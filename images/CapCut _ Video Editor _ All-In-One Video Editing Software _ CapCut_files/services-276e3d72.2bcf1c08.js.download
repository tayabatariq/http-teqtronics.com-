"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["7722"],{180773:function(e,t,r){r.d(t,{j:function(){return i}});let i=(0,r(335290).yh)("audio-player-service")},433679:function(e,t,r){r.d(t,{D:function(){return a}});var i=r(827322),s=r(587892),n=r(402655),o=r(407899);class a extends n.JT{get error(){return this._audio.error}get duration(){return this._audio.duration}get currentTime(){return this._audio.currentTime}get url(){return this._audio.src}get volume(){return this._audio.volume}get muted(){return this._audio.muted}get rate(){return this._audio.playbackRate}play(){return this._audio.play()}pause(){this._audio.pause()}dispose(){this._audio.pause(),super.dispose()}setCurrentTime(e){this._audio.currentTime=e}setVolume(e){this._audio.volume=e}setMuted(e){this._audio.muted=e}setRate(e){this._audio.playbackRate=e}constructor(e){var t;super(),this._onPlay=new s.Q,this._onPlaying=new s.Q,this._onPause=new s.Q,this._onEnded=new s.Q,this._onTimeUpdate=new s.Q,this._onLoadedMetaData=new s.Q,this._onVolumeChange=new s.Q,this._onError=new s.Q,this._audio=new Audio,this.onPlay=this._onPlay.event,this.onPlaying=this._onPlaying.event,this.onPause=this._onPause.event,this.onEnded=this._onEnded.event,this.onTimeUpdate=this._onTimeUpdate.event,this.onLoadedMetaData=this._onLoadedMetaData.event,this.onVolumeChange=this._onVolumeChange.event,this.onError=this._onError.event,this._audio.src=(0,i.C)(e.url,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),this._audio.volume=e.volume,this._audio.playbackRate=null!==(t=e.rate)&&void 0!==t?t:1,this._register((0,o.n)(this._audio,"play",()=>{this._onPlay.fire()})),this._register((0,o.n)(this._audio,"playing",()=>{this._onPlaying.fire()})),this._register((0,o.n)(this._audio,"pause",()=>{this._onPause.fire()})),this._register((0,o.n)(this._audio,"ended",()=>{this._onEnded.fire()})),this._register((0,o.n)(this._audio,"timeupdate",()=>{this._onTimeUpdate.fire()})),this._register((0,o.n)(this._audio,"loadedmetadata",()=>{this._onLoadedMetaData.fire()})),this._register((0,o.n)(this._audio,"volumechange",()=>{this._onVolumeChange.fire()})),this._register((0,o.n)(this._audio,"error",e=>{this._onError.fire(e.target.error)}))}}},545713:function(e,t,r){r.d(t,{b:function(){return i}});class i{setViewStateToLocal(e,t){if(!this._guideService.isMuted)localStorage.setItem(e,JSON.stringify(t))}removeViewStateFromLocal(e){localStorage.removeItem(e)}getViewStateFromLocal(e){let t=localStorage.getItem(e);if(!!t)return"true"===t}setViewStateToServer(e){return this._tagStateDataService.setTagState({tag:e})}getViewStateFromServer(e){return this._tagStateDataService.getTagState({tags:e})}setViewStateToLocalAndServer(e,t){if(!this._guideService.isMuted)this.setViewStateToLocal(e,t),t&&this.setViewStateToServer(e)}constructor(e,t){this._tagStateDataService=e,this._guideService=t}}},214312:function(e,t,r){r.d(t,{u:function(){return i}});let i=(0,r(335290).yh)("context-view-service")},929818:function(e,t,r){r.d(t,{R:function(){return a}});var i=r(587892),s=r(402655),n=r(800788),o=r(570126);class a extends s.JT{get onMount(){return this._onMount.event}get onUnmount(){return this._onUnmount.event}mount(){if(!this._isMounted)this._isMounted=!0,document.body.appendChild(this.container),this.root.render(this._component),this._onMount.fire()}show(){this.container.style.display="block"}hide(){this.container.style.display="none"}unmount(){if(!this._isUnmounted)(0,n.Y2)(this._isMounted,"should mount before unmount"),this._isUnmounted=!0,this.root.unmount(),document.body.contains(this.container)&&document.body.removeChild(this.container),this._onUnmount.fire(),this.dispose()}constructor(e,t){super(),this._onMount=this._register(new i.Q),this._onUnmount=this._register(new i.Q),this._isMounted=!1,this._isUnmounted=!1,this.id=e.id,this._component=e.component,this.root=(0,o.createRoot)(t),this.container=t}}},82797:function(e,t,r){r.d(t,{n:()=>d});var i=r("690613"),s=r("114861"),n=r("405051"),o=r("894339"),a=r("515207"),c=r("863183"),u=r("121130");let l={RegisterUploadLink:"/cc/v1/workspace/update_workspace_upload_link",GetUploadInfo:"/cc/v1/workspace/get_workspace_upload_link"};class d{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new n.yk().build({headers:{"Content-Type":"application/json"}});return(0,o.mH)(e),(0,a.J)(e),(0,s.V)(e),(0,c.xP)(e),(0,u.i3)(e),e}()),this._networkClientInstance}async registerUploadLink(e){try{let t=await this._networkClient.post(l.RegisterUploadLink,{workspaceId:e.workspaceId});return(0,i.oW)(t.data.uploadLink)}catch(e){return(0,i.wf)(-1,"api call error")}}async getUploadInfo(e){try{let t=await this._networkClient.post(l.GetUploadInfo,{workspaceId:e.workspaceId});return(0,i.oW)(t.data)}catch(e){return(0,i.wf)(-1,"api call error")}}}},315401:function(e,t,r){r.d(t,{$d:function(){return d},ZS:function(){return c},Zj:function(){return u},tQ:function(){return _},tz:function(){return l}});var i,s,n,o,a,c=((i={})[i.ALL=0]="ALL",i[i.NORMAL=1]="NORMAL",i[i.VIDEO=2]="VIDEO",i);var u=((s={})[s.HitSensitiveWord=2334]="HitSensitiveWord",s[s.DirectoryExceedMaxDepth=2416]="DirectoryExceedMaxDepth",s[s.FolderNotExist=2417]="FolderNotExist",s);var l=((n={})[n.DeleteNotEmptyFolder=2415]="DeleteNotEmptyFolder",n);var d=((o={}).WaitForSync="waitForSync",o.Normal="normal",o);var _=((a={})[a.Initial=0]="Initial",a[a.Process=1]="Process",a[a.CleanUp=2]="CleanUp",a[a.Success=3]="Success",a[a.Failure=4]="Failure",a)},885692:function(e,t,r){r.d(t,{A:function(){return m}});var i=r(789786),s=r(690613),n=r(763832),o=r(800788),a=r(114861),c=r(690465),u=r(583642),l=r(127830),d=r(405051),_=r(894339),h=r(121130),p=r(866006),g=r(191449),y=r(672621),f=r(315401),v=r(618026);class m{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new d.yk().build({headers:{"Content-Type":"application/json"},withCredentials:!0});return(0,_.mH)(e),(0,a.V)(e,{retries:2}),(0,h.e_)(e),e}()),this._networkClientInstance}async getMaterials(e){let{count:t,assetSource:r,orderBy:i,order:n,workspaceId:o,spaceId:a}=e.config;try{let{assets:u,has_more:l,new_cursor:d}=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.GET_MATERIAL_LIST}),data:{count:t,asset_source:r,order_by:i,order:n,cursor:`${e.offset}`,workspace_id:o,space_id:a},withCredentials:!0}),_=(null!=u?u:[]).map(v.M);return(0,s.oW)((0,p.ib)(e.config,_,{hasMore:l,offset:Number(d)}))}catch(e){return(0,s.wf)(-1,null==e?void 0:e.message)}}async getUserAssets(e){let{count:t,orderBy:r,order:i,workspaceId:n,parentId:o,assetTypes:a,isCrossFolder:l,offset:d,entryIds:_}=e.config;try{let{assets:h,has_more:g}=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.GET_ASSET_QUERY}),data:{count:t,asset_types:a,parent_id:o,is_cross_folder:l,order_by:r,order:i,offset:d,workspace_id:n,entry_ids:_},withCredentials:!0}),f=(null!=h?h:[]).map(e=>(0,u.y)(e));return(0,s.oW)((0,p.ib)(e.config,f,{hasMore:g,offset:d+t}))}catch(e){return(0,s.wf)(-1,null==e?void 0:e.message)}}async getOriginalUserAssets(e){let{count:t,orderBy:r,order:i,workspaceId:n,parentId:o,assetTypes:a,isCrossFolder:u,offset:l,entryIds:d}=e.config;try{let{assets:_,has_more:h}=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.GET_ASSET_QUERY}),data:{count:t,asset_types:a,parent_id:o,is_cross_folder:u,order_by:r,order:i,offset:l,workspace_id:n,entry_ids:d},withCredentials:!0});return(0,s.oW)((0,p.ib)(e.config,_,{hasMore:h,offset:l+t}))}catch(e){return(0,s.wf)(-1,null==e?void 0:e.message)}}async getMaterialsByIds(e){let t=this._splitArray(e.assetIds,100);try{let r=(await Promise.all(t.map(t=>this._networkClient.request({withCredentials:!0,method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.GET_MATERIALS_BY_IDS}),data:{workspace_id:e.workspaceId,space_id:e.spaceId,asset_ids:t}})))).reduce((e,t)=>e.concat(t.assets.map(v.M)),[]);if(e.assetIds.length>r.length)return(0,s.wf)(-1,"not found all assets");return(0,s.oW)(r)}catch(e){var r,i;return(0,s.wf)(Number(null!==(r=null==e?void 0:e.ret)&&void 0!==r?r:-1),null!==(i=null==e?void 0:e.errmsg)&&void 0!==i?i:null==e?void 0:e.message)}}async tryGetMaterialsByIds(e){let t=this._splitArray(e.assetIds,100);try{let r=(await Promise.all(t.map(t=>this._networkClient.request({withCredentials:!0,method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.GET_MATERIALS_BY_IDS}),data:{workspace_id:e.workspaceId,space_id:e.spaceId,asset_ids:t}})))).reduce((e,t)=>e.concat(t.assets.map(v.M)),[]);return(0,s.oW)(r)}catch(e){var r,i;return(0,s.wf)(Number(null!==(r=null==e?void 0:e.ret)&&void 0!==r?r:-1),null!==(i=null==e?void 0:e.errmsg)&&void 0!==i?i:null==e?void 0:e.message)}}copyMaterialToWorkspace(e){return this.copyAsset({...e,assetType:l.pS.Material})}async copyAsset(e){let{fromWorkspaceId:t,toWorkspaceId:r,meta:i,assetId:o,folderId:a,assetType:u}=e;try{let e=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.COPY_ASSET}),data:{from_workspace_id:t,to_workspace_id:r,meta:i,asset_id:o,folder_id:a,asset_type:u},withCredentials:!0}),l=0,d=async()=>{let t=await this._checkAsyncTaskProcess({workspace_id:r,process_id:e.process_id});if(!t.ok)return++l>10?(0,s.wf)(-2,"process task fetch failure"):(await (0,n.D)(500),d());return t.value.isProcess?(l=0,await (0,n.D)(500),d()):t.value.isSuccess?t:(0,s.wf)(-3,"server copy asset task failure")};return await d()}catch(e){var l;return(0,s.wf)((null==e?void 0:e.ret)?Number(null==e?void 0:e.ret):-1,null!==(l=null==e?void 0:e.errmsg)&&void 0!==l?l:null==e?void 0:e.message)}}async deleteMaterials(e){let{workspaceId:t,assetIds:r}=e;try{return await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.DELETE_MATERIALS}),data:{workspace_id:t,asset_ids:r},withCredentials:!0}),(0,s.ly)()}catch(e){return(0,s.Mx)(Number(e.ret)||-1,(null==e?void 0:e.errmsg)||e.message,e)}}async renameAsset(e){let{workspaceId:t,assetId:r,name:i}=e;try{return await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.RENAME_ASSET}),data:{workspace_id:t,asset_id:r,asset_name:i},withCredentials:!0}),(0,s.ly)()}catch(e){return(0,s.Mx)(Number(e.ret)||-1,(null==e?void 0:e.errmsg)||e.message,e)}}async createAsset(e){let{name:t,assetType:r,parentId:i,workspaceId:n,enableOverDeep:o}=e;try{let e=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.CREATE_ASSET}),data:{name:t,asset_type:r,parent_id:i,workspace_id:n,enable_over_deep:o},withCredentials:!0});return(0,s.oW)((0,u.y)(e))}catch(e){if(e.ret===String(f.Zj.HitSensitiveWord))return(0,s.wf)(f.Zj.HitSensitiveWord,e.errmsg);if(e.ret===String(f.Zj.DirectoryExceedMaxDepth))return(0,s.wf)(f.Zj.DirectoryExceedMaxDepth,e.errmsg);if(e.ret===String(f.Zj.FolderNotExist))return(0,s.wf)(f.Zj.FolderNotExist,e.errmsg);return(0,s.wf)(-1,null==e?void 0:e.message)}}async labelAssetsAsExported(e){try{let t=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.LABEL_AS_EXPORTED}),data:(0,g.X)(e),withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.ly)()}catch(e){var t,r;return(0,s.wf)(Number(null!==(t=null==e?void 0:e.ret)&&void 0!==t?t:-1),null!==(r=null==e?void 0:e.errmsg)&&void 0!==r?r:null==e?void 0:e.message)}}async promoteAsset(e){try{let t=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.PROMOTE_ASSET}),data:(0,g.X)(e),withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.ly)()}catch(e){var t,r;return(0,s.wf)(Number(null!==(t=null==e?void 0:e.ret)&&void 0!==t?t:-1),null!==(r=null==e?void 0:e.errmsg)&&void 0!==r?r:null==e?void 0:e.message)}}async _checkAsyncTaskProcess(e){try{let t=await this._networkClient.request({method:"POST",url:this._httpApiSettingService.getRequestURL({domainType:c.Y.DEFAULT,path:y.b.QUERY_PROCESS}),data:e,withCredentials:!0});switch(t.status){case f.tQ.Initial:case f.tQ.Process:return(0,s.oW)({isProcess:!0,isSuccess:!1});case f.tQ.CleanUp:case f.tQ.Failure:return(0,s.oW)({isProcess:!1,isSuccess:!1});case f.tQ.Success:return(0,s.oW)({isProcess:!1,isSuccess:!0,newId:t.new_id_str});default:(0,o.bP)(t.status)}}catch(e){return(0,s.wf)(-1,null==e?void 0:e.message)}}_splitArray(e,t){let r=[];for(let i=0;i<e.length;i+=t)r.push(e.slice(i,i+t));return r}constructor(e){this._httpApiSettingService=e}}m=(0,i.gn)([(0,i.fM)(0,c.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.x?Object:c.x])],m)},618026:function(e,t,r){r.d(t,{M:function(){return _}});var i=r(73435),s=r(426020),n=r(875320),o=r(180685),a=r(300303),c=r(532611),u=r(127830),l=r(374904);function d(e,t){var r;let i={},s="video"===t?"player_":"audio_";return Object.entries(null!==(r=e.play_info)&&void 0!==r?r:{}).forEach(e=>{let[t,r]=e;if(t.startsWith(s)&&r){if(!(r.primary_url||r.secondary_url))return;i[t.replace(s,"")]={url:r.primary_url,backupUrl:r.secondary_url,key:r.url_key}}}),Object.keys(i).length?i:void 0}function _(e){let t={key:e.md5,sourceType:s.ov.EverCloud,assetType:u.pS.Material,assetId:e.asset_id,filename:e.filename,fileType:s.YB.File,owner:e.owner,md5:e.md5,mime:e.mime,size:e.size,sourcePath:e.source_path,createdAt:e.create_time?new Date(e.create_time).valueOf():void 0,updatedAt:e.updated_at,url:e.origin_download_link,subType:e.sub_type,meta:e.meta},r=(0,a.m)(e.meta);if((0,c.Ml)(t)||(0,c.jL)(r))return(0,c.jL)(r)&&(t.decryptKey=null==r?void 0:r.key),t;switch(e.file_type||(0,l.Gt)(t.mime)){case s.YB.Image:return function(e,t){let r=function(e){var t;let r={};return Object.entries(null!==(t=e.preview_url)&&void 0!==t?t:{}).forEach(t=>{let[i,s]=t;r[i.replace("bucket_key_","")]={width:0,height:0,url:s,key:e.preview_key}}),r}(e),n=(()=>{var t,s,n;if(null===(t=e.preview_url)||void 0===t?void 0:t.bucket_key_360p)return{url:null===(n=e.preview_url)||void 0===n?void 0:n.bucket_key_360p,key:e.preview_key};let o=null===(s=Object.values(r))||void 0===s?void 0:s[0];return o?{url:o.url,key:o.key}:(0,i.i)(e.width,e.height)})();return{...t,fileType:s.YB.Image,cover:n,width:e.width,height:e.height,isImgTranscoding:!1,imgTranscodeInfo:r}}(e,t);case s.YB.Video:return function(e,t){var r,a,c,u,_,h,p;let g=(null===(r=e.preview_url)||void 0===r?void 0:r.bucket_key_360p)?{url:null===(a=e.preview_url)||void 0===a?void 0:a.bucket_key_360p,key:e.preview_key}:(0,i.i)(e.width,e.height),y=(null===(u=e.sprite_frame)||void 0===u?void 0:null===(c=u.detail_infos)||void 0===c?void 0:c.length)?(0,n.J)(null==e?void 0:e.sprite_frame):(0,o.y)({url:null!==(h=g.url)&&void 0!==h?h:"",key:e.preview_key,width:e.width,height:e.height});return{...t,fileType:s.YB.Video,cover:g,width:e.width,height:e.height,duration:(null!==(p=e.duration)&&void 0!==p?p:0)/1e3,isVideoTranscoding:1===e.transcode_status,isVideoCompletion:null===(_=e.filter_list)||void 0===_?void 0:_.includes(l.VW.FILM_ASSET),videoTranscodeInfo:d(e,"video"),thumb:y}}(e,t);case s.YB.Audio:var _,h;return _=e,{...t,fileType:s.YB.Audio,duration:(null!==(h=_.duration)&&void 0!==h?h:0)/1e3,isAudioTranscoding:1===_.transcode_status,audioTranscodeInfo:d(_,"audio")};default:return t}}},314823:function(e,t,r){function i(e){if(!!(e.primary_url||e.secondary_url))return{url:e.primary_url,backupUrl:e.secondary_url,key:e.url_key}}function s(e){let t={};if(e.audio){let r=i(e.audio);r&&(t["128kb"]=r)}if(e.p360){let r=i(e.p360);r&&(t["360p"]=r)}if(e.p480){let r=i(e.p480);r&&(t["480p"]=r)}if(e.p720){let r=i(e.p720);r&&(t["720p"]=r)}if(e.origin){let r=i(e.origin);r&&(t.origin=r)}return Object.keys(t).length?t:void 0}r.d(t,{J:function(){return s}})},748177:function(e,t,r){r.d(t,{m:function(){return i}});function i(e){if(!e)return;let t=e.lastIndexOf(".");if(-1!==t)return e.substr(t+1)}},36955:function(e,t,r){r.d(t,{h:function(){return _}});var i=r(789786),s=r(532653),n=r(405051),o=r(894339),a=r(121130),c=r(515207),u=r(141314),l=r(621249),d=r(58344);class _{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new n.yk().build({headers:{"Content-Type":"application/json"}});return(0,o.mH)(e),(0,a.i3)(e),(0,c.J)(e),e}()),this._networkClientInstance}async getVodToken(e){let t=this._urlGenerator.url("GET_VOD_TOKEN"),{data:r}=await this._networkClient.post(t,{key_version:"v5",biz:e},{[s.$R]:!1});return{key:r.key,sign:r.sign,accessKeyId:r.access_key_id,secretAccessKey:r.secret_access_key,sessionToken:r.session_token,expiredTime:r.expired_time,currentTime:r.current_time,spaceName:r.space_name}}constructor(){this._urlGenerator=new u.w(d.H)}}(0,i.gn)([(0,l.K)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof VodSpaceName?Object:VodSpaceName]),(0,i.w6)("design:returntype",Promise)],_.prototype,"getVodToken",null)},321327:function(e,t,r){r.d(t,{_:function(){return a}});var i=r(789786),s=r(376907),n=r(230689),o=r(963727);class a{runTask(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return this._getContainerService().createInstance(e,...r)}_getContainerService(){if(this._ffmpegContainerService)return this._ffmpegContainerService;let e=new s.R;return e.register(o.i,o.e),this._ffmpegContainerService=this._containerService.createChild(e.makeCollection()),this._ffmpegContainerService}constructor(e){this._containerService=e}}a=(0,i.gn)([(0,i.fM)(0,n.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.t?Object:n.t])],a)},753637:function(e,t,r){r.d(t,{L:function(){return i}});let i=(0,r(335290).yh)("ffmpeg-adapter-service")},224360:function(e,t,r){r.d(t,{Q:function(){return c}});var i=r(789786),s=r(587892),n=r(690613),o=r(108628),a=r(963727);class c{get value(){return this._value}get error(){return this._error}async start(){let e;let{release:t,ffmpeg:r}=await this._driverService.acquire();if(!r.loaded){this._fireError((0,n.wf)(-1,"ffmpeg loaded fail.")),t();return}this._error=void 0,this._value=void 0;let{name:i}=this._file;try{r.writeFile(i,await (0,o.dc)(this._file))}catch(e){this._fireError((0,n.Mx)(-1,"write fs error.",e)),t();return}r.on("log",this._listenLog);try{await r.exec(["-i",i])}catch(e){this._fireError((0,n.Mx)(-1,"check video meta error.",e)),this._clearFs(r),t();return}finally{r.off("log",this._listenLog)}if(!this._hasAudio){this._fireError((0,n.wf)(-1,"video has not audio.")),this._clearFs(r),t();return}let s=`${this._name}.${this._outputFormat}`,a=`audio/${this._outputFormat}`;r.on("progress",this._listenProgress);try{await r.exec(["-i",i,"-acodec","mp3","-vn","-qscale:a","5",s],3e4)}catch(e){this._fireError((0,n.Mx)(-1,"extract video error.",e)),this._clearFs(r),t();return}finally{r.off("progress",this._listenProgress)}try{e=await r.readFile(s)}catch(e){this._fireError((0,n.Mx)(-1,"read fs error.",e)),this._clearFs(r),t();return}try{let t=new Blob([e],{type:a}),r=new File([t],s,{type:a});this._value=r,this._onSuccess.fire(this._value)}catch(e){this._fireError((0,n.Mx)(-1,"return result.",e))}finally{this._clearFs(r),t()}}_fireError(e){this._error=e,this._onFail.fire(this._error)}_clearFs(e){e.deleteFile(this._file.name)}constructor(e,t,r){this._driverService=r,this._onProgress=new s.Q,this._onSuccess=new s.Q,this._onFail=new s.Q,this._hasAudio=!1,this._listenLog=e=>{let{message:t}=e;t.indexOf("Audio:")>=0&&(this._hasAudio=!0)},this._listenProgress=e=>{this._onProgress.fire(e.progress)},this.onProgress=this._onProgress.event,this.onSuccess=this._onSuccess.event,this.onFail=this._onFail.event,this._file=e.file,this._name=t.name,this._outputFormat=t.outputFormat}}c=(0,i.gn)([(0,i.fM)(2,a.i),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IExtractAudioInput?Object:IExtractAudioInput,"undefined"==typeof IExtractAudioOutput?Object:IExtractAudioOutput,void 0===a.i?Object:a.i])],c)},242785:function(e,t,r){r.d(t,{O:function(){return n},r:function(){return o}});var i,s=r(335290);var n=((i={})[i.Canvas=0]="Canvas",i[i.Image=1]="Image",i);let o=(0,s.yh)("graphic-toolkit")},867206:function(e,t,r){r.d(t,{C:()=>E});var i=r("789786"),s=r("587892"),n=r("402655"),o=r("176022"),a=r("772322");r("818938"),r("225572");var c=r("953032"),u=r("255276"),l=r("97257"),d=r("827322"),_=r("218571"),h=r("641077"),p=r("150564"),g=r("801497"),y=r("941865"),f=r("438536"),v=r("105789"),m=r.n(v),w=r("799587");let k=e=>{let{guideProps:t,target:r,wrapStyle:i}=e,{title:s,content:n,image:v,disableCancel:k,cancelLabel:T,placement:R,cancel:b,confirm:S,confirmLabel:C,className:I,contentClassName:P,showCloseIcon:E=!0,showStepText:A=!0,stepText:M,stepIndex:x,steps:O=[],okText:F,nextText:D,skipText:L,showSkipButton:U=!1,showFooter:B=!0,showArrow:G=!0,blurToNext:j,mask:V,maskClosable:H,maskClassName:N,arrowClassName:q,closeClassName:Y,maskPlaceholderClassName:$,maskBackgroundColor:K="rgba(0, 0, 0, .6)",placeholderRadius:W=12,placeholderBorderColor:Q,placeholderBorderWidth:J="2px",placeholderBorderStyle:Z="solid",handleTargetClick:z,clickToClose:X=!1,clickToCloseTooltip:ee=!1,clickTargetToClose:et=!1,resizeObserverSelectors:er=[],mutationObserverSelectors:ei=[],scrollContainerSelector:es,mouseLeaveToClose:en=!1,offset:eo,useNewArrow:ea}=t,[ec,eu]=(0,_.useState)(!0),el=V?K:"transparent",[ed,e_]=(0,_.useState)(null!=i?i:{}),{run:eh}=(0,c.default)(()=>{let e=(0,w.pX)(r,V||j);e&&e_(e)},200,[],{trailing:!0,leading:!1});(0,_.useEffect)(()=>(eh(),window.addEventListener("resize",eh),()=>{window.removeEventListener("resize",eh)}),[eh,r]),(0,_.useEffect)(()=>{for(let e of er){let t=new ResizeObserver(()=>{eh()}),r=document.querySelector(e);if(r)return t.observe(r),()=>{t.disconnect()}}},[er,eh]),(0,_.useEffect)(()=>{for(let e of ei){let t=new MutationObserver(e=>{eh()}),r=document.querySelector(e);if(r)return t.observe(r,{attributes:!0,childList:!1,subtree:!1}),()=>{t.disconnect()}}},[ei,eh]),(0,_.useEffect)(()=>{if(!es)return;let e=document.querySelector(es);if(e)return e.addEventListener("scroll",eh),()=>{null==e||e.removeEventListener("scroll",eh)}},[es,eh]);let ep=(e,t)=>{eu(!1),null==t||t(e)},eg=e=>{!e&&ep({from:o.c.VisibleChange},S)},ey=()=>{V&&H&&ep({from:o.c.ClickMask},S),j&&ep({from:o.c.ClickMask},S)};(0,_.useEffect)(()=>{let e;let t=()=>{ep({from:o.c.ClickTarget},S)};return X&&(null==(e=(0,w.nq)(r))||e.addEventListener("click",t)),()=>{e&&e.removeEventListener("click",t)}},[X,r]);let ef=(0,_.useRef)(null);(0,_.useEffect)(()=>{let e=t=>{t.stopPropagation(),document.body.removeEventListener("click",e,!0)},t=e=>{e.stopPropagation(),document.body.removeEventListener("mouseup",t,!0)},i=()=>{ep({from:o.c.ClickFocus},S),document.body.removeEventListener("mouseup",i,!0)},s=s=>{var n,o,a;let c=(0,w.nq)(r);if(!((null===(n=ef.current)||void 0===n?void 0:n.contains(s.target))||(null===(o=document.querySelector(".lv-modal-wrapper"))||void 0===o?void 0:o.contains(s.target))||(null===(a=document.querySelector(".lv_cookie_banner-wrapper"))||void 0===a?void 0:a.contains(s.target)))){if((null==c?void 0:c.contains(s.target))||V&&H||j){document.body.addEventListener("mouseup",i,!0);return}V&&(s.stopPropagation(),document.body.addEventListener("mouseup",t,!0),document.body.addEventListener("click",e,!0))}};if(et&&r)return document.body.addEventListener("mousedown",s,!0),()=>{document.body.removeEventListener("mousedown",s,!0)}},[et,r,H,S,V,j]);let ev=(0,_.useCallback)(()=>{if(k||!U)return null;if(T){let e=typeof T;return"number"===e||"string"===e||"boolean"===e?(0,a.jsx)(l.Z,{type:"default",className:"guide-cancel-button",onClick:()=>ep.bind(void 0)({from:o.c.CancelLable},b),children:T}):(0,a.jsx)("div",{onClick:()=>ep.bind(void 0)({from:o.c.CancelLable},b),children:T})}return(0,a.jsx)(l.Z,{type:"default",className:"guide-cancel-button",onClick:()=>ep.bind(void 0)({from:o.c.CancelBtn},b),children:null!=L?L:g.oc.t("skip_web",{},"Skip")})},[T,b,k,U,L]),em=(0,_.useCallback)(()=>{if(C){let e=typeof C;return"number"===e||"string"===e||"boolean"===e?(0,a.jsx)(l.Z,{type:"primary",className:"guide-confirm-button",onClick:()=>ep.bind(void 0)({from:o.c.ConfirmLabel},S),children:C}):(0,a.jsx)("div",{onClick:()=>ep.bind(void 0)({from:o.c.ConfirmLabel},S),children:C})}return(0,a.jsx)(l.Z,{type:"primary",className:"guide-confirm-button",onClick:()=>ep.bind(void 0)({from:o.c.ConfirmBtn},S),children:x===O.length?null!=F?F:g.oc.t("know_ok",{},"Ok"):null!=D?D:g.oc.t("next_web",{},"Next")})},[S,C,x,O.length,F,D]),ew=(0,_.useMemo)(()=>{let e=O.length;return A&&1!==e?M?M(x,e):`${x}/${e}`:""},[M,x,O.length,A]),ek=(0,_.useMemo)(()=>{let e={};return(null==eo?void 0:eo.x)&&(e.marginLeft=`${null==eo?void 0:eo.x}px`),(null==eo?void 0:eo.y)&&(e.marginTop=`${null==eo?void 0:eo.y}px`),e},[eo]),eT=()=>(0,a.jsxs)("div",{ref:ef,className:`${f.Z["service-guide-container"]} ${null!=P?P:""}`,style:{...ek},children:[ea?(0,a.jsx)("img",{className:f.Z["hover-tips-triangle"]+(q?` ${q}`:""),src:(0,d.C)(y.Z,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})}):null,E&&(0,a.jsx)("div",{className:f.Z["guide-close-icon"]+(Y?` ${Y}`:""),onClick:()=>{ep({from:o.c.CloseIcon},b)},children:(0,a.jsx)(p.x8P,{})}),!!s&&(0,a.jsx)("div",{className:"guide-title",children:s}),(0,a.jsxs)("div",{className:"guide-content",children:[n,v?(0,a.jsx)("div",{className:"guide-content-image",children:(0,a.jsx)(h.Z,{src:(0,d.C)(v,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})})}):null]}),B&&(0,a.jsxs)("div",{className:"guide-footer",children:[(0,a.jsx)("div",{className:"guide-step-text",children:ew}),(0,a.jsxs)("div",{className:"guide-step-buttons",children:[ev(),em()]})]})]});return V||j?(0,a.jsx)("div",{style:{borderColor:el,...ed},className:m()(f.Z["guide-wapper"],N,{[f.Z["pointer-events-none"]]:et}),children:(0,a.jsx)(u.Z,{onClick:z,clickToCloseTooltip:ee,onVisibleChange:eg,onClickOutside:ey,popup:()=>eT(),popupVisible:ec&&(0,w.YE)(ed),blurToHide:!1,clickToClose:X,mouseLeaveToClose:en,showArrow:G&&!ea,arrowProps:{className:"guide-service-arrow"+(q?` ${q}`:""),style:{display:ea?"none":"block"}},className:m()(f.Z["guide-trigger"],I),position:R,updateOnScroll:!0,autoFitPosition:!0,autoFixPosition:!0,children:(0,a.jsxs)("div",{className:f.Z["guide-placeholder"]+($?` ${$}`:""),style:{"--guide-service-placeholder-radius":`${W}px`,"--guide-service-placeholder-before-color":el},children:[(0,a.jsx)("div",{className:f.Z["guide-placeholder-before"]}),(0,a.jsx)("div",{className:f.Z["guide-placeholder-after"],style:{...Q?{borderColor:Q}:{},...J?{borderWidth:J}:{},...Z?{borderStyle:Z}:{}}})]})})}):(0,a.jsx)(u.Z,{onClick:z,clickToCloseTooltip:ee,onVisibleChange:eg,onClickOutside:ey,popup:()=>eT(),popupVisible:ec&&(0,w.YE)(ed),blurToHide:!1,clickToClose:X,mouseLeaveToClose:en,showArrow:G&&!ea,arrowProps:{className:"guide-service-arrow"+(q?` ${q}`:""),style:{display:ea?"none":"block"}},className:m()(f.Z["guide-trigger"],I,{[f.Z["pointer-events-none"]]:et}),position:R,updateOnScroll:!0,autoFitPosition:!0,autoFixPosition:!0,childrenPrefix:"akara",children:(0,a.jsx)("div",{className:f.Z["guide-placeholder-without-mask"],style:{borderRadius:W,...X?{zIndex:0}:{},...Q?{borderColor:Q}:{},...J?{borderWidth:J}:{},...ed}})})};var T=r("570126");let R=class e{_remove(){var e;null===(e=this.root)||void 0===e||e.unmount()}close(){this._remove()}show(e){var t,r;!this.modal&&(this.modal=document.createElement("div"),document.body.appendChild(this.modal));let{target:i}=e;null===(t=(r=e.guideProps).show)||void 0===t||t.call(r);let{mask:s,blurToNext:n}=e.guideProps,o=(0,w.pX)(i,s||n);if(!!o)this.root=(0,T.createRoot)(this.modal),this.root.render((0,a.jsx)(k,{guideProps:{...e.guideProps,cancel:t=>{var r,i;this._remove(),null===(r=(i=e.guideProps).cancel)||void 0===r||r.call(i,t)},confirm:()=>{var t,r;this._remove(),null===(t=(r=e.guideProps).confirm)||void 0===t||t.call(r)}},wrapStyle:o,target:i}))}constructor(){this.modal=null,this.root=null}};class b extends n.JT{setGuideQueue(e){this.guideQueue=e}}class S extends b{get index(){return this._index}set index(e){this._index=e}clear(){this._guide.close(),this._onClear.fire()}invoke(){return this.status="invoking",new Promise(e=>{let t=this.guideQueue.steps[this.index];if(t){let{target:r,confirm:i,cancel:s}=t;if(!(0,w.nq)(r)){this.status="end",e({done:!1,status:"error"});return}this.index++,this._guide.show({target:r,guideProps:{...this.guideQueue,...t,stepIndex:this.index,confirm:()=>this._confirm(e,i),cancel:t=>this._cancel(e,t,s),mask:this.guideQueue.mask,maskClosable:this.guideQueue.maskClosable,className:this.guideQueue.className,contentClassName:this.guideQueue.contentClassName}});return}this.status="end",e({done:!0,status:"end"})})}stopShowAgain(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this._stopShowAgainStatus=e,"end"===this.status&&this._storage.set(this.guideQueue.key,e)}_confirm(e,t){null==t||t(),this._onClose.fire(o.c.CancelBtn),this._setShowState(),e({done:!1,status:"success"})}_cancel(e,t,r){null==r||r(t),this._onClose.fire(t.from);let{key:i,cancelWithSkip:s}=this.guideQueue;this._setShowState(),s&&this._storage.set(i,!0),e({done:!0,status:"success"})}_setShowState(){let{steps:e,repeat:t,key:r}=this.guideQueue;this.index>=e.length&&(!t&&this._storage.set(r,!0),void 0!==this._stopShowAgainStatus&&this._storage.set(r,this._stopShowAgainStatus))}constructor(e,t){super(),this.guideQueue={},this._index=0,this._onClear=new s.Q,this.onClear=this._onClear.event,this._onClose=new s.Q,this.onClose=this._onClose.event,this._storage=t.keyValue,this.setGuideQueue(e),this.status="pending",this._guide=new R}}var C=r("332557"),I=r("396190"),P=r("134392");class E extends n.JT{get isMuted(){return this._isMuted}mute(){this._isMuted=!0,this.queue=[]}unmute(){this._isMuted=!1}trigger(e){if(this._environmentService.isAutoTest||this._environmentService.isRealAutoTest||this._isMuted)return null;let{key:t}=e,r=this.keyValue.query(t);if(r.ok&&"true"===r.value)return null;let i=this.getCurrentShowState();if(i.show&&i.key===e.key||this.queue.find(t=>t.guideQueue.key===e.key))return null;let s=new S(e,this.storage);return this.queue.push(s),this._running||this._invoke(),s}clear(){var e,t;this.queue=[],null===(t=this._currentGuide)||void 0===t||null===(e=t.clear)||void 0===e||e.call(t)}getShowStateByKey(e){let t=this.keyValue.query(e);return t.ok&&"true"===t.value}getCurrentShowState(){var e;return{show:this._running,key:null===(e=this._currentGuide)||void 0===e?void 0:e.guideQueue.key}}setGuideShowed(e){this.keyValue.set(e,!0)}_next(){this.queue.length&&(this._running||this._invoke())}async _invoke(){let e=this.queue.shift();if(this._currentGuide=e,e){this._running=!0,this._onStateChange.fire(this.getCurrentShowState()),e.guideQueue.mask&&this._keybindingService.disableKeybinding();let t=e.onClear(()=>{this._running&&this._currentGuide===e&&(this._running=!1,this._currentGuide=void 0,this._onStateChange.fire(this.getCurrentShowState()),this._keybindingService.restoreKeybinding(),this._next(),t.dispose())});try{let t=await e.invoke();for(;!t.done&&"success"===t.status;)t=await e.invoke()}catch(e){}this._running=!1,this._onStateChange.fire(this.getCurrentShowState()),e.guideQueue.mask&&this._keybindingService.restoreKeybinding(),t.dispose()}this._next()}constructor(e,t,r){super(),this.storage=e,this._environmentService=t,this._keybindingService=r,this.queue=[],this._running=!1,this._onStateChange=this._store.add(new s.Q),this.onStateChange=this._onStateChange.event,this._isMuted=!1,this.keyValue=this.storage.keyValue,this.queue=[]}}E=(0,i.gn)([(0,i.fM)(0,C.U),(0,i.fM)(1,I.Y),(0,i.fM)(2,P.d),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C.U?Object:C.U,void 0===I.Y?Object:I.Y,void 0===P.d?Object:P.d])],E)},123869:function(e,t,r){r.d(t,{S:function(){return i}});let i=(0,r(335290).yh)("i18n-service")},376915:function(e,t,r){r.d(t,{D:function(){return _}});var i=r(827322),s=r(801497),n=r(184568),o=r(269307),a=r(587892),c=r(402655),u=r(800788),l=r(293698),d=r(961087);class _ extends c.JT{get currentLocale(){return(0,u.ZB)(this._locale),this._locale.getCurrentLocale()}get supportLanguages(){return(0,u.ZB)(this._locale),this._locale.getSupportLocales().map(e=>({locale:e.locale,text:e.text}))}changeLocale(e){this._locale.setCurrentLocale(e),this._onLocaleChange.fire(e);let t=(0,l.vB)();location.href=(0,i.C)(`${location.pathname}?${t}`,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})}async allowToRender(){await this._initAwaitLock.awaitForInit()}_overwriteI18nT(){let{t:e}=s.ZP,{searchParams:t}=new URL(window.location.href);t.get("__debug_i18n__");let r=new Map;s.ZP.t=(t,i,n)=>{if(i&&Object.values(i).some(e=>"function"==typeof e))return e.call(s.ZP,t,i,n);let{language:o}=s.ZP,a=JSON.stringify({k:t,o:i,f:n});!r.has(o)&&r.set(o,new Map);let c=r.get(o),u=c.get(a);if(u){let{value:e}=u;return e}let l=e.call(s.ZP,t,i,n);return c.set(a,{value:l}),l}}_bootstrap(e){let{locale:t,namespace:r,apiKey:i,injectI18nResource:a,maxRetryLoadCounts:c=5,lazyUpdate:u=!1,localeChangeHook:l}=e;this._locale=t;let d=t.getSupportLocales().map(e=>e.locale),_=t.getCurrentLocale();l&&(this._localeChangeHook=l);let h=()=>{!this._initAwaitLock.hasBeenDone&&this._initAwaitLock.initDone()},p=e=>{if(!e){let e=1;s.ZP.use((0,n.registerBackendPlugin)({loadOptions:{apiKey:null!=i?i:"38d171503ca311ee866b4ff6c924e0e2",namespace:null!=r?r:"WebClient",TEAChannelDomain:"",zoneHost:"https://starling-va.capcutapi.com",timeout:8e3,lazyUpdate:u},simpleLoad:!0,on:{done:()=>{h()},fallback:t=>{e>=c?h():(s.ZP.i18nInstance.instance.reloadResources(),e++)}},fallbackTexts:{}}))}s.ZP.use(o.p6).init({lng:_,supportedLngs:d,fallbackLng:["en"],thirdParamFallback:!0,saveMissing:!0,resources:e,missingKeyHandler:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]}},e?h:void 0)};this._overwriteI18nT();let{localesMap:g,__injectedI18nUrl:y}=window;a&&a.lng===_&&(!y||(null==y?void 0:y.includes(null==g?void 0:g[_])))?a.resources.then(e=>{e?p(e):p()}).catch(()=>{p()}):p()}constructor(e){super(),this._initAwaitLock=new d.G,this._onLocaleChange=this._store.add(new a.Q),this.onLocaleChange=this._onLocaleChange.event,this._bootstrap(e)}}},691805:function(e,t,r){r.d(t,{Q:function(){return n},U:function(){return o}});var i,s=r(335290);var n=((i={}).Ltr="LTR",i.Rtl="RTL",i);let o=(0,s.yh)("input-preference-service")},221643:function(e,t,r){r.d(t,{J:function(){return c}});var i=r(587892),s=r(995370),n=r(163003);let o=s.V5?"metaKey":"ctrlKey",a=["INPUT","TEXTAREA","SELECT"];class c{get cmdKeyHadDown(){return this._cmdKeyHadDown}get isKeybindingDisabled(){return this._isKeybindingDisabled}getOrCreateContext(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(this._contextMap.has(e))return this._contextMap.get(e);let i=new n.b(this,e,{useCapture:t,skipCondition:this._skipCondition,tagBlacklist:r?a:[]});return this._contextMap.set(e,i),i}removeContext(e){this._contextMap.has(e.targetNode)&&this._contextMap.delete(e.targetNode)}dispose(){document.removeEventListener("keydown",this._cmdKeyDownListener,!0),document.removeEventListener("keyup",this._cmdKeyDownListener,!0),window.removeEventListener("blur",this._resetCmdKeyDownState)}disableKeybinding(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blocklist";this._whitelistOrBlocklistKeys=e,this._keysMode=t,this._isKeybindingDisabled=!0}restoreKeybinding(){this._whitelistOrBlocklistKeys=void 0,this._keysMode=void 0,this._isKeybindingDisabled=!1}constructor(){this._serviceBrand=void 0,this._contextMap=new Map,this._whitelistOrBlocklistKeys=void 0,this._keysMode=void 0,this._isKeybindingDisabled=!1,this._cmdKeyHadDown=!1,this._cmdKeyDown=new i.Q,this.onCmdKeyDown=this._cmdKeyDown.event,this._cmdKeyDownListener=e=>{!!e[o]!==this._cmdKeyHadDown&&(this._cmdKeyHadDown=!this._cmdKeyHadDown,this._cmdKeyDown.fire(this._cmdKeyHadDown))},this._resetCmdKeyDownState=()=>{this._cmdKeyHadDown=!1,this._cmdKeyDown.fire(this._cmdKeyHadDown)},this._skipCondition=(e,t)=>{var r,i;let s=t+e;return this._isKeybindingDisabled&&("whitelist"===this._keysMode&&(null===(r=this._whitelistOrBlocklistKeys)||void 0===r?void 0:r.includes(s))||"blocklist"===this._keysMode&&!(null===(i=this._whitelistOrBlocklistKeys)||void 0===i?void 0:i.includes(s)))},document.addEventListener("keydown",this._cmdKeyDownListener,!0),document.addEventListener("keyup",this._cmdKeyDownListener,!0),window.addEventListener("blur",this._resetCmdKeyDownState)}}},597623:function(e,t,r){r.d(t,{DT:function(){return o},lT:function(){return a},zb:function(){return n}});var i,s=r(335290);var n=((i={}).Success="success",i.Info="info",i.Warning="warning",i.Error="error",i.Normal="normal",i.Loading="loading",i);let o=3,a=(0,s.yh)("notification")},825686:function(e,t,r){r.d(t,{K1:function(){return a},lp:function(){return u},pJ:function(){return c},sX:function(){return l}});var i,s,n,o=r(335290);var a=((i={}).UpgradeToPro="upgrade_to_pro",i.profileIconUpgrade="profile_icon_upgrade",i.sVipOnlinePromptPopup="svip_online_prompt_popup",i.spaceUpgrade="space_upgrade",i.spaceLimitUpgrade="space_limit_upgrade",i.removeWatermarkUpgrade="remove_watermark_upgrade",i.allowDownloadUpgrade="allow_download_upgrade",i.editUpgradeToUnlock="edit_upgrade_to_unlock",i.exportUpgradeToPro="export_upgrade_to_pro",i.enoughTimeUpgrade="enough_time_upgrade",i.notification="notification",i.benefitUseIntercept="vip_function_use",i);var c=((s={}).CLOSED="CLOSED",s.OPEN="OPEN",s);var u=((n={}).SUCCESS="SUCCESS",n.FAIL="FAIL",n.PROCESSING="PROCESSING",n);let l=(0,o.yh)("payin-payout-service")},87290:function(e,t,r){r.d(t,{P:function(){return p}});var i=r(789786),s=r(825686),n=r(905806),o=r(587892),a=r(402655),c=r(961087),u=r(782350),l=r(396190),d=r(290568),_=r(200247),h=r(596112);class p extends a.JT{_loadStorageExpandPackage(){return Promise.all([r.e("4493"),r.e("7616"),r.e("3838"),r.e("5642"),r.e("4354"),r.e("6237"),r.e("7089"),r.e("2515"),r.e("523"),r.e("6884"),r.e("5883"),r.e("5794"),r.e("7239"),r.e("7754"),r.e("5769"),r.e("1878"),r.e("8989"),r.e("799"),r.e("4355"),r.e("8754"),r.e("6870"),r.e("5340"),r.e("2232"),r.e("2221"),r.e("9147"),r.e("4249"),r.e("7308"),r.e("1381"),r.e("554"),r.e("6068"),r.e("9002"),r.e("241"),r.e("491"),r.e("8331"),r.e("3767"),r.e("6576"),r.e("1927"),r.e("3270"),r.e("1068"),r.e("5679"),r.e("8792"),r.e("8800"),r.e("725"),r.e("5028"),r.e("4585"),r.e("5868"),r.e("1218"),r.e("3654"),r.e("8180"),r.e("605"),r.e("9955"),r.e("4617"),r.e("6926"),r.e("4481")]).then(r.bind(r,690855))}async prefetch(){await this._loadStorageExpandPackage()}get modalShowStatus(){return this._modalShowStatus}async isSupportPay(e){let t=await this.getInstance(e),r=await (null==t?void 0:t.isSupportExpand());return null!=r&&r}async isRegionSupportPay(){let{LvStorageExpandModalSingleton:e}=await this._loadStorageExpandPackage();return e.isSupportExpandStatic()}isSpaceRoleSupportPay(e){let t=this._workspaceService.workspaceList.find(t=>t.workspace_id===e);return(null==t?void 0:t.role)==="owner"}_updateWebId(e){this._webId=e}async showSpaceNotEnoughModal(e){let{workspaceId:t,modalProps:r,reporterParams:i}=e;if(!this.canOpenInstanceModal)return;this._fireModalOpen();let s=await this.getInstance(t),{IStorageShowType:n,OPEN_PAGE_FROM:o}=await this._loadStorageExpandPackage();null==s||s.show({type:n.CAPACITY_INSUFFICIENT,modalProps:{okText:null==r?void 0:r.okText,cancelText:null==r?void 0:r.cancelText,title:null==r?void 0:r.title,content:null==r?void 0:r.content,onOk:()=>{this._onDidOk.fire()},onCancel:()=>{this._onDidCancel.fire()},onClose:()=>{this._onDidOk.dispose(),this._onDidCancel.dispose(),this._fireModalClose()}},reporterParams:{pageFrom:o.spaceLimitUpgrade,...i}})}async showPayModal(e){let{workspaceId:t,reporterParams:r,isUpgrade:i}=e;if(!this.canOpenInstanceModal)return;this._fireModalOpen();let s=await this.getInstance(t),{IStorageShowType:n}=await this._loadStorageExpandPackage();null==s||s.show({type:i?n.VIP_BUY:n.CAPACITY_BUY,reporterParams:r,onCurrentShowPayStatus:(e,t)=>{"success"===e?this._onDidPaySuccess.fire(t):"error"===e&&this._onDidPayFailed.fire(t)},modalProps:{onClose:()=>{this._fireModalClose()}}})}async showPayUploadFullSpaceModal(e){let{workspaceId:t,uploadFileList:r,reporterParams:i}=e;if(!this.canOpenInstanceModal)return;this._fireModalOpen();let s=await this.getInstance(t),n=await this.isSupportPay(t),{IStorageShowType:o,OPEN_PAGE_FROM:a}=await this._loadStorageExpandPackage();null==s||s.show({type:o.UPLOAD_FULL_SPACE_RESOLVE,isUpgradeEntryVisible:n,uploadFileList:r,reporterParams:{pageFrom:a.spaceLimitUpgrade,...i},modalProps:{onOk:()=>{this._onDidOk.fire()},onCancel:()=>{this._onDidCancel.fire(),this._onDidOk.dispose(),this._onDidCancel.dispose(),this._fireModalClose()}},onCurrentShowPayStatus:(e,t)=>{"success"===e?this._onDidPaySuccess.fire(t):"error"===e&&this._onDidPayFailed.fire(t)}})}async getInstance(e){await this._initAwaitLocker.awaitForInit();let t=this._getUserInfo(),r=this._getCloudInfo(e),i=this._getWorkspaceInfo(e),o=this._getDefaultWorkspaceInfo(),a=this._getWorkspaceList(),{LvStorageExpandModalSingleton:c}=await this._loadStorageExpandPackage();return c({userInfo:t,cloudInfo:r,workspaceInfo:i,workspaceList:a,defaultWorkspaceInfo:o,cookieConsent:n.gx,isBOE:!this._environmentService.isProd,riskInfo:{webid:this._webId},shouldStartFirstPartyAnalytics:!1,getABTestConfig:(e,t)=>this._teaAdapterService.getABTestVar(e,t),onModalStatusChange:e=>{e===s.pJ.OPEN?this._fireModalOpen():this._fireModalClose()},handleReporterProcessing:(e,t)=>{this._onDidReporterProcessing.fire(e,t)},onPayStatusChange:(e,t)=>{let r=this._userService.dangerUsedUserMachineService;if(this._onDidGlobalPayStatusChange.fire(e),e===s.lp.SUCCESS){var n;r.send({type:"UPDATE_WORKSPACE",workspaceId:(null==t?void 0:null===(n=t.productInfo)||void 0===n?void 0:n.isCloud)?null==i?void 0:i.workspace_id:null==o?void 0:o.workspace_id}),r.send({type:"UPDATE_VIP_INFO"}),r.send({type:"REFRESH_WORKSPACE_LIST"})}}})}_fireModalOpen(){if(this._modalShowStatus!==s.pJ.OPEN)this._modalShowStatus=s.pJ.OPEN,this._onDidOpen.fire()}_fireModalClose(){if(this._modalShowStatus!==s.pJ.CLOSED)this._modalShowStatus=s.pJ.CLOSED,this._onDidClose.fire()}get canOpenInstanceModal(){return this._modalShowStatus===s.pJ.CLOSED}async lockModal(e){let t=await this.getInstance(e);t.getConfig().canOpenModal&&t.updateConfig({canOpenModal:!1})}async freeModal(e){let t=await this.getInstance(e);!t.getConfig().canOpenModal&&t.updateConfig({canOpenModal:!0})}_getUserInfo(){let e=this._accountService.userProfile,{userVipInfo:t}=this._accountService;return{name:null==e?void 0:e.name,avatar:null==e?void 0:e.avatar,hasLogined:!0,uid:null==e?void 0:e.uid,region:null==e?void 0:e.region,email:null==e?void 0:e.email,idc:null==e?void 0:e.idc,reqDomain:null==e?void 0:e.reqDomain,createTime:null==e?void 0:e.create_time,vipInfo:t}}_getCloudInfo(e){var t;return null===(t=this._workspaceService.workspaceExpandInfoMap)||void 0===t?void 0:t[e]}_getWorkspaceInfo(e){var t;if(!this._accountService.hasLogin||!this._workspaceService.available)return{workspace_id:""};return null!==(t=this._workspaceService.getWorkspace(e))&&void 0!==t?t:{}}_getWorkspaceList(){var e;if(!this._accountService.hasLogin||!this._workspaceService.available)return[];return null!==(e=this._workspaceService.workspaceList)&&void 0!==e?e:[]}_getDefaultWorkspaceInfo(){var e,t,r;let i=null===(t=this._accountService.userProfile)||void 0===t?void 0:null===(e=t.personalSpaceInfo)||void 0===e?void 0:e.workspaceId;return this._accountService.hasLogin&&this._workspaceService.available?null!==(r=this._workspaceService.getWorkspace(i))&&void 0!==r?r:{}:{workspace_id:""}}constructor(e,t,r,i,n){super(),this._accountService=e,this._workspaceService=t,this._teaAdapterService=r,this._environmentService=i,this._userService=n,this._serviceBrand=void 0,this._webId="",this._onDidPaySuccess=this._register(new o.Q),this._onDidPayFailed=this._register(new o.Q),this._onDidGlobalPayStatusChange=this._register(new o.Q),this._onDidOpen=this._register(new o.Q),this._onDidReporterProcessing=this._register(new o.Q),this._onDidOk=this._register(new o.Q),this._onDidCancel=this._register(new o.Q),this._onDidClose=this._register(new o.Q),this._initAwaitLocker=new c.G,this._modalShowStatus=s.pJ.CLOSED,this.onDidOpen=this._onDidOpen.event,this.onDidReporterProcessing=this._onDidReporterProcessing.event,this.onDidPaySuccess=this._onDidPaySuccess.event,this.onDidPayFailed=this._onDidPayFailed.event,this.onDidOk=this._onDidOk.event,this.onDidCancel=this._onDidCancel.event,this.onDidClose=this._onDidClose.event,this.onDidGlobalPayStatusChange=this._onDidGlobalPayStatusChange.event,Promise.all([this._teaAdapterService.getWebId().then(e=>{this._updateWebId(e)})]).then(()=>{this._initAwaitLocker.initDone()})}}p=(0,i.gn)([(0,i.fM)(0,_.D),(0,i.fM)(1,u.W),(0,i.fM)(2,h.w),(0,i.fM)(3,l.Y),(0,i.fM)(4,d.S),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.D?Object:_.D,void 0===u.W?Object:u.W,void 0===h.w?Object:h.w,void 0===l.Y?Object:l.Y,void 0===d.S?Object:d.S])],p)},315529:function(e,t,r){r.d(t,{J:function(){return i}});let i=(0,r(335290).yh)("performance-monitor-service")},971420:function(e,t,r){r.d(t,{e:()=>g});var i=r("789786"),s=r("396190"),n=r("28791"),o=r("546723"),a=r("722169");function c(e){return!!(null==e?void 0:e.FrameInfo)}function u(e){return!!(null==e?void 0:e.LongTaskInfo)}function l(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.omit)(e,[...o.Tf,...t?[]:o.fs])}var d=r("230982"),_=r("375197"),h=r("587892"),p=r("402655");class g extends p.JT{get _hasEnableFeature(){return this._enableRecordFrameTime||this._enableRecordLongTask}_bootstrap(e){let{isDev:t}=this._environmentService,{enableRecordFrameTime:r=!1,enableRecordLongTask:i=!1,enableReport:s=!1,forceEnableAllFeature:n=!1}=e;this._hasForceEnableAllFeature=n,t||n?(this._enableRecordFrameTime=!0,this._enableRecordLongTask=!0,this._enableReport=!1):(this._enableRecordFrameTime=r,this._enableRecordLongTask=i,this._enableReport=s),this._enableRecordFrameTime&&this._recordFrameTime(),this._enableRecordLongTask&&new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this._longTaskEntries.push(e)})}).observe({type:"longtask",buffered:!0}),this._injectDebug()}_injectDebug(){window.__debugger&&(window.__debugger.performanceMonitorService=this)}_fireOnReportIfNeed(){if(!!this._enableReport&&0!==this._history.length)(0===this._reportTaskQueue.length||Date.now()>=6e4+this._lastReportTime)&&(this._onReport.fire({history:this.dumpHistory(),analyzeHistory:this.dumpAnalyzeHistory()}),this.clear(),this._lastReportTime=Date.now())}_handleIdle(){if(0===this._reportTaskQueue.length)return;let e=this._reportTaskQueue.shift();if(!!e)e(),this._fireOnReportIfNeed(),(0,d.n)(this._handleIdle.bind(this),{priorityLevel:_.q.IdlePriority})}_reportIfIdle(){(0,d.n)(this._handleIdle.bind(this),{priorityLevel:_.q.IdlePriority})}_recordFrameTime(){performance.mark("_recordFrameTime:start"),this._ticks.push(performance.now()),performance.mark("_recordFrameTime:end"),requestAnimationFrame(this._recordFrameTime.bind(this)),this._measureAndClearMarks("_recordFrameTime","_recordFrameTime:start","_recordFrameTime:end")}_measureAndClearMarks(e,t,r){performance.measure(e,t,r),performance.clearMarks(t),performance.clearMarks(r)}extract(e,t,r){performance.mark("extract:start");let i=this._ticks.findIndex(e=>e>=t),s=this._ticks.findLastIndex(e=>e<=r),n=this._ticks.slice(i,s-1).map((e,t,r)=>{var i;return(null!==(i=null==r?void 0:r[t+1])&&void 0!==i?i:0)-e}).filter(e=>e>=0),o=this._longTaskEntries.filter(e=>e.startTime>=t&&e.startTime<=r),a={Named:!0,Meta:!0,name:e,duration:r-t};return this._enableRecordFrameTime&&0!==n.length&&Object.assign(a,{FrameInfo:!0,frameTimes:n,AFT:n.reduce((e,t)=>e+t,0)/n.length,MFT:Math.max(...n),FPS:Math.round(1e3/((r-t)/n.length))}),this._enableRecordLongTask&&0!==o.length&&Object.assign(a,{LongTaskInfo:!0,longTaskCount:o.length,averageLongTaskDuration:o.map(e=>e.duration).reduce((e,t)=>e+t,0)/o.length,maximumLongTaskDuration:Math.max(...o.map(e=>e.duration),0),longTasks:o}),performance.mark("extract:end"),this._measureAndClearMarks("extract","extract:start","extract:end"),a}merge(e,t){let r={Named:!0,name:e.name,Meta:!0,duration:e.duration+t.duration};if(c(e)&&c(t)){let i=e.frameTimes.concat(t.frameTimes),s=(e.AFT*e.duration+t.AFT*t.duration)/(e.duration+t.duration),n=Math.max(e.MFT,t.MFT);Object.assign(r,{FrameInfo:!0,frameTimes:i,AFT:s,MFT:n,FPS:(e.FPS*e.duration+t.FPS*t.duration)/(e.duration+t.duration)})}else c(e)?Object.assign(r,{FrameInfo:!0,frameTimes:e.frameTimes,AFT:e.AFT,MFT:e.MFT,FPS:e.FPS}):c(t)&&Object.assign(r,{FrameInfo:!0,frameTimes:t.frameTimes,AFT:t.AFT,MFT:t.MFT,FPS:t.FPS});if(u(e)&&u(t)){let i=e.longTaskCount+t.longTaskCount,s=(e.averageLongTaskDuration*e.duration+t.averageLongTaskDuration*t.duration)/(e.duration+t.duration),n=Math.max(e.maximumLongTaskDuration,t.maximumLongTaskDuration);Object.assign(r,{LongTaskInfo:!0,longTaskCount:i,averageLongTaskDuration:s,maximumLongTaskDuration:n,longTasks:e.longTasks.concat(t.longTasks)})}else u(e)?Object.assign(r,{LongTaskInfo:!0,longTaskCount:e.longTaskCount,averageLongTaskDuration:e.averageLongTaskDuration,maximumLongTaskDuration:e.maximumLongTaskDuration,longTasks:e.longTasks}):u(t)&&Object.assign(r,{LongTaskInfo:!0,longTaskCount:t.longTaskCount,averageLongTaskDuration:t.averageLongTaskDuration,maximumLongTaskDuration:t.maximumLongTaskDuration,longTasks:t.longTasks});return r}record(e){if(!!this._hasEnableFeature)!this._recordStarTimingMap[e]&&(performance.mark(`[${e}]-record:start`),Object.assign(this._recordStarTimingMap,{[e]:performance.now()}))}stop(e){var t;if(!this._hasEnableFeature||!this._recordStarTimingMap[e])return;performance.mark(`[${e}]-record:end`),this._measureAndClearMarks(`[${e}]-measure`,`[${e}]-record:start`,`[${e}]-record:end`);let r=null===(t=this._recordStarTimingMap)||void 0===t?void 0:t[e],i=performance.now();this._reportTaskQueue.push(()=>{var t;if(!r)return;let s=this.extract(e,r,i);this._logger.info(`${r}-${i}`,s),this._history.push(s),null===(t=this._recordStarTimingMap)||void 0===t||delete t[e]}),this._reportIfIdle()}dumpHistory(){return this._history}dumpAnalyzeHistory(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(0===this._history.length)return;let t={};this._history.forEach(e=>{let r=null==t?void 0:t[e.name];if(!r){Object.assign(t,{[e.name]:e});return}Object.assign(t,{[e.name]:this.merge(r,e)})});let r={};for(let i in t){if(!Object.hasOwn(t,i))continue;let s=t[i];if(c(s)){r[i]=l(function(e){let t=e.frameTimes.sort((e,t)=>e-t),r=Math.floor(t.length*(1/4)),i=Math.floor(.5*t.length),s=Math.floor(t.length*(3/4)),n=Math.floor(.9*t.length);return{...e,PCT25_FT:t[r],PCT50_FT:t[i],PCT75_FT:t[s],PCT90_FT:t[n],Analysis:!0}}(s),e);continue}r[i]=l(s,e)}return r}enableReport(){this._enableReport=!0}forceEnableAllFeature(){if(!this._hasForceEnableAllFeature)this._bootstrap({forceEnableAllFeature:!0})}clear(){this._history.splice(0,this._history.length),this._ticks.splice(0,this._ticks.length),this._longTaskEntries.splice(0,this._longTaskEntries.length)}get onReport(){return this._onReport.event}constructor(e={},t,r){super(),this._options=e,this._environmentService=t,this._loggerService=r,this._onReport=new h.Q,this._history=[],this._reportTaskQueue=[],this._recordStarTimingMap={},this._ticks=[],this._longTaskEntries=[],this._lastReportTime=-1,this._enableRecordFrameTime=!1,this._enableRecordLongTask=!1,this._enableReport=!1,this._hasForceEnableAllFeature=!1,this._logger=this._loggerService.createLogger(o.Yd.id,{logPrefix:o.Yd.prefix}),this._bootstrap(this._options)}}g=(0,i.gn)([(0,i.fM)(1,s.Y),(0,i.fM)(2,n.yR),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof Partial?Object:Partial,void 0===s.Y?Object:s.Y,void 0===n.yR?Object:n.yR])],g)},461571:function(e,t,r){r.d(t,{O:function(){return s}});var i,s=((i={})[i.readonly=1]="readonly",i[i.editable=2]="editable",i[i.owner=3]="owner",i)},613069:function(e,t,r){r.d(t,{H:function(){return i}});let i=(0,r(335290).yh)("permission-service")},610142:function(e,t,r){r.d(t,{L:function(){return i}});let i=(0,r(335290).yh)("sidebar-dnd-service")},651725:function(e,t,r){r.d(t,{e:function(){return i}});function i(e){let{container:t,transformOrigin:r,scaleFactor:i}=e,s=t.x-r.x,n=t.y-r.y,o=r.x+s*i.x;return{x:o,y:r.y+n*i.y}}},566669:function(e,t,r){r.d(t,{E_:function(){return d},Ec:function(){return c},HA:function(){return a},NB:function(){return l},SW:function(){return n},Y_:function(){return p},b5:function(){return s},j9:function(){return g},ks:function(){return h},nr:function(){return o},rM:function(){return u},vI:function(){return _}});var i=r(475028);let s=(0,i.i)(11e4,"key value storage fail."),n=(0,i.i)(110001,"set key value storage fail.");(0,i.i)(110002,"set key value storage oversize.");let o=(0,i.i)(110003,"delete key value storage fail."),a=(0,i.i)(110004,"query key value storage fail."),c=(0,i.i)(110005,"clear key value storage fail.");(0,i.i)(110003,"delete key value storage not found."),(0,i.i)(111001,"database not found."),(0,i.i)(111002,"table not found.");let u=(0,i.i)(111003,"connect db fail.");(0,i.i)(111004,"db quota exceeded.");let l=(0,i.i)(111005,"set database fail."),d=(0,i.i)(111006,"delete database fail."),_=(0,i.i)(111007,"query database fail."),h=(0,i.i)(111008,"clear database fail."),p=(0,i.i)(111009,"cleanup database fail."),g=(0,i.i)(111010,"invoke transaction fail.")},556075:function(e,t,r){r.d(t,{v:function(){return s}});class i{async next(){return(this._continue(),this._currentCursor=await this._waiting,this._currentCursor)?{value:this._currentCursor,done:!1}:{value:this._currentCursor,done:!0}}[Symbol.asyncIterator](){return this}_updateWaiting(){this._waiting=new Promise(e=>{this._resolve=e})}_continue(){var e;this._updateWaiting(),null===(e=this._currentCursor)||void 0===e||e.continue()}constructor(e){this._request=e,this._currentCursor=null,this._request.onsuccess=()=>{this._resolve(this._request.result)},this._request.onerror=()=>{this._resolve(null)}}}function s(e,t,r){return new i(e.openCursor(t,r))}},652725:function(e,t,r){r.d(t,{T:function(){return s},r:function(){return n}});var i=r(763832);function s(e,t,r){let s=r.value,n=async function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];let o=await e.reopenDatabase.apply(t);return o.ok?s.apply(t,i):o};return r.value=async function(){for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];let a=await s.apply(this,r);if(a.ok||!a.cause)return a;switch(a.cause.name){case"QuotaExceededError":{e.readyCleanup.apply(this),await (0,i.D)(500);let t=await n(this,...r);if(!t.ok)return a;return t}case"InvalidStateError":{let e=await n(this,...r);if(!e.ok)return a;return e}default:return a}},r}function n(e,t,r){let s=r.value;return r.value=async function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];let o=await s.apply(this,r);if(o.ok||!o.cause)return o;if("QuotaExceededError"===o.cause.name){e.readyCleanup.apply(this),await (0,i.D)(500);let t=await s.apply(this,r);return t.ok?t:o}return o},r}},887383:function(e,t,r){r.d(t,{m:function(){return s}});var i=r(556075);class s{has(e){return new Promise((t,r)=>{let i=this._transaction.objectStore(this._storeName).openCursor(e);i.onerror=()=>{r(i.error)},i.onsuccess=()=>{t(!!i.result)}})}async set(e,t){let r=await this.query(e);return r?t.createTime=r.createTime:t.createTime=Date.now(),t.updateTime=Date.now(),new Promise((e,r)=>{let i=this._transaction.objectStore(this._storeName).put(t);i.onerror=()=>{r(i.error)},i.onsuccess=()=>{e()}})}setMany(e){let t=[];for(let r of e)t.push(this.set(r.key,r.value));return new Promise((e,r)=>{Promise.all(t).then(()=>{e()}).catch(e=>{r(e)})})}delete(e){return new Promise((t,r)=>{let i=this._transaction.objectStore(this._storeName).delete(e);i.onerror=()=>{r(i.error)},i.onsuccess=()=>{t()}})}deleteMany(e){let t=[];for(let r of e)t.push(this.delete(r));return new Promise((e,r)=>{Promise.all(t).then(()=>{e()}).catch(e=>{r(e)})})}deleteByIndex(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:IDBKeyRange.only(t);return new Promise(async(t,s)=>{let n=this._transaction.objectStore(this._storeName).index(e);for await(let e of(0,i.v)(n,r)){if(!e)break;e.delete()}t()})}query(e){return new Promise((t,r)=>{let i=this._transaction.objectStore(this._storeName).get(e);i.onerror=()=>{r(i.error)},i.onsuccess=()=>{t(this._handleResult(i.result))}})}queryMany(e){let t=new Map,r=[];for(let i of e)r.push(this.query(i).then(e=>(e&&t.set(i,e),e)));return new Promise((e,i)=>{Promise.all(r).then(()=>{e(t)}).catch(e=>{i(e)})})}queryByIndex(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:IDBKeyRange.only(t);return new Promise(async(t,s)=>{let n=this._transaction.objectStore(this._storeName).index(e),o=[];for await(let e of(0,i.v)(n,r)){if(!e)break;o.push(e.value)}t(o)})}queryByRange(e,t){return new Promise(async(r,s)=>{let n=this._transaction.objectStore(this._storeName).index(e),o=[];for await(let e of(0,i.v)(n,t)){if(!e)break;o.push(e.value)}r(o)})}queryByConditions(e){return new Promise(async(t,r)=>{let s=this._transaction.objectStore(this._storeName),n=[];for await(let t of(0,i.v)(s,null)){if(!t)break;e(t.value)&&n.push(t.value)}t(n)})}clear(){return new Promise((e,t)=>{let r=this._transaction.objectStore(this._storeName).clear();r.onerror=()=>{t(r.error)},r.onsuccess=()=>{e()}})}_handleResult(e){if(!e)return;if(void 0===e.maxAge)return e;if(!(e.updateTime+e.maxAge<Date.now()))return e}constructor(e,t){this._transaction=e,this._storeName=t}}},709037:function(e,t,r){r.d(t,{z:()=>k});var i=r("789786"),s=r("55449"),n=r("690613"),o=r("800788");class a{get store(){return this._store}constructor(e){for(let t of(this._store=new Map,e)){(0,o.Y2)(!this._store.has(t.id));let e=new Map;for(let r of t.tables)(0,o.Y2)(!e.has(r.name)),e.set(r.name,r);this._store.set(t.id,{version:t.version,tables:e})}}}var c=r("566669"),u=r("668380"),l=r("230982"),d=r("768362"),_=r("434316"),h=r("31463"),p=r("556075"),g=r("453991");class y{mark(){if(!this._mark)this._mark=!0,(0,l.n)(()=>{this.cleanup((0,_.fC)())})}cleanup(e){return(this._mark=!1,1===this._status)?Promise.resolve((0,n.ly)()):(this._status=1,this._cleanup(e))}_calcType(){return(this._times=this._times%3,3==this._times++)?1:0}async _cleanup(e){let t;t=0===this._calcType()?.5:1,this._reportService.reportDevEvent("idb-cleanup",{percent:t});try{return await this._cleanupDatabases(t),this._reportService.reportDevEvent("idb-cleanup-success",{percent:t}),(0,n.ly)()}catch(e){return this._reportService.reportDevError("idb-cleanup-error",e,{percent:t.toString()}),(0,c.Y_)(e)}finally{this._status=0}}_getCount(e){return new Promise((t,r)=>{let i=e.count();i.onsuccess=()=>{t(i.result)},i.onerror=e=>{r(e)}})}_cleanupTable(e,t,r){return new Promise(async(i,s)=>{let n=e.transaction(t,"readwrite"),o=n.objectStore(t);if(!o.indexNames.contains("updateTime")){i();return}n.onabort=()=>{s(n.error)},n.onerror=()=>{s(n.error)},n.oncomplete=()=>{i()};let a=o.index("updateTime"),c=IDBKeyRange.lowerBound(0),u=Math.floor(await this._getCount(a)*r),l=0;for await(let e of(0,p.v)(a,c,"next"))if(e&&l<u)e.delete(),l++;else break})}async _cleanupDatabases(e){for(let t of this._schemas.keys()){let r=await this._databasePool.getDatabase(t);for(let t of r.objectStoreNames)await this._cleanupTable(r,t,e)}}constructor(e,t,r){this._schemas=e,this._databasePool=t,this._reportService=r,this._status=0,this._times=0,this._mark=!1}}(0,i.gn)([(0,d.lI)("storage","cleanup"),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_._y?Object:_._y]),(0,i.w6)("design:returntype","undefined"==typeof Promise?Object:Promise)],y.prototype,"cleanup",null),y=(0,i.gn)([(0,i.fM)(2,h.m),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof Map?Object:Map,void 0===g.T?Object:g.T,void 0===h.m?Object:h.m])],y);var f=r("544674"),v=r("652725");class m extends a{connect(e,t){return this._store.has(e)?this._connect(e,t):Promise.resolve((0,c.rM)("db not found."))}invokeTransaction(e,t,r,i,s){return new Promise(async o=>{try{let a=(await this._databasePool.getDatabase(e)).transaction(t,i,s),u=new f.Y(a,t);u.onError(e=>{o((0,c.j9)(e))}),u.onComplete(e=>{o((0,n.oW)(e))}),r(u),u.commit()}catch(e){o((0,c.j9)(e))}})}readyCleanup(){this._cleanupMgr.mark()}_connect(e,t){return new Promise(async r=>{try{let i=await this._databasePool.getDatabase(e),s=new u.T(i,t,this._databasePool,this._cleanupMgr);r((0,n.oW)(s))}catch(e){r((0,c.rM)(e))}})}constructor(e,t){super(e),this._instantiation=t,this._databasePool=new g.T(this._store),this._cleanupMgr=this._instantiation.createInstance(y,this._store,this._databasePool)}}(0,i.gn)([v.r,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,Array,Function,"undefined"==typeof IDBTransactionMode?Object:IDBTransactionMode,"undefined"==typeof IDBTransactionOptions?Object:IDBTransactionOptions]),(0,i.w6)("design:returntype","undefined"==typeof Promise?Object:Promise)],m.prototype,"invokeTransaction",null),m=(0,i.gn)([(0,i.fM)(1,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array,void 0===s.T?Object:s.T])],m);var w=r("232109");class k{constructor(e,t){this.keyValue=new w.T,this.database=t.createInstance(m,e)}}k=(0,i.gn)([(0,i.fM)(1,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array,void 0===s.T?Object:s.T])],k)},246457:function(e,t,r){r.d(t,{d:function(){return n}});var i=r(335290),s=r(332557);let n=(0,i.LO)(s.U)},343828:function(e,t,r){r.d(t,{f:function(){return _},h:function(){return l}});var i,s=r(789786),n=r(587892),o=r(402655),a=r(800788),c=r(246457),u=r(786377);var l=((i={}).Dark="dark",i.Light="light",i);let d="CAPCUT_THEME";class _ extends o.JT{getTheme(){let e;let t=this.storageService.keyValue.query(d);return t.ok&&t.value?((0,a.ZB)(t.value),e=t.value):(e="light",this.storageService.keyValue.set(d,e)),e}setTheme(e){u.Z.set(d,e),this.storageService.keyValue.set(d,e),this._onDidThemeChange.fire(e)}constructor(e){super(),this.storageService=e,this._onDidThemeChange=this._register(new n.Q),this.onDidThemeChange=this._onDidThemeChange.event}}_=(0,s.gn)([(0,s.fM)(0,c.d),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[void 0===c.d?Object:c.d])],_)},361401:function(e,t,r){r.d(t,{X:function(){return n}});var i=r(999268),s=r(402655);class n extends s.JT{async _flushToken(){if(!!(Date.now()-this._lastFlushTokenTime>this._tokenMaxAge)){if(!this._flushMutex.tryLock()){await this._flushMutex.lockShared(),this._flushMutex.unLockShared();return}try{let e=await this._getToken();if(!e.ok){this._token=void 0;return}this._token=e.value,this._lastFlushTokenTime=Date.now()}finally{this._flushMutex.unLock()}}}constructor(...e){super(...e),this._flushMutex=new i.L,this._lastFlushTokenTime=0,this._tokenMaxAge=12e5}}},105581:function(e,t,r){r.d(t,{A:()=>w});var i=r("789786"),s=r("690613"),n=r("800788");function o(e){return new Promise(t=>{e.onComplete(e=>{t((0,s.oW)(e))}),e.onError(e=>{t(e)})})}var a=r("361401"),c=r("999268"),u=r("921881"),l=r("570334"),d=r("587892"),_=r("402655"),h=r("914069");class p extends _.JT{cancel(){this._sdk.cancel(this._key)}constructor(e,t){super(),this._sdk=e,this._key=t,this._onCompleted=new d.Q,this._onError=new d.Q,this._onProgress=new d.Q,this.onComplete=this._onCompleted.event,this.onError=this._onError.event,this.onProgress=this._onProgress.event,this._sdk.on("complete",e=>{var t,r,i,s,n;if(e.key!==this._key)return;let{uploadResult:o}=e;this._onCompleted.fire({uri:null!==(t=o.Uri)&&void 0!==t?t:"",width:null!==(r=o.ImageWidth)&&void 0!==r?r:0,height:null!==(i=o.ImageHeight)&&void 0!==i?i:0,md5:null!==(s=o.ImageMd5)&&void 0!==s?s:"",fileName:null!==(n=o.FileName)&&void 0!==n?n:""})}),this._sdk.on("error",e=>{var t;if(e.key===this._key)this._onError.fire((0,s.wf)(null!==(t=e.extra.errorCode)&&void 0!==t?t:-1,e.extra.message))}),this._sdk.on("progress",e=>{if(e.key===this._key)this._onProgress.fire(e.percent)})}}class g{setUserId(e){var t;this._config.userId=e,null===(t=this._sdk)||void 0===t||t.setOption({userId:e})}async uploadFile(e,t){if((0,n.Y2)(e.serviceId,"use imagex must set `serviceId` in uploader."),await this._ensureSdk(e),!this._sdk)return(0,s.wf)(-1,"sdk undefined.");let r=(0,l.N)(this._sdk,{file:t,stsToken:this._convertToken(e)});return(0,s.oW)(r)}async uploadImage(e,t){if((0,n.Y2)(e.serviceId,"use imagex must set `serviceId` in uploader."),await this._ensureSdk(e),!this._sdk)return(0,s.wf)(-1,"sdk undefined.");let r=function(e,t){let r=e.addFile({file:t.file,stsToken:t.stsToken,type:h.A.Image});return e.start(r),new p(e,r)}(this._sdk,{file:t,stsToken:this._convertToken(e)});return(0,s.oW)(r)}async _ensureSdk(e){if(!this._sdk){if(!this._mutex.tryLock()){await this._mutex.lockShared(),this._mutex.unLockShared();return}try{let t;t=(await r.e("1586").then(r.t.bind(r,249220,23))).default,this._sdk=new t({userId:this._config.userId,appId:this._config.appId,region:e.region,stsToken:this._convertToken(e),imageConfig:{serviceId:e.serviceId,processAction:this._config.actions},objectConfig:{serviceId:e.serviceId,processAction:this._config.actions},...(0,u.X)(e.region),getSliceFunc:this._config.getSliceFunc})}finally{this._mutex.unLock()}}}_convertToken(e){return{AccessKeyId:e.accessKeyId,SecretAccessKey:e.secretAccessKey,SessionToken:e.sessionToken,ExpiredTime:e.expiredTime,CurrentTime:e.currentTime}}constructor(e){this._config=e,this._mutex=new c.L}}var y=r("523327"),f=r("836038"),v=r("531334"),m=r("230689");class w extends a.X{async uploadImage(e){let{file:t}=e,r=await this._uploadImageAndGetTask(t);return r.ok?o(r.value):r}async uploadImageAndGetTask(e){let{file:t}=e,r=await this._uploadImageAndGetTask(t);return r.ok?r.value:new f.y(r)}async uploadFile(e){let{file:t}=e,r=await this._uploadFileAndGetTask(t);return r.ok?o(r.value):r}async uploadFileAndGetTask(e){let{file:t}=e,r=await this._uploadFileAndGetTask(t);return r.ok?r.value:new f.y(r)}_getToken(){return this._spaceConfig.getImageXToken()}_getSdkDriver(){return this._sdkDriver?this._sdkDriver:(this._sdkDriver=new g({appId:this._appId,userId:this._userIdProvider.userId,getSliceFunc:this._uploadSettings.sliceSize,actions:this._uploadSettings.actions}),this._sdkDriver)}async _uploadImageAndGetTask(e){return((0,n.Y2)(this._spaceConfig.permissionSlots&1<<y.pd.Image,"this imagex space no support upload image."),await super._flushToken(),this._token)?this._getSdkDriver().uploadImage(this._token,e):(0,s.wf)(-1,"stsToken undefined.")}async _uploadFileAndGetTask(e){return((0,n.Y2)(this._spaceConfig.permissionSlots&1<<y.pd.File,"this imagex space no support upload file."),await super._flushToken(),this._token)?this._getSdkDriver().uploadFile(this._token,e):(0,s.wf)(-1,"stsToken undefined.")}constructor(e,t,r,i){super(),this._appId=e,this._spaceConfig=t,this._uploadSettings=r,this._containerService=i,void 0!==this._uploadSettings.userId?this._userIdProvider=new v.k(this._uploadSettings.userId):this._userIdProvider=this._containerService.createInstance(v.w),this._userIdProvider.onUserIdChange(()=>{if(!!this._sdkDriver)this._sdkDriver.setUserId(this._userIdProvider.userId)})}}w=(0,i.gn)([(0,i.fM)(3,m.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Number,"undefined"==typeof IImageXUploaderConfigProxy?Object:IImageXUploaderConfigProxy,"undefined"==typeof IImageXSettings?Object:IImageXSettings,void 0===m.t?Object:m.t])],w)},836038:function(e,t,r){r.d(t,{y:function(){return n}});var i=r(587892),s=r(63434);class n{cancel(){this._cancelled=!0}get onComplete(){return!this._neverEmitter&&(this._neverEmitter=new i.Q),this._neverEmitter.event}get onProgress(){return!this._neverEmitter&&(this._neverEmitter=new i.Q),this._neverEmitter.event}get onError(){return this._cancelled?(!this._neverEmitter&&(this._neverEmitter=new i.Q),this._neverEmitter.event):(0,s.V)(this._err)}constructor(e){this._err=e,this._cancelled=!1}}},531334:function(e,t,r){r.d(t,{k:function(){return u},w:function(){return c}});var i=r(789786),s=r(587892),n=r(641276),o=r(80286),a=r(200247);class c{get userId(){return this._accountService.hasLogin?this._accountService.userProfile.uid:"unknown"}constructor(e){this._accountService=e,this._onUserIdChange=new s.Q,this.onUserIdChange=this._onUserIdChange.event,!this._accountService.hasLogin&&(0,n.V)(this._accountService.onDidLogin)(()=>{this._onUserIdChange.fire(this._accountService.userProfile.uid)})}}c=(0,i.gn)([(0,i.fM)(0,a.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.D?Object:a.D])],c);class u{get userId(){return this._userId}get onUserIdChange(){return o.I}constructor(e){this._userId=e}}},544347:function(e,t,r){r.d(t,{PX:function(){return n},rA:function(){return s}});var i,s=((i={})[i.Video=0]="Video",i[i.File=1]="File",i);function n(){return[0,1].map(e=>1<<e).reduce((e,t)=>e+t)}},442056:function(e,t,r){r.d(t,{N:function(){return c}});var i=r(587892),s=r(402655),n=r(690613),o=r(914069);class a extends s.JT{cancel(){this._sdk.cancel(this._key)}constructor(e,t){super(),this._sdk=e,this._key=t,this._onCompleted=new i.Q,this._onError=new i.Q,this._onProgress=new i.Q,this.onComplete=this._onCompleted.event,this.onError=this._onError.event,this.onProgress=this._onProgress.event,this._sdk.on("complete",e=>{var t,r;if(e.key!==this._key)return;let{uploadResult:i}=e;this._onCompleted.fire({uri:null!==(r=i.Uri)&&void 0!==r?r:"",md5:null===(t=i.ObjectMeta)||void 0===t?void 0:t.Md5})}),this._sdk.on("error",e=>{var t;if(e.key===this._key)this._onError.fire((0,n.wf)(null!==(t=e.extra.errorCode)&&void 0!==t?t:-1,e.extra.message))}),this._sdk.on("progress",e=>{if(e.key===this._key)this._onProgress.fire(e.percent)})}}function c(e,t){let r=e.addFile({file:t.file,stsToken:t.stsToken,type:o.A.Object});return e.start(r),new a(e,r)}},669742:function(e,t,r){r.d(t,{i:function(){return s}});var i=r(690613);function s(e){return new Promise(t=>{e.onComplete(e=>{t((0,i.oW)(e))}),e.onError(e=>{t(e)})})}},269331:function(e,t,r){r.d(t,{L:function(){return s}});var i=r(999268);class s{async getFrame(e){var t;await this._sharedMutex.lock(),e=Math.min(e=Math.max(e,0),1e3*this._video.duration),this._video.currentTime=e/1e3,await (t=this._video,new Promise(e=>{t.addEventListener("seeked",e,{once:!0})})),this._ctx.drawImage(this._video,0,0,this._video.videoWidth,this._video.videoHeight,0,0,this._canvas.width,this._canvas.height);try{return{timestamp:e,data:await this._formatFunction(this._canvas,this._ctx)}}finally{this._sharedMutex.unLock()}}constructor(e,t,r,s){this._video=e,this._canvas=t,this._ctx=r,this._formatFunction=s,this._sharedMutex=new i.L}}},358046:function(e,t,r){r.d(t,{X:function(){return o}});var i=r(230982),s=r(375197),n=r(269331);class o extends n.L{async getFrame(e){return await new Promise(t=>{(0,i.n)(async()=>{t(await super.getFrame(e))},{priorityLevel:s.q.IdlePriority})})}}},229502:function(e,t,r){r.d(t,{J:function(){return i}});class i{async next(){if(0===this._times.length)return{value:null,done:!0};let e=this._times.shift();if(this._cache&&this._cache.timestamp===e)return{value:this._cache,done:!1};let t=await this._builder.getFrame(e);return this._cache=t,{value:t,done:!1}}[Symbol.asyncIterator](){return this}constructor(e,t){this._builder=e,this._times=t}}},666466:function(e,t,r){r.d(t,{w:function(){return o}});var i=r(827322),s=r(402655),n=r(609591);class o extends s.JT{get video(){return this._element}get root(){return this._element.parentElement}get duration(){return this._element.duration}get paused(){return this._element.paused}get isFullscreen(){return!!(document.fullscreenElement&&document.fullscreenElement===this._fullscreenElem)}get mediaUrl(){return this._element.currentSrc}get currentTime(){return this._element.currentTime}set currentTime(e){this._element.currentTime=e}get volume(){return this._element.volume}set volume(e){this._element.volume=e}get muted(){return this._element.muted}set muted(e){this._element.muted=e}get loop(){return this._element.loop}set loop(e){this._element.loop=e}get autoplay(){return this._element.autoplay}set autoplay(e){this._element.autoplay=e}setConfig(e){e.url&&this._element.src!==e.url&&(this._element.src=(0,i.C)(e.url,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})),void 0!==e.volume&&(this._element.volume=e.volume),void 0!==e.loop&&(this._element.loop=e.loop),void 0!==e.muted&&(this._element.muted=e.muted),void 0!==e.autoplay&&(this._element.autoplay=e.autoplay),e.autoplayMuted&&(this._element.muted=e.autoplayMuted,this._element.autoplay=e.autoplayMuted),void 0!==e.crossOrigin&&(this._element.crossOrigin=e.crossOrigin),void 0!==e.width&&(this._element.style.width=String(e.width)),void 0!==e.height&&(this._element.style.height=String(e.height))}play(){return this._element.play()}replay(){this._element.currentTime=0,this.play()}pause(){this._element.pause()}seek(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.j.Auto;this._element.currentTime=e,t===n.j.Pause?this._element.pause():this._element.play()}load(){this._element.load()}setMediaUrl(e){this._element.src=(0,i.C)(e,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})}changeDefinition(e,t){return this._element.src=(0,i.C)(e.url,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),new Promise(e=>{this.play().then(e)})}getFullscreen(e){return e?this._fullscreenElem=e:this._fullscreenElem=this._element,this._fullscreenElem.requestFullscreen()}exitFullscreen(){return document.fullscreenElement&&document.fullscreenElement===this._fullscreenElem?(this._fullscreenElem=void 0,document.exitFullscreen()):Promise.resolve()}getBufferedRange(){let e=[],{buffered:t}=this._element;for(let r=0;r<t.length;r++)e.push(t.start(r),t.end(r));return e}dispose(){this._element.pause(),this._element.remove(),super.dispose()}constructor(e){super(),this._element=e}}},609591:function(e,t,r){r.d(t,{i:function(){return o},j:function(){return n}});var i,s=r(335290);var n=((i={}).Auto="auto",i.Play="play",i.Pause="pause",i);let o=(0,s.yh)("video-player-service")},396570:function(e,t,r){r.d(t,{v:function(){return n}});var i=r(445788),s=r(882760);class n{createRawVideoPlayer(e,t){return this._getRawVideoFactory().createVideoPlayer(e,t)}createXgVideoPlayer(e,t){return this._getXgVideoFactory().createXgVideoPlayer(e,t)}createXgPresetVideoPlayer(e,t){return this._getXgVideoFactory().createXgPresetVideoPlayer(e,t)}_getRawVideoFactory(){return!this._rawVideoFactory&&(this._rawVideoFactory=new i.U),this._rawVideoFactory}_getXgVideoFactory(){return!this._xgVideoFactory&&(this._xgVideoFactory=new s.v),this._xgVideoFactory}}},248952:function(e,t,r){r.d(t,{w:function(){return a}});var i=r(587892),s=r(690613),n=r(309817),o=r(528573);class a extends o.J{get onPlay(){return!this._onPlay&&(this._onPlay=this._register(new i.Q),this._playerSdk.on(n.PLAY,()=>{this._onPlay.fire()})),this._onPlay.event}get onPlayStart(){return!this._onPlayStart&&(this._onPlayStart=this._register(new i.Q),this._playerSdk.on(n.AUTOPLAY_STARTED,()=>{this._onPlayStart.fire()})),this._onPlayStart.event}get onPause(){return!this._onPause&&(this._onPause=this._register(new i.Q),this._playerSdk.on(n.PAUSE,()=>{this._onPause.fire()})),this._onPause.event}get onSeeking(){return!this._onSeeking&&(this._onSeeking=this._register(new i.Q),this._playerSdk.on(n.SEEKING,()=>{this._onSeeking.fire()})),this._onSeeking.event}get onSeeked(){return!this._onSeeked&&(this._onSeeked=this._register(new i.Q),this._playerSdk.on(n.SEEKED,()=>{this._onSeeked.fire(this._playerSdk.currentTime)})),this._onSeeked.event}get onTimeUpdate(){return!this._onTimeUpdate&&(this._onTimeUpdate=this._register(new i.Q),this._playerSdk.on(n.TIME_UPDATE,()=>{this._onTimeUpdate.fire(this._playerSdk.currentTime)})),this._onTimeUpdate.event}get onEnded(){return!this._onEnded&&(this._onEnded=this._register(new i.Q),this._playerSdk.on(n.ENDED,()=>{this._onEnded.fire()})),this._onEnded.event}get onLoadStart(){return!this._onLoadStart&&(this._onLoadStart=this._register(new i.Q),this._playerSdk.on(n.LOAD_START,()=>{this._onLoadStart.fire()})),this._onLoadStart.event}get onLoaded(){return!this._onLoaded&&(this._onLoaded=this._register(new i.Q),this._playerSdk.on(n.LOADED_DATA,()=>{this._onLoaded.fire()})),this._onLoaded.event}get onLoadedMetadata(){return!this._onLoadedMetadata&&(this._onLoadedMetadata=this._register(new i.Q),this._playerSdk.on(n.LOADED_METADATA,()=>{this._onLoadedMetadata.fire()})),this._onLoadedMetadata.event}get onError(){return!this._onError&&(this._onError=this._register(new i.Q),this._playerSdk.on(n.ERROR,()=>{var e,t;let{error:r}=this._playerSdk.media;this._onError.fire((0,s.wf)(null!==(e=null==r?void 0:r.code)&&void 0!==e?e:-1,null!==(t=null==r?void 0:r.message)&&void 0!==t?t:"unknown error."))})),this._onError.event}get onDurationChange(){return!this._onDurationChange&&(this._onDurationChange=this._register(new i.Q),this._playerSdk.on(n.DURATION_CHANGE,()=>{this._onDurationChange.fire(this._playerSdk.duration)})),this._onDurationChange.event}get onWaiting(){return!this._onWaiting&&(this._onWaiting=this._register(new i.Q),this._playerSdk.on(n.WAITING,()=>{this._onWaiting.fire()})),this._onWaiting.event}get onCanPlay(){return!this._onCanPlay&&(this._onCanPlay=this._register(new i.Q),this._playerSdk.on(n.CANPLAY,e=>{this._onCanPlay.fire(e)})),this._onCanPlay.event}get onDownloadProgress(){return!this._onDownloadProgress&&(this._onDownloadProgress=this._register(new i.Q),this._playerSdk.on(n.PROGRESS,()=>{this._onDownloadProgress.fire()})),this._onDownloadProgress.event}get onVolumeChange(){return!this._onVolumeChange&&(this._onVolumeChange=this._register(new i.Q),this._playerSdk.on(n.VOLUME_CHANGE,()=>{this._onVolumeChange.fire(this._playerSdk.volume)})),this._onVolumeChange.event}get onFullscreenChange(){return!this._onFullscreenChange&&(this._onFullscreenChange=this._register(new i.Q),this._playerSdk.on(n.FULLSCREEN_CHANGE,e=>{this._onFullscreenChange.fire(e)})),this._onFullscreenChange.event}get onDefinitionChange(){return!this._onDefinitionChange&&(this._onDefinitionChange=this._register(new i.Q),this._playerSdk.on(n.DEFINITION_CHANGE,e=>{this._onDefinitionChange.fire(e)})),this._onDefinitionChange.event}get onBufferingStart(){return!this._onBufferingStart&&(this._onBufferingStart=this._register(new i.Q),this._playerSdk.on(n.WAITING,()=>{this._onBufferingStart.fire()}),this._playerSdk.on(n.SEEKING,()=>{this._onBufferingStart.fire()})),this._onBufferingStart.event}get onBufferingEnd(){return!this._onBufferingEnd&&(this._onBufferingEnd=this._register(new i.Q),this._playerSdk.on(n.CANPLAY,()=>{this._onBufferingEnd.fire()}),this._playerSdk.on(n.SEEKED,()=>{this._onBufferingEnd.fire()})),this._onBufferingEnd.event}dispose(){this._playerSdk.offAll(),super.dispose()}}},15754:function(e,t,r){r.d(t,{R:function(){return o},t:function(){return n}});var i,s,n=((i={}).Auto="auto",i.Fill="fill",i.FillHeight="fillHeight",i.FillWidth="fillWidth",i.Cover="cover",i);var o=((s={}).Cssfullscreen="cssfullscreen",s.Screenshot="screenshot",s.Pip="pip",s.Miniscreen="miniscreen",s.Keyboard="keyboard",s.Download="download",s.Playbackrate="playbackrate",s.Time="time",s.Definition="definition",s.Error="error",s.Fullscreen="fullscreen",s.Loading="loading",s.Mobile="mobile",s.Pc="pc",s.Play="play",s.Poster="poster",s.Progress="progress",s.Replay="replay",s.Start="start",s.Volume="volume",s)},454530:function(e,t,r){r.d(t,{o:function(){return s}});var i,s=((i={}).NewTransitionEffectEnabled="enable_new_engine_transition",i)},744268:function(e,t,r){r.d(t,{aU:()=>d,Ui:()=>_});var i=r("335290"),s=r("587892"),n=r("800788"),o=r("716913"),a=r("386527"),c=r("824547");class u{get contents(){return this._contents}getValue(e){return(0,o.Z)(this._contents,e)}setValue(e,t){(0,a.Z)(this._contents,e,t)}isEmpty(){return 0===Object.keys(this._contents).length}init(e){this._contents=e}reset(e){this._contents=e}merge(e){return(0,c.Z)(this._contents,e),this}constructor(e={}){this._contents=e}}var l=r("320271");class d{getRegisteredConfigurations(e){(0,n.ss)("not implemented")}registerSectionConfigurations(e,t){(0,n.ss)("not implemented")}removeSectionConfiguration(e){(0,n.ss)("not implemented")}getConfigurationValues(e,t){(0,n.ss)("not implemented")}updateConfigurationValues(e,t){(0,n.ss)("not implemented")}reloadConfigurations(){(0,n.ss)("not implemented")}getResourceTypeByPanel(e){return Object.keys(this.resourcePanel).reduce((e,t)=>{var r;let i=this.resourcePanel[t],s=null!==(r=l.vJ[i])&&void 0!==r?r:i;return{...e,[s]:t}},{})[e]}initAppConfiguration(e){this._appConfiguration.init(e)}getAppConfigurationValue(e){return this._appConfiguration.getValue(e)}setAppConfigurationValue(e,t){this._appConfiguration.setValue(e,t)}constructor(){this._onDidChangeConfiguration=new s.Q,this._appConfiguration=new u,this.onDidChangeConfiguration=this._onDidChangeConfiguration.event}}let _=(0,i.yh)("configuration")},386663:function(e,t,r){r.d(t,{e:function(){return o}});var i=r(789786),s=r(55449),n=r(402655);class o extends n.JT{_checkPeerDependServicesExist(e){}constructor(e,t){super(),this._instantiationService=t,this._checkPeerDependServicesExist(e)}}o=(0,i.gn)([(0,i.fM)(1,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array,void 0===s.T?Object:s.T])],o)},64765:function(e,t,r){r.d(t,{J:function(){return u}});var i=r(614363),s=r(861810),n=r(297969),o=r(503601),a=r(153614),c=r(327786);class u extends i.FS{createChild(e){return new u(e,this)}dispose(){for(let e of this._childs)e.dispose();for(let[t,r]of(this._parent instanceof u&&this._parent._childs.delete(this),this._services.entries)){if(!(r instanceof s.M)&&r!==this&&r.__origin__!==this){if((0,a.Wf)(r)){var e;switch(null===(e=this.services.ownerships)||void 0===e?void 0:e.get(t)){case n.x.Reference:break;case n.x.Owned:default:r.dispose()}}}}}constructor(e=new o.y,t){super(e,t,e=>{(0,c.PB)(e,this)}),this._childs=new Set,this._parent instanceof u&&this._parent._childs.add(this)}}},349168:function(e,t,r){r.d(t,{O:function(){return o}});var i=r(587892),s=r(402655),n=r(578209);class o extends s.JT{_getHasProcess(){let e=this._taskStatusMap.map(e=>e.status);return e.includes(n.Vc.ProcessStatus)||e.includes(n.Vc.QueueStatus)}_getIsAllEnded(){let e=this._taskStatusMap.map(e=>e.status);return!e.includes(n.Vc.ProcessStatus)&&!e.includes(n.Vc.QueueStatus)}_getIsProcess(e){return[n.Vc.ProcessStatus,n.Vc.QueueStatus].includes(e)}_delQueryTasks(e){this.queryTasks.splice(this.queryTasks.findIndex(t=>t.id===e),1)}async _getTaskProgress(){let e=await this._aiToolRepository.getEditorTaskProcess({...this._queryParams,tasks:this.queryTasks},this._urlParams);if(e.ok){this._getTaskProgressErrorCount=0;let t=[],r=[],i=[];e.value.tasks.forEach(e=>{var s;let o=null===(s=this._taskStatusMap.find(t=>t.id===e.id))||void 0===s?void 0:s.status;this._getIsProcess(e.status)?t.push(e):e.status===n.Vc.SuccessStatus&&o!==n.Vc.SuccessStatus?(r.push(e),this._delQueryTasks(e.id)):e.status===n.Vc.FailStatus&&o!==n.Vc.FailStatus&&(i.push(e),this._delQueryTasks(e.id))}),r.length&&this._onSuccess.fire(r),i.length&&this._onFailed.fire(i),this.generatingTasks=t,this._taskStatusMap=e.value.tasks.map(e=>({id:e.id,status:e.status})),this._getHasProcess()&&this._onProgress.fire(t),this._getIsAllEnded()&&this._onAllEnded.fire(e.value)}else this._getTaskProgressErrorCount++;this._getTaskProgressErrorCount>=10&&(this._handleError(-9999,"tasks query failed"),this.cancelEditorTask())}_handleError(e,t){this._onFailed.fire(this.generatingTasks)}async _startPollingProgress(){var e;if(this._canceled)return;if(!(null===(e=this.queryTasks)||void 0===e?void 0:e.length)){this._handleError(-9999,"tasks empty");return}if(this._queryCnt>108e3){this._handleError(-9998,"tasks query timeout"),this.cancelEditorTask();return}if(this._queryCnt+=1,await this._getTaskProgress(),!this._canceled){if(this._taskStatusMap.find(e=>this._getIsProcess(e.status))){this._timeoutRef=setTimeout(()=>{this._startPollingProgress()},1e3);return}this._clearTimeout()}}_clearTimeout(){this._timeoutRef&&(clearTimeout(this._timeoutRef),this._timeoutRef=null)}reStartPollingProgress(e){if(this._queryCnt=0,this._canceled=!1,this._getTaskProgressErrorCount=0,this.queryTasks=this.queryTasks.concat(e),!this._timeoutRef)this._startPollingProgress()}async cancelEditorTask(){this._canceled=!0;let e=this.generatingTasks.map(e=>e.bind_id);this._clearTimeout(),e.forEach(e=>{this._delQueryTasks(e)});let t=this.queryTasks.filter(t=>e.includes(t.bindId));return(await this._aiToolRepository.cancelEditorTask({tasks:t})).ok&&this._onCancel.fire(),e}constructor(e,t,r,s){super(),this._aiToolRepository=e,this.value=t,this._queryParams=r,this._urlParams=s,this._onProgress=this._store.add(new i.Q),this.onProgress=this._onProgress.event,this._onAllEnded=this._store.add(new i.Q),this.onAllEnded=this._onAllEnded.event,this._onError=this._store.add(new i.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new i.Q),this.onSuccess=this._onSuccess.event,this._onCancel=this._store.add(new i.Q),this.onCancel=this._onCancel.event,this._onFailed=this._store.add(new i.Q),this.onFailed=this._onFailed.event,this._taskStatusMap=[],this._getTaskProgressErrorCount=0,this._canceled=!1,this._queryCnt=0,this.generatingTasks=[],this._timeoutRef=null,this.queryTasks=r.tasks,this._startPollingProgress()}}},528395:function(e,t,r){r.d(t,{z:function(){return c}});var i=r(690613),s=r(587892),n=r(402655),o=r(800788),a=r(578209);class c extends n.JT{async _getTaskProgress(){let e;switch(this._scene){case a.dZ.SmartTool:e=await this._aiToolRepository.getAiTaskProcess({taskId:this.value.taskId,...this._queryParams});break;case a.dZ.GraphEditor:e=await this._aiToolRepository.getGraphicAiTaskProcess({taskId:this.value.taskId,...this._queryParams});break;default:(0,o.bP)(this._scene)}e.ok?(this._getTaskProgressErrorCount=0,this._taskStauts=e.value.status,this._taskStauts===a.gF.Processing?this._onProgress.fire(e.value):this._taskStauts===a.gF.Fail?this._onError.fire((0,i.wf)(a.gF.Fail,"ai task failed")):this._taskStauts===a.gF.Success&&this._onSuccess.fire(e.value)):this._getTaskProgressErrorCount++,this._getTaskProgressErrorCount>=10&&(this._taskStauts=a.gF.Fail,this._onError.fire((0,i.wf)(e.code,e.msg)))}async _startPollingProgress(){await this._getTaskProgress(),this._taskStauts===a.gF.Processing&&!this._canceled&&setTimeout(()=>{this._startPollingProgress()},500)}cancel(){if(!this._canceled)this._canceled=!0,this._onCancel.fire()}constructor(e,t,r,i){super(),this._aiToolRepository=e,this.value=t,this._queryParams=r,this._scene=i,this._onProgress=this._store.add(new s.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new s.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new s.Q),this.onSuccess=this._onSuccess.event,this._onCancel=this._store.add(new s.Q),this.onCancel=this._onCancel.event,this._taskStauts=a.gF.Processing,this._getTaskProgressErrorCount=0,this._canceled=!1,this.value.taskId&&this._startPollingProgress()}}},578209:function(e,t,r){r.d(t,{Vc:function(){return a},dZ:function(){return c},gF:function(){return o}}),r(139305);var i,s,n,o=((i={})[i.Processing=1]="Processing",i[i.Success=2]="Success",i[i.Fail=3]="Fail",i[i.NotFound=4]="NotFound",i);var a=((s={}).FailStatus="failed",s.CancelStatus="canceled",s.SuccessStatus="succeed",s.ProcessStatus="processing",s.QueueStatus="queueing",s.ExpiredStatus="expired",s);var c=((n={})[n.SmartTool=0]="SmartTool",n[n.GraphEditor=1]="GraphEditor",n)},716045:function(e,t,r){r.d(t,{W:()=>C});var i=r("789786"),s=r("690613"),n=r("800788"),o=r("114861"),a=r("702049"),c=r("405051"),u=r("121130"),l=r("894339"),d=r("905180"),_=r("768101"),h=r("191449"),p=r("981632");let g={CREATE_TASK:"/lv/v1/intelligence/create",GET_TASK_PROCESS:"/lv/v1/intelligence/query",CHECK_POPUP:"/lv/v1/intelligence/check_popup",CONFIRM_POPUP:"/lv/v1/intelligence/confirm_popup",IMAGE_HIGHLIGH_ANALYSE:"/lv/v1/intelligence/image_highlight_analyse",PROMPT_TO_TEXT:"/lv/v1/intelligence/prompt_to_text",PROMPT_SUG:"/lv/v1/intelligence/prompt_sug",TEXT_TO_VIDEO_PRESET:"/lv/v1/intelligence/text2video_preset",RENDER_CREATE:"/lv/v1/intelligence/render_create",PACKAGE_SYNC_STATUS:"/lv/v1/intelligence/package_sync_status",RENDER_TASK_CREATE:"/lv/v1/render_task/create",GET_AUDIO_SNR:"/lv/v1/intelligence/get_audio_snr",CREATE_EDITOR_TASK:"/lv/v1/editor/task/new",QUERY_EDITOR_TASK_PROCESS:"/lv/v1/editor/task/query",CANCEL_EDITOR_TASK:"/lv/v1/editor/task/cancel",INTELLIGENT_PRODUCT_HISTORY_ADD:"/lv/v1/intelligence/product/add",INTELLIGENT_PRODUCT_HISTORY_UPDATE:"/lv/v1/intelligence/product/update",INTELLIGENT_PRODUCT_HISTORY_LIST:"/lv/v1/intelligence/product/list",CHECK_CONTROLLABLE_AREA:"/lv/v1/lite/config/check_region"};var y=r("578209"),f=r("292180"),v=r("492197");let m=e=>{let{status:t,speed:r,task_detail:i,draft_info:s}=e.data,n=null==i?void 0:i.map(e=>({resourceId:e.resource_id,resourceName:e.resource_name,resourceType:e.resource_type,level:e.level,width:e.width,height:e.height,scene:e.scene,platform:e.platform,md5:e.md5,video:e.video&&{cover:e.video.cover,playInfo:e.video.play_info},image:e.image&&{url:e.image.key,key:e.image.key,urlList:e.image.url_list,previewKey:e.image.preview_key}}));return{status:t,progress:r,taskDetail:n||[],draftInfo:s?{draftKey:s.draft_key,packageId:s.package_id,materialId:s.material_id,subtitleList:s.subtitle_list}:void 0}},w=e=>{let{status:t,speed:r,task_detail:i,draft_info:s}=e.data,n=null==i?void 0:i.map(e=>({resourceId:e.resource_id,resourceName:e.resource_name,resourceType:e.resource_type,level:e.level,width:e.width,height:e.height,scene:e.scene,platform:e.platform,md5:e.md5,video:e.video&&{cover:e.video.cover,playInfo:e.video.play_info},image:e.image&&{url:e.image.url,key:e.image.key,urlList:e.image.url_list,previewKey:e.image.preview_key}}));return{status:t,progress:r,taskDetail:n||[],draftInfo:s?{draftKey:s.draft_key,packageId:s.package_id,materialId:s.material_id,subtitleList:s.subtitle_list}:void 0}},k=e=>{let{task_id:t,task_detail:r,link_type:i}=e.data;return{taskId:t,taskDetail:(null==r?void 0:r.map(e=>({resourceId:e.resource_id,resourceName:e.resource_name,resourceType:e.resource_type,level:e.level,width:e.width,height:e.height,scene:e.scene,platform:e.platform,md5:e.md5,video:e.video&&{cover:e.video.cover,playInfo:e.video.play_info},image:e.image&&{url:e.image.key,key:e.image.key,urlList:e.image.url_list,previewKey:e.image.preview_key}})))||[],linkType:null!=i?i:0}},T=e=>{let{task_id:t,task_detail:r,link_type:i}=e.data;return{taskId:t,taskDetail:(null==r?void 0:r.map(e=>({resourceId:e.resource_id,resourceName:e.resource_name,resourceType:e.resource_type,level:e.level,width:e.width,height:e.height,scene:e.scene,platform:e.platform,md5:e.md5,video:e.video&&{cover:e.video.cover,playInfo:e.video.play_info},image:e.image&&{url:e.image.url,key:e.image.key,urlList:e.image.url_list,previewKey:e.image.preview_key}})))||[],linkType:null!=i?i:0}},R=e=>{let{audioAssetId:t,videoAssetId:r,captionAssetId:i}=e,s=[],n={};return t&&(n.audioAssetId=t,s.push(t)),r&&(n.videoAssetId=r,s.push(r)),i&&(n.captionAssetId=i,s.push(i)),n.assetIdList=s,n};var b=r("583642"),S=r("690465");class C{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build(c.kk);return(0,u.i3)(e),(0,l.mH)(e),(0,o.V)(e),(0,d.Y)(e),e}()),this._networkClientInstance}_getApi(e){return`${a._L.getVar("web_domain")}${e}`}async createAiTask(e,t){try{let r=(0,v.Z)(e.params,(e,t)=>(0,f.Z)(t)),i=await this._networkClient.post(this._getApi(g.CREATE_TASK),{asset_id:e.assetId,workspace_id:e.workspaceId,platform:e.platform,smart_tool_type:e.aiToolType,sync_call:Number(e.syncCall),scene:e.scene,use_base64:Number(e.useBase64),params:r},{withCredentials:!0,params:t});if("0"!==i.ret)return(0,s.wf)(Number(i.ret),i.errmsg);return(0,s.oW)(k(i))}catch(e){return(0,_.m)(e,-1,"createAiTask api error.")}}async createGraphicAiTask(e,t){try{let{params:r}=e,i={};r&&(i=Object.assign({},...Object.keys(r).map(e=>"styleKey"===e?{style_key:r[e]}:{[e]:r[e]})));let n=await this._networkClient.post(this._getApi(g.CREATE_TASK),{asset_id:e.assetId,workspace_id:e.workspaceId,asset_workspace_id:e.assetWorkspaceId,platform:e.platform,smart_tool_type:e.aiToolType,sync_call:void 0!==e.syncCall?Number(e.syncCall):void 0,scene:y.dZ.GraphEditor,use_base64:void 0!==e.useBase64?Number(e.useBase64):void 0,params:JSON.stringify(i)},{withCredentials:!0,params:t});if("0"!==n.ret)return(0,s.wf)(Number(n.ret),n.errmsg);return(0,s.oW)(T(n))}catch(e){return(0,_.m)(e,-1,"createAiTask api error.")}}async getGraphicAiTaskProcess(e){try{let t=await this._networkClient.post(this._getApi(g.GET_TASK_PROCESS),{task_id:e.taskId,smart_tool_type:e.aiToolType,workspace_id:e.workspaceId},{withCredentials:!0,params:e.urlParams});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)(w(t))}catch(e){return(0,_.m)(e,-1,"getAiTaskProcess api error.")}}async getAiTaskProcess(e){try{let t=await this._networkClient.post(this._getApi(g.GET_TASK_PROCESS),{task_id:e.taskId,smart_tool_type:e.aiToolType,workspace_id:e.workspaceId},{withCredentials:!0,params:e.urlParams});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)(m(t))}catch(e){return(0,_.m)(e,-1,"getAiTaskProcess api error.")}}async aiCheckPopup(){try{let e=await this._networkClient.post(this._getApi(g.CHECK_POPUP));if("0"!==e.ret)return(0,s.wf)(Number(e.ret),e.errmsg);return(0,s.oW)(e.data.need_check)}catch(e){return(0,_.m)(e,-1,"aiCheckPopup api error.")}}async aiConfirmPopup(){try{let e=await this._networkClient.post(this._getApi(g.CONFIRM_POPUP));if("0"!==e.ret)return(0,s.wf)(Number(e.ret),e.errmsg);return(0,s.ly)()}catch(e){return(0,_.m)(e,-1,"aiCheckPopup api error.")}}async imageHighlightAnalyse(e){try{let t=await this._networkClient.post(this._getApi(g.IMAGE_HIGHLIGH_ANALYSE),{workspace_id:e.workspaceId,top_k:e.topK,image_base64_list:e.imageBase64List});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)({status:t.data.status,highlightImageIndex:t.data.highlight_image_index})}catch(e){return(0,_.m)(e,-1,"aiCheckPopup api error.")}}async promptToText(e){try{let t=(0,v.Z)(e.adScript,(e,t)=>(0,f.Z)(t)),r=await this._networkClient.post(this._getApi(g.PROMPT_TO_TEXT),{mode:e.mode,request_id:e.requestId,smart_script_id:e.smartScriptId,oral_script:e.oralScript,ad_script:t},{withCredentials:!0});if("0"!==r.ret)return(0,s.wf)(Number(r.ret),r.errmsg);let{texts:i}=r.data;return(0,s.oW)({status:r.data.status,texts:i.map(e=>{let{label:t,text:r,script_id:i,model_name:s}=e;return{label:t,text:r,scriptId:i,modelName:s}})})}catch(e){return(0,s.Mx)(-1,"promptToText api error.",e)}}async promptSug(e){try{let t=await this._networkClient.post(this._getApi(g.PROMPT_SUG),{input:e.input,category:e.category},{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)({recommendResult:t.data.recommend_result})}catch(e){return(0,s.Mx)(-1,"promptSug api error.",e)}}async getTextToVideoPreset(){try{let e=await this._networkClient.post(this._getApi(g.TEXT_TO_VIDEO_PRESET),null,{withCredentials:!0});if("0"!==e.ret)return(0,s.wf)(Number(e.ret),e.errmsg);return(0,s.oW)({historyTones:e.data.history_tones,formConfig:(0,p.D)(e.data.form_config)})}catch(e){return(0,s.Mx)(-1,"getTextToVideoPreset api error.",e)}}async generateVideo(e){try{let t=await this._networkClient.post(this._getApi(g.RENDER_CREATE),{task_id:e.taskId,package_id:e.packageId,workspace_id:e.workspaceId,draft_key:e.draftKey,use_cache:e.useCache},{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)({playUrl:t.data.play_url,coverUrl:t.data.cover_url})}catch(e){return(0,s.Mx)(-1,"generateVideo api error.",e)}}async syncPackageStatus(e){try{let t=await this._networkClient.post(this._getApi(g.PACKAGE_SYNC_STATUS),{task_id:e.taskId,from_workspace_id:e.fromWorkspaceId,to_workspace_id:e.toWorkspaceId,smart_tool_type:e.smartToolType,custom_info:e.customInfo},{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)({draftKey:t.data.draft_key,packageId:t.data.package_id})}catch(e){return(0,s.Mx)(e.ret||-1,"sync package status error.",e)}}async createRenderTask(e){try{let t=await this._networkClient.post(this._getApi(g.RENDER_TASK_CREATE),{uid:e.uid,app_version:e.appVersion,sdk_version:e.sdkVersion,extra:e.extra,type:e.type,region:e.region,app_id:e.appId,width:e.width,height:e.height,fps:e.fps,format:e.format,cover:e.cover,duration:e.duration,quality:e.quality,definition:e.definition,task_id:e.taskId,video_name:e.videoName,draft_id:e.draftId,package_id:e.packageId,video_id:e.videoId,video_path:e.videoPath,group_id:e.groupId,custom_info:e.customInfo,from_workspace_id:e.fromWorkspaceId,to_workspace_id:e.toWorkspaceId,force_export:e.forceExport},{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)({taskId:t.data.task_id,missMaterials:t.data.miss_materials})}catch(e){return(0,s.Mx)(-1,"create render task error.",e)}}async createEditorTask(e,t){try{let{bindId:r,enterFrom:i,workspaceId:n,tasks:o,canQueue:a}=e,c=o.map(e=>(0,v.Z)(e,(e,t)=>(0,f.Z)(t))),u=await this._networkClient.post(this._getApi(g.CREATE_EDITOR_TASK),{bind_id:r,enter_from:i,workspace_id:n,tasks:c,can_queue:a},{withCredentials:!0,params:t});if("0"!==u.ret)return(0,s.wf)(Number(u.ret),u.errmsg);return(0,s.oW)({tasks:u.data.tasks,failed_tasks:u.data.failed_tasks})}catch(e){return(0,_.m)(e,-1,"createAiTask api error.")}}async getEditorTaskProcess(e,t){try{let{tasks:r,enterFrom:i,workspaceId:n,canQueue:o}=e,a=r.map(e=>(0,v.Z)(e,(e,t)=>(0,f.Z)(t))),c=await this._networkClient.post(this._getApi(g.QUERY_EDITOR_TASK_PROCESS),{tasks:a,enter_from:i,workspace_id:n,can_queue:o},{withCredentials:!0,params:t});if("0"!==c.ret)return(0,s.wf)(Number(c.ret),c.errmsg);return(0,s.oW)(c.data)}catch(e){return(0,_.m)(e,-1,"getAiTaskProcess api error.")}}async cancelEditorTask(e){try{let{tasks:t}=e,r=t.map(e=>(0,v.Z)(e,(e,t)=>(0,f.Z)(t))),i=await this._networkClient.post(this._getApi(g.CANCEL_EDITOR_TASK),{tasks:r},{withCredentials:!0});if("0"!==i.ret)return(0,s.wf)(Number(i.ret),i.errmsg);return(0,s.oW)(i.data)}catch(e){return(0,s.Mx)(-1,"create render task error.",e)}}async getAudioSNR(e){try{let t=await this._networkClient.post(this._getApi(g.GET_AUDIO_SNR),{audio_vid:e.vid,uri:e.uri,audio_format:e.format},{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)({left:t.data.estimated_snr_left,right:t.data.estimated_snr_right})}catch(e){return(0,s.Mx)(e.ret||-1,"get audio snr error",e)}}async addIntelligentProduct(e){try{let{productInfo:t}=e,r=R(t),i=await this._networkClient.post(this._httpApiSettingService.getRequestURL({domainType:S.Y.DEFAULT,path:g.INTELLIGENT_PRODUCT_HISTORY_ADD}),{workspace_id:e.workspaceId,draft_id:e.draftId,package_id:e.packageId,product_info:JSON.stringify({...(0,h.X)(r),extra:e.extra}),scene:e.scene},{withCredentials:!0});if("0"!==i.ret)return(0,s.wf)(Number(i.ret),i.errmsg);return(0,s.oW)(i.data)}catch(e){return(0,s.Mx)(e.ret||-1,"get audio snr error",e)}}async updateIntelligentProduct(e){try{let{productInfo:t}=e,r=R(t),i=await this._networkClient.post(this._httpApiSettingService.getRequestURL({domainType:S.Y.DEFAULT,path:g.INTELLIGENT_PRODUCT_HISTORY_UPDATE}),{id:e.id,workspace_id:e.workspaceId,product_info:JSON.stringify({...(0,h.X)(r),extra:e.extra})},{withCredentials:!0});if("0"!==i.ret)return(0,s.wf)(Number(i.ret),i.errmsg);return(0,s.ly)()}catch(e){return(0,s.Mx)(e.ret||-1,"get audio snr error",e)}}async getIntelligentProductList(e){try{let t=await this._networkClient.post(this._httpApiSettingService.getRequestURL({domainType:S.Y.DEFAULT,path:g.INTELLIGENT_PRODUCT_HISTORY_LIST}),{draft_id:e.draftId,workspace_id:e.workspaceId,count:e.count,cursor:e.cursor,create_time_desc:!0,scene:e.scene},{withCredentials:!0}),{has_more:r,product_record_list:i,new_cursor:o}=t.data,a=[];if(i.forEach(e=>{let{videoAssetId:t,audioAssetId:r,captionAssetId:i,extra:s}=(0,h.b)((0,p.D)(e.product_info)),o={};if(t){let r=e.product_details[t];(0,n.Y2)(r),o.videoAsset=(0,b.y)(r)}if(r){let t=e.product_details[r];(0,n.Y2)(t),o.audioAsset=(0,b.y)(t)}if(i){let t=e.product_details[i];(0,n.Y2)(t),o.captionAsset=(0,b.y)(t)}a.push({id:e.id,appId:e.app_id,createTime:Number(`${e.create_time}000`),updateTime:Number(`${e.update_time}000`),packageId:e.package_id,workspaceId:e.workspace_id,scene:e.scene,userId:e.user_id,productResultRecord:o,draftId:e.draft_id,extra:s})}),"0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)({productRecordList:a,hasMore:r,newCursor:o})}catch(e){return(0,s.Mx)(e.ret||-1,"get product list error",e)}}async avCheckControllableArea(e){try{let t=await this._networkClient.post(this._httpApiSettingService.getRequestURL({domainType:S.Y.DEFAULT,path:g.CHECK_CONTROLLABLE_AREA}),{app_id:e.appId},{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)(t.data.invalid)}catch(e){return(0,s.Mx)(e.ret||-1,"get audio snr error",e)}}constructor(e){this._httpApiSettingService=e}}C=(0,i.gn)([(0,i.fM)(0,S.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===S.x?Object:S.x])],C)},208066:function(e,t,r){r.d(t,{J:function(){return o},L:function(){return n}});var i,s=r(335290);var n=((i={})[i.Success=1]="Success",i[i.Process=0]="Process",i[i.Failure=-1]="Failure",i[i.Cancel=2]="Cancel",i);let o=(0,s.yh)("ai-writer-data-service")},930826:function(e,t,r){r.d(t,{p:()=>b});var i=r("789786"),s=r("593642"),n=r("55449"),o=r("402655"),a=r("690613"),c=r("256030"),u=r("114861"),l=r("405051"),d=r("121130"),_=r("894339"),h=r("702049"),p=r("801497"),g=r("870590"),y=r("556418"),f=r("276939");class v{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new l.yk().build({...l.kk,timeout:9e4});return(0,d.i3)(e),(0,_.mH)(e),(0,u.V)(e),e}()),this._networkClientInstance}get _api(){return`${h._L.getVar("web_domain")}${g.b.TEXT_REWRITE}`}async textRewrite(e){var t,r,i;try{let r=(0,f.L)(e.content,e.type);if(r)return r;let i=await this._networkClient.post(this._api,this._formatParams(e),{withCredentials:!0});if("0"!==i.ret)return(0,a.wf)(Number(i.ret),null!==(t=i.errmsg)&&void 0!==t?t:"");return(0,a.oW)(this._formatResponse(i))}catch(s){let t=null!==(r=s.ret)&&void 0!==r?r:-1;return(0,a.Mx)(Number(t),null!==(i=(0,y.az)(t,e.type))&&void 0!==i?i:p.oc.t("web_ai_writer_toast_polish_failure_unknown_error",{},"Couldn\u2019t polish. Try again later."),s)}}_formatParams(e){return{count:5,content:e.content,action_type:e.type}}_formatResponse(e){let{data:{texts:t}}=e;return{texts:t.map(e=>({text:e.text,scriptId:e.script_id}))}}}var m=r("533710"),w=r("587892"),k=r("208066");let T=Math.floor(2.5);class R extends o.JT{get error(){return this._error}get status(){return this._taskStatus}get value(){return this._result}cancel(){this._taskStatus=k.L.Cancel}async _fetchPromptResult(){let e=await this.promptToTextPromise;e.ok?(this._taskStatus=k.L.Success,this._result=e.value,this._onSuccess.fire(this._result)):(this._taskStatus=k.L.Failure,this._error=e,this._onError.fire(e))}_mockUpdateProcess(){this._taskStatus===k.L.Process?(this._currentProcess=Math.min(this._currentProcess+T,99),this._onProgress.fire({process:this._currentProcess,status:k.L.Process}),setTimeout(()=>{this._mockUpdateProcess()},500)):this._onProgress.fire({process:100,status:this._taskStatus})}constructor(e){super(),this.promptToTextPromise=e,this._onProgress=this._store.add(new w.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new w.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new w.Q),this.onSuccess=this._onSuccess.event,this._taskStatus=k.L.Process,this._error=(0,a.ly)(),this._currentProcess=0,this._fetchPromptResult(),this._mockUpdateProcess()}}class b extends o.JT{createPromptToTextTask(e){let t=(0,f.L)(e.prompt);if(t)return t;let r=(0,s.Rl)(),i=this._promptToTextRepository.promptToText({...e,requestId:r});return(0,a.oW)(new R(i))}textRewrite(e){return this._textRewriteRepository.textRewrite(e)}report(e){return this._aiWriterReportRepository.report(e)}constructor(e){super(),this._instantiationService=e,this._promptToTextRepository=this._instantiationService.createInstance(c.P),this._textRewriteRepository=this._instantiationService.createInstance(v),this._aiWriterReportRepository=this._instantiationService.createInstance(m.u)}}b=(0,i.gn)([(0,i.fM)(0,n.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.T?Object:n.T])],b)},870590:function(e,t,r){r.d(t,{b:function(){return i}});let i={PROMPT_TO_TEXT:"/lv/v1/intelligence/prompt_to_text",TEXT_REWRITE:"/lv/v1/intelligence/text_rewrite",TEXT_REWRITE_CN:"/lv/v1/aigc_text/rewrite",REPORT:"/lv/v1/report/report"}},556418:function(e,t,r){r.d(t,{CB:function(){return o},Yq:function(){return a},az:function(){return u}});var i,s,n=r(801497);var o=((i={})[i.Title=1]="Title",i[i.Text=2]="Text",i);var a=((s={})[s.Longer=1]="Longer",s[s.Shorter=2]="Shorter",s[s.Rewrite=3]="Rewrite",s);let c={get 1e3(){return n.oc.t("web_ai_writer_hover_generate_error",{},"Couldn\u2019t generate. Try again later.")},get 203107(){return n.oc.t("web_ai_writer_hover_generated_too_frequent",{},"Too many attempts. Try again later.")},get 203108(){return n.oc.t("web_ai_writer_hover_generate_failed",{},"Couldn\u2019t generate. Edit your prompt or text and try again.")},get 203109(){return n.oc.t("web_ai_writer_toast_generate_failed_internet_error",{},"Couldn\u2019t generate. Connect to the internet and try again.")},get 203110(){return n.oc.t("web_ai_writer_toast_generate_failed_edit_text_retry",{},"Couldn\u2019t generate. Edit your prompt or text and try again.")},get 203130(){return n.oc.t("web_ai_writer_hover_generate_failed",{},"Couldn\u2019t generate. Edit your prompt or text and try again.")}};function u(e,t){var r,i;let s=`${e}`;if(void 0===t)return c[s];let o={1e3:{3:n.oc.t("web_ai_writer_toast_polish_failure_unknown_error",{},"Couldn\u2019t polish. Try again later."),1:n.oc.t("web_ai_writer_toast_expand_failure_unknown_error",{},"Couldn\u2019t expand. Try again later."),2:n.oc.t("web_ai_writer_toast_shorten_failure_unknown_error",{},"Couldn\u2019t shorten. Try again later.")},203107:{3:n.oc.t("web_ai_writer_toast_many_attempts_alert",{},"Too many attempts. Try again later."),1:n.oc.t("web_ai_writer_toast_many_attempts_alert",{},"Too many attempts. Try again later."),2:n.oc.t("web_ai_writer_toast_many_attempts_alert",{},"Too many attempts. Try again later.")},203108:{3:n.oc.t("web_ai_writer_toast_polish_failure_edit_text",{},"Couldn\u2019t polish. Edit your prompt or text and try again."),1:n.oc.t("web_ai_writer_toast_expand_failure_edit_text",{},"Couldn\u2019t expand. Edit your prompt or text and try again."),2:n.oc.t("web_ai_writer_toast_shorten_failure_edit_text",{},"Couldn\u2019t shorten. Edit your prompt or text and try again.")},203109:{3:n.oc.t("web_ai_writer_toast_polish_failure_internet_error",{},"Couldn\u2019t polish. Connect to the internet and try again."),1:n.oc.t("web_ai_writer_toast_polish_failure_internet_error",{},"Couldn\u2019t polish. Connect to the internet and try again."),2:n.oc.t("web_ai_writer_toast_polish_failure_internet_error",{},"Couldn\u2019t polish. Connect to the internet and try again.")},203130:{3:n.oc.t("web_ai_writer_toast_polish_failure_retry",{},"Couldn\u2019t polish. Try again later."),1:n.oc.t("web_ai_writer_toast_expand_failure_unknown_error",{},"Couldn\u2019t expand. Try again later."),2:n.oc.t("web_ai_writer_toast_shorten_failure_unknown_error",{},"Couldn\u2019t shorten. Try again later.")},203110:{3:n.oc.t("web_ai_writer_toast_polish_failure_edit_text_retry",{},"Couldn\u2019t polish. Edit your prompt or text and try again."),1:n.oc.t("web_ai_writer_toast_expand_failure_edit_text_retry",{},"Couldn\u2019t expand. Edit your prompt or text and try again."),2:n.oc.t("web_ai_writer_toast_shorten_failure_edit_text_retry",{},"Couldn\u2019t shorten. Edit your prompt or text and try again.")}};return null!==(i=null===(r=o[e])||void 0===r?void 0:r[t])&&void 0!==i?i:o["1000"][t]}},235297:function(e,t,r){r.d(t,{o:function(){return i}});let i=(0,r(335290).yh)("get-arithmetic-model-data-service")},63276:function(e,t,r){r.d(t,{R:()=>y});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861");function c(e){let t=[...e.file_url.url_list,...e.file_url.zip_url_list].filter(e=>!!e);return{key:e.file_url.uri,name:e.name,version:e.version,modelType:e.type,md5:e.file_url.uri,package:{uri:e.file_url.uri,urlList:t},status:e.status,fileType:e.file_type}}var u=r("966697"),l=r("702049"),d=r("405051"),_=r("121130"),h=r("768101"),p=r("396190");class g{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new d.yk().build(d.kk);return(0,_.i3)(e),(0,a.V)(e),e}()),this._networkClientInstance}async getModel(e){try{var t;let r=await this._networkClient.get(this._api,this._buildRequestConfig(e)),i=Number(null!==(t=r.status_code)&&void 0!==t?t:0);if(0!==i)return(0,o.wf)(null!=i?i:-1,"get Model error");let s=this._convertResponseToArithmeticModelData(r);return(0,o.oW)(s)}catch(e){return(0,h.m)(e,-1,"getModel api error")}}_convertResponseToArithmeticModelData(e){return{list:e.data.arithmetics.cakeCook.map(c)}}_buildRequestConfig(e){var t,r;return{params:{busi_id:"501066",device_type:"capcut_web",device_platform:"mac",ve_version:null!==(t=e.veVersion)&&void 0!==t?t:"",sdk_version:null!==(r=e.veVersion)&&void 0!==r?r:"",app_version:this._environmentService.appVersion,aid:"0",app_name:"capcut",status:l.JA?"0":"1",web_id:e.webId,device_id:e.webId,uid:this._accountService.userProfile.uid,...e.modelNames?{required_model_list:this._getUniqueName(e.modelNames)}:void 0}}}_getUniqueName(e){let t=new Map;return e.forEach(e=>{t.set(e,e)}),Array.from(t.keys()).join(",")}get _api(){return"/model/api/arithmetics"}constructor(e,t){this._accountService=e,this._environmentService=t}}g=(0,i.gn)([(0,i.fM)(0,u.Gw),(0,i.fM)(1,p.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.Gw?Object:u.Gw,void 0===p.Y?Object:p.Y])],g);class y extends n.JT{getModel(e){return this._getModelRepository.getModel(e)}constructor(e){super(),this._instantiationService=e,this._getModelRepository=this._instantiationService.createInstance(g)}}y=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],y)},806337:function(e,t,r){r.d(t,{l:()=>G});var i=r("789786"),s=r("861810"),n=r("55449"),o=r("402655"),a=r("690613"),c=r("127830"),u=r("412497"),l=r("928790");class d extends u.r{get resourceType(){return c._g.VoiceChange}parseEffectsToResources(e){return e.map(e=>(0,l.s)(e))}}var _=r("773943"),h=r("850078");class p extends _.b{buildCustomRequest(e){var t;return{enable_album:null!==(t=e.enableAlbum)&&void 0!==t&&t,region:e.region,enter_from:e.enter_from}}get resourceType(){return c._g.VoiceChange}parseEffectsToResources(e,t){return(0,h.Z)(e.map(e=>(0,l.s)(e,t)),"resourceId")}}var g=r("512363");class y extends g.L{get resourceType(){return c._g.VoiceChange}buildCustomRequest(e){return{region:e.region,enter_from:e.enter_from}}}var f=r("52798"),v=r("249656"),m=r("587892"),w=r("920704"),k=r("374149");class T extends o.JT{_createIncrementalRandomFunction(){let e=0;return function(){let t=Math.min(e,98);return e=Math.floor(Math.random()*(Math.max(e,98)-t+1))+t}}get error(){return this._error}get status(){return this._smartTaskStatus}get value(){return this._result}cancel(){this._smartTaskStatus=w.y.Failure,this._onCancel.fire()}async _getTaskProgress(){var e,t,r,i,s,n,o,c,u,l,d;let _=null===(e=this._taskRequest)||void 0===e?void 0:e.data.task_id;if(_){let e=await this._vcTaskRepository.query({task_id:_,workspaceId:this._workspaceId},this._urlParams);if(e.ok){let{status:h}=e.value.data;if(h===k.T9.Success&&this.status===w.y.Process){let a=null===(r=e.value.data)||void 0===r?void 0:null===(t=r.task_detail)||void 0===t?void 0:t.find(e=>e.resource_type===w.uP.STSAudio),h=null==a?void 0:a.sync_status;this._hasLogin&&h===k.Tx.Success||!this._hasLogin?(this._smartTaskStatus=w.y.Success,this._result={vid:null!==(c=null==a?void 0:a.resource_id)&&void 0!==c?c:"",md5:null!==(u=null==a?void 0:a.md5)&&void 0!==u?u:"",url:null!==(l=null==a?void 0:null===(s=a.transcode_audio_info)||void 0===s?void 0:null===(i=s[0])||void 0===i?void 0:i.url)&&void 0!==l?l:"",key:null!==(d=null==a?void 0:null===(o=a.transcode_audio_info)||void 0===o?void 0:null===(n=o[0])||void 0===n?void 0:n.key)&&void 0!==d?d:"",task_id:_},this._onProgress.fire({progress:100,status:this._smartTaskStatus}),this._onSuccess.fire(this._result)):this._onProgress.fire({progress:99,status:this._smartTaskStatus})}else if(h===k.T9.Processing){this._smartTaskStatus=w.y.Process;let e=this._getProcess();this._onProgress.fire({progress:e,status:this._smartTaskStatus})}else this._smartTaskStatus=w.y.Failure,this._error=(0,a.wf)(-1,"query task failed"),this._onError.fire(this._error)}else this._getTaskProgressErrorCount++;this._getTaskProgressErrorCount>=10&&(this._smartTaskStatus=w.y.Failure,this._error=(0,a.wf)(e.code,e.msg),this._onError.fire(this._error))}}async _startPollingProgress(){await this._getTaskProgress(),this._smartTaskStatus===w.y.Process&&setTimeout(()=>{this._startPollingProgress()},1500)}constructor(e,t,r,i,s){super(),this._vcTaskRepository=e,this._taskRequest=t,this._hasLogin=r,this._workspaceId=i,this._urlParams=s,this._onProgress=this._store.add(new m.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new m.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new m.Q),this.onSuccess=this._onSuccess.event,this._onCancel=this._store.add(new m.Q),this.onCancel=this._onCancel.event,this._smartTaskStatus=w.y.Process,this._getTaskProgressErrorCount=0,this._error=(0,a.ly)(),this._startPollingProgress(),this._getProcess=this._createIncrementalRandomFunction()}}var R=r("966697"),b=r("721389"),S=r("174416"),C=r("758027"),I=r("33883");class P extends C.B{get resourceType(){return c._g.VoiceChange}get resourcePanelType(){return I.q.VoiceChange}parseHeycanResponseDataToResources(e){return(0,S.A)(e)}buildCustomRequest(e){var t,r;return{panel:e.panel,client_ab_param:e.clientABParam,panel_source:e.panelSource,category_id:Number(e.categoryId),category_key:e.category_key,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t,only_commercial:null!==(r=e.onlyCommercial)&&void 0!==r&&r}}}}var E=r("872443");class A extends E.L{get resourceType(){return c._g.VoiceChange}get resourcePanelType(){return I.q.VoiceChange}parseHeycanResponseDataToResources(e){return(0,S.A)(e)}buildCustomRequest(e){var t,r;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t,only_commercial:null!==(r=e.onlyCommercial)&&void 0!==r&&r}}}buildCustomRequestParams(){var e;return{device_type:"default",channel:null!==(e=new URLSearchParams(location.search).get("lokiChannel"))&&void 0!==e?e:"online"}}}var M=r("736031"),x=r("305301"),O=r("744268"),F=r("256718"),D=r("273340"),L=r("786022"),U=r("396190");class B extends F.k{get resourceType(){return D.g.VoiceChange}parseHeycanResponseDataToResources(e){return(0,S.A)(e)}buildCustomRequest(){return{app_id:L.kJ,loki_optional:{app_version:this._environmentService.appVersion,device_platform:"web"},pack_optional:{need_thumb:!0}}}constructor(e={},t,r){super(e,t),this._environmentService=r}}B=(0,i.gn)([(0,i.fM)(1,R.Gw),(0,i.fM)(2,U.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===R.Gw?Object:R.Gw,void 0===U.Y?Object:U.Y])],B);class G extends o.JT{async getAudioVoice(e){var t;let r=null===(t=this._configurationService.getAppConfigurationValue("toolbar.voiceChanger.isFromHeycan"))||void 0===t||t;return await (0,M._Q)(this._configurationService,this._getHeycanVoiceChangeByCategoryRepository.resourcePanelType)&&r?this._getHeycanVoiceChangeByCategoryRepository.getResources(e):this._getAudioVoiceRepository.getResources(e)}async batchGetAudioVoicesByIds(e){if(e.source===v.Hw.LOKI)return this._batchGetAudioVoiceRepository.batchGetResources(e);{let t=await (0,M.bY)(this._configurationService);return"loki"===(0,M.lo)(t,this._batchGetHeycanVoiceChangeRepository.resourcePanelType).panel_path&&e.source!==v.Hw.HEYCAN?this._batchGetAudioVoiceRepository.batchGetResources(e):this._batchGetHeycanVoiceChangeRepository.batchGetResources((0,x.Q)(e.ids,this._batchGetHeycanVoiceChangeRepository.resourceType,e.source))}}async getAudioVoiceCategories(e){var t;let r=null===(t=this._configurationService.getAppConfigurationValue("toolbar.voiceChanger.isFromHeycan"))||void 0===t||t,i=await (0,M.bY)(this._configurationService);return"vimo"===(0,M.lo)(i,this._getHeycanVoiceChangeCategoriesRepository.resourcePanelType).panel_path&&r?this._getHeycanVoiceChangeCategoriesRepository.getCategories((0,M.lY)(e,i)):this._getAudioVoiceCategoriesRepository.getCategories(e)}async createVcTask(e,t){let r=`${e.assetId}_${e.voice.resourceId}`,i=this._cache[r];if(i)return i;let s=await this._vcTaskRepository.create(e,t);if(s.ok){let i=new T(this._vcTaskRepository,s.value,this._accountService.hasLogin,e.workspaceId,t),n=(0,a.oW)(i);return this._cache[r]=n,n}return(0,a.wf)(-1,"create task error")}getAudioVoiceCollections(e){return this._collectionAudioVoiceRepository.getCollections(e)}addToCollection(e){return this._collectionAudioVoiceRepository.addToCollection(e)}removeFromCollection(e){return this._collectionAudioVoiceRepository.removeFromCollection(e)}constructor(e={},t,r,i){super(),this._collectionParam=e,this._instantiationService=t,this._accountService=r,this._configurationService=i,this._cache={},this._getAudioVoiceRepository=this._instantiationService.createInstance(p),this._batchGetAudioVoiceRepository=this._instantiationService.createInstance(d),this._getAudioVoiceCategoriesRepository=this._instantiationService.createInstance(y),this._vcTaskRepository=this._instantiationService.createInstance(f.a),this._getHeycanVoiceChangeByCategoryRepository=this._instantiationService.createInstance(P),this._getHeycanVoiceChangeCategoriesRepository=this._instantiationService.createInstance(A),this._batchGetHeycanVoiceChangeRepository=this._instantiationService.createInstance(b.d),this._collectionAudioVoiceRepository=this._instantiationService.createInstance(new s.M(B,[e],!1))}}G=(0,i.gn)([(0,i.fM)(1,n.T),(0,i.fM)(2,R.Gw),(0,i.fM)(3,O.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===n.T?Object:n.T,void 0===R.Gw?Object:R.Gw,void 0===O.Ui?Object:O.Ui])],G)},928790:function(e,t,r){r.d(t,{s:function(){return o}});var i=r(623935),s=r(127830),n=r(249656);function o(e,t){let{common:r,extra:o}=(0,i.sh)(s._g.VoiceChange,e,t);return{...r,source:r.source===n.Hw.UNKNOWN?n.Hw.LOKI:r.source,extra:o,isVoiceConversion:!!o.is_voice_conversion}}},174416:function(e,t,r){r.d(t,{A:function(){return c}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372),a=r(134429);function c(e){let t=(0,i.E)(e,s._g.VoiceChange),r=(0,n.D)(e.common_attr.extra);return{...t,key:`${s._g.VoiceChange}_${t.resourceId}`,name:t.title,isBusiness:t.isBusiness,icon:{uri:(0,o.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,o.s)(t.originUrl),urlList:[t.originUrl]},sdkVersion:a.f4,isVoiceConversion:!!r.is_voice_conversion,extra:r}}},378481:function(e,t,r){r.d(t,{F:function(){return i}});let i=(0,r(335290).yh)("audio-data-service")},285633:function(e,t,r){r.d(t,{i:()=>j});var i,s=r("789786"),n=r("866006"),o=r("966697"),a=r("277714"),c=r("256718"),u=r("273340");class l extends c.k{get resourceType(){return this._resourceType}parseHeycanResponseDataToResources(e){return this._resourceType===u.g.AudioEffect?(0,a.L3)(e,this._resourceType):(0,a.Fi)(e,this._resourceType)}buildCustomRequest(){return{pack_optional:{need_thumb:!0,thumb_opt:'{"is_support_webp":1}'}}}constructor(e,t={},r){super(t,r),this._resourceType=e}}l=(0,s.gn)([(0,s.fM)(2,o.Gw),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",["undefined"==typeof AudioEffectType?Object:AudioEffectType,"undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===o.Gw?Object:o.Gw])],l);var d=r("861810"),_=r("55449"),h=r("402655"),p=r("680452"),g=r("702049"),y=r("768101"),f=r("405051"),v=r("121130"),m=r("894339"),w=r("690613"),k=r("114861"),T=r("772270"),R=r("512505");class b{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new f.yk().build(f.kk);return(0,v.i3)(e),(0,m.mH)(e),(0,k.V)(e),e}()),this._networkClientInstance}async getRecommendAudios(e){let t=e instanceof n.yt?e.config:e;try{var r,i;let s=await this._networkClient.post(`${this._api}?lite_aid=${T.AF}`,{id:t.id,collection_type:0,...this._getTokenParams(e)}),n=Number(null!==(r=s.ret)&&void 0!==r?r:0),o=null!==(i=s.errmsg)&&void 0!==i?i:"";if(0!==n)return(0,w.wf)(null!=n?n:-1,null!=o?o:"");let a=this._convertResponseToQueryToken(e,s);return(0,w.oW)(a)}catch(e){return(0,y.m)(e,-1,"getMusicAlbums api error")}}_getTokenParams(e){var t,r;return(0,n.ky)(e)?{offset:e.offset,count:null!==(t=e.config.limit)&&void 0!==t?t:50}:{offset:0,count:null!==(r=e.limit)&&void 0!==r?r:50}}_convertResponseToQueryToken(e,t){var r,i;let s=e instanceof n.yt?e.config:e,o=null!==(i=null===(r=t.data.songs)||void 0===r?void 0:r.map(e=>(0,a.y3)(e)))&&void 0!==i?i:[],c=e instanceof n.yt?e.offset:0,u=t.data.has_more,l=c+o.length;return(0,n.ib)(s,{list:o},{hasMore:u,offset:l})}get _api(){return`${g._L.getVar("web_domain")}${R.J.GET_RECOMMEND_MUSIC}`}constructor(e){this._capcutAccountService=e}}b=(0,s.gn)([(0,s.fM)(0,o.Gw),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw])],b);var S=r("720646"),C=r("620752");var I=((i={})[i.normal=0]="normal",i);class P{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new f.yk().build(f.kk);return(0,v.i3)(e),(0,m.mH)(e),(0,k.V)(e),e}()),this._networkClientInstance}async getMusicAlbums(){try{var e,t;let r=await this._networkClient.post(`${this._api}?lite_aid=${T.AF}`,{scene:I.normal}),i=Number(null!==(e=r.ret)&&void 0!==e?e:0),s=null!==(t=r.errmsg)&&void 0!==t?t:"";if(0!==i)return(0,w.wf)(null!=i?i:-1,null!=s?s:"");let n=this._convertResponseToCollectionData(r);return(0,w.oW)(n)}catch(e){return(0,y.m)(e,-1,"getMusicAlbums api error")}}_convertResponseToCollectionData(e){let{data:t}=e;return{albums:t.collections.map(e=>{let t=Object.values(e.cover_url).map(e=>this._parseUrlToTranscodeInfo(e));return{id:e.id,name:e.name,coverUrl:e.cover_url.medium,transcodeInfo:t}})}}_parseUrlToTranscodeInfo(e){var t,r;let i=e.match(/_(\d+)x(\d+)\./);return{url:e,width:Number(null!==(t=null==i?void 0:i[1])&&void 0!==t?t:0),height:Number(null!==(r=null==i?void 0:i[2])&&void 0!==r?r:0)}}get _api(){return`${g._L.getVar("web_domain")}${R.J.GET_MUSIC_COLLECTIONS}`}constructor(e){this._capcutAccountService=e}}P=(0,s.gn)([(0,s.fM)(0,o.Gw),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw])],P);var E=r("596150"),A=r("551525"),M=r("97506"),x=r("786022"),O=r("727334"),F=r("184754");class D{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new f.yk().build(f.kk);return(0,v.i3)(e),(0,m.mH)(e),(0,k.V)(e),e}()),this._networkClientInstance}async searchSongs(e){let t=e instanceof n.yt?e.config:e;try{var r,i;let s=await this._networkClient.post(this._api,{app_id:x.kJ,region:this._capcutAccountService.userProfile.region,search_song_type:this._searchSongType,keyword:t.query,...this._getTokenParams(e)},{withCredentials:!0}),n=Number(null!==(r=s.ret)&&void 0!==r?r:0),o=null!==(i=s.errmsg)&&void 0!==i?i:"";if(0!==n)return(0,w.wf)(null!=n?n:-1,null!=o?o:"");let a=this._convertResponseToQueryToken(e,s);return(0,w.oW)(a)}catch(e){return(0,y.m)(e,-1,"getMusicAlbums api error")}}_getTokenParams(e){var t,r;return(0,n.ky)(e)?{offset:e.offset,count:null!==(t=e.config.limit)&&void 0!==t?t:50,search_id:e.searchId}:{offset:0,count:null!==(r=e.limit)&&void 0!==r?r:50}}_convertResponseToQueryToken(e,t){var r,i;let s=e instanceof n.yt?e.config:e,o=this._searchSongType===F.S.music?u.g.Song:u.g.AudioEffect,c=null!==(i=null===(r=t.data.songs)||void 0===r?void 0:r.map(e=>(0,a.y3)(e,o)))&&void 0!==i?i:[],l=t.data.has_more,d=t.data.new_cursor;return(0,n.ib)(s,{list:c,relatedWords:t.data.related_words},{hasMore:l,offset:d,searchId:t.data.search_id,requestId:t.log_id})}get _api(){return`${g._L.getVar("web_domain")}${O.J.SEARCH_SONGS}`}constructor(e,t){this._searchSongType=e,this._capcutAccountService=t}}D=(0,s.gn)([(0,s.fM)(1,o.Gw),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[void 0===F.S?Object:F.S,void 0===o.Gw?Object:o.Gw])],D);var L=r("446204"),U=r("740446");class B extends U.i{parseResponseDataToResources(e){return(0,a.Fi)(e,void 0,!0)}}var G=r("846373");class j extends h.JT{getAudios(e){return(e instanceof n.yt?e.config:e).audioResourceType!==M.b.Music?this._getSoundEffectRepository.getResources(e):"v1"===this._options.repositoryVersion?this._getMusicV1Repository.getRecommendAudios(e):this._getMusicRepository.getResources(e)}getBrandAudios(e){return this._getBrandAudiosRepository.getResources(e)}getAudioAlbums(e){return e===M.b.SoundEffect?this._getSoundEffectAlbumsRepository.getSoundEffectAlbums():"v1"===this._options.repositoryVersion?this._getMusicAlbumsV1Repository.getMusicAlbums():this._getMusicAlbumsRepository.getMusicAlbums()}getAlbumSongs(e){return"v1"===this._options.repositoryVersion?this._getAlbumSongsV1Repository.getAlbumSongs(e):this._getAlbumSongsRepository.getAlbumSongs(e)}batchGetAudios(e){let{isFromBrand:t=!1}=e;return t?this._getBrandAudiosByIdsRepository.getResourcesByIds({ids:e.resourceIds}):e.audioResourceType===M.b.Music?this._batchGetMusicRepository.batchGetResources(e):this._batchGetSoundEffectRepository.batchGetResources(e)}searchAudio(e){return(e instanceof n.yt?e.config:e).audioResourceType===M.b.Music?this._searchMusicRepository.searchSongs(e):this._searchSoundEffectRepository.searchSongs(e)}getCollections(e){return(e instanceof n.yt?e.config:e).audioResourceType===M.b.Music?this._collectionMusicRepository.getCollections(e):this._collectionSoundEffectRepository.getCollections(e)}addToCollection(e){return e.audioResourceType===M.b.Music?this._collectionMusicRepository.addToCollection(e):this._collectionSoundEffectRepository.addToCollection(e)}removeFromCollection(e){return e.audioResourceType===M.b.Music?this._collectionMusicRepository.removeFromCollection(e):this._collectionSoundEffectRepository.removeFromCollection(e)}constructor(e={},t){super(),this._options=e,this._instantiationService=t,this._searchMusicRepository=this._instantiationService.createInstance(new d.M(D,[F.S.music])),this._collectionMusicRepository=this._instantiationService.createInstance(new d.M(l,[u.g.Song,this._options])),this._getMusicRepository=this._instantiationService.createInstance(new d.M(p.E,[u.g.Song])),this._getMusicV1Repository=this._instantiationService.createInstance(new d.M(b,[])),this._batchGetMusicRepository=this._instantiationService.createInstance(new d.M(S.w,[u.g.Song])),this._getMusicAlbumsRepository=this._instantiationService.createInstance(C.g),this._getMusicAlbumsV1Repository=this._instantiationService.createInstance(P),this._getAlbumSongsRepository=this._instantiationService.createInstance(E.x),this._getAlbumSongsV1Repository=this._instantiationService.createInstance(A.Y),this._searchSoundEffectRepository=this._instantiationService.createInstance(new d.M(D,[F.S.audioEffect])),this._collectionSoundEffectRepository=this._instantiationService.createInstance(new d.M(l,[u.g.AudioEffect,this._options])),this._getSoundEffectRepository=this._instantiationService.createInstance(new d.M(p.E,[u.g.AudioEffect])),this._batchGetSoundEffectRepository=this._instantiationService.createInstance(new d.M(S.w,[u.g.AudioEffect])),this._getSoundEffectAlbumsRepository=this._instantiationService.createInstance(L.F),this._getBrandAudiosRepository=this._instantiationService.createInstance(G.u),this._getBrandAudiosByIdsRepository=this._instantiationService.createInstance(B)}}j=(0,s.gn)([(0,s.fM)(1,_.T),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",["undefined"==typeof AudioDataServiceParams?Object:AudioDataServiceParams,void 0===_.T?Object:_.T])],j)},512505:function(e,t,r){r.d(t,{J:function(){return i}});let i={GET_MUSIC_COLLECTIONS:"/lv/v1/get_collections",GET_RECOMMEND_MUSIC:"/lv/v1/get_recommend_songs",GET_SOUND_EFFECT_COLLECTIONS:"/lv/v1/music/get_music_effect_collections",GET_COLLECTION_SONGS:"/lv/v1/get_collection_songs",SEARCH_SONGS:"/lv/v1/music/search/songs"}},727334:function(e,t,r){r.d(t,{J:function(){return i}});let i={GET_MUSIC_COLLECTIONS:"/lv/v1/music/get_collections",GET_SOUND_EFFECT_COLLECTIONS:"/lv/v1/music/get_music_effect_collections",GET_COLLECTION_SONGS:"/lv/v1/music/get_collection_songs",SEARCH_SONGS:"/lv/v1/music/search/songs"}},277714:function(e,t,r){r.d(t,{Fi:function(){return u},L3:function(){return l},y3:function(){return d}});var i=r(889862),s=r(273340),n=r(127830),o=r(249656),a=r(163210),c=r(800788);function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?function(e){let{common_attr:t,song:r}=e,i=(0,a.C)(t);return(0,c.ZB)(r),{...i,isDefault:e.IsDefault,userId:t.user_id,createTime:t.create_time,effectType:s.g.Song,songId:Number(t.id),duration:r.duration,decryptKey:r.key,authorName:"",isFromBrand:!0,workspaceId:t.workspace_id}}(e):function(e,t){var r,s;let o=(0,i.E)(e,n._g.Audio);return t&&(o.effectType=t),{...o,duration:null!==(r=e.song.duration)&&void 0!==r?r:0,authorName:null!==(s=e.song.pgc_author_name)&&void 0!==s?s:"",songId:0}}(e,t)}function l(e,t){var r,s;let o=(0,i.E)(e,n._g.Audio);return t&&(o.effectType=t),{...o,duration:null!==(r=e.audio_effect.duration)&&void 0!==r?r:0,authorName:null!==(s=e.audio_effect.pgc_author_name)&&void 0!==s?s:"",songId:0}}function d(e,t){let r=s.g.Song;t&&(r=t);let i=e.preview_url.match(/\/([^\/?#]+)([?#]|$|\/$)/),a=(null==i?void 0:i[1])?i[1]:String(e.id);return{key:`${n._g.Audio}_${String(e.id)}`,resourceId:String(e.id),md5:a,effectType:r,effectId:String(e.id),songId:e.id,description:"",source:o.Hw.MUSIC,duration:e.duration,isBusiness:e.is_commerce,title:e.title,coverUrl:e.cover_url.thumb,originUrl:e.preview_url,authorName:e.author,isVip:!1}}},625569:function(e,t,r){r.d(t,{r:()=>R});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("725104");class u extends a.r{get resourceType(){return o._g.AutoBeautyBody}parseEffectsToResources(e){return e.map(e=>(0,c.K)(e))}}var l=r("773943");class d extends l.b{buildCustomRequest(e){return{category:e.category}}get resourceType(){return o._g.AutoBeautyBody}parseEffectsToResources(e,t){return e.map(e=>(0,c.K)(e,t))}}var _=r("859765"),h=r("748020"),p=r("758027"),g=r("33883");class y extends p.B{get resourceType(){return o._g.AutoBeautyBody}parseHeycanResponseDataToResources(e){return(0,h.r)(e)}get resourcePanelType(){return g.q.AutoBeautyBody}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,category_id:"all"===e.category?-1:Number(e.category),panel:this.resourcePanelType,..."all"===e.category&&{category_key:"all"},pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}buildCustomRequestParams(){var e;return{device_type:"default",channel:null!==(e=new URLSearchParams(location.search).get("lokiChannel"))&&void 0!==e?e:"online"}}}var f=r("217809"),v=r("155513"),m=r("736031"),w=r("744268"),k=r("726563"),T=r("305301");class R extends n.JT{async getAutoBeautyBody(e){return await (0,m._Q)(this._configurationService,this._getHeycanAutoBeautyBodyByCategoryRepository.resourcePanelType)?this._getHeycanAutoBeautyBodyByCategoryRepository.getResources(e):this._getHeycanAutoBeautyBodyByCategoryRepository.getResources({...e,panelSource:"loki"})}async batchGetAutoBeautyBodiesByIds(e){if(e.source===k.H.LOKI)return this._batchGetAutoBeautyBodyRepository.batchGetResources(e);{let t=await (0,m.bY)(this._configurationService);return"loki"===(0,m.lo)(t,this._batchGetHeycanAutoBeautyBodyRepository.resourcePanelType).panel_path&&e.source!==k.H.HEYCAN?this._batchGetAutoBeautyBodyRepository.batchGetResources(e):this._batchGetHeycanAutoBeautyBodyRepository.batchGetResources((0,T.Q)(e.ids,this._batchGetHeycanAutoBeautyBodyRepository.resourceType,e.source))}}async getAutoBeautyBodyCategories(e){let t=await (0,m.bY)(this._configurationService);return"vimo"===(0,m.lo)(t,this._getHeycanAutoBeautyBodyCategoriesRepository.resourcePanelType).panel_path?this._getHeycanAutoBeautyBodyCategoriesRepository.getCategories((0,m.lY)(e,t)):this._getHeycanAutoBeautyBodyCategoriesRepository.getCategories({...e,panelSource:"loki"})}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._autoBeautyBodyRepository=this._instantiationService.createInstance(d),this._batchGetAutoBeautyBodyRepository=this._instantiationService.createInstance(u),this._getAutoBeautyBodyCategoriesRepository=this._instantiationService.createInstance(_.w),this._getHeycanAutoBeautyBodyByCategoryRepository=this._instantiationService.createInstance(y),this._getHeycanAutoBeautyBodyCategoriesRepository=this._instantiationService.createInstance(f.T),this._batchGetHeycanAutoBeautyBodyRepository=this._instantiationService.createInstance(v.X)}}R=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,w.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===w.Ui?Object:w.Ui])],R)},725104:function(e,t,r){r.d(t,{K:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r,extra:n}=(0,i.sh)(s._g.AutoBeautyBody,e,t);return{...r,effectType:n.effect_type,order:n.order,selectedIcon:n.selected_icon}}},748020:function(e,t,r){r.d(t,{r:function(){return a}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372);function a(e){let t=(0,i.E)(e,s._g.Sticker),r=(0,n.D)(e.common_attr.extra);return{key:`${s._g.AutoBeautyBody}_${t.resourceId}`,resourceId:t.resourceId,thirdResourceId:t.thirdResourceId,effectId:t.effectId,md5:t.md5,name:t.title,isBusiness:t.isBusiness,isVip:t.isVip,requirements:t.requirements,modelNames:t.modelNames,icon:{uri:(0,o.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,o.s)(t.originUrl),urlList:[t.originUrl]},source:t.source,sdkVersion:"",isPrefab:!1,order:r.order,effectType:r.effect_type,selectedIcon:r.selected_icon,intensityKey:r.intensity_key,maxValue:r.slider_maxValue,minValue:r.slider_minValue,defaultValue:r.slider_defaultValue}}},966421:function(e,t,r){r.d(t,{z:()=>I});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("623094");class u extends a.r{get resourceType(){return o._g.AutoBeautyFace}parseEffectsToResources(e){return e.map(e=>(0,c.t)(e))}}var l=r("500071"),d=r("512363");class _ extends d.L{get resourceType(){return o._g.AutoBeautyFace}}var h=r("521687"),p=r("758027"),g=r("33883");class y extends p.B{get resourceType(){return o._g.AutoBeautyFace}get resourcePanelType(){return g.q.AutoBeautyFace}parseHeycanResponseDataToResources(e){return(0,h.L)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,category_id:"all"===e.category?-1:Number(e.category),panel:this.resourcePanelType,..."all"===e.category&&{category_key:"all"},pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}buildCustomRequestParams(){var e;return{device_type:"default",channel:null!==(e=new URLSearchParams(location.search).get("lokiChannel"))&&void 0!==e?e:"online"}}}var f=r("649607"),v=r("966697"),m=r("273340"),w=r("789869"),k=r("685795");class T extends w.A{get resourceType(){return m.g.AutoBeautyFace}get resourcePanelType(){return g.q.AutoBeautyFace}parseHeycanResponseDataToResources(e){return(0,h.L)(e)}constructor(e,t){super(e,t)}}T=(0,i.gn)([(0,i.fM)(0,v.Gw),(0,i.fM)(1,k.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v.Gw?Object:v.Gw,void 0===k.L?Object:k.L])],T);var R=r("744268"),b=r("736031"),S=r("249656"),C=r("305301");class I extends n.JT{async getAutoBeautyFace(e){return await (0,b._Q)(this._configurationService,this._getHeycanAutoBeautyFaceByCategoryRepository.resourcePanelType)?this._getHeycanAutoBeautyFaceByCategoryRepository.getResources(e):this._getHeycanAutoBeautyFaceByCategoryRepository.getResources({...e,panelSource:"loki"})}async batchGetAutoBeautyFacesByIds(e){if(e.source===S.Hw.LOKI)return this._batchGetAutoBeautyFaceRepository.batchGetResources(e);{let t=await (0,b.bY)(this._configurationService);return"loki"===(0,b.lo)(t,this._batchGetHeycanAutoBeautyFaceByIdsRepository.resourcePanelType).panel_path&&e.source!==S.Hw.HEYCAN?this._batchGetAutoBeautyFaceRepository.batchGetResources(e):this._batchGetHeycanAutoBeautyFaceByIdsRepository.batchGetResources((0,C.Q)(e.ids,this._batchGetHeycanAutoBeautyFaceByIdsRepository.resourceType,e.source))}}batchGetAutoBeautyFacesByIdAndType(e){return this._batchGetHeycanAutoBeautyFaceByIdsRepository.batchGetResources(e)}async getAutoBeautyFaceCategories(e){let t=await (0,b.bY)(this._configurationService);return"vimo"===(0,b.lo)(t,this._getHeycanAutoBeautyFaceCategoriesRepository.resourcePanelType).panel_path?this._getHeycanAutoBeautyFaceCategoriesRepository.getCategories((0,b.lY)(e,t)):this._getHeycanAutoBeautyFaceCategoriesRepository.getCategories({...e,panelSource:"loki"})}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._autoBeautyFaceRepository=this._instantiationService.createInstance(l.Z),this._batchGetAutoBeautyFaceRepository=this._instantiationService.createInstance(u),this._getAutoBeautyFaceCategoriesRepository=this._instantiationService.createInstance(_),this._getHeycanAutoBeautyFaceByCategoryRepository=this._instantiationService.createInstance(y),this._getHeycanAutoBeautyFaceCategoriesRepository=this._instantiationService.createInstance(f.E),this._batchGetHeycanAutoBeautyFaceByIdsRepository=this._instantiationService.createInstance(T)}}I=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,R.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===R.Ui?Object:R.Ui])],I)},941953:function(e,t,r){r.d(t,{s:()=>R});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("743612");class u extends a.r{get resourceType(){return o._g.AutoBeautyMakeup}parseEffectsToResources(e){return e.map(e=>(0,c.W)(e))}}var l=r("388520"),d=r("939152"),_=r("872443"),h=r("33883"),p=r("1939");class g extends _.L{get resourceType(){return o._g.AutoBeautyMakeup}get resourcePanelType(){return h.q.AutoBeautyMakeup}parseHeycanResponseDataToResources(e){return(0,p.T)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t}}}buildCustomRequestParams(){var e;return{device_type:"default",channel:null!==(e=new URLSearchParams(location.search).get("lokiChannel"))&&void 0!==e?e:"online"}}}var y=r("758027");class f extends y.B{get resourceType(){return o._g.AutoBeautyMakeup}get resourcePanelType(){return h.q.AutoBeautyMakeup}parseHeycanResponseDataToResources(e){return(0,p.T)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,category_id:Number(e.category),pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}}var v=r("731275"),m=r("736031"),w=r("744268"),k=r("249656"),T=r("305301");class R extends n.JT{async getAutoBeautyMakeup(e){return await (0,m._Q)(this._configurationService,this._getHeycanAutoBeautyMakeupByCategoryRepository.resourcePanelType)?this._getHeycanAutoBeautyMakeupByCategoryRepository.getResources(e):this._getHeycanAutoBeautyMakeupByCategoryRepository.getResources({...e,panelSource:"loki"})}async batchGetAutoBeautyMakeupsByIds(e){if(e.source===k.Hw.LOKI)return this._batchGetAutoBeautyMakeupRepository.batchGetResources(e);{let t=await (0,m.bY)(this._configurationService);return"loki"===(0,m.lo)(t,this._batchGetHeycanAutoBeautyMakeupRepository.resourcePanelType).panel_path&&e.source!==k.Hw.HEYCAN?this._batchGetAutoBeautyMakeupRepository.batchGetResources(e):this._batchGetHeycanAutoBeautyMakeupRepository.batchGetResources((0,T.Q)(e.ids,this._batchGetHeycanAutoBeautyMakeupRepository.resourceType,e.source))}}async getAutoBeautyMakeupCategories(e){let t=await (0,m.bY)(this._configurationService);return"vimo"===(0,m.lo)(t,this._getHeycanAutoBeautyMakeupCategoriesRepository.resourcePanelType).panel_path?this._getHeycanAutoBeautyMakeupCategoriesRepository.getCategories((0,m.lY)(e,t)):this._getHeycanAutoBeautyMakeupCategoriesRepository.getCategories({...e,panelSource:"loki"})}constructor(e={},t,r){super(),this._options=e,this._instantiationService=t,this._configurationService=r,this._autoBeautyMakeupRepository=this._instantiationService.createInstance(l.M),this._batchGetAutoBeautyMakeupRepository=this._instantiationService.createInstance(u),this._getAutoBeautyMakeupCategoriesRepository=this._instantiationService.createInstance(d._),this._getHeycanAutoBeautyMakeupCategoriesRepository=this._instantiationService.createInstance(g),this._getHeycanAutoBeautyMakeupByCategoryRepository=this._instantiationService.createInstance(f),this._batchGetHeycanAutoBeautyMakeupRepository=this._instantiationService.createInstance(v.X),this._options.fixedRegion&&(this._getHeycanAutoBeautyMakeupByCategoryRepository.setFixedRegion(this._options.fixedRegion),this._getHeycanAutoBeautyMakeupCategoriesRepository.setFixedRegion(this._options.fixedRegion))}}R=(0,i.gn)([(0,i.fM)(1,s.T),(0,i.fM)(2,w.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object,void 0===s.T?Object:s.T,void 0===w.Ui?Object:w.Ui])],R)},743612:function(e,t,r){r.d(t,{W:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r,extra:n}=(0,i.sh)(s._g.AutoBeautyMakeup,e,t);return{...r,effectType:n.effect_type,order:n.order,beautify:n.beautify,exclusionGroup:n.exclusion_group,imageUrl:n.image_url,intensityKey:n.intensity_key}}},1939:function(e,t,r){r.d(t,{T:function(){return c}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372),a=r(134429);function c(e){let t=(0,i.E)(e,s._g.AutoBeautyMakeup),r=(0,n.D)(e.common_attr.extra);return{key:`${s._g.AutoBeautyMakeup}_${t.resourceId}`,resourceId:t.resourceId,thirdResourceId:t.thirdResourceId,effectId:t.effectId,md5:t.md5,name:t.title,isBusiness:t.isBusiness,isVip:t.isVip,icon:{uri:(0,o.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,o.s)(t.originUrl),urlList:[t.originUrl]},requirements:t.requirements,modelNames:t.modelNames,source:t.source,isPrefab:t.isPrefab,sdkVersion:a.f4,effectType:r.effect_type,order:r.order,beautify:r.beautify,exclusionGroup:r.exclusion_group,imageUrl:r.image_url,intensityKey:r.intensity_key}}},65934:function(e,t,r){r.d(t,{w:()=>I});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("381280");class u extends a.r{get resourceType(){return o._g.AutoBeautyShape}parseEffectsToResources(e){return e.map(e=>(0,c.c)(e))}}var l=r("15365"),d=r("512363");class _ extends d.L{get resourceType(){return o._g.AutoBeautyShape}}var h=r("725402"),p=r("966697"),g=r("273340"),y=r("430675"),f=r("789869"),v=r("33883"),m=r("685795");class w extends f.A{get resourceType(){return g.g.AutoBeautyShape}get resourcePanelType(){return v.q.AutoBeautyShape}parseHeycanResponseDataToResources(e){return(0,y.x)(e)}constructor(e,t){super(e,t)}}w=(0,i.gn)([(0,i.fM)(0,p.Gw),(0,i.fM)(1,m.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.Gw?Object:p.Gw,void 0===m.L?Object:m.L])],w);var k=r("758027");class T extends k.B{get resourceType(){return o._g.AutoBeautyShape}get resourcePanelType(){return v.q.AutoBeautyShape}parseHeycanResponseDataToResources(e){return(0,y.x)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,category_id:Number(e.category),pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}}var R=r("736031"),b=r("744268"),S=r("249656"),C=r("305301");class I extends n.JT{async getAutoBeautyShape(e){return await (0,R._Q)(this._configurationService,this._getHeycanAutoBeautyShapeByCategoryRepository.resourcePanelType)?this._getHeycanAutoBeautyShapeByCategoryRepository.getResources(e):this._getHeycanAutoBeautyShapeByCategoryRepository.getResources({...e,panelSource:"loki"})}async batchGetAutoBeautyShapesByIds(e){if(e.source===S.Hw.LOKI)return this._batchGetAutoBeautyShapeRepository.batchGetResources(e);{let t=await (0,R.bY)(this._configurationService);return"loki"===(0,R.lo)(t,this._batchGetHeycanAutoBeautyShapeRepository.resourcePanelType).panel_path&&e.source!==S.Hw.HEYCAN?this._batchGetAutoBeautyShapeRepository.batchGetResources(e):this._batchGetHeycanAutoBeautyShapeRepository.batchGetResources((0,C.Q)(e.ids,this._batchGetHeycanAutoBeautyShapeRepository.resourceType,e.source))}}async getAutoBeautyShapeCategories(e){let t=await (0,R.bY)(this._configurationService);return"vimo"===(0,R.lo)(t,this._getHeycanAutoBeautyShapeCategoriesRepository.resourcePanelType).panel_path?this._getHeycanAutoBeautyShapeCategoriesRepository.getCategories((0,R.lY)(e,t)):this._getHeycanAutoBeautyShapeCategoriesRepository.getCategories({...e,panelSource:"loki"})}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._autoBeautyShapeRepository=this._instantiationService.createInstance(l.f),this._batchGetAutoBeautyShapeRepository=this._instantiationService.createInstance(u),this._getAutoBeautyShapeCategoriesRepository=this._instantiationService.createInstance(_),this._getHeycanAutoBeautyShapeByCategoryRepository=this._instantiationService.createInstance(T),this._getHeycanAutoBeautyShapeCategoriesRepository=this._instantiationService.createInstance(h.g),this._batchGetHeycanAutoBeautyShapeRepository=this._instantiationService.createInstance(w)}}I=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,b.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===b.Ui?Object:b.Ui])],I)},381280:function(e,t,r){r.d(t,{c:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r,extra:n}=(0,i.sh)(s._g.AutoBeautyShape,e,t);return{...r,intensityKey:n.intensity_key,effectType:n.effect_type,order:n.order,selectedIcon:n.selected_icon,maxValue:n.slider_maxValue,minValue:n.slider_minValue}}},430675:function(e,t,r){r.d(t,{x:function(){return a}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372);function a(e){let t=(0,i.E)(e,s._g.AutoBeautyShape),r=(0,n.D)(e.common_attr.extra);return{key:`${s._g.AutoBeautyShape}_${t.resourceId}`,resourceId:t.resourceId,thirdResourceId:t.thirdResourceId,effectId:t.effectId,md5:t.md5,name:t.title,isBusiness:t.isBusiness,isVip:t.isVip,icon:{uri:(0,o.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,o.s)(t.originUrl),urlList:[t.originUrl]},requirements:t.requirements,modelNames:t.modelNames,source:t.source,sdkVersion:"",isPrefab:!1,intensityKey:r.intensity_key,effectType:r.effect_type,order:r.order,selectedIcon:r.selected_icon,maxValue:r.slider_maxValue,minValue:r.slider_minValue}}},597247:function(e,t,r){r.d(t,{V:function(){return s}});var i,s=((i={}).webp="image/webp",i.jpeg="image/jpeg",i)},9590:function(e,t,r){r.d(t,{m:function(){return s}});var i,s=((i={}).Free="free",i.LimitedTimeFree="limited_time_free",i.Subscribe="subscribe",i.Oneoff="oneoff",i)},335534:function(e,t,r){r.d(t,{D:function(){return s}});var i,s=((i={})[i.OrderFailedFE=1000010]="OrderFailedFE",i)},256718:function(e,t,r){r.d(t,{k:function(){return y}});var i=r(789786),s=r(966697),n=r(702049),o=r(405051),a=r(121130),c=r(866006),u=r(768101),l=r(690613),d=r(114861),_=r(502600),h=r(606805),p=r(801497),g=r(772270);class y{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.i3)(e),(0,d.V)(e),e}()),this._networkClientInstance}async getCollections(e){try{var t,r,i,s;let n=e instanceof c.yt?e.config:e,o=await this._networkClient.post(this._getCollectionApi,this._convertParamsToRequest(e),{...(0,h._)(null!==(r=null!==(t=this._options.fixedRegion)&&void 0!==t?t:this._accountService.userProfile.region)&&void 0!==r?r:"",p.ZP.language,void 0,g.AF,!!this._options.fixedRegion),withCredentials:!0}),a=Number(null!==(i=o.ret)&&void 0!==i?i:0),u=null!==(s=o.errmsg)&&void 0!==s?s:"";if(0!==a)return(0,l.wf)(null!=a?a:-1,null!=u?u:"");let d=this._convertResponseToQueryToken(n,o);return(0,l.oW)(d)}catch(e){return(0,u.m)(e,-1,`[${this.resourceType}] getCollections api error`)}}async addToCollection(e){try{var t,r,i,s;let n=await this._networkClient.post(this._addCollectionApi,this._convertAddParamsToRequest(e),{...(0,h._)(null!==(r=null!==(t=this._options.fixedRegion)&&void 0!==t?t:this._accountService.userProfile.region)&&void 0!==r?r:"",p.ZP.language,void 0,g.AF,!!this._options.fixedRegion),withCredentials:!0}),o=Number(null!==(i=n.ret)&&void 0!==i?i:0),a=null!==(s=n.errmsg)&&void 0!==s?s:"";if(0!==o)return(0,l.wf)(null!=o?o:-1,null!=a?a:"");let c=n.data.favorite_info,u=Object.keys(c).filter(e=>0===c[e]),d=Object.keys(c).filter(e=>0!==c[e]);return(0,l.oW)({successfulItems:u,failedItems:d})}catch(t){let e="string"==typeof t?t:"addToCollection api error";return(0,u.m)(t,-1,e)}}async removeFromCollection(e){try{var t,r,i,s;let n=await this._networkClient.post(this._removeCollectionApi,this._convertRemoveParamsToRequest(e),{...(0,h._)(null!==(r=null!==(t=this._options.fixedRegion)&&void 0!==t?t:this._accountService.userProfile.region)&&void 0!==r?r:"",p.ZP.language,void 0,g.AF,!!this._options.fixedRegion),withCredentials:!0}),o=Number(null!==(i=n.ret)&&void 0!==i?i:0),a=null!==(s=n.errmsg)&&void 0!==s?s:"";if(0!==o)return(0,l.wf)(null!=o?o:-1,null!=a?a:"");let c=n.data.unfavorite_info,u=Object.keys(c).filter(e=>0===c[e]),d=Object.keys(c).filter(e=>0!==c[e]);return(0,l.oW)({successfulItems:u,failedItems:d})}catch(t){let e="string"==typeof t?t:"removeFromCollection api error";return(0,u.m)(t,-1,e)}}buildCustomRequest(){return{}}get defaultQueryToken(){return{offset:0,count:50}}_convertParamsToRequest(e){var t,r;e instanceof c.yt&&e.config;let i=this.buildCustomRequest(),s=(0,c.ky)(e)?{count:null!==(t=e.config.limit)&&void 0!==t?t:50,offset:null!==(r=e.offset)&&void 0!==r?r:0}:{...this.defaultQueryToken,...e.limit?{count:e.limit}:void 0};return{effect_type:this.resourceType,...i,...s}}_convertAddParamsToRequest(e){let{collections:t}=e,r=t.map(e=>({...e,effect_type:this.resourceType}));return{items:r,...this.buildCustomRequest()}}_convertRemoveParamsToRequest(e){let{collections:t}=e,r=t.map(e=>({...e,effect_type:this.resourceType}));return{items:r,...this.buildCustomRequest()}}_convertResponseToQueryToken(e,t){let r=t.data.effect_item_list.map(e=>this.parseHeycanResponseDataToResources(e)),i=t.data.next_offset,s=t.data.has_more;return(0,c.ib)(e,{list:r},{hasMore:s,offset:i})}get _getCollectionApi(){return`${n._L.getVar("web_domain")}${_.bl.GET_COLLECTIONS}`}get _addCollectionApi(){return`${n._L.getVar("web_domain")}${_.bl.BATCH_FAVORITE}`}get _removeCollectionApi(){return`${n._L.getVar("web_domain")}${_.bl.BATCH_UNFAVORITE}`}constructor(e={},t){this._options=e,this._accountService=t,this._options=e}}y=(0,i.gn)([(0,i.fM)(1,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===s.Gw?Object:s.Gw])],y)},891551:function(e,t,r){r.d(t,{c:function(){return n},u:function(){return o}});var i,s,n=((i={}).TrackEditor="track_editor",i.Export="export",i);var o=((s={})[s.Scale360p=1]="Scale360p",s[s.Scale720p=3]="Scale720p",s[s.Scale1080p=4]="Scale1080p",s[s.Scale4k=10]="Scale4k",s)},612327:function(e,t,r){r.d(t,{J:function(){return p}});var i=r(789786),s=r(966697),n=r(702049),o=r(405051),a=r(121130),c=r(768101),u=r(690613),l=r(114861),d=r(502600),_=r(606805),h=r(801497);class p{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.i3)(e),(0,l.V)(e),e}()),this._networkClientInstance}async batchGetResources(e){try{var t,r;let i=await this._networkClient.post(this._batchGetResourcesApi,this._convertParamsToRequest(e),(0,_._)(this._accountService.userProfile.region,h.ZP.language)),s=Number(null!==(t=i.ret)&&void 0!==t?t:0),n=null!==(r=i.errmsg)&&void 0!==r?r:"";if(0!==s)return(0,u.wf)(null!=s?s:-1,null!=n?n:"");let o=this._convertResponseToResourcesData(e,i);return(0,u.oW)(o)}catch(e){return(0,c.m)(e,-1,`[${this.resourceType}] batchGetResources api error`)}}buildCustomRequest(e){return{}}_convertParamsToRequest(e){let t={items:e.items.map(e=>{let{id:t,effectType:r,source:i}=e;return{id:t,effect_type:r,source:i}})},r=this.buildCustomRequest(e);return{...t,...r}}_convertResponseToResourcesData(e,t){return{list:t.data.effect_item_list.map(e=>this.parseHeycanResponseDataToResources(e))}}get _batchGetResourcesApi(){return`${n._L.getVar("web_domain")}${d.bl.BATCH_GET_TUCHONG_RESOURCES_BY_ID}`}constructor(e){this._accountService=e}}p=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw])],p)},872443:function(e,t,r){r.d(t,{L:function(){return S}});var i=r(789786),s=r(200247),n=r(405051),o=r(121130),a=r(866006),c=r(768101),u=r(786022),l=r(690613),d=r(114861),_=r(502600),h=r(76552),p=r(801497),g=r(606805),y=r(932606),f=r(9590),v=r(916636),m=r(544688),w=r(744268),k=r(690465),T=r(685795),R=r(847083),b=r(332557);class S{shouldUseRace(){return!1}get _networkClient(){if(!this._networkClientInstance){let e=function(e){let{addBusinessPlugins:t}=e,r=new n.yk().build(n.kk);return t(r,[R.U.Preload]),(0,o.i3)(r),(0,d.V)(r),r}(this._clientPluginService);this._networkClientInstance=this.shouldUseRace()?(0,h.d)(e,this._storageService,this._accountService.uniqueId,this._configurationService.disableRequestCache):(0,h.D)(e,this._storageService,this._accountService.uniqueId,this._configurationService.disableRequestCache)}return this._networkClientInstance}get skipSingleDataParseError(){return!1}setFixedRegion(e){this._fixedRegion=e}get _api(){return this._httpApiSettingService.getRequestURL({domainType:k.Y.DEFAULT,path:_.bl.GET_CATEGORY_BY_PANEL})}async getCategories(e){var t,r,i,s,n,o,u;let d=Date.now(),h=e instanceof a.yt?e.config:e;try{let o=await this._convertParamsToRequest(e),a=this._configurationService.getAppConfigurationValue("RegionheycanDataService.fixed")||this._fixedRegion,c=await this._networkClient.postWithCache(this._api,o,{params:{...(0,g._)(null!==(t=null!=a?a:this._accountService.userProfile.region)&&void 0!==t?t:"",p.ZP.language,h.sdkVersion,h.appID,!!a).params,...this.buildCustomRequestParams()},withCredentials:!0}),u=Number(null!==(r=c.ret)&&void 0!==r?r:0),y=null!==(i=c.errmsg)&&void 0!==i?i:"";try{let e=Object.values(c.data.category_resources||{}).reduce((e,t)=>{var r;return e+((null===(r=t.effect_item_list)||void 0===r?void 0:r.length)||0)},0);null===(n=this._slardarAdapterService)||void 0===n||n.sendEvent("vimo_material_fetch_result",{path:_.bl.GET_CATEGORY_BY_PANEL,ret:String(u),msg:y,panel:this.resourcePanelType,logid:c.logid||"",panelCount:null===(s=c.data.categories)||void 0===s?void 0:s.length,defaultCount:e,duration:Date.now()-d})}catch(e){console.error("_slardarAdapterService error",e)}if(0!==u)return(0,l.wf)(null!=u?u:-1,null!=y?y:"");let f=this._convertResponseToQueryToken(h,c);return(0,l.oW)(f)}catch(t){let e=(0,c.m)(t,-1,`${this.resourcePanelType} getCategories api error: ${null==t?void 0:t.message}`);console.error("GetResourceCategoriesRepository getCategories error",t);try{null===(u=this._slardarAdapterService)||void 0===u||u.sendEvent("vimo_material_fetch_result",{path:_.bl.GET_CATEGORY_BY_PANEL,ret:String(e.code),logid:null===(o=e.cause)||void 0===o?void 0:o.logid,msg:e.msg,panel:this.resourcePanelType,duration:Date.now()-d})}catch(e){console.error("_slardarAdapterService error",e)}return e}}async _convertParamsToRequest(e){var t,r,i,s,n,o,c,l;let d=e instanceof a.yt?e.config:e,_=this.buildCustomRequest(d),h=await this.buildCustomFilterParams(),p={app_id:null!==(o=d.appID)&&void 0!==o?o:u.kJ,panel:d.panel||this.resourcePanelType,get_res_category_count:null===(t=d.polyConfig)||void 0===t?void 0:t.categoryCount,resource_count:null===(r=d.polyConfig)||void 0===r?void 0:r.detailCount,get_resource:(null===(i=d.polyConfig)||void 0===i?void 0:i.getAllResource)||!!(null===(s=d.polyConfig)||void 0===s?void 0:s.detailCount),only_commercial:!!d.onlyCommercial,panel_source:d.panelSource,get_all_resource:null===(n=d.polyConfig)||void 0===n?void 0:n.getAllResource},g=(0,a.ky)(e)?{count:null!==(c=e.config.limit)&&void 0!==c?c:50,offset:null!==(l=e.offset)&&void 0!==l?l:0}:{...this.defaultQueryToken,...e.limit?{count:e.limit}:void 0};return{...h,...p,..._,...g}}_convertResponseListToResourceList(e){return e.map(e=>{let t={...e,panel:this.resourcePanelType};if(!this.skipSingleDataParseError)return this.parseHeycanResponseDataToResources(t);try{return this.parseHeycanResponseDataToResources(t)}catch(e){return console.error(`${this.resourceType} parse error:`,e),null}}).filter(Boolean)}_getCategoryKey(e,t){return e.category_key}_convertResponseToQueryToken(e,t){let{category_resources:r={}}=t.data,i=(t.data.categories||[]).map(e=>({id:String(e.category_id),key:this._getCategoryKey(e,t.data.panel_source),name:e.category_name,starlingKey:e.name_starling_key,panelSource:t.data.panel_source,tags:e.tags})),s=Object.keys(r).map(String).reduce((e,t)=>{let i=r[t];return e[t]={list:this._convertResponseListToResourceList(i.effect_item_list),hasMore:i.has_more,offset:i.next_offset,fail_reason:i.fail_reason},e},{});return(0,a.ib)(e,{list:i,details:s,panelSource:t.data.panel_source})}buildCustomRequest(e){return{}}buildCustomRequestParams(){return{}}get defaultQueryToken(){return{offset:0,count:50}}async _getWhiteUserPermission(){if(!this._accountService.hasLogin)return!1;let[e,t]=(await this._userPermissionDataService.getUserPermission({})).pair();return!e&&!!t.publishWebTemplatePermission||!1}async buildCustomFilterParams(){let e=await this._getWhiteUserPermission();return!this._configurationService.getAppConfigurationValue("vip.disableFilter")&&await (0,y.g)(e,this.resourceType)?{filter_optional:{filter_paid_type:[f.m.Subscribe]}}:{}}constructor(e,t,r,i,s,n,o,a){this._accountService=e,this._effectAbTestService=t,this._userPermissionDataService=r,this._configurationService=i,this._httpApiSettingService=s,this._slardarAdapterService=n,this._storageService=o,this._clientPluginService=a}}S=(0,i.gn)([(0,i.fM)(0,s.D),(0,i.fM)(1,v.c),(0,i.fM)(2,m.c),(0,i.fM)(3,w.Ui),(0,i.fM)(4,k.x),(0,i.fM)(5,T.L),(0,i.fM)(6,b.U),(0,i.fM)(7,R.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.D?Object:s.D,void 0===v.c?Object:v.c,void 0===m.c?Object:m.c,void 0===w.Ui?Object:w.Ui,void 0===k.x?Object:k.x,void 0===T.L?Object:T.L,void 0===b.U?Object:b.U,void 0===R.a?Object:R.a])],S)},606805:function(e,t,r){r.d(t,{_:function(){return o}});var i=r(786022),s=r(502600),n=r(134429);function o(e,t,r,o,a){var c;let{searchParams:u}=new URL(window.location.href),l=u.get("__local_test__")?"local_test":"online",d=null!==(c=u.get("aid"))&&void 0!==c?c:i.kJ;return{params:{aid:null!=o?o:d,version_name:null!=r?r:n.f4,version_code:s.HI,sdk_version:null!=r?r:n.f4,effect_sdk_version:null!=r?r:n.f4,device_platform:s.DP,region:e,language:t,device_type:"web",channel:l,use_region:a?1:void 0},withCredentials:!0}}},305301:function(e,t,r){r.d(t,{Q:function(){return s}});var i=r(249656);let s=(e,t,r)=>({items:e.map(e=>({id:e,effect_type:t,source:r||i.Hw.LOKI}))})},889862:function(e,t,r){r.d(t,{E:function(){return s}});var i=r(981632);function s(e,t){var r,s,n,o,a,c,u,l,d,_,h;let p=(0,i.D)(e.common_attr.extra),g=(0,i.D)((null===(r=e.common_attr.business_info)||void 0===r?void 0:r.json_str)||"{}"),y=Object.values(e.common_attr.model_names?JSON.parse(e.common_attr.model_names):{}).reduce((e,t)=>[...e,...t],[]),f=null===(s=e.common_attr.tag_list)||void 0===s?void 0:s.map(e=>String(e.id));return{key:`${t}_${e.common_attr.id||e.common_attr.md5}`,resourceId:e.common_attr.id,effectId:null===(n=e.common_attr.effect_id)||void 0===n?void 0:n.toString(),effectType:e.common_attr.effect_type,source:e.common_attr.source,publishSource:e.common_attr.publish_source,copyright:e.common_attr.copyright?{from:e.common_attr.copyright.copyright_text,owner:e.common_attr.copyright.artist_name}:void 0,aspectRatio:e.common_attr.aspect_ratio,isBusiness:e.common_attr.is_business,md5:e.common_attr.md5,isVip:null!==(u=null!==(c=p.is_vip)&&void 0!==c?c:g.is_vip)&&void 0!==u&&u,title:e.common_attr.title,description:e.common_attr.description,coverUrl:e.common_attr.cover_url.small,originUrl:null!==(d=null!==(l=null===(o=e.common_attr.item_urls)||void 0===o?void 0:o[0])&&void 0!==l?l:null===(a=e.common_attr.download_info)||void 0===a?void 0:a.url)&&void 0!==d?d:"",isFavorite:e.common_attr.has_favorited,order:e.order_info?{id:e.order_info.id,source:e.order_info.source,url:void 0}:void 0,createTime:e.common_attr.create_time,requirements:e.common_attr.requirements,modelNames:y,isPrefab:null!==(_=p.is_prefab)&&void 0!==_&&_,thirdResourceId:null!==(h=e.common_attr.third_resource_id_str)&&void 0!==h?h:e.common_attr.third_resource_id,tagList:e.common_attr.tag_list,subType:e.common_attr.sub_type,labels:f}}},924901:function(e,t,r){r.d(t,{e:function(){return s}});var i,s=((i={})[i.SENSITIVE_WORDS=200506]="SENSITIVE_WORDS",i[i.NORMAL_ERROR=200505]="NORMAL_ERROR",i)},773943:function(e,t,r){r.d(t,{b:function(){return S}});var i=r(789786),s=r(966697),n=r(702049),o=r(405051),a=r(121130),c=r(866006),u=r(768101),l=r(690613),d=r(114861),_=r(243254),h=r(801497),p=r(744268),g=r(249656),y=r(544688),f=r(916636),v=r(76552),m=r(332557),w=r(454530),k=r(396190),T=r(932606),R=r(847083),b=r(134429);class S{shouldUseRace(){return!1}get _networkClient(){if(!this._networkClientInstance){let e=function(e){let{addBusinessPlugins:t}=e,r=new o.yk().build(o.kk);return t(r,[R.U.Preload]),(0,a.i3)(r),(0,d.V)(r),r}(this._clientPluginService);this._networkClientInstance=this.shouldUseRace()?(0,v.d)(e,this._storageService,this._accountService.uniqueId,this._configurationService.disableRequestCache):(0,v.D)(e,this._storageService,this._accountService.uniqueId,this._configurationService.disableRequestCache)}return this._networkClientInstance}async _getWhiteUserPermission(){if(!this._accountService.hasLogin)return!1;let[e,t]=(await this._userPermissionDataService.getUserPermission({})).pair();return!e&&!!t.publishWebTemplatePermission||!1}async getResources(e){let t=e instanceof c.yt?e.config:e;try{let r=this.convertGetResourcesByCategoryToRequest(e),i=await this._doGetResources(r);if(!i.ok)return i;let s=this._convertGetResourcesByCategoryToQueryToken(t,i.value),n=await this.filterResources(s);return(0,l.oW)(n)}catch(e){return(0,u.m)(e,-1,"getResourcesByCategory api error")}}async filterResources(e){let{disableFilterVipResource:t}=e.config;if(!t){let t=await this._getWhiteUserPermission();!this._configurationService.getAppConfigurationValue("vip.disableFilter")&&await (0,T.g)(t,this.resourceType)&&(e.value.list=e.value.list.filter(e=>!e.isVip))}return e}async _doGetResources(e){var t,r;let i=await this._networkClient.postWithCache(this._api,e,{withCredentials:!0}),s=null===(t=i.BaseResp)||void 0===t?void 0:t.StatusCode,n=null===(r=i.BaseResp)||void 0===r?void 0:r.StatusMessage;return 0!==s?(0,l.wf)(null!=s?s:-1,null!=n?n:"do getResources error"):(0,l.oW)(i)}convertGetResourcesByCategoryToRequest(e){var t,r,i,s;let n=e instanceof c.yt?e.config:e,o=null===(t=this._configurationService.abTestManager)||void 0===t?void 0:t.getBooleanAbTestValue(w.o.NewTransitionEffectEnabled),a=this._environmentService.isAutoTest||o?g.Nb.New:g.Nb.Old,u={panel:n.panel||this._configurationService.resourcePanel[this.resourceType],appVersion:this._environmentService.appVersion,sdkVersion:null!==(r=n.sdkVersion)&&void 0!==r?r:b.f4,lang:h.ZP.language,category:null!==(i=n.category)&&void 0!==i?i:"all",hasCategoryEffects:!1,cc_web_version:a},l=this.buildCustomRequest(n),{limit:d,offset:_}=(0,c.ky)(e)?{...e.config.limit?{limit:e.config.limit}:void 0,offset:null!==(s=e.offset)&&void 0!==s?s:0}:{...this.defaultQueryToken,...e.limit?{limit:e.limit}:void 0};return{...u,...l,...d?{limit:d}:void 0,offset:_,sortingPosition:_}}get defaultQueryToken(){return{offset:0}}buildCustomRequest(e){return{}}get _api(){return`${n._L.getVar("web_domain")}${_.bl.GET_RESOURCES_BY_CATEGORY}`}_convertGetResourcesByCategoryToQueryToken(e,t){var r;let i=this.parseEffectsToResources(t.data.CategoryEffects.Effects,null===(r=t.data.UrlPrefix)||void 0===r?void 0:r[0]),{HasMore:s,SortingPosition:n}=t.data.CategoryEffects;return(0,c.ib)(e,{list:i},{hasMore:s,offset:n})}constructor(e,t,r,i,s,n,o){this._accountService=e,this._configurationService=t,this._storageService=r,this._effectAbTestService=i,this._environmentService=s,this._userPermissionDataService=n,this._clientPluginService=o}}S=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.fM)(1,p.Ui),(0,i.fM)(2,m.U),(0,i.fM)(3,f.c),(0,i.fM)(4,k.Y),(0,i.fM)(5,y.c),(0,i.fM)(6,R.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw,void 0===p.Ui?Object:p.Ui,void 0===m.U?Object:m.U,void 0===f.c?Object:f.c,void 0===k.Y?Object:k.Y,void 0===y.c?Object:y.c,void 0===R.a?Object:R.a])],S)},952269:function(e,t,r){r.d(t,{F:function(){return i}});function i(e){return{id:e.Id.toString(),key:e.Key,name:e.Name,tags:e.Tags}}},623935:function(e,t,r){r.d(t,{sh:function(){return n}});var i=r(981632),s=r(127830);function n(e,t,r){var n,o,a,c,u,l,d;let _=(0,i.D)(t.Extra),h=(0,i.D)(t.SdkExtra),p=(0,i.D)(null!==(n=t.ContentFile)&&void 0!==n?n:"");let g=(u=r,l=t,null!=u?u:`${function(e){if(!e)return"";let t=e.split("/");return t.pop(),t.join("/")}(null===(d=l.FileUrl.UrlList)||void 0===d?void 0:d[0])}/`),y=function(e,t){var r,i,s,n,o;let a=null!==(o=null!==(n=null!==(s=null!==(i=null!==(r=t.web_icon)&&void 0!==r?r:t.hover_icon)&&void 0!==i?i:t.preview_cover)&&void 0!==s?s:t.track_thumbnail)&&void 0!==n?n:t.canvas_cover)&&void 0!==o?o:"";return a?`${e}${a}`:""}(g,_),f=(t.Labels?(0,i.D)(t.Labels):[]).map(e=>String(e.id)),v=Object.values(t.ModelNames?JSON.parse(t.ModelNames):{}).reduce((e,t)=>[...e,...t],[]);return{common:{key:function(e,t){let{ResourceId:r,EffectId:i}=t;if(e===s._g.TextGlow)return`${e}_${r.toString()}_${r.toString()}`;return`${e}_${r.toString()}_${i.toString()}`}(e,t),resourceId:t.ResourceId.toString(),effectId:t.EffectId.toString(),name:t.Name,isBusiness:null!==(o=_.is_business)&&void 0!==o&&o,md5:t.FileUrl.Uri,isVip:null!==(a=_.is_vip)&&void 0!==a&&a,package:{uri:t.FileUrl.Uri,urlList:t.FileUrl.UrlList},icon:{uri:t.IconUrl.Uri,urlList:t.IconUrl.UrlList},sdkVersion:t.SdkVersion,requirements:t.Requirements,modelNames:v,previewUrl:y||t.IconUrl.UrlList[0],source:t.Source,panel:t.Panel,isPrefab:null!==(c=_.is_prefab)&&void 0!==c&&c,labels:f},extra:_,sdkExtra:h,urlPrefix:g,contentFile:p}}},415266:function(e,t,r){r.d(t,{c:function(){return s}});var i=r(702049);let s={get domain(){return i._L.getVar("web_domain")},baseURL:"/lv/v1",urlMap:{GET_COLLECTIONS:"/music/get_collections",GET_MUSIC_EFFECT_COLLECTIONS:"/music/get_music_effect_collections",GET_COLLECTION_SONGS:"/music/get_collection_songs",SEARCH_SONGS:"/music/search/songs",MULTI_GET_SONGS:"/music/multi_get_songs",GET_MY_DOUYIN_SONGS:"/get_tiktok_songs",TEXT_TO_AUDIO:"/text_to_audio",RENDER_TASK_CREATE:"/render_task/create",CAPTION_SUBMIT:"/caption/submit",CAPTION_QUERY:"/caption/query",CAPTION_SUBMIT_TRANSCRIBE:"/caption/sami/submit",CAPTION_QUERY_TRANSCRIBE:"/caption/sami/query",SUBTITLE_TRANSLATE:"/language/translate",RECENT_TRANSLATE_LAN_LIST:"/language/list_recent_translate",DETECT_LANGUAGE:"/language/detect",CREATE_INTELLIGENT_TASK:"/intelligence/create",GET_INTELLIGENT_TASK:"/intelligence/query",CREATE_MATTING_TASK:"/keying/create_task",CREATE_REVERSE_TASK:"/reverse/create_task",GET_REVERSE_TASK:"/reverse/get_task",GET_MATTING_TASK:"/keying/get_task",TRANSFER_MATTING_TASK:"/ever_photo/sync_asset",GET_TRANSFER_MATTING_TASK:"/ever_photo/get_sync_state",GET_PACKAGE_INFO:"/draft/get_package_info",SAVE_DRAFT:"/editor/video_draft/save",VOICE_RECOGNITION:"/intelligence/man_voice_recognition",GET_DRAFT_FRAME_INFO:"/draft/frame_info",RENDER_DRAFT_FRAME_INFO:"/draft/frame_info/render",CCWEB_FEED:"/ccweb/feed",GET_USER_PERMISSION:"/user/web/user_permissions",MUSIC_BEAT:"/music/music_beat",MUSIC_BEAT_AGREE:"/music/check_agree_info",UPDATE_USER_AGREEMENT:"/user/update",GET_MATERIAL_LIST:"/asset/list",GET_ASSETS_BY_ASSET_IDS:"/asset/detail",DELETE_MATERIALS:"/asset/delete",COPY_MATERIAL:"/asset/copy",SYNC_UPLOAD_INFO:"/asset/sync_upload_info",QUERY_PROCESS:"/asset/query_process",EVENT_REPORT:"/event/report",GET_SAMI_TOKEN:"/common/tts/token",GET_USER_INFO:"/user/web/user_info",GET_TEXT_TO_VIDEO_DRAFT:"/draft/text_to_video",CREATE_TEXT_TO_VIDEO_DRAFT:"/draft/text_to_video/create",GET_EFFECT_AB_PARAM:"/effect/get_ab_param",GET_EFFECT_SETTINGS:"/service/settings/v3/",COMMIT_USERCHANGE:"/editor/video_draft/delta_update",QUERY_VC_TASK:"/intelligence/query",CREATE_VC_TASK:"/intelligence/create",COMMIT_ACTION:"/draft/commit_action"},webmssdk:!0}},884192:function(e,t,r){r.d(t,{b:function(){return w}});var i=r(789786),s=r(249656),n=r(702049),o=r(405051),a=r(768101),c=r(141314),u=r(402655),l=r(690613),d=r(114861),_=r(415266),h=r(629351),p=r(744268),g=r(454530),y=r(396190),f=r(134429),v=r(690465);let m="/lv/v1/draft/get_package_info";class w extends u.JT{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(e){let t=new o.yk().build(o.kk);return(0,d.V)(t),(0,h.V)(t,{appVersion:e.appVersion}),t}({appVersion:this._environmentService.appVersion})),this._networkClientInstance}async getPackageInfo(e,t){let{packageKey:r,spaceId:i,workspaceId:o,lang:c,fromEmail:u,password:d,captcha:_}=t,h=this._configurationService.abTestManager.getBooleanAbTestValue(g.o.NewTransitionEffectEnabled),p=this._environmentService.isAutoTest||h?s.Nb.New:s.Nb.Old;try{var y,v,m;let t=await this._networkClient.post(this._api,{lang:c,package_key:r,space_id:i,workspace_id:o,region:n._L.getVar("country_code"),app_version:this._environmentService.appVersion,sdk_version:f.f4,cc_web_version:p,from_email:u,password:d,captcha_fp:_},{withCredentials:!0,ctx:e});if(console.log("[startup] package info response",t),(null==t?void 0:null===(y=t.data)||void 0===y?void 0:y.ret)!=="0")return(0,l.wf)(1,null==t?void 0:null===(v=t.data)||void 0===v?void 0:v.ret,null==t?void 0:null===(m=t.data)||void 0===m?void 0:m.errmsg);return(0,l.oW)(t.data)}catch(e){return(0,a.m)(e,-1,"getPackageInfo api error")}}async getPackageInfoFromJsonp(){if(!document.getElementById("GTW_DRAFT_JSONP")&&!document.getElementById("draft-detail-jsonp"))return(0,l.wf)(-2,"packageInfoJsonp not injected");try{await window.pPackageInfo}catch(e){return(0,a.m)(e,-1,"getPackageInfoJsonp api error")}let e=window.__get_package_info__||window.__package_info;return e?"0"===e.ret?(0,l.oW)(e):(0,l.wf)(1,null==e?void 0:e.ret):(0,l.wf)(-1,"getPackageInfoJsonp api error")}get _api(){return this._httpApiSettingService.getRequestURL({domainType:v.Y.DEFAULT,path:m})}constructor(e,t,r){super(),this._configurationService=e,this._environmentService=t,this._httpApiSettingService=r,this._urlGenerator=new c.w(_.c)}}w=(0,i.gn)([(0,i.fM)(0,p.Ui),(0,i.fM)(1,y.Y),(0,i.fM)(2,v.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.Ui?Object:p.Ui,void 0===y.Y?Object:y.Y,void 0===v.x?Object:v.x])],w)},251266:function(e,t,r){r.d(t,{Tv:function(){return a},Xp:function(){return o},gt:function(){return c}});var i,s,n=r(335290);var o=((i={})[i.doing=0]="doing",i[i.success=1]="success",i[i.fail=-1]="fail",i);var a=((s={})[s.video=0]="video",s[s.image=1]="image",s[s.audio=2]="audio",s);let c=(0,n.yh)("text-to-video")},377680:function(e,t,r){r.d(t,{I:function(){return i}});let i=(0,r(335290).yh)("user-info")},323550:function(e,t,r){r.d(t,{b:function(){return i}});let i={GET_USER_PERMISSION:"/lv/v1/user/web/user_permissions"}},604571:function(e,t,r){r.d(t,{c:function(){return c}});var i=r(789786),s=r(55449),n=r(402655),o=r(123567),a=r(462589);class c extends n.JT{getUserPermission(e){return this._userPermissionRepository.getUserPermission(e)}constructor(e){super(),this._instantiationService=e,this._userPermissionRepository=this._instantiationService.createInstance(o.n)}}(0,i.gn)([(0,a.o)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IGetUserPermissionParams?Object:IGetUserPermissionParams]),(0,i.w6)("design:returntype","undefined"==typeof Promise?Object:Promise)],c.prototype,"getUserPermission",null),c=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],c)},234207:function(e,t,r){function i(e){let{publish_web_template:t,business_template_publish:r}=e;return{publishWebTemplatePermission:t,publishBusinessTemplatePermission:r}}function s(e){return i(e.data.permission_map)}r.d(t,{P:function(){return s},n:function(){return i}})},283452:function(e,t,r){r.d(t,{g:()=>w});var i=r("789786"),s=r("55449"),n=r("525569"),o=r("450495"),a=r("846562"),c=r("740446"),u=r("803894");class l extends c.i{parseResponseDataToResources(e){return(0,u.J)(e)}}var d=r("690613"),_=r("800788"),h=r("64886"),p=r("127830"),g=r("702049"),y=r("768101"),f=r("995706"),v=r("565520");class m{async createBrandResource(e){try{let t=await this._networkClient.post(this._createBrandResourceUrl,this._convertCreateParamsToRequest(e),{params:{},withCredentials:!0});return(0,d.oW)({id:t.data.id})}catch(e){return(0,y.m)(e)}}async updateBrandResource(e){try{let t=await this._networkClient.post(this._updateBrandResourceUrl,this._convertUpdateParamsToRequest(e),{withCredentials:!0});if(t.data.id!==e.id)throw Error(t);return(0,d.ly)()}catch(e){return(0,y.m)(e)}}async deleteBrandResource(e){try{return await this._networkClient.post(this._deleteBrandResourceUrl,this._convertDeleteParamsToRequest(e),{withCredentials:!0}),(0,d.ly)()}catch(e){return(0,y.m)(e)}}_convertCreateParamsToRequest(e){let{resourceType:t,workspaceId:r,data:i}=e;return{workspace_id:r,resource_type:`${this._convertSourceType2BrandSourceType(t)}`,data:JSON.stringify(this._convertCreateBrandOriginModel(i))}}_convertSourceType2BrandSourceType(e){switch(e){case p._g.AdjustmentPreset:return v.Q.AdjustmentPreset;case p._g.TextTemplate:return v.Q.TextTemplatePreset;case p._g.TextPreset:return v.Q.TextPreset;case p._g.Video:return v.Q.Video;case p._g.Photo:return v.Q.Logo;case p._g.BrandColor:return v.Q.Color;default:(0,_.bP)(e)}}_convertCreateBrandOriginModel(e){return{common_data:(e=>{let{icon:t,file:r,...i}=e,{imageUri:s,width:n,height:o,...a}=null!=t?t:{},{fileUri:c,size:u,...l}=null!=r?r:{};return{...i,icon:t?{...a,width:n?`${n}`:void 0,height:o?`${o}`:void 0,image_uri:s}:void 0,file:r?{...l,size:u?`${u}`:void 0,file_uri:c}:void 0}})(e.commonData)}}_convertUpdateParamsToRequest(e){let{id:t,title:r,color:i}=e;return{workspace_id:e.workspaceId,id:t,title:r,color:i}}_convertDeleteParamsToRequest(e){let{id:t}=e;return{workspace_id:e.workspaceId,id:t}}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=(0,h.G)()),this._networkClientInstance}get _createBrandResourceUrl(){return`${g._L.getVar("web_domain")}${f.l.createBrandResource}`}get _updateBrandResourceUrl(){return`${g._L.getVar("web_domain")}${f.l.updateBrandResource}`}get _deleteBrandResourceUrl(){return`${g._L.getVar("web_domain")}${f.l.deleteBrandResource}`}}class w{getMultiBrandResourcesByResourceTypes(e){return this._getMultiBrandResourcesRepository.getMultiBrandResources(e)}getBrandColors(e){return this._getBrandColorsRepository.getResources(e)}getBrandAdjustmentPresets(e){return this._getBrandAdjustmentPresetsRepository.getResources(e)}getBrandAdjustmentPresetsByIds(e){return this._getBrandAdjustmentPresetsByIdsRepository.getResourcesByIds(e)}createBrandResource(e){return this._operateBrandResourceRepository.createBrandResource(e)}updateBrandResource(e){return this._operateBrandResourceRepository.updateBrandResource(e)}deleteBrandResource(e){return this._operateBrandResourceRepository.deleteBrandResource(e)}constructor(e){this._instantiationService=e,this._getMultiBrandResourcesRepository=this._instantiationService.createInstance(n.Z),this._getBrandColorsRepository=this._instantiationService.createInstance(o.z),this._getBrandAdjustmentPresetsRepository=this._instantiationService.createInstance(a.$),this._getBrandAdjustmentPresetsByIdsRepository=this._instantiationService.createInstance(l),this._operateBrandResourceRepository=this._instantiationService.createInstance(m)}}w=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],w)},995706:function(e,t,r){r.d(t,{_:function(){return s},l:function(){return i}});let i={getBrandResourcesByResourceTypes:"/cc/v1/workspace/web/get_brand_list",getAllBrandResources:"/cc/v1/workspace/get_all_brand_list",createBrandResource:"/cc/v1/workspace/upload_brand_resource",updateBrandResource:"/cc/v1/workspace/update_brand_resource",deleteBrandResource:"/cc/v1/workspace/delete_brand_resource"},s="99.99.99"},565520:function(e,t,r){r.d(t,{Q:function(){return s}});var i,s=((i={})[i.Logo=1]="Logo",i[i.Sticker=2]="Sticker",i[i.Background=3]="Background",i[i.Video=4]="Video",i[i.Audio=5]="Audio",i[i.Font=6]="Font",i[i.Color=7]="Color",i[i.TextPreset=8]="TextPreset",i[i.AdjustmentPreset=9]="AdjustmentPreset",i[i.TextTemplatePreset=10]="TextTemplatePreset",i[i.TextGlow=11]="TextGlow",i)},740446:function(e,t,r){r.d(t,{i:function(){return u}});var i=r(702049),s=r(995706),n=r(64886),o=r(690613),a=r(768101),c=r(134429);class u{async getResourcesByIds(e){try{let t=await this._networkClient.post(this._url,this._convertParamsToRequest(e),{withCredentials:!0}),r=this._convertResponseToResourcesData(t);return(0,o.oW)(r)}catch(e){return(0,a.m)(e)}}_convertParamsToRequest(e){return{id_list:e.ids,effect_sdk_version:s._,pack_optional:{NeedThumb:!0},need_depend_resource:!0,need_sub_item:!0,need_vip_tag:!0,app_version:c.$U}}_convertResponseToResourcesData(e){return{list:e.data.resource_info_list.map(e=>this.parseResponseDataToResources(e))}}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=(0,n.G)()),this._networkClientInstance}get _url(){return`${i._L.getVar("web_domain")}${s.l.getBrandResourcesByResourceTypes}`}}},393958:function(e,t,r){r.d(t,{h:function(){return l}});var i=r(702049),s=r(866006),n=r(995706),o=r(64886),a=r(690613),c=r(768101),u=r(134429);class l{async getResources(e){try{let t=await this._networkClient.post(this._url,this._convertParamsToRequest(e),{withCredentials:!0}),r=e instanceof s.yt?e.config:e,i=this._convertResponseToQueryToken(r,t);return(0,a.oW)(i)}catch(e){return(0,c.m)(e)}}get defaultQueryToken(){return{cursor:"",count:50}}_convertParamsToRequest(e){var t;let r=e instanceof s.yt?e.config:e,i=e instanceof s.yt?{count:null!==(t=e.config.limit)&&void 0!==t?t:50,cursor:e.offset}:{...this.defaultQueryToken};return{workspace_id:r.workspaceId,cursor_map:i.cursor?{[this.brandResourceType]:i.cursor}:void 0,count:i.count,resource_type_list:[String(this.brandResourceType)],effect_sdk_version:n._,app_version:u.$U,need_depend_resource:!0,need_sub_item:!0,need_vip_tag:!0}}_convertResponseToQueryToken(e,t){var r,i,n,o;let a=t.data.resource_info_list.map(e=>this.parseResponseDataToResources(e)),c=null!==(n=null!==(i=t.data.nextcursor_map[this.brandResourceType])&&void 0!==i?i:null===(r=t.data.resource_info_list[t.data.resource_info_list.length-1])||void 0===r?void 0:r.common_attr.id)&&void 0!==n?n:"",u=null!==(o=t.data.hasmore_map[this.brandResourceType])&&void 0!==o&&o;return(0,s.ib)(e,{list:a},{hasMore:u,offset:c})}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=(0,o.G)()),this._networkClientInstance}get _url(){return`${i._L.getVar("web_domain")}${n.l.getBrandResourcesByResourceTypes}`}}},826843:function(e,t,r){r.d(t,{d:function(){return o}});var i=r(127830),s=r(565520),n=r(800788);function o(e){switch(e){case s.Q.Logo:return i._g.Photo;case s.Q.Video:return i._g.Video;case s.Q.AdjustmentPreset:return i._g.AdjustmentPreset;case s.Q.Audio:return i._g.Audio;case s.Q.Background:return i._g.VideoBackground;case s.Q.Color:return i._g.BrandColor;case s.Q.Font:return i._g.Font;case s.Q.Sticker:return i._g.Sticker;case s.Q.TextPreset:return i._g.TextPreset;case s.Q.TextTemplatePreset:return i._g.TextTemplate;case s.Q.TextGlow:return i._g.TextGlow;default:(0,n.bP)(e)}}},64886:function(e,t,r){r.d(t,{G:function(){return a}});var i=r(629351),s=r(405051),n=r(121130),o=r(114861);function a(){let e=new s.yk().build(s.kk);return(0,n.i3)(e),(0,o.V)(e),(0,i.V)(e,{appVersion:""}),e}},643625:function(e,t,r){r.d(t,{V:function(){return i}});let i=(0,r(335290).yh)("bubble-data-service")},74677:function(e,t,r){r.d(t,{S:()=>S});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("89927");class u extends a.r{get resourceType(){return o._g.Bubble}parseEffectsToResources(e){return e.map(e=>(0,c.o)(e))}}var l=r("512363");class d extends l.L{get resourceType(){return o._g.Bubble}}var _=r("773943");class h extends _.b{buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return o._g.Bubble}parseEffectsToResources(e,t){return e.map(e=>(0,c.o)(e,t))}}var p=r("744268"),g=r("736031"),y=r("249656"),f=r("305301"),v=r("512859"),m=r("758027"),w=r("33883"),k=r("581797");class T extends m.B{get resourceType(){return o._g.Bubble}get resourcePanelType(){return w.q.Bubble}parseHeycanResponseDataToResources(e){return(0,k.E)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource||"heycan",category_id:Number(e.category),pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}var R=r("872443");class b extends R.L{get resourceType(){return o._g.Bubble}get resourcePanelType(){return w.q.Bubble}parseHeycanResponseDataToResources(e){return(0,k.E)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}class S extends n.JT{async getBubble(e){return await (0,g._Q)(this._configurationService,this._getHeycanBubbleByCategoryRepository.resourcePanelType,g.$0)?this._getHeycanBubbleByCategoryRepository.getResources(e):this._bubbleRepository.getResources(e)}async batchGetBubblesByIds(e){if(e.source===y.Hw.LOKI)return this._batchGetBubbleRepository.batchGetResources(e);{let t=await (0,g.bY)(this._configurationService,g.$0);return"loki"===(0,g.lo)(t,this._batchGetHeycanBubbleRepository.resourcePanelType).panel_path&&e.source!==y.Hw.HEYCAN?this._batchGetBubbleRepository.batchGetResources(e):this._batchGetHeycanBubbleRepository.batchGetResources((0,f.Q)(e.ids,this._batchGetHeycanBubbleRepository.resourceType,e.source))}}async getBubbleCategories(e){let t=await (0,g.bY)(this._configurationService,g.$0);return"vimo"===(0,g.lo)(t,this._getHeycanBubbleCategoriesRepository.resourcePanelType).panel_path?this._getHeycanBubbleCategoriesRepository.getCategories((0,g.lY)(e,t)):this._getBubbleCategoriesRepository.getCategories(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._bubbleRepository=this._instantiationService.createInstance(h),this._batchGetBubbleRepository=this._instantiationService.createInstance(u),this._getBubbleCategoriesRepository=this._instantiationService.createInstance(d),this._getHeycanBubbleByCategoryRepository=this._instantiationService.createInstance(T),this._getHeycanBubbleCategoriesRepository=this._instantiationService.createInstance(b),this._batchGetHeycanBubbleRepository=this._instantiationService.createInstance(v.w)}}S=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,p.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===p.Ui?Object:p.Ui])],S)},89927:function(e,t,r){r.d(t,{o:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r}=(0,i.sh)(s._g.Bubble,e,t);return{...r}}},14716:function(e,t,r){r.d(t,{e:function(){return i}});let i=(0,r(335290).yh)("generate-tts-data-service")},618439:function(e,t,r){r.d(t,{j:function(){return a}});var i=r(789786),s=r(55449),n=r(402655),o=r(137681);class a extends n.JT{getGenerateTts(e){return this._generateTtsRepository.getGenerateTts(e)}constructor(e){super(),this._instantiationService=e,this._generateTtsRepository=this._instantiationService.createInstance(o.D)}}a=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],a)},404929:function(e,t,r){r.d(t,{i:function(){return s}});var i,s=((i={})[i.TTAM=1]="TTAM",i[i.SAMI=2]="SAMI",i[i.ELEVENLABS=3]="ELEVENLABS",i[i.VIMO=6]="VIMO",i[i.ECOM_INTERNAL=100]="ECOM_INTERNAL",i)},565018:function(e,t,r){r.d(t,{Q:()=>T});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("702049"),u=r("405051"),l=r("121130"),d=r("894339"),_=r("905180"),h=r("768101"),p=r("786022");let g="/lv/v1/caption/submit",y="/lv/v1/caption/query";var f=r("966697");class v{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.i3)(e),(0,d.mH)(e),(0,a.V)(e),(0,_.Y)(e),e}()),this._networkClientInstance}get _api(){return`${c._L.getVar("web_domain")}${g}`}async createCaption(e,t){try{let i=await this._networkClient.post(this._api,this._formatCreateParams(e),{withCredentials:!0,params:t});if("0"!==i.ret){var r;return(0,o.wf)(Number(i.ret),null!==(r=i.errmsg)&&void 0!==r?r:"")}return(0,o.ly)()}catch(e){return(0,h.m)(e,-1,"createCaption api error")}}_formatCreateParams(e){return{app_id:p.kJ,region:this._accountService.userProfile.region,resources:e.resources.map(e=>({workspace_id:e.workspaceId,resource_id:e.resourceId,url_from_type:e.urlFromType,language:e.language,caption_type:e.captionType,file_type:e.fileType,words_per_line:e.wordsPerLine,audio_text:e.audioText,caption_category:e.captionCategory,asset_workspace_id:e.assetWorkspaceId})),reserve_sil:e.reserveSil}}constructor(e){this._accountService=e}}v=(0,i.gn)([(0,i.fM)(0,f.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===f.Gw?Object:f.Gw])],v);let m=e=>({status:e.data.status,list:e.data.caption.map(e=>({resourceId:e.resource_id,utterances:e.utterances.map(e=>({text:e.text,startTime:e.start_time,endTime:e.end_time,attribute:e.attribute,words:e.words.map(e=>({text:e.text,startTime:e.start_time,endTime:e.end_time,attribute:e.attribute}))}))}))});class w{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.i3)(e),(0,d.mH)(e),(0,a.V)(e),(0,_.Y)(e),e}()),this._networkClientInstance}get _api(){return`${c._L.getVar("web_domain")}${y}`}async getCaption(e,t){try{let i=await this._networkClient.post(this._api,this._formatGetParams(e),{params:t});if(2===i.data.status){var r;return(0,o.wf)(Number(i.ret),null!==(r=i.errmsg)&&void 0!==r?r:"")}return(0,o.oW)(m(i))}catch(e){return(0,h.m)(e,-1,"getCaption api error")}}_formatGetParams(e){return{app_id:p.kJ,region:this._accountService.userProfile.region,reserve_sil:e.reserveSil,resources:e.resources.map(e=>({workspace_id:e.workspaceId,resource_id:e.resourceId,url_from_type:e.urlFromType,language:e.language,caption_type:e.captionType,file_type:e.fileType,words_per_line:e.wordsPerLine,audio_text:e.audioText,caption_category:e.captionCategory}))}}constructor(e){this._accountService=e}}w=(0,i.gn)([(0,i.fM)(0,f.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===f.Gw?Object:f.Gw])],w);var k=r("966818");class T extends n.JT{async createCaptionTask(e,t){let r=await this._createCaptionRepository.createCaption(e,t);return r.ok?(0,o.oW)(new k.u(this._getCaptionRepository,e,t)):r}getCaptions(e,t){return this._getCaptionRepository.getCaption(e,t)}constructor(e){super(),this._instantiationService=e,this._createCaptionRepository=this._instantiationService.createInstance(v),this._getCaptionRepository=this._instantiationService.createInstance(w)}}T=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],T)},390701:function(e,t,r){r.d(t,{j:function(){return i}});let i=(0,r(335290).yh)("clone-voice-data-service")},101554:function(e,t,r){r.d(t,{P7:function(){return o},bl:function(){return n}});var i=r(92690),s=r(547997);let n=i.b,o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ccweb";"ccweb"===e&&(n=i.b),"commerce"===e&&(n=s.b)}},316733:function(e,t,r){r.d(t,{q:function(){return c}});var i=r(789786),s=r(273340),n=r(106937),o=r(966697),a=r(858362);class c extends n.n{get resourceType(){return s.g.CloneVoice}parseHeycanResponseDataToResources(e){return(0,a.cY)(e)}constructor(e){super(e),this._capcutAccountService=e}}c=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw])],c)},967026:function(e,t,r){r.d(t,{k:()=>m});var i=r("789786"),s=r("690613"),n=r("114861"),o=r("966697"),a=r("702049"),c=r("405051"),u=r("121130"),l=r("866006"),d=r("768101"),_=r("502600"),h=r("606805"),p=r("801497"),g=r("772270");class y{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build(c.kk);return(0,u.i3)(e),(0,n.V)(e),e}()),this._networkClientInstance}async getHomepageEffects(e){try{var t;let r=e instanceof l.yt?e.config:e,i=await this._networkClient.post(this._getApi(_.bl.GET_HOMEPAGE_EFFECT_LIST),this._convertParamsToPequest(e),(0,h._)(this._accountService.userProfile.region,p.ZP.language,void 0,null!==(t=r.appId)&&void 0!==t?t:g.AF)),{ret:n,errmsg:o}=i,a=Number(null!=n?n:0);if(0!==a)return(0,s.wf)(a,o);return(0,s.oW)(this._convertResponseToQueryToken(r,i))}catch(e){return(0,d.m)(e,-1,`[${this.resourceType}] getHomepageEffects error`)}}buildCustomRequest(){return{}}get defaultQueryToken(){return{cursor:"0",count:50}}_getApi(e){return`${a._L.getVar("web_domain")}${e}`}_convertParamsToPequest(e){var t,r;let i=this.buildCustomRequest(),s=(0,l.ky)(e)?{app_id:e.config.appId,count:null!==(t=e.config.limit)&&void 0!==t?t:50,cursor:String(null!==(r=e.offset)&&void 0!==r?r:0)}:{app_id:e.appId,...this.defaultQueryToken,...e.limit?{count:e.limit}:void 0,...e.offset?{cursor:e.offset}:void 0};return{uid:this._accountService.userProfile.uid,effect_type:this.resourceType,...i,...s}}_convertResponseToQueryToken(e,t){let r=t.data.effect_item_list.map(e=>this.parseHeycanResponseDataToResources(e)),i=Number(t.data.next_cursor),s=t.data.has_more;return(0,l.ib)(e,{list:r},{hasMore:s,offset:i})}constructor(e){this._accountService=e}}y=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw])],y);var f=r("858362"),v=r("273340");class m extends y{get resourceType(){return v.g.CloneVoice}parseHeycanResponseDataToResources(e){return(0,f.cY)(e)}constructor(e){super(e),this._accountService=e}}m=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw])],m)},574777:function(e,t,r){r.d(t,{p:function(){return a}});var i=r(789786),s=r(44859),n=r(966697),o=r(273340);class a extends s.F{get resourceType(){return o.g.CloneVoice}buildCustomRequest(e){return{clone_timbre:{speaker_id:e.speakerId}}}constructor(e){super(e),this._accountService=e}}a=(0,i.gn)([(0,i.fM)(0,n.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.Gw?Object:n.Gw])],a)},858362:function(e,t,r){r.d(t,{DC:function(){return o},cY:function(){return c},pA:function(){return n},yU:function(){return a}});var i=r(889862),s=r(127830);function n(e){let{frequency_pass:t,user_voice_num:r}=e.data;return{frequencyPass:t,userVoiceNumPass:r.user_voice_num_pass,voiceNum:r.voice_num}}function o(e){let{end_time:t,start_time:r,nodes:i,status:s}=e.data,n="",o=null,a=-1,c="";if(Array.isArray(i)){let e=i.find(e=>"voice_clone"===e.key);if(e){let{code:t,message:r,resp_json:i}=e,{speaker_id:s,test_speak_binary_data:u}=null!=i?i:{};n=s,o=function(e){var t;let r=null===(t=window)||void 0===t?void 0:t.atob(e),i=[];for(let e=0;e<r.length;e+=512){let t=r.slice(e,e+512),s=Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);let n=new Uint8Array(s);i.push(n)}return new Blob(i,{type:"audio/mp3"})}(u),a=t,c=r}}return{endTimestamp:t,startTimestamp:r,status:s,errCode:a,errMsg:c,speakerId:n,trimeAudioBlob:o}}function a(e){let{speak_text:t,test_text:r}=e.data;return{speakingText:t,trimeAudioTexts:r}}function c(e){let t=(0,i.E)(e,s._g.UserCloneVoice),{clone_timbre:r,author:n}=e;return{...t,speakerId:r.speaker_id,author:n?{name:n.name,avatarUrl:n.avatar_url,source:n.source,uid:n.uid,certificationDescription:n.certification_description,creatorType:n.creator_type,certifiedType:n.certified_type}:void 0}}},322141:function(e,t,r){r.d(t,{m:()=>f});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("702049"),u=r("405051"),l=r("121130"),d=r("894339"),_=r("768101");let h="/lv/v1/coordination/package/get_share_info",p="/cc/v1/workspace/get_file_room_user",g="/lv/v1/coordination/package/copy";class y{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.i3)(e),(0,d.mH)(e),(0,a.V)(e),e}()),this._networkClientInstance}get _copyPackageApi(){return`${c._L.getVar("web_domain")}${g}`}get _shareInfoApi(){return`${c._L.getVar("web_domain")}${h}`}get _fileRoomUser(){return`${c._L.getVar("web_domain")}${p}`}get isShareOpen(){return this._isShareOpen}async copyPackage(e){try{let r=await this._networkClient.post(this._copyPackageApi,function(e){let t={package_key:e.packageKey,new_package_key:e.newPackageKey,from_workspace_id:e.fromWorkspaceId,to_workspace_id:e.toWorkspaceId,resource_type:e.resourceType};return e.meta&&(t.meta=e.meta),t}(e));if("0"!==r.ret){var t;return(0,o.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}let i={processId:r.data.process_id};return(0,o.oW)(i)}catch(e){return(0,_.m)(e,-1,"copyPackage api error")}}async getShareInfo(e){try{var t,r;let i=await this._networkClient.post(this._shareInfoApi,{package_key:e.packageKey,workspace_id:e.workspaceId});if("0"!==i.ret){;return(0,o.wf)(Number(i.ret),null!==(t=i.errmsg)&&void 0!==t?t:"")}let s={reviewStatus:(r=i).data.review_status,fileShareStatus:r.data.file_share_status,accessType:r.data.access_type};return this._isShareOpen=s.fileShareStatus,(0,o.oW)(s)}catch(e){return(0,o.Mx)(-1,"getShareInfo api error",e)}}async getFileRoomUser(e){try{let r=await this._networkClient.post(this._fileRoomUser,{file_id:e.fileId,workspace_id:e.workspaceId});if("0"!==r.ret){var t;return(0,o.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,o.oW)(function(e){let{data:t}=e,{member_list:r,count:i,show_max:s}=t;return{memberList:r,count:i,showMax:s}}(r))}catch(e){return(0,o.Mx)(-1,"getShareInfo api error",e)}}constructor(){this._isShareOpen=0}}class f extends n.JT{copyPackage(e){return this._collaboratorRepository.copyPackage(e)}getShareInfo(e){return this._collaboratorRepository.getShareInfo(e)}getFileRoomUser(e){return this._collaboratorRepository.getFileRoomUser(e)}getIsShareOpen(){return this._collaboratorRepository.isShareOpen}constructor(e){super(),this._instantiationService=e,this._collaboratorRepository=this._instantiationService.createInstance(y)}}f=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],f)},653890:function(e,t,r){r.d(t,{h:function(){return i}});let i=(0,r(335290).yh)("commercial-data-service")},504393:function(e,t,r){r.d(t,{a:function(){return v}});var i=r(789786),s=r(702049),n=r(405051),o=r(121130),a=r(894339),c=r(786022),u=r(768101),l=r(191449),d=r(690613),_=r(114861),h=r(286748),p=r(238458),g=r(32001),y=r(966697),f=r(231150);class v{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new n.yk().build({headers:{"Content-Type":"application/json"}});return(0,o.i3)(t),e?(0,f.XC)(t):(0,a.mH)(t),(0,_.V)(t),t}(this._options.useCommercialApiPC)),this._networkClientInstance}_getApi(e){return`${s._L.getVar("commerce_domain")}${e}`}async getCommercialTools(){try{var e;let t=await this._networkClient.request({method:"post",data:{app_id:c.kJ},url:this._getApi(h.b.COMMERCIAL_GET_BENEFITS),withCredentials:!0});if("0"!==t.ret)return(0,d.wf)(Number(t.ret),t.errmsg);let{pay:r=[]}=null!==(e=t.data)&&void 0!==e?e:{},i=r.reduce((e,t)=>(e[t]={benefitStatus:p.p.Pay},e),{});return(0,d.oW)(i)}catch(e){return(0,u.m)(e,-1,"create drawFrame task api error.")}}async queryVoiceBenefit(e){try{var t;let r=await this._networkClient.post(this._getApi(h.b.QUERY_VOICE_BENEFIT),{benefit_category:e.benefitCategory},(0,g.t)());if("0"!==r.ret)return(0,d.wf)(Number(r.ret),r.errmsg);let{quota_left:i}=null!==(t=r.data[p.B.CloneVoiceFreeLeft])&&void 0!==t?t:{};return(0,d.oW)({[p.B.CloneVoiceFreeLeft]:{quotaLeft:i}})}catch(e){return(0,u.m)(e,-1,"queryVoiceBenefit api error.")}}async reportVoiceUsage(e){try{let t=await this._networkClient.post(this._getApi(h.b.REPORT_VOICE_USAGE),{usage_type:e.usageType,use_quota:e.useQuota},(0,g.t)());if("0"!==t.ret)return(0,d.wf)(Number(t.ret),t.errmsg);return(0,d.ly)()}catch(e){return(0,u.m)(e,-1,"reportVoiceUasge api error.")}}async batchGetUserBenefit(e){try{let t;this._options.useCommercialApiPC&&(t=(await (0,f.TO)()).appID);let r=await this._networkClient.post(this._getApi(h.b.BATCH_GET_USER_BENEFIT),{benefit_category:e.benefitCategory},(0,g.t)(t));if("0"!==r.ret)return(0,d.wf)(Number(r.ret),r.errmsg);return(0,d.oW)(r)}catch(e){return(0,u.m)(e,-1,"batch-get-user-benefit-error")}}async reportUsage(e){try{let t=await this._networkClient.post(this._getApi(h.b.REPORT_USAGE),{benefit_log_id:e.benefitLogId,is_success:e.isSuccess,fail_code:e.failCode},(0,g.t)());if("0"!==t.ret)return(0,d.wf)(Number(t.ret),t.errmsg);return(0,d.oW)(t)}catch(e){return(0,u.m)(e,-1,"report-usage-error")}}async getBenefitMetadata(e){try{let t=await this._networkClient.post(this._getApi(h.b.BENEFIT_META),{query_list:(0,l.X)(e.queryList)},{...(0,g.t)(),headers:{loc:this._capcutAccountService.region}});if("0"!==t.ret)return(0,d.wf)(Number(t.ret),t.errmsg);let r=(0,l.b)(t.data);if(!r)return(0,d.wf)(-1,"get-benefit-metadata-formatted-error");return(0,d.oW)({...t,data:r})}catch(e){return(0,u.m)(e,-1,"get-benefit-metadata-error")}}async batchGetUserBenefitV3(e){try{let t=await this._networkClient.post(this._getApi(h.b.BATCH_GET_USER_BENEFIT_V3),{query_list:(0,l.X)(e.queryList)},{...(0,g.t)(),headers:{loc:this._capcutAccountService.region}});if("0"!==t.ret)return(0,d.wf)(Number(t.ret),t.errmsg);let r=(0,l.b)(t.data);if(!r)return(0,d.wf)(-1,"get-benefit-metadata-formatted-error");return(0,d.oW)({...t,data:r})}catch(e){return(0,u.m)(e,-1,"get-benefit-metadata-error")}}constructor(e={},t){this._options=e,this._capcutAccountService=t}}v=(0,i.gn)([(0,i.fM)(1,y.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICommercialRepositoryOptions?Object:ICommercialRepositoryOptions,void 0===y.Gw?Object:y.Gw])],v)},466854:function(e,t,r){r.d(t,{b:function(){return i}});let i=(0,r(335290).yh)("copyright-tip-data-service")},342317:function(e,t,r){r.d(t,{s:function(){return i}});let i=(0,r(335290).yh)("curve-hsl-data-service")},550626:function(e,t,r){r.d(t,{g:()=>T});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("48808");class u extends a.r{get resourceType(){return o._g.CurveHSL}parseEffectsToResources(e){return e.map(e=>(0,c.F)(e))}}var l=r("773943");class d extends l.b{buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return o._g.CurveHSL}parseEffectsToResources(e,t){return e.map(e=>(0,c.F)(e,t))}}var _=r("26372"),h=r("789869"),p=r("273340"),g=r("33883"),y=r("857727");class f extends h.A{get resourceType(){return p.g.CurveHSL}get resourcePanelType(){return g.q.CurveHSL}parseHeycanResponseDataToResources(e){return(0,y.z)(e)}}var v=r("736031"),m=r("744268"),w=r("249656"),k=r("305301");class T extends n.JT{async getCurveHsl(e){let t=await (0,v.bY)(this._configurationService,v.$0);return"vimo"===(0,v.lo)(t,this._getHeycanCurveHslByCategoryRepository.resourcePanelType).panel_path?this._getHeycanCurveHslByCategoryRepository.getResources((0,v.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._curveHslRepository.getResources(e)}async batchGetCurveHslsByIds(e){if(e.source===w.Hw.LOKI)return this._batchGetCurveHslRepository.batchGetResources(e);{let t=await (0,v.bY)(this._configurationService,v.$0);return"loki"===(0,v.lo)(t,this._batchGetHeycanCurveHslRepository.resourcePanelType).panel_path&&e.source!==w.Hw.HEYCAN?this._batchGetCurveHslRepository.batchGetResources(e):this._batchGetHeycanCurveHslRepository.batchGetResources((0,k.Q)(e.ids,this._batchGetHeycanCurveHslRepository.resourceType,e.source))}}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._curveHslRepository=this._instantiationService.createInstance(d),this._batchGetCurveHslRepository=this._instantiationService.createInstance(u),this._getHeycanCurveHslByCategoryRepository=this._instantiationService.createInstance(_.O),this._batchGetHeycanCurveHslRepository=this._instantiationService.createInstance(f)}}T=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,m.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===m.Ui?Object:m.Ui])],T)},48808:function(e,t,r){r.d(t,{F:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r,extra:n}=(0,i.sh)(s._g.CurveHSL,e,t);return{...r}}},857734:function(e,t,r){r.d(t,{U:function(){return o}});var i=r(127830),s=r(412497),n=r(920699);class o extends s.r{get resourceType(){return i._g.CurvePreset}parseEffectsToResources(e){return e.map(e=>(0,n.z)(e))}}},276283:function(e,t,r){r.d(t,{u:function(){return n}});var i=r(127830),s=r(512363);class n extends s.L{get resourceType(){return i._g.CurvePreset}}},644150:function(e,t,r){r.d(t,{U:function(){return o}});var i=r(773943),s=r(920699),n=r(127830);class o extends i.b{buildCustomRequest(e){var t;return{enable_album:null!==(t=e.enableAlbum)&&void 0!==t&&t}}get resourceType(){return n._g.CurvePreset}parseEffectsToResources(e,t){return e.map(e=>(0,s.z)(e,t))}}},602817:function(e,t,r){r.d(t,{V:function(){return a}});var i=r(273340),s=r(481302),n=r(789869),o=r(33883);class a extends n.A{get resourceType(){return i.g.CurvePreset}get resourcePanelType(){return o.q.CurvePreset}parseHeycanResponseDataToResources(e){return(0,s.a)(e)}}},64088:function(e,t,r){r.d(t,{r:function(){return a}});var i=r(758027),s=r(127830),n=r(33883),o=r(481302);class a extends i.B{get resourceType(){return s._g.CurvePreset}get resourcePanelType(){return n.q.CurvePreset}parseHeycanResponseDataToResources(e){return(0,o.a)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource||"heycan",category_id:Number(e.category),pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}},920699:function(e,t,r){r.d(t,{z:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r}=(0,i.sh)(s._g.CurvePreset,e,t);return{...r}}},481302:function(e,t,r){r.d(t,{a:function(){return a}});var i=r(889862),s=r(127830),n=r(32372),o=r(134429);function a(e){let t=(0,i.E)(e,s._g.CurvePreset);return{...t,key:`${s._g.CurvePreset}_${t.resourceId}`,name:t.title,icon:{uri:(0,n.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,n.s)(t.originUrl),urlList:[t.originUrl]},sdkVersion:o.f4}}},698533:function(e,t,r){r.d(t,{r:function(){return i}});let i=(0,r(335290).yh)("curve-speed-data-service")},711652:function(e,t,r){r.d(t,{e:()=>R});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("198715");class u extends a.r{get resourceType(){return o._g.CurveSpeed}parseEffectsToResources(e){return e.map(e=>(0,c.T)(e))}}var l=r("913446"),d=r("512363");class _ extends d.L{get resourceType(){return o._g.CurveSpeed}}var h=r("744268"),p=r("736031"),g=r("249656"),y=r("305301"),f=r("677145"),v=r("462090"),m=r("872443"),w=r("33883"),k=r("510879");class T extends m.L{get resourceType(){return o._g.CurveSpeed}get resourcePanelType(){return w.q.CurveSpeed}parseHeycanResponseDataToResources(e){return(0,k.t)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}class R extends n.JT{async getCurveSpeed(e){return await (0,p._Q)(this._configurationService,this._getHeycanCurveSpeedByCategoryRepository.resourcePanelType,p.$0)?this._getHeycanCurveSpeedByCategoryRepository.getResources(e):this._curveSpeedRepository.getResources(e)}async batchGetCurveSpeedsByIds(e){if(e.source===g.Hw.LOKI)return this._batchGetCurveSpeedRepository.batchGetResources(e);{let t=await (0,p.bY)(this._configurationService,p.$0);return"loki"===(0,p.lo)(t,this._batchGetHeycanCurveSpeedRepository.resourcePanelType).panel_path&&e.source!==g.Hw.HEYCAN?this._batchGetCurveSpeedRepository.batchGetResources(e):this._batchGetHeycanCurveSpeedRepository.batchGetResources((0,y.Q)(e.ids,this._batchGetHeycanCurveSpeedRepository.resourceType,e.source))}}async getCurveSpeedCategories(e){let t=await (0,p.bY)(this._configurationService,p.$0);return"vimo"===(0,p.lo)(t,this._getHeycanCurveSpeedCategoriesRepository.resourcePanelType).panel_path?this._getHeycanCurveSpeedCategoriesRepository.getCategories((0,p.lY)(e,t)):this._getCurveSpeedCategoriesRepository.getCategories(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._curveSpeedRepository=this._instantiationService.createInstance(l.f),this._batchGetCurveSpeedRepository=this._instantiationService.createInstance(u),this._getCurveSpeedCategoriesRepository=this._instantiationService.createInstance(_),this._getHeycanCurveSpeedByCategoryRepository=this._instantiationService.createInstance(v.A),this._getHeycanCurveSpeedCategoriesRepository=this._instantiationService.createInstance(T),this._batchGetHeycanCurveSpeedRepository=this._instantiationService.createInstance(f.r)}}R=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,h.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===h.Ui?Object:h.Ui])],R)},510879:function(e,t,r){r.d(t,{t:function(){return c}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372),a=r(134429);function c(e){var t;let r=(0,i.E)(e,s._g.CurveSpeed),c=(0,n.D)(e.common_attr.extra),u=null!==(t=(0,n.D)(c.speed_points).speed_points)&&void 0!==t?t:[];return{...r,key:`${s._g.CurveSpeed}_${r.resourceId}`,name:r.title,icon:{uri:(0,o.s)(r.coverUrl),urlList:[r.coverUrl]},previewUrl:r.coverUrl,package:{uri:(0,o.s)(r.originUrl),urlList:[r.originUrl]},sdkVersion:a.f4,speedPoints:u}}},543395:function(e,t,r){r.d(t,{b:function(){return i}});let i={SEARCH:"/lv/v1/intelligence/search/item/list",SAVE_TO_CLOUD:"/lv/v1/intelligence/digital_human/asset"}},471169:function(e,t,r){r.d(t,{F:function(){return o},V:function(){return n}});var i,s,n=((i={})[i.TTAM=3]="TTAM",i);var o=((s={})[s.Male=0]="Male",s[s.Female=1]="Female",s)},942133:function(e,t,r){r.d(t,{H:function(){return a}});var i=r(872443),s=r(33883),n=r(467209),o=r(127830);class a extends i.L{get resourcePanelType(){return s.q.DigitalHuman}get resourceType(){return o._g.DigitalHuman}get skipSingleDataParseError(){return!0}parseHeycanResponseDataToResources(e){return(0,n.A)(e)}buildCustomRequest(e){var t;return{pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'},enter_from:"digital_human"}}}},415906:function(e,t,r){r.d(t,{z:function(){return a}});var i=r(127830),s=r(467209),n=r(758027),o=r(33883);class a extends n.B{get resourceType(){return i._g.DigitalHuman}get resourcePanelType(){return o.q.DigitalHuman}parseHeycanResponseDataToResources(e){return(0,s.A)(e)}get skipSingleDataParseError(){return!0}buildCustomRequest(e){var t,r,i;return{category_id:Number(e.category),limit:null!==(t=e.limit)&&void 0!==t?t:50,offset:null!==(r=e.offset)&&void 0!==r?r:0,pack_optional:{need_thumb:!0,only_commercial:null!==(i=e.onlyCommercial)&&void 0!==i&&i,thumb_opt:'{"is_support_webp":1}'},enter_from:"digital_human"}}}},156470:function(e,t,r){r.d(t,{c:()=>_});var i=r("690613"),s=r("114861"),n=r("702049"),o=r("405051"),a=r("121130"),c=r("894339"),u=r("866006"),l=r("543395"),d=r("768101");class _{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.i3)(e),(0,c.mH)(e),(0,s.V)(e),e}()),this._networkClientInstance}async searchDigitalHuman(e){let t=(0,u.ky)(e)?e.config:e;try{var r,s,n;let o=await this._networkClient.post(this._api,{filters:[...this._buildFilterParams(null!==(r=t.filters)&&void 0!==r?r:{})],item_type:2e4,key_word:t.query,...this._getTokenParams(e)},{withCredentials:!0}),a=Number(null!==(s=o.ret)&&void 0!==s?s:0),c=null!==(n=o.errmsg)&&void 0!==n?n:"";if(0!==a)return(0,i.wf)(null!=a?a:-1,null!=c?c:"");let u=await this._convertResponseToQueryToken(t,o);if(!u.ok)return u;return(0,i.oW)(u.value)}catch(e){return(0,d.m)(e,-1,"searchDigitalHuman api error")}}_getTokenParams(e){var t,r;return(0,u.ky)(e)?{cursor:e.offset,count:null!==(t=e.config.limit)&&void 0!==t?t:50}:{cursor:0,count:null!==(r=e.limit)&&void 0!==r?r:50}}_buildFilterParams(e){let t=[];return e.onlyCommercial&&t.push({key:"commercial",values:["true"]}),["gender","outfit","pose"].forEach(r=>{e[r]&&t.push({key:r,values:e[r]})}),t}async _convertResponseToQueryToken(e,t){let{data:r}=t,s=r.next_cursor,n=r.has_more,o=r.item_infos.length?await this._batchGetDigitalHumanReposity.batchGetResources({resourceIds:r.item_infos}):(0,i.oW)({list:[]});if(!o.ok)return o;let a=(0,u.ib)(e,{list:o.value.list,requestId:t.log_id},{hasMore:n,offset:s});return(0,i.oW)(a)}get _api(){return`${n._L.getVar("web_domain")}${l.b.SEARCH}`}constructor(e){this._batchGetDigitalHumanReposity=e}}},467209:function(e,t,r){r.d(t,{A:function(){return d}});var i=r(127830),s=r(249656),n=r(471169),o=r(764091),a=r(981632),c=r(889862),u=r(492795);let l={1:u.x$.ElevenLabs,2:u.x$.Vimo};function d(e){var t,r,u,d,_,h,p,g,y;function f(t,r){let i=(0,o.Mk)({video:t,common_attr:{...e.common_attr,id:r}});return i.originUrl=i.originVideo.url,i}let v=(0,a.D)(e.common_attr.extra),m=(0,a.D)(null!==(d=e.digital_human.face_shot)&&void 0!==d?d:""),w=e.digital_human.preview_video.origin_video;!w&&(w=null===(_=e.digital_human.preview_video.transcoded_video)||void 0===_?void 0:_[Object.keys(null!==(h=e.digital_human.preview_video.transcoded_video)&&void 0!==h?h:{})[0]]),e.common_attr.sub_type,n.V.TTAM;let k=e.digital_human.mask_video&&(e.digital_human.mask_video.origin_video||e.digital_human.mask_video.transcoded_video);return{...(0,c.E)(e,i._g.DigitalHuman),id:e.common_attr.description,source:s.Hw.HEYCAN,name:e.common_attr.title,title:e.common_attr.title,width:228,height:304,tonePlatform:(e.digital_human.voice_source?l[e.digital_human.voice_source]:"")||"",toneResourceId:void 0,toneType:e.digital_human.voice_type,isFavorite:e.common_attr.has_favorited,smallPicture:e.common_attr.cover_url.small,coverUrl:e.common_attr.cover_url.small,bigPicture:(null===(t=e.digital_human.preview_image)||void 0===t?void 0:t.image_url)||e.common_attr.cover_url.static_img||e.common_attr.cover_url.small,faceShot:m&&{faceCenterX:null==m?void 0:m.face_center_x,faceCenterY:null==m?void 0:m.face_center_y,faceRadius:null==m?void 0:m.face_radius},originUrl:null==w?void 0:w.video_url,description:"Hey, good to see you",originVideo:{height:1920,width:1080},aspectRatio:null!==(p=e.common_attr.aspect_ratio)&&void 0!==p?p:.75,duration:e.digital_human.preview_video.duration||3,duration_ms:e.digital_human.preview_video.duration_ms||3e3,gender:"female"===e.digital_human.gender?n.F.Female:n.F.Male,isBusiness:null===(g=e.common_attr.is_business)||void 0===g||g,previewVideo:f(e.digital_human.preview_video,e.common_attr.id),maskVideo:k?f(e.digital_human.mask_video,`${e.common_attr.id}-matting`):void 0,longPreviewVideoId:null==v?void 0:v.digital_human_long_preview_video_item_id,longPreviewMaskId:null==v?void 0:v.digital_human_long_preview_mask_item_id,hasRealBg:null!==(y=null===(r=e.digital_human)||void 0===r?void 0:r.has_real_bg)&&void 0!==y&&y,reqKey:null===(u=e.digital_human)||void 0===u?void 0:u.cv_lab_key,digitalHumanCustomType:0,trainVideoDuration:0}}},465698:function(e,t,r){r.d(t,{b:function(){return i}});let i={CREATE_COPY_TASK:"/lv/v1/coordination/package/copy",GET_COPY_TASK_DETAIL:"/lv/v1/coordination/package/query_process"}},660323:function(e,t,r){r.d(t,{W:()=>l});var i=r("402655"),s=r("690613"),n=r("147081"),o=r("587892"),a=r("197238"),c=r("845981");class u extends i.JT{get error(){return this._error}get status(){return this._status}async _getTaskProgress(){let e=await this._draftCopyRepository.getDraftCopyTask({workspace_id:this._workspaceId,process_id:this._processId,need_visible:this._needVisible});e.ok?(this._getTaskProgressErrorCount=0,e.value.status===c.SH.Success?(this._status=c.SH.Success,this._onSuccess.fire()):e.value.status===c.SH.Processing||e.value.status===c.SH.Initial?(this._status=c.SH.Processing,this._onProgress.fire({progress:e.value.progress})):(this._status=c.SH.Failed,this._error=(0,s.wf)(-1,"draft copy task failed"),this._onError.fire(this._error))):this._getTaskProgressErrorCount++,this._getTaskProgressErrorCount>=10&&(this._status=c.SH.Failed,this._error=(0,s.wf)(e.code,e.msg),this._onError.fire(this._error))}async _startPollingProgress(){if(await this._getTaskProgress(),Date.now()-this._startTime>this._timeout){this._status=c.SH.Failed,this._error=(0,a.hO)(),this._onError.fire(this._error);return}this._status===c.SH.Processing&&setTimeout(()=>{this._startPollingProgress()},500)}constructor(e,t,r,i,n=!0){super(),this._timeout=e,this._draftCopyRepository=t,this._workspaceId=r,this._processId=i,this._needVisible=n,this._onProgress=this._store.add(new o.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new o.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new o.Q),this.onSuccess=this._onSuccess.event,this._status=c.SH.Initial,this._getTaskProgressErrorCount=0,this._error=(0,s.ly)(),this._startTime=0,this._startTime=Date.now(),this._startPollingProgress()}}class l extends i.JT{async createCopyTask(e){let t=await this._draftCopyRepository.createDraftCopyTask({from_workspace_id:e.fromWorkspaceId,to_workspace_id:e.toWorkspaceId,package_key:e.packageKey,new_package_key:e.newPackageKey,meta:e.meta,resource_type:e.resourceType});return t.ok?(0,s.oW)(new u(6e4,this._draftCopyRepository,e.toWorkspaceId,t.value,e.needVisible)):t}constructor(){super(),this._draftCopyRepository=new n.n}}},644246:function(e,t,r){r.d(t,{g:()=>p});var i=r("789786"),s=r("690613"),n=r("114861"),o=r("702049"),a=r("405051"),c=r("121130"),u=r("894339"),l=r("768101"),d=r("289041"),_=r("801497"),h=r("966697");class p{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new a.yk().build(a.kk);return(0,c.i3)(e),(0,u.mH)(e),(0,n.V)(e),e}()),this._networkClientInstance}get _api(){return`${o._L.getVar("web_domain")}${d.b.GET_PACK_RESOURCE}`}async getDraftCover(e){try{let r=await this._networkClient.post(this._api,{workspace_id:e.workspaceId,materials:e.materials,referenced_assets:e.referencedAssets.map(e=>({md5:e.md5,source_path:e.sourcePath})),sdk_version:"13.6.0",lang:_.ZP.language,region:this._accountService.userProfile.region},{withCredentials:!0});if("0"!==r.ret){var t;return(0,s.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,s.oW)(r.data)}catch(e){return(0,l.m)(e,-1,"getDraftCoverResource api error")}}constructor(e){this._accountService=e}}p=(0,i.gn)([(0,i.fM)(0,h.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.Gw?Object:h.Gw])],p)},699338:function(e,t,r){r.d(t,{Y:function(){return i}});let i=(0,r(335290).yh)("draft-permission-data-service")},503125:function(e,t,r){r.d(t,{b:()=>y});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("702049"),u=r("405051"),l=r("121130"),d=r("894339"),_=r("768101");let h={UPDATE_DRAFT_PERMISSION:"/cc/v1/workspace/update_file_edit_owner",GET_DRAFT_OWNER:"/cc/v1/workspace/get_file_edit_owner"};class p{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.i3)(e),(0,d.mH)(e),(0,a.V)(e),e}()),this._networkClientInstance}_getApi(e){return`${c._L.getVar("web_domain")}${e}`}async updateDraftPermission(e){try{let r=await this._networkClient.post(this._getApi(h.UPDATE_DRAFT_PERMISSION),{workspace_id:e.workspaceId,file_id:e.draftId,uid:e.uid},{withCredentials:!0});if("0"!==r.ret){var t;return(0,o.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,o.ly)()}catch(e){return(0,_.m)(e,-1,"updateDraftPermission api error")}}async getDraftPermission(e){try{let r=await this._networkClient.post(this._getApi(h.GET_DRAFT_OWNER),{workspace_id:e.workspaceId,file_id:e.draftId},{withCredentials:!0});if("0"!==r.ret){var t;return(0,o.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}let{edit_owner:i,owner_nickname:s,owner:n,permissions:a}=r.data;return(0,o.oW)({editOwner:i,owner:n,ownerNickname:s,permissions:a})}catch(e){return(0,_.m)(e,-1,"getDraftOwner api error")}}}var g=r("462589");class y extends n.JT{updateDraftPermission(e){return this._draftPermissionRepository.updateDraftPermission(e)}getDraftPermission(e){return this._draftPermissionRepository.getDraftPermission(e)}constructor(e){super(),this._instantiationService=e,this._draftPermissionRepository=this._instantiationService.createInstance(p)}}(0,i.gn)([(0,g.o)(12e4),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IGetDraftOwnerParams?Object:IGetDraftOwnerParams]),(0,i.w6)("design:returntype","undefined"==typeof Promise?Object:Promise)],y.prototype,"getDraftPermission",null),y=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],y)},445449:function(e,t,r){r.d(t,{E:function(){return i}});let i=(0,r(335290).yh)("edit-time-data-service")},177318:function(e,t,r){r.d(t,{t:()=>v});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("702049"),u=r("405051"),l=r("121130"),d=r("894339"),_=r("768101");let h="/lv/v1/stat/report_creation_data",p="/lv/v1/stat/get_creation_data";var g=r("966697");class y{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.i3)(e),(0,d.mH)(e),(0,a.V)(e),e}()),this._networkClientInstance}get _api(){return`${c._L.getVar("web_domain")}${h}`}async editTimeReport(e){try{let r=await this._networkClient.post(this._api,{edit_time:e.editTime,draft_id:e.draftId,region:this._capcutAccountService.userProfile.region},{withCredentials:!0});if("0"!==r.ret){var t;return(0,o.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,o.oW)(!0)}catch(e){return(0,_.m)(e,-1,"editTimeReport api error")}}editTimeReportBeacon(e){try{let t=new Blob([JSON.stringify({edit_time:e.editTime,draft_id:e.draftId,region:this._capcutAccountService.userProfile.region})],{type:"application/json"});if(navigator.sendBeacon(this._api,t))return(0,o.oW)(!0);return(0,o.wf)(-1,"editTimeReport api error")}catch(e){return(0,_.m)(e,-1,"editTimeReport api error")}}constructor(e){this._capcutAccountService=e}}y=(0,i.gn)([(0,i.fM)(0,g.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g.Gw?Object:g.Gw])],y);class f{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.i3)(e),(0,d.mH)(e),(0,a.V)(e),e}()),this._networkClientInstance}get _api(){return`${c._L.getVar("web_domain")}${p}`}async getDraftEditTime(e){try{let r=await this._networkClient.post(this._api,{draft_id:e.draftId,region:this._capcutAccountService.userProfile.region},{withCredentials:!0});if("0"!==r.ret){var t;return(0,o.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}let{edit_days:i,actual_edit_days:s,actual_edit_time:n}=r.data;return(0,o.oW)({editDays:i,actualEditDays:s,actualEditTime:n})}catch(e){return(0,_.m)(e,-1,"getDraftEditTime api error")}}constructor(e){this._capcutAccountService=e}}f=(0,i.gn)([(0,i.fM)(0,g.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g.Gw?Object:g.Gw])],f);class v extends n.JT{getDraftEditTime(e){return this._getEditTimeRepository.getDraftEditTime(e)}editTimeReport(e){return this._commitEditTimeRepository.editTimeReport(e)}editTimeReportBeacon(e){return this._commitEditTimeRepository.editTimeReportBeacon(e)}constructor(e){super(),this._instantiationService=e,this._commitEditTimeRepository=this._instantiationService.createInstance(y),this._getEditTimeRepository=this._instantiationService.createInstance(f)}}v=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],v)},835342:function(e,t,r){r.d(t,{o:function(){return s}});var i=r(981632);function s(e){var t;return{...e.data,parameters:(0,i.D)(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.parameters)}}},257402:function(e,t,r){r.d(t,{p:()=>g});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("629351"),u=r("415266"),l=r("405051"),d=r("768101"),_=r("141314"),h=r("396190");class p{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(e){let t=new l.yk().build(l.kk);return(0,c.V)(t,{appVersion:e.appVersion}),(0,a.V)(t),t}({appVersion:this._environmentService.appVersion})),this._networkClientInstance}async getEffectSettings(e){let{veVersion:t,webId:r,...i}=e;try{var s;let e=await this._networkClient.get(`${u.c.domain}${u.c.urlMap.GET_EFFECT_SETTINGS}`,{params:{...i,web_id:r,ve_version:null!=t?t:""},withCredentials:!0}),n=null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.data;if(null==n?void 0:n.settings)return(0,o.oW)(null==n?void 0:n.settings);return(0,o.Mx)(-1,"invalid getEffectSettings response",Error("invalid getEffectSettings response"))}catch(e){return(0,d.m)(e,-1,"getEffectSettings api error")}}constructor(e){this._environmentService=e,this._urlGenerator=new _.w(u.c)}}p=(0,i.gn)([(0,i.fM)(0,h.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.Y?Object:h.Y])],p);class g extends n.JT{getEffectSettings(e){return this._effectAbTestRepository.getEffectSettings(e)}constructor(e){super(),this._instantiationService=e,this._effectAbTestRepository=this._instantiationService.createInstance(p)}}g=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],g)},317419:function(e,t,r){r.d(t,{$:function(){return n},s:function(){return o}});var i,s=r(335290);var n=((i={}).Loki="loki",i.Heycan="heycan",i);let o=(0,s.yh)("effect-data-service")},444036:function(e,t,r){r.d(t,{f:()=>U});var i=r("789786"),s=r("861810"),n=r("55449"),o=r("402655"),a=r("866006"),c=r("127830"),u=r("249656"),l=r("317419"),d=r("966697"),_=r("744268"),h=r("412497"),p=r("549367"),g=r("396190");class y extends h.r{get resourceType(){return this._resourceType}parseEffectsToResources(e){return e.map(e=>(0,p.By)(this._resourceType)(e))}constructor(e,t,r,i){super(t,r,i),this._resourceType=e}}y=(0,i.gn)([(0,i.fM)(1,d.Gw),(0,i.fM)(2,_.Ui),(0,i.fM)(3,g.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof EffectResourceType?Object:EffectResourceType,void 0===d.Gw?Object:d.Gw,void 0===_.Ui?Object:_.Ui,void 0===g.Y?Object:g.Y])],y);var f=r("773943"),v=r("332557"),m=r("916636"),w=r("544688"),k=r("847083");class T extends f.b{get resourceType(){return this._resourceType}buildCustomRequest(e){return{enable_album:e.enableAlbum,only_commercial:e.onlyCommercial}}parseEffectsToResources(e,t){return e.map(e=>(0,p.By)(this._resourceType)(e,t))}constructor(e,t,r,i,s,n,o,a){super(t,r,i,s,n,o,a),this._resourceType=e}}T=(0,i.gn)([(0,i.fM)(1,d.Gw),(0,i.fM)(2,_.Ui),(0,i.fM)(3,v.U),(0,i.fM)(4,m.c),(0,i.fM)(5,g.Y),(0,i.fM)(6,w.c),(0,i.fM)(7,k.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof EffectResourceType?Object:EffectResourceType,void 0===d.Gw?Object:d.Gw,void 0===_.Ui?Object:_.Ui,void 0===v.U?Object:v.U,void 0===m.c?Object:m.c,void 0===g.Y?Object:g.Y,void 0===w.c?Object:w.c,void 0===k.a?Object:k.a])],T);var R=r("976058"),b=r("872443"),S=r("229622"),C=r("690465"),I=r("685795");class P extends b.L{get resourcePanelType(){return this._resourcePanelType}get resourceType(){return this._resourceType}parseHeycanResponseDataToResources(e){return this._resourceType===c._g.Effects?(0,S.qi)(e):(0,S.vf)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}',image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}constructor(e,t,r,i,s,n,o,a,c,u){super(r,i,s,n,o,a,c,u),this._resourceType=e,this._resourcePanelType=t}}P=(0,i.gn)([(0,i.fM)(2,d.Gw),(0,i.fM)(3,m.c),(0,i.fM)(4,w.c),(0,i.fM)(5,_.Ui),(0,i.fM)(6,C.x),(0,i.fM)(7,I.L),(0,i.fM)(8,v.U),(0,i.fM)(9,k.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof EffectResourceType?Object:EffectResourceType,"undefined"==typeof EffectHeycanPanelType?Object:EffectHeycanPanelType,void 0===d.Gw?Object:d.Gw,void 0===m.c?Object:m.c,void 0===w.c?Object:w.c,void 0===_.Ui?Object:_.Ui,void 0===C.x?Object:C.x,void 0===I.L?Object:I.L,void 0===v.U?Object:v.U,void 0===k.a?Object:k.a])],P);var E=r("273340"),A=r("853369"),M=r("96879"),x=r("151293"),O=r("33883"),F=r("607572"),D=r("612327");class L extends D.J{get resourceType(){return this._resourceType}parseHeycanResponseDataToResources(e){return this._resourceType===E.g.SpecialEffect?(0,S.qi)(e):(0,S.vf)(e)}constructor(e,t){super(t),this._resourceType=e}}L=(0,i.gn)([(0,i.fM)(1,d.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof EffectHeycanType?Object:EffectHeycanType,void 0===d.Gw?Object:d.Gw])],L);class U extends o.JT{getEffectCategories(e,t){let r=e instanceof a.yt?e.config:e;if(t===l.$.Heycan)return r.effectResourceType===c._g.Effects?this._getHeyCanVideoEffectCategoriesRepository.getCategories(e):this._getHeyCanFaceEffectCategoriesRepository.getCategories(e);return r.effectResourceType===c._g.Effects?this._getVideoEffectCategoriesRepository.getCategories(e):this._getFaceEffectCategoriesRepository.getCategories(e)}getEffect(e,t){let r=e instanceof a.yt?e.config:e;if(t===l.$.Heycan)return r.effectResourceType===c._g.Effects?this._getHeyCanVideoEffectByCategoryRepository.getResources(e):this._getHeyCanFaceEffectByCategoryRepository.getResources(e);return r.effectResourceType===c._g.Effects?this._videoEffectRepository.getResources(e):this._faceEffectRepository.getResources(e)}batchGetEffectsByIds(e){let t=(e instanceof a.yt?e.config:e).effectResourceType===c._g.Effects;if(e.source===u.Hw.HEYCAN){let r={items:e.ids.map(e=>({id:e,effectType:t?E.g.SpecialEffect:E.g.FaceTool,source:u.Hw.HEYCAN}))};return t?this._batchGetHeycanVideoEffectRepository.batchGetResources(r):this._batchGetHeycanFaceEffectRepository.batchGetResources(r)}return t?this._batchGetVideoEffectRepository.batchGetResources(e):this._batchGetFaceEffectRepository.batchGetResources(e)}searchEffect(e,t){return t===l.$.Heycan?this._searchHeycanEffectRepository.searchResources(e):this._searchEffectRepository.searchResources(e)}getCollections(e){return(e instanceof a.yt?e.config:e).effectResourceType===c._g.Effects?this._collectionVideoEffectRepository.getCollections(e):this._collectionFaceEffectRepository.getCollections(e)}addToCollection(e){return(e instanceof a.yt?e.config:e).effectResourceType===c._g.Effects?this._collectionVideoEffectRepository.addToCollection(e):this._collectionFaceEffectRepository.addToCollection(e)}removeFromCollection(e){return(e instanceof a.yt?e.config:e).effectResourceType===c._g.Effects?this._collectionVideoEffectRepository.removeFromCollection(e):this._collectionFaceEffectRepository.removeFromCollection(e)}constructor(e={},t){var r;if(super(),this.collectionParam=e,this._instantiationService=t,this._videoEffectRepository=this._instantiationService.createInstance(new s.M(T,[c._g.Effects])),this._batchGetVideoEffectRepository=this._instantiationService.createInstance(new s.M(y,[c._g.Effects])),this._getVideoEffectCategoriesRepository=this._instantiationService.createInstance(new s.M(R.H,[c._g.Effects])),this._collectionVideoEffectRepository=this._instantiationService.createInstance(new s.M(A.w,[E.g.SpecialEffect,e])),this._searchEffectRepository=this._instantiationService.createInstance(M.S),this._searchHeycanEffectRepository=this._instantiationService.createInstance(x.v),this._getHeyCanVideoEffectCategoriesRepository=this._instantiationService.createInstance(new s.M(P,[c._g.Effects,O.q.Effects])),this._getHeyCanVideoEffectByCategoryRepository=this._instantiationService.createInstance(new s.M(F.t,[c._g.Effects])),this._batchGetHeycanVideoEffectRepository=this._instantiationService.createInstance(new s.M(L,[E.g.SpecialEffect])),this._faceEffectRepository=this._instantiationService.createInstance(new s.M(T,[c._g.FaceProp])),this._batchGetFaceEffectRepository=this._instantiationService.createInstance(new s.M(y,[c._g.FaceProp])),this._getFaceEffectCategoriesRepository=this._instantiationService.createInstance(new s.M(R.H,[c._g.FaceProp])),this._collectionFaceEffectRepository=this._instantiationService.createInstance(new s.M(A.w,[E.g.FaceTool])),this._getHeyCanFaceEffectCategoriesRepository=this._instantiationService.createInstance(new s.M(P,[c._g.FaceProp,O.q.FaceProp])),this._getHeyCanFaceEffectByCategoryRepository=this._instantiationService.createInstance(new s.M(F.t,[c._g.FaceProp])),this._batchGetHeycanFaceEffectRepository=this._instantiationService.createInstance(new s.M(L,[E.g.FaceTool])),null===(r=this.collectionParam)||void 0===r?void 0:r.fixedRegion){let{fixedRegion:e}=this.collectionParam;this._getHeyCanVideoEffectCategoriesRepository.setFixedRegion(e),this._getHeyCanVideoEffectByCategoryRepository.setFixedRegion(e),this._getHeyCanFaceEffectByCategoryRepository.setFixedRegion(e),this._getHeyCanFaceEffectCategoriesRepository.setFixedRegion(e)}}}U=(0,i.gn)([(0,i.fM)(1,n.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===n.T?Object:n.T])],U)},96879:function(e,t,r){r.d(t,{S:function(){return h}});var i=r(789786),s=r(273340),n=r(157021),o=r(494158),a=r(786022),c=r(916636),u=r(966697),l=r(544688),d=r(932606),_=r(744268);class h extends n.d{buildCustomRequest(e){return{app_id:a.kJ,search_option:{cc_web_use_new_search:!0},pack_optional:{need_thumb:!0,thumb_opt:'{"is_support_webp":1}'}}}async _getWhiteUserPermission(){if(!this._accountService.hasLogin)return!1;let[e,t]=(await this._userPermissionDataService.getUserPermission({})).pair();return!e&&!!t.publishWebTemplatePermission||!1}async filterResources(e){let t=await this._getWhiteUserPermission();return!this._configurationService.getAppConfigurationValue("vip.disableFilter")&&await (0,d.g)(t)&&(e.value.list=e.value.list.filter(e=>!e.isVip)),e}get resourceType(){return s.g.SpecialEffect}parseHeycanResponseDataToResources(e){return(0,o.h)(e)}constructor(e,t,r,i){super(e),this._effectAbTestService=t,this._userPermissionDataService=r,this._configurationService=i}}h=(0,i.gn)([(0,i.fM)(0,u.Gw),(0,i.fM)(1,c.c),(0,i.fM)(2,l.c),(0,i.fM)(3,_.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===u.Gw?Object:u.Gw,void 0===c.c?Object:c.c,void 0===l.c?Object:l.c,void 0===_.Ui?Object:_.Ui])],h)},494158:function(e,t,r){r.d(t,{h:function(){return u}});var i=r(889862),s=r(273340),n=r(127830),o=r(249656),a=r(981632),c=r(977442);function u(e){var t;let r=(0,i.E)(e,n._g.Effects),{effect_duration:u,model_names:l,requirements:d=[]}=e.special_effect,_=[],h=(e.common_attr.labels?(0,a.D)(e.common_attr.labels):[]).map(e=>String(null==e?void 0:e.id));try{if(l){let e=JSON.parse(l);_=Object.values(e).reduce((e,t)=>[...e,...t],[])}else _=r.modelNames||[]}catch(e){}let p=e=>{var t;let r=e.match(/^(http:.+\/)[0-9a-z]+$/g);return null!==(t=null==r?void 0:r[0])&&void 0!==t?t:e},g=(0,a.D)(e.common_attr.sdk_extra);return{key:`${n._g.Effects}_${r.resourceId}`,resourceId:r.resourceId,effectId:r.effectId,md5:r.md5,name:r.title,isVip:r.isVip,isBusiness:r.isBusiness,icon:{uri:p(r.coverUrl),urlList:[r.coverUrl]},previewUrl:r.coverUrl,package:{uri:p(r.originUrl),urlList:[r.originUrl]},source:null!==(t=r.source)&&void 0!==t?t:o.Hw.LOKI,sdkVersion:"",adjustParams:(0,c.U)(g.setting),effectDuration:u,effectType:r.effectType===s.g.SpecialEffect?n._g.Effects:n._g.FaceProp,modelNames:_,requirements:d.length?d:r.requirements,isPrefab:!1,labels:h}}},229622:function(e,t,r){r.d(t,{qi:function(){return u},vf:function(){return l}});var i=r(889862),s=r(127830),n=r(977442),o=r(32372),a=r(981632);function c(e,t){var r,s;let c=(0,i.E)(e,t),u=(0,a.D)(e.common_attr.sdk_extra),l=(e.common_attr.labels?(0,a.D)(e.common_attr.labels):[]).map(e=>String(null==e?void 0:e.id));return{key:`${t}_${c.resourceId}`,resourceId:c.resourceId,effectId:c.effectId,md5:c.md5,name:c.title,isBusiness:c.isBusiness,isVip:c.isVip,icon:{uri:c.coverUrl,urlList:[c.coverUrl]},previewUrl:c.coverUrl,package:{uri:(0,o.s)(c.originUrl),urlList:[c.originUrl]},source:c.source,sdkVersion:"",isPrefab:c.isPrefab,adjustParams:(0,n.U)(null==u?void 0:u.setting),effectDuration:(null===(r=e.special_effect)||void 0===r?void 0:r.effect_duration)||0,modelNames:c.modelNames,requirements:c.requirements,thirdResourceId:null!==(s=e.common_attr.third_resource_id_str)&&void 0!==s?s:e.common_attr.third_resource_id,isFavorite:c.isFavorite,labels:l}}function u(e){return{...c(e,s._g.Effects),effectType:s._g.Effects}}function l(e){return{...c(e,s._g.FaceProp),effectType:s._g.FaceProp}}},568625:function(e,t,r){r.d(t,{F:function(){return o}});var i=r(127830),s=r(412497),n=r(148163);class o extends s.r{get resourceType(){return i._g.Emoji}parseEffectsToResources(e){return e.map(e=>(0,n.B)(e))}}},518683:function(e,t,r){r.d(t,{v:function(){return o}});var i=r(773943),s=r(148163),n=r(127830);class o extends i.b{buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return n._g.Emoji}parseEffectsToResources(e,t){return e.map(e=>(0,s.B)(e,t))}}},143177:function(e,t,r){r.d(t,{x:function(){return a}});var i=r(273340),s=r(767528),n=r(789869),o=r(33883);class a extends n.A{get resourceType(){return i.g.Emoji}get resourcePanelType(){return o.q.Emoji}parseHeycanResponseDataToResources(e){return(0,s.F)(e)}}},768098:function(e,t,r){r.d(t,{s:function(){return a}});var i=r(758027),s=r(127830),n=r(33883),o=r(767528);class a extends i.B{get resourceType(){return s._g.Emoji}get resourcePanelType(){return n.q.Emoji}parseHeycanResponseDataToResources(e){return(0,o.F)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource||"heycan",category_id:Number(e.category),pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}},148163:function(e,t,r){r.d(t,{B:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r,extra:n}=(0,i.sh)(s._g.Emoji,e,t);return{...r}}},627084:function(e,t,r){r.d(t,{o:function(){return i}});let i=(0,r(335290).yh)("evercloud-token-data-service")},529948:function(e,t,r){r.d(t,{n:()=>p});var i=r("789786"),s=r("690613"),n=r("114861"),o=r("405051"),a=r("121130"),c=r("894339"),u=r("786022"),l=r("768101"),d=r("121305"),_=r("966697"),h=r("690465");class p{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.i3)(e),(0,c.mH)(e),(0,n.V)(e),e}()),this._networkClientInstance}get _api(){return this._httpApiSettingService.getRequestURL({domainType:h.Y.DEFAULT,path:d.b.GET_EVERCLOUD_TOKEN})}async getEvercloudToken(){try{var e,t;let r=await this._networkClient.post(this._api,{app_id:u.kJ,region:this._capcutAccountService.region},{withCredentials:!0});if("0"!==r.ret){;return(0,s.wf)(Number(r.ret),null!==(e=r.errmsg)&&void 0!==e?e:"")}return(0,s.oW)({token:(t=r).data.token,everPhotoUser:{userId:t.data.ever_photo_user.user_id,webUserId:t.data.ever_photo_user.web_user_id}})}catch(e){return(0,l.m)(e,-1,"getEvercloudToken api error")}}constructor(e,t){this._capcutAccountService=e,this._httpApiSettingService=t}}p=(0,i.gn)([(0,i.fM)(0,_.Gw),(0,i.fM)(1,h.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.Gw?Object:_.Gw,void 0===h.x?Object:h.x])],p)},263539:function(e,t,r){r.d(t,{E:function(){return i}});let i=(0,r(335290).yh)("filter-data-service")},738253:function(e,t,r){r.d(t,{T:()=>b});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("652705"),a=r("722807"),c=r("127830"),u=r("512363");class l extends u.L{parseDetailToResources(e){return(0,a.y)(e)}get resourceType(){return c._g.Filter}}var d=r("955977"),_=r("273340"),h=r("955310"),p=r("789869"),g=r("33883");class y extends p.A{get resourceType(){return _.g.Filter}get resourcePanelType(){return g.q.Filter}parseHeycanResponseDataToResources(e){return(0,h.Q)(e)}}var f=r("734372"),v=r("872443");class m extends v.L{get resourceType(){return c._g.Filter}get resourcePanelType(){return g.q.Filter}parseHeycanResponseDataToResources(e){return(0,h.Q)(e)}buildCustomRequest(e){var t,r;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t,only_commercial:null!==(r=e.onlyCommercial)&&void 0!==r&&r,image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}var w=r("744268"),k=r("736031"),T=r("249656"),R=r("305301");class b extends n.JT{async getFilter(e){let t=await (0,k.bY)(this._configurationService,k.Jk);return"vimo"===(0,k.lo)(t,this._getHeycanFilterByCategoryRepository.resourcePanelType).panel_path?this._getHeycanFilterByCategoryRepository.getResources((0,k.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._filterRepository.getResources(e)}async batchGetFiltersByIds(e){if(e.source===T.Hw.LOKI)return this._batchGetFilterRepository.batchGetResources(e);{let t=await (0,k.bY)(this._configurationService,k.Jk);return"loki"===(0,k.lo)(t,this._batchGetHeycanFilterRepository.resourcePanelType).panel_path&&e.source!==T.Hw.HEYCAN?this._batchGetFilterRepository.batchGetResources(e):this._batchGetHeycanFilterRepository.batchGetResources((0,R.Q)(e.ids,this._batchGetHeycanFilterRepository.resourceType,e.source))}}async getFilterCategories(e){let t=await (0,k.bY)(this._configurationService,k.Jk);return"vimo"===(0,k.lo)(t,this._getHeycanFilterCategoriesRepository.resourcePanelType).panel_path?this._getHeycanFilterCategoriesRepository.getCategories((0,k.lY)(e,t)):this._getFilterCategoriesRepository.getCategories(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._filterRepository=this._instantiationService.createInstance(d.p),this._batchGetFilterRepository=this._instantiationService.createInstance(o.i),this._getFilterCategoriesRepository=this._instantiationService.createInstance(l),this._getHeycanFilterByCategoryRepository=this._instantiationService.createInstance(f.c),this._getHeycanFilterCategoriesRepository=this._instantiationService.createInstance(m),this._batchGetHeycanFilterRepository=this._instantiationService.createInstance(y)}}b=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,w.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===w.Ui?Object:w.Ui])],b)},722807:function(e,t,r){r.d(t,{y:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r}=(0,i.sh)(s._g.Filter,e,t);return{...r}}},110608:function(e,t,r){r.d(t,{H:function(){return i}});let i=(0,r(335290).yh)("font-data-service")},810005:function(e,t,r){r.d(t,{q:()=>$});var i,s,n=r("789786"),o=r("55449"),a=r("402655"),c=r("127830"),u=r("412497"),l=r("899797");class d extends u.r{get resourceType(){return c._g.Font}parseEffectsToResources(e){return e.map(e=>(0,l.ey)(e))}}var _=r("540907"),h=r("512363");class p extends h.L{get resourceType(){return c._g.Font}}var g=r("393958"),y=r("565520");class f extends g.h{get brandResourceType(){return y.Q.Font}parseResponseDataToResources(e){return(0,l.ey)(e,void 0,!0)}}var v=r("740446");class m extends v.i{parseResponseDataToResources(e){return(0,l.ey)(e,void 0,!0)}}var w=((i={}).Loki="loki",i);var k=((s={})[s.CN=2515]="CN",s[s.OVERSEAS=7356]="OVERSEAS",s),T=r("744268"),R=r("544688"),b=r("33883"),S=r("872443"),C=r("200247"),I=r("916636"),P=r("690465"),E=r("685795"),A=r("332557"),M=r("847083");class x extends S.L{get resourceType(){return c._g.Font}get resourcePanelType(){return b.q.DreaminaFont}parseHeycanResponseDataToResources(e){return(0,l.es)(e)}buildCustomRequest(e){var t;return{panel_source:w.Loki,app_id:null!==(t=e.appID)&&void 0!==t?t:513695,loki_opt:{loki_biz_id:k.CN}}}constructor(e,t,r,i,s,n,o,a){super(e,t,r,i,s,n,o,a)}}x=(0,n.gn)([(0,n.fM)(0,C.D),(0,n.fM)(1,I.c),(0,n.fM)(2,R.c),(0,n.fM)(3,T.Ui),(0,n.fM)(4,P.x),(0,n.fM)(5,E.L),(0,n.fM)(6,A.U),(0,n.fM)(7,M.a),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===C.D?Object:C.D,void 0===I.c?Object:I.c,void 0===R.c?Object:R.c,void 0===T.Ui?Object:T.Ui,void 0===P.x?Object:P.x,void 0===E.L?Object:E.L,void 0===A.U?Object:A.U,void 0===M.a?Object:M.a])],x);var O=r("758027"),F=r("502600");class D extends O.B{get resourceType(){return c._g.Font}get resourcePanelType(){return this._configurationService.resourcePanel[c._g.Font]}get getResourcesApi(){return`${this._httpApiSettingService.getRequestURL({domainType:P.Y.DEFAULT,path:F.bl.GET_CATEGORY_RESOURCE})}`}parseHeycanResponseDataToResources(e){return(0,l.es)(e)}buildCustomFilterParams(){return Promise.resolve({})}buildCustomRequest(e){var t;return{category_key:e.category,panel:this._configurationService.resourcePanel[c._g.Font],panel_source:w.Loki,app_id:null!==(t=e.appID)&&void 0!==t?t:513695,loki_opt:{loki_biz_id:e.lokiAppID}}}constructor(e,t,r,i,s,n,o,a){super(e,t,r,i,n,o,a),this._httpApiSettingService=s}}D=(0,n.gn)([(0,n.fM)(0,C.D),(0,n.fM)(1,R.c),(0,n.fM)(2,I.c),(0,n.fM)(3,T.Ui),(0,n.fM)(4,P.x),(0,n.fM)(5,E.L),(0,n.fM)(6,M.a),(0,n.fM)(7,A.U),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===C.D?Object:C.D,void 0===R.c?Object:R.c,void 0===I.c?Object:I.c,void 0===T.Ui?Object:T.Ui,void 0===P.x?Object:P.x,void 0===E.L?Object:E.L,void 0===M.a?Object:M.a,void 0===A.U?Object:A.U])],D);var L=r("249656"),U=r("966697"),B=r("273340"),G=r("820590"),j=r("789869");class V extends j.A{get resourceType(){return B.g.Font}get resourcePanelType(){return b.q.Font}parseHeycanResponseDataToResources(e){return(0,G.n)(e)}constructor(e,t){super(e,t)}}V=(0,n.gn)([(0,n.fM)(0,U.Gw),(0,n.fM)(1,E.L),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===U.Gw?Object:U.Gw,void 0===E.L?Object:E.L])],V);class H extends O.B{get resourceType(){return c._g.Font}get resourcePanelType(){return b.q.Font}parseHeycanResponseDataToResources(e){return(0,G.n)(e)}buildCustomRequest(e){var t,r;return{panel:e.panel,client_ab_param:e.clientABParam,panel_source:e.panelSource,category_id:Number(e.categoryId),pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t,only_commercial:null!==(r=e.onlyCommercial)&&void 0!==r&&r}}}}var N=r("345577"),q=r("736031"),Y=r("305301");class $ extends a.JT{async getFont(e){return await (0,q._Q)(this._configurationService,this._getHeycanFontByCategoryRepository.resourcePanelType)?this._getHeycanFontByCategoryRepository.getResources(e):this._fontRepository.getResources(e)}getBrandFonts(e){return this._getBrandFontsRepository.getResources(e)}async batchGetFontsByIds(e){let{isFromBrand:t=!1}=e;if(t)return this._getBrandFontsByIdsRepository.getResourcesByIds(e);if(e.source===L.Hw.LOKI)return this._batchGetFontRepository.batchGetResources(e);{let t=await (0,q.bY)(this._configurationService);return"loki"===(0,q.lo)(t,this._batchGetHeycanFontRepository.resourcePanelType).panel_path&&e.source!==L.Hw.HEYCAN?this._batchGetFontRepository.batchGetResources(e):this._batchGetHeycanFontRepository.batchGetResources((0,Y.Q)(e.ids,this._batchGetHeycanFontRepository.resourceType,e.source))}}async getFontCategories(e){let t=await (0,q.bY)(this._configurationService);return"vimo"===(0,q.lo)(t,this._getHeycanFontCategoriesRepository.resourcePanelType).panel_path?this._getHeycanFontCategoriesRepository.getCategories((0,q.lY)(e,t)):this._getFontCategoriesRepository.getCategories(e)}getDreaminaFontCategories(){return this._getDreaminaFontCategoriesRepository.getCategories({panelSource:w.Loki,appID:513695})}getDreaminaFonts(e){return this._getDreaminaFontsRespository.getResources(e)}constructor(e={},t,r){super(),this._options=e,this._instantiationService=t,this._configurationService=r,this._fontRepository=this._instantiationService.createInstance(_.T),this._batchGetFontRepository=this._instantiationService.createInstance(d),this._getFontCategoriesRepository=this._instantiationService.createInstance(p),this._getBrandFontsRepository=this._instantiationService.createInstance(f),this._getBrandFontsByIdsRepository=this._instantiationService.createInstance(m),this._getDreaminaFontCategoriesRepository=this._instantiationService.createInstance(x),this._getDreaminaFontsRespository=this._instantiationService.createInstance(D),this._getHeycanFontByCategoryRepository=this._instantiationService.createInstance(H),this._getHeycanFontCategoriesRepository=this._instantiationService.createInstance(N.K),this._batchGetHeycanFontRepository=this._instantiationService.createInstance(V),this._options.fixedRegion&&(this._getHeycanFontCategoriesRepository.setFixedRegion(this._options.fixedRegion),this._getHeycanFontByCategoryRepository.setFixedRegion(this._options.fixedRegion))}}$=(0,n.gn)([(0,n.fM)(1,o.T),(0,n.fM)(2,T.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,void 0===o.T?Object:o.T,void 0===T.Ui?Object:T.Ui])],$)},313164:function(e,t,r){r.d(t,{D:function(){return i}});let i=(0,r(335290).yh)("frame-data-service")},651998:function(e,t,r){r.d(t,{z:function(){return d}});var i=r(702049),s=r(405051),n=r(121130),o=r(894339),a=r(768101),c=r(690613),u=r(114861),l=r(116010);class d{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new s.yk().build({headers:{"Content-Type":"application/json"}});return(0,n.i3)(e),(0,o.mH)(e),(0,u.V)(e),e}()),this._networkClientInstance}get _createFrameApi(){return`${i._L.getVar("web_domain")}${l.b.CREATE_DRAW_FRAME_TASK}`}get _queryFrameApi(){return`${i._L.getVar("web_domain")}${l.b.QUERY_DRAW_FRAME_TASK}`}async createDrawFrameTask(e){try{var t,r;let i=await this._networkClient.post(this._createFrameApi,{...e},{withCredentials:!0});if("0"!==i.ret)return(0,c.wf)(Number(i.ret),i.errmsg);return(0,c.oW)({taskId:null===(t=i.data)||void 0===t?void 0:t.task_id,reqId:null===(r=i.data)||void 0===r?void 0:r.req_id})}catch(e){return(0,a.m)(e,-1,"create drawFrame task api error.")}}async queryDrawFrameTask(e){try{var t,r;let i=await this._networkClient.post(this._queryFrameApi,{...e},{withCredentials:!0});if("0"!==i.ret)return(0,c.wf)(Number(i.ret),i.errmsg);return(0,c.oW)({status:null===(t=i.data)||void 0===t?void 0:t.status,md5:null===(r=i.data)||void 0===r?void 0:r.md5})}catch(e){return(0,a.m)(e,-1,"get drawFrame task api error.")}}}},249833:function(e,t,r){r.d(t,{b:function(){return i}});let i={TRENDING:"/artist/v1/library/giphy/trending",SEARCH:"/artist/v1/library/giphy/search",SEARCH_WORDS:"/artist/v1/library/giphy/search_words",MGET_BY_IDS:"/artist/v1/library/giphy/mget_by_ids"}},743327:function(e,t,r){r.d(t,{P:()=>R});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("702049"),u=r("405051"),l=r("121130"),d=r("866006"),_=r("966697"),h=r("249833"),p=r("620090"),g=r("801497"),y=r("606805"),f=r("768101");class v{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.i3)(e),(0,a.V)(e),e}()),this._networkClientInstance}async getGifsByCategory(e){let t=(0,d.ky)(e)?e.config:e;try{var r,i;let s=await this._networkClient.post(this._api,{type:t.category,...this._getTokenParams(e)},(0,y._)(this._capcutAccountService.userProfile.region,g.ZP.language)),n=Number(null!==(r=s.ret)&&void 0!==r?r:0),a=null!==(i=s.errmsg)&&void 0!==i?i:"";if(0!==n)return(0,o.wf)(null!=n?n:-1,null!=a?a:"");let c=this._convertResponseToQueryToken(t,s);return(0,o.oW)(c)}catch(e){return(0,f.m)(e,-1,"getGifs api error")}}_getTokenParams(e){var t,r;return(0,d.ky)(e)?{offset:e.offset,count:null!==(t=e.config.limit)&&void 0!==t?t:50}:{offset:0,count:null!==(r=e.limit)&&void 0!==r?r:50}}_convertResponseToQueryToken(e,t){let{data:r}=t,i=r.next_offset,s=r.has_more,n=r.library_item_list.map(e=>(0,p.g)(e));return(0,d.ib)(e,{list:n},{hasMore:s,offset:i})}get _api(){return`${c._L.getVar("web_domain")}${h.b.TRENDING}`}constructor(e){this._capcutAccountService=e}}v=(0,i.gn)([(0,i.fM)(0,_.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.Gw?Object:_.Gw])],v);var m=r("409565");class w{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,m.Y)(e),(0,a.V)(e),e}()),this._networkClientInstance}async searchGifs(e){let t=(0,d.ky)(e)?e.config:e;try{var r,i;let s=await this._networkClient.post(this._api,{type:t.category,from:t.from,query:t.query,...this._getTokenParams(e)},(0,y._)(this._capcutAccountService.userProfile.region,g.ZP.language)),n=Number(null!==(r=s.ret)&&void 0!==r?r:0),a=null!==(i=s.errmsg)&&void 0!==i?i:"";if(![0,2013].includes(n)){if(1e3===n)return(0,o.wf)(null!=n?n:-1,g.ZP.t("the_keyword_is_invalid__please_re_enter",{},"\u5173\u952E\u8BCD\u65E0\u6548\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"));return(0,o.wf)(null!=n?n:-1,null!=a?a:"")}let c=this._convertResponseToQueryToken(t,s);return(0,o.oW)(c)}catch(e){if("1000"===e.ret||"2013"===e.ret)return(0,o.wf)(Number(e.ret),g.ZP.t("the_keyword_is_invalid__please_re_enter",{},"\u5173\u952E\u8BCD\u65E0\u6548\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165"));return(0,f.m)(e,-1,"searchGifs api error")}}_getTokenParams(e){var t,r;return(0,d.ky)(e)?{offset:e.offset,count:null!==(t=e.config.limit)&&void 0!==t?t:50}:{offset:0,count:null!==(r=e.limit)&&void 0!==r?r:50}}_convertResponseToQueryToken(e,t){let{data:r}=t,i=r.next_offset,s=r.has_more,n=r.library_item_list.map(e=>(0,p.g)(e));return(0,d.ib)(e,{list:n,requestId:t.logid},{hasMore:s,offset:i})}get _api(){return`${c._L.getVar("web_domain")}${h.b.SEARCH}`}constructor(e){this._capcutAccountService=e}}w=(0,i.gn)([(0,i.fM)(0,_.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.Gw?Object:_.Gw])],w);var k=r("896002"),T=r("846760");class R extends n.JT{getGifsByCategory(e){return this._getGifsByCategoryRepository.getGifsByCategory(e)}getGifsByIds(e){return this._getGifsByIdsRepository.getGifsByIds(e)}getTrendingSearchWords(){return this._getTrendingSearchWordsRepository.getTrendingSearchWords()}searchGifs(e){return this._searchGifsRepository.searchGifs(e)}constructor(e){super(),this._instantiationService=e,this._getGifsByCategoryRepository=this._instantiationService.createInstance(v),this._searchGifsRepository=this._instantiationService.createInstance(w),this._getGifsByIdsRepository=this._instantiationService.createInstance(k.d),this._getTrendingSearchWordsRepository=this._instantiationService.createInstance(T.x)}}R=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],R)},620090:function(e,t,r){r.d(t,{g:function(){return i}});function i(e){var t,r,i,s,n,o;return{aspectRatio:e.images.small.width/e.images.small.height,key:e.id,id:e.id,category:e.type,name:e.title,coverUrl:e.images.static_img.image_url,animatedUrl:e.images.small.image_url,author:{name:null!==(s=null===(t=e.author)||void 0===t?void 0:t.name)&&void 0!==s?s:"",description:null!==(n=null===(r=e.author)||void 0===r?void 0:r.description)&&void 0!==n?n:"",avatarUrl:null!==(o=null===(i=e.author)||void 0===i?void 0:i.avatar_url)&&void 0!==o?o:""},transcode:{small:{url:e.images.small.image_url,width:e.images.small.width,height:e.images.small.height},medium:{url:e.images.medium.image_url,width:e.images.medium.width,height:e.images.medium.height},large:{url:e.images.large.image_url,width:e.images.large.width,height:e.images.large.height},static:{url:e.images.static_img.image_url,width:e.images.static_img.width,height:e.images.static_img.height}},duration:0,isBusiness:!1,isVip:!1}}},287524:function(e,t,r){r.d(t,{a:function(){return i}});let i=(0,r(335290).yh)("graffiti-data-service")},50580:function(e,t,r){r.d(t,{K:function(){return o}});var i=r(773943),s=r(750503),n=r(127830);class o extends i.b{buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return n._g.Graffiti}parseEffectsToResources(e,t){return e.map(e=>(0,s.H)(e,t))}}},750503:function(e,t,r){r.d(t,{H:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r}=(0,i.sh)(s._g.Graffiti,e,t);return{...r}}},555515:function(e,t,r){r.d(t,{m:()=>p});var i=r("789786"),s=r("55449"),n=r("690613"),o=r("768101"),a=r("629351"),c=r("405051"),u=r("121130"),l=r("114861"),d=r("470824"),_=r("690465");class h{async getUploadToken(e){try{let t=await this._networkClient.post(this._httpApiSettingService.getRequestURL({domainType:_.Y.DEFAULT,path:d.K.getUploadToken}),e,{withCredentials:!0});return(0,n.oW)(this._convertUploadTokenFromServer(t.data))}catch(e){return(0,o.m)(e)}}_convertUploadTokenFromServer(e){return{accessKeyId:e.access_key_id,secretAccessKey:e.secret_access_key,sessionToken:e.session_token,expiredTime:e.expired_time,currentTime:e.current_time,spaceName:e.space_name,uploadDomain:e.upload_domain,spaceType:e.space_type,region:e.region}}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build(c.kk);return(0,u.i3)(e),(0,l.V)(e),(0,a.V)(e,{appVersion:""}),e}()),this._networkClientInstance}constructor(e){this._httpApiSettingService=e}}h=(0,i.gn)([(0,i.fM)(0,_.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===_.x?Object:_.x])],h);class p{getUploadToken(e){return this._getUploadTokenRepository.getUploadToken(e)}constructor(e){this._instantiationService=e,this._getUploadTokenRepository=this._instantiationService.createInstance(h)}}p=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],p)},416347:function(e,t,r){r.d(t,{x:function(){return i}});let i=(0,r(335290).yh)("image-figure-effect-data-service")},59315:function(e,t,r){r.d(t,{m:function(){return i}});let i=(0,r(335290).yh)("integration-data-service")},39039:function(e,t,r){r.d(t,{X:function(){return o}});var i=r(773943),s=r(669773),n=r(127830);class o extends i.b{buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return n._g.Integration}parseEffectsToResources(e,t){return e.map(e=>(0,s.f)(e,t))}}},883224:function(e,t,r){r.d(t,{W:function(){return a}});var i=r(758027),s=r(127830),n=r(33883),o=r(801363);class a extends i.B{get resourceType(){return s._g.Integration}get resourcePanelType(){return n.q.Integration}parseHeycanResponseDataToResources(e){return(0,o.O)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource||"heycan",category_id:Number(e.category),pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}},801363:function(e,t,r){r.d(t,{O:function(){return a}});var i=r(889862),s=r(127830),n=r(32372),o=r(134429);function a(e){let t=(0,i.E)(e,s._g.Integration);return{...t,key:`${s._g.Integration}_${t.resourceId}`,name:t.title,icon:{uri:(0,n.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,n.s)(t.originUrl),urlList:[t.originUrl]},sdkVersion:o.f4}}},968474:function(e,t,r){r.d(t,{l:function(){return i}});let i=(0,r(335290).yh)("language-data-service")},468661:function(e,t,r){r.d(t,{T:()=>h});var i=r("690613"),s=r("114861"),n=r("702049"),o=r("405051"),a=r("121130"),c=r("894339"),u=r("768101");let l={DETECT_LANGUAGE:"/lv/v1/language/detect",TRANSLATE_LANGUAGE:"/lv/v1/language/translate"},d=e=>{let{target_language:t,source_language:r,subtitles:i}=e.data;return{targetLanguage:t,sourceLanguage:r,subTitles:i.map(e=>({sourceText:e.source_text,text:e.text,endTime:e.end_time,startTime:e.start_time}))}},_={0:"unspecified",1:"aa",2:"ab",3:"ae",4:"af",5:"ak",6:"am",7:"an",8:"ar",9:"as",10:"av",11:"ay",12:"az",13:"ba",14:"be",15:"bg",16:"bh",17:"bi",18:"bm",19:"bn",20:"bo",21:"br",22:"bs",23:"ca",24:"ce",25:"ch",26:"co",27:"cr",28:"cs",29:"cu",30:"cv",31:"cy",32:"da",33:"de",34:"dv",35:"dz",36:"ee",37:"el",38:"en",39:"eo",40:"es",41:"et",42:"eu",43:"fa",44:"ff",45:"fi",46:"fj",47:"fo",48:"fr",49:"fy",50:"ga",51:"gd",52:"gl",53:"gn",54:"gu",55:"gv",56:"ha",57:"he",58:"hi",59:"ho",60:"hr",61:"ht",62:"hu",63:"hy",64:"hz",65:"ia",66:"id",67:"ie",68:"ig",69:"ii",70:"ik",71:"io",72:"is",73:"it",74:"iu",75:"ja",76:"jv",77:"ka",78:"kg",79:"ki",80:"kj",81:"kk",82:"kl",83:"km",84:"kn",85:"ko",86:"kr",87:"ks",88:"ku",89:"kv",90:"kw",91:"ky",92:"la",93:"lb",94:"lg",95:"li",96:"ln",97:"lo",98:"lt",99:"lu",100:"lv",101:"mg",102:"mh",103:"mi",104:"mk",105:"ml",106:"mn",107:"mo",108:"mr",109:"ms",110:"mt",111:"my",112:"na",113:"nb",114:"nd",115:"ne",116:"ng",117:"nl",118:"nn",119:"no",120:"nr",121:"nv",122:"ny",123:"oc",124:"oj",125:"om",126:"or",127:"os",128:"pa",129:"pi",130:"pl",131:"ps",132:"pt",133:"qu",134:"rm",135:"rn",136:"ro",137:"ru",138:"rw",139:"sa",140:"sc",141:"sd",142:"se",143:"sg",144:"sh",145:"si",146:"sk",147:"sl",148:"sm",149:"sn",150:"so",151:"sq",152:"sr",153:"ss",154:"st",155:"su",156:"sv",157:"sw",158:"ta",159:"te",160:"tg",161:"th",162:"ti",163:"tk",164:"tl",165:"tn",166:"to",167:"tr",168:"ts",169:"tt",170:"tw",171:"ty",172:"ug",173:"uk",174:"ur",175:"uz",176:"ve",177:"vi",178:"vo",179:"wa",180:"wo",181:"xh",182:"yi",183:"yo",184:"za",185:"zh",186:"zu",1001:"hi-Latn",1002:"zh-Hant",1004:"zh-Hant-TW",1003:"zh-Hant-HK",2001:"ceb",2002:"ckb",2003:"kmr",2004:"umb",2005:"nso",2006:"kam",2007:"luo",2008:"fuv",3001:"lzh"};class h{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.i3)(e),(0,c.mH)(e),(0,s.V)(e),e}()),this._networkClientInstance}_getApi(e){return`${n._L.getVar("web_domain")}${e}`}async detectLanguage(e){try{let r=await this._networkClient.post(this._getApi(l.DETECT_LANGUAGE),{detect_text:e.text});if("0"!==r.ret){var t;return(0,i.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,i.oW)({code:r.data.language_code,name:r.data.language_name,languageCode:_[r.data.language_code]})}catch(e){return(0,u.m)(e,-1,"detectLanguage api error")}}async translateLanguage(e){try{let r=await this._networkClient.post(this._getApi(l.TRANSLATE_LANGUAGE),{target_language:e.targetLanguage,source_language:e.sourceLanguage,tmp_id:e.tmpId,subtitles:e.subTitles.map(e=>({start_time:e.startTime,end_time:e.endTime,text:e.text}))});if("0"!==r.ret&&"200703"!==r.ret){var t;return(0,i.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,i.oW)(d(r))}catch(e){return(0,u.m)(e,-1,"translateLanguage api error")}}}},198104:function(e,t,r){r.d(t,{n:function(){return i}});let i=(0,r(335290).yh)("mask-data-service")},726258:function(e,t,r){r.d(t,{h:function(){return o}});var i=r(127830),s=r(412497),n=r(905449);class o extends s.r{get resourceType(){return i._g.Mask}parseEffectsToResources(e){return e.map(e=>(0,n.m)(e))}}},479657:function(e,t,r){r.d(t,{R:function(){return a}});var i=r(127830),s=r(872443),n=r(33883),o=r(495719);class a extends s.L{get resourcePanelType(){return n.q.AiAvatarMask}get resourceType(){return i._g.AiAvatarMask}parseHeycanResponseDataToResources(e){return(0,o.q)(e)}buildCustomRequestParams(){return{use_region:1,region:"US"}}}},660056:function(e,t,r){r.d(t,{d:function(){return n}});var i=r(127830),s=r(512363);class n extends s.L{get resourceType(){return i._g.Mask}}},791569:function(e,t,r){r.d(t,{z:function(){return a}});var i=r(758027),s=r(127830),n=r(33883),o=r(574329);class a extends i.B{get resourceType(){return s._g.Mask}get resourcePanelType(){return n.q.Mask}parseHeycanResponseDataToResources(e){return(0,o.B)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource||"heycan",category_id:Number(e.category),pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}},495719:function(e,t,r){r.d(t,{q:function(){return o}});var i=r(127830),s=r(889862),n=r(32372);function o(e){let t=(0,s.E)(e,i._g.AiAvatarMask);return{...t,name:t.title,package:{uri:(0,n.s)(t.originUrl),urlList:[t.originUrl]},icon:{uri:(0,n.s)(t.coverUrl),urlList:[t.coverUrl]},sdkVersion:"",previewUrl:t.coverUrl,maskType:"",themeIcon:{dark:{uri:"",urlList:[""]},light:{uri:"",urlList:[""]}}}}},574329:function(e,t,r){r.d(t,{B:function(){return c}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372),a=r(134429);function c(e){let t=(0,i.E)(e,s._g.Mask),r=(0,n.D)(e.common_attr.extra);return{...t,key:`${s._g.Mask}_${t.resourceId}`,name:t.title,icon:{uri:(0,o.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,o.s)(t.originUrl),urlList:[t.originUrl]},sdkVersion:a.f4,maskType:r.resource_type,themeIcon:{dark:{uri:r.dark_icon?(0,o.s)(r.dark_icon):"",urlList:[r.dark_icon]},light:{uri:r.dark_icon?(0,o.s)(r.dark_icon):"",urlList:[r.light_icon]}}}}},164479:function(e,t,r){r.d(t,{H:function(){return i}});let i=(0,r(335290).yh)("matting-stroke-data-service")},244393:function(e,t,r){r.d(t,{f:()=>v});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("801388");class u extends a.r{get resourceType(){return o._g.MattingStroke}parseEffectsToResources(e){return e.map(e=>(0,c.K)(e))}}var l=r("773943");class d extends l.b{buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return o._g.MattingStroke}parseEffectsToResources(e,t){return e.map(e=>(0,c.K)(e,t))}}var _=r("503901"),h=r("63862"),p=r("744268"),g=r("736031"),y=r("249656"),f=r("305301");class v extends n.JT{async getMattingStroke(e){let t=await (0,g.bY)(this._configurationService,g.Jk);return"vimo"===(0,g.lo)(t,this._getHeycanMattingStrokeByCategoryRepository.resourcePanelType).panel_path?this._getHeycanMattingStrokeByCategoryRepository.getResources((0,g.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._mattingStrokeRepository.getResources(e)}async batchGetMattingStrokesByIds(e){if(e.source===y.Hw.HEYCAN){let t=await (0,g.bY)(this._configurationService,g.Jk);return"loki"===(0,g.lo)(t,this._batchGetHeycanMattingStrokeRepository.resourcePanelType).panel_path&&e.source!==y.Hw.HEYCAN?this._batchGetMattingStrokeRepository.batchGetResources(e):this._batchGetHeycanMattingStrokeRepository.batchGetResources((0,f.Q)(e.ids,this._batchGetHeycanMattingStrokeRepository.resourceType,e.source))}return this._batchGetMattingStrokeRepository.batchGetResources(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._mattingStrokeRepository=this._instantiationService.createInstance(d),this._batchGetMattingStrokeRepository=this._instantiationService.createInstance(u),this._getHeycanMattingStrokeByCategoryRepository=this._instantiationService.createInstance(h.G),this._batchGetHeycanMattingStrokeRepository=this._instantiationService.createInstance(_.J)}}v=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,p.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===p.Ui?Object:p.Ui])],v)},801388:function(e,t,r){r.d(t,{K:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){var r;let{common:n}=(0,i.sh)(s._g.MattingStroke,e,t),o=null!==(r=n.modelNames)&&void 0!==r?r:[];return!o.includes("tt_matting_video")&&o.push("tt_matting_video"),{...n,modelNames:o}}},287462:function(e,t,r){r.d(t,{m:function(){return i}});let i=(0,r(335290).yh)("mix-data-service")},176047:function(e,t,r){r.d(t,{h:()=>T});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("179314");class u extends a.r{get resourceType(){return o._g.Mix}parseEffectsToResources(e){return e.map(e=>(0,c.H)(e))}}var l=r("773943");class d extends l.b{buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return o._g.Mix}parseEffectsToResources(e,t){return e.map(e=>(0,c.H)(e,t))}}var _=r("736031"),h=r("249656"),p=r("305301"),g=r("438148"),y=r("81162"),f=r("872443"),v=r("33883"),m=r("998342");class w extends f.L{get resourceType(){return o._g.Mix}get resourcePanelType(){return v.q.Mix}parseHeycanResponseDataToResources(e){return(0,m.n)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}var k=r("744268");class T extends n.JT{async getMix(e){let t=await (0,_.bY)(this._configurationService,_.$0);return"vimo"===(0,_.lo)(t,this._getHeycanMixByCategoryRepository.resourcePanelType).panel_path?this._getHeycanMixByCategoryRepository.getResources((0,_.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._mixRepository.getResources(e)}async getMixCategories(e){let t=await (0,_.bY)(this._configurationService,_.$0);return this._getHeycanMixCategoriesRepository.getCategories((0,_.lY)(e,t))}async batchGetMixsByIds(e){if(e.source===h.Hw.LOKI)return this._batchGetMixRepository.batchGetResources(e);{let t=await (0,_.bY)(this._configurationService,_.$0);return"loki"===(0,_.lo)(t,this._batchGetHeycanMixRepository.resourcePanelType).panel_path&&e.source!==h.Hw.HEYCAN?this._batchGetMixRepository.batchGetResources(e):this._batchGetHeycanMixRepository.batchGetResources((0,p.Q)(e.ids,this._batchGetHeycanMixRepository.resourceType,e.source))}}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._mixRepository=this._instantiationService.createInstance(d),this._batchGetMixRepository=this._instantiationService.createInstance(u),this._getHeycanMixByCategoryRepository=this._instantiationService.createInstance(y._),this._getHeycanMixCategoriesRepository=this._instantiationService.createInstance(w),this._batchGetHeycanMixRepository=this._instantiationService.createInstance(g.m)}}T=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,k.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===k.Ui?Object:k.Ui])],T)},154007:function(e,t,r){r.d(t,{l:function(){return s}});var i,s=((i={})[i.transcoding=0]="transcoding",i[i.success=1]="success",i[i.fail=2]="fail",i)},73478:function(e,t,r){r.d(t,{b1:function(){return s}});let i=[{entrance:"editor",pathRegex:[/action=addDigitalHuman/]},{entrance:"tool",pathRegex:[/editor-tools\/long-video-to-shorts/,/editor-tools\/convert-script-to-video/,/editor-tools\/url-to-ads/]}];function s(){let e="";return i.forEach(t=>{t.pathRegex.forEach(r=>{var i;(null===(i=location.href.match(r))||void 0===i?void 0:i[0])&&(e=t.entrance)})}),e}},223706:function(e,t,r){r.d(t,{f:function(){return i}});let i=(0,r(335290).yh)("new-guide-user-data-service")},367846:function(e,t,r){r.d(t,{R:()=>d});var i=r("690613"),s=r("114861"),n=r("702049"),o=r("405051"),a=r("121130"),c=r("894339"),u=r("768101");let l="/lv/v1/user/web/is_video_active_user";class d{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.i3)(e),(0,c.mH)(e),(0,s.V)(e),e}()),this._networkClientInstance}get _api(){return`${n._L.getVar("web_domain")}${l}`}async getNewGuideUser(){try{let t=await this._networkClient.post(this._api,{},{withCredentials:!0});if("0"!==t.ret){var e;return(0,i.wf)(Number(t.ret),null!==(e=t.errmsg)&&void 0!==e?e:"")}let{is_video_active_user:r,active_time:s=Number(new Date)}=t.data;return(0,i.oW)({isActiveUser:r,activeTime:s})}catch(e){return(0,u.m)(e,-1,"getNewGuideUser api error")}}}},720709:function(e,t,r){r.d(t,{K:()=>d});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("777051");class u extends a.r{get resourceType(){return o._g.ObjectLock}parseEffectsToResources(e){return e.map(e=>(0,c.U)(e))}}var l=r("686247");class d extends n.JT{getObjectLock(e){return this._objectLockRepository.getResources(e)}batchGetObjectLocksByIds(e){return this._batchGetObjectLockRepository.batchGetResources(e)}constructor(e){super(),this._instantiationService=e,this._objectLockRepository=this._instantiationService.createInstance(l.P),this._batchGetObjectLockRepository=this._instantiationService.createInstance(u)}}d=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],d)},777051:function(e,t,r){r.d(t,{U:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r,extra:n}=(0,i.sh)(s._g.ObjectLock,e,t);return{...r}}},311452:function(e,t,r){r.d(t,{H:()=>v});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("547895");class u extends a.r{get resourceType(){return o._g.PathAnimation}parseEffectsToResources(e){return e.map(e=>(0,c.f)(e))}}var l=r("773943");class d extends l.b{buildCustomRequest(e){return{}}get resourceType(){return o._g.PathAnimation}parseEffectsToResources(e,t){return e.map(e=>(0,c.f)(e,t))}}var _=r("723476"),h=r("493168"),p=r("744268"),g=r("736031"),y=r("249656"),f=r("305301");class v extends n.JT{async getPathAnimation(e){let t=await (0,g.bY)(this._configurationService,g.Jk);return"vimo"===(0,g.lo)(t,this._getHeycanPathAnimationByCategoryRepository.resourcePanelType).panel_path?this._getHeycanPathAnimationByCategoryRepository.getResources((0,g.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._pathAnimationRepository.getResources(e)}async batchGetPathAnimationsByIds(e){if(e.source===y.Hw.HEYCAN){let t=await (0,g.bY)(this._configurationService,g.Jk);return"loki"===(0,g.lo)(t,this._batchGetHeycanPathAnimationRepository.resourcePanelType).panel_path&&e.source!==y.Hw.HEYCAN?this._batchGetPathAnimationRepository.batchGetResources(e):this._batchGetHeycanPathAnimationRepository.batchGetResources((0,f.Q)(e.ids,this._batchGetHeycanPathAnimationRepository.resourceType,e.source))}return this._batchGetPathAnimationRepository.batchGetResources(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._pathAnimationRepository=this._instantiationService.createInstance(d),this._batchGetPathAnimationRepository=this._instantiationService.createInstance(u),this._getHeycanPathAnimationByCategoryRepository=this._instantiationService.createInstance(h.a),this._batchGetHeycanPathAnimationRepository=this._instantiationService.createInstance(_.S)}}v=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,p.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===p.Ui?Object:p.Ui])],v)},547895:function(e,t,r){r.d(t,{f:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r}=(0,i.sh)(s._g.PathAnimation,e,t);return{...r}}},837477:function(e,t,r){r.d(t,{r:function(){return a}});var i=r(889862),s=r(127830),n=r(32372),o=r(134429);function a(e){let t=(0,i.E)(e,s._g.PathAnimation);return{...t,key:`${s._g.PathAnimation}_${t.resourceId}`,name:t.title,icon:{uri:(0,n.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:{uri:(0,n.s)(t.originUrl),urlList:[t.originUrl]},sdkVersion:o.f4}}},436202:function(e,t,r){r.d(t,{n:()=>h});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("405051"),u=r("653533");let l={JIANYING_DOWNLOAD_URL_JSON:u.K.PC_EDITOR_DOWNLOAD_URL_CONFIG,CAPCUT_DOWNLOAD_URL_JSON:u.K.PC_EDITOR_DOWNLOAD_URL_CONFIG};var d=r("181844");class _{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build();return(0,a.V)(e),e}()),this._networkClientInstance}async getDownloadUrlConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"channel_default";try{var t;let{data:r}=await this._networkClient.get(l.CAPCUT_DOWNLOAD_URL_JSON);if(!(null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.footerHeaderAndLinks))return(0,o.wf)(1,"get download url fail");let i=JSON.parse(r.data.footerHeaderAndLinks);if(!i.bee_dsrc_11969[0])return(0,o.wf)(1,"get download url fail");return(0,o.oW)((0,d.E)(i.bee_dsrc_11969[0],e))}catch(e){return(0,o.wf)(1,"get download url fail")}}}class h extends n.JT{getDownloadUrlConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"channel_default";return this._pcDownloadUrlRepository.getDownloadUrlConfig(e)}constructor(e){super(),this._instantiationService=e,this._pcDownloadUrlRepository=this._instantiationService.createInstance(_)}}h=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],h)},155101:function(e,t,r){r.d(t,{V:function(){return i}});let i=(0,r(335290).yh)("pc-download-url")},102593:function(e,t,r){r.d(t,{b:function(){return i}});let i={GET_SHARE_INFO:"/lv/v1/coordination/package/get_share_info",GET_WORKSPACE_INFO_EXTERNAL:"/cc/v1/workspace/get_workspace_info_external",APPLICATION_CREATE:"/lv/v1/coordination/package/application_create"}},549069:function(e,t,r){r.d(t,{P:()=>g});var i=r("789786"),s=r("55449"),n=r("690613"),o=r("114861"),a=r("405051"),c=r("894339"),u=r("121130"),l=r("702049"),d=r("102593");class _{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new a.yk().build(a.kk);return(0,o.V)(e),(0,c.mH)(e),(0,u.i3)(e),e}()),this._networkClientInstance}async getDraftShareInfo(e){try{var t,r;let i=await this._networkClient.post(this._api(),{package_key:e.packageKey,workspace_id:e.workspaceId},{withCredentials:!0}),s=Number(null!==(t=i.ret)&&void 0!==t?t:0),o=null!==(r=i.errmsg)&&void 0!==r?r:"";if(0!==s)return(0,n.wf)(null!=s?s:-1,null!=o?o:"");return(0,n.oW)(i.data)}catch(e){return(0,n.wf)(-1,"getDraftShareInfo api error")}}_api(){return`${l._L.getVar("web_domain")}${d.b.GET_SHARE_INFO}`}}var h=r("329598"),p=r("713261");class g{getDraftShareInfo(e){return this._getDraftShareInfoRepository.getDraftShareInfo(e)}getWorkspaceInfoExternal(e){return this._getWorkspaceInfoExternalRepository.getWorkspaceInfoExternal(e)}applyToDraft(e){return this._applyToDraftRepository.applyToDraft(e)}constructor(e){this._instantiationService=e,this._getDraftShareInfoRepository=this._instantiationService.createInstance(_),this._getWorkspaceInfoExternalRepository=this._instantiationService.createInstance(h.v),this._applyToDraftRepository=this._instantiationService.createInstance(p.S)}}g=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],g)},15290:function(e,t,r){r.d(t,{P:function(){return s}});var i,s=((i={}).jpeg="JPEG",i.gif="GIF",i)},462235:function(e,t,r){r.d(t,{B:function(){return i}});let i=(0,r(335290).yh)("photo-data-service")},958481:function(e,t,r){r.d(t,{h:function(){return c}});var i=r(789786),s=r(966697),n=r(801003),o=r(273340),a=r(106937);class c extends a.n{get resourceType(){return o.g.Image}parseHeycanResponseDataToResources(e){return(0,n.Ar)(e)}constructor(e){super(e),this._capcutAccountService=e}}c=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw])],c)},207486:function(e,t,r){r.d(t,{p:function(){return c}});var i=r(789786),s=r(966697),n=r(801003),o=r(273340),a=r(612327);class c extends a.J{get resourceType(){return o.g.Image}parseHeycanResponseDataToResources(e){return(0,n.Ar)(e)}constructor(e){super(e),this._capcutAccountService=e}}c=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw])],c)},595751:function(e,t,r){r.d(t,{T:function(){return l}});var i=r(789786),s=r(966697),n=r(801003),o=r(273340),a=r(473065),c=r(256718),u=r(396190);class l extends c.k{get resourceType(){return o.g.Image}parseHeycanResponseDataToResources(e){return(0,n.Ar)(e)}buildCustomRequest(){return{loki_optional:{app_version:this._environmentService.appVersion,device_platform:"web"},pack_optional:{large_image_formats:a.r,need_thumb:!0}}}constructor(e={},t,r){super(e,t),this._environmentService=r}}l=(0,i.gn)([(0,i.fM)(1,s.Gw),(0,i.fM)(2,u.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===s.Gw?Object:s.Gw,void 0===u.Y?Object:u.Y])],l)},927193:function(e,t,r){r.d(t,{G:function(){return n}});var i=r(740446),s=r(801003);class n extends i.i{parseResponseDataToResources(e){return(0,s.Ar)(e,!0)}}},409779:function(e,t,r){r.d(t,{Y:function(){return o}});var i=r(393958),s=r(565520),n=r(801003);class o extends i.h{get brandResourceType(){return s.Q.Logo}parseResponseDataToResources(e){return(0,n.Ar)(e,!0)}}},84149:function(e,t,r){r.d(t,{y:function(){return c}});var i=r(801003),s=r(758027),n=r(473065),o=r(127830),a=r(33883);class c extends s.B{get resourceType(){return o._g.Photo}get resourcePanelType(){return a.q.Photo}parseHeycanResponseDataToResources(e){return(0,i.Ar)(e)}buildCustomRequest(e){var t;return{category_id:Number(e.category),pack_optional:{large_image_formats:n.r,need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}}},861335:function(e,t,r){r.d(t,{l:function(){return c}});var i=r(872443),s=r(33883),n=r(801003),o=r(473065),a=r(127830);class c extends i.L{get resourcePanelType(){return s.q.Photo}get resourceType(){return a._g.Photo}parseHeycanResponseDataToResources(e){return(0,n.Ar)(e)}buildCustomRequest(e){var t;return{pack_optional:{large_image_formats:o.r,need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t}}}}},323439:function(e,t,r){r.d(t,{x:function(){return a}});var i=r(622472),s=r(273340),n=r(891551),o=r(249656);class a extends i.T{get effectType(){return s.g.Image}get effectSource(){return o.Hw.TUCHONG}get scene(){return n.c.TrackEditor}}},9322:function(e,t,r){r.d(t,{Q:function(){return o}});var i=r(273340),s=r(222977),n=r(801003);class o extends s.g{buildCustomRequest(e){return{search_option:{cc_web_use_new_search:!0,...this._buildFilterParams(e)}}}get resourceType(){return i.g.Image}parseHeycanResponseDataToResources(e){return(0,n.Ar)(e)}_buildFilterParams(e){var t,r,i;let s={};return(null===(t=e.filters)||void 0===t?void 0:t.colors)&&(s.custom_colors=e.filters.colors.map(e=>({R:e[0],G:e[1],B:e[2]}))),(null===(r=e.filters)||void 0===r?void 0:r.aspectRatios)&&(s.custom_aspect_ratios=e.filters.aspectRatios),(null===(i=e.filters)||void 0===i?void 0:i.onlyCommercial)&&(s.filter_uncommercial=e.filters.onlyCommercial),s}}},265796:function(e,t,r){r.d(t,{V:function(){return i}});let i=(0,r(335290).yh)("popup-data-service")},952898:function(e,t,r){r.d(t,{a:function(){return o}});var i=r(789786),s=r(55449),n=r(941693);class o{getPopupStatus(e){return this._popupRepository.getPopupStatus(e)}confirmPopup(e){return this._popupRepository.confirmPopup(e)}constructor(e){this._instantiationService=e,this._popupRepository=this._instantiationService.createInstance(n.G)}}o=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],o)},82748:function(e,t,r){r.d(t,{X:function(){return n},_:function(){return o}});var i,s,n=((i={})[i.PopupSmartTool=1001]="PopupSmartTool",i);var o=((s={})[s.SmartToolTypeEnum_DigitalHuman=20001]="SmartToolTypeEnum_DigitalHuman",s[s.SmartToolTypeEnum_VocalSeparation=33]="SmartToolTypeEnum_VocalSeparation",s[s.SmartToolTypeEnum_VocalBeautify=36]="SmartToolTypeEnum_VocalBeautify",s)},328777:function(e,t,r){r.d(t,{b:function(){return i}});let i={CREATE_ASSET:"/lv/v1/record_edit/create_asset",GET_ASSET:"/lv/v1/record_edit/get_asset"}},940939:function(e,t,r){r.d(t,{Z:function(){return i}});let i=(0,r(335290).yh)("screen-record-data-service")},717545:function(e,t,r){r.d(t,{t:function(){return i}});function i(e){let t={};return Object.keys(e.data.upload_asset_map).forEach(r=>{let{asset_id:i,...s}=e.data.upload_asset_map[r];t[r]={assetId:i,...s}}),{assetMap:t,status:e.data.status}}},983233:function(e,t,r){r.d(t,{i:function(){return n},p:function(){return o}});var i,s=r(335290);var n=((i={})[i.BeforeSearch=1]="BeforeSearch",i[i.Searching=2]="Searching",i);let o=(0,s.yh)("search-hot-word-data-service")},459924:function(e,t,r){r.d(t,{l:()=>R});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("405051"),u=r("121130"),l=r("786022"),d=r("768101"),_=r("502600"),h=r("702049"),p=r("606805"),g=r("966697"),y=r("801497");class f{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build(c.kk);return(0,u.i3)(e),(0,a.V)(e),e}()),this._networkClientInstance}_convertHotWords(e){return e.map(e=>{let{query_id:t,word:r,word_source:i,icon_tag:s}=e;return{queryId:t,word:r,wordSource:i,iconTag:s}})}async getSearchHotWords(e){try{var t,r;let i=await this._networkClient.post(this._api(),{app_id:l.kJ,effect_type:e.effectType,cc_web_use_new_search:!0,search_word_type:e.searchType},(0,p._)(this._accountService.userProfile.region,y.ZP.language)),s=Number(null!==(t=i.ret)&&void 0!==t?t:0),n=null!==(r=i.errmsg)&&void 0!==r?r:"";if(0!==s)return(0,o.wf)(null!=s?s:-1,null!=n?n:"");return(0,o.oW)({list:this._convertHotWords(i.data.hot_words)})}catch(e){return(0,d.m)(e,-1,"getShape api error")}}_api(){return`${h._L.getVar("web_domain")}${_.bl.GET_SEARCH_WORDS}`}constructor(e){this._accountService=e}}f=(0,i.gn)([(0,i.fM)(0,g.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g.Gw?Object:g.Gw])],f);var v=r("999432"),m=r("87909"),w=r("134429");let k={businessHeader:{loc:"sg",appSDKVesion:w.Mr,lan:"en",pf:"7",appVersion:w.$U,tdid:"web",signVer:1},draftVersion:w.Mr};class T{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build({...c.kk,withCredentials:!0});return(0,v.V)(e,{...k.businessHeader,lan:y.ZP.language}),(0,u.i3)(e),(0,a.V)(e),e}()),this._networkClientInstance}async getSearchHotWords(){try{var e,t;let r=await this._networkClient.post(this._api(),{enter_from:"template_editor"}),i=Number(null!==(e=r.ret)&&void 0!==e?e:0),s=null!==(t=r.errmsg)&&void 0!==t?t:"";if(0!==i)return(0,o.wf)(null!=i?i:-1,null!=s?s:"");return(0,o.oW)(this._convertResponseToModel(r))}catch(e){return(0,d.m)(e,-1,"template getSearchHotWords api error")}}_api(){return`${h._L.getVar("web_domain")}${m.b.GET_SEARCH_WORDS}`}_convertResponseToModel(e){var t,r,i;return{searchingHotList:e.data.hot_list.map(e=>{let{word:t}=e;return t}),hotList:null!==(r=e.data.intervention_hot_list)&&void 0!==r?r:[],greyWord:(null===(t=e.data.gray_list)||void 0===t?void 0:t.length)?e.data.gray_list[0]:{word:"",starling_key:""},region:null!==(i=e.data.region)&&void 0!==i?i:""}}}class R extends n.JT{getSearchHotWords(e){return this._searchHotWordRepository.getSearchHotWords(e)}getTemplateSearchHotWords(){return this._templateSearchHotWordRepository.getSearchHotWords()}constructor(e){super(),this._instantiationService=e,this._searchHotWordRepository=this._instantiationService.createInstance(f),this._templateSearchHotWordRepository=this._instantiationService.createInstance(T)}}R=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],R)},232851:function(e,t,r){r.d(t,{B:function(){return d}});var i=r(690613),s=r(114861),n=r(702049),o=r(405051),a=r(121130),c=r(894339),u=r(768101),l=r(250841);class d{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.i3)(e),(0,c.mH)(e),(0,s.V)(e),e}()),this._networkClientInstance}get _api(){return`${n._L.getVar("web_domain")}${l.b.GET_CONTENT}`}async getServerStorage(e){try{let r=await this._networkClient.post(this._api,{id:e.draftId,type:e.key},{withCredentials:!0});if("0"!==r.ret){var t;return(0,i.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,i.oW)({key:r.data.type,value:r.data.content})}catch(e){return(0,u.m)(e,-1,"getServerStorage api error")}}}},784958:function(e,t,r){r.d(t,{W:function(){return i}});let i=(0,r(335290).yh)("shape-animation-data-service")},185097:function(e,t,r){r.d(t,{q:()=>T});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("101887"),a=r("773943"),c=r("424736"),u=r("127830");class l extends a.b{buildCustomRequest(e){return{}}get resourceType(){return u._g.ShapeAnimation}parseEffectsToResources(e,t){return e.map(e=>(0,c.j)(e,t))}}var d=r("273340"),_=r("806752"),h=r("789869"),p=r("33883");class g extends h.A{get resourceType(){return d.g.TextAnimation}get resourcePanelType(){return p.q.ShapeAnimation}parseHeycanResponseDataToResources(e){return(0,_.o)(e)}}var y=r("758027");class f extends y.B{get resourceType(){return u._g.ShapeAnimation}get resourcePanelType(){return p.q.ShapeAnimation}parseHeycanResponseDataToResources(e){return(0,_.o)(e)}buildCustomRequest(e){return{client_ab_param:e.clientABParam,panel_source:e.panelSource||"heycan",category_id:Number(e.category),pack_optional:{}}}}var v=r("744268"),m=r("736031"),w=r("249656"),k=r("305301");class T extends n.JT{async getShapeAnimation(e){let t=await (0,m.bY)(this._configurationService,m.Jk);return"vimo"===(0,m.lo)(t,this._getHeycanShapeAnimationByCategoryRepository.resourcePanelType).panel_path?this._getHeycanShapeAnimationByCategoryRepository.getResources((0,m.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._shapeAnimationRepository.getResources(e)}async batchGetShapeAnimationsByIds(e){if(e.source===w.Hw.HEYCAN){let t=await (0,m.bY)(this._configurationService,m.Jk);return"loki"===(0,m.lo)(t,this._batchGetHeycanShapeAnimationRepository.resourcePanelType).panel_path&&e.source!==w.Hw.HEYCAN?this._batchGetShapeAnimationRepository.batchGetResources(e):this._batchGetHeycanShapeAnimationRepository.batchGetResources((0,k.Q)(e.ids,this._batchGetHeycanShapeAnimationRepository.resourceType,e.source))}return this._batchGetShapeAnimationRepository.batchGetResources(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._shapeAnimationRepository=this._instantiationService.createInstance(l),this._batchGetShapeAnimationRepository=this._instantiationService.createInstance(o.v),this._getHeycanShapeAnimationByCategoryRepository=this._instantiationService.createInstance(f),this._batchGetHeycanShapeAnimationRepository=this._instantiationService.createInstance(g)}}T=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,v.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===v.Ui?Object:v.Ui])],T)},692825:function(e,t,r){r.d(t,{B:function(){return o}});var i=r(127830),s=r(412497),n=r(806050);class o extends s.r{get resourceType(){return i._g.SmartColorAdjust}parseEffectsToResources(e){return e.map(e=>(0,n.V)(e))}}},806050:function(e,t,r){r.d(t,{V:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){let{common:r,extra:n}=(0,i.sh)(s._g.SmartColorAdjust,e,t);return{...r,maxValue:n.max_value,minValue:n.min_value,defaultValue:n.default_value,isVip:n.is_vip}}},745860:function(e,t,r){r.d(t,{p:function(){return i}});let i=(0,r(335290).yh)("intelligent-data-service")},432814:function(e,t,r){r.d(t,{v:function(){return s}});var i,s=((i={})[i.ProgressSuccess=2]="ProgressSuccess",i[i.Success=1]="Success",i[i.Process=0]="Process",i[i.Failure=-1]="Failure",i)},39735:function(e,t,r){r.d(t,{c:()=>p});var i=r("702049"),s=r("405051"),n=r("905180"),o=r("121130"),a=r("894339"),c=r("786022"),u=r("768101"),l=r("690613"),d=r("114861");let _="/lv/v1/intelligence/create",h="/lv/v1/intelligence/query";class p{get _createTaskApi(){return`${i._L.getVar("web_domain")}${_}`}get _getTaskDetailApi(){return`${i._L.getVar("web_domain")}${h}`}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(e){let t=new s.yk().build({headers:{"Content-Type":"application/json"}});return(0,n.Y)(t),(0,o.i3)(t),(0,a.mH)(t),!e&&(0,d.V)(t),t}(this._disabledRetry)),this._networkClientInstance}_createSubmitId(){return this._updateSubmitId?`${new Date().getTime()}_${Math.random()}`:this._taskSubmitId}async createIntelligentTask(e,t){try{let r=JSON.stringify(e),i=this._cacheTaskReqMap.get(r);!i&&(this._taskSubmitId=this._createSubmitId(),this._updateSubmitId=!0,i=this._networkClient.post(this._createTaskApi,{...e,app_id:c.kJ,submit_id:this._taskSubmitId},{withCredentials:!0,params:t}).finally(()=>{this._cacheTaskReqMap.delete(r)}),this._cacheTaskReqMap.set(r,i));let s=await i;if("0"!==s.ret)return(0,l.wf)(Number(s.ret),s.errmsg);return(0,l.oW)(s)}catch(e){return(null==e?void 0:e.code)==="ERR_NETWORK"&&(this._updateSubmitId=!1),(0,u.m)(e,-1,"createIntelligentTask api error.")}}async getIntelligentTask(e,t){try{let r=await this._networkClient.post(this._getTaskDetailApi,{...e},{withCredentials:!0,params:t});if("0"!==r.ret)return(0,l.wf)(Number(r.ret),r.errmsg);return r.data._meta={log_id:r.log_id},(0,l.oW)(r.data)}catch(e){return(0,u.m)(e,-1,"getIntelligentTaskDetail api error.")}}constructor(e){this._cacheTaskReqMap=new Map,this._taskSubmitId="",this._updateSubmitId=!0,this._disabledRetry=e}}},50597:function(e,t,r){r.d(t,{b:function(){return i}});let i={CREATE_MATTING_TASK:"/lv/v1/keying/create_task",GET_MATTING_TASK_DETAIL:"/lv/v1/keying/get_task"}},5026:function(e,t,r){r.d(t,{s:function(){return i}});let i=(0,r(335290).yh)("matting-data-service")},847382:function(e,t,r){r.d(t,{Q:()=>g});var i,s=r("789786"),n=r("402655"),o=r("690613"),a=r("243623"),c=r("197238"),u=r("587892");var l=((i={})[i.Success=1]="Success",i[i.Process=0]="Process",i[i.Failure=-1]="Failure",i),d=r("920704");class _ extends n.JT{get error(){return this._error}get status(){return this._smartTaskStatus}get value(){return this._result}async _getTaskProgress(){let e=await this._mattingRepository.getVideoMattingTask({platform:this._taskParams.platform,asset_id:this._taskParams.assetId,workspace_id:this._taskParams.workspaceId,tmp_id:this._taskParams.tmpId});if(e.ok){if(this._getTaskProgressErrorCount=0,function(e){let{status:t,vid:r,md5:i,url:s}=e;return t!==l.Failure&&(t===l.Process||!r&&!i&&!s)&&!0}(e.value))this._smartTaskStatus=d.y.Process,this._onProgress.fire({progress:e.value.progress,status:this._smartTaskStatus});else if(function(e){let{status:t,vid:r,md5:i,url:s}=e;return t!==l.Failure&&t===l.Success&&(!!r||!!i||!!s)||!1}(e.value)){var t,r,i,s;this._smartTaskStatus=d.y.Success,this._result={vid:null!==(t=e.value.vid)&&void 0!==t?t:"",md5:null!==(r=e.value.md5)&&void 0!==r?r:"",url:null!==(i=e.value.url)&&void 0!==i?i:"",key:null!==(s=e.value.key)&&void 0!==s?s:"",edgeProductKey:e.value.edge_product_key,edgeProductMd5:e.value.edge_product_md5,edgeProductUrl:e.value.edge_product_url,edgeProductVid:e.value.edge_product_vid},this._onSuccess.fire(this._result)}else this._smartTaskStatus=d.y.Failure,this._error=(0,o.wf)(l.Failure,"matting task failed"),this._onError.fire(this._error)}else this._getTaskProgressErrorCount++;this._getTaskProgressErrorCount>=10&&(this._smartTaskStatus=d.y.Failure,this._error=(0,o.wf)(e.code,e.msg),this._onError.fire(this._error))}async _startPollingProgress(){if(await this._getTaskProgress(),Date.now()-this._startTime>this._timeout){this._smartTaskStatus=d.y.Failure,this._error=(0,c.hO)(),this._onError.fire(this._error);return}this._smartTaskStatus===d.y.Process&&!this._canceled&&setTimeout(()=>{this._startPollingProgress()},500)}cancel(){if(!this._canceled)this._canceled=!0,this._onCancel.fire()}constructor(e,t,r){super(),this._timeout=e,this._mattingRepository=t,this._taskParams=r,this._onProgress=this._store.add(new u.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new u.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new u.Q),this.onSuccess=this._onSuccess.event,this._onCancel=this._store.add(new u.Q),this.onCancel=this._onCancel.event,this._smartTaskStatus=d.y.Process,this._getTaskProgressErrorCount=0,this._error=(0,o.ly)(),this._canceled=!1,this._startTime=0,this._startTime=Date.now(),this._startPollingProgress()}}var h=r("991339"),p=r("966697");class g extends n.JT{async createVideoMattingTask(e){let t=await this._mattingRepository.createVideoMattingTask({platform:e.platform,asset_id:e.assetId,workspace_id:e.workspaceId,tmp_id:e.tmpId,region:this._capcutAccountService.userProfile.region});return t.ok?(0,o.oW)(new _(6e4,this._mattingRepository,e)):t}async createGraphicMattingTask(e){let t=await this._mattingRepository.mattingGraphic({platform:e.platform,asset_id:e.assetId,workspace_id:e.workspaceId,tmp_id:e.tmpId,region:this._capcutAccountService.userProfile.region});return t.ok?(0,o.oW)(new h.$(t.value)):t}constructor(e){super(),this._capcutAccountService=e,this._mattingRepository=new a.W}}g=(0,s.gn)([(0,s.fM)(0,p.Gw),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[void 0===p.Gw?Object:p.Gw])],g)},223822:function(e,t,r){r.d(t,{b:function(){return i}});let i={CREATE_OBJECT_LOCK_TASK:"/lv/v1/intelligence/create",GET_OBJECT_LOCK_TASK_DETAIL:"/lv/v1/intelligence/query"}},576745:function(e,t,r){r.d(t,{X:()=>u});var i,s=r("587892"),n=r("402655"),o=r("690613"),a=r("920704");var c=((i={})[i.Process=1]="Process",i[i.Success=2]="Success",i[i.Failure=3]="Failure",i[i.NotFound=4]="NotFound",i);class u extends n.JT{get error(){return this._error}get status(){return this._smartTaskStatus}get value(){return this._result}cancel(){this._onCancel.fire(),this._canceled=!0,this._pollProgressTimer&&clearTimeout(this._pollProgressTimer)}async _getTaskProgress(){let e=await this._objectLockRepository.getObjectLockTaskDetail(this._taskParams);if(e.ok){this._getTaskProgressErrorCount=0;let{speed:t,status:r}=e.value;c.Process===r?(this._smartTaskStatus=a.y.Process,this._onProgress.fire({progress:t,status:this._smartTaskStatus})):c.Success===r?(this._smartTaskStatus=a.y.Success,this._onSuccess.fire(e.value)):(this._smartTaskStatus=a.y.Failure,this._error=(0,o.wf)(c.Failure,"object lock task failed"),this._onError.fire(this._error))}else this._getTaskProgressErrorCount++;this._getTaskProgressErrorCount>=10&&(this._smartTaskStatus=a.y.Failure,this._error=(0,o.wf)(e.code,e.msg),this._onError.fire(this._error))}async _startPollingProgress(){await this._getTaskProgress(),this._smartTaskStatus===a.y.Process&&!this._canceled&&(this._pollProgressTimer=setTimeout(()=>{this._startPollingProgress()},500))}constructor(e,t){super(),this._objectLockRepository=e,this._taskParams=t,this._onProgress=this._store.add(new s.Q),this._onSuccess=this._store.add(new s.Q),this._onError=this._store.add(new s.Q),this._onCancel=this._store.add(new s.Q),this._smartTaskStatus=a.y.Process,this._getTaskProgressErrorCount=0,this._pollProgressTimer=null,this._canceled=!1,this._error=(0,o.ly)(),this.onProgress=this._onProgress.event,this.onSuccess=this._onSuccess.event,this.onError=this._onError.event,this.onCancel=this._onCancel.event,this._startPollingProgress()}}},326236:function(e,t,r){r.d(t,{Z:function(){return i}});let i=(0,r(335290).yh)("pipeline-data-service")},317723:function(e,t,r){r.d(t,{J:()=>y});var i=r("402655"),s=r("690613"),n=r("702049"),o=r("405051"),a=r("121130"),c=r("894339"),u=r("768101"),l=r("114861"),d=r("457004");class _{get _createTaskApi(){return`${n._L.getVar("web_domain")}${d.b.CREATE_PIPELINE_TASK}`}get _getTaskDetailApi(){return`${n._L.getVar("web_domain")}${d.b.GET_PIPELINE_TASK_DETAIL}`}get _getOriginTaskDetailApi(){return`${n._L.getVar("web_domain")}${d.b.GET_PIPELINE_ORIGIN_TASK_DETAIL}`}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build({headers:{"Content-Type":"application/json"}});return(0,a.i3)(e),(0,c.mH)(e),(0,l.V)(e),e}()),this._networkClientInstance}async createPipelineTask(e){try{let t=await this._networkClient.post(this._createTaskApi,e,{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)(t.data)}catch(e){return(0,u.m)(e,-1,"createPipelineTask api error.")}}async getPipelineTask(e){try{let t=await this._networkClient.post(this._getTaskDetailApi,e,{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)(t.data)}catch(e){return(0,u.m)(e,-1,"getPipelineTaskDetail api error.")}}async getPipelineOriginTask(e){try{let t=await this._networkClient.post(this._getOriginTaskDetailApi,e,{withCredentials:!0});if("0"!==t.ret)return(0,s.wf)(Number(t.ret),t.errmsg);return(0,s.oW)(t.data)}catch(e){return(0,u.m)(e,-1,"getPipelineOriginTaskDetail api error.")}}}var h=r("392138"),p=r("126729"),g=r("144690");class y extends i.JT{getPipelineOriginTask(e){return this._pipelineRepository.getPipelineOriginTask({workspace_id:e.workspaceId,pipeline_id:e.pipelineId})}async createPipelineTask(e){let t=await this._pipelineRepository.createPipelineTask(this._buildRequestConfig(e));return t.ok?(0,s.oW)(new h.B(this._pipelineRepository,{pipeline_id:t.value.pipeline_id,workspace_id:e.workspaceId})):t}_buildRequestConfig(e){let t=e.params.map((e,t)=>{switch(e.toolType){case p.F2.VideoIntelligentToning:case p.F2.PictureIntelligentToning:e.param.level=e.param.level/20;break;case p.F2.ImageNoiseReduction:case p.F2.VideoNoiseReduction:e.param={denoise_level:Number(e.param.level)+1};break;case p.F2.VideoCut:e.param={start_time_milli:Math.floor(Number(e.param.start)/1e3),end_time_milli:Math.floor(Number(e.param.end)/1e3)}}return{order:t+1,tool_type:e.toolType,param:(0,g.Z)(e.param)?"":JSON.stringify(e.param)}});return{asset_id:e.assetId,asset_type:e.assetType,draft_key:e.draftKey,segment_id:e.segmentId,platform:e.platform,workspace_id:e.workspaceId,resource_idc:e.resourceIdc,scene:e.scene,asset_workspace_id:e.assetWorkspaceId,params:t}}constructor(){super(),this._pipelineRepository=new _}}},807664:function(e,t,r){r.d(t,{N:function(){return i}});let i=(0,r(335290).yh)("reverse-data-service")},804321:function(e,t,r){r.d(t,{K:()=>R});var i,s=r("789786"),n=r("402655"),o=r("690613"),a=r("702049"),c=r("405051"),u=r("121130"),l=r("894339"),d=r("786022"),_=r("768101"),h=r("114861");let p="/lv/v1/reverse/create_task",g="/lv/v1/reverse/get_task";class y{get _createTaskApi(){return`${a._L.getVar("web_domain")}${p}`}get _getTaskDetailApi(){return`${a._L.getVar("web_domain")}${g}`}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build({headers:{"Content-Type":"application/json"}});return(0,u.i3)(e),(0,l.mH)(e),(0,h.V)(e),e}()),this._networkClientInstance}async createReverseTask(e){try{let t=await this._networkClient.post(this._createTaskApi,{...e,app_id:d.kJ},{withCredentials:!0});if("0"!==t.ret)return(0,o.wf)(Number(t.ret),t.errmsg);return(0,o.ly)()}catch(e){return(0,_.m)(e,-1,"createReverseTask api error.")}}async getReverseTask(e){try{let t=await this._networkClient.post(this._getTaskDetailApi,e,{withCredentials:!0});if("0"!==t.ret)return(0,o.wf)(Number(t.ret),t.errmsg);return(0,o.oW)(t.data)}catch(e){return(0,_.m)(e,-1,"getReverseTaskDetail api error.")}}}var f=r("197238"),v=r("587892");var m=((i={})[i.Success=1]="Success",i[i.Process=0]="Process",i[i.Failure=-1]="Failure",i),w=r("920704");class k extends n.JT{get error(){return this._error}get status(){return this._smartTaskStatus}get value(){return this._result}async _getTaskProgress(){let e=await this._reverseRepository.getReverseTask({platform:this._taskParams.platform,asset_id:this._taskParams.assetId,workspace_id:this._taskParams.workspaceId,tmp_id:this._taskParams.tmpId});if(e.ok){if(this._getTaskProgressErrorCount=0,function(e){let{status:t,vid:r,md5:i,url:s}=e;return t!==m.Failure&&(t===m.Process||!r&&!i&&!s)&&!0}(e.value))this._smartTaskStatus=w.y.Process,this._onProgress.fire({progress:e.value.progress,status:this._smartTaskStatus});else if(function(e){let{status:t,vid:r,md5:i,url:s}=e;return t!==m.Failure&&t===m.Success&&(!!r||!!i||!!s)||!1}(e.value)){var t,r,i,s;this._smartTaskStatus=w.y.Success,this._result={vid:null!==(t=e.value.vid)&&void 0!==t?t:"",md5:null!==(r=e.value.md5)&&void 0!==r?r:"",url:null!==(i=e.value.url)&&void 0!==i?i:"",key:null!==(s=e.value.key)&&void 0!==s?s:""},this._onSuccess.fire(this._result)}else this._smartTaskStatus=w.y.Failure,this._error=(0,o.wf)(m.Failure,"reverse task failed"),this._onError.fire(this._error)}else this._getTaskProgressErrorCount++;this._getTaskProgressErrorCount>=10&&(this._smartTaskStatus=w.y.Failure,this._error=(0,o.wf)(e.code,e.msg),this._onError.fire(this._error))}async _startPollingProgress(){if(await this._getTaskProgress(),Date.now()-this._startTime>this._timeout){this._smartTaskStatus=w.y.Failure,this._error=(0,f.hO)(),this._onError.fire(this._error);return}this._smartTaskStatus===w.y.Process&&!this._canceled&&setTimeout(()=>{this._startPollingProgress()},500)}cancel(){if(!this._canceled)this._canceled=!0,this._onCancel.fire()}constructor(e,t,r){super(),this._timeout=e,this._reverseRepository=t,this._taskParams=r,this._onProgress=this._store.add(new v.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new v.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new v.Q),this.onSuccess=this._onSuccess.event,this._onCancel=this._store.add(new v.Q),this.onCancel=this._onCancel.event,this._smartTaskStatus=w.y.Process,this._getTaskProgressErrorCount=0,this._error=(0,o.ly)(),this._canceled=!1,this._startTime=0,this._startTime=Date.now(),this._startPollingProgress()}}var T=r("966697");class R extends n.JT{async createReverseTask(e){let t=await this._reverseRepository.createReverseTask({platform:e.platform,asset_id:e.assetId,workspace_id:e.workspaceId,tmp_id:e.tmpId,region:this._capcutAccountService.userProfile.region});return t.ok?(0,o.oW)(new k(6e4,this._reverseRepository,e)):t}constructor(e){super(),this._capcutAccountService=e,this._reverseRepository=new y}}R=(0,s.gn)([(0,s.fM)(0,T.Gw),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[void 0===T.Gw?Object:T.Gw])],R)},538379:function(e,t,r){r.d(t,{b:function(){return i}});let i={SMART_CROP_CHECK:"/lv/v1/intelligence/smart_crop/check",SMART_CROP_SUBJECT:"/lv/v1/intelligence/smart_crop/subject",SMART_CROP_CREATE:"/lv/v1/intelligence/smart_crop/create",SMART_CROP_QUERY:"/lv/v1/intelligence/smart_crop/query"}},987527:function(e,t,r){r.d(t,{D:function(){return s}});var i,s=((i={})[i.NotStart=0]="NotStart",i[i.Processing=1]="Processing",i[i.Success=2]="Success",i[i.Failed=3]="Failed",i)},145324:function(e,t,r){r.d(t,{I:function(){return i}});let i=(0,r(335290).yh)("smart-crop-data-service")},741827:function(e,t,r){r.d(t,{k:function(){return s}});var i,s=((i={})[i.Success=1]="Success",i[i.Process=0]="Process",i[i.Failure=-1]="Failure",i)},651894:function(e,t,r){r.d(t,{h:function(){return i}});let i=(0,r(335290).yh)("smart-split-data-service")},788695:function(e,t,r){r.d(t,{G:()=>v});var i=r("789786"),s=r("402655"),n=r("690613"),o=r("966697"),a=r("702049"),c=r("405051"),u=r("121130"),l=r("894339"),d=r("786022"),_=r("768101"),h=r("114861");let p="/lv/v1//smart_video_slice/create_task",g="/lv/v1//smart_video_slice/get_task";class y{get _createTaskApi(){return`${a._L.getVar("web_domain")}${p}`}get _getTaskDetailApi(){return`${a._L.getVar("web_domain")}${g}`}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build({headers:{"Content-Type":"application/json"}});return(0,u.i3)(e),(0,l.mH)(e),(0,h.V)(e),e}()),this._networkClientInstance}async createSmartSplitTask(e){try{let t=await this._networkClient.post(this._createTaskApi,{...e,app_id:d.kJ},{withCredentials:!0});if("0"!==t.ret)return(0,n.wf)(Number(t.ret),t.errmsg);return(0,n.ly)()}catch(e){return(0,_.m)(e,-1,"createSmartSplitTask api error.")}}async getSmartSplitTask(e){try{let t=await this._networkClient.post(this._getTaskDetailApi,e,{withCredentials:!0});if("0"!==t.ret)return(0,n.wf)(Number(t.ret),t.errmsg);return(0,n.oW)(t.data)}catch(e){return(0,_.m)(e,-1,"getSmartSplitTaskDetail api error.")}}}var f=r("245667");class v extends s.JT{async createSmartSplitTask(e){let t=await this._smartSplitRepository.createSmartSplitTask({platform:e.platform,asset_id:e.assetId,workspace_id:e.workspaceId,tmp_id:e.tmpId,region:this._capcutAccountService.userProfile.region});return t.ok?(0,n.oW)(new f.o(6e4,this._smartSplitRepository,e)):t}constructor(e){super(),this._capcutAccountService=e,this._smartSplitRepository=new y}}v=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw])],v)},144760:function(e,t,r){r.d(t,{b:()=>m});var i=r("789786"),s=r("402655"),n=r("690613"),o=r("800788"),a=r("702049"),c=r("405051"),u=r("121130"),l=r("894339"),d=r("786022"),_=r("768101"),h=r("114861");let p="/lv/v1/ever_photo/sync_asset",g="/lv/v1/ever_photo/get_sync_state";class y{get _createTaskApi(){return`${a._L.getVar("web_domain")}${p}`}get _getTaskDetailApi(){return`${a._L.getVar("web_domain")}${g}`}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build({headers:{"Content-Type":"application/json"}});return(0,u.i3)(e),(0,l.mH)(e),(0,h.V)(e),e}()),this._networkClientInstance}async createSyncTask(e){try{let t=await this._networkClient.post(this._createTaskApi,{...e,app_id:d.kJ},{withCredentials:!0});if("0"!==t.ret)return(0,n.wf)(Number(t.ret),t.errmsg);return(0,n.oW)(t.data)}catch(e){return(0,_.m)(e,-1,"createSyncTask api error.")}}async getSyncTask(e){try{let t=await this._networkClient.post(this._getTaskDetailApi,e,{withCredentials:!0});if("0"!==t.ret)return(0,n.wf)(Number(t.ret),t.errmsg);return(0,n.oW)(t.data)}catch(e){return(0,_.m)(e,-1,"getSyncTaskDetail api error.")}}}var f=r("936864"),v=r("966697");class m extends s.JT{async createSyncTask(e){(0,o.Y2)(""!==this._accountService.unloginRegion);let t=await this._syncRepository.createSyncTask({resource_id:e.resourceId,resource_type:e.resourceType,tmp_id:e.tmpId,workspace_id:e.workspaceId,is_gameplay:e.isGameplay,region:this._accountService.unloginRegion,pipeline_id:e.pipelineId});if(t.ok){var r;return(0,n.oW)(new f.o(this._syncRepository,{...e,region:this._accountService.unloginRegion,md5:null!==(r=t.value.md5)&&void 0!==r?r:""}))}return t}constructor(e){super(),this._accountService=e,this._syncRepository=new y}}m=(0,i.gn)([(0,i.fM)(0,v.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v.Gw?Object:v.Gw])],m)},138886:function(e,t,r){r.d(t,{M:function(){return s}});var i,s=((i={})[i.Success=2]="Success",i[i.Process=1]="Process",i[i.Failure=3]="Failure",i[i.NotFound=4]="NotFound",i)},677779:function(e,t,r){r.d(t,{Q:()=>f});var i=r("789786"),s=r("402655"),n=r("690613"),o=r("702049"),a=r("405051"),c=r("121130"),u=r("894339"),l=r("786022"),d=r("114861");let _="/lv/v1/intelligence/create",h="/lv/v1/intelligence/query";class p{get _createTaskApi(){return`${o._L.getVar("web_domain")}${_}`}get _getTaskDetailApi(){return`${o._L.getVar("web_domain")}${h}`}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new a.yk().build({headers:{"Content-Type":"application/json"}});return(0,c.i3)(e),(0,u.mH)(e),(0,d.V)(e),e}()),this._networkClientInstance}async createVideoTrackingTask(e){try{let t=await this._networkClient.post(this._createTaskApi,{...e,app_id:l.kJ},{withCredentials:!0});if("0"!==t.ret)return(0,n.wf)(Number(t.ret),t.errmsg);return(0,n.oW)(t.data)}catch(e){return(0,n.Mx)(-1,"createReverseTask api error.",e)}}async getVideoTrackingTask(e){try{let t=await this._networkClient.post(this._getTaskDetailApi,e,{withCredentials:!0});if("0"!==t.ret)return(0,n.wf)(Number(t.ret),t.errmsg);return(0,n.oW)(t.data)}catch(e){return(0,n.Mx)(-1,"GetVideoTrackingTaskDetail api error.",e)}}}var g=r("258849"),y=r("966697");class f extends s.JT{async createVideoTrackingTask(e){let t=await this._videoTrackingRepository.createVideoTrackingTask({platform:e.platform,asset_id:e.assetId,workspace_id:e.workspaceId,tmp_id:e.tmpId,region:this._capcutAccountService.userProfile.region,smart_tool_type:23,params:{VideoTrackingPluginImpl:e.trackingArea}});return t.ok?(0,n.oW)(new g.J(this._videoTrackingRepository,{task_id:t.value.task_id,smart_tool_type:23})):t}constructor(e){super(),this._capcutAccountService=e,this._videoTrackingRepository=new p}}f=(0,i.gn)([(0,i.fM)(0,y.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.Gw?Object:y.Gw])],f)},464062:function(e,t,r){r.d(t,{G:function(){return a}});var i=r(789786),s=r(402655),n=r(520313),o=r(745860);class a extends s.JT{createVocalBeautifyTask(e,t){let{platform:r,assetId:i,tmpId:s,step:o,timeRange:a=[]}=e,[c,u]=a,l=void 0!==c&&void 0!==u?{start_time:String(c),end_time:String(u)}:void 0,d=l?JSON.stringify({audio_trim_params:l}):void 0;return this._intelligentDataService.createIntelligentTask({platform:r,assetId:i,workspaceId:e.workspaceId,tmpId:s,reqJson:d,urlParams:t,smartToolType:n.J9,params:JSON.stringify({ratio:String(o/100)})})}constructor(e){super(),this._intelligentDataService=e}}a=(0,i.gn)([(0,i.fM)(0,o.p),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.p?Object:o.p])],a)},93476:function(e,t,r){r.d(t,{Q:()=>R});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("492197"),a=r("483932"),c=r("292180"),u=r("799882"),l=r("702049"),d=r("405051"),_=r("121130"),h=r("894339"),p=r("768101"),g=r("786022"),y=r("690613"),f=r("114861"),v=r("966697"),m=r("70586"),w=r("977794");class k{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new d.yk().build(d.kk);return(0,_.i3)(e),(0,f.V)(e),(0,h.mH)(e),e}()),this._networkClientInstance}async getCombinationSegmentSprite(e){try{var t,r;let i=await this._networkClient.post(this._api(),this._buildRequest(e),{withCredentials:!0}),s=Number(null!==(t=i.ret)&&void 0!==t?t:0),n=null!==(r=i.errmsg)&&void 0!==r?r:"";if(0!==s)return(0,y.wf)(null!=s?s:-1,null!=n?n:"");return(0,y.oW)(this._formatDataFromServer(i.data))}catch(e){return(0,p.m)(e,-1,"getCombinationSegmentSprite api error")}}_buildRequest(e){let t=(0,o.Z)(e,(0,a.Z)(c.Z,1));return{support_webp:!0,app_id:g.kJ,region:this._accountService.userProfile.region,...t}}_formatDataFromServer(e){return(0,o.Z)(e,(t,r)=>{let i=r in w.E?w.E[r]:r;return Array.isArray(t)?e[i]=t.map(this._formatDataFromServer):(0,u.Z)(t)&&(e[i]=this._formatDataFromServer(t)),i})}_api(){return`${l._L.getVar("web_domain")}${m.b.GET_COMBINATION_SEGMENT_SPRITE}`}constructor(e){this._accountService=e}}k=(0,i.gn)([(0,i.fM)(0,v.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===v.Gw?Object:v.Gw])],k);var T=r("31665");class R extends n.JT{getCombinationSegmentSprite(e){return this._getCombinationSegmentSpriteRepository.getCombinationSegmentSprite(e)}getMutableSegmentSprite(e){return this._getMutablePolySegmentSpriteRepository.getMutablePolySegmentSprite(e)}constructor(e){super(),this._instantiationService=e,this._getCombinationSegmentSpriteRepository=this._instantiationService.createInstance(k),this._getMutablePolySegmentSpriteRepository=this._instantiationService.createInstance(T.o)}}R=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],R)},237104:function(e,t,r){r.d(t,{x:function(){return o}});var i=r(127830),s=r(412497),n=r(309118);class o extends s.r{get resourceType(){return i._g.StickerMotion}parseEffectsToResources(e){return e.map(e=>(0,n.y)(e))}}},232148:function(e,t,r){r.d(t,{O:function(){return n}});var i=r(127830),s=r(512363);class n extends s.L{get resourceType(){return i._g.StickerMotion}}},462932:function(e,t,r){r.d(t,{N:()=>J});var i=r("789786"),s=r("861810"),n=r("55449"),o=r("402655"),a=r("892292"),c=r("784275"),u=r("773258"),l=r("482707"),d=r("127830"),_=r("512363");class h extends _.L{parseDetailToResources(e){return(0,l.jh)(e)}get resourceType(){return d._g.Sticker}}var p=r("773943"),g=r("868870"),y=r("623935");class f extends p.b{buildCustomRequest(e){return{enable_album:!0,category:g.q.ALBUM,album_size_limit:e.albumChildLimit,album_resource_id:e.albumResourceId,enter_from:e.enterFrom}}get resourceType(){return d._g.Sticker}parseEffectsToResources(e,t){return e.map(e=>(function(e,t){var r,i,s,n;let{common:o,urlPrefix:a,sdkExtra:c}=(0,y.sh)(d._g.Sticker,e,t),u=null!==(s=null===(r=e.ChildEffects)||void 0===r?void 0:r.map(e=>(0,l.jh)(e,a)))&&void 0!==s?s:[],_=e.StickerImage?{stickerImage:{imageWidth:e.StickerImage.ImageWidth,imageHeight:e.StickerImage.ImageHeight,uri:e.StickerImage.URI,url:e.StickerImage.URL,md5:e.StickerImage.Md5,imageUrlList:null!==(n=null===(i=e.StickerImage.ImageURLList)||void 0===i?void 0:i.map(e=>({width:e.Width,height:e.Height,url:e.URL})))&&void 0!==n?n:[]}}:{};return{...o,..._,sdkExtra:c,key:`album_${o.key}`,childStickers:u}})(e,t))}}var v=r("917835"),m=r("976995"),w=r("690613"),k=r("114861"),T=r("702049"),R=r("405051"),b=r("121130"),S=r("866006"),C=r("966697"),I=r("502600"),P=r("606805"),E=r("801497"),A=r("768101");class M{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new R.yk().build(R.kk);return(0,b.i3)(e),(0,k.V)(e),e}()),this._networkClientInstance}async getSimilarityResources(e){let t=e instanceof S.yt?e.config:e;try{var r,i;let s=await this._networkClient.post(this._SimilarityApi,this._convertParamsToRequest(e),(0,P._)(this._accountService.userProfile.region,E.ZP.language)),n=Number(null!==(r=s.ret)&&void 0!==r?r:0),o=null!==(i=s.errmsg)&&void 0!==i?i:"";if(0!==n)return(0,w.wf)(null!=n?n:-1,null!=o?o:"");let a=this._converResponseToQueryToken(t,s);return(0,w.oW)(a)}catch(e){return(0,A.m)(e,-1,"SimilarityResource api error")}}get defaultQueryTOken(){return{offset:0,count:50}}buildCustomRequest(e){return{}}_convertParamsToRequest(e){var t,r,i;let s=e instanceof S.yt?e.config:e,n={req_scene:"similarity_rec",panel:s.panel,category:null!==(t=s.category)&&void 0!==t?t:"",context_info:JSON.stringify({similarity_item_id:s.itemId})},o=this.buildCustomRequest(s),a=(0,S.ky)(e)?{count:null!==(r=e.config.limit)&&void 0!==r?r:50,offset:null!==(i=e.offset)&&void 0!==i?i:0}:{...this.defaultQueryTOken,...e.limit?{count:e.limit}:void 0};return{...n,...o,...a}}_converResponseToQueryToken(e,t){let r=t.data.effect_item_list.map(this.parseHeycanResponseDataToResources),i=t.data.next_offset,s=t.data.has_more;return(0,S.ib)(e,{list:r},{hasMore:s,offset:i})}get _SimilarityApi(){return`${T._L.getVar("web_domain")}${I.bl.GET_SIMILARITIES}`}constructor(e){this._accountService=e}}M=(0,i.gn)([(0,i.fM)(0,C.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C.Gw?Object:C.Gw])],M);var x=r("378351");class O extends M{buildCustomRequest(e){return{pack_optional:{only_commercial:e.onlyCommercial}}}parseHeycanResponseDataToResources(e){return(0,x.U)(e)}constructor(e){super(e)}}O=(0,i.gn)([(0,i.fM)(0,C.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C.Gw?Object:C.Gw])],O);var F=r("455500"),D=r("930852");class L extends D.G{get resourceType(){return d._g.Sticker}buildCustomRequest(e){return{enter_from:e.enterFrom}}parseEffectsToResources(e,t){return e.map(e=>(0,l.jh)(e,t))}}var U=r("273340"),B=r("106937");class G extends B.n{get resourceType(){return U.g.Sticker}parseHeycanResponseDataToResources(e){return(0,x.U)(e)}constructor(e){super(e),this._capcutAccountService=e}}G=(0,i.gn)([(0,i.fM)(0,C.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===C.Gw?Object:C.Gw])],G);var j=r("249656"),V=r("393958"),H=r("565520");class N extends V.h{get brandResourceType(){return H.Q.Sticker}parseResponseDataToResources(e){return(0,l.jh)(e,void 0,!0)}}var q=r("577337"),Y=r("872443"),$=r("33883");class K extends Y.L{get resourcePanelType(){return $.q.Sticker}get resourceType(){return d._g.Sticker}parseHeycanResponseDataToResources(e){return(0,x.U)(e)}buildCustomRequest(e){var t;return{pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}var W=r("758027");class Q extends W.B{get resourceType(){return d._g.Sticker}get resourcePanelType(){return $.q.Sticker}parseHeycanResponseDataToResources(e){return(0,x.U)(e)}buildCustomRequest(e){var t;return{category_id:Number(e.category),pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}',image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}class J extends o.JT{getStickerByCategory(e,t){return e===a.C.Heycan?this._getHeycanStickerByCategoryRepository.getResources(t):this._stickerRepository.getResources(t)}getBrandStickers(e){return this._getBrandStickersRepository.getResources(e)}getStickerAlbum(e){return this._stickerAlbumRepository.getResources(e)}batchGetStickersByIds(e){let{isFromBrand:t=!1}=e;return t?this._getBrandStickersByIdsRepository.getResourcesByIds({ids:e.ids}):e.source===j.Hw.HEYCAN?this._batchGetHeycanStickerRepository.batchGetResources({resourceIds:e.ids}):this._batchGetStickerRepository.batchGetResources({ids:e.ids,enterFrom:e.enterFrom})}getStickerCategories(e,t){return e===a.C.Heycan?this._getHeycanStickerCategoriesRepository.getCategories(t):this._getStickerCategoriesRepository.getCategories(t)}searchSticker(e){return this._searchStickerRepository.searchResources(e)}searchLokiSticker(e){return this._searchLokiStickerRepository.searchResources(e)}getCollections(e){return this._collectionStickerRepository.getCollections(e)}addToCollection(e){return this._collectionStickerRepository.addToCollection(e)}removeFromCollection(e){return this._collectionStickerRepository.removeFromCollection(e)}getSimilarSticker(e){return this._similarityStickerRepository.getSimilarityResources(e)}getRecentSticker(e){return this._recentStickerRepository.getRecentResources(e)}addRecentSticker(e){return this._recentStickerRepository.addRecentResource(e)}constructor(e={},t){super(),this.collectionParam=e,this._instantiationService=t,this._stickerRepository=this._instantiationService.createInstance(u.Q),this._getHeycanStickerByCategoryRepository=this._instantiationService.createInstance(Q),this._stickerAlbumRepository=this._instantiationService.createInstance(f),this._batchGetStickerRepository=this._instantiationService.createInstance(c.Z),this._getStickerCategoriesRepository=this._instantiationService.createInstance(h),this._getHeycanStickerCategoriesRepository=this._instantiationService.createInstance(K),this._searchStickerRepository=this._instantiationService.createInstance(v.u),this._searchLokiStickerRepository=this._instantiationService.createInstance(L),this._collectionStickerRepository=this._instantiationService.createInstance(new s.M(m.E,[e],!1)),this._similarityStickerRepository=this._instantiationService.createInstance(O),this._recentStickerRepository=this._instantiationService.createInstance(F.B),this._batchGetHeycanStickerRepository=this._instantiationService.createInstance(G),this._getBrandStickersRepository=this._instantiationService.createInstance(N),this._getBrandStickersByIdsRepository=this._instantiationService.createInstance(q.y),this.collectionParam.fixedRegion&&(this._getHeycanStickerCategoriesRepository.setFixedRegion(this.collectionParam.fixedRegion),this._getHeycanStickerByCategoryRepository.setFixedRegion(this.collectionParam.fixedRegion))}}J=(0,i.gn)([(0,i.fM)(1,n.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===n.T?Object:n.T])],J)},378351:function(e,t,r){r.d(t,{U:function(){return o}});var i=r(889862),s=r(32372),n=r(127830);function o(e){var t;let r=(0,i.E)(e,n._g.Sticker);return{key:`${n._g.Sticker}_${r.resourceId}`,aspectRatio:null!==(t=r.aspectRatio)&&void 0!==t?t:1,resourceId:r.resourceId,effectId:r.effectId,md5:r.md5,name:r.title,isBusiness:r.isBusiness,isVip:r.isVip,icon:{uri:r.coverUrl,urlList:[r.coverUrl]},previewUrl:r.coverUrl,package:{uri:(0,s.s)(r.originUrl),urlList:[r.originUrl]},source:r.source,sdkVersion:"",isPrefab:!1}}},482707:function(e,t,r){r.d(t,{jh:function(){return l}});var i=r(623935),s=r(127830),n=r(249656),o=r(32372),a=r(570811),c=r(134429),u=r(15290);function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?function(e){let{common_attr:t}=e,r=t.item_url||t.download_info.url;return{key:t.id,resourceId:t.id,effectId:t.id,md5:t.md5||t.id,name:t.title,isBusiness:!1,isVip:t.is_vip,package:{uri:(0,o.s)(r),urlList:[r]},icon:{uri:(0,o.s)(t.cover_url.small),urlList:[t.cover_url.small]},format:"gif"===t.format?u.P.gif:u.P.jpeg,aspectRatio:(0,a.o)(t.width,t.height,1),isFromBrand:!0,source:n.Hw.BRAND,sdkVersion:c.f4,previewUrl:t.cover_url.small,isDefault:e.IsDefault,userId:t.user_id,createTime:t.create_time,isPrefab:!1}}(e):function(e,t){var r,o;let{common:a,sdkExtra:c,contentFile:u}=(0,i.sh)(s._g.Sticker,e,t),l=e.StickerImage?{stickerImage:{imageWidth:e.StickerImage.ImageWidth,imageHeight:e.StickerImage.ImageHeight,uri:e.StickerImage.URI,url:e.StickerImage.URL,md5:e.StickerImage.Md5,imageUrlList:null!==(o=null===(r=e.StickerImage.ImageURLList)||void 0===r?void 0:r.map(e=>({width:e.Width,height:e.Height,url:e.URL})))&&void 0!==o?o:[]}}:{};return{...a,...l,sdkExtra:c,contentFile:u,source:n.Hw.LOKI,useReportMs:e.UseReportMs}}(e,t)}},621071:function(e,t,r){r.d(t,{C:function(){return n},x:function(){return o}});var i,s,n=((i={})[i.NONE=0]="NONE",i[i.EverCloud=1]="EverCloud",i[i.IMAGEX=2]="IMAGEX",i[i.HEYCAN=3]="HEYCAN",i[i.URI=4]="URI",i);var o=((s={})[s.DataError=1]="DataError",s[s.ServiceError=2]="ServiceError",s)},928566:function(e,t,r){r.d(t,{Z:function(){return i}});let i=(0,r(335290).yh)("subject-crop-data-service")},414104:function(e,t,r){r.d(t,{Q:()=>p});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("702049"),a=r("405051"),c=r("894339"),u=r("768101"),l=r("495322"),d=r("690613"),_=r("621071");class h{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=(0,a.Gf)(),(0,c.mH)(this._networkClientInstance)),this._networkClientInstance}_getApi(e){return`${o._L.getVar("web_domain")}${e}`}_getRequestParams(e){return{req_list:e.map(e=>({source_type:e.sourceType,source:e.source,workspace_id:e.workspaceId,target_ratios:e.targetRatios}))}}async subjectCrop(e){let t=this._getRequestParams(e);try{let e=await this._networkClient.post(this._getApi(l.b.SMART_CROP),t,{withCredentials:!0});if(!(null==e?void 0:e.image_subject_crop_res))return(0,d.wf)(_.x.DataError,"getSmartCrop api error: no image_smart_crop_res");let r=e.image_subject_crop_res;if(!r.length)return(0,d.wf)(_.x.DataError,"getSmartCrop api error: no crop_res_list");let i=r.map(e=>({source:e.source,list:e.crop_res_list.map(e=>({ratio:e.ratio,code:e.code,cropBox:e.crop_box}))}));return(0,d.oW)(i)}catch(e){return(0,u.m)(e,_.x.ServiceError,"getSmartCrop api error")}}}class p extends n.JT{getSubjectCropResult(e){return this._SubjectCropRepository.subjectCrop(e)}constructor(e){super(),this._instantiationService=e,this._SubjectCropRepository=this._instantiationService.createInstance(h)}}p=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],p)},593815:function(e,t,r){r.d(t,{u:()=>y});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("866006"),a=r("872443"),c=r("33883"),u=r("978874"),l=r("127830");class d extends a.L{get resourceType(){return l._g.SubtitleTemplate}get resourcePanelType(){return c.q.SubtitleTemplate}parseHeycanResponseDataToResources(e){return(0,u.G)(e)}buildCustomRequest(e){var t;return{panel_source:"heycan",pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}buildCustomRequestParams(){var e;return{device_type:"default",channel:null!==(e=new URLSearchParams(location.search).get("lokiChannel"))&&void 0!==e?e:"online"}}}var _=r("758027");class h extends _.B{get resourceType(){return l._g.SubtitleTemplate}get resourcePanelType(){return c.q.SubtitleTemplate}parseHeycanResponseDataToResources(e){return(0,u.G)(e)}buildCustomRequest(e){var t,r,i,s;return{category_id:Number(e.category),pack_optional:{need_thumb:!0,only_commercial:e.onlyCommercial,thumb_opt:'{"is_support_webp":1}',image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:null!==(i=null===(t=e.iconSize)||void 0===t?void 0:t.width)&&void 0!==i?i:100,height:null!==(s=null===(r=e.iconSize)||void 0===r?void 0:r.height)&&void 0!==s?s:100}}},panelSource:"heycan",full_count:!0}}buildCustomFilterOtherParams(e){return e.strategyFilterAppId?{strategy_filter_app_id:e.strategyFilterAppId}:{}}buildCustomRequestParams(){var e;return{device_type:"default",channel:null!==(e=new URLSearchParams(location.search).get("lokiChannel"))&&void 0!==e?e:"online"}}}var p=r("744268"),g=r("352980");class y extends n.JT{getSubtitleTemplateCategories(e){let t={...e instanceof o.yt?e.config:e};return this._getSubtitleTemplateCategoriesRepository.getCategories(t)}getSubtitleTemplateByCategory(e){return this._getSubtitleTemplateByCategoryRepository.getResources(e)}getSubtitleTemplateByIds(e){return this._getSubtitleTemplateByIdsRepository.batchGetResources({resourceIds:e.ids})}constructor(e={},t,r){super(),this._options=e,this._instantiationService=t,this._configurationService=r,this._getSubtitleTemplateCategoriesRepository=this._instantiationService.createInstance(d),this._getSubtitleTemplateByCategoryRepository=this._instantiationService.createInstance(h),this._getSubtitleTemplateByIdsRepository=this._instantiationService.createInstance(g.v),this._options.fixedRegion&&(this._getSubtitleTemplateByCategoryRepository.setFixedRegion(this._options.fixedRegion),this._getSubtitleTemplateCategoriesRepository.setFixedRegion(this._options.fixedRegion))}}y=(0,i.gn)([(0,i.fM)(1,s.T),(0,i.fM)(2,p.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object,void 0===s.T?Object:s.T,void 0===p.Ui?Object:p.Ui])],y)},978874:function(e,t,r){r.d(t,{G:function(){return o},s:function(){return n}});var i=r(127830),s=r(889862);function n(e){return`${i._g.SubtitleTemplate}_${e}`}function o(e){var t,r,o;let a=(0,s.E)(e,i._g.SubtitleTemplate),c=null!==(o=null===(t=e.subtitle_template)||void 0===t?void 0:t.depend_resource_list.map(e=>({type:e.type,resourceId:e.resource_id,source:e.source})))&&void 0!==o?o:[];return{key:n(a.resourceId),resourceId:a.resourceId,effectId:a.effectId,md5:a.md5,source:a.source,dependentResources:c,name:a.title,isVip:a.isVip,isBusiness:a.isBusiness,icon:{uri:a.coverUrl,urlList:[a.coverUrl]},previewUrl:a.coverUrl,staticPreviewUrl:e.common_attr.cover_url.static_img,package:{uri:(e=>{var t;let r=e.match(/^(http:.+\/)[0-9a-z]+$/g);return null!==(t=null==r?void 0:r[0])&&void 0!==t?t:e})(a.originUrl),urlList:[a.originUrl]},sdkVersion:"",scriptTemplateVersion:null===(r=e.subtitle_template)||void 0===r?void 0:r.script_template_version,isPrefab:!1}}},318819:function(e,t,r){r.d(t,{b:function(){return i}});let i={SYNC_FILE_OPEN_TIME:"/cc/v1/workspace/sync_file_open_time"}},323516:function(e,t,r){r.d(t,{g:function(){return i}});let i=(0,r(335290).yh)("sync-file-open-time-data-service")},174298:function(e,t,r){r.d(t,{b:function(){return i}});let i={CREATE_SYNC_TASK:"/lv/v1/ever_photo/sync_template_asset",GET_SYNC_TASK_DETAIL:"/lv/v1/ever_photo/batch_get_sync_state"}},493034:function(e,t,r){r.d(t,{d:function(){return i}});let i=(0,r(335290).yh)("sync-template-build-in-data-service")},505790:function(e,t,r){r.d(t,{j:()=>u});var i=r("402655"),s=r("690613"),n=r("385827"),o=r("587892"),a=r("217123");class c extends i.JT{get error(){return this._error}get errorCodes(){return this._assetsResult?this._assetsResult.reduce((e,t)=>(![a.f.Process,a.f.Success].includes(t.status)&&e.push(t.status),e),[]):[]}get _processingResource(){let e=[];for(let t of this._childTaskStatus.values())t.status===a.f.Process&&e.push(t.resourceId);return e}get status(){return this._taskStatus}get value(){return{status:this._taskStatus,progress:this._successCount/this._taskParams.data.length,assets:this._assetsResult}}get _assetsResult(){let e=[];for(let t of this._childTaskStatus.values())e.push(t);return e}async retry(){if([a.f.Process,a.f.Success].includes(this._taskStatus))return;this._taskStatus=a.f.Process,this._getTaskProgressErrorCount=0;let e=await this._syncRepository.createSyncTask({template_id:this._taskParams.templateId,workspace_id:this._workspaceId,invisible:this._taskParams.invisible,no_occupy:this._taskParams.noOccupy,uris:this._taskParams.data.filter(e=>{var t;return(null===(t=this._childTaskStatus.get(e.uri))||void 0===t?void 0:t.status)!==a.f.Success}).map(e=>e.uri)});if(!e.ok){this._taskStatus=a.f.Failure,this._error=e,this._onError.fire(this._error);return}this._bootstrap()}async reSyncWhileWorkspaceIdChange(e){this._workspaceId=e,this._taskStatus=a.f.Process,this._getTaskProgressErrorCount=0;let t=await this._syncRepository.createSyncTask({template_id:this._taskParams.templateId,workspace_id:this._workspaceId,invisible:this._taskParams.invisible,no_occupy:this._taskParams.noOccupy,uris:this._taskParams.data.map(e=>e.uri)});if(!t.ok){this._taskStatus=t.code,this._multiSetChildTaskStatus(t.code,t.msg),this._error=t,this._onError.fire(this._error);return}this._extra.failureResource=t.value.failureResource,this._bootstrap()}_bootstrap(){let e=!1,t=!1;if(this._taskParams.data.forEach(r=>{let{uri:i,md5:s}=r;if(this._extra.failureResource.includes(i)){this._childTaskStatus.set(i,{resourceId:i,assetId:void 0,md5:s,status:a.f.Failure,message:""}),e=!0;return}this._childTaskStatus.set(i,{resourceId:i,assetId:void 0,md5:s,status:a.f.Process,message:""}),t=!0}),this._successCount=0,this._onProgress.fire(this.value),t)this._startPollingProgress();else if(e){this._taskStatus=a.f.Failure;let e=(0,s.wf)(-1,"failure");this._onError.fire(e)}else this._taskStatus=a.f.Success,this._onSuccess.fire(this.value)}_multiSetChildTaskStatus(e,t){this._taskParams.data.forEach(r=>{let{uri:i,md5:s}=r;this._childTaskStatus.set(i,{resourceId:i,assetId:void 0,md5:s,status:e,message:t||""})})}async _getTaskProgress(){let e=await this._syncRepository.getSyncTask({resource_ids:this._processingResource,workspace_id:this._workspaceId});if(e.ok){this._getTaskProgressErrorCount=0;let t=e.value,r=!1,i=0;t.assets.forEach(e=>{switch(e.status){case a.f.Process:r=!0,this._childTaskStatus.set(e.resourceId,e);break;case a.f.Success:i++,this._childTaskStatus.set(e.resourceId,e);break;case a.f.Failure:case a.f.NotFound:case a.f.USER_SPACE_NOT_ENOUGH:default:this._childTaskStatus.set(e.resourceId,e)}}),this._successCount=this._successCount+i,r?(this._taskStatus=a.f.Process,this._onProgress.fire(this.value)):this.errorCodes.length?(this._taskStatus=a.f.Failure,this._error=(0,s.wf)(a.f.Failure,"sync task failed"),this._onError.fire(this._error)):(this._taskStatus=a.f.Success,this._onSuccess.fire(this.value))}else this._getTaskProgressErrorCount++;let t=()=>{this._taskParams.data.forEach(t=>{var r;let{uri:i,md5:s}=t;if((null===(r=this._childTaskStatus.get(i))||void 0===r?void 0:r.status)===a.f.Process){this._childTaskStatus.set(i,{resourceId:i,assetId:void 0,md5:s,status:e.code,message:e.msg});return}}),this._taskStatus=e.code,this._error=(0,s.wf)(e.code,e.msg),this._onError.fire(this._error)};if(e.code===a.f.USER_SPACE_NOT_ENOUGH){t();return}this._getTaskProgressErrorCount>=10&&t()}async _startPollingProgress(){await this._getTaskProgress(),this._taskStatus===a.f.Process&&setTimeout(()=>{this._startPollingProgress()},1e3)}constructor(e,t,r){super(),this._syncRepository=e,this._taskParams=t,this._extra=r,this._onProgress=this._store.add(new o.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new o.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new o.Q),this.onSuccess=this._onSuccess.event,this._taskStatus=a.f.Process,this._getTaskProgressErrorCount=0,this._childTaskStatus=new Map,this._successCount=0,this._error=(0,s.ly)(),this._workspaceId=t.workspaceId,this._multiSetChildTaskStatus(a.f.Process),this._extra.autoCreateTask?this.reSyncWhileWorkspaceIdChange(t.workspaceId):this._bootstrap()}}class u extends i.JT{createSyncTask(e){return Promise.resolve((0,s.oW)(new c(this._syncRepository,e,{autoCreateTask:!0,failureResource:[]})))}constructor(){super(),this._syncRepository=new n.j}}},63366:function(e,t,r){r.d(t,{b:function(){return i}});let i={GET_TAG_STATE:"/lv/v1/common/batch_get_tag",SET_TAG_STATE:"/lv/v1/common/set_tag"}},231922:function(e,t,r){r.d(t,{b:function(){return i}});let i={GET_SMART_TOOL_TCC_CONFIG:"https://sf16-muse-va.ibytedtos.com/obj/ies-fe-bee-maliva/bee_prod/biz_149/bee_prod_149_bee_publish_978.json",GET_AI_WATERMARK_TCC_CONFIG:"https://sf16-muse-va.ibytedtos.com/obj/ies-fe-bee-maliva/bee_prod/biz_149/bee_prod_149_bee_publish_994.json",GET_AI_GENERATE_FOR_PC_TCC_CONFIG:r(702049).RD?"https://lf3-beecdn.___________/obj/ies-fe-bee/bee_prod/biz_1293/bee_prod_1293_bee_publish_14128.json":"https://sf16-muse-va.ibytedtos.com/obj/ies-fe-bee-maliva/bee_prod/biz_149/bee_prod_149_bee_publish_1073.json",GET_UG_DRAINAGE_FECONFIG:"https://sf16-muse-va.ibytedtos.com/obj/ies-fe-bee-maliva/bee_prod/biz_149/bee_prod_149_bee_publish_1086.json"}},349360:function(e,t,r){r.d(t,{V:function(){return i}});function i(e){e.interceptors.response.use(e=>200===e.status?Promise.resolve(e.data):Promise.reject(e.data))}},781548:function(e,t,r){r.d(t,{_:function(){return i}});let i=(0,r(335290).yh)("tcc-config-data-service")},419516:function(e,t,r){r.d(t,{H:()=>T});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("186607");class u extends a.r{get resourceType(){return o._g.TextMotion}parseEffectsToResources(e){return e.map(e=>(0,c.W)(e))}}var l=r("208267"),d=r("727423"),_=r("133223"),h=r("75909"),p=r("872443"),g=r("33883"),y=r("147194");class f extends p.L{get resourceType(){return o._g.TextMotion}get resourcePanelType(){return g.q.TextMotion}parseHeycanResponseDataToResources(e){return(0,y.Q)(e)}buildCustomRequest(e){return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}var v=r("744268"),m=r("736031"),w=r("249656"),k=r("305301");class T extends n.JT{async getTextMotion(e){let t=await (0,m.bY)(this._configurationService,m.Jk);return"vimo"===(0,m.lo)(t,this._getHeycanTextMotionByCategoryRepository.resourcePanelType).panel_path?this._getHeycanTextMotionByCategoryRepository.getResources((0,m.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._motionRepository.getResources(e)}async batchGetTextMotionsByIds(e){if(e.source===w.Hw.HEYCAN){let t=await (0,m.bY)(this._configurationService,m.Jk);return"loki"===(0,m.lo)(t,this._batchGetHeycanTextMotionRepository.resourcePanelType).panel_path&&e.source!==w.Hw.HEYCAN?this._batchGetTextMotionRepository.batchGetResources(e):this._batchGetHeycanTextMotionRepository.batchGetResources((0,k.Q)(e.ids,this._batchGetHeycanTextMotionRepository.resourceType,e.source))}return this._batchGetTextMotionRepository.batchGetResources(e)}async getTextMotionCategories(e){let t=await (0,m.bY)(this._configurationService,m.Jk);return"vimo"===(0,m.lo)(t,this._getHeycanTextMotionCategoriesRepository.resourcePanelType).panel_path?this._getHeycanTextMotionCategoriesRepository.getCategories((0,m.lY)(e,t)):this._getTextMotionCategoriesRepository.getCategories(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._motionRepository=this._instantiationService.createInstance(l.N),this._batchGetTextMotionRepository=this._instantiationService.createInstance(u),this._getTextMotionCategoriesRepository=this._instantiationService.createInstance(d.M),this._getHeycanTextMotionByCategoryRepository=this._instantiationService.createInstance(h.t),this._getHeycanTextMotionCategoriesRepository=this._instantiationService.createInstance(f),this._batchGetHeycanTextMotionRepository=this._instantiationService.createInstance(_.A)}}T=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,v.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===v.Ui?Object:v.Ui])],T)},186607:function(e,t,r){r.d(t,{W:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){var r;let{common:n,extra:o}=(0,i.sh)(s._g.TextMotion,e,t);return{...n,isKtv:"true"===o.is_ktv,ktvColor:null!==(r=o.ktv_color)&&void 0!==r?r:""}}},498435:function(e,t,r){r.d(t,{w:()=>k});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("656609"),a=r("808656"),c=r("439079"),u=r("736031"),l=r("744268"),d=r("273340"),_=r("146761"),h=r("789869"),p=r("33883");class g extends h.A{get resourceType(){return d.g.TextGlow}get resourcePanelType(){return p.q.TextGlow}parseHeycanResponseDataToResources(e){return(0,_.b)(e)}}var y=r("249656"),f=r("305301"),v=r("872443"),m=r("127830");class w extends v.L{get resourceType(){return m._g.TextGlow}get resourcePanelType(){return p.q.TextGlow}parseHeycanResponseDataToResources(e){return(0,_.b)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t,image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}class k extends n.JT{async getTextGlow(e){let t=await (0,u.bY)(this._configurationService,u.$0);return"vimo"===(0,u.lo)(t,this._getHeycanTextGlowByCategoryRepository.resourcePanelType).panel_path?this._getHeycanTextGlowByCategoryRepository.getResources((0,u.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._textGlowRepository.getResources(e)}async getTextGlowCategories(e){let t=await (0,u.bY)(this._configurationService,u.$0);return this._getHeycanTextGlowCategoriesRepository.getCategories((0,u.lY)(e,t))}async batchGetTextGlowsByIds(e){if(e.source===y.Hw.LOKI)return this._batchGetTextGlowRepository.batchGetResources(e);{let t=await (0,u.bY)(this._configurationService,u.$0);return"loki"===(0,u.lo)(t,this._batchGetHeycanTextGlowRepository.resourcePanelType).panel_path&&e.source!==y.Hw.HEYCAN?this._batchGetTextGlowRepository.batchGetResources(e):this._batchGetHeycanTextGlowRepository.batchGetResources((0,f.Q)(e.ids,this._batchGetHeycanTextGlowRepository.resourceType,e.source))}}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._textGlowRepository=this._instantiationService.createInstance(a.S),this._batchGetTextGlowRepository=this._instantiationService.createInstance(o.k),this._getHeycanTextGlowByCategoryRepository=this._instantiationService.createInstance(c.G),this._getHeycanTextGlowCategoriesRepository=this._instantiationService.createInstance(w),this._batchGetHeycanTextGlowRepository=this._instantiationService.createInstance(g)}}k=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,l.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===l.Ui?Object:l.Ui])],k)},850513:function(e,t,r){r.d(t,{J:function(){return i}});let i=(0,r(335290).yh)("text-preset-service")},542901:function(e,t,r){r.d(t,{_:()=>x});var i=r("789786"),s=r("861810"),n=r("55449"),o=r("402655"),a=r("557206"),c=r("578767"),u=r("773943"),l=r("692060"),d=r("127830");class _ extends u.b{get resourceType(){return d._g.TextPreset}parseEffectsToResources(e,t){return e.map(e=>(0,l.Ck)(e))}buildCustomRequest(e){return{only_commercial:e.onlyCommercial}}}var h=r("412497"),p=r("966697"),g=r("744268"),y=r("396190");class f extends h.r{get resourceType(){return d._g.TextPreset}parseEffectsToResources(e,t){return e.map(e=>(0,l.Ck)(e))}constructor(e,t,r){super(e,t,r)}}f=(0,i.gn)([(0,i.fM)(0,p.Gw),(0,i.fM)(1,g.Ui),(0,i.fM)(2,y.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.Gw?Object:p.Gw,void 0===g.Ui?Object:g.Ui,void 0===y.Y?Object:y.Y])],f);var v=r("249656"),m=r("196656"),w=r("740446");class k extends w.i{parseResponseDataToResources(e){return(0,l.Ck)(e,!0)}}var T=r("305301"),R=r("273340"),b=r("789869"),S=r("228310"),C=r("33883"),I=r("685795");class P extends b.A{get resourceType(){return R.g.WordArt}get resourcePanelType(){return C.q.Flower}parseHeycanResponseDataToResources(e){return(0,S.Q)(e)}constructor(e,t){super(e,t)}}P=(0,i.gn)([(0,i.fM)(0,p.Gw),(0,i.fM)(1,I.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.Gw?Object:p.Gw,void 0===I.L?Object:I.L])],P);var E=r("151097"),A=r("786501"),M=r("736031");class x extends o.JT{async getTextCategories(e){let t=await (0,M.bY)(this._configurationService);return"vimo"===(0,M.lo)(t,this._getHeycanTextPresetCategoriesRepository.resourcePanelType).panel_path?this._getHeycanTextPresetCategoriesRepository.getCategories((0,M.lY)(e,t)):this._getTextPresetCategoriesRepository.getCategories(e)}async getTextByCategory(e){return await (0,M._Q)(this._configurationService,this._getHeycanTextPresetByCategoryRepository.resourcePanelType)?this._getHeycanTextPresetByCategoryRepository.getResources(e):this._getTextPresetByCategoryRepository.getResources(e)}getBrandTextPresets(e){return this._getBrandTextPresetsRepository.getResources(e)}async getTextByIds(e){let{isFromBrand:t=!1}=e;if(t){var r;return this._getBrandTextPresetsByIdsRepository.getResourcesByIds({ids:null!==(r=e.ids)&&void 0!==r?r:[]})}if(e.source===v.Hw.LOKI)return this._getTextPresetByIdsRepository.batchGetResources(e);{let t=await (0,M.bY)(this._configurationService);return"loki"===(0,M.lo)(t,this._batchGetHeycanTextPresetRepository.resourcePanelType).panel_path&&e.source!==v.Hw.HEYCAN?this._getTextPresetByIdsRepository.batchGetResources(e):this._batchGetHeycanTextPresetRepository.batchGetResources((0,T.Q)(e.ids,this._batchGetHeycanTextPresetRepository.resourceType,e.source))}}getCollections(e){return this._collectionTextPresetRepository.getCollections(e)}addToCollection(e){return this._collectionTextPresetRepository.addToCollection(e)}removeFromCollection(e){return this._collectionTextPresetRepository.removeFromCollection(e)}constructor(e={},t,r){super(),this.collectionParam=e,this._instantiationService=t,this._configurationService=r,this._getTextPresetCategoriesRepository=t.createInstance(a.d),this._collectionTextPresetRepository=t.createInstance(new s.M(c.B,[e],!1)),this._getTextPresetByCategoryRepository=t.createInstance(_),this._getTextPresetByIdsRepository=t.createInstance(f),this._getBrandTextPresetsRepository=this._instantiationService.createInstance(m.a),this._getBrandTextPresetsByIdsRepository=this._instantiationService.createInstance(k),this._getHeycanTextPresetByCategoryRepository=this._instantiationService.createInstance(E.V),this._getHeycanTextPresetCategoriesRepository=this._instantiationService.createInstance(A.A),this._batchGetHeycanTextPresetRepository=this._instantiationService.createInstance(P)}}x=(0,i.gn)([(0,i.fM)(1,n.T),(0,i.fM)(2,g.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===n.T?Object:n.T,void 0===g.Ui?Object:g.Ui])],x)},228310:function(e,t,r){r.d(t,{Q:function(){return n}});var i=r(127830),s=r(889862);function n(e){var t;let r=(0,s.E)(e,i._g.TextPreset),n=e=>{var t;let r=e.match(/^(http:.+\/)[0-9a-z]+$/g);return null!==(t=null==r?void 0:r[0])&&void 0!==t?t:e};return{...r,key:`${i._g.TextPreset}_${r.resourceId}`,resourceId:r.resourceId,effectId:r.effectId,md5:r.md5,aspectRatio:1,source:r.source,isFavorite:null!==(t=r.isFavorite)&&void 0!==t&&t,name:r.title,isVip:r.isVip,isBusiness:r.isBusiness,icon:{uri:n(r.coverUrl),urlList:[r.coverUrl]},previewUrl:r.coverUrl,package:{uri:n(r.originUrl),urlList:[r.originUrl]},sdkVersion:"",isPrefab:!1}}},582026:function(e,t,r){r.d(t,{$:function(){return s}});var i,s=((i={})[i.artist=0]="artist",i[i.loki=1]="loki",i[i.brand=6]="brand",i)},894257:function(e,t,r){r.d(t,{U:function(){return l}});var i=r(789786),s=r(966697),n=r(256718),o=r(786022),a=r(690831),c=r(273340),u=r(396190);class l extends n.k{get resourceType(){return c.g.TextTemplate}parseHeycanResponseDataToResources(e){return(0,a._)(e)}buildCustomRequest(){return{loki_optional:{app_version:this._environmentService.appVersion,device_platform:"web"},app_id:o.kJ}}constructor(e={},t,r){super(e,t),this._environmentService=r}}l=(0,i.gn)([(0,i.fM)(1,s.Gw),(0,i.fM)(2,u.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===s.Gw?Object:s.Gw,void 0===u.Y?Object:u.Y])],l)},906965:function(e,t,r){r.d(t,{_:function(){return n}});var i=r(740446),s=r(858725);class n extends i.i{parseResponseDataToResources(e){return(0,s.K3)(e,!0)}}},879496:function(e,t,r){r.d(t,{K:function(){return a}});var i=r(690831),s=r(758027),n=r(127830),o=r(33883);class a extends s.B{get resourceType(){return n._g.TextTemplate}get resourcePanelType(){return o.q.TextTemplate}parseHeycanResponseDataToResources(e){return(0,i._)(e)}buildCustomRequest(e){var t;return{category_id:Number(e.category),full_count:!0,pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}}},466956:function(e,t,r){r.d(t,{R:function(){return c}});var i=r(789786),s=r(966697),n=r(273340),o=r(690831),a=r(106937);class c extends a.n{get resourceType(){return n.g.TextTemplate}parseHeycanResponseDataToResources(e){return(0,o._)(e)}constructor(e){super(e),this._capcutAccountService=e}}c=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw])],c)},683280:function(e,t,r){r.d(t,{L:function(){return o}});var i=r(773943),s=r(858725),n=r(127830);class o extends i.b{get resourceType(){return n._g.TextTemplate}parseEffectsToResources(e,t){return e.map(e=>(0,s.H)(e))}buildCustomRequest(e){return{only_commercial:e.onlyCommercial}}}},177866:function(e,t,r){r.d(t,{G:function(){return l}});var i=r(789786),s=r(412497),n=r(966697),o=r(744268),a=r(858725),c=r(127830),u=r(396190);class l extends s.r{get resourceType(){return c._g.TextTemplate}parseEffectsToResources(e,t){return e.map(e=>(0,a.H)(e))}constructor(e,t,r){super(e,t,r)}}l=(0,i.gn)([(0,i.fM)(0,n.Gw),(0,i.fM)(1,o.Ui),(0,i.fM)(2,u.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.Gw?Object:n.Gw,void 0===o.Ui?Object:o.Ui,void 0===u.Y?Object:u.Y])],l)},701473:function(e,t,r){r.d(t,{z:function(){return o}});var i=r(858725),s=r(512363),n=r(127830);class o extends s.L{parseDetailToResources(e){return(0,i.K3)(e)}get resourceType(){return n._g.TextTemplate}}},563681:function(e,t,r){r.d(t,{v:function(){return s}});var i=r(311928);class s{getDataByChannel(e){return this._thirdpartyPluginChannelRepository.getDataByChannel(e)}constructor(){this._thirdpartyPluginChannelRepository=new i.k}}},657605:function(e,t,r){r.d(t,{M:()=>d});var i=r("690613"),s=r("27074"),n=r("405051"),o=r("515207"),a=r("121130"),c=r("894339"),u=r("943943");class l{getPlugins(){return this._request({url:"/lv/v1/third_party_clouds/get_plugins"})}async _request(e){try{let t;let{url:r,data:s,config:n,isGetMethod:o}=e;return t=o?await this._networkClient.get(r,{...n,[u.$R]:!1}):await this._networkClient.post(r,s,{...n,[u.$R]:!1}),(0,i.oW)(t)}catch(c){var t;let{code:e,ret:r,msg:s,errmsg:n}=c||{},o=e?Number(null!=e?e:r):1002,a=null!==(t=null!=s?s:n)&&void 0!==t?t:"unknown error";return(0,i.wf)(o,a)}}constructor(){this._networkClient=function(){let e=new n.yk().build({headers:{"Content-Type":"application/json","app-sdk-version":s.w}});return(0,o.J)(e),(0,a.i3)(e),(0,c.mH)(e),e}()}}class d{getPlugins(){return this._thirdpartyPluginManagementRepository.getPlugins()}constructor(){this._thirdpartyPluginManagementRepository=new l}}},658165:function(e,t,r){r.d(t,{Z:()=>_});var i=r("690613"),s=r("800788");let n="/lv/v1/ever_photo/sync_asset",o="/lv/v1/ever_photo/get_sync_state";var a=r("523732"),c=r("702049"),u=r("943943");class l{async createSyncTask(e){try{let t=await this._networkClient.post(this._createTaskApi,e,{withCredentials:!0,[u.$R]:!1});if("0"!==t.ret)return(0,i.wf)(Number(t.ret),t.errmsg);return(0,i.oW)(t.data)}catch(e){return(0,i.Mx)(-1,"createSyncTask api error.",e)}}async getSyncTask(e){try{let t=await this._networkClient.post(this._getTaskDetailApi,e,{withCredentials:!0,[u.$R]:!1});if("0"!==t.ret)return(0,i.wf)(Number(t.ret),t.errmsg);return(0,i.oW)(t.data)}catch(e){return(0,i.Mx)(-1,"getSyncTaskDetail api error.",e)}}get _createTaskApi(){return`${c._L.getVar("web_domain")}${n}`}get _getTaskDetailApi(){return`${c._L.getVar("web_domain")}${o}`}constructor(){this._networkClient=(0,a.G)()}}var d=r("966697");class _{async createSyncTask(e){try{if(!this._accountService.hasLogin)return this._accountService.login({reportParams:{pageEnterFrom:d.d.ThirdpartyPlugin}}),(0,i.wf)(-1,"no login");(0,s.ZB)(e.workspace_id,"un expect undefined for workspaceId when login");let t=await this._thirdpartyPluginResourceRepository.createSyncTask(e);if(!t.ok)return(0,i.Mx)(-1,t.msg,t);return(0,i.oW)(t.value)}catch(e){return(0,i.Mx)(-1,"unexpected error",e)}}constructor(e){this._accountService=e,this._thirdpartyPluginResourceRepository=new l}}},694101:function(e,t,r){r.d(t,{T:()=>P});var i,s,n=r("690613");var o=((i={}).Dropbox="Dropbox",i.GoogleDrive="GoogleDrive",i.GoogleContacts="GoogleContacts",i.EpidemicSound="epidemic",i);var a=((s={}).COMPLETED="COMPLETED",s.ABORTED="ABORTED",s.DENIED="DENIED",s);function c(e,t){return t((0,n.oW)(a.DENIED)),()=>null}function u(e,t){t((0,n.oW)(a.DENIED))}function l(){return{requestAuthentication:c,withdrawAuthentication:u}}var d=r("327375"),_=r("827322"),h=r("814800"),p=r("673664"),g=r.n(p),y=r("684138");let f=e=>g()("sha256").update(e).digest("hex"),v=e=>{let t=new Uint8Array(new ArrayBuffer(e.length));for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},m=e=>h.fromByteArray(new Uint8Array(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),w=async e=>{let t=f(e).slice(0,43);return m(new Uint8Array(await window.crypto.subtle.digest("SHA-256",v(t))))},k=e=>Object.keys(e).map(t=>`${t}=${e[t]}`).join("&");async function T(e,t){var r;let i=window.screen.height,s=window.screen.width,{host:c}=window.location,u=k({response_type:"code",client_id:"8l2554rqc5Rv",redirect_uri:`https://${c}/lv/v1/user/web/third_party_platform_authorization?platform=${o.EpidemicSound}`,code_challenge:await w(e),code_challenge_method:"S256",state:null===(r=f(null!=e?e:""))||void 0===r?void 0:r.slice(15,47)}),l=`https://login.epidemicsound.com/auth/realms/accounts/protocol/openid-connect/auth?${u}`;window.open((0,_.C)(l,null,{logType:"js.window.location",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),"name=thirdparty_cloud_storage_auth",`fullscreen=1,width=800,height=600,top=${(i-30-600)/2},left=${(s-800)/2}`);let d=e=>{if(e.key===y.g.THIRDPARTY_CLOUD_AUTH)"fail"===e.newValue?t((0,n.oW)(a.DENIED)):t((0,n.oW)(a.COMPLETED)),window.removeEventListener("storage",d),window.localStorage.removeItem(y.g.THIRDPARTY_CLOUD_AUTH)};return window.localStorage.removeItem(y.g.THIRDPARTY_CLOUD_AUTH),window.addEventListener("storage",d),()=>{window.removeEventListener("storage",d)}}async function R(e,t){try{let r={platform:o.EpidemicSound},i=await e.shareUserUnbind(r);t(i.ok&&0===Number(i.value.ret)?(0,n.oW)(a.COMPLETED):(0,n.oW)(a.DENIED))}catch(e){t((0,n.Mx)(-1,a.DENIED,e))}}var b=r("141806"),S=r("943943");class C{shareUserUnbind(e){return this._request({url:"/lv/v1/user/web/third_party_clouds_deauthorization",data:e})}async _request(e){try{let t;let{url:r,data:i,config:s,isGetMethod:o}=e;return t=o?await this._networkClient.get(r,{...s,[S.$R]:!1}):await this._networkClient.post(r,i,{...s,[S.$R]:!1}),(0,n.oW)(t)}catch(c){var t;let{code:e,ret:r,msg:i,errmsg:s}=c||{},o=e?Number(null!=e?e:r):1002,a=null!==(t=null!=i?i:s)&&void 0!==t?t:"unknown error";return(0,n.wf)(o,a)}}constructor(){this._networkClient=(0,b.G)()}}var I=r("966697");class P{requestAuthentication(e,t){var r,i;if(!this._accountService.hasLogin){this._accountService.onDidLogin(()=>{var r,i;(null!==(i=this._oauthManager.getOAuthConfig(e))&&void 0!==i?i:l()).requestAuthentication(null===(r=this._accountService.userProfile)||void 0===r?void 0:r.uid,t)}),this._accountService.login({reportParams:{pageEnterFrom:I.d.ThirdpartyPlugin}});return}(null!==(i=this._oauthManager.getOAuthConfig(e))&&void 0!==i?i:l()).requestAuthentication(null===(r=this._accountService.userProfile)||void 0===r?void 0:r.uid,t)}withdrawAuthentication(e,t){try{var r;(null!==(r=this._oauthManager.getOAuthConfig(e))&&void 0!==r?r:l()).withdrawAuthentication(this._thirdpartyPluginUserRepository,t)}catch(e){t((0,n.Mx)(-1,a.DENIED,e))}}constructor(e){this._accountService=e,this._thirdpartyPluginUserRepository=new C,this._oauthManager=new d.x,!function(e){e.registerOAuthConfig("1",{requestAuthentication:T,withdrawAuthentication:R})}(this._oauthManager)}}},673006:function(e,t,r){r.d(t,{d:function(){return i}});function i(e){let t="GET"===e.method,r={headers:e.headers,timeout:e.timeout,withCredentials:!1};return t&&e.data&&(r.params=JSON.parse(e.data)),{url:e.url,data:t?void 0:e.data,config:r,isGetMethod:t}}},113974:function(e,t,r){r.d(t,{G:function(){return a}});var i=r(27074),s=r(405051),n=r(515207),o=r(894339);function a(){let e=new s.yk().build({headers:{"Content-Type":"application/json","app-sdk-version":i.w}});return(0,n.J)(e),!function(e){e.interceptors.response.use(e=>200===e.status?Promise.resolve(e.data):Promise.reject(e.data))}(e),(0,o.mH)(e),e}},27074:function(e,t,r){r.d(t,{w:function(){return i}});let i="48.0.0"},250978:function(e,t,r){r.d(t,{C:function(){return i}});let i=(0,r(335290).yh)("thirdparty-plugin-data-service")},884007:function(e,t,r){r.d(t,{q:()=>u});var i=r("702049"),s=r("405051"),n=r("121130"),o=r("894339"),a=r("114861");let c="/lv/v1/third_party_clouds/user_info?type=multi";class u{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new s.yk().build({headers:{"Content-Type":"application/json"}});return(0,n.i3)(e),(0,o.mH)(e),(0,a.V)(e),e}()),this._networkClientInstance}async getIsBindShopify(){try{var e;let t=await this._networkClient.post(this._api,{platform:"Shopify"},{withCredentials:!0});return{isBind:!!(null==t?void 0:null===(e=t.data.user_infos)||void 0===e?void 0:e.length)}}catch(e){return{isBind:!1}}}get _api(){return`${i._L.getVar("web_domain")}${c}`}}},898875:function(e,t,r){r.d(t,{i:function(){return i}});let i=(0,r(335290).yh)("thirdparty-shopify-service")},564961:function(e,t,r){r.d(t,{a:function(){return d}});var i=r(789786),s=r(33883),n=r(256718),o=r(273340),a=r(786022),c=r(966697),u=r(396190),l=r(545604);class d extends n.k{get resourcePanelType(){return s.q.Tone}get resourceType(){return o.g.Timbre}parseHeycanResponseDataToResources(e){return(0,l.K)({...e,panel:this.resourcePanelType})}buildCustomRequest(){return{app_id:a.kJ,loki_optional:{app_version:this._environmentService.appVersion,device_platform:"web"},pack_optional:{need_thumb:!0}}}constructor(e={},t,r){super(e,t),this._environmentService=r}}d=(0,i.gn)([(0,i.fM)(1,c.Gw),(0,i.fM)(2,u.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===c.Gw?Object:c.Gw,void 0===u.Y?Object:u.Y])],d)},123522:function(e,t,r){r.d(t,{D:function(){return y}});var i=r(789786),s=r(872443),n=r(33883),o=r(127830),a=r(545604),c=r(544688),u=r(916636),l=r(690465),d=r(685795),_=r(332557),h=r(847083),p=r(966697),g=r(744268);class y extends s.L{shouldUseRace(){return!0}get resourcePanelType(){return n.q.Tone}get resourceType(){return o._g.Tone}parseHeycanResponseDataToResources(e){return(0,a.K)(e)}_getCategoryKey(e,t){return this._shouldUseCategoryIdAsKey&&"loki"!==t?`${e.category_id}`:super._getCategoryKey(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t}}}constructor(e,t,r,i,s,n,o,a,c){super(t,r,i,s,n,o,a,c),this._shouldUseCategoryIdAsKey=e}}y=(0,i.gn)([(0,i.fM)(1,p.Gw),(0,i.fM)(2,u.c),(0,i.fM)(3,c.c),(0,i.fM)(4,g.Ui),(0,i.fM)(5,l.x),(0,i.fM)(6,d.L),(0,i.fM)(7,_.U),(0,i.fM)(8,h.a),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean,void 0===p.Gw?Object:p.Gw,void 0===u.c?Object:u.c,void 0===c.c?Object:c.c,void 0===g.Ui?Object:g.Ui,void 0===l.x?Object:l.x,void 0===d.L?Object:d.L,void 0===_.U?Object:_.U,void 0===h.a?Object:h.a])],y)},817342:function(e,t,r){r.d(t,{s:function(){return d}});var i=r(789786),s=r(966697),n=r(273340),o=r(545604),a=r(789869),c=r(726563),u=r(33883),l=r(685795);class d extends a.A{get resourceType(){return n.g.Timbre}get resourcePanelType(){return u.q.Tone}parseHeycanResponseDataToResources(e){return(0,o.K)(e)}getHeycanToneByIds(e){let t=e.ids.map(t=>{var r;return{id:t,effect_type:n.g.Timbre,source:null!==(r=null==e?void 0:e.source)&&void 0!==r?r:c.H.VIMO}});return this.batchGetResources({items:t})}constructor(e,t){super(e,t)}}d=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.fM)(1,l.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw,void 0===l.L?Object:l.L])],d)},472026:function(e,t,r){r.d(t,{l:function(){return a}});var i=r(758027),s=r(127830),n=r(545604),o=r(33883);class a extends i.B{shouldUseRace(){return!0}get resourceType(){return s._g.Tone}get resourcePanelType(){return o.q.Tone}parseHeycanResponseDataToResources(e){return(0,n.K)(e)}buildCustomRequest(e){return{category_id:Number(e.category),category_key:e.category_key,client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_tag:!0,need_thumb:!0,thumb_opt:'{"is_support_webp":1}',image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}},651475:function(e,t,r){r.d(t,{Y:function(){return n}});var i=r(127830),s=r(512363);class n extends s.L{shouldUseRace(){return!0}buildCustomRequest(e){return{region:e.region,enter_from:e.enter_from}}get resourceType(){return i._g.Tone}}},845523:function(e,t,r){r.d(t,{T:function(){return o},i:function(){return n}});var i,s=r(335290);var n=((i={}).Loki="loki",i.Heycan="heycan",i);let o=(0,s.yh)("tone-data-service")},545604:function(e,t,r){r.d(t,{K:function(){return p}});var i=r(889862),s=r(32372),n=r(127830),o=r(981632),a=r(492795),c=r(451818),u=r(134429);let l=a.jg.Female,d=e=>{let t=(0,i.E)(e,n._g.Tone);return{...t,key:`${n._g.Tone}_${t.resourceId}`,name:t.title,icon:{uri:(0,s.s)(t.coverUrl),urlList:[t.coverUrl]},package:{uri:(0,s.s)(t.originUrl),urlList:[t.originUrl]}}},_=e=>{var t,r;let i=d(e),s=(0,o.D)(e.common_attr.extra),n=(0,o.D)(s.tonetype),c=s.voice_alias_name,l=s.voice_gender,_=s.tone_avatar_url;if(_){let e=i.coverUrl.split("/");e[e.length-1]=_,_=_.includes("http")?_:e.join("/")}let h=null===(t=n.emotion)||void 0===t?void 0:t.map(e=>({emotion:e.emotion,emotionScale:e.emotion_scale,nameKey:e.name_key,text:e.text}));return{tone:{ttsVoice:n.tts_voice,rate:n.rate,name:n.name,voiceType:n.voice_type,voiceGender:s.voice_gender,isAiavatarIgnorePhonemes:s.is_aiavatar_ignore_phonemes,tonePlatform:null!==(r=n.platform)&&void 0!==r?r:a.x$.Sami,emotion:h},...i,isPrefab:i.isPrefab,sdkVersion:u.f4,previewUrl:i.coverUrl,voiceAliasName:c,voiceGender:l,voiceAvatar:_,voiceAvatarUri:s.tone_avatar_url}},h=e=>{var t,r,i,s,n;let o=d(e),u=(0,c.Z)(o,a.x$.ElevenLabs);return{tone:{ttsVoice:"",voiceType:o.subType===a.us.ElevenLabs?null!==(s=null===(t=e.timbre)||void 0===t?void 0:t.voice_type)&&void 0!==s?s:o.thirdResourceId:o.effectId,name:o.title,rate:"24000",voiceGender:(n=o.tagList)?n.some(e=>"gender/male"===e.name)?a.jg.Male:a.jg.Female:l,isAiavatarIgnorePhonemes:!0,tonePlatform:u},...o,previewUrl:null===(i=e.timbre)||void 0===i?void 0:null===(r=i.audio_info)||void 0===r?void 0:r.audio_url,sdkVersion:"",isPrefab:!1}};function p(e){if("tone"===e.panel)return _(e);return h(e)}},451818:function(e,t,r){r.d(t,{Z:function(){return n}});var i=r(492795);let s={1:i.x$.ElevenLabs,2:i.x$.Vimo};function n(e,t){var r;let{subType:n}=e,o=null!=t?t:i.x$.Sami;return void 0===n?o:null!==(r=s[n])&&void 0!==r?r:o}},266649:function(e,t,r){r.d(t,{Q:function(){return o},x:function(){return n}});var i,s=r(335290);var n=((i={})[i.Success=1]="Success",i[i.Process=0]="Process",i[i.Failure=-1]="Failure",i);let o=(0,s.yh)("transcript-data-service")},75897:function(e,t,r){r.d(t,{p:()=>k});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("451505"),c=r("114861"),u=r("702049"),l=r("405051"),d=r("894339"),_=r("768101"),h=r("786022"),p=r("305261"),g=r("667891"),y=r("966697");class f{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new l.yk().build(l.kk);return(0,d.mH)(e),(0,c.V)(e),e}()),this._networkClientInstance}get _api(){return`${u._L.getVar("web_domain")}${p.b.QUERY}`}async getTranscript(e){try{var t;let r=await this._networkClient.post(this._api,this._formatGetParams(e),{withCredentials:!0});if(r&&200===r.status)return(0,o.oW)((0,g.M)(r.data));throw Error(`${null!==(t=r.status)&&void 0!==t?t:"network error"}`)}catch(e){return(0,_.m)(e,-1,"getTranscript api error")}}_formatGetParams(e){return{app_id:h.kJ,region:this._accountService.userProfile.region,reserve_sil:e.reserveSil,resources:e.resources.map(e=>({workspace_id:e.workspaceId,resource_id:e.resourceId,url_from_type:e.urlFromType,language:e.language,caption_type:e.captionType,file_type:e.fileType,words_per_line:e.wordsPerLine,audio_text:e.audioText,transcript_category:e.transcriptCategory}))}}constructor(e){this._accountService=e}}f=(0,i.gn)([(0,i.fM)(0,y.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.Gw?Object:y.Gw])],f);var v=r("587892"),m=r("266649");class w extends n.JT{get error(){return this._error}get status(){return this._transcriptTaskStatus}get value(){return this._result}async _getTaskProgress(){let[e,t]=(await this._transcriptRepository.getTranscript(this._taskParams)).pair();if(e)this._getTaskProgressErrorCount++;else switch(this._getTaskProgressErrorCount=0,t.status){case 0:this._transcriptTaskStatus=m.x.Success,this._onSuccess.fire(t),this._result=t;break;case 1:this._transcriptTaskStatus=m.x.Process,this._onProgress.fire(t);break;case 2:this._transcriptTaskStatus=m.x.Failure,this._error=(0,o.wf)(Number(t.ret),t.errmsg),this._onError.fire(this._error)}if(this._getTaskProgressErrorCount>=10){var r,i;this._transcriptTaskStatus=m.x.Failure,this._error=(0,o.wf)(null!==(r=null==e?void 0:e.code)&&void 0!==r?r:-1,null!==(i=null==e?void 0:e.msg)&&void 0!==i?i:""),this._onError.fire(this._error)}}async _startPollingProgress(){await this._getTaskProgress(),this._transcriptTaskStatus===m.x.Process&&setTimeout(()=>{this._startPollingProgress()},500)}constructor(e,t){super(),this._transcriptRepository=e,this._taskParams=t,this._onProgress=this._store.add(new v.Q),this.onProgress=this._onProgress.event,this._onError=this._store.add(new v.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new v.Q),this.onSuccess=this._onSuccess.event,this._transcriptTaskStatus=m.x.Process,this._getTaskProgressErrorCount=0,this._error=(0,o.ly)(),this._startPollingProgress()}}class k extends n.JT{async createTranscriptTask(e){let t=await this._createTranscriptRepository.createTranscript(e);return t.ok?(0,o.oW)(new w(this._getTranscriptRepository,e)):t}constructor(e){super(),this._instantiationService=e,this._createTranscriptRepository=this._instantiationService.createInstance(a.i),this._getTranscriptRepository=this._instantiationService.createInstance(f)}}k=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],k)},859125:function(e,t,r){r.d(t,{h:function(){return o}});var i=r(773943),s=r(177813),n=r(127830);class o extends i.b{buildCustomRequest(e){var t;return{category:null!==(t=e.category)&&void 0!==t?t:"all",only_commercial:e.onlyCommercial}}get resourceType(){return n._g.Transition}parseEffectsToResources(e,t){return e.map(e=>(0,s.h)(e,t))}}},726105:function(e,t,r){r.d(t,{J:function(){return a}});var i=r(273340),s=r(575124),n=r(789869),o=r(33883);class a extends n.A{get resourceType(){return i.g.TextAnimation}get resourcePanelType(){return o.q.Transitions}parseHeycanResponseDataToResources(e){return(0,s.f)(e)}}},894124:function(e,t,r){r.d(t,{S:function(){return a}});var i=r(872443),s=r(33883),n=r(127830),o=r(575124);class a extends i.L{get resourceType(){return n._g.Transition}get resourcePanelType(){return s.q.Transitions}parseHeycanResponseDataToResources(e){return(0,o.f)(e)}buildCustomRequest(e){return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}},173888:function(e,t,r){r.d(t,{a:function(){return s}});var i,s=((i={}).Unknown="unknown",i.Preparing="Preparing",i.Prepared="Prepared",i.PrepareFailure="PrepareFailure",i.WaitingUpload="waitingUpload",i.Uploading="uploading",i.UploadFailure="uploadFailure",i.Uploaded="uploaded",i.Transcoding="transcoding",i.TranscodeFailure="transcodeFailure",i.Transcoded="transcoded",i.WaitForSync2UserMaterial="waitForSync2UserMaterial",i.Syncing2UserMaterial="syncing2UserMaterial",i.Synced2UserMaterial="synced2UserMaterial",i.Sync2UserMaterialFailure="sync2UserMaterialFailure",i.Success="Success",i)},723703:function(e,t,r){r.d(t,{U:function(){return s}});var i,s=((i={}).ExtractAudio="ExtractAudio",i)},180685:function(e,t,r){r.d(t,{y:function(){return i}});function i(e){var t,r,i,s,n;return{common:{singleFrameHeight:null!==(t=e.height)&&void 0!==t?t:0,singleFrameWidth:null!==(r=e.width)&&void 0!==r?r:0,totalSetNum:1},details:[{frameCount:1,imageWidth:null!==(i=null==e?void 0:e.width)&&void 0!==i?i:0,imageHeight:null!==(s=null==e?void 0:e.height)&&void 0!==s?s:0,url:e.url,encryptedBucketKey:"",encryptedKey:null!==(n=e.key)&&void 0!==n?n:""}],isFromFallback:!0}}},73435:function(e,t,r){r.d(t,{i:function(){return i}});function i(e,t){return{url:function(e,t,r){let i=document.createElement("canvas");i.width=e,i.height=t;let s=i.getContext("2d");return s.fillStyle=r,s.fillRect(0,0,e,t),i.toDataURL()}(e||100,t||100,"#000000"),key:"",isFromFallback:!0}}},583642:function(e,t,r){r.d(t,{y:function(){return _}});var i=r(426020),s=r(127830),n=r(875320),o=r(532611),a=r(300303),c=r(374904),u=r(73435),l=r(180685);function d(e,t){var r;let i={},s="video"===t?"player_":"audio_";return Object.entries(null!==(r=e.play_info)&&void 0!==r?r:{}).forEach(e=>{let[t,r]=e;if(t.startsWith(s)&&r){if(!(r.primary_url||r.secondary_url))return;i[t.replace(s,"")]={url:r.primary_url,backupUrl:r.secondary_url,key:r.url_key}}}),Object.keys(i).length?i:void 0}function _(e){var t,r,_;if(e.asset_type===s.pS.Folder){;return t=e,{assetType:s.pS.Folder,assetId:t.asset_id,filename:t.filename,permissions:t.permissions,owner:t.owner,childFileNum:t.child_file_num}}let h={key:e.md5,assetType:s.pS.Material,sourceType:i.ov.EverCloud,assetId:e.asset_id,parentId:e.parent_id,filename:e.filename,fileType:i.YB.File,owner:e.owner,md5:e.md5,mime:e.mime,size:e.size,sourcePath:e.source_path,createdAt:e.create_time?new Date(e.create_time).valueOf():void 0,updatedAt:e.updated_at,url:e.origin_download_link,subType:e.sub_type,meta:e.meta},p=(0,a.m)(e.meta);if((0,o.Ml)(h)||(0,o.jL)(p))return(0,o.jL)(p)&&(h.decryptKey=null==p?void 0:p.key),h;switch(e.file_type||(0,c.Gt)(h.mime)){case i.YB.Image:return function(e,t){let r=function(e){var t,r;let i={};return Object.entries(null!==(r=null===(t=e.preview_info)||void 0===t?void 0:t[0].preview_url)&&void 0!==r?r:{}).forEach(t=>{let[r,s]=t;i[r.replace("bucket_key_","")]={width:0,height:0,url:s,key:e.preview_info[0].preview_key}}),i}(e),s=(()=>{var t,i,s,n,o,a;if(null===(i=e.preview_info)||void 0===i?void 0:null===(t=i[0].preview_url)||void 0===t?void 0:t.bucket_key_360p)return{url:null===(o=e.preview_info)||void 0===o?void 0:null===(n=o[0].preview_url)||void 0===n?void 0:n.bucket_key_360p,key:null===(a=e.preview_info)||void 0===a?void 0:a[0].preview_key};let c=null===(s=Object.values(r))||void 0===s?void 0:s[0];return c?{url:c.url,key:c.key}:(0,u.i)(e.width,e.height)})();return{...t,fileType:i.YB.Image,cover:s,width:e.width,height:e.height,isImgTranscoding:!1,imgTranscodeInfo:r}}(e,h);case i.YB.Video:return function(e,t){var r,s,o,a,_,h,p,g,y,f;let v=(null===(s=e.preview_info)||void 0===s?void 0:null===(r=s[0].preview_url)||void 0===r?void 0:r.bucket_key_360p)?{url:null===(a=e.preview_info)||void 0===a?void 0:null===(o=a[0].preview_url)||void 0===o?void 0:o.bucket_key_360p,key:null===(_=e.preview_info)||void 0===_?void 0:_[0].preview_key}:(0,u.i)(e.width,e.height),m=(null===(p=e.sprite_frame)||void 0===p?void 0:null===(h=p.detail_infos)||void 0===h?void 0:h.length)?(0,n.J)(null==e?void 0:e.sprite_frame):(0,l.y)({url:null!==(y=v.url)&&void 0!==y?y:"",key:e.preview_key,width:e.width,height:e.height});return{...t,fileType:i.YB.Video,cover:v,width:e.width,height:e.height,duration:(null!==(f=e.duration)&&void 0!==f?f:0)/1e3,isVideoTranscoding:1===e.transcode_status,isVideoCompletion:null===(g=e.filter_list)||void 0===g?void 0:g.includes(c.VW.FILM_ASSET),videoTranscodeInfo:d(e,"video"),thumb:m}}(e,h);case i.YB.Audio:;return r=e,{...h,fileType:i.YB.Audio,duration:(null!==(_=r.duration)&&void 0!==_?_:0)/1e3,isAudioTranscoding:1===r.transcode_status,audioTranscodeInfo:d(r,"audio")};default:return h}}},300303:function(e,t,r){r.d(t,{m:function(){return i}});function i(e){try{if(!e)return{};return JSON.parse(e)}catch(e){return{}}}},730963:function(e,t,r){r.d(t,{G:function(){return o}});var i=r(127830),s=r(426020),n=r(800788);function o(e){let t={[s.YB.Video]:i._g.UserVideo,[s.YB.Image]:i._g.UserPhoto,[s.YB.File]:i._g.UserFile,[s.YB.Audio]:i._g.UserAudio}[e];if(t)return t;(0,n.ss)("un expect result, not found target type")}},556446:function(e,t,r){r.d(t,{V:function(){return g}});var i=r(789786),s=r(690613),n=r(114861),o=r(702049),a=r(405051),c=r(121130),u=r(894339),l=r(786022),d=r(768101),_=r(894365),h=r(966697),p=r(396190);class g{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new a.yk().build(a.kk);return(0,c.i3)(e),(0,u.mH)(e),(0,n.V)(e),e}()),this._networkClientInstance}get _api(){return`${o._L.getVar("web_domain")}${_.b.UPDATE_PRIVACY_POLICY}`}async updateUserPrivacyPolicy(e){try{let r=await this._networkClient.post(this._api,{app_id:l.kJ,region:this._capcutAccountService.userProfile.region,faceu_common:{loc:this._capcutAccountService.userProfile.uid,app_sdk_version:this._environmentService.appVersion},agree_privacy_policy:e.agreePrivacyPolicy?JSON.stringify(e.agreePrivacyPolicy):void 0,use_gpt_text2video:e.useGPTText2Video,export_gpt_text2video:e.exportGetText2Video},{withCredentials:!0});if("0"!==r.ret){var t;return(0,s.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,s.oW)(r.data.updated_sem)}catch(e){return(0,d.m)(e,-1,"getUserPrivacyPolicy api error")}}constructor(e,t){this._capcutAccountService=e,this._environmentService=t}}g=(0,i.gn)([(0,i.fM)(0,h.Gw),(0,i.fM)(1,p.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.Gw?Object:h.Gw,void 0===p.Y?Object:p.Y])],g)},278433:function(e,t,r){r.d(t,{u:function(){return i}});let i=(0,r(335290).yh)("user-privacy-policy-data-service")},544432:function(e,t,r){r.d(t,{O:function(){return o}});var i=r(127830),s=r(412497),n=r(527898);class o extends s.r{get resourceType(){return i._g.VideoBackground}parseEffectsToResources(e){return e.map(e=>(0,n.ll)(e))}}},286800:function(e,t,r){r.d(t,{h:function(){return o}});var i=r(393958),s=r(565520),n=r(527898);class o extends i.h{get brandResourceType(){return s.Q.Background}parseResponseDataToResources(e){return(0,n.r1)(e)}}},961235:function(e,t,r){r.d(t,{C:function(){return a}});var i=r(773943),s=r(527898),n=r(127830),o=r(850078);class a extends i.b{buildCustomRequest(e){var t;return{enable_album:null!==(t=e.enableAlbum)&&void 0!==t&&t}}get resourceType(){return n._g.VideoBackground}parseEffectsToResources(e,t){return(0,o.Z)(e,e=>e.ResourceId).map(e=>(0,s.ll)(e,t))}}},75995:function(e,t,r){r.d(t,{A:function(){return a}});var i=r(525944),s=r(758027),n=r(127830),o=r(33883);class a extends s.B{get resourceType(){return n._g.VideoBackground}get resourcePanelType(){return o.q.VideoBackground}parseHeycanResponseDataToResources(e){return(0,i.s)(e)}buildCustomRequest(e){var t;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,category_id:Number(e.category),pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t}}}}},527898:function(e,t,r){r.d(t,{ll:function(){return l},r1:function(){return u}});var i=r(623935),s=r(127830),n=r(249656),o=r(570811),a=r(32372),c=r(134429);function u(e){let{common_attr:t}=e,r=t.item_url||t.download_info.url;return{key:t.id,resourceId:t.id,effectId:t.id,md5:t.md5||t.id,name:t.title,isBusiness:!1,isVip:!1,aspectRatio:(0,o.o)(t.width,t.height,1),package:{uri:(0,a.s)(r),urlList:[r]},icon:{uri:(0,a.s)(t.cover_url.small),urlList:[t.cover_url.small]},isFromBrand:!0,source:n.Hw.BRAND,sdkVersion:c.f4,previewUrl:t.cover_url.small,isDefault:e.IsDefault,userId:t.user_id,createTime:t.create_time,isPrefab:!1}}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?u(e):function(e,t){let{common:r,extra:n,urlPrefix:o}=(0,i.sh)(s._g.VideoBackground,e,t),a={uri:n.canvas_cover,urlList:[`${o}${n.canvas_cover}`]};return{...r,md5:a.uri,package:a}}(e,t)}},525944:function(e,t,r){r.d(t,{s:function(){return c}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372),a=r(134429);function c(e){let t=(0,i.E)(e,s._g.VideoBackground),r=(0,n.D)(e.common_attr.biz_extra),c={uri:r.canvas_cover.uri,urlList:[r.canvas_cover.url]};return{...t,key:`${s._g.VideoBackground}_${t.resourceId}`,name:t.title,icon:{uri:(0,o.s)(t.coverUrl),urlList:[t.coverUrl]},previewUrl:t.coverUrl,package:c,sdkVersion:a.f4,md5:c.uri||t.md5}}},131829:function(e,t,r){r.d(t,{k:function(){return i}});let i=(0,r(335290).yh)("video-background-data-service")},430687:function(e,t,r){r.d(t,{u:function(){return i}});let i=(0,r(335290).yh)("video-data-service")},474955:function(e,t,r){r.d(t,{E:()=>L});var i=r("789786"),s=r("966697"),n=r("764091"),o=r("273340"),a=r("256718"),c=r("396190");class u extends a.k{get resourceType(){return o.g.Video}parseHeycanResponseDataToResources(e){return(0,n.Mk)(e)}buildCustomRequest(){return{loki_optional:{app_version:this._environmentService.appVersion,device_platform:"web"},pack_optional:{need_thumb:!0}}}constructor(e={},t,r){super(e,t),this._environmentService=r}}u=(0,i.gn)([(0,i.fM)(1,s.Gw),(0,i.fM)(2,c.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===s.Gw?Object:s.Gw,void 0===c.Y?Object:c.Y])],u);var l=r("157021"),d=r("690465"),_=r("502600");class h extends l.d{buildCustomRequest(e){return{search_option:{cc_web_use_new_search:!0,...this._buildFilterParams(e)},pack_optional:{need_thumb:!0,thumb_opt:'{"is_support_webp":1}'}}}filterServiceResponse(e,t){return t.data.effect_item_list=t.data.effect_item_list.filter(e=>{var t;let r=!!e.video.origin_video,i=Object.keys(null!==(t=e.video.transcoded_video)&&void 0!==t?t:{}).length>0;return r||i}),Promise.resolve(t)}get resourceType(){return o.g.Video}get _searchApi(){return this._httpApiSettingService.getRequestURL({domainType:d.Y.DEFAULT,path:_.bl.SEARCH})}parseHeycanResponseDataToResources(e){return(0,n.Mk)(e)}_buildFilterParams(e){var t,r,i;let s={};return(null===(t=e.filters)||void 0===t?void 0:t.colors)&&(s.custom_colors=e.filters.colors.map(e=>({R:e[0],G:e[1],B:e[2]}))),(null===(r=e.filters)||void 0===r?void 0:r.aspectRatios)&&(s.custom_aspect_ratios=e.filters.aspectRatios),(null===(i=e.filters)||void 0===i?void 0:i.onlyCommercial)&&(s.filter_uncommercial=e.filters.onlyCommercial),s}constructor(e,t){super(e),this._httpApiSettingService=t}}h=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.fM)(1,d.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw,void 0===d.x?Object:d.x])],h);var p=r("861810"),g=r("55449"),y=r("402655"),f=r("733110");class v extends f.i{get resourceType(){return o.g.Video}parseHeycanResponseDataToResources(e){return(0,n.Mk)(e)}buildCustomRequest(e){var t;return{pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,need_contract:!0,thumb_opt:'{"is_support_webp":1}'}}}constructor(e){super(e),this._capcutAccountService=e}}v=(0,i.gn)([(0,i.fM)(0,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw])],v);var m=r("224603"),w=r("872443"),k=r("33883"),T=r("127830");class R extends w.L{get resourcePanelType(){return k.q.Video}get resourceType(){return T._g.Video}parseHeycanResponseDataToResources(e){return(0,n.Mk)(e)}buildCustomRequest(e){var t;return{pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}}class b extends w.L{get resourcePanelType(){return k.q.MaterialLib}get resourceType(){return T._g.Video}parseHeycanResponseDataToResources(e){return(0,n.Mk)(e)}buildCustomRequest(e){return{app_id:e.appID}}buildCustomFilterParams(){return new Promise(e=>{e({})})}}var S=r("758027");class C extends S.B{get resourceType(){return T._g.Video}get resourcePanelType(){return k.q.Video}parseHeycanResponseDataToResources(e){return(0,n.Mk)(e)}buildCustomRequest(e){var t;return{category_id:Number(e.category),pack_optional:{need_thumb:!0,only_commercial:null!==(t=e.onlyCommercial)&&void 0!==t&&t,thumb_opt:'{"is_support_webp":1}'}}}}var I=r("222977");class P extends I.g{buildCustomRequest(e){return{search_option:{cc_web_use_new_search:!0,...this._buildFilterParams(e)},pack_optional:{need_thumb:!0,thumb_opt:'{"is_support_webp":1}'}}}get resourceType(){return o.g.Video}parseHeycanResponseDataToResources(e){return(0,n.Mk)(e)}_buildFilterParams(e){var t,r,i;let s={};return(null===(t=e.filters)||void 0===t?void 0:t.colors)&&(s.custom_colors=e.filters.colors.map(e=>({R:e[0],G:e[1],B:e[2]}))),(null===(r=e.filters)||void 0===r?void 0:r.aspectRatios)&&(s.custom_aspect_ratios=e.filters.aspectRatios),(null===(i=e.filters)||void 0===i?void 0:i.onlyCommercial)&&(s.filter_uncommercial=e.filters.onlyCommercial),s}}var E=r("622472"),A=r("891551"),M=r("249656");class x extends E.T{get effectType(){return o.g.Video}get effectSource(){return M.Hw.TUCHONG}get scene(){return A.c.TrackEditor}buildCustomRequest(e){var t;return{video_scale:null!==(t=e.videoScale)&&void 0!==t?t:A.u.Scale360p}}}var O=r("981895"),F=r("116827"),D=r("793871");class L extends y.JT{getVideos(e){return this._getVideoRepository.getResources(e)}getBrandVideos(e){return this._getBrandVideosRepository.getResources(e)}getVideosByCategory(e){return this._getVideoByCategoryRepository.getResources(e)}batchGetVideos(e){let{isFromBrand:t=!1}=e;return t?this._getBrandVideosByIdsRepository.getResourcesByIds({ids:e.resourceIds}):this._batchGetVideosRepository.batchGetResources(e)}batchGetTuchongVideos(e){return this._batchGetTuchongVideoRepository.batchGetResources(e)}searchVideos(e){return this._searchVideoRepository.searchResources(e)}searchTuchongVideos(e){return this._searchTuchongVideoRepository.searchResources(e)}getCollections(e){return this._collectionVideoRepository.getCollections(e)}addToCollection(e){return this._collectionVideoRepository.addToCollection(e)}removeFromCollection(e){return this._collectionVideoRepository.removeFromCollection(e)}order(e){return this._orderRepository.order(e)}getCategories(e){return this._getVideoCategoriesRepository.getCategories(e)}constructor(e={},t){super(),this.collectionParam=e,this._instantiationService=t,this.getMaterialLibCategories=e=>this._getMaterialLibVideoCategoriesRepository.getCategories(e),this._searchVideoRepository=this._instantiationService.createInstance(h),this._collectionVideoRepository=this._instantiationService.createInstance(new p.M(u,[e],!1)),this._getVideoRepository=this._instantiationService.createInstance(v),this._getVideoByCategoryRepository=this._instantiationService.createInstance(C),this._orderRepository=this._instantiationService.createInstance(x),this._batchGetVideosRepository=this._instantiationService.createInstance(m.h),this._batchGetTuchongVideoRepository=this._instantiationService.createInstance(O.S),this._getVideoCategoriesRepository=this._instantiationService.createInstance(R),this._getMaterialLibVideoCategoriesRepository=this._instantiationService.createInstance(b),this._searchTuchongVideoRepository=this._instantiationService.createInstance(P),this._getBrandVideosRepository=this._instantiationService.createInstance(F._),this._getBrandVideosByIdsRepository=this._instantiationService.createInstance(D.z),this._getMaterialLibVideoCategoriesRepository.setFixedRegion("CN")}}L=(0,i.gn)([(0,i.fM)(1,g.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===g.T?Object:g.T])],L)},922465:function(e,t,r){r.d(t,{N:function(){return n}});var i=r(623935),s=r(127830);function n(e,t){var r;let{common:n,sdkExtra:o}=(0,i.sh)(s._g.VideoMotion,e,t);return{...n,animationDuration:null==o?void 0:null===(r=o.setting)||void 0===r?void 0:r.animation_duration}}},73059:function(e,t,r){r.d(t,{F:function(){return c}});var i=r(889862),s=r(127830),n=r(981632),o=r(32372),a=r(134429);function c(e){var t;let r=(0,i.E)(e,s._g.VideoMotion),c=(0,n.D)(e.common_attr.sdk_extra);return{...r,key:`${s._g.VideoMotion}_${r.resourceId}`,name:r.title,icon:{uri:(0,o.s)(r.coverUrl),urlList:[r.coverUrl]},previewUrl:r.coverUrl,package:{uri:(0,o.s)(r.originUrl),urlList:[r.originUrl]},sdkVersion:a.f4,animationDuration:null==c?void 0:null===(t=c.setting)||void 0===t?void 0:t.animation_duration}}},618009:function(e,t,r){r.d(t,{u:function(){return i}});let i=(0,r(335290).yh)("video-motion-data-service")},842005:function(e,t,r){r.d(t,{z:()=>C});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("127830"),a=r("412497"),c=r("922465");class u extends a.r{get resourceType(){return o._g.VideoMotion}parseEffectsToResources(e){return e.map(e=>(0,c.N)(e))}}var l=r("734481"),d=r("512363");class _ extends d.L{get resourceType(){return o._g.VideoMotion}}var h=r("273340"),p=r("73059"),g=r("789869"),y=r("33883");class f extends g.A{get resourceType(){return h.g.VideoAnimation}get resourcePanelType(){return y.q.VideoMotion}parseHeycanResponseDataToResources(e){return(0,p.F)(e)}}var v=r("758027");class m extends v.B{get resourceType(){return o._g.VideoMotion}get resourcePanelType(){return y.q.VideoMotion}parseHeycanResponseDataToResources(e){return(0,p.F)(e)}buildCustomRequest(e){return{client_ab_param:e.clientABParam,panel_source:e.panelSource||"heycan",category_key:e.category,pack_optional:{image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}var w=r("872443");class k extends w.L{get resourceType(){return o._g.VideoMotion}get resourcePanelType(){return y.q.VideoMotion}parseHeycanResponseDataToResources(e){return(0,p.F)(e)}buildCustomRequest(e){return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{image_pack_param:{icon_limit:{static_format:"webp",dynamic_format:"awebp",width:100,height:100}}}}}}var T=r("744268"),R=r("736031"),b=r("249656"),S=r("305301");class C extends n.JT{async getVideoMotion(e){let t=await (0,R.bY)(this._configurationService,R.Jk);return"vimo"===(0,R.lo)(t,this._getHeycanVideoMotionByCategoryRepository.resourcePanelType).panel_path?this._getHeycanVideoMotionByCategoryRepository.getResources((0,R.lY)(e,t,{isSkipSetPanelSourceNull:!0})):this._motionRepository.getResources(e)}async batchGetVideoMotionsByIds(e){if(e.source===b.Hw.HEYCAN){let t=await (0,R.bY)(this._configurationService,R.Jk);return"loki"===(0,R.lo)(t,this._batchGetHeycanVideoMotionRepository.resourcePanelType).panel_path&&e.source!==b.Hw.HEYCAN?this._batchGetVideoMotionRepository.batchGetResources(e):this._batchGetHeycanVideoMotionRepository.batchGetResources((0,S.Q)(e.ids,this._batchGetHeycanVideoMotionRepository.resourceType,e.source))}return this._batchGetVideoMotionRepository.batchGetResources(e)}async getVideoMotionCategories(e){let t=await (0,R.bY)(this._configurationService,R.Jk);return"vimo"===(0,R.lo)(t,this._getHeycanVideoMotionCategoriesRepository.resourcePanelType).panel_path?this._getHeycanVideoMotionCategoriesRepository.getCategories((0,R.lY)(e,t)):this._getVideoMotionCategoriesRepository.getCategories(e)}constructor(e,t){super(),this._instantiationService=e,this._configurationService=t,this._motionRepository=this._instantiationService.createInstance(l.X),this._batchGetVideoMotionRepository=this._instantiationService.createInstance(u),this._getVideoMotionCategoriesRepository=this._instantiationService.createInstance(_),this._getHeycanVideoMotionByCategoryRepository=this._instantiationService.createInstance(m),this._getHeycanVideoMotionCategoriesRepository=this._instantiationService.createInstance(k),this._batchGetHeycanVideoMotionRepository=this._instantiationService.createInstance(f)}}C=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.fM)(1,T.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T,void 0===T.Ui?Object:T.Ui])],C)},87909:function(e,t,r){r.d(t,{b:function(){return i}});let i={BATCH_GET_SYNC_STATE:"/lv/v1/ever_photo/batch_get_sync_state",MULTI_GET_TEMPLATES:"/lv/v1/cc_web/replicate/multi_get_templates",SYNC_TEMPLATE_ASSET:"/lv/v1/ever_photo/sync_template_asset",GET_CATEGORY_TEMPLATES:"/lv/v1/cc_web/replicate/get_collection_templates",SEARCH_TEMPLATES:"/lv/v1/cc_web/replicate/search_templates",GET_RECOMMENDED_TEMPLATES:"/lv/v1/cc_web/replicate/get_recommended_templates",GET_COLLECTIONS:"/lv/v1/cc_web/replicate/get_collections",GET_SEARCH_WORDS:"/lv/v1/cc_web/replicate/get_search_words",GET_PUBLISH_TEMPLATE_CONFIG:"/lv/v1/cc_web/replicate/publish_config",PUBLISH_TEMPLATE:"/lv/v1/cc_web/replicate/publish_template",IMPRESSION_TEMPLATES:"/lv/v1/cc_web/replicate/impression_templates"}},648653:function(e,t,r){r.d(t,{e:function(){return n},f:function(){return o}});var i,s,n=((i={}).ILLEGAL_MUSIC="11005",i);var o=((s={})[s.library=1]="library",s[s.other=0]="other",s)},876019:function(e,t,r){r.d(t,{O:function(){return y}});var i=r(789786),s=r(690613),n=r(114861),o=r(966697),a=r(702049),c=r(405051),u=r(999432),l=r(121130),d=r(894339),_=r(768101),h=r(827084),p=r(87909),g=r(213742);class y{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build(c.kk);return(0,u.V)(e,{...g.P7}),(0,l.i3)(e),(0,d.mH)(e),(0,n.V)(e),e}()),this._networkClientInstance}async batchGetCategories(e){try{var t,r;let i=await this._networkClient.post(this._api,this._buildRequestRequest(e),{withCredentials:!0}),n=Number(null!==(t=i.ret)&&void 0!==t?t:0);if(0!==n)return(0,s.wf)(null!=n?n:-1,null!==(r=i.errmsg)&&void 0!==r?r:"batchGetCategories api error");return(0,s.oW)(this._formatDataFromServer(i))}catch(e){return(0,_.m)(e,-1,"batchGetCategories api error")}}_formatDataFromServer(e){let{collections:t=[]}=e.data;return{logId:e.log_id,list:t.map(e=>{let t={id:e.id,name:e.display_name,resourceLen:e.resource_len,direction:e.direction,rootCategory:e.root_category,categoryType:e.category_type,starlingKey:e.starling_key,useChangeMode:!!e.changes_button_status};return e.detail_info?{...t,detail:{hasMore:e.detail_info.has_more,offset:e.detail_info.new_cursor,list:e.detail_info.item_list.map(e=>(0,h.yt)(e))}}:t})}}_buildRequestRequest(e){var t;return{sdk_version:g.pH,uuid:this._accountService.userProfile.uid,show_ugc_template:e.showUgcTemplate,collection_type:e.panelType,detail_count:null!==(t=e.count)&&void 0!==t?t:0,template_id_list:e.templateIdList,draft_id:e.draftId,canvas_width:e.canvasWidth,canvas_height:e.canvasHeight,asset_md5_list:e.userGeneratedOnTrackMaterialsMd5List,resources_id_list:e.otherMaterialsIdList,trigger_scene:e.triggerScene,enter_from:e.enterFrom,web_id:this._accountService.userProfile.webId,source:"capcut_recommend",frontend_impression:!0}}get _api(){return`${a._L.getVar("web_domain")}${p.b.GET_COLLECTIONS}`}constructor(e){this._accountService=e}}y=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw])],y)},957412:function(e,t,r){r.d(t,{a:function(){return k}});var i=r(789786),s=r(690613),n=r(114861),o=r(966697),a=r(249656),c=r(702049),u=r(405051),l=r(999432),d=r(121130),_=r(894339),h=r(866006),p=r(768101),g=r(827084),y=r(87909),f=r(744268),v=r(454530),m=r(213742),w=r(396190);class k{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build(u.kk);return(0,l.V)(e,{...m.P7}),(0,d.i3)(e),(0,_.mH)(e),(0,n.V)(e),e}()),this._networkClientInstance}async batchGetVideoTemplatesByCategory(e){let t=e instanceof h.yt?e.config:e;try{var r,i;let e=await this._networkClient.post(this._api,this._buildRequestRequest({limit:20,...t}),{withCredentials:!0}),n=Number(null!==(r=e.ret)&&void 0!==r?r:0);if(0!==n)return(0,s.wf)(null!=n?n:-1,null!==(i=e.errmsg)&&void 0!==i?i:"batchGetVideoTemplatesByCategory api error");let o=this._convertResponseToQueryToken(t,e);return(0,s.oW)(o)}catch(e){return(0,p.m)(e,-1,"batchGetVideoTemplatesByCategory api error")}}_convertResponseToQueryToken(e,t){let r={list:t.data.item_list.map(e=>(0,g.yt)({...e,user_bizid:t.data.user_bizid})),requestId:t.log_id,searchId:t.log_id},{has_more:i,new_cursor:s}=t.data;return(0,h.ib)(e,r,{hasMore:i,offset:Number(null!=s?s:0),logId:t.log_id})}_buildRequestRequest(e){var t,r;let i=this._configurationService.abTestManager.getBooleanAbTestValue(v.o.NewTransitionEffectEnabled),s=this._environmentService.isAutoTest||i?a.Nb.New:a.Nb.Old;return{id:e.categoryId,enter_from:null!==(t=e.enterFrom)&&void 0!==t?t:"template_editor",web_feed_entrance:"feed",sdk_version:m.pH,uuid:this._accountService.userProfile.uid,count:e.limit,cursor:`${null!==(r=e.offset)&&void 0!==r?r:e.limit}`,cc_web_version:s,template_id_list:e.templateIdList,draft_id:e.draftId,canvas_width:e.canvasWidth,canvas_height:e.canvasHeight,asset_md5_list:e.userGeneratedOnTrackMaterialsMd5List,resources_id_list:e.otherMaterialsIdList,trigger_scene:e.triggerScene,web_id:this._accountService.userProfile.webId,source:"capcut_recommend",frontend_impression:!0}}get _api(){return`${c._L.getVar("web_domain")}${y.b.GET_CATEGORY_TEMPLATES}`}constructor(e,t,r){this._accountService=e,this._configurationService=t,this._environmentService=r}}k=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.fM)(1,f.Ui),(0,i.fM)(2,w.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw,void 0===f.Ui?Object:f.Ui,void 0===w.Y?Object:w.Y])],k)},922453:function(e,t,r){r.d(t,{Y:function(){return f}});var i=r(789786),s=r(690613),n=r(114861),o=r(966697),a=r(702049),c=r(405051),u=r(999432),l=r(121130),d=r(894339),_=r(768101),h=r(87909),p=r(213742),g=r(650248),y=r(396190);class f{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build(c.kk);return(0,u.V)(e,{...p.P7}),(0,l.i3)(e),(0,d.mH)(e),(0,n.V)(e),e}()),this._networkClientInstance}impressionTemplates(e){this._templateIdList.push(e.templateId),this._sendRequestThrottle()}async _sendRequest(){try{var e,t;let r=await this._networkClient.post(this._api,this._buildRequestRequest(),{withCredentials:!0}),i=Number(null!==(e=r.ret)&&void 0!==e?e:0);if(0!==i)return(0,s.wf)(null!=i?i:-1,null!==(t=r.errmsg)&&void 0!==t?t:"impressionTemplates api error");return(0,s.oW)(r.data)}catch(e){return(0,_.m)(e,-1,"impressionTemplates api error")}}_buildRequestRequest(){let e=[...this._templateIdList];return this._templateIdList=[],{template_id_list:e,uuid:this._accountService.userProfile.uid}}get _api(){return`${a._L.getVar("web_domain")}${h.b.IMPRESSION_TEMPLATES}`}constructor(e,t){this._accountService=e,this._environmentService=t,this._templateIdList=[],this._sendRequestThrottle=(0,g.Z)(this._sendRequest,1e3,{leading:!1}).bind(this)}}f=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.fM)(1,y.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw,void 0===y.Y?Object:y.Y])],f)},884461:function(e,t,r){r.d(t,{K:function(){return _}});var i=r(690613),s=r(114861),n=r(702049),o=r(405051),a=r(999432),c=r(121130),u=r(768101),l=r(87909),d=r(213742);class _{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.V)(e,{...d.P7}),(0,c.i3)(e),(0,s.V)(e),e}()),this._networkClientInstance}async publishTemplate(e){try{var t;let r=await this._networkClient.post(this._api,this._buildRequestRequest(e),{withCredentials:!0}),s=Number(null!==(t=r.ret)&&void 0!==t?t:0);if(0!==s)return(0,i.wf)(null!=s?s:-1,"publish template error");let n=this._convertResponseToPublishTemplateResult(r);return(0,i.oW)(n)}catch(e){return(0,u.m)(e,-1,"publishTemplate api error")}}_convertResponseToPublishTemplateResult(e){let{id:t,web_id:r,illegal_music_list:i}=e.data;return{id:t,webId:r,illegalMusicList:i?JSON.parse(i):[]}}_buildRequestRequest(e){return{title:e.title,description:e.description,template_type:e.templateType,segment_template_collection:e.segmentTemplateCollection,template_json:e.templateJson,template_attachment_json:e.templateAttachmentJson,template_attachment_video_algorithm_json:e.templateAttachmentVideoAlgorithmJson,music_source:e.musicSource,lang:e.lang,sdk_version:e.sdkVersion,app_version:e.appVersion,file_info:e.fileInfo.map(e=>{let t;return e.pipelinePath&&(t={result:e.pipelinePath.result,matting:e.pipelinePath.matting,edge_product:e.pipelinePath.edgeProduct}),{md5:e.md5,space_id:e.spaceId,space_idc:e.spaceIdc,material_id:e.materialId,material_schema:e.materialSchema,material_source:e.materialSource,material_type:e.materialType,pipeline_id:e.pipelineId,pipeline_path:t,path:e.path,cover_path:e.coverPath,is_public:e.isPublic}}),cover:e.cover,cover_width:e.coverWidth,cover_height:e.coverHeight,fragment_count:e.fragmentCount,limit:{platform:e.limit.platform,sdk_version_min:e.limit.sdkVersionMin},extra:e.extra,render_info:{task_id:e.renderInfo.taskId},settings:{is_mute:e.settings.isMute,default_open_mode:e.settings.defaultOpenMode,dynamic_slots_option:e.settings.dynamicSlotsOption,can_update_music:e.settings.canUpdateMusic},purchase_info:{amount:e.purchaseInfo.amount,product_id:e.purchaseInfo.productId,currency_code:e.purchaseInfo.currencyCode,need_purchase:e.purchaseInfo.needPurchase,need_unlock_by_ad:e.purchaseInfo.needUnlockByAd},functions:e.functions,workspace_id:e.workspaceId}}get _api(){return`${n._L.getVar("web_domain")}${l.b.PUBLISH_TEMPLATE}`}}},801859:function(e,t,r){r.d(t,{s:function(){return b}});var i=r(789786),s=r(690613),n=r(114861),o=r(966697),a=r(249656),c=r(702049),u=r(405051),l=r(999432),d=r(121130),_=r(894339),h=r(866006),p=r(768101),g=r(504826),y=r(827084),f=r(87909),v=r(744268),m=r(86571),w=r(454530),k=r(801497),T=r(213742),R=r(396190);class b{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new u.yk().build({...u.kk,withCredentials:!0});return(0,l.V)(e,{...T.P7,lan:k.ZP.language}),(0,d.i3)(e),(0,_.mH)(e),(0,n.V)(e),e}()),this._networkClientInstance}async searchVideoTemplates(e){let t=e instanceof h.yt?e.config:e;try{var r,i;let n=await this._networkClient.post(this._api,this._buildRequestRequest(e)),o=Number(null!==(r=n.ret)&&void 0!==r?r:0);if(0!==o)return(0,s.wf)(null!=o?o:-1,null!==(i=n.errmsg)&&void 0!==i?i:"batchGetRecommendedVideoTemplates api error");let a=this._convertResponseToQueryToken(t,n);return(0,s.oW)(a)}catch(e){return(0,p.m)(e,-1,"searchVideoTemplates api error")}}_convertResponseToQueryToken(e,t){var r,i;let s={list:null!==(i=null===(r=t.data.video_templates)||void 0===r?void 0:r.map(e=>(0,y.yt)({...e,user_bizid:t.data.user_bizid})))&&void 0!==i?i:[]},{has_more:n,new_cursor:o}=t.data;return(0,h.ib)(e,s,{hasMore:n,offset:Number(null!=o?o:0),searchId:t.data.search_id,requestId:t.data.request_id||t.log_id})}_buildRequestRequest(e){var t,r,i;let s=e instanceof h.yt?e.config:e;s.limit=s.limit||20;let{filters:n={},query:o="",scene:c=g.cY.Video}=s,u=(()=>{switch(null==n?void 0:n.ratio){case"1:1":return 1;case"9:16":return 2;case"16:9":return 3;default:return}})(),l=(()=>{if(!(null==n?void 0:n.color))return;if((0,m.S)(n.color))return n.color;let e=parseInt(n.color.replace("#","0x"),16);return[e>>16,e>>8&255,255&e]})(),d=this._configurationService.abTestManager.getBooleanAbTestValue(w.o.NewTransitionEffectEnabled),_=this._environmentService.isAutoTest||d?a.Nb.New:a.Nb.Old,{offset:p,count:y}=(0,h.ky)(e)?{count:null!==(t=e.config.limit)&&void 0!==t?t:50,offset:null!==(r=e.offset)&&void 0!==r?r:0}:{...this.defaultQueryToken,...e.limit?{count:e.limit}:void 0};return{query:o,scale:u,color:l,scene:c,filter_type:n.onlyCommercial?"commercial":void 0,enter_from:null!==(i=s.enterFrom)&&void 0!==i?i:"template_editor",sdk_version:T.pH,count:y,cursor:`${p}`,cc_web_version:_,search_id:(0,h.ky)(e)?e.searchId:void 0}}get _api(){return`${c._L.getVar("web_domain")}${f.b.SEARCH_TEMPLATES}`}get defaultQueryToken(){return{offset:0,count:50}}constructor(e,t,r){this._accountService=e,this._configurationService=t,this._environmentService=r}}b=(0,i.gn)([(0,i.fM)(0,o.Gw),(0,i.fM)(1,v.Ui),(0,i.fM)(2,R.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw,void 0===v.Ui?Object:v.Ui,void 0===R.Y?Object:R.Y])],b)},166226:function(e,t,r){r.d(t,{N:function(){return s}});var i=r(504826);function s(e,t){return 348188===t?4:e===i.WY.BUSINESS?1:e===i.WY.CONSUMER?0:void 0}},606527:function(e,t,r){r.d(t,{_:function(){return i}});let i=(0,r(335290).yh)("draft-save-data-service")},20498:function(e,t,r){r.d(t,{s:()=>m});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("405051"),a=r("894339"),c=r("121130"),u=r("768101"),l=r("690613"),d=r("197238"),_=r("242369"),h=r("690465");class p{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new o.yk().build(o.kk);return(0,a.mH)(e),(0,c.i3)(e),e}()),this._networkClientInstance}async save(e){var t,r,i;try{let i=await this._networkClient.post(this._api,e,{withCredentials:!0}),s=i.ret;if("0"!==s)return(0,l.Mx)(Number(s),i.errmsg,i);return(0,l.oW)(null!==(r=null===(t=i.data)||void 0===t?void 0:t.package_id)&&void 0!==r?r:"")}catch(t){let e=null!==(i=null==t?void 0:t.ret)&&void 0!==i?i:null==t?void 0:t.code;return(0,u.m)(t,d.pY.Interrupted,`saveDraft api error: ${e}, msg: ${null==t?void 0:t.message}`)}}async deltaUpdate(e){var t,r,i;try{let i=await this._networkClient.post(this._deltaUpdateApi,e,{withCredentials:!0}),s=i.ret;if("0"!==s)return(0,l.Mx)(Number(s),i.errmsg,i);return(0,l.oW)(null!==(r=null===(t=i.data)||void 0===t?void 0:t.package_id)&&void 0!==r?r:"")}catch(t){let e=null!==(i=null==t?void 0:t.ret)&&void 0!==i?i:null==t?void 0:t.code;return(0,u.m)(t,d.pY.Interrupted,`deltaUpdate api error: ${e}, msg: ${null==t?void 0:t.message}`)}}get _api(){return this._httpApiSettingService.getRequestURL({domainType:h.Y.JIANYING,path:_.b.SAVE_DRAFT})}get _deltaUpdateApi(){return this._httpApiSettingService.getRequestURL({domainType:h.Y.JIANYING,path:_.b.DELTA_UPDATE})}constructor(e){this._httpApiSettingService=e}}p=(0,i.gn)([(0,i.fM)(0,h.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.x?Object:h.x])],p);var g=r("292180"),y=r("492197"),f=r("823981"),v=r("799882");class m extends n.JT{save(e){let t=this._buildRequest(e);return this._draftSaveRepository.save(t)}deltaUpdate(e){let t=this._buildRequest(e);return this._draftSaveRepository.deltaUpdate(t)}constructor(e){super(),this._instantiationService=e,this._buildRequest=e=>{let t=["md5"];return(0,f.Z)(e)||(0,v.Z)(e)?(0,y.Z)(e,(r,i)=>{let s=t.includes(i)?i:(0,g.Z)(i);switch(delete e[i],!0){case(0,f.Z)(r):e[s]=r.map(this._buildRequest);case(0,v.Z)(r):e[s]=this._buildRequest(r);default:e[s]=r}return s}):e},this._draftSaveRepository=this._instantiationService.createInstance(p)}}m=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],m)},660157:function(e,t,r){r.d(t,{$:function(){return s}});var i,s=((i={})[i.Video=2]="Video",i[i.Graphic=5]="Graphic",i)},801868:function(e,t,r){r.d(t,{hv:function(){return i}});let i=(0,r(335290).yh)("export-data-service")},956797:function(e,t,r){r.d(t,{I:()=>f});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("405051"),u=r("121130"),l=r("894339"),d=r("768101"),_=r("905906"),h=r("847083"),p=r("690465");class g{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(e){let{addBusinessPlugins:t}=e,r=new c.yk().build({headers:{"Content-Type":"application/json"}});return t(r,[h.U.Shark]),(0,u.i3)(r),(0,a.V)(r,{isRetry:e=>{var t;return(null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)!==429&&!0}}),(0,l.mH)(r),r}(this._clientPluginService)),this._networkClientInstance}_getApi(e){return this._httpApiSettingService.getRequestURL({domainType:p.Y.JIANYING,path:e})}_createSubmitId(){return this._updateSubmitId?`${new Date().getTime()}_${Math.random()}`:this._taskSubmitId}async createExportTask(e){try{this._taskSubmitId=this._createSubmitId(),this._updateSubmitId=!0;let t=await this._networkClient.post(this._getApi(_.b.CREATE_EXPORT_TASK),{...e,submit_id:this._taskSubmitId},{withCredentials:!0});if("0"!==t.ret)return(0,o.wf)(Number(t.ret),t.errmsg,{log_id:t.log_id});return(0,o.oW)({...t.data,log_id:t.log_id})}catch(e){return(null==e?void 0:e.code)==="ERR_NETWORK"&&(this._updateSubmitId=!1),(0,d.m)(e,-1,"createExportTask api error.")}}async getExportTask(e){try{let t=await this._networkClient.post(this._getApi(_.b.GET_EXPORT_TASK_DETAIL),e,{withCredentials:!0});if("0"!==t.ret)return(0,o.wf)(Number(t.ret),t.errmsg,{log_id:t.log_id});return(0,o.oW)({...t.data.render_task[e.task_ids[0]],log_id:t.log_id})}catch(e){return(0,d.m)(e,-1,"getExportTaskDetail api error.")}}async cancelExportTask(e){try{let t=await this._networkClient.post(this._getApi(_.b.CANCLE_EXPORT_TASK),e,{withCredentials:!0});if("0"!==t.ret)return(0,o.wf)(Number(t.ret),t.errmsg,{log_id:t.log_id});return(0,o.ly)()}catch(e){return(0,d.m)(e,-1,"cancelExportTask api error.")}}async retryExportTask(e){try{let t=await this._networkClient.post(this._getApi(_.b.CREATE_EXPORT_TASK),e,{withCredentials:!0});if("0"!==t.ret)return(0,o.wf)(Number(t.ret),t.errmsg,{log_id:t.log_id});return(0,o.oW)(t.data)}catch(e){return(0,d.m)(e,-1,"retryExportTask api error.")}}constructor(e,t){this._clientPluginService=e,this._httpApiSettingService=t,this._taskSubmitId="",this._updateSubmitId=!0}}g=(0,i.gn)([(0,i.fM)(0,h.a),(0,i.fM)(1,p.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.a?Object:h.a,void 0===p.x?Object:p.x])],g);var y=r("903943");class f extends n.JT{async createExportTask(e){let t=await this._exportRepository.createExportTask(e);return t.ok?(0,o.oW)(t.value):t}async createExportTaskLifeCycle(e){let t=await this._exportRepository.createExportTask(e);return t.ok?(0,o.oW)(new y.w(this._exportRepository,t.value)):t}async createExportTaskLifeCycleForBusiness(e,t){let r=await this._exportRepository.createExportTask(e);return r.ok&&"0"!==r.value.task_id?(0,o.oW)(new y.w(this._exportRepository,r.value,t)):r}async getExportTask(e){let t=await this._exportRepository.getExportTask(e);return t.ok?(0,o.oW)(t.value):t}cancelExportTask(e){return this._exportRepository.cancelExportTask(e)}retryExportTask(e){return this._exportRepository.retryExportTask(e)}constructor(e){super(),this._instantiationService=e,this._exportRepository=this._instantiationService.createInstance(g)}}f=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],f)},303079:function(e,t,r){r.d(t,{G:function(){return i}});let i=(0,r(335290).yh)("first-frame-data-service")},530743:function(e,t,r){r.d(t,{Q:function(){return l}});var i=r(690613),s=r(405051),n=r(121130),o=r(894339),a=r(768101),c=r(702049),u=r(338473);class l{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new s.yk().build(s.kk);return(0,n.i3)(e),(0,o.mH)(e),e}()),this._networkClientInstance}get _api(){return`${c._L.getVar("web_domain")}${u.b.RENDER_FRAME}`}async renderFirstFrame(e){try{let r=await this._networkClient.post(this._api,{draft_id:e.draftId,package_id:e.packageId,frame_change:e.frameChange,workspace_id:e.workspaceId,draft_info:{canvas_config:e.draftInfo.canvasConfig,duration:e.draftInfo.duration}},{withCredentials:!0});if("0"!==r.ret){var t;return(0,i.wf)(Number(r.ret),null!==(t=r.errmsg)&&void 0!==t?t:"")}return(0,i.ly)()}catch(e){return(0,a.m)(e,-1,"renderFirstFrame api error")}}}},64479:function(e,t,r){r.d(t,{b:function(){return i}});let i={MUSIC_BEAT:"/lv/v1/music/music_beat",MUSIC_BEAT_AGREEMENT:"/lv/v1/music/check_agree_info"}},381516:function(e,t,r){r.d(t,{_:function(){return i}});let i=(0,r(335290).yh)("music-beat-data-service")},991335:function(e,t,r){r.d(t,{h:function(){return a}});var i=r(789786),s=r(55449),n=r(402655),o=r(125975);class a extends n.JT{getMusicBeats(e){return this._musicBeatRepository.getMusicBeats(e)}getMusicBeatAgreement(){return this._musicBeatRepository.getMusicBeatAgreement()}constructor(e){super(),this._instantiationService=e,this._musicBeatRepository=this._instantiationService.createInstance(o.N)}}a=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],a)},375503:function(e,t,r){r.d(t,{$:()=>d});var i=r("405051"),s=r("121130"),n=r("894339"),o=r("768101"),a=r("702049"),c=r("690613"),u=r("114861");let l="/lv/v1/common/tts/token";class d{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new i.yk().build({headers:{"Content-Type":"application/json"}});return(0,s.i3)(e),(0,n.mH)(e),(0,u.V)(e),e}()),this._networkClientInstance}async getToken(){try{let e=await this._networkClient.request({method:"post",url:this._api,withCredentials:!0});if("0"!==e.ret)return(0,c.wf)(Number(e.ret),e.errmsg);return(0,c.oW)({token:e.data.token,appKey:e.data.app_key})}catch(e){return(0,o.m)(e,-1,"getToken api error.")}}get _api(){return`${a._L.getVar("web_domain")}${l}`}}},755358:function(e,t,r){r.d(t,{z:function(){return i}});let i=(0,r(335290).yh)("text-to-speech-data-service")},89683:function(e,t,r){r.d(t,{T:()=>_});var i=r("702049"),s=r("405051"),n=r("121130"),o=r("894339"),a=r("866006"),c=r("690613"),u=r("114861");let l={GET_WOKRSPACE_MEMBER:"/cc/v1/workspace/get_member"};var d=r("768101");class _{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new s.yk().build({headers:{"Content-Type":"application/json"}});return(0,n.i3)(e),(0,o.mH)(e),(0,u.V)(e),e}()),this._networkClientInstance}_getApi(e){return`${i._L.getVar("web_domain")}${e}`}async getMembers(e){let t=e instanceof a.yt?e.config:e;try{var r,i;let e=await this._networkClient.post(this._getApi(l.GET_WOKRSPACE_MEMBER),{count:null!==(r=t.limit)&&void 0!==r?r:10,cursor:`${null!==(i=t.offset)&&void 0!==i?i:""}`,workspace_id:t.workspaceId},{withCredentials:!0});if("0"!==e.ret)return(0,c.wf)(Number(e.ret),e.errmsg);let s=this._convertResponseToQueryToken(t,e);return(0,c.oW)(s)}catch(e){return(0,d.m)(e,-1,"workspace getMember api error")}}_convertResponseToQueryToken(e,t){let r=t.data.member_list.map(e=>({uid:e.uid,nickname:e.uid,avatar:e.avatar,role:e.role,everPhotoUid:e.ever_photo_uid})),{has_more:i,next_cursor:s}=t.data;return(0,a.ib)(e,{list:r},{hasMore:i,offset:Number(null!=s?s:0)})}}},946561:function(e,t,r){r.d(t,{b:function(){return i}});let i={GET_WOKRSPACES:"/cc/v1/workspace/get_user_workspaces"}},706707:function(e,t,r){r.d(t,{z:function(){return i}});let i=(0,r(335290).yh)("workspace-data-service")},458871:function(e,t,r){r.d(t,{y:()=>f});var i=r("789786"),s=r("55449"),n=r("402655"),o=r("690613"),a=r("114861"),c=r("405051"),u=r("121130"),l=r("894339"),d=r("866006"),_=r("768101"),h=r("690465"),p=r("946561");class g{get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=function(){let e=new c.yk().build({headers:{"Content-Type":"application/json"}});return(0,u.i3)(e),(0,l.mH)(e),(0,a.V)(e),e}()),this._networkClientInstance}async getWorkspace(e){let t=e instanceof d.yt?e.config:e;try{var r,i,s;let n=await this._networkClient.post(this._httpApiSettingService.getRequestURL({domainType:h.Y.DEFAULT,path:p.b.GET_WOKRSPACES}),{count:null!==(r=t.limit)&&void 0!==r?r:this._defaultLimit,cursor:`${null!==(i=t.offset)&&void 0!==i?i:"0"}`,need_convert_workspace:null===(s=t.needCovertWorkspace)||void 0===s||s},{withCredentials:!0,params:{lite_aid:t.liteAppId}});if("0"!==n.ret)return(0,o.wf)(Number(n.ret),n.errmsg);let a=this._convertResponseToQueryToken(e,n);return(0,o.oW)(a)}catch(e){return(0,_.m)(e,-1,"workspace get user workspace api error")}}_convertResponseToQueryToken(e,t){var r;let i=t.data.workspace_infos.map(e=>{var t;return{workspaceId:(t=e).workspace_id,name:t.name,spaceId:t.space_id,role:t.role,callerNickname:t.caller_nickname,memberLimit:t.member_limit,memberCount:t.member_cnt,owner:t.owner,ownerName:t.owner_name,quota:t.quota,usage:t.usage,avatarColor:t.avatar_color,invitationLink:t.invitation_link,expireTime:t.expire_time,region:t.region,idc:t.idc,dcName:t.dcName,spaceIdc:t.space_idc,spaceHost:t.space_host,spaceResHost:t.space_res_host,spaceType:t.space_type,rawSpaceType:t.raw_space_type,hasBrandPermission:t.has_brand_permission}}),{has_more:s}=t.data,n=e instanceof d.yt?e.config:e;return(0,d.ib)(n,{list:i},{hasMore:s,offset:(e instanceof d.yt?null==e?void 0:e.offset:0)+(null!==(r=null==n?void 0:n.limit)&&void 0!==r?r:this._defaultLimit)})}constructor(e){this._httpApiSettingService=e,this._defaultLimit=100}}g=(0,i.gn)([(0,i.fM)(0,h.x),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.x?Object:h.x])],g);var y=r("241033");class f extends n.JT{getWorkspace(e){return this._getWorkspaceRepository.getWorkspace(e)}getChanelWorkspace(e){return this._getChanelRepository.getChanelWorkspace(e)}constructor(e){super(),this._instantiationService=e,this._getWorkspaceRepository=this._instantiationService.createInstance(g),this._getChanelRepository=new y.Y}}f=(0,i.gn)([(0,i.fM)(0,s.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],f)},629529:function(e,t,r){r.d(t,{L:function(){return i}});class i{get isInSdkIframe(){return this._isInSdkIframe}constructor(e){var t,r,i,s,n,o,a;this.isDev=e.isDev,this.isProd=e.isProd,this.isBoe=null!==(t=e.isBoe)&&void 0!==t?t:!e.isProd,this.isInternal=e.isInternal,this.isAutoTest=function(){let{searchParams:e}=new URL(window.location.href);return!!e.get("is_auto_test")}(),this.isRealAutoTest=function(){let{searchParams:e}=new URL(window.location.href);return!!e.get("is_real_auto_test")}(),this.appVersion=null!==(r=e.appVersion)&&void 0!==r?r:"0.0.1",this.appId=null!==(i=null==e?void 0:e.appId)&&void 0!==i?i:0,this._isInSdkIframe=function(){var e,t;let{searchParams:r}=new URL(window.location.href),i={clientId:null!==(e=r.get("client_id"))&&void 0!==e?e:"",appName:null!==(t=r.get("app_name"))&&void 0!==t?t:""};return"1"===r.get("embed_sdk")&&"plugin"===r.get("utm_campaign")&&!!i.clientId}(),this.host_env={cpu_cores:null===(n=navigator)||void 0===n?void 0:n.hardwareConcurrency,device_memory:null!==(a=null===(o=navigator)||void 0===o?void 0:o.deviceMemory)&&void 0!==a?a:-1},this.forceHighQuality=null!==(s=null==e?void 0:e.forceHighQuality)&&void 0!==s&&s}}},396190:function(e,t,r){r.d(t,{Y:function(){return i}});let i=(0,r(335290).yh)("environment")},28791:function(e,t,r){r.d(t,{in:function(){return n},jd:function(){return o},yR:function(){return a}});var i,s=r(335290);var n=((i={})[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warning=2]="Warning",i[i.Error=3]="Error",i);let o=1,a=(0,s.yh)("logger")},87967:function(e,t,r){r.d(t,{g:function(){return o}});var i=r(789786),s=r(685795),n=r(104985);class o{createLogger(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._loggers.has(e))return this._loggers.get(e);let r=new n.a(this._slardarAdapterService,this,e,t);return this._loggers.set(e,r),r}getLogger(e){return this._loggers.get(e)}destroy(e){return this._loggers.delete(e)}constructor(e){this._slardarAdapterService=e,this._loggers=new Map}}o=(0,i.gn)([(0,i.fM)(0,s.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.L?Object:s.L])],o)},847083:function(e,t,r){r.d(t,{U:function(){return n},a:function(){return o}});var i,s=r(335290);var n=((i={})[i.Shark=0]="Shark",i[i.Preload=1]="Preload",i);let o=(0,s.yh)("network-client-plugin-service")},588415:function(e,t,r){r.d(t,{r:()=>u});var i=r("789786"),s=r("685795"),n=r("596112"),o=r("800788"),a=r("476624");class c extends a.O{reportBusinessEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!!this._filter(t))super.reportBusinessEvent(e,t,r)}reportBusinessExitEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!!this._filter(t))super.reportBusinessExitEvent(e,t,r)}reportDevEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!!this._filter(t))super.reportDevEvent(e,t)}reportDevError(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super.reportDevError(e,t,r)}constructor(e,t,r){super(e,t),this._filter=r}}class u{reportBusinessEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.url_path=location.pathname;let{immediately:i=!1,important:s=!0}=r;s?this._teaAdapterService.ensureTrack(e,t,i):this._teaAdapterService.track(e,t,i),r.syncServer&&((0,o.ZB)(this._requestStub),this._requestStub(e,{session_id:this._teaAdapterService.getSessionId(),...this._teaAdapterService.getCommonEventParams(),...t},this._teaAdapterService.getTeaConfig()))}reportBusinessEventByServer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.ZB)(this._requestStub);let r=this._teaAdapterService.getTeaConfig();this._requestStub(e,{session_id:this._teaAdapterService.getSessionId(),...this._teaAdapterService.getCommonEventParams(),...t},r)}reportBusinessExitEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.reportBusinessEvent(e,t,{...r,immediately:!0})}reportDevEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;this._slardarAdapterService.sendEvent(e,function(e){let t={};return Object.entries(e).forEach(e=>{let[r,i]=e;("number"==typeof i||"string"==typeof i)&&(t[r]=i)}),t}(t),r)}reportDevResource(e){this._slardarAdapterService.reportResource(e)}reportDevPerf(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._slardarAdapterService.sendCustomPerfMetric(e,t,function(e){let t={};return Object.entries(e).forEach(e=>{let[r,i]=e;"string"==typeof i&&(t[r]=i)}),t}(r))}reportDevError(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._slardarAdapterService.captureException(e,t,r)}createReporter(e,t){(0,o.Y2)(!this._reporters.has(e),"reporter existed.");let r=new a.O(t,this);return this._reporters.set(e,r),r}createSamplingReporter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=new c(r,this,t);return this._reporters.set(e,i),i}getReporter(e){return(0,o.Y2)(this._reporters.has(e),"reporter not existed."),this._reporters.get(e)}reportPv(e,t){this._teaAdapterService.reportPv(e,t)}constructor(e,t,r){this._requestStub=e,this._teaAdapterService=t,this._slardarAdapterService=r,this._reporters=new Map}}u=(0,i.gn)([(0,i.fM)(1,n.w),(0,i.fM)(2,s.L),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object,void 0===n.w?Object:n.w,void 0===s.L?Object:s.L])],u)},31463:function(e,t,r){r.d(t,{m:function(){return i}});let i=(0,r(335290).yh)("report")},594062:function(e,t,r){r.d(t,{V:()=>I});var i=r("789786"),s=r("688432"),n=r("861810"),o=r("55449"),a=r("800788"),c=r("787076"),u=r("114861"),l=r("191981"),d=r("63434"),_=r("587892"),h=r("690613"),p=r("197238"),g=r("208041"),y=r("168550"),f=r("291081"),v=r("340073"),m=r("627084"),w=r("332557");function k(e,t){return`${e}_${t}`}class T{get onSuccess(){return this._value?(0,d.V)(this._value):this._onSuccess.event}get onFail(){return this._error?(0,d.V)(this._error):this._onFail.event}get key(){return this._options.key}get status(){return this._status}get value(){return this._value}get sourceFrom(){return this._sourceFrom}get error(){return this._error}get downloadType(){return this._downloadType}set downloadType(e){this._config.downloadType=e}async fetch(){if(this._status=y.lh.Loading,this._clearCacheIfExist&&await this._deleteResourceCacheIfExist(),this._databaseFirst&&await this._fetchByStorage(),this._status===y.lh.Loading)this._options.url.startsWith("blob:")?await this._fetchByBlobUrl():await this._fetchByNetwork()}cancel(){this._downloadService.remove(this),this._cancellationTokenSource.cancel(),this._fireFail((0,h.wf)(p.pY.Cancelled,"download task canceled."))}startImmediately(){this._downloadService.startImmediately(this)}equal(e){return(0,l.v)(this._options,e._options)&&(0,l.v)(this._compareConfig,e._compareConfig)}toJSON(){return{options:this._options,config:this._compareConfig}}get _compareConfig(){let e={};return this._config.cacheInDatabase&&(e.cacheInDatabase=this._config.cacheInDatabase),this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),this._config.headers&&(e.headers=this._config.headers),this._config.disableTokenHeaders&&(e.disableTokenHeaders=this._config.disableTokenHeaders),e}get _downloadType(){var e;return null!==(e=this._config.downloadType)&&void 0!==e?e:y._5.Idle}get _cacheInDatabase(){var e;return null===(e=this._config.cacheInDatabase)||void 0===e||e}get _databaseFirst(){var e;return null===(e=this._config.databaseFirst)||void 0===e||e}get _clearCacheIfExist(){var e;return null!==(e=this._config.clearCacheIfExist)&&void 0!==e&&e}get _headers(){return this._config.headers}get _disableTokenHeaders(){var e;return null!==(e=this._config.disableTokenHeaders)&&void 0!==e&&e}async _deleteResourceCacheIfExist(){let e=await this._storageService.database.connect(f.g.id,v.d.name);if(!e.ok)return!1;let t=e.value,[r]=(await t.delete(this._options.key,{durability:"relaxed"})).pair();return(!r||!!r.ok)&&!0}async _fetchMetaByStorage(){let e=await this._storageService.database.connect(f.g.id,v.d.name);if(!e.ok)return e;let t=e.value,[r,i]=(await t.query(this._options.key,{durability:"relaxed"})).pair();return r&&!r.ok?r:i?(0,h.oW)(i):(0,p.PX)()}async _fetchDetailByStorage(e){var t,r;let i=await this._storageService.database.connect(f.g.id,v.z.name);if(!i.ok)return i;let s=i.value;let[n,o]=(await s.query((t=e.uniqueId,r=e.decryptHash,`${t}_${r}`),{durability:"relaxed"})).pair();return n&&!n.ok?n:o?(0,h.oW)(o):(0,p.PX)()}async _fetchByStorage(){let e=this._fetchDetailByStorage({uniqueId:this._options.uniqueId,decryptHash:this._options.decryptHash}),[t,r]=(await this._fetchMetaByStorage()).pair();if(t||r.uniqueId!==this._options.uniqueId||r.decryptHash!==this._options.decryptHash)return;let[i,s]=(await e).pair();if(!i)this._fireSuccess({key:this._options.key,url:this._options.url,uniqueId:this._options.uniqueId,decryptHash:this._options.decryptHash,contentType:r.contentType,buffer:s.buffer},y.Gu.Cache)}async _fetchByNetwork(){try{var e,t;let r={};if(t=this._options.url,!/http(s)?:\/\/lf\d-lv-buz\.vlabstatic\.com/.test(t)&&t.match(/origin/)){let[e,t]=(await this._evercloudTokenDataService.getEvercloudToken()).pair();!e&&!this._disableTokenHeaders&&(r={"x-everphoto-global-session-token":t.token,"x-everphoto-token":t.token})}let i=await this._networkClient.request({method:"GET",url:this._options.url,headers:{...this._headers,...r},withCredentials:this._config.withCredentials,signal:this._cancellationTokenSource.signal}),s=i.data,n=null!==(e=i.headers["content-type"])&&void 0!==e?e:"";this._fireSuccess({key:this._options.key,url:this._options.url,uniqueId:this._options.uniqueId,decryptHash:this._options.decryptHash,buffer:s,contentType:n},y.Gu.Online),this._cacheInDatabase&&this._cache(s,n)}catch(e){if(this._cancellationTokenSource.token.isCancellationRequested)return;this._fireFail((0,h.Mx)(-1,"download error.",e))}}async _fetchByBlobUrl(){try{var e;let t=await fetch(this._options.url),r=await t.arrayBuffer(),i=null!==(e=t.headers.get("content-type"))&&void 0!==e?e:"";this._fireSuccess({key:this._options.key,url:this._options.url,uniqueId:this._options.uniqueId,decryptHash:this._options.decryptHash,buffer:r,contentType:i},y.Gu.Memory)}catch(e){this._fireFail((0,h.Mx)(p.pY.Interrupted,"download error.",e))}}_fireSuccess(e,t){if(!this._cancellationTokenSource.token.isCancellationRequested)(0,a.Y2)(this._status===y.lh.Loading),this._status=y.lh.Completed,this._value=e,this._sourceFrom=t,this._onSuccess.fire()}_fireFail(e){if(this._status!==y.lh.Error)this._status=y.lh.Error,this._error=e,this._onFail.fire(this._error)}async _cache(e,t){(await this._cacheDetail(e)).ok&&this._cacheMeta(t)}async _cacheMeta(e){let t=await this._storageService.database.connect(f.g.id,v.d.name);if(!t.ok)return t;let r=t.value,i={key:this._options.key,contentType:e,uniqueId:this._options.uniqueId,decryptHash:this._options.decryptHash};return r.set(this._options.key,i,{durability:"relaxed"})}async _cacheDetail(e){var t,r;let i=await this._storageService.database.connect(f.g.id,v.z.name);if(!i.ok)return i;let s=i.value;let n=(t=this._options.uniqueId,r=this._options.decryptHash,`${t}_${r}`);return s.set(n,{uniqueIdWithDecryptHash:n,buffer:e},{durability:"relaxed"})}constructor(e,t,r,i,s,n){this._config=e,this._options=t,this._networkClient=r,this._downloadService=i,this._storageService=s,this._evercloudTokenDataService=n,this._status=y.lh.Waiting,this._onSuccess=new _.Q,this._onFail=new _.Q,this._cancellationTokenSource=new g.A}}T=(0,i.gn)([(0,i.fM)(4,w.U),(0,i.fM)(5,m.o),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IDownloadConfig?Object:IDownloadConfig,"undefined"==typeof IDownloadOptions?Object:IDownloadOptions,"undefined"==typeof NetworkClientInstance?Object:NetworkClientInstance,"undefined"==typeof ResourceDownloadService?Object:ResourceDownloadService,void 0===w.U?Object:w.U,void 0===m.o?Object:m.o])],T);var R=r("786701"),b=r("6002");let S=1/0;function C(e){return JSON.stringify(e)}class I{warmup(){this._instantiationService.invokeFunction(e=>{let t=e.get(w.U);t.database.connect(f.g.id,v.d.name),t.database.connect(f.g.id,v.z.name)})}download(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[r,i]=this._getOrCreateTask(e,t);return i?r:(this._recordTask(r),r)}remove(e){e.downloadType===y._5.Eager?this._immediatelyQueue.removeTask(e):this._idleQueue.removeTask(e)}startImmediately(e){if(!(e.status>=y.lh.Loading)&&e.downloadType!==y._5.Eager)this._idleQueue.removeTask(e),e.downloadType=y._5.Eager,this._immediatelyQueue.addTask(e)}_recordTask(e){e.onFail(()=>{this._tasks.delete(e)}),e.onSuccess(()=>{this._tasks.delete(e),this._taskCache.put(C(e),e)}),this._tasks.add(e),e.downloadType===y._5.Eager?this._immediatelyQueue.addTask(e):this._idleQueue.addTask(e)}_getOrCreateTask(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this._instantiationService.createInstance(new n.M(T,[t,e,this._networkClient,this])),i=this._taskCache.get(C(r));if(i)return(0,a.Y2)(i.status!==y.lh.Error),[i,!0];for(let e of this._tasks)if((0,a.Y2)(e.status!==y.lh.Completed&&e.status!==y.lh.Error),e.equal(r))return[e,!0];return[r,!1]}constructor(e){this._instantiationService=e,this._tasks=new Set,this._taskCache=new s.o(100,3e5),this._networkClient=function(){let e=(0,c.e)({responseType:"arraybuffer"});return(0,u.V)(e,{retries:2}),e}(),this._idleQueue=this._instantiationService.createInstance(new n.M(R.J,[])),this._immediatelyQueue=this._instantiationService.createInstance(new n.M(b.H,[S]))}}I=(0,i.gn)([(0,i.fM)(0,o.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.T?Object:o.T])],I)},168550:function(e,t,r){r.d(t,{Gu:function(){return u},_5:function(){return c},lh:function(){return a},tx:function(){return l}});var i,s,n,o=r(335290);var a=((i={})[i.Waiting=0]="Waiting",i[i.Loading=1]="Loading",i[i.Completed=2]="Completed",i[i.Error=3]="Error",i);var c=((s={})[s.Eager=0]="Eager",s[s.Idle=1]="Idle",s);var u=((n={})[n.Memory=0]="Memory",n[n.Cache=1]="Cache",n[n.Online=2]="Online",n);let l=(0,o.yh)("resource-download")},15130:function(e,t,r){r.d(t,{x:()=>p});var i=r("789786"),s=r("507255"),n=r("168550"),o=r("800788"),a=r("315201"),c=r("481710"),u=r("744268"),l=r("572029");class d extends c.${getCover(e){return e.coverUrl}getContentUrl(e){return e.itemUrl}get contentFileFilter(){return e=>e.endsWith(".json")}_getDownloadConfig(e){return{withCredentials:!0}}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value));let[e,t]=(await this._brandDataService.getBrandAdjustmentPresetsByIds({ids:[this.value.id]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._configurationService=i,this._brandDataService=s}}d=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,u.Ui),(0,i.fM)(4,l.X),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAdjustmentPresetMeta?Object:IAdjustmentPresetMeta,void 0===n.tx?Object:n.tx,void 0===u.Ui?Object:u.Ui,void 0===l.X?Object:l.X])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},280478:function(e,t,r){r.d(t,{g:function(){return l}});var i=r(789786),s=r(168550),n=r(800788),o=r(315201),a=r(198104),c=r(744268),u=r(464954);class l extends u.m{getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,n.Y2)(!(0,o.R)(this.value));let[e,t]=(await this._aiAvatarMaskDataService.batchGetAiAvatarMaskByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._aiAvatarMaskDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.fM)(3,a.n),(0,i.fM)(4,c.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAiAvatarMaskMeta?Object:IAiAvatarMaskMeta,void 0===s.tx?Object:s.tx,void 0===a.n?Object:a.n,void 0===c.Ui?Object:c.Ui])],l)},345514:function(e,t,r){r.d(t,{K:()=>_});var i=r("789786"),s=r("507255"),n=r("168550"),o=r("800788"),a=r("420072"),c=r("277754");class u extends a.i{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){let t=this._getContentResourceKey(),r=this.getContentUrl(e);return(0,c.MZ)({key:t,url:r,md5:e.md5},this._downloadService)}_getContentResourceKey(){return`${this.key}_content`}getContentUrl(e){return e.package.urlList[0]}doFetch(){(0,o.ss)("not support do fetch single model")}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}u=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IArithmeticModelMeta?Object:IArithmeticModelMeta,void 0===n.tx?Object:n.tx])],u);var l=r("861810"),d=r("55449");class _ extends s.e{createResource(e,t){return this._instantiationService.createInstance(new l.M(u,[e,t]))}constructor(e){super(e),this._instantiationService=e}}_=(0,i.gn)([(0,i.fM)(0,d.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.T?Object:d.T])],_)},628178:function(e,t,r){r.d(t,{k:function(){return l}});var i=r(789786),s=r(390129),n=r(168550),o=r(800788),a=r(315201),c=r(481710),u=r(744268);class l extends c.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)((0,a.R)(this.value));let[e,t]=(await this._audioVoiceDataService.batchGetAudioVoicesByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._audioVoiceDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,s.m),(0,i.fM)(4,u.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAudioVoiceMeta?Object:IAudioVoiceMeta,void 0===n.tx?Object:n.tx,void 0===s.m?Object:s.m,void 0===u.Ui?Object:u.Ui])],l)},354078:function(e,t,r){r.d(t,{v:function(){return c}});var i=r(789786),s=r(507255),n=r(851894),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.z,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},257856:function(e,t,r){r.d(t,{_:function(){return c}});var i=r(789786),s=r(507255),n=r(970575),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.p,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},272421:function(e,t,r){r.d(t,{R:function(){return a}});var i=r(789786),s=r(168550),n=r(261939),o=r(277754);class a extends n.B{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){let t=this._getContentResourceKey(),r=this.getContentUrl(e);return(0,o.tT)({key:t,url:r},this._downloadService,this.contentFileFilter)}_getContentResourceKey(){return`${this.key}_content`}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}a=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===s.tx?Object:s.tx])],a)},479945:function(e,t,r){r.d(t,{k:function(){return c}});var i=r(789786),s=r(168550),n=r(420072),o=r(277754),a=r(249656);class c extends n.i{getCoverResourceToken(){return this._getResourceTokenSync(this._createCoverToken.bind(this),()=>this._coverResourceToken,e=>this._coverResourceToken=e)}_createCoverToken(e){let t=this._getCoverResourceKey(),{url:r,decryptKey:i,shouldAutoDecrypt:s}=this.getCover(e);return(0,o.MZ)({key:t,url:r,decryptKey:i,shouldAutoDecrypt:s,encryptType:a.PS.AES_CBC},this._downloadService)}_getCoverResourceKey(){return`${this.key}_cover`}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}c=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===s.tx?Object:s.tx])],c)},660170:function(e,t,r){r.d(t,{Z:function(){return a}});var i=r(789786),s=r(168550),n=r(277754),o=r(420072);class a extends o.i{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){let t=this._getFileResourceKey(),r=this.getContentUrl(e);return(0,n.rW)({key:t,url:r},this._downloadService)}_getFileResourceKey(){return`${this.key}_file`}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}a=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===s.tx?Object:s.tx])],a)},464954:function(e,t,r){r.d(t,{m:function(){return a}});var i=r(789786),s=r(168550),n=r(277754),o=r(420072);class a extends o.i{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){let t=this._getContentResourceKey(),r=this.getContentUrl(e);return(0,n.Dy)({key:t,url:r},this._downloadService)}_getContentResourceKey(){return`${this.key}_content`}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}a=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===s.tx?Object:s.tx])],a)},798184:function(e,t,r){r.d(t,{x:function(){return a},y:function(){return c}});var i=r(587892),s=r(690613),n=r(800788),o=r(312231);function a(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((n,o)=>{if(!!t)r?e.startImmediately(i):e.start(!1,i),e.onReady(e=>{n((0,s.oW)(e))}),e.onError(e=>{o(e)})})}class c{onError(e){if(this.status===o.G.complete)return{dispose:()=>{}};if(this.status!==o.G.error)return this._errorEmitter.event(e);let t=!1;return setTimeout(()=>{if(!t){if(this.status!==o.G.error)return this._errorEmitter.event(e);(0,n.Y2)(this.error),e(this.error)}}),{dispose:()=>{t=!0}}}onReady(e){if(this.status!==o.G.complete)return this._readyEmitter.event(e);let t=!1;return setTimeout(()=>{if(!t)e(this.value)}),{dispose:()=>{t=!0}}}async start(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._isStartByImmediately=!!this._isStartByImmediately||e,-1!==[o.G.init,o.G.error].indexOf(this.status))try{this.status=o.G.fetching,this._isTokenDisposed=!1;let r=await this.loadResource(e,t);if(this.status!==o.G.fetching)return;if(this.status=o.G.complete,this._isTokenDisposed)return;this._readyEmitter.fire(r)}catch(e){if(this.status!==o.G.fetching)return;if(this.status=o.G.error,this.error=e,this._isTokenDisposed)return;this._errorEmitter.fire(e)}}startImmediately(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.start(!0,e)}cancel(){return -1!==[o.G.fetching].indexOf(this.status)&&!this._isStartByImmediately&&(this._isTokenDisposed=!0,this.status=o.G.init,!0)}constructor(){this._isTokenDisposed=!1,this._isStartByImmediately=!1,this.status=o.G.init,this._errorEmitter=new i.Q,this._readyEmitter=new i.Q}}},420072:function(e,t,r){r.d(t,{Z:function(){return l},i:function(){return d}});var i=r(107486),s=r(475590),n=r(587892),o=r(690613),a=r(800788),c=r(315201),u=r(420400);function l(e){return new Promise((t,r)=>{e.status===i.n.error&&e.restart(),e.onReady(e=>{t((0,o.oW)(e))}),e.onError(e=>{r(e)})})}class d{get resourceType(){return this.value.type}onResourceCreated(){(0,c.R)(this.value)?this._doResourceReady(this.value):this._tryCompleteResource()}onReady(e){if(this.status!==i.n.complete)return this._resourceReadyEmitter.event(e);let t=!1;return setTimeout(()=>{if(!t)(0,a.Y2)((0,c.R)(this.value)),e(this.value)}),{dispose:()=>{t=!0}}}onError(e){if(this.status===i.n.complete)return{dispose:()=>{}};if(this.status!==i.n.error)return this._resourceErrorEmitter.event(e);let t=!1;return setTimeout(()=>{if(!t){if(this.status!==i.n.error)return this._resourceErrorEmitter.event(e);(0,a.Y2)(this.error),e(this.error)}}),{dispose:()=>{t=!0}}}restart(){(0,a.Y2)(this.status===i.n.error),this._tryCompleteResource()}async _tryCompleteResource(){let e=await this._fetchResourceDetail();if(!e.ok){this._onHandleResourceError(e.cause);return}this._onHandleResourceReady(e.value)}_doResourceReady(e){this.status=i.n.complete,this._resourceReadyEmitter.fire(e),this._onResourceReadyDefer.resolve(e)}_getResourceTokenSync(e,t,r){let i=t();if(i)return i;if((0,c.R)(this.value)){let t=e(this.value);return r(t),t}let s=new u.R(()=>new Promise(t=>{let i=this.onReady(i=>{let s=e(i);r(s),t(s)});this.onError(()=>i.dispose())}));return r(s),s}_getResourceTokenSyncWithCondition(e,t,r,i){let s=t();if(s)return s;let n=new u.R(()=>new Promise(async t=>{let s=e(await i.promise);if(!!s)r(s),t(s)}));return r(n),n}async _getResourceTokenAsync(e,t,r){let i=t();if(i)return i;if((0,c.R)(this.value)){let t=e(this.value);return r(t),t}if(await this._onResourceReadyDefer.promise,i=t())return i;(0,a.Y2)((0,c.R)(this.value));let s=e(this.value);return r(s),s}_onHandleResourceReady(e){this.value=Object.assign(this.value,e),(0,c.K)(this.value),this._doResourceReady(e)}_onHandleResourceError(e){this.status=i.n.error,this.error=e,this._resourceErrorEmitter.fire(e)}async _fetchResourceDetail(){(0,a.Y2)(this.status===i.n.init||this.status===i.n.error);try{this.status=i.n.fetching;let e=await this.doFetch();return(0,a.Y2)(Object.keys(e).length>1,`resource is not full resource. ${e}`),(0,o.oW)(e)}catch(e){return this.status=i.n.error,(0,o.Mx)(-1,"fetch resource detail fail.",e)}}constructor(e,t){this.key=e,this.status=i.n.init,this._resourceReadyEmitter=new n.Q,this._resourceErrorEmitter=new n.Q,this._onResourceReadyDefer=(0,s.PQ)(),this.value=t}}},397522:function(e,t,r){r.d(t,{D:function(){return o}});var i=r(959636),s=r(457382),n=r(800788);class o extends i.w{async doParseArrayBuffer(e){super.doParseArrayBuffer(e);let t=await (0,s.x)(e.buffer,e.contentType);(0,n.Y2)(!(t instanceof ArrayBuffer));let r=Object.keys(t).find(e=>this._contentFileFilter(e));(0,n.Y2)(r),Object.defineProperty(this.value,"content",{get:()=>new TextDecoder("utf-8").decode(t[r].arrayBuffer),enumerable:!0})}constructor(e,t,r){super(e,t),this._contentFileFilter=r}}},747498:function(e,t,r){r.d(t,{Q:function(){return o}});var i=r(959636),s=r(457382),n=r(800788);class o extends i.w{async doParseArrayBuffer(e){return await super.doParseArrayBuffer(e),Promise.resolve()}constructor(e,t,r){super(e,t,r),Object.defineProperty(this.value,"files",{value:async()=>{(0,n.Y2)(this.value.buffer,"should call files after buffer ready.");try{let e=await (0,s.x)(this.value.buffer,this.value.contentType);return(0,n.Y2)(!(e instanceof ArrayBuffer)),e}catch(t){await this._loadResourceWithoutCache(!0);let e=await (0,s.x)(this.value.buffer,this.value.contentType);return(0,n.Y2)(!(e instanceof ArrayBuffer)),e}},enumerable:!0})}}},959636:function(e,t,r){r.d(t,{w:function(){return h}});var i=r(690613),s=r(46037),n=r(800788),o=r(798184),a=r(107486),c=r(877033),u=r(906236),l=r(249656),d=r(168550),_=r(241366);class h extends o.y{async startImmediately(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];await this.start(!0,e)}cancel(){var e;return!!super.cancel()&&(null===(e=this._downloadTask)||void 0===e||e.cancel(),this._downloadTask=void 0,!0)}async loadResource(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return await this._doLoadPersistentResource({downloadType:e?d._5.Eager:d._5.Idle,disableTokenHeaders:t})}catch(r){if((0,i.oi)(r)&&1e3===r.code)return await this._loadResourceWithoutCache(e,t);throw r}}_loadResourceWithoutCache(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._doLoadPersistentResource({downloadType:e?d._5.Eager:d._5.Idle,clearCacheIfExist:!0,databaseFirst:!1,disableTokenHeaders:t})}_makeDownloadTask(e){let t=(0,_.Y)({tokenKey:this._metadata.key,decryptKey:(0,a.d)(this._metadata)?this._metadata.decryptKey:void 0}),r=(0,a.d)(this._metadata)?(0,s.Cv)(this._metadata.decryptKey).toString():"";return this._downloadService.download({key:t,url:this._metadata.url,decryptHash:r,uniqueId:this._metadata.md5||t},{...this.config,...e})}_doLoadPersistentResource(e){return new Promise((t,r)=>{let s=this._makeDownloadTask(e);this._downloadTask=s,s.onSuccess(async()=>{(0,n.ZB)(s.value);try{await this.doParseArrayBuffer(s.value),t(this.value)}catch(e){r((0,i.Mx)(1e3,"parse arraybuffer error",e))}}),s.onFail(e=>{r(e)})})}async doParseArrayBuffer(e){let{buffer:t}=e;t=await this.decryptResourceIfNeeded(t),this.value.buffer=t,this.value.contentType=e.contentType}async decryptResourceIfNeeded(e){if((0,a.d)(this._metadata)&&this._metadata.shouldAutoDecrypt){if(this._metadata.encryptType===l.PS.AES_CBC)return await (0,c.Z)(e,this._metadata.decryptKey);if(this._metadata.encryptType===l.PS.AES_GCM)return await (0,u.y)(e,this._metadata.decryptKey)}return e}constructor(e,t,r){super(),this._metadata=e,this._downloadService=t,this.config=r,this.value={...this._metadata}}}},777512:function(e,t,r){r.d(t,{c:function(){return c}});var i=r(789786),s=r(507255),n=r(655650),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},602131:function(e,t,r){r.d(t,{d:function(){return l}});var i=r(789786),s=r(342317),n=r(168550),o=r(800788),a=r(315201),c=r(481710),u=r(744268);class l extends c.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value));let[e,t]=(await this._curveHslDataService.batchGetCurveHslsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._curveHslDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,s.s),(0,i.fM)(4,u.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ICurveHslMeta?Object:ICurveHslMeta,void 0===n.tx?Object:n.tx,void 0===s.s?Object:s.s,void 0===u.Ui?Object:u.Ui])],l)},549447:function(e,t,r){r.d(t,{R:()=>p});var i=r("789786"),s=r("507255"),n=r("168550"),o=r("800788"),a=r("315201"),c=r("176151"),u=r("272421"),l=r("744268");class d extends u.R{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value));let[e,t]=(await this._curvePresetDataService.batchGetCurvePresetsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._curvePresetDataService=i,this._configurationService=s}}d=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,c.s),(0,i.fM)(4,l.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ICurvePresetMeta?Object:ICurvePresetMeta,void 0===n.tx?Object:n.tx,void 0===c.s?Object:c.s,void 0===l.Ui?Object:l.Ui])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},779843:function(e,t,r){r.d(t,{l:()=>p});var i=r("789786"),s=r("507255"),n=r("168550"),o=r("800788"),a=r("315201"),c=r("698533"),u=r("272421"),l=r("744268");class d extends u.R{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value));let[e,t]=(await this._curveSpeedDataService.batchGetCurveSpeedsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._curveSpeedDataService=i,this._configurationService=s}}d=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,c.r),(0,i.fM)(4,l.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ICurveSpeedMeta?Object:ICurveSpeedMeta,void 0===n.tx?Object:n.tx,void 0===c.r?Object:c.r,void 0===l.Ui?Object:l.Ui])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},991907:function(e,t,r){r.d(t,{g:()=>p});var i=r("789786"),s=r("507255"),n=r("861810"),o=r("55449"),a=r("168550"),c=r("481710"),u=r("744268"),l=r("430687"),d=r("537745"),_=r("277754");class h extends c.${getCover(e){return e.coverUrl}_getDigitalResourceKey(){return`${this.key}_video`}_createDigitalResourceToken(e){let{originUrl:t}=e,r=this._getDigitalResourceKey();return(0,_.MZ)({key:r,url:t,md5:e.md5},this._downloadService)}getDigitalResourceToken(){return this._getResourceTokenSync(this._createDigitalResourceToken.bind(this),()=>this._digitalResourceToken,e=>this._digitalResourceToken=e)}getContentUrl(e){return e.previewVideo.originUrl}getDigitalHumanResourceToken(){return this._getResourceTokenSync(this._createDigitalHumanResourceToken.bind(this),()=>this._digitalResourceToken,e=>this._digitalResourceToken=e)}_createDigitalHumanResourceToken(e){let{originUrl:t}=e,r=this._getDigitalHumanResourceKey();return(0,_.MZ)({key:r,url:t,md5:e.md5},this._downloadService)}_getDigitalHumanResourceKey(){return`${this.key}_digital_human_${this.value.resourceId}`}getThumbResourceTokens(){return this._getResourceTokenAsync(this._createVideoThumbTokens.bind(this),()=>this._thumbResourceTokens,e=>this._thumbResourceTokens=e)}_createVideoThumbTokens(e){return e.previewVideo.thumb.details.map(t=>{let r=this._getThumbResourceKey(t.url),{singleFrameWidth:i,singleFrameHeight:s}=e.previewVideo.thumb.common,n={frameCount:t.frameCount,singleFrameWidth:i,singleFrameHeight:s,imageWidth:t.imageWidth,imageHeight:t.imageHeight};return(0,_.MZ)({key:r,url:t.url,...n},this._downloadService,this._getDownloadConfig(e))})}_getThumbResourceKey(e){return`${this.key}_thumb_${e}`}async doFetch(){let[e,t]=(await this._digitalHumanDataService.getDigitalHumanByIds({resourceIds:[this.value.resourceId]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s,n){super(e,t,r),this.key=e,this._downloadService=r,this._configurationService=i,this._videoDataService=s,this._digitalHumanDataService=n}}h=(0,i.gn)([(0,i.fM)(2,a.tx),(0,i.fM)(3,u.Ui),(0,i.fM)(4,l.u),(0,i.fM)(5,d.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IDigitalHumanMeta?Object:IDigitalHumanMeta,void 0===a.tx?Object:a.tx,void 0===u.Ui?Object:u.Ui,void 0===l.u?Object:l.u,void 0===d.T?Object:d.T])],h);class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new n.M(h,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,o.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.T?Object:o.T])],p)},906022:function(e,t,r){r.d(t,{h:()=>h});var i=r("789786"),s=r("507255"),n=r("861810"),o=r("55449"),a=r("261939"),c=r("168550"),u=r("315201"),l=r("800788"),d=r("277754");class _ extends a.B{getCover(e){return e.coverUrl}doFetch(){(0,l.ss)("dreamina user ai video should not trigger doFetch ")}getVideoResourceToken(){return this._getResourceTokenSync(this._createDreaminaAiVideoResourceToken.bind(this),()=>this._dreaminaAiVideoResourceToken,e=>this._dreaminaAiVideoResourceToken=e)}_createDreaminaAiVideoResourceToken(e){(0,l.Y2)((0,u.R)(e));let t=e.video.originVideo.videoUrl,{key:r}=e;return this._dreaminaAiVideoResourceToken=(0,d.MZ)({key:r,url:t},this._downloadService),this._dreaminaAiVideoResourceToken}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}_=(0,i.gn)([(0,i.fM)(2,c.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IDreaminaShowcaseVideoMeta?Object:IDreaminaShowcaseVideoMeta,void 0===c.tx?Object:c.tx])],_);class h extends s.e{createResource(e,t){return this._instantiationService.createInstance(new n.M(_,[e,t]))}constructor(e){super(e),this._instantiationService=e}}h=(0,i.gn)([(0,i.fM)(0,o.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.T?Object:o.T])],h)},609366:function(e,t,r){r.d(t,{C:function(){return c}});var i=r(789786),s=r(507255),n=r(998170),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.x,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},342565:function(e,t,r){r.d(t,{C:()=>p});var i=r("789786"),s=r("507255"),n=r("263539"),o=r("168550"),a=r("800788"),c=r("315201"),u=r("481710"),l=r("744268");class d extends u.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>e.endsWith(".json")}async doFetch(){(0,a.Y2)(!(0,c.R)(this.value));let[e,t]=(await this._filterDataService.batchGetFiltersByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._filterDataService=i,this._configurationService=s}}d=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,n.E),(0,i.fM)(4,l.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IFilterMeta?Object:IFilterMeta,void 0===o.tx?Object:o.tx,void 0===n.E?Object:n.E,void 0===l.Ui?Object:l.Ui])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},549611:function(e,t,r){r.d(t,{I:function(){return i}});let i=(0,r(335290).yh)("font-resource-service")},519633:function(e,t,r){r.d(t,{D:function(){return l}});var i=r(789786),s=r(110608),n=r(168550),o=r(800788),a=r(315201),c=r(481710),u=r(744268);class l extends c.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value)),"dreamina"===this.value.sourceFrom&&(0,o.ss)("");let[e,t]=(await this._fontDataService.batchGetFontsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._fontDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,s.H),(0,i.fM)(4,u.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IFontMeta?Object:IFontMeta,void 0===n.tx?Object:n.tx,void 0===s.H?Object:s.H,void 0===u.Ui?Object:u.Ui])],l)},358872:function(e,t,r){r.d(t,{k:()=>_});var i=r("789786"),s=r("507255"),n=r("616315"),o=r("168550"),a=r("277754"),c=r("261939");class u extends c.B{getCover(e){return e.coverUrl}getGifResourceToken(){return this._getResourceTokenSync(this._createGifResourceToken.bind(this),()=>this._gifResourceToken,e=>this._gifResourceToken=e)}_createGifResourceToken(e){let{animatedUrl:t,key:r}=e;return(0,a.MZ)({key:r,url:t},this._downloadService)}async doFetch(){let[e,t]=(await this._gifDataService.getGifsByIds({ids:[this.value.key]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._gifDataService=i}}u=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,n.N),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IGifMeta?Object:IGifMeta,void 0===o.tx?Object:o.tx,void 0===n.N?Object:n.N])],u);var l=r("861810"),d=r("55449");class _ extends s.e{createResource(e,t){return this._instantiationService.createInstance(new l.M(u,[e,t]))}constructor(e){super(e),this._instantiationService=e}}_=(0,i.gn)([(0,i.fM)(0,d.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===d.T?Object:d.T])],_)},782057:function(e,t,r){r.d(t,{i:function(){return c}});var i=r(789786),s=r(507255),n=r(397583),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.M,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},619282:function(e,t,r){r.d(t,{z:function(){return c}});var i=r(789786),s=r(507255),n=r(602923),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.W,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},189404:function(e,t,r){r.d(t,{V:()=>p});var i=r("789786"),s=r("507255"),n=r("168550"),o=r("277754"),a=r("800788"),c=r("315201"),u=r("261939"),l=r("396190");class d extends u.B{getCover(e){return e.url}getContentResourceToken(){return this._getResourceTokenSync(this._createContentResourceToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}getContentResolutionInfo(){return(0,a.Y2)((0,c.R)(this.value)),this._getImageSourceResolutionInfo(this.value)}getResourceTokenByFuzzyMatchWidth(e){let t,r;for(let i of((0,a.Y2)((0,c.R)(this.value)),this.value.transcode))if(i.width>=e){if(r&&i.width>r)continue;r=i.width,t=i}!t&&(t=this.value.transcode[this.value.transcode.length-1]);let i=this._getResolutionResourceKey(String(r));return(0,o.MZ)({key:i,url:t.url,md5:this.value.uri},this._downloadService)}getAllResolutionResourceTokens(){return this._getResourceTokenAsync(this._createAllResolutionResourceTokens.bind(this),()=>{if(0!==Object.keys(this._allResolutionResourceTokens).length)return this._allResolutionResourceTokens},e=>this._allResolutionResourceTokens=e)}_createCoverToken(e){let t=this._getCoverResourceKey(),r=this.getCover(e);return(0,o.MZ)({key:t,url:r},this._downloadService)}_createAllResolutionResourceTokens(e){return(0,a.Y2)(e.transcode),e.transcode.reduce((e,t,r)=>e[t.width]?e:(e[t.width]=this._createUserPhotoResourceTokenByKey(r),e),{})}_createUserPhotoResourceTokenByKey(e){(0,a.Y2)((0,c.R)(this.value)),(0,a.Y2)(this.value.transcode,"transcode should not be undefined!");let t=this.value.transcode[e],{url:r,width:i}=t,s=this._getResolutionResourceKey(String(i));return(0,o.MZ)({key:s,url:r,md5:t.url},this._downloadService)}_createContentResourceToken(e){let{url:t,resolution:r}=this._getImageSourceResolutionInfo(e),i=this._getResolutionResourceKey(r);return(0,o.MZ)({key:i,url:t,md5:e.url},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}_getImageSourceResolutionInfo(e){let t=e.transcode.map(e=>{let{url:t,width:r,height:i}=e;return{url:t,resolution:this._getResolutionKeyByLongSide(r,i)}}).filter(e=>e.resolution);for(let e of this._environmentService.isAutoTest?["720p","1024p","540p","480p","360p","288p"]:["480p","720p","360p","540p","1024p","288p"]){let r=t.find(t=>t.resolution===e);if(r)return r}return{url:e.url,resolution:"origin"}}getImageSourceOrderedResolutionInfo(){return(0,a.Y2)((0,c.R)(this.value)),this.getContentResolutionInfo()}_getResolutionKeyByLongSide(e,t,r){let i=100,s=null;for(let n of null!=r?r:[1024,720,540,480,360,288]){let r;(r=e>t?Math.abs(n-e):Math.abs(n-t))<i&&(i=r,s=n)}if(!!s)return`${s}p`}doFetch(){return(0,a.Y2)((0,c.R)(this.value)),Promise.resolve(this.value)}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._environmentService=i,this._allResolutionResourceTokens={}}}d=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,l.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IImageSourceMeta?Object:IImageSourceMeta,void 0===n.tx?Object:n.tx,void 0===l.Y?Object:l.Y])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},966442:function(e,t,r){r.d(t,{C:()=>g});var i=r("789786"),s=r("507255"),n=r("198104"),o=r("168550"),a=r("800788"),c=r("315201"),u=r("277754"),l=r("464954"),d=r("744268");class _ extends l.m{getLightCoverResourceToken(){return this._getResourceTokenSync(this._createLightCoverToken.bind(this),()=>this._lightCoverResourceToken,e=>this._lightCoverResourceToken=e)}getDarkCoverResourceToken(){return this._getResourceTokenSync(this._createDarkCoverToken.bind(this),()=>this._darkCoverResourceToken,e=>this._darkCoverResourceToken=e)}_createDarkCoverToken(e){let t=this._getDarkCoverResourceKey(),r=e.themeIcon.dark.urlList[0];return(0,u.MZ)({key:t,url:r,md5:e.md5},this._downloadService)}_createLightCoverToken(e){let t=this._getLightCoverResourceKey(),r=e.themeIcon.light.urlList[0];return(0,u.MZ)({key:t,url:r,md5:e.md5},this._downloadService)}_getCoverResourceKey(){return`${this.key}_cover`}_getLightCoverResourceKey(){return`${this._getCoverResourceKey()}_light`}_getDarkCoverResourceKey(){return`${this._getCoverResourceKey()}_dark`}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,a.Y2)(!(0,c.R)(this.value));let[e,t]=(await this._maskDataService.batchGetMasksByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._maskDataService=i,this._configurationService=s}}_=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,n.n),(0,i.fM)(4,d.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IMaskMeta?Object:IMaskMeta,void 0===o.tx?Object:o.tx,void 0===n.n?Object:n.n,void 0===d.Ui?Object:d.Ui])],_);var h=r("861810"),p=r("55449");class g extends s.e{createResource(e,t){return this._instantiationService.createInstance(new h.M(_,[e,t]))}constructor(e){super(e),this._instantiationService=e}}g=(0,i.gn)([(0,i.fM)(0,p.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.T?Object:p.T])],g)},555938:function(e,t,r){r.d(t,{U:()=>p});var i=r("789786"),s=r("507255"),n=r("164479"),o=r("168550"),a=r("800788"),c=r("315201"),u=r("481710"),l=r("744268");class d extends u.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,a.Y2)(!(0,c.R)(this.value));let[e,t]=(await this._mattingStrokeDataService.batchGetMattingStrokesByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._mattingStrokeDataService=i,this._configurationService=s}}d=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,n.H),(0,i.fM)(4,l.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IMattingStrokeMeta?Object:IMattingStrokeMeta,void 0===o.tx?Object:o.tx,void 0===n.H?Object:n.H,void 0===l.Ui?Object:l.Ui])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},881961:function(e,t,r){r.d(t,{k:function(){return l}});var i=r(789786),s=r(287462),n=r(168550),o=r(800788),a=r(315201),c=r(481710),u=r(744268);class l extends c.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileMix(){return e=>e.endsWith(".json")}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value));let[e,t]=(await this._mixDataService.batchGetMixsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._mixDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,s.m),(0,i.fM)(4,u.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IMixMeta?Object:IMixMeta,void 0===n.tx?Object:n.tx,void 0===s.m?Object:s.m,void 0===u.Ui?Object:u.Ui])],l)},312231:function(e,t,r){r.d(t,{G:function(){return s}});var i,s=((i={}).init="init",i.fetching="fetching",i.complete="complete",i.error="error",i)},110146:function(e,t,r){r.d(t,{q:()=>p});var i=r("789786"),s=r("507255"),n=r("168550"),o=r("800788"),a=r("315201"),c=r("457775"),u=r("744268"),l=r("464954");class d extends l.m{getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value));let[e,t]=(await this._objectLockDataService.batchGetObjectLocksByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._objectLockDataService=i,this._configurationService=s}}d=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,c.i),(0,i.fM)(4,u.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IObjectLockMeta?Object:IObjectLockMeta,void 0===n.tx?Object:n.tx,void 0===c.i?Object:c.i,void 0===u.Ui?Object:u.Ui])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},771708:function(e,t,r){r.d(t,{q:()=>_});var i=r("789786");let s=(0,r("335290").yh)("photo-dreamina-data-service");var n=r("168550"),o=r("277754"),a=r("800788"),c=r("315201"),u=r("261939"),l=r("396190");let d=["1024p","720p","540p","480p","360p","288p"];class _ extends u.B{getCover(e){return e.coverUrl}getContentResourceToken(){return this._getResourceTokenSync(this._createContentResourceToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}getContentResolutionInfo(){return(0,a.Y2)((0,c.R)(this.value)),this._getPhotoDreaminaResolutionInfo(this.value)}getResourceTokenByFuzzyMatchWidth(e){let t,r;for(let i of((0,a.Y2)((0,c.R)(this.value)),this.value.transcode)){let s=Math.max(i.width,i.height);if(s>=e){if(r&&s>r)continue;r=s,t=i}}!t&&(t=this.value.transcode[this.value.transcode.length-1]);let i=this._getResolutionResourceKey(String(r));return(0,o.MZ)({key:i,url:t.url,md5:this.value.md5},this._downloadService)}_createCoverToken(e){let t=this._getCoverResourceKey(),r=this.getCover(e);return(0,o.MZ)({key:t,url:r},this._downloadService)}_createContentResourceToken(e){let{url:t,resolution:r}=this._getPhotoDreaminaResolutionInfo(e),i=this._getResolutionResourceKey(r);return(0,o.MZ)({key:i,url:t,md5:e.md5},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}_getPhotoDreaminaResolutionInfo(e){let t=e.transcode.map(t=>{let{url:r,width:i,height:s}=t;return{url:r,resolution:this._getResolutionKeyByLongSide(i,s,e.resolutionKeys)}}).filter(e=>e.resolution),r=e.resolutionKeys?e.resolutionKeys.map(e=>`${e}p`):["480p","720p","360p","540p","1024p","288p"],i=this._environmentService.isAutoTest?["720p","1024p","540p","480p","360p","288p"]:r;for(let e of(this._environmentService.forceHighQuality&&(i=d),i)){let r=t.find(t=>t.resolution===e);if(r)return r}return{url:e.coverUrl,resolution:"origin"}}getPhotoDreaminaOrderedResolutionInfo(){return(0,a.Y2)((0,c.R)(this.value)),this.getContentResolutionInfo()}_getResolutionKeyByLongSide(e,t,r){let i=100,s=null;for(let n of null!=r?r:[1024,720,540,480,360,288]){let r;(r=e>t?Math.abs(n-e):Math.abs(n-t))<i&&(i=r,s=n)}if(!!s)return`${s}p`}async doFetch(){(0,a.Y2)(!(0,c.R)(this.value));let[e,t]=(await this._photoDataService.batchGetPhotos({resourceIds:[this.value.resourceId]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._photoDataService=i,this._environmentService=s}}_=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,s),(0,i.fM)(4,l.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IPhotoDreaminaMeta?Object:IPhotoDreaminaMeta,void 0===n.tx?Object:n.tx,void 0===s?Object:s,void 0===l.Y?Object:l.Y])],_)},35216:function(e,t,r){r.d(t,{y:function(){return c}});var i=r(789786),s=r(507255),n=r(63726),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.T,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},433140:function(e,t,r){r.d(t,{c:function(){return i}});let i=(0,r(335290).yh)("resource-service")},759544:function(e,t,r){r.d(t,{P:()=>p});var i=r("789786"),s=r("507255"),n=r("784958"),o=r("168550"),a=r("800788"),c=r("315201"),u=r("481710"),l=r("744268");class d extends u.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileShapeAnimation(){return e=>e.endsWith(".json")}async doFetch(){(0,a.Y2)(!(0,c.R)(this.value));let[e,t]=(await this._shapeAnimationDataService.batchGetShapeAnimationsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._shapeAnimationDataService=i,this._configurationService=s}}d=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,n.W),(0,i.fM)(4,l.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IShapeAnimationMeta?Object:IShapeAnimationMeta,void 0===o.tx?Object:o.tx,void 0===n.W?Object:n.W,void 0===l.Ui?Object:l.Ui])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},968944:function(e,t,r){r.d(t,{p:function(){return l}});var i=r(789786),s=r(801953),n=r(168550),o=r(800788),a=r(315201),c=r(272421),u=r(744268);class l extends c.R{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>e.endsWith(".svg")}async doFetch(){(0,o.Y2)(!(0,a.R)(this.value));let[e,t]=(await this._shapeDataService.batchGetShapesByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._shapeDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,s.K),(0,i.fM)(4,u.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IShapeMeta?Object:IShapeMeta,void 0===n.tx?Object:n.tx,void 0===s.K?Object:s.K,void 0===u.Ui?Object:u.Ui])],l)},421598:function(e,t,r){r.d(t,{D:function(){return l}});var i=r(789786),s=r(168550),n=r(800788),o=r(315201),a=r(405650),c=r(744268),u=r(464954);class l extends u.m{getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,n.Y2)(!(0,o.R)(this.value));let[e,t]=(await this._smartColorAdjustDataService.batchGetSmartColorAdjustsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._smartColorAdjustDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.fM)(3,a.e),(0,i.fM)(4,c.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ISmartColorAdjustMeta?Object:ISmartColorAdjustMeta,void 0===s.tx?Object:s.tx,void 0===a.e?Object:a.e,void 0===c.Ui?Object:c.Ui])],l)},966139:function(e,t,r){r.d(t,{B:function(){return i}});let i=(0,r(335290).yh)("sticker-resource-service")},498768:function(e,t,r){r.d(t,{U:function(){return l}});var i=r(789786),s=r(168550),n=r(800788),o=r(315201),a=r(481710),c=r(892292),u=r(744268);class l extends a.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}async doFetch(){(0,n.Y2)(!(0,o.R)(this.value));let[e,t]=(await this._stickerDataService.batchGetStickersByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._stickerDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.fM)(3,c.c),(0,i.fM)(4,u.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IStickerMeta?Object:IStickerMeta,void 0===s.tx?Object:s.tx,void 0===c.c?Object:c.c,void 0===u.Ui?Object:u.Ui])],l)},189294:function(e,t,r){r.d(t,{c:()=>b});var i=r("789786"),s=r("507255"),n=r("611654"),o=r("127830"),a=r("168550"),c=r("800788"),u=r("315201"),l=r("481710"),d=r("186872"),_=r("694471"),h=r("822796"),p=r("549611"),g=r("966139"),y=r("850592"),f=r("583039"),v=r("318303"),m=r("744268"),w=r("320271");class k extends l.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,c.Y2)(!(0,u.R)(this.value));let[e,t]=(await this._subtitleTemplateDataService.getSubtitleTemplateByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}_getResourceKey(e){return`${e.type}_${e.key}`}_doResourceReady(e){super._doResourceReady(e),this.parseAndInitChildResources()}parseAndInitChildResources(){for(let e of this.dependencyResources)switch(e.type){case o._g.Font:this._fontResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case o._g.TextMotion:this._textMotionResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case o._g.StickerMotion:this._stickerMotionResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case o._g.Sticker:this._stickerResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case o._g.TextPreset:this._textPresetResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case o._g.ShapeAnimation:this._shapeAnimationResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case o._g.SystemFonts:break;default:(0,c.ss)("unsupported child resource type in text template resource!")}}getBuiltinContentTokens(){return this.dependencyResources.map(e=>{switch(e.type){case o._g.Font:let t=this._fontResourceService.get(this._getResourceKey(e));return(0,c.Y2)(t),t.getContentResourceToken();case o._g.TextMotion:let r=this._textMotionResourceService.get(this._getResourceKey(e));return(0,c.Y2)(r),r.getContentResourceToken();case o._g.StickerMotion:let i=this._stickerMotionResourceService.get(this._getResourceKey(e));return(0,c.Y2)(i),i.getContentResourceToken();case o._g.Sticker:let s=this._stickerResourceService.get(this._getResourceKey(e));return(0,c.Y2)(s),s.getContentResourceToken();case o._g.TextPreset:let n=this._textPresetResourceService.get(this._getResourceKey(e));return(0,c.Y2)(n),n.getContentResourceToken();case o._g.ShapeAnimation:let a=this._shapeAnimationResourceService.get(this._getResourceKey(e));return(0,c.Y2)(a),a.getContentResourceToken();case o._g.SystemFonts:return;default:(0,c.ss)("unsupported child resource type in text template resource!")}}).filter(e=>void 0!==e)}get dependencyResources(){var e;return(0,c.Y2)((0,u.R)(this.value),"resource is not ready yet! please call this function after resource ready."),(null!==(e=this.value.dependentResources)&&void 0!==e?e:[]).filter(e=>e.type!==o._g.SystemFonts).map(e=>((0,c.Y2)(e.resourceId,"dependency resource should have a resource id"),{type:(0,v.e)(w.hR[e.type]||e.type,this._configurationService.resourcePanel),source:e.source,key:e.resourceId}))}constructor(e,t,r,i,s,n,o,a,c,u,l,d){super(e,t,u),this.key=e,this._fontResourceService=r,this._stickerResourceService=i,this._textPresetResourceService=s,this._textMotionResourceService=n,this._videoMotionResourceService=o,this._stickerMotionResourceService=a,this._shapeAnimationResourceService=c,this._downloadService=u,this._subtitleTemplateDataService=l,this._configurationService=d}}k=(0,i.gn)([(0,i.fM)(9,a.tx),(0,i.fM)(10,n.B),(0,i.fM)(11,m.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ISubtitleTemplateMeta?Object:ISubtitleTemplateMeta,void 0===p.I?Object:p.I,void 0===g.B?Object:g.B,void 0===y.V?Object:y.V,void 0===d.n?Object:d.n,void 0===_.B?Object:_.B,void 0===h.p?Object:h.p,void 0===f.X?Object:f.X,void 0===a.tx?Object:a.tx,void 0===n.B?Object:n.B,void 0===m.Ui?Object:m.Ui])],k);var T=r("861810"),R=r("55449");class b extends s.e{createResource(e,t){return this._instantiationService.createInstance(new T.M(k,[e,t,this._fontResourceService,this._stickerResourceService,this._textPresetResourceService,this._textMotionResourceService,this._videoMotionResourceService,this._stickerMotionResourceService,this._shapeAnimationResourceService]))}constructor(e,t,r,i,s,n,o,a){super(a),this._fontResourceService=e,this._stickerResourceService=t,this._textPresetResourceService=r,this._textMotionResourceService=i,this._videoMotionResourceService=s,this._stickerMotionResourceService=n,this._shapeAnimationResourceService=o,this._instantiationService=a}}b=(0,i.gn)([(0,i.fM)(7,R.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===p.I?Object:p.I,void 0===g.B?Object:g.B,void 0===y.V?Object:y.V,void 0===d.n?Object:d.n,void 0===_.B?Object:_.B,void 0===h.p?Object:h.p,"undefined"==typeof IShapeAnimationResourceService?Object:IShapeAnimationResourceService,void 0===R.T?Object:R.T])],b)},525393:function(e,t,r){r.d(t,{e:()=>y});var i=r("789786"),s=r("507255"),n=r("168550"),o=r("277754"),a=r("800788"),c=r("315201"),u=r("261939"),l=r("396190"),d=r("127830");let _=(0,r("335290").yh)("dreamina-canvas-template-service");class h extends u.B{getCover(e){return e.url}getContentResourceToken(){return this._getResourceTokenSync(this._createContentResourceToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}getContentResolutionInfo(){return(0,a.Y2)((0,c.R)(this.value)),this._getImageSourceResolutionInfo(this.value)}getResourceTokenByFuzzyMatchWidth(e){let t,r;for(let i of((0,a.Y2)((0,c.R)(this.value)),this.value.transcode)){let s=Math.max(i.width,i.height);if(s>=e){if(r&&s>r)continue;r=s,t=i}}!t&&(t=this.value.transcode[this.value.transcode.length-1]);let i=this._getResolutionResourceKey(String(r));return(0,o.MZ)({key:i,url:t.url},this._downloadService)}getAllResolutionResourceTokens(){return this._getResourceTokenAsync(this._createAllResolutionResourceTokens.bind(this),()=>{if(0!==Object.keys(this._allResolutionResourceTokens).length)return this._allResolutionResourceTokens},e=>this._allResolutionResourceTokens=e)}_createCoverToken(e){let t=this._getCoverResourceKey(),r=this.getCover(e);return(0,o.MZ)({key:t,url:r},this._downloadService)}_createAllResolutionResourceTokens(e){return(0,a.Y2)(e.transcode),e.transcode.reduce((e,t,r)=>e[t.width]?e:(e[t.width]=this._createUserPhotoResourceTokenByKey(r),e),{})}_createUserPhotoResourceTokenByKey(e){(0,a.Y2)((0,c.R)(this.value)),(0,a.Y2)(this.value.transcode,"transcode should not be undefined!");let t=this.value.transcode[e],{url:r,width:i}=t,s=this._getResolutionResourceKey(String(i));return(0,o.MZ)({key:s,url:r,md5:t.url},this._downloadService)}_createContentResourceToken(e){let{url:t,resolution:r}=this._getImageSourceResolutionInfo(e),i=this._getResolutionResourceKey(r);return(0,o.MZ)({key:i,url:t,md5:e.url},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}_getImageSourceResolutionInfo(e){let t=e.transcode.map(e=>{let{url:t,width:r,height:i}=e;return{url:t,resolution:this._getResolutionKeyByLongSide(r,i)}}).filter(e=>e.resolution);for(let e of this._environmentService.isAutoTest?["720p","1024p","540p","480p","360p","288p"]:["480p","720p","360p","540p","1024p","288p"]){let r=t.find(t=>t.resolution===e);if(r)return r}return{url:e.url,resolution:"origin"}}getImageSourceOrderedResolutionInfo(){return(0,a.Y2)((0,c.R)(this.value)),this.getContentResolutionInfo()}_getResolutionKeyByLongSide(e,t,r){let i=100,s=null;for(let n of null!=r?r:[1024,720,540,480,360,288]){let r;(r=e>t?Math.abs(n-e):Math.abs(n-t))<i&&(i=r,s=n)}if(!!s)return`${s}p`}async doFetch(){var e,t;(0,a.Y2)(this.value.templateId);let r=await this._templateDataService.getCanvasDetail({itemId:this.value.templateId,packOptions:{packEverPhotoList:[{imageUri:this.value.key}]}});if(!r.ok)throw Error(`doFetch error-${r.code}-${r.msg}`);(0,a.Y2)(null===(e=r.value.everPhotoList)||void 0===e?void 0:e[0]);let i=r.value.everPhotoList[0];return{type:d._g.TemplatePhotoDreamina,key:i.imageUri,uri:i.imageUri,url:i.imageUrl,transcode:null===(t=Object.keys(i.coverUrlMap||{}))||void 0===t?void 0:t.map(e=>{let t=i.coverUrlMap[e];return{width:i.width,height:i.height,url:t,uri:i.imageUri}}),templateId:this.value.templateId,aspectRatio:i.width/i.height}}constructor(e,t,r,i,s){super(e,t,i),this.key=e,this._templateDataService=r,this._downloadService=i,this._environmentService=s,this._allResolutionResourceTokens={}}}h=(0,i.gn)([(0,i.fM)(2,_),(0,i.fM)(3,n.tx),(0,i.fM)(4,l.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITemplatePhotoDreaminaMeta?Object:ITemplatePhotoDreaminaMeta,void 0===_?Object:_,void 0===n.tx?Object:n.tx,void 0===l.Y?Object:l.Y])],h);var p=r("861810"),g=r("55449");class y extends s.e{createResource(e,t){return this._instantiationService.createInstance(new p.M(h,[e,t]))}constructor(e){super(e),this._instantiationService=e}}y=(0,i.gn)([(0,i.fM)(0,g.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===g.T?Object:g.T])],y)},959675:function(e,t,r){r.d(t,{t:()=>p});var i=r("789786"),s=r("507255"),n=r("861810"),o=r("55449"),a=r("168550"),c=r("800788"),u=r("315201"),l=r("967016"),d=r("744268"),_=r("660170");class h extends _.Z{getContentUrl(e){return e.fileUrl}async doFetch(){(0,c.Y2)((0,u.R)(this.value)),(0,c.Y2)(this.value.key,"text art should have an resource id");let[e,t]=(await this._textArtDataService.queryTextArtItems({itemList:[{itemId:this.value.itemId}]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);let r=t.itemConfs[0];return{type:this.value.type,key:this.value.key,resourceId:r.iconFileUri,itemId:this.value.itemId,fileUrl:r.iconFileUrl,fileUri:r.iconFileUri,fontId:r.fontId,model:r.model,prompt:r.prompt}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._textArtDataService=i,this._configurationService=s}}h=(0,i.gn)([(0,i.fM)(2,a.tx),(0,i.fM)(3,l.l),(0,i.fM)(4,d.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextArtIconMeta?Object:ITextArtIconMeta,void 0===a.tx?Object:a.tx,void 0===l.l?Object:l.l,void 0===d.Ui?Object:d.Ui])],h);class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new n.M(h,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,o.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.T?Object:o.T])],p)},339381:function(e,t,r){r.d(t,{t:function(){return l}});var i=r(789786),s=r(168550),n=r(800788),o=r(315201),a=r(967016),c=r(744268),u=r(660170);class l extends u.Z{getContentUrl(e){return e.fileUrl}async doFetch(){(0,n.Y2)((0,o.R)(this.value)),(0,n.Y2)(this.value.key,"text art should have an resource id");let[e,t]=(await this._textArtDataService.queryTextArtItems({itemList:[{itemId:this.value.itemId,uriList:[this.value.fileUri]}]})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);let r="",i="",s=t.itemConfs[0];return(0,n.Y2)(s.uriToUrl,"error uriToUrl"),Object.keys(s.uriToUrl).forEach(e=>{r=e,i=s.uriToUrl[e]}),{type:this.value.type,key:this.value.key,...t,resourceId:r,itemId:this.value.itemId,fileUrl:i,fileUri:r}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._textArtDataService=i,this._configurationService=s}}l=(0,i.gn)([(0,i.fM)(2,s.tx),(0,i.fM)(3,a.l),(0,i.fM)(4,c.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextArtMeta?Object:ITextArtMeta,void 0===s.tx?Object:s.tx,void 0===a.l?Object:a.l,void 0===c.Ui?Object:c.Ui])],l)},195117:function(e,t,r){r.d(t,{z:function(){return c}});var i=r(789786),s=r(507255),n=r(843883),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.G,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},604837:function(e,t,r){r.d(t,{J:function(){return c}});var i=r(789786),s=r(507255),n=r(635761),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.B,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},186872:function(e,t,r){r.d(t,{n:function(){return i}});let i=(0,r(335290).yh)("text-motion-resource-service")},850592:function(e,t,r){r.d(t,{V:function(){return i}});let i=(0,r(335290).yh)("text-preset-resource-service")},359413:function(e,t,r){r.d(t,{U:function(){return p}});var i=r(789786),s=r(507255),n=r(663393),o=r(861810),a=r(55449),c=r(549611),u=r(822796),l=r(966139),d=r(186872),_=r(850592),h=r(694471);class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.u,[e,t,this._fontResourceService,this._stickerResourceService,this._textPresetResourceService,this._textMotionResourceService,this._videoMotionResourceService,this._stickerMotionResourceService,this._shapeAnimationResourceService]))}constructor(e,t,r,i,s,n,o,a){super(a),this._fontResourceService=e,this._stickerResourceService=t,this._textPresetResourceService=r,this._textMotionResourceService=i,this._videoMotionResourceService=s,this._stickerMotionResourceService=n,this._shapeAnimationResourceService=o,this._instantiationService=a}}p=(0,i.gn)([(0,i.fM)(7,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.I?Object:c.I,void 0===l.B?Object:l.B,void 0===_.V?Object:_.V,void 0===d.n?Object:d.n,void 0===h.B?Object:h.B,void 0===u.p?Object:u.p,"undefined"==typeof IShapeAnimationResourceService?Object:IShapeAnimationResourceService,void 0===a.T?Object:a.T])],p)},315201:function(e,t,r){function i(e){if(!e._fullResourceBrand)Object.defineProperty(e,"_fullResourceBrand",{value:()=>!0,enumerable:!1,writable:!1})}function s(e){return void 0!==e._fullResourceBrand||!1}r.d(t,{K:function(){return i},R:function(){return s}})},626516:function(e,t,r){r.d(t,{L:function(){return Y}});var i=r(277714),s=r(273340),n=r(467209),o=r(127830),a=r(801003),c=r(764091),u=r(731992),l=r(228310),d=r(229622),_=r(378351),h=r(756024),p=r(690831),g=r(978874),y=r(495719),f=r(748020),v=r(521687),m=r(1939),w=r(430675),k=r(820590),T=r(174416),R=r(955310),b=r(525944),S=r(73059),C=r(147194),I=r(680978),P=r(575124),E=r(806752),A=r(837477),M=r(428934),x=r(422711),O=r(146761),F=r(857727),D=r(574329),L=r(767528),U=r(788808),B=r(801363),G=r(581797),j=r(998342),V=r(481302),H=r(510879);let N=[{type:o._g.VideoDreamina,typeParser:function(e){return!!(e.video&&(0,a.bO)(e.scheme))||!1},formatter:c.NU},{type:o._g.Video,typeParser:function(e){return!!e.video||!1},formatter:c.Mk},{type:o._g.Audio,typeParser:function(e){return!!e.song||!!e.audio_effect&&(e.song=e.audio_effect,!0)},formatter:i.Fi},{type:o._g.Photo,typeParser:function(e){return!!e.image||!1},formatter:a.Ar},{type:o._g.TextPreset,typeParser:function(e){return!!e.word_art||!1},formatter:l.Q},{type:o._g.Effects,typeParser:function(e){return e.common_attr.effect_type===s.g.SpecialEffect||!1},formatter:d.qi},{type:o._g.FaceProp,typeParser:function(e){return e.common_attr.effect_type===s.g.FaceTool||!1},formatter:d.vf},{type:o._g.Sticker,typeParser:function(e){return!!e.sticker||!1},formatter:_.U},{type:o._g.DigitalHuman,typeParser:function(e){return!!e.digital_human||!1},formatter:n.A},{type:o._g.AiAvatarMask,typeParser:function(e){return e.common_attr.effect_type===s.g.AiAvatarMask||!1},formatter:y.q},{type:o._g.TextTemplate,typeParser:function(e){return!!e.text_template||!1},formatter:p._},{type:o._g.SubtitleTemplate,typeParser:function(e){return!!e.subtitle_template||!1},formatter:g.G},{type:o._g.AutoBeautyBody,typeParser:function(e){return e.common_attr.effect_type===s.g.AutoBeautyBody||!1},formatter:f.r},{type:o._g.AutoBeautyFace,typeParser:function(e){return e.common_attr.effect_type===s.g.AutoBeautyFace||!1},formatter:v.L},{type:o._g.AutoBeautyMakeup,typeParser:function(e){return e.common_attr.effect_type===s.g.AutoBeautyMakeup||!1},formatter:m.T},{type:o._g.AutoBeautyShape,typeParser:function(e){return e.common_attr.effect_type===s.g.AutoBeautyShape||!1},formatter:w.x},{type:o._g.Font,typeParser:function(e){return e.common_attr.effect_type===s.g.Font||!1},formatter:k.n},{type:o._g.VoiceChange,typeParser:function(e){return e.common_attr.effect_type===s.g.VoiceChange||!1},formatter:T.A},{type:o._g.Filter,typeParser:function(e){return e.common_attr.effect_type===s.g.Filter||!1},formatter:R.Q},{type:o._g.VideoBackground,typeParser:function(e){return e.common_attr.effect_type===s.g.VideoBackground||!1},formatter:b.s},{type:o._g.VideoMotion,typeParser:function(e){return e.common_attr.effect_type===s.g.VideoAnimation||!1},formatter:S.F},{type:o._g.TextMotion,typeParser:function(e){return e.common_attr.effect_type===s.g.TextAnimation||!1},formatter:C.Q},{type:o._g.StickerMotion,typeParser:function(e){return e.common_attr.effect_type===s.g.StickerMotion||!1},formatter:I.R},{type:o._g.Transition,typeParser:function(e){return e.common_attr.effect_type===s.g.Transitions||!1},formatter:P.f},{type:o._g.ShapeAnimation,typeParser:function(e){return e.common_attr.effect_type===s.g.ShapeAnimation||!1},formatter:E.o},{type:o._g.PathAnimation,typeParser:function(e){return e.common_attr.effect_type===s.g.PathAnimation||!1},formatter:A.r},{type:o._g.Graffiti,typeParser:function(e){return e.common_attr.effect_type===s.g.Graffiti||!1},formatter:M.b},{type:o._g.MattingStroke,typeParser:function(e){return e.common_attr.effect_type===s.g.MattingStroke||!1},formatter:x.l},{type:o._g.TextGlow,typeParser:function(e){return e.common_attr.effect_type===s.g.TextGlow||!1},formatter:O.b},{type:o._g.CurveHSL,typeParser:function(e){return e.common_attr.effect_type===s.g.CurveHSL||!1},formatter:F.z},{type:o._g.Mask,typeParser:function(e){return e.common_attr.effect_type===s.g.Mask||!1},formatter:D.B},{type:o._g.Emoji,typeParser:function(e){return e.common_attr.effect_type===s.g.Emoji||!1},formatter:L.F},{type:o._g.SmartColorAdjust,typeParser:function(e){return e.common_attr.effect_type===s.g.SmartColorAdjust||!1},formatter:U.a},{type:o._g.Integration,typeParser:function(e){return e.common_attr.effect_type===s.g.Integration||!1},formatter:B.O},{type:o._g.Bubble,typeParser:function(e){return e.common_attr.effect_type===s.g.Bubble||!1},formatter:G.E},{type:o._g.Mix,typeParser:function(e){return e.common_attr.effect_type===s.g.Mix||!1},formatter:j.n},{type:o._g.CurvePreset,typeParser:function(e){return e.common_attr.effect_type===s.g.CurvePreset||!1},formatter:V.a},{type:o._g.CurveSpeed,typeParser:function(e){return e.common_attr.effect_type===s.g.CurveSpeed||!1},formatter:H.t}],q=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){if(e===o._g.Photo)return o._g.PhotoDreamina;if(e===o._g.Video)return o._g.VideoDreamina}return e};function Y(e,t){for(let t of N){let{typeParser:r,formatter:i}=t;if(r(e)){let r=i(e),s=(0,a.bO)(e.scheme),n=q(t.type,s);return(0,u.l)(n,r)}}let r=`resource ${e.common_attr.title}(type: ${e.common_attr.effect_type}) has not support pre parse.`;return t.reportDevError("[resource-service]: heycan-format-error",Error(r),{level:"error",reason:r,describe:r,str:r}),h.t.error(r),null}},867179:function(e,t,r){r.d(t,{$:function(){return V}});var i=r(198715),s=r(482707),n=r(186607),o=r(922465),a=r(527898),c=r(309118),u=r(725104),l=r(623094),d=r(381280),_=r(743612),h=r(549367),p=r(722807),g=r(424022),y=r(179314),f=r(692060),v=r(928790),m=r(858725),w=r(669773),k=r(424736),T=r(750503),R=r(547895),b=r(127830),S=r(920699),C=r(899797),I=r(905449),P=r(177813),E=r(731992),A=r(89927),M=r(937942),x=r(756024),O=r(148163),F=r(806050),D=r(43818),L=r(320271),U=r(48808),B=r(801388);let G=e=>e.Panel,j=[{type:b._g.Font,formatter:C.ey},{type:b._g.Transition,formatter:P.h},{type:b._g.Mask,formatter:I.m},{type:b._g.CurvePreset,formatter:S.z},{type:b._g.CurveSpeed,formatter:i.T},{type:b._g.Sticker,formatter:s.jh},{type:b._g.TextMotion,formatter:n.W},{type:b._g.VideoMotion,formatter:o.N},{type:b._g.VideoBackground,formatter:a.ll},{type:b._g.StickerMotion,formatter:c.y},{type:b._g.AutoBeautyBody,formatter:u.K},{type:b._g.AutoBeautyFace,formatter:l.t},{type:b._g.AutoBeautyShape,formatter:d.c},{type:b._g.AutoBeautyMakeup,formatter:_.W},{type:b._g.Effects,formatter:h.W6},{type:b._g.FaceProp,formatter:h.LP},{type:b._g.Filter,formatter:p.y},{type:b._g.Bubble,formatter:A.o},{type:b._g.Tone,formatter:g.t},{type:b._g.Mix,formatter:y.H},{type:b._g.TextPreset,formatter:f.Ck},{type:b._g.VoiceChange,formatter:v.s},{type:b._g.TextTemplate,formatter:m.K3},{type:b._g.Integration,formatter:w.f},{type:b._g.ShapeAnimation,formatter:k.j},{type:b._g.Graffiti,formatter:T.H},{type:b._g.PathAnimation,formatter:R.f},{type:b._g.AiAvatarMask,formatter:M.q},{type:b._g.Emoji,formatter:O.B},{type:b._g.SmartColorAdjust,formatter:F.V},{type:b._g.TextGlow,formatter:D.B},{type:b._g.CurveHSL,formatter:U.F},{type:b._g.MattingStroke,formatter:B.K}];function V(e,t,r){for(let r of j){var i;let s=(null!==(i=r.typeParser)&&void 0!==i?i:G)(t),n=e[r.type];if((L.Kr[s]||s)===n){let e=r.formatter(t);return(0,E.l)(r.type,e)}}let s=`resource ${t.Name}(panel: ${t.Panel}) has not support pre parse.`;return r.reportDevError("[resource-service]: loki-format-error",Error(s),{level:"error",reason:s,describe:s,str:s}),x.t.error(s),null}},457382:function(e,t,r){r.d(t,{x:function(){return n}});var i=r(417597);let s=["application/zip","application/x-7z-compressed","application/gzip","application/x-tar"];async function n(e,t){if(s.includes(function(e){let t=e.split(";")[0];return t?t.trim():""}(t))){let t={},{entries:r}=await (0,i.Ri)(e);for(let[e,i]of Object.entries(r)){if(i.isDirectory||e.startsWith("__MACOSX")||e.includes(".DS_Store"))continue;let r=await i.arrayBuffer();t[e.replaceAll("//","/")]={isDirectory:i.isDirectory,size:i.size,name:i.name,arrayBuffer:r}}return Promise.resolve(t)}return Promise.resolve(e)}},49713:function(e,t,r){r.d(t,{E:()=>p});var i=r("789786"),s=r("507255"),n=r("484719"),o=r("168550"),a=r("800788"),c=r("315201"),u=r("481710"),l=r("744268");class d extends u.${getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,a.Y2)(!(0,c.R)(this.value));let[e,t]=(await this._transitionDataService.batchGetTransitionsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],source:this.value.source})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._transitionDataService=i,this._configurationService=s}}d=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,n.T),(0,i.fM)(4,l.Ui),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITransitionMeta?Object:ITransitionMeta,void 0===o.tx?Object:o.tx,void 0===n.T?Object:n.T,void 0===l.Ui?Object:l.Ui])],d);var _=r("861810"),h=r("55449");class p extends s.e{createResource(e,t){return this._instantiationService.createInstance(new _.M(d,[e,t]))}constructor(e){super(e),this._instantiationService=e}}p=(0,i.gn)([(0,i.fM)(0,h.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.T?Object:h.T])],p)},463144:function(e,t,r){r.d(t,{I:function(){return p}});var i=r(789786),s=r(173888),n=r(627084),o=r(249656),a=r(168550),c=r(277754),u=r(475590),l=r(800788),d=r(315201),_=r(98498),h=r(420072);class p extends h.i{isSupportFastImport(){return this._onFastImportDefer.promise}getPreviewResourceToken(){return this._getResourceTokenSyncWithCondition(e=>{if(!!e)return this._createPreviewResourceToken()},()=>this._previewResourceToken,e=>this._previewResourceToken=e,this._onFastImportDefer)}getOriginResourceToken(){return this._getResourceTokenSync(this._createOriginResourceToken.bind(this),()=>this._userAudioOriginResourceToken,e=>this._userAudioOriginResourceToken=e)}_createOriginResourceToken(e){(0,l.Y2)((0,_.H)(e));let t=`${this.key}_origin`;return(0,c.MZ)({key:t,url:e.url},this._downloadService)}getUserAudioResourceToken(){return this._getResourceTokenSync(this._createUserAudioResourceToken.bind(this),()=>this._userAudioResourceToken,e=>this._userAudioResourceToken=e)}_createUserAudioResourceToken(e){(0,l.Y2)((0,d.R)(this.value));for(let t of((0,l.Y2)(e.audioTranscodeInfo,"audioTranscodeInfo should not be undefined!"),["128kb"])){let{url:r,key:i}=e.audioTranscodeInfo[t];if(r){let s=this._getResolutionResourceKey(t);return(0,c.MZ)({key:s,url:r,md5:e.md5,decryptKey:i,shouldAutoDecrypt:!1,encryptType:o.PS.AES_CBC},this._downloadService)}}(0,l.ss)("UserAudioResource::_createUserAudioResourceToken no appropriate resolution")}_createPreviewResourceToken(){var e;let t=this.value;(0,l.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.blobUrl);let r=`${this.key}_fast_import`,i=t.uploading.blobUrl;return(0,c.MZ)({key:r,url:i},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}doFetch(){return new Promise(e=>{(0,l.Y2)(!(0,d.R)(this.value)),this.value.onProgress(e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()}),this.value.onReady(t=>{if(Object.assign(this.value,t),!(0,d.R)(this.value))(0,d.K)(this.value),this._checkAndMarkResourceToken(),(0,l.Y2)((0,d.R)(this.value)),e(this.value)})})}_checkAndMarkResourceToken(){var e,t,r;let i=this.value;(null===(e=i.uploading)||void 0===e?void 0:e.isSupportFastImport)&&(null===(t=i.uploading)||void 0===t?void 0:t.file)&&this._onFastImportDefer.resolve(!0),(i.status===s.a.Success||(null===(r=i.uploading)||void 0===r?void 0:r.isSupportFastImport)===!1)&&this._onFastImportDefer.resolve(!1)}constructor(e,t,r,i){super(e,t),this.key=e,this._downloadService=r,this._evercloudTokenDataService=i,this._onFastImportDefer=(0,u.PQ)(),this._checkAndMarkResourceToken()}}p=(0,i.gn)([(0,i.fM)(2,a.tx),(0,i.fM)(3,n.o),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IUserAudioMeta?Object:IUserAudioMeta,void 0===a.tx?Object:a.tx,void 0===n.o?Object:n.o])],p)},921836:function(e,t,r){r.d(t,{C:function(){return _}});var i=r(789786),s=r(426020),n=r(249656),o=r(168550),a=r(800788),c=r(315201),u=r(689315),l=r(660170),d=r(277754);class _ extends l.Z{getFileUniqueId(){return(0,a.Y2)((0,c.R)(this.value),"resource is not ready yet! please ensure resource is ready before call this function."),this.value.sourceType===s.ov.EverCloud?this.value.assetId:this.value.vid}getUserFileResourceToken(){return this._getResourceTokenSync(this._createEncryptedUserFileResourceToken.bind(this),()=>this._userFileEncryptedResourceToken,e=>this._userFileEncryptedResourceToken=e)}_createEncryptedUserFileResourceToken(e){let t=this._getFileResourceKey(),r=this.getContentUrl(e),{decryptKey:i=""}=e;return(0,d.rW)({key:t,url:r,encryptType:n.PS.AES_CBC,shouldAutoDecrypt:!1,decryptKey:i},this._downloadService)}getContentUrl(e){return(0,a.ZB)(e.url,"un expect fullResource url"),e.url}_createContentToken(e){let t=this._getFileResourceKey(),r=this.getContentUrl(e),{decryptKey:i}=e;return i?(0,d.rW)({key:t,url:r,encryptType:n.PS.AES_CBC,shouldAutoDecrypt:!0,decryptKey:i},this._downloadService):(0,d.rW)({key:t,url:r},this._downloadService)}doFetch(){return new Promise(e=>{(0,a.Y2)(!(0,c.R)(this.value)),this.value.onProgress(e=>{Object.assign(this.value,e)}),this.value.onReady(t=>{Object.assign(this.value,t),(0,c.K)(this.value),(0,a.Y2)((0,u.H)(this.value)),e(this.value)})})}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}_=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IUserFileMeta?Object:IUserFileMeta,void 0===o.tx?Object:o.tx])],_)},366845:function(e,t,r){r.d(t,{o:()=>R});var i=r("789786"),s=r("507255"),n=r("173888"),o=r("627084"),a=r("249656"),c=r("107486"),u=r("168550"),l=r("277754"),d=r("475590"),_=r("800788"),h=r("315201"),p=r("335290");let g=["480p","360p","540p","720p","origin"],y=["1080p","720p","540p","480p","360p","origin"],f=h.R;(0,p.yh)("user-photo-resource-service");var v=r("479945"),m=r("396190");class w extends v.k{isSupportFastImport(){return this._onFastImportDefer.promise}getOriginResourceToken(){return this._getResourceTokenSync(this._createOriginResourceToken.bind(this),()=>this._userPhotoOriginResourceToken,e=>this._userPhotoOriginResourceToken=e)}async _waitPreviewResourceUrlReady(){let e=this.value;if(e.uploading&&!e.uploading.blobUrl&&e.uploading.waitBlobUrlReady){var t,r;await (null===(t=(r=e.uploading).waitBlobUrlReady)||void 0===t?void 0:t.call(r))}}async getPreviewResourceToken(){return await this._waitPreviewResourceUrlReady(),this._getResourceTokenSyncWithCondition(e=>{if(!!e)return this._createPreviewResourceToken()},()=>this._userPhotoPreviewResourceToken,e=>this._userPhotoPreviewResourceToken=e,this._onFastImportDefer)}_createOriginResourceToken(e){(0,_.Y2)(f(e));let t=`${this.key}_origin`;return(0,l.MZ)({key:t,url:e.url},this._downloadService)}getCoverResourceToken(){let e=this.value;if(!e.cover){var t,r;null===(r=e.uploading)||void 0===r||null===(t=r.generateCoverTrigger)||void 0===t||t.call(r)}return this._getResourceTokenSyncWithCondition(this._createCoverToken.bind(this),()=>this._coverResourceToken,e=>this._coverResourceToken=e,this._onCoverDefer)}getCover(e){(0,_.Y2)(e.cover);let t=e.cover.key;return{url:e.cover.url,decryptKey:t,shouldAutoDecrypt:!!t,encryptType:a.PS.AES_CBC}}getUserPhotoResourceToken(){return this.getResolutionResourceTokenByQueue(this._environmentService.isAutoTest||this._environmentService.forceHighQuality?y:g)}getResolutionResourceTokenByQueue(e){return this._getResourceTokenSync(t=>{(0,_.Y2)(t.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!");let r=this._getBestResolution(t,e);return this._allResolutionResourceTokens[r]?this._allResolutionResourceTokens[r]:this._createUserPhotoResourceTokenByKey(r)},()=>{if(this.status!==c.n.complete)return;(0,_.Y2)(f(this.value));let t=this._getBestResolution(this.value,e);return this._allResolutionResourceTokens[t]},t=>{(0,_.Y2)(f(this.value));let r=this._getBestResolution(this.value,e);if(!this._allResolutionResourceTokens[r])this._allResolutionResourceTokens[r]=t})}getAllResolutionResourceTokens(){return this._getResourceTokenAsync(this._createAllResolutionResourceTokens.bind(this),()=>{if(0!==Object.keys(this._allResolutionResourceTokens).length)return this._allResolutionResourceTokens},e=>this._allResolutionResourceTokens=e)}getResourceTokenByFuzzyMatchWidth(e){let t;(0,_.Y2)(f(this.value));let r="",i=0,s="";for(let n in this.value.imgTranscodeInfo){let o=this.value.imgTranscodeInfo[n];if(!("width"in o)||!("height"in o))continue;let a=Math.max(o.width,o.height);if(a>i&&(i=a,s=n),a>=e){if(t&&a>t)continue;t=a,r=n}}return(!r&&(r=s),this._allResolutionResourceTokens[r])?this._allResolutionResourceTokens[r]:this._createUserPhotoResourceTokenByKey(r)}_createUserPhotoResourceTokenByKey(e){(0,_.Y2)(f(this.value)),(0,_.Y2)(this.value.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!");let{url:t,key:r,decryptType:i}=this.value.imgTranscodeInfo[e],s=this._getResolutionResourceKey(e);return(0,l.MZ)({key:s,url:t,decryptKey:r,shouldAutoDecrypt:!!r,encryptType:null!=i?i:a.PS.AES_CBC},this._downloadService)}_createAllResolutionResourceTokens(e){return(0,_.Y2)(e.imgTranscodeInfo),Object.keys(e.imgTranscodeInfo).reduce((e,t)=>e[t]?e:(e[t]=this._createUserPhotoResourceTokenByKey(t),e),{})}_createPreviewResourceToken(){var e;let t=this.value;(0,_.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.blobUrl);let r=`${this.key}_fast_import`,i=t.uploading.blobUrl;return(0,l.MZ)({key:r,url:i},this._downloadService)}_createCoverToken(){var e,t;let r=this.value;return(0,_.Y2)(r.cover),(0,l.MZ)({key:this._getCoverResourceKey(),url:r.cover.url,md5:r.md5,decryptKey:null!==(e=r.cover.key)&&void 0!==e?e:"",shouldAutoDecrypt:!!r.cover.key,encryptType:null!==(t=r.cover.decryptType)&&void 0!==t?t:a.PS.AES_CBC},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}doFetch(){return new Promise(e=>{(0,_.Y2)(!f(this.value)),this.value.onProgress(e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()}),this.value.onReady(t=>{if(Object.assign(this.value,t),!f(this.value))(0,h.K)(this.value),this._checkAndMarkResourceToken(),(0,_.Y2)(f(this.value)),e(this.value)})})}_checkAndMarkResourceToken(){var e,t,r;let i=this.value;(null===(e=i.uploading)||void 0===e?void 0:e.isSupportFastImport)&&(null===(t=i.uploading)||void 0===t?void 0:t.file)&&this._onFastImportDefer.resolve(!0),(i.status===n.a.Success||(null===(r=i.uploading)||void 0===r?void 0:r.isSupportFastImport)===!1)&&this._onFastImportDefer.resolve(!1),i.cover&&this._onCoverDefer.resolve()}_getBestResolution(e,t){for(let i of((0,_.Y2)(e.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!"),t)){var r;let{url:t}=null!==(r=e.imgTranscodeInfo[i])&&void 0!==r?r:{};if(t)return i}(0,_.ss)("UserPhotoResource::_getBestResolution no appropriate resolution")}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._evercloudTokenDataService=i,this._environmentService=s,this._onFastImportDefer=(0,d.PQ)(),this._onCoverDefer=(0,d.PQ)(),this._allResolutionResourceTokens={},this._checkAndMarkResourceToken()}}w=(0,i.gn)([(0,i.fM)(2,u.tx),(0,i.fM)(3,o.o),(0,i.fM)(4,m.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IUserPhotoMeta?Object:IUserPhotoMeta,void 0===u.tx?Object:u.tx,void 0===o.o?Object:o.o,void 0===m.Y?Object:m.Y])],w);var k=r("861810"),T=r("55449");class R extends s.e{createResource(e,t){return this._instantiationService.createInstance(new k.M(w,[e,t]))}constructor(e){super(e),this._instantiationService=e}}R=(0,i.gn)([(0,i.fM)(0,T.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===T.T?Object:T.T])],R)},789374:function(e,t,r){r.d(t,{t:function(){return c}});var i=r(789786),s=r(507255),n=r(808081),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.r,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},999872:function(e,t,r){r.d(t,{Y:function(){return s}});var i=r(335290);let s=r(315201).R;(0,i.yh)("user-video-resource-service")},203388:function(e,t,r){r.d(t,{j:function(){return _}});var i=r(789786),s=r(245044),n=r(168550),o=r(277754),a=r(800788),c=r(315201),u=r(261939),l=r(396190);let d=[360,480,720,1080,2400];class _ extends u.B{getCover(e){return e.coverUrl}async doFetch(){(0,a.Y2)(!(0,c.R)(this.value));let[e,t]=(await this._videoDataService.batchGetVideos({resourceIds:[this.value.resourceId],historyRecordId:this.value.historyRecordId})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.list[0]}}getVideoResolutionInfo(){var e;return(0,a.Y2)((0,c.R)(this.value)),{url:null!==(e=this.value.originVideo.url)&&void 0!==e?e:"",resolution:"origin"}}getVideoResourceToken(){return this._getResourceTokenSync(this._createDreaminaUserAiVideoResourceToken.bind(this),()=>this._videoDreaminaResourceToken,e=>this._videoDreaminaResourceToken=e)}getThumbResourceTokens(){return this._getResourceTokenAsync(this._createUserVideoThumbTokens.bind(this),()=>this._videoDreaminaThumbResourceTokens,e=>this._videoDreaminaThumbResourceTokens=e)}getCoverResourceTokenByFuzzyMatchWidth(e){let t,r;(0,a.Y2)((0,c.R)(this.value));let{coverUrlMap:i}=this.value,s={};for(let n of(d.forEach(e=>{s[e]=i[e]}),Object.keys(s))){let i=Number(n);if(i>=e){if(r&&i>r)continue;r=i,t=s[i]}}!t&&(t=this.value.coverUrl,r=200),(0,a.Y2)(t);let n=this._getCoverResolutionResourceKey(String(r));return(0,o.MZ)({key:n,url:t},this._downloadService)}_getVideoResourceKey(e,t){return`${e}_${t}`}_getThumbResourceKey(e){return`${this.key?`${this.key}_`:""}thumb_${e}`}_getCoverResolutionResourceKey(e){return`${this.key}_cover_resolution_${e}`}_createDreaminaUserAiVideoResourceToken(e){var t;(0,a.Y2)((0,c.R)(e)),(0,a.Y2)(null==e?void 0:null===(t=e.originVideo)||void 0===t?void 0:t.url);let{url:r}=e.originVideo,{key:i}=e,s=this._getVideoResourceKey(i,r);return this._videoDreaminaResourceToken=(0,o.MZ)({key:s,url:r},this._downloadService),this._videoDreaminaResourceToken}_createUserVideoThumbTokens(e){(0,a.Y2)(e.thumb);let{singleFrameWidth:t,singleFrameHeight:r}=e.thumb.thumbCommonInfo;return this._videoDreaminaThumbResourceTokens=e.thumb.detailInfos.map(e=>{let i=this._getThumbResourceKey(e.url),s={frameCount:e.frameCount,singleFrameWidth:t,singleFrameHeight:r,imageWidth:e.imageWidth,imageHeight:e.imageHeight};return(0,o.MZ)({key:i,url:e.url,...s},this._downloadService)}),this._videoDreaminaThumbResourceTokens}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._videoDataService=i,this._environmentService=s}}_=(0,i.gn)([(0,i.fM)(2,n.tx),(0,i.fM)(3,s.Z),(0,i.fM)(4,l.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoDreaminaMeta?Object:IVideoDreaminaMeta,void 0===n.tx?Object:n.tx,void 0===s.Z?Object:s.Z,void 0===l.Y?Object:l.Y])],_)},987272:function(e,t,r){r.d(t,{h:function(){return c}});var i=r(789786),s=r(507255),n=r(298073),o=r(861810),a=r(55449);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new o.M(n.E,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,a.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===a.T?Object:a.T])],c)},694471:function(e,t,r){r.d(t,{B:function(){return i}});let i=(0,r(335290).yh)("video-motion-resource-service")},680140:function(e,t,r){r.d(t,{W:function(){return u}});var i=r(789786),s=r(978112),n=r(249656),o=r(168550),a=r(261939),c=r(277754);class u extends a.B{getThumbResourceTokens(){return this._getResourceTokenAsync(this._createThumbResourceTokens.bind(this),()=>this._thumbResourceTokens,e=>this._thumbResourceTokens=e)}getBuiltinResourceTokens(){return this._getResourceTokenAsync(this._createBuiltinResourceTokens.bind(this),()=>this._builtinResourceTokens,e=>this._builtinResourceTokens=e)}getCover(e){return e.cover.url}_createThumbResourceTokens(e){return e.encryptedSprites.map(e=>{let{count:t,url:r}=e,i={frameCount:e.count,singleFrameWidth:e.width/e.x,singleFrameHeight:e.height/e.y,imageWidth:e.width,imageHeight:e.height},s=`${this.key}_thumb_${t}`;return(0,c.MZ)({key:s,url:r,...i},this._downloadService)})}_createBuiltinResourceTokens(e){return e.preload.builtIns.map(e=>{let{md5:t,url:r,aes:i,key:s}=e;return s?(0,c.MZ)({key:`${t}_${s.slice(0,6)}`,url:r,decryptKey:s,shouldAutoDecrypt:i,encryptType:n.PS.AES_GCM},this._downloadService):(0,c.MZ)({key:t,url:r},this._downloadService)})}async doFetch(){var e;let t;if(!this._jsonpTemplate){let[e,t]=(await this._videoTemplateDataService.getVideoTemplatesByJsonp()).pair(),r=null==t?void 0:t.list[0];!e&&r&&(this._jsonpTemplate=r)}if((null===(e=this._jsonpTemplate)||void 0===e?void 0:e.id)===this.value.id)return{type:this.value.type,...this._jsonpTemplate};let{searchParams:r,pathname:i}=new URL(window.location.href);t="tiktok_anchor"===r.get("utm_medium")?"tiktok_anchor_template_ccweb":i.startsWith("/editor-template")?"template_editor":"editor";let[s,n]=(await this._videoTemplateDataService.batchGetVideoTemplatesByIds({ids:[this.value.id],enterFrom:t})).pair();if(s)throw Error(`doFetch error-${s.code}-${s.msg}`,{cause:s.code});return{type:this.value.type,...n.list[0]}}setOriginVideoAlgorithmInfo(e){this._originVideoAlgorithmInfo=e}getOriginVideoAlgorithmInfo(){return this._originVideoAlgorithmInfo}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._videoTemplateDataService=i}}u=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,s.A),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoTemplateMeta?Object:IVideoTemplateMeta,void 0===o.tx?Object:o.tx,void 0===s.A?Object:s.A])],u)},784104:function(e,t,r){r.d(t,{e:function(){return p}});var i=r(789786),s=r(430687),n=r(249656),o=r(168550),a=r(277754),c=r(690613),u=r(800788),l=r(315201),d=r(261939),_=r(109685),h=r(396190);class p extends d.B{getCover(e){return e.coverUrl}getVideoResourceToken(){return this._getResourceTokenSync(this._createVideoResourceToken.bind(this),()=>this._videoResourceToken,e=>this._videoResourceToken=e)}getMaskVideoResourceToken(){return this._getResourceTokenSync(this._createMaskVideoResourceToken.bind(this),()=>this._maskVideoResourceToken,e=>this._maskVideoResourceToken=e)}async getVideoOrderedResourceToken(){if(await this._onResourceReadyDefer.promise,(0,u.Y2)((0,l.R)(this.value)),this._videoOrderedResourceToken)return(0,c.oW)(this._videoOrderedResourceToken);if(!(0,_.uS)(this.value))return(0,c.oW)(this.getVideoResourceToken());if((0,_.ko)(this.value))return(0,c.oW)(this._createVideoOrderedResourceToken(this.value));let e=await this._orderTuchongVideo();return e.ok?(0,c.oW)(this._createVideoOrderedResourceToken(this.value)):e}getThumbResourceTokens(){return this._getResourceTokenAsync(this._createVideoThumbTokens.bind(this),()=>this._thumbResourceTokens,e=>this._thumbResourceTokens=e)}getMaskVideoResolutionInfo(){for(let e of((0,u.Y2)((0,l.R)(this.value)),(0,u.Y2)(this.value.maskVideoTranscode),this._environmentService.isAutoTest?["720p","1080p","540p","480p","360p"]:["480p","360p","540p","720p","1080p"])){let t=this.value.maskVideoTranscode[e];if(null==t?void 0:t.url)return{url:t.url,resolution:e,decryptKey:t.decryptKey}}let{url:e}=this.value.maskVideo;return{url:e,resolution:"origin"}}getVideoResolutionInfo(){for(let e of((0,u.Y2)((0,l.R)(this.value)),this._environmentService.isAutoTest?["720p","1080p","540p","480p","360p"]:["480p","360p","540p","720p","1080p"])){let t=this.value.transcode[e];if(null==t?void 0:t.url)return{url:t.url,resolution:e,decryptKey:t.decryptKey}}let{url:e}=this.value.originVideo;return{url:e,resolution:"origin"}}getVideoOrderedResolutionInfo(){return((0,u.Y2)((0,l.R)(this.value)),this.value.order)?((0,u.Y2)(this.value.order.url),{url:this.value.order.url,resolution:"origin"}):this.getVideoResolutionInfo()}async getVideoStreamInfo(){if(await this._onResourceReadyDefer.promise,(0,u.Y2)((0,l.R)(this.value)),!(0,_.uS)(this.value)){var e;let{url:t,decryptKey:r}=this.getVideoResolutionInfo();return(0,c.oW)({url:t,decryptKey:r,encryptType:n.PS.AES_CBC,withCredentials:null!==(e=this.value.isFromBrand)&&void 0!==e&&e})}if((0,_.ko)(this.value)){let{url:e}=this.getVideoOrderedResolutionInfo();return(0,c.oW)({url:e})}let t=await this._orderTuchongVideo();return t.ok?(0,c.oW)({url:t.value.url}):t}_createCoverToken(e){let t=this._getCoverResourceKey(),r=this.getCover(e);return(0,a.MZ)({key:t,url:r},this._downloadService,this._getDownloadConfig(e))}async _orderTuchongVideo(){(0,u.Y2)((0,l.R)(this.value));let e=this.value.order,t=await this._videoDataService.order({id:e.id});if(!t.ok)return t;let{url:r}=t.value;return this.value.order.url=r,t}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}_createMaskVideoResourceToken(e){(0,u.Y2)((0,l.R)(this.value));let{url:t,decryptKey:r,resolution:i}=this.getMaskVideoResolutionInfo(),s=this._getMaskResolutionResourceKey(i);return this._maskVideoResourceToken=(0,a.MZ)({key:s,url:t,decryptKey:r,shouldAutoDecrypt:!1},this._downloadService,this._getDownloadConfig(e)),this._maskVideoResourceToken}_createVideoResourceToken(e){(0,u.Y2)((0,l.R)(this.value));let{url:t,decryptKey:r,resolution:i}=this.getVideoResolutionInfo(),s=this._getResolutionResourceKey(i);return this._videoResourceToken=(0,a.MZ)({key:s,url:t,decryptKey:r,shouldAutoDecrypt:!1},this._downloadService,this._getDownloadConfig(e)),this._videoResourceToken}_createVideoOrderedResourceToken(e){(0,u.Y2)((0,l.R)(this.value));let{url:t}=this.getVideoOrderedResolutionInfo(),r=this._getOrderedResolutionResourceKey();return this._videoResourceToken=(0,a.MZ)({key:r,url:t},this._downloadService,this._getDownloadConfig(e)),this._videoResourceToken}_createVideoThumbTokens(e){return e.thumb.details.map(t=>{let r=this._getThumbResourceKey(t.url),{singleFrameWidth:i,singleFrameHeight:s}=e.thumb.common,n={frameCount:t.frameCount,singleFrameWidth:i,singleFrameHeight:s,imageWidth:t.imageWidth,imageHeight:t.imageHeight};return(0,a.MZ)({key:r,url:t.url,...n},this._downloadService)})}_getMaskResolutionResourceKey(e){return`${this.key}_mask_resolution_${e}`}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}_getOrderedResolutionResourceKey(){return`${this.key}_ordered`}_getThumbResourceKey(e){return`${this.key}_thumb_${e}`}async doFetch(){let[e,t]=(await this._videoDataService.getVideos({})).pair();if(e)throw Error(`doFetch error-${e.code}-${e.msg}`);return{type:this.value.type,...t.value.list[0]}}constructor(e,t,r,i,s){super(e,t,r),this.key=e,this._downloadService=r,this._videoDataService=i,this._environmentService=s}}p=(0,i.gn)([(0,i.fM)(2,o.tx),(0,i.fM)(3,s.u),(0,i.fM)(4,h.Y),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoMeta?Object:IVideoMeta,void 0===o.tx?Object:o.tx,void 0===s.u?Object:s.u,void 0===h.Y?Object:h.Y])],p)},693967:function(e,t,r){r.d(t,{_:function(){return c}});var i=r(789786),s=r(507255),n=r(861810),o=r(55449),a=r(492668);class c extends s.e{createResource(e,t){return this._instantiationService.createInstance(new n.M(a.t,[e,t]))}constructor(e){super(e),this._instantiationService=e}}c=(0,i.gn)([(0,i.fM)(0,o.T),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.T?Object:o.T])],c)},308665:function(e,t,r){r.d(t,{m:function(){return i}});let i={name:"resource-request",key:"id",index:[{name:"createTime",unique:!1},{name:"updateTime",unique:!1}]}},686567:function(e,t,r){r.d(t,{b:function(){return i}});let i={name:"template-post",key:"id",index:[{name:"createTime",unique:!1},{name:"updateTime",unique:!1}]}},332557:function(e,t,r){r.d(t,{U:function(){return i}});let i=(0,r(335290).yh)("Storage")},782350:function(e,t,r){r.d(t,{W:function(){return i}});let i=(0,r(335290).yh)("workspace")},825067:function(e,t,r){r.d(t,{A:function(){return l}});var i=r(789786),s=r(587892),n=r(402655),o=r(800788),a=r(813072),c=r(290568),u=r(200247);class l extends n.JT{get available(){return this._available}get workspaceList(){return(0,o.Y2)(this._accountService.hasLogin,"workspace list is undefined"),this._workspaceList}initialize(e){return new Promise(e=>{if(this._available){e();return}try{if("undefined"!=typeof window){var t,r,i,s;if(this._workspaceList=null!==(s=null===(r=JSON.parse(window.__userWorkspaces))||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.workspace_infos)&&void 0!==s?s:[],!(null===(i=this._workspaceList)||void 0===i?void 0:i.length))throw Error("invalid value");this._available=!0,this._onDidWorkspaceChange.fire(this._workspaceList)}e()}catch(t){this._userService.onDidWorkspaceChange(t=>{if(!(null==t?void 0:t.length))throw Error("invalid value");this._workspaceList=t,this._available=!0,this._onDidWorkspaceChange.fire(this._workspaceList),e()})}})}get workspaceExpandInfoMap(){return this._workspaceExpandInfoMap}getWorkspace(e){return this.workspaceList.find(t=>t.workspace_id===e)}triggerWorkspaceListChange(e){this._userService.dangerUsedUserMachineService.send({type:"NOTIFY_WORKSPACE_CHANGE",notifyData:e})}refreshWorkspaceList(){this._userService.dangerUsedUserMachineService.send("REFRESH_WORKSPACE_LIST")}refreshUserSpace(){this._userService.dangerUsedUserMachineService.send("REFRESH_USER_SPACE")}constructor(e,t){super(),this._userService=e,this._accountService=t,this._workspaceList=[],this._available=!1,this._onDidWorkspaceChange=this._store.add(new s.Q),this.onDidWorkspaceChange=this._onDidWorkspaceChange.event,this._onDidWorkspaceExpandInfoMapChange=this._store.add(new s.Q),this.onDidWorkspaceExpandInfoMapChange=this._onDidWorkspaceExpandInfoMapChange.event,this._userService.registerTransition(e=>{var t,r,i,s;if(!e)return;this._workspaceExpandInfoMap=null===(t=e.context)||void 0===t?void 0:t.workspaceExpandInfoMap;let n=null===(r=e.context)||void 0===r?void 0:r.workspaceList,o=null===(i=e.context)||void 0===i?void 0:i.workspaceExpandInfoMap;!(0,a.Z)(this._workspaceList,n)&&(null==n?void 0:n.length)&&(this._workspaceList=n,this._available=!0,this._onDidWorkspaceChange.fire(n)),!(0,a.Z)(this._workspaceExpandInfoMap,o)&&(this._workspaceExpandInfoMap=null===(s=e.context)||void 0===s?void 0:s.workspaceExpandInfoMap,this._onDidWorkspaceExpandInfoMapChange.fire())})}}l=(0,i.gn)([(0,i.fM)(0,c.S),(0,i.fM)(1,u.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.S?Object:c.S,void 0===u.D?Object:u.D])],l)}}]);