(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["88"],{809933:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={"sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px"}},344686:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={container:"container-JAwbfg","segment-wrapper":"segment-wrapper-y2iLiA",segmentWrapper:"segment-wrapper-y2iLiA",info:"info-peZ1nI",name:"name-empaIb",duration:"duration-IYynvJ"}},996820:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px"}},979708:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={view:"view-Z2D8sW",active:"active-UpTrWZ",wrapper:"wrapper-K4332N",title:"title-VfPRCo",content:"content-ZlIlq8"}},914264:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-EK8nz4",entryContainer:"entry-container-EK8nz4","view-box":"view-box-Jy3CLN",viewBox:"view-box-Jy3CLN",hidden:"hidden-OcvYLG","scroll-container":"scroll-container-UX90zw",scrollContainer:"scroll-container-UX90zw","view-box-category":"view-box-category-PHCTby",viewBoxCategory:"view-box-category-PHCTby","favorite-header":"favorite-header-qiqIci",favoriteHeader:"favorite-header-qiqIci",backBtn:"backBtn-Zg88AQ",active_category:"active_category-kSl2Xy",activeCategory:"active_category-kSl2Xy",active_category_back_btn_wrap:"active_category_back_btn_wrap-Mv11S2",activeCategoryBackBtnWrap:"active_category_back_btn_wrap-Mv11S2",active_category_content:"active_category_content-tNhrpA",activeCategoryContent:"active_category_content-tNhrpA",active_category_back_btn:"active_category_back_btn-MMl6xd",activeCategoryBackBtn:"active_category_back_btn-MMl6xd"}},145952:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={"entire-panel-skeleton":"entire-panel-skeleton-DQJlg_",entirePanelSkeleton:"entire-panel-skeleton-DQJlg_"}},911378:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px",hide:"hide-JHz05x","base-add-text":"base-add-text-PbMnj1",baseAddText:"base-add-text-PbMnj1",title:"title-X3p6dF","entry-container":"entry-container-xS6MYK",entryContainer:"entry-container-xS6MYK","view-box":"view-box-mKBpdX",viewBox:"view-box-mKBpdX",initializing:"initializing-ULdS80",hidden:"hidden-Vj6zB4","scroll-container":"scroll-container-wRkMof",scrollContainer:"scroll-container-wRkMof",active_category:"active_category-TfqOmV",activeCategory:"active_category-TfqOmV",active_category_back_btn_wrap:"active_category_back_btn_wrap-ddEyhP",activeCategoryBackBtnWrap:"active_category_back_btn_wrap-ddEyhP",active_category_content:"active_category_content-pQVAQA",activeCategoryContent:"active_category_content-pQVAQA",active_category_back_btn:"active_category_back_btn-WoKk9a",activeCategoryBackBtn:"active_category_back_btn-WoKk9a"}},339992:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});let i={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px",hide:"hide-o80jVY","entry-container":"entry-container-cosq71",entryContainer:"entry-container-cosq71",initializing:"initializing-Lv0ewU","tags-wrapper":"tags-wrapper-SjaenT",tagsWrapper:"tags-wrapper-SjaenT",tags:"tags-bLYVmg","view-box-wrapper":"view-box-wrapper-X290Xu",viewBoxWrapper:"view-box-wrapper-X290Xu","view-box":"view-box-Y3gtWg",viewBox:"view-box-Y3gtWg",hidden:"hidden-WgYQNQ","scroll-container":"scroll-container-mdnEta",scrollContainer:"scroll-container-mdnEta","view-box-category":"view-box-category-dtnw63",viewBoxCategory:"view-box-category-dtnw63",active_category:"active_category-tAr08f",activeCategory:"active_category-tAr08f",active_category_back_btn_wrap:"active_category_back_btn_wrap-EiKCpE",activeCategoryBackBtnWrap:"active_category_back_btn_wrap-EiKCpE",active_category_content:"active_category_content-Mrk3_h",activeCategoryContent:"active_category_content-Mrk3_h",active_category_back_btn:"active_category_back_btn-AyNOPG",activeCategoryBackBtn:"active_category_back_btn-AyNOPG",transitionTipWithPoly:"transitionTipWithPoly-piCujV"}},680306:function(){},296805:function(){},678671:function(){},89387:function(){},544499:function(){},567675:function(){},300798:function(){},170535:function(){},54734:function(){},147442:function(e,t,r){var i,a,n=r(499845);(null==n?void 0:n.env.EDENX_TARGET)!=="node"&&(null===(a=performance)||void 0===a||null===(i=a.mark)||void 0===i||i.call(a,"ENTRY_SCRIPT_EXECUTION_START"))},728631:function(e,t,r){"use strict";r.d(t,{j:function(){return i},n:function(){return a}});let i={SiderMenuCaption:"siderMenuCaption",SiderMenuAudio:"siderMenuAudio",SiderMenuEffect:"siderMenuEffect",SiderMenuFilter:"siderMenuFilter",SiderMenuMedia:"siderMenuMedia",SiderMenuPhoto:"siderMenuPhoto",SiderMenuShortcut:"siderMenuShortcut",SiderMenuSticker:"siderMenuSticker",SiderTabTemplate:"siderTabTemplate",SiderMenuText:"siderMenuText",SiderMenuTextEditMedia:"siderMenuTextEditMedia",SiderMenuTransition:"siderMenuTransition",SiderMenuStockVideo:"siderMenuStockVideo",SiderMenuDigitalHuman:"siderMenuDigitalHuman",SiderMenuElement:"siderMenuElement",SiderMenuPlugin:"siderMenuPlugin",SiderMenuBrandKit:"siderMenuBrandKit",ToolbarAudioBasic:"toolbarAudioBasic",ToolbarAudioSpeed:"toolbarAudioSpeed",ToolbarAudioVoiceChanger:"toolbarAudioVoiceChanger",ToolbarEffectBasic:"toolbarEffectBasic",ToolbarFilterBasic:"toolbarFilterBasic",ToolbarMutableAudioBasic:"toolbarMutableAudioBasic",ToolbarMutableTextBasic:"toolbarMutableTextBasic",ToolbarStickerBasic:"toolbarStickerBasic",ToolbarStickerMotion:"toolbarStickerMotion",ToolbarTextBasic:"toolbarTextBasic",ToolbarTextMotion:"toolbarTextMotion",ToolbarTextPreset:"toolbarTextPreset",ToolbarMutableTextPreset:"toolbarMutableTextPreset",ToolbarTextTemplateBasic:"toolbarTextTemplateBasic",ToolbarTextTemplateMotion:"toolbarTextTemplateMotion",ToolbarTextTts:"toolbarTextTts",ToolbarTransitionBasic:"toolbarTransitionBasic",ToolbarVideoAudio:"toolbarVideoAudio",ToolbarVideoBackground:"toolbarVideoBackground",ToolbarVideoBasic:"toolbarVideoBasic",ToolbarVideoCutout:"toolbarVideoCutout",ToolbarVideoElement:"toolbarVideoElement",ToolbarVideoMotion:"toolbarVideoMotion",ToolbarVideoSpeed:"toolbarVideoSpeed",ToolbarPictureAdjustBasic:"toolbarPictureAdjustBasic",ToolBarUnselectedGuide:"toolbarUnselectedGuide"},a={[i.SiderMenuCaption]:"subtitle",[i.SiderMenuAudio]:"audio",[i.SiderMenuEffect]:"effect",[i.SiderMenuFilter]:"filter",[i.SiderMenuMedia]:"media",[i.SiderMenuPhoto]:"photos",[i.SiderMenuSticker]:"sticker",[i.SiderTabTemplate]:"templates",[i.SiderMenuText]:"text",[i.SiderMenuTextEditMedia]:"transcript",[i.SiderMenuTransition]:"trans",[i.SiderMenuStockVideo]:"material_lib",[i.SiderMenuElement]:"elements",[i.SiderMenuPlugin]:"plugin",[i.SiderMenuDigitalHuman]:"digitalHuman",[i.SiderMenuBrandKit]:"brand"}},274559:function(e,t,r){"use strict";r.d(t,{X:function(){return l},Z:function(){return d}});var i=r(587892),a=r(402655),n=r(800788),o=r(204676),s=r(619425),c=r(21961);let l="/";class d extends a.JT{get currentPath(){return this._currentPath.join(l)}get nodesInCurrentPath(){return this._nodes}get currentFolder(){return this._parent}batchAddNodes(e,t){var r;let i=e.map(e=>e.type===c.t.File?{path:this._formatPathArrayFromString(e.path),data:e.data,options:e.options,type:c.t.File}:{path:this._formatPathArrayFromString(e.path),data:e.data,options:e.options,type:c.t.Folder});this._directoryTree.batchAddNodes(i,t);let a=[],n=null!==(r=null==t?void 0:t.insertPosition)&&void 0!==r?r:c.O.End;e.forEach(e=>{let t;let{path:r}=e,i=this._formatPathArrayFromString(r),o=i[i.length-1];t=e.type===c.t.Folder?this._formatNode({id:o,data:e.data,isFile:!1,path:i}):this._formatNode({id:o,data:e.data,isFile:!0,path:i}),n===c.O.Beginning?(this._nodes.unshift(t),a.unshift(t)):(this._nodes.push(t),a.push(t))}),this._onAdd.fire(a,{insertPosition:n})}addFileToCurrentPath(e,t,r){var i;let a=[...this._currentPath,e],n=null!==(i=null==r?void 0:r.insertPosition)&&void 0!==i?i:c.O.End;this._directoryTree.createFile(a,t,r);let o=this._formatNode({id:e,data:t,isFile:!0,path:a});n===c.O.Beginning?this._nodes.unshift(o):this._nodes.push(o),this._onAdd.fire([o],{insertPosition:n})}addFolderToCurrentPath(e,t,r){var i;let a=[...this._currentPath,e],n=null!==(i=null==r?void 0:r.insertPosition)&&void 0!==i?i:c.O.End;this._directoryTree.createFolder(a,t,r);let o=this._formatNode({id:e,data:t,isFile:!1,path:a});n===c.O.Beginning?this._nodes.unshift(o):this._nodes.push(o),this._onAdd.fire([o],{insertPosition:n})}open(e){let t=this._directoryTree.getFolderById(e);t&&(this._onBeforePathChange.fire({action:s.l.Forward}),this._currentPath=t.path,e===this.root.id?this._updateParent(this._directoryTree.root):this._updateParent(t),this._history.push(this._currentPath),this._nodes=null==t?void 0:t.children.map(e=>this._formatNodeFromTreeNode(e)),this._onPathChange.fire({action:s.l.Forward}))}back(){var e;if(this._history.length<=1)return;this._onBeforePathChange.fire({action:s.l.Back}),this._history.pop(),this._currentPath=null!==(e=this._history[this._history.length-1])&&void 0!==e?e:this.root.path;let t=this._directoryTree.getFolderByPath(this._currentPath);t&&(this._updateParent(t),this._nodes=null==t?void 0:t.children.map(e=>this._formatNodeFromTreeNode(e))),this._onPathChange.fire({action:s.l.Back})}deleteFileById(e){let t=this._nodes.findIndex(t=>t.type===c.t.File&&t.id===e);if(-1!==t){var r;let i=null===(r=this.nodesInCurrentPath.splice(t,1))||void 0===r?void 0:r[0];this._directoryTree.delete([...this._currentPath,e]),this._onDelete.fire(i)}else{let t=this._directoryTree.getFileById(e);(0,n.ZB)(t,`Can't find the folder or file with id ${e}.`),this._directoryTree.delete(t.path),this._onDelete.fire(this._formatNodeFromTreeNode(t))}}deleteFolderById(e){let t=this._nodes.findIndex(t=>t.type===c.t.Folder&&t.id===e);if(-1!==t){var r;let i=null===(r=this.nodesInCurrentPath.splice(t,1))||void 0===r?void 0:r[0];this._directoryTree.delete([...this._currentPath,e]),this._onDelete.fire(i)}else{let t=this._directoryTree.getFolderById(e);(0,n.ZB)(t,`Can't find the folder or file with id ${e}.`),this._directoryTree.delete(t.path),this._onDelete.fire(this._formatNodeFromTreeNode(t))}}syncPreorderTraversal(e,t){let r=this._getTreeFolderById(e);r&&this._directoryTree.syncPreorderTraversal(r,e=>{t(this._formatNodeFromTreeNode(e))})}syncPostorderTraversal(e,t){let r=this._getTreeFolderById(e);r&&this._directoryTree.syncPostorderTraversal(r,e=>{t(this._formatNodeFromTreeNode(e))})}async asyncPreorderTraversal(e,t){let r=this._getTreeFolderById(e);r&&await this._directoryTree.asyncPreorderTraversal(r,async e=>{await t(this._formatNodeFromTreeNode(e))})}async asyncPostorderTraversal(e,t){let r=this._getTreeFolderById(e);r&&await this._directoryTree.asyncPostorderTraversal(r,async e=>{await t(this._formatNodeFromTreeNode(e))})}print(e){this._directoryTree.print(void 0,{indent:e.indent,formatter:e.formatter?t=>{var r,i;let a=this._formatNodeFromTreeNode(t);return null!==(i=null==e?void 0:null===(r=e.formatter)||void 0===r?void 0:r.call(e,a))&&void 0!==i?i:""}:void 0})}getFolderById(e){let t=this._getTreeFolderById(e);return t?this._formatFolderFromTreeFolder(t):null}getFolderByPath(e){let t=this._directoryTree.getFolderByPath(e.split(l));return t?this._formatFolderFromTreeFolder(t):null}getFileById(e){let t=this._getTreeFileById(e);return t?this._formatFileFromTreeFile(t):null}getFileByPath(e){let t=this._directoryTree.getFileByPath(e.split(l));return t?this._formatFileFromTreeFile(t):null}createFolderByPath(e,t,r){var i;this._directoryTree.createFolder(this._formatPathArrayFromString(e),t,r);let a=null!==(i=null==r?void 0:r.insertPosition)&&void 0!==i?i:c.O.End,n=this._formatPathArrayFromString(e),o=n[n.length-1],s=this._formatNode({id:o,data:t,isFile:!1,path:n});a===c.O.Beginning?this._nodes.unshift(s):this._nodes.push(s),this._onAdd.fire([s],{insertPosition:a})}createFileByPath(e,t,r){var i;this._directoryTree.createFile(this._formatPathArrayFromString(e),t,r);let a=null!==(i=null==r?void 0:r.insertPosition)&&void 0!==i?i:c.O.End,n=this._formatPathArrayFromString(e),o=n[n.length-1],s=this._formatNode({id:o,data:t,isFile:!0,path:n});a===c.O.Beginning?this._nodes.unshift(s):this._nodes.push(s),this._onAdd.fire([s],{insertPosition:a})}formatPathFromArray(e){return e.join(l)}getParentFolder(e){if(e.type===c.t.File){let t=this._directoryTree.getFileByPath(this._formatPathArrayFromString(e.path));return(null==t?void 0:t.parent)?this._formatFolderFromTreeFolder(t.parent):null}{let t=this._directoryTree.getFolderByPath(this._formatPathArrayFromString(e.path));return(null==t?void 0:t.parent)?this._formatFolderFromTreeFolder(t.parent):null}}getFolderChildNodes(e){let t=this._getTreeFolderById(e);return t?t.children.map(this._formatNodeFromTreeNode.bind(this)):null}extractParentPath(e){let t=e.split("/");return t.length>1?t.slice(0,t.length-1).join("/"):""}extractCurrentId(e){let t=e.split("/");return t[t.length-1]}dangerouslyUpdateFile(e,t){let r=this.getFileById(e);(0,n.ZB)(r),this._directoryTree.updateFile(this._formatPathArrayFromString(r.path),t)}dangerouslyUpdateFolder(e,t){let r=this.getFolderById(e);(0,n.ZB)(r),this._directoryTree.updateFolder(this._formatPathArrayFromString(r.path),t)}_getTreeFolderById(e){let t=this._directoryTree.getFolderByPath([...this._formatPathArrayFromString(this.currentPath),e]);return!t&&(t=this._directoryTree.getFolderById(e)),t}_getTreeFileById(e){let t=this._directoryTree.getFileByPath([...this._formatPathArrayFromString(this.currentPath),e]);return!t&&(t=this._directoryTree.getFileById(e)),t}_formatNodeFromTreeNode(e){return e.type===c.t.File?this._formatFileFromTreeFile(e):this._formatFolderFromTreeFolder(e)}_formatFileFromTreeFile(e){return{id:e.id,data:e.data,type:c.t.File,path:this.formatPathFromArray(e.path)}}_formatFolderFromTreeFolder(e){return{id:e.id,data:e.data,type:c.t.Folder,path:this.formatPathFromArray(e.path)}}_formatNode(e){return e.isFile?{id:e.id,data:e.data,type:c.t.File,path:this.formatPathFromArray(e.path)}:{id:e.id,data:e.data,type:c.t.Folder,path:this.formatPathFromArray(e.path)}}_updateParent(e){if((null==e?void 0:e.type)===c.t.Folder){let t=this._formatFolderFromTreeFolder(e);this._parent=t}}_formatPathArrayFromString(e){return e.split(l)}constructor({rootId:e,rootData:t}){super(),this._nodes=[],this._onAdd=this._store.add(new i.Q),this.onAdd=this._onAdd.event,this._onDelete=this._store.add(new i.Q),this.onDelete=this._onDelete.event,this._onPathChange=this._store.add(new i.Q),this.onPathChange=this._onPathChange.event,this._onBeforePathChange=this._store.add(new i.Q),this.onBeforePathChange=this._onBeforePathChange.event,this._directoryTree=new o.s({rootId:e,rootData:t}),this.root=this._formatFolderFromTreeFolder(this._directoryTree.root),this._parent=this.root,this._currentPath=[e],this._history=[this._currentPath]}}},841616:function(e,t,r){"use strict";r.d(t,{w:function(){return h}});var i=r(690613),a=r(753637),n=r(268977),o=r(426020),s=r(127830),c=r(251180),l=r(137348),d=r(599735),u=r(339098);async function h(e){try{let t=(0,u.O)(e.containerService,e.notificationGenerator),[r]=e.containerService.invokeFunction(e=>[e.get(a.L)]),h=Promise.all(e.files.map(a=>(0,i.oW)(e.containerService.createInstance(c.c,{fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,fromFolderId:e.fromFolderId,toFolderId:e.toFolderId,data:{sourceType:o.ov.EverCloud,assetType:s.pS.Material,key:"",filename:(0,l.F)({name:a.name,format:"mp3"}),fileType:o.YB.Audio,owner:"",md5:"",mime:"audio/mp3",duration:0,isAudioTranscoding:!1,size:a.size,createdAt:Date.now().valueOf(),updatedAt:Date.now().valueOf()},addModelToDraft:(0,d.s)(e.containerService),fastImportAnalyzeHelper:e.fastImportAnalyzeHelper,prepareMaterialLifecycleHelper:new n.A({file:a,ffmpegAdapterService:r}),notificationService:t,payinPayoutHelper:e.payinPayoutHelper,uploadParams:e.uploadParams}))));return await h}catch(e){return[(0,i.wf)(-1,null==e?void 0:e.message)]}}},234487:function(e,t,r){"use strict";r.d(t,{u:function(){return _}});var i=r(690613),a=r(225698),n=r(775352),o=r(273238),s=r(48824),c=r(374904),l=r(383168),d=r(426020),u=r(127830),h=r(599735),g=r(339098);async function _(e){let t=(0,g.O)(e.containerService,e.notificationGenerator),[r,_,p]=e.containerService.invokeFunction(e=>[e.get(a.w),e.get(n.ec),e.get(o.b)]);try{let a=Promise.all(e.files.map(async a=>{let n=await (await r.getInstance()).calcFileMd5(a);return n.ok?(0,i.oW)(e.containerService.createInstance(l.m,{fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,data:{sourceType:d.ov.EverCloud,assetType:u.pS.Material,key:n.value,filename:a.name,fileType:(0,c.eF)({file:a})||d.YB.File,owner:"",md5:n.value,mime:a.type,size:a.size,createdAt:Date.now().valueOf(),updatedAt:Date.now().valueOf()},addModelToDraft:(0,h.s)(e.containerService),packageDelta:e.packageDelta,uploadMaterialLifecycleHelper:new s.x({file:a,fromWorkspaceId:e.fromWorkspaceId,userMaterialUploadService:_,userMaterialService:p,uploadParams:e.uploadParams,payinPayoutHelper:e.payinPayoutHelper,notificationService:t}),notificationService:t})):n}));return await a}catch(e){return[(0,i.wf)(-1,null==e?void 0:e.message)]}}},433744:function(e,t,r){"use strict";r.d(t,{a:function(){return c}});var i=r(162641),a=r(838348),n=r(599735),o=r(127830),s=r(339098);function c(e,t){let r=(0,s.O)(t.containerService,t.notificationGenerator);return e.map(e=>{let s=(0,a.C)(e);return t.containerService.createInstance(i.q,{data:{...s,key:s.vid,assetType:o.pS.Material},addModelToDraft:(0,n.s)(t.containerService),toWorkspaceId:t.toWorkspaceId,payinPayoutHelper:t.payinPayoutHelper,syncAssetOptions:null==t?void 0:t.syncAssetOptions,notificationService:r})})}},512619:function(e,t,r){"use strict";r.d(t,{f:function(){return h}});var i=r(493034),a=r(426020),n=r(200247),o=r(67557),s=r(641276),c=r(599735),l=r(701004),d=r(936243),u=r(339098);function h(e){let{templateId:t,data:r,toWorkspaceId:h,payinPayoutHelper:g}=e,_=(0,u.O)(e.containerService,e.notificationGenerator),p=e.containerService.invokeFunction(async e=>{let a=e.get(i.d),o=e.get(d.v);(!e.get(n.D).hasLogin||!o.draftWorkspaceManager.workspaceId)&&await new Promise(e=>{(0,s.V)(o.draftWorkspaceManager.onDidWorkspaceChange)(()=>{e()})});let c=await a.createSyncTask({templateId:t,data:r,workspaceId:null!=h?h:o.draftWorkspaceManager.workspaceId});return o.draftWorkspaceManager.onDidWorkspaceChange(()=>{h!==o.draftWorkspaceManager.workspaceId&&h&&o.draftWorkspaceManager.workspaceId&&c.ok&&c.value.reSyncWhileWorkspaceIdChange(o.draftWorkspaceManager.workspaceId)}),c});return r.map(t=>{let r=(0,l.F)({data:{md5:t.md5,decryptKey:t.decryptKey,url:t.url,decryptType:t.decryptType},fileType:t.fileType});return e.containerService.createInstance(o.N,{data:{sourceType:a.ov.PublicSpace,uri:t.uri,url:t.url,key:t.key,md5:t.md5,size:t.size,...r},toWorkspaceId:h,syncParams:{syncTask:p,uri:t.uri},addModelToDraft:(0,c.s)(e.containerService),payinPayoutHelper:g,notificationService:_})})}},988385:function(e,t,r){"use strict";r.d(t,{E:function(){return p}});var i=r(690613),a=r(775352),n=r(273238),o=r(463263),s=r(374904),c=r(48824),l=r(426020),d=r(127830),u=r(607732),h=r(801497),g=r(599735),_=r(339098);async function p(e){let{addToUserGenerated:t=!0}=e,r=(0,_.O)(e.containerService,e.notificationGenerator);try{let[_,p]=e.containerService.invokeFunction(e=>[e.get(a.ec),e.get(n.b)]),f=Promise.all(e.files.map((a,n)=>{var f,m,v,y,S,b;let M=`.${a.name.split(".").reverse()[0]}`;if(e.acceptTypes&&!(0,s.J5)({file:a,accepts:e.acceptTypes})&&!e.acceptTypes.includes("file")||(null===(f=e.disableTypes)||void 0===f?void 0:f.includes(a.type))||(null===(m=e.disableTypes)||void 0===m?void 0:m.includes(M))||a.size<=0)return!e.acceptTypesErrorTipDisabled&&(null==r||r.error(h.ZP.t("current_import_format_not_supported",{},"Current import format is not supported"))),(0,i.wf)(-1,"un support file type",{name:a.name});if(a.size<=0)return null==r||r.error(h.ZP.t("web_file_upload_toast_empty_file",{},"Can\u2019t upload empty file")),(0,i.wf)(-1,"invalid file size");let k=(0,u.m)(a.size,null===(v=e.checkUploadLimit)||void 0===v?void 0:v.singleSize,(null===(y=e.checkUploadLimit)||void 0===y?void 0:y.isNoNeedSingleSizeLimitToast)?void 0:r);if(!k.ok)return k;let T=null===(S=e.dataDelta)||void 0===S?void 0:S[n];return(0,i.oW)(e.containerService.createInstance(o.p,{fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,fromFolderId:e.fromFolderId,toFolderId:e.toFolderId,data:{key:"",owner:"",md5:"",...T,filename:a.name,sourceType:l.ov.EverCloud,assetType:d.pS.Material,fileType:(null===(b=e.uploadParams)||void 0===b?void 0:b.skipTranscode)?l.YB.File:(0,s.eF)({file:a}),mime:a.type,size:a.size,createdAt:Date.now().valueOf(),updatedAt:Date.now().valueOf()},autoUpload:e.autoUpload,packageDelta:e.packageDelta,addModelToDraft:(0,g.s)(e.containerService,{addToUserGenerated:t,notificationService:r}),payinPayoutHelper:e.payinPayoutHelper,uploadMaterialLifecycleHelper:new c.x({file:a,uploadSizeChecker:e.uploadSizeChecker,fromWorkspaceId:e.fromWorkspaceId,fromFolderId:e.fromFolderId,uploadParams:e.uploadParams,fastImportAnalyzeHelper:e.fastImportAnalyzeHelper,captureCoverAndThumbHelper:e.captureCoverAndThumbHelper,userMaterialUploadService:_,userMaterialService:p,payinPayoutHelper:e.payinPayoutHelper,checkUploadFlag:e.checkUploadFlag,notificationService:r}),notificationService:r}))})),m=await f;return m}catch(e){return[(0,i.wf)(-1,null==e?void 0:e.message)]}}},211820:function(e,t,r){"use strict";r.d(t,{Q:()=>f});var i=r("426020"),a=r("789786"),n=r("800788"),o=r("173888"),s=r("31463"),c=r("198414"),l=r("116528"),d=r("860734"),u=r("565598"),h=r("273238");class g extends c.E{getModel(){var e;return{...super.getModel(),addModelToDraft:this.__addModelToDraftBinder,transcoding:null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.transcoding}}canRetryTranscode(){var e,t;return null!==(t=null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.canRetryTranscode())&&void 0!==t&&t}transcode(){return(0,n.Y2)(this._transcodeMaterialHelper,"helper not found"),this._transcodeMaterialHelper.transcode()}_initMaterialStatus(e){let{forceTranscode:t}=e,r=this._data,a=!1,n=!1;if(r.fileType===i.YB.Image&&(a=r.isImgTranscoding,n=(0,u.o)(r.imgTranscodeInfo,{keyFormatter:e=>"origin"!==e?`${e}p`:"origin",originSize:r.width&&r.height?{width:r.width,height:r.height}:void 0})),r.fileType===i.YB.Video&&(a=!(n=!!r.videoTranscodeInfo)),r.fileType===i.YB.Audio&&(a=!(n=!!r.audioTranscodeInfo)),a||t){this._updateStatus(o.a.Transcoding),this._transcodeMaterialHelper.listenTranscodeResult();return}n?this.canSync2UserMaterial()?(this._updateStatus(o.a.WaitForSync2UserMaterial),this.sync2UserMaterial()):this._updateStatus(o.a.Success):this._updateStatus(o.a.TranscodeFailure)}_partialUpdateModel(e){this._data.key&&delete e.key,Object.assign(this._data,e)}constructor(e,t,r){super(e,t,r),this.__addModelToDraftBinder=()=>this.addModelToDraft(this),this._data=e.data,(0,n.Y2)(this._data.sourceType===i.ov.EverCloud),this._data.fileType===i.YB.Image?this._transcodeMaterialHelper=new l.Y({assetId:this._data.assetId,fromWorkspaceId:e.fromWorkspaceId,userMaterialService:t,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>{this._data=e}}}):[i.YB.Audio,i.YB.Video].includes(this._data.fileType)?this._transcodeMaterialHelper=new d.D({assetId:this._data.assetId,fileType:this._data.fileType,fromWorkspaceId:e.fromWorkspaceId,userMaterialService:t,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}):(0,n.ss)("unexpected logic"),this._initMaterialStatus({forceTranscode:e.forceTranscode})}}g=(0,a.gn)([(0,a.fM)(1,h.b),(0,a.fM)(2,s.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IMediaMaterialLifecycle?Object:IMediaMaterialLifecycle,void 0===h.b?Object:h.b,void 0===s.m?Object:s.m])],g);var _=r("599735"),p=r("339098");function f(e,t){let r=(0,p.O)(t.containerService,t.notificationGenerator);switch(e.fileType){case i.YB.Video:case i.YB.Audio:case i.YB.Image:return t.containerService.createInstance(g,{data:e,forceTranscode:t.forceTranscode,packageDelta:t.packageDelta,fromWorkspaceId:t.fromWorkspaceId,toWorkspaceId:t.toWorkspaceId,payinPayoutHelper:t.payinPayoutHelper,fromFolderId:t.fromFolderId,toFolderId:t.toFolderId,addModelToDraft:(0,_.s)(t.containerService,{addToUserGenerated:t.addToUserGenerated,notificationService:r}),notificationService:r});default:return t.containerService.createInstance(c.E,{data:e,packageDelta:t.packageDelta,fromWorkspaceId:t.fromWorkspaceId,toWorkspaceId:t.toWorkspaceId,fromFolderId:t.fromFolderId,toFolderId:t.toFolderId,payinPayoutHelper:t.payinPayoutHelper,addModelToDraft:(0,_.s)(t.containerService,{addToUserGenerated:t.addToUserGenerated,notificationService:r}),notificationService:r})}}},940882:function(e,t,r){"use strict";r.d(t,{W:function(){return s}});var i=r(999268),a=r(690613),n=r(34159),o=r(173888);class s{get syncingUserMaterial(){return{progress:0}}get _updateStatus(){return this._params.handler.updateStatus}canSync2UserMaterial(){return!0}sync2UserMaterial(){return new Promise(async(e,t)=>{if(!this._mutex.tryLock())return(0,a.wf)(-1,"do not call this function before it done");this.syncingUserMaterial.error=void 0,this._updateStatus(o.a.Syncing2UserMaterial);try{var r,i;let t=await this._params.syncDataService.createSyncTask({resourceType:this._params.resourceType,resourceId:null!==(r=this._params.realResourceId)&&void 0!==r?r:this._params.resourceId,workspaceId:this._params.toWorkspaceId,tmpId:this._params.tmpId,isGameplay:null!==(i=this._params.isGameplay)&&void 0!==i&&i,pipelineId:this._params.pipelineId});if(!t.ok){this.syncingUserMaterial.error=t,this._updateStatus(o.a.Sync2UserMaterialFailure,{errInfo:t}),e(t);return}let s=t.value;s.onSuccess(async t=>{let{md5:r}=t,i=await this._params.userMaterialService.getEvercloudInstance(this._params.toWorkspaceId);this._params.handler.updateModel({md5:r});let s=await i.getAssets({md5s:[r],material:!1});!s&&e((0,a.wf)(-1,"not found target assets")),this._params.handler.updateModel((0,n.V)(s[0])),this._updateStatus(o.a.Synced2UserMaterial),e((0,a.ly)())}),s.onError(t=>{this.syncingUserMaterial.error=t,this._updateStatus(o.a.Sync2UserMaterialFailure,{errInfo:t}),e(t)})}catch(e){throw this.syncingUserMaterial.error=(0,a.wf)(-1,null==e?void 0:e.message),this._updateStatus(o.a.Sync2UserMaterialFailure,{errInfo:this.syncingUserMaterial.error}),e}finally{this._mutex.unLock()}})}constructor(e){this._params=e,this._mutex=new i.L}}},483197:function(e,t,r){"use strict";r.d(t,{B:function(){return _}});var i=r(789786),a=r(999268),n=r(690613),o=r(800788),s=r(775352),c=r(173888),l=r(426020),d=r(31463),u=r(848784),h=r(458906),g=r(70031);class _{get _vid(){return this._params.vid}get _updateStatus(){return this._params.handler.updateStatus}get syncingUserMaterial(){return this._syncingUserMaterial}canSync2UserMaterial(){return!0}async sync2UserMaterial(e){var t,r,i,a,s;if(!this._mutex.tryLock())return(0,n.wf)(-1,"do not call this function before it done");this._syncingUserMaterial.error=void 0,this._updateStatus(c.a.Syncing2UserMaterial);let d=(0,u.c)(1e4,{onprogress:e=>{this._syncingUserMaterial&&(this._syncingUserMaterial.progress=e,this._params.handler.onProgress(e))}});try{let s=this._params.userMaterialService.getBaseEvercloud(),d=this._params.handler.model(),u=await s.syncVideoToEverCloud(this._vid,{fileSize:null!==(i=d.size)&&void 0!==i?i:0,resouceType:this._fileTypeToSyncResourceType(d.fileType),imageAsyncResize:!0,folderId:null!==(a=this._params.toFolderId)&&void 0!==a?a:l.ZF,invisible:null==e?void 0:e.invisible,noTranscode:null==e?void 0:e.noTranscode,noOccupy:null==e?void 0:e.noOccupy}),h=await u.done();if(h.errInfo)return this._syncingUserMaterial.error=(0,n.wf)(-1,"unknown"),this._reportService.reportDevError("sync-material-from-public",this._syncingUserMaterial.error),this._updateStatus(c.a.Sync2UserMaterialFailure,{errInfo:this._syncingUserMaterial.error}),h;let{entryId:g,assetId:_}=h.data,p=g||_;this._params.handler.updateModel({assetId:p});let f=await this._params.userMaterialService.getMaterialsByIds({workspaceId:this._params.toWorkspaceId,assetIds:[p]});(0,o.Y2)(f.ok&&(null===(t=f.value)||void 0===t?void 0:t[0]));let{key:m,...v}=null===(r=f.value)||void 0===r?void 0:r[0];return this._params.handler.updateModel({...v}),this._updateStatus(c.a.Synced2UserMaterial),(0,n.ly)()}catch(r){let e,t;try{let i=JSON.parse(r);e=null!==(s=i.code)&&void 0!==s?s:-1,t=null==i?void 0:i.message}catch{e=-1,t="string"==typeof r?r:null==r?void 0:r.message}throw this._syncingUserMaterial.error=(0,n.wf)(e||-1,null!=t?t:"sync-material-from-public-error"),this._reportService.reportDevError("sync-material-from-public",this._syncingUserMaterial.error),this._updateStatus(c.a.Sync2UserMaterialFailure,{errInfo:this._syncingUserMaterial.error}),this._handleError(e),r}finally{d(),this._mutex.unLock()}}_handleError(e){if(Number(e)===s.H9.Insufficient)(0,h.i)({payinPayoutHelper:this._params.payinPayoutHelper,payScene:g.Mm.SYNC,workspaceId:this._params.toWorkspaceId,onPaySuccess:()=>{this.sync2UserMaterial()}})}_fileTypeToSyncResourceType(e){switch(e){case l.YB.Video:return 1;case l.YB.Audio:return 2;case l.YB.Image:return 3;default:return 1}}constructor(e,t){this._params=e,this._reportService=t,this._mutex=new a.L,this._syncingUserMaterial={progress:0}}}_=(0,i.gn)([(0,i.fM)(1,d.m),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ISyncFromPublicHelper?Object:ISyncFromPublicHelper,void 0===d.m?Object:d.m])],_)},353170:function(e,t,r){"use strict";r.d(t,{$:function(){return u}});var i=r(801497),a=r(999268),n=r(690613),o=r(315401),s=r(5507),c=r(173888),l=r(458906),d=r(70031);class u{get _updateStatus(){return this._handler.updateStatus}get _updateModel(){return this._handler.updateModel}get _delete(){return this._handler.delete}get _notificationService(){return this._params.notificationService}get uploading(){return this._uploading}bootstrap(e){Object.entries(e.events).forEach(e=>{let[t,r]=e;this._uploading[t]=r}),this._handler=e.handler,this._updateStatus(c.a.Uploading)}updateFromWorkspaceId(e){if(this._fromWorkspaceId!==e)(()=>{this._uploadTaskId&&this._params.thirdpartyUploader.setSpaceId(e),this._updatedAssetId=void 0,this._mutex=new a.L,this._handler.updateStatus(c.a.WaitingUpload)})(),this._fromWorkspaceId=e,this.upload()}canRetryUpload(){return!!(this._handler.status()===c.a.UploadFailure&&!this._canCancelSignal)}async upload(){if(this._handler.status()!==c.a.Uploading){if(this._uploading.error=void 0,this._updateStatus(c.a.Uploading),this._updatedAssetId){await this._tryFetchUserMaterialAndUpdate(this._updatedAssetId),this._mutex.unLock();return}this._params.thirdpartyUploader.retryUpload(this._params.taskId)}}canCancelUpload(){return this._canCancelSignal}async cancelUpload(){var e,t;this._uploadTaskId&&await this._params.thirdpartyUploader.cancelUpload(this._uploadTaskId),null===(e=(t=this._handler).onCancelUpload)||void 0===e||e.call(t),this.dispose()}dispose(){this._uploadTaskId=void 0,this._disposer.forEach(e=>e.dispose()),this._params=null}async _tryFetchUserMaterialAndUpdate(e){let t=await this._params.userMaterialService.getMaterialsByIds({workspaceId:this._fromWorkspaceId,assetIds:[e],fetchMode:o.$d.WaitForSync});if(!t.ok){let e=(0,n.wf)(-1,"fetch user material failure");this._uploading.error=e,this._updateStatus(c.a.UploadFailure,{errInfo:e});return}this._updateModel(t.value[0]),this._updateStatus(c.a.Uploaded)}_doWithNotInsufficientSpaceUpload(e){this._params.payinPayoutHelper&&(0,l.i)({payinPayoutHelper:this._params.payinPayoutHelper,payScene:d.Mm.UPLOAD,workspaceId:e,onPaySuccess:()=>{this.upload()}})}constructor(e){this._params=e,this._mutex=new a.L,this._canCancelSignal=!0,this._disposer=[],this._fromWorkspaceId=this._params.fromWorkspaceId,this._uploading={supportPreview:!1,isSupportFastImport:!1,blobUrl:void 0,progress:0},this._disposer.push(this._params.thirdpartyUploader.onProgressChange((e,t)=>{if(e===this._params.taskId)this._updateStatus(c.a.Uploading),this.uploading.progress=t,this._handler.onProgress(t)})),this._disposer.push(this._params.thirdpartyUploader.onFailure((e,t)=>{if(e===this._params.taskId){switch(t.code){case s.r.Insufficient:this._doWithNotInsufficientSpaceUpload(this._fromWorkspaceId);break;case s.r.Cancel:this._delete(),this.dispose();break;case s.r.Unknown:default:var r;null===(r=this._notificationService)||void 0===r||r.error(i.ZP.t("upload_failed",{},"upload failed"))}this._uploading.error=t,this._updateStatus(c.a.UploadFailure,{errInfo:t})}})),this._disposer.push(this._params.thirdpartyUploader.onSuccess(async e=>{if(e.id===this._params.taskId)this._canCancelSignal=!1,this._updatedAssetId=e.fileId,await this._tryFetchUserMaterialAndUpdate(this._updatedAssetId)}))}}},599735:function(e,t,r){"use strict";r.d(t,{s:function(){return function e(t,r){let{addToUserGenerated:_,notificationService:p}=(0,h.Z)({},{addToUserGenerated:!0,notificationService:(0,u.O)(t)},r);return r=>t.invokeFunction(async u=>{let h=u.get(i.D),f=u.get(g.v),m=u.get(o.b);(0,n.ZB)(r.md5);let v=r.getModel();if(f.draftWorkspaceManager.workspaceId&&r.fromWorkspaceId&&v.status===s.a.Success&&v.sourceType===c.ov.EverCloud){let e=await m.getMaterialsByIds({workspaceId:r.fromWorkspaceId,assetIds:[v.assetId]});if(!e.ok){if("not found all assets"===e.msg){var y;null==p||null===(y=p.error)||void 0===y||y.call(p,l.ZP.t("web_editor_addmaterial_deleted",{},"The material has been deleted."))}return e}}return!h.isMaterialExistInUserGeneratedByMd5(r.md5)&&f.draftWorkspaceManager.workspaceId&&(r.updateToWorkspaceId(f.draftWorkspaceManager.workspaceId),_?h.addToUserGenerated(t.createInstance(d.P,{lifecycle:r,isListenOriginDeleted:!1,addModelToDraft:e(t,{addToUserGenerated:_,notificationService:p}),notificationService:p})):h.addToAutoGenerated(t.createInstance(d.P,{lifecycle:r,isListenOriginDeleted:!1,addModelToDraft:e(t,{addToUserGenerated:_,notificationService:p}),notificationService:p}))),(0,a.ly)()})}}});var i=r(948328),a=r(690613),n=r(800788),o=r(273238),s=r(173888),c=r(426020),l=r(801497),d=r(745403),u=r(339098),h=r(824547),g=r(936243)},951149:function(e,t,r){"use strict";r.d(t,{J:function(){return n}});var i=r(195471);class a{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="vip_right_details"}}function n(e,t){(0,i.K)(e,a,[t])}},254336:function(e,t,r){"use strict";r.d(t,{CF:function(){return f},O9:function(){return h},V$:function(){return d},cg:function(){return p},cn:function(){return g},jm:function(){return u},oH:function(){return _}});var i,a,n,o,s,c,l,d=((i={}).VIDEO="video",i.IMAGE="image",i.AUDIO="audio",i.FILE="file",i);var u=((a={}).CLICK_ADD="click_add",a.DRAG_TO_PANEL="drag_to_panel",a.SHORT_KEY="shortkey",a.DRAG_TO_CANVAS="drag_to_canvas",a.PASTE="paste",a.DRAG_TO_TRACK="drag_to_track",a.CLICK_COMPONENT="click_component",a.TTLIVE_AUTHORIZE="ttlive_authorize",a.SHOPIFY_AUTHORIZE="shopify_authorize",a.GOOGLE_DRIVE_AUTHORIZE="gd_authorize",a.DROPBOX_AUTHORIZE="dropbox_authorize",a.VOICE_EFFECT="voice_effect",a.THIRDPARTY_PLUGIN_API="thirdparty_plugin_api",a);var h=((n={}).LOCAL="local",n.GOOGLE_DRIVE="google_drive",n.MY_SPACE="my_space",n.SHOPIFY="shopify",n.LINK="link",n.DROP_BOX="dropbox",n.STOCK_VIDEOS="stock_videos",n.EXTRA_AUDIO="extra_audio",n.TTLIVE="ttlive",n.MURF="murf",n.Assets="assets",n);var g=((o={}).EDIT="edit",o.PHOTO_EDIT="photoedit",o.TEMPLATE="template",o.OTHER="other",o);var _=((s={}).EDITOR="editor",s.PHOTO_EDITOR="photoeditor",s.TEMPLATE="template",s.WORKBENCH="workbench",s.TOOL="tool",s);var p=((c={}).MATERIAL_LIB="material_lib",c.MATERIAL="material",c.TRACK="track",c.DROP_DOWN="drop_down",c.CANVAS="canvas",c.PHONE_UPLOAD="phone_upload",c.BROWSER_OUTSIDE="browser_outside",c.COVER_EDIT="cover_edit",c.TTLIVE="ttlive",c.ADD_OVERLAY="add_overlay",c.REPLACE_MEDIA="replace_media",c.WATCH_AND_CUT="watch_and_cut",c.SLOTS="slots",c.THIRDPARTY_PLUGIN="thirdparty_plugin",c);var f=((l={}).SUCCESS="success",l.FAIL="fail",l.CANCEL="cancel",l)},358132:function(e,t,r){"use strict";r.d(t,{q:function(){return _}});var i=r(789786),a=r(274559),n=r(21961),o=r(426020),s=r(966697),c=r(127830),l=r(948328),d=r(641276),u=r(587892),h=r(800788),g=r(115618);class _ extends a.Z{async deleteFolderById(e){await super.asyncPostorderTraversal(e,async t=>{t.id!==e&&(t.type===n.t.Folder?await this.deleteFolderById(t.id):t.type===n.t.File&&await this.deleteFileById(t.id))}),super.deleteFolderById(e)}async deleteFileById(e){let t=this.getFileById(e);if((0,h.ZB)(t),(0,g.F)(t.data.status)){t.data.canCancelUpload()&&t.data.cancelUpload(),super.deleteFileById(e);return}await t.data.delete(),this._draftMaterialsService.removeFromUserGenerated(e),super.deleteFileById(e)}print(){super.print({formatter:e=>{var t;return null!==(t=e.type===n.t.Folder?e.data.filename:e.data.getModel().filename)&&void 0!==t?t:""}})}_filterMaterial(e){var t,r;return e.fileType!==o.YB.File||!(null===(r=e.draftDelta)||void 0===r?void 0:null===(t=r.meta)||void 0===t?void 0:t.visible)}_bootstrap(){let e=()=>{let e=this._draftMaterialsService.getMaterials().userGeneratedMaterials.filter(this._filterMaterial);this.isInitialize=!0,this._onDidInitialized.fire(),e.forEach(e=>{e.assetType===c.pS.Material?this._draftMaterialsService.invokeFunctionWithLifeCycleById(e.id,e=>{this.addFileToCurrentPath(e.id,e)}):this.addFolderToCurrentPath(e.assetId,e)}),this._listenDraftMaterialsServiceAdd()};this._draftMaterialsService.isReady?e():(0,d.V)(this._draftMaterialsService.onDidReady)(()=>{e()})}_listenDraftMaterialsServiceAdd(){this._draftMaterialsService.onDidMaterialAdd(e=>{let t=this._draftMaterialsService.getMaterials().userGeneratedMaterials.map(e=>e.id);e.forEach(e=>{if(!t.includes(e))return;let r=this._draftMaterialsService.getMaterialById(e);if(!(!this._filterMaterial(r)||this.nodesInCurrentPath.find(t=>t.type===n.t.File&&t.id===e)))this._draftMaterialsService.invokeFunctionWithLifeCycleById(e,e=>{if(e.fromFolderId&&!this._capcutAccountService.hasLogin){let t=this.getFolderById(e.fromFolderId),r=null==t?void 0:t.path;(0,h.ZB)(r),this.createFileByPath(this.formatPathFromArray([r,e.id]),e,{insertPosition:n.O.Beginning})}else this.createFileByPath(this.formatPathFromArray([this.root.path,e.id]),e,{insertPosition:n.O.Beginning})})})})}constructor(e,t,r){super(e),this._draftMaterialsService=t,this._capcutAccountService=r,this._onDidInitialized=this._store.add(new u.Q),this.isInitialize=!1,this.onDidInitialized=this._onDidInitialized.event,this._bootstrap()}}_=(0,i.gn)([(0,i.fM)(1,l.D),(0,i.fM)(2,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IDraftDirectoryManagerOptions?Object:IDraftDirectoryManagerOptions,void 0===l.D?Object:l.D,void 0===s.Gw?Object:s.Gw])],_)},186521:function(e,t,r){"use strict";r.d(t,{R:function(){return o}});var i=r(260963),a=r(908503),n=r(980867);class o{get tasks(){return this._observableData.list}addMaterialLifecycle(e){(0,i.z)(()=>{this._observableData.list.unshift((0,n.M)(e.material.getModel()))}),(0,a.M)({material:e.material,onUpdateModel:e=>this._updateMaterialModeByModel(e),onDeleteLifecycle:e=>this._deleteMaterialModel(e)})}_updateMaterialModeByModel(e){(0,i.z)(()=>{let t=this._observableData.list.findIndex(t=>t.id===e.id);-1!==t&&(this._observableData.list[t]=(0,n.M)(e))})}_deleteMaterialModel(e){(0,i.z)(()=>{let t=this._observableData.list.findIndex(t=>t.id===e);-1!==t&&this._observableData.list.splice(t,1)})}constructor(){this._observableData=(0,i.LO)({list:[]})}}},309180:function(e,t,r){"use strict";r.d(t,{d:function(){return d}});var i=r(789786),a=r(572029),n=r(110608),o=r(782350),s=r(966697),c=r(622204),l=r(801497);class d extends c.j{fetchData(e){return this._fontDataService.getBrandFonts(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return l.ZP.t("web_space_brandkit_editor_brand_font",{},"Fonts")}constructor(e,t,r,i,a){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;super(i,a,n,o),this._brandDataService=t,this._fontDataService=r,this._workspaceService=i,this._capcutAccountService=a,this.setInitialData(null==o?void 0:o.list,s)}}d=(0,i.gn)([(0,i.fM)(1,a.X),(0,i.fM)(2,n.H),(0,i.fM)(3,o.W),(0,i.fM)(4,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===a.X?Object:a.X,void 0===n.H?Object:n.H,void 0===o.W?Object:o.W,void 0===s.Gw?Object:s.Gw])],d)},151394:function(e,t,r){"use strict";r.d(t,{C:function(){return u}});var i=r(789786),a=r(572029),n=r(892292),o=r(782350),s=r(966697),c=r(801497),l=r(622204),d=r(752048);class u extends l.j{fetchData(e){return this._stickerDataService.getBrandStickers(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return c.ZP.t("web_space_brandkit_editor_brand_sticker",{},"Stickers")}constructor(e,t,r,i,a){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;(null==o?void 0:o.list)&&(o.list=(0,d.B)(o.list)),super(i,a,n,o),this._brandDataService=t,this._stickerDataService=r,this._workspaceService=i,this._capcutAccountService=a,this.setInitialData(null==o?void 0:o.list,s)}}u=(0,i.gn)([(0,i.fM)(1,a.X),(0,i.fM)(2,n.c),(0,i.fM)(3,o.W),(0,i.fM)(4,s.Gw),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===a.X?Object:a.X,void 0===n.c?Object:n.c,void 0===o.W?Object:o.W,void 0===s.Gw?Object:s.Gw])],u)},402093:function(e,t,r){"use strict";r.d(t,{S:function(){return l}});var i=r(789786),a=r(800788),n=r(782350),o=r(200247),s=r(260963);let c="last-brand-workspace-id";class l{get currentWorkspaceId(){return this.observableData.currentWorkspaceId}get currentWorkspace(){if(!!this.currentWorkspaceId)return this.observableData.workspaceList.find(e=>e.workspace_id===this.currentWorkspaceId)}get workspaceList(){return this.observableData.workspaceList}get initiated(){return!!this.observableData.workspaceList.length}selectWorkspaceId(e){let t=this.observableData.workspaceList.find(t=>t.workspace_id===e);(0,a.Y2)(t,"unexpected selected"),(0,s.z)(()=>{this.observableData.currentWorkspaceId=e,this._setLocalWorkspaceId(e)})}_setLocalWorkspaceId(e){let{uid:t}=this._accountService.userProfile;window.localStorage.setItem(`${c}_${t}`,e)}_listenWorkspaceListChange(){let e=()=>{(0,s.z)(()=>{this.observableData.workspaceList=this._workspaceService.workspaceList,this.observableData.workspaceList.length&&this._revisionCurrentWorkspaceId()})};this._workspaceService.available&&e(),this._workspaceService.onDidWorkspaceChange(()=>{e()})}_initWorkSpaceId(){let e=()=>{var e,t,r,i;let{uid:a}=this._accountService.userProfile;this.observableData.currentWorkspaceId=null!==(i=null===(t=window)||void 0===t?void 0:null===(e=t.localStorage)||void 0===e?void 0:e.getItem(`${c}_${a}`))&&void 0!==i?i:null===(r=this.observableData.workspaceList[0])||void 0===r?void 0:r.workspace_id};this._accountService.onDidLogin(()=>{(0,s.z)(()=>{e()})}),e()}_revisionCurrentWorkspaceId(){if(!this.observableData.workspaceList.find(e=>e.workspace_id===this.observableData.currentWorkspaceId))(0,s.z)(()=>{this.observableData.currentWorkspaceId=this._workspaceService.workspaceList[0].workspace_id})}constructor(e,t){this._workspaceService=e,this._accountService=t,this.observableData=(0,s.LO)({currentWorkspaceId:void 0,workspaceList:[]}),this._listenWorkspaceListChange(),this._initWorkSpaceId()}}l=(0,i.gn)([(0,i.fM)(0,n.W),(0,i.fM)(1,o.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.W?Object:n.W,void 0===o.D?Object:o.D])],l)},263757:function(e,t,r){"use strict";r.d(t,{Zw:function(){return d},pN:function(){return g}});var i=r(998498),a=r.n(i),n=r(589140),o=r(702049),s=r(528426);let c=()=>`${Date.now().valueOf()}${Math.floor(1e5*Math.random())}`,l=e=>a()(`${n.VY+n.mx+e}f8a69f1719916z`).toLowerCase(),d=()=>{let e=sessionStorage.getItem("device_id")?sessionStorage.getItem("device_id"):c();return sessionStorage.setItem("device_id",null!=e?e:""),e},u=e=>0===e.indexOf("wss://frontier-va.capcut.com")&&(0,s.hN)()?e.replace("wss://frontier-va.capcut.com","wss://frontier-va-us-looki.capcut.com"):e,h=(e,t)=>0===e.indexOf("wss://frontier-va.capcut.com")&&(0,s.hN)()?{...t,looki_pseudonym_uid:"1"}:t,g=(e,t)=>{let r=d();return{fpID:n.VY,aID:n.it,appKey:n.mx,accessKey:l(r),deviceID:r,debug:o.JA,url:u(e),enableTransformTextPayload:!0,customParams:h(e,t)}}},354309:function(e,t,r){"use strict";r.d(t,{i:function(){return u}});var i=r(697641),a=r(639605),n=r(587892),o=r(402655),s=r(690613),c=r(702049),l=r(589140),d=r(263757);class u extends o.JT{getState(){return this._state}_handleClose(e){this._state=a.de.DISCONNECTED,this._onClose.fire(e)}_handleError(e){this._onError.fire(e)}_handleOpen(e){this._state=a.de.OPEN,this._onOpen.fire(e)}_handleMessage(e){let{method:t,textPayload:r}=e.message,i=this._callbackMap[t];if(!!i)try{let e=JSON.parse(r);if("0"!==e.ret){let t=(0,s.wf)(Number(e.ret),e.errmsg);i.forEach(e=>e(t));return}let t=(0,s.oW)(e.data);i.forEach(e=>e(t))}catch(t){let e=(0,s.Mx)(-1,"handle message error",t);i.forEach(t=>t(e))}}_updateIds(e){let{draftId:t,uid:r,workspaceId:i}=e;this._draftId=null!=t?t:this._draftId,this._uid=null!=r?r:this._uid,this._workspaceId=null!=i?i:this._workspaceId}connect(e){var t;if(!(e.draftId&&e.uid&&e.workspaceId))return(0,s.wf)(-1,"draftId,uid,workspaceId required");if(this._draftId===e.draftId&&this._uid===e.uid&&this._workspaceId===e.workspaceId)return(0,s.ly)();this._updateIds(e),this.close();let r=c._L.getVar("frontier_domain"),n=(0,d.pN)(null!==(t=null==e?void 0:e.frontierDomain)&&void 0!==t?t:r,{workspace_id:this._workspaceId,file_id:this._draftId});this._state=a.de.CONNECTING;let o=new i.FWS(n);return o.addEventListener("close",this._handleClose.bind(this)),o.addEventListener("message",this._handleMessage.bind(this)),o.addEventListener("error",this._handleError.bind(this)),o.addEventListener("open",this._handleOpen.bind(this)),this._websocketInstance=o,(0,s.ly)()}sendMessage(e){var t;let r=JSON.stringify(e);null===(t=this._websocketInstance)||void 0===t||t.send(r,{method:l.NZ,service:l.N3})}close(){var e;null===(e=this._websocketInstance)||void 0===e||e.close()}getDeviceId(){return(0,d.Zw)()}registerCallback(e,t){let r=this._callbackMap[e];if(!r){this._callbackMap[e]=[t];return}r.push(t)}unregisterCallback(e,t){var r;this._callbackMap[e]=null===(r=this._callbackMap[e])||void 0===r?void 0:r.filter(e=>e!==t)}constructor(...e){super(...e),this._state=a.de.DISCONNECTED,this._onClose=this._store.add(new n.Q),this.onClose=this._onClose.event,this._onError=this._store.add(new n.Q),this.onError=this._onError.event,this._onOpen=this._store.add(new n.Q),this.onOpen=this._onOpen.event,this._callbackMap={}}}},622969:function(e,t,r){"use strict";r.d(t,{c:function(){return a}});var i,a=((i={}).NotAdd="notAdd",i.None="none",i.DeleteExistFromCache="deleteExistFromCache",i.DeleteExistFromCloud="deleteExistFromCloud",i)},317832:function(e,t,r){"use strict";r.d(t,{V:function(){return i}});let i=(0,r(335290).yh)("workspace-directory-service")},434397:function(e,t,r){"use strict";r.d(t,{y:function(){return c}});var i=r(772322),a=r(105789),n=r.n(a),o=r(472334),s=r(185628);let c=e=>{let{containerWidth:t}=e;return(0,i.jsx)("div",{className:n()(s.Z.entryContainer),children:(0,i.jsx)("div",{className:n()(s.Z.viewBox,{[s.Z.initializing]:!0}),children:(0,i.jsx)(o.ZP,{isLoading:!0,skeletonWidth:t,skeletons:["bar","tags","small-bar","masonry-list"]})})})}},69226:function(e,t,r){"use strict";r.d(t,{Y9:function(){return h},jv:function(){return u},y_:function(){return g}});var i=r(772322);r(701840);var a=r(794571),n=r(729099),o=r(472334),s=r(739921),c=r(105789),l=r.n(c),d=r(671910);let u=e=>{let{width:t,height:r}=e;return(0,i.jsx)(n.fi,{width:t,height:r})},h=e=>{let{className:t,numTypes:r,itemWidth:a=d.v8.width,itemHeight:n=d.v8.height}=e;return(0,i.jsx)("div",{className:l()(s.Z["rows-skeleton-container"],t),children:Array(r).fill(0).map((e,t)=>(0,i.jsx)(o.ZP,{isLoading:!0,skeletonWidth:a,skeletons:["poly-cate-with-label-custom"],itemWidth:a,itemHeight:n},t))})},g=e=>{let{numTypes:t,containerWidth:r}=e;return(0,i.jsxs)("div",{className:l()(s.Z["brand-panel-skeleton"],s.Z["panel-container"]),children:[(0,i.jsx)(o.ZP,{className:s.Z["brand-panel-header-skeleton"],skeletonWidth:r,isLoading:!0,skeletons:["bar"]}),(0,i.jsx)(a.Z,{className:s.Z["brand-panel-skeleton-divider"]}),(0,i.jsx)(o.ZP,{skeletonWidth:r,isLoading:!0,skeletons:["bar"]}),(0,i.jsx)(h,{numTypes:t})]})}},458906:function(e,t,r){"use strict";r.d(t,{T:function(){return o},i:function(){return s}});var i=r(70031);let a=e=>{let{payinPayoutHelper:t,workspaceId:r,reporterParams:i,payScene:a,onOk:n,onCancel:o}=e;t.addListenNotEnoughModalOK(n),t.addListenNotEnoughModalCancel(o),t.showSpaceNotEnoughModal({workspaceId:r,payScene:a,reporterParams:i})},n=e=>{let{payinPayoutHelper:t,workspaceId:r,payScene:i,uploadFileList:a=[],onOk:n,onCancel:o}=e;t.addListenNotEnoughModalOK(n),t.addListenNotEnoughModalCancel(o),t.showPayUploadFullSpaceModal({workspaceId:r,payScene:i,uploadFileList:a})},o=e=>{let{payinPayoutHelper:t,workspaceId:r,payScene:i,pageFrom:a,isUpgrade:n,onPaySuccess:o,onPayFailed:s,reporterParams:c}=e;t.addListenPaySuccess(o),t.addListenPayFailed(s),t.showExpandModal({workspaceId:r,payScene:i,pageFrom:a,isUpgrade:n,reporterParams:c})},s=e=>{let{payinPayoutHelper:t,workspaceId:r,payScene:o,uploadFileList:s,reporterParams:c,onOk:l,onCancel:d,onPaySuccess:u,onPayFailed:h}=e;if(t.addListenPaySuccess(u),t.addListenPayFailed(h),!0==!!(o===i.Mm.UPLOAD&&(null==s?void 0:s.length)))n({payinPayoutHelper:t,workspaceId:r,payScene:o,uploadFileList:s,reporterParams:c,onOk:()=>{null==l||l(),t.triggerOnNotEnoughModalOK({workspaceId:r,payScene:o})},onCancel:()=>{null==d||d(),t.triggerOnNotEnoughModalCancel({workspaceId:r,payScene:o})}});else a({payinPayoutHelper:t,workspaceId:r,payScene:o,reporterParams:c,onOk:()=>{null==l||l(),t.triggerOnNotEnoughModalOK({workspaceId:r,payScene:o})},onCancel:()=>{null==d||d(),t.triggerOnNotEnoughModalCancel({workspaceId:r,payScene:o})}})}},50712:function(e,t,r){"use strict";r.d(t,{u:function(){return s}});var i=r(456518),a=r(690613),n=r(800788);class o{async makeCoverByBuffer(e,t,r){let i=URL.createObjectURL(new Blob([new Uint8Array(e)])),a=await this.makeCoverByUrl(i,t,r);try{return a}finally{URL.revokeObjectURL(i)}}async makeCoverByUrl(e,t,r){let n=this._getCtx(t,r),o=await (0,i.L)(e);if(!o.ok)return o;let s=o.value,c=t/r,l=s.width/s.height,d=0,u=0,h=t,g=r;return c<l?(d=0,h=t,u=(r-(g=t*s.height/s.width))/2):c>l&&(u=0,g=r,d=(t-(h=r*s.width/s.height))/2),n.fillStyle="#000000",n.fillRect(0,0,t,r),n.drawImage(s,0,0,s.width,s.height,d,u,h,g),(0,a.oW)(this._canvas.toDataURL("image/jpeg",.5))}_getCtx(e,t){return this._canvas.width=e,this._canvas.height=t,this._canvas.getContext("2d")}get _canvas(){return!o._canvas&&(o._canvas=document.createElement("canvas")),o._canvas}}async function s(e){let t=new o;if(e.buffer){let r=await t.makeCoverByBuffer(e.buffer,e.width,e.height);return r.ok?(console.log("[saving] make cover success."),r.value):(console.error("[saving] make cover error."),"")}if(e.url){let r=await t.makeCoverByUrl(e.url,e.width,e.height);return r.ok?(console.log("[saving] make cover success."),r.value):(console.error("[saving] make cover error."),"")}(0,n.ss)()}},301867:function(e,t,r){"use strict";r.d(t,{v:function(){return s}});var i=r(789786),a=r(402655),n=r(230689),o=r(670863);class s extends a.JT{async getFirstFrameUrl(e){this._lastFirstFrameTask&&this._lastFirstFrameTask.cancelFirstFrameTask();let t=this._containerService.createInstance(o.u,this._dataSdk,480,e);this._lastFirstFrameTask=t;let r=await t.generateFirstFrameUrl();return this._lastFirstFrameTask=null,r}constructor(e,t){super(),this._dataSdk=e,this._containerService=t,this._lastFirstFrameTask=null}}s=(0,i.gn)([(0,i.fM)(1,n.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===n.t?Object:n.t])],s)},806731:function(e,t,r){"use strict";r.d(t,{J:function(){return a}});var i=r(426336);function a(e){var t,r,a,n,o,s,c,l,d,u,h,g,_,p;let f,m,v,y,S;let b={tracks:[],materials:{}};try{b=i.HHr.parse(e)}catch(e){return null}let{tracks:M,materials:k}=b,T={},I={},w={};for(let e of M){let i=null!==(t=e.type)&&void 0!==t?t:"";for(let t of null!==(r=e.segments)&&void 0!==r?r:[]){let e=t.id;if(!e)continue;let r=t.material_id;if(r)for(let i of(I[r]=e,null!==(o=t.extra_material_refs)&&void 0!==o?o:[]))I[i]=e;let u=BigInt(null!==(s=null===(a=t.target_timerange)||void 0===a?void 0:a.start)&&void 0!==s?s:0),h=BigInt(null!==(c=null===(n=t.target_timerange)||void 0===n?void 0:n.duration)&&void 0!==c?c:0),g=null!==(d=null!==(l=t.track_render_index)&&void 0!==l?l:t.render_index)&&void 0!==d?d:0;T[e]={id:e,start:u,duration:h,renderIndex:g,trackType:i}}}for(let e of null!==(u=k.text_templates)&&void 0!==u?u:[]){let t=I[null!==(h=e.id)&&void 0!==h?h:""];if(!!t)for(let r of null!==(g=e.text_info_resources)&&void 0!==g?g:[])r.text_material_id&&(I[r.text_material_id]=t)}for(let e of null!==(_=k.texts)&&void 0!==_?_:[]){if(!!I[null!==(p=e.id)&&void 0!==p?p:""])e.font_resource_id&&(!e.font_path||0>e.font_path.indexOf("."))&&(w[e.font_resource_id]=e.id)}return{materialId2SegmentId:I,segmentsMeta:T,invalidMaterialResources:w,...(f=!1,m=!1,v=!1,y=!1,S=!1,!function e(t){let{effects:r,videos:a,drafts:n}=t;for(let e of(Array.isArray(r)&&r.some(e=>e.type===i.cVg.MetaTypeMakeupRoot)&&(S=!0),null!=a?a:[])){var o,s,c,l;(null===(s=e.matting)||void 0===s?void 0:null===(o=s.strokes)||void 0===o?void 0:o.length)>0&&(y=!0),e.object_locked&&(m=!0),(null==e?void 0:null===(c=e.matting)||void 0===c?void 0:c.flag)&&(null==e?void 0:null===(l=e.matting)||void 0===l?void 0:l.flag)>1&&(v=!0),!f&&e.extra_type_option&&e.extra_type_option&i.BKu.IsCombinationVideo&&(f=!0)}if(Array.isArray(n))for(let t of n){let{draft:r}=t;(null==r?void 0:r.materials)&&e(r.materials)}}(k),{hasSubDraft:f,hasObjectLocked:m,hasMattingBlend:v,hasMattingStroke:y,hasMakeup:S})}}},396974:function(e,t,r){"use strict";r.d(t,{b:function(){return n}});var i=r(587892),a=r(402655);class n extends a.JT{get onLoadingStatusChange(){return this._onLoadingStatusChange.event}get onSegmentLoadingStatusChange(){return this._onSegmentLoadingStatusChange.event}get isLoading(){return this._isLoading}get segmentLoadingStatusMap(){return this._segmentLoadingStatusMap}updateIsLoading(e){this._isLoading=e,this._onLoadingStatusChange.fire(e)}updateSegmentLoadingStatus(e,t){e.forEach(e=>{this._segmentLoadingStatusMap[e]=t}),this._onSegmentLoadingStatusChange.fire(e,t)}constructor(...e){super(...e),this._isLoading=!1,this._segmentLoadingStatusMap={},this._onLoadingStatusChange=this._store.add(new i.Q),this._onSegmentLoadingStatusChange=this._store.add(new i.Q)}}},961298:function(e,t,r){"use strict";r.d(t,{l:function(){return o}});var i=r(426336);function a(e,t){let{fontPaths:r,index:a}=(0,i.cwy)(e,t);return r.length>0?r[a]:null}function n(e,t){let{fontPath:r,fonts:i,content:n}=e,o={},s={content:n};if(s.content=n,null==i?void 0:i.length)s.fonts=i.map(e=>e.clone()),s.fonts.forEach(e=>{let r=a(e.path,t);if(!!r&&r!==e.path&&!o[e.path])o[e.path]=r,e.path=r});else{let e=a(r,t);if(!e||e===r)return null;o[r]=e,s.fontPath=e}let c=Object.entries(o);return c.length?(c.forEach(e=>{let[t,r]=e,i=RegExp(t,"g");s.content=s.content.replace(i,r)}),s):null}function o(e,t,r,o){let{fs:s}=t,c=e.draftView.getAllTracks(),l=e.draftView.getDraftId(),d=e.api.batch.batchStart(),u=0,h=0,g=0,_=0;try{c.forEach((t,r)=>{let{id:o,segments:c}=t;c.forEach(t=>{let{id:c}=t;switch(t.__segment_struct_type){case i.Ocy.SegmentText:{h+=1;let{material:a}=t,d=n(a,s);if(!d)return;u+=1;let g=new i.xKN;g.material=new i.edz,Object.assign(g.material,d);let _=(0,i.xXD)({__segment_struct_type:t.__segment_struct_type});i.T8X.pick(t,g,_),e.api.text.setMaterials({updates:[{draftId:l,segmentId:c,trackId:o,segmentDelta:g,sourceSegmentDelta:_,trackIndex:r}]},!1,!1);break}case i.Ocy.SegmentTextTemplate:{_+=1;let{resources:d,textInfoResources:u}=t.material,h=!1,p=new i.kph;if(p.material=new i._0h,p.material.resources=d.map(e=>e.clone()),p.material.textInfoResources=u.map(e=>e.clone()),p.material.resources.forEach(e=>{if("fonts"!==e.panel)return;let t=a(e.path,s);if(!!t&&t!==e.path)e.path=t,h=!0}),p.material.textInfoResources.forEach(e=>{let t=e.textMaterial,r=n(t,s);if(!!r)Object.assign(t,r),h=!0}),h){let a=(0,i.xXD)({__segment_struct_type:t.__segment_struct_type});i.T8X.pick(t,p,a),g+=1,e.api.textTemplate.setMaterial({updates:[{draftId:l,segmentId:c,trackId:o,segmentDelta:p,sourceSegmentDelta:a,trackIndex:r}]},!1,!1)}break}default:return}})})}catch(e){throw e}finally{e.api.batch.batchEnd(d,{canUndoRedo:!1,clearRedoStack:!1,isRecovery:!0})}r.reportDevEvent("font_path_fix_count",{textSegmentFixCount:u,textTemplateSegmentFixCount:g,textSegmentCount:h,textTemplateSegmentCount:_,totalFontFixCount:u+g,totalFontRelatedSegmentCount:h+_,isDraftUpdate:o?"true":"false"})}},697667:function(e,t,r){"use strict";r.d(t,{Ow:function(){return s},Wk:function(){return i},ZK:function(){return o}});let i={topLeft:"point-top-left",topRight:"point-top-right",bottomLeft:"point-bottom-left",bottomRight:"point-bottom-right",left:"point-left",right:"point-right"};var a,n,o=((a={}).Select="select",a.Edit="edit",a.Delete="delete",a.Move="move",a.Rotate="rotate",a.Scale="scale",a.Stretch="stretch",a);var s=((n={}).normal="normal",n.symmetric="symmetric",n)},80539:function(e,t,r){"use strict";r.d(t,{Q:function(){return a}});var i,a=((i={}).Light="light",i.Dark="dark",i)},557598:function(e,t,r){"use strict";r.d(t,{Q8:()=>p,MF:()=>f,ZP:()=>v,d_:()=>m});var i=r("772322");r("17435"),r("35867");var a=r("629913"),n=r("113152"),o=r("218571"),s=r("105789"),c=r.n(s),l=r("426336"),d=r("801497"),u=r("687730"),h=r("150564"),g=r("537783");let _="var(--lvv-color-text-tertiary)",p={[l.rxY.CanvasRatioCustom]:()=>(0,i.jsx)(h.TWD,{className:"ratio-select-icon-customsize",size:20}),[l.rxY.CanvasRatioOriginal]:()=>(0,i.jsx)(h.V$o,{size:20,color:_}),[l.rxY.CanvasRatio16To9]:()=>(0,i.jsx)(h.DjO,{size:20,color:_}),[l.rxY.CanvasRatio4To3]:()=>(0,i.jsx)(h.wdj,{size:20,color:_}),[l.rxY.CanvasRatio2To1]:()=>(0,i.jsx)(h.$wh,{size:20,color:_}),[l.rxY.CanvasRatio9To16]:()=>(0,i.jsx)(h.YtH,{size:20,color:_}),[l.rxY.CanvasRatio1To1]:()=>(0,i.jsx)(h.MDd,{size:20,color:_}),[l.rxY.CanvasRatio3To4]:()=>(0,i.jsx)(h.$4_,{size:20,color:_}),[l.rxY.CanvasRatio4To5]:()=>(0,i.jsx)(h.qgg,{size:20,color:_})},f={[l.rxY.CanvasRatio16To9]:()=>(0,i.jsx)(h.WZs,{size:20}),[l.rxY.CanvasRatio4To3]:()=>(0,i.jsx)(h.Wp0,{size:20}),[l.rxY.CanvasRatio2To1]:()=>(0,i.jsx)(h.EPn,{size:20}),[l.rxY.CanvasRatio9To16]:()=>(0,i.jsx)(h.QmX,{size:20}),[l.rxY.CanvasRatio1To1]:()=>(0,i.jsx)(h.ArD,{size:20}),[l.rxY.CanvasRatio3To4]:()=>(0,i.jsx)(h.ZjU,{size:20}),[l.rxY.CanvasRatio4To5]:()=>(0,i.jsx)(h.Fnp,{size:20})},m={[l.rxY.CanvasRatio16To9]:()=>{let{i18n:e}=(0,g.$)();return(0,i.jsx)(i.Fragment,{children:e.t("web_materialSearch_text_youtube_ads",{},"YouTube ads")})},[l.rxY.CanvasRatio4To3]:()=>{let{i18n:e}=(0,g.$)();return(0,i.jsx)(i.Fragment,{children:e.t("web_materialSearch_text_linkedin_facebook",{},"LinkedIn ads, Facebook videos")})},[l.rxY.CanvasRatio9To16]:()=>{let{i18n:e}=(0,g.$)();return(0,i.jsx)(i.Fragment,{children:e.t("web_materialSearch_text_tiktok_instagram",{},"TikTok, TikTok ads, Instagram stories")})},[l.rxY.CanvasRatio1To1]:()=>{let{i18n:e}=(0,g.$)();return(0,i.jsx)(i.Fragment,{children:e.t("web_materialSearch_text_instagram_posts",{},"Instagram posts")})}},v=(0,o.memo)(e=>{let{ratio:t,visible:r,ratioOptions:s,disabled:h,onRatioChange:g,onVisibleChange:_,triggerProps:f,triggerElement:v,dropdownMenuClassName:y,isReverseGroup:S}=e,[b,M]=(0,o.useState)(!1),k=null!=r?r:b,T=(0,o.useMemo)(()=>null!=s?s:u.j9.map(e=>({...e,icon:p[e.value],extra:m[e.value]})),s),I=T.filter(e=>-1===e.width),w=T.filter(e=>-1!==e.width&&e.width>e.height),P=T.filter(e=>-1!==e.width&&e.width<=e.height),x=S?[I,P,w]:[I,w,P],C=(0,o.useMemo)(()=>null!=f?f:{autoAlignPopupWidth:!1,position:"right",popupAlign:{right:[10,64]},className:"canvas-radio-popup-wrapper"},[f]);return(0,i.jsx)(n.Z,{value:t.value,popupVisible:k,disabled:h,dropdownMenuClassName:c()("canvas-ratio-dropdown",y),triggerElement:null!=v?v:(0,i.jsxs)("div",{className:c()("canvas-ratio-select",{disabled:h,finalVisible:k}),children:[(0,i.jsx)("div",{className:"canvas-ratio-icon",children:(()=>{var e;let r=null===(e=x.flat().find(e=>e.value===t.value))||void 0===e?void 0:e.icon;return r?(0,i.jsx)(r,{}):""})()}),(0,i.jsx)("div",{className:"canvas-ratio-font","data-ssr-i18n-key":"web_track_export_title_aspect_ratio","data-ssr-i18n-value":d.oc.t("web_track_export_title_aspect_ratio"),children:t.value===l.rxY.CanvasRatioOriginal?d.oc.t("web_track_export_title_aspect_ratio",{},"Ratio"):t.name})]}),triggerProps:C,onVisibleChange:null!=_?_:M,onChange:g,children:x.map((e,t)=>(0,i.jsx)(n.Z.OptGroup,{children:e.map(e=>{let{name:t,value:r,extra:o,icon:s}=e,c=o?(0,i.jsx)(o,{}):"";return(0,i.jsx)(n.Z.Option,{value:r,children:(0,i.jsxs)("div",{className:"ratio-box",children:[(0,i.jsx)(s,{}),(0,i.jsxs)("div",{className:"ratio-text",children:[(0,i.jsx)(a.Z,{position:"bottom",content:t,checkOverflow:!0,children:(0,i.jsx)("p",{className:"ratio-title",children:t})}),""!==c&&(0,i.jsx)(a.Z,{position:"bottom",content:c,checkOverflow:!0,children:(0,i.jsx)("p",{className:"ratio-desc",children:c})})]})]})},r)})},`group-${t}`))})})},960832:function(e,t,r){"use strict";r.d(t,{e:function(){return c}});var i=r(772322),a=r(105789),n=r.n(a),o=r(472334),s=r(925022);let c=e=>{let{containerWidth:t}=e;return(0,i.jsx)("div",{className:n()(s.Z.entryContainer),children:(0,i.jsx)("div",{className:n()(s.Z.viewBox,{[s.Z.initializing]:!0}),children:(0,i.jsx)(o.ZP,{isLoading:!0,skeletonWidth:t,skeletons:["bar","tags","small-bar","masonry-list"]})})})}},768261:function(e,t,r){"use strict";r.d(t,{A9:function(){return a},aR:function(){return i},bx:function(){return n}});let i=5,a=5,n=1},435013:function(e,t,r){"use strict";r.d(t,{W:function(){return a},b:function(){return i}});let i=999999,a="loki2vimo"},952538:function(e,t,r){"use strict";r.d(t,{$$:function(){return p},EL:function(){return b},MY:function(){return s},My:function(){return u},R0:function(){return n},RI:function(){return S},YF:function(){return d},dS:function(){return l},du:function(){return y},dw:function(){return f},gX:function(){return o},ou:function(){return h},pn:function(){return m},se:function(){return v},uj:function(){return c},w8:function(){return _},yt:function(){return g}});var i=r(801497),a=r(426336);let n=.008,o=.05,s=.22,c=10,l="",d=.08,u={get[`${a.v$U.Horizontal}_${a.s8r.Left}`](){return i.oc.t("align_to_the_left",{},"\u5411\u5DE6\u5BF9\u9F50")},get[`${a.v$U.Horizontal}_${a.s8r.Right}`](){return i.oc.t("align_right",{},"\u5411\u53F3\u5BF9\u9F50")},get[`${a.v$U.Horizontal}_${a.s8r.Center}`](){return i.oc.t("left_and_right_centered",{},"\u5DE6\u53F3\u5C45\u4E2D")},get[`${a.v$U.Vertical}_${a.s8r.Up}`](){return i.oc.t("align_up",{},"\u5411\u4E0A\u5BF9\u9F50")},get[`${a.v$U.Vertical}_${a.s8r.Down}`](){return i.oc.t("align_down",{},"\u5411\u4E0B\u5BF9\u9F50")},get[`${a.v$U.Vertical}_${a.s8r.Center}`](){return i.oc.t("up_and_down_center",{},"\u4E0A\u4E0B\u5C45\u4E2D")}},h="#FFFFFF",g=.9,_=.8,p=.15,f=1,m=5,v=8,y=-45,S=1e3,b={get MIXED_VALUES(){return"--"}}},211901:function(e,t,r){"use strict";r.d(t,{K:function(){return g}});var i=r(544633),a=r(218571),n=r(426336),o=r(334769),s=r(105166),c=r(111061),l=r(937802),d=r(108692),u=r(896413),h=r(373722);function g(e){let{canvasManager:t,store:r,enable:g,displaySize:_,segmentId:p,failedSegments:f}=e,m=(0,o.F)(t),v=(0,l.G)(d.n),y=(0,l.G)(u.a),S=(0,s.K)(t),{progress:b,canvasResizing:M,duration:k,widgetUpdateTrigger:T}=r,[I,w]=(0,a.useState)([]),P=(0,a.useRef)(0),x=(0,a.useCallback)((e,t)=>m.draftView.getSegmentById(e,t,!1),[m]),C=(0,a.useMemo)(()=>{if(!!p)return(0,c.OO)(I,p)},[I,p]),E=(0,i.default)(async e=>{var t;return 0===e.length?Promise.resolve([]):null!==(t=await S.getSegmentRectangles({draftView:m.draftView,canvasSize:_,segIds:e,selectedSegmentsIds:y.selection.getSelectedSegmentsIds(),getSegmentById:x,current:b}))&&void 0!==t?t:[]});return(0,a.useEffect)(()=>{if(!g)return;if(M){I.findIndex(e=>e.id===p)>-1&&w(I.filter(e=>e.id!==p));return}let{tracks:e}=r,i=(0,c.pt)(e),a=(0,c.KO)({tracks:i,duration:k,progress:b}).filter(e=>!f.has(e.id)),o=a.map(e=>e.id),s=function(e){let{canvasManager:t,progress:r,segments:i,mainDraftService:a}=e,{draftIdToMutableVideos:o,draftIdToMutableTexts:s}=t.modules.templateManager,l={};for(let e of i)if((0,n.duj)(e)){var d,u;let t=a.subDraftApplySpeedViewManager.getCombinationApplySpeedDraftViewById(e.id),i=(null==t?void 0:t.getAllTracks())||[];if(!(null==i?void 0:i.length))continue;let n=(0,c.KO)({tracks:i,duration:e.duration,progress:r-e.start}),h=e.materialDraft.draft.getDraftId(),g=null!==(d=o[h])&&void 0!==d?d:[],_=[...g,...null!==(u=s[h])&&void 0!==u?u:[]];(n=n.filter(e=>_.find(t=>t.segmentId===e.id))).length&&(l[e.id]=n.map(e=>e.id))}return l}({canvasManager:t,segments:a,progress:b,mainDraftService:v}),l=performance.now();P.current=l,E(Object.keys(s).reduce((e,t)=>(e.push(...s[t]),e),[...o])).then(e=>{if(l<P.current)return;let t=new Map;w(e=e.filter(e=>0!==e.originalWidth||0!==e.originalHeight).map(e=>{let r=a.find(t=>{let{id:r}=t;return r===e.id}),i=r&&(0,n.duj)(r);return e.subRects=e.subRects.map(e=>{let a={};if(i){let t=function(e,t){if(!(0,n.duj)(e))return;let{tracks:r}=e.materialDraft.draft;for(let e of r){let{segments:r}=e;for(let e of r)if(e.id===t)return e}}(r,e.id);if(t){var o,s;a={id:t.id,type:t.__segment_struct_type,scale:{...null===(o=t.clip)||void 0===o?void 0:o.scale},transform:{...null===(s=t.clip)||void 0===s?void 0:s.transform}}}}else Object.assign(a,{id:"",type:"Child"});let c={...e,...a,timestamp:Date.now()};return i&&t.set(e.id,c),c}),{...e,...r}}).map(e=>{let r=e.id,i=t.get(r);return i?{...e,...(0,h.Z)(i,"type")}:e}))})},[g,M,_.join("x"),P,T,E,w,k]),{rectangles:I,selectedWidgetRectangle:C,getSegmentRectangles:E}}},576977:function(e,t,r){"use strict";var i,a;r.d(t,{K:function(){return s}});let n=null!==(a=null===(i=window.location.href.match(/\/([^\/?]+)?(?:\?|$)/))||void 0===i?void 0:i[1])&&void 0!==a?a:"",o=`universal-${n}`;class s{static genKey(e,t,r){var i,a;let n=["LOCAL_NOTE"];return n.push(e.key),(null===(i=e.associate)||void 0===i?void 0:i.userId)?n.push(`UID_${t}`):n.push("NO_UID"),(null===(a=e.associate)||void 0===a?void 0:a.draftId)?n.push(`DRID_${r}`):n.push("NO_DRID"),n.join("-")}set userId(e){this._userId=e,this._sync()}get userId(){return this._userId}set draftId(e){this._draftId=e,this._sync()}get draftId(){return this._draftId}register(e,t){if(!e.key)throw Error("every local note needs a key");if(this._registry[e.key]&&delete this._got[e.key],this._registry[e.key]=e,t){this._reset(e.key);return}this._reload(e.key)}_reset(e){var t,r,i,a;let n=this._registry[e];if(!n){console.warn("LocalNote cant reload a non-exist key",e);return}if((null===(t=n.associate)||void 0===t?void 0:t.userId)&&void 0===this._userId){console.warn("LocalNote even not has an userId for",e);return}if((null===(r=n.associate)||void 0===r?void 0:r.draftId)&&void 0===this._draftId){console.warn("LocalNote even not has an draftId for",e);return}this._got[n.key]=null,[s.genKey(this._registry[e],null!==(i=this._userId)&&void 0!==i?i:"",null!==(a=this._draftId)&&void 0!==a?a:""),`${e}-${o}`].forEach(e=>{window.localStorage.removeItem(e)})}_reload(e){var t,r,i,a;let n=this._registry[e];if(!n){console.warn("LocalNote cant reload a non-exist key",e);return}if((null===(t=n.associate)||void 0===t?void 0:t.userId)&&void 0===this._userId){console.warn("LocalNote even not has an userId for",e);return}if((null===(r=n.associate)||void 0===r?void 0:r.draftId)&&void 0===this._draftId){console.warn("LocalNote even not has an draftId for",e);return}this._got[n.key]=window.localStorage.getItem(s.genKey(n,null!==(i=this._userId)&&void 0!==i?i:"",null!==(a=this._draftId)&&void 0!==a?a:""))}reload(e){if(void 0!==e)this._reload(e);else for(let e of Object.keys(this._registry))this._reload(e)}_flush(e){var t,r,i,a;let n=this._registry[e],c=this._got[e];if(!n){console.warn("LocalNote cant flush a non-exist key",e);return}if((null===(t=n.associate)||void 0===t?void 0:t.userId)&&void 0===this._userId){console.warn("LocalNote even not has an userId for",e);return}if((null===(r=n.associate)||void 0===r?void 0:r.draftId)&&void 0===this._draftId){console.warn("LocalNote even not has an draftId for",e);return}[s.genKey(this._registry[e],null!==(i=this._userId)&&void 0!==i?i:"",null!==(a=this._draftId)&&void 0!==a?a:""),`${e}-${o}`].forEach(e=>{window.localStorage.setItem(e,c)})}update(e,t){this._write(e,t)}get(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=this._read(e);return t?null!=r?r:this._readLocalUniversal(e):r}_read(e){return!Object.prototype.hasOwnProperty.call(this._got,e)&&this._reload(e),this._got[e]}_readLocalUniversal(e){return window.localStorage.getItem(`${e}-${o}`)}_write(e,t){this._got[e]=t,Object.prototype.hasOwnProperty.call(this._registry,e)&&this._flush(e)}_sync(){for(let[r,i]of Object.entries(this._registry)){var e,t;void 0!==this._userId&&(null===(e=i.associate)||void 0===e?void 0:e.userId)&&((null===(t=i.associate)||void 0===t?void 0:t.draftId)?void 0!==this._draftId&&(this._got[r]?this._flush(r):this._reload(r)):this._got[r]?this._flush(r):this._reload(r))}}constructor(){this._userId=void 0,this._draftId=void 0,this._registry={},this._got={}}}},674076:function(e,t,r){"use strict";r.d(t,{Y3:function(){return s}});let i=(0,r(914028).Z)();function a(){return"chrome"===i.name}function n(){return a()?/Edg\/([\d.]+)/.test(navigator.userAgent)?"edge":"chrome":"other"}function o(){var e;let t=null===(e=i.version)||void 0===e?void 0:e.split(".")[0];return t?parseInt(t,10):0}function s(){let e=o(),t=[],r=n();return a()||t.push("BrowserType"),function(){switch(n()){case"other":default:return!0;case"edge":return o()>=80;case"chrome":return o()>=86}}()||t.push("BrowserVersion"),function(){let e=!1;try{e=void 0!==window.WebAssembly}catch(e){}return e}()||t.push("WebAssembly"),function(){performance.mark("CHECK_WEBGL2_START");let e=!1,t=!1;try{let r=document.createElement("canvas");return e=!!window.WebGL2RenderingContext,t=!!r.getContext("webgl2"),e&&t}catch(e){return!1}finally{performance.mark("CHECK_WEBGL2_END",{detail:{supportType:e,supportContext:t}})}}()||t.push("WebGL2"),"undefined"!=typeof SharedArrayBuffer||t.push("SharedArrayBuffer"),{unsupported:t,chromeOrEdge:r,browserVersion:e}}},188247:function(e,t,r){"use strict";r.d(t,{Is:function(){return d},bf:function(){return u}});var i=r(801497),a=r(441247),n=r(460254),o=r(426336),s=r(271564);let c=(e,t,r)=>{let{id:i,type:o}=e,{dragSourceType:c,fileType:l}=t;if("mutable"===o){if((0,s.AG)(r))return(!l||!!a.Ze.includes(l))&&(c===n.r.Photo||c===n.r.UserPhoto);return[n.r.Video,n.r.UserVideo,n.r.Photo,n.r.UserPhoto].includes(c)}return!0},l=(e,t,r)=>{let{id:i,type:o}=e,{dragSourceType:c,fileType:l}=t;if("mutable"===o)return(!(0,s.ef)(r)||!l||!!a.ns.includes(l))&&[n.r.Video,n.r.UserVideo,n.r.Photo,n.r.UserPhoto].includes(c);return!0},d=(e,t,r)=>r&&(0,o.hey)(r)?(0,s.AG)(r)?[c(e,t,r),i.ZP.t("web_editor_title_slot_replace",{},"You can only replace this clip with an image")]:(0,s.ef)(r)?[l(e,t,r),i.ZP.t("web_editor_toast_unsupported_format",{},"Can\u2019t add. This file format is unsupported.")]:[!0]:[!0],u=(e,t,r)=>{let[i]=d(e,t,r);return i}},552216:function(e,t,r){"use strict";r.d(t,{z:function(){return n}});var i=r(914028);let a=e=>{let{userAgent:t,platform:r,maxTouchPoints:i}=e;return void 0!==t&&"MacIntel"===r&&"number"==typeof i&&i>1},n=()=>{var e;let t=(null===(e=navigator)||void 0===e?void 0:e.userAgent)||"",r=(0,i.Z)(t),{mobile:n}=r,{os:o=""}=r,s=t.toLowerCase(),c=/crios/.test(s),l="other";return/android/.test(s)&&(l="android",n=!0),(/ios/.test(o)||/ipad|iphone|ipod|mac os x/i.test(s))&&(l="apple"),{isMobile:!!n||a(navigator)||c,mobileType:l}}},281118:function(e,t,r){"use strict";r.d(t,{$:function(){return o},F:function(){return n}});let i={MONTH:1,YEAR:12},a={1:"1_month",12:"12_month"},n=e=>{let{cycleUnit:t,subscribeCycle:r,subscribeType:n}=null!=e?e:{};if(!t||!r)return"free";let o=(Object.keys(i).includes(t)?i[t]:0)*r;return o&&a[o]?`${a[o]}${"auto"===n?"_auto":""}`:"free"},o=e=>{var t;let r=null==e?void 0:null===(t=e.filter(e=>{var t;return!(null===(t=e.product_id)||void 0===t?void 0:t.includes("subscription"))}))||void 0===t?void 0:t.reduce((e,t)=>(t.space_capacity||0)+e,0);return`${r?r/1024/1024/1024:0}GB`}},511706:function(e,t,r){"use strict";r.d(t,{Vb:function(){return n}});var i=r(763832);function a(e){if(e&&e.status>=200&&e.status<300)return e;throw Error(`Unexpected status code: ${e.status}`)}async function n(e){var t,r;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{onProgress:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=await function e(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,{delayMs:o=500,numTry:s=2,checkResponse:c=a}=null!=n?n:{};return t.startsWith("http://")&&(t=t.replace(/^http:\/\//,"https://")),fetch(t,r).then(c).catch(async a=>{if(a instanceof DOMException&&"AbortError"===a.name){console.warn(`fetch ${t} has been aborted`);return}{let n=s-1;if(n<=0)throw console.warn("fetch-retry no more retry times, url:",t,", error:",a),a;return console.warn("fetch-retry url:",t,", will retry:",n,", error:",a),await (0,i.D)(o),await e(t,r,{delayMs:o,numTry:n})}})}(e,n);if(!(s.status>=200&&s.status<300)){let t=Error(`Request status(${s.status}): ${e}`);throw t.response=t,t}let{body:c,headers:l}=s,d=Number(null!==(r=null!==(t=l.get("Content-Length"))&&void 0!==t?t:l.get("Media-Length"))&&void 0!==r?r:0);if(!c||!d)return s;let u=0,h=new Response(new ReadableStream({start(e){let t=c.getReader();return function r(){return t.read().then(t=>{let{done:i,value:a}=t;if(i){e.close();return}return e.enqueue(a),u+=a.byteLength,null==o||o(u/d),r()})}()}}),{status:s.status,statusText:s.statusText});for(let[e,t]of s.headers.entries())h.headers.set(e,t);return h}},129883:function(e,t,r){"use strict";r.d(t,{V:function(){return n}});var i=r(978594),a=r(426336);function n(e){let t=[];if(e===BigInt(Number.MAX_SAFE_INTEGER))return t;let r=(0,i.W)(a.pMA.div(e,1e3))/10,n=a.pMA.div(e,1e3*r);for(let e=0;e<n;++e)t.push(Math.floor(1e3*Math.pow(Math.random(),.25))/1e3);return t}},836946:function(e,t,r){"use strict";r.d(t,{A2:function(){return c},Ii:function(){return n},Io:function(){return s},qH:function(){return a},qp:function(){return l},uu:function(){return d}});var i=r(231811);function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],a=-t,n=Math.cos(a*Math.PI/180),o=Math.sin(a*Math.PI/180),s=r[0]+(e[0]-r[0])*n-(e[1]-r[1])*o,c=r[1]+(e[0]-r[0])*o+(e[1]-r[1])*n;return[(0,i.FH)(s),(0,i.FH)(c)]}function n(e,t){let{begin:r,end:a}=e;if(a[1]===r[1])return Math.abs(t[1]-r[1]);if(a[0]===r[0])return Math.abs(t[0]-r[0]);let n=-(a[0]-r[0])/(a[1]-r[1]),o=r[1]*(a[0]-r[0])/(a[1]-r[1])-r[0],s=(1*t[0]+n*t[1]+o)/Math.sqrt(1+n**2);return(0,i.FH)(Math.abs(s))}function o(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])}function s(e,t,r){return o(e.begin,e.end,r)*o(t.begin,t.end,r)>=0}function c(e,t){let[r,i,a,n]=e;return o(r,i,t)*o(a,n,t)>=0&&o(i,a,t)*o(n,r,t)>=0}function l(e,t){let r=e.end[0]-e.begin[0],a=e.end[1]-e.begin[1],n=t.end[0]-t.begin[0],o=t.end[1]-t.begin[1],s=Math.atan2(r*o-a*n,r*n+a*o)/Math.PI*180;return(0,i.FH)((s+360)%360,2)}let d=(e,t)=>{let{x:r,y:i,width:a,height:n}=e,{x:o,y:s,width:c,height:l}=t,d=Math.max(r,o),u=Math.max(i,s),h=Math.max(Math.min(r+a,o+c)-d,0),g=Math.max(Math.min(i+n,s+l)-u,0);return{x:d,y:u,width:h,height:g}}},764030:function(e,t,r){"use strict";r.d(t,{H:function(){return c},K:function(){return s}});var i=r(426336),a=r(722169),n=r(879551),o=r(544494);function s(e,t,r,i){let a=(0,o.j)(r,e.draftPathStore,t,i),s=(0,n.K3)(r,e.draftPathStore,t,i);return Array.isArray(a)?[...a,...s]:[a,...s]}async function c(e,t){let r=[],n=(a,o)=>{for(let c of a.getAllSegments())r.push(s(e,t,c,o)),(0,i.duj)(c)&&n(c.materialDraft.draft,c.id)};if(n(e.dataSdk.draftView),!r.length)return[];let o=(await Promise.all((0,a.flattenDeep)(r))).filter(Boolean);return(0,a.uniqBy)(o,e=>{let{resourceId:t,segmentId:r}=e;return t+r})}},544494:function(e,t,r){"use strict";r.d(t,{j:function(){return v}});var i=r(426336),a=r(827084),n=r(504826),o=r(127830),s=r(320271);let c=e=>{if(!e)return!1;let{sourcePlatform:t}=e;return t!==i.cvu.MaterialPlatformDefault&&!0},l=(e,t,r)=>new Promise(t=>{let s=r.get((0,a.Bc)(e.templateId),o._g.VideoTemplate);if(!s){t(null);return}null==s||s.onReady(r=>{var a;let o=null!==(a=r.optimizedCoverUrl.mediumCoverUrl)&&void 0!==a?a:r.cover.url;t({previewUrl:o,animatedUrl:o,isBusiness:r.templateType===n.WY.BUSINESS,metaType:i.cVg.MetaTypeCombination,name:r.name,resourceId:r.id,segmentId:e.id})}),null==s||s.onError(()=>{t(null)})}),d=(e,t,r,a)=>new Promise(n=>{let s,c;let{material:l}=e,d=l.path,u=t.getResourceKeyFromDraftPath(d);if(!u){n(null);return}switch(!0){case l.type===i.cVg.MetaTypeMusic:case l.type===i.cVg.MetaTypeSound:s=o._g.Audio,null==(c=r.get(u,s))||c.onReady(t=>{let{coverUrl:r,isBusiness:i,resourceId:o,isVip:s,title:c,source:d}=t;n({previewUrl:r,animatedUrl:r,isBusiness:i,metaType:l.type,name:c,resourceId:o,segmentId:e.id,isVip:s,parentSegmentId:a,source:d})})}if(!c){n(null);return}null==c||c.onError(()=>{n(null)})}),u=(e,t,r,a)=>new Promise(n=>{let s,c;let{material:l}=e,d=l.path,u=t.getResourceKeyFromDraftPath(d);if(!u){n(null);return}if(!0==(l.type===i.cVg.MetaTypeTextTemplate))s=o._g.TextTemplate,null==(c=r.get(u,s))||c.onReady(t=>{var r,i;let{icon:o,previewUrl:s,isBusiness:c,resourceId:d,isVip:u,name:h,source:g}=t;n({previewUrl:s,animatedUrl:null!==(i=null==o?void 0:null===(r=o.urlList)||void 0===r?void 0:r[0])&&void 0!==i?i:s,isBusiness:c,metaType:l.type,name:h,resourceId:d,segmentId:e.id,isVip:u,parentSegmentId:a,source:g})}),null==c||c.onError(()=>{n(null)});if(!c){n(null);return}null==c||c.onError(()=>{n(null)})}),h=(e,t,r,a)=>new Promise(n=>{var s,c;let l,d;let u=null!==(c=null==e?void 0:e.effect)&&void 0!==c?c:null==e?void 0:null===(s=e.effects)||void 0===s?void 0:s[0];if(!u){n(null);return}let h=u.path,g=t.getResourceKeyFromDraftPath(h);if(!g){n(null);return}switch(!0){case u.type===i.cVg.MetaTypeText:case u.type===i.cVg.MetaTypeTextEffect:case u.type===i.cVg.MetaTypeTextFlower:case u.type===i.cVg.MetaTypeTextShape:case u.type===i.cVg.MetaTypeTextPreset:l=o._g.TextPreset,null==(d=r.get(g,l))||d.onReady(t=>{var r,i;let{previewUrl:o,icon:s,isBusiness:c,resourceId:l,isVip:d,name:h,source:g}=t;n({previewUrl:o,animatedUrl:null!==(i=null==s?void 0:null===(r=s.urlList)||void 0===r?void 0:r[0])&&void 0!==i?i:o,isBusiness:c,metaType:u.type,name:h,resourceId:l,segmentId:e.id,isVip:d,parentSegmentId:a,source:g})})}if(!d){n(null);return}null==d||d.onError(()=>{n(null)})}),g=(e,t,r,i)=>new Promise(a=>{let n=e.path,s=t.getResourceKeyFromDraftPath(n);if(!s){a(null);return}let c=o._g.TextPreset,l=r.get(s,c);if(!l){a(null);return}null==l||l.onError(()=>{a(null)}),null==l||l.onReady(t=>{var r,n,o,s;let{previewUrl:c,icon:l,isBusiness:d,resourceId:u,name:h,isVip:g,source:_}=t;a({previewUrl:null!==(o=null==l?void 0:null===(r=l.urlList)||void 0===r?void 0:r[0])&&void 0!==o?o:c,animatedUrl:null!==(s=null==l?void 0:null===(n=l.urlList)||void 0===n?void 0:n[0])&&void 0!==s?s:c,isBusiness:d,metaType:e.type,name:h,resourceId:u,segmentId:e.segmentId,isVip:g,parentSegmentId:i,source:_})})}),_=(e,t,r,a)=>new Promise(n=>{let s,c;let{material:l}=e,d=l.path,u=t.getResourceKeyFromDraftPath(d);if(!u){n(null);return}if(!0==(l.type===i.cVg.MetaTypeSticker)){if(s=o._g.Sticker,!(c=r.get(u,s))){n(null);return}null==c||c.onReady(t=>{var r,i;let{previewUrl:o,icon:s,isBusiness:c,resourceId:d,isVip:u,name:h,source:g}=t;n({previewUrl:o,animatedUrl:null!==(i=null==s?void 0:null===(r=s.urlList)||void 0===r?void 0:r[0])&&void 0!==i?i:o,isBusiness:c,metaType:l.type,name:h,resourceId:d,segmentId:e.id,isVip:u,parentSegmentId:a,source:g})})}if(!c){n(null);return}null==c||c.onError(()=>{n(null)})}),p={[i.cVg.MetaTypeVideoEffect]:o._g.Effects,[i.cVg.MetaTypeFaceEffect]:o._g.FaceProp},f=(e,t,r,i)=>new Promise(a=>{let n;let{material:o}=e,s=o.path,c=t.getResourceKeyFromDraftPath(s);if(!c){a(null);return}let l=p[o.type];if(l){if(!(n=r.get(c,l))){a(null);return}null==n||n.onReady(t=>{var r,n;let{previewUrl:s,icon:c,isBusiness:l,resourceId:d,isVip:u,name:h,source:g}=t;a({previewUrl:s,animatedUrl:null!==(n=null==c?void 0:null===(r=c.urlList)||void 0===r?void 0:r[0])&&void 0!==n?n:s,isBusiness:l,metaType:o.type,name:h,resourceId:d,segmentId:e.id,isVip:u,parentSegmentId:i,source:g})})}if(!n){a(null);return}null==n||n.onError(()=>{a(null)})}),m=(e,t,r,a)=>new Promise(n=>{let s,c;let{material:l}=e,d=l.path,u=t.getResourceKeyFromDraftPath(d);if(!u){n(null);return}if(!0==(l.type===i.cVg.MetaTypeFilter)){if(s=o._g.Filter,!(c=r.get(u,s))){n(null);return}null==c||c.onReady(t=>{var r,i;let{previewUrl:o,icon:s,isBusiness:c,resourceId:d,isVip:u,name:h,source:g}=t;n({previewUrl:o,animatedUrl:null!==(i=null==s?void 0:null===(r=s.urlList)||void 0===r?void 0:r[0])&&void 0!==i?i:o,isBusiness:c,metaType:l.type,name:h,resourceId:d,segmentId:e.id,isVip:u,parentSegmentId:a,source:g})})}if(!c){n(null);return}null==c||c.onError(()=>{n(null)})}),v=(e,t,r,a)=>{switch(!0){case(0,i.hey)(e):var n,p,v,y;return n=e,p=t,v=r,y=a,(0,i.duj)(n)?l(n,p,v):new Promise(e=>{let t,r;let{material:a}=n;if(!c(a)){e(null);return}let s=a.path,l=p.getResourceKeyFromDraftPath(s);if(!l){e(null);return}switch(!0){case a.type===i.cVg.MetaTypePhoto:t=o._g.Photo,null==(r=v.get(l,t))||r.onReady(t=>{let{coverUrl:r,isBusiness:i,resourceId:a,isVip:o,title:s,order:c,source:l}=t;e({previewUrl:r,animatedUrl:r,isBusiness:i,metaType:n.material.type,name:s,resourceId:a,segmentId:n.id,isVip:o,parentSegmentId:y,order:c,source:l})});break;case a.type===i.cVg.MetaTypeVideo:t=o._g.Video,null==(r=v.get(l,t))||r.onReady(t=>{let{coverUrl:r,isBusiness:i,resourceId:a,isVip:o,title:s,order:c,source:l}=t;e({previewUrl:r,animatedUrl:r,isBusiness:i,metaType:n.material.type,name:s,resourceId:a,segmentId:n.id,isVip:o,parentSegmentId:y,order:c,source:l})});break;case a.type===i.cVg.MetaTypeGif:t=o._g.Gif,null==(r=v.get(l,t))||r.onReady(t=>{let{coverUrl:r,animatedUrl:i,id:a,name:o}=t;e({previewUrl:r,animatedUrl:i,isBusiness:!1,metaType:n.material.type,name:o,resourceId:a,segmentId:n.id,parentSegmentId:y})})}if(!r){e(null);return}null==r||r.onError(()=>{e(null)})});case(0,i.Y9Q)(e):return d(e,t,r,a);case(0,i.Q2R)(e):let S=[u(e,t,r,a)],{material:b}=e;if(b.resources.length)for(let n of b.resources)S.push(g({path:n.path,segmentId:e.id,type:n.panel===s.U_.Flower?i.cVg.MetaTypeTextEffect:i.cVg.MetaTypeText},t,r,a));return S;case(0,i.Ftn)(e):return h(e,t,r,a);case(0,i.P2T)(e):return _(e,t,r,a);case(0,i.w5o)(e):return f(e,t,r,a);case(0,i.SiN)(e):return m(e,t,r,a)}return Promise.resolve(null)}},547314:function(e,t,r){"use strict";function i(e){var t;return null!==(t=null==e?void 0:e.is_matting)&&void 0!==t?t:null==e?void 0:e.is_reverse}function a(e){let{mattingPath:t,edgeMattingPath:r}=e;return r?`${t};${r}`:t}r.d(t,{_:function(){return i},t:function(){return a}})},566504:function(e,t,r){"use strict";r.d(t,{A8:function(){return u},Bl:function(){return c},DU:function(){return l},JA:function(){return d},Sn:function(){return h},ad:function(){return n},hr:function(){return o},ov:function(){return a},po:function(){return s}});var i=r(426336);function a(e){return(null==e?void 0:e.__segment_struct_type)===i.Ocy.SegmentVideo}function n(e){return(null==e?void 0:e.__segment_struct_type)===i.Ocy.SegmentAudio}function o(e){return(null==e?void 0:e.__segment_struct_type)===i.Ocy.SegmentText}function s(e){return(null==e?void 0:e.__segment_struct_type)===i.Ocy.SegmentTextTemplate}function c(e){var t;return s(e)&&!!(null===(t=e.material)||void 0===t?void 0:t.version)}function l(e){var t;return(0,i.Q2R)(e)&&!(null===(t=e.material)||void 0===t?void 0:t.version)}function d(e){return(null==e?void 0:e.__segment_struct_type)===i.Ocy.SegmentSticker}function u(e){return!!(null==e?void 0:e.__segment_struct_type)}function h(e){return a(e)||n(e)}},955171:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var i=r(460254),a=r(426336),n=r(29188);function o(e,t){let r=a.pMA.times(n.H6,1e3,"bigint");switch(e){case i.r.UserPhoto:case i.r.UserVideo:case i.r.DigitalHuman:case i.r.Photo:case i.r.Video:case i.r.VideoTemplate:case i.r.Gif:r=e===i.r.Video?a.pMA.times(t.duration_ms,1e3,"bigint"):e===i.r.DigitalHuman?a.pMA.times(t.duration,1e6,"bigint"):e===i.r.UserVideo||e===i.r.Gif?a.pMA.times(t.duration,1e6,"bigint"):i.r.VideoTemplate===e?a.pMA.times(t.duration,1e6,"bigint"):a.pMA.times(n.H6,1e3,"bigint");break;case i.r.UserAudio:case i.r.Audio:r=a.pMA.times(t.duration,1e6,"bigint");break;case i.r.Transition:r=a.pMA.times(n.u$,1e3,"bigint");break;case i.r.BasicText:case i.r.TextPreset:case i.r.TextTemplate:case i.r.BrandText:r=a.pMA.times(n.B7,1e3,"bigint");break;case i.r.Sticker:r=a.pMA.times(n.rk,1e3,"bigint");break;case i.r.Effects:r=a.pMA.times(n.zx,1e3,"bigint");break;case i.r.Filter:case i.r.AdjustmentPreset:r=a.pMA.times(n.Ru,1e3,"bigint")}return r}},224986:function(e,t,r){"use strict";r.d(t,{F:function(){return o}});var i=r(800788),a=r(426336),n=r(254336);let o=e=>{let{mutableId:t,file:r,dataSdk:o,fileUploaderManager:s,position:c,subDraftId:l,subTemplateId:d}=e,u=o.draftView.getDraftId(),h=null!=l?l:u,g=o.cutSame.draftIdToMutableVideos[h];(0,i.Y2)(g);let _=g.find(e=>e.id===t);(0,i.Y2)(_);let p=o.draftView.getSegmentById(_.segmentId);return(0,i.Y2)(p&&(0,a.hey)(p)),s.mutableFileUpload({draftId:h,mutableId:t,templateId:d},r,{uploadReportParams:{action_type:n.jm.CLICK_ADD,material_source:n.O9.LOCAL,position:c}})}},794273:function(e,t,r){"use strict";r.d(t,{FH:function(){return o},Ff:function(){return n},v5:function(){return a}});var i=r(426336);function a(e,t){let r=10**t;return Math.round(e*r)/r}function n(e){return null!=e&&"type"in e&&(null==e?void 0:e.type)===i.cVg.MetaTypeTransition}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return Number.parseFloat(e.toFixed(t))}},196769:function(e,t,r){"use strict";r.d(t,{o:function(){return _}});var i=r(789786),a=r(827322),n=r(561909),o=r(624515),s=r(425427),c=r(402144),l=r(70031),d=r(825686),u=r(782350),h=r(744268),g=r(230689);class _ extends c.W{async triggerOnNotEnoughModalOK(e){let{workspaceId:t}=e;switch(await this.getNotEnoughOkType(e)){case l.mq.OK:break;case l.mq.CHANGE_LOCATION:this._contaienrService.invokeFunction(e=>{let r=e.get(n.l);this._payinPayoutService.lockModal(t);let i=r.onModalClose(()=>{this._payinPayoutService.freeModal(t),i.dispose()});r.showModal(n.B.MOVE)});break;case l.mq.EXPAND:case l.mq.UPGRADE:this.showExpandModal({pageFrom:d.K1.spaceLimitUpgrade,...e});break;case l.mq.FREE_UP:window.open((0,a.C)(`${window.location.origin}/my-cloud/${e.workspaceId}?enter_from=cloud_space_popup&from_page=editor`,null,{logType:"js.window.location",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),"_blank");case l.mq.TRY_AGAIN:}}async triggerOnNotEnoughModalCancel(e){let t=await this.getNotEnoughCancelType(e),r=this._contaienrService.invokeFunction(e=>e.get(o.O));switch(t){case l.hU.CANCEL:break;case l.hU.ABANDON_PROJECT:r.cancelGlobalExitConfirm(),window.location.reload();break;case l.hU.FREE_UP:window.open((0,a.C)(`${window.location.origin}/my-cloud/${e.workspaceId}?enter_from=cloud_space_popup&from_page=editor`,null,{logType:"js.window.location",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),"_blank")}}constructor(e,t,r,i,a){super(t,r,i),this._videoEnvironmentService=e,this._payinPayoutService=t,this._workspaceService=r,this._configurationService=i,this._contaienrService=a,this._currentPage=(0,s.JY)(this._videoEnvironmentService)?"template_editor":"editor"}}_=(0,i.gn)([(0,i.fM)(0,s.rO),(0,i.fM)(1,d.sX),(0,i.fM)(2,u.W),(0,i.fM)(3,h.Ui),(0,i.fM)(4,g.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.rO?Object:s.rO,void 0===d.sX?Object:d.sX,void 0===u.W?Object:u.W,void 0===h.Ui?Object:h.Ui,void 0===g.t?Object:g.t])],_)},118830:function(e,t,r){"use strict";r.d(t,{J:function(){return a},X:function(){return n}});var i=r(293698);function a(){let{referrer:e}=document;if(!e)return"first_page";try{let t=new URL(e),{location:r}=document;if(t.hostname===r.hostname&&t.pathname===r.pathname)return"first_page"}catch(e){console.log("failed to parse url",e)}return"other"}function n(){let{searchParams:e}=new URL(window.location.href);if((0,i.l0)())return i.dL;{var t,r;let i=a();return null!==(r=null!==(t=e.get("__from_page"))&&void 0!==t?t:e.get("from_page"))&&void 0!==r?r:i}}},918513:function(e,t,r){"use strict";r.d(t,{Cr:function(){return c},F:function(){return s},GT:function(){return n},XX:function(){return o},gT:function(){return l}});var i=r(136877);let a={[i.ZZ.remove_background]:"remove_background",[i.ZZ.resize_video]:"resize_video",[i.ZZ.ad_script]:"ad_script",[i.ZZ.text_to_image]:"text_to_image",[i.ZZ.image_to_image]:"image_to_image",[i.ZZ.portrait_generator]:"portrait_generator",[i.ZZ.image_style_transfer]:"image_style_transfer",[i.ZZ.video_style_transfer]:"video_style_transfer",[i.ZZ.image_upscaler]:"image_upscaler",[i.ZZ.ai_color_correction]:"ai_color_correction",[i.ZZ.photo_colorizer]:"photo_colorizer",[i.ZZ.old_photo_restoration]:"old_photo_restoration",[i.ZZ.low_light_image_enhancement]:"low_light_image_enhancement",[i.ZZ.video_upscaler]:"video_upscaler",[i.ZZ.super_slow_motion]:"super_slow_motion",[i.ZZ.video_stabilization]:"video_stabilization",[i.ZZ.chatgpt]:"chatgpt",[i.ZZ.autocut]:"autocut",[i.ZZ.text_to_video]:"text_to_video",[i.ZZ.chatgpt_search]:"chatgpt_search",[i.ZZ.long_to_short]:"clip_shorts",[i.ZZ.ai_video]:"ai_video",[i.ZZ.text_to_speech]:"text_to_speech",[i.ZZ.av_translator]:"av_translator",[i.ZZ.voice_changer]:"voice_changer",[i.ZZ.storyboard]:"storyboard"};function n(e){return!!a[e]}function o(e){return a[e]}function s(e,t){let r="edit";if(t&&n(t)&&t!==i.ZZ.chatgpt_search)r="smart_tool";else if(e||t===i.ZZ.template||t===i.ZZ.chatgpt_search)r="template";return r}function c(e,t){if(t){let r=e.getSegmentById(t);return!!(null==r?void 0:r.smartCrop)}return e.getAllSegments().some(e=>{let t=null==e?void 0:e.smartCrop;return null!=t})}function l(e){return!!e.getDraftChangedSummary().is_smart_crop}},533743:function(e,t,r){"use strict";r.d(t,{R:function(){return a}});var i=r(426336);let a=(e,t,r,a)=>{let n=null!=a?a:e.draftView.getDraftId(),o=e.cutSame.draftIdToMutableVideos[n];if(!!o)for(let a of r){let{mutableId:r}=a,n=o.find(e=>{let{id:t}=e;return t===r}),s=null==n?void 0:n.segmentId;if(!s)continue;let c=e.draftView.getSegmentById(s);if(!c||!(0,i.hey)(c))continue;let l=t.getMutablePipelineParams(c,a);if(!l){t.pipelineManager.deleteAllIntelligent(c);continue}let{params:d,toolType:u}=l;t.switchIntelligentByPipeline(c,u,d)}}},805355:function(e,t,r){"use strict";r.d(t,{u:function(){return l},z:function(){return d}});var i=r(909034),a=r(593642),n=r(800788),o=r(426336),s=r(550535),c=r(948328);let l=async(e,t,r,a,o,l,d)=>{var u;let{md5:h,workspaceId:g}=d,_=await (0,s.J)({md5s:[h],packageDelta:{meta:{visible:!0}},fromWorkspaceId:g,toWorkspaceId:g,fetchRetryOptions:{delay:500,retryTimes:20},containerService:l});(0,n.Y2)(_.ok,_.msg);let p=null===(u=_.value)||void 0===u?void 0:u[0],f=p.getModel(),m=await (0,i.q3)(f,e.dataSdk,t,r,e.draftPathStore,a,l);return o.addToUserGenerated(p,{addFrom:c.a.Freeze}),m},d=(e,t,r,i,s)=>{var c;let{segment:l,progress:d,md5:u,duration:h,mediaInfo:g,path:_}=i,p=null===(c=e.getMaterialsByMd5(u))||void 0===c?void 0:c[0],f=(0,a.Rl)();(0,n.Y2)(p,"no draw frame asset."),r.api.batch.freezeVideo({segId:l.id,splitTime:d,videoParam:(0,o.lFK)({segmentId:f,mediaInfo:g,path:_,materialName:p.filename,materialId:p.key,duration:h,sourceDuration:h,sourcePlatform:0,sourceStartTime:d,startTime:d})},s),t.setSelectedData({segmentIds:[f]})}},338151:function(e,t,r){"use strict";r.d(t,{G:function(){return o},h:function(){return n}});var i=r(800788),a=r(426336);let n={[a.Ocy.SegmentVideo]:"video",[a.Ocy.SegmentVideoEffect]:"effect",[a.Ocy.SegmentAudio]:"audio",[a.Ocy.SegmentFilter]:"filter",[a.Ocy.SegmentText]:"text",[a.Ocy.SegmentTextTemplate]:"textTemplate",[a.Ocy.SegmentSticker]:"sticker",[a.Ocy.SegmentImageSticker]:"imageSticker",[a.Ocy.SegmentPictureAdjust]:"pictureAdjust",[a.Ocy.SegmentTailLeader]:"tailLeader",[a.Ocy.SegmentHandwrite]:"handwrite"};function o(e){!e.__segment_struct_type&&(0,i.ss)();let t=n[e.__segment_struct_type];return"video"===t&&(0,a.duj)(e)&&(t="combination"),t}},132456:function(e,t,r){"use strict";function i(e){let t=new FileReader;return new Promise(r=>{t.onload=e=>{e&&"load"===e.type&&(t.result.fileStart=0,r(t.result))},t.readAsArrayBuffer(e)})}r.d(t,{B:function(){return i}})},574548:function(e,t,r){"use strict";r.d(t,{G:function(){return a}});var i=r(827322);function a(e){let{attrs:t={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((r,a)=>{let n=new Image;for(let[e,r]of Object.entries(t))n[e]=r;n.onload=()=>r(n),n.onerror=(e,t,r,i,n)=>{a(n)},n.src=(0,i.C)(e,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})})}},298730:function(e,t,r){"use strict";r.d(t,{Mf:function(){return l},W1:function(){return g},_3:function(){return u},dx:function(){return d},h8:function(){return _},kt:function(){return p},kv:function(){return h},q6:function(){return c},ty:function(){return m}});var i=r(566504),a=r(426336),n=r(801497),o=r(29188),s=r(690613);function c(e){return e.flatMap(e=>e.segments.filter(a.duj))}function l(e,t,r){var a,n;if((0,i.A8)(r)){if((0,i.ov)(r)){for(let t of e)if(t.id===(null===(a=r.material)||void 0===a?void 0:a.id))return t}else if((0,i.hr)(r)){for(let e of t)if(e.id===(null===(n=r.material)||void 0===n?void 0:n.id))return e}else if((0,i.po)(r)){let e=[];for(let i of t)i.segmentId===r.id&&e.push(i);return e}}else;return null}let d=(e,t,r)=>{for(let t of e)if(t.segmentId===r)return t;let i=[];for(let e of t)e.segmentId===r&&i.push(e);return i.length>1?i:1===i.length?i[0]:null};function u(e){return 0===e.length||e[0].type===a.pNd.TrackTypeNone}function h(e){return!!e.map(e=>e.segments).flat().find(e=>(0,a.hey)(e)||(0,a.kjj)(e))}function g(e){return!!e.map(e=>e.segments).flat().some(e=>{var t,r;return!!(null===(r=e.material)||void 0===r?void 0:null===(t=r.matting)||void 0===t?void 0:t.flag)})}function _(e,t){for(let i of e)for(let e of i.segments){var r;if(e.id===t)return e;if((0,a.hey)(e)&&(null===(r=e.transition)||void 0===r?void 0:r.id)===t)return e.transition}return null}let p=(e,t)=>{for(let i of e){var r;for(let e of null!==(r=i.segments)&&void 0!==r?r:[])if(e.id===t)return e}return null},f=(e,t,r)=>t.map(e=>{let{track:t,index:i}=e;return[{...t,segments:t.segments.filter(e=>!r.has(e.id))},i]}).filter(t=>{let[r]=t;return e.draftView.isMainTrack(r)||r.segments.length}),m=(e,t)=>{let r=t.filter(e=>{let{type:t}=e;return"combination"===t||"video"===t||"audio"===t});if(!r.length)return(0,s.ly)();let i=e.draftView.getAllTracks().map((e,t)=>({track:e,index:t})),c=i.filter((e,t)=>t>0&&e.track.type!==a.pNd.TrackTypeAudio),l=i.filter(t=>e.draftView.isMainTrack(t.track)),d=i.filter(e=>e.track.type===a.pNd.TrackTypeAudio),u=new Set(r.map(e=>{let{id:t=""}=e;return t})),h=f(e,c,u),g=f(e,l,u),_=f(e,d,u),p=r.filter(e=>{let{type:t,newTrack:r}=e;return("video"===t||"combination"===t)&&r}),m=[...g,...h.filter(e=>{let[t]=e;return"video"===t.type})],v=e.draftView.getAllTracks().filter(e=>e.type===a.pNd.TrackTypeVideo).length;if(p.length+m.length>Math.max(o.cp,v))return(0,s.wf)(-1,n.oc.t("web_multi_track_text_cannot_add",{},"Couldn\u2019t add. There is no space for more tracks."));let y=r.filter(e=>{let{type:t,newTrack:r}=e;return"audio"===t&&r}),S=_.filter(e=>{let[t]=e;return"audio"===t.type}),b=e.draftView.getAllTracks().filter(e=>e.type===a.pNd.TrackTypeAudio).length;if(y.length+S.length>Math.max(o.Fb,b))return(0,s.wf)(-1,n.oc.t("web_multi_track_text_audio_limits",{},"Couldn\u2019t add. There is no space for more tracks."));let M=r.filter(e=>{let{type:t}=e;return"combination"===t}).map(t=>{let{trackIndex:r,targetStart:i,newTrack:a}=t,n=i,o=e.draftView.getTrackByIndex(r);if(o&&e.draftView.getDraftProperty().maintrackAdsorb&&e.draftView.isMainTrack(o)&&!a){let e=o.segments,t=e[e.length-1],r=t?t.targetTimerange.start+t.targetTimerange.duration:0n;i>r&&(n=r)}return{...t,targetStart:n}}),k=0n,T=m.flatMap(t=>{let[r,i]=t;return r.segments.map(t=>{let a=t.targetTimerange.clone();return e.draftView.getDraftProperty().maintrackAdsorb&&e.draftView.isMainTrack(r)&&(a.start=k,k=a.start+a.duration),[{targetTimerange:a,originalSegment:t},i]}).filter(e=>{let[t]=e;return(0,a.hey)(t.originalSegment)&&a.bZh.isCombinationVideo(t.originalSegment)})}),I=e.draftView.getAllSegments();return M.some(e=>{let{id:t}=e;return!I.find(e=>e.id===t)})&&T.length+M.length>o.HW?(0,s.wf)(-1,n.oc.t("web_multi_track_text_up_to_three",{},"You can add up to 3 templates in a project")):M.some(e=>{let{targetStart:t,duration:r,trackIndex:i,newTrack:a}=e;return!T.filter(e=>{let[,t]=e;return a||t!==i}).every(e=>{let[i]=e;return t+r-33333n<=i.targetTimerange.start||t+33333n>=i.targetTimerange.start+i.targetTimerange.duration})})?(0,s.wf)(-1,n.oc.t("web_multi_track_text_can_not_added",{},"Can\u2019t add template here. Another template has already been added to this timestamp.")):(0,s.ly)()}},953211:function(e,t,r){"use strict";r.d(t,{b:function(){return n},r:function(){return o}});var i=r(426336),a=r(57407);let n=e=>e.reduce((e,t)=>{let[r]=t;return r.trackType===i.pNd.TrackTypeAudio?e:(r.segments.forEach(t=>{var r;let i=null===(r=t.mutable)||void 0===r?void 0:r.children;(null!=i?i:[t]).forEach(t=>{var r;!(null===(r=t.mutable)||void 0===r?void 0:r.locked)&&e.push(t)})}),e)},[]),o=e=>{var t;return Array.from(null!==(t=e.keys())&&void 0!==t?t:[]).slice(0,a.T.length).reduce((e,t,r)=>(e[t]=a.T[r],e),{})}},861631:function(e,t,r){"use strict";r.d(t,{pY:function(){return o},qK:function(){return n},tt:function(){return s},xn:function(){return a}});var i=r(504826);function a(e){let{width:t,height:r}=e;if(854===t&&480===r)return{width:864,height:486};if(480===t&&854===r)return{width:486,height:864};if(486===t&&364===r)return{width:492,height:369};else if(364===t&&486===r)return{width:369,height:492};else return{width:t,height:r}}function n(e,t){let r,i;let a=!1;t.width>t.height?(r=t.height,i=t.width,a=!0):(r=t.width,i=t.height);let n=Math.floor(e*i/r);return a?{width:n,height:e}:{width:e,height:n}}function o(e,t){let r;return t&&Object.values(e).forEach(e=>{if(!r){for(let t of e)if(!t.filled){r=t.id;break}}}),!r}function s(e,t){return 348188===t?4:e===i.WY.BUSINESS?1:e===i.WY.CONSUMER?0:void 0}},528854:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var i=r(772322);r(218571);var a=r(105789),n=r.n(a),o=r(801497),s=r(150564),c=r(166107);let l=()=>(0,i.jsxs)("div",{className:n()("template-post-banner",c.Z.banner),children:[(0,i.jsx)(s.BdQ,{className:c.Z.bannerIcon}),(0,i.jsx)("span",{className:c.Z.bannerText,children:o.ZP.t("web_posttemplate_text_select_elements",{},"Select the elements that can be replaced in timeline below")})]})},400290:function(e,t,r){"use strict";r.d(t,{R:()=>B});var i=r("789786"),a=r("3375"),n=r("686567"),o=r("978112"),s=r("230689"),c=r("763832"),l=r("210823"),d=r("271368"),u=r("134392"),h=r("850649"),g=r("896413"),_=r("108692"),p=r("314181"),f=r("165092"),m=r("218571"),v=r("786377"),y=r("373722"),S=r("801497"),b=r("426336"),M=r("433140"),k=r("782350"),T=r("685795"),I=r("425427"),w=r("764030"),P=r("181304"),x=r("54059"),C=r("862893"),E=r("991153"),D=r("811750");class F{invokeExportAndPublish(e,t){let r=this._mainDraftService.dataSdk.draftView.getAllSegments();return new Promise(i=>{this._exportService.triggerVideoExport({customExportParams:{video_name:e.title,definition:e.definition,fps:30,quality:1,format:"mp4",type:p.Po.template_post},customShareInstanceProps:{hideHeaderBtn:!0,disableCancelConfirm:!0,customText:this._getVideoExportCustomText(),customResultRender:i=>{let{exportTaskId:a,onClose:n,reportParams:o}=i;return(0,m.createElement)(P.Z,{analysisDuration:this._calcTemplateAnalysisDuration(r),onBack:e=>{null==n||n(),e||this._parent.toggleActive(!1)},onInvoke:this.invokePublish.bind(this,e,t,a,o)})}},onExportCancel:(e,t)=>{i(),(0,E.$)(this._containerService,{...t,status:"cancel",reason:e})},onExportSuccess:(e,t)=>{i()},onExportFailed:(e,t)=>{(0,E.$)(this._containerService,{...t,status:"fail",reason:e}),i()}})})}async invokePublish(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{let o;let{width:s,height:c}=this._mainDraftService.dataSdk.draftView.getCanvasConfig(),l=this._mainDraftService.dataSdk.draftView.getAllTracks().map(e=>e.segments.map(t=>({...t.clone(),trackFlag:e.flag}))).flat().reduce((e,t)=>(e[t.id]=t,e),{}),d=t.reduce((e,t)=>{let r=l[t.id];return r&&e.push(r),e},[]),u=new Set(d.map(e=>e.id)),h=new Set,g=d.filter(e=>{let t=(0,C.Uu)(e);if(t)switch(!0){case(0,b.hey)(e):h.add("video");break;case(0,b.Ftn)(e):case(0,b.Q2R)(e):h.add("text");break;case(0,b.P2T)(e):h.add("sticker")}return t}),_=g.filter(e=>(0,b.hey)(e)),p=this._mainDraftService.dataSdk.getDraftStr(),f=(0,C.UZ)(JSON.parse(p)),{template:m,mutableVideoCovers:S}=(0,C.v1)(f,e,g);f=m;let M=(0,C.zY)(l,g),k=[];try{var a,n;(null==(o=JSON.parse(null!==(n=null===(a=b.lLh.getInstance().get(D.di))||void 0===a?void 0:a.getDraftStr(this._mainDraftService.dataSdk))&&void 0!==n?n:""))?void 0:o.video_algorithms)&&(k=o.video_algorithms,o.video_algorithms=k.filter(e=>!u.has(e.segmentId)))}catch{}let T=(await (0,w.H)(this._mainDraftService,this._resourceService)).reduce((e,t)=>(e[t.resourceId]=t,e),{}),I=this._workspaceService.getWorkspace(this._mainDraftService.draftWorkspaceManager.workspaceId),P=this._mainDraftService.saveManager.packageAssetsBuilder.buildPackageAssets(),x=P.filter(e=>!!e.source_path).reduce((e,t)=>{let r=this._mainDraftService.getMaterialReferenceSegmentIds(t.source_path);if(null==r?void 0:r.size){let[i]=r;e[t.source_path]=l[i]}return e},{}),{template:F,fileInfo:O}=(0,C.Mi)(l,T,I,P,x,k,f,S);f=F,f=(0,C.Ko)(f,g);let A={title:e.title,description:e.description,templateType:e.template_type,segmentTemplateCollection:e.segment_template_collection,templateJson:JSON.stringify(f),templateAttachmentJson:JSON.stringify(M),templateAttachmentVideoAlgorithmJson:JSON.stringify(o),fileInfo:O,fragmentCount:_.length,cover:e.cover,coverWidth:Math.floor(s)||0,coverHeight:Math.floor(c)||0,musicSource:(0,C.vj)(l,f),lang:v.Z.get("capcut_locale")||"en",sdkVersion:this._videoEnvironmentService.draftVersion,appVersion:this._videoEnvironmentService.appVersion,limit:{platform:["ios","android"],sdkVersionMin:this._videoEnvironmentService.draftVersion},extra:JSON.stringify({align_mode:e.align_mode,version:this._videoEnvironmentService.draftVersion,render_mode:"default",fragments:(0,C.bE)(_,f),change_type:Array.from(h)}),renderInfo:{taskId:r},settings:{isMute:!1,defaultOpenMode:e.default_open_mode,dynamicSlotsOption:e.dynamic_slots_option,canUpdateMusic:(0,C.XY)(l,f)},purchaseInfo:{amount:0,productId:"",currencyCode:"",needPurchase:!1,needUnlockByAd:!1},functions:(0,C.Q3)(l,f),workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId};this._slardarAdapterService.sendEvent("template_post_invoke",{payload:JSON.stringify((0,y.Z)(A,"cover"))});let j=await this._videoTemplateDataService.publishTemplate(A),[R,L]=j.pair();return R?(this._slardarAdapterService.sendEvent("template_post_error",{payload:JSON.stringify(R)}),(0,E.$)(this._containerService,{...i,status:"fail",reason:`${R.code}`})):(this._slardarAdapterService.sendEvent("template_post_success",{payload:JSON.stringify(L)}),(0,E.$)(this._containerService,{...i,status:"success"})),j}catch(e){throw this._slardarAdapterService.sendEvent("template_post_error",{payload:JSON.stringify(e)}),e}}_calcTemplateAnalysisDuration(e){return 2*e.filter(e=>{var t,r;return(null===(t=e.material)||void 0===t?void 0:t.type)&&[b.cVg.MetaTypeVideo,b.cVg.MetaTypePhoto,b.cVg.MetaTypeGif,b.cVg.MetaTypeMusic,b.cVg.MetaTypeExtractMusic,b.cVg.MetaTypeSound,b.cVg.MetaTypeRecord,b.cVg.MetaTypeImage].includes(null===(r=e.material)||void 0===r?void 0:r.type)}).length+x.jb}_getVideoExportCustomText(){let e=S.ZP.t("web_posttemplate_toast_exporting_video",{},"Exporting video..."),t=S.ZP.t("export_failed",{},"Couldn\u2019t export"),r=S.ZP.t("web_posttemplate_desc_not_close_window",{},"It may take a while. If you close the window, the template will not be posted.");return{title:S.ZP.t("web_posttemplate_button_post_template",{},"Post template"),progress:{title:{export:e,failed:t,hadCancel:t,load:e,loadFileFailed:t},content:{export:r,failed:e=>e===p.KH.order_failed?S.ZP.t("web_posttemplate_toast_not_enough_copyright",{},"You\u2019ve reached the maximum number of copyrighted materials to use today."):"",hadCancel:"",load:r,loadFileFailed:""},button:{export:S.ZP.t("web_posttemplate_button_cancel",{},"Cancel"),failed:S.ZP.t("web_posttemplate_button_retry",{},"Try again"),hadCancel:S.ZP.t("web_posttemplate_button_retry",{},"Try again")}}}}constructor(e,t,r,i,a,n,o,s,c){this._parent=e,this._slardarAdapterService=t,this._exportService=r,this._resourceService=i,this._mainDraftService=a,this._workspaceService=n,this._videoTemplateDataService=o,this._videoEnvironmentService=s,this._containerService=c}}F=(0,i.gn)([(0,i.fM)(1,T.L),(0,i.fM)(2,p.AA),(0,i.fM)(3,M.c),(0,i.fM)(4,_.n),(0,i.fM)(5,k.W),(0,i.fM)(6,o.A),(0,i.fM)(7,I.rO),(0,i.fM)(8,s.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ITemplatePostManager?Object:ITemplatePostManager,void 0===T.L?Object:T.L,void 0===p.AA?Object:p.AA,void 0===M.c?Object:M.c,void 0===_.n?Object:_.n,void 0===k.W?Object:k.W,void 0===o.A?Object:o.A,void 0===I.rO?Object:I.rO,void 0===s.t?Object:s.t])],F);var O=r("23052"),A=r("772322"),j=r("670933"),R=r("937802"),L=r("903554"),V=r("941806");r("843930");class U{_onCancelTemplatePost(){this._modules.templatePostManager.toggleActive(!1)}render(){return(0,A.jsx)(j.zt,{store:this._store,modules:this._modules,children:(0,A.jsxs)(R.$,{instantiationService:this._containerService,children:[(0,A.jsx)(V.Z,{onBack:this._onCancelTemplatePost.bind(this)}),(0,A.jsx)(L.Z,{})]})})}constructor(e,t,r){this._store=e,this._modules=t,this._containerService=r}}class B{static async getStoreInstance(e){if(!B._storeInstance){let t=await e.database.connect(a.L.id,n.b.name);t.ok&&(B._storeInstance=t.value)}return B._storeInstance}_init(){this._formManager.initData(!0),window.__templatePostManager=this}get ui(){return this._controller}get formManager(){return this._formManager}get publisherManager(){return this._publisherManager}toggleActive(e){this._store[f.gq].setActive(e),this._mainEditorWidgetService.timelineManager.templatePost.toggleTemplatePostMode(e),this._switchDisplay(e),this._switchInteract(e),e&&this._formManager.initData()}_switchInteract(e){if((0,c._)(50).then(()=>{this._mainEditorWidgetService.canvasManager.zoom.setZoom({zoom:100,isFit:!0})}),this._mainEditorWidgetService.canvasManager.readonlyFromOutsideSet(e),e){let e=[d.VD.SPACE].concat([h.Fu.SELECT_ALL,h.Fu.NEXT,h.Fu.PREVIOUS,h.Fu.TIMELINE_ZOOM_IN,h.Fu.TIMELINE_ZOOM_OUT].map(e=>[h.Yq[e].keyBindings.mac,h.Yq[e].keyBindings.win].flat()).flat());this._keyBindingService.disableKeybinding(e)}else this._keyBindingService.restoreKeybinding()}_switchDisplay(e){e?(this._workbenchService.hideSiderMenu(!0),this._workbenchService.hideTitleBar(!0),this._workbenchService.hideToolBar(!0),this._workbenchService.setWorkbenchClassName("workbench-container--with-template-post")):(this._workbenchService.hideSiderMenu(!1),this._workbenchService.hideTitleBar(!1),this._workbenchService.hideToolBar(!1),this._workbenchService.setWorkbenchClassName(void 0)),this._mainEditorWidgetService.timelineManager.timelineUI.panel.setCollapsed(!1)}constructor(e,t,r,i,a,n,o){this._workbenchService=e,this._mainEditorWidgetService=t,this._mainDraftService=r,this._videoTemplateDataService=i,this._exportService=a,this._keyBindingService=n,this._containerService=o,this._store=(0,f.kY)(),this._publisherManager=this._containerService.createInstance(F,this),this._formManager=this._containerService.createInstance(O.G,this,this._store[f.s9],this._publisherManager),this._controller=new U(this._store,{templatePostManager:this,videoTemplateDataService:this._videoTemplateDataService,workbenchService:this._workbenchService,mainEditorWidgetService:this._mainEditorWidgetService,mainDraftService:this._mainDraftService,exportService:this._exportService,keyBindingService:this._keyBindingService},this._containerService),this._init()}}B=(0,i.gn)([(0,i.fM)(0,l.e),(0,i.fM)(1,g.a),(0,i.fM)(2,_.n),(0,i.fM)(3,o.A),(0,i.fM)(4,p.AA),(0,i.fM)(5,u.d),(0,i.fM)(6,s.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===l.e?Object:l.e,void 0===g.a?Object:g.a,void 0===_.n?Object:_.n,void 0===o.A?Object:o.A,void 0===p.AA?Object:p.AA,void 0===u.d?Object:u.d,void 0===s.t?Object:s.t])],B)},145457:function(e,t,r){"use strict";r.d(t,{o:function(){return a}});var i=r(260963);class a{get active(){return this._active}setActive(e){this._active=e}constructor(){this._active=!1,(0,i.ky)(this)}}},897722:function(e,t,r){"use strict";r.d(t,{D:function(){return i},Y:function(){return a}});let i="siderMenuAudio",a={id:"sider-menu-audio",prefix:"SiderMenuAudio"}},744216:function(e,t,r){"use strict";r.d(t,{P:()=>v});var i=r("772322"),a=r("150564"),n=r("801497"),o=r("897722"),s=r("728631"),c=r("446198");r("738683");var l=r("233189"),d=r("376933"),u=r("472334"),h=r("97506"),g=r("105789"),_=r.n(g),p=r("370109"),f=r("848218");let m=e=>{let{containerWidth:t}=e;return(0,i.jsx)("div",{className:p.Z.entryContainer,children:(0,i.jsxs)(d.Z,{className:_()(p.Z.viewBox),activeTab:h.b.Music,children:[(0,i.jsx)(l.Z.TabPane,{title:n.ZP.t("music_web",{},"Music"),children:(0,i.jsx)("div",{className:_()(f.Z.entryContainer),children:(0,i.jsx)("div",{className:_()(f.Z.viewBox,{[f.Z.initializing]:!0}),children:(0,i.jsx)(u.ZP,{isLoading:!0,skeletons:["bar","tags","small-bar","song-list"],skeletonWidth:t})})})},h.b.Music),(0,i.jsx)(l.Z.TabPane,{title:n.ZP.t("effect_web_s",{},"Sound effects")},h.b.SoundEffect)]})})},v={siderMenu:[{id:o.D,name:s.j.SiderMenuAudio,position:"top",icon:()=>(0,i.jsx)(a.GCV,{}),tooltips:()=>n.ZP.t("audio_web",{},"Audio"),title:()=>n.ZP.t("audio_web",{},"Audio")}],siderMenuPanel:[{name:s.j.SiderMenuAudio,skeleton:e=>{let{containerWidth:t}=e;return(0,i.jsx)(m,{containerWidth:(0,c._)(t)})}}]}},200507:function(e,t,r){"use strict";r.d(t,{P:function(){return i}});let i=(0,r(407880).c)({numTypes:6})},35528:function(e,t,r){"use strict";r.d(t,{P:function(){return u}});var i=r(772322),a=r(150564),n=r(801497),o=r(111937),s=r(728631),c=r(472334),l=r(446198),d=r(676693);let u={siderMenu:[{id:o.DQ,name:s.j.SiderMenuCaption,position:"top",icon:()=>(0,i.jsx)(a.EPA,{}),tooltips:()=>n.ZP.t("web_subtitleAndText_text_create",{},"Caption"),title:()=>n.ZP.t("web_subtitleAndText_text_create",{},"Caption")}],siderMenuPanel:[{name:s.j.SiderMenuCaption,skeleton:e=>{let{containerWidth:t}=e;return(0,i.jsx)("div",{style:{marginTop:d.Z["sider-menu-panel-margin-top"],padding:`0 ${d.Z["sider-menu-panel-padding-x"]}`},children:(0,i.jsx)(c.ZP,{isLoading:!0,skeletons:["bar"],skeletonWidth:(0,l._)(t)})})},disableCacheRenderedDom:!0}]}},645199:function(e,t,r){"use strict";r.d(t,{M:function(){return g}});var i=r(772322);r(738683);var a=r(233189),n=r(376933),o=r(472334),s=r(127830),c=r(105789),l=r.n(c),d=r(801497),u=r(914264),h=r(915123);let g=e=>{let{containerWidth:t}=e;return(0,i.jsx)("div",{className:u.Z.entryContainer,children:(0,i.jsxs)(n.Z,{className:l()(u.Z.viewBox),activeTab:s._g.Effects,children:[(0,i.jsx)(a.Z.TabPane,{title:d.ZP.t("web_multi_track_button_video _effects",{},"Video effects"),children:(0,i.jsx)("div",{className:l()(h.Z.entryContainer),children:(0,i.jsx)("div",{className:l()(h.Z.viewBox,{[h.Z.initializing]:!0}),children:(0,i.jsx)(o.ZP,{isLoading:!0,skeletons:["tags","small-bar","base-title-list","tags","small-bar","base-title-list"],skeletonWidth:t,size:"small"})})})},s._g.Effects),(0,i.jsx)(a.Z.TabPane,{title:d.ZP.t("web_multi_track_button_body_effects",{},"Body effects")},s._g.FaceProp)]})})}},586210:function(e,t,r){"use strict";r.d(t,{$X:function(){return S},AQ:function(){return y},Aq:function(){return l},DQ:function(){return n},JK:function(){return v},R$:function(){return o},Yd:function(){return d},ZO:function(){return g},ZR:function(){return m},_b:function(){return p},_x:function(){return f},ho:function(){return c},ii:function(){return s},jB:function(){return h},q1:function(){return u},sF:function(){return _}});var i,a=r(801497);let n="siderMenuElement",o=100,s=70,c=92,l=3/4,d={id:"sider-menu-element",prefix:"SiderMenuElement"};var u=((i={}).all="all",i.video="video",i.photo="photo",i.sticker="sticker",i.giphy="giphy",i.digitalHuman="digitalHuman",i);let h=["combine","combine","square","square"],g=["combine","combine","square","square"],_=["combine","combine","ai-character-cate","square","square"],p={video:"stock_videos",photo:"photos",sticker:"stickers",giphy:"giphy",digitalHuman:"ai_character",all:"all"},f={video:"material_lib",photo:"photos",sticker:"sticker",giphy:"giphy",digitalHuman:"ai_character",all:"elements"},m={video:"material_lib",photo:"photos",sticker:"sticker",giphy:"giphy",digitalHuman:"ai_character",all:"elements"},v=[{key:"all",get title(){return a.ZP.t("web_left_panel_tab_all",{},"All")}},{key:"video",get title(){return a.ZP.t("web_left_panel_tab_stock_videos",{},"Videos")}},{key:"photo",get title(){return a.ZP.t("web_left_panel_tab_photos",{},"Photos")}},{key:"digitalHuman",get title(){return a.ZP.t("web_edit_button_ai_character",{},"AI Characters")}},{key:"sticker",get title(){return a.ZP.t("web_left_panel_tab_stickers",{},"Stickers")}},{key:"giphy",get title(){return a.ZP.t("web_left_panel_tab_giphy",{},"Giphy")}}],y=[{key:"video",params:{materialCategory:"material_lib",materialGroupcategory:"stock_videos"}},{key:"photo",params:{materialCategory:"photos",materialGroupcategory:"photos"}},{key:"sticker",params:{materialCategory:"sticker",materialGroupcategory:"stickers"}},{key:"giphy",params:{materialCategory:"giphy",materialGroupcategory:"giphy",materialThirdcategory:"stickers"}},{key:"giphy",params:{materialCategory:"giphy",materialGroupcategory:"giphy",materialThirdcategory:"gifs"}},{key:"digitalHuman",params:{materialCategory:"ai_character",materialGroupcategory:"ai_character"}}],S={all:[],giphy:["color","ratio"],video:[],photo:[],sticker:["color","ratio"],digitalHuman:["color","ratio"]}},644241:function(e,t,r){"use strict";r.d(t,{DQ:function(){return a},F:function(){return d},Ff:function(){return s},V_:function(){return o},dM:function(){return l},iz:function(){return n},tz:function(){return c}});var i=r(241254);let a="siderMenuMedia",n=["bar","upload-action","cloud-cards"],o=10,s=20,c={scenario:i.HI.VideoEditor,feature_key:i._A.SubtitleRecognition,feature_entrance:i.zU.Editor,feature_entrance_detail:`${i.zU.Editor}-elements-upload-${i._A.SubtitleRecognition}`},l="drainage_banner_show_record",d="has_record_drainage_banner_show"},235684:function(e,t,r){"use strict";r.d(t,{P:function(){return c}});var i=r(772322),a=r(801497),n=r(326211),o=r(458115),s=r(728631);let c={siderMenu:[{id:n.D,name:s.j.SiderMenuShortcut,position:"bottom",icon:()=>(0,i.jsx)(o.X,{}),tooltips:()=>a.ZP.t("web_materialSearch_text_shortcuts",{},"Shortcuts")}]}},185305:function(e,t,r){"use strict";r.d(t,{P:function(){return h}});var i=r(772322),a=r(150564),n=r(801497),o=r(728631),s=r(105789),c=r.n(s),l=r(339992),d=r(472334),u=r(446198);let h={siderMenu:[{name:o.j.SiderMenuTransition,position:"top",icon:()=>(0,i.jsx)(a.$cv,{}),tooltips:()=>n.ZP.t("transitions",{},"Transitions"),title:()=>n.ZP.t("transitions",{},"Transitions")}],siderMenuPanel:[{name:o.j.SiderMenuTransition,skeleton:e=>{let{containerWidth:t}=e;return(0,i.jsx)("div",{className:c()(l.Z.entryContainer,{[l.Z.initializing]:!0}),children:(0,i.jsx)(d.ZP,{isLoading:!0,skeletonWidth:(0,u._)(t),skeletons:["tags","small-bar","base-title-list","tags","small-bar","base-title-list"],size:"small"})})}}]}},763695:function(e,t,r){"use strict";r.d(t,{D:function(){return i}});let i="siderMenuStock"},850826:function(e,t,r){"use strict";r.d(t,{D:function(){return i},j:function(){return a}});let i="titlebarDraftDuplicate",a={TitlebarDraftDuplicate:"TitlebarDraftDuplicate"}},505730:function(e,t,r){"use strict";r.d(t,{P:function(){return n}});var i=r(850826),a=r(515379);let n={titleBar:[{name:i.j.TitlebarDraftDuplicate,position:"left",type:"Custom",contributionSymbol:i.D,onlyShowedWhenEditable:!1,order:a.z.Duplicate}]}},308194:function(e,t,r){"use strict";r.d(t,{_:function(){return d}});var i=r(772322);r(959195);var a=r(389910),n=r(557598),o=r(958444),s=r(105789),c=r.n(s);r(690988);var l=r(218571);let d=e=>{let{active:t,isAvailable:r,showGuide:s,ratio:d,prefetchResources:u}=e;if((0,l.useEffect)(()=>{setTimeout(()=>{null==u||u()},3e3)},[]),!d)return(0,i.jsx)(i.Fragment,{});let h=r?n.MF[d]:n.Q8[d];return(0,i.jsxs)("div",{className:c()("header-ratio-container",{highlight:r}),children:[(0,i.jsx)("span",{className:"header-ratio-icon",children:h&&(0,i.jsx)(h,{})}),s?(0,i.jsx)(a.Z,{dot:!0,count:1,style:{lineHeight:"0"},offset:[4,-2],children:(0,i.jsx)("span",{className:"header-ratio-text",children:d})}):(0,i.jsx)("span",{className:"header-ratio-text",children:d}),t?(0,i.jsx)(o.CYX,{size:12,className:c()("header-icon-down",{left:s})}):(0,i.jsx)(o.MQ,{size:12,className:c()("header-icon-down",{left:s})})]})}},185017:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var i=r(772322);r(218571);var a=r(568998);r(347600);let n=e=>{let{onClick:t,onMouseOver:r,onMouseEnter:n,disabled:o}=e;return(0,i.jsx)("div",{className:"Lv_Task-wrapper",onClick:t,onMouseOver:r,onMouseEnter:n,children:(0,i.jsx)("div",{className:"Lv_Task-static-icon",children:(0,i.jsx)(a.Tnb,{size:20,style:o?{color:"var(--lvv-color-text-disable)",cursor:"not-allowed"}:void 0})})})}},528150:function(e,t,r){"use strict";r.d(t,{D:function(){return i},j:function(){return a}});let i="titlebarPCDownload",a={TitlebarToolbarPCDownload:i}},603314:function(e,t,r){"use strict";r.d(t,{D:function(){return i},j:function(){return a}});let i="titlebarReadonlyTag",a={TitlebarReadonlyTag:i}},962688:function(e,t,r){"use strict";r.d(t,{DQ:function(){return n},Mj:function(){return l},RY:function(){return c},jR:function(){return o},si:function(){return s}});var i,a=r(801497);let n="titlebarSaveStatus",o={TitlebarSaveStatus:n};var s=((i={})[i.None=0]="None",i[i.hasStorageExpandAbilityAndMultiSpace=1]="hasStorageExpandAbilityAndMultiSpace",i[i.hasStorageExpandAbilityNotMultiSpace=2]="hasStorageExpandAbilityNotMultiSpace",i[i.notStorageExpandAbilityNotMultiSpace=3]="notStorageExpandAbilityNotMultiSpace",i[i.notStorageExpandAbilityAndMultiSpace=4]="notStorageExpandAbilityAndMultiSpace",i);let c={0:e=>({content:"",cancelText:"",okText:""}),1:e=>({content:a.ZP.t("web_visualPolish_toast_spacelimit4",{placeholder1:e},"{placeholder1} has reached the storage limit, You can expand the storage, or change the saving location"),cancelText:a.ZP.t("web_visualPolish_button_changeSavingLocation",{},"Change saving location"),okText:a.ZP.t("to_expand_space",{},"Expand")}),2:e=>({content:a.ZP.t("web_visualPolish_toast_spacelimit2",{placeholder1:e},"{placeholder1} has reached the storage limit, You can delete some of your cloud files or expand your cloud storage."),cancelText:a.ZP.t("web_a_template_got_it",{},"Got it"),okText:a.ZP.t("to_expand_space",{},"Expand")}),3:e=>({content:a.ZP.t("web_visualPolish_toast_spacelimit1",{placeholder1:e},"{placeholder1} has reached the storage limit. You can delete some of your cloud files"),cancelText:a.ZP.t("web_try_again",{},"Try again"),okText:a.ZP.t("web_a_template_got_it",{},"Got it")}),4:e=>({content:a.ZP.t("web_visualPolish_toast_spacelimit3",{placeholder1:e},"{placeholder1} has reached the storage limit, You can delete some of your cloud files, or change the saving location"),cancelText:a.ZP.t("web_try_again",{},"Try again"),okText:a.ZP.t("web_visualPolish_button_changeSavingLocation",{},"Change saving location")})},l=e=>`cloud-draft-async-save-${e}`},534822:function(e,t,r){"use strict";r.d(t,{P:function(){return d}});var i=r(772322),a=r(326106),n=r(302343),o=r(515379),s=r(420092),c=r(682430),l=r(768133);let d={titleBar:[{name:s.jR.TitlebarToolbarViewMode,type:a._.Custom,position:"right",style:{marginLeft:"4px",marginRight:"4px"},orderLevel:n.r.low,order:o.r.ToolbarViewMode,contributionSymbol:s.DQ,content:e=>(0,i.jsx)(c.Z,{visuallyDisabled:!0,onClick:e.onClick,onMouseOver:e.onHover,onMouseEnter:e.onEnter}),showInMenu:{priority:l.Yg.FixedMode,group:l.kS.FixedMode,withMenu:!1,priorityInMenu:l.$9.FixedMode}}]}},211570:function(e,t,r){"use strict";r.d(t,{x:function(){return a}});var i=r(426336);let a=[i.Eu.KFTypePositionX,i.Eu.KFTypePositionY,i.Eu.KFTypePositionXY,i.Eu.KFTypeScale,i.Eu.KFTypeScaleX,i.Eu.KFTypeScaleY]},150280:function(e,t,r){"use strict";r.d(t,{K$:function(){return v},Nk:function(){return h},aS:function(){return k},d_:function(){return y},i8:function(){return c},iT:function(){return l},mD:function(){return M},nN:function(){return S},pv:function(){return b},r3:function(){return s},rb:function(){return u},vW:function(){return d}});var i,a,n,o=r(426336);var s=((i={}).Basic="basic",i.HSL="hsl",i.Curves="curve",i);let c={[o.cVg.MetaTypeSaturation]:"saturation",[o.cVg.MetaTypeTemperature]:"colorTemperature",[o.cVg.MetaTypeHue]:"hue"},l={[o.cVg.MetaTypeBrightness]:"brightness",[o.cVg.MetaTypeContrast]:"contrast",[o.cVg.MetaTypeLightSensation]:"lightSensation",[o.cVg.MetaTypeHighlight]:"highlight",[o.cVg.MetaTypeShadow]:"shadow"},d={[o.cVg.MetaTypeSharpen]:"sharpening",[o.cVg.MetaTypeVignetting]:"vignetting",[o.cVg.MetaTypeFade]:"fade",[o.cVg.MetaTypeParticle]:"particle"};var u=((a={}).Color="color",a.Lightness="lightness",a.Effects="effects",a);let h={color:c,lightness:l,effects:d},g=[o.Eu.KFTypeSaturation,o.Eu.KFTypeTemperature,o.Eu.KFTypeHue],_=[o.Eu.KFTypeBrightness,o.Eu.KFTypeContrast,o.Eu.KFTypeLightSensatione,o.Eu.KFTypeHightLight,o.Eu.KFTypeChromaShadow],p=[o.Eu.KFTypeSharpen,o.Eu.KFTypeVignetting,o.Eu.KFTypeFade,o.Eu.KFTypeParticle],f=new Set(g),m=new Set(_),v={color:f,lightness:m,effects:new Set(p)},y=50,S=50,b=100;var M=((n={}).Hue="hue",n.Saturation="saturation",n.Lightness="lightness",n);let k={[o.SXD.HslColorRed]:"red",[o.SXD.HslColorOrange]:"orange",[o.SXD.HslColorYellow]:"yellow",[o.SXD.HslColorGreen]:"green",[o.SXD.HslColorCyan]:"cyan",[o.SXD.HslColorBlue]:"blue",[o.SXD.HslColorPurple]:"violet",[o.SXD.HslColorPurpleRed]:"magenta"}},611818:function(e,t,r){"use strict";r.d(t,{c:function(){return g}});var i=r(772322);r(17435);var a=r(221625),n=r(629913),o=r(218571),s=r(105789),c=r.n(s),l=r(426336),d=r(150564),u=r(273791),h=r(801497);r(452487);let g=e=>{let{segment:t}=e,{curveEditorModel:r}=e,s=(0,o.useCallback)(()=>{r.onCompare()},[]),g=(0,o.useCallback)(()=>{r.onCancelCompare()},[]),_=(0,o.useCallback)(()=>{r.onStartPickColor()},[]),p=(0,o.useCallback)(()=>{r.onReset()},[]),f=(0,o.useRef)(null),[m,v]=(0,o.useState)(!1),y=(0,o.useCallback)(e=>{r.onPickColor(e),v(!1)},[]);(0,a.default)(()=>{y("")});let S=(0,l.E6P)(t)?"#canvas-cover":`[data-widget-id="${t.id}"]`;return(0,i.jsxs)("div",{className:"attribute-color-curves-chart-bar",children:[(0,i.jsx)("div",{className:"attribute-color-curves-chart-bar-title",children:h.ZP.t("web_adjust_screen_title_rgb",{},"RGB curve")}),(0,i.jsxs)("div",{className:"attribute-color-curves-chart-bar-icon",onMouseEnter:()=>{var e;null===(e=f.current)||void 0===e||e.preparePickColor()},children:[(0,i.jsx)(u.Z,{onColorPick:y,ref:f,triggerTarget:S,pickerCanvas:"#video-editor-canvas",ignoreClass:["point","widget-control-point"],children:(0,i.jsx)("div",{className:c()("attribute-color-curves-chart-bar-icon-item",{active:m}),onClick:()=>{if(m){var e;v(!1),null===(e=f.current)||void 0===e||e.cancelColorPick(),y("");return}_(),setTimeout(()=>{var e;null===(e=f.current)||void 0===e||e.pickColorTrigger(),v(!0)},200)},children:(0,i.jsx)(n.Z,{content:h.ZP.t("web_adjust_screen_text_color_pick",{},"Color picker"),children:(0,i.jsx)(d.BcP,{})})})}),(0,i.jsx)("div",{className:c()("attribute-color-curves-chart-bar-icon-item","normal",{disabled:!r.canCompare}),onMouseEnter:s,onMouseLeave:g,children:(0,i.jsx)(n.Z,{content:h.ZP.t("web_adjust_screen_text_see_original",{},"See original"),disabled:!r.canCompare,children:(0,i.jsx)(d.rRg,{})})}),(0,i.jsx)("div",{className:c()("attribute-color-curves-chart-bar-icon-item",{disabled:!r.canReset}),onClick:()=>{r.canReset&&p()},children:(0,i.jsx)(n.Z,{content:h.ZP.t("web_adjust_screen_text_reset",{},"Reset"),disabled:!r.canReset,children:(0,i.jsx)(d.pD$,{})})})]})]})}},172027:function(e,t,r){"use strict";let i;r.d(t,{Z:function(){return c}});var a=r(772322),n=r(218571),o=r(195291);r(243773);let s=e=>{let{children:t}=e;return(0,o.createPortal)(t,e.containerRef.current)},c=e=>{let{activeColor:t,position:r}=e,o=(0,n.useMemo)(()=>i?i:((i=document.createElement("div")).className="color-picker-anchor-wrapper",i.id="color-picker-anchor-wrapper",document.body.appendChild(i),i),[]),c=(0,n.useRef)(o);return(0,a.jsx)(s,{containerRef:c,children:(0,a.jsx)("div",{className:"color-picker-anchor",style:{left:r[0]-74,top:r[1]-74},children:(0,a.jsx)("div",{className:"color-picker-anchor-inner",style:{outlineColor:t},children:(0,a.jsx)("div",{className:"color-picker-anchor-point",style:{backgroundColor:t}})})})})}},959542:function(e,t,r){"use strict";r.d(t,{W:function(){return g},u:function(){return h}});var i=r(260963),a=r(736323),n=r(392486),o=r(615585),s=r(650248),c=r(426336),l=r(232297),d=r(108692),u=r(896413);let h=new l.v("color-controls-curves-preset");class g{get customPoints(){var e,t;return(null===(e=this._customPreset)||void 0===e?void 0:e.curveValue)?(0,n.gy)(null===(t=this._customPreset)||void 0===t?void 0:t.curveValue):{}}get canReset(){var e;if(!(null===(e=this.curvePreset)||void 0===e?void 0:e.curveValue)||!this.points)return!1;let t=(0,n.gy)(this.curvePreset.curveValue);return this._getIsDiffPoints(this.points,t)}get canCompare(){return!!this.points&&this._getIsDiffPoints(this.points,this.customPoints)}onReset(){var e;if(!(null===(e=this.curvePreset)||void 0===e?void 0:e.curveValue))return;let t=(0,n.gy)(this.curvePreset.curveValue);this.onAfterChangeWithCache(t)}onCompare(){this._compareTimer&&clearTimeout(this._compareTimer),this.setIsPreview(!0),this.handleReportAdjust(a.aR.seeOriginal),this.onAfterChange(this.customPoints,!1)}onCancelCompare(){this.points&&this.onAfterChange(this.points,!1),this._compareTimer=setTimeout(()=>{this.setIsPreview(!1),this._compareTimer&&clearTimeout(this._compareTimer)},500)}onStartPickColor(){if(!this._segment)return;let{targetTimerange:e}=this._segment,t=this._containerService.invokeFunction(e=>{let{dataSdk:t}=e.get(d.n);return t.draftView.getAllTracks()}),r=(0,o.u)(this._segment,t);this._hideSegmentIds=r,this.onToggleVideoChromaPick({segmentId:this._segment.id,hiddenSegIds:r,enableEffectGroup:!1,enableFilterGroup:!1,enableVmixGroup:!1,enableLutGroup:!1,enableAdjustGroup:!1,enableHslGroup:!1},!1);let i=this._containerService.invokeFunction(e=>e.get(u.a).playerManager.status.progress);!(i<e.start||i>e.duration)&&this.setDisabledWidgetClick(!0)}onPickColor(e){var t;let r;this.setDisabledWidgetClick(!1),this._hideSegmentIds&&this.onToggleVideoChromaPick({segmentId:this._segment.id,hiddenSegIds:this._hideSegmentIds,enableEffectGroup:!1,enableFilterGroup:!1,enableVmixGroup:!1,enableLutGroup:!1,enableAdjustGroup:!1,enableHslGroup:!1},!0),this._hideSegmentIds=[];let i=(0,n.dT)(e);if(!i)return;let{r:o,g:s,b:c}=i;switch(this._activeColorType){case a.wD.Luma:r=(.299*o+.587*s+.114*c)/255;break;case a.wD.Red:r=o/255;break;case a.wD.Green:r=s/255;break;case a.wD.Blue:r=c/255;break;default:r=-1}let{startPointIndex:l,currentLineControlPoints:d}=this._getControlPoints(r);if(l<0)return;let u=(null!==(t=this.points[this._activeColorType])&&void 0!==t?t:[]).map(e=>{var t,r;return{x:null===(t=e.anchor)||void 0===t?void 0:t.x,y:null===(r=e.anchor)||void 0===r?void 0:r.y}}),h=(0,n.N8)(r,d);if(h){u.splice(l+1,0,{x:r,y:h});let e=(0,n.F0)(u),t=u.map((t,r)=>({anchor:t,left_control:0===r?void 0:e[2*r-1],right_control:r===u.length-1?void 0:e[2*r]}));this.handleReportAdjust(a.aR.colorPicker),this.onAfterChangeWithCache({...this.points,[this._activeColorType]:t}),this.controlSelectedIndex=l+1}}addPoint(e,t){let[r]=t,i=e.activeLine.points.length,n=[...e.activeLine.points];if(r<=0||r>=e.activeLine.points[i-1][0])return n;let o=n.findIndex((e,t)=>{var i;return r>=e[0]&&r<=(null===(i=n[t+1])||void 0===i?void 0:i[0])});return n.splice(o+1,0,t),this.handleReportAdjust(a.aR.addPoint),this.afterUpdatePoint({...e,activeLine:{color:e.activeLine.color,points:n}}),n}deletePoint(e,t){if(0!==t&&t!==e.activeLine.points.length-1){let r=e.activeLine.points.reduce((e,r,i)=>(t!==i&&e.push(r),e),[]);this.handleReportAdjust(a.aR.deletePoint),this.afterUpdatePoint({...e,activeLine:{color:e.activeLine.color,points:r}})}}afterUpdatePoint(e){let t=this._transferEchartLinesToCurvePonts(e);this.onAfterChangeWithCache(t)}onAfterChangeWithCache(e){var t,r,i;this.setIsPreview(!1);let a=null!==(t=this.getPresetCache())&&void 0!==t?t:{},{presetPoints:n=[]}=a,o=n.find(e=>{var t;return e.name===(null===(t=this.curvePreset)||void 0===t?void 0:t.name)});o?o.points=e:n.push({points:e,name:null!==(i=null===(r=this.curvePreset)||void 0===r?void 0:r.name)&&void 0!==i?i:""}),a.presetPoints=n,this.setPresetCache(a),this.updatePointOrCommit(void 0,()=>this.onAfterChange(e))}updateCurvePreset(e){var t;if((null===(t=this.curvePreset)||void 0===t?void 0:t.name)!==(null==e?void 0:e.name))this.curvePreset=e}updateCustomPreset(e){this._customPreset=e}updatePointsData(e){this.points=e}updateSegment(e){this._segment=e}setDisabledWidgetClick(e){this._containerService.invokeFunction(t=>{t.get(u.a).canvasManager.disabledSelectWidget(e)})}getPresetCache(){return h.get(this._draftId)}setPresetCache(e){h.set(this._draftId,e)}saveDataApplyToAll(){var e,t;let r=null!==(t=this.getPresetCache())&&void 0!==t?t:{activeName:{}};!r.activeName&&(r.activeName={});let i=this._containerService.invokeFunction(e=>{let{dataSdk:t}=e.get(d.n);return t.draftView.getAllTracks()});if(null===(e=this.curvePreset)||void 0===e?void 0:e.name)i.reduce((e,t)=>(t.segments.forEach(t=>{(0,c.hey)(t)&&e.push(t.id)}),e),[]).forEach(e=>{var t;r.activeName[e]=null===(t=this.curvePreset)||void 0===t?void 0:t.name}),this.setPresetCache(r)}_getColorCurvesPoint(e){let t=(0,n.F0)(e.map(n.XH));return e.map((r,i)=>({anchor:(0,n.XH)(r),leftControl:0===i?void 0:t[2*i-1],rightControl:i===e.length-1?void 0:t[2*i]}))}_transferEchartLinesToCurvePonts(e){let t={},r=0;return a.UX.forEach(i=>{if(i.lineColor===e.activeLine.color)t[i.name]=this._getColorCurvesPoint(e.activeLine.points);else{var a,n;t[i.name]=this._getColorCurvesPoint(null!==(n=null===(a=e.inactiveLines.find(e=>e.color===i.lineColor))||void 0===a?void 0:a.points)&&void 0!==n?n:e.inactiveLines[r].points),r++}}),t}_getControlPoints(e){var t;let r=null!==(t=this.points[this._activeColorType])&&void 0!==t?t:[],i=r.findIndex((t,i)=>{var n,o,s;return(null===(n=t.anchor)||void 0===n?void 0:n.x)!==void 0&&(null===(s=r[i+1])||void 0===s?void 0:null===(o=s.anchor)||void 0===o?void 0:o.x)!==void 0&&e>t.anchor.x+a.iZ&&e<r[i+1].anchor.x-a.iZ});if(i<0)return{startPointIndex:i};let o=r.map(e=>{var t,r;return{x:null===(t=e.anchor)||void 0===t?void 0:t.x,y:null===(r=e.anchor)||void 0===r?void 0:r.y}}),s=(0,n.F0)(o);return{currentLineControlPoints:[r[i].anchor,s[2*i],s[2*i+1],r[i+1].anchor],startPointIndex:i}}constructor(e){this.updatePointOrCommit=(0,s.Z)((e,t)=>{if(t)null==t||t();else if(e){let t=this._transferEchartLinesToCurvePonts(e);this.onChange(t)}},200,{trailing:!0,leading:!0}),this.curvePreset=null,this.isPreview=!1,this.points={},this.controlSelectedIndex=-1,this._customPreset=null,this._activeColorType=a.wD.Luma,this._hideSegmentIds=[],this._compareTimer=null,this.setActiveColorType=e=>{this._activeColorType=e,this.onToggleColorType(e),this.updateControlSelectedIndex(null)},this.setIsPreview=e=>{this.isPreview=e},this.handleReportAdjust=e=>{var t;let r=null===(t=this.curvePreset)||void 0===t?void 0:t.name,i=this._activeColorType,n=null!=e?e:a.aR.choosePreset;this.reportCurveAdjust(r,i,n)},this.updateControlSelectedIndex=e=>{this.controlSelectedIndex=e},this._getIsDiffPoints=(e,t)=>!Object.values(a.wD).every(r=>{var i,a;let n=null!==(i=e[r])&&void 0!==i?i:[],o=null!==(a=t[r])&&void 0!==a?a:[];return n.length===o.length&&n.every((e,t)=>{var r,i,a,n;return(null===(r=e.anchor)||void 0===r?void 0:r.x)===(null===(i=o[t].anchor)||void 0===i?void 0:i.x)&&(null===(a=e.anchor)||void 0===a?void 0:a.y)===(null===(n=o[t].anchor)||void 0===n?void 0:n.y)})}),this.onChange=e.onChange,this.onAfterChange=e.onAfterChange,this.onToggleVideoChromaPick=e.onToggleVideoChromaPick,this.onToggleColorType=e.onToggleColorType,this.reportCurveAdjust=e.reportCurveAdjust,this._segment=e.segment,this._containerService=e.containerService,this._draftId=this._containerService.invokeFunction(e=>e.get(d.n).dataSdk.draftView.getDraftId()),(0,i.ky)(this)}}},413798:function(e,t,r){"use strict";r.d(t,{V:function(){return o}});var i=r(772322),a=r(218571),n=r(736323);let o=(0,a.memo)(e=>{let{onToggle:t,curveColorType:r}=e;return(0,i.jsx)("div",{className:"attribute-color-curves-chart-tabs",children:n.UX.map(e=>(0,i.jsx)("div",{onClick:()=>{t(e.name)},className:`attribute-color-curves-chart-tabs-item
      ${r===e.name?"attribute-color-curves-chart-tabs-item-active":""}`,children:(0,i.jsx)("div",{className:"attribute-color-curves-chart-tabs-item-inner",style:{backgroundColor:e.color,borderColor:e.borderColor}})},e.name))})})},382621:function(e,t,r){"use strict";r.d(t,{Q:function(){return n}});var i=r(731992),a=r(127830);async function n(e,t){for(let r of t){let t=(0,i.l)(a._g.Integration,r),n=e.ensureEffect(t);await n.waitForResourceValueReady()}}},517614:function(e,t,r){"use strict";r.d(t,{El:function(){return l},JN:function(){return c},No:function(){return s},Wh:function(){return o}});var i=r(426336),a=r(127830),n=r(249656);let o=[{md5:"2b6fdbe3e3477e4006a63045c4631537",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/2b6fdbe3e3477e4006a63045c4631537",name:"fade",metaType:79,effectId:"13170322",resourceId:"7199836446956458497",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"6.6.0",materialIds:[""],persistType:i.cVg.MetaTypeFade,version:void 0,key:"/integration/2b6fdbe3e3477e4006a63045c4631537",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/2b6fdbe3e3477e4006a63045c4631537"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"2e8325f71937d19224bcf03e555ea0f1",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/2e8325f71937d19224bcf03e555ea0f1",name:"light_sensation",metaType:79,effectId:"13170318",resourceId:"7199836632386638338",relatedId:"",sourcePlatform:0,requirements:["blit"],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{isEHEffect:!1,triggerJson:null},appId:0,sdkVersion:"6.6.0",materialIds:[""],persistType:i.cVg.MetaTypeLightSensation,version:void 0,key:"/integration/2e8325f71937d19224bcf03e555ea0f1",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/2e8325f71937d19224bcf03e555ea0f1"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"af36483c66438cc12d6e92a65a1656a5",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/af36483c66438cc12d6e92a65a1656a5",name:"brightness_v2",metaType:79,effectId:"13170326",resourceId:"7199836837035119105",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"9.5.0",materialIds:[""],persistType:i.cVg.MetaTypeBrightness,version:"v2",key:"/integration/af36483c66438cc12d6e92a65a1656a5",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/af36483c66438cc12d6e92a65a1656a5"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"bad1d02823e4e07a9af035bb339b3dc7",url:"https://lf19-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/bad1d02823e4e07a9af035bb339b3dc7",name:"contrast_v1",metaType:79,effectId:"13170308",resourceId:"7199836817103786497",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"10.1.0",materialIds:[""],persistType:i.cVg.MetaTypeContrast,version:"v1",key:"/integration/bad1d02823e4e07a9af035bb339b3dc7",type:a._g.Integration,package:{uri:"",urlList:["https://lf19-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/bad1d02823e4e07a9af035bb339b3dc7"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"3c832c1b6333797f428fc4ac0cb69415",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/cfca698bebfe77ae225b9498d5878e89",name:"particle_v1",metaType:79,effectId:"13170323",resourceId:"7199836762879824386",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"10.1.0",materialIds:[""],persistType:i.cVg.MetaTypeParticle,version:"v1",key:"/integration/3c832c1b6333797f428fc4ac0cb69415",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/cfca698bebfe77ae225b9498d5878e89"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"678935193ee7c06bef2cd034566b95fc",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/678935193ee7c06bef2cd034566b95fc",name:"saturation_v1",metaType:79,effectId:"13170325",resourceId:"7199836752415035906",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"10.1.0",materialIds:[""],persistType:i.cVg.MetaTypeSaturation,version:"v1",key:"/integration/678935193ee7c06bef2cd034566b95fc",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/678935193ee7c06bef2cd034566b95fc"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"546140de633b7159491406d85c5805c5",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/546140de633b7159491406d85c5805c5",name:"shadow_highlight_v2",metaType:79,effectId:"13170312",resourceId:"7199836722098606594",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"9.7.0",materialIds:[""],persistType:i.cVg.MetaTypeHighlight,version:"v2",key:"/integration/546140de633b7159491406d85c5805c5",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/546140de633b7159491406d85c5805c5"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"546140de633b7159491406d85c5805c5",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/546140de633b7159491406d85c5805c5",name:"shadow_highlight_v2",metaType:79,effectId:"13170312",resourceId:"7199836722098606594",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"9.7.0",materialIds:[""],persistType:i.cVg.MetaTypeShadow,version:"v2",key:"/integration/546140de633b7159491406d85c5805c5",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/546140de633b7159491406d85c5805c5"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"a973f6ef7b7133d1a172da99b1b3a851",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/a973f6ef7b7133d1a172da99b1b3a851",name:"sharp_v1",metaType:79,effectId:"13170310",resourceId:"199836696236528130",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"10.1.0",materialIds:[""],persistType:i.cVg.MetaTypeSharpen,version:"v1",key:"/integration/a973f6ef7b7133d1a172da99b1b3a851",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/a973f6ef7b7133d1a172da99b1b3a851"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"d82e84b0500e9588fd8e90400a63c2c2",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/d82e84b0500e9588fd8e90400a63c2c2",name:"tone_temperature_v2",metaType:79,effectId:"13170309",resourceId:"7199836679685804546",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"9.5.0",materialIds:[""],persistType:i.cVg.MetaTypeHue,version:"v2",key:"/integration/d82e84b0500e9588fd8e90400a63c2c2",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/d82e84b0500e9588fd8e90400a63c2c2"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"d82e84b0500e9588fd8e90400a63c2c2",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/d82e84b0500e9588fd8e90400a63c2c2",name:"tone_temperature_v2",metaType:79,effectId:"13170309",resourceId:"7199836679685804546",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"9.5.0",materialIds:[""],persistType:i.cVg.MetaTypeTemperature,version:"v2",key:"/integration/d82e84b0500e9588fd8e90400a63c2c2",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/d82e84b0500e9588fd8e90400a63c2c2"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},{md5:"f5e6ec39e1aedd80af25a614e4a0ad36",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/721feed87396271a2001fa1fcdb19520",name:"vignetting_v1",metaType:79,effectId:"13170292",resourceId:"7199836665496474113",relatedId:"",sourcePlatform:0,requirements:[],modelNames:[],isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},appId:0,sdkVersion:"10.1.0",materialIds:[""],persistType:i.cVg.MetaTypeVignetting,version:"v1",key:"/integration/f5e6ec39e1aedd80af25a614e4a0ad36",type:a._g.Integration,package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies.fe.effect.alisg/721feed87396271a2001fa1fcdb19520"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1}],s={md5:"bf71eb4d49fbae3426f26ff70d31b424",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies-fe-effect-va/bf71eb4d49fbae3426f26ff70d31b424",resourceId:"7224338001147466241",effectId:"494008",regionKey:"default",metaType:80,extra:{},requirements:[],modelNames:[],isBusiness:!1,persistType:i.cVg.MetaTypeHsl,name:"hsl",key:"/integration/bf71eb4d49fbae3426f26ff70d31b424",type:a._g.Integration,sdkVersion:"10.1.0",package:{uri:"",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies-fe-effect-va/bf71eb4d49fbae3426f26ff70d31b424"]},icon:{uri:"",urlList:[]},isVip:!1,previewUrl:"",source:n.Hw.LOKI,isPrefab:!1},c={md5:"cb01a183fae704b7f5b68f47d8b549bf",url:"https://lf16-effectcdn.byteeffecttos-g.com/obj/ies-fe-effect-va/cb01a183fae704b7f5b68f47d8b549bf",resourceId:"7199840404223562241",effectId:"13174263",regionKey:"default",metaType:80,requirements:["blit"],modelNames:[],persistType:i.cVg.MetaTypeColorCurves,name:"colorCurve",key:"/integration/cb01a183fae704b7f5b68f47d8b549bf",type:a._g.Integration,package:{uri:"cb01a183fae704b7f5b68f47d8b549bf",urlList:["https://lf16-effectcdn.byteeffecttos-g.com/obj/ies-fe-effect-va/cb01a183fae704b7f5b68f47d8b549bf"]},isVip:!1,source:n.Hw.LOKI,isPrefab:!1,isBusiness:!1,icon:{uri:"",urlList:[]},sdkVersion:"9.5.0"},l="7206147814030578178"},341079:function(e,t,r){"use strict";r.d(t,{C6:function(){return T},pW:function(){return k},z2:function(){return M}});var i=r(426336);let{KFTypePositionY:a,KFTypePositionX:n,KFTypeRotation:o,KFTypeScale:s,KFTypeAlpha:c,KFTypeVolume:l,KFTypeLastVolume:d,KFTypeFilter:u,KFTypeTextAlpha:h,KFTypeGlobalAlpha:g,KFTypeTextColor:_,KFTypeBackgroundColor:p,KFTypeBackgroundAlpha:f,KFTypeShadowColor:m,KFTypeShadowAlpha:v,KFTypeShadowSmoothing:y,KFTypeBorderColor:S,KFTypeBorderWidth:b}=i.Eu,M=[l,d],k={[i.Eu.KFTypePositionX]:{function_category:"basic",function_subcategory:"adjustment",control_type:"position_x"},[i.Eu.KFTypePositionY]:{function_category:"basic",function_subcategory:"adjustment",control_type:"position_y"},[i.Eu.KFTypePositionXY]:{function_category:"basic, basic",function_subcategory:"adjustment, adjustment",control_type:"position_x, position_y"},[i.Eu.KFTypeScale]:{function_category:"basic",function_subcategory:"adjustment",control_type:"size"},[i.Eu.KFTypeScaleX]:{function_category:"basic",function_subcategory:"adjustment",control_type:"size"},[i.Eu.KFTypeScaleY]:{function_category:"basic",function_subcategory:"adjustment",control_type:"size"},[i.Eu.KFTypeRotation]:{function_category:"basic",function_subcategory:"adjustment",control_type:"rotate"},[i.Eu.KFTypeAlpha]:{function_category:"basic",function_subcategory:"compositing",control_type:"opacity"},[i.Eu.KFTypeFilter]:{function_category:"basic",function_subcategory:"intensity",control_type:"intensity"},[i.Eu.KFTypeVolume]:{function_category:"audio",function_subcategory:"volume",control_type:"volume"},[i.Eu.KFTypeLastVolume]:{function_category:"audio",function_subcategory:"volume",control_type:"volume"},[i.Eu.KFTypeMaskPostion]:{function_category:"basic, basic",function_subcategory:"mask, mask",control_type:"mask_position_x, mask_position_y"},[i.Eu.KFTypeMaskSize]:{function_category:"basic",function_subcategory:"mask",control_type:"mask_size"},[i.Eu.KFTypeCommonMaskRotation]:{function_category:"basic",function_subcategory:"mask",control_type:"mask_rotate"},[i.Eu.KFTypeCommonMaskFeather]:{function_category:"basic",function_subcategory:"mask",control_type:"mask_feather"},[i.Eu.KFTypeCommonMaskRoundCorner]:{function_category:"basic",function_subcategory:"mask",control_type:"mask_corner_radius"},[i.Eu.KFTypeTextColor]:{function_category:"basic",function_subcategory:"style",control_type:"fill_color"},[i.Eu.KFTypeTextAlpha]:{function_category:"basic",function_subcategory:"style",control_type:"opacity"},[i.Eu.KFTypeGlobalAlpha]:{function_category:"basic",function_subcategory:"style",control_type:"opacity"},[i.Eu.KFTypeBackgroundColor]:{function_category:"basic",function_subcategory:"style",control_type:"background_color"},[i.Eu.KFTypeBackgroundAlpha]:{function_category:"basic",function_subcategory:"style",control_type:"background_opacity"},[i.Eu.KFTypeShadowColor]:{function_category:"basic",function_subcategory:"style",control_type:"shadow_color"},[i.Eu.KFTypeShadowAlpha]:{function_category:"basic",function_subcategory:"style",control_type:"shadow_opacity"},[i.Eu.KFTypeShadowSmoothing]:{function_category:"basic",function_subcategory:"style",control_type:"shadow_blur"},[i.Eu.KFTypeBorderColor]:{function_category:"basic",function_subcategory:"style",control_type:"outline_color"},[i.Eu.KFTypeBorderWidth]:{function_category:"basic",function_subcategory:"style",control_type:"outline_size"},[i.Eu.KFTypeSaturation]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"color_vibrance"},[i.Eu.KFTypeTemperature]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"color_temperature"},[i.Eu.KFTypeHue]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"color_hue"},[i.Eu.KFTypeBrightness]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"lightness_brightness"},[i.Eu.KFTypeContrast]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"lightness_contrast"},[i.Eu.KFTypeLightSensatione]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"lightness_shine"},[i.Eu.KFTypeHightLight]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"lightness_highlight"},[i.Eu.KFTypeShadow]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"lightness_shadow"},[i.Eu.KFTypeSharpen]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"effects_sharpness"},[i.Eu.KFTypeVignetting]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"effects_vignette"},[i.Eu.KFTypeFade]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"effects_fade"},[i.Eu.KFTypeParticle]:{function_category:"basic",function_subcategory:"color_adjustment",control_type:"effects_grain"}},T=[i.Eu.KFTypeEffectAdjustParam1,i.Eu.KFTypeEffectAdjustParam2,i.Eu.KFTypeEffectAdjustParam3]},112987:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var i=r(772322),a=r(728631),n=r(801497),o=r(150564),s=r(108917),c=r(612809);let l={toolBar:[{id:r(236843).DQ,name:a.j.ToolbarMutableTextPreset,type:"unpin",icon:()=>(0,i.jsx)(o.AhC,{fontSize:20}),title:()=>n.ZP.t("web_materialSearch_button_preset",{},"Presets"),groups:[s.D.MutableText],order:1,defaultActiveGroupList:[]}],toolBarPanel:[{name:a.j.ToolbarMutableTextPreset,content:(0,i.jsx)(c.v,{})}]}},595796:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var i=r(772322),a=r(728631),n=r(801497),o=r(150564),s=r(108917),c=r(612809);let l={toolBar:[{id:r(76031).D,name:a.j.ToolbarStickerBasic,type:"unpin",icon:()=>(0,i.jsx)(o.Ph1,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.Sticker]}],toolBarPanel:[{name:a.j.ToolbarStickerBasic,content:(0,i.jsx)(c.v,{})}]}},715877:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var i=r(772322),a=r(728631),n=r(801497),o=r(150564),s=r(108917),c=r(612809);let l={toolBar:[{id:r(438506).D,name:a.j.ToolbarStickerMotion,type:"unpin",icon:()=>(0,i.jsx)(o._SE,{fontSize:20}),title:()=>n.ZP.t("web_materialSearch_text_motion",{},"Motion"),groups:[s.D.Sticker],defaultActiveGroupList:[s.D.Sticker]}],toolBarPanel:[{name:a.j.ToolbarStickerMotion,content:(0,i.jsx)(c.v,{})}]}},929303:function(e,t,r){"use strict";r.d(t,{D:function(){return i},j:function(){return a}});let i="toolbarStickerTracking",a={ToolbarStickerTracking:"ToolbarStickerTracking"}},996788:function(e,t,r){"use strict";r.d(t,{DK:function(){return n},DQ:function(){return i},N3:function(){return a}});let i="toolbarTextBasic",a="basic",n="all"},103124:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var i=r(772322),a=r(728631),n=r(801497),o=r(150564),s=r(108917),c=r(612809);let l={toolBar:[{id:r(12066).D,name:a.j.ToolbarTextTemplateBasic,type:"unpin",icon:()=>(0,i.jsx)(o.lFi,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.TextTemplate,s.D.MutableTextTemplate],order:2,defaultActiveGroupList:[s.D.TextTemplate]}],toolBarPanel:[{name:a.j.ToolbarTextTemplateBasic,content:(0,i.jsx)(c.v,{})}]}},388285:function(e,t,r){"use strict";r.d(t,{D:function(){return i},N:function(){return a}});let i="toolbarVideoAudio",a="audio"},768453:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var i=r(772322),a=r(728631),n=r(801497),o=r(150564),s=r(108917),c=r(612809);let l={toolBar:[{id:r(388285).D,name:a.j.ToolbarVideoAudio,type:"unpin",icon:()=>(0,i.jsx)(o.GCV,{fontSize:20}),title:()=>n.ZP.t("audio_web",{},"Audio"),groups:[s.D.Video,s.D.MutableVideo,s.D.Unselected]}],toolBarPanel:[{name:a.j.ToolbarVideoAudio,content:(0,i.jsx)(c.v,{})}]}},730592:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var i=r(772322),a=r(728631),n=r(801497),o=r(150564),s=r(108917),c=r(612809);let l={toolBar:[{id:r(97920).D,name:a.j.ToolbarVideoBackground,type:"unpin",icon:()=>(0,i.jsx)(o.tjt,{fontSize:20}),title:()=>n.ZP.t("background_web",{},"Background"),groups:[s.D.Video,s.D.VideoCombination,s.D.Mutable,s.D.Unselected]}],toolBarPanel:[{name:a.j.ToolbarVideoBackground,content:(0,i.jsx)(c.v,{})}]}},639097:function(e,t,r){"use strict";r.d(t,{l:function(){return s}});var i=r(426336),a=r(501887),n=r(808213),o=r(33883);let s=e=>{let t=0,r=0,s=[],c=[],l=[],d=[],u=[];for(let g of e.draftView.getAllTracks()){var h;if(!!(null===(h=g.segments)||void 0===h?void 0:h.length))for(let e of g.segments)if((0,i.hey)(e)){let{figures:r}=e;if(!(null==r?void 0:r.length))continue;for(let e of r){if((0,n.W)(e))continue;t=1;let{categoryId:r}=e,i=(0,a.W)(e);r===o.q.AutoBeautyFace&&c.push(i),r===o.q.AutoBeautyBody&&u.push(i),r===o.q.AutoBeautyMakeup&&d.push(i),r===o.q.AutoBeautyShape&&l.push(i)}}else(0,i.w5o)(e)&&e.material.type===i.cVg.MetaTypeFaceEffect&&(r=1,s.push(e.material.effectId))}return{is_beauty:t,facial_beauty_detail:l.length?l.join(","):null,makeup_detail:d.length?d.join(","):null,body_detail:u.length?u.join(","):null,beauty_detail:c.length?c.join(","):null,is_face_prop:r,face_prop_detail:s.length?s.join(","):""}}},217626:function(e,t,r){"use strict";r.d(t,{DQ:function(){return i},N3:function(){return o},_M:function(){return n}});let i="toolbarVideoCutout";var a,n=((a={})[a.Normal=0]="Normal",a[a.Cutout=1]="Cutout",a[a.Beauty=2]="Beauty",a[a.ObjectLock=3]="ObjectLock",a);let o="smart_tools"},662301:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var i=r(772322),a=r(728631),n=r(801497),o=r(150564),s=r(108917),c=r(612809);let l={toolBar:[{id:r(709479).DQ,name:a.j.ToolbarVideoSpeed,type:"unpin",icon:()=>(0,i.jsx)(o.fDY,{fontSize:20}),title:()=>n.ZP.t("speed_web",{},"Speed"),groups:[s.D.Video,s.D.VideoCombination,s.D.Unselected]}],toolBarPanel:[{name:a.j.ToolbarVideoSpeed,content:(0,i.jsx)(c.v,{})}]}},282193:function(e,t,r){"use strict";r.d(t,{x:function(){return b}});var i=r(789786),a=r(433140),n=r(537745),o=r(230689),s=r(200247),c=r(426336),l=r(593642),d=r(641276),u=r(690613),h=r(932099),g=r(380455),_=r(909034),p=r(298730),f=r(756024),m=r(82978),v=r(857670),y=r(108692),S=r(797913);class b{updateRenderManager(e){this._renderManager=e}async add(e,t,r){var i,a;let n;if(!this._renderManager)return(0,h.u_)(m.o.RenderManagerUndefined);await this._checkAdd();let o=(0,u.oW)(""),s=(0,p.ty)(this._dataSdk,[{targetStart:t.start,duration:this._getDuration(e,t),trackIndex:t.trackIndex,newTrack:null!==(i=t.needInsertTargetTrack)&&void 0!==i&&i,type:"video"}]);if(!s.ok)return this._callbackOptions.toast(s.msg),o=(0,h.u_)(m.o.TrackLimit);let c=(0,l.Rl)(),{uiSegmentId:d}=this._callbackOptions.beforeAddSegment(e,t,c);try{let i,s;this._callbackOptions.beforeEnsureResource(e);try{({videoResourceRecord:i,maskResourceRecord:s}=await (0,_.oi)(e.value,this._ensureManager,this._renderManager,this._resourceService,this._digitalHumanDataService,this._containerService))}catch(e){return f.t.error(e),o=(0,h.u_)(m.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,i)}if(!i)return o=(0,h.u_)(m.o.MissResource);let l=await this._renderManager.getMediaFileInfo(i.resPath,null!==(a=i.decryptKey)&&void 0!==a?a:"");if(!l)return o=(0,h.u_)(m.o.GetMediaFileInfo);let d=this._dataSdk.api.batch.batchStart();try{if(!(o=this._addVideoTrackIfNeeded(t)).ok)return o;if(t.duration=this._getDuration(e,t,l),n=this._digitalHumanResourceToDigitalHumanParam(e.value,t,c,i.segmentPath,l),!(o=this._dataSdk.api.video.addDigitalHuman(n)).ok)return o=(0,h.u_)(m.o.AddSegment);s&&(this._dataSdk.api.video.setMatting({segId:o.value,path:s.segmentPath}),!(null==r?void 0:r.openMatting)&&this._dataSdk.api.video.clearMatting({segId:o.value,path:s.segmentPath}))}catch(e){return f.t.error(e),o=(0,h.u_)(m.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(d)}}catch(e){f.t.error(e),o=(0,h.u_)(m.o.Unknown)}finally{this._callbackOptions.afterAddSegment(o.ok?o.value:void 0,d),o.ok&&o.value}return o}addToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(!this._renderManager)return(0,h.u_)(m.o.RenderManagerUndefined);let i=!this._dataSdk.draftView.getMainTrack(),a=0,n=(0,v.i1)(this._renderManager.progress);return t?n=(0,h.Pr)(this._dataSdk,n):{needToInsert:i,trackIndex:a}=this._dataSdk.draftView.findTrackIndexToInsert(c.pNd.TrackTypeVideo,n,(0,c.k3U)(e.value.duration_ms,1000n,"bigint")),this.add(e,{start:n,trackIndex:a,needInsertTargetTrack:i},r)}_digitalHumanResourceToDigitalHumanParam(e,t,r,i,a,n){var o;let s=this._videoConfigurationService.getAppConfigurationValue("siderMenu.digitalHuman.defaultText");return{trackIndex:t.trackIndex,digitalHumanId:e.id,digitalHumanPath:i,startTime:t.start,duration:a.duration,materialId:e.resourceId,videoParam:(0,c.lFK)({segmentId:r,path:i,materialName:e.title,startTime:t.start,duration:a.duration,type:c.cVg.MetaTypeVideo,sourceStartTime:0n,sourceDuration:null!==(o=t.duration)&&void 0!==o?o:0n,materialId:"",originMaterialId:"",source:void 0,sourcePlatform:g.t.toSourcePlatform(e.source,e.publishSource),categoryId:null==n?void 0:n.materialThirdcategoryId,categoryName:null==n?void 0:n.materialThirdcategory,mediaInfo:a,copyBackground:!1}),localTaskId:"",ttsMetaParams:[{text:null!=s?s:e.description,ttsParam:{text:{toneType:e.toneType,tonePlatform:e.tonePlatform,resourceId:e.toneResourceId}},ttsPayload:""}],digitalHumanSource:c.O_D.DigitalHumanSourcePGCVimo}}_getDuration(e,t,r){if((null==r?void 0:r.duration)||t.duration){var i,a;return null!==(a=null!==(i=null==r?void 0:r.duration)&&void 0!==i?i:t.duration)&&void 0!==a?a:0n}return(0,c.k3U)(e.value.duration_ms,1000n,"bigint")}_addVideoTrackIfNeeded(e){let t=(0,u.ly)();if(e.needInsertTargetTrack){let r=(0,h.HU)(this._dataSdk);if(!r.ok)return t=(0,h.u_)(m.o.AddTrack);0!==e.trackIndex&&!(r=this._dataSdk.api.track.add({trackIndex:e.trackIndex,track:new c.fQ8({id:(0,l.Rl)(),type:c.pNd.TrackTypeVideo,flag:c.w9k.FlagSubVideo})})).ok&&(t=(0,h.u_)(m.o.AddTrack))}return t}async _checkAdd(){!this._accountService.hasLogin&&await new Promise(e=>{this._accountService.login({reportParams:{current_page:"editor",pageEnterFrom:"ai_character"},execAfterLogin:()=>{(0,d.V)(this._mainDraftService.draftWorkspaceManager.onDidWorkspaceChange)(()=>{e(!0)})}})})}constructor(e,t,r,i,a,n,o,s,c,l){this._dataSdk=e,this._renderManager=t,this._ensureManager=r,this._callbackOptions=i,this._resourceService=a,this._digitalHumanDataService=n,this._mainDraftService=o,this._containerService=s,this._accountService=c,this._videoConfigurationService=l}}b=(0,i.gn)([(0,i.fM)(4,a.c),(0,i.fM)(5,n.T),(0,i.fM)(6,y.n),(0,i.fM)(7,o.t),(0,i.fM)(8,s.D),(0,i.fM)(9,S.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===a.c?Object:a.c,void 0===n.T?Object:n.T,void 0===y.n?Object:y.n,void 0===o.t?Object:o.t,void 0===s.D?Object:s.D,void 0===S.J?Object:S.J])],b)},806622:function(e,t,r){"use strict";r.d(t,{v:function(){return M}});var i=r(789786),a=r(335534),n=r(426020),o=r(433140),s=r(230689),c=r(426336),l=r(593642),d=r(690613),u=r(800788),h=r(932099),g=r(460254),_=r(909034),p=r(473595),f=r(298730),m=r(756024),v=r(82978),y=r(857670),S=r(380455),b=r(485634);class M{updateRenderManager(e){this._renderManager=e}async add(e,t,r){var i,n,o,s,c,_,y,S,M,k,T,I,w,P,x;let C;if(!this._renderManager)return(0,h.u_)(v.o.RenderManagerUndefined);let E=(0,d.oW)(""),D=(0,f.ty)(this._dataSdk,[{targetStart:t.start,duration:this._getDuration(e,t),trackIndex:t.trackIndex,newTrack:null!==(i=t.needInsertTargetTrack)&&void 0!==i&&i,type:"video"}]);if(!D.ok)return this._callbackOptions.toast(D.msg),E=(0,h.u_)(v.o.TrackLimit);let F=(0,l.Rl)(),{uiSegmentId:O}=this._callbackOptions.beforeAddSegment(e,t,F);try{let i;this._callbackOptions.beforeEnsureResource(e);try{i=await this._ensureResource(e)}catch(e){return m.t.error(e),(0,d.oi)(e)&&e.code===a.D.OrderFailedFE?(null===(n=(o=this._callbackOptions).onOrderError)||void 0===n||n.call(o,e),E=(0,h.u_)(v.o.OrderFailed)):E=(0,h.u_)(v.o.EnsureResource),E}finally{this._callbackOptions.afterEnsureResource(e,i)}if(!i)return E=(0,h.u_)(v.o.MissResource);if(e.type===g.r.UserVideo){let t=await (null===(c=e.value)||void 0===c?void 0:null===(s=c.addModelToDraft)||void 0===s?void 0:s.call(c));if(t&&!t.ok)return E=(0,h.u_)(v.o.MissResource)}let l=await this._renderManager.getMediaFileInfo(i.resPath,null!==(_=i.decryptKey)&&void 0!==_?_:"");if((0,b.c)(this._containerService,{bitrate:null!==(y=null==l?void 0:l.bitrate)&&void 0!==y?y:0,decryptKey:null!==(S=i.decryptKey)&&void 0!==S?S:"",duration:null!==(M=null==l?void 0:l.duration.toString())&&void 0!==M?M:"",fps:null!==(k=null==l?void 0:l.fps)&&void 0!==k?k:0,height:null!==(T=null==l?void 0:l.height)&&void 0!==T?T:0,resourcePath:i.resPath,rotation:null!==(I=null==l?void 0:l.rotation)&&void 0!==I?I:0,type:null!==(w=null==l?void 0:l.type)&&void 0!==w?w:"",width:null!==(P=null==l?void 0:l.width)&&void 0!==P?P:0}),!l)return E=(0,h.u_)(v.o.GetMediaFileInfo);let p=this._dataSdk.api.batch.batchStart();try{if(!(E=this._addVideoTrackIfNeeded(t)).ok)return E;let a=this._draftPathStore.getDraftPathFromResourceKey(e.value.key);switch(t.duration=this._getDuration(e,t,l),e.type){case g.r.Video:C=this._videoResourceToVideoParam(e.value,t,F,i.segmentPath,l,r);break;case g.r.UserVideo:C=this._userVideoResourceToVideoParam(e.value,t,F,a||i.segmentPath,l);break;case g.r.Gif:C=this._gifResourceToVideoParam(e.value,t,F,i.segmentPath,l);break;default:(0,u.bP)(e,"resource type error")}if(!(E=this._dataSdk.api.video.add({trackIndex:t.trackIndex,videos:[C]})).ok)return E=(0,h.u_)(v.o.AddSegment);null==r||null===(x=r.batchTask)||void 0===x||x.call(r)}catch(e){return m.t.error(e),E=(0,h.u_)(v.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(p)}}catch(e){m.t.error(e),E=(0,h.u_)(v.o.Unknown)}finally{if(this._callbackOptions.afterAddSegment(E.ok?null==C?void 0:C.segmentId:void 0,O),E.ok&&(null==C?void 0:C.segmentId)){let{segmentId:e}=C;p.f.add(e,{searchId:null==r?void 0:r.searchId,requestId:null==r?void 0:r.requestId})}}return E}async batchAdd(e,t,r){var i,a,n,o,s,c,_,p,y,S,b;if(!this._renderManager)return(0,h.u_)(v.o.RenderManagerUndefined);let M=(0,d.ly)(),k=t.start,T=(0,f.ty)(this._dataSdk,e.map(e=>{var r;let i=this._getDuration(e,t),a=k;return k+=i,{targetStart:a,duration:i,trackIndex:t.trackIndex,newTrack:null!==(r=t.needInsertTargetTrack)&&void 0!==r&&r,type:"video"}}));if(!T.ok)return this._callbackOptions.toast(T.msg),M=(0,h.u_)(v.o.TrackLimit);let I=Array.from(e,()=>void 0),w=Array.from(e,()=>(0,h.u_)(v.o.AddSegment));null===(i=(a=this._callbackOptions).beforeBatchAddSegment)||void 0===i||i.call(a,e,t);try{let i=[];null===(n=(o=this._callbackOptions).beforeBatchEnsureResource)||void 0===n||n.call(o,e);try{let t=[];for(let r of e)t.push(this._ensureResource(r));i=(await Promise.allSettled(t)).map(e=>"fulfilled"===e.status?e.value:void 0)}catch(e){return m.t.error(e),M=(0,h.u_)(v.o.EnsureResource)}finally{null===(s=(c=this._callbackOptions).afterBatchEnsureResource)||void 0===s||s.call(c,e,i)}for(let t of e)if(t.type===g.r.UserVideo){let e=await (null===(p=t.value)||void 0===p?void 0:null===(_=p.addModelToDraft)||void 0===_?void 0:_.call(p));if(e&&!e.ok)return M=(0,h.u_)(v.o.MissResource)}let a=[];for(let e of i){if(!e){a.push(Promise.resolve(null));break}a.push(this._renderManager.getMediaFileInfo(e.resPath,null!==(y=e.decryptKey)&&void 0!==y?y:""))}let d=(await Promise.allSettled(a)).map(e=>"fulfilled"===e.status?e.value:null),f=this._dataSdk.api.batch.batchStart();try{if(!(M=this._addVideoTrackIfNeeded(t)).ok)return M;for(let a=0;a<e.length;a++){let n=e[a],o=i[a],s=d[a];if(!o||!s)continue;let c=this._draftPathStore.getDraftPathFromResourceKey(n.value.key);switch(t.duration=this._getDuration(n,t,s),n.type){case g.r.Video:I[a]=this._videoResourceToVideoParam(n.value,t,(0,l.Rl)(),o.segmentPath,s,null==r?void 0:r[a]);break;case g.r.UserVideo:I[a]=this._userVideoResourceToVideoParam(n.value,t,(0,l.Rl)(),c||o.segmentPath,s);break;case g.r.Gif:I[a]=this._gifResourceToVideoParam(n.value,t,(0,l.Rl)(),o.segmentPath,s);break;default:(0,u.bP)(n,"resource type error")}if(!!I[a])w[a]=this._dataSdk.api.video.add({trackIndex:t.trackIndex,videos:[I[a]]}),w[a].ok&&(t.start+=t.duration)}}catch(e){return m.t.error(e),M=(0,h.u_)(v.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(f)}}catch(e){m.t.error(e),M=(0,h.u_)(v.o.Unknown)}finally{null===(S=(b=this._callbackOptions).afterBatchAddSegment)||void 0===S||S.call(b,w.map((e,t)=>{var r;return e.ok?null===(r=I[t])||void 0===r?void 0:r.segmentId:void 0}))}return M}addBySegment(e,t){var r,i,a;let n=this._addVideoTrackIfNeeded(t);if(!n.ok)return n;let o=(0,l.Rl)();return this._dataSdk.api.segment.insert({segmentId:o,referenceSegment:e,trackIndex:t.trackIndex,targetStartTime:t.start,targetDuration:null!==(r=t.duration)&&void 0!==r?r:e.targetTimerange.duration,sourceStartTime:null!==(i=t.sourceStart)&&void 0!==i?i:e.sourceTimerange.start,sourceDuration:null!==(a=t.sourceDuration)&&void 0!==a?a:e.sourceTimerange.duration})?(0,d.oW)(o):(0,h.u_)(v.o.AddSegment)}addToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(!this._renderManager)return(0,h.u_)(v.o.RenderManagerUndefined);let i=!this._dataSdk.draftView.getMainTrack(),a=0,o=(0,y.i1)(this._renderManager.progress);return t?o=(0,h.Pr)(this._dataSdk,o):{needToInsert:i,trackIndex:a}=this._dataSdk.draftView.findTrackIndexToInsert(c.pNd.TrackTypeVideo,o,(0,c.k3U)((()=>{if(e.type===g.r.Video);else if(e.type===g.r.UserVideo){if(e.value.fileType===n.YB.Video)return e.value.duration;(0,u.ss)("no user video type, do not use this function")}return e.value.duration})(),1000000n,"bigint")),this.add(e,{start:o,trackIndex:a,needInsertTargetTrack:i},r)}_videoResourceToVideoParam(e,t,r,i,a,n){var o;return(0,c.lFK)({segmentId:r,path:i,materialName:"video clip",startTime:t.start,duration:a.duration,sourceStartTime:0n,sourceDuration:null!==(o=t.duration)&&void 0!==o?o:0n,materialId:e.resourceId,originMaterialId:"",source:e.source,sourcePlatform:S.t.toSourcePlatform(e.source,e.publishSource),categoryId:null==n?void 0:n.materialThirdcategoryId,categoryName:null==n?void 0:n.materialThirdcategory,mediaInfo:a,teamId:e.workspaceId})}_userVideoResourceToVideoParam(e,t,r,i,a,o){var s;return(0,u.Y2)(e.fileType===n.YB.Video),(0,c.lFK)({segmentId:r,path:i,materialName:e.filename,startTime:t.start,duration:a.duration,sourceStartTime:0n,sourceDuration:null!==(s=t.duration)&&void 0!==s?s:0n,materialId:"",source:void 0,sourcePlatform:void 0,categoryId:null==o?void 0:o.materialThirdcategoryId,categoryName:null==o?void 0:o.materialThirdcategory,mediaInfo:a})}_gifResourceToVideoParam(e,t,r,i,a){var n;return(0,c.lFK)({segmentId:r,path:i,materialName:e.name,startTime:t.start,duration:a.duration,sourceStartTime:0n,sourceDuration:null!==(n=t.duration)&&void 0!==n?n:0n,materialId:e.id,originMaterialId:void 0,source:void 0,sourcePlatform:c.cvu.MaterialPlatformGiphy,categoryId:"",categoryName:e.category,mediaInfo:a})}_getDuration(e,t,r){if((null==r?void 0:r.duration)||t.duration){var i,a;return null!==(a=null!==(i=null==r?void 0:r.duration)&&void 0!==i?i:t.duration)&&void 0!==a?a:0n}return e.type===g.r.UserVideo?((0,u.Y2)(e.value.fileType===n.YB.Video),(0,c.k3U)(e.value.duration,1000000n,"bigint")):(0,c.k3U)(e.value.duration,1000000n,"bigint")}_addVideoTrackIfNeeded(e){let t=(0,d.ly)();if(e.needInsertTargetTrack){let r=(0,h.HU)(this._dataSdk);if(!r.ok)return t=(0,h.u_)(v.o.AddTrack);0!==e.trackIndex&&!(r=this._dataSdk.api.track.add({trackIndex:e.trackIndex,track:new c.fQ8({id:(0,l.Rl)(),type:c.pNd.TrackTypeVideo,flag:c.w9k.FlagSubVideo})})).ok&&(t=(0,h.u_)(v.o.AddTrack))}return t}async _ensureResource(e){let t;if(!!this._renderManager){switch(e.type){case g.r.Video:t=await (0,_.y$)(e.value,this._ensureManager,this._renderManager,this._resourceService);break;case g.r.UserVideo:t=await (0,_.ti)(e.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService);break;case g.r.Gif:t=await (0,_.M3)(e.value,this._ensureManager,this._renderManager,this._resourceService);break;default:(0,u.bP)(e,"resource type error")}return t}}constructor(e,t,r,i,a,n,o){this._dataSdk=e,this._renderManager=t,this._ensureManager=r,this._draftPathStore=i,this._callbackOptions=a,this._resourceService=n,this._containerService=o}}M=(0,i.gn)([(0,i.fM)(5,o.c),(0,i.fM)(6,s.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===o.c?Object:o.c,void 0===s.t?Object:s.t])],M)},550786:function(e,t,r){"use strict";r.d(t,{E:function(){return l},g:function(){return d}});var i=r(486872),a=r(517614),n=r(426336),o=r(731992),s=r(915208),c=r(127830);let l=e=>{let t=[],{adjust:r,color_curves:l,hsl:d}=e;if(r&&Object.keys(r).forEach(e=>{var i;let n=r[e];if(void 0===n)return;let l=a.Wh.filter(t=>`${t.persistType}_value`===e)[0];if(!l)return;let d=(0,o.l)(c._g.Integration,l),u={type:l.persistType,value:n,path:(0,s.uL)(d.resource),effectId:l.effectId,name:l.name,version:null!==(i=l.version)&&void 0!==i?i:"",resId:l.resourceId};t.push(u)}),l){let e=(0,o.l)(c._g.Integration,a.JN),r=(0,s.uL)(e.resource),d={blue:l.blue,green:l.green,red:l.red,luma:l.luma};(0,i.Y$)(d);let u={type:n.cVg.MetaTypeColorCurves,path:r,colorCurvesParams:{...d,path:r,resourceId:a.JN.resourceId}};t.push(u)}if(d){let e=(0,o.l)(c._g.Integration,a.No),r=(0,s.uL)(e.resource);!d.hsl_params&&(d.hsl_params=[{...d}]),d.hsl_params.forEach(i=>{let o=(0,n.BZR)({hue:i.hue,lightness:i.lightness,saturation:i.saturation,hslColorType:i.color_type,visible:!0,path:r}),c={type:a.No.persistType,path:(0,s.uL)(e.resource),hslParams:o,effectId:a.No.effectId,name:a.No.name,resId:a.No.resourceId};t.push(c)})}return t},d=e=>{let t={};if((0,n.hey)(e)&&e.adjust){var r,i,a,o,s,c,l,d,u,h,g,_,p,f,m,v,y,S,b,M,k,T,I,w,P;if(t.adjust={brightness_value:null!==(f=null===(r=e.adjust.brightness)||void 0===r?void 0:r.value)&&void 0!==f?f:0,contrast_value:null!==(m=null===(i=e.adjust.contrast)||void 0===i?void 0:i.value)&&void 0!==m?m:0,saturation_value:null!==(v=null===(a=e.adjust.saturation)||void 0===a?void 0:a.value)&&void 0!==v?v:0,sharpen_value:null!==(y=null===(o=e.adjust.sharpening)||void 0===o?void 0:o.value)&&void 0!==y?y:0,highlight_value:null!==(S=null===(s=e.adjust.highlight)||void 0===s?void 0:s.value)&&void 0!==S?S:0,shadow_value:null!==(b=null===(c=e.adjust.shadow)||void 0===c?void 0:c.value)&&void 0!==b?b:0,temperature_value:null!==(M=null===(l=e.adjust.colorTemperature)||void 0===l?void 0:l.value)&&void 0!==M?M:0,fade_value:null!==(k=null===(d=e.adjust.fade)||void 0===d?void 0:d.value)&&void 0!==k?k:0,light_sensation_value:null!==(T=null===(u=e.adjust.lightSensation)||void 0===u?void 0:u.value)&&void 0!==T?T:0,vignetting_value:null!==(I=null===(h=e.adjust.vignetting)||void 0===h?void 0:h.value)&&void 0!==I?I:0,particle_value:null!==(w=null===(g=e.adjust.particle)||void 0===g?void 0:g.value)&&void 0!==w?w:0,tone_value:null!==(P=null===(_=e.adjust.hue)||void 0===_?void 0:_.value)&&void 0!==P?P:0,enable:!0},null===(p=e.adjust.hsl)||void 0===p?void 0:p.length){let r=e.adjust.hsl.map(e=>({hue:e.hue,lightness:e.lightness,saturation:e.saturation,color_type:e.hslColorType}));t.hsl={hsl_params:r}}if(e.adjust.colorCurves){let r=e.adjust.colorCurves;t.color_curves={blue:r.blue,green:r.green,red:r.red,luma:r.luma,enable:!0}}}return t}},214063:function(e,t,r){"use strict";r.d(t,{D:function(){return n}});var i=r(426336),a=r(314108);async function n(e,t,r){let n;let[o,s]=function(e,t,r){let a=new i.eK().nextTextAndStickerRenderIndex(t.draftView),n=i.ysb.createImpliment((0,i.pB0)(),(0,i.WSD)({...e.params.material,clip:(0,i.cE6)(e.params.material.clip)}),e.params.resources,e.params.type,a,e.json),o=i.ysb.isNewTextTemplateSegment(n.material);return r.commit(()=>{let e=r.getRenderConfig(),t=r.addTrack(i.u2r.EffectTrack,-1),s=o?(0,i.ggg)(n,e):(0,i.fT)(n,e);s.id=n.id,s.layer=BigInt(a),s.is_visible=!1,s.filter.filterLayer=BigInt(a),s.rid=BigInt(a);let c=n.targetTimerange.start,l=n.targetTimerange.duration+c;r.addClip(t,s,c,l),o&&!r.hasBrokenPath(i.k92.getInstance().pathRecords.get(n.material.path))&&(0,i.Dkg)(n,!1,e)}),[n,()=>{r.commit(()=>{r.removeClip(n.id)})}]}(e,t,r);try{await (0,a.i)(o.id,r)}catch{return[0,0]}let c=i.ysb.isNewTextTemplateSegment(o.material),l=await i.ysb.getTextTemplateParams(o.id,c);if(!l)return[0,0];try{n=JSON.parse(l)}catch{return[0,0]}let d=n.bounding_box,u=d[0]/2+.5,h=.5-d[1]/2,g=d[2]/2+.5,_=.5-d[3]/2;return s(),[g-u,h-_]}},82978:function(e,t,r){"use strict";r.d(t,{i:function(){return n},o:function(){return a}});var i,a=((i={})[i.NoError=0]="NoError",i[i.TrackLimit=1]="TrackLimit",i[i.TransitionSegmentLimit=2]="TransitionSegmentLimit",i[i.TransitionDurationLimit=3]="TransitionDurationLimit",i[i.EnsureResource=4]="EnsureResource",i[i.MissResource=5]="MissResource",i[i.GetMediaFileInfo=6]="GetMediaFileInfo",i[i.AddTrack=7]="AddTrack",i[i.AddSegment=8]="AddSegment",i[i.AddTransition=9]="AddTransition",i[i.SubDraftError=10]="SubDraftError",i[i.TextRectangle=11]="TextRectangle",i[i.RenderManagerUndefined=12]="RenderManagerUndefined",i[i.OrderFailed=13]="OrderFailed",i[i.AddModelToDraft=14]="AddModelToDraft",i[i.ResourceParserError=15]="ResourceParserError",i[i.Unknown=16]="Unknown",i);let n=new Map([[0,"No error"],[1,"Track limit error"],[2,"Transition segment limit error"],[3,"Transition duration limit error"],[4,"Ensure resource error"],[5,"Miss resource error"],[6,"Get media file info error"],[7,"Add track error"],[8,"Add segment error"],[9,"Add transition error"],[10,"Sub draft error"],[11,"Text rectangle error"],[12,"Render manager undefined"],[13,"Adobe / Pond5 Order failed"],[15,"Resource parse error"],[16,"Unknown error"]])},832251:function(e,t,r){"use strict";r.d(t,{R:function(){return d}});var i=r(789786),a=r(782350),n=r(569471),o=r(587892),s=r(273238),c=r(639605),l=r(690613);class d{setDraftName(e){this._cloudMeta.draft.name=e}setDraftId(e){this._oldFileId=this._cloudMeta.draft.id,this._cloudMeta.draft.id=e}updateCreateTime(e){this._cloudMeta.createSource.createTime=e,this._cloudMeta.uploadSource.createTime=e}async execute(){try{this._updateCloudMeta();let e=this._cloudMeta.draft.id,t=this._workspaceService.getWorkspace(this._toWorkspaceId),r=this._workspaceService.getWorkspace(this._fromWorkspaceId),i=await this._userMaterialsService.getEvercloudInstance(this._toWorkspaceId),a=await i.copyFromSpace({fromSpace:r.space_id,fromIdc:r.space_idc,resourceId:this._packageId,resourceType:3,meta:this._cloudMeta,toSpace:t.space_id,toIdc:t.space_idc,packageKey:e}),{data:n}=await a.done(),{result_id:o}=n;this._websocketService.sendMessage({new_file_id:e,new_workspace_id:this._toWorkspaceId,old_file_id:this._oldFileId,old_workspace_id:this._fromWorkspaceId});let s=(0,l.oW)(o);return this._onComplete.fire((0,l.oW)({newPackageId:o,newPackageKey:e})),s}catch(t){let e=(0,l.Mx)(-1,"sync draft to another space err",Error(String(t)));return this._onComplete.fire(e),e}}_updateCloudMeta(){this._cloudMeta.createSource.createTime=Date.now(),this._cloudMeta.uploadSource.createTime=Date.now(),this._cloudMeta.draft.updateTime=Date.now();let e=this._packageAssets.reduce((e,t)=>e+=t.size,this._draftJson.length);this._cloudMeta.draft.size=e}constructor(e,t,r,i,a,s,c,l,d){this._packageId=t,this._draftJson=r,this._fromWorkspaceId=i,this._toWorkspaceId=a,this._packageAssets=s,this._workspaceService=c,this._userMaterialsService=l,this._websocketService=d,this._oldFileId="",this._onComplete=new o.Q,this.onComplete=this._onComplete.event,this._cloudMeta=(0,n.I)(e)}}d=(0,i.gn)([(0,i.fM)(6,a.W),(0,i.fM)(7,s.b),(0,i.fM)(8,c.J0),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICloudDraftMeta?Object:ICloudDraftMeta,String,String,String,String,Array,void 0===a.W?Object:a.W,void 0===s.b?Object:s.b,void 0===c.J0?Object:c.J0])],d)},446654:function(e,t,r){"use strict";r.d(t,{g:function(){return f}});var i=r(789786),a=r(606527),n=r(230689),o=r(569471),s=r(475590),c=r(587892),l=r(690613),d=r(493359),u=r(263757),h=r(948328),g=r(204806),_=r(756024);let p="cover.jpg";class f{getCloudMeta(){return this._cloudMeta}getDraftJson(){return this._draftJson}getPackageAssets(){return this._packageAssets}setCoverTask(e){this._makeCoverTask=e}setDraftName(e){this._cloudMeta.draft.name=e}setDraftId(e){this._cloudMeta.draft.id=e}setPackageId(e){this._packageId=e}updateCreateTime(e){this._cloudMeta.createSource.createTime=e,this._cloudMeta.uploadSource.createTime=e}getCoverUrl(){return this._newCoverUrl}async execute(){let{userGeneratedMaterials:e,autoGeneratedMaterials:t}=this._draftMaterialsService.getMaterials(),r=(0,d.wW)([...e,...t]);if(r){let e=r.syncingUserMaterial.error.msg||"syncFailedMaterial",t=r.syncingUserMaterial.error.code;return(0,l.wf)(t,e)}this._updateCloudMeta();let i=await (0,g.gq)(this._containerService,this._cloudMeta.draft.size,this._uploadSizeChecker,this._workspaceId);if(!i.ok){let e=i.msg||"notEnoughSpace",t=i.code;return(0,l.wf)(t,e)}let a=!1,n="";if(this._makeCoverTask){if(this._makeCoverTask.hasCover()){console.log("[saving]","start build cover"),a=!0;try{n=await this._makeCoverTask.getBase64Url()}catch(e){a=!1,_.t.error("draft-save-task","getCoverTaskError",null==e?void 0:e.message)}""!==n&&(this._newCoverUrl=n,this._cloudMeta.draft.cover=p),console.log("[saving]","end build cover")}else this._cloudMeta.draft.cover=void 0,console.log("[saving]","no cover")}else this._cloudMeta.draft.cover=p,console.log("[saving]","use last cover");let o=n.split("base64,")[1],s={workspaceId:this._workspaceId,packageType:2,packageKey:this._cloudMeta.draft.id,basePackageId:this._packageId,templateData:this._draftJson,templateMeta:JSON.stringify(this._cloudMeta),isCoverChange:a,coverImageContent:o,packageAssets:this._packageAssets,renderMutableList:[],renderSegmentList:[],deviceId:(0,u.Zw)()},c=await this._saveComplete(s);return c.ok?(this._onComplete.fire((0,l.oW)({newPackageId:c.value,newPackageKey:this._cloudMeta.draft.id})),(0,l.oW)(this._cloudMeta.draft.id)):(this._onComplete.fire(c),c)}async _saveComplete(e){return await (0,s.Hp)(async t=>{let r=await this._draftSaveService.save(e);return t.isCancellationRequested?"":r},6e4)}_updateCloudMeta(){this._cloudMeta.draft.updateTime=Date.now();let e=this._packageAssets.reduce((e,t)=>e+=t.size,this._draftJson.length);this._cloudMeta.draft.size=e}constructor(e,t,r,i,a,n,s,l,d){this._packageId=t,this._draftJson=r,this._workspaceId=i,this._packageAssets=a,this._uploadSizeChecker=n,this._draftSaveService=s,this._draftMaterialsService=l,this._containerService=d,this._newCoverUrl="",this._onComplete=new c.Q,this.onComplete=this._onComplete.event,this._cloudMeta=(0,o.I)(e)}}f=(0,i.gn)([(0,i.fM)(6,a._),(0,i.fM)(7,h.D),(0,i.fM)(8,n.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ICloudDraftMeta?Object:ICloudDraftMeta,String,String,String,Array,"undefined"==typeof UploadSizeChecker?Object:UploadSizeChecker,void 0===a._?Object:a._,void 0===h.D?Object:h.D,void 0===n.t?Object:n.t])],f)},418952:function(e,t,r){"use strict";r.d(t,{a:()=>y});var i=r("834506"),a=r("274618"),n=r("225344"),o=r("235248"),s=r("805177"),c=r("16000"),l=r("568601"),d=r("426336");class u{refresh(e){let t=e.draftView.getCover();if(!!t)t.imagePath&&(this._cacheImagePath=t.imagePath,this._referenceCountManager.acquire(this._cacheImagePath,"")),t.graphicDraftPath&&(this._cacheGraphicDraftPath=t.graphicDraftPath,this._referenceCountManager.acquire(this._cacheGraphicDraftPath,""))}afterChangeDiff(e,t){if(0===e[d.u4I.CONFIG].length)return;let r=t.draftView.getCover();if(!r){this._cacheImagePath&&(this._referenceCountManager.release(this._cacheImagePath,""),this._cacheImagePath=""),this._cacheGraphicDraftPath&&(this._referenceCountManager.release(this._cacheGraphicDraftPath,""),this._cacheGraphicDraftPath="");return}r.imagePath?(this._cacheImagePath=r.imagePath,this._referenceCountManager.acquire(this._cacheImagePath,"")):this._cacheImagePath&&(this._referenceCountManager.release(this._cacheImagePath,""),this._cacheImagePath=""),r.graphicDraftPath?(this._cacheGraphicDraftPath=r.graphicDraftPath,this._referenceCountManager.acquire(this._cacheGraphicDraftPath,"")):this._cacheGraphicDraftPath&&(this._referenceCountManager.release(this._cacheGraphicDraftPath,""),this._cacheGraphicDraftPath="")}constructor(e){this._referenceCountManager=e,this._cacheImagePath="",this._cacheGraphicDraftPath=""}}var h=r("444381");class g extends h.M{_findPath(e){return(0,d.hey)(e)?e.material.videoAlgorithm.path:""}}var _=r("393101"),p=r("114011"),f=r("629982"),m=r("285409"),v=r("328100");class y extends i.N{constructor(e){super(e),this.dataSdk=e,this._watchers.push(new m.Y(this),new v.S(this),new a.P(this),new n.U(this),new o.D(this),new s.g(this),new l.B(this),new g(this),new c.Y(this),new p.E(this),new _.I(this),new f.m(this)),this._customWatchers.push(new u(this))}}},444381:function(e,t,r){"use strict";r.d(t,{M:function(){return n}});var i=r(800788),a=r(426336);class n{refreshCache(e){let t=e=>{let t=this._findPath(e);t&&(this._cache.set(e.id,t),this._acquireByPath(e.id,t))};for(let r of e)t(r),this._iterateSubDraftSegment(r,t)}afterChangeDiff(e,t){if(0!==e[a.u4I.SEGMENT].length)for(let r of e[a.u4I.SEGMENT]){let{type:e}=r;switch(e){case a.C8.ADD:{let e=r.item.segment;this._whenInsertOrUpdateSegment(e),this._iterateSubDraftSegment(e,this._whenInsertOrUpdateSegment.bind(this));break}case a.C8.UPDATE:{let e=t.draftView.getSegmentById(r.item.id);this._whenInsertOrUpdateSegment(e);break}case a.C8.DELETE:this._whenDeleteSegment(r.item.id),this._iterateSubDraftSegment(r.item.segment,e=>this._whenDeleteSegment(e.id));break;case a.C8.MOVE:break;default:(0,i.bP)(e)}}}_acquireByPath(e,t){this._referenceCountManager.acquire(t,e)}_releaseByPath(e,t){this._referenceCountManager.release(t,e)}_whenInsertOrUpdateSegment(e){let t=this._cache.get(e.id),r=this._findPath(e);if(t!==r)this._cache.set(e.id,r),t&&this._releaseByPath(e.id,t),r&&this._acquireByPath(e.id,r)}_whenDeleteSegment(e){let t=this._cache.get(e);if(!!t)this._cache.delete(e),this._releaseByPath(e,t)}_iterateSubDraftSegment(e,t){((0,a.duj)(e)||(0,a.itF)(e))&&e.materialDraft.draft.getAllSegments().forEach(e=>{t(e)})}constructor(e){this._referenceCountManager=e,this._cache=new Map}}},594735:function(e,t,r){"use strict";r.d(t,{V:function(){return c}});var i=r(753809),a=r(937567),n=r(426336),o=r(144144),s=r(572013);function c(e,t,r,c,l,d){(0,o.Ie)(a.LVVE_DESERIALIZE_JSON);let u=n.HHr.parse(t);(0,o.oe)(a.LVVE_DESERIALIZE_JSON),(0,o.Ie)(a.LVVE_FIX_JSON),u=(0,n.bbM)(u,r),(0,o.oe)(a.LVVE_FIX_JSON),(0,o.Ie)(a.LVVE_UPGRADE),u=(0,n.MoK)(u),(0,o.oe)(a.LVVE_UPGRADE),(0,o.Ie)(a.LVVE_FILL_JSON);let h=e.getMaterialPathMap(),g={...e.getEffectPathMap(),[i.rH]:n.P4R.ensureRootPath(i.rv.dir),[i.aO.resourceId]:i.aO.path,[i.aO.resourceIdOnHeycan]:i.aO.path};c&&(u.id=c),"string"==typeof l&&(u.name=l),r&&Object.entries(r.oldResourceIdToNewResourceIdMap).forEach(e=>{let[t,r]=e;g[r]&&(g[t]=g[r])});let _=(0,n.Y_K)(u),p=[],f=(0,n.sU5)(u,!1,g,p),m=(0,n.GEr)(u,"texts"),v=(0,n.GEr)(u,"effects");return(0,n.SyO)(u,h),r&&(0,n.fGK)(r.rawPreloadMaterialsMap,h,_),(0,n.rts)(f,g,h,d,p),(0,n.UIg)(m,v,g),(0,n.Cg6)(u,m,v),!function(e){let t=null==e?void 0:e.canvas_config;if(!t||!(null==t?void 0:t.dom_width)||!(null==t?void 0:t.dom_height))return;let r=(0,s.Ce)([t.dom_width,t.dom_height]);e.canvas_config.dom_width=r[0],e.canvas_config.dom_height=r[1]}(u),(0,o.oe)(a.LVVE_FILL_JSON),u}},462132:function(e,t,r){"use strict";r.d(t,{p:function(){return l},y:function(){return s}});var i,a=r(901840),n=r(426336),o=r(49299);var s=((i={})[i.Init=0]="Init",i[i.Replace=1]="Replace",i);let c=async e=>{let{builtIn:t,isNewDraft:r,segmentMaterial:i,coverNormalizedPath:a,replaceType:o,renderManager:s,targetRealPath:c}=e,{duration:l,type:d,width:u,height:h}=i,g="Video";switch(o){case"cover":g=a.endsWith(".gif")?"ImageVideo":"Image";break;case"lost":g="Image";break;case"original":n.cVg.MetaTypeVideo===d?g="Video":n.cVg.MetaTypeGif===d?g="ImageVideo":[n.cVg.MetaTypeImage,n.cVg.MetaTypePhoto].includes((null!=d?d:"").toLowerCase())&&(g="Image")}return"Video"===g?await s.getMediaFileInfo(c,""):r&&t&&t.height&&t.width?{width:t.width,height:t.height,duration:l,rotation:0,type:g}:r?await s.getMediaFileInfo(c,""):{width:u,height:h,duration:l,rotation:0,type:g}};async function l(e,t,r,i,s){let l,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0,g=arguments.length>8?arguments[8]:void 0,{dataSdk:_,draftPathStore:p}=e,{cutSame:f,draftView:m,api:v}=_;!h&&(l=v.batch.batchStart());let y=[];g?y=[g]:(y=m.getAllSubDraft(!0).map(e=>e.getDraftId())).unshift(m.getDraftId());let S={};if(i&&!g){var b,M;let{webVideoEditorInfo:t}=e.cloudMetaManager.getMeta().draft;(null!==(b=null==t?void 0:t.template_infos)&&void 0!==b?b:[]).map(e=>e.template_id).forEach(t=>{let{builtIns:r}=e.draftTemplateManager.getTemplateSync(t).preload;r.forEach(e=>{S[(0,a.F)(e)]=e})}),(null!==(M=null==d?void 0:d.video_algorithms)&&void 0!==M?M:[]).forEach(e=>{let{path:t}=e;t&&_.api.attachment.insertVideoAlgorithms({videoAlgorithms:[e]})})}let k=async a=>{let l=f.getMutableVideos(a,!!g),d=a&&a!==m.getDraftId()?m.getDraftById(a):m,h=u?l.map((e,t)=>{var r;let i=u[t];if(!(null==i?void 0:i.filled)||(0,o.LL)(i.path))return e;let a=null!==(r=f.segmentId2initialSpeed[e.segmentId])&&void 0!==r?r:1;return i.metaType!==n.cVg.MetaTypePhoto&&i.duration<n.pMA.times(e.targetDuration,.5*a,"bigint")?e:{...i,id:e.id,segmentId:e.segmentId,crop:[],width:e.width,height:e.height}}).filter(Boolean):l,_=Promise.resolve({results:{}});u&&(_=s.getNewTemplateSubjectCropResult(h,u,e.draftTemplateManager.getTemplateId()));let y=h.map(async e=>{let r=m.getSegmentById(e.segmentId,d);if(r&&r.__segment_struct_type===n.Ocy.SegmentVideo)try{let{coverPath:o}=e,s=t.resourceRecords.pathRecords.safeGet(o),l=e.path,d=t.resourceRecords.pathRecords.safeGet(l),u=l,h=d,g="original",_=null!=d?d:l,f=null!=s?s:o;if(""!==_&&!_.includes("://")&&!t.fs.isExist(_)||""===_){if(""!==f&&(t.fs.isExist(f)||t.resourceRecords.pathRecords.safeGet(o)))u=o,g="cover",h=s;else{var a;u=n.BeO.templateSlotLostVideoHolderPath,h=null===(a=t.resourceRecords.getRecordBySegmentPath(n.BeO.templateSlotLostVideoHolderPath))||void 0===a?void 0:a.resPath,g="lost"}}let m=S[p.getResourceKeyFromDraftPath(u)||""],{width:v,duration:y,height:b,type:M,rotation:k}=await c({builtIn:m,isNewDraft:i,segmentMaterial:r.material,coverNormalizedPath:o,replaceType:g,renderManager:t,targetRealPath:null!=h?h:""});return{...(0,n.FeB)({id:e.id,path:u,crop:e.crop,sourceStart:e.sourceStart,assetMd5:e.assetMd5,sourcePlatform:e.sourcePlatform,materialId:e.materialId,originMaterialId:e.originMaterialId,materialName:e.materialName,volume:e.volume,initialSpeed:r.speed.speed}),width:v,height:b,rotation:k,mediaType:M,duration:y,originalPath:l}}catch(e){console.warn("[startup] setTemplateMutableInfo get media info failed",e)}}),b=(await Promise.all(y)).filter(e=>!!e);b.length>0&&(v.template.setMutableVideos({draftId:a,videos:b},!1,1===r),u&&Promise.allSettled([_]).then(e=>{let[t]=e;s.applySubjectCropToNewTemplate(t)}))},T=y.map(e=>k(e));await Promise.all(T),l&&v.batch.batchEnd(l,{canUndoRedo:!1,clearRedoStack:!1,isRecovery:!0})}},85446:function(e,t,r){"use strict";r.d(t,{c:function(){return o}});var i=r(356954);let a="cloud_space_popup";class n{getEventParams(){return this._params}constructor(e){this._params=e,this.eventName=a}}function o(e,t,r){a===r&&(0,i.K)(e,n,[t])}},688974:function(e,t,r){"use strict";r.d(t,{_:function(){return a}});var i,a=((i={}).EDIT="edit",i.SMART_AD_EDIT="smart_ad_edit",i.TEXT_TO_VIDEO="text_to_video",i.REMOVE_BACKGROUND="remove_background",i.SMART_DERIVATION="smart crop",i)},450038:function(e,t,r){"use strict";r.d(t,{B:function(){return n}});var i=r(356954);class a{getEventParams(){return{action:this._params.action,enter_from:this._params.enterFrom}}constructor(e){this._params=e,this.eventName="apply_draft_permission"}}function n(e,t){(0,i.K)(e,a,[t])}},279627:function(e,t,r){"use strict";r.d(t,{v:function(){return d}});var i=r(960395),a=r(356954),n=r(108692),o=r(425427);class s{getEventParams(){return{draft_permissions:this._params.draftSharePermission,space_permissions:this._params.workspaceSharePermission,page_name:this._params.pageName,action:"show"}}constructor(e){this._params=e,this.eventName="collaborator_error_page"}}async function c(e){let[t,r,a]=e.invokeFunction(e=>[e.get(i.q),e.get(n.n),e.get(o.rO)]),s=r.dataSdk.draftView.getDraftId()||a.draftIdFromUrl,c=r.draftWorkspaceManager.workspaceId,[l,d]=(await t.getDraftShareInfo({packageKey:s,workspaceId:c})).pair();return l?-1:d.access_type}async function l(e){let[t,r]=e.invokeFunction(e=>[e.get(n.n),e.get(o.rO)]),i=t.dataSdk.draftView.getDraftId()||r.draftIdFromUrl,a=await t.draftWorkspaceManager.getIsApplyAllowed(i);return void 0===a?-1:a?0:1}async function d(e,t){let r=void 0===t.draftSharePermission?c(e):Promise.resolve(t.draftSharePermission),i=void 0===t.workspaceSharePermission?l(e):Promise.resolve(t.workspaceSharePermission),[n,o]=await Promise.all([r,i]);(0,a.K)(e,s,[{...t,draftSharePermission:n,workspaceSharePermission:o}])}},38272:function(e,t,r){"use strict";r.d(t,{n:function(){return n}});var i=r(356954);class a{getEventParams(){return{action:this._params.action}}constructor(e){this._params=e,this.eventName="exit_page_popup"}}function n(e,t){(0,i.K)(e,a,[t])}},641917:function(e,t,r){"use strict";r.d(t,{L:function(){return n}});var i=r(356954);class a{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="ai_writer_entrance"}}function n(e,t){(0,i.K)(e,a,[t])}},553748:function(e,t,r){"use strict";r.d(t,{u:function(){return n}});var i=r(356954);class a{getEventParams(){return{prompt_source:"input",...this._params}}constructor(e){this._params=e,this.eventName="text_to_video_intelligent_script_action"}}function n(e,t){(0,i.K)(e,a,[t])}},770311:function(e,t,r){"use strict";r.d(t,{G:function(){return n},d:function(){return s}});var i,a=r(356954);var n=((i={}).Show="show",i.On="on",i.Off="off",i);class o{getEventParams(){return{action:this._params.action}}constructor(e){this._params=e,this.eventName="edit_player_douyin_preview"}}function s(e,t){(0,a.K)(e,o,[t])}},526867:function(e,t,r){"use strict";r.d(t,{j:function(){return l}});var i=r(356954),a=r(407899),n=r(271697),o=r(153614);class s{getEventParams(){return{url:location.href,url_path:location.pathname,title:document.title,duration:this._duration,from:this._from}}constructor(e,t){this._duration=e,this._from=t,this.eventName="page_stay_time"}}class c{updateTime(){this._lastTime=Date.now()}report(e){(0,i.K)(this._containerService,s,[Date.now()-this._lastTime,e]),this._lastTime=Date.now()}constructor(e){this._containerService=e,this._lastTime=Date.now()}}function l(e){let t=new c(e),r=(0,n.r)(()=>{t.report("from-timer")},6e4),i=(0,a.n)(window,"beforeunload",()=>{t.report("from-beforeunload")}),s=(0,a.n)(window,"blur",()=>{t.report("from-onblur"),r.dispose()}),l=(0,a.n)(window,"focus",()=>{t.updateTime(),r.dispose(),r=(0,n.r)(()=>{t.report("from-timer")},6e4)});return(0,o.UQ)(()=>{i.dispose(),s.dispose(),l.dispose(),r.dispose()})}},873482:function(e,t,r){"use strict";r.d(t,{m:function(){return n},n:function(){return s}});var i,a=r(356954);var n=((i={})[i.AllFailed=-1]="AllFailed",i[i.NoSubject=0]="NoSubject",i[i.SomeSuccess=1]="SomeSuccess",i);class o{getEventParams(){var e;return{material_type:null!==(e=this._params.materialType)&&void 0!==e?e:"image",time:this._params.time,status:this._params.status}}constructor(e){this._params=e,this.eventName="objects_recognized"}}function s(e,t){(0,a.K)(e,o,[t])}},49200:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var i=r(356954);class a{getEventParams(){let{actionType:e,aspectRatio:t,buttonStatus:r,colorCode:i,isCommercial:a,isVip:n,keywordSource:o,materialCategory:s,materialChannel:c,materialDuration:l,materialForthcategory:d="none",materialForthcategoryId:u="none",materialId:h,materialName:g,materialSubcategory:_="none",materialSubcategoryId:p="none",materialThirdcategory:f="none",materialThirdcategoryId:m="none",optionType:v,rank:y,scene:S,searchId:b,requestId:M,recommendId:k,searchKeyword:T,stickerCategory:I,wordPosition:w,searchTabName:P,searchStartTabName:x,materialGroupcategory:C,category:E,displayMode:D,keywordRegion:F,isSearchWordPreset:O,isSearchTemplatePreset:A,isPreset:j,space_id:R,space_type:L,space_user_cnt:V}=this._params;return{category:E,action_type:e,aspect_ratio:t,button_status:r,color_code:i,is_commercial:a?"true":"false",is_vip:n?1:0,keyword_source:o||void 0,material_category:s,material_channel:c,material_duration:l?Math.floor(l):void 0,material_forthcategory:d,material_forthcategory_id:u,material_id:h,material_name:g,material_subcategory:_,material_subcategory_id:p,material_thirdcategory:f,material_thirdcategory_id:m,option_type:v,rank:y,scene:S,request_id:M,search_id:b,rec_id:k,search_keyword:T||void 0,sticker_category:I,word_position:w||void 0,search_tab_name:P,search_start_tab_name:x,material_groupcategory:C,display_mode:D,keyword_region:F,search_word_preset:O?"1":"0",search_template_preset:A?"1":"0",is_preset:j,space_id:R,space_type:L,space_user_cnt:V}}constructor(e){this._params=e,this.eventName="click_material_item"}}function n(e,t){(0,i.K)(e,a,[t])}},570895:function(e,t,r){"use strict";r.d(t,{n:function(){return n}});var i=r(356954);class a{getEventParams(){return{option:this._params.show?"on":"off",action_type:this._params.actionType}}constructor(e){this._params=e,this.eventName="sidebar_option"}}function n(e,t){(0,i.K)(e,a,[t])}},769273:function(e,t,r){"use strict";r.d(t,{s:function(){return s}});var i=r(789786),a=r(108692),n=r(356954);class o{getEventParams(){return{draft_id:this._mainDraftService.dataSdk.draftView.getDraftId(),current_page:this._params.current_page,action_type:this._params.action_type}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="edit_player_pause"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,i.gn)([(0,i.fM)(1,a.n),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===a.n?Object:a.n])],o)},839573:function(e,t,r){"use strict";r.d(t,{U:function(){return d}});var i=r(789786),a=r(108692),n=r(896413),o=r(425427),s=r(356954),c=r(861631);class l{getEventParams(){return{action:this._params.action,template_id:this._params.templateId,video_type_id:this._params.videoTypeId}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="template_locate_popup"}}function d(e,t){let r=e.invokeFunction(e=>e.get(n.a)),i=e.invokeFunction(e=>e.get(a.n)),d=e.invokeFunction(e=>e.get(o.rO)),{subDraftTemplateId:u}=r.segmentSelection,h=null!=u?u:i.draftTemplateManager.getTemplateId();if(!(0,o.JY)(d)||!h)return;let g=i.draftTemplateManager.getTemplateSync(h),_=(0,c.tt)(g.templateType,g.producerAppId);(0,s.K)(e,l,[{templateId:h,videoTypeId:_,action:t}])}l=(0,i.gn)([(0,i.fM)(1,a.n),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===a.n?Object:a.n])],l)},589630:function(e,t,r){"use strict";r.d(t,{q:function(){return n}});var i=r(356954);class a{getEventParams(){return{}}constructor(){this.eventName="click_add_transition"}}function n(e){(0,i.K)(e,a)}},51122:function(e,t,r){"use strict";r.d(t,{W:function(){return n}});var i=r(356954);class a{getEventParams(){let{action:e}=this._params;return{action:e}}constructor(e){this._params=e,this.eventName="template_publish"}}function n(e,t){(0,i.K)(e,a,[t])}},337081:function(e,t,r){"use strict";r.d(t,{$0:function(){return U},An:function(){return A},Ay:function(){return j},BE:function(){return g},Cw:function(){return y},Em:function(){return T},Kb:function(){return B},Op:function(){return b},Ph:function(){return p},RF:function(){return D},Ym:function(){return R},_M:function(){return V},bf:function(){return C},cI:function(){return v},cS:function(){return k},dP:function(){return I},dT:function(){return E},i1:function(){return S},jw:function(){return _},kQ:function(){return L},ke:function(){return P},r$:function(){return m},r1:function(){return x},sW:function(){return f}});var i=r(539525),a=r(54827),n=r(808213),o=r(426336),s=r(504826),c=r(342812),l=r(374497),d=r(658955),u=r(679827),h=r(229749);let g=(e,t,r)=>{var i,a,n;let o=null!==(a=null===(i=t.draftIdToRelationVideoGroup[e])||void 0===i?void 0:i.size)&&void 0!==a?a:0;return Number((null!==(n=r.extra.fragments)&&void 0!==n?n:[]).filter(e=>!e.relation_video_group).length)+o||0},_=e=>{var t;return(null!==(t=e.extra.fragments)&&void 0!==t?t:[]).filter(e=>e.gameplay_algorithm).length},p=(e,t)=>{let{subDraftApplySpeedViewManager:r}=t,i=r.getCombinationApplySpeedDraftViewById(e.id);if(!i)return[];let a=new Set;return i.getAllSegments().forEach(e=>{if((0,o.hey)(e)){let t=(0,o.MnT)(e.material);(null==t?void 0:t.algorithm)&&a.add(null==t?void 0:t.algorithm)}}),Array.from(a)},f=(e,t)=>{let{subDraftApplySpeedViewManager:r}=t,i=r.getCombinationApplySpeedDraftViewById(e.id);if(!i)return[];let a={};return i.getAllSegments().forEach(e=>{var t,r,i;if(!(0,o.hey)(e))return;let n=e.material;n.reversePath&&(a.reverse=!0);let{algorithms:s=[],path:c=""}=n.videoAlgorithm;if(s.length>0||c.length>0)for(let e of(n.videoAlgorithm.motionBlurConfig&&(a.motion_blur=!0),n.videoAlgorithm.deflicker&&(a.deflicker=!0),n.videoAlgorithm.noiseReduction&&(a.noise_reduction=!0),s))e.type===o.zzh.ComplementFrame&&(a.complement_frame=!0);n.objectLocked&&(a.object_locked=!0);let{matting:l}=n;(null==l?void 0:l.path)&&(3n===l.flag&&(a.smart_matting=!0),5n===l.flag&&(a.custom_matting=!0)),3n===n.matting.flag&&(a.smart_matting=!0),(null===(t=n.stable)||void 0===t?void 0:t.stableLevel)>0&&(a.stable=!0),(null!==(i=null===(r=e.chroma)||void 0===r?void 0:r.color)&&void 0!==i?i:"").length>0&&(a.chromas=!0)}),Object.keys(a)},m=e=>e.preload.mutableTexts.length,v=e=>{let t=[];return e.forEach(e=>{(0,o.SiN)(e)&&t.push(e.material.resourceId)}),{templateFilterCnt:t.length,templateFilterIds:t.join(",")}},y=(e,t,r)=>(0,l.fl)(e,t,r).template_algorithm_cnt,S=e=>{var t;let r=null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.fragments;return(null==r?void 0:r.length)||0},b=e=>Number(e.canUpdateMusic),M=(e,t,r)=>{let i=t.getMutableAudios(e,!0),a=r.preload.mutableAudios;return i.length!==a.length||i.some((e,t)=>{var r;return(null===(r=a[t])||void 0===r?void 0:r.material_name)!==e.materialName})},k=(e,t,r)=>{let i=t.getMutableAudios(e,!0),a=r.preload.mutableAudios;return(0!==i.length||0===a.length)&&M(e,t,r)},T=(e,t,r)=>{let i=b(r),a=M(e,t,r),n="0";return i?a&&(n="1"):n="-1",n},I=(e,t,r)=>{let i=b(r),a=M(e,t,r);return Number(i&&a)},w=(0,i.Z)((e,t)=>{let r=t.getSegmentByDraftId(e);return!!(r&&r.targetTimerange.start>0)},(e,t)=>t.getMutableVideos(e).some(e=>{let{filled:t,visible:r}=e;return t||!r}),(e,t,r)=>{let i=t.getMutableTexts(e),a=r.preload.mutableTexts;return i.length!==a.length||i.some(e=>{let{text:t}=e;return a.every(e=>{let{text:r}=e;return r!==t})})},M),P=(0,a.Z)(w,Number),x=e=>e.templateType===s.WY.BUSINESS?1:0,C=()=>!0,E=e=>Number(e.mute),D=e=>{let t=0;for(let r of e){if(!(0,o.hey)(r))continue;let{figures:e}=r;if(!!e.length)for(let r of e){if(!!(0,n.W)(r))t=1}}return t},F=(e,t)=>"none"===e&&"none"===t?"none":"none"===e?t:"none"===t?e:`${e}&${t}`,O=e=>{var t,r;let i=[];return(null===(r=e.animations)||void 0===r?void 0:null===(t=r.animations)||void 0===t?void 0:t.length)&&e.animations.animations.forEach(e=>{var t,r,a;i.push({type:null!==(t=c.d[e.type])&&void 0!==t?t:"",name:null!==(r=e.name)&&void 0!==r?r:"",duration:Number((null!==(a=null==e?void 0:e.duration)&&void 0!==a?a:0n)/1000000n)})}),i},A=e=>{let t=[],r=[],i=e.length?e[0]:void 0,a=e.length?e.slice(1).reverse():[];return null==i||i.segments.filter(o.hey).forEach(e=>{t.concat(O(e))}),a.forEach(e=>null==e?void 0:e.segments.filter(o.hey).forEach(e=>{r.concat(O(e))})),F(t.map(e=>{let{type:t,name:r,duration:i}=e;return`${t}:${r}:${i}`}).join(",")||"none",r.map(e=>{let{type:t,name:r,duration:i}=e;return`${t}:${r}:${i}`}).join(",")||"none")};function j(e){let t=0,r=0,i=0,a=0,n=[],s=[],c=[];for(let h of e)for(let e of h.segments){if((0,o.NHR)(e)){var l,d,u;t++,i+=(0,o.NN_)(e.targetTimerange.duration,1e6);let{digitalHuman:r}=e;n.push(r.digitalHumanId),s.push(null!==(u=null===(l=r.mask)||void 0===l?void 0:l.resourceId)&&void 0!==u?u:"7242668175614022146"),c.push((null===(d=r.voiceInfo)||void 0===d?void 0:d.toneType)||"unknown")}(0,o.ot2)(e)&&(r++,a+=(0,o.NN_)(e.targetTimerange.duration,1e6))}return{ai_character_cnt:t,ai_character_processing_cnt:r,ai_character_time:i,ai_character_processing_time:a,ai_character_id:n.join(","),ai_character_frame:s.join(","),ai_character_tone:c.join(",")}}let R=e=>{let t=e.length?e[0]:void 0;return(null==t?void 0:t.segments.length)||0},L=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:",";return null!==(t=null==e?void 0:e.map(e=>"string"==typeof e&&0===e.length?"none":e).join(i))&&void 0!==t?t:r},V=e=>{var t,r;let i=null!==(r=null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.fragments)&&void 0!==r?r:[];return Array.isArray(i)&&i.some(e=>!!e.relation_video_group)};function U(e){let t=e.getDraftChangedSummary(),r={is_change_ratio:0},i=t.is_change_ratio?1:0,a=t.change_ratio_type;r.is_change_ratio=i,i&&a&&(r.change_ratio_type=a);let n=e.getSourceTemplateId();return(a===d.C.ChangeTemplate||a===d.C.ChangeTemplateResizeBackground)&&n&&(r.source_template_id=e.getSourceTemplateId()),r}function B(e){let t=[h.QO,h.yg];return(0,u.l)(t,e)}},542761:function(e,t,r){"use strict";r.d(t,{Q:function(){return n}});var i=r(356954);class a{getEventParams(){return{status:this._params.status,function_category:this._params.functionCategory,function_subcategory:this._params.functionSubCategory,function_thirdcategory:this._params.functionThirdCategory,panel_category:this._params.panelCategory,track_category:this._params.trackCategory,control_type:this._params.controlType}}constructor(e){this._params=e,this.eventName="click_function_panel_checkbox"}}function n(e,t){(0,i.K)(e,a,[t])}},657056:function(e,t,r){"use strict";r.d(t,{TK:function(){return n}});var i=r(356954);class a{getEventParams(){var e;let t={panel_category:this._params.panelCategory,status:this._params.status,material_duration:Number(this._params.materialDuration),material_format:this._params.materialFormat,material_name:this._params.materialName,material_resolution:this._params.materialResolution,material_size:this._params.materialSize,material_type:this._params.panelCategory,cutout_type:null!==(e=this._params.cutoutType)&&void 0!==e?e:"auto"};return this._params.duration&&(t=Object.assign(t,{duration:String(this._params.duration)})),this._params.failReason&&(t=Object.assign(t,{fail_reason:this._params.failReason})),void 0!==this._params.isCache&&(t=Object.assign(t,{is_cache:this._params.isCache})),t}constructor(e){this._params=e,this.eventName="remove_background_status"}}function n(e,t){(0,i.K)(e,a,[t])}},985395:function(e,t,r){"use strict";r.d(t,{T:function(){return n},h:function(){return s}});var i,a=r(356954);var n=((i={}).Success="success",i.Fail="fail",i.Cancel="cancel",i);class o{getEventParams(){return{status:this._params.status,apply_time:this._params.applyTime,apply_to_all:this._params.applyToAll,apply_to_local:this._params.applyToLocal,error_code:this._params.errorCode,text_len:this._params.textLen,text_section:this._params.textSection,text_type:this._params.textType,tone:this._params.tone,tone_id:this._params.toneId,with_text_updates:this._params.autoUpdate,tts_type:this._params.ttsType}}constructor(e){this._params=e,this.eventName="text_function_reading_status"}}function s(e,t){(0,a.K)(e,o,[t])}},457564:function(e,t,r){"use strict";r.d(t,{S:function(){return n}});var i=r(356954);class a{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="perf_cover_video_frame_set_cover"}}function n(e,t){(0,i.K)(e,a,[t])}},447273:function(e,t,r){"use strict";r.d(t,{T:function(){return n}});var i=r(356954);class a{getEventParams(){let{saveStatus:e,failReason:t}=this._params,r={save_status:e};return t&&(r.failReason=t),r}constructor(e){this._params=e,this.eventName="exist_offline_data"}}function n(e,t){(0,i.K)(e,a,[t])}},332970:function(e,t,r){"use strict";r.d(t,{J7:function(){return y},oI:function(){return p},zo:function(){return v}});var i=r(789786),a=r(221963),n=r(425427),o=r(896413),s=r(108692),c=r(861810),l=r(237225),d=r(31463),u=r(356954),h=r(805794);function g(e,t){let{msgOrigin:r,stack:i="",threadIdOrigin:a,threadStack:n}=e,{appVersion:o,veBuildId:s,veFullBuildVersion:c,isSIMD:l}=null!=t?t:{},d=`${c}${l?"_simd":""}`,u=null!=r?r:"",h=a;if(/wasm-function\[\d*\]/gim.test(i))u=i.replace(/\n.*?(?:(\d*?:\d*?)\)|wasm-function\[(\d*)\]:0x[0-9a-z]+\)?)/gim,function(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return`,${null!==(e=r[1])&&void 0!==e?e:r[2]}`});else if(u){let e=u.match(/(pthread sent an error!.*?: Uncaught Error: )(\d+): (.*$)/);if(e){let[,t,r]=e;h=Number(r),u=t}}let g=`[${d}] ${u}`;return{msg:u,unionMsg:g,stack:i,threadId:h,threadStack:n,appVersion:o,veVersion:s,videoEditorScmVersion:d,buildCommitId:"",buildTime:""}}class _{getEventParams(){let{msg:e,unionMsg:t,appVersion:r,veVersion:i,videoEditorScmVersion:a=""}=g(this._params,this._videoEnvironmentService),n=a.split(".",4).map(e=>(0,l.hk)(e));return{error_msg:e,union_error_msg:t,app_version:r,ve_version:i,videoeditor_scm_version:a,videoeditor_scm_version_v1:n[0],videoeditor_scm_version_v2:n[1],videoeditor_scm_version_v3:n[2],videoeditor_scm_version_v4:n[3],url:location.href}}constructor(e,t){this._params=e,this._videoEnvironmentService=t,this.eventName="ve_on_crash_emit"}}function p(e,t){(0,u.K)(e,_,[t])}_=(0,i.gn)([(0,i.fM)(1,n.rO),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IVeCrashCbParams?Object:IVeCrashCbParams,void 0===n.rO?Object:n.rO])],_);class f{_getDumpLog(){return this._mainEditorWidgetService.renderManager.dumpLogInfo()}_getCrashMsg(e){let t=this._getDumpLog(),r=e;if(/pthread sent an error!.*?: Uncaught Error: /.test(r)){let e=t.match(/\[Exception throw\](.|\n)*?(?:!@#\$|$)/gi);null!==e&&(r+=e[e.length-1].replace("!@#$","").replace(/\n.*?(?:(\d*?:\d*?)\)|wasm-function\[(\d*)\]:0x[0-9a-z]+\)?)/gim,function(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return`,${null!==(e=r[1])&&void 0!==e?e:r[2]}`}))}return r}_getCrashInfo(){return g(this._params,this._videoEnvironmentService)}getEventParams(){let{msg:e=""}=this._getCrashInfo();return{error_msg:this._getCrashMsg(e)}}getLogContent(){let{threadId:e="",stack:t="",threadStack:r=""}=this._getCrashInfo(),i="";try{i+=JSON.stringify(t)}catch(e){i+=t.toString()}let a=this._getDumpLog();return{prefixContent:this._prefixContent,threadId:e,crashStack:i,threadStack:r,dumpLog:a}}getLogContextParams(){let{msg:e=""}=this._getCrashInfo(),t=this._getCrashMsg(e),r=this._mainDraftService.dataSdk.getDraftStr();return{...(0,a.Z)(this._mainDraftService,this._videoEnvironmentService),log_name:this.eventName,...this._extra,template:r,crashMsg:t}}constructor(e,t,r,i,a,n){this._prefixContent=e,this._extra=t,this._params=r,this._videoEnvironmentService=i,this._mainEditorWidgetService=a,this._mainDraftService=n,this.eventName="VE_CRASH_LOG"}}f=(0,i.gn)([(0,i.fM)(3,n.rO),(0,i.fM)(4,o.a),(0,i.fM)(5,s.n),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,"undefined"==typeof Record?Object:Record,"undefined"==typeof IVeCrashCbParams?Object:IVeCrashCbParams,void 0===n.rO?Object:n.rO,void 0===o.a?Object:o.a,void 0===s.n?Object:s.n])],f);class m extends f{constructor(...e){super(...e),this.eventName="ve_on_crash_emit"}}function v(e,t){let r=e.createInstance(new c.M(m,["",{},t]));e.invokeFunction(async e=>{let t=e.get(d.m);t.reportDevEvent(r.eventName,r.getEventParams());let i=JSON.stringify(r.getLogContent()),a=await h.B.saveLog(i);a&&t.reportDevEvent(`${r.eventName}_log`,{key:a})})}function y(e,t){let{msgOrigin:r,threadIdOrigin:i,threadStack:a}=t;e.invokeFunction(e=>{let t=e.get(d.m),n=`${r}|${i}|${a}`,o=Error(`[data_layer] - ve_error (${n});`);t.reportDevError("data_layer",o,{level:"error",label:"data_layer",reason:n,describe:"ve_error"})})}},725341:function(e,t,r){"use strict";r.d(t,{c:function(){return n},o:function(){return o}});var i=r(426336);let a=(e,t)=>{let{modifyFlags:r,draftPath:a,selectionUpdate:n,textMaterial:o,textMaterialId:s}=t,c=i.ic0.combineModifyFlags(r),l=i.ic0.isApplyTextPresetStyleFlag(c),d=i.ysb.getTextBindInfo(e,s);if(d){let{textMaterial:t}=d;i.ysb.isNewTextTemplateSegment(e.material)&&n&&!t.isRichText&&(t.isRichText=!0)}return l?i.ysb.updateApplyTextStyle(e,o,s,c):i.ysb.updateTextMaterial(e,o,s,c)},n=(e,t)=>{let{segId:r,textMaterialId:n}=t,o=e.getSegmentById(r);if(!o||!(0,i.Q2R)(o))return[];t.modifyFlags=t.modifyFlags.filter(e=>e!==i.XHM.ModifyRichTextStyleToAll);let s=!n,c=o.material.textInfoResources.map(e=>e.textMaterial).filter(e=>s||e.id===n),l=e.getTrackBySegmentId(r).id,d=e.getTrackIndexBySegmentId(r),u=o.clone();c.forEach(e=>{a(u,{...t,textMaterialId:e.id})});let h=new i.kph;h.material=new i._0h,h.material.textInfoResources=u.material.textInfoResources,h.material.nonTextInfoResources=u.material.nonTextInfoResources;let g=(0,i.xXD)({__segment_struct_type:o.__segment_struct_type});return i.T8X.pick(o,h,g),[{trackId:l,trackIndex:d,segmentId:r,segmentDelta:h,sourceSegmentDelta:g}]},o=(e,t,r)=>{let n=e.getSegmentById(t);if(!n||!(0,i.Q2R)(n))return;let o=e.getTrackBySegmentId(t).id,s=e.getTrackIndexBySegmentId(t),c=n.clone();r.forEach(e=>{a(c,{...e,segId:t})});let l=new i.kph;l.material=new i._0h,l.material.textInfoResources=c.material.textInfoResources,l.material.nonTextInfoResources=c.material.nonTextInfoResources;let d=(0,i.xXD)({__segment_struct_type:n.__segment_struct_type});return i.T8X.pick(n,l,d),{trackId:o,trackIndex:s,segmentId:t,segmentDelta:l,sourceSegmentDelta:d}}},677056:function(e,t,r){"use strict";r.d(t,{MR:function(){return o},Td:function(){return s},rA:function(){return c}});var i=r(426336),a=r(728631),n=r(105304);function o(e){if(!e)return!1;let t=BigInt(e.attribute);return!!((0,i.MDU)(e)?i.$SW.MuteFlag:t&&i.$SW.MuteFlag)}function s(e){let{disable:t,workbenchService:r}=e;t?(r.hideSiderMenu(!0),r.unActiveSidebarMenu()):(r.hideSiderMenu(!1),r.activeSiderMenuByName(a.j.SiderMenuMedia,"auto"))}let c=e=>{let{disable:t,timelineManager:r,mainEditorWidgetService:i,keyBindingService:a}=e;t&&(i.segmentSelection.setExpandedSegmentId(null),i.segmentSelection.setSelectedData({segmentIds:[]})),r.timelineUI.zoom.setEnableZoom(!t),i.canvasManager.disabledSelectWidget(t),t?(r.timelineInteract.setDisableInteract([n.Vf.SEQUENCE,n.Vf.SELECTION]),a.disableKeybinding()):(r.timelineInteract.clearDisableInteract(),a.restoreKeybinding())}},797913:function(e,t,r){"use strict";r.d(t,{J:function(){return n}});var i=r(335290),a=r(744268);let n=(0,i.LO)(a.Ui)},974116:function(e,t,r){"use strict";r.d(t,{X:function(){return o}});var i=r(587892),a=r(800788),n=r(426336);class o{getModels(){return this._models}getModel(e){return this._models.get(e)}createModel(e){let t=new n.hF;return e&&(t._draft.recovery(e),t._onChangeDiff.fire(t.getChangeNodesFromModel())),this._onModelAdded.fire(t),t}destroyModel(e){let t=this._models.get(e);(0,a.ZB)(t),this._models.delete(e),this._onModelRemoved.fire(t)}constructor(){this._models=new Map,this._onModelAdded=new i.Q,this._onModelRemoved=new i.Q,this.onModelAdded=this._onModelAdded.event,this.onModelRemoved=this._onModelRemoved.event}}},437612:function(e,t,r){"use strict";r.d(t,{F:function(){return i}});let i=(0,r(335290).yh)("draft-model")},624515:function(e,t,r){"use strict";r.d(t,{O:function(){return i}});let i=(0,r(335290).yh)("global-exit-confirm-service")},545772:function(e,t,r){"use strict";r.d(t,{o:function(){return p}});var i=r(789786),a=r(587892),n=r(800788),o=r(425427),s=r(827084),c=r(420072),l=r(315201),d=r(433140),u=r(127830),h=r(426336),g=r(298730),_=r(210823);class p{_checkIsNewEmpty(){return!!(0,o.JY)(this._videoEnvironmentService)&&(0,o.xA)(this._videoEnvironmentService)}async getTemplate(e){let t=this._resourceService.get((0,s.Bc)(e),u._g.VideoTemplate);return await (0,c.Z)(t),(0,n.Y2)((0,l.R)(t.value),"template must ensure before draft using."),t.value}getTemplateSync(e){let t=this._resourceService.get((0,s.Bc)(e),u._g.VideoTemplate);return(0,n.Y2)(t),(0,n.Y2)((0,l.R)(t.value),"template must ensure before draft using."),t.value}setTemplate(e,t){this._cloudMetaManager.setTemplate(e,t),this._isNewEmpty=!1,this._workbench.toggleSiderMenuWidthCache(!0),this._onTemplateIdChange.fire(e),this._onIsNewEmptyChange.fire(this._isNewEmpty)}resetTemplate(){this._cloudMetaManager.resetTemplate(),this._isNewEmpty=!0,this._onIsNewEmptyChange.fire(this._isNewEmpty)}getTemplateId(){return this._cloudMetaManager.getTemplateId()}getCombinationSegmentTemplateIds(){return(0,g.q6)(this._dataSdk.draftView.getAllTracks()).map(e=>e.templateId)}addTemplateMetaInfo(e){let{draft:t}=this._cloudMetaManager.getMeta(),{webVideoEditorInfo:r={}}=t,{template_infos:i=[]}=r;i.push(e),this._cloudMetaManager.setMetaDraft({...t,webVideoEditorInfo:{...r,template_infos:i}})}getTemplateMetaInfo(e){var t;let{webVideoEditorInfo:r}=this._cloudMetaManager.getMeta().draft;return null==r?void 0:null===(t=r.template_infos)||void 0===t?void 0:t.find(t=>t.template_id===e)}removeTemplateMetaInfoById(e){let{draft:t}=this._cloudMetaManager.getMeta(),{webVideoEditorInfo:r={}}=t,i=null==r?void 0:r.template_infos;if(!i)return;let a=i.findIndex(t=>t.template_id===e);if(!(a<=-1))i.splice(a,1),this._cloudMetaManager.setMetaDraft({...t,webVideoEditorInfo:{...r,template_infos:i}})}updateDraftChangedSummary(e,t){let{draft:r}=this._cloudMetaManager.getMeta(),{webVideoEditorInfo:i={}}=r;!i.draft_changed_summary&&(i.draft_changed_summary={}),i.draft_changed_summary[e]={...i.draft_changed_summary[e],...t}}getDraftChangedSummary(e){var t,r,i,a,n,s,c,l,d,u,h,g;let _=this._cloudMetaManager.getMeta(),p=this._dataSdk.draftView.getDraftId(),f=(0,o.JY)(this._videoEnvironmentService),m=null!==(r=null===(t=_.draft.webVideoEditorInfo)||void 0===t?void 0:t.draft_changed_summary)&&void 0!==r?r:{};if(f)return{is_smart_crop:null!==(l=null===(i=m[p])||void 0===i?void 0:i.is_smart_crop)&&void 0!==l&&l,is_change_text:null!==(d=null===(a=m[p])||void 0===a?void 0:a.is_change_text)&&void 0!==d&&d,is_move_material:null!==(u=null===(n=m[p])||void 0===n?void 0:n.is_move_material)&&void 0!==u&&u,is_change_ratio:null!==(h=null===(s=m[p])||void 0===s?void 0:s.is_change_ratio)&&void 0!==h&&h,change_ratio_type:null!==(g=null===(c=m[p])||void 0===c?void 0:c.change_ratio_type)&&void 0!==g?g:void 0};{let t=!1,r=!1,i=!1;for(let a of null!=e?e:Object.keys(m)){let e=m[a];if(!!e)e.is_smart_crop&&(t=!0),e.is_change_text&&(r=!0),e.is_move_material&&(i=!0)}return{is_smart_crop:t,is_change_text:r,is_move_material:i}}}getMutableSegmentDefaultAttribute(e){return this._segmentIdToDefaultAttribute.get(e)}getSourceTemplateId(){var e,t,r;let i=this._cloudMetaManager.getMeta(),a=this._dataSdk.draftView.getDraftId(),n=null===(t=(null!==(r=null===(e=i.draft.webVideoEditorInfo)||void 0===e?void 0:e.draft_changed_summary)&&void 0!==r?r:{})[a])||void 0===t?void 0:t.source_template_id;return null!=n?n:""}setSourceTemplateId(e){if(!!this._isInTemplate)this.updateDraftChangedSummary(this._dataSdk.draftView.getDraftId(),{source_template_id:e})}get isNewEmpty(){return this._isNewEmpty}constructor(e,t,r,i,n){if(this._cloudMetaManager=e,this._dataSdk=t,this._videoEnvironmentService=r,this._resourceService=i,this._workbench=n,this._onIsNewEmptyChange=new a.Q,this._onTemplateIdChange=new a.Q,this._segmentIdToDefaultAttribute=new Map,this.onTemplateIdChange=this._onTemplateIdChange.event,this.onIsNewEmptyChange=this._onIsNewEmptyChange.event,this._isNewEmpty=this._checkIsNewEmpty(),this._isInTemplate=(0,o.JY)(this._videoEnvironmentService),this._isInTemplate){let e=this._dataSdk.onChangeDiff(t=>{if(t.actionOperateType!==h.aWQ.History)return;let r=this._cloudMetaManager.getTemplateId();r&&(this._onTemplateIdChange.fire(r),e.dispose())})}this._dataSdk.onChangeDiff(e=>{let{draftIdToMutableVideos:t,draftIdToMutableTexts:r}=this._dataSdk.cutSame,i=e=>{var t;let r=e.segmentId;if(this._segmentIdToDefaultAttribute.has(r))return;let i=this._dataSdk.draftView.getSegmentById(r),a=i&&(0,h.Ftn)(i)?[i.material.clone()]:void 0;i&&(0,h.Q2R)(i)&&(a=i.material.textInfoResources.map(e=>e.textMaterial.clone())),i&&this._segmentIdToDefaultAttribute.set(r,{clip:null===(t=i.clip)||void 0===t?void 0:t.clone(),volume:i.volume,textMaterials:a})};if(e.actionOperateType===h.aWQ.History){Object.keys(t).forEach(e=>{this._dataSdk.cutSame.getMutableVideos(e,!0).forEach(i)}),Object.keys(r).forEach(e=>{this._dataSdk.cutSame.getMutableTexts(e,!0).forEach(i)});return}for(let a of e[h.u4I.SEGMENT]){if(a.type===h.C8.ADD){let e=a.item.segment;if((0,h.duj)(e)){let a=e.materialDraft.draft.getDraftId(),n=t[a],o=r[a];n.forEach(i),o.forEach(i)}}if(a.type===h.C8.UPDATE){let e=this._dataSdk.draftView.getSegmentById(a.item.id);if(e&&(0,h.duj)(e)&&a.item.segment.templateId){let t=e.materialDraft.draft.getDraftId(),r=this._dataSdk.cutSame.getMutableVideos(t,!0),a=this._dataSdk.cutSame.getMutableTexts(t,!0);r.forEach(i),a.forEach(i)}}}}),this._isNewEmpty&&this._workbench.toggleSiderMenuWidthCache(!1)}}p=(0,i.gn)([(0,i.fM)(2,o.rO),(0,i.fM)(3,d.c),(0,i.fM)(4,_.e),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof CloudMetaManager?Object:CloudMetaManager,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===o.rO?Object:o.rO,void 0===d.c?Object:d.c,void 0===_.e?Object:_.e])],p)},74183:function(e,t,r){"use strict";r.d(t,{w:()=>t_});var i=r("789786"),a=r("876026"),n=r("29188"),o=r("533743"),s=r("532085"),c=r("260025"),l=r("961656"),d=r("38476"),u=r("779085"),h=r("693511"),g=r("425427"),_=r("108692"),p=r("624515"),f=r("797913"),m=r("426336"),v=r("639605"),y=r("230689"),S=r("782350"),b=r("31463"),M=r("200247"),k=r("434316"),T=r("800788"),I=r("850427"),w=r("948328"),P=r("433140");class x extends I.z{async preload(){let e=this._preloadManager.preloadPackageData((0,k.fC)(),!0),[t,r]=(await e).pair();if(t)return this._debuggerLogger.info(`preload \u{52A0}\u{8F7D} packageInfo \u{5931}\u{8D25}`),null;if(this.hasQuickImport(r))return this._debuggerLogger.info(`preload \u{5B58}\u{5728}\u{5FEB}\u{901F}\u{5BFC}\u{5165}\u{7D20}\u{6750}`),null;let i=this._preloadManager.preloadDraftResources(e,{shouldDisableProgressiveLoading:!0},this.filterPackageAssets,this.filterOnlineResources),a=this._preloadManager.preloadCombinationTemplates(e),n=[e,i,a],{waitForEnsureFinished:o,waitForMetasReady:s}=await i;return await Promise.all([o(),s()]),n}async resetDraft(e){let{draftIdFromUrl:t}=this._environmentService;try{var r,i,a,n,o,s;let[c,l]=e,[d,u]=(await c).pair();d&&(0,T.ZB)(u);let h=null==u?void 0:null===(r=u.meta)||void 0===r?void 0:r.draft,g=null==h?void 0:h.name;await this.restoreDraft({meta:null==u?void 0:u.meta,draftJson:null!==(s=null==u?void 0:u.template)&&void 0!==s?s:"",preloadResourcePromise:l,overrideDraftId:null!=t?t:null==u?void 0:null===(a=u.meta)||void 0===a?void 0:null===(i=a.draft)||void 0===i?void 0:i.id,overrideDraftName:g,draftDataVersion:null==u?void 0:null===(o=u.meta)||void 0===o?void 0:null===(n=o.uploadSource)||void 0===n?void 0:n.draft_ve_version,packageId:null==u?void 0:u.syncId})}catch(e){this._debuggerLogger.error(`resetDraft \u{8349}\u{7A3F}\u{8FD8}\u{539F}\u{5931}\u{8D25}: ${null==e?void 0:e.message}`)}}constructor(e,t,r,i,a,n,o,s){super(e,t,n,o,a),this._preloadManager=r,this._debuggerLogger=i,this._environmentService=s}}x=(0,i.gn)([(0,i.fM)(4,w.D),(0,i.fM)(5,P.c),(0,i.fM)(6,_.n),(0,i.fM)(7,g.rO),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IPreloadManager?Object:IPreloadManager,"undefined"==typeof DebuggerLogger?Object:DebuggerLogger,void 0===w.D?Object:w.D,void 0===P.c?Object:P.c,void 0===_.n?Object:_.n,void 0===g.rO?Object:g.rO])],x);var C=r("462132"),E=r("64604"),D=r("722169"),F=r("273238"),O=r("690613"),A=r("763832"),j=r("756024"),R=r("161442"),L=r("165312"),V=r("572013"),U=r("862678"),B=r("961298"),N=r("137309");class W{_initListener(){this._listenSocketOpen(),this._listenDraftUpdateNotice(),this._listenPageVisibilityChange()}_listenSocketOpen(){this._websocketService.getState()!==v.de.OPEN?this._websocketService.onOpen(this._handleLastestPackageId):this._handleLastestPackageId()}_listenDraftUpdateNotice(){this._websocketService.registerCallback(v.h1.DraftUpdateNotice,e=>{var t;this._debuggerLogger.info(`\u{63A5}\u{6536}\u{5230}\u{534F}\u{540C}\u{6D88}\u{606F}\u{FF0C}\u{7248}\u{672C}\u{53F7}: ${null===(t=e.pair()[1])||void 0===t?void 0:t.package_id}`),this._collabMessageManager.addCollabMessage(e),this._handleDraftUpdatedThrottle()})}_listenPageVisibilityChange(){document.addEventListener("visibilitychange",async()=>{if("visible"===document.visibilityState){this._debuggerLogger.info(`\u{9875}\u{9762}\u{53EF}\u{89C1}: ${this._state}, ${this._cacheState}`),this._state=this._cacheState,this._handleDraftUpdatedThrottle();return}await (0,A._)(3e5),"hidden"===document.visibilityState&&(this._debuggerLogger.info(`\u{9875}\u{9762}\u{4E0D}\u{53EF}\u{89C1}: ${this._state}, ${this._cacheState}}`),this._setCacheSate(this._state),this._state="pause")})}_checkCollabMessage(e){let[t,r]=e.pair();if(t)return!1;if(!r.package_id)return this._debuggerLogger.error("\u6821\u9A8C message: package_id \u4E3A\u7A7A"),!1;let{saveManager:i}=this._mainDraftService,a=i.getPackageId();return r.package_id!==a&&!0}_getCollabTask(){return(0,g.JY)(this._videoEnvironmentService)?this._containerService.createInstance(E._,this._dataSdk,this._ensureManager,this._preloadManager,this._canvasManager,this._draftTemplateManager,this._timelineManager,this._debuggerLogger):this._containerService.createInstance(x,this._dataSdk,this._ensureManager,this._preloadManager,this._debuggerLogger)}async _handleDraftUpdated(){try{var e,t,r,i,a;if(this._debuggerLogger.info(`\u{5F00}\u{59CB}\u{5904}\u{7406}\u{534F}\u{540C}\u{6D88}\u{606F}: ${this._collabMessageManager.isEmpty()}, ${this._state}`),this._collabMessageManager.isEmpty()||"idle"!==this._state)return;let n=this._collabMessageManager.getCommittingMessage();if(!n&&(this._collabMessageManager.moveWaitingToCommitting(),n=this._collabMessageManager.getCommittingMessage()),!this._checkCollabMessage(n))throw Error("checkCollabMessage invalid.");let{saveManager:o}=this._mainDraftService,s=performance.now();this._toggleCollabStateWorking("working");let c=null===(e=o.lockSave)||void 0===e?void 0:e.call(o),l=this._getCollabTask();this._debuggerLogger.info(`\u{5F00}\u{59CB} preload: ${null===(t=n.pair()[1])||void 0===t?void 0:t.package_id}`);let u=await l.preload(),h=performance.now();if(this._debuggerLogger.info(`\u{7ED3}\u{675F} preload: ${null===(r=n.pair()[1])||void 0===r?void 0:r.package_id}`),!u)throw this._debuggerLogger.info(`\u{534F}\u{540C}\u{6D88}\u{606F}\u{5904}\u{7406}\u{7ED3}\u{675F}\u{FF0C}preloadResult \u{4E3A}\u{7A7A}: ${null===(a=n.pair()[1])||void 0===a?void 0:a.package_id}`),Error("preloadResult is null.");this._debuggerLogger.info(`\u{5F00}\u{59CB}\u{7F13}\u{5B58}\u{5F53}\u{524D} seek \u{7684}\u{4F4D}\u{7F6E}`);let g=await this._renderManager.getCurrentPosition();this._debuggerLogger.info(`\u{7ED3}\u{675F}\u{7F13}\u{5B58}\u{5F53}\u{524D} seek \u{7684}\u{4F4D}\u{7F6E}`);let _=this._segmentSelection.getSelectedData(),p=this._renderManager.state===m.jey.PLAYING;this._renderManager.disableRender(),this._timelineManager.timelineInteract.setEnableTimelineRefresh(!1),this._timelineManager.resource.reset(),this._debuggerLogger.info(`\u{5F00}\u{59CB}\u{8FD8}\u{539F}\u{8349}\u{7A3F}`),await l.resetDraft(u),this._debuggerLogger.info(`\u{7ED3}\u{675F}\u{8FD8}\u{539F}\u{8349}\u{7A3F}`),this._debuggerLogger.info(`\u{5F00}\u{59CB}\u{91CD}\u{65B0}\u{521D}\u{59CB}\u{5316}\u{65F6}\u{95F4}\u{7EBF}`),await this._timelineManager.resource.bootstrap(),this._timelineManager.timelineInteract.setEnableTimelineRefresh(!0,!0),this._debuggerLogger.info(`\u{7ED3}\u{675F}\u{91CD}\u{65B0}\u{521D}\u{59CB}\u{5316}\u{65F6}\u{95F4}\u{7EBF}`),this._debuggerLogger.info(`\u{5F00}\u{59CB}\u{8BBE}\u{7F6E}\u{69FD}\u{4F4D}\u{4FE1}\u{606F}`),await Promise.all([(0,C.p)(this._mainDraftService,this._renderManager,C.y.Init,!1,this._subjectCropManager),(0,B.l)(this._mainDraftService.dataSdk,this._renderManager,this._reportService),(0,N.o)(this._mainDraftService.dataSdk,this._renderManager)]),this._debuggerLogger.info(`\u{7ED3}\u{675F}\u{8BBE}\u{7F6E}\u{69FD}\u{4F4D}\u{4FE1}\u{606F}`),this._segmentSelection.setSelectedData(_);let f=this._dataSdk.draftView.getDuration();this._renderManager.enableRender(),this._debuggerLogger.info(`\u{5F00}\u{59CB}\u{753B}\u{5E03}\u{66F4}\u{65B0}`);let v=this._mainDraftService.dataSdk.draftView.getCanvasConfig(),{materialWidth:y,materialHeight:S}=(0,d.Hu)(v),[b,M]=(0,V.Ce)([y,S]);await this._renderManager.setCanvasSize(b,M),this._debuggerLogger.info(`\u{7ED3}\u{675F}\u{753B}\u{5E03}\u{66F4}\u{65B0}`),this._renderManager.flushRender(!1),f>g&&p&&this._renderManager.play(),l.removeDeletedMaterials(),this._toggleCollabStateWorking("idle"),this._collabMessageManager.moveWaitingToCommitting(),this._collabMessageManager.isEmpty()||this._handleDraftUpdatedThrottle(),this._debuggerLogger.info(`\u{534F}\u{540C}\u{6D88}\u{606F}\u{5904}\u{7406}\u{5B8C}\u{6210}: ${null===(i=n.pair()[1])||void 0===i?void 0:i.package_id}`),(0,U.y)(this._containerService,{total:performance.now()-s,preload:h-s}),await (0,A._)(2e3),null==c||c.unlock()}catch(e){this._debuggerLogger.info(`\u{534F}\u{540C}\u{6D88}\u{606F}\u{5904}\u{7406}\u{5931}\u{8D25}: ${null==e?void 0:e.message}`),this._toggleCollabStateWorking("idle"),this._collabMessageManager.moveWaitingToCommitting(),this._collabMessageManager.isEmpty()||this._handleDraftUpdatedThrottle()}finally{this._globalExitConfirmService.cancelGlobalExitConfirm()}}_toggleCollabStateWorking(e){"pause"!==this._state&&this._state!==e&&(this._state=e),this._setCacheSate(e)}_setCacheSate(e){"pause"!==e&&(this._cacheState=e)}async getLastestPackageIdAndUpdateDraft(e){try{var t;this._debuggerLogger.info("\u5904\u7406\u6700\u65B0\u7248\u672C\u53F7\u5F00\u59CB:"),await this._workspaceService.initialize((0,k.fC)());let r=await this._userMaterialsService.getEvercloudInstance(e),i=null!==(t=this._dataSdk.draftView.getDraftId())&&void 0!==t?t:this._videoEnvironmentService.draftIdFromUrl;if(!i)return;let a=await r.getPackageByKey(i);if(this._debuggerLogger.info(`\u{83B7}\u{53D6}\u{6700}\u{65B0}\u{7248}\u{672C}\u{53F7}\u{6210}\u{529F}: ${a.id}, ${this._mainDraftService.saveManager.getPackageId()}`),a.id===this._mainDraftService.saveManager.getPackageId())return;this._collabMessageManager.addCollabMessage((0,O.oW)({package_id:a.id,author:""})),this._handleDraftUpdatedThrottle()}catch(e){this._debuggerLogger.error(`\u{5904}\u{7406}\u{6700}\u{65B0}\u{7248}\u{672C}\u{53F7}\u{5931}\u{8D25}: ${null==e?void 0:e.message}`),j.t.error("getLastestPackageIdAndUpdateDraft error:",null==e?void 0:e.message)}}constructor(e,t,r,i,a,n,o,s,c,l,d,u,h,_,p,f,m,v,y,S,b){this._preloadManager=e,this._renderManager=t,this._ensureManager=r,this._segmentSelection=i,this._subjectCropManager=a,this._dataSdk=n,this._playerManager=o,this._timelineManager=s,this._canvasManager=c,this._draftTemplateManager=l,this._draftWorkspaceManager=d,this._containerService=u,this._websocketService=h,this._mainDraftService=_,this._videoEnvironmentService=p,this._userMaterialsService=f,this._workspaceService=m,this._globalExitConfirmService=v,this._accountService=y,this._videoConfigurationService=S,this._reportService=b,this._state="idle",this._cacheState="idle",this._collabMessageManager=new R.B,this._debuggerLogger=new L.J,this._handleLastestPackageId=async()=>{this._draftWorkspaceManager.workspaceId&&await this.getLastestPackageIdAndUpdateDraft(this._draftWorkspaceManager.workspaceId),this._draftWorkspaceManager.onDidWorkspaceChange(async()=>{await this.getLastestPackageIdAndUpdateDraft(this._draftWorkspaceManager.workspaceId)})},this._handleDraftUpdatedThrottle=(0,D.throttle)(this._handleDraftUpdated.bind(this),W.UpdateDraftThrottleTime,{leading:!0,trailing:!0}),!this._videoConfigurationService.getAppConfigurationValue("collaboration.disable")&&!(0,g.JY)(this._videoEnvironmentService)&&this._initListener(),window.__dcl__=this._debuggerLogger}}W.UpdateDraftThrottleTime=3e3,W=(0,i.gn)([(0,i.fM)(11,y.t),(0,i.fM)(12,v.J0),(0,i.fM)(13,_.n),(0,i.fM)(14,g.rO),(0,i.fM)(15,F.b),(0,i.fM)(16,S.W),(0,i.fM)(17,p.O),(0,i.fM)(18,M.D),(0,i.fM)(19,f.J),(0,i.fM)(20,b.m),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IPreloadManager?Object:IPreloadManager,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof SubjectCropManager?Object:SubjectCropManager,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===u.X?Object:u.X,void 0===h.j?Object:h.j,"undefined"==typeof ICanvasManager?Object:ICanvasManager,"undefined"==typeof IDraftTemplateManager?Object:IDraftTemplateManager,"undefined"==typeof DraftWorkspaceManager?Object:DraftWorkspaceManager,void 0===y.t?Object:y.t,void 0===v.J0?Object:v.J0,void 0===_.n?Object:_.n,void 0===g.rO?Object:g.rO,void 0===F.b?Object:F.b,void 0===S.W?Object:S.W,void 0===p.O?Object:p.O,void 0===M.D?Object:M.D,void 0===f.J?Object:f.J,void 0===b.m?Object:b.m])],W);var Z=r("183609"),z=r("811149"),H=r("358793");class K{updateRenderSdk(e){for(let t of(this._renderManager=e,this._queueTask))t.updateRenderSdk(e)}getTask(e){let t=this._containerService.createInstance(z.g5,{file:e,renderManager:this._renderManager});return this._queueTask.push(t),this._taskRunner(),t}isImageNeedCapture(e){return!!e&&H.M.includes(e)}_taskRunner(){if(this._runningTask<this._taskNum&&this._queueTask.length){let e=this._queueTask.shift();this._runningTask++,e.analyze(),e.taskDone().then(()=>{this._runningTask--,this._taskRunner()}),this._taskRunner()}}constructor(e){this._containerService=e,this._queueTask=[],this._runningTask=0,this._taskNum=1}}K=(0,i.gn)([(0,i.fM)(0,y.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===y.t?Object:y.t])],K);var G=r("91474"),Y=r("98392"),$=r("732564"),q=r("387381"),J=r("189577"),Q=r("126429"),X=r("41770"),ee=r("739111"),et=r("494591"),er=r("743109"),ei=r("890069"),ea=r("836560"),en=r("80587"),eo=r("776884"),es=r("609962"),ec=r("995234"),el=r("128171"),ed=r("839226"),eu=r("583031"),eh=r("389995"),eg=r("655400"),e_=r("705325"),ep=r("181613"),ef=r("896413"),em=r("257838"),ev=r("230982"),ey=r("375197"),eS=r("641276"),eb=r("846313"),eM=r("587892"),ek=r("402655"),eT=r("849002"),eI=r("691805"),ew=r("134392"),eP=r("610142"),ex=r("176022"),eC=r("315529"),eE=r("332557"),eD=r("744268"),eF=r("210823"),eO=r("52533"),eA=r("614022"),ej=r("166621"),eR=r("823077"),eL=r("144144"),eV=r("495755"),eU=r("30947"),eB=r("386213"),eN=r("120973"),eW=r("339693"),eZ=r("26543"),ez=r("937567"),eH=r("718901"),eK=r("801497"),eG=r("850649"),eY=r("105304"),e$=r("674103"),eq=r("397163"),eJ=r("903980"),eQ=r("893354"),eX=r("934065"),e0=r("260963"),e1=r("208041"),e2=r("82748"),e3=r("492795"),e6=r("920704"),e8=r("755358"),e5=r("14716"),e9=r("484829"),e4=r("290563"),e7=r("257118"),te=r("886475"),tt=r("652146"),tr=r("247461"),ti=r("777859"),ta=r("775352"),tn=r("594670"),to=r("597623"),ts=r("998498"),tc=r.n(ts),tl=r("250362"),td=r("794821");let tu=e=>e.replaceAll("\n"," ");class th extends ek.JT{async _check(e){return!this._accountService.hasLogin&&await new Promise(t=>{this._accountService.login({reportParams:{...e},execAfterLogin:()=>{t("")}})}),await this._popupStatusService.check({popup_item_id:e2._.SmartToolTypeEnum_DigitalHuman,popup_scene:e2.X.PopupSmartTool},this._containerService)}getTargetSegments(e,t,r){let i=[];if(r){var a;let r=this._mainDraftService.dataSdk.draftView.getTrackBySegmentId(e.id);i=this._mainDraftService.dataSdk.draftView.getSegmentsByTrackId(null!==(a=null==r?void 0:r.id)&&void 0!==a?a:"").filter(e=>"text"===t?(0,e7.Nw)(e):(0,e7.U3)(e))}else i=[e];return i}cancelApplySpeech(){this.cancellationTokenSource.cancel()}openModal(){this.speechingModal=(0,ti.r)({onCancel:()=>{this.cancelApplySpeech()},theme:this._themeService.getTheme(),title:eK.ZP.t("web_edit_text_generating_speech",{},"Generating speech...")})}closeModal(){var e;null===(e=this.speechingModal)||void 0===e||e.close()}async transformTextToSpeechPath(e){let{converter:t,content:r,voiceType:i,voiceIsVip:a,id:n,tonePlatform:o}=e,s=tc()(`${i}_${r}`),c={custom_tag:td.D},l=await (0,te.jQ)(t,r,i,o,s,{},c),{token:d}=this.cancellationTokenSource;if(!l.ok)return(0,O.Mx)(100,"",l);if(d.isCancellationRequested)return(0,O.wf)(101,"");let u=await (0,te.Mo)({data:l.value,renderManager:this._mainEditorWidgetService.renderManager,draftMaterialsService:this._draftMaterialsService,mainDraftService:this._mainDraftService,uploadMaterialFromLocalMixinManager:this._mainEditorWidgetService.fileUploadManager.getUploadMaterialFromLocalMixinManager(),resourceService:this._resourceService,mainEditorWidgetService:this._mainEditorWidgetService,bussinessMeta:{from_vip:!!a},uploadFlag:ta.m5.InvisibleNoOccupation,autoPromote:!0});return d.isCancellationRequested?(0,O.wf)(101,""):(u.buffer=l.value.buffer,u.id=n,u.text=r,(0,O.oW)(u))}async applySpeechToAll(e){let{converter:t,contents:r,voiceType:i,tonePlatform:a,voiceIsVip:n}=e;if(!t)return;this.cancellationTokenSource=new e1.A;let o=[];for(let e of r){if((0,tt.md)(e.text)){o.push(void 0);continue}let r=await this.transformTextToSpeechPath({converter:t,content:e.text,voiceType:i,tonePlatform:a,voiceIsVip:n,id:e.id});if(o.push(r),this.cancellationTokenSource.token.isCancellationRequested)return[]}return o}async getDigitalHumanList(e){if(this._list.length)return this._list;let[t,r]=(await e.getDigitalHumanList({limit:1e4})).pair();return t?this._list:(this._list=null==r?void 0:r.value.list,this._list)}resetPreviewDigitalHuman(){this._mainEditorWidgetService.renderManager.resetPreview()}async _generate(e){var t,r,i,a,n,o,s,c,l,d,u,h,g;let{segment:_,applyToAll:p,digitalHumanService:f}=e;if(!await this._check({current_page:"editor",pageEnterFrom:"ai_character"}))return;let v=Date.now(),y=(null===(r=_.digitalHuman)||void 0===r?void 0:null===(t=r.voiceInfo)||void 0===t?void 0:t.tonePlatform)||e3.x$.ElevenLabs,S=this.getTargetSegments(_,"digitalhuman",!!p);S.map(e=>[e.id,e]);let b=this._mainDraftService.dataSdk.api.batch.batchStart();if(!!y&&!!(null===(i=_.digitalHuman.voiceInfo)||void 0===i?void 0:i.toneType))try{this.openModal();let e=null===(a=await this.applySpeechToAll({converter:this._ttsConverter,contents:S.map(e=>{var t;return{text:tu(null!==(t=(0,e7.fN)(e))&&void 0!==t?t:""),id:e.id}}),voiceType:null===(n=_.digitalHuman.voiceInfo)||void 0===n?void 0:n.toneType,tonePlatform:y}))||void 0===a?void 0:a.map(e=>null==e?void 0:e.pair()),t=null==e?void 0:e.filter(e=>!(null==e?void 0:e[0])).map(e=>null==e?void 0:e[1]);if(this.cancellationTokenSource.token.isCancellationRequested)return;if(!(null==t?void 0:t.length)||t.length!==S.length)throw Error("generate tts fail");if(this.cancellationTokenSource.token.isCancellationRequested)return;let r=(await this.getDigitalHumanList(f)).find(e=>e.id===_.digitalHuman.digitalHumanId),[i,c]=await Promise.all([Promise.all(t.map(e=>{var t,r;return f.generateUploadZip([{name:`${(null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"").replaceAll("/","_")}.mp3`,buffer:null==e?void 0:e.buffer,offset:0n,segmentId:null!==(r=null==e?void 0:e.id)&&void 0!==r?r:""}])})),(0,e7.vs)({imageUrl:null!==(o=null==r?void 0:r.bigPicture)&&void 0!==o?o:"",digitalHumanId:null!==(s=null==r?void 0:r.id)&&void 0!==s?s:"",digitalHumanService:f,containerService:this._containerService,mainDraftService:this._mainDraftService,mainEditorWidgetService:this._mainEditorWidgetService,resourceService:this._resourceService})]);if(this.cancellationTokenSource.token.isCancellationRequested)return;let l=await Promise.all(i.filter(e=>e.uri&&e.segmentId).map(async(e,i)=>{var a,n,o,s,l,d,u;if(this.cancellationTokenSource.token.isCancellationRequested)return;let h=null==t?void 0:t.find(t=>(null==t?void 0:t.id)===e.segmentId),g=null!==(n=null==h?void 0:h.mediaInfo.duration)&&void 0!==n?n:0n,p=await f.createDigitalHumanTask({resource_id:r.resourceId,tts_resource_id:e.uri,segmentId:e.segmentId,tts_duration:g,temp_asset_ids:[c.resource.getModel().assetId].filter(Boolean)},e9.V5.RemoveBackground);if(p.targetSegmentId=e.segmentId,this.cancellationTokenSource.token.isCancellationRequested){null==p||null===(o=p.cancel)||void 0===o||o.call(p);return}let v=this._mainDraftService.dataSdk.draftView.getSegmentById(e.segmentId),S=this._mainDraftService.dataSdk.draftView.getTrackIndexBySegmentId(e.segmentId);return this.resetPreviewDigitalHuman(),(0,e7.xS)({localTaskId:p.taskId,segmentId:e.segmentId,imageInfo:c,resourceId:null!==(s=null==r?void 0:r.resourceId)&&void 0!==s?s:"",position:{start:v.offset,trackIndex:S,duration:g},sourceTimerangeParam:{start:0n},duration:g,ttsMetaParams:[{ttsParam:{type:m.cVg.MetaTypeTextToAudio,duration:null!==(l=null==h?void 0:h.mediaInfo.duration)&&void 0!==l?l:0n,startTime:0n,segmentId:"",sourceStartTime:0n,audioPath:null==h?void 0:h.path,text:{textSegmentId:"",speed:1,toneType:null!==(d=null===(a=_.digitalHuman.voiceInfo)||void 0===a?void 0:a.toneType)&&void 0!==d?d:"",tonePlatform:y}},text:null!==(u=null==h?void 0:h.text)&&void 0!==u?u:"",ttsPayload:""}]},{mainDraftService:this._mainDraftService}),p})),d=async e=>{var t,r,i,a,n,o,s,c;e.status===e6.y.Success&&(this.resetPreviewDigitalHuman(),await (0,e7.iM)({segmentId:e.targetSegmentId,digitalHumanId:_.digitalHuman.digitalHumanId,resourceId:_.digitalHuman.resourceId,taskId:e.taskId,data:e.data},{containerService:this._containerService,mainDraftService:this._mainDraftService,mainEditorWidgetService:this._mainEditorWidgetService,resourceService:this._resourceService}),f.handleHumanTaskApplied(e.taskId,e.segmentId),(0,tl.O)(this._containerService,{tool_type:"ai_character",time:Date.now()-v,ai_character_id:_.digitalHuman.digitalHumanId,ai_character_tone:null!==(a=null===(t=_.digitalHuman.voiceInfo)||void 0===t?void 0:t.toneType)&&void 0!==a?a:"",status:"success",current_page:"editor",ai_character_enter_position:"ai_character",ai_character_frame:null===(i=_.videoMask)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.resourceId})),e.status===e6.y.Failure&&(f.discardTask(e.taskId),(0,tl.O)(this._containerService,{tool_type:"ai_character",time:Date.now()-v,ai_character_id:_.digitalHuman.digitalHumanId,ai_character_tone:null!==(c=null===(n=_.digitalHuman.voiceInfo)||void 0===n?void 0:n.toneType)&&void 0!==c?c:"",status:"fail",current_page:"editor",ai_character_enter_position:"ai_character",ai_character_frame:null===(s=_.videoMask)||void 0===s?void 0:null===(o=s[0])||void 0===o?void 0:o.resourceId,fail_reason:e.failReason||"intelligence query error",server_response_status_code:e.serverResponseStatusCode,log_id:e.logId}))};l.forEach(e=>{if(!!e)f.addTaskListenner(e.taskId,e.segmentId,d)})}catch(e){setTimeout(()=>{this._notificationService.error(eK.ZP.t("remove_bg_remove_fail_toast",{},"Couldn't remove background. Try again later."))},16),(0,tl.O)(this._containerService,{tool_type:"ai_character",time:Date.now()-v,ai_character_id:_.digitalHuman.digitalHumanId,ai_character_tone:null===(c=_.digitalHuman.voiceInfo)||void 0===c?void 0:c.toneType,status:"fail",current_page:"editor",ai_character_enter_position:"ai_character",ai_character_frame:null===(d=_.videoMask)||void 0===d?void 0:null===(l=d[0])||void 0===l?void 0:l.resourceId,fail_reason:e.message})}finally{this._mainDraftService.dataSdk.api.batch.batchEnd(b),this.cancellationTokenSource.token.isCancellationRequested&&(0,tl.O)(this._containerService,{tool_type:"ai_character",time:Date.now()-v,ai_character_id:_.digitalHuman.digitalHumanId,ai_character_tone:null===(u=_.digitalHuman.voiceInfo)||void 0===u?void 0:u.toneType,status:"cancel",current_page:"editor",ai_character_enter_position:"ai_character",ai_character_frame:null===(g=_.videoMask)||void 0===g?void 0:null===(h=g[0])||void 0===h?void 0:h.resourceId}),this.closeModal()}}async generate(e){let{segment:t,applyToAll:r,onFinally:i,digitalHumanService:a}=e;await this._generate({segment:t,applyToAll:r,onFinally:i,digitalHumanService:a}),null==i||i()}constructor(e,t,r,i,a,n,o,s,c,l){super(),this._popupStatusService=t,this._accountService=r,this._containerService=i,this._themeService=a,this._draftMaterialsService=n,this._resourceService=o,this._notificationService=s,this._ttsDataService=c,this._generateTtsDataService=l,this.cancellationTokenSource=new e1.A,this._ttsManager=new tr.u,this._list=[],this._mainEditorWidgetService=e.mainEditorWidgetService,this._mainDraftService=e.mainDraftService,this._ttsConverter=this._ttsManager.createConverter({ttsDataService:this._ttsDataService,generateTtsDataService:this._generateTtsDataService}),this._ttsConverter.onError(e=>{}),(0,e0.rC)(this)}}th=(0,i.gn)([(0,i.fM)(1,e4.k),(0,i.fM)(2,M.D),(0,i.fM)(3,y.t),(0,i.fM)(4,tn.X),(0,i.fM)(5,w.D),(0,i.fM)(6,P.c),(0,i.fM)(7,to.lT),(0,i.fM)(8,e8.z),(0,i.fM)(9,e5.e),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object,void 0===e4.k?Object:e4.k,void 0===M.D?Object:M.D,void 0===y.t?Object:y.t,void 0===tn.X?Object:tn.X,void 0===w.D?Object:w.D,void 0===P.c?Object:P.c,void 0===to.lT?Object:to.lT,void 0===e8.z?Object:e8.z,void 0===e5.e?Object:e5.e])],th);let tg="video-editor-canvas";class t_ extends ek.JT{setForReadonly(){this._keybindingService.disableKeybinding(eG.SZ.map(e=>eG.Yq[e]?[eG.Yq[e].keyBindings.mac,eG.Yq[e].keyBindings.win].flat():[]).flat()),this._guideService.mute(),this._canvasManager.readonlyFromOutsideSet(!0),this._timelineManager.timelineInteract.setDisableInteract([eY.Vf.SEQUENCE,eY.Vf.TIMELINE_HEADER,eY.Vf.READONLY_MODE])}get phase(){return this._phase}get selection(){return this._selection}get prepareSelection(){return this._prepareSelection}get segmentSelection(){return this._segmentSelection}get onFreeze(){return this._onFreeze.event}get onDisableSave(){return this._onDisableSave.event}get freeze(){return this._freeze}get disableSave(){return this._disableSave}get canvasManager(){return this._canvasManager}get mutableReplaceTaskManager(){return this._mutableReplaceTaskManager}get checkListManager(){return this._checklistManager}get fileUploadManager(){return this._fileUploadManager}get richTextEditorManager(){return(0,T.Y2)(this._richTextEditorManager,"you should not call richTextEditorManager in current moment."),this._richTextEditorManager}get timelineManager(){return this._timelineManager}get playerManager(){return this._playerManager}get layoutManager(){return this._layoutManager}get ensureManager(){return(0,T.Y2)(this._ensureManager,"you should not call ensureManager in current moment."),this._ensureManager}get preloadManager(){return(0,T.Y2)(this._preloadManager,"you should not call preloadManager in current moment."),this._preloadManager}get canvas(){return this._canvas}get renderManager(){return this._renderManager}get maskManager(){return this._maskManager}get textEditManager(){return this._textEditManager}get screenshotManager(){return this._screenshotManager}get modalManager(){return(0,T.Y2)(this._modalManager,"you should not call modalManager in current moment."),this._modalManager}get permissionManager(){return this._permissionManager}get replaceSegmentManager(){return this._replaceSegmentManager}get thirdPartyManager(){return this._thirdPartyManager}get fastImportAnalyzeManager(){return(0,T.Y2)(this._fastImportAnalyzeManager,"you should not call fastImportAnalyzeManager in current moment."),this._fastImportAnalyzeManager}get captureImageFrameManager(){return(0,T.Y2)(this._captureImageFrameManager,"you should not call captureImageFrameManager in current moment."),this._captureImageFrameManager}get smartToolsManager(){return(0,T.Y2)(this._smartToolsManager,"you should not call smartToolsManager in current moment."),this._smartToolsManager}get attachmentSaveManager(){return this._attachmentSaveManager}get segOperationManager(){return this._segOperationManager}get screenRecorderManager(){return this._screenRecorderManager}get resourceErrorManager(){return this._resourceErrorManager}get unHideMutableVideoManager(){return this._unHideMutableVideoManager}get subjectCropManager(){return this._subjectCropManager}get hasFailSegments(){return this._hasFailSegments}get segmentResultMap(){return this._segmentResultMap}get reactiveViewManager(){return this._reactiveViewManager}get aiWriterManager(){return this._canvasManager.modules.aiWriterManager}get templateElementManager(){return this._templateElementManager}get digitalHumanGenerateManager(){return this._digitalHumanGenerateManager}async when(e){if(e<=this._phase)return;let t=this._phaseWhen.get(e);!t&&(t=new eT.U,this._phaseWhen.set(e,t)),await t.wait()}_initAfterRenderManagerReady(){this._richTextEditorManager=this._containerService.createInstance(Y.l,this._mainDraftService.dataSdk,this._renderManager,this._selection,this._playerManager),this._register(this._richTextEditorManager),this._canvasManager.initLevel2(this._renderManager,this._richTextEditorManager,this._addSegmentManager,this._replaceSegmentManager,this._smartToolsManager,this._modalManager,this._segOperationManager,{isTemplate:this._isTemplate,isNewEditPage:this._isNewEditPage}),this._screenshotManager.bind(this._renderManager,this._timelineManager);let e=[er.p.Triggers.MutablePoly,er.p.Triggers.Mutable];(0,g.o2)(this._videoEnvironmentService)&&e.push(er.p.Triggers.Combination),this._screenshotManager.listen(...e),this._screenshotManager.onScreenshotCompleted(e=>{let t=this._timelineManager.resource.getSpritesByKey(e.resourceKey);(null==t?void 0:t.some(e=>!("imageData"in e)))&&this._timelineManager.resource.resetSpritesByKey(e.resourceKey),this._timelineManager.resource.setSpritesByTimestamp({resourceKey:e.resourceKey,sprites:e.sprites.map(e=>({...e,sourceTimestamp:e.timestamp}))})}),this.screenshotManager.onScreenshotFullUpdate(e=>{this._timelineManager.resource.resetSpritesByKey(e)}),this.screenshotManager.onScreenshotUpdate(e=>{this._mainDraftService.saveManager.appendSaveDraftParams(e)})}_handleBeforeCallbackFire(e){let{cbValue:t}=e;try{if((0,eO.Z)(null==t?void 0:t.rc)||(0,eO.Z)(null==t?void 0:t.worker2mainCostTime))return;(0,ev.n)(()=>{(0,eW.X)(this._containerService,{cbValue:t})},{priorityLevel:ey.q.IdlePriority})}catch(e){}}onBeforeLocalFileUpload(){this._canvasManager.setLoading(!0),this._canvasManager.modules.workbenchController.openMediaTab()}onAfterLocalFileUpload(){this._canvasManager.setLoading(!1)}onBeforeThirdpartyFileUpload(){this._canvasManager.setLoading(!0),this._canvasManager.modules.workbenchController.openMediaTab()}onAfterThirdpartyFileUpload(){this._canvasManager.setLoading(!1)}onBeforeAddSegment(e,t,r){this.setFreeze(!0),this._segmentSelection.setSelectedData({});let i=this._timelineManager.tracksManager.beforeAddSegment(e,t,r);return this._canvasManager.modules.segmentManager.beforeAddSegment(),{uiSegmentId:i}}onAfterAddSegment(e,t){this.setFreeze(!1),this._timelineManager.tracksManager.afterAddSegment(e,t),this._timelineManager.timelineUI.guide.showGuideIfNeed(e),this._canvasManager.modules.segmentManager.afterAddSegment(e),this._layoutManager.layoutContainer&&this._layoutManager.layoutContainer.focus()}onBeforeAddTransition(e,t,r){return{uiTransitionId:this._timelineManager.tracksManager.beforeAddTransition(e.value,e.type,t,r)}}onAfterAddTransition(e,t){this.setFreeze(!1),this._timelineManager.tracksManager.afterAddTransition(e,t),this._layoutManager.layoutContainer&&this._layoutManager.layoutContainer.focus()}onAddError(e){this._canvasManager.modules.segmentManager.onAddError(e),this._timelineManager.timelineUI.toast.error(e)}beforeReplaceMutable(e,t){e.forEach(e=>{let{mutableId:r}=e,i=this._mutableReplaceTaskManager.get(r),a=null==i?void 0:i.token;if(a&&a.status===es.a.UPLOADING)a.triggerReplaceStatus();else{let e=new ec.L({mutableId:r,draftId:t,originPath:"",cancelable:!1});e.triggerReplaceStatus(),null==i||i.setToken(e)}this._smartToolsManager.cacheOriginSegment(r,t)}),this._canvasManager.modules.segmentManager.beforeReplaceMutable()}afterReplaceMutable(e,t){this._canvasManager.modules.segmentManager.afterReplaceMutable(),this.timelineManager.tracksManager.afterReplaceMutable(e),e.forEach(e=>{let{mutableId:t}=e,r=this._mutableReplaceTaskManager.get(t),i=null==r?void 0:r.token;i&&i.triggerSuccessStatus()}),(0,o.R)(this._mainDraftService.dataSdk,this._smartToolsManager,e,t),this._layoutManager.layoutContainer&&this._layoutManager.layoutContainer.focus()}onReplaceError(e){this._canvasManager.modules.segmentManager.onReplaceError(e)}onOrderError(e){this._timelineManager.timelineUI.toast.error(eK.ZP.t("web_posttemplate_toast_not_enough_copyright",{},"You\u2019ve reached the maximum number of copyrighted materials to use today."));let{errorInfo:t={}}=null!=e?e:{},r=t.code;(0,eZ.E)(this._containerService,{fail_reason:`${r?`[${r}]`:""}${t.message}`,logid:t.logid})}checkAvailability(e,t){var r,i,a;let n=null!==(r=null!=t?t:this.segmentSelection.subDraftId)&&void 0!==r?r:this._mainDraftService.dataSdk.draftView.getDraftId(),o=[...null!==(i=this._mainDraftService.dataSdk.cutSame.draftIdToMutableVideos[n])&&void 0!==i?i:[],...null!==(a=this._mainDraftService.dataSdk.cutSame.draftIdToMutableAudios[n])&&void 0!==a?a:[]],s={};for(let t of e){let e=o.find(e=>(0,m.VIL)(e)?e.segmentId===t.mutableId:e.id===t.mutableId);(0,T.ZB)(e,"invalid mutableId");let r={type:t.type,data:t.value},i=this.timelineManager.autoReplace.checkReplace(e,r);if(s[t.mutableId]=i,i.errmsg){if(this.timelineManager.tracksManager.replaceSegmentError(t),!this.segmentSelection.expandedSegmentId&&!this._isTemplate)return eQ.Z.error(i.errmsg,{getContainer:()=>document.getElementById(tg)}),!1;return this.timelineManager.timelineUI.toast.error(i.errmsg),!1}}return this.timelineManager.tracksManager.beforeReplaceMutable(s),!0}async _initRenderManager(e,t){this._canvas.id=tg,this._canvas.width=n.fQ.width,this._canvas.height=n.fQ.height,(0,ej.w)(this._canvas),(0,eL.Ie)(ez.LOAD_MODULE);let r=await e;(0,eL.oe)(ez.LOAD_MODULE);let i=this._inputPreferenceService.getInputPreference()===eI.Q.Rtl;(0,eL.Ie)(ez.CREATE_OBJECT);let a=(0,eU.GS)(this._storageService,null!=t?t:"",this._videoEnvironmentService.sdkVersion),o=this._configService.abTestManager.getBooleanAbTestValue("enable_stream_fetch_opt",!1),s=this._configService.abTestManager.getBooleanAbTestValue("ve_enable_track_clip_opt",!1);this._renderManager=new $.zo({dataSdk:this._mainDraftService.dataSdk,renderSDKParams:{module:r,renderConfig:{canvasId:tg,lostAudioPlaceholder:"/__opfs_system_root/integration/audio/empty.mp3",enableRtlTextRender:!0,enableAudioStream:!0,enableStreamOpt:o,enableTrackClipOpt:s,directionLevel:i?1:0,...this._videoEnvironmentService.isAutoTest?{enableUsePreFrameStrict:!0,enableFF264Strict:!0,enableSkipDropFrame:!0}:void 0,...a?{effectAbBoolConfig:a.boolean,effectAbFloatConfig:a.float,effectAbIntConfig:a.int,effectAbStringConfig:a.string}:void 0}}}),eX.tx.createInstance(this._renderManager),(0,eL.oe)(ez.CREATE_OBJECT),this._renderManager.onFlushRender(()=>{(0,eL.Ie)(ez.SEEK_FIRST_FRAME),(0,eL.Ie)(ez.WEB_CALL_VE_SEEK)}),window.__renderManger=this._renderManager,this._ensureManager.enableWriteToFS(this.renderManager);let c=this._renderManager.waitForVEUtilsCreated();this._renderManager.beforeCallbackFire(this._handleBeforeCallbackFire.bind(this));let l=(0,ed.hF)(this._renderManager);this._playerManager.setDefaultPlayer(l,this._renderManager),(0,eL.Ie)(ez.SET_CANVAS_SIZE),this._renderManager.setPreviewSize(n.fQ.width,n.fQ.height,!0),this._renderManager.setCanvasSize(n.fQ.width,n.fQ.height,!1,!0),(0,eL.oe)(ez.SET_CANVAS_SIZE),(0,eL.Ie)(ez.WAIT_FOR_VE_UTILS),await c,(0,eL.oe)(ez.WAIT_FOR_VE_UTILS),this._initAfterRenderManagerReady(),this._setPhase(ef.U.Eventually),this._onEventually.setPhase(ef.U.Eventually)}_setPhase(e){if((0,T.Y2)(e>=this._phase,"Lifecycle cannot go backwards"),this._phase===e)return;this._phase=e;let t=this._phaseWhen.get(this._phase);t&&(t.open(),this._phaseWhen.delete(this._phase))}_initSegmentResultMap(){(0,eS.V)(this.onEventually)(()=>{this.renderManager.onAddClip(e=>{let{clipId:t,result:r}=e;this._segmentResultMap[t]=r,this._timelineManager.resource.updateFailSegments(this._segmentResultMap),this._canvasManager.updateSegmentAddResult(t,r),this._updateHasFailSegments()})})}_updateHasFailSegments(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=[],r=!1;for(let i of e)(0,eA.Z)(this._segmentResultMap[i.id])&&this._segmentResultMap[i.id]!==eR.D5&&(r=!0,t.push(i.id));r!==this._hasFailSegments&&(this._hasFailSegments=r,this._onHasFailSegmentsChange.fire(r,t))}_segmentCropOptimize(){this._register(this._timelineManager.segmentManager.onSegmentCropStart(()=>{this._canvasManager.doNotRenderRectangles(!0)})),this._register(this._timelineManager.segmentManager.onSegmentBeforeHandleCrop(()=>{this._canvasManager.doNotRenderRectangles(!1)})),this._register(this._timelineManager.segmentManager.onSegmentCropError(()=>{this._canvasManager.doNotRenderRectangles(!1)}))}_pausePlayerWhenDragStart(){this._register(this._sidebarDndService.onDragStart(()=>{this._playerManager.pause()}))}setFreeze(e){this._freeze=e,this._timelineManager.setFreeze(e),this._canvasManager.setLoading(e),this._onFreeze.fire(e)}setDisableSave(e){this._disableSave=e,this._onDisableSave.fire(e)}constructor(e,t,r,i,n,o,d,_,p,f,v,y,S){super(),this._workbenchService=r,this._mainDraftService=i,this._containerService=n,this._videoEnvironmentService=o,this._inputPreferenceService=d,this._keybindingService=_,this._storageService=p,this._sidebarDndService=f,this._guideService=v,this._configService=y,this._performanceMonitorService=S,this._onEventually=new eb.K(ef.U.Waiting,{shortcutEventMode:eb.E.Sync}),this._onHasFailSegmentsChange=new eM.Q,this._freeze=!1,this._disableSave=!1,this._onDisableSave=new eM.Q,this._onFreeze=new eM.Q,this._canvas=document.createElement("canvas"),this._playerManager=this._register(new u.X(()=>this._mainDraftService.dataSdk.draftView.getDuration())),this._phaseWhen=new Map,this._phase=ef.U.Waiting,this._segmentResultMap={},this._hasFailSegments=!1,this._layoutManager=this._containerService.createInstance(q.n),this.onEventually=this._onEventually.when(ef.U.Eventually),this._isTemplate=(0,g.JY)(this._videoEnvironmentService),this._isNewEditPage=!this._videoEnvironmentService.draftIdFromUrl,this._mutableReplaceTaskManager=this._containerService.createInstance(el.i),this._ensureManager=this._containerService.createInstance(J.P,this._isTemplate,this._mainDraftService.draftPathStore),window.__ensureManager=this._ensureManager,this._ensureManager.getModelMap().catch(e=>{console.error("[ensure] failed to preload model map",e)}),this._algorithmFilerManager=this._containerService.createInstance(a.c),this._attachmentSaveManager=this._containerService.createInstance(l.z,this._algorithmFilerManager),this._preloadManager=this._containerService.createInstance(eu.Z,{ensureManager:this._ensureManager,attachmentSaveManager:this._attachmentSaveManager,containerService:this._containerService}),this._selection=this._containerService.createInstance(Q.Y,this._mainDraftService.dataSdk),this._prepareSelection=this._containerService.createInstance(Q.d,this._mainDraftService.dataSdk),this._segmentSelection=this._containerService.createInstance(eg.q,this._selection,this._prepareSelection,this._mainDraftService.dataSdk),this._fastImportAnalyzeManager=this._containerService.createInstance(K),this._captureImageFrameManager=this._containerService.createInstance(eq.l),this._fileUploadManager=this._containerService.createInstance(ei.O,this._fastImportAnalyzeManager,this._captureImageFrameManager,this._mutableReplaceTaskManager,{beforeLocalFileUpload:this.onBeforeLocalFileUpload.bind(this),afterLocalFileUpload:this.onAfterLocalFileUpload.bind(this),beforeThirdpartyFileUpload:this.onBeforeThirdpartyFileUpload.bind(this),afterThirdpartyFileUpload:this.onAfterThirdpartyFileUpload.bind(this)},this.segmentSelection),this._thirdPartyManager=this._containerService.createInstance(e_.X),this._maskManager=this._containerService.createInstance(ea.l,this._thirdPartyManager),this._register(this._maskManager),this._checklistManager=this._containerService.createInstance(c.H),this._segOperationManager=this._containerService.createInstance(eh.u,this._mainDraftService.dataSdk,this._renderManager,this._selection,this._segmentSelection,this._playerManager),this._screenshotManager=this._register(this._containerService.createInstance(er.p,this._mainDraftService.dataSdk)),this._resourceErrorManager=this._containerService.createInstance(X.X,this._mainDraftService.draftPathStore),this._smartToolsManager=this._containerService.createInstance(em.f,this._mainDraftService.dataSdk,this._renderManager,void 0,this._mainDraftService.draftPathStore,this._playerManager,this._algorithmFilerManager,this._segmentSelection),this._replaceSegmentManager=this._containerService.createInstance(G.m,this._mainDraftService.dataSdk,this._renderManager,this._ensureManager,this._mainDraftService.draftPathStore,{beforeReplaceMutable:this.beforeReplaceMutable.bind(this),afterReplaceMutable:this.afterReplaceMutable.bind(this),onAddError:this.onReplaceError.bind(this)}),this._modalManager=this._containerService.createInstance(en.g,this,this._playerManager,this._ensureManager,this._selection,this._segmentSelection,this._replaceSegmentManager,this._renderManager,{getTimelineSwitch:()=>this._timelineManager.getTimelineSwitches()}),this._permissionManager=this._containerService.createInstance(eo.Y,this._mainDraftService.dataSdk,this._modalManager),this._addSegmentManager=this._containerService.createInstance(Z.O,this._mainDraftService.dataSdk,this._renderManager,this._ensureManager,this._preloadManager,this._selection,this._mainDraftService.draftPathStore,{beforeAddSegment:this.onBeforeAddSegment.bind(this),afterAddSegment:this.onAfterAddSegment.bind(this),beforeAddTransition:this.onBeforeAddTransition.bind(this),afterAddTransition:this.onAfterAddTransition.bind(this),toast:this.onAddError.bind(this),beforeEnsureResource:e=>{this.timelineManager.event.timelineBeforeEnsureResource({data:e})},afterEnsureResource:(e,t)=>{this.timelineManager.resource.preload(e),this.timelineManager.event.timelineAfterEnsureResource({data:e,resourceRecord:t})},onOrderError:this.onOrderError.bind(this)}),this._subjectCropManager=this._containerService.createInstance(eN.s,this._mainDraftService.dataSdk,this._segmentSelection,this._renderManager),this._timelineManager=this._containerService.createInstance(h.j,this,this._mainDraftService.dataSdk,this._mainDraftService.cloudMetaManager,this._mainDraftService.draftPathStore,this._mainDraftService.draftTemplateManager,this._fileUploadManager,this._layoutManager,this._playerManager,this._segOperationManager,this._selection,this._prepareSelection,this._segmentSelection,this._checklistManager,this._mutableReplaceTaskManager,this._screenshotManager,this._addSegmentManager,this._modalManager,this._ensureManager,this._resourceErrorManager,this._smartToolsManager,this._replaceSegmentManager,this.checkAvailability.bind(this),this._subjectCropManager),this._templateElementManager=this._containerService.createInstance(eJ._,this._modalManager,this._timelineManager,this._selection,this._segmentSelection,this._fileUploadManager,this._mutableReplaceTaskManager,this._playerManager,this._subjectCropManager,this._smartToolsManager.intelligentStoreManager),this._modalManager.setTimelineManager(this._timelineManager),this._smartToolsManager.setTimelineManager(this._timelineManager),this.modalManager.setAutoReplace(),this._textEditManager=this._containerService.createInstance(s.l,this._timelineManager),this._canvasManager=this._register(this._containerService.createInstance(ee.S,this._canvas,this._mainDraftService.dataSdk,this._selection,this._prepareSelection,this._segmentSelection,this._layoutManager,this._playerManager,this._fileUploadManager,this._ensureManager,this._mainDraftService.saveManager,this._timelineManager,this._subjectCropManager,this._resourceErrorManager,{isTemplate:this._isTemplate,isNewEditPage:this._isNewEditPage})),this._screenRecorderManager=this._containerService.createInstance(ep.N),this._shortCutManager=this._containerService.createInstance(et.O,this._timelineManager,this._selection,this._layoutManager,this._segmentSelection),this._unHideMutableVideoManager=this._containerService.createInstance(eV.M,this._selection,this._mainDraftService.dataSdk),this._reactiveViewManager=this._containerService.createInstance(eB.M,this._selection,this._mainDraftService.dataSdk,this._videoEnvironmentService.isDev),this._undoMutableManager=this._containerService.createInstance(e$.A,this._mainDraftService.dataSdk,this._mainDraftService.draftPathStore,this._replaceSegmentManager,this._selection),this._digitalHumanGenerateManager=this._containerService.createInstance(th,{mainEditorWidgetService:this,mainDraftService:this._mainDraftService}),this._workbenchService.updateUIConfig({editors:[{name:"video-editor",content:this._layoutManager.render}]}),this._initRenderManager(e,t).then(()=>{m.Ytq.getInstance().setKeyframeCaptureProc(()=>{var e;return{captureWidth:2,trackPxPerMs:1,playHead:null!==(e=this._renderManager.progress)&&void 0!==e?e:0n}}),(0,eL.Ie)(ez.FS_MOUNT),this._ensureManager.enableCompleteWrite(this.renderManager),(0,eL.oe)(ez.FS_MOUNT),this._fastImportAnalyzeManager.updateRenderSdk(this.renderManager),this._captureImageFrameManager.updateRenderSdk(this.renderManager),this._algorithmFilerManager.updateRenderManager(this.renderManager),this._attachmentSaveManager.updateRenderManager(this.renderManager),this.timelineManager.setRenderManager(this.renderManager),this._segOperationManager.updateRenderManager(this.renderManager),this._smartToolsManager.updateRenderManager(this.renderManager),this._modalManager.updateRenderManager(this.renderManager),this._addSegmentManager.updateRenderManager(this.renderManager),this._replaceSegmentManager.updateRenderManager(this.renderManager),this._subjectCropManager.updateRenderManager(this.renderManager),this._templateElementManager.updateRenderManager(this.renderManager),this._draftCollabManager=this._containerService.createInstance(W,this.preloadManager,this._renderManager,this.ensureManager,this.segmentSelection,this._subjectCropManager,this._mainDraftService.dataSdk,this._playerManager,this._timelineManager,this.canvasManager,this._mainDraftService.draftTemplateManager,this._mainDraftService.draftWorkspaceManager),this._performanceMonitorService.onReport(e=>{let{analyzeHistory:t}=e;if(history&&t)for(let[,e]of Object.entries(t))(0,eH.l)(this._containerService,{report:e})})}),this.onHasFailSegmentsChange=this._onHasFailSegmentsChange.event,this._initSegmentResultMap(),this._segmentCropOptimize(),this._pausePlayerWhenDragStart()}}t_=(0,i.gn)([(0,i.fM)(2,eF.e),(0,i.fM)(3,_.n),(0,i.fM)(4,y.t),(0,i.fM)(5,g.rO),(0,i.fM)(6,eI.U),(0,i.fM)(7,ew.d),(0,i.fM)(8,eE.U),(0,i.fM)(9,eP.L),(0,i.fM)(10,ex.W),(0,i.fM)(11,eD.Ui),(0,i.fM)(12,eC.J),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof Promise?Object:Promise,Object,void 0===eF.e?Object:eF.e,void 0===_.n?Object:_.n,void 0===y.t?Object:y.t,void 0===g.rO?Object:g.rO,void 0===eI.U?Object:eI.U,void 0===ew.d?Object:ew.d,void 0===eE.U?Object:eE.U,void 0===eP.L?Object:eP.L,void 0===ex.W?Object:ex.W,void 0===eD.Ui?Object:eD.Ui,void 0===eC.J?Object:eC.J])],t_)},264837:function(e,t,r){"use strict";r.d(t,{s:function(){return l}});var i=r(772322);r(966156);var a=r(368100),n=r(140515),o=r(797913),s=r(434005),c=r(801497);function l(e){(0,n.lT)(e.containerService,{action:n.UL.Show,tool_type:n.Yp.AiCharacter});let t=e.containerService.invokeFunction(e=>e.get(o.J)).getAppConfigurationValue("starlingKey.digitalHuman.templates")||"web_edit_text_avatar_templates",r=a.Z.confirm({icon:null,title:c.ZP.t("web_edit_text_solely_responsible",void 0,"You shall be solely responsible for content created using a sampled AI character."),content:(0,i.jsx)("div",{children:c.ZP.t(t,{href0:t=>(0,s.Pq)(t,()=>{(0,n.lT)(e.containerService,{action:n.UL.LearnMore,tool_type:n.Yp.AiCharacter})})},`These AI characters were created with sampled content and certain synthetic elements. By using this feature, you agree to abide by CapCut\u{2019}s <href0>Community Guidelines</href0>. You shall be solely responsible for content created using a model derived from sampled content and certain other synthetic elements on CapCut, including, without limitation, disclosing in case of making your video public that your content has been artificially generated to avoid confusion.`)}),okText:c.ZP.t("web_magicTools_button_continue",{},"Continue"),okButtonProps:{status:"default",type:"primary"},cancelText:c.ZP.t("web_magicTools_button_back",{},"Go back"),onOk:function(){e.onOk(),(0,n.lT)(e.containerService,{action:n.UL.Continue,tool_type:n.Yp.AiCharacter})},onCancel:function(){e.onCancel(),(0,n.lT)(e.containerService,{action:n.UL.Cancel,tool_type:n.Yp.AiCharacter})},cancelButtonProps:{onClick(){e.onCancel(),r.close(),(0,n.lT)(e.containerService,{action:n.UL.GoBack,tool_type:n.Yp.AiCharacter})}}})}},282573:function(e,t,r){"use strict";r.d(t,{s:function(){return s}});var i=r(772322);r(966156);var a=r(368100),n=r(140515),o=r(801497);function s(e){(0,n.lT)(e.containerService,{action:n.UL.Show,tool_type:n.Dd.VoiceBeautify});let t=a.Z.confirm({icon:null,title:o.ZP.t("web_enhance_voice_title_allow",void 0,"Allow CapCut to upload your audio to our server?"),content:(0,i.jsx)("div",{children:o.ZP.t("web_enhance_voice_info_allow",void 0,"CapCut needs to upload your audio to our server to enhance your voice. Once the voice is enhanced, your audio will be immediately deleted from our server.")}),okText:o.ZP.t("web_enhance_voice_btn_allow",{},"Allow"),okButtonProps:{status:"default",type:"primary"},cancelText:o.ZP.t("web_enhance_voice_btn_not_now",{},"Not now"),onOk:function(){e.onOk(),(0,n.lT)(e.containerService,{action:n.UL.Allow,tool_type:n.Dd.VoiceBeautify})},onCancel:function(){e.onCancel(),(0,n.lT)(e.containerService,{action:n.UL.Close,tool_type:n.Dd.VoiceBeautify})},cancelButtonProps:{onClick(){e.onCancel(),t.close(),(0,n.lT)(e.containerService,{action:n.UL.Reject,tool_type:n.Dd.VoiceBeautify})}}})}},290563:function(e,t,r){"use strict";r.d(t,{k:function(){return i}});let i=(0,r(335290).yh)("popup-status-service")},413787:function(e,t,r){"use strict";r.d(t,{w:function(){return l}});var i=r(789786),a=r(690613),n=r(390129),o=r(200247),s=r(596112),c=r(65458);class l{async execute(){let e=this._audioVoiceDataService.createVcTask({assetId:this._params.assetId,platform:this._params.platform,voice:this._params.voice,workspaceId:this._params.workspaceId,resourceType:this._params.resourceType},this._params.urlParams);return await e}cancel(){}transfer(e){let t={type:c.FV.Vc,assetId:this._params.assetId,taskId:e.task_id};if(e.md5)t.cloudData={md5:e.md5,key:e.key};else{if(!e.vid||!e.url)return(0,a.wf)(-1,"vc response invalid.");t.onlineData={vid:e.vid,url:e.url,key:e.key}}return(0,a.oW)(t)}constructor(e,t,r,i){this._params=e,this._accountService=t,this._teaAdapterService=r,this._audioVoiceDataService=i}}l=(0,i.gn)([(0,i.fM)(1,o.D),(0,i.fM)(2,s.w),(0,i.fM)(3,n.m),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object,void 0===o.D?Object:o.D,void 0===s.w?Object:s.w,void 0===n.m?Object:n.m])],l)},186488:function(e,t,r){"use strict";r.d(t,{P:function(){return u}});var i=r(789786),a=r(690613),n=r(5026),o=r(920704),s=r(200247),c=r(596112),l=r(65458),d=r(358789);class u extends d.g{async execute(){return this._task=this._mattingDataService.createGraphicMattingTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform}),await this._task}transfer(e){let t={type:l.FV.Matting,assetId:this._assetId};if(e.vid&&e.url)t.onlineData={vid:e.vid,url:e.url,key:e.key,edgeProductVid:e.edgeProductVid,edgeProductUrl:e.edgeProductUrl,edgeProductKey:e.edgeProductKey};else{if(!e.md5)return(0,a.wf)(-1,"reverse response invalid.");t.cloudData={md5:e.md5,edgeProductMd5:e.edgeProductMd5}}return(0,a.oW)(t)}constructor(e,t,r,i,a,n){super(),this._assetId=e,this._platform=t,this._workspaceId=r,this._accountService=i,this._teaAdapterService=a,this._mattingDataService=n}}u=(0,i.gn)([(0,i.fM)(3,s.D),(0,i.fM)(4,c.w),(0,i.fM)(5,n.s),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,String,void 0===s.D?Object:s.D,void 0===c.w?Object:c.w,void 0===n.s?Object:n.s])],u)},371167:function(e,t,r){"use strict";r.d(t,{X:function(){return l}});var i=r(789786),a=r(690613),n=r(65458),o=r(358789),s=r(214291),c=r(966697);class l extends o.g{async execute(){return this._task=this._objectLockDataService.createObjectLockTask({assetId:this._assetId,workspaceId:this._workspaceId,platform:this._platform,tmpId:this._accountService.hasLogin?"":this._accountService.userProfile.webId,region:this._accountService.userProfile.region,params:this._editParams}),await this._task}transfer(e){var t;let r={type:n.FV.ObjectLock,assetId:this._assetId},[{url:i="",capcutEditGatewayOutput:o="{}"}]=null!==(t=e.taskDetail)&&void 0!==t?t:[{}];if(!i||!o)return(0,a.wf)(-1,"object track response invalid.");try{let{cache_url:e=""}=JSON.parse(o);r.onlineData={outputUrl:i,cacheUrl:e}}catch(e){return(0,a.wf)(-1,"object track response invalid. capcutEditGatewayOutput is not a valid JSON",e)}return(0,a.oW)(r)}constructor(e,t,r,i,a,n){super(),this._assetId=e,this._platform=t,this._workspaceId=r,this._editParams=i,this._accountService=a,this._objectLockDataService=n}}l=(0,i.gn)([(0,i.fM)(4,c.Gw),(0,i.fM)(5,s.iM),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,"undefined"==typeof SmartTaskPlatform?Object:SmartTaskPlatform,String,"undefined"==typeof ObjectLockCloudEditParams?Object:ObjectLockCloudEditParams,void 0===c.Gw?Object:c.Gw,void 0===s.iM?Object:s.iM])],l)},66859:function(e,t,r){"use strict";r.d(t,{S:function(){return c}});var i=r(789786),a=r(690613),n=r(145324),o=r(200247),s=r(65458);class c{async execute(){return this._task=this._smartCropDataService.createSmartCropTask(this._params),await this._task}transfer(e){return(0,a.oW)({type:s.FV.SmartCrop,cropProduct:{crop_box_list:e.crop_box_list}})}cancel(){var e;null===(e=this._task)||void 0===e||e.then(e=>{e.ok&&e.value.cancel()})}constructor(e,t,r){this._params=e,this._smartCropDataService=t,this._accountService=r}}c=(0,i.gn)([(0,i.fM)(1,n.I),(0,i.fM)(2,o.D),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof CreateSmartCropTaskParams?Object:CreateSmartCropTaskParams,void 0===n.I?Object:n.I,void 0===o.D?Object:o.D])],c)},284943:function(e,t,r){"use strict";r.d(t,{o:function(){return u}});var i=r(789786),a=r(690613),n=r(651894),o=r(920704),s=r(200247),c=r(596112),l=r(65458),d=r(358789);class u extends d.g{async execute(){return this._task=this._smartSplitDataService.createSmartSplitTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform}),await this._task}transfer(e){let t={type:l.FV.SmartSplit};return Object.keys(e).length?(0,a.oW)({...t,...e}):(0,a.wf)(-1,"smart split response invalid.")}constructor(e,t,r,i,a,n){super(),this._assetId=e,this._platform=t,this._workspaceId=r,this._accountService=i,this._teaAdapterService=a,this._smartSplitDataService=n}}u=(0,i.gn)([(0,i.fM)(3,s.D),(0,i.fM)(4,c.w),(0,i.fM)(5,n.h),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,String,void 0===s.D?Object:s.D,void 0===c.w?Object:c.w,void 0===n.h?Object:n.h])],u)},817488:function(e,t,r){"use strict";r.d(t,{v:function(){return a}});var i,a=((i={})[i.Algorithm=12]="Algorithm",i[i.Stable=13]="Stable",i[i.Gameplay=16]="Gameplay",i[i.DigitalHuman=20001]="DigitalHuman",i)},827404:function(e,t,r){"use strict";r.d(t,{G:function(){return u}});var i=r(789786),a=r(402655),n=r(961087),o=r(597875),s=r(323516),c=r(108692),l=r(461571),d=r(613069);class u extends a.JT{async syncFileOpenTime(){await this._initAwaitLocker.awaitForInit();let e=this._mainDraftService.draftWorkspaceManager.workspaceId,t={workspaceId:e,fileId:this._mainDraftService.dataSdk.draftView.getDraftId(),fileType:o.H.Package};if(this._permissionService.getDraftPermission()===l.O.editable)return this._syncFileOpenTimeDataService.syncFileOpenTime(t)}constructor(e,t,r){super(),this._syncFileOpenTimeDataService=e,this._mainDraftService=t,this._permissionService=r,this._initAwaitLocker=new n.G,new Promise(e=>{let{workspaceId:t}=this._mainDraftService.draftWorkspaceManager;t&&e(),this._mainDraftService.draftWorkspaceManager.onDidWorkspaceChange(()=>{e()})}).then(()=>{this._initAwaitLocker.initDone()})}}u=(0,i.gn)([(0,i.fM)(0,s.g),(0,i.fM)(1,c.n),(0,i.fM)(2,d.H),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===s.g?Object:s.g,void 0===c.n?Object:c.n,"undefined"==typeof IVideoPermissionService?Object:IVideoPermissionService])],u)},599639:function(e,t,r){"use strict";r.d(t,{m:function(){return i}});let i=(0,r(335290).yh)("toolbar-state-service")},204034:function(e,t,r){"use strict";r.d(t,{UQ:function(){return c},ZP:function(){return l},w8:function(){return s}});var i,a,n=r(260963),o=r(262418);var s=((i={}).Edit="Edit",i.SelectFrame="SelectFrame",i);var c=((a={}).upload="upload",a.video="video",a.highlight="highlight",a.staticCover="staticCover",a);let l=class e{setGraphicEditorIframe(e){this.graphicEditorIframe=e}switchEditorGraphic(e){this.showEditorGraphic=e}coverLoadingSet(e){this.coverLoading=e}coverSet(e){this.cover=e}updateAddCoverForOpeningWhenExport(e){this.addCoverForOpeningWhenExport=e}setSelectLocalFile(e){this.selectLocalFile={file:e,url:URL.createObjectURL(e)}}setUploadMaterial(e){this.uploadMaterial&&e?this.uploadMaterial={...this.uploadMaterial,...e}:this.uploadMaterial=e}openConfirmModal(){this.confirmVisible=!0}closeConfirmModal(){this.confirmVisible=!1}setDraftModifyTime(e){this.draftModifyTime=e}selectTypeSet(e){this.selectType=e}cancelUpload(){this.selectType="video",this.selectLocalFile=void 0,this.uploadMaterial=null}toggleIsOpeningGraphic(e){this.isOpeningGraphic=e}isSettingCoverSet(e){this.isSettingCover=e}startHighlightSelect(){this.selectType="highlight"}highlightLoadingSet(e){this.highlightParam&&(this.highlightParam.loading=e)}highlightListSet(e){this.highlightParam&&(this.highlightParam.highlightList=e,this.highlightParam.selectedIndex=e[0])}highlightErrorSet(e){this.highlightParam&&(this.highlightParam.errorStatus=e)}highlightIndexSet(e){if(!!this.highlightParam)this.highlightParam.selectedIndex=e}updateGraphicPackageAssets(e){this.graphicPackageAssets=e}setCoverPosition(e){this.coverPosition=e}setVideoParam(e){this.videoParam=e}setVideoSeekTo(e){this.seekTo=e}setHighlightParam(e){this.highlightParam=e}refreshDraftModifyTimeWhenOpen(){this._draftModifyTimeWhenOpen=this.draftModifyTime}setVisible(e){this.visible=e}setModalType(e){this.modalType=e}setSelectFramesForGraphicParams(e){this.selectFramesForGraphicParams=e}setAspectRatio(e){this.aspectRatio=e}setDuration(e){this.duration=e}setVideoCanvas(e){this.videoCanvas=e}setUpscalerSize(e){this.upscalerSize=e}setFrameSize(e){this.frameSize=e}setHighlightFrameSize(e){this.highlightFrameSize=e}setIsOpeningGraphic(e){this.isOpeningGraphic=e}setIsSettingCover(e){this.isSettingCover=e}setSelectType(e){this.selectType=e}setCover(e){this.cover=e}setIsLogin(e){this.isLogin=e}setIsAddingFramesToGraphic(e){this.isAddingFramesToGraphic=e}constructor(){this.isLogin=!1,this._draftModifyTimeWhenOpen=-1,this.isSettingCover=!1,this.draftModifyTime=0,this.isAddingFramesToGraphic=!1,this.selectFramesForGraphicParams={},this.addCoverForOpeningWhenExport=!0,this.selectLocalFile=void 0,this.uploadingFile=null,this.uploadMaterial=null,this.upscalerSize={width:0,height:0},this.frameSize={width:0,height:0},this.highlightFrameSize={width:0,height:0},this.videoParam=void 0,this.highlightParam=void 0,this.isOpeningGraphic=!1,this.showEditorGraphic=!1,this.graphicPackageAssets=[],this.coverPosition=o.fh.TrackBar,this.graphicEditorIframe=null,this.seekTo=0n,this.visible=!1,this.modalType="Edit",this.confirmVisible=!1,this.confirmVisible=!1,this.coverLoading=!0,this.selectType="video",this.aspectRatio=0,this.duration=0n,(0,n.ky)(this)}}},649508:function(e,t,r){"use strict";function i(e,t,r){let i=document.createElement("canvas");i.width=e,i.height=t;let a=i.getContext("2d");return a.fillStyle=r,a.fillRect(0,0,e,t),i.toDataURL()}r.d(t,{o:function(){return i}})},933096:function(e,t,r){"use strict";r.d(t,{l:function(){return i}});let i=(0,r(335290).yh)("video-cover")},782153:function(e,t,r){"use strict";r.d(t,{u:function(){return a}});var i=r(613069);let a=(0,r(335290).LO)(i.H)},58822:function(e,t,r){"use strict";r.d(t,{T:function(){return i}});let i=(0,r(335290).yh)("workspace-update")},795612:function(e,t,r){"use strict";r.d(t,{Q:function(){return o}});var i=r(789786),a=r(782350),n=r(639605);class o{_init(){this._initWebSocket()}_initWebSocket(){this._initWebSocketCallbackMap(),this._registerWebSocketCallback()}_initWebSocketCallbackMap(){this._webSocketCallbackList=[{method:n.h1.WorkspaceRemove,callback:this._registerWorkspaceRemoveCallback},{method:n.h1.WorkspaceUpdate,callback:this._registerWorkspaceUpdateCallback},{method:n.h1.WorkspaceNewMember,callback:this._registerWorkspaceNewMemberCallback}]}_registerWebSocketCallback(){this._webSocketCallbackList.forEach(e=>{let{method:t,callback:r}=e;this._websocketService.registerCallback(t,r)})}getWebsocketCallbackList(){return this._webSocketCallbackList}constructor(e,t){this._websocketService=e,this._workspaceService=t,this._webSocketCallbackList=[],this._registerWorkspaceRemoveCallback=e=>{if(!!e.ok)this._workspaceService.triggerWorkspaceListChange({...e.value,method:n.h1.WorkspaceRemove})},this._registerWorkspaceUpdateCallback=e=>{if(!!e.ok)this._workspaceService.triggerWorkspaceListChange({...e.value,method:n.h1.WorkspaceUpdate})},this._registerWorkspaceNewMemberCallback=e=>{if(!!e.ok)this._workspaceService.triggerWorkspaceListChange({...e.value,method:n.h1.WorkspaceNewMember})},this._init()}}o=(0,i.gn)([(0,i.fM)(0,n.J0),(0,i.fM)(1,a.W),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===n.J0?Object:n.J0,void 0===a.W?Object:a.W])],o)},441247:function(e,t,r){"use strict";r.d(t,{Fw:function(){return n},Gi:function(){return s},Jg:function(){return u},Ze:function(){return o},gy:function(){return l},ns:function(){return c},q2:function(){return d}});var i=r(65458),a=r(426336);let n="image/jpeg,image/jpg,image/webp,image/bmp,image/png,image/tiff,image/x-tiff,jpeg,jpg,png",o=n.split(","),s="video/mp4,video/mov,video/m4v,video/x-flv,video/quicktime,video/avi,video/webm,video/mp2t,video/x-ms-asf,mp4,mov,m4v,flv,mkv,avi,webm,wmv,rm,rmvb,3gp,m2ts,mt2s,m2t,mxf,mpg,mpeg,mpe,ts,mts,qt,asf,audio/mp3,audio/mpeg,audio/m4a,audio/x-m4a,audio/wav,audio/flac,mp3,flac,m4a,wav,aac,oga,ogg,wma,amr,aif,aiff,ac3,mpa,ape,mac,mp2,acc,image/jpeg,image/jpg,image/webp,image/bmp,image/png,image/heif,image/heic,image/tiff,image/x-tiff,image/x-icon,image/vnd.microsoft.icon,image/svg+xml,image/vnd.adobe.photoshop,image/avif,jpeg,jpg,png,heif,heic,tiff,tif,ico,svg,svgz,psd,avif",c=s.split(","),l="video/mp4,video/mov,video/m4v,video/x-flv,video/quicktime,video/avi,video/webm,video/mp2t,video/x-ms-asf,mp4,mov,m4v,flv,mkv,avi,webm,wmv,rm,rmvb,3gp,m2ts,mt2s,m2t,mxf,mpg,mpeg,mpe,ts,mts,qt,asf";l.split(",");let d={0:a.cVg.MetaTypeVideo,1:a.cVg.MetaTypePhoto},u={0:i.wM.Video,1:i.wM.Image}},311669:function(e,t,r){"use strict";r.d(t,{b:function(){return c}});var i=r(789786),a=r(260963),n=r(129219),o=r(989719);function s(e){return{status:e.status,type:e.source,error:e.error,value:e.status===n.xR.Success?e.product:void 0,progress:e.status===n.xR.Success?100:0,cancel:e.cancel}}class c{actionSegmentIntelligentSet(e,t){let r=new Map;t.token&&r.set(t.token.source,s(t.token)),this.segmentIntelligentMap[e]=r}actionSegmentSmartJobSet(e,t){if(this.segmentIntelligentMap[e])this.segmentIntelligentMap[e].set(t.source,s(t));else{let r=new Map;r.set(t.source,s(t)),this.segmentIntelligentMap[e]=r}}actionSegmentIntelligentProgressSet(e,t,r){var i;(null===(i=this.segmentIntelligentMap[e])||void 0===i?void 0:i.has(t))&&(this.segmentIntelligentMap[e].get(t).progress=r)}actionSegmentIntelligentStatusSet(e,t,r){var i;(null===(i=this.segmentIntelligentMap[e])||void 0===i?void 0:i.has(t))&&(this.segmentIntelligentMap[e].get(t).status=r)}actionSegmentIntelligentErrorSet(e,t){var r;let{type:i,status:a,error:s}=t;(null===(r=this.segmentIntelligentMap[e])||void 0===r?void 0:r.has(i))?this.segmentIntelligentMap[e].get(i).status=a:a===n.xR.Error&&(this.segmentIntelligentMap[e]||new Map).set(i,{status:a,type:i,error:s,progress:0,value:null,cancel:o.Z})}actionSetOriginSegment(e){this.idToOriginMaterial[e.segmentId]=e}actionSetIntermediateMaterial(e,t){this.idToIntermediateMaterial[e]=t}actionIntelligentReset(e,t){var r;if(!(null===(r=this.segmentIntelligentMap[e])||void 0===r?void 0:r.has(t)))return;let i=this.segmentIntelligentMap[e].get(t);i.progress=0,i.status=n.xR.Cancelled,delete this.idToOriginMaterial[e],delete this.idToIntermediateMaterial[e]}constructor(){this.segmentIntelligentMap={},this.idToOriginMaterial={},this.idToIntermediateMaterial={},(0,a.ky)(this)}}(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,"undefined"==typeof IObservableSlot?Object:IObservableSlot]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionSegmentIntelligentSet",null),(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,"undefined"==typeof ISmartToken?Object:ISmartToken]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionSegmentSmartJobSet",null),(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,void 0===n.Sc?Object:n.Sc,Number]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionSegmentIntelligentProgressSet",null),(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,void 0===n.Sc?Object:n.Sc,void 0===n.xR?Object:n.xR]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionSegmentIntelligentStatusSet",null),(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,"undefined"==typeof Pick?Object:Pick]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionSegmentIntelligentErrorSet",null),(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof IOriginMutableMaterial?Object:IOriginMutableMaterial]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionSetOriginSegment",null),(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,"undefined"==typeof MaterialVideo?Object:MaterialVideo]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionSetIntermediateMaterial",null),(0,i.gn)([a.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,void 0===n.Sc?Object:n.Sc]),(0,i.w6)("design:returntype",void 0)],c.prototype,"actionIntelligentReset",null)},601559:function(e,t,r){"use strict";r.d(t,{$:function(){return _}});var i=r(789786),a=r(919111),n=r(800788),o=r(426336),s=r(230689),c=r(431220),l=r(600921),d=r(129219),u=r(271564),h=r(538181);function g(e){return e.reverse?`${e.id}_${e.material.reversePath}`:`${e.id}_${e.material.path}`}class _{updateRenderManager(e){this._renderManager=e}startGamePlay(e){var t,r,i;let a=e,n=a.id;if(!a)return;let s=(0,o.MnT)(a.material),c=null!==(i=null==s?void 0:s.algorithm)&&void 0!==i?i:"",l=(null==a?void 0:null===(t=a.material)||void 0===t?void 0:t.path)||"";if(!c||!l)return;this._originalMaterialMap.set(a.id,this._intelligenceStore.idToOriginMaterial[n]),null===(r=this._currentRequestMap[a.id])||void 0===r||r.cancel();let u=this._getOrCreateToken(a);if(this._currentRequestMap[a.id]=u,u.status===d.xR.Success)return this._intelligenceStore.actionSetIntermediateMaterial(a.id,a.material.clone()),this._replaceResource(a,u),u;let g=Date.now();return(0,h.Z)(this._containerService,{type:"gameplay",stage:"start",value:c,errorMsg:u.error.msg}),u.onSuccess(e=>{if((0,h.Z)(this._containerService,{type:"gameplay",stage:"success",value:c,costTime:Date.now()-g,errorMsg:u.error.msg}),!!(a=this._dataSdk.draftView.getSegmentById(n)))this._intelligenceStore.actionSetIntermediateMaterial(a.id,a.material.clone()),this._replaceResource(a,u)}),u.onError(e=>{(0,h.Z)(this._containerService,{type:"gameplay",stage:"fail",value:c,costTime:Date.now()-g,errorMsg:u.error.msg})}),u.onCancel(()=>{(0,h.Z)(this._containerService,{type:"gameplay",stage:"cancel",value:c,costTime:Date.now()-g,errorMsg:u.error.msg})}),u}cancelGamePlay(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];!Array.isArray(e)&&(e=[e]),e.forEach(e=>{var r;null===(r=this._currentRequestMap[e])||void 0===r||r.cancel(),t&&this._recoverMutable(e),this._originalMaterialMap.delete(e)})}_getOrCreateToken(e){(0,n.Y2)((0,o.hey)(e)),(0,n.Y2)(""!==e.material.path);let t=this._cache.getGameplayCache(g(e));if(t)return t;let r=this._containerService.createInstance(l.m,e,this._renderManager,this._draftPathStore);return r.onSuccess(()=>{this._cache.setGameplayCache(g(e),r)}),r}_replaceImageToImageGamePlayResult(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this._dataSdk.draftView.getSegmentById(e);if(!r)return;let{path:i}=r.material;if(!i)return;let a=this._dataSdk.draftView.getDraftIdAndSegById(r.id);if(!!a)this._dataSdk.api.segment.innerReplace({draftId:a.draftId,identifier:{id:r.id,material:{path:i}},substitute:{material:{path:t,sourcePlatform:o.cvu.MaterialPlatformDefault}}})}_replaceImageToVideoGamePlayResult(e,t){let{path:r,resourceId:i,resourceName:a}=t;if(!this._originalMaterialMap.get(e))return;let n=this._dataSdk.draftView.getDraftIdAndSegById(e);if(!!n)this._dataSdk.api.segment.innerReplace({draftId:n.draftId,identifier:{id:n.segment.id,material:{path:n.segment.material.path}},substitute:{material:{path:r,type:o.cVg.MetaTypeVideo,materialId:i,materialName:a,sourcePlatform:o.cvu.MaterialPlatformDefault,duration:n.segment.targetTimerange.duration}}})}async _recoverMutable(e){let t=this._originalMaterialMap.get(e);if(t){let e=await (0,u.jm)(this._dataSdk,this._renderManager,t);this._dataSdk.api.template.setMutableVideos(e)}}_replaceResource(e,t){(0,n.Y2)(t.status===d.xR.Success);try{t.product.groupType===d.FI.Image?this._replaceImageToImageGamePlayResult(e.id,t.product.path):this._replaceImageToVideoGamePlayResult(e.id,{path:t.product.path,resourceId:t.product.resourceId,resourceName:t.product.resourceName})}catch(e){}finally{delete this._currentRequestMap[e.id]}}constructor(e,t,r,i,a,n){this._cache=e,this._dataSdk=t,this._renderManager=r,this._draftPathStore=i,this._intelligenceStore=a,this._containerService=n,this._originalMaterialMap=new Map,this._currentRequestMap={}}}_=(0,i.gn)([(0,i.fM)(5,s.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===c.v?Object:c.v,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof RenderManager?Object:RenderManager,void 0===a.H?Object:a.H,"undefined"==typeof IntelligenceStore?Object:IntelligenceStore,void 0===s.t?Object:s.t])],_)},865908:function(e,t,r){"use strict";r.d(t,{v:function(){return b}});var i=r(789786);r(784923);var a=r(498417),n=r(426336),o=r(260963),s=r(801497),c=r(85031),l=r(230689),d=r(145324),u=r(685795),h=r(108692),g=r(587892),_=r(402655),p=r(800788),f=r(209537),m=r(911365),v=r(720196),y=r(597623),S=r(271564);class b extends _.JT{get dataSdk(){return this._mainDraftService.dataSdk}get timelineManager(){return this._timelineManager}get segmentManager(){return this._timelineManager.segmentManager}updateRenderManager(e){this._renderManager=e}_setLoadingUI(e,t,r,i){let a=this._noticeLoadingIdsMap.get(e),n=`smart-crop-loading-notice-${e}`;if(t){if(this.segmentManager.setTimelineSegmentLoading(e,t,this._segmentIdLoadingTimestamp,s.ZP.t("web_edit_text_smart_ratio_wait",{number0:null!=r?r:0},"Applying auto reframe... {number0}%")),a)this._notificationService.updateLoading(e,s.ZP.t("web_edit_text_smart_ratio_wait",{number0:null!=r?r:0},"Applying auto reframe... {number0}%"),{duration:4e4,className:n});else{let{id:t}=this._notificationService.loading(s.ZP.t("web_edit_text_smart_ratio_wait",{number0:null!=r?r:0},"Applying auto reframe... {number0}%"),{},{id:e,duration:4e4,className:n});setTimeout(()=>{let e=document.querySelector(`.${n}`);e&&e.addEventListener("click",()=>{null==i||i()})},2e3),this._noticeLoadingIdsMap.set(e,t)}}else{this.segmentManager.setTimelineSegmentLoading(e,!1,this._segmentIdLoadingTimestamp);let t=this._noticeLoadingIdsMap.get(e);this._notificationService.updateLoading(e,s.ZP.t("web_edit_text_smart_ratio_wait",{number0:null!=r?r:100},"Applying auto reframe... {number0}%"),{duration:1}),this._notificationService.close(t,e),this._noticeLoadingIdsMap.delete(e)}}setLoadingState(e,t){this._segmentIdLoadingState.set(e,t)}getLoadingState(e){var t;return null!==(t=this._segmentIdLoadingState.get(e))&&void 0!==t?t:{loading:!1,loadingText:void 0,progress:0}}async getSubject(e){let t=performance.now(),r={material_type:"video",reco_time_ms:e.currentFrameTime};(0,f.V)(this._containerService,{...r});let i=await this._smartCropDataService.getSmartCropSubject(e),a=performance.now()-t;if(!i.ok){(0,m.C)(this._containerService,{...r,time:a,status:-1});return}return i.value.subjectList.length>0?(0,m.C)(this._containerService,{...r,time:a,status:1}):(0,m.C)(this._containerService,{...r,time:a,status:0}),i}getSmartCropToken(e){return this._segmentIdTokenMap.get(e)}setTimelineManager(e){this._timelineManager=e}startSmartCrop(e,t,r){let{segment:i,params:a}=e,n=performance.now();this._segmentIdLoadingTimestamp=new Date().getTime();let o=this.getSmartCropToken(i.id);null==o||o.cancel(),this.setLoadingState(i.id,{loading:!0,loadingText:void 0,progress:0}),this._setLoadingUI(i.id,!0,0,t);let s=this._containerService.createInstance(c.c,i,a,this._mainDraftService.draftPathStore,this._algorithmFilerManager);return(0,v.e)(this._containerService,{material_type:a.extra.material_type,material_format:a.extra.material_format,material_resolution:a.extra.material_resolution,crop_resolution:a.extra.crop_resolution,duration:a.extra.duration,status:"start"}),this._segmentIdTokenMap.set(i.id,s),s.onProgress((e,r)=>{this._setLoadingUI(i.id,!0,e,t),this.setLoadingState(i.id,{loading:!0,loadingText:void 0,progress:null!=e?e:0}),this._onProgress.fire({segmentId:i.id,progress:null!=e?e:0})}),s.onSuccess(e=>{if(this._deleteIfEqual(i.id,s),e){let t=performance.now()-n;this.handleSuccess(i,a,e,e.cache_path,t),this._onSuccess.fire({segmentId:i.id,params:a})}}),s.onError(e=>{this._deleteIfEqual(i.id,s),this._slardarAdapterService.captureException("smart crop error",e),this.handleError(i.id,e,a,r),this._onError.fire({segmentId:i.id,params:a})}),s.onCancel(()=>{this._setLoadingUI(i.id,!1,0),this._deleteIfEqual(i.id,s),this.setLoadingState(i.id,{loading:!1,loadingText:void 0,progress:0}),this._onCancel.fire({segmentId:i.id,params:a}),(0,v.e)(this._containerService,{material_type:a.extra.material_type,material_format:a.extra.material_format,material_resolution:a.extra.material_resolution,crop_resolution:a.extra.crop_resolution,duration:a.extra.duration,status:"cancel",fail_reason:"cancel"})}),s}_deleteIfEqual(e,t){t===this._segmentIdTokenMap.get(e)&&this._segmentIdTokenMap.delete(e)}cancelSmartCrop(e){var t;null===(t=this._segmentIdTokenMap.get(e))||void 0===t||t.cancel()}handleSuccess(e,t,r,i,o){var c,l;this._setLoadingUI(e.id,!1),this.setLoadingState(e.id,{loading:!1,loadingText:void 0,progress:0}),(0,p.Y2)(this.dataSdk);let d=this.dataSdk.api.batch.batchStart();this._renderManager.clearTrackingRelation(e.id,!0)&&setTimeout(()=>{a.Z.warning(s.ZP.t("web_tracking_text_auto_reframe_no_tracking",{},"Auto reframe applied. Tracking is removed."))},500),this.dataSdk.api.video.crop({segId:e.id,cropRatio:n.j8m.CropRatioFree});let u=null!==(l=null===(c=S.A9[t.extra.crop_ratio])||void 0===c?void 0:c.strValue)&&void 0!==l?l:"original";this.dataSdk.api.video.addSmartCrop({segId:e.id,cropRatio:"free"===u?"custom":u,stability:t.stableWeight,trackSpeed:null==t?void 0:t.keyFrameFps,cachePath:i}),(0,v.e)(this._containerService,{material_type:t.extra.material_type,material_format:t.extra.material_format,material_resolution:t.extra.material_resolution,crop_resolution:t.extra.crop_resolution,duration:t.extra.duration,time:o,status:"success"}),this.dataSdk.api.batch.batchEnd(d),this._notificationService.success(s.ZP.t("web_editor_toolsmodify_toast_resize_success",{},"Auto reframe applied"))}handleError(e,t,r,i){this._setLoadingUI(e,!1,0),this.setLoadingState(e,{loading:!1,loadingText:void 0,progress:0}),(0,v.e)(this._containerService,{material_type:r.extra.material_type,material_format:r.extra.material_format,material_resolution:r.extra.material_resolution,crop_resolution:r.extra.crop_resolution,duration:r.extra.duration,status:"fail",fail_reason:-1===t.code?"network_error":"server_error"}),this._slardarAdapterService.captureException("smart crop error",t),null==i||i(e)}removeSmartCrop(e){(0,p.Y2)(this.dataSdk),this.dataSdk.api.video.removeSmartCrop({segId:e})}async _checkDisable(){let e=await this._smartCropDataService.checkSmartCropDisable();e.ok&&(0,o.z)(()=>{this.observableData.disableSmartCrop=e.value})}constructor(e,t,r,i,a,n,s,c){super(),this._algorithmFilerManager=e,this._timelineManager=t,this._renderManager=r,this._containerService=i,this._mainDraftService=a,this._smartCropDataService=n,this._slardarAdapterService=s,this._notificationService=c,this._segmentIdTokenMap=(0,o.LO)(new Map,{deep:!1}),this._segmentIdLoadingState=(0,o.LO)(new Map),this._segmentIdLoadingTimestamp=new Date().getTime(),this._noticeLoadingIdsMap=new Map,this._onProgress=this._register(new g.Q),this._onSuccess=this._register(new g.Q),this._onError=this._register(new g.Q),this._onCancel=this._register(new g.Q),this.observableData=(0,o.LO)({disableSmartCrop:!0}),this._checkDisable(),this.onProgress=this._onProgress.event,this.onSuccess=this._onSuccess.event,this.onError=this._onError.event,this.onCancel=this._onCancel.event,this._mainDraftService.dataSdk.onChangeDiff(e=>{let t=[];this._segmentIdTokenMap.forEach((e,r)=>{!this._mainDraftService.dataSdk.draftView.getSegmentById(r)&&t.push(e)}),t.forEach(e=>e.cancel())})}}b=(0,i.gn)([(0,i.fM)(3,l.t),(0,i.fM)(4,h.n),(0,i.fM)(5,d.I),(0,i.fM)(6,u.L),(0,i.fM)(7,y.lT),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof AlgorithmFilerManager?Object:AlgorithmFilerManager,Object,"undefined"==typeof RenderManager?Object:RenderManager,void 0===l.t?Object:l.t,void 0===h.n?Object:h.n,void 0===d.I?Object:d.I,void 0===u.L?Object:u.L,void 0===y.lT?Object:y.lT])],b)},361459:function(e,t,r){"use strict";r.d(t,{l:function(){return S}});var i=r(789786),a=r(587892),n=r(402655),o=r(690613),s=r(208041),c=r(800788),l=r(129219),d=r(65458),u=r(230689),h=r(433140),g=r(200247),_=r(817554),p=r(263958),f=r(503914),m=r(638336),v=r(105395),y=r(732564);class S extends n.JT{get source(){return l.Sc.Algorithm}get product(){return(0,c.Y2)(this._product),this._product}get status(){return this._cancellation.token.isCancellationRequested?l.xR.Cancelled:this._job?(0,f.s)(this._job.status):l.xR.Running}get error(){return this._error}async _startJob(){if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let e=this._smartToolsService.makeBuilder(),t=await (0,m.aP)(this._segment,this._draftPathStore,this._resourceService),r=(0,m.R5)(this._segment,this._accountService.hasLogin);e.createAlgorithmTask(t,r,{level:.5,mute:0===this._segment.volume?1:2}),this._job=e.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,c.Y2)(1===e.length),this._downloadAndAddResourceService(e[0])})}async _downloadAndAddResourceService(e){var t,r;let i=[{md5:null!==(t=e.md5)&&void 0!==t?t:"",vid:null!==(r=e.vid)&&void 0!==r?r:"",url:e.url,key:e.key}].filter(e=>""!==e.md5||""!==e.vid),a=await this._containerService.invokeFunction(_.CH,{list:i},{resourceType:l.uG.SmartTools,resourceId:e.taskId,isGameplay:!0});if(!a.ok){this._error=a,this._onError.fire(this._error);return}e.groupType===d.wM.Image?this._accountService.hasLogin?this._handleImageProduct(e,a.value):this._handleFileProduct(e,a.value):this._accountService.hasLogin?this._handleVideoProduct(e,a.value):this._handleFileProduct(e,a.value)}async _handleImageProduct(e,t){let r=this._containerService.invokeFunction(_.Fq,t,this._draftPathStore),i=await this._containerService.invokeFunction(v.RG,r[0].id,r[0].path);if(!i.ok){this._error=i,this._onError.fire(this._error);return}this._product={path:r[0].path,groupType:l.FI.Image,resourceId:e.resourceId,resourceName:e.resourceName},this._onSuccess.fire(this._product)}async _handleVideoProduct(e,t){let r=this._containerService.invokeFunction(_.Rg,t,this._draftPathStore);(0,c.Y2)(r.length>=1);let i=await (0,_.TB)(this._resourceService,r[0].id);this._product={path:r[0].path,...i,groupType:l.FI.Video,resourceId:e.resourceId,resourceName:e.resourceName};let a=await this._containerService.invokeFunction(v.U3,this._renderManager,this._product);if(!a.ok){this._error=a,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}async _handleFileProduct(e,t){let r=this._containerService.invokeFunction(_.Jy,t,this._draftPathStore);(0,c.Y2)(r.length>=1);let i=await (0,_.gF)(this._resourceService,r[0].id);if(this._product={path:r[0].path,...i,groupType:l.FI.Video,resourceId:e.resourceId,resourceName:e.resourceName},e.groupType===d.wM.Video){let e=await this._containerService.invokeFunction(v.U3,this._renderManager,this._product);if(!e.ok){this._error=e,this._onError.fire(this._error);return}}else if(e.groupType===d.wM.Image){let t=await this._containerService.invokeFunction(v.F4,e.resourceId,this._draftPathStore.getDraftPathFromResourceKey(e.resourceId));if(!t.ok){this._error=t,this._onError.fire(this._error);return}}else(0,c.bP)(e.groupType);this._onSuccess.fire(this._product)}constructor(e,t,r,i,n,c,l){super(),this._segment=e,this._renderManager=t,this._draftPathStore=r,this._accountService=i,this._smartToolsService=n,this._containerService=c,this._resourceService=l,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellation=new s.A,this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new p.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}S=(0,i.gn)([(0,i.fM)(3,g.D),(0,i.fM)(4,d.dM),(0,i.fM)(5,u.t),(0,i.fM)(6,h.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,void 0===y.zo?Object:y.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===g.D?Object:g.D,void 0===d.dM?Object:d.dM,void 0===u.t?Object:u.t,void 0===h.c?Object:h.c])],S)},817554:function(e,t,r){"use strict";r.d(t,{CH:function(){return k},Fq:function(){return P},Jy:function(){return I},Lo:function(){return M},Rg:function(){return w},TB:function(){return b},gF:function(){return S},r2:function(){return T}});var i=r(690613),a=r(800788),n=r(550535),o=r(828403),s=r(820193),c=r(948328),l=r(420072),d=r(315201),u=r(798184),h=r(230689),g=r(433140),_=r(200247),p=r(596112),f=r(127830),m=r(565508),v=r(129219),y=r(108692);async function S(e,t){var r;let i=e.get(t,f._g.UserFile);return(0,a.ZB)(i),await (0,l.Z)(i),(0,a.Y2)((0,d.R)(i.value)),{url:i.value.url,key:null!==(r=i.value.decryptKey)&&void 0!==r?r:""}}async function b(e,t){var r;let i=e.get(t,f._g.UserVideo);(0,a.ZB)(i),await (0,l.Z)(i),(0,a.Y2)((0,d.R)(i.value));let n=i.getUserVideoResourceToken();return await (0,u.x)(n),{url:n.value.url,key:null!==(r=n.value.decryptKey)&&void 0!==r?r:""}}async function M(e,t){var r;let i=e.get(t,f._g.UserPhoto);(0,a.ZB)(i),await (0,l.Z)(i),(0,a.Y2)((0,d.R)(i.value));let n=i.getUserPhotoResourceToken();return{url:n.value.url,key:null!==(r=n.value.decryptKey)&&void 0!==r?r:""}}async function k(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{resourceType:v.uG.MattingVideo},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{addToUserGenerated:!0},c=e.get(h.t),l=e.get(y.n),d=e.get(_.D),u=e.get(p.w),{addToUserGenerated:g}=s;if(d.hasLogin){let e=t.list.map(e=>e.md5).filter(e=>e);return(0,a.ZB)(e.length,"no found md5s when login"),await (0,n.J)({md5s:e,packageDelta:{meta:{visible:!1}},fromWorkspaceId:l.draftWorkspaceManager.workspaceId,toWorkspaceId:l.draftWorkspaceManager.workspaceId,containerService:c,addToUserGenerated:g})}{let e=t.list.map(e=>e.vid);(0,a.ZB)(e.length,"no found vids when login");let n=(0,o.n)(t.list,{syncParams:{...r,tmpId:await u.getWebId()},containerService:c});return(0,i.oW)(n)}}function T(e,t,r,i){let a=e.get(g.c),n=[];return t.forEach((e,t)=>{var r;let o=(0,s.GL)(e.getModel(),f._g.UserFile),c=null!==(r=null==i?void 0:i[t])&&void 0!==r?r:(0,m.do)(o.resource);n.push({id:o.resource.key,path:c}),a.add(o.key,o.resource)}),n}function I(e,t,r,i){let a=e.get(c.D),n=e.get(g.c),o=[];return t.forEach((e,t)=>{var c;let l=(0,s.GL)(e.getModel(),f._g.UserFile),d=null!==(c=null==i?void 0:i[t])&&void 0!==c?c:(0,m.do)(l.resource);o.push({id:l.resource.key,path:d}),r.recordDraftPathToResourceKey(d,l.resource.key),r.recordResourceKeyToDraftPath(l.resource.key,d),a.addToAutoGenerated(e),n.add(l.key,l.resource)}),o}function w(e,t,r,i){let a=e.get(c.D),n=e.get(g.c),o=[];return t.forEach((e,t)=>{var c;let l=(0,s.GL)(e.getModel(),f._g.UserVideo),d=null!==(c=null==i?void 0:i[t])&&void 0!==c?c:(0,m.do)(l.resource);o.push({id:l.resource.key,path:d}),r.recordDraftPathToResourceKey(d,l.resource.key),r.recordResourceKeyToDraftPath(l.resource.key,d),a.addToAutoGenerated(e),n.add(l.key,l.resource)}),o}function P(e,t,r,i){let a=e.get(c.D),n=e.get(g.c),o=[];return t.forEach((e,t)=>{var c;let l=(0,s.GL)(e.getModel(),f._g.UserPhoto),d=null!==(c=null==i?void 0:i[t])&&void 0!==c?c:(0,m.do)(l.resource);o.push({id:l.resource.key,path:d}),r.recordDraftPathToResourceKey(d,l.resource.key),r.recordResourceKeyToDraftPath(l.resource.key,d),a.addToAutoGenerated(e),n.add(l.key,l.resource)}),o}},254539:function(e,t,r){"use strict";r.d(t,{I:function(){return S}});var i=r(789786),a=r(587892),n=r(402655),o=r(690613),s=r(208041),c=r(800788),l=r(129219),d=r(65458),u=r(230689),h=r(433140),g=r(200247),_=r(817554),p=r(263958),f=r(503914),m=r(638336),v=r(105395),y=r(732564);class S extends n.JT{get source(){return l.Sc.Reverse}get product(){return(0,c.Y2)(this._product.key&&this._product.path&&this._product.url),this._product}get status(){return this._cancellation.token.isCancellationRequested?l.xR.Cancelled:this._job?(0,f.s)(this._job.status):l.xR.Running}get error(){return this._error}async _startJob(){if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let e=this._smartToolsService.makeBuilder(),t=await (0,m.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService),r=(0,m.R5)(this._segment,this._accountService.hasLogin);if(e.createReverseTask(t,r),this._segment.material.matting.flag){let t=await (0,m.qk)(this._segment,this._draftPathStore,this._resourceService),r=(0,m._Y)(this._accountService.hasLogin);for(let i of(this._mattingAssetId=t[0],this._mattingEdgeAssetId=t[1],t))e.createReverseTask(i,r)}this._job=e.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{this._downloadAndAddResourceService(e)})}async _downloadAndAddResourceService(e){for(let t of e){let e=await this._handleReverseTaskValue(t);if(!e.ok){this._error=e,this._onError.fire(this._error);return}}let t=await this._containerService.invokeFunction(v.rn,this._renderManager,this._product);if(!t.ok){this._error=t,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}async _handleReverseTaskValue(e){var t,r,i,a,n,s,d,u;let h=await this._containerService.invokeFunction(_.CH,{list:[{md5:null!==(n=null===(t=e.cloudData)||void 0===t?void 0:t.md5)&&void 0!==n?n:"",vid:null!==(s=null===(r=e.onlineData)||void 0===r?void 0:r.vid)&&void 0!==s?s:"",url:null!==(d=null===(i=e.onlineData)||void 0===i?void 0:i.url)&&void 0!==d?d:"",key:null!==(u=null===(a=e.onlineData)||void 0===a?void 0:a.key)&&void 0!==u?u:""}]},{resourceType:l.uG.Reverse});if(!h.ok)return h;let g=this._containerService.invokeFunction(_.Jy,h.value,this._draftPathStore);(0,c.Y2)(g.length>=1);let p={url:"",key:""};if(e.cloudData){let e=await (0,_.gF)(this._resourceService,g[0].id);p.url=e.url,p.key=e.key}else e.onlineData&&(p.url=e.onlineData.url,p.key=e.onlineData.key);return e.assetId===this._mattingAssetId?this._product.matting={path:g[0].path,...p}:e.assetId===this._mattingEdgeAssetId?this._product.mattingEdge={path:g[0].path,...p}:(this._product.path=g[0].path,this._product.url=p.url,this._product.key=p.key),(0,o.oW)(g[0])}constructor(e,t,r,i,n,c,l){super(),this._segment=e,this._renderManager=t,this._draftPathStore=r,this._accountService=i,this._smartToolsService=n,this._containerService=c,this._resourceService=l,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellation=new s.A,this._product={},this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new p.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}S=(0,i.gn)([(0,i.fM)(3,g.D),(0,i.fM)(4,d.dM),(0,i.fM)(5,u.t),(0,i.fM)(6,h.c),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,void 0===y.zo?Object:y.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===g.D?Object:g.D,void 0===d.dM?Object:d.dM,void 0===u.t?Object:u.t,void 0===h.c?Object:h.c])],S)},914893:function(e,t,r){"use strict";r.d(t,{U:function(){return U},u:function(){return B}});var i=r(789786),a=r(587892),n=r(402655),o=r(690613),s=r(208041),c=r(800788),l=r(129219),d=r(896413),u=r(108692),h=r(65458),g=r(420072),_=r(798184),p=r(920704),f=r(374149),m=r(915208),v=r(390129),y=r(230689),S=r(433140),b=r(168550),M=r(200247),k=r(127830),T=r(241254),I=r(817554),w=r(426336),P=r(503914),x=r(638336),C=r(105395),E=r(732564),D=r(254336),F=r(53230),O=r(474572),A=r(122312),j=r(205921),R=r(196769),L=r(198990),V=r(271564);function U(e,t){var r,i;return t&&t.path?t:[{path:null!==(i=null===(r=e.vocalBeautify)||void 0===r?void 0:r.productionPath)&&void 0!==i?i:"",type:w.cVg.MetaTypeVocalBeautify},{path:e.vocalSeparation.productionPath,type:w.cVg.MetaTypeVocalSeparation},{path:(0,w.hey)(e)?e.material.videoAlgorithm.path:"",type:w.cVg.MetaTypeVideo},{path:(0,w.hey)(e)?e.material.reversePath:"",type:w.cVg.MetaTypeVideo},{path:e.material.path,type:e.material.type}].find(e=>e.path)}class B extends n.JT{static generateKey(e,t,r){return`${e.id}_${U(e,r).path}_${t.resourceId}`}dispose(){this._onProgress.dispose(),this._onError.dispose(),this._onSuccess.dispose(),this._onCancel.dispose(),super.dispose()}get key(){return this._key}get source(){return l.Sc.Vc}get product(){return(0,c.Y2)(this._product),this._product}get status(){return this._job?(0,P.s)(this._job.status):l.xR.Running}get error(){return this._error}cancel(){this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()}_separateAudio(){return new Promise(async e=>{var t,r,i;let{workspaceId:a}=this._mainDraftService.draftWorkspaceManager||{},n=U(this._segment,this._material).path,o=null!==(t=this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(n),k._g.UserVideo))&&void 0!==t?t:this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(n),k._g.Video);await (0,g.Z)(o);let s=o.getOriginResourceToken();await (0,_.x)(s);let{buffer:c}=(null==s?void 0:s.value)||{};if(!c)return;let l=new Blob([c],{type:"video/mp4"}),d=(0,L.h)({source:l,fileName:`${o.value.md5}_extractor`}),{hasLogin:u}=this._accountService;if(u){let t=await (null===(r=this._veExtractAudioAndUploadMaterialManager)||void 0===r?void 0:r.extractAudioAndUpload({files:[d],fromWorkspaceId:a,toWorkspaceId:a,uploadReportParams:{action_type:D.jm.VOICE_EFFECT,material_source:D.O9.EXTRA_AUDIO}})),i=null==t?void 0:t[0];(null==i?void 0:i.ok)?(i.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this._error)}),i.value.onPrepareFailure(async t=>{e(await this._useFfmpeg(d))}),i.value.onTranscodeFailure(async()=>{e(await this._useFfmpeg(d))}),i.value.onDidDone(()=>{let t=i.value.getModel();e(null==t?void 0:t.assetId)})):e(await this._useFfmpeg(d))}else{let t=await (null===(i=this._veExtraAudioAndUploadNoSignManager)||void 0===i?void 0:i.upload({files:[d],uploadReportParams:{action_type:D.jm.VOICE_EFFECT,material_source:D.O9.EXTRA_AUDIO}})),r=null==t?void 0:t[0];(null==r?void 0:r.ok)?(r.value.onDidTranscode(()=>{e(r.value.getModel().vid)}),r.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this._error)}),r.value.onPrepareFailure(async t=>{e(await this._useFfmpeg(d))}),r.value.onTranscodeFailure(async()=>{e(await this._useFfmpeg(d))})):e(await this._useFfmpeg(d))}})}_useFfmpeg(e){let{hasLogin:t}=this._accountService,{workspaceId:r}=this._mainDraftService.draftWorkspaceManager;return new Promise(async(i,a)=>{var n,s;if(t){let t=await (null===(n=this._extractAudioAndUploadMaterialManager)||void 0===n?void 0:n.extractAudioAndUpload({files:[e],fromWorkspaceId:r,toWorkspaceId:r,uploadReportParams:{action_type:D.jm.VOICE_EFFECT,material_source:D.O9.EXTRA_AUDIO}})),a=null==t?void 0:t[0];(null==a?void 0:a.ok)?(a.value.onDidDone(()=>{let e=a.value.getModel();i(null==e?void 0:e.assetId)}),a.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this.error)}),a.value.onPrepareFailure(e=>{this._onError.fire(null!=e?e:this.error)}),a.value.onTranscodeFailure(e=>{this._onError.fire(null!=e?e:this.error)})):this._onError.fire((0,o.wf)(-1,"extractor fail"))}else{let t=await (null===(s=this._extraAudioAndUploadNoSignManager)||void 0===s?void 0:s.extractAudioAndUpload({files:[e],uploadReportParams:{action_type:D.jm.VOICE_EFFECT,material_source:D.O9.EXTRA_AUDIO}})),r=null==t?void 0:t[0];(null==r?void 0:r.ok)?(r.value.onDidTranscode(()=>{i(r.value.getModel().vid)}),r.value.onUploadFailure(()=>{this._onError.fire(this.error)}),r.value.onPrepareFailure(e=>{this._onError.fire(null!=e?e:this.error)}),r.value.onTranscodeFailure(e=>{this._onError.fire(null!=e?e:this.error)})):this._onError.fire((0,o.wf)(-1,"extractor fail"))}})}async _startJob(){let e;if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let t=this._smartToolsService.makeBuilder(),r="";e=(0,x.R5)(this._segment,this._accountService.hasLogin);let i=U(this._segment,this._material);i.type===w.cVg.MetaTypeVideoOriginalSound?(r=await (0,x.hi)(U(this._segment,this._material).path,this._draftPathStore,this._resourceService),e=this._accountService.hasLogin?p.hn.EverPhoto:p.hn.VideoArch):r=i.type===w.cVg.MetaTypeVideo?await (0,x.hi)(U(this._segment,this._material).path,this._draftPathStore,this._resourceService):await (0,x.EZ)(U(this._segment,this._material).path,this._draftPathStore,this._resourceService),!r&&this._onError.fire(this._error);let a=(0,V.lr)(T._A.VoiceChange),n=(0,w.hey)(this._segment);t.createVcTask(r,e,this._voice,n?f.vG.Video:f.vG.Audio,a),this._job=t.build(),this._job.onCancel(()=>{this._onCancel.fire()}),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this.progress=e,this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,c.Y2)(1===e.length),this._onProgress.fire(100),this._downloadAndAddResourceService(e[0])})}async _downloadAndAddResourceService(e){var t,r,i,a,n,o,s,d,u;let h;let g=[{md5:null!==(n=null===(t=e.cloudData)||void 0===t?void 0:t.md5)&&void 0!==n?n:"",vid:null!==(o=null===(r=e.onlineData)||void 0===r?void 0:r.vid)&&void 0!==o?o:"",url:null!==(s=null===(i=e.onlineData)||void 0===i?void 0:i.url)&&void 0!==s?s:"",key:null!==(d=null===(a=e.onlineData)||void 0===a?void 0:a.key)&&void 0!==d?d:"",resourceId:null!==(u=e.taskId)&&void 0!==u?u:""}].filter(e=>""!==e.md5||""!==e.vid),_=await this._containerService.invokeFunction(I.CH,{list:g},{resourceType:l.uG.VC,isGameplay:!0});if(!_.ok)return _;let p=_.value.map(e=>`${m.CM}${e.getModel().key}`);h=this._speech?this._containerService.invokeFunction(I.r2,_.value,this._draftPathStore,p):this._containerService.invokeFunction(I.Jy,_.value,this._draftPathStore,p),(0,c.Y2)(h.length>=1);let f={url:"",key:""};if(e.cloudData){let e=await (0,I.gF)(this._resourceService,h[0].id);f.url=e.url,f.key=e.key}else e.onlineData&&(f.url=e.onlineData.url,f.key=e.onlineData.key);this._product={path:h[0].path,...f};let v=await this._containerService.invokeFunction(C.P$,this._renderManager,this._product,_.value);if(!v.ok){this._error=v,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}constructor(e,t,r,i,n,c,l,d,u,h,g,_,p,f){super(),this._segment=e,this._voice=t,this._material=r,this._renderManager=i,this._draftPathStore=n,this._speech=c,this._accountService=l,this._smartToolsService=d,this._audioVoiceDataService=u,this._containerService=h,this._resourceService=g,this._mainEditorWidgetService=_,this._mainDraftService=p,this._resourceDownloadService=f,this.progress=0,this._extractAudioAndUploadMaterialManager=null,this._veExtractAudioAndUploadMaterialManager=null,this._extraAudioAndUploadNoSignManager=null,this._veExtraAudioAndUploadNoSignManager=null,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellation=new s.A,this._error=(0,o.wf)(-1,"voice effect failed!"),this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event;let m=this._containerService.createInstance(R.o);this._extractAudioAndUploadMaterialManager=this._containerService.createInstance(F.Z,{onCreated:()=>{},payinPayoutHelper:m,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._veExtractAudioAndUploadMaterialManager=this._containerService.createInstance(O.C,{onCreated:()=>{},payinPayoutHelper:m,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._extraAudioAndUploadNoSignManager=this._containerService.createInstance(A.d,{onCreated:e=>{let{}=e},payinPayoutHelper:m,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._veExtraAudioAndUploadNoSignManager=this._containerService.createInstance(j.D,{onCreated:()=>{},payinPayoutHelper:m,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._key=B.generateKey(this._segment,this._voice,this._material),this._startJob()}}B=(0,i.gn)([(0,i.fM)(6,M.D),(0,i.fM)(7,h.dM),(0,i.fM)(8,v.m),(0,i.fM)(9,y.t),(0,i.fM)(10,S.c),(0,i.fM)(11,d.a),(0,i.fM)(12,u.n),(0,i.fM)(13,b.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object,"undefined"==typeof IAudioVoice?Object:IAudioVoice,Object,void 0===E.zo?Object:E.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,Boolean,void 0===M.D?Object:M.D,void 0===h.dM?Object:h.dM,void 0===v.m?Object:v.m,void 0===y.t?Object:y.t,void 0===S.c?Object:S.c,void 0===d.a?Object:d.a,void 0===u.n?Object:u.n,void 0===b.tx?Object:b.tx])],B)},836392:function(e,t,r){"use strict";r.d(t,{y:function(){return y}});var i=r(789786),a=r(587892),n=r(402655),o=r(690613),s=r(208041),c=r(800788),l=r(129219),d=r(65458),u=r(230689),h=r(433140),g=r(168550),_=r(200247),p=r(263958),f=r(503914),m=r(638336),v=r(732564);class y extends n.JT{get source(){return l.Sc.Reverse}get product(){return(0,c.Y2)(this._product.json),this._product}get status(){return this._cancellation.token.isCancellationRequested?l.xR.Cancelled:this._job?(0,f.s)(this._job.status):l.xR.Running}get error(){return this._error}async _startJob(){var e,t;let r,i;if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let a=this._smartToolsService.makeBuilder();this._segment.reverse||(null===(t=this._segment.material)||void 0===t?void 0:null===(e=t.videoAlgorithm)||void 0===e?void 0:e.path)?(r=await (0,m.OJ)(this._segment,this._draftPathStore,this._resourceService),i=(0,m._Y)(this._accountService.hasLogin)):(r=await (0,m.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService,!0),i=(0,m.R5)(this._segment,this._accountService.hasLogin)),a.createVideoTrackingTask(r,i,this._trackingArea),this._job=a.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{this._downloadAndAddResourceService(e)})}async _downloadAndAddResourceService(e){for(let t of e){let e=await this._handleVideoTrackingTaskValue(t);if(!e.ok){this._error=e,this._onError.fire(this._error);return}}this._onSuccess.fire(this._product)}async _handleVideoTrackingTaskValue(e){var t;return(null===(t=e.onlineData)||void 0===t?void 0:t.url)&&await new Promise(t=>{var r,i,a,n;let s=this._downloadService.download({key:"videoTracking",url:null!==(a=null===(r=e.onlineData)||void 0===r?void 0:r.url)&&void 0!==a?a:"",uniqueId:null!==(n=null===(i=e.onlineData)||void 0===i?void 0:i.url)&&void 0!==n?n:"",decryptHash:""},{databaseFirst:!1});s.onSuccess(()=>{try{var e;let r=new TextDecoder;this._product.json=r.decode(null===(e=s.value)||void 0===e?void 0:e.buffer),t((0,o.ly)())}catch(e){}}),s.onFail(()=>{t((0,o.wf)(-1,"download error."))})}),(0,o.oW)(e)}constructor(e,t,r,i,n,c,l,d,u){super(),this._segment=e,this._trackingArea=t,this._renderManager=r,this._draftPathStore=i,this._accountService=n,this._smartToolsService=c,this._containerService=l,this._resourceService=d,this._downloadService=u,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellation=new s.A,this._product={},this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new p.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}y=(0,i.gn)([(0,i.fM)(4,_.D),(0,i.fM)(5,d.dM),(0,i.fM)(6,u.t),(0,i.fM)(7,h.c),(0,i.fM)(8,g.tx),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof VideoTrackingServiceParams?Object:VideoTrackingServiceParams,void 0===v.zo?Object:v.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===_.D?Object:_.D,void 0===d.dM?Object:d.dM,void 0===u.t?Object:u.t,void 0===h.c?Object:h.c,void 0===g.tx?Object:g.tx])],y)},105395:function(e,t,r){"use strict";r.d(t,{F4:function(){return M},Nv:function(){return m},P$:function(){return v},RG:function(){return b},U3:function(){return S},V7:function(){return k},rn:function(){return y}});var i=r(690613),a=r(800788),n=r(426336),o=r(627084),s=r(433140),c=r(315201),l=r(200247),d=r(127830),u=r(787347),h=r(234075),g=r.n(h),_=r(896413);function p(e,t,r,i,a){(0,u.M9)(e,{uniquePath:r,url:i,decryptKey:a},{headers:{"x-everphoto-global-session-token":t.token,"x-everphoto-token":t.token}})}function f(e,t,r,i){(0,u.M9)(e,{uniquePath:t,url:r,decryptKey:i})}async function m(e,t,r){if(e.get(l.D).hasLogin){let i=e.get(o.o),a=await i.getEvercloudToken();if(!a.ok)return a;p(t,a.value,r.path,r.url,r.key),r.edgeProductPath&&p(t,a.value,r.edgeProductPath,r.edgeProductUrl,r.edgeProductKey)}else f(t,r.path,r.url,r.key),r.edgeProductPath&&f(t,r.edgeProductPath,r.edgeProductUrl,r.edgeProductKey);return(0,i.ly)()}async function v(e,t,r,o,l){let u=e.get(_.a),h=e.get(s.c),p=o[0].getModel(),f=h.get(p.key,d._g.UserFile);(0,a.Y2)((0,c.R)(f.value));let m=f.getUserFileResourceToken(),v=n.P4R.ensureRootPath(g().join("/editor",r.path));return await u.ensureManager.warmupFileResource(null!=l?l:r.key,m,r.path,v,r.key),(0,i.ly)()}async function y(e,t,r){if(e.get(l.D).hasLogin){let i=e.get(o.o),a=await i.getEvercloudToken();if(!a.ok)return a;p(t,a.value,r.path,r.url,r.key),r.matting&&p(t,a.value,r.matting.path,r.matting.url,r.matting.key),r.mattingEdge&&p(t,a.value,r.mattingEdge.path,r.mattingEdge.url,r.mattingEdge.key)}else f(t,r.path,r.url,r.key),r.matting&&f(t,r.matting.path,r.matting.url,r.matting.key),r.mattingEdge&&f(t,r.mattingEdge.path,r.mattingEdge.url,r.mattingEdge.key);return(0,i.ly)()}async function S(e,t,r){if(e.get(l.D).hasLogin){let i=e.get(o.o),a=await i.getEvercloudToken();if(!a.ok)return a;p(t,a.value,r.path,r.url,r.key)}else f(t,r.path,r.url,r.key);return(0,i.ly)()}async function b(e,t,r){let o=e.get(_.a),l=e.get(s.c).get(t,d._g.UserPhoto);(0,a.Y2)((0,c.R)(l.value)),await l.getAllResolutionResourceTokens();let u=l.getResolutionResourceTokenByQueue(["480p","360p","540p","720p","origin"]),h=n.P4R.ensureRootPath(g().join("/editor",r));return await o.ensureManager.warmupFileResource(t,u,r,h),(0,i.ly)()}async function M(e,t,r){let o=e.get(_.a),l=e.get(s.c).get(t,d._g.UserFile);(0,a.Y2)((0,c.R)(l.value));let u=l.getContentResourceToken(),h=n.P4R.ensureRootPath(g().join("/editor",r));return await o.ensureManager.warmupFileResource(t,u,r,h),(0,i.ly)()}async function k(e,t,r){if(e.get(l.D).hasLogin){let i=e.get(o.o),a=await i.getEvercloudToken();if(!a.ok)return a;r.path&&p(t,a.value,r.path,r.url,r.key),r.matting&&p(t,a.value,r.matting.path,r.matting.url,r.matting.key),r.mattingEdge&&p(t,a.value,r.mattingEdge.path,r.mattingEdge.url,r.mattingEdge.key)}else r.path&&f(t,r.path,r.url,r.key),r.matting&&f(t,r.matting.path,r.matting.url,r.matting.key),r.mattingEdge&&f(t,r.mattingEdge.path,r.mattingEdge.url,r.mattingEdge.key);return(0,i.ly)()}},616924:function(e,t,r){"use strict";r.d(t,{X:function(){return u}});var i=r(789786),a=r(426336),n=r(800788),o=r(230689),s=r(914893),c=r(732564),l=r(260963);let d=new class e{constructor(){this.loadingMap={},this.setLoadingMap=(e,t,r)=>{if(r)this.loadingMap[e]?this.loadingMap[e].add(t):this.loadingMap[e]=new Set([t]);else{var i;null===(i=this.loadingMap[e])||void 0===i||i.delete(t)}},this.getLoading=(e,t)=>{var r,i,a;return null!==(a=null===(i=this.loadingMap)||void 0===i?void 0:null===(r=i[e])||void 0===r?void 0:r.has(t))&&void 0!==a&&a},this.resetLoadingMap=()=>{this.loadingMap={}},this.hasSegmentLoading=e=>{var t;return!!(null===(t=this.loadingMap[e])||void 0===t?void 0:t.size)},(0,l.ky)(this)}};class u{updateRenderManager(e){this._renderManager=e}setVc(e,t,r){(0,n.Y2)((0,a.Y9Q)(e)||(0,a.hey)(e)),(0,n.Y2)(""!==e.id);let i=this._cache.getVcCache(s.u.generateKey(e,t,r));if(i)return i;let o=this._containerService.createInstance(s.u,e,t,r,this._renderManager,this._draftPathStore,!1);return o.onSuccess(()=>{this._cache.setVcCache(s.u.generateKey(e,t,r),o)}),o}setVcSpeech(e,t,r){(0,n.Y2)((0,a.Y9Q)(e)||(0,a.hey)(e)),(0,n.Y2)(""!==e.id);let i=this._cache.getVcCache(`speech_${e.id}_${e.material.path}_${t.resourceId}`);if(i)return i;let o=this._containerService.createInstance(s.u,e,t,r,this._renderManager,this._draftPathStore,!0);return o.onSuccess(()=>{this._cache.setVcCache(`speech_${e.id}_${e.material.path}_${t.resourceId}`,o)}),o}constructor(e,t,r,i){this._cache=e,this._renderManager=t,this._draftPathStore=r,this._containerService=i,this.store=d}}u=(0,i.gn)([(0,i.fM)(3,o.t),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof ProductCache?Object:ProductCache,void 0===c.zo?Object:c.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===o.t?Object:o.t])],u)},248283:function(e,t,r){"use strict";r.d(t,{J:function(){return d},O:function(){return u}});var i,a=r(789786),n=r(426336),o=r(800788),s=r(230689),c=r(732564),l=r(545590);var d=((i={}).CROP="crop",i.TOOLBAR="toolbar",i);class u{updateRenderManager(e){this._renderManager=e}setVocalbeautify(e){let{segment:t,step:r,timeRange:i,material:a}=e;(0,o.Y2)((0,n.Y9Q)(t)||(0,n.hey)(t)),(0,o.Y2)(""!==t.id);let s=this._cache.getVocalBeautifyCache(l.E.generateKey(t,r,i,a));if(s)return s;let c=this._containerService.createInstance(l.E,t,r,i,a,this._renderManager,this._draftPathStore);return c.onSuccess(()=>{this._cache.setVocalBeautifyCache(l.E.generateKey(t,r,i,a),c)}),c}removeVocalBeautify(e){this._dataSdk.api.audio.removeVocalBeautify({segmentId:e.id})}constructor(e,t,r,i,a){this._cache=e,this._dataSdk=t,this._renderManager=r,this._draftPathStore=i,this._containerService=a}}u=(0,a.gn)([(0,a.fM)(4,s.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ProductCache?Object:ProductCache,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===c.zo?Object:c.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===s.t?Object:s.t])],u)},13751:function(e,t,r){"use strict";r.d(t,{V:function(){return d},p:function(){return u}});var i,a=r(789786),n=r(426336),o=r(800788),s=r(230689),c=r(732564),l=r(553637);var d=((i={}).CROP="crop",i.TOOLBAR="toolbar",i.TIMELINE="timeline",i);class u{updateRenderManager(e){this._renderManager=e}setVocalSeparation(e){let{segment:t,mode:r,timeRange:i,material:a}=e;(0,o.Y2)((0,n.Y9Q)(t)||(0,n.hey)(t)),(0,o.Y2)(""!==t.id);let s=this._cache.getVocalSeparationCache(l.b.generateKey(t,r,i,a));if(s)return s;let c=this._containerService.createInstance(l.b,t,r,i,a,this._renderManager,this._draftPathStore);return c.onSuccess(()=>{this._cache.setVocalSeparationCache(l.b.generateKey(t,r,i,a),c)}),c}removeVocalSeparation(e){this._dataSdk.api.audio.removeVocalSeparation({segmentId:e.id})}constructor(e,t,r,i,a){this._cache=e,this._dataSdk=t,this._renderManager=r,this._draftPathStore=i,this._containerService=a}}u=(0,a.gn)([(0,a.fM)(4,s.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ProductCache?Object:ProductCache,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===c.zo?Object:c.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===s.t?Object:s.t])],u)}}]);