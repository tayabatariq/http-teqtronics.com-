"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["5312"],{185628:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-sX0Bno",entryContainer:"entry-container-sX0Bno","view-box":"view-box-XMP62g",viewBox:"view-box-XMP62g",initializing:"initializing-Fl61Qz",hidden:"hidden-jhtbL1","poly-entry":"poly-entry-lzDscR",polyEntry:"poly-entry-lzDscR","scroll-container":"scroll-container-HLztsp",scrollContainer:"scroll-container-HLztsp","search-bar":"search-bar-IwjDQr",searchBar:"search-bar-IwjDQr","search-bar-new-style":"search-bar-new-style-p21H0g",searchBarNewStyle:"search-bar-new-style-p21H0g","favorite-header":"favorite-header-LfDifR",favoriteHeader:"favorite-header-LfDifR",backBtn:"backBtn-yJ_Zyj"}},387666:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"timeline-collapse":"timeline-collapse-g8UMf0",timelineCollapse:"timeline-collapse-g8UMf0","timeline-collapse--hidden":"timeline-collapse--hidden-iRnoWw",timelineCollapseHidden:"timeline-collapse--hidden-iRnoWw","timeline-collapse--disabled":"timeline-collapse--disabled-WjfELM",timelineCollapseDisabled:"timeline-collapse--disabled-WjfELM","timeline-collapse-container":"timeline-collapse-container-y3glkW",timelineCollapseContainer:"timeline-collapse-container-y3glkW","timeline-collapse-playground":"timeline-collapse-playground-QntIWt",timelineCollapsePlayground:"timeline-collapse-playground-QntIWt","timeline-collapse-play-bar":"timeline-collapse-play-bar-jtBrU6",timelineCollapsePlayBar:"timeline-collapse-play-bar-jtBrU6","timeline-collapse-play-bar-arrow":"timeline-collapse-play-bar-arrow-_oUorp",timelineCollapsePlayBarArrow:"timeline-collapse-play-bar-arrow-_oUorp","timeline-collapse-play-axis":"timeline-collapse-play-axis-BQP8dC",timelineCollapsePlayAxis:"timeline-collapse-play-axis-BQP8dC","timeline-collapse--slots":"timeline-collapse--slots-r0s7OE",timelineCollapseSlots:"timeline-collapse--slots-r0s7OE"}},166107:function(e,t,i){i.d(t,{Z:function(){return r}});let r={banner:"banner-j9xsAf","banner-icon":"banner-icon-VRg1Ew",bannerIcon:"banner-icon-VRg1Ew","banner-text":"banner-text-bbWwOX",bannerText:"banner-text-bbWwOX"}},944396:function(e,t,i){i.d(t,{Z:function(){return r}});let r={container:"container-MF2IvN",active:"active-DS_NpA",top:"top-L_wgcT"}},367253:function(){},603190:function(){},47043:function(){},387210:function(){},690988:function(){},491715:function(){},210113:function(){},478889:function(e,t,i){i.d(t,{Z:function(){return r}});let r={noiseReductionTitleWrap:"noiseReductionTitleWrap-cjGJzO",title:"title-k_HSTp",titleVip:"titleVip-vP5YIy",noiseReductionSwitch:"noiseReductionSwitch-v7zjiI",noiseReductionBlock:"noiseReductionBlock-E7T3tD"}},881308:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"cover-graphic-editor-mask":"cover-graphic-editor-mask-jxytpw",coverGraphicEditorMask:"cover-graphic-editor-mask-jxytpw",active:"active-GNPgZL","loading-mask":"loading-mask-NIqpRY",loadingMask:"loading-mask-NIqpRY","loading-tips":"loading-tips-SCwYoK",loadingTips:"loading-tips-SCwYoK",tips:"tips-sAW39z","cover-graphic-editor-container":"cover-graphic-editor-container-C4kFac",coverGraphicEditorContainer:"cover-graphic-editor-container-C4kFac"}},359281:function(e){e.exports="data:image/webp;base64,UklGRgwEAABXRUJQVlA4WAoAAAAQAAAAZgAAMQAAQUxQSHsAAAABcFzbttLc6KNJh6K0h2g9OB3k/yk+e3eciJgAbJ3kW9tJY1u/I8FxOE6aD/7etZy0z6+bctI/BxBODD1IT2F0oolj+CXxaknUhoSZ/hA0JH41iepN4hGRCO4dhUEQUHAB5ARSALjm6mXXDeD1qnUujiV8V1YlU70CwRYAVlA4IGoDAABQEQCdASpnADIAPp1AnEsuJyioqlVbWLATiWMAxyheSXYII/dP7483iA0lMy7yAfUnAGGH1m5NZAEPpvDaJZj1tD4Et7mhH8F7gM+LPgC6u6lemIljoD3xzesTKiVKfPszXeBMRkrAv67ln2MOEq4j8+wA34AT28MSdeWfhE8eIhxIGiJqNXXGXOHd8wIo7nfmuiAA/vYARZSJcL2p05H+XhDW/Dmr5Ri6nC104AIqc1O4XDW7PcFdURBZ8Y+xJ8eUP9x5lTsQu/BBcBa4nsPGARN6J/VCyij9iZWllPWN8t+5SbKWrr8Y7WsT7sOH5oABXIA1yjZiYDCFBiZDj/NMwFklKHnO0sJCV40yx9hFgsjudsrrn+28zix1UCDZJP6Ucvv65Kwb/+RSEjTh4vAJVJPD1BsL8x5ztGekWFdhcveVzi/076B13ScZ4yYfVVVEhZnAWXdM3kSSD+3byJPO24Sbk+rXtfUedHFQHAyCldvqw53F1uA3GRGygCC+86F3c6LeVt+j6NWs5mwfcgu3RekB/H14N2syFRzgeMNEI6WbeNOvixeE+knAc9TPd4pIus+F+BnMID1nZZEKrywGJWoKd5dDLvefOt0qQlkethDbqKbW3kD+X5F0/ogTqnAUwr8b7Gr95RFgiG45wb1MG/qgJttnAx5tIjGn6VtMiCpSe9WN9nhlA8rsQXm3UgGDkhtkkkPtv5mUEbl+/6j0e6nGaeznLN9nFSQQevWXyNXEZXZ4vmbXqKci+wNopfQK+pn838xf7Ft9GCI4gfqde0c/Mmhj0T5dHA2Q9gZBnpeeAUqCF5O08HWQ5P/EKfyOhFsNqmCmurGZTavnOYhBBZjbLYyuhCGufmci5zuAsbqQxu0PH9qKqmJXZRbiRaA69dfs/D8CzVi1HqQgyyxd95d/0+b0W1iL17aoBbxQEUKAPYpMtIutEodX2+MjmTWDmP2Uzal3SqkJ9OaItReqM6Qt7Mfrc8KYKx/ZNoDcOckdIuuun7+nZPhmKFfG6SrQawJB7Ob4K+cl1Rp6tAzHB0FK8dUoH8nGNZ0VaFMsO7tnrQCM5OVcR3vvP+wAyl0jwWhQIyAznaBHm/v3wFheCe3piK6Iri1BUj9AmGLelWuLa0Ytm3WPV/a0f1N/wZn/qif6m/3AAAAA"},374704:function(e,t,i){i.d(t,{j:function(){return s}});var r=i(979512),a=i(218571);function n(e){let t=(0,a.useRef)(e);return t.current=e,t}let o=e=>{let t=n(e);(0,a.useEffect)(()=>()=>{t.current()},[])};function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=n(e),s=(0,a.useMemo)(()=>(0,r.N)(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return i.current(...t)},t),[]);return o(()=>{s.cancel()}),{run:s,cancel:s.cancel,flush:s.flush}}},872813:function(e,t,i){i.d(t,{x:function(){return u}});var r=i(789786),a=i(28791),n=i(230689),o=i(374904),s=i(201225),l=i(347477),d=i(507967),c=i(21961);class u{get accepts(){return this.getAcceptsByType(this.acceptTypes)}get acceptTypes(){return this._options.acceptTypes}getAcceptsByType(e){var t;return null!==(t=null==e?void 0:e.reduce((e,t)=>`${e?",":""}${e}${o.NF[t].accept},`,""))&&void 0!==t?t:"*/*"}async selectToUpload(e){let t=await (0,l.IL)(e.acceptTypes?this.getAcceptsByType(e.acceptTypes):this.accepts,e.multiple);if(!!(null==t?void 0:t.length))this.upload({...e,files:t})}async upload(e){var t,i;let r=await (0,s.T)({...e,checkUploadLimit:this._options.checkUploadLimit,containerService:this._containerService,fastImportAnalyzeHelper:this._options.fastImportHelper,captureCoverAndThumbHelper:this._captureCoverAndThumbHelper,payinPayoutHelper:this._options.payinPayoutHelper,autoUpload:e.autoUpload,acceptTypes:["video","audio","image","file"],acceptTypesErrorTipDisabled:this._options.acceptTypesErrorTipDisabled});return null===(t=(i=this._options).onBeforeCreated)||void 0===t||t.call(i,{tasks:r,files:e.files}),r.forEach(t=>{var i,r;if(!!t.ok)null===(i=(r=this._options).onCreated)||void 0===i||i.call(r,{directoryNodeType:c.t.File,material:t.value,...e})}),r}constructor(e,t,i){var r;this._options=e,this._loggerService=t,this._containerService=i,this._captureCoverAndThumbHelper=null!==(r=this._options.captureCoverAndThumbHelper)&&void 0!==r?r:this._containerService.createInstance(d.i)}}u=(0,r.gn)([(0,r.fM)(1,a.yR),(0,r.fM)(2,n.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IUploadMaterialFromLocalParams?Object:IUploadMaterialFromLocalParams,void 0===a.yR?Object:a.yR,void 0===n.t?Object:n.t])],u)},655521:function(e,t,i){i.d(t,{G:function(){return h}});var r=i(789786),a=i(999268),n=i(587892),o=i(641276),s=i(402655),l=i(800788),d=i(396190),c=i(200247),u=i(136877);class h extends s.JT{get dirty(){return this._dirty}setMeta(e){(0,l.Y2)(this._sharedMutex.tryLock(),"meta manager should setMeta only once."),this._meta=e,this._initMetaHook(),this._dirty=!0,this._onDidChangeMeta.fire()}getMeta(){return this._dirty&&this._updateMeta(),this._meta}_consumeDirtySignal(){this._dirty=!1}_recordDirtyAndNotify(){this._dirty=!0,this._onDidChangeMeta.fire()}_makeSource(){return{owner:this._accountService.userProfile.uid,platform:u.fz.Browser,systemVersion:window.navigator.userAgent,appVersion:this._environmentService.appVersion,createTime:Date.now(),commitId:this.uuid}}constructor(e,t,i){var r;super(),this._accountService=t,this._environmentService=i,this._onDidChangeMeta=new n.Q,this._sharedMutex=new a.L,this._meta={uploadSource:this._makeSource(),createSource:this._makeSource(),draft:{id:"",type:0,duration:0,updateTime:0,size:0,version:"",platformSupport:"browser",isMainTrackEmpty:!1,isScriptTemplate:!1,isBusiness:!1,itemType:0,renderIndexTrackMode:!1,createScenario:null!==(r=new URL(window.location.href).searchParams.get("scenario"))&&void 0!==r?r:"",transferedFrom:0}},this._dirty=!0,this.onDidChangeMeta=this._onDidChangeMeta.event,this._register(e.draftChangeEvent(()=>{this._dirty=!0})),!this._accountService.hasLogin&&(0,o.V)(this._accountService.onDidLogin)(()=>{this._dirty=!0})}}h=(0,r.gn)([(0,r.fM)(1,c.D),(0,r.fM)(2,d.Y),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object,void 0===c.D?Object:c.D,void 0===d.Y?Object:d.Y])],h)},136877:function(e,t,i){i.d(t,{ZZ:function(){return h},eP:function(){return d},fz:function(){return l},hB:function(){return u},t5:function(){return c}});var r,a,n,o,s,l=((r={}).Android="android",r.Ios="ios",r.Browser="browser",r.Mac="mac",r.Windows="windows",r);var d=((a={}).TemplatelistSearch="templatelist_search",a.TemplatelistCategory="templatelist_category",a.TemplatelistSimilar="templatelist_similar",a.TemplatelistSearchNoResult="templatelist_search_no_result",a.EditorSimilar="editor_similar",a.EditorSearch="editor_search",a.EditorRecommended="editor_recommended",a);var c=((n={}).EmptyCutsame="empty_cutsame",n.DreaminaStory="dreamina_story",n.AiCreator="storyboard",n);var u=((o={})[o.VideoCut=0]="VideoCut",o[o.VideoTemplate=1]="VideoTemplate",o[o.Script=3]="Script",o[o.SmartTool=4]="SmartTool",o[o.Graphic=5]="Graphic",o[o.DreaminaAIEditor=6]="DreaminaAIEditor",o[o.CC4BDigitalHumanEditor=7]="CC4BDigitalHumanEditor",o);var h=((s={})[s.default=0]="default",s[s.remove_background=5]="remove_background",s[s.resize_video=6]="resize_video",s[s.ad_script=7]="ad_script",s[s.text_to_image=8]="text_to_image",s[s.image_to_image=9]="image_to_image",s[s.portrait_generator=10]="portrait_generator",s[s.image_style_transfer=11]="image_style_transfer",s[s.video_style_transfer=12]="video_style_transfer",s[s.image_upscaler=13]="image_upscaler",s[s.ai_color_correction=14]="ai_color_correction",s[s.photo_colorizer=15]="photo_colorizer",s[s.old_photo_restoration=16]="old_photo_restoration",s[s.low_light_image_enhancement=17]="low_light_image_enhancement",s[s.video_upscaler=18]="video_upscaler",s[s.super_slow_motion=19]="super_slow_motion",s[s.video_stabilization=20]="video_stabilization",s[s.chatgpt=21]="chatgpt",s[s.autocut=22]="autocut",s[s.text_to_video=23]="text_to_video",s[s.url_to_video=24]="url_to_video",s[s.template=25]="template",s[s.chatgpt_search=26]="chatgpt_search",s[s.long_to_short=27]="long_to_short",s[s.ai_video=28]="ai_video",s[s.text_to_speech=29]="text_to_speech",s[s.av_translator=30]="av_translator",s[s.voice_changer=31]="voice_changer",s[s.dreamina_story=33]="dreamina_story",s[s.storyboard=38]="storyboard",s[s.festival_marketing_editor=39]="festival_marketing_editor",s[s.smart_ad_edit=40]="smart_ad_edit",s[s.smart_derivation=41]="smart_derivation",s[s.ai_character=42]="ai_character",s[s.business_script_edit=43]="business_script_edit",s[s.video_template_edit=44]="video_template_edit",s[s.smart_ad_edit_for_tts=45]="smart_ad_edit_for_tts",s[s.quick_cut=46]="quick_cut",s)},247235:function(e,t,i){i.d(t,{Z:function(){return a}});var r,a=((r={})[r.SUCCESS=0]="SUCCESS",r[r.FAIL=1]="FAIL",r[r.PREPARE=2]="PREPARE",r[r.SAVING=3]="SAVING",r[r.IDLE=4]="IDLE",r)},143953:function(e,t,i){i.d(t,{UW:function(){return o}});var r=i(690613),a=i(709037),n=i(756024);class o{async init(){let{dbSchema:{id:e,version:t,table:i}}=this.options,r=new a.z([{id:e,version:t,tables:[i]}],this.instantiationService),o=await r.database.connect(e,i.name);o.ok?(this.status="initialized",this.DBStorage=o.value,this.listenDraftQueueChange()):(this.status="failed",n.t.error("offline_data","set",null==o?void 0:o.msg,null==o?void 0:o.cause))}async syncOfflineDraft(){let e,t;if("failed"===this.status)return(0,r.wf)(1,"init_error");let i=await this.DBStorage.query(this.generateKey("committing")),a=await this.DBStorage.query(this.generateKey("waiting"));if(!i.ok||!a.ok)return this.status="failed",n.t.error("offline_data","syncOfflineDraft",i.msg||a.msg,i.cause||a.cause),(0,r.wf)(2,"get_error");try{e=i.value&&this.offlineDataToSaveTask(i.value.data),t=a.value&&this.offlineDataToSaveTask(a.value.data)}catch(e){return this.status="failed",n.t.error("offline_data syncOfflineDraft","syncOfflineDraft",null==e?void 0:e.message),(0,r.wf)(3,"parse_error")}if(!(null==e?void 0:e.length)&&!(null==t?void 0:t.length))return this.status="finished",(0,r.oW)(!1);let o=await this.applyAndSaveOfflineData(e,t);return this.status=o?"finished":"failed",o?(0,r.oW)(!0):(0,r.wf)(4,"apply_error")}listenDraftQueueChange(){this.draftSaveManager.draftSaveTaskQueue.onDraftQueueChange((e,t)=>{e?this.set("committing",[e]):this.delete("committing"),t.length?this.set("waiting",t):this.delete("waiting")})}async set(e,t){try{var i;let r=await (null===(i=this.DBStorage)||void 0===i?void 0:i.set(this.generateKey(e),{data:this.saveTaskToOfflineData(t),key:this.generateKey(e)}));!(null==r?void 0:r.ok)&&n.t.error("offline_data","set",null==r?void 0:r.msg,null==r?void 0:r.cause)}catch(e){n.t.error("offline_data","set",null==e?void 0:e.message)}}async deleteAll(){let[e,t]=await Promise.all([this.delete("committing"),this.delete("waiting")]);return e&&t}async delete(e){var t;let i=await (null===(t=this.DBStorage)||void 0===t?void 0:t.delete(this.generateKey(e)));return(null==i?!!void 0:!!i.ok)||(n.t.error("offline_data","delete",null==i?void 0:i.msg,null==i?void 0:i.cause),!1)}generateKey(e){return`${this.options.getDraftId()}_${this.options.getUid()}_${e}`}constructor(e,t,i){this.draftSaveManager=e,this.options=t,this.instantiationService=i,this.status="pending",this.draftSaveManager.onError(e=>{var t;(null===(t=e.cause)||void 0===t?void 0:t.ret)==="2006"&&this.deleteAll()})}}},207033:function(e,t,i){i.d(t,{y:function(){return h}});var r=i(690613),a=i(753637),n=i(426020),o=i(127830),s=i(667086),l=i(268977),d=i(599735),c=i(137348),u=i(339098);async function h(e){try{let t=(0,u.O)(e.containerService,e.notificationGenerator),[i]=e.containerService.invokeFunction(e=>[e.get(a.L)]),h=Promise.all(e.files.map(a=>(0,r.oW)(e.containerService.createInstance(s.k,{fromFolderId:e.fromFolderId,file:a,data:{sourceType:n.ov.PublicSpace,assetType:o.pS.Material,key:"",filename:(0,c.F)({name:a.name,format:"mp3"}),fileType:n.YB.Audio,md5:"",mime:"audio/mp3",duration:0,isAudioTranscoding:!1,size:a.size},addModelToDraft:(0,d.s)(e.containerService),fastImportAnalyzeHelper:e.fastImportAnalyzeHelper,prepareMaterialLifecycleHelper:new l.A({file:a,ffmpegAdapterService:i}),payinPayoutHelper:e.payinPayoutHelper,notificationService:t}))));return await h}catch(e){return[(0,r.wf)(-1,null==e?void 0:e.message)]}}},7703:function(e,t,i){i.d(t,{f:function(){return d}});var r=i(426020),a=i(690613),n=i(211820),o=i(575747),s=i(387133),l=i(948328);function d(e){let t=e.preloadMaterialFromEvercloud.reduce((e,t)=>(e[t.md5]=t,e),{}),i=[];for(let p of e.packageAssets){var d,c,u,h;let{md5:_,source_path:m,meta:f}=p,g=e.containerService.invokeFunction(e=>e.get(l.D));if(g.isMaterialExistByKey(_)){g.getMaterialsByMd5(_).forEach(e=>{let{id:t}=e;g.invokeFunctionWithLifeCycleById(t,e=>{i.push(e)})});continue}if(!t[_])return(0,a.wf)(-1,"not found target material");let v=(0,o.n)(t[_]);v.key=(0,s.y)(v,{sourcePath:m});let y={sourcePath:m,meta:f?JSON.parse(f):void 0};!y.meta&&!(null===(c=t[_].tags)||void 0===c?void 0:null===(d=c.includes)||void 0===d?void 0:d.call(c,7001))&&(y.meta={visible:!1}),u=v,h=y,m.startsWith("text_to_audio")&&(u.fileType=r.YB.File,h.meta||(h.meta={visible:!1})),!function(e,t,i){if(["attachment_video_algorithm.json"].includes(i)){var r;!(null===(r=t.meta)||void 0===r?void 0:r.id)&&(t.meta={visible:!1,id:"Algorithm"})};}(v,y,m),i.push((0,n.Q)(v,{fromWorkspaceId:e.workspaceId,toWorkspaceId:e.workspaceId,payinPayoutHelper:e.payinPayoutHelper,packageDelta:y,containerService:e.containerService}))}return(0,a.oW)(i)}},828403:function(e,t,i){i.d(t,{n:()=>v});var r=i("789786"),a=i("273238"),n=i("173888"),o=i("426020"),s=i("317550"),l=i("230689"),d=i("986824"),c=i("690613"),u=i("800788"),h=i("940882"),p=i("495141");class _ extends d.I{get md5(){return this._data.md5}getModel(){return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidDone:this.onDidDone,onDidRemove:this.onDidRemove,status:this.status}}canRetryPrepare(){(0,u.ss)("unSupport method")}prepare(){(0,u.ss)("unSupport method")}canRetryUpload(){return!1}upload(){(0,u.ss)("unSupport method")}canCancelUpload(){return!1}cancelUpload(){(0,u.ss)("unSupport method")}canRetryTranscode(){return!1}transcode(){(0,u.ss)("unSupport method")}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}cancelSync2UserMaterial(){this.status===n.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}sync2UserMaterial(){this._triggerSyncMaterialFromWorkspaceHelper(),(0,u.ZB)(this._syncFromWorkspaceHelper),this._syncFromWorkspaceHelper.sync2UserMaterial()}async delete(e){try{return this._hasBeenSync&&((0,u.Y2)(this._data.sourceType===o.ov.EverCloud),!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]})),await super.delete(),(0,c.ly)()}catch(e){var t;return(0,c.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}bindListenerWithLifecycle(){this._updateStatus(n.a.WaitForSync2UserMaterial),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._updateFromWorkspaceId(this.toWorkspaceId),this._updateStatus(n.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){if(!this._syncFromWorkspaceHelper||this._syncHelperType!==this._data.sourceType){if(this._syncHelperType=this._data.sourceType,this._data.sourceType===o.ov.PublicSpace){var e,t;this._syncFromWorkspaceHelper=new h.W({...this._option.syncParams,resourceId:this._data.vid,realResourceId:null===(t=this._option)||void 0===t?void 0:null===(e=t.syncParams)||void 0===e?void 0:e.resourceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,syncDataService:this._syncDataService,handler:{model:()=>this.getModel(),status:()=>this.status,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}})}else this._syncFromWorkspaceHelper=this._containerService.createInstance(p.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._notificationService})}}_partialUpdateModel(e){let{key:t,...i}=e;Object.assign(this._data,i)}constructor(e,t,i,r){super({fromWorkspaceId:void 0,toWorkspaceId:void 0,addModelToDraft:e.addModelToDraft,fromFolderId:void 0,toFolderId:void 0,notificationService:e.notificationService}),this._option=e,this._syncDataService=t,this._containerService=i,this._userMaterialsService=r,this._hasBeenSync=!1,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let a=this._option;this._data=a.data,this.bindListenerWithLifecycle()}}_=(0,r.gn)([(0,r.fM)(1,s._),(0,r.fM)(2,l.t),(0,r.fM)(3,a.b),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IPublicSpaceFileMaterialLifecycle?Object:IPublicSpaceFileMaterialLifecycle,void 0===s._?Object:s._,void 0===l.t?Object:l.t,void 0===a.b?Object:a.b])],_);var m=i("127830"),f=i("599735"),g=i("339098");function v(e,t){let i=(0,g.O)(t.containerService,t.notificationGenerator);return e.map(e=>t.containerService.createInstance(_,{data:{assetType:m.pS.Material,key:e.vid,vid:e.vid,sourceType:o.ov.PublicSpace,fileType:o.YB.File,url:e.url,decryptKey:e.key,filename:"",draftDelta:{sourcePath:e.vid,meta:{visible:!1}}},addModelToDraft:(0,f.s)(t.containerService),syncParams:{resourceId:e.resourceId,...t.syncParams},notificationService:i}))}},16526:function(e,t,i){i.d(t,{J:function(){return p}});var r=i(273238),a=i(136255),n=i.n(a),o=i(463263),s=i(353170),l=i(374904),d=i(426020),c=i(127830),u=i(599735),h=i(339098);function p(e){let t=e.containerService.invokeFunction(e=>e.get(r.b)),i=(0,h.O)(e.containerService,e.notificationGenerator);return e.tasks.map(r=>{let a=n().getType(r.name);return e.containerService.createInstance(o.p,{fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,data:{sourceType:d.ov.EverCloud,assetType:c.pS.Material,key:"",filename:r.name,fileType:a?(0,l.Gt)(a):(0,l.eF)({file:{name:r.name,fileType:""}}),owner:"",md5:"",mime:null!=a?a:"",size:r.size,createdAt:Date.now().valueOf(),updatedAt:Date.now().valueOf(),cover:{url:r.coverUrl}},payinPayoutHelper:e.payinPayoutHelper,autoUpload:e.autoUpload,addModelToDraft:(0,u.s)(e.containerService),uploadMaterialLifecycleHelper:new s.$({taskId:r.id,fromWorkspaceId:e.fromWorkspaceId,thirdpartyUploader:e.thirdpartyUploader,userMaterialService:t,payinPayoutHelper:e.payinPayoutHelper,notificationService:i}),notificationService:i})})}},507967:function(e,t,i){i.d(t,{i:function(){return c}});var r=i(789786),a=i(827322),n=i(690613),o=i(800788),s=i(210360),l=i(229106),d=i(426020);class c{async getCover(e){let{fileType:t,blobUrl:i}=e;if(![d.YB.Video,d.YB.Image].includes(t))return(0,n.wf)(-1,"only support type");switch(t){case d.YB.Video:{let e=await this._getVideoSize(i);if(!e.ok)return e;let t=this._sizeFormat(e.value),r=await this._videoCaptureService.createCapturer(i,t);if(!r.ok)return r;let a=await r.value.captureSingleFrame(1,s.l.ArrayBuffer);return(0,n.oW)({url:URL.createObjectURL(new Blob([a.data]))})}case d.YB.Image:return await new Promise(e=>{let t=new Image;t.src=(0,a.C)(i,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),t.onload=()=>{e((0,n.oW)({url:i}))},t.onerror=t=>{e((0,n.wf)(-1,"img not loaded"))}});case d.YB.Audio:case d.YB.File:(0,o.ss)(`CaptureCoverAndThumbHelper::getCover ${t}`);default:(0,o.bP)(t)}}async getThumb(e){let{blobUrl:t}=e;if(e.fileType!==d.YB.Video)return(0,n.wf)(-1,"only support for video");let i=this._getSpriteInterval(1e3*e.duration),r=this._sizeFormat(e.size),a=await this._videoCaptureService.createCapturer(t,r);if(!a.ok)return a;let o=a.value.captureByInterval(i,s.l.ArrayBuffer),c=(await (0,l.uC)(o)).map(e=>({frameCount:1,imageWidth:r.width,imageHeight:r.height,url:URL.createObjectURL(new Blob([e.data]))}));return(0,n.oW)({common:{singleFrameWidth:r.width,singleFrameHeight:r.height,totalSetNum:c.length},details:c})}_getVideoSize(e){return new Promise(t=>{let i=document.createElement("video"),r=()=>{i.remove(),i=null};i.src=(0,a.C)(e,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),i.onloadedmetadata=()=>{let{videoWidth:e,videoHeight:a}=i;t((0,n.oW)({width:e,height:a})),r()},i.onerror=()=>{r(),t((0,n.wf)(-1,"load error"))}})}_sizeFormat(e){let t=e.width,i=e.height;if(e.height>100){let r=100/e.height;t=e.width*r,i=100}return{width:Math.round(t),height:Math.round(i)}}_getSpriteInterval(e){let t;return t=e>=72e6?e/36e5:e>=36e6?2e4:e>=18e6?1e4:e>=36e5?5e3:e>=18e5?3e3:e>=6e5?2e3:e>=6e4?1e3:e>=1e4?500:e>=5e3?125:100}constructor(e){this._videoCaptureService=e}}c=(0,r.gn)([(0,r.fM)(0,s.T),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===s.T?Object:s.T])],c)},169790:function(e,t,i){i.d(t,{n:function(){return v}});var r=i(789786),a=i(745299),n=i(273238),o=i(225698),s=i(173888),l=i(426020),d=i(230689),c=i(986824),u=i(641276),h=i(690613),p=i(800788),_=i(196392),m=i(483197),f=i(495141),g=i(85539);class v extends c.I{get md5(){return this._data.md5}getModel(){var e,t,i,r;return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidRemove:this.onDidRemove,onDidDone:this.onDidDone,status:this.status,uploading:null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.uploading,transcoding:null===(t=this._transcodeMaterialHelper)||void 0===t?void 0:t.transcoding,preparing:null===(i=this._prepareMaterialLifecycleHelper)||void 0===i?void 0:i.preparing,syncingUserMaterial:null===(r=this._syncFromWorkspaceHelper)||void 0===r?void 0:r.syncingUserMaterial}}canRetryPrepare(){(0,p.ss)("VeExtractAudioAndUploadToPublicSpaceLifecycle::canRetryPrepare")}prepare(){(0,p.ss)("VeExtractAudioAndUploadToPublicSpaceLifecycle::prepare")}canRetryUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canRetryUpload())&&void 0!==t&&t}upload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.upload()}canCancelUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canCancelUpload())&&void 0!==t&&t}cancelUpload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.cancelUpload(),super.cancelUpload()}canRetryTranscode(){var e,t;return null!==(t=null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.canRetryTranscode())&&void 0!==t&&t}transcode(){return(0,p.Y2)(this._transcodeMaterialHelper,"helper not found"),this._transcodeMaterialHelper.transcode()}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}cancelSync2UserMaterial(){this.status===s.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}sync2UserMaterial(){this._triggerSyncMaterialFromWorkspaceHelper(),(0,p.ZB)(this._syncFromWorkspaceHelper),this._syncFromWorkspaceHelper.sync2UserMaterial()}async delete(e){var t,i;try{return this._hasBeenSync?((0,p.Y2)(this._data.sourceType===l.ov.EverCloud),!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]})):[s.a.Uploading,s.a.UploadFailure,s.a.WaitingUpload].includes(this.status)&&(null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.cancelUpload()),await super.delete(),(0,h.ly)()}catch(e){return(0,h.wf)(-1,null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"unexpected error")}}get _needPrepare(){return!!this._prepareMaterialLifecycleHelper}bindListenerWithLifecycle(){this._needPrepare&&(0,u.V)(this.onDidPrepare)(()=>{Promise.resolve().then(()=>{var e,t,i,r;if(this.hasBeenRemoved)return;let a=null===(e=this._prepareMaterialLifecycleHelper)||void 0===e?void 0:e.result;(0,p.ZB)(null==a?void 0:a.buffer);let n=new File([new Blob([null==a?void 0:a.buffer],{type:"audio/m4a"})],null!==(r=null==a?void 0:a.fileName)&&void 0!==r?r:"undefined.m4a",{type:"audio/m4a"});this._uploadMaterialLifecycleHelper=new g.I({file:n,publicSpaceUploadService:this._publicSpaceUploadService,userMaterialService:this._userMaterialsService,fastImportAnalyzeHelper:this._option.fastImportAnalyzeHelper,fileCalcMd5Service:this._lazyFileMd5CalcService,notificationService:this._notificationService}),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.bootstrap({handler:{model:()=>this.getModel(),status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},updateStatus:this._updateStatus.bind(this),updateModel:e=>{this._partialUpdateModel(e)}},events:{onSuccess:this.onDidUpload,onError:this.onUploadFailure}}),this._updateStatus(s.a.WaitingUpload),null===(i=this._uploadMaterialLifecycleHelper)||void 0===i||i.upload()})}),(0,u.V)(this.onDidUpload)(()=>{Promise.resolve().then(()=>{var e,t;if(!this.hasBeenRemoved)null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.dispose(),(0,p.Y2)(this._data.sourceType===l.ov.PublicSpace,"current material is not from publicSpace"),this._transcodeMaterialHelper=new _.L({taskId:this._data.publicSpaceId,fileType:this._data.fileType,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}),this._updateStatus(s.a.Transcoding),null===(t=this._transcodeMaterialHelper)||void 0===t||t.listenTranscodeResult()})}),(0,u.V)(this.onDidTranscode)(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved){if(this.toWorkspaceId){this.sync2UserMaterial();return}this._updateStatus(s.a.WaitForSync2UserMaterial)}})}),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._hasBeenSync=!0,this._updateFromWorkspaceId(this.toWorkspaceId),this._updateStatus(s.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){(!this._syncFromWorkspaceHelper||this._syncHelperType!==this._data.sourceType)&&(this._syncHelperType=this._data.sourceType,this._data.sourceType===l.ov.PublicSpace?this._syncFromWorkspaceHelper=this._containerService.createInstance(m.B,{vid:this._data.vid,toFolderId:this.toFolderId,toWorkspaceId:this.toWorkspaceId,payinPayoutHelper:this._option.payinPayoutHelper,userMaterialService:this._userMaterialsService,handler:{model:()=>this.getModel(),status:()=>this.status,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e),onProgress:()=>this._onModelUpdate.fire(this.getModel())}}):this._syncFromWorkspaceHelper=this._containerService.createInstance(f.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._notificationService}))}_partialUpdateModel(e){this._data.key&&delete e.key,Object.assign(this._data,e)}constructor(e,t,i,r,a){var n;super({fromWorkspaceId:void 0,toWorkspaceId:void 0,addModelToDraft:e.addModelToDraft,fromFolderId:void 0,toFolderId:void 0,notificationService:e.notificationService}),this._option=e,this._publicSpaceUploadService=t,this._userMaterialsService=i,this._lazyFileMd5CalcService=r,this._containerService=a,this._hasBeenSync=!1,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let o=this._option;this._data=o.data,this._prepareMaterialLifecycleHelper=o.prepareMaterialLifecycleHelper,null===(n=this._prepareMaterialLifecycleHelper)||void 0===n||n.bootstrap({handler:{status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},updateStatus:this._updateStatus.bind(this)},events:{onSuccess:this.onDidPrepare,onError:this.onPrepareFailure}}),setTimeout(()=>{var e;null===(e=this._prepareMaterialLifecycleHelper)||void 0===e||e.prepare()}),this.bindListenerWithLifecycle()}}v=(0,r.gn)([(0,r.fM)(1,a.S),(0,r.fM)(2,n.b),(0,r.fM)(3,o.w),(0,r.fM)(4,d.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IVeExtractAudioAndUploadToPublicSpaceLifecycle?Object:IVeExtractAudioAndUploadToPublicSpaceLifecycle,void 0===a.S?Object:a.S,void 0===n.b?Object:n.b,void 0===o.w?Object:o.w,void 0===d.t?Object:d.t])],v)},607732:function(e,t,i){i.d(t,{J:function(){return s},m:function(){return o}});var r=i(801497),a=i(690613),n=i(800302);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0x40000000,i=arguments.length>2?arguments[2]:void 0;return e>t?(null==i||i.error(r.ZP.t("web_storage_desc_file_size_limit",{number0:(0,n.W)(t)},"This item cannot be uploaded because it is larger than the {number0} GB file size limit.")),(0,a.wf)(-1,"over size")):(0,a.ly)()}function s(e,t,i){if(e>t){var o;return null==i||null===(o=i.notificationService)||void 0===o||o.error(r.ZP.t("only_supports_materials_total_up_to_{size}",{size:(0,n.y)(t)},"You can upload materials up to {size} when not signed in. Sign in to upload more and larger materials.")),(0,a.wf)(-1,"over size")}return(0,a.ly)()}},730182:function(e,t,i){i.d(t,{X:function(){return o}});var r=i(475590),a=i(690613),n=i(565598);function o(e,t){let{userMaterialInstance:i}=t,{resolve:o,promise:s}=(0,r.PQ)(),l=async()=>{let t=await i.getAssetByFileId(e);if((0,n.o)(t.imageTranscodeInfo,{originSize:t.width&&t.height?{width:t.width,height:t.height}:void 0})){o((0,a.ly)());return}if(!t.imageAsyncResize){o((0,a.wf)(-1,"transcode failure with old data"));return}setTimeout(l,2e3)};return l(),s}},695324:function(e,t,i){i.d(t,{Z:function(){return n},b:function(){return s}});var r,a=i(195471);var n=((r={}).EditPlayerPause="edit_player_pause",r.EnterEditPage="enter_edit_page",r.ClickExportWindowOption="click_exportwindow_option",r.MoveTimeline="move_timeline",r.AddMaterialToTrack="add_material_to_track",r.MoveMaterialSegment="move_material_segment",r.CutMaterialSegment="cut_material_segment",r.DeleteMaterialSegment="delete_material_segment",r.EnterFunctionPanel="enter_function_panel",r.AuditPreviewOption="audio_preview_option",r.ClickMaterialItem="click_material_item",r.ClickFunctionCategory="click_function_category",r.ClickVideoFunctionEditControl="click_video_function_edit_control",r.ClickNewTextConfirm="click_new_text_confirm",r.ClickImport="click_import",r);class o{getEventParams(){let{relatedEvent:e,duration:t,actionType:i}=this._params;return{related_event:e,duration:t,action_type:i}}constructor(e){this._params=e,this.eventName="event_inp"}}function s(e,t){let i=performance.now();requestAnimationFrame(()=>{let r=performance.now()-i;r>200&&(0,a.K)(e,o,[Object.assign({},t,{duration:r})])})}},195471:function(e,t,i){i.d(t,{K:function(){return o},z:function(){return s}});var r=i(8462),a=i(861810),n=i(31463);function o(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0,s=e.createInstance(new a.M(t,i)),l=s.getEventParams();e.invokeFunction(e=>{e.get(n.m).reportBusinessEvent(s.eventName,l,o)}),e.invokeFunction(e=>{e.get(r.x).reportBySlardar(s.eventName,l)})}function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];arguments.length>3&&arguments[3];let r=e.createInstance(new a.M(t,i));e.invokeFunction(e=>{e.get(n.m).reportBusinessEventByServer(r.eventName,{...r.getEventParams()})})}},677406:function(e,t,i){i.d(t,{U:function(){return r},m:function(){return a}});let r="Default";class a{get namespace(){return this._options.namespace}get _handler(){return this._options.handler}getMaterials(){return[...this._materialSet].map(e=>{var t;let i=this._handler.findById(e);return i.draftDelta={...i.draftDelta,meta:{...null===(t=i.draftDelta)||void 0===t?void 0:t.meta,visible:!1,id:this.namespace===r?void 0:this.namespace}},i})}addMaterials(e){let t=[];e.forEach(e=>{if(!this._materialSet.has(e.id))this._materialSet.add(e.id),t.push(e.id),this._handler.add(e)}),this._handler.onDidAdd(t)}removeMaterials(e){let t=[];if(e.forEach(e=>{if(!!this._materialSet.has(e))this._materialSet.delete(e),t.push(this._handler.findById(e)),this._handler.remove(e)}),!!t&&0!==t.length)this._handler.onDidRemove(t)}replaceMaterial(e,t){if(!this._materialSet.has(e)||this._materialSet.has(t.id))return;let i=this._handler.findById(e);this._materialSet.delete(e),this._materialSet.add(t.id),this._handler.replace(e,t),this._handler.onDidReplace(i,t)}replaceAllMaterials(e){this.clear(),this.addMaterials(e)}clear(){this.removeMaterials([...this._materialSet])}constructor(e){this._options=e,this._materialSet=new Set}}},936243:function(e,t,i){i.d(t,{v:function(){return r}});let r=(0,i(335290).yh)("base-main-draft-service")},599883:function(e,t,i){i.d(t,{m:function(){return y}});var r=i(789786);i(784923);var a=i(498417),n=i(260963),o=i(173888),s=i(966697),l=i(127830),d=i(985759),c=i(801497),u=i(800788),h=i(948328),p=i(908503),_=i(980867),m=i(735244),f=i(865632),g=i(21961),v=i(936243);class y{fetchMoreFoldersAndMaterials(){(0,u.ss)("method no support")}retryFetchMaterials(){(0,u.ss)("method no support")}retryMaterial(e){this._draftMaterialsService.invokeFunctionWithLifeCycleById(e,e=>{(0,m.B)(e)})}backToParentFolder(){this._directoryManager.back()}removeMaterialsInCanvas(e){var t,i;let{draftEditorAdapter:r}=this._options;(null==r?void 0:null===(t=r.checkMaterialsInCanvas)||void 0===t?void 0:t.call(r,e))&&(null==r||null===(i=r.removeMaterialsInCanvas)||void 0===i||i.call(r,e))}openFolder(e){this._directoryManager.open(e.assetId)}async deleteMaterial(e,t){let{draftEditorAdapter:i}=this._options;if(e.assetType===l.pS.Material){var r;let n=null==i?void 0:null===(r=i.checkMaterialsInCanvas)||void 0===r?void 0:r.call(i,e);if(!(null==t?void 0:t.forceDelete)){let i=c.ZP.t("some_assets_have_been_added_to_the_track_and_the_assets_in_the_track_will_be_de",{},"Some materials have been added to track. If deleted, they will also be deleted from track"),r=c.ZP.t("the_selected_material_will_be_deleted_and_you_can_still_add_it_in_[my_cloud_mate",{},"Selected material will be deleted. You can still add it in Cloud Space.");await (0,d.W)({title:c.ZP.t("are_you_sure_to_delete_the_selected_material?",{},"Confirm you want to delete the selected items?"),content:this._capcutAccountService.hasLogin?n?i:r:"",okText:c.ZP.t("confirm_deletion",{},"Delete"),onBeforeOk:()=>new Promise(i=>{try{this._directoryManager.deleteFileById(e.id),!(null==t?void 0:t.forceDelete)&&a.Z.success(c.ZP.t("web_graphic_delete_successfully",{},"Delete Successfully.")),i()}catch(e){throw!(null==t?void 0:t.forceDelete)&&a.Z.error(c.ZP.t("web_graphic_delete_failed",{},"Delete Failed.")),e}}),cancelText:c.ZP.t("cancel_web",{},"Cancel")})}}else await (0,d.W)({title:c.ZP.t("are_you_sure_to_delete_the_selected_material?",{},"Confirm you want to delete the selected items?"),content:"",okText:c.ZP.t("confirm_deletion",{},"Delete"),onBeforeOk:()=>new Promise(i=>{try{this._directoryManager.deleteFolderById(e.assetId),!(null==t?void 0:t.forceDelete)&&a.Z.success(c.ZP.t("web_graphic_delete_successfully",{},"Delete Successfully.")),i()}catch(e){throw!(null==t?void 0:t.forceDelete)&&a.Z.error(c.ZP.t("web_graphic_delete_failed",{},"Delete Failed.")),e}}),cancelText:c.ZP.t("cancel_web",{},"Cancel")})}cancelUploadMaterial(e){let{draftEditorAdapter:t}=this._options;this._draftMaterialsService.invokeFunctionWithLifeCycleById(e,i=>{var r,a;(null==t?void 0:null===(r=t.checkMaterialsInCanvas)||void 0===r?void 0:r.call(t,i.getModel()))&&(null==t||null===(a=t.removeMaterialsInCanvas)||void 0===a||a.call(t,i.getModel())),this._directoryManager.deleteFileById(e)})}_bootstrap(){let e=()=>{this._directoryManager.nodesInCurrentPath.forEach(e=>{if(e.type===g.t.File){let t=e.data;this._bindLifecycleAction(t),this.observableData.materials.push((0,_.M)(t.getModel()))}else this.observableData.materials.push(e.data)})};this._directoryManager.isInitialize?(e(),this.observableData.isInitialize=this._directoryManager.isInitialize):this._directoryManager.onDidInitialized(()=>{(0,n.z)(()=>{e(),this.observableData.isInitialize=this._directoryManager.isInitialize})})}_listenWorkspaceIdChange(){let e=()=>{(0,n.z)(()=>{this._mainDraftService.draftWorkspaceManager.workspaceId&&(this.observableData.workspaceId=this._mainDraftService.draftWorkspaceManager.workspaceId)})};e(),this._mainDraftService.draftWorkspaceManager.onDidWorkspaceChange(()=>{e()})}_updateMaterialModeByModel(e){(0,n.z)(()=>{let t=this.observableData.materials.findIndex(t=>t.assetType===l.pS.Material&&t.id===e.id);-1!==t&&(this.observableData.materials[t]=(0,_.M)(e))})}_updateMaterialSequence(e){let t=this.observableData.materials.findIndex(t=>t.assetType===l.pS.Material&&t.id===e);(0,u.Y2)(-1!==t);let i=this.observableData.materials.findIndex(t=>t.assetType===l.pS.Material&&[o.a.Success].includes(t.status)&&t.id!==e);-1===i?(0,n.z)(()=>{let e=this.observableData.materials.splice(t,1)[0];this.observableData.materials.push(e)}):(0,n.z)(()=>{let e=this.observableData.materials.splice(t,1)[0];this.observableData.materials.splice(i-1,0,e)})}_deleteMaterialModel(e){(0,n.z)(()=>{let t=this.observableData.materials.findIndex(t=>t.assetType===l.pS.Material&&t.id===e||t.assetType===l.pS.Folder&&e===t.assetId);-1!==t&&this.observableData.materials.splice(t,1)})}_listenDirectoryChange(){this._directoryManager.onPathChange(()=>{this._directoryPath=this._directoryManager.currentPath,this.observableData.parentFolder=this._directoryManager.currentFolder.data,this.observableData.isRootFolder=this._directoryManager.root.path===this._directoryPath,this.observableData.materials=this._directoryManager.nodesInCurrentPath.map(e=>{if(e.type===g.t.File){let t=e.data;return this._bindLifecycleAction(t),(0,_.M)(t.getModel())}return e.data})}),this._directoryManager.onAdd((e,t)=>{(0,n.z)(()=>{e.forEach(e=>{if(!this._isNodeInCurrentFolder(e.path))if(e.type===g.t.File){let i=e.data;this._bindLifecycleAction(i),t.insertPosition===g.O.Beginning?this.observableData.materials.unshift((0,_.M)(i.getModel())):this.observableData.materials.push((0,_.M)(i.getModel()))}else t.insertPosition===g.O.Beginning?this.observableData.materials.unshift(e.data):this.observableData.materials.push(e.data)})})}),this._directoryManager.onDelete(e=>{if(e.type===g.t.File&&this.removeMaterialsInCanvas(e.data.getModel()),this._isNodeInCurrentFolder(e.path))return;let t=this.observableData.materials.findIndex(t=>t.assetType===l.pS.Material&&t.id===e.id||t.assetType===l.pS.Folder&&t.assetId===e.id);-1!==t&&this.observableData.materials.splice(t,1)})}_isNodeInCurrentFolder(e){return this._directoryPath!==this._directoryManager.extractParentPath(e)}_bindLifecycleAction(e){let t=this._directoryManager.getFileById(e.id),i=(null==t?void 0:t.path)?this._directoryManager.extractParentPath(t.path):void 0;(0,p.M)({material:e,onUpdateModel:e=>{if(i===this._directoryPath)this._updateMaterialModeByModel(e)},onDeleteLifecycle:e=>this._deleteMaterialModel(e)})}constructor(e,t,i,r,a){this._options=e,this._capcutAccountService=t,this._draftMaterialsService=i,this._mainDraftService=r,this._draftMaterialsDirectoryService=a,this._directoryManager=this._draftMaterialsDirectoryService.draftMaterialsDirectory,this._directoryPath=this._directoryManager.currentPath,this.observableData=(0,n.LO)({isInitialize:!1,isInitializedError:!1,isFetchingData:!1,isFetchFailure:!1,workspaceId:"",materials:[],parentFolder:this._directoryManager.currentFolder.data,isRootFolder:this._directoryManager.root.path===this._directoryPath}),this._bootstrap(),this._listenWorkspaceIdChange(),this._listenDirectoryChange()}}y=(0,r.gn)([(0,r.fM)(1,s.Gw),(0,r.fM)(2,h.D),(0,r.fM)(3,v.v),(0,r.fM)(4,f.b),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDraftMaterials?Object:IDraftMaterials,void 0===s.Gw?Object:s.Gw,void 0===h.D?Object:h.D,void 0===v.v?Object:v.v,void 0===f.b?Object:f.b])],y)},838180:function(e,t,i){i.d(t,{E:function(){return r}});let r=(0,i(335290).yh)("media-sdier-menu-service")},372853:function(e,t,i){i.d(t,{bv:function(){return r}});let r=(0,i(335290).yh)("sdk-iframe-event-service")},352625:function(e,t,i){i.d(t,{F:function(){return d}});var r=i(789786),a=i(572029),n=i(782350),o=i(966697),s=i(622204),l=i(801497);class d extends s.j{fetchData(e){return this._brandDataService.getBrandColors(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return l.ZP.t("web_space_brandkit_editor_brand_color",{},"Colors")}constructor(e,t,i,r){let{managerConfig:a,preloadData:n,shouldPaginate:o}=e;super(i,r,a,n),this._brandDataService=t,this._workspaceService=i,this._capcutAccountService=r,this.setInitialData(null==n?void 0:n.list,o)}}d=(0,r.gn)([(0,r.fM)(1,a.X),(0,r.fM)(2,n.W),(0,r.fM)(3,o.Gw),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===a.X?Object:a.X,void 0===n.W?Object:n.W,void 0===o.Gw?Object:o.Gw])],d)},752048:function(e,t,i){i.d(t,{B:function(){return r}});let r=e=>e.sort((e,t)=>t.createTime-e.createTime)},525266:function(e,t,i){i.d(t,{_:function(){return a}});var r=i(809933);function a(e){return e-2*parseInt(r.Z["sider-menu-panel-padding-x"])}},407880:function(e,t,i){i.d(t,{c:function(){return c}});var r=i(772322),a=i(958444),n=i(801497),o=i(728631),s=i(69226),l=i(525266),d=i(671910);let c=e=>{let{numTypes:t}=e;return{siderMenu:[{id:d.DQ,name:o.j.SiderMenuBrandKit,position:"top",icon:()=>(0,r.jsx)(a.dVb,{}),tooltips:()=>n.ZP.t("web_space_brandkit_editor_brand_library",{},"Brand"),title:()=>n.ZP.t("web_space_brandkit_editor_brand_library",{},"Brand")}],siderMenuPanel:[{name:o.j.SiderMenuBrandKit,skeleton:e=>{let{containerWidth:i}=e;return(0,r.jsx)(s.y_,{numTypes:t,containerWidth:(0,l._)(i)})}}]}}},917786:function(e,t,i){i.d(t,{Q:function(){return a}});var r=i(426336);function a(e){return e.draftView.getAllSegments().filter(r.ot2).some(e=>{let t=e.materialDraft.draft.getMainTrack();if(!t)return!1;let[i]=t.segments;return!!i&&(0,r.hey)(i)&&i.material.type===r.cVg.MetaTypeVideo})}},853315:function(e,t,i){i.d(t,{K:function(){return a}});var r=i(195471);function a(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0;(0,r.K)(e,t,i,a)}},959292:function(e,t,i){i.d(t,{H:function(){return a}});var r,a=((r={})[r.normal=0]="normal",r[r.seekDone=1]="seekDone",r[r.onGoing=2]="onGoing",r)},960913:function(e,t,i){i.d(t,{kh:function(){return r}});let r="audio"},892652:function(e,t,i){i.d(t,{X:function(){return a}});var r,a=((r={}).Select="Select",r.Delete="Delete",r)},231811:function(e,t,i){function r(e){return void 0===e?"":`${e}px`}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return Number.parseFloat(e.toFixed(t))}function n(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}i.d(t,{Et:function(){return n},FH:function(){return a},N9:function(){return o},aR:function(){return r}});let o=e=>{let t=e/1e3,i=0,r=0,a="00",n="00";return t/60>=1?(i=Math.floor(t/60),r=Math.ceil(t-60*i)):r=Math.ceil(t),n=r>=10?r.toString():`0${r}`,a=i>=10?i.toString():`0${i}`,`${a}:${n}`}},195045:function(e,t,i){i.d(t,{V:function(){return p}});var r=i(789786),a=i(772322),n=i(485231),o=i(230689),s=i(200247),l=i(641276),d=i(723777),c=i(108692),u=i(896413),h=i(425427);class p extends n.M{async _checkAdd(e){return!this._accountService.hasLogin&&await new Promise(e=>{this._accountService.login({reportParams:{current_page:"editor",pageEnterFrom:"ai_character"},execAfterLogin:()=>{(0,l.V)(this._mainDraftService.draftWorkspaceManager.onDidWorkspaceChange)(()=>{e(!0)})}})}),null==e?void 0:e()}add(e,t){return this._checkAdd(()=>this._addSegmentManager.addDigitalHumanToCurrentProgress(e,!0,t))}renderSnapshot(e){return t=>{let{currentHoverTarget:i}=t;return(0,a.jsx)(d.N,{currentHoverTarget:i,imageInfo:{url:e.data.smallPicture},segmentInfo:{name:e.data.title,duration:e.data.duration}})}}constructor(e,t,i,r,a){super(e,t,i,r),this._containerService=e,this._mainDraftService=t,this._mainEditorWidgetService=i,this._environmentService=r,this._accountService=a}}p=(0,r.gn)([(0,r.fM)(0,o.t),(0,r.fM)(1,c.n),(0,r.fM)(2,u.a),(0,r.fM)(3,h.rO),(0,r.fM)(4,s.D),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===o.t?Object:o.t,void 0===c.n?Object:c.n,void 0===u.a?Object:u.a,void 0===h.rO?Object:h.rO,void 0===s.D?Object:s.D])],p)},309906:function(e,t,i){i.d(t,{x:function(){return g}});var r=i(218571),a=i(254336),n=i(692387),o=i(695324),s=i(728631),l=i(426020),d=i(230689),c=i(173888),u=i(918585),h=i(330699),p=i(356515),_=i(937802),m=i(460254);let f=e=>{let t=e.getModel();switch(t.fileType){case l.YB.Image:return{type:m.r.UserPhoto,sourceFrom:"quick-upload",dragSource:t};case l.YB.Video:return{type:m.r.UserVideo,sourceFrom:"quick-upload",dragSource:t};default:throw Error()}};function g(e){let{modules:t,mutableVideos:i,mountType:l,isTemplate:m,templateId:g=""}=e,{draftOperation:v,sider:y,mutableUpload:S,fileUpload:w,mutableReplaceTaskManager:b,autoReplace:M}=t,T=(0,_.G)(d.t),k=(e,t)=>{let{fileType:i,size:r=0,filename:o="",status:s}=e.getModel();if(![c.a.Success,c.a.TranscodeFailure,c.a.UploadFailure].includes(s))return;let l=m?a.oH.TEMPLATE:a.oH.EDITOR;(0,n.vK)(T,{scenario:m?a.cn.TEMPLATE:a.cn.EDIT,featureKey:m?"normal_template":"material",featureEntrance:l,featureEntranceDetail:`${l}-material_upload`,uploadType:i,status:t,fileSize:r,fileExtension:o.indexOf(".")>-1?o.split(".").pop():"",templateId:g})},x=(0,r.useCallback)(async(e,t)=>{(0,o.b)(T,{relatedEvent:o.Z.AddMaterialToTrack,actionType:"click",optionType:"replace"});let i=f(t),r=await M.expand(e,"mutable",{type:i.type,data:i.dragSource}),a=await v.mutable.setMutableVideos({dragData:i,mutableVideoList:r});a&&v.mutable.addMaterialToTrackReport({model:t.getModel(),status:a.result.ok?"success":"fail",waitTime:a.performanceDuration,mountType:l})},[]);return{uploadFileAndReplaceMutable:(0,r.useCallback)(async(e,t)=>{var r,a;let o=(0,p.f)(t),l=i.find(t=>t.id===e);if(0===o.length||!l)return;y.siderActiveTabSet(s.j.SiderMenuMedia,"project");let[d,...c]=o,_=await S.uploadFile(e,d),m=await w.createUploadTask(c,{autoUpload:!1}),f=!1,g=()=>{if(!f)f=!0,m.forEach(e=>{e.upload()})},v=(0,h.D)(_,{onSuccess:()=>{g(),k(_,n.vm.SUCCESS)},onError:()=>{g(),k(_,n.vm.FAIL)},onCancel:g}),M=b.get(e);null==M||null===(r=M.token)||void 0===r||r.onCancel(()=>{v.dispose()}),await v.done(),(null==M?void 0:null===(a=M.token)||void 0===a?void 0:a.status)!==u.a.CANCELED&&x(e,_)},[i]),cancelUpload:e=>{S.cancelUploadTask(e)},retryUpload:e=>{S.retryUploadTask(e)}}}},755945:function(e,t,i){i.d(t,{j:function(){return a}});var r,a=((r={}).PolyChild="PolyChild",r.FlattedChild="FlattedChild",r.ElementChild="ElementChild",r)},29188:function(e,t,i){i.d(t,{B7:function(){return v},CZ:function(){return u},Fb:function(){return _},H6:function(){return f},HW:function(){return m},Rr:function(){return c},Ru:function(){return g},cp:function(){return h},fQ:function(){return x},g4:function(){return I},m:function(){return p},rk:function(){return y},u$:function(){return w},zD:function(){return d},zx:function(){return S}});var r,a,n,o,s=i(92490),l=i(426336);let d=30,c=100000n,u=l.pMA.div(1000000n,d,"bigint"),h=7,p=6,_=10,m=3,f=5e3,g=3e3,v=3e3,y=3e3,S=3e3,w=500,{searchParams:b}=new URL(window.location.href),M="480",T="_is_gpu_exist";try{let{isCompatible:e}=(0,s.z)();if(e){let e={cpu:8,gpu:1},t=navigator.hardwareConcurrency,i=localStorage.getItem(T);null===i&&(i=document.createElement("canvas").getContext("webgl") instanceof WebGLRenderingContext?"1":"0",localStorage.setItem(T,i)),e.cpu<=t&&e.gpu===Number(i)&&(M="720")}}catch(e){}window._canvas_resolution=M;let k={480:[864,864],720:[1296,1296],1080:[1944,1944]},x={width:null!==(n=null==k?void 0:null===(r=k[M])||void 0===r?void 0:r[0])&&void 0!==n?n:864,height:null!==(o=null==k?void 0:null===(a=k[M])||void 0===a?void 0:a[1])&&void 0!==o?o:864},I=1080,P=b.get("mock_log_level");P&&Number.isFinite(parseInt(P,10))&&parseInt(P,10)},99195:function(e,t,i){i.d(t,{Q:function(){return s}});var r=i(544633),a=i(108692),n=i(937802),o=i(218571);function s(e){let t=(0,r.default)(e),i=(0,n.G)(a.n);(0,o.useEffect)(()=>{let e=i.dataSdk.onDidUndo(t),r=i.dataSdk.onDidRedo(t);return()=>{r.dispose(),e.dispose()}},[i,t])}},465482:function(e,t,i){i.d(t,{Zk:function(){return l},mU:function(){return d}});var r=i(218571),a=i(896413),n=i(108692),o=i(937802),s=i(722169);function l(){let e=(0,o.G)(a.a),t=(0,o.G)(n.n),{segmentIds:i}=e.selection,[s,l]=(0,r.useState)(()=>i.map(e=>t.dataSdk.draftView.getSegmentById(e)));return(0,r.useEffect)(()=>{let i=e.selection.onChange(e=>{let{segmentIds:i}=e.selectedData;l(i.map(e=>t.dataSdk.draftView.getSegmentById(i[0])))});return()=>{i.dispose()}}),s}function d(e){let t=(0,o.G)(a.a),i=(0,o.G)(n.n),{segmentIds:l}=t.selection,[d,c]=(0,r.useState)(()=>{if(1!==l.length)return null;let t=i.dataSdk.draftView.getSegmentById(l[0]);return!(0,s.isNil)(e)&&!(null==e?void 0:e(t))||(0,s.isNil)(t)?null:t});return(0,r.useEffect)(()=>{let e=t.selection.onChange(e=>{let{segmentIds:t}=e.selectedData;if(1!==t.length){c(null);return}c(i.dataSdk.draftView.getSegmentById(t[0]))});return()=>{e.dispose()}}),d}},800793:function(e,t,i){i.d(t,{SK:function(){return c},Vw:function(){return u},bx:function(){return l},iC:function(){return d}});var r=i(544633),a=i(937802),n=i(134392),o=i(218571);function s(e){var t;return(0,o.useMemo)(()=>e,[e.handler,e.keyBindings.mac.join("_"),e.keyBindings.win.join("_"),null===(t=e.description)||void 0===t?void 0:t.join("_"),e.shouldPreventDefault,e.weight,e.when])}function l(e,t){let i=(0,a.G)(n.d),r=s(e);(0,o.useEffect)(()=>{let r=t?i.getOrCreateContext(t):null;return null==r||r.register(e),()=>null==r?void 0:r.unregister(e)},[r,t,i])}function d(e,t){let i=(0,a.G)(n.d),l=s(e),d=(0,o.useMemo)(()=>t?i.getOrCreateContext(t):null,[t,i]),c=(0,r.default)(()=>null==d?void 0:d.register(l));return{registerConfig:c,unRegisterConfig:(0,r.default)(()=>null==d?void 0:d.unregister(l))}}function c(){let e=(0,a.G)(n.d),[t,i]=(0,o.useState)(e.cmdKeyHadDown);return(0,o.useEffect)(()=>{let t=e.onCmdKeyDown(e=>i(e));return()=>{t.dispose()}},[e]),t}function u(e){return!["input","textarea"].includes(e.target.tagName.toLowerCase())}},831998:function(e,t,i){i.d(t,{F:function(){return o}});var r=i(218571),a=i(937802),n=i(594670);function o(){let e=(0,a.G)(n.X),[t,i]=(0,r.useState)(e.getTheme()),o=(0,r.useCallback)(t=>{e.setTheme(t)},[e]);return(0,r.useEffect)(()=>{let t=e.onDidThemeChange(i);return()=>{t.dispose()}},[e,i]),[t,o]}},485231:function(e,t,i){i.d(t,{M:function(){return m}});var r=i(789786),a=i(801497),n=i(183609),o=i(91474),s=i(425427),l=i(108692),d=i(896413),c=i(230689),u=i(641276),h=i(800788),p=i(426336),_=i(929105);class m{_createAddHelper(){var e=this;this._addSegmentManager=this._containerService.createInstance(n.O,this._mainDraftService.dataSdk,this._mainEditorWidgetService.renderManager,this._mainEditorWidgetService.ensureManager,this._mainEditorWidgetService.preloadManager,this._mainEditorWidgetService.selection,this._mainDraftService.draftPathStore,{beforeAddSegment:this._mainEditorWidgetService.onBeforeAddSegment.bind(this._mainEditorWidgetService),afterAddSegment:this._mainEditorWidgetService.onAfterAddSegment.bind(this._mainEditorWidgetService),beforeAddTransition:this._mainEditorWidgetService.onBeforeAddTransition.bind(this._mainEditorWidgetService),afterAddTransition:this._mainEditorWidgetService.onAfterAddTransition.bind(this._mainEditorWidgetService),toast:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";e._mainEditorWidgetService.timelineManager.timelineUI.toast[i](t)},beforeEnsureResource:e=>{this._mainEditorWidgetService.timelineManager.event.timelineBeforeEnsureResource({data:e})},afterEnsureResource:(e,t)=>{this._mainEditorWidgetService.timelineManager.resource.preload(e),this._mainEditorWidgetService.timelineManager.event.timelineAfterEnsureResource({data:e,resourceRecord:t})},onOrderError:this._onOrderError.bind(this)})}_createReplaceHelper(){this._replaceSegmentManager=this._containerService.createInstance(o.m,this._mainDraftService.dataSdk,this._mainEditorWidgetService.renderManager,this._mainEditorWidgetService.ensureManager,this._mainDraftService.draftPathStore,{beforeReplaceMutable:this._beforeReplaceMutable.bind(this),afterReplaceMutable:this._mainEditorWidgetService.afterReplaceMutable.bind(this._mainEditorWidgetService),onAddError:this._onAddError.bind(this),onOrderError:this._onOrderError.bind(this)})}_beforeReplaceMutable(e,t){this._mainEditorWidgetService.beforeReplaceMutable(e,t);let{segmentSelection:i,timelineManager:r}=this._mainEditorWidgetService;if(!i.isSelectedFromCanvas||!i.segment){let t=e.map(e=>e.mutableId);r.tracksManager.trySeekAndScrollToNextMutableVideo(t)}}_onAddError(e){this._mainEditorWidgetService.timelineManager.timelineUI.toast.error(e)}_onOrderError(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this._mainEditorWidgetService.onOrderError(...t)}isForReplace(){let e=(0,s.JY)(this._environmentService),{segmentMutable:t,expandedSegmentId:i}=this._mainEditorWidgetService.segmentSelection;return!!(e||(Array.isArray(t)?0!==t.length:t)||i)}getDraftIdToReplace(){var e;return null!==(e=this._mainEditorWidgetService.segmentSelection.subDraftId)&&void 0!==e?e:void 0}findMutableVideoToReplace(){let e=this._mainEditorWidgetService.selection.getSelectedSingleSegment(),{mutableVideos:t}=this._mainEditorWidgetService.segmentSelection;if(e&&(0,p.hey)(e)&&!(0,p.duj)(e))return t.find(t=>t.segmentId===e.id);let{timelineManager:i}=this._mainEditorWidgetService;if(i.getIsBatchReplace())return t.find(e=>!e.filled);let r=i.getCurrentTimeLineSegment();if(r){let e=t.find(e=>e.segmentId===r.id);return!e&&this._onAddError(a.ZP.t("web_could_not_add_to_present",{},`Couldn\u{2019}t add it to the slot`)),e}}async findMutableVideosToReplace(e,t){let i=this.findMutableVideoToReplace();if(!i)return Promise.resolve({mutableVideos:[],unhideTargetMutableVideo:!1});let{selection:r,segmentSelection:a}=this._mainEditorWidgetService;if(0===r.segmentIds.length&&a.setSelectedData({segmentIds:[i.segmentId]}),!this._mainEditorWidgetService.checkAvailability([{mutableId:i.id,type:e,value:t}]))return Promise.resolve({mutableVideos:[],unhideTargetMutableVideo:!1});let n=await this._mainEditorWidgetService.unHideMutableVideoManager.autoUnHideMutableVideo(i.id);return{unhideTargetMutableVideo:n,mutableVideos:await this._mainEditorWidgetService.timelineManager.autoReplace.expand(i.id,"mutable",{type:e,data:t})}}findCurrentMutableAudio(){var e;let{segmentIds:t,placeholderIds:i}=this._mainEditorWidgetService.selection.getSelectedData(),r=null!==(e=t[0])&&void 0!==e?e:i[0],{tracksManager:n,timelineUI:o}=this._mainEditorWidgetService.timelineManager,s=n.getSegmentInfo(r);if(!s||s.type!==p.Ocy.SegmentAudio){let e=(null==s?void 0:s.type)===p.Ocy.SegmentVideo?a.ZP.t("web_slots_can_only_be_filled_with_videos_or_images",{},"Only video and photo can be added to the slot"):a.ZP.t("web_musicreplace_toast_click_track_first",{},"Select music track first to replace music");o.toast.error(e);return}return{segmentId:r,action:i.length>0?"add":"replace",timeRange:{start:s.start,duration:s.duration}}}showTooltips(e,t){let i=!1,r="",{mutableVideos:a}=this._mainEditorWidgetService.segmentSelection,{segmentIds:n}=this._mainEditorWidgetService.selection;if(n.length>0){let o=a.find(e=>e.segmentId===n[0]);if(o){let a=(0,_.T)({slot:o,resource:{data:t,type:e}});a.errmsg&&(i=!0,r=a.errmsg)}}return{show:i,text:r}}process(e,t){return this.isForReplace()?this.replace(e):this.add(e,t)}add(e,t){(0,h.ss)("needs to be implemented in subclass")}replace(e){(0,h.ss)("needs to be implemented in subclass")}constructor(e,t,i,r){this._containerService=e,this._mainDraftService=t,this._mainEditorWidgetService=i,this._environmentService=r,(0,u.V)(this._mainEditorWidgetService.onEventually)(()=>{this._createAddHelper(),this._createReplaceHelper()})}}m=(0,r.gn)([(0,r.fM)(0,c.t),(0,r.fM)(1,l.n),(0,r.fM)(2,d.a),(0,r.fM)(3,s.rO),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.t?Object:c.t,void 0===l.n?Object:l.n,void 0===d.a?Object:d.a,void 0===s.rO?Object:s.rO])],m)},764276:function(e,t,i){i.d(t,{x:function(){return g}});var r=i(789786),a=i(673422),n=i(872813),o=i(317832),s=i(865632),l=i(825686),d=i(230689),c=i(200247),u=i(108692),h=i(196769),p=i(230982),_=i(375197),m=i(475590),f=i(893245);class g{get accepts(){return this._accountService.hasLogin?this._uploadMaterialFromLocalManager.accepts:this._uploadMaterialFromLocalNoSignManager.accepts}selectToUpload(e){var t,i,r,a;let n=null!==(t=null==e?void 0:e.fromWorkspaceId)&&void 0!==t?t:this._mainDraftService.draftWorkspaceManager.workspaceId;if(this._accountService.hasLogin&&n){let t=null!==(r=null==e?void 0:e.fromFolderId)&&void 0!==r?r:null===(i=this._workspaceDirectoryService.getOrCreateDirectoryManager(n))||void 0===i?void 0:i.currentFolder.id;this._uploadMaterialFromLocalManager.selectToUpload({fromWorkspaceId:n,fromFolderId:t,toWorkspaceId:null==e?void 0:e.toWorkspaceId,uploadReportParams:null==e?void 0:e.uploadReportParams,multiple:null==e?void 0:e.multiple,acceptTypes:null==e?void 0:e.acceptTypes,onFilesSelected:null==e?void 0:e.onFilesSelected})}else{let t=null!==(a=null==e?void 0:e.fromFolderId)&&void 0!==a?a:this._draftMaterialsDirectoryService.draftMaterialsDirectory.currentFolder.id;this._uploadMaterialFromLocalNoSignManager.selectToUpload({fromFolderId:t,uploadReportParams:null==e?void 0:e.uploadReportParams,multiple:null==e?void 0:e.multiple,acceptTypes:null==e?void 0:e.acceptTypes})}}upload(e){var t,i,r,a,n;let o=null!==(t=null==e?void 0:e.fromWorkspaceId)&&void 0!==t?t:this._mainDraftService.draftWorkspaceManager.workspaceId;if(this._accountService.hasLogin&&o||e.uploadUntilLogin){let t=null!==(r=null==e?void 0:e.fromFolderId)&&void 0!==r?r:null===(i=this._workspaceDirectoryService.getOrCreateDirectoryManager(o))||void 0===i?void 0:i.currentFolder.id;return this._uploadMaterialFromLocalManager.upload({files:e.files,dataDelta:e.dataDelta,uploadParams:e.uploadParams,fromWorkspaceId:o,toWorkspaceId:null==e?void 0:e.toWorkspaceId,fromFolderId:t,toFolderId:null==e?void 0:e.toFolderId,uploadReportParams:null==e?void 0:e.uploadReportParams,autoUpload:e.autoUpload})}{let t=null!==(n=null==e?void 0:e.fromFolderId)&&void 0!==n?n:null===(a=this._draftMaterialsDirectoryService.draftMaterialsDirectory)||void 0===a?void 0:a.currentFolder.id;return this._uploadMaterialFromLocalNoSignManager.upload({fromFolderId:t,files:e.files,dataDelta:e.dataDelta,uploadParams:e.uploadParams,uploadReportParams:null==e?void 0:e.uploadReportParams,autoUpload:e.autoUpload})}}constructor(e,t,i,r,o,s,l){this._options=e,this._containerService=t,this._accountService=i,this._mainDraftService=r,this._payinPayoutService=o,this._workspaceDirectoryService=s,this._draftMaterialsDirectoryService=l;let d=this._containerService.createInstance(h.o),c=this._containerService.createInstance(f.W,{captureImageFrameHelper:this._options.captureImageFrameManager});this._uploadMaterialFromLocalManager=this._containerService.createInstance(a.K,{acceptTypes:["video","image","audio","file"],onCreated:e.onCreated,onBeforeCreated:e.onBeforeCreated,payinPayoutHelper:d,fastImportHelper:this._options.fastImportAnalyzeManager,captureCoverAndThumbHelper:c}),(0,p.n)(()=>{this._payinPayoutService.prefetch()},{priorityLevel:_.q.IdlePriority}),this._uploadMaterialFromLocalNoSignManager=this._containerService.createInstance(n.x,{checkUploadLimit:{totalSize:async()=>{let e=await (0,m.Hp)(()=>this._payinPayoutService.isSupportPay(this._mainDraftService.draftWorkspaceManager.workspaceId),1e3);return e.ok?e.value?0x40000000:524288e3:524288e3}},onBeforeCreated:e.onBeforeCreated,onCreated:e.onCreated,fastImportHelper:this._options.fastImportAnalyzeManager,captureCoverAndThumbHelper:c,payinPayoutHelper:d,acceptTypes:["video","image","audio"]})}}g=(0,r.gn)([(0,r.fM)(1,d.t),(0,r.fM)(2,c.D),(0,r.fM)(3,u.n),(0,r.fM)(4,l.sX),(0,r.fM)(5,o.V),(0,r.fM)(6,s.b),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IUploadMaterialFromLocalMixinParams?Object:IUploadMaterialFromLocalMixinParams,void 0===d.t?Object:d.t,void 0===c.D?Object:c.D,void 0===u.n?Object:u.n,void 0===l.sX?Object:l.sX,void 0===o.V?Object:o.V,void 0===s.b?Object:s.b])],g)},787347:function(e,t,i){i.d(t,{M9:function(){return o},WZ:function(){return n}});var r=i(46037),a=i(614022);async function n(e,t,i){let r=URL.createObjectURL(e);return await i.insertBlob(r,e),console.log("[resource] warmup quick import file",t,r),i.recordResource({segmentPath:t,resPath:r}),r}function o(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{uniquePath:n,url:o,decryptKey:s,decryptType:l,type:d,fsPath:c,fetchOption:u}=t,{preloadBlockCount:h,withCredentials:p=!1,headers:_={}}=i,m=`asset_id://${n.replace(/^\//,"")}${s?(0,r.Cv)(s):""}`,f={url:o,headers:JSON.stringify(_),withCredentials:p,decryptType:l,type:d,fsPath:null!=c?c:"",fetchOption:u};e.recordResource({segmentPath:n,resPath:m,stream:f,decryptKey:s}),(0,a.Z)(h)&&h>0&&e.startPreload(m,h)}},314882:function(e,t,i){i.d(t,{wA:()=>c});var r=i("733730"),a=i("144144"),n=i("511706");function o(e){var t;let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=null===(t=performance.getEntriesByName(e))||void 0===t?void 0:t[0];if(!r&&i){let t=e.split("/").pop();t&&(r=performance.getEntries().find(e=>e.name.includes(t)))}return r&&void 0!==r.transferSize?0===r.transferSize?"browser":"none":"unknown"}let s="force_refresh",l=!1;"DedicatedWorkerGlobalScope"!==globalThis.constructor.name&&navigator.cookieEnabled&&(l=!!localStorage.getItem("disable_compatible_versions"));let d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new URL(e);for(let e in t)i.searchParams.append(e,t[e]);return i.href},c=new class e{async getCachedBuf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=await this.getCachedResponse(e,t);return await (null==i?void 0:i.arrayBuffer())}async getCachedResponse(e){var t,i,r;let a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this._cacheInitPromise;let o=(null===(t=n.versions)||void 0===t?void 0:t.length)&&(null===(i=n.marks)||void 0===i?void 0:i.group)&&(null===(r=n.marks)||void 0===r?void 0:r.name)&&!l,s=d(e,n.marks);"DedicatedWorkerGlobalScope"===globalThis.constructor.name&&(l=globalThis.disableCompatible);try{if(o){let t=await this.getCachedKeysByGroup(n.marks.group,n.versions),i=null==t?void 0:t.find(e=>e.name===n.marks.name);i&&(console.info("found cached version:",i.version),a=await this._cache.match(i.url,{ignoreSearch:!0}),i.version!==n.versions[0]&&this._cache.match(e,{ignoreSearch:!0}).then(e=>{void 0===e?this._cache.add(s):s!==e.url&&this._cache.put(s,e.clone())}))}return!a&&(a=await this._cache.match(e,{ignoreSearch:!0}))&&s!==a.url&&this._cache.put(s,a.clone()),a}catch(e){return}}_perfSuccess(e,t,i){return(0,a.oe)(e,{categories:{hit_cache:t,status:"success"},metrics:{file_size:null==i?void 0:i.byteLength}}),i}_perfError(e){(0,a.oe)(e,{categories:{status:"fail"}})}async _fetchArrayBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{perfName:i,forceRefresh:r,marks:l={},priority:c,ignoreQueryInKey:u}=t;await this._cacheInitPromise;let h=u?e.split("?")[0]:e;(0,a.Ie)(i);let p=r?void 0:await this.getCachedBuf(h,t);if(p)return this._perfSuccess(i,"idb",p),p;try{var _;let t=await (0,n.Vb)(r?d(e,{[s]:`${Date.now()}`}):e,{priority:c},{onProgress:t=>this._eventbus.emit(`progress:${e}`,t)});return p=await t.arrayBuffer(),null===(_=this._cache)||void 0===_||_.put(d(h,l),new Response(p)),this._eventbus.removeAllListeners(`progress:${e}`),this._perfSuccess(i,o(e),p),p}catch(t){throw this._perfError(i),this._eventbus.removeAllListeners(`progress:${e}`),t}}async _fetchResponse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{perfName:i,forceRefresh:r,marks:l,priority:c,ignoreQueryInKey:u}=t;await this._cacheInitPromise;let h=u?e.split("?")[0]:e;(0,a.Ie)(i);let p=r?void 0:await this.getCachedResponse(h,t);if(p)return this._perfSuccess(i,"idb"),p;try{var _;return p=await (0,n.Vb)(r?d(e,{[s]:`${Date.now()}`}):e,{priority:c},{onProgress:t=>{this._eventbus.emit(`progress:${e}`,t),t>=1&&(this._eventbus.removeAllListeners(`progress:${e}`),this._perfSuccess(i,o(e)))}}),null===(_=this._cache)||void 0===_||_.put(d(h,l),p.clone()),p}catch(t){throw this._perfError(i),this._eventbus.removeAllListeners(`progress:${e}`),t}}fetchWithCache(e,t){let{onProgress:i,removeAfterDone:r=!0,returnType:a="arraybuffer"}=null!=t?t:{};i&&this._eventbus.on(`progress:${e}`,i);let n=`${e}_${a}`,o=this._task.get(n);if(o)return o;let s="arraybuffer"===a?this._fetchArrayBuffer(e,t):this._fetchResponse(e,t);return this._task.set(n,s),r&&s.finally(()=>this._task.delete(n)),s}deleteTask(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"arraybuffer",i=`${e}_${t}`;this._task.delete(i)}async deleteCache(e,t){var i;await this._cacheInitPromise,await (null===(i=this._cache)||void 0===i?void 0:i.delete(e,t))}async _initCachedList(){var e,t;if(this._cachedList.length)return;await this._cacheInitPromise;let i=null!==(t=await (null===(e=this._cache)||void 0===e?void 0:e.keys()))&&void 0!==t?t:[];this._cachedList=i.map(e=>{let{url:t}=e,{searchParams:i}=new URL(t),r={};for(let[e,t]of i.entries())r[e]=t;return{url:t,...r}})}async getCachedKeysByGroup(e,t){await this._cacheKeysPromise;let i=this._cachedList.filter(t=>t.group===e);if(!i.length)return;let r=new Set(i[0].names.split("~")),a=i.reduce((e,t)=>t.version&&t.name?(!(t.version in e)&&(e[t.version]=[]),e[t.version].push(t),e):e,{});for(let e in a){let t=new Set(a[e].map(e=>e.name));!(t.size===r.size&&[...r].every(e=>t.has(e)))&&delete a[e]}if(!t)return a;for(let e of t)if(a[e])return a[e]}async clearCacheByGroup(e,t){try{if(navigator.storage&&navigator.storage.estimate){let e=await navigator.storage.estimate();if(!e.quota||!e.usage)return;let t=e.usage/e.quota*100,i=e.quota-e.usage;if(console.log("clearCacheByGroup info ====>",{remaining:i,percentageUsed:t,quota:e}),e.quota>1e10&&t<30)return;if(i/1e6>100)return}for(let i of(await this._cacheKeysPromise,this._cachedList.filter(t=>{var i,r;return t.group===e||(null===(i=(r=t.url).includes)||void 0===i?void 0:i.call(r,e))})))!t.includes(i.version)&&this.deleteCache(i.url)}catch(e){console.error("clearCacheByGroup error",e)}}constructor(){this._eventbus=new r.Z,this._cache=null,this._task=new Map,this._cachedList=[],this._cacheInitPromise=caches.open("cache_manager").then(e=>this._cache=e).catch(e=>console.error("CacheManager error: ",e)),this._cacheKeysPromise=this._initCachedList()}}},719162:function(e,t,i){i.d(t,{O:function(){return a}});var r=i(374904);let a=e=>{let{acceptType:t}=e;return(null==t?void 0:t.length)?(null==t?void 0:t.map(e=>r.NF[e].accept)).join(","):r.NF.allAccept}},262319:function(e,t,i){i.d(t,{jL:function(){return a},u6:function(){return o},xG:function(){return n}});var r=i(426336);let a=e=>(0,r.hey)(e)?e.adjust:e.material,n=(e,t,i,a)=>(0,r.hey)(t)?e.api.video.setBasicColor(i,a):e.api.adjustment.setBasicColor(i,a),o=(e,t,i)=>(0,r.hey)(t)?e.api.video.resetBasicColor(i):e.api.adjustment.resetBasicColor(i)},319657:function(e,t,i){let r;i.d(t,{O:function(){return n}});class a{ask(e){return new Promise(t=>{this.questions.set(e,{answer:t})})}reply(e,t){let i=this.questions.get(e);i&&(i.answer(t),this.questions.delete(e))}constructor(){this.questions=new Map}}function n(){return void 0===r&&(r=new a),r}},879551:function(e,t,i){i.d(t,{K3:function(){return u},Y8:function(){return o}});var r=i(426336),a=i(978874),n=i(127830);let o=function(e,t,i,r,a,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return new Promise(l=>{let d=t.getResourceKeyFromDraftPath(r);if(!d){l(null);return}let c=i.get(d,a);null==c||c.onReady(t=>{let{isVip:i,name:r,resourceId:a,isBusiness:d,previewUrl:c,icon:u,source:h,dependentResources:p}=t,_="",m="";if([n._g.VideoMotion,n._g.TextMotion,n._g.TextGlow,n._g.Transition,n._g.SubtitleTemplate,n._g.AutoBeautyBody,n._g.AutoBeautyFace,n._g.AutoBeautyMakeup,n._g.AutoBeautyShape].includes(t.type)){var f;_=c,m=null!==(f=u.urlList[0])&&void 0!==f?f:c}l({previewUrl:null!=_?_:"",animatedUrl:null!=m?m:"",isBusiness:d,metaType:o,name:r,resourceId:a,segmentId:e.id,isVip:i,parentSegmentId:s,source:h,resourceType:t.type,dependentResources:p})})})},s=(e,t,i,a)=>{var s,l,d,c,u;let h=[];return(null===(l=e.animations)||void 0===l?void 0:null===(s=l.animations)||void 0===s?void 0:s.length)&&(null===(u=e.animations)||void 0===u||u.animations.forEach(s=>{h.push(o(e,t,i,s.path,n._g.VideoMotion,r.cVg.MetaTypeVideoAnimation,a))})),(null===(d=e.transition)||void 0===d?void 0:d.path)&&h.push(o(e,t,i,e.transition.path,n._g.Transition,r.cVg.MetaTypeTransition,a)),(null===(c=e.figures)||void 0===c?void 0:c.length)&&e.figures.forEach(a=>{a.categoryId===n._g.AutoBeautyMakeup&&h.push(o(e,t,i,a.path,a.categoryId,r.cVg.MetaTypeFigure))}),h},l=(e,t,i,s)=>{var l,d,c,u;let h=[];return(null===(d=e.animations)||void 0===d?void 0:null===(l=d.animations)||void 0===l?void 0:l.length)&&(null===(c=e.animations)||void 0===c||c.animations.forEach(a=>{h.push(o(e,t,i,a.path,n._g.TextMotion,r.cVg.MetaTypeAnimation,s))})),e.effects.length&&e.effects.forEach(a=>{h.push(o(e,t,i,a.path,n._g.TextPreset,r.cVg.MetaTypeTextEffect))}),e.material.captionTemplateInfo.resourceId&&h.push(o(e,t,i,null!==(u=t.getDraftPathFromResourceKey((0,a.s)(e.material.captionTemplateInfo.resourceId)))&&void 0!==u?u:"",n._g.SubtitleTemplate,r.cVg.MetaTypeSubtitle)),e.bloom&&BigInt(e.material.checkFlag)&r.PbZ.LightFlag&&h.push(o(e,t,i,e.bloom.path,n._g.TextGlow,r.cVg.MetaTypeBloom)),h},d=(e,t,i,a)=>{let s=[],{textInfoResources:l}=e.material;return l.length&&l.forEach(l=>{var d;let c=null===(d=l.textAnimateMaterial)||void 0===d?void 0:d.animations;if(!!(null==c?void 0:c.length))c.forEach(l=>{s.push(o(e,t,i,l.path,n._g.TextMotion,r.cVg.MetaTypeAnimation,a))})}),s},c=(e,t,i,a)=>{let s=[],l=e.voiceChange;return null==l||l.forEach(l=>{s.push(o(e,t,i,l.path,n._g.VoiceChange,r.cVg.MetaTypeAudioEffect,a))}),s},u=(e,t,i,a)=>{switch(!0){case(0,r.hey)(e):return s(e,t,i,a);case(0,r.Ftn)(e):return l(e,t,i,a);case(0,r.Q2R)(e):return d(e,t,i,a);case(0,r.Y9Q)(e):return c(e,t,i,a)}return[Promise.resolve(null)]}},808213:function(e,t,i){i.d(t,{W:function(){return a}});var r=i(426336);let a=e=>{var t,i;if(!e)return!1;let{subType:a}=e,n=0===e.value,o=null===(t=e.adjustParams)||void 0===t?void 0:t.every(e=>0===e.value),s=null===(i=e.faceAdjustParams)||void 0===i?void 0:i.every(e=>{let{adjustParams:t}=e;return t.every(e=>0===e.value)});switch(a){case r.DeX.MetaSubTypeAutoBeauty:return n&&o;case r.DeX.MetaSubTypeExclusionFace:case r.DeX.MetaSubTypeExclusion:return n&&o&&s;default:return n}}},322613:function(e,t,i){i.d(t,{a:function(){return a}});var r=i(426336);function a(e){switch(e){case r.rxY.CanvasRatio16To9:return"16:9";case r.rxY.CanvasRatio9To16:return"9:16";case r.rxY.CanvasRatio4To3:return"4:3";case r.rxY.CanvasRatio3To4:return"3:4";case r.rxY.CanvasRatio1To1:return"1:1";case r.rxY.CanvasRatio2To1:return"2:1";case r.rxY.CanvasRatio2_35To1:return"2.35:1";case r.rxY.CanvasRatio1_85To1:return"1.85:1";case r.rxY.CanvasRatio1_125To2_436:return"1.125:2.436";case r.rxY.CanvasRatioOriginal:default:return""}}},684685:function(e,t,i){i.d(t,{AB:function(){return c},dl:function(){return p},wX:function(){return u}});var r=i(798184),a=i(242785),n=i(800788),o=i(217131),s=i(282600);let l=async(e,t,i)=>{let r=[],l=[],d=new Map;for(let c of e){let{buffer:e,mimeType:u,frameCount:h,imageWidth:p,imageHeight:_,singleFrameHeight:m,singleFrameWidth:f}=c,g=await t.converter.bufferToImage(e,u);(!g.ok||!g.value)&&(0,n.ss)("[TimelineResource] split sprites error"),g.value.width===p&&g.value.height!==_&&(g.value.height=_);let v=t.sprite.split({graphic:g.value,xCount:p/f,yCount:_/m,totalCount:h,compress:{height:null!=i?i:o.ts}},a.O.Canvas);for(let e of v)l.push((0,s.r)(e.graphic).then(t=>(d.set(e,t),t)));r.push(...v)}try{await Promise.all(l)}catch(e){}return r.map(e=>{var t;return{image:null!==(t=d.get(e))&&void 0!==t?t:e.graphic,x:e.x,y:e.y,width:e.width,height:e.height,timestamp:0n,sourceTimestamp:0n}})};async function d(e){let t=await e.getThumbResourceTokens();try{await Promise.all(t.map(e=>(0,r.x)(e)))}catch(e){throw e}let i=[];for(let e of t){(0,n.ZB)(e.value);let{buffer:t,contentType:r,frameCount:a,imageHeight:o,imageWidth:s,singleFrameHeight:l,singleFrameWidth:d}=e.value;i.push({buffer:t,mimeType:r,frameCount:a,imageHeight:o,imageWidth:s,singleFrameHeight:l,singleFrameWidth:d})}return i}async function c(e,t,i){return l(await d(e),t,i)}function u(e,t){return{getResourceSpritesTask:()=>d(e),splitSpritesTask:e=>l(e,t)}}let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,{buffer:i,mimeType:r,frameCount:a,imageWidth:n,imageHeight:o,singleFrameHeight:s,singleFrameWidth:l}=e,d=URL.createObjectURL(new Blob([i],{type:r})),c=(function(e,t){let i=[];for(let r=0;r<t;r++)for(let t=0;t<e;t++)i.push({x:t,y:r});return i})(n/l,o/s).slice(0,a),u=s*t,h=l*t;return c.map(e=>({url:d,x:e.x*h,y:e.y*u,width:h,height:u}))};async function p(e){return(await d(e)).map(e=>{let t=function(e){let{originHeight:t,targetHeight:i,originWidth:r,targetWidth:a}=e,n=1;return t&&i?n=t/i:r&&a&&(n=r/a),Math.max(1,n)}({originHeight:e.singleFrameHeight,targetHeight:o.ts});return h(e,t)}).flat()}},654033:function(e,t,i){i.d(t,{a:function(){return a}});var r=i(794273);function a(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],a=-t,n=Math.cos(a*Math.PI/180),o=Math.sin(a*Math.PI/180),s=i[0]+(e[0]-i[0])*n-(e[1]-i[1])*o,l=i[1]+(e[0]-i[0])*o+(e[1]-i[1])*n;return[(0,r.FH)(s),(0,r.FH)(l)]}},578186:function(e,t,i){i.d(t,{G:function(){return a}});var r=i(827322);function a(e){let t=document.createElement("template");return t.innerHTML=(0,r.J)(e.trim(),null,{logType:"js.innerHTML",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),t.content.firstChild}},584341:function(e,t,i){function r(e,t){return String(e).padStart(t,"0")}i.d(t,{N9:function(){return o},ci:function(){return n}});let a=RegExp("(?<h>\\??h+)?((?<dm>.)(?<m>\\??m+))?((?<ds>.)(?<s>\\??s+))?((?<dms>.)(?<ms>(ms)+))?((?<df>.)(?<f>(f)+))?");function n(e){var t,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?hh:mm:ss",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{h:l,m:d,dm:c="",s:u,ds:h="",ms:p,dms:_="",f:m,df:f=""}=null!==(i=null===(t=a.exec(n))||void 0===t?void 0:t.groups)&&void 0!==i?i:{},g=e,v="";if(m){let e=Math.round(g%1e3/1e3*o);v=`${r(e,m.replace(/^\?/,"").length)}`}if(p&&(v=`${r(g%1e3,p.replace(/^\?/,"").length/2)}${f}${v}`),g=Math.floor(g/1e3),u){let e=g%60;(e||!u.startsWith("?"))&&(v=`${r(e,u.replace(/^\?/,"").length)}${_||f}${v}`)}if(g=Math.floor(g/60),d){let e=g%60;if(s&&(e=g>9999?"9999+":g),(e||!d.startsWith("?"))&&(v=`${r(e,d.replace(/^\?/,"").length)}${h}${v}`),s)return v}if(g=Math.floor(g/60),l){let e=g;(e||!l.startsWith("?"))&&(v=`${r(e,l.replace(/^\?/,"").length)}${c}${v}`)}return v}function o(e){let t=e/1e3,i=0,r=0,a="00",n="00";return t/60>=1?(i=Math.floor(t/60),r=Math.ceil(t-60*i)):r=Math.ceil(t),n=r>=10?r.toString():`0${r}`,a=i>=10?i.toString():`0${i}`,`${a}:${n}`}},992798:function(e,t,i){i.d(t,{Z:function(){return r}});function r(e,t,i){let{mimeType:r}=i;return new Promise((t,i)=>{e.toBlob(e=>e?t(e):i(Error("[canvas2Blob] received null")),r)})}},130685:function(e,t,i){i.d(t,{r:()=>s});var r=i("47391"),a=i("968172");async function n(e,t,i){let{mimeType:n}=t,{compress:o}=i,s=await (0,r.G)(e,{mimeType:n});return(0,a.N)(s,void 0,{compress:o})}var o=i("132456");async function s(e,t){let{mimeType:i,quality:r}=t,a=await (0,o.B)(e);return(await n(a,{mimeType:i},{})).toDataURL(i,r)}},339142:function(e,t,i){i.d(t,{U:function(){return r}});function r(e){let{width:t}=e,{height:i}=e,r=document.createElement("canvas");r.width=t,r.height=i;let a=r.getContext("2d");if(!a)throw Error("[imageData2CanvasSync] create context failed!");return a.putImageData(e,0,0),r}},623087:function(e,t,i){i.d(t,{Z:()=>L});var r=i("772322");i("225572"),i("878858");var a=i("324160"),n=i("97257"),o=i("835667"),s=i("218571"),l=i("801497"),d=i("276513"),c=i("105789"),u=i.n(c),h=i("289647"),p=i("230689");i("68972"),i("35867"),i("960560");var _=i("572651"),m=i("113152"),f=i("928881"),g=i("591850"),v=i("540266"),y=i("893354"),S=i("768182"),w=i("175994"),b=i("54059"),M=i("264738"),T=i("398566"),k=i("164361");i("479967");let{DEFINITION:x}=v.JY,I=[1,2,3],P={layout:"horizontal",labelCol:{flex:1},wrapperCol:{flex:"36px"}},E="template-post-form-main_field",C="template-post-form-more_field",D="template-post-form-extra_field",F="template-post-form-extra",A="template-post-form-tips";var R=i("654144"),j=i("51122"),O=i("937802"),B=i("434005");i("718726");let V="template-post-form",N=`${V}-more`;function U(e){let t=(0,s.useRef)(null),i=(0,s.createElement)("div",{key:e,ref:t});return[t,i]}let L=(0,s.forwardRef)(function(e,t){let{value:i={},onChange:c,beforeSubmit:v,onSubmit:L,config:W,active:Z,coverSize:H,duration:z}=e,[K]=o.Z.useForm(),$=(0,O.G)(p.t),Y=(0,s.useRef)(null),[Q,G]=U("fist-elem"),[X,J]=U("last-elem"),[q,ee]=(0,s.useState)(!1),et=function(e,t,i){var a,n;let{segmentTemplateCollections:d=[]}=null!=t?t:{},c=(0,s.useCallback)(()=>{y.Z.warning(l.ZP.t("only_supports_materials_up_to_{size}",{size:(0,S.a)(b.i9)},"Only materials up to {size} are supported"),{getContainer:()=>document.getElementById(b.$I)})},[]);return[(0,r.jsx)(o.Z.Item,{label:"",field:"cover",required:!0,className:E,children:(0,r.jsx)(T.Z,{width:null==i?void 0:null===(a=i.coverSize)||void 0===a?void 0:a[0],height:null==i?void 0:null===(n=i.coverSize)||void 0===n?void 0:n[1],duration:null==i?void 0:i.duration,limit:b.i9,onLimit:c})},"cover"),(0,r.jsx)(o.Z.Item,{label:l.ZP.t("web_posttemplate_title_title",{},"Title"),field:"title",required:!0,className:E,children:(0,r.jsx)(f.Z,{size:"small",autoComplete:"off",placeholder:l.ZP.t("web_posttemplate_text_describe_template_theme",{},"Please enter template title"),maxLength:100,showWordLimit:!0})},"title"),(0,r.jsx)(o.Z.Item,{label:l.ZP.t("web_posttemplate_text_template_description",{},"Template description"),field:"description",className:E,children:(0,r.jsx)(f.Z.TextArea,{autoComplete:"off",placeholder:l.ZP.t("web_posttemplate_text_describe_your_template",{},"Describe your video"),rows:3,style:{maxHeight:"280px"},maxLength:200,showWordLimit:!0})},"description"),(0,r.jsx)(o.Z.Item,{label:l.ZP.t("web_posttemplate_title_export_template_clarity",{},"Export clarity"),field:"definition",required:!0,className:E,children:(0,r.jsx)(m.Z,{size:"small",defaultActiveFirstOption:!1,renderFormat:(e,t)=>{var i;return null===(i=x.find(e=>e.value===t))||void 0===i?void 0:i.key},children:x.map(e=>(0,r.jsx)(m.Z.Option,{value:e.value,children:e.key},e.key))})},"definition"),(0,r.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:t=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z.Item,{label:l.ZP.t("web_posttemplate_title_template_type",{},"Template type"),field:"template_type",required:!0,className:E,children:(0,r.jsxs)(k.Z,{size:"small",direction:"vertical",onChange:()=>e.setFieldValue("segment_template_collection",void 0),children:[(0,r.jsxs)(_.Z,{value:w.xw.video_template,children:[l.ZP.t("web_posttemplate_title_video_template",{},"Video templates"),(0,r.jsx)("div",{className:A,style:{marginTop:"4px"},children:l.ZP.t("web_posttemplate_text_select_one_material",{},"Select at least one interchangedable material")})]}),(0,r.jsx)(_.Z,{value:w.xw.clip_template,children:l.ZP.t("web_posttemplate_title_clip_template",{},"Clip templates")})]})}),(null==t?void 0:t.template_type)===2&&(0,r.jsxs)("div",{className:F,children:[(0,r.jsxs)("div",{className:`${F}-title`,children:[l.ZP.t("web_posttemplate_text_select_clip_type",{},"select type of clip templates"),(0,r.jsx)("span",{children:" *"})]}),(0,r.jsx)(o.Z.Item,{label:"",field:"segment_template_collection",required:!0,className:E,children:(0,r.jsx)(k.Z,{size:"small",direction:"vertical",displayType:"gray",children:d.map(e=>(0,r.jsx)(_.Z,{value:e.id,children:l.ZP.t(e.starlingKey,{},e.name)},e.id))})})]})]})},"template_type")]}(K,W,{coverSize:H,duration:z}),ei=function(e,t,i){let[a,n]=(0,s.useState)(!1);return[(0,r.jsx)(o.Z.Item,{label:l.ZP.t("web_posttemplate_text_template_paid_setting",{},"Paid settings"),field:"amount",className:C,children:e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(k.Z,{value:e.amount,size:"small",displayType:"tag",disabled:!0,children:[(0,r.jsx)(_.Z,{value:0,onClick:()=>{n(!0)},children:l.ZP.t("web_posttemplate_text_free",{},"Free")}),I.map(e=>(0,r.jsx)(_.Z,{onClick:()=>{n(!0)},style:{flex:1},value:e,children:`$${e.toFixed(1)}`},e))]}),a&&(0,r.jsxs)("div",{className:"template-post-form-notice",children:[(0,r.jsx)("div",{className:"template-post-form-notice-icon",children:(0,r.jsx)(g.Z,{})}),(0,r.jsx)("div",{className:"template-post-form-notice-text",children:l.ZP.t("web_posttemplate_text_not_changable",{},"Can\u2019t change price. All current templates are free.")})]})]})},"amount"),(0,r.jsx)(o.Z.Item,{label:l.ZP.t("web_posttemplate_text_template_presentation",{},"Template presentation"),field:"align_mode",className:C,children:(0,r.jsxs)(k.Z,{size:"small",direction:"vertical",displayType:"gray",children:[(0,r.jsx)(_.Z,{value:w.xp.align_canvas,children:l.ZP.t("web_posttemplate_text_display_proportion",{},"Complete display of the proportion of videos uploaded by users")}),(0,r.jsx)(_.Z,{value:w.xp.align_video,children:l.ZP.t("web_posttemplate_text_same_scale",{},"Crop the user uploaded video to the same scale as the template video")})]})},"align_mode"),(0,r.jsx)(o.Z.Item,{label:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:`${D}-title`,children:l.ZP.t("web_posttemplate_title_original_sound",{},"Original Sound Preserved")}),(0,r.jsx)("div",{className:A,style:{marginTop:"6px"},children:l.ZP.t("web_posttemplate_text_original_sound",{},"When turned on, user uploaded video footage will retain the original sound")})]}),field:"is_mute",className:u()(C,D),...P,children:(0,r.jsx)(M.Z,{size:"default",valueMap:{on:!1,off:!0}})},"is_mute"),(0,r.jsx)(o.Z.Item,{label:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:`${D}-title`,children:l.ZP.t("web_posttemplate_text_priority_shooting",{},"Priority photography")}),(0,r.jsx)("div",{className:A,style:{marginTop:"6px"},children:l.ZP.t("web_posttemplate_text_ suited_shooting",{},"If the template is more suitable for completion using the shooting function, it is recommended to turn on")})]}),field:"default_open_mode",className:u()(C,D),...P,children:(0,r.jsx)(M.Z,{size:"default",valueMap:{on:w.GJ.shooting,off:w.GJ.default}})},"default_open_mode"),(0,r.jsx)(o.Z.Item,{label:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:`${D}-title`,children:l.ZP.t("web_posttemplate_text_intelligent_modification",{},"Number of stencil clips")}),(0,r.jsx)("div",{className:A,style:{marginTop:"6px"},children:l.ZP.t("web_posttemplate_text_used_by_more",{},"When turned on, the template may be used by more users and it is recommended to turn on")})]}),field:"dynamic_slots_option",className:u()(C,D),...P,children:(0,r.jsx)(M.Z,{size:"default",valueMap:{on:w.xZ.on,off:w.xZ.off}})},"dynamic_slots_option"),(0,r.jsx)(o.Z.Item,{field:"is_group",hidden:!0,className:u()(C,D),...P,children:(0,r.jsx)(M.Z,{size:"default"})},"is_group"),(0,r.jsx)(o.Z.Item,{field:"is_freeze_group",hidden:!0,className:u()(C,D),...P,children:(0,r.jsx)(M.Z,{size:"default"})},"is_freeze_group"),null==i?void 0:i.lastElem]}(0,0,{lastElem:J}),[er,ea]=(0,s.useState)(!1),[en,eo]=(0,s.useState)(!1),[es,el]=(0,s.useState)(!1),ed=(0,s.useMemo)(()=>(0,R.S)(i),[i]),ec=(0,s.useCallback)(()=>{let e=!er;if(ea(e),ee(e),e)eo(e),setTimeout(()=>{var e;null==X||null===(e=X.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})});else{var t,i,r;let a=(null!==(r=null==Y?void 0:null===(t=Y.current)||void 0===t?void 0:t.scrollTop)&&void 0!==r?r:0)>0;a&&(null==Q||null===(i=Q.current)||void 0===i||i.scrollIntoView({behavior:"smooth"})),setTimeout(()=>{eo(e)},a?300:0)}},[er]),eu=(0,s.useCallback)(async()=>{el(!0),(0,j.W)($,{action:"click"});try{let e=await K.validate();await (null==v?void 0:v(e)),await (null==L?void 0:L(e))}catch{}finally{el(!1)}},[v,L]),eh=(0,s.useCallback)((e,t)=>{null==c||c(t)},[c]),ep=(0,s.useCallback)((0,d.Z)(()=>{var e,t;ee((null!==(t=null===(e=Y.current)||void 0===e?void 0:e.scrollTop)&&void 0!==t?t:0)>0)}),[]);(0,s.useImperativeHandle)(t,()=>({setFormValue:e=>{K.resetFields(),K.setFieldsValue(e)}})),(0,s.useEffect)(()=>{!Z&&(ea(!1),eo(!1),ee(!1))},[Z]);let[e_,em]=(0,a.default)();return(0,s.useEffect)(()=>{em&&(0,j.W)($,{action:"show"})},[em]),(0,r.jsxs)("div",{className:V,children:[q&&(0,r.jsx)("div",{className:`${V}-shadow`}),(0,r.jsx)("div",{className:`${V}-main`,ref:Y,onScroll:ep,children:(0,r.jsxs)(o.Z,{form:K,size:"small",layout:"vertical",onValuesChange:eh,children:[G,et,(0,r.jsxs)("div",{className:u()(N,{collapse:!en}),children:[(0,r.jsxs)("div",{className:`${N}-head`,onClick:ec,children:[(0,r.jsx)("div",{className:`${N}-title`,children:l.ZP.t("web_posttemplate_button_more_settings",{},"More settings")}),(0,r.jsx)(h.Z,{className:u()(`${N}-toggle`,{active:er})})]}),(0,r.jsx)("div",{className:`${N}-main`,children:ei})]})]})}),(0,r.jsxs)("div",{className:`${V}-bottom`,children:[(0,r.jsx)(n.Z,{className:`${V}-submit`,type:"primary",onClick:eu,disabled:!ed,loading:es,ref:e_,children:l.ZP.t("web_posttemplate_button_post_template",{},"Post template")}),(0,r.jsx)("div",{className:`${V}-agreement`,children:l.ZP.t("web_posttemplate_button_accept_creator_agreement",{"text-href0":B.gj},"By tapping Post, you accept the <text-href0>Creator Agreement</text-href0>")})]})]})})},181304:function(e,t,i){i.d(t,{Z:function(){return m}});var r=i(772322);i(601979),i(225572);var a=i(52838),n=i(97257),o=i(827322),s=i(218571),l=i(801497),d=i(130805),c=i(127801),u=i(648653),h=i(54059);i(625184);let p="template-post-publisher",_=e=>{let{duration:t,href:i,children:n}=e,[l,d]=(0,s.useState)(t),c=(0,s.useRef)(l),[u,h]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=setInterval(()=>{if(c.current<=0){clearInterval(e),h(!1);return}c.current--,d(c.current)},1e3);return()=>{clearInterval(e)}},[]),(0,r.jsxs)(a.Z,{href:(0,o.C)(i,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),target:"_blank",disabled:u,children:[n,u&&(0,r.jsx)("span",{children:`(${l}s)`})]},"preview")},m=e=>{let t,i,o,{onInvoke:m,onBack:f,loadingIcon:g,analysisDuration:v}=e,[y,S]=(0,s.useState)(0),[w,b]=(0,s.useState)(),[M,T]=(0,s.useState)(),k=(0,s.useMemo)(()=>{if((null==M?void 0:M.code)===u.e.ILLEGAL_MUSIC)return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:l.ZP.t("web_posttemplate_toast_not_pass",{},"Music copyright restrictions")}),(0,r.jsx)("div",{children:l.ZP.t("web_posttemplate_toast_no_copyright",{},"CapCut doesn\u2019t have the copyright of the music you use. Replace the music and try again.")})]});return l.ZP.t("web_sharereview_toast_page_exception",{},"Something went wrong")},[M]),x=async()=>{S(0);try{let[e,t]=(await m()).pair();e||!t?(T(e),S(2)):(b(t),S(1))}catch{T(void 0),S(2)}};switch(y){case 1:t=(0,r.jsx)(d.Z,{}),i=(0,r.jsx)("span",{children:l.ZP.t("web_posttemplate_toast_post_successfully",{},"Template posted")}),o=(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(n.Z,{type:"primary",onClick:()=>null==f?void 0:f(),size:"small",children:l.ZP.t("web_posttemplate_button_back_to_editor",{},"Go back to editor")})});break;case 2:t=(0,r.jsx)(c.Z,{}),i=l.ZP.t("web_posttemplate_toast_post_failed",{},"Couldn\u2019t post"),o=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z,{className:`${p}-back`,onClick:()=>null==f?void 0:f(!0),style:{marginRight:"16px"},type:"secondary",size:"small",children:l.ZP.t("web_posttemplate_button_back_to_editor",{},"Go back to editor")}),(0,r.jsx)(n.Z,{type:"primary",onClick:x,size:"small",children:l.ZP.t("web_posttemplate_button_retry",{},"Try again")})]})}return(0,s.useEffect)(()=>{x()},[]),(0,r.jsx)("div",{className:p,children:(0,r.jsxs)("div",{className:`${p}-body`,children:[(0,r.jsx)("div",{className:`${p}-icon`,children:0===y?g:t}),(0,r.jsx)("div",{className:`${p}-title`,children:0===y?l.ZP.t("web_posttemplate_toast_posting_template",{},"Posting template..."):i}),0===y&&(0,r.jsx)("div",{className:`${p}-description`,children:l.ZP.t("web_posttemplate_desc_not_close_window",{},"It may take a while. If you close the window, the template will not be posted.")}),2===y&&(0,r.jsx)("div",{className:`${p}-description`,children:k}),1===y&&(0,r.jsx)("div",{className:`${p}-description`,children:l.ZP.t("web_posttemplate_text_preview_template",{"text-action0":e=>(0,r.jsx)(_,{duration:null!=v?v:h.jb,href:`${location.origin}/editor-template?create_id=${null==w?void 0:w.webId}&from_page=editor&is_preview_template=1`,children:e},"preview"),"text-action1":e=>(0,r.jsx)(a.Z,{type:"text",onClick:x,children:e},"post")},"You can <text-action0>preview template</text-action0>. If you couldn\u2019t preview your template, <text-action1>post template</text-action1> again.")}),0!==y&&(0,r.jsx)("div",{className:`${p}-bottom`,children:o})]})})}},54059:function(e,t,i){i.d(t,{$I:function(){return l},$R:function(){return p},DQ:function(){return n},RO:function(){return h},i9:function(){return s},jR:function(){return o},jb:function(){return d}});var r=i(995370),a=i(426020);let n="TemplatePost",o={TitlebarTemplatePost:"TitlebarTemplatePost"},s=r.lc*r.lc,l="template-post-view",d=30,c=["flv","mkv","avi","webm","wmv","rm","rmvb","3gp","m2ts","mt2s","m2t","mxf","mpg","mpe","ts"],u=["aac","oga","ogg","wma","amr","aif","aiff","ac3","mpa","ape","mac","mp2","acc"],h=[a.YB.Audio,a.YB.Image,a.YB.Video],p=[...c,...u]},23052:function(e,t,i){i.d(t,{G:function(){return _}});var r=i(789786),a=i(801497),n=i(373722),o=i(893354),s=i(332557),l=i(978112),d=i(896413),c=i(108692),u=i(175994),h=i(54059),p=i(400290);class _{bindFormInstance(e){this._store.setFormRef(e)}async initFormValue(e){var t,i;let{formValue:r}=this._store;if(e){let e=await p.R.getStoreInstance(this._storageService),[t,i]=(await e.query(this._mainDraftService.dataSdk.draftView.getDraftId())).pair();!t&&i&&(r=JSON.parse(i.form))}let a=await this._mainDraftService.coverManager.getCoverTask(!0),n=await a.getBase64Url();this._store.setFormValue({...r,cover:n}),null===(i=this._store.formRef)||void 0===i||null===(t=i.current)||void 0===t||t.setFormValue(this._store.formValue)}async initFormConfig(){let[e,t]=(await this._videoTemplateDataService.getPublishTemplateConfig()).pair();!e&&this._store.setFormConfig(t)}async initData(e){await Promise.allSettled([this.initFormValue(e)].concat(e?[]:[this.initFormConfig()]))}get formConfig(){return this._store.formConfig}setFormConfig(e){this._store.setFormConfig(e)}get formValue(){return this._store.formValue}setFormValue(e){let t=this._mainDraftService.dataSdk.draftView.getDraftId();p.R.getStoreInstance(this._storageService).then(async i=>{let[r,a]=(await i.query(t)).pair();i.set(t,{id:t,form:JSON.stringify((0,n.Z)(e,"cover")),segmentsInfo:!r&&a?a.segmentsInfo:""})}),this._store.setFormValue(e)}async submit(){!this.formValue.cover&&await this.initFormValue();let e=this.formValue;if(!e.cover){o.Z.warning(a.ZP.t("web_posttemplate_toast_add_cover_first",{},"Add cover to post template"),{getContainer:()=>document.getElementById(h.$I)});return}let t=this._mainEditorWidgetService.timelineManager.templatePost.getTemplatePostMutableSegments();await this._publisherManager.invokeExportAndPublish(e,t)}constructor(e,t,i,r,a,n,o){this._parent=e,this._store=t,this._publisherManager=i,this._mainEditorWidgetService=r,this._mainDraftService=a,this._storageService=n,this._videoTemplateDataService=o}}_=(0,r.gn)([(0,r.fM)(3,d.a),(0,r.fM)(4,c.n),(0,r.fM)(5,s.U),(0,r.fM)(6,l.A),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ITemplatePostManager?Object:ITemplatePostManager,void 0===u.CR?Object:u.CR,"undefined"==typeof ITemplatePostPublisherManager?Object:ITemplatePostPublisherManager,void 0===d.a?Object:d.a,void 0===c.n?Object:c.n,void 0===s.U?Object:s.U,void 0===l.A?Object:l.A])],_)},165092:function(e,t,i){i.d(t,{gq:function(){return n},kY:function(){return s},s9:function(){return o}});var r=i(145457),a=i(175994);let n="templatePostStore",o="templatePostFormStore";function s(){let e=new r.o;return{[n]:e,[o]:new a.CR}}},175994:function(e,t,i){i.d(t,{CR:function(){return p},GJ:function(){return c},xZ:function(){return u},xp:function(){return d},xw:function(){return l}});var r,a,n,o,s=i(260963);var l=((r={})[r.video_template=1]="video_template",r[r.clip_template=2]="clip_template",r);var d=((a={}).align_canvas="align_canvas",a.align_video="align_video",a);var c=((n={})[n.default=0]="default",n[n.shooting=1]="shooting",n);var u=((o={})[o.on=1]="on",o[o.off=2]="off",o);let h={cover:"",title:"",description:"",definition:1080,template_type:1,segment_template_collection:-1,amount:0,align_mode:"align_video",is_mute:!0,is_group:!1,is_freeze_group:!1,default_open_mode:0,dynamic_slots_option:1};class p{get formRef(){return this._formRef}get formValue(){return this._formValue}get formConfig(){return this._formConfig}setFormRef(e){this._formRef=e}setFormValue(e){this._formValue=e}setFormConfig(e){this._formConfig=e}constructor(){this._formValue=h,this._formConfig={segmentTemplateCollections:[]},(0,s.ky)(this)}}},384932:function(e,t,i){i.d(t,{DQ:function(){return r},_V:function(){return a}});let r="siderMenuEffect",a=70},577429:function(e,t,i){i.d(t,{P:function(){return c}});var r=i(772322),a=i(150564),n=i(801497),o=i(384932),s=i(728631),l=i(645199),d=i(446198);let c={siderMenu:[{id:o.DQ,name:s.j.SiderMenuEffect,position:"top",icon:()=>(0,r.jsx)(a.t33,{}),tooltips:()=>n.ZP.t("effects_web",{},"Effects"),title:()=>n.ZP.t("effects_web",{},"Effects")}],siderMenuPanel:[{name:s.j.SiderMenuEffect,skeleton:e=>{let{containerWidth:t}=e;return(0,r.jsx)(l.M,{containerWidth:(0,d._)(t)})}}]}},184597:function(e,t,i){i.d(t,{P:function(){return p}});var r=i(772322),a=i(150564),n=i(801497),o=i(864),s=i(728631),l=i(105789),d=i.n(l),c=i(962777),u=i(472334),h=i(446198);let p={siderMenu:[{id:o.D,name:s.j.SiderMenuFilter,position:"top",icon:()=>(0,r.jsx)(a.AqX,{}),tooltips:()=>n.ZP.t("filter_web_s",{},"Filters"),title:()=>n.ZP.t("filter_web_s",{},"Filters")}],siderMenuPanel:[{name:s.j.SiderMenuFilter,skeleton:e=>{let{containerWidth:t}=e;return(0,r.jsx)("div",{className:d()(c.Z.entryContainer,{[c.Z.initializing]:!0}),children:(0,r.jsx)(u.ZP,{isLoading:!0,skeletonWidth:(0,h._)(t),skeletons:["tags","small-bar","base-title-list","tags","small-bar","base-title-list"],size:"small"})})}}]}},139536:function(e,t,i){i.d(t,{P:function(){return c}});var r=i(772322),a=i(150564),n=i(801497),o=i(644241),s=i(728631),l=i(773768),d=i(446198);let c={siderMenu:[{id:o.DQ,name:s.j.SiderMenuMedia,position:"top",icon:()=>(0,r.jsx)(a.L_4,{}),tooltips:()=>n.ZP.t("mediz_web_a",{},"Media"),title:()=>n.ZP.t("mediz_web_a",{},"Media")}],siderMenuPanel:[{name:s.j.SiderMenuMedia,skeleton:e=>{let{containerWidth:t}=e;return(0,r.jsx)(l.Z,{containerWidth:(0,d._)(t)})}}]}},539309:function(e,t,i){i.d(t,{DQ:function(){return r},Uf:function(){return o},s_:function(){return n}});let r="Plugin";var a,n=((a={}).list="list",a.detail="detail",a.plugin="plugin",a);let o="has_shown_detail_plugins"},458115:function(e,t,i){i.d(t,{X:function(){return o}});var r=i(772322);i(225572);var a=i(97257);i(218571);var n=i(150564);let o=e=>{let{onClick:t}=e;return(0,r.jsx)(a.Z,{type:"text",size:"small",icon:(0,r.jsx)(n.N1d,{}),iconOnly:!0,onClick:t})}},118249:function(e,t,i){i.d(t,{$V:function(){return o},CJ:function(){return s},Cc:function(){return u},DQ:function(){return l},N1:function(){return a},Y5:function(){return n},Yd:function(){return d},mP:function(){return c},y2:function(){return h}});var r=i(801497);let a="recommended",n="none",o="6001";r.oc.t("web_materialSearch_title_recommend",{},"Recommended");let s=107,l="siderTabTemplate",d={id:"sider-tab-template",prefix:"siderTabTemplate"},c=280,u=700,h=19},44005:function(e,t,i){i.d(t,{P:function(){return d}});var r=i(772322);i(363791);var a=i(193568),n=i(150564),o=i(801497),s=i(204573),l=i(728631);let d={siderMenu:[{id:s.DQ,name:l.j.SiderMenuTextEditMedia,position:"top",icon:()=>(0,r.jsx)(n.Ib$,{}),tooltips:()=>o.ZP.t("web_text_edit_title_transcript",{},"Transcript"),title:()=>o.ZP.t("web_text_edit_title_transcript",{},"Transcript")}],siderMenuPanel:[{name:l.j.SiderMenuTextEditMedia,skeleton:()=>(0,r.jsx)(a.Z,{})}]}},359802:function(e,t,i){i.d(t,{P:function(){return c}});var r=i(772322),a=i(150564),n=i(801497),o=i(763695),s=i(728631),l=i(960832),d=i(446198);let c={siderMenu:[{id:o.D,name:s.j.SiderMenuStockVideo,position:"top",icon:()=>(0,r.jsx)(a.eIr,{}),tooltips:()=>n.ZP.t("stock_web_v",{},"Stock videos"),title:()=>n.ZP.t("stock_web_v",{},"Stock videos")}],siderMenuPanel:[{name:s.j.SiderMenuStockVideo,skeleton:e=>{let{containerWidth:t}=e;return(0,r.jsx)(l.e,{containerWidth:(0,d._)(t)})}}]}},207204:function(e,t,i){i.d(t,{U:function(){return o}});var r=i(183346),a=i(801497);let n=e=>e,o=()=>({key:r.F3.ChecklistBtnGuide,steps:[{target:".header-right #nav-checklist",get title(){return a.ZP.t("web_first_subscribe_text_capcut_pro",{strong:n},"CapCut Pro")},content:a.ZP.t("web_first_subscribe_text_clik_to_go",{},"You can view all Pro features and materials used in this project."),placement:"br"}],mask:!1,showSkipButton:!1,maskClosable:!0,get okText(){return a.ZP.t("web_first_subscribe_title_got_it",{},"Got it")}})},66507:function(e,t,i){i.d(t,{P:function(){return s}});var r=i(326106),a=i(302343),n=i(515379),o=i(345276);let s={titleBar:[{name:o.jR.TitlebarCollaborator,type:r._.Custom,position:"right",style:{marginRight:"12px"},orderLevel:a.r.high,order:n.r.Collaborator,contributionSymbol:o.DQ}]}},17426:function(e,t,i){i.d(t,{u:function(){return s}});var r=i(772322);i(218571);var a=i(958444),n=i(105789),o=i.n(n);i(926615);let s=e=>{let{percent:t,active:i=!1,isDisabled:n,onMouseOver:s,onMouseEnter:l,onClick:d}=e;return(0,r.jsxs)("div",{className:o()("header-percent-container header-content-bg",{disabled:n}),onClick:d,onMouseOver:s,onMouseEnter:l,children:[(0,r.jsx)("div",{className:"header-percent-text",children:`${t}%`}),i?(0,r.jsx)(a.CYX,{size:12,className:"header-icon-down"}):(0,r.jsx)(a.MQ,{size:12,className:"header-icon-down"})]})}},282022:function(e,t,i){i.d(t,{DQ:function(){return a},d4:function(){return o},jR:function(){return n}});var r=i(271368);let a="titlebarEditorActions",n={TitlebarCursorMode:"TitlebarCursorMode",TitlebarCanvasZoomSize:"TitlebarCanvasZoomSize",TitlebarDraftUndo:"TitlebarDraftUndo",TitlebarDraftRedo:"TitlebarDraftRedo",TitlebarResizeCanvas:"TitlebarResizeCanvas"},o={move:{keyBindings:{win:[r.VD.V],mac:[r.VD.V]},handleFnName:"_handleChangeCursorToMouseForShortKey"},handle_tool:{keyBindings:{win:[r.VD.H],mac:[r.VD.H]},handleFnName:"_handleChangeCursorToToolForShortKey"},undo:{keyBindings:{win:[r.N9.CTRL_WIN+r.VD.Z],mac:[r.N9.COMMAND+r.VD.Z]},handleFnName:"_handleUndoFromShortKey"},redo:{keyBindings:{win:[r.N9.SHIFT+r.N9.CTRL_WIN+r.VD.Z],mac:[r.N9.SHIFT+r.N9.COMMAND+r.VD.Z]},handleFnName:"_handleRedoFromShortKey"}}},998559:function(e,t,i){i.d(t,{P:function(){return p}});var r=i(772322),a=i(282022),n=i(157488),o=i(17426),s=i(517847),l=i(801497),d=i(806124),c=i(995370),u=i(958444),h=i(308194);let p={titleBar:[{name:a.jR.TitlebarCursorMode,type:"Custom",position:"center",contributionSymbol:a.DQ,content:e=>(0,r.jsx)(n.K,{observableData:{isDisabled:!0,cursorMode:s.W.Mouse},onClick:e.onClick,onMouseOver:e.onHover,onMouseEnter:e.onEnter})},{name:a.jR.TitlebarCanvasZoomSize,type:"Custom",position:"center",contributionSymbol:a.DQ,content:e=>(0,r.jsx)(o.u,{isDisabled:!0,percent:100,onClick:e.onClick,onMouseOver:e.onHover,onMouseEnter:e.onEnter})},{name:a.jR.TitlebarResizeCanvas,type:"Custom",position:"center",contributionSymbol:a.DQ,content:e=>(0,r.jsx)(h._,{onClick:e.onClick})},{name:a.jR.TitlebarDraftUndo,type:"Custom",position:"center",onlyShowedWhenEditable:!0,appendDividerBefore:!0,contributionSymbol:a.DQ,content:e=>(0,r.jsx)(d.K,{observableData:{isDisabled:!0},renderIcon:(0,r.jsx)(u.NO0,{size:20}),onClick:e.onClick,onMouseOver:e.onHover,onMouseEnter:e.onEnter,tooltips:{content:()=>l.ZP.t("Undo_web",{},"\u64A4\u9500"),subContent:()=>c.V5?"\u2318 Z":"Ctrl + Z"}})},{name:a.jR.TitlebarDraftRedo,type:"Custom",position:"center",onlyShowedWhenEditable:!0,contributionSymbol:a.DQ,content:e=>(0,r.jsx)(d.K,{observableData:{isDisabled:!0},renderIcon:(0,r.jsx)(u.c5m,{size:20}),onClick:e.onClick,onMouseOver:e.onHover,onMouseEnter:e.onEnter,tooltips:{content:()=>l.ZP.t("web_text_edit_button_restore",{},"\u6062\u590D"),subContent:()=>c.V5?"\u21E7 \u2318 Z":"Ctrl + Shift + Z"}})}]}},30817:function(e,t,i){i.d(t,{A:function(){return a}});var r,a=((r={}).ExportForbidViewPermission="export_forbid_view_permission",r.ExportForbidHasMaterialMiss="export_forbid_has_material_miss",r.MaterialIsBeingTransferred="material_is_being_transferred__please_wait",r.DraftHasFileFail="draft_has_file_fail",r.DraftIsEmpty="draft_is_empty_and_cannot_be_exported",r.NonLogin="export_after_logging_in",r)},153197:function(e,t,i){i.d(t,{Bt:function(){return T},GL:function(){return M},H1:function(){return P},Te:function(){return C},XX:function(){return x},Yj:function(){return v},bN:function(){return w},hN:function(){return y},iK:function(){return S},iP:function(){return R},jf:function(){return B},kV:function(){return D},my:function(){return j},nV:function(){return E},pL:function(){return V},w1:function(){return F},wm:function(){return O},z8:function(){return I}});var r=i(49299),a=i(566504),n=i(861631),o=i(972068),s=i(129219),l=i(426336),d=i(461571),c=i(173888),u=i(801497),h=i(52533),p=i(890789),_=i(218571),m=i(658096),f=i.n(m),g=i(30817);let v=[s.Sc.Algorithm,s.Sc.Gameplay,s.Sc.Matting,s.Sc.Stable,s.Sc.Pipeline];function y(e){return Object.keys(e).map(t=>{let i=!(0,h.Z)(t)&&!(0,h.Z)(e[t]),r=e[t];if(i&&"object"==typeof r)try{r=JSON.stringify(r)}catch(e){}return i?`${t}=${r}`:void 0}).filter(Boolean).join(",")}function S(e){return[c.a.PrepareFailure,c.a.UploadFailure,c.a.Sync2UserMaterialFailure].includes(e)}function w(e,t){return e.every(e=>"none"===e[t])?"none":e.map(e=>e[t]).join(",")}function b(e,t){t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)}function M(e){let t=(0,_.useRef)();return!t.current&&(t.current=function(e){try{let t=localStorage.getItem(e);return t?JSON.parse(t):void 0}catch(e){return}}(e)),[t,(0,p.Z)(b,e)]}function T(e,t){let i={};return Object.keys(e).forEach(e=>{let r=Number(e);return t&&r>=1080?(i[r]=!0,i):e}),i}let k=(e,t)=>t.some(t=>t.segments.some(t=>{if(!((null==t?void 0:t.material)&&"path"in(null==t?void 0:t.material)&&(0,r.LL)(t.material.path)))return!1;let i=e.find(e=>{var i,r;return(null==t?void 0:t.material)&&"path"in(null==t?void 0:t.material)&&(null==t?void 0:null===(r=t.material)||void 0===r?void 0:null===(i=r.path)||void 0===i?void 0:i.includes(e.key))});return i&&S(i.status)}));function x(e){let{uid:t,hasInvalidMaterial:i,hasFailSegments:r,isTemplate:a,isMaterialSyning:n,draftMaterials:o,tracks:s,draftPermission:l,draftOwnerName:c,draftEditorName:h}=e;return l===d.O.readonly?[u.oc.t("web_share_add_text_ask_for_edit",{placeholder0:c,placeholder1:h},"You don\u2019t have edit access to this space. Contact the person who created the project to ask for edit access."),g.A.ExportForbidViewPermission]:t?(i||r)&&!a?[u.oc.t("export_forbid_has_material_miss",{},"\u8BF7\u5220\u9664\u8F68\u9053\u4E0A\u4E22\u5931\u7684\u7D20\u6750\u540E\u518D\u64CD\u4F5C\u5BFC\u51FA"),g.A.ExportForbidHasMaterialMiss]:n?[u.oc.t("material_is_being_transferred__please_wait",{},"\u7D20\u6750\u8F6C\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019"),g.A.MaterialIsBeingTransferred]:k(o,s)?[u.oc.t("web_export_toast_effect_miss",{},"The video may not have a good performace since there are some materials couldn't uploaded"),g.A.DraftHasFileFail]:s.length>1||1===s.length&&s[0].segments.length?["",""]:[u.oc.t("draft_is_empty_and_cannot_be_exported",{},"\u8349\u7A3F\u4E3A\u7A7A\uFF0C\u65E0\u6CD5\u5BFC\u51FA"),g.A.DraftIsEmpty]:[u.oc.t("export_after_logging_in",{},"\u767B\u5F55\u540E\u4FBF\u53EF\u5BFC\u51FA"),g.A.NonLogin]}function I(e,t){switch(!0){case!e||!t:return[!1,o.B9.error];case e<=1080&&t>36e6:return[!1,o.B9.lte_1080p_36000s];case e>1080&&t>54e5:return[!1,o.B9.gt_1080p_5400s];default:return[!0]}}function P(){return{}}function E(e,t,i){let r=(0,n.xn)({width:e,height:t});return(0,n.qK)(i,r)}function C(){return`${f().generate()}${f().generate()}${f().generate()}${f().generate()}`}function D(e){return((0,a.ad)(e)||(0,a.ov)(e))&&((0,r.iI)(e.material.path)||(0,r.LL)(e.material.path))}function F(e){return e.reduce((e,t)=>t.type===l.pNd.TrackTypeAudio||t.type===l.pNd.TrackTypeVideo?e.concat(t.segments.filter(D)):e,[])}let A="lvve-video-add-cover-for-opening-when-export";function R(){var e;return(null!==(e=window.localStorage.getItem(A))&&void 0!==e?e:"1")==="1"}function j(e){window.localStorage.setItem(A,e?"1":"0")}let O=(e,t)=>{let i=Object.keys(t),r=new Set;for(let n of i)if(e.includes(n)){let e=t[n];for(let t of v){var a;(null===(a=e.get(t))||void 0===a?void 0:a.status)===s.xR.Running&&r.add(n)}}return Array.from(r)};function B(e){return[c.a.Prepared,c.a.Preparing,c.a.WaitingUpload,c.a.Uploading].includes(e.status)||!e.md5}function V(e){var t,i,r,a,n;if(e.status===c.a.UploadFailure){let n=null===(i=e.uploading)||void 0===i?void 0:null===(t=i.error)||void 0===t?void 0:t.code,o=null===(a=e.uploading)||void 0===a?void 0:null===(r=a.error)||void 0===r?void 0:r.msg;return y({fileName:e.filename,status:e.status,md5:e.md5,errCode:n,errMsg:o})}{let{assetId:t}=e;return y({fileName:e.filename,status:e.status,md5:e.md5,assetId:t,progress:null===(n=e.uploading)||void 0===n?void 0:n.progress,size:e.size})}}},804251:function(e,t,i){i.d(t,{P:function(){return l}});var r=i(772322),a=i(540266),n=i(515379),o=i(913417),s=i(326106);let l={titleBar:[{name:a.jR.TitlebarExport,type:s._.Custom,position:"right",style:{marginRight:"8px"},order:n.r.Export,contributionSymbol:a.DQ,content:e=>(0,r.jsx)(o.Z,{visuallyDisabled:!0,showIcon:!0,onClick:e.onClick,onMouseEnter:e.onEnter})}]}},375654:function(e,t,i){i.d(t,{D:function(){return r},j:function(){return a}});let r="titlebarJoinSpace",a={TitlebarJoinSpace:r}},693289:function(e,t,i){i.d(t,{P:function(){return s}});var r=i(326106),a=i(302343),n=i(375654),o=i(515379);let s={titleBar:[{name:n.j.TitlebarJoinSpace,type:r._.Custom,position:"right",style:{marginRight:"8px"},orderLevel:a.r.high,order:o.r.JoinSpace,contributionSymbol:n.D}]}},205876:function(e,t,i){i.d(t,{P:function(){return s}});var r=i(326106),a=i(515379),n=i(528150),o=i(768133);let s={titleBar:[{name:n.j.TitlebarToolbarPCDownload,type:r._.Custom,position:"right",order:a.r.PCDownload,contributionSymbol:n.D,content:()=>null,showInMenu:{priority:o.Yg.FixedMode,group:o.kS.FixedMode,withMenu:!1,priorityInMenu:o.$9.FixedMode}}]}},402309:function(e,t,i){i.d(t,{s:function(){return s}});var r=i(772322),a=i(958444),n=i(105789),o=i.n(n);i(235066);let s=e=>{let{onClick:t,onMouseOver:i,onMouseEnter:n,isDisabled:s}=e;return(0,r.jsx)("div",{id:"cloud-draft-async",onClick:t,onMouseOver:i,onMouseEnter:n,children:(0,r.jsx)(a.o0l,{className:o()("save-status-iconpark-icon",{disabled:s})})})}},879601:function(e,t,i){i.d(t,{V:()=>w,Z:()=>b});var r=i("772322");i("17435"),i("701840"),i("55041"),i("931598");var a=i("629913"),n=i("794571"),o=i("519065"),s=i("16464"),l=i("218571"),d=i("801497"),c=i("958444"),u=i("150564"),h=i("991340"),p=i("343828");i("544499");let _=e=>{var t;let{selectedThemeMode:i,setSelectedThemeMode:a,onThemeModeChange:n}=e,s={[p.h.Light]:d.ZP.t("web_graphic_light_theme",{},"Light Theme"),[p.h.Dark]:d.ZP.t("web_graphic_dark_theme",{},"Dark Theme")};return(0,r.jsx)(o.Z,{className:"locale-menu-container",selectedKeys:[null!=i?i:p.h.Light],children:null===(t=Object.keys(s))||void 0===t?void 0:t.map(e=>(0,r.jsxs)(o.Z.Item,{onClick:()=>{n(e),null==a||a(e)},children:[s[e],e===i?(0,r.jsx)(c.EgK,{size:20}):null]},e))})};var m=i("691805");let f=e=>{let{selectedInputPreference:t,onInputPreferenceChange:i}=e,a=[{label:d.ZP.t("web_subtitle_button_preference_left_right",{},"Left to right"),value:m.Q.Ltr},{label:d.ZP.t("web_subtitle_button_preference_right_left",{},"Right to left"),value:m.Q.Rtl}];return(0,r.jsx)(o.Z,{className:"user-menu-container",selectedKeys:[null!=t?t:a[0].value],children:a.map(e=>(0,r.jsxs)(o.Z.Item,{onClick:()=>i(e.value),children:[e.label,e.value===t?(0,r.jsx)(c.EgK,{size:20}):null]},e.value))})};var g=i("568998"),v=i("670933");i("603124");var y=i("105789"),S=i.n(y);let w=function(){let{isDisabled:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isDisabled:!1};return(0,r.jsx)("div",{className:S()("settings-nav-action-btn",{disabled:e}),children:(0,r.jsx)(u.I_I,{width:20,height:20})})},b=(0,v.Pi)(e=>{let{observableData:t,getCurrentLocale:i,getSupportLocales:p,onLanguageChange:m,onThemeModeChange:v,onInputPreferenceChange:y,loginAndSavePackage:S,isDetailRender:b,hideTheme:M,hideLanguage:T}=e,{userProfile:k,themeMode:x,inputPreference:I}=t,{uid:P}=k,[E,C]=(0,l.useState)(x),[D,F]=(0,l.useState)(!1),A=(0,l.useMemo)(()=>{var e;let t=i();return null===(e=p().find(e=>e.locale===t))||void 0===e?void 0:e.text},[]),R=(0,r.jsx)(o.Z.SubMenu,{triggerProps:{className:"locale-dropdown",popupAlign:{left:10}},title:(0,r.jsxs)("div",{className:"menu-submenu-locale",children:[(0,r.jsx)(c.P_r,{size:20}),(0,r.jsx)("span",{className:"menu-title",children:`${d.ZP.t("language_web",{},"Language")}: ${A}`}),(0,r.jsx)("div",{className:"menu-submenu-icon",children:(0,r.jsx)(g.U8A,{color:"var(--lvv-color-text-tertiary)"})})]}),children:(0,r.jsx)(h.Z,{getCurrentLocale:i,getSupportLocales:p,onLanguageChange:m})},"3"),j=(0,r.jsx)(o.Z.SubMenu,{triggerProps:{className:"locale-dropdown",popupAlign:{left:10}},title:(0,r.jsxs)("div",{className:"menu-submenu-locale",children:[(0,r.jsx)(c.lTF,{size:20}),(0,r.jsx)("span",{className:"menu-title",children:d.ZP.t("web_graphic_theme",{},"Theme")}),(0,r.jsx)("div",{className:"menu-submenu-icon",children:(0,r.jsx)(g.U8A,{color:"var(--lvv-color-text-tertiary)"})})]}),children:(0,r.jsx)(_,{onThemeModeChange:v,selectedThemeMode:E,setSelectedThemeMode:C})},"4"),O=(0,r.jsx)(o.Z.SubMenu,{triggerProps:{className:"locale-dropdown",popupAlign:{left:10}},title:(0,r.jsxs)("div",{className:"menu-submenu-locale",children:[(0,r.jsx)(u.TLM,{size:20}),(0,r.jsx)("span",{className:"menu-title",children:d.ZP.t("web_subtitle_button_preference",{},"Input preferences")}),(0,r.jsx)("div",{className:"menu-submenu-icon",children:(0,r.jsx)(g.U8A,{color:"var(--lvv-color-text-tertiary)"})})]}),children:(0,r.jsx)(f,{selectedInputPreference:I,onInputPreferenceChange:y})},"5"),B=(0,r.jsxs)(r.Fragment,{children:[!T&&R,!M&&j,O]}),V=(0,r.jsxs)(o.Z,{selectable:!1,children:[(0,r.jsx)("div",{className:"menu-type-title",children:d.ZP.t("web_exportlogic_text_more_setting",{},"Settings")}),B]}),N=(0,r.jsxs)(o.Z,{selectable:!1,children:[(0,r.jsx)(o.Z.Item,{className:"menu-item-user-tab",children:(0,r.jsxs)("div",{className:"menu-item-sign-btn",onClick:()=>S(),children:[(0,r.jsx)(c.PSW,{size:20}),(0,r.jsx)("span",{className:"menu-item-sign-text",children:d.ZP.t("web_log_in_to_save",{},"Sign in")})]})},"1"),(0,r.jsx)(o.Z.Item,{className:"menu-item-divider",children:(0,r.jsx)(n.Z,{className:"graphic-divider"})},"2"),B]});return b?B:(0,r.jsx)("div",{className:`header-avatar-container ${D?"user-drop-down-visible":""}`,children:(0,r.jsx)(a.Z,{trigger:"hover",content:d.ZP.t("web_exportlogic_text_more_setting",{},"Settings"),children:(0,r.jsx)(s.Z,{triggerProps:{className:"header-avatar-dropdown",trigger:"click"},droplist:P?V:N,position:"bl",unmountOnExit:!1,onVisibleChange:e=>{F(e)},children:w()})})})})},851621:function(e,t,i){i.d(t,{D:function(){return r},N:function(){return a}});let r="toolbarAudioBasic",a="basic"},266476:function(e,t,i){i.d(t,{P:function(){return d}});var r=i(772322),a=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(67323).D,name:a.j.ToolbarAudioSpeed,type:"unpin",icon:()=>(0,r.jsx)(o.fDY,{fontSize:20}),title:()=>n.ZP.t("speed_web",{},"Speed"),groups:[s.D.Audio]}],toolBarPanel:[{name:a.j.ToolbarAudioSpeed,content:(0,r.jsx)(l.v,{})}]}},682942:function(e,t,i){i.d(t,{K:()=>h});var r=i("772322");i("17435"),i("339605");var a=i("629913"),n=i("667058"),o=i("218571"),s=i("186087"),l=i("105789"),d=i.n(l),c=i("162183");let u=e=>e.clientHeight<e.scrollHeight;i("567675");let h=(0,c.Q)(e=>{var t,i;let l=(0,o.useRef)(null),[c,h]=(0,o.useState)(!1);(0,o.useEffect)(()=>{h(function(e){var t;if(!e)return!1;return(t=e).scrollWidth>t.clientWidth||u(e)}(l.current))},[e.description]);let p=(0,o.useMemo)(()=>c?(0,r.jsx)(a.Z,{content:e.description,children:(0,r.jsx)("div",{className:"attribute-switch-field-des1",ref:l,children:e.description})}):(0,r.jsx)("div",{className:"attribute-switch-field-des1",ref:l,children:e.description}),[c]);return(0,r.jsx)("div",{className:`attribute-switch-field ${null!==(i=e.className)&&void 0!==i?i:""}`,children:(0,r.jsxs)("div",{className:"attribute-switch-field-top",children:[e.logo?(0,r.jsx)("div",{className:"attribute-switch-field-logo",children:e.logo}):null,(0,r.jsxs)("div",{className:"attribute-switch-field-present",children:[(0,r.jsxs)("div",{className:d()("attribute-switch-field-title",{"show-guide-point":e.showGuidePoint}),children:[e.title,!!e.tips&&(0,r.jsx)(a.Z,{content:null===(t=e.tips)||void 0===t?void 0:t.content,children:(0,r.jsx)(s.Z,{className:"attribute-switch-field-icon",fontSize:15})}),e.externalIcon?(0,r.jsx)("div",{className:"attribute-switch-field-external-icon",children:e.externalIcon}):null]}),e.description?p:null]}),(0,r.jsx)(a.Z,{content:e.disabledTip,children:(0,r.jsx)(n.Z,{className:"attribute-switch-field-button",disabled:e.disabled,checked:e.checked,onChange:e.onChange,loading:e.loading,onPointerUp:()=>{var t;return null===(t=e.onPointerUp)||void 0===t?void 0:t.call(e,e.disabled,e.loading)}})})]})})})},612809:function(e,t,i){i.d(t,{v:function(){return o}});var r=i(772322);i(837510);var a=i(948747);i(218571);let n={display:"flex",justifyContent:"center",alignItems:"center",margin:"1rem",minHeight:"254px"},o=()=>(0,r.jsx)("div",{style:n,children:(0,r.jsx)(a.Z,{})})},717026:function(e,t,i){i.d(t,{L:function(){return h},r:function(){return u}});var r=i(772322),a=i(498780),n=i(218571),o=i(611818),s=i(413798),l=i(736323),d=i(141913);i(795883);let c=(0,d.fi)(async()=>{let{EChartContainer:e}=await Promise.all([i.e("3295"),i.e("3695"),i.e("3379"),i.e("57"),i.e("8290"),i.e("7912"),i.e("2785"),i.e("7257"),i.e("4947"),i.e("2646"),i.e("3303"),i.e("2420"),i.e("4223"),i.e("1589"),i.e("7732"),i.e("526"),i.e("8426"),i.e("4976"),i.e("2490"),i.e("2879"),i.e("2134"),i.e("9131"),i.e("3156"),i.e("3815"),i.e("5154"),i.e("4734"),i.e("9746"),i.e("3873"),i.e("2555"),i.e("1293"),i.e("8845"),i.e("9189"),i.e("594"),i.e("9439"),i.e("2699"),i.e("4320"),i.e("7126"),i.e("5782"),i.e("1759"),i.e("2544"),i.e("9969"),i.e("5056"),i.e("606"),i.e("1138"),i.e("2170"),i.e("4351"),i.e("3265"),i.e("6393"),i.e("4577"),i.e("3484"),i.e("2271"),i.e("1779"),i.e("5701"),i.e("7709"),i.e("8196"),i.e("6009"),i.e("8243"),i.e("1735"),i.e("394"),i.e("333"),i.e("8743"),i.e("4666"),i.e("2097"),i.e("1895"),i.e("5946"),i.e("9835"),i.e("8223"),i.e("4237"),i.e("9519"),i.e("4331"),i.e("3832"),i.e("7324"),i.e("6960"),i.e("8002"),i.e("145"),i.e("7707"),i.e("998"),i.e("1357"),i.e("2536"),i.e("6687"),i.e("1365"),i.e("4460"),i.e("935"),i.e("1311"),i.e("6056"),i.e("9098"),i.e("3830"),i.e("3235"),i.e("4349"),i.e("5609"),i.e("9356"),i.e("5011"),i.e("1573"),i.e("9256"),i.e("1483"),i.e("4042"),i.e("9046"),i.e("7475"),i.e("4046"),i.e("4570"),i.e("5625"),i.e("5977"),i.e("6692"),i.e("4023"),i.e("4837"),i.e("8146"),i.e("9194")]).then(i.bind(i,43982));return{default:e}}),{preload:u}=c,h=e=>{let{segment:t,points:i,curveEditorModel:d,curveColorType:u}=e,h=(0,n.useCallback)(e=>{d.setActiveColorType(e)},[]);(0,a.default)(()=>{u!==l.wD.Luma&&d.setActiveColorType(u)});let p=(0,n.useMemo)(()=>(0,r.jsx)(o.c,{segment:t,curveEditorModel:d}),[t,d.canReset]);return(0,r.jsxs)("div",{className:"attribute-color-curves-chart",children:[p,(0,r.jsxs)("div",{className:"attribute-color-curves-chart-main",children:[(0,r.jsx)(s.V,{onToggle:h,curveColorType:u}),(0,r.jsx)(n.Suspense,{children:(0,r.jsx)(c,{points:i,curveColorType:u,curveEditorModel:d})})]})]})}},436597:function(e,t,i){i.d(t,{Y:function(){return s}});var r=i(218571),a=i(736323),n=i(392486),o=i(262319);let s=function(e,t,i){var s,l,d;let c=!(arguments.length>3)||void 0===arguments[3]||arguments[3],[u,h]=(0,r.useState)(null!==(d=null===(l=t.getPresetCache())||void 0===l?void 0:null===(s=l.activeName)||void 0===s?void 0:s[e.id])&&void 0!==d?d:""),p=(0,r.useCallback)(i=>{var r,o,s,l;if(i.name===u)return;h(i.name),i&&t.updateCurvePreset(null!=i?i:null);let d=null!==(s=t.getPresetCache())&&void 0!==s?s:{activeName:{}};!d.activeName&&(d.activeName={}),d.activeName[e.id]=i.name,t.setPresetCache(d),t.updateControlSelectedIndex(null),t.handleReportAdjust(a.aR.choosePreset);let p=c&&null!==(l=null===(o=d.presetPoints)||void 0===o?void 0:null===(r=o.find(e=>e.name===i.name))||void 0===r?void 0:r.points)&&void 0!==l?l:(0,n.gy)(i.curveValue);t.setIsPreview(!1),t.onAfterChange(p)},[u,e,c]);if(!t.curvePreset&&i.length){let e=i.find(e=>e.name===u);e&&t.updateCurvePreset(null!=e?e:null)}return(0,r.useEffect)(()=>{if(!u&&i.length>0){h(i[0].name);let r=(0,o.jL)(e);!(null==r?void 0:r.colorCurves)&&t.onAfterChange((0,n.gy)(i[0].curveValue),!1)}t.updateCustomPreset(i[0]);let r=i.find(e=>e.name===u);r&&t.updateCurvePreset(null!=r?r:null)},[u,e,i]),{activeId:u,handleSelect:p}}},517649:function(e,t,i){i.d(t,{JP:function(){return n},bR:function(){return a}});var r,a=((r={}).intensity="intensity",r.shadow="shadow",r.edgeSmooth="edge_smooth",r.spill="spill",r);let n=.4},118642:function(e,t,i){i.d(t,{LG:function(){return c},O_:function(){return u},Pv:function(){return o},RV:function(){return d},Rn:function(){return l},p$:function(){return s},th:function(){return n}});var r=i(426336),a=i(211570);let n=(e,t,i,r)=>{let a=e.draftView.getMultiplePropertyValues(t.id,[r],i);return a.length>0?a[0]:[0]},o=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let a=new Set(i);return e.commonKeyframes.some(e=>a.has(e.propertyType)&&e.keyframeList.length>0)},s=(e,t,i,a,n)=>{let o="";if((0,r.hey)(t)||(0,r.Y9Q)(t)){var s,l;o=(null==t?void 0:null===(l=t.voiceChange)||void 0===l?void 0:null===(s=l[0])||void 0===s?void 0:s.id)||""}e.api.keyframe.add({segmentId:t.id,keyframeType:n,dataParam:{playHead:i,datas:a},materialId:o})},l=(e,t,i,n)=>{let o=e.api.batch.batchStart(),l=!1;for(let r of n)s(e,t,i,r.values,r.type),a.x.includes(r.type)&&(l=!0);l&&t.videoTracking&&((0,r.P2T)(t)?e.api.sticker.removeVideoTracker({segId:t.id}):(0,r.Ftn)(t)?e.api.text.removeVideoTracker({segId:t.id}):(0,r.Q2R)(t)&&e.api.textTemplate.removeVideoTracker({segId:t.id})),e.api.batch.batchEnd(o)},d=(e,t,i,r)=>{e.api.keyframe.delete({segmentId:t.id,keyframeId:r,keyframeTypeList:[i]})},c=(e,t,i)=>{let r=e.api.batch.batchStart();for(let r of i)d(e,t,r.type,r.id);e.api.batch.batchEnd(r)},u=(e,t,i,r)=>{e.api.keyframe.delete({segmentId:t.id,keyframeTypeList:i,draftId:r})}},734412:function(e,t,i){i.d(t,{DQ:function(){return o},Dy:function(){return u},N3:function(){return l},_M:function(){return c},jR:function(){return s},ry:function(){return d}});var r,a=i(772270),n=i(241254);let o="toolbarDigitalHuman",s={ToolbarDigitalHuman:"ToolbarDigitalHuman"},l="ai_character",d="RECENT_DIGITAL_HUMAN_TONE_KEY";var c=((r={})[r.Normal=0]="Normal",r[r.Appearance=1]="Appearance",r[r.Background=2]="Background",r);let u={aid:null!==a.AF&&void 0!==a.AF?a.AF:348188,device_platform:"web",region:window.__locationCountryCode||"us",scenario:n.HI.VideoEditor,feature_key:n._A.TextToSpeech,feature_entrance:n.zU.Editor,feature_entrance_detail:`${n.zU.Editor}-feature-ai_avatar-${n._A.TextToSpeech}`}},498614:function(e,t,i){i.d(t,{D:function(){return r},N:function(){return a}});let r="toolbarEffectBasic",a="basic"},931753:function(e,t,i){i.d(t,{P:function(){return d}});var r=i(772322),a=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(767732).D,name:a.j.ToolbarMutableTextBasic,type:"unpin",icon:()=>(0,r.jsx)(o.lFi,{fontSize:20}),title:()=>n.ZP.t("web_text",{},"Text"),groups:[s.D.Text,s.D.Mutable,s.D.Caption,s.D.Audio]}],toolBarPanel:[{name:a.j.ToolbarMutableTextBasic,content:(0,r.jsx)(l.v,{})}]}},235514:function(e,t,i){i.d(t,{P:function(){return d}});var r=i(772322),a=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(471202).D,name:a.j.ToolbarTextMotion,type:"unpin",icon:()=>(0,r.jsx)(o._SE,{fontSize:20}),title:()=>n.ZP.t("web_materialSearch_text_motion",{},"Motion"),groups:[s.D.Text,s.D.Caption],order:0}],toolBarPanel:[{name:a.j.ToolbarTextMotion,content:(0,r.jsx)(l.v,{})}]}},443981:function(e,t,i){i.d(t,{DQ:function(){return n},L8:function(){return s},N3:function(){return o},xo:function(){return l}});var r,a=i(801497);let n="toolbarTextPreset",o="preset";var s=((r={}).Basic="basic",r.Templates="templates",r);let l=[{key:"basic",get title(){return a.oc.t("web_caption_presets_styles",{},"Style")}},{key:"templates",get title(){return a.oc.t("web_caption_presets_templates",{},"Templates")}}]},12066:function(e,t,i){i.d(t,{D:function(){return r},N:function(){return a}});let r="toolbarTextTemplateBasic",a="basic"},103805:function(e,t,i){i.d(t,{P:function(){return d}});var r=i(772322),a=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(989994).D,name:a.j.ToolbarTextTemplateMotion,type:"unpin",icon:()=>(0,r.jsx)(o._SE,{fontSize:16}),title:()=>n.ZP.t("web_materialSearch_text_motion",{},"Motion"),groups:[s.D.TextTemplate],order:0}],toolBarPanel:[{name:a.j.ToolbarTextTemplateMotion,content:(0,r.jsx)(l.v,{})}]}},262088:function(e,t,i){i.d(t,{H:function(){return n}});var r=i(937802),a=i(896413);let n=e=>{let{segment:t}=e,{smartToolsManager:{basicSmartToolManager:i}}=(0,r.G)(a.a),{enable:n,reason:o}=i.deflickerCheck(t);return{enable:n,reason:o}}},501887:function(e,t,i){i.d(t,{W:function(){return r}});let r=(e,t)=>{let i={"6976822940608238093":"Smooth","7019182177380209153":"Brighten","7019182285542920706":"White teeth","7130176030764962305":"Smile lines","7130176030802711041":"Dark circles","7158739772733657602":"Korean Schoolgirl","7158739772742046209":"Orange Sea","7158739772733690369":"Mashed Taro Boo","7158739772733673986":"Eileen Makeup","7158739773601878530":"mystic","7158739772733690370":"Killer Smoke","7158739773555741185":"Angel Makeup","7158739773593489921":"California Sunset","7158739773497020929":"Free Freckles","7158739772788183554":"Surnatural Freckles","7158755064616587778":"Natural Nude","7158756142250725889":"Strawberry Iced Tea","7158756204599054849":"Soft Pink","7158755294980346370":"Ice Extract Americano","7158755530012365314":"Rouge","7158755624547783169":"Rudy","7158755458193297922":"Spirit","7158755717623583233":"Mouth Black","7158748239158579714":"Nude makeup","7158746687677141506":"Orange","7158747823645659649":"Cream Powder Brown","7158747064812179969":"mystic","7158748159139648002":"Killer Smoke","7158747168021418497":"California Sunset","7158746891818111489":"Innocent","7158748001165382146":"Smoky","7158759513552589313":"Salt","7158759182655558146":"Wild","7158762300193640962":"Fairy Eyelashes","7158760070040261121":"Smart","7158759261768520193":"Western","7158759987785765378":"Nature","7158761955170193922":"Little Devil","7158762163207672322":"Internet Celebrity Style","7134558897590768130":"Brow Height","7134558898819699201":"Nasal Root","7134558899008442881":"Nose Height","7134558897448227330":"Nose Size","7130178350013747713":"Mouth Height","7130178350013764097":"Short Face","7130178350013747714":"Thin Face","7130178350017942018":"Cheekbones","7130176029557019137":"Jawline","7130178350013796866":"Chin Length","7019182024527188481":"Big Eyes","7130178350009553409":"Eyes Height","7019182100469256705":"Slim nose","7130178350013796865":"Mouth Size","6956089104412971534":"Legs","6977639534938821121":"Slim","6977639665473950210":"Waist","6977639776321016322":"Head","7134583375607632386":"Smooth","7134583242732081666":"Brighten"};return i[e.resourceId]||i[e.thirdResourceId||""]||e.name||t||"\u6CA1\u6709\u540D\u79F0\u7684\u7279\u6548"}},689342:function(e,t,i){i.d(t,{DQ:function(){return r},N3:function(){return o},Rc:function(){return n},rb:function(){return s}});let r="toolbarVideoElement";var a,n=((a={}).Clip="clip",a.TEXT="text",a.AUDIO="audio",a);let o="element",s=".attribute-element-wrapper"},648973:function(e,t,i){i.d(t,{J:function(){return _}});var r=i(789786),a=i(772322);i(837510),i(784923);var n=i(948747),o=i(498417),s=i(801497),l=i(484829),d=i(195291),c=i(218571),u=i(313820),h=i(797913);let p=(0,c.forwardRef)((e,t)=>{let[r,n]=o.Z.useMessage(),s=(0,c.useRef)(void 0);return(0,c.useImperativeHandle)(t,()=>({info:t=>{var n;s.current=null==r?void 0:null===(n=r.info)||void 0===n?void 0:n.call(r,{content:t,duration:0,id:"digital-human-progress-msg",icon:e.icon||(0,a.jsx)("div",{style:{background:"#fff",borderRadius:20,height:20,width:20},children:(0,a.jsx)("img",{style:{width:20,height:20},src:i(962965),alt:""})})})},success:e=>{var t;null==r||null===(t=r.success)||void 0===t||t.call(r,e)},close:()=>{var e;null===(e=s.current)||void 0===e||e.call(s)}})),(0,a.jsx)(a.Fragment,{children:n})});class _{_renderNoticeDom(){let e=document.getElementById("workbench-editor-container")||document.body,t=document.createElement("div");t.className=u.Z["manager-container"],e.appendChild(t),d.render((0,a.jsx)(p,{ref:this._noticeRef,icon:this._type===l.V5.RemoveBackground?(0,a.jsx)("div",{style:{borderRadius:20,height:20,width:20},children:(0,a.jsx)(n.Z,{loading:!0,spinColor:"white"})}):""}),t)}_getText(e,t){let{progress:i,count:r=0}=t;if(this._type===l.V5.RemoveBackground)return"progress"===e?s.ZP.t("remove_bg_remove_inprogress_toast",{percentage:Math.floor(i)},"Removing background...{percentage}%"):s.ZP.t("remove_bg_remove_success_toast",{},"Background removed");if("progress"===e){var a;let e=null!==(a=this._videoConfigurationService.getAppConfigurationValue("starlingKey.digitalHuman.applying"))&&void 0!==a?a:"web_edit_text_ai_applying";return`${s.ZP.t(e,{number0:this._taskList.length,num:this._taskList.length},"Applying {number0} characters...")} ${Math.floor(i)}%`}return s.ZP.t("web_edit_text_applied",{number0:r,num:r},"{number0} characters applied")}update(e){var t,i;if(this._taskList=e,this._taskList.length){let e=this._taskList.reduce((e,t)=>{var i;return e+(null!==(i=t.progress)&&void 0!==i?i:0)},0)/this._taskList.length;null===(i=this._noticeRef.current)||void 0===i||i.info(this._getText("progress",{progress:e}))}else null===(t=this._noticeRef.current)||void 0===t||t.close()}updateSuccess(e){if(e){var t;null===(t=this._noticeRef.current)||void 0===t||t.success(this._getText("success",{progress:100,count:e}))}}constructor(e,t){this._videoConfigurationService=t,this._noticeRef=(0,c.createRef)(),this._type=null!=e?e:l.V5.Generate,this._taskList=[],this._renderNoticeDom(),this.update=this.update.bind(this)}}_=(0,r.gn)([(0,r.fM)(1,h.J),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===l.V5?Object:l.V5,void 0===h.J?Object:h.J])],_)},794821:function(e,t,i){i.d(t,{D:function(){return n}});var r=i(772270),a=i(241254);let n={aid:null!==r.AF&&void 0!==r.AF?r.AF:348188,device_platform:"web",region:window.__locationCountryCode||"us",scenario:a.HI.VideoEditor,feature_key:a._A.TextToSpeech,feature_entrance:a.zU.Editor,feature_entrance_detail:`${a.zU.Editor}-feature-ai_avatar-${a._A.TextToSpeech}`}},231502:function(e,t,i){i.d(t,{v:function(){return m}});var r=i(789786),a=i(932099),n=i(426336),o=i(433140),s=i(127830),l=i(593642),d=i(690613),c=i(909034),u=i(756024),h=i(82978),p=i(857670),_=i(380455);class m{updateRenderManager(e){this._renderManager=e}async add(e,t,i){let r;if(!this._renderManager)return(0,a.u_)(h.o.RenderManagerUndefined);let o=(0,d.oW)(""),s=(0,l.Rl)(),{uiSegmentId:p}=this._callbackOptions.beforeAddSegment(e,t,s);try{let d;this._callbackOptions.beforeEnsureResource(e);try{d=await (0,c.Z0)(e.value,this._ensureManager,this._renderManager,this._resourceService)}catch(e){return u.t.error(e),o=(0,a.u_)(h.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,d)}if(!d)return o=(0,a.u_)(h.o.MissResource);let p=this._dataSdk.api.batch.batchStart();try{if(t.needInsertTargetTrack){let e=(0,a.HU)(this._dataSdk);if(!e.ok||0!==t.trackIndex&&!(e=this._dataSdk.api.track.add({trackIndex:t.trackIndex,track:new n.fQ8({id:(0,l.Rl)(),type:n.pNd.TrackTypeVideoEffect,flag:n.w9k.FlagNone})})).ok)return o=(0,a.u_)(h.o.AddTrack)}if(r=this._resourceToEffectParam(e.value,t,d.segmentPath,this._dataSdk.draftView.getAllTracks()[t.trackIndex].id,s,i),!(o=this._dataSdk.api.effect.add(r)).ok)return o=(0,a.u_)(h.o.AddSegment)}catch(e){return u.t.error(e),o=(0,a.u_)(h.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(p)}}catch(e){u.t.error(e),o=(0,a.u_)(h.o.Unknown)}finally{this._callbackOptions.afterAddSegment(o.ok?null==r?void 0:r.segmentId:void 0,p)}return o}addToCurrentProgress(e,t){if(!this._renderManager)return(0,a.u_)(h.o.RenderManagerUndefined);let i=(0,p.i1)(this._renderManager.progress),{needToInsert:r,trackIndex:o}=this._dataSdk.draftView.findTrackIndexToInsert(n.pNd.TrackTypeVideoEffect,i,a.zx);return this.add(e,{start:i,trackIndex:o,needInsertTargetTrack:r},t)}_resourceToEffectParam(e,t,i,r,o,l){var d;return{trackId:r,applyType:n.nH8.AllVideo,segmentId:o,targetTimeRange:{start:t.start,duration:null!==(d=t.duration)&&void 0!==d?d:a.zx},material:(0,n.ABm)({path:i,name:e.name,effectId:e.effectId,resId:e.resourceId,value:1,adjustParams:e.adjustParams.map(e=>({adjustKey:e.effectKey,adjustValue:e.default,defaultValue:e.default,flags:0n})),type:e.effectType===s._g.Effects?n.cVg.MetaTypeVideoEffect:n.cVg.MetaTypeFaceEffect,categoryId:null==l?void 0:l.materialThirdcategoryId,categoryName:null==l?void 0:l.materialThirdcategory,sourcePlatform:_.t.toSourcePlatform(e.source)})}}constructor(e,t,i,r,a){this._dataSdk=e,this._renderManager=t,this._ensureManager=i,this._callbackOptions=r,this._resourceService=a}}m=(0,r.gn)([(0,r.fM)(4,o.c),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===o.c?Object:o.c])],m)},670010:function(e,t,i){i.d(t,{D:function(){return w}});var r=i(789786),a=i(211808),n=i(433140),o=i(127830),s=i(249656),l=i(932099),d=i(426336),c=i(593642),u=i(690613),h=i(801497),p=i(460254),_=i(909034),m=i(756024),f=i(563431),g=i(82978),v=i(857670),y=i(380455),S=i(820193);class w{updateRenderManager(e){this._renderManager=e}_loadBrandTextSchema(e){return new Promise((t,i)=>{let r=(0,S.nQ)(this._resourceService,o._g.TextPreset,e).getPresetSchemaResourceToken();r.start(),r.onReady(()=>{var e;let i=new TextDecoder("utf-8").decode(null===(e=r.value)||void 0===e?void 0:e.buffer);t(i?JSON.parse(i):void 0)}),r.onError(i)})}async ensureResourceByType(e){let t=(0,u.oW)("");if(!this._renderManager)return{resourceFailResult:t=(0,l.u_)(g.o.RenderManagerUndefined),resourceRecord:void 0};if(e.type===p.r.BrandText){let o={textPreset:void 0,fontPath:"",fontSource:s.Hw.LOKI,brandTextParams:void 0,segmentPath:"",resPath:""};this._callbackOptions.beforeEnsureResource(e);try{var i,r,n;let s=await this._loadBrandTextSchema(e.value);if(!s)return{resourceFailResult:t=(0,l.u_)(g.o.EnsureResource),resourceRecord:o};o.brandTextParams=s;let{flowerResId:d,font_resource_id:c,light_res_id:u}=s.style;if(u){let t=null===(i=e.value.brandSubItemList)||void 0===i?void 0:i.find(e=>e.resourceId===u);if(t){let e=await (0,_.sT)(t,this._ensureManager,this._renderManager,this._resourceService);o.textGlow=e}}if(c){let t=(null!==(r=e.value.brandSubItemList)&&void 0!==r?r:[]).find(e=>e.resourceId===c);if(t){o.fontPath=await (0,_.kF)(t,this._ensureManager,this._renderManager);let e=s.resources.find(e=>e.resource_id===c);o.fontSource=e?(0,a.hh)(e.source_platform):t.source}}if(d){let t=(null!==(n=e.value.brandSubItemList)&&void 0!==n?n:[]).find(e=>e.resourceId===d);if(t){let e=await (0,_.mr)(t,this._ensureManager,this._renderManager,this._resourceService).catch(()=>null);o.textPreset=null!=e?e:void 0}}return{resourceRecord:o,resourceFailResult:t}}catch(e){m.t.error(e),t=(0,l.u_)(g.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,o)}}if(e.type===p.r.TextPreset){let i;this._callbackOptions.beforeEnsureResource(e);try{i=await (0,_.mr)(e.value,this._ensureManager,this._renderManager,this._resourceService)}catch(e){m.t.error(e),t=(0,l.u_)(g.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,i)}return!i&&(t=(0,l.u_)(g.o.MissResource)),{resourceRecord:i,resourceFailResult:t}}return{resourceRecord:void 0,resourceFailResult:t}}ensureAddInTrack(e){let t=(0,u.oW)("");if(e.needInsertTargetTrack){let i=(0,l.HU)(this._dataSdk);!i.ok&&(t=(0,l.u_)(g.o.AddTrack)),0!==e.trackIndex&&!(i=this._dataSdk.api.track.add({trackIndex:e.trackIndex,track:new d.fQ8({id:(0,c.Rl)(),type:d.pNd.TrackTypeText,flag:d.w9k.FlagNone})})).ok&&(t=(0,l.u_)(g.o.AddTrack))}return t}async add(e,t,i){let r;if(!this._renderManager)return(0,l.u_)(g.o.RenderManagerUndefined);let a=(0,u.oW)(""),n=(0,c.Rl)(),{uiSegmentId:o}=this._callbackOptions.beforeAddSegment(e,t,n);try{let o=this._dataSdk.api.batch.batchStart();try{let{resourceRecord:o,resourceFailResult:s}=await this.ensureResourceByType(e);if(!s.ok)return s;let d=this.ensureAddInTrack(t);if(!d.ok)return d;if(r=void 0,e.type===p.r.BasicText?r=this._resourceToTextParam(e.value,t,n,i):e.type===p.r.TextPreset?r=this._resourceToTextPresetParam(e.value,t,n,o.resPath,i):e.type===p.r.BrandText&&(r=this._resourceToBrandTextParam({brandText:o.brandTextParams,position:t,segmentId:n,options:i,resourceRecord:o,resourcesList:e.value.brandSubItemList})),!(a=this._dataSdk.api.text.add(r)).ok)return a=(0,l.u_)(g.o.AddSegment)}catch(e){return m.t.error(e),a=(0,l.u_)(g.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(o)}}catch(e){m.t.error(e),a=(0,l.u_)(g.o.Unknown)}finally{this._callbackOptions.afterAddSegment(a.ok?null==r?void 0:r.segInfo.segmentId:void 0,o)}return a}addToCurrentProgress(e,t){if(!this._renderManager)return(0,l.u_)(g.o.RenderManagerUndefined);let i=(0,v.i1)(this._renderManager.progress),{needToInsert:r,trackIndex:a}=this._dataSdk.draftView.findTrackIndexToInsert(d.pNd.TrackTypeText,i,l.rk);return this.add(e,{start:i,trackIndex:a,needInsertTargetTrack:r},t)}async addToCurrentProgressBySegmentId(e,t,i,r){if(!this._renderManager)return(0,l.u_)(g.o.RenderManagerUndefined);let a=this._dataSdk.draftView.getSegmentById(t),n=[this._dataSdk.draftView.getCanvasConfig().width,this._dataSdk.draftView.getCanvasConfig().height];if(!(a&&(0,d.Ftn)(a)))return this.addToCurrentProgress(e,void 0);{var o,s,c,u,h;let r=await this._renderManager.getSegmentRectangles({draftView:this._dataSdk.draftView,getSegmentById:this._dataSdk.draftView.getSegmentById.bind(this._dataSdk.draftView),canvasSize:n,segIds:[t],selectedSegmentsIds:this._selection.getSelectedSegmentsIds(),current:this._renderManager.progress});if(!r[0])return(0,l.u_)(g.o.TextRectangle);let d={transformX:null===(o=a.clip)||void 0===o?void 0:o.transform.x,transformY:null===(s=a.clip)||void 0===s?void 0:s.transform.y,flipVertical:null===(c=a.clip)||void 0===c?void 0:c.flip.vertical,flipHorizontal:null===(u=a.clip)||void 0===u?void 0:u.flip.horizontal,alpha:null===(h=a.clip)||void 0===h?void 0:h.alpha,...i};if(void 0!==d.transformY){let e=r[0].height/n[1]*2;d.transformY-=e}return(0,f.f2)(r[0],n)&&(d.transformX=0,d.transformY=0),this.addToCurrentProgress(e,d)}}_resourceToTextParam(e,t,i,r){var a;return{trackIndex:t.trackIndex,type:d.cVg.MetaTypeText,segInfo:{segmentId:i,material:{content:e.content,fontPath:"",fontTitle:"",fontId:"",fontResId:"",alignment:e.alignment,fontSize:e.fontSize,boldWidth:e.boldWidth,ttsAutoUpdate:null!==(a=null==r?void 0:r.ttsAutoUpdate)&&void 0!==a?a:this._defaultTTSAutoUpdate},timeRange:{start:t.start,duration:l.rk},clip:{transformX:null==r?void 0:r.transformX,transformY:null==r?void 0:r.transformY}}}}_resourceToTextPresetParam(e,t,i,r,a){var n,o,s,c;return{trackIndex:t.trackIndex,type:d.cVg.MetaTypeText,segInfo:{segmentId:i,material:{content:h.oc.t("default",{},"\u9ED8\u8BA4\u6587\u672C"),fontPath:"",fontTitle:"",fontId:"",fontResId:"",fontSize:l.n5,ttsAutoUpdate:null!==(n=null==a?void 0:a.ttsAutoUpdate)&&void 0!==n?n:this._defaultTTSAutoUpdate},textEffect:{path:r,name:e.name,effectId:e.effectId,resId:e.resourceId,thirdResourceId:e.thirdResourceId,sourcePlatform:y.t.formatEffectSourcePlatform(e.source),categoryId:null!==(o=null==a?void 0:a.materialThirdcategoryId)&&void 0!==o?o:"",categoryName:null!==(s=null==a?void 0:a.materialThirdcategory)&&void 0!==s?s:"",type:d.cVg.MetaTypeTextEffect},timeRange:{start:t.start,duration:null!==(c=t.duration)&&void 0!==c?c:l.rk},clip:{transformX:null==a?void 0:a.transformX,transformY:null==a?void 0:a.transformY,flipVertical:null==a?void 0:a.flipVertical,flipHorizontal:null==a?void 0:a.flipHorizontal}}}}_resourceToBrandTextParam(e){var t,i,r,a,n,o,c,u;let{brandText:h,position:p,options:_={},resourceRecord:m,resourcesList:f,segmentId:g}=e,{font_resource_id:v,font_size:S,font_name:w,alignment:b,fixed_height:M,fixed_width:T,has_bold_width:k,has_underline:x,italic_degree:I,color:P,text_alpha:E,use_effect_default_color:C,letter_spacing:D,line_spacing:F,type_setting:A,global_alpha:R,border_item_checked:j,border_color:O,border_width:B,frame_color:V,frame_horizontal_offset:N,frame_vertical_offset:U,frame_height:L,frame_width:W,frame_angle:Z,frame_alpha:H,shadow_checked:z,shadow_color:K,shadow_alpha:$,shadow_angle:Y,shadow_smoothing:Q,use_shadow_diffuse:G,shadow_distance:X,frame_style:J,rotation:q,transform_x:ee,transform_y:et,scale_x:ei,scale_y:er,flowerResId:ea,light_checked:en,light_res_id:eo,light_color:es,light_strength:el,light_range:ed,light_ver_degree:ec,light_hor_degree:eu}=h.style,eh={trackIndex:p.trackIndex,type:d.cVg.MetaTypeText,segInfo:{segmentId:g,material:{content:h.content,checkFlag:63|Number(en?d.PbZ.LightFlag:0),fontPath:null==m?void 0:m.fontPath,fontTitle:w,fontId:"",fontResId:v,fontSize:S,fontSourcePlatform:y.t.formatEffectSourcePlatform(null!==(t=null==m?void 0:m.fontSource)&&void 0!==t?t:s.Hw.LOKI),fixedWidth:T,fixedHeight:M,boldWidth:k?.08:0,underlineWidth:x?.05:0,hasUnderline:x,italicDegree:I,textColor:P,textAlpha:E||1,useEffectDefaultColor:C,alignment:b,letterSpacing:D,lineSpacing:F,typesetting:A,globalAlpha:R||1,borderColor:O,borderWidth:j?B:0,bgColor:V,bgAlpha:V?H:1,bgRoundRadiusScale:Z,bgWidth:W,bgHeight:L,bgVerticalOffset:U,bgHorizontalOffset:N,bgStyle:J,hasShadow:z,shadowColor:K,shadowAlpha:z?$:1,shadowAngle:Y,shadowSmoothing:Q,shadowSmoothingUseDiffuse:G,shadowDistance:X,ttsAutoUpdate:null!==(i=null==_?void 0:_.ttsAutoUpdate)&&void 0!==i?i:this._defaultTTSAutoUpdate},timeRange:{start:p.start,duration:null!==(r=p.duration)&&void 0!==r?r:l.rk},clip:{transformX:null!==(a=_.transformX)&&void 0!==a?a:ee,transformY:null!==(n=_.transformY)&&void 0!==n?n:et,flipVertical:null==_?void 0:_.flipVertical,flipHorizontal:null==_?void 0:_.flipHorizontal,rotation:q,scaleX:ei,scaleY:er}}};if(null==m?void 0:m.textPreset){let{resPath:e}=m.textPreset,t=(null!=f?f:[]).find(e=>e.resourceId===ea);eh.segInfo.textEffect={path:e,name:t.name,effectId:t.effectId,resId:t.resourceId,sourcePlatform:y.t.formatEffectSourcePlatform(t.source),categoryId:null!==(o=null==_?void 0:_.materialThirdcategoryId)&&void 0!==o?o:"",categoryName:null!==(c=null==_?void 0:_.materialThirdcategory)&&void 0!==c?c:"",type:d.cVg.MetaTypeTextEffect}}return en&&eo&&(eh.segInfo.bloomMaterial={path:null==m?void 0:null===(u=m.textGlow)||void 0===u?void 0:u.resPath,resId:eo,type:d.cVg.MetaTypeBloom,sourcePlatform:d.nj7.EffectPlatformLoki,bloomActionParams:{color:es,strength:el,range:ed,dirX:eu,dirY:ec}}),eh}constructor(e,t,i,r,a,n){this._dataSdk=e,this._renderManager=t,this._ensureManager=i,this._selection=r,this._callbackOptions=a,this._resourceService=n,this._defaultTTSAutoUpdate=!1}}w=(0,r.gn)([(0,r.fM)(5,n.c),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===n.c?Object:n.c])],w)},265557:function(e,t,i){i.d(t,{P:function(){return s}});var r=i(593642),a=i(763832),n=i(426336),o=i(314108);async function s(e,t,i){var s;let[l,d]=function(e,t,i){let{segInfo:a,adaptionModel:o}=e,{clip:s}=a,l=new n.S8D;l.id=(0,r.Rl)(),l.renderIndex=new n.eK().nextTextAndStickerRenderIndex(t.draftView),o&&(l.adaptionModel=o),s=(0,n.cE6)(s),l.clip=new n.bXy({flip:new n.BWs({vertical:s.flipVertical,horizontal:s.flipHorizontal}),scale:new n.Ciz({x:s.scaleX,y:s.scaleY}),rotation:s.rotation,transform:new n.wx7({x:s.transformX,y:s.transformY})});let d=new n.cJv;return d.categoryId=a.material.categoryId,d.categoryName=a.material.categoryName,d.name=a.material.name,d.path=a.material.path,d.resourceId=a.material.resourceId,d.stickerId=a.material.stickerId,d.unicode=a.material.unicode,d.iconUrl=a.material.iconUrl,d.previewCoverUrl=a.material.previewCoverUrl,d.platform=a.material.platform,d.sourcePlatform=a.material.sourcePlatform,d.formulaId=a.material.formulaId,d.teamId=a.material.teamId,d.requestId=a.material.requestId,l.material=d,l.material.type=n.cVg.MetaTypeSticker,l.targetTimerange=new n.tnv(a.timeRange),i.commit(()=>{let e=i.addTrack(n.u2r.EffectTrack,-1),t=(0,n.soe)(l);if(!t)return;t.filter.filterLayer=BigInt(l.renderIndex),t.is_visible=!1;let r=l.offset+l.targetTimerange.start,a=l.targetTimerange.duration+r;i.addClip(e,t,r,a)}),[l,()=>{i.commit(()=>{i.removeClip(l.id)})}]}(e,t,i);try{await (0,o.i)(l.id,i)}catch{return[0,0]}await (0,a.D)(60);let c=await (null===(s=i.infoSticker)||void 0===s?void 0:s.getStickerBoundingBox(l.id,!1));if(!c)return[0,0];let u=c.left/2+.5,h=c.right/2+.5,p=c.top/2+.5,_=c.bottom/2+.5;return d(),[h-u,_-p]}},393910:function(e,t,i){i.d(t,{x:function(){return l}});var r=i(772322),a=i(195291);i(793173);var n=i(670933),o=i(218571);let s=(0,n.Pi)(e=>{let{logs:t}=e,[i,a]=(0,o.useState)("25vh"),[n,s]=(0,o.useState)("50vh"),l=(0,o.useRef)(null),d=(0,o.useCallback)(()=>{"25vh"===i&&a("20px"),"50vh"===n&&s("20px")},[i,n]),c=(0,o.useCallback)(()=>{"20px"===i&&a("25vh"),"20px"===n&&s("50vh")},[i,n]);return(0,o.useEffect)(()=>{l.current.scrollTop=l.current.scrollHeight}),(0,r.jsxs)("div",{className:"debugger-log-panel-container",onClick:c,style:{maxHeight:i,maxWidth:n},ref:l,children:[(0,r.jsx)("div",{className:"debugger-log-panel-title",children:"\u534F\u540C\u6D88\u606F\u65E5\u5FD7"}),(0,r.jsx)("div",{className:"debugger-log-panel-minimize",onClick:e=>{e.isPropagationStopped(),d()},children:"20px"===i?"\u02C5":"^"}),(0,r.jsx)("ul",{children:t.map(e=>(0,r.jsxs)("li",{children:[(0,r.jsx)("span",{className:`debugger-log-panel-log-type-${e.type}`,children:e.type})," ",(0,r.jsx)("span",{className:"debugger-log-panel-log-date",children:e.date})," ",(0,r.jsx)("span",{className:"debugger-log-panel-log-message",children:e.message})," ",(0,r.jsx)("span",{className:"debugger-log-panel-log-duration",children:e.duration})]},e.time))})]})});function l(e){let t=document.createElement("div");document.body.append(t),a.render((0,r.jsx)(s,{logs:e}),t)}},811149:function(e,t,i){let r;i.d(t,{g5:()=>_,_W:()=>u});var a,n=i("789786"),o=i("475590"),s=i("690613"),l=i("230689"),d=i("225698"),c=i("409519");var u=((a={})[a.disabled=0]="disabled",a[a.enabledForAll=1]="enabledForAll",a[a.enabledForHighResolution=2]="enabledForHighResolution",a);let h=["image/webp","image/png","image/jpg","image/bmp","image/jpeg","image/gif","image/heic"],p=["h263","mpeg4"];class _{taskDone(){return this._taskDone.promise}updateRenderSdk(e){this._renderManagerDefer.resolve(e)}done(){return this._doneDefer.promise}cancel(){this._analyzeDone((0,s.wf)(-1,"cancel"))}async analyze(){let e;let{file:t}=this._options;await this._renderManagerDefer.promise;try{let i;if(t.size>=0x100000000){this._analyzeDone((0,s.wf)(-1,"file_over_4G"));return}let{type:r}=t;e=URL.createObjectURL(t);let a=Date.now(),[n,o]=await Promise.all([this._calcMd5(t),this._tryGetFileInfo(t,e)]),l=Date.now()-a,{result:d,duration:c}=n,{result:u,duration:h}=o,p={file:t,calcMd5Duration:c,analyzeFileDuration:h,duration:l};if(!d.ok){this._analyzeDone(d,p);return}if(!u.ok){this._analyzeDone(u,p);return}if(u.value.error){this._analyzeDone((0,s.wf)(u.value.error,u.value.msg),p);return}switch(!0){case u.value.type.startsWith("video"):i=await this._videoChecker(t,e,u.value);break;case u.value.type.startsWith("audio"):i=await this._audioChecker(t,e,u.value);break;case r.startsWith("image"):i=await this._imageChecker(t,e,u.value);break;default:i=(0,s.wf)(-1,"file_type_not_supported")}if(!i.ok){this._analyzeDone(i,p);return}!i.value.data&&(i.value.data={}),Object.assign(i.value.data,{},{key:d.value,md5:d.value}),this._analyzeDone(i,p)}finally{e&&URL.revokeObjectURL(e)}}_analyzeDone(e,t){this._doneDefer.resolve(e),this._taskDone.resolve(),t&&this._reportImportMaterialAnalyzeFinish({isFastImport:e.ok,...t})}_videoChecker(e,t,i){var a,n;if(a=e,("video"!==(n=i).type||!n.supportWebCodecs||"video/quicktime"!==a.type)&&""===document.createElement("video").canPlayType(e.type))return Promise.resolve((0,s.wf)(-1,"video_cant_play"));let{width:o,height:l,fps:d,gop:c,testDecodeTime:h,codecName:_,rotation:m}=i,f=function(){var e,t;if(void 0!==r)return r;let i=Number(null!==(e=new URLSearchParams(window.location.search).get("decoder_strategy"))&&void 0!==e?e:u.enabledForHighResolution),a=!1;try{a=Number(null===(t=window.navigator.userAgent.match(/Chrome\/([\d]+)/))||void 0===t?void 0:t[1])>=98}catch(e){}return void 0!==window.VideoDecoder&&a?r=i in u?i:u.disabled:u.disabled}(),g=o<=4096&&l<=4096&&o*l<=8294400;if(i.duration<=0)return Promise.resolve((0,s.wf)(-1,"video_no_duration"));if(!g)return Promise.resolve((0,s.wf)(-1,"video_oversized"));if(!(d<=(0===f?50:60)))return Promise.resolve((0,s.wf)(-2,"video_fps_excessive"));if(c>250)return Promise.resolve((0,s.wf)(-1,"video_gop_excessive"));if(h<0||h>20)return Promise.resolve((0,s.wf)(-1,"video_test_decode_timeout"));if(p.includes(_))return Promise.resolve((0,s.wf)(-1,"video_codecs_not_supported"));let v=90===m||270===m;return Promise.resolve((0,s.oW)({data:{duration:i.duration/1e3,width:v?l:o,height:v?o:l}}))}_audioChecker(e,t,i){if(""===document.createElement("audio").canPlayType(e.type))return Promise.resolve((0,s.wf)(-1,"browser could not to play"));let{duration:r,format:a}=i;return r<=0?Promise.resolve((0,s.wf)(-1,"audio_no_duration")):this._isQuickImportSupportAudioFormat(a)?Promise.resolve((0,s.oW)({data:{duration:r/1e3}})):Promise.resolve((0,s.wf)(-1,"audio_format_not_supported"))}_imageChecker(e,t,i){let{width:r,height:a,rotation:n}=i;if(!h.some(t=>e.type.toLocaleLowerCase().startsWith(t)))return Promise.resolve((0,s.wf)(-1,"not image_format_not_supported"));if(r*a>0xfd2000)return Promise.resolve((0,s.wf)(-1,"image_oversized"));if(r>8192)return Promise.resolve((0,s.wf)(-1,"image_too_wide"));if(a>8192)return Promise.resolve((0,s.wf)(-1,"image_too_long"));let o=90===n||270===n;return Promise.resolve((0,s.oW)({data:{width:o?a:r,height:o?r:a}}))}async _tryGetFileInfo(e,t){let i=Date.now(),r=await this._renderManagerDefer.promise;try{await r.insertBlob(t,e);let a=await r.getQuickImportInfo(t,20),n=JSON.parse(null!=a?a:"{}"),o=Date.now()-i;return(0,c.n)(this._containerService,{action:"wait_analyze_file",calcMd5Duration:o,materialName:e.name,materialSize:e.size}),{result:(0,s.oW)(n),duration:o}}catch(t){let e=Date.now()-i;return{result:(0,s.wf)(-1,null==t?void 0:t.message),duration:e}}finally{r.removeBlob(t)}}async _calcMd5(e){let t=Date.now(),i=await (await this._lazyFileMd5CalcService.getInstance()).calcFileMd5(e),r=Date.now()-t;return(0,c.n)(this._containerService,{action:"wait_calc_md5",calcMd5Duration:r,materialName:e.name,materialSize:e.size}),{result:i,duration:r}}_isQuickImportSupportAudioFormat(e){return["mp3","ogg","matroska,webm"].includes(e)}_reportImportMaterialAnalyzeFinish(e){let{isFastImport:t,file:i,analyzeFileDuration:r,calcMd5Duration:a,duration:n}=e;(0,c.n)(this._containerService,{action:"finish",materialName:null==i?void 0:i.name,materialSize:null==i?void 0:i.size,isFastImport:t,analyzeFileDuration:r,calcMd5Duration:a,duration:n})}constructor(e,t,i){this._options=e,this._lazyFileMd5CalcService=t,this._containerService=i,this._renderManagerDefer=(0,o.PQ)(),this._doneDefer=(0,o.PQ)(),this._taskDone=(0,o.PQ)(),this._options.renderManager&&this._renderManagerDefer.resolve(this._options.renderManager)}}_=(0,n.gn)([(0,n.fM)(1,d.w),(0,n.fM)(2,l.t),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IFastImportAnalyzeTask?Object:IFastImportAnalyzeTask,void 0===d.w?Object:d.w,void 0===l.t?Object:l.t])],_)},225344:function(e,t,i){i.d(t,{U:function(){return n}});var r=i(426336),a=i(444381);class n extends a.M{_findPath(e){if(!(0,r.Y9Q)(e))return"";let{material:t}=e,{type:i}=t;return!(null==t?void 0:t.musicId)||(null==t?void 0:t.musicId)&&i!==r.cVg.MetaTypeVideoOriginalSound?t.path:""}}},322401:function(e,t,i){i.d(t,{$:function(){return n}});var r=i(789193),a=i(690613);function n(e){var t;return(0,a.wf)(e,null!==(t=r.x.get(e))&&void 0!==t?t:"")}},805675:function(e,t,i){i.d(t,{Q9:function(){return y},WZ:function(){return v},_S:function(){return S},hB:function(){return f}});var r=i(230982),a=i(641276),n=i(176022),o=i(801497),s=i(183346),l=i(896413),d=i(425427);let c=new URLSearchParams(window.location.search),u="googlemarketplace"===c.get("utm_source")&&"googledrive"===c.get("utm_campaign"),h="dropbox"===c.get("utm_source"),p="shopify"===c.get("utm_source"),_={get target(){let e=document.querySelectorAll("#player-content");if(e.length)return e[0];return null},get title(){return o.ZP.t("preview_web_area",{},"Preview area")},get content(){return o.ZP.t("preview_web_material_web_here",{},"You can preview your materials and videos here")},mask:!0,placement:"bottom"},m={[s.F3.EditorAreaBaseGuide]:{key:s.F3.EditorAreaBaseGuide,steps:[{target(){let e=document.querySelector("#workbench > .lv-layout-sider");return null!=e?e:null},get title(){if(u)return o.ZP.t("web_marketplace_text_resources",{},"Media resources");return o.ZP.t("material_web_resources",{},"Material resources")},get content(){if(u)return o.ZP.t("web_marketplace_text_upload_online",{},"You can upload your own media or select media from your space.");return o.ZP.t("upload_web_material_web_use",{},"You can upload your own materials as well as use online ones")},placement:"right"}],mask:!0}};function f(){return m[s.F3.EditorAreaBaseGuide].steps}function g(e){let t=e.get(l.a),i=e.get(n.W),o=e.get(s.AS),c=e.get(d.rO);!(0,d.JY)(c)&&f().push(_),(0,a.V)(t.onEventually)(()=>{!o.getViewStateFromLocal(s.F3.EditorAreaBaseGuide)&&(0,r.n)(()=>{i.trigger(m[s.F3.EditorAreaBaseGuide]),o.setViewStateToLocal(s.F3.EditorAreaBaseGuide,!0)})})}function v(e){m[s.F3.EditorAreaBaseGuide].steps=e}function y(e){e.invokeFunction(g)}function S(e){if(!h&&!u&&!p)y(e)}},783280:function(e,t,i){i.d(t,{t:function(){return o}});var r=i(356954);let a="cloud_pay_window";class n{getEventParams(){return this._params}constructor(e){this._params=e,this.eventName=a}}function o(e,t,i){a===i&&(0,r.K)(e,n,[t])}},961066:function(e,t,i){i.d(t,{w:function(){return n}});var r=i(356954);class a{getEventParams(){return{status:this._params.status,enter_from:this._params.enterFrom,fail_reason:this._params.fail_reason}}constructor(e){this._params=e,this.eventName="apply_draft_permission_status"}}function n(e,t){(0,r.K)(e,a,[t])}},712829:function(e,t,i){i.d(t,{Y:function(){return n}});var r=i(356954);class a{getEventParams(){return{action:this._params.action,enter_from:this._params.enterFrom}}constructor(e){this._params=e,this.eventName="apply_join_space"}}function n(e,t){(0,r.K)(e,a,[t])}},515336:function(e,t,i){i.d(t,{D$:function(){return T},EL:function(){return M},MO:function(){return k},lQ:function(){return v}});var r=i(789786),a=i(108692),n=i(896413),o=i(425427),s=i(782350),l=i(230689),d=i(356954),c=i(534124),u=i(374497),h=i(918157),p=i(118830),_=i(258150),m=i(426336),f=i(352998);class g{getEventParams(){var e,t;let{searchParams:i}=new URL(window.location.href),r=this._videoEnvironmentService.draftIdFromUrl?this._videoEnvironmentService.draftIdFromUrl:void 0,{workspaceId:a}=this._mainDraftService.draftWorkspaceManager,n=a?this._workspaceService.getWorkspace(a):void 0;return{url:location.href,draft_id:r,from_page:(0,p.X)(),enter_from:r?"draft":function(){let{searchParams:e}=new URL(window.location.href),t=e.get("enter_from");return[h.f.CREATE_PROJECT,h.f.LOGIN,h.f.SIGNUP,h.f.CREATE_NEW,h.f.PROJECT,h.f.NEW_FUNCTION_POPUP,h.f.ENTRANCE].includes(t)?t:h.f.NEW}(),template_id:i.get("templateId")||i.get("create_id")||"",templateId:i.get("templateId")||i.get("create_id")||"",tool_type:null!==(e=i.get("__tool_type"))&&void 0!==e?e:void 0,article_type:i.get("article_type")||void 0,article_title:i.get("article_title")||void 0,position:i.get("__action_from")||i.get("position")||void 0,template_search_id:i.get("template_search_id")||void 0,template_search_no_result:i.get("template_search_no_result")||void 0,template_tab_name:i.get("template_tab_name")||void 0,autocut_type:null!==(t=i.get("autocut_type"))&&void 0!==t?t:void 0,...n?{space_id:n.workspace_id,space_user_cnt:n.member_cnt,space_type:(0,_.Ju)(n).spaceType,raw_space_type:(0,_.Ju)(n).rawSpaceType}:{}}}constructor(e,t,i,r,a,n){this._params=e,this._mainDraftService=t,this._workspaceService=i,this._mainEditorWidgetService=r,this._videoEnvironmentService=a,this._containerService=n}}function v(e,t){var i;if(!e)return{};let{linkRatioTemplateInfo:r,cover:a}=e,{width:n,height:o}=a,s=null==t?void 0:null===(i=t.getCanvasConfig())||void 0===i?void 0:i.ratio;return s===m.rxY.CanvasRatioOriginal&&(s=(0,f.GT)(n,o)),{is_support_ratio:r.length>0?1:0,support_ratio_cnt:r.length||1,ratio:null!=s?s:m.rxY.CanvasRatioOriginal}}g=(0,r.gn)([(0,r.fM)(1,a.n),(0,r.fM)(2,s.W),(0,r.fM)(3,n.a),(0,r.fM)(4,o.rO),(0,r.fM)(5,l.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IEnterTemplateEditPageParams?Object:IEnterTemplateEditPageParams,void 0===a.n?Object:a.n,void 0===s.W?Object:s.W,void 0===n.a?Object:n.a,void 0===o.rO?Object:o.rO,void 0===l.t?Object:l.t])],g);class y extends g{getEventParams(){let e=super.getEventParams(),{template:t,loadTime:i}=this._params,r=(0,c._)(t),a={...e,...v(t,this._mainDraftService.dataSdk.draftView),load_time:Math.round(i),is_mute:(null==t?void 0:t.mute)?1:0,can_update_music:(null==t?void 0:t.canUpdateMusic)?1:0,is_same_dots:r?1:0},n=this._mainDraftService.draftTemplateManager.getSourceTemplateId()||new URL(window.location.href).searchParams.get("source_template_id");return n&&(a.source_template_id=n),a}constructor(e,t,i,r,a,n){super(e,t,i,r,a,n),this._params=e,this._mainDraftService=t,this._workspaceService=i,this._mainEditorWidgetService=r,this._videoEnvironmentService=a,this._containerService=n}}y=(0,r.gn)([(0,r.fM)(1,a.n),(0,r.fM)(2,s.W),(0,r.fM)(3,n.a),(0,r.fM)(4,o.rO),(0,r.fM)(5,l.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IFullEnterTemplateEditPageParams?Object:IFullEnterTemplateEditPageParams,void 0===a.n?Object:a.n,void 0===s.W?Object:s.W,void 0===n.a?Object:n.a,void 0===o.rO?Object:o.rO,void 0===l.t?Object:l.t])],y);class S extends g{constructor(...e){super(...e),this.eventName="enter_template_edit_page_immediately"}}class w extends g{constructor(...e){super(...e),this.eventName="enter_template_edit_page_immediately_server"}}class b extends y{getEventParams(){let e=super.getEventParams();return this._params.template?Object.assign({...(0,u.fl)(this._params.template)},e):e}constructor(...e){super(...e),this.eventName="enter_template_edit_page"}}function M(e,t){(0,d.K)(e,S,[t])}function T(e,t){(0,d.z)(e,w,[t])}function k(e,t){(0,d.K)(e,b,[t])}},348061:function(e,t,i){i.d(t,{O:function(){return n},w:function(){return s}});var r,a=i(356954);var n=((r={}).Slide="slide",r.Input="input",r.Click="click",r.Touchpad="touchpad",r.MouseWheel="mouse_wheel",r.ShortkeyFit="shortkey_fit",r.Shortkey50="shortkey_50",r.Shortkey100="shortkey_100",r.Shortkey200="shortkey_200",r.ShortkeyZoomin="shortkey_zoomin",r.ShortkeyZoomout="shortkey_zoomout",r);class o{getEventParams(){return{action_type:this._params.action_type,scale:this._params.scale}}constructor(e){this._params=e,this.eventName="click_canvas_display_zoom"}}function s(e,t){(0,a.K)(e,o,[t])}},946765:function(e,t,i){i.d(t,{R:function(){return n},h:function(){return s}});var r,a=i(356954);var n=((r={}).CanvasDrag="canvas_drag",r.Touchpad="touchpad",r.MouseWheel="mouse_wheel",r.ShortkeyAndWheel="shortkey_and_wheel",r);class o{getEventParams(){return{action_type:this._params.action_type}}constructor(e){this._params=e,this.eventName="drag_canvas"}}function s(e,t){(0,a.K)(e,o,[t])}},495567:function(e,t,i){i.d(t,{Us:function(){return j},yS:function(){return C}});var r=i(789786),a=i(28791),n=i(31463),o=i(200247),s=i(937567),l=i(425427),d=i(896413),c=i(108692),u=i(373722),h=i(928623),p=i(918513),_=i(136877),m=i(426336),f=i(690613);let g=!1,v={entries:[],params:{}},y="vesdk_editor_web_prepare_time",S="vesdk_event_editor_swing_time",w="vesdk_editor_first_seek",b="vesdk_editor_create_gl_context",M="vesdk_event_editor_stream_edit_first_frame_event",T="vesdk_event_editor_stream_edit_fetch_getfilesize_time_event",k="vesdk_event_editor_stream_edit_image_event",x="vesdk_editor_videofile_decode_first_frame_time",I="ve_web_workers_detail",P={[I]:"VE_WORKERS_DETAIL",[y]:"VE_PREPARE_TIME",[S]:"VE_EFFECT_SEEK",[w]:"VE_FIRST_SEEK",[b]:"VE_CREATE_GL_CONTEXT",[M]:"VE_FIRST_FRAME",[T]:"VE_STREAM_GET_FILE_SIZE",[k]:"VE_STREAM_EDIT_IMAGE",[x]:"VE_DECODE_VIDEO_FIRST_FRAME"},E={},C=e=>{if(g)return;let{msg:t}=e;try{let i=JSON.parse(t),r={...e,...i},{eventName:a}=r;switch(console.log("[VE_FRAME_REPORT] event",r),r.eventName){case I:v.params={...v.params,totalWorkers:r.total_workers,unusedWorkers:r.unused_workers,runningWorkers:r.runningWorkers};return;case y:case S:case w:case M:case b:{let e=Number.parseFloat(r[`${a}_start`])-performance.timeOrigin,t=Number.parseFloat(r[`${a}_end`])-performance.timeOrigin,i=Number.parseFloat(r[`${a}_duration`]),n={name:P[a],start:e,end:t,duration:i};v.entries.push(n);return}case T:case k:case x:{let e=Number.parseFloat(r[`${a}_start`])-performance.timeOrigin,t=Number.parseFloat(r[`${a}_end`])-performance.timeOrigin,i=Number.parseFloat(r[`${a}_duration`]),n={name:P[a],start:e,end:t,duration:i},o=E[a];if(o){let e=Math.min(o.summary.start,n.start),t=Math.max(o.summary.end,n.end);E[a]={name:P[a],total:o.total+1,summary:{name:P[a],start:e,end:t,duration:t-e},longest:o.longest.duration>n.duration?o.longest:n,last:n}}else E[a]={name:P[a],total:1,summary:n,longest:n,last:n}}default:return}}catch(e){}};function D(e,t){let i={};for(let r in t){if(!("object"==typeof t[r]&&("categories"===r||"metrics"===r))){i[`${e}_${r}`]=t[r];continue}for(let a in t[r])i[`${e}_${a}`]=t[r][a]}return i}function F(e){let t=[];return s.ATOMIC_TASKS.filter(e=>e!==s.RESTORE_FIRST_FRAME).forEach(e=>{t.push(`${e}_start`),t.push(`${e}_duration`),t.push(`${e}_end`)}),(0,u.Z)(e,t)}class A{doReport(){let{duration:e}=this._params,t=(0,l.JY)(this._videoEnvironmentService);e>(t?53e3:24e3)&&Math.random()<(t?.01:.001)&&this._loggerService.createLogger("editor_init_too_long").info(this._mainEditorWidgetService.renderManager.dumpLogInfo())}constructor(e,t,i,r){this._params=e,this._videoEnvironmentService=t,this._loggerService=i,this._mainEditorWidgetService=r}}A=(0,r.gn)([(0,r.fM)(1,l.rO),(0,r.fM)(2,a.yR),(0,r.fM)(3,d.a),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IAbnormalVEDurationParams?Object:IAbnormalVEDurationParams,void 0===l.rO?Object:l.rO,void 0===a.yR?Object:a.yR,void 0===d.a?Object:d.a])],A);class R{async doReport(){var e,t,i,r,a,n,o,d,c,g,y,S,w,b,M,T,k,x,I,P,C,A;let R;let{prevCondition:j="none",status:O,originError:B,hasHiddenPage:V,hasAttemptedUnloadPage:N,preloadResourceResult:U,params:L={}}=this._params,W={...L},Z=this._videoEnvironmentService.isDev||this._videoEnvironmentService.isDebug,H=(0,l.JY)(this._videoEnvironmentService),{searchParams:z}=new URL(window.location.href),K=performance.now(),$=null===(t=performance.getEntriesByName(s.TTV))||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.startTime,Y=null===(r=performance.getEntriesByName("first-contentful-paint"))||void 0===r?void 0:null===(i=r[0])||void 0===i?void 0:i.startTime,Q=1/0,G=0,X=null!==(o=window.__preload_marks)&&void 0!==o?o:[],J=e=>X.find(t=>t.name===e);for(let e of s.ATOMIC_TASKS){let t=(null===(d=performance.getEntriesByName(`${e}_START`))||void 0===d?void 0:d[0])||J(`${e}_START`),i=(null===(c=performance.getEntriesByName(`${e}_END`))||void 0===c?void 0:c[0])||J(`${e}_END`);if(t&&i){if(Z)try{performance.measure(e,`${e}_START`,`${e}_END`)}catch(e){console.warn(e)}t.startTime<Q&&(Q=t.startTime),i.startTime>G&&(G=i.startTime);let r={start:t.startTime,end:i.startTime,duration:i.startTime-t.startTime,...t.detail,...i.detail};W={...W,...D(e,r)}}else if(t){let i={start:t.startTime,end:K,duration:K-t.startTime,status:"timeout",...t.detail};W={...W,...D(e,i)}}}if(W.webIDC=null===(a=window.gfdatav1)||void 0===a?void 0:a.region,W.renderLevel=2===window._SSR_RENDER_LEVEL?"ssr":"csr","success"===O){let e=G-Q;this._reportAbnormalVEDuration(e)}W.status=O,W.prevCondition=j,W.editorType=H?"/editor-template/":"/editor/",W.draftState=this._videoEnvironmentService.draftIdFromUrl?"restore":"empty",W.userState=this._accountService.hasLogin?"logged":"unlogged",W.draftId=null!==(g=this._videoEnvironmentService.draftIdFromUrl)&&void 0!==g?g:"",W.referer=new URL(window.location.href).searchParams.get("__action_from")||"none",W.timingVisible=$,W.timingStart=Q,W.timingEnd=G,W.timingDuration=G-Q,W.timingReport=K,W.timingFCP=Y;try{W.timingNavigation=JSON.stringify(null===(y=performance.getEntriesByType("navigation"))||void 0===y?void 0:y[0])}catch(e){console.error("stringify_error","navigation timing stringify error",e)}try{W={...W,...function(){let e=performance.getEntriesByType("resource").filter(e=>"link"===e.initiatorType&&e.name.includes("static/js")),t=e.filter(e=>0===e.transferSize).length,[i,r]=function(e){let t=1/0,i=0;for(let r of e)r.startTime<t&&(t=r.startTime),r.responseEnd>i&&(i=r.responseEnd);return[t,i]}(e);return{scriptStart:i,scriptEnd:r,scriptDuration:r-i,scriptCachedRatio:t/e.length}}(),...this._params}}catch(e){console.error("get_timing_js_error","get timing js error",e)}W.hasAttemptedUnloadPage=N?"true":"false",W.hasHiddenPage=V?"true":"false";let q=this._mainDraftService.cloudMetaManager.getMeta().draft,ee=this._mainDraftService.dataSdk.draftView.getAllSegments(),et=[],ei=0;for(let e of ee)""!==e.templateId&&(0,m.hey)(e)&&(ei+=1,et.push(e.templateId));this._videoEnvironmentService.templateIdFromUrl&&et.push(this._videoEnvironmentService.templateIdFromUrl);let er=et.length>0,ea=-1,en=-1,eo=-1,es=-1,el=-1;try{if("success"===O&&et.length>0){ea=0,en=0,eo=0,es=0,el=0;try{for(let e of et){let t=this._mainDraftService.draftTemplateManager.getTemplateSync(e);ea+=t.preload.builtIns.length,es+=t.preload.online.length,en+=Object.keys(null!==(S=t.preload.avs)&&void 0!==S?S:{}).length,eo+=Object.keys(null!==(w=t.preload.effects)&&void 0!==w?w:{}).length,el+=t.preload.builtIns.length+t.preload.online.length}er=!1}catch(e){console.error(e)}}}catch(e){console.error(e)}H&&!this._videoEnvironmentService.draftIdFromUrl&&(R=this._videoEnvironmentService.currentTemplateId?"specified":"empty");let ed=!!this._videoEnvironmentService.draftIdFromUrl,ec=-1,eu=-1,eh=-1,ep=-1,e_=-1,em=-1,ef=-1,eg=-1,ev="",ey="",eS="",ew=-1,eb=-1,eM=-1,eT="",ek="",ex="",eI=-1,eP=-1,eE=-1,eC="",eD="",eF="",eA=-1,eR=-1,ej=-1,eO="",eB="",eV="",eN=-1,eU=-1,eL=-1;try{if("success"===O&&U){let e=await U;if(e){ed=!1;let{preloadMaterialItems:t,preloadEffectItems:i,onlineMaterialList:r,everCloudMaterialList:a,effectMaterialList:n}=e,{everCloudMaterials:o,onlineMaterials:s,unresolvedOnlineMaterials:l,unresolvedEverCloudMaterials:d,builtInMaterials:c,remainingBuiltInResources:u}=t,{effects:h,unresolvedEffects:p}=i,_=this._creatEnsurePerformanceRetriever();for(let e of(eu=s.length,eh=l.length,r)){let t=_(e.key,e.resource.type);if(!!t&&!(t.duration<ew))ey=e.key,ev=e.resource.type,ew=t.duration,eb=t.start,eM=t.end,eS=t.condition}for(let e of(ec=o.length,ep=d.length,a)){let t=_(e.key,e.resource.type);if(!!t&&!(t.duration<eI))ek=e.key,eT=e.resource.type,eI=t.duration,eP=t.start,eE=t.end,ex=t.condition}for(let e of(e_=h.length,em=p.length,ef=eu+ec+e_,n)){let t=_(e.key,e.resource.type);if(!!t&&!(t.duration<eA))eD=e.key,eC=e.resource.type,eA=t.duration,eR=t.start,ej=t.end,eF=t.condition}let m=[...c,...u];for(let e of m){let t=_(null==e?void 0:null===(b=e.builtIn)||void 0===b?void 0:b.key,(null==e?void 0:null===(M=e.builtIn)||void 0===M?void 0:M.mime_type)||"");if(!!t&&!(t.duration<eN))eB=null==e?void 0:null===(T=e.builtIn)||void 0===T?void 0:T.key,eO=(null==e?void 0:null===(k=e.builtIn)||void 0===k?void 0:k.mime_type)||"",eN=t.duration,eU=t.start,eL=t.end,eV=t.condition}}}}catch(e){console.error(e)}if(W={...W,longestOnlineMaterialResourceType:ev,longestOnlineMaterialResourceKey:ey,longestOnlineMaterialDuration:ew,longestOnlineMaterialStart:eb,longestOnlineMaterialEnd:eM,longestEverCloudMaterialResourceType:eT,longestEverCloudMaterialResourceKey:ek,longestEverCloudMaterialDuration:eI,longestEverCloudMaterialStart:eP,longestEverCloudMaterialEnd:eE,longestEffectMaterialResourceType:eC,longestEffectMaterialResourceKey:eD,longestEffectMaterialDuration:eA,longestEffectMaterialStart:eR,longestEffectMaterialEnd:ej,longestBuiltInMaterialResourceType:eO,longestBuiltInMaterialResourceKey:eB,longestBuiltInMaterialDuration:eN,longestBuiltInMaterialStart:eU,longestBuiltInMaterialEnd:eL,longestOnlineMaterialResourceCondition:eS,longestEverCloudMaterialResourceCondition:ex,longestEffectMaterialResourceCondition:eF,longestBuiltInMateriallResourceCondition:eV},"fail"===O&&(W.errorMessage="missing error instance",W.errorCause="missing error instance",B)){this._reportService.reportDevError("editor_init",B,{msg:null!==(x=W.msg)&&void 0!==x?x:""});let e=(0,f.oi)(B)?B.cause:B;W.errorMessage=`${null==e?void 0:e.name}-${null==e?void 0:e.message}`,W.errorCause=e instanceof Error?`${null==e?void 0:e.name}-${e.cause}`:"missing error cause"}let eW=window._serverTimingParams,eZ={};try{for(let e of v.entries){let t=e.name;if(eZ[`${t}_START`]=e.start,eZ[`${t}_END`]=e.end,eZ[`${t}_DURATION`]=e.duration,Z)try{performance.measure(t,{start:e.start,end:e.end})}catch(e){console.warn(e)}}for(let e of Object.keys(E)){let t=E[e],i=t.name;for(let e of(v.params={...v.params,[`${name}_count`]:t.total},["summary","longest","last"])){let r=t[e],a=`${i}_${e}`;if(eZ[`${a}_START`]=r.start,eZ[`${a}_END`]=r.end,eZ[`${a}_DURATION`]=r.duration,Z)try{performance.measure(a,{start:r.start,end:r.end})}catch(e){console.warn(e)}}}}catch(e){console.log("[init] failed to parse ve data: ",e)}let eH={from_page:z.get("__from_page")||z.get("from_page")||"none",tool_type:null!==(P=null!==(I=(0,p.XX)(q.transferedFrom))&&void 0!==I?I:z.get("__tool_type"))&&void 0!==P?P:void 0,template_cnt:ei,templateState:R,hasIncompleteTemplateInfo:er?"true":"false",totalBuiltinResourceCount:ea,totalTemplatePreloadAVCount:en,totalTemplatePreloadEffectCount:eo,totalTemplatePreloadOnlineCount:es,totalTemplateResourceCount:el,initTemplateIds:et.join(","),initTemplateIdCount:et.length,hasIncompleteDraftInfo:ed?"true":"false",draftOnlineMaterialCount:eu,draftUnresolvedEverCloudMaterialCount:ep,draftEverCloutMaterialCount:ec,draftUnresolvedOnlineMaterialCount:eh,draftEffectCount:e_,draftUnresolvedEffectCount:em,totalDraftResourceCount:ef,...eW?{SSR_HTML_RENDER_duration:null!==(C=null==eW?void 0:null===(n=eW.timing)||void 0===n?void 0:n["bd-edenx-ssr-render-html_duration"])&&void 0!==C?C:0}:void 0,...W,...(null==q?void 0:q.transferedFrom)===_.ZZ.ad_script?null==q?void 0:q.scriptInfo:{},...v.params};this._reportService.reportDevEvent("editor_init",{...(A=eH,(0,u.Z)(A,["longestOnlineMaterialResourceType","longestOnlineMaterialResourceKey","longestOnlineMaterialDuration","longestOnlineMaterialStart","longestOnlineMaterialEnd","longestEverCloudMaterialResourceType","longestEverCloudMaterialResourceKey","longestEverCloudMaterialDuration","longestEverCloudMaterialStart","longestEverCloudMaterialEnd","longestEffectMaterialResourceType","longestEffectMaterialResourceKey","longestEffectMaterialDuration","longestEffectMaterialStart","longestEffectMaterialEnd","longestBuiltInMaterialResourceType","longestBuiltInMaterialResourceKey","longestBuiltInMaterialDuration","longestBuiltInMaterialStart","longestBuiltInMaterialEnd"])),timingNavigation:void 0}),this._reportService.reportDevEvent("editor_init_resource",{...F(eH),timingNavigation:void 0}),this._reportService.reportDevEvent("editor_ve_marks",{...F(eH),...eZ,timingNavigation:void 0});let ez=(0,h.Z)(eH,["status","msg","draftState","prevCondition","renderLevel","error","webIDC"]),eK={...eH,...eZ};if(this._params.useBeacon)this._reportService.reportBusinessExitEvent("editor_init",eK);else{this._reportService.reportBusinessEvent("editor_init",eK);let e=()=>{this._reportService.reportBusinessEventByServer("editor_init_server",ez)};if(e(),!this._accountService.hasLogin){let t=this._accountService.onDidLogin(()=>{e(),t.dispose()})}}return s.ATOMIC_TASKS.forEach(e=>{performance.clearMarks(`${e}_START`),performance.clearMarks(`${e}_END`)}),Z&&(console.log("[init] editor_init: ",JSON.stringify(W)),console.log("[init] editor_init_res_params: ",eK)),W}constructor(e,t,i,r,a,n,o){this._params=e,this._reportAbnormalVEDuration=t,this._creatEnsurePerformanceRetriever=i,this._videoEnvironmentService=r,this._reportService=a,this._accountService=n,this._mainDraftService=o,this.eventName="editor_init"}}function j(e,t){g=!0;e.createInstance(R,t,t=>{e.createInstance(A,{duration:t}).doReport()},()=>{let t=e.invokeFunction(e=>e.get(d.a));return(e,i)=>t.ensureManager.getEnsureResourcePerformance(e,i)}).doReport()}R=(0,r.gn)([(0,r.fM)(3,l.rO),(0,r.fM)(4,n.m),(0,r.fM)(5,o.D),(0,r.fM)(6,c.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof EditorInitParams?Object:EditorInitParams,Function,Function,void 0===l.rO?Object:l.rO,void 0===n.m?Object:n.m,void 0===o.D?Object:o.D,void 0===c.n?Object:c.n])],R)},443038:function(e,t,i){i.d(t,{v:function(){return s}});var r=i(789786),a=i(108692),n=i(356954);class o{getEventParams(){return{draft_id:this._mainDraftService.dataSdk.draftView.getDraftId(),action_type:this._params.action_type,is_batch:this._params.is_batch,material_category:this._params.material_category,track_category:this._params.track_category,material_subcategory:this._params.material_subcategory,material_subcategory_id:this._params.material_subcategory_id,material_thirdcategory:this._params.material_thirdcategory,material_thirdcategory_id:this._params.material_thirdcategory_id,material_id:this._params.material_id,material_name:this._params.material_name}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="delete_material_segment"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,r.gn)([(0,r.fM)(1,a.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===a.n?Object:a.n])],o)},533147:function(e,t,i){i.d(t,{r:function(){return n}});var r=i(356954);class a{getEventParams(){var e;return{material_type:null!==(e=this._params.materialType)&&void 0!==e?e:"image"}}constructor(e){this._params=e,this.eventName="recognizing_objects"}}function n(e,t){(0,r.K)(e,a,[t])}},177975:function(e,t,i){i.d(t,{P6:function(){return c},R:function(){return p},gM:function(){return h}});var r,a=i(896413),n=i(108692),o=i(356954),s=i(374497),l=i(426336),d=i(800788);var c=((r={}).Replace="replace",r.Select="select",r.Trim="trim",r.Crop="crop",r.Move="move",r.Rotate="rotate",r.Scale="scale",r.HIDE_MATERIAL="hide",r.UNHIDE_MATERIAL="unhide",r.SCALE_FAIL="scale_fail",r.MOVE_FAIL="move_fail",r.ROTATE_FAIL="rotate_fail",r);class u{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="template_material_option"}}function h(e,t){var i,r,d;let c=e.invokeFunction(e=>e.get(a.a)),h=e.invokeFunction(e=>e.get(n.n)),{subDraftTemplateId:p}=c.segmentSelection,_=null!=p?p:h.draftTemplateManager.getTemplateId();if(!_)return;let[m]=c.selection.getSelectedSegments(),f=h.draftTemplateManager.getTemplateSync(_),g=(0,s.fl)(f),v=null!==(r=null==m?void 0:m.commonKeyframes.reduce((e,t)=>{var i,r,a,n,o,s,d,c;if(!t.keyframeList.length)return e;switch(t.propertyType){case l.Eu.KFTypeScaleX:case l.Eu.KFTypeScaleY:{let o=t.propertyType===l.Eu.KFTypeScaleX?null==m?void 0:null===(r=m.clip)||void 0===r?void 0:null===(i=r.scale)||void 0===i?void 0:i.x:null==m?void 0:null===(n=m.clip)||void 0===n?void 0:null===(a=n.scale)||void 0===a?void 0:a.y;return t.keyframeList.some(e=>e.values[0]!==o)&&e.add("scale"),e}case l.Eu.KFTypePositionX:case l.Eu.KFTypePositionY:{let i=t.propertyType===l.Eu.KFTypePositionX?null==m?void 0:null===(s=m.clip)||void 0===s?void 0:null===(o=s.transform)||void 0===o?void 0:o.x:null==m?void 0:null===(c=m.clip)||void 0===c?void 0:null===(d=c.transform)||void 0===d?void 0:d.y;return t.keyframeList.some(e=>e.values[0]!==i)&&e.add("position"),e}case l.Eu.KFTypeRotation:return t.keyframeList.some(e=>{var t;return e.values[0]!==(null==m?void 0:null===(t=m.clip)||void 0===t?void 0:t.rotation)})&&e.add("rotate"),e;default:return e.add("other"),e}},new Set))&&void 0!==r?r:new Set,y=v.size>0,S=Array.from(v).join(",");(0,o.K)(e,u,[{...g,action_type:"click",template_id:_,option_type:t.optionType,material_type:null!==(d=null==m?void 0:null===(i=m.material)||void 0===i?void 0:i.type)&&void 0!==d?d:"",is_keyframe:y?"true":"false",keyframe_detail:y?S:void 0}])}function p(e,t){switch(t){case"disableScale":h(e,{optionType:"scale_fail"});return;case"disableDrag":h(e,{optionType:"move_fail"});return;case"disableRotate":h(e,{optionType:"rotate_fail"});return;default:(0,d.bP)(t)}}},574132:function(e,t,i){i.d(t,{JI:function(){return m},NR:function(){return p},QU:function(){return _}});var r=i(789786),a=i(426020),n=i(356954),o=i(339764),s=i(374497),l=i(108692),d=i(896413),c=i(425427),u=i(426336);class h{getEventParams(){var e,t;let{actionType:i,addFrom:r,aspectRatio:a,batchCnt:n,colorCode:l,fileType:d,isCommercial:c,isFastImport:h,isVip:p,keywordSource:_,materialCategory:m,materialChannel:f,materialDuration:g,materialForthcategory:v,spaceId:y,materialForthcategoryId:S,materialId:w,materialName:b,materialSource:M,materialSubcategory:T,materialSubcategoryId:k,materialThirdcategory:x,materialThirdcategoryId:I,optionType:P,rank:E,resolution:C,scene:D,requestId:F,searchId:A,searchKeyword:R,status:j,storage:O,trackIndex:B,trackType:V,waitTime:N,wordPosition:U,category:L,searchStartTabName:W,searchTabName:Z,materialGroupcategory:H,displayMode:z=o.d.floor,recommendId:K,templateId:$,isTemplateSubjectCrop:Y=!1,fromFolder:Q}=this._params,G=(0,s.ex)({mainDraftService:this._mainDraftService,mainEditorWidgetService:this._mainEditorWidgetService,videoEnvironmentService:this._videoEnvironmentService}),{subDraftTemplateId:X}=this._mainEditorWidgetService.segmentSelection,J=null!==(t=null!=$?$:X)&&void 0!==t?t:this._mainDraftService.draftTemplateManager.getTemplateId(),{clipType:q}=this._params,ee=null===(e=this._mainEditorWidgetService.segmentSelection.segment)||void 0===e?void 0:e.id;if(ee&&!q){let{clip_type:e}=this._mainEditorWidgetService.timelineManager.tracksManager.getClipTypeAndDuration(ee,!1);q=e}let et=P;return(0,u.OvQ)(this._mainEditorWidgetService.segmentSelection.segmentMutable)&&(et="replace"),{...G,action_type:i,add_from:r,aspect_ratio:a,batch_cnt:n,color_code:l,file_type:d,is_commercial:c?"true":"false",is_fast_import:h?1:0,is_vip:p?1:0,keyword_source:_||void 0,material_category:m,material_channel:f,material_duration:g,material_forthcategory:v,material_forthcategory_id:S,material_id:w,material_name:b,material_source:M,material_subcategory:null!=T?T:"none",material_subcategory_id:null!=k?k:"none",material_thirdcategory:null!=x?x:"none",material_thirdcategory_id:null!=I?I:"none",option_type:et,rank:E,resolution:C,scene:D,request_id:F,search_id:A,template_id:null!=J?J:"",search_keyword:R||void 0,status:j,storage:O?String(O):void 0,track_index:B,track_type:V,wait_time:N?Number(N.toFixed(0)):void 0,word_position:U||void 0,clip_type:q,space_id:y,category:L,display_mode:z,material_groupcategory:H,search_start_tab_name:W,search_tab_name:Z,rec_id:K,template_is_smart_crop:Y?"1":"0",from_folder:void 0===Q?void 0:Q?1:0}}constructor(e,t,i,r){this._params=e,this._mainDraftService=t,this._mainEditorWidgetService=i,this._videoEnvironmentService=r,this.eventName="add_material_to_track"}}function p(e,t){(0,n.K)(e,h,[t])}function _(e,t){p(e,{materialSubcategory:"cloud",...{scene:"category",addFrom:"material",isFastImport:!1,isVip:!1,materialCategory:"media",category:"media",...t}})}function m(e){if(e.sourceType===a.ov.EverCloud&&e.meta){let t;try{t=JSON.parse(e.meta)}catch(e){return}return t.is_from_tt_live?"ttlive":void 0}}h=(0,r.gn)([(0,r.fM)(1,l.n),(0,r.fM)(2,d.a),(0,r.fM)(3,c.rO),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IAddMaterialToTrackParams?Object:IAddMaterialToTrackParams,void 0===l.n?Object:l.n,void 0===d.a?Object:d.a,void 0===c.rO?Object:c.rO])],h)},310147:function(e,t,i){i.d(t,{Jr:function(){return s},a5:function(){return l}});var r=i(356954);let a="record_transcribe_entrance_session_storage";class n{getEventParams(){let{action:e,failReason:t,language:i,position:r,status:a,transcribeType:n}=this._params;return{action:e,fail_reason:t,language:i,position:r,status:a,transcribe_type:n}}constructor(e){this._params=e,this.eventName="click_trim_with_transcript"}}function o(e,t){(0,r.K)(e,n,[t])}function s(e,t){o(e,{...t,position:sessionStorage.getItem(a)})}function l(e,t){o(e,{position:t.position,action:"entrance_click"}),sessionStorage.setItem(a,t.position)}},970930:function(e,t,i){i.d(t,{y:function(){return n}});var r=i(356954);class a{getEventParams(){return{absorb_status:this._params.absorb_status,material_category:this._params.material_category,material_id:this._params.material_id,material_name:this._params.material_name,material_subcategory:this._params.material_subcategory,material_subcategory_id:this._params.material_subcategory_id,material_thirdcategory:this._params.material_thirdcategory,material_thirdcategory_id:this._params.material_thirdcategory_id,track_category:this._params.track_category,template_id:this._params.template_id}}constructor(e){this._params=e,this.eventName="cut_material_segment"}}function n(e,t){(0,r.K)(e,a,[t])}},956626:function(e,t,i){i.d(t,{Ds:function(){return g},SH:function(){return S},U4:function(){return f},X3:function(){return _},kO:function(){return m},o7:function(){return v}});var r,a,n,o,s,l=i(789786),d=i(356954),c=i(374497),u=i(108692),h=i(896413),p=i(425427);var _=((r={}).VIDEO="video",r.DROP_OFF="drop_off",r.TIMELINE_BLANK="timeline_blank",r);var m=((a={}).CLICK="click",a.SHORTKEY="shortkey",a.DRAG="drag",a);var f=((n={}).TRACK="track",n.BUBBLE="bubble",n);var g=((o={}).REPLACE="replace",o.SELECT="select",o.EDIT="edit",o.TRIM="trim",o.CROP="crop",o.DELETE="delete",o.EDIT_TEMPLATE="edit_template",o.INTEGRATE="integrate",o.UNHIDE_MATERIAL="unhide",o.HIDE_MATERIAL="hide",o.CANCEL="cancel",o.RETRY="retry",o);var v=((s={}).TIMELINE="timeline",s.BATCH_REPLACE="batch_replace",s.PLAYER="player",s.PANEL="panel",s);class y{getEventParams(){return{...(0,c.ex)({mainDraftService:this._mainDraftService,mainEditorWidgetService:this._mainEditorWidgetService,videoEnvironmentService:this._videoEnvironmentService}),...this._params}}constructor(e,t,i,r){this._params=e,this._mainDraftService=t,this._mainEditorWidgetService=i,this._videoEnvironmentService=r,this.eventName="template_track_option"}}function S(e,t){(0,d.K)(e,y,[t])}y=(0,l.gn)([(0,l.fM)(1,u.n),(0,l.fM)(2,h.a),(0,l.fM)(3,p.rO),(0,l.w6)("design:type",Function),(0,l.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===u.n?Object:u.n,void 0===h.a?Object:h.a,void 0===p.rO?Object:p.rO])],y)},658955:function(e,t,i){i.d(t,{C:function(){return d},v:function(){return u}});var r,a=i(789786),n=i(108692),o=i(896413),s=i(515336),l=i(195471);var d=((r={}).ChangeTemplate="change_template",r.ResizeBackground="resize_background",r.ChangeTemplateResizeBackground="change_template_resize_background",r);class c{getEventParams(){let{draftTemplateManager:e,dataSdk:t}=this._mainDraftService,i=e.getTemplateId()||this._mainEditorWidgetService.segmentSelection.subDraftTemplateId;if(!i)return{};let r=e.getTemplateSync(i),a={...(0,s.lQ)(r,null==t?void 0:t.draftView),after_ratio:this._params.afterRatio,ratio:this._params.ratio,change_ratio_type:this._params.changeRatioType,edit_type:"video_template_edit",template_id:this._params.beforeTemplateId};this._params.webId&&(a.after_template_id=this._params.webId);let n=e.getSourceTemplateId();return n&&(a.source_template_id=n),a}constructor(e,t,i){this._params=e,this._mainDraftService=t,this._mainEditorWidgetService=i,this.eventName="click_change_ratio_option"}}function u(e,t){(0,l.K)(e,c,[t])}c=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.fM)(2,o.a),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IClickChangeRatioOptionParams?Object:IClickChangeRatioOptionParams,void 0===n.n?Object:n.n,void 0===o.a?Object:o.a])],c)},342812:function(e,t,i){i.d(t,{d:function(){return a}});var r=i(801497);let a={get in(){return r.ZP.t("in_web",{},"\u5165\u573A")},get out(){return r.ZP.t("out_web",{},"\u51FA\u573A")},get group(){return r.ZP.t("combo_web",{},"\u7EC4\u5408")}}},795910:function(e,t,i){i.d(t,{r:function(){return s}});var r=i(789786),a=i(108692),n=i(356954);class o{getEventParams(){return{action:this._params.action}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="image_matting_window"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,r.gn)([(0,r.fM)(1,a.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===a.n?Object:a.n])],o)},544846:function(e,t,i){i.d(t,{F:function(){return n}});var r=i(356954);class a{getEventParams(){let e={function_category:this._params.functionCategory,function_subcategory:this._params.functionSubcategory,material_category:this._params.materialCategory,track_category:this._params.trackCategory};return this._params.functionThirdcategory&&(e=Object.assign(e,{function_thirdcategory:this._params.functionThirdcategory})),e}constructor(e){this._params=e,this.eventName="click_function_panel_reset"}}function n(e,t){(0,r.K)(e,a,[t])}},109450:function(e,t,i){i.d(t,{f:function(){return o}});var r=i(254336),a=i(692387);let n=e=>e.indexOf(".")>-1?e.split(".").pop():"";function o(e,t,i){let{scenario:o=r.cn.EDIT,featureKey:s="material",featureEntrance:l=r.oH.EDITOR,featureEntranceDetail:d=`${r.oH.EDITOR}-material_upload`,templateId:c}=i,u={scenario:o,featureKey:s,featureEntrance:l,featureEntranceDetail:d,templateId:c};t.onDidUpload(()=>{let i=t.getModel();(0,a.vK)(e,{...u,uploadType:null==i?void 0:i.fileType,status:a.vm.SUCCESS,fileSize:(null==i?void 0:i.size)||0,fileExtension:n(i.filename||"")})}),t.onUploadFailure(()=>{let i=t.getModel();(0,a.vK)(e,{...u,uploadType:null==i?void 0:i.fileType,status:a.vm.FAIL,fileSize:(null==i?void 0:i.size)||0,fileExtension:n(i.filename||"")})})}},827604:function(e,t,i){i.d(t,{x:function(){return u}});var r=i(789786),a=i(962916),n=i(356954),o=i(782350),s=i(426020),l=i(200247),d=i(775352);class c{getEventParams(){var e;let{searchParams:t}=new URL(window.location.href);return{...this._params,uploader_type:this._userMaterialUploadService.uploaderType,tool_type:null!==(e=t.get("__tool_type"))&&void 0!==e?e:void 0,is_login:this._accountService.hasLogin?1:0}}constructor(e,t,i,r){this._params=e,this._accountService=t,this._workspaceService=i,this._userMaterialUploadService=r,this.eventName="import_material_result"}}function u(e,t,i){var r,o,l;let d={...i,material_duration:t.fileType===s.YB.Video||t.fileType===s.YB.Audio?Math.round((null!==(r=t.duration)&&void 0!==r?r:0)*1e3):void 0,material_resolution:(t.fileType===s.YB.Video||t.fileType===s.YB.Image)&&t.width&&t.height?`${null!==(o=t.width)&&void 0!==o?o:0} * ${null!==(l=t.height)&&void 0!==l?l:0}`:"",...(0,a.U)(t)};(0,n.K)(e,c,[d])}c=(0,r.gn)([(0,r.fM)(1,l.D),(0,r.fM)(2,o.W),(0,r.fM)(3,d.ec),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ImportMaterialPrams?Object:ImportMaterialPrams,void 0===l.D?Object:l.D,void 0===o.W?Object:o.W,void 0===d.ec?Object:d.ec])],c)},285266:function(e,t,i){i.d(t,{G:function(){return c}});var r=i(789786),a=i(962916),n=i(356954),o=i(782350),s=i(200247),l=i(775352);class d{getEventParams(){return{...this._params,uploader_type:this._userMaterialUploadService.uploaderType,is_login:this._accountService.hasLogin?1:0}}constructor(e,t,i,r){this._params=e,this._accountService=t,this._workspaceService=i,this._userMaterialUploadService=r,this.eventName="import_material_start"}}function c(e,t,i){let r={...i,...(0,a.U)(t)};(0,n.K)(e,d,[r])}d=(0,r.gn)([(0,r.fM)(1,s.D),(0,r.fM)(2,o.W),(0,r.fM)(3,l.ec),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ImportMaterialPrams?Object:ImportMaterialPrams,void 0===s.D?Object:s.D,void 0===o.W?Object:o.W,void 0===l.ec?Object:l.ec])],d)},962916:function(e,t,i){i.d(t,{U:function(){return o}});var r=i(254336),a=i(426020);let n={[a.YB.Video]:r.V$.VIDEO,[a.YB.Image]:r.V$.IMAGE,[a.YB.Audio]:r.V$.AUDIO,[a.YB.File]:r.V$.FILE};function o(e){var t;return{material_name:null!==(t=e.filename)&&void 0!==t?t:"",material_type:n[e.fileType],material_size:e.size?String(e.size/1e3):"0",material_format:e.filename?e.filename.split(".").pop():""}}},410138:function(e,t,i){i.d(t,{o:function(){return p}});var r=i(789786),a=i(70246),n=i(962916),o=i(356954),s=i(254336),l=i(782350),d=i(426020),c=i(200247),u=i(775352);class h{getEventParams(){var e,t;let{searchParams:i}=new URL(window.location.href);return{...this._params,uploader_type:this._userMaterialUploadService.uploaderType,is_login:this._accountService.hasLogin?1:0,tool_type:null!==(e=i.get("__tool_type"))&&void 0!==e?e:void 0,space_id:null!==(t=this._params.fromWorkspaceId)&&void 0!==t?t:"",space_type:this._params.fromWorkspaceId?this._workspaceService.getWorkspace(this._params.fromWorkspaceId).space_type:0,raw_space_type:this._params.fromWorkspaceId?this._workspaceService.getWorkspace(this._params.fromWorkspaceId).raw_space_type:0,space_user_cnt:this._params.fromWorkspaceId?this._workspaceService.getWorkspace(this._params.fromWorkspaceId).member_cnt:0}}constructor(e,t,i,r){this._params=e,this._accountService=t,this._workspaceService=i,this._userMaterialUploadService=r,this.eventName="import_material"}}function p(e,t,i){var r,l,c,u,p,_;let m={...i,...(0,n.U)(t),is_fast_import:(null===(r=t.uploading)||void 0===r?void 0:r.isSupportFastImport)?1:0,material_duration:t.fileType===d.YB.Video||t.fileType===d.YB.Audio?Math.round((null!==(l=t.duration)&&void 0!==l?l:0)*1e3):void 0,material_resolution:(t.fileType===d.YB.Video||t.fileType===d.YB.Image)&&t.width&&t.height?`${null!==(c=t.width)&&void 0!==c?c:0} * ${null!==(u=t.height)&&void 0!==u?u:0}`:"",fail_reason:i.status===s.CF.FAIL?null!==(_=null!==(p=i.fail_reason)&&void 0!==p?p:function(e){if(!!e){for(let t in a.D3)if(a.D3[t]===e)return t}}(i.error_code))&&void 0!==_?_:"unkown error":void 0};(0,o.K)(e,h,[m])}h=(0,r.gn)([(0,r.fM)(1,c.D),(0,r.fM)(2,l.W),(0,r.fM)(3,u.ec),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ImportMaterialPrams?Object:ImportMaterialPrams,void 0===c.D?Object:c.D,void 0===l.W?Object:l.W,void 0===u.ec?Object:u.ec])],h)},860660:function(e,t,i){i.d(t,{KG:function(){return p},Of:function(){return d},p8:function(){return c},u8:function(){return h}});var r=i(854585),a=i(794273),n=i(860147),o=i(426336),s=i(800788);function l(e){if(!e)return"";switch(!0){case(0,o.NHR)(e):return"ai_character";case(0,o.hey)(e)&&e.material.type===o.cVg.MetaTypePhoto:return"image";case(0,o.hey)(e)&&(0,a.Ff)(e.transition):return"transition";case(0,o.hey)(e)&&!(0,o.duj)(e):return"video";case(0,o.Y9Q)(e):return"audio";case(0,o.Ftn)(e):case(0,o.Q2R)(e):return"text";case(0,o.P2T)(e):return"sticker";case(0,o.SiN)(e):return"filter";case(0,o.E6P)(e):return"adjustment_preset";case(0,o.w5o)(e):return"effect";case(0,o.duj)(e):return"templates";default:(0,s.ss)()}}function d(e,t){if(r.Yr.includes(e))switch(t){case o.cvu.MaterialPlatformArtist:return"heycan";case o.cvu.MaterialPlatformGiphy:return"giphy";case o.cvu.MaterialPlatformBrand:return"brand"}else if(r.i$.includes(e))switch(t){case o.QZ3.AudioPlatformArtist:return"heycan";case o.QZ3.AudioPlatformLibrary:return"lib";case o.QZ3.AudioPlatformBrand:return"brand"}return""}function c(e){var t,i,r,s,c,u,h,p,_,m,f,g,v,y,S,w,b,M,T,k,x,I,P,E,C,D,F,A,R,j;let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2?arguments[2]:void 0;if(!e)return{material_category:"",material_subcategory:"",material_thirdcategory:"",material_thirdcategory_id:"",material_id:"",material_name:"",material_type:"",track_category:"",panel_category:l(e)};if(O&&(0,o.hey)(e)&&(0,a.Ff)(e.transition))return{material_category:"trans",material_subcategory:"",material_thirdcategory:e.transition.categoryName,material_thirdcategory_id:e.transition.categoryId,material_id:null!==(t=e.transition.resourceId)&&void 0!==t?t:"",material_name:null!==(i=e.transition.name)&&void 0!==i?i:"",material_type:null!==(r=e.transition.type)&&void 0!==r?r:"",track_category:"transition",panel_category:l(e)};if((0,o.hey)(e)&&(0,o.duj)(e)){let t=B?B.dataSdk.draftView.getTrackBySegmentId(e.id):void 0;return{material_thirdcategory:e.material.categoryName,material_thirdcategory_id:e.material.categoryId,material_id:null!==(s=e.templateId)&&void 0!==s?s:"",material_name:null!==(c=e.material.materialName)&&void 0!==c?c:"",material_type:null!==(u=e.material.type)&&void 0!==u?u:"",track_category:t&&!(0,o.MDU)(t)?"vice_video":"video",panel_category:l(e),material_category:"templates",material_subcategory:"",template_id:null!==(h=e.templateId)&&void 0!==h?h:""}}if((0,o.hey)(e)&&!(0,o.duj)(e)){let t=B?B.dataSdk.draftView.getSegmentPath(e.id):[e.id],i=B?B.dataSdk.draftView.getTrackBySegmentId(t[0]):void 0,r=d(e.material.type,e.material.sourcePlatform),a=e.material.type===o.cVg.MetaTypePhoto,n=e.material.sourcePlatform===o.cvu.MaterialPlatformDefault,s=(0,o.NHR)(e),c={material_thirdcategory:e.material.categoryName,material_thirdcategory_id:e.material.categoryId,material_id:s?"none":null!==(p=e.material.materialId)&&void 0!==p?p:"",material_name:s?e.digitalHuman.digitalHumanId:null!==(_=e.material.materialName)&&void 0!==_?_:"",material_type:null!==(m=e.material.type)&&void 0!==m?m:"",track_category:i?(0,o.MDU)(i)?"video":"vice_video":a?"image":"video",panel_category:l(e),material_category:s?"ai_character":n?"media":a?"photos":"material_lib",material_subcategory:n?"project":""};if("giphy"===r)return{...c,material_category:"sticker",material_subcategory:"giphy"};if("heycan"===r)return{...c,material_category:a?"photos":"material_lib",material_subcategory:""};else if("brand"===r)return{...c,material_category:a?"photos":"material_lib",is_brand:!0};else return c}if((0,o.Y9Q)(e)){let t=e.material.type===o.cVg.MetaTypeMusic?"music":"sound_effects";return{material_category:"audio",sub_category:t,material_subcategory:t,material_thirdcategory:null!==(f=e.material.categoryName)&&void 0!==f?f:"",material_thirdcategory_id:null!==(g=e.material.categoryId)&&void 0!==g?g:"",material_id:null!==(v=e.material.musicId)&&void 0!==v?v:"",material_name:null!==(y=e.material.name)&&void 0!==y?y:"",material_type:null!==(S=e.material.type)&&void 0!==S?S:"",track_category:"audio",panel_category:l(e),is_brand:e.material.sourcePlatform===o.QZ3.AudioPlatformBrand}}if((0,o.Ftn)(e)){let t=e.effect||0!==e.effects.length?"text_effects":"text",i=null!==(b=e.effect)&&void 0!==b?b:null===(w=e.effects)||void 0===w?void 0:w[0],r={material_category:"text",sub_category:t,material_subcategory:t,material_id:null!==(M=null==i?void 0:i.resourceId)&&void 0!==M?M:"",material_name:null!==(T=null==i?void 0:i.name)&&void 0!==T?T:"",material_type:null!==(k=e.material.type)&&void 0!==k?k:"",track_category:"text",panel_category:l(e),material_thirdcategory:null==i?void 0:i.categoryName,material_thirdcategory_id:null==i?void 0:i.categoryId,is_brand:e.material.fontSourcePlatform===o.nj7.EffectPlatformBrand};return(0,n.Cq)(e)||(0,n.K9)(e)?{...r,material_category:"subtitle",track_category:"subtitle"}:r}if((0,o.Q2R)(e)){let t="text_template";return{track_category:"text",panel_category:l(e),material_category:"text",sub_category:t,material_subcategory:t,material_thirdcategory:e.material.categoryName,material_thirdcategory_id:e.material.categoryId,material_id:e.material.resourceId,material_name:e.material.name,material_type:null!==(x=e.material.type)&&void 0!==x?x:"",text_type:"text_template"}}return(0,o.P2T)(e)?{material_category:"sticker",panel_category:l(e),material_subcategory:"stickers",material_thirdcategory:e.material.categoryName,material_thirdcategory_id:e.material.categoryId,material_id:null!==(I=e.material.stickerId)&&void 0!==I?I:"",material_name:null!==(P=e.material.name)&&void 0!==P?P:"",material_type:null!==(E=e.material.type)&&void 0!==E?E:"",track_category:"sticker",is_brand:e.material.sourcePlatform===o.nj7.EffectPlatformBrand}:(0,o.SiN)(e)?{material_category:"filter",material_subcategory:"",material_thirdcategory:e.material.categoryName,material_thirdcategory_id:e.material.categoryId,material_id:null!==(C=e.material.resourceId)&&void 0!==C?C:"",material_name:null!==(D=e.material.name)&&void 0!==D?D:"",material_type:null!==(F=e.material.type)&&void 0!==F?F:"",track_category:"filter",panel_category:l(e)}:(0,o.w5o)(e)?{material_category:"effect",material_subcategory:e.material.type===o.cVg.MetaTypeVideoEffect?"video_effect":"body_effect",material_thirdcategory:e.material.categoryName,material_thirdcategory_id:e.material.categoryId,material_id:null!==(A=e.material.effectId)&&void 0!==A?A:"",material_name:null!==(R=e.material.name)&&void 0!==R?R:"",material_type:null!==(j=e.material.type)&&void 0!==j?j:"",track_category:"effect",panel_category:l(e)}:(0,o.E6P)(e)?{material_category:"",material_subcategory:"",material_thirdcategory:"",material_thirdcategory_id:"",material_id:"",material_name:"",material_type:"",track_category:"adjust",panel_category:l(e)}:{material_category:"",material_subcategory:"",material_thirdcategory:"",material_thirdcategory_id:"",material_id:"",material_name:"",material_type:"",track_category:"",panel_category:l(e)}}function u(e){let t={material_category:"",material_subcategory:"",material_subcategory_id:"none",material_thirdcategory:"",material_thirdcategory_id:"none",material_id:"none",material_name:"",track_category:"",template_id:void 0},i={material_category:"",material_subcategory:"",material_subcategory_id:"",material_thirdcategory:"",material_thirdcategory_id:"",material_id:"",material_name:"",track_category:"",template_id:""};return Object.keys(i).forEach(r=>{i[r]=e.map(e=>{var i;return null!==(i=e[r])&&void 0!==i?i:t[r]}).filter(e=>void 0!==e).join(",")}),""===i.template_id&&(i.template_id=void 0),i.is_batch=e.length>1?1:0,i}function h(e){let{segments:t,transitionSegments:i}=e,r=t.map(e=>c(e,!1));return u([...r,...i.map(e=>c(e,!0))])}function p(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u(e.map(e=>c(e,t)))}},256179:function(e,t,i){i.d(t,{T:function(){return n}});var r=i(356954);class a{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="perf_cover_upload_set_cover"}}function n(e,t){(0,r.K)(e,a,[t])}},257635:function(e,t,i){i.d(t,{kK:function(){return o}});var r=i(52533),a=i(874916),n=i(820306);function o(e,t){let{onSaveDraftSuccess:i,onSaveDraftFail:o}=(0,n.n)(e,t);return n=>{let s;if(n.ok){let e=(0,r.Z)(n.value)?void 0:n.value;i(e),s={saveStatus:"success",packageId:e}}else o(n.msg),s={saveStatus:"failed",failReason:n.msg};"auto"===t&&(0,a.L)(e,s)}}},264336:function(e,t,i){i.d(t,{b:function(){return n}});var r=i(356954);class a{getEventParams(){return{blob_url:this._params.blobUrl,file_path:this._params.filePath,substitute_path:this._params.substitutePath}}constructor(e){this._params=e,this.eventName="quick_import_replace_and_remove_blob"}}function n(e,t){(0,r.K)(e,a,[t])}},697959:function(e,t,i){i.d(t,{C:function(){return d},o:function(){return l}});var r=i(426336);let a=async(e,t,i,a)=>{if(i){if(t.effect=void 0,0n===(a&=~r.ic0.translateModifyFlags(r.XHM.ModifyStyleName)))return;let i=async(e,t,i)=>{let[,a]=await (0,r.mL_)(e,i);t.baseContent=a,t.content=a,t.text=r.hMI.getOriginContentFromContent(a)};await r.ic0.updateRichTextStyle(t,e.textMaterial,a,i)}else{let i=async function(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t||!i)return;let[n,o]=await (0,r.mL_)(e,i,a);if(!!n)t.baseContent=o,t.content=o,t.text=r.hMI.getOriginContentFromContent(o)};await r.ic0.setRichTextMaterial(t,e.textMaterial,(0,r.ABm)({}),e.bloomMaterial,a,e.selectionUpdate,i)}},n=(e,t)=>{let{textMaterial:i,bloomMaterial:a}=e,n=e=>{let[,t]=r.OPZ.pack(e);return t};if(t===r.Eu.KFTypeBorderWidth)return[i.borderWidth];if(t===r.Eu.KFTypeTextAlpha)return[i.textAlpha];if(t===r.Eu.KFTypeBackgroundAlpha)return[i.bgAlpha];else if(t===r.Eu.KFTypeShadowAlpha)return i.hasShadow?[i.shadowAlpha]:[0];else if(t===r.Eu.KFTypeShadowSmoothing)return[i.shadowSmoothing];else if(t===r.Eu.KFTypeShadowAngle)return[i.shadowAngle];else if(t===r.Eu.KFTypeShadowDistance)return[i.shadowDistance];else if(t===r.Eu.KFTypeBorderColor)return n(i.borderColor);else if(t===r.Eu.KFTypeTextColor)return n(i.textColor);else if(t===r.Eu.KFTypeShadowColor)return n(i.shadowColor);else if(t===r.Eu.KFTypeBackgroundColor)return n(i.bgColor);else if(t===r.Eu.KFTypeGlobalAlpha)return[i.globalAlpha];else if(t===r.Eu.KFTypeBloomColor)return n(a.bloomActionParams.color);else if(t===r.Eu.KFTypeBloomStrength)return[a.bloomActionParams.strength];else if(t===r.Eu.KFTypeBloomRange)return[a.bloomActionParams.range];else if(t===r.Eu.KFTypeBloomDirX)return[a.bloomActionParams.dirX];else if(t===r.Eu.KFTypeBloomDirY)return[a.bloomActionParams.dirY];else if(t===r.Eu.KFTypeBorderAlpha){let e=n(i.borderColor);return[e[e.length-1]]}return[]},o=(e,t,i,a)=>{let o=a,s=[];if(a.includes(r.Eu.KFTypeBorderColor)&&""===t.material.borderColor&&s.push(r.Eu.KFTypeBorderColor,r.Eu.KFTypeBorderAlpha,r.Eu.KFTypeBorderWidth),0===t.material.backgroundStyle&&s.push(r.Eu.KFTypeBackgroundColor,r.Eu.KFTypeBackgroundAlpha),!t.material.hasShadow&&s.push(r.Eu.KFTypeShadowAlpha,r.Eu.KFTypeShadowAngle,r.Eu.KFTypeShadowColor,r.Eu.KFTypeShadowDistance,r.Eu.KFTypeShadowSmoothing),s.length>0){for(let e of s)r.OLp.takeKeyframes(t,e);o=o.filter(e=>!s.includes(e))}let l=!1;for(let a of o){let o=r.ysx.execute({draftView:i,segment:t,keyframeType:a,keyframeId:e.keyframeId,values:n(e,a)});if(l=l||!!o,null==o?void 0:o.segmentDelta.commonKeyframes){let e=t.commonKeyframes.findIndex(e=>e.propertyType===a),i=o.segmentDelta.commonKeyframes.find(e=>e&&e.propertyType===a);e>-1?i?t.commonKeyframes[e]=i:t.commonKeyframes.splice(e,1):i&&t.commonKeyframes.push(i)}}return l},s=async(e,t,i,r,n,s)=>(await a(e,t,i,r),o(e,t,n,s)),l=function(e,t,i){var a;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1n,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=e.getSegmentById(t);if(!s)return[];let l=[],d=null===(a=s.material)||void 0===a?void 0:a.type;if((i||0!==o.length)&&(d===r.cVg.MetaTypeSubtitle||d===r.cVg.MetaTypeLyrics||d===r.cVg.MetaTypeText)){let t=r.pNd.TrackTypeText;l.push(...e.getSegmentsByTrackTypeAndMaterialType(t,d,o))}else l.push(s);if(n>=0){let e=[];for(let t of l){let i=n-t.targetTimerange.start;i>=0&&i<=t.targetTimerange.duration&&e.push(t)}return e}return l},d=async(e,t)=>{let i=e.getDraftId(),n=e.getSegmentById(t.segId);if(!n||!(0,r.Ftn)(n))return[];let o=[],d=n.clone(),c=r.ic0.combineModifyFlags(t.modifyFlags),u=r.ic0.forceApplyToAll(c)&&!t.selectionUpdate,h=c&~(1n<<BigInt(r.XHM.ModifyRichTextStyleToAll)),p=h===BigInt(r.XHM.ModifyTextAll),_=r.ic0.isApplyTextPresetStyleFlag(h)&&!p,m=[];if((p||h&r.ic0.translateModifyFlags(r.XHM.ModifyTextAlpha))&&m.push(r.Eu.KFTypeTextAlpha),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyTextBorderWidth))&&m.push(r.Eu.KFTypeBorderWidth),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyTextBgAlpha))&&m.push(r.Eu.KFTypeBackgroundAlpha),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyShadowAlpha))&&m.push(r.Eu.KFTypeShadowAlpha),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyShadowSmoothing))&&m.push(r.Eu.KFTypeShadowSmoothing),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyShadowAngle))&&m.push(r.Eu.KFTypeShadowAngle),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyShadowDistance))&&m.push(r.Eu.KFTypeShadowDistance),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyTextBorderColor))&&(m.push(r.Eu.KFTypeBorderColor),m.push(r.Eu.KFTypeBorderAlpha)),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyTextColor))&&m.push(r.Eu.KFTypeTextColor),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyShadowColor))&&m.push(r.Eu.KFTypeShadowColor),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyHasShadow))&&m.push(r.Eu.KFTypeShadowAlpha),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyTextBgColor))&&m.push(r.Eu.KFTypeBackgroundColor),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyGlobalAlpha))&&m.push(r.Eu.KFTypeGlobalAlpha),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyBloomColor))&&m.push(r.Eu.KFTypeBloomColor),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyBloomStrength))&&m.push(r.Eu.KFTypeBloomStrength),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyBloomRange))&&m.push(r.Eu.KFTypeBloomRange),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyBloomDirX))&&m.push(r.Eu.KFTypeBloomDirX),(p||h&r.ic0.translateModifyFlags(r.XHM.ModifyBloomDirY))&&m.push(r.Eu.KFTypeBloomDirY),await s(t,d,_,h,e,m)){let{material:e}=d;r.hMI.isRichText(e.baseContent||e.content)&&r.ic0.removeConflictKeyframeProperty(d),h&BigInt(1<<r.XHM.ModifyHasShadow)&&(e.hasShadow=t.textMaterial.hasShadow)}t.textMaterial.words.length>0&&(d.material.words=new r.H1R({startTime:t.textMaterial.words.map(e=>e.startTime),endTime:t.textMaterial.words.map(e=>e.endTime),text:t.textMaterial.words.map(e=>e.text)})),0===t.textMaterial.words.length&&n.material.addType===r.RZH.ManualAdd&&""!==t.textMaterial.content&&(d.material.words=r.LCH.generateTextMaterialWords(r.hMI.getOriginContentFromContent(t.textMaterial.content),n.targetTimerange.duration));let f=new r.xKN;f.material=new r.edz(d.material),f.bloom=new r.W9x(d.bloom),f.commonKeyframes=d.commonKeyframes;let g=e.getTrackBySegmentId(n.id);if(g){let t=(0,r.xXD)({__segment_struct_type:d.__segment_struct_type});r.T8X.pick(d,f,t),o.push({draftId:i,trackId:g.id,trackIndex:e.getTrackIndexById(g.id),segmentId:d.id,segmentDelta:f,sourceSegmentDelta:t})}for(let n of(h=c,!u&&(h&=~(1n<<BigInt(r.XHM.ModifyRichTextStyleToAll))),h&=~(1n<<BigInt(r.XHM.ModifyTextColor)),h&=~(1n<<BigInt(r.XHM.ModifyTextAlpha)),h&=~(1n<<BigInt(r.XHM.ModifyTextBorderColor)),h&=~(1n<<BigInt(r.XHM.ModifyTextBorderWidth)),h&=~(1n<<BigInt(r.XHM.ModifyShadowColor)),h&=~(1n<<BigInt(r.XHM.ModifyShadowAlpha)),h&=~(1n<<BigInt(r.XHM.ModifyShadowSmoothing)),h&=~(1n<<BigInt(r.XHM.ModifyShadowAngle)),h&=~(1n<<BigInt(r.XHM.ModifyShadowDistance)),h&=~(1n<<BigInt(r.XHM.ModifyFontSize)),h&=~(1n<<BigInt(r.XHM.ModifyBoldWidth)),h&=~(1n<<BigInt(r.XHM.ModifyItalicDegree)),h&=~(1n<<BigInt(r.XHM.ModifyUnderline)),h&=~(1n<<BigInt(r.XHM.ModifyUnderlineWidth)),h&=~(1n<<BigInt(r.XHM.ModifyUnderlineOffset)),h&=~(1n<<BigInt(r.XHM.ModifyCheckFlag)),l(e,t.segId,t.syncToAll,BigInt(t.syncToActionTime),t.segmentIds))){if(n.id===d.id||!(0,r.Ftn)(n))continue;let s=n.clone();(t.syncToAll||t.segmentIds.length>0)&&u&&(t.textMaterial.replaceStyleRichText=d.material.content,r.ic0.updateTextMaterial(s,t.textMaterial,t.bloomMaterial,c),r.ic0.syncRichTextResources(s,d)),await a(t,s,_,h);let l=new r.xKN({effects:s.effects});l.material=new r.edz(s.material),l.material.richTextCommand=null,l.bloom=new r.W9x(s.bloom);let p=e.getTrackBySegmentId(s.id);if(p){let t=(0,r.xXD)({__segment_struct_type:s.__segment_struct_type});r.T8X.pick(s,f,t),o.push({draftId:i,trackId:p.id,trackIndex:e.getTrackIndexById(p.id),segmentId:s.id,segmentDelta:l,sourceSegmentDelta:t})}}return o}},252842:function(e,t,i){i.d(t,{X:()=>v});var r=i("789786"),a=i("587892"),n=i("690613"),o=i("800788"),s=i("560308"),l=i("426336");let d=async function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{keepEmptyPlaceholder:!1},r=e.getSegmentById(t.segId);if(!r||!(0,l.Ftn)(r))return null;let{material:a}=r;if(a.content===t.content)return null;let n=t.content.indexOf("\b"),o=l.hMI.getOriginContentFromContent(t.content),s=new l.BzH;if(t.isEditing){"\b"!==t.content&&!(null==i?void 0:i.keepEmptyPlaceholder)&&-1!==(n=t.content.indexOf("\b"))&&(t.content=t.content.replace("\b","")),s.iOpCode=l.wIK.CT_EDIT_TEXT_PARAM,s.iParam1=1;let e={richText:t.content};s.iParam5=JSON.stringify(e)}else{s.iOpCode=l.wIK.CT_EDIT_TEMPLATE_TEXT_STYLE;let e={text:""===o?"\b":o,templateStyle:a.content};s.iParam5=JSON.stringify(e);let[i,r]=await (0,l.mL_)(t.segId,s);i&&(t.content=r)}return s};var c=i("786030"),u=i("970244"),h=i("697959"),p=i("190825"),_=i("952538");let m=e=>{var t;let i={fontResourceId:e.fonts.length>1?_.EL.MIXED_VALUES:null!==(t=e.fonts[0])&&void 0!==t?t:"",fontSize:1===e.fontSizes.length?Math.round(e.fontSizes[0]):void 0,boldWidth:1===e.boldStyles.length&&e.boldStyles[0]?_.R0:0,italicDegree:1===e.italicStyles.length&&e.italicStyles[0]?_.uj:0,underline:1===e.underlineStyles.length&&e.underlineStyles[0],borderWidth:1===e.outlineWidths.length?e.outlineWidths[0]:_.YF,shadowAlpha:1===e.shadowAlphas.length?e.shadowAlphas[0]:_.yt,shadowSmoothing:1===e.shadowSmooths.length?18*e.shadowSmooths[0]:_.$$,shadowDistance:1===e.shadowDistances.length?100*e.shadowDistances[0]:_.pn,shadowAngle:1===e.shadowAngles.length?e.shadowAngles[0]:_.du};return 1===e.textColors.length&&(i.textColor=e.textColors[0]),1===e.outlineColors.length&&(i.borderColor=e.outlineColors[0]),1===e.shadowColors.length&&(i.shadowColor=e.shadowColors[0]),!e.outlineEnabled&&(i.borderColor=""),!e.shadowEnabled&&(i.shadowColor="",i.shadowAlpha=void 0),i.mixedStyles={fontId:e.fonts.length>1,fontSize:e.fontSizes.length>1,bold:e.boldStyles.length>1,italic:e.italicStyles.length>1,underline:e.underlineStyles.length>1,textColors:e.textColors,textColor:e.textColors.length>1,outlineColors:e.outlineEnabled?e.outlineColors:void 0,outlineColor:e.outlineColors.length>1,outlineWidth:e.outlineWidths.length>1,shadowColors:e.shadowEnabled?e.shadowColors:void 0,shadowColor:e.shadowColors.length>1,shadowAlpha:e.shadowAlphas.length>1,shadowSmooth:e.shadowSmooths.length>1,shadowDistance:e.shadowDistances.length>1,shadowAngle:e.shadowAngles.length>1},i};var f=i("761811"),g=i("725341");class v{getRichTextEditorUtilConfig(){return{...this._config}}setRichTextEditorUtilConfig(e){this._config={...this._config,...e}}getFontPath(){return""}setDefaultFontPath(e){}checkAfterLifecycle(e){return!0}async templateUpdateMutableText(e,t){var i;let r=null!==(i=this._dataSdk.draftView.getDraftById(t))&&void 0!==i?i:this._dataSdk.draftView,a=this._getMutableTextsActionOptions(r,e),n=await Promise.all(a.text.map(async e=>({updates:await (0,h.C)(r,e)}))),o=a.textTemplate.map(e=>(0,f.g)(r,e)).filter(e=>e);this._dataSdk.api.template.setMutableTexts({draftId:t,text:n,textTemplate:[{updates:o}]})}_getMutableMaterials(e){var t;let i=new Map,{mutableConfig:r}=e.getDraftProperty();for(let e of null!==(t=null==r?void 0:r.mutableMaterials)&&void 0!==t?t:[])i.set(e.id,e);return i}_getMutableTextsActionOptions(e,t){let i=this._getMutableMaterials(e),r=e.getTracksByTypes([l.pNd.TrackTypeText,l.pNd.TrackTypeSticker]),a=new Map;for(let e of r)for(let t of e.segments)if((0,l.Ftn)(t)){let e=t.material.id;if(e){if(!i.has(e))continue;a.set(e,t)}}else if((0,l.Q2R)(t)){let{material:e}=t;if(e)for(let r of e.textInfoResources){let e=r.textMaterial.id;if(!!i.has(e))a.set(e,t)}}let n={text:[],textTemplate:[]};for(let e of t){let t=a.get(e.id);if(!!t)(0,l.Ftn)(t)?n.text.push(this.setMutableText(e,t)):(0,l.Q2R)(t)&&n.textTemplate.push(this.setMutableTextTemplate(e,t))}return n}setMutableText(e,t){let i=(0,l.U_g)({});return i.content=e.text,(0,l.OTo)({segId:t.id,modifyFlags:[l.XHM.ModifyContent],textMaterial:i,isKeyframe:!1})}setMutableTextTemplate(e,t){let{material:i}=t,r=(0,l.yCo)({segId:t.id});r.textInfo.content=e.text;let a=0;for(let t of i.textInfoResources){if(t.textMaterial.id===e.id){r.textInfo.index=a;break}a++}return r}async textUpdateMaterial(e,t){var i;e.draftId&&this.textEndSubDraftPreview(e.segId);let r=null!==(i=this._dataSdk.draftView.getDraftById(e.draftId))&&void 0!==i?i:this._dataSdk.draftView,a=(0,l.OTo)(e);this._richTextEditor.getEditingId()!==e.segId&&await this._richTextEditor.beginEdit(e.segId);let n=await (0,h.C)(r,a);if(0!==n.length)this._dataSdk.api.text.setMaterials({updates:n}),e.modifyFlags.includes(l.XHM.ModifyContent)&&await this._richTextEditor.endEdit(e.segId)}async textUpdateMaterialPreview(e){var t;let{executor:i}=this._renderManager;if(!i)return;let{segId:r,textMaterial:a,selectionUpdate:n}=e;this._richTextEditor.getEditingId()!==r&&await this._richTextEditor.beginEdit(r);let o=new l.BzH;if(void 0!==a.fontPath&&void 0!==a.fontResId&&void 0!==a.fontId){o.iOpCode=l.wIK.CT_EDIT_FONT,o.iParam5=`{"id": "${0===a.fontResId.length?a.fontId:a.fontResId}", "path": "${a.fontPath}"}`;let[,e]=await (0,l.mL_)(r,o,n),t=new l.xKN;t.material=new l.edz,t.material.baseContent=e,t.material.content=e,t.material.richTextCommand=o,this._updateTextPreview(r,t)}else if(void 0!==a.fontSize){o.iOpCode=l.wIK.CT_EDIT_SIZE,o.iParam1=a.fontSize;let[,e]=await (0,l.mL_)(r,o,n),t=new l.xKN;t.material=new l.edz,t.material.baseContent=e,t.material.content=e,t.material.fontSize=a.fontSize,t.material.richTextCommand=o,this._updateTextPreview(r,t)}else if(null===(t=e.modifyFlags)||void 0===t?void 0:t.includes(l.XHM.ModifyContent)){o.iOpCode=l.wIK.CT_EDIT_TEMPLATE_TEXT_STYLE,o.iParam5=JSON.stringify({text:e.textMaterial.content,templateStyle:e.textMaterial.replaceStyleRichText});let[,t]=await (0,l.mL_)(r,o,n),i=new l.xKN;i.material=new l.edz,i.material.baseContent=t,i.material.content=t,e.textMaterial.fixedWidth?(i.material.fixedWidth=e.textMaterial.fixedWidth,i.material.richTextCommand=new l.BzH):i.material.richTextCommand=o,this._updateTextPreview(r,i)}}getRichTextUtil(){return l.hMI}async textUpdateTextTemplateMaterialPreview(e){var t,i;let{executor:r}=this._renderManager;if(!r)return;let{segId:a}=e;this._richTextEditor.getEditingId()!==a&&await this._richTextEditor.beginEdit(a);let n=(0,l.u3w)({...e}),o=(0,g.c)(this._dataSdk.draftView,{...n});if(null==o?void 0:null===(t=o[0])||void 0===t?void 0:t.segmentDelta){let e=this._dataSdk.draftView.getSegmentPath(a);this._renderManager.preview({item:{id:a,path:e,segment:null==o?void 0:null===(i=o[0])||void 0===i?void 0:i.segmentDelta,segmentType:l.Ocy.SegmentTextTemplate,trackIndex:this._dataSdk.draftView.getTrackIndexBySegmentId(a)},order:0,type:l.C8.UPDATE})}}async textUpdateMaterialResetPreview(e){let{executor:t}=this._renderManager;if(!t)return;let i=await this._richTextEditor.getSelectRange(),r=new l.BzH;r.iOpCode=l.wIK.CT_EDIT_TEXT_PARAM,r.iParam1=1;let a=new l.xKN;a.material=new l.edz,a.material.richTextCommand=r,this._updateTextPreview(e,a),i.length>0&&this._richTextEditor.selectContent(i)}textTemplateUpdateMaterialResetPreview(e){this._renderManager.resetPreview()}textTemplateUpdateText(e){let t=(0,f.g)(this._dataSdk.draftView,e);t&&this._dataSdk.api.textTemplate.setMaterial({updates:[t]})}textTemplateUpdateMaterial(e){let t=(0,l.u3w)({...e}),i=(0,g.c)(this._dataSdk.draftView,t);i&&i.length&&this._dataSdk.api.textTemplate.setMaterial({updates:i})}async textChangeConvertCase(e,t,i){let r=await (0,p.y)(this._dataSdk.draftView,e,t,i);this._dataSdk.api.text.setMaterials({updates:r})}async textUpdateEffect(e,t){var i;let r=null!==(i=this._dataSdk.draftView.getDraftById(t))&&void 0!==i?i:this._dataSdk.draftView,a=await (0,l.vJZ)(r,e);this._dataSdk.api.text.updateEffect({updates:a})}textReset(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],(0,n.oW)("textReset")}adjustFixedSize(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],(0,n.oW)("adjustFixedSize")}textEnterSubDraft(e){this._draftId=e}textExitSubDraft(){this._draftId=void 0}async textBeginEdit(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;await this._richTextEditor.beginEdit(e,new c.Yw(i,r)),await this.textEditUpdateSnapshot()}async textEndEdit(e,t){await this._richTextEditor.endEdit(e),this._richTextEditor.clearSnapshots(),this._fireSelectionCleared(),this.textExitSubDraft()}async textSelectAll(){await this._richTextEditor.selectAll(),await this.textEditUpdateSnapshot()}async textEditUpdateSnapshot(){let e=this._dataSdk.api.undoRedo.getTopItemId(),t=await this._richTextEditor.captureSnapshot(e),{start:i,length:r}=t.selectionRange;return this._onSelectionRangeChange.fire(i,i+r),t}async textMoveCursorByDirection(e){if(e===c.Nm.Left||e===c.Nm.Right){let t=await this._richTextEditor.getSelectRange();if(0!==t.length){let i=e===c.Nm.Left;return this._moveCursorByIndex(i?t.start:t.start+t.length,c.Ye.Front)}}await this._richTextEditor.moveCursor(e),await this.textEditUpdateSnapshot()}async _moveCursorByIndex(e,t){await this._richTextEditor.moveCursorByIndex(e,t),await this.textEditUpdateSnapshot()}async textMoveCursorByPos(e,t){await this._richTextEditor.moveCursorByPos(new c.Yw(e,t)),this.textEditUpdateSnapshot()}async textMoveCursorToLineHead(){await this._richTextEditor.moveCursorToLineHead(),await this.textEditUpdateSnapshot()}async moveCursorToLineEnd(){await this._richTextEditor.moveCursorToLineEnd(),await this.textEditUpdateSnapshot()}async textMoveCursorToLineEnd(){await this._richTextEditor.moveCursorToLineEnd(),await this.textEditUpdateSnapshot()}async textMoveCursorToHead(){await this._moveCursorByIndex(0,c.Ye.Front),await this.textEditUpdateSnapshot()}async textMoveCursorToEnd(){await this._richTextEditor.moveCursorByPos(new c.Yw(1,-1)),await this.textEditUpdateSnapshot()}async textMoveCursorAndSelect(e){await this._richTextEditor.moveCursorAndSelect(e),await this.textEditUpdateSnapshot()}async textMoveCursorByWordBoundary(e){await this._richTextEditor.moveCursorByWordBoundary(e),await this.textEditUpdateSnapshot()}async textGetCursorRect(){let e=await this._richTextEditor.getCursorRect();if(isNaN(e.x)||isNaN(e.y)||isNaN(e.w)||isNaN(e.h)||0===e.h){let t=this._richTextEditor.getEditingId();(0,o.Y2)(this._dataSdk,"rich-text-editor dataSdk is nil");let i=this._dataSdk.draftView.getSegmentById(t);if(!i||!(0,l.Ftn)(i))return e;let{material:r}=i;if(r.typesetting===l.v$U.Vertical)e=new c.x1(-1,0,1,0);else if(r.fixedWidth>0)switch(r.alignment){case l.s8r.Left:e=new c.x1(-.95,-.8,0,.8);break;case l.s8r.Right:e=new c.x1(.95,-.8,0,.8);break;default:e=new c.x1(0,-.8,0,.8)}else e=new c.x1(0,-.8,0,.8)}return e}async textSelectToPos(e){await this._richTextEditor.selectToPos(e);let t=await this._richTextEditor.getSelectRange();this._onSelectionRangeChange.fire(t.start,t.start+t.length)}async textSelectToLineHead(){await this._richTextEditor.selectToLineHead(),await this.textEditUpdateSnapshot()}async textSelectToLineEnd(){await this._richTextEditor.selectToLineEnd(),await this.textEditUpdateSnapshot()}async textSelectToHead(){await this._richTextEditor.selectToHead(),await this.textEditUpdateSnapshot()}async textSelectToEnd(){await this._richTextEditor.selectToEnd(),await this.textEditUpdateSnapshot()}async textSelectWordByDirection(e){await this._richTextEditor.selectWordByDirection(e),await this.textEditUpdateSnapshot()}async textInputStr(e){let t=await this._richTextEditor.getPlainStr(c.je.All);if("\b"===t){var i,r;let t=this._richTextEditor.getEditingId(),a={segId:t,content:e,isEditing:!1};(0,o.Y2)(this._dataSdk,"rich-text-editor dataSdk is nil");let n=this._draftId,s=null!==(i=this._dataSdk.draftView.getDraftById(n))&&void 0!==i?i:this._dataSdk.draftView,u=await d(s,a);if(u){let e=a.segId,t=s.getSegmentById(e),i=null===(r=s.getTrackBySegmentId(e,[]))||void 0===r?void 0:r.id,d=s.getTrackIndexBySegmentId(e);(0,o.Y2)(t,"rich-text-editor textInputStr getSegmentById return undefined"),(0,o.Y2)((0,l.Ftn)(t),"rich-text-editor textInputStr getSegmentById isSegmentText return false"),(0,o.Y2)(i,"rich-text-editor textInputStr getTrackBySegmentId return undefined");let c=new l.xKN;c.material=new l.edz,c.material.baseContent=a.content,c.material.content=a.content,c.material.richTextCommand=u,c.material.text=l.hMI.getOriginContentFromContent(a.content);let h=(0,l.xXD)({__segment_struct_type:t.__segment_struct_type});l.T8X.pick(t,c,h),this._dataSdk.api.text.setMaterials({updates:[{draftId:n,trackId:i,segmentId:e,segmentDelta:c,sourceSegmentDelta:h,trackIndex:d}]})}await this._richTextEditor.beginEdit(t,new c.Yw(1,-1))}else await this._richTextEditor.inputStr(e)}async textBackDelete(){await this._richTextEditor.backDelete(),this._fireSelectionCleared()}async textForwardDelete(){await this._richTextEditor.forwardDelete(),this._fireSelectionCleared()}async textDeleteToLineHead(){if(await this._richTextEditor.hasSelection())return this._richTextEditor.backDelete();await this._richTextEditor.selectToLineHead(),await this._richTextEditor.backDelete(),this._fireSelectionCleared()}async textDeleteToLineEnd(){let e=await this._richTextEditor.hasSelection();if(e)return this._richTextEditor.backDelete();await this._richTextEditor.selectToLineEnd(),(e=await this._richTextEditor.hasSelection())&&await this._richTextEditor.backDelete(),this._fireSelectionCleared()}async textDeleteWordByDirection(e){let t=await this._richTextEditor.hasSelection();if(t)return this._richTextEditor.backDelete();await this._richTextEditor.selectWordByDirection(e),(t=await this._richTextEditor.hasSelection())&&await this._richTextEditor.backDelete(),this._fireSelectionCleared()}async textStartCompose(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this._dataSdk.api.undoRedo.getTopItemId();if(await this._richTextEditor.hasUncommittedChange(t)){let e=this._richTextEditor.getEditingId();await this._updateEditingContent(e,!0)}let i=await this._richTextEditor.getPlainStr(c.je.All),r=e;!r&&(r=await this._richTextEditor.getRichStr(c.je.All));if("\b"===i){var a,n;let e=this._richTextEditor.getEditingId(),t={segId:e,content:"",isEditing:!0},i=this._draftId,r=null!==(a=this._dataSdk.draftView.getDraftById(i))&&void 0!==a?a:this._dataSdk.draftView,s=await d(r,t);if(s){let a=r.getSegmentById(e),d=null===(n=r.getTrackBySegmentId(e,[]))||void 0===n?void 0:n.id,c=r.getTrackIndexBySegmentId(e);(0,o.Y2)(a,"rich-text-editor textInputStr getSegmentById return undefined"),(0,o.Y2)((0,l.Ftn)(a),"rich-text-editor textInputStr getSegmentById isSegmentText return false"),(0,o.Y2)(d,"rich-text-editor textInputStr getTrackBySegmentId return undefined");let u=new l.xKN;u.material=new l.edz,u.material.baseContent=t.content,u.material.content=t.content,u.material.richTextCommand=s,u.material.text=l.hMI.getOriginContentFromContent(t.content);let h=(0,l.xXD)({__segment_struct_type:a.__segment_struct_type});l.T8X.pick(a,u,h),this._dataSdk.api.text.setMaterials({updates:[{draftId:i,trackId:d,segmentId:e,segmentDelta:u,sourceSegmentDelta:h,trackIndex:c}]})}await this._richTextEditor.beginEdit(e,new c.Yw(1,-1))}await this._richTextEditor.startCompose(r),this._fireSelectionCleared()}async textPreEditCompose(e){await this._richTextEditor.preEditCompose(e)}async textEndCompose(e){await this._richTextEditor.endCompose(e)}async _updateEditingContent(e){var t,i;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],e!==this._richTextEditor.getEditingId())return 0;let r=await this._richTextEditor.getRichStr(c.je.All),a={segId:e,content:r,isEditing:r.length>0};(0,o.Y2)(this._dataSdk,"rich-text-editor dataSdk is nil");let n=this._draftId,s=null!==(t=this._dataSdk.draftView.getDraftById(n))&&void 0!==t?t:this._dataSdk.draftView,u=await d(s,a);if(u){let t=s.getSegmentById(e),r=null===(i=s.getTrackBySegmentId(e,[]))||void 0===i?void 0:i.id,d=s.getTrackIndexBySegmentId(e);(0,o.Y2)(t,"rich-text-editor textInputStr getSegmentById return undefined"),(0,o.Y2)((0,l.Ftn)(t),"rich-text-editor textInputStr getSegmentById isSegmentText return false"),(0,o.Y2)(r,"rich-text-editor textInputStr getTrackBySegmentId return undefined");let c=new l.xKN;c.material=new l.edz,c.material.baseContent=a.content,c.material.content=a.content,c.material.richTextCommand=u,c.material.text=l.hMI.getOriginContentFromContent(a.content);let h=(0,l.xXD)({__segment_struct_type:t.__segment_struct_type});l.T8X.pick(t,c,h),this._dataSdk.api.text.setMaterials({updates:[{draftId:n,trackId:r,segmentId:e,segmentDelta:c,sourceSegmentDelta:h,trackIndex:d}]})}(0,o.Y2)(this._dataSdk,"rich-text-editor dataSdk is nil");let h=this._dataSdk.api.undoRedo.getTopItemId();await this._richTextEditor.captureSnapshot(h),!a.isEditing&&await this._richTextEditor.beginEdit(a.segId,new c.Yw(0,0))}textUpdateEditingContent(e,t){return this._updateEditingContent(e,t)}textGetPlainStr(){return this._richTextEditor.getPlainStr(c.je.All)}async textSelectContent(e,t){await this._richTextEditor.selectContent(new c.e6(e,t)),await this.textEditUpdateSnapshot()}async textSyncSelection(e,t,i,r){return this._richTextEditor.getEditingId()!==e&&await this._richTextEditor.beginEdit(e),this._richTextEditor.selectContent(new c.e6(i,r))}async textSelectWord(){await this._richTextEditor.selectWord(),await this.textEditUpdateSnapshot()}textGetSelectRange(){return this._richTextEditor.getSelectRange()}textEditUndo(){return this._editUndoRedo()}textEditRedo(){return this._editUndoRedo(!0)}textUpdateAnimation(e){this._dataSdk.api.text.updateAnimation(e)}textUpdateAnimationValue(e){(0,n.oW)("textUpdateAnimationValue")}textRemoveAnimation(e){this._dataSdk.api.text.deleteAnimation(e)}_textGetMixedStyles(e,t){return t.begin===t.end&&(t.begin=0,t.end=e.text.length),l.hMI.getMixedStyles(e.baseContent||e.content,t)}getTextMaterialWithMixedStyles(e,t){return m(this._textGetMixedStyles(e,t))}findTrackToInsertAll(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;(0,o.Y2)(this._dataSdk,"rich-text-editor dataSdk is nil");let n=this._dataSdk.draftView,s=r.slice(),d=n.findTargetTrackIndexByTimeRange([e],[],new l.tnv({start:l.pMA.times(t,1e3,"bigint"),duration:l.pMA.times(i,1e3,"bigint")}),a,[]),c=n.getTracksByType(e),u=n.getTracksByTypes(s);if(d===c.length)d=u.length;else{let e=c[d].id;d=u.findIndex(t=>t.id===e)}return s.includes(l.pNd.TrackTypeVideo)&&e!==l.pNd.TrackTypeVideo&&0===n.getAllTracks().length&&(d+=1),d}_fireSelectionCleared(){this._onSelectionRangeChange.fire(0,0)}_getAdjustParams(e){(0,o.Y2)(this._dataSdk,"rich-text-editor dataSdk is nil");let t=this._dataSdk.draftView.getSegmentById(e);return t&&(0,l.w5o)(t)?t.material.adjustParams.map(e=>({adjustKey:e.name,adjustValue:e.value,defaultValue:e.defaultValue})):[]}async _editUndoRedo(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._richTextEditor.getEditingId(),i=!1;(0,o.Y2)(this._dataSdk,"rich-text-editor dataSdk is nil");let r=this._dataSdk.api.undoRedo.getTopItemId(),a=await this._richTextEditor.hasUncommittedChange(r);if(!e&&a&&await this._updateEditingContent(t,!0),e&&this._dataSdk.api.undoRedo.canRedo()?(this._dataSdk.api.undoRedo.redo(),i=!0):!e&&this._dataSdk.api.undoRedo.canUndo()&&(this._dataSdk.api.undoRedo.undo(),i=!0),i)await this._richTextEditor.beginEdit(t);else if(e)return 0;r=this._dataSdk.api.undoRedo.getTopItemId();let n=await this._richTextEditor.restoreSnapshot(r);if(n){let{selectionRange:e}=n;this._onSelectionRangeChange.fire(e.start,e.start+e.length)}return 0}_updateTextPreview(e,t){let{executor:i}=this._renderManager;if(!!i)i.text.updatePreview(e,t,this._dataSdk.draftView)}textBeginSubDraftPreview(e){let{executor:t}=this._renderManager;if(!t)return;let i=this._dataSdk.draftView.getSegmentPath(e);for(let e of(null!=i?i:[]).slice(0,-1))t.draft.beginDraft(e)}textEndSubDraftPreview(e){let{executor:t}=this._renderManager;if(!t)return;let i=this._dataSdk.draftView.getSegmentPath(e);for(let e of(null!=i?i:[]).slice(0,-1))t.draft.endDraft(e)}constructor(e,t){this._dataSdk=e,this._renderManager=t,this._config={defaultTTSAutoUpdate:u.gl,textDuration:u.B7},this._onSelectionRangeChange=new a.Q,this._updateTextCache={param:void 0},this._isUpdatingText=!1,this.onSelectionRangeChange=this._onSelectionRangeChange.event,this._richTextEditor=t.createRichTextEditor()}}(0,r.gn)([s.cQ,s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object,Object]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textUpdateMaterial",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,String,Number,Number]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textBeginEdit",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,String]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textEndEdit",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectAll",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.Nm?Object:c.Nm]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorByDirection",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number,Number]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorByPos",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorToLineHead",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"moveCursorToLineEnd",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorToLineEnd",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorToHead",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorToEnd",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.Nm?Object:c.Nm]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorAndSelect",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.Nm?Object:c.Nm]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textMoveCursorByWordBoundary",null),(0,r.gn)([s.Zl,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textGetCursorRect",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.Yw?Object:c.Yw]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectToPos",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectToLineHead",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectToLineEnd",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectToHead",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectToEnd",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.Nm?Object:c.Nm]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectWordByDirection",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textInputStr",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textBackDelete",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textForwardDelete",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textDeleteToLineHead",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textDeleteToLineEnd",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.Nm?Object:c.Nm]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textDeleteWordByDirection",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textStartCompose",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textPreEditCompose",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textEndCompose",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,Boolean]),(0,r.w6)("design:returntype",void 0)],v.prototype,"textUpdateEditingContent",null),(0,r.gn)([s.Zl,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",void 0)],v.prototype,"textGetPlainStr",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number,Number]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectContent",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,String,Number,Number]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSyncSelection",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],v.prototype,"textSelectWord",null),(0,r.gn)([s.Zl,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype","undefined"==typeof Promise?Object:Promise)],v.prototype,"textGetSelectRange",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",void 0)],v.prototype,"textEditUndo",null),(0,r.gn)([s.dQ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",void 0)],v.prototype,"textEditRedo",null)},786030:function(e,t,i){i.d(t,{Nm:function(){return o},Ye:function(){return s},Yw:function(){return u},e6:function(){return c},je:function(){return l},x1:function(){return d}});var r,a,n,o=((r={})[r.Left=0]="Left",r[r.Right=1]="Right",r[r.Up=2]="Up",r[r.Down=3]="Down",r);var s=((a={})[a.Front=0]="Front",a[a.Behind=1]="Behind",a);var l=((n={})[n.All=0]="All",n[n.Selected=1]="Selected",n);class d{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.w=i,this.h=r}}class c{constructor(e=0,t=0){this.start=e,this.length=t}}class u{constructor(e=0,t=0){this.x=e,this.y=t}}},919914:function(e,t,i){i.d(t,{o:function(){return r}});let r=(0,i(335290).yh)("draft-duplicate-service")},561909:function(e,t,i){i.d(t,{B:function(){return n},l:function(){return o}});var r,a=i(335290);var n=((r={}).EXPORT="EXPORT",r.MOVE="MOVE",r);let o=(0,a.yh)("draft-move-service")},808839:function(e,t,i){i.d(t,{y:function(){return c}});var r=i(425427),a=i(629529),n=i(53600),o=i(660228),s=i(796500),l=i(754559),d=i(9594);class c extends a.L{get workspaceIdFromUrl(){return this._evercloudSpaceInfo.workspaceIdFromUrl}get spaceIdFromUrl(){return this._evercloudSpaceInfo.spaceIdFromUrl}get business(){return(0,r.JY)(this)?r.US.Template:r.US.Editor}constructor(e){var t,i,a;super(e),this.templateIdFromUrl=null,this.currentTemplateId=null,this._evercloudSpaceInfo=new l.I;let{isInternal:c,appScmBuildVersion:u,appScmBuildBranch:h,veBuildId:p,veFullBuildVersion:_,draftVersion:m,appVersion:f,sdkVersion:g}=e,{searchParams:v,pathname:y}=new URL(window.location.href);this.isInternal=c,this.appSubType=/^\/editor-template\/?/.test(y)?r.cP.Template:r.cP.MultiTrack,this.draftIdFromUrl=null!==(t=(0,n.Ci)())&&void 0!==t?t:null,this.thirdPartyPlatform=(0,o.Ik)(),this.thirdPartyDraftId=(0,o.$i)(),this.hasThirdPartyPlatformQuery=!!this.thirdPartyPlatform&&!!this.thirdPartyDraftId,this.isFromThirdPartPlatform=this.hasThirdPartyPlatformQuery&&!this.draftIdFromUrl;let S=(0,o.SD)();this.utmSource=S.source,this.utmMedium=S.medium,this.utmCampaign=S.campaign,this.isFromChatGPT="referral"===this.utmMedium&&"extension"===this.utmSource&&"chatgpt"===this.utmCampaign,this.templateIdFromUrl=this.draftIdFromUrl?v.get("templateId"):null!==(i=(0,n.Y8)())&&void 0!==i?i:null;let w=v.get("activeSmartTool");w&&w in d.lQ&&(this.activeSmartTool=w),this.appSubType=/^\/editor-template\/?/.test(y)?r.cP.Template:r.cP.MultiTrack,this.currentTemplateId=this.templateIdFromUrl,this.scenarioFromUrl=v.get("scenario"),this.isPreviewTemplate="1"===v.get("is_preview_template"),this.isAutoTest=!!v.get("is_auto_test"),this.isRealAutoTest=!!v.get("is_real_auto_test"),this.fromPage=v.get("from_page"),this.appScmBuildVersion=u,this.appScmBuildBranch=h,this.veBuildId=p,this.veFullBuildVersion=_,this.sdkVersion=g,this.appVersion=f,this.draftVersion=m,this.isDebug=!!v.get("debug"),this.isSIMD="simd"===(0,s.l)().wasmType,this.forcePreload=!!v.get("force_preload"),this.debugDraftSave=!!v.get("debug_draft_save"),this.preloadStreamBlockCount=Number.parseInt(null!==(a=v.get("preload_stream_block"))&&void 0!==a?a:"0",10);let b=v.get("__debug_console__");"1"===b?this.debugConsoleStatus=!0:"0"===b?this.debugConsoleStatus=!1:this.debugConsoleStatus=null,this.appSubType===r.cP.MultiTrack&&this.isFromThirdPartPlatform&&(this.appSubType=r.cP.ThirdParty)}}},333686:function(e,t,i){i.d(t,{_:function(){return y}});var r=i(789786),a=i(402655),n=i(210823),o=i(108692),s=i(230689),l=i(200247),d=i(247235),c=i(948328),u=i(699163),h=i(53600),p=i(425427),_=i(896413),m=i(257635),f=i(594061),g=i(546651),v=i(38272);class y extends a.JT{_init(){this._registerBeforeUnload(),this._initHandleClickBack(),this._initListeners()}_registerBeforeUnload(){window.addEventListener("beforeunload",this._handleBeforeUnload.bind(this))}_handleBeforeUnload(e){if(this._skipUnloadPrevent)return;let t=this._accountService.hasLogin,i=this._draftMaterialsService.isMaterialAllDone(),r=this._mainDraftService.saveManager.needSave(),a=this._mainEditorWidgetService.freeze;if(!t||!i||r||a){let t=(0,m.kK)(this._containerService,"auto");(0,f.Z)(this._containerService,{action:"save_by_exit",duration:0}),this._mainDraftService.saveManager.saveDraft().then(e=>{t(e)}),e.preventDefault(),e.returnValue=""}}_initHandleClickBack(){this._workbenchService.registerBackLogoConfirguation({disableLogoRedirect:()=>(this.showExitModal({onOk:()=>{var e,t;let i=(0,h.G8)(null!==(t=null===(e=this._workbenchService.backLogoConfirguation)||void 0===e?void 0:e.backPath)&&void 0!==t?t:"/",{enter_from:"page_header",from_page:this._isTemplate?"template_editor":"editor"});(0,h.f5)(i,{excludeQuery:["video",...h.u8]})}}),!0),showToolTip:!0})}_initListeners(){this._mainDraftService.saveManager.onSaving(()=>{this._saveStatus=d.Z.SAVING}),this._mainDraftService.saveManager.onError(()=>{this._saveStatus=d.Z.FAIL}),this._mainDraftService.saveManager.onSuccess(()=>{this._saveStatus=d.Z.SUCCESS})}showExitModal(e){let t=this._accountService.hasLogin,i=this._mainEditorWidgetService.freeze,r=this._draftMaterialsService.isMaterialAllDone(),{onOk:a,onCancel:n}=e,o=()=>{this.cancelGlobalExitConfirm(),null==a||a(),(0,g.w)(this._containerService),(0,v.n)(this._containerService,{action:"confirm"})},s=()=>{null==n||n(),(0,v.n)(this._containerService,{action:"cancel"})};if(!navigator.onLine||!t||t&&!r||i){(0,v.n)(this._containerService,{action:"show"}),(()=>{this._exitModalIns.showModal({showUploadingContent:!r,onOk:o,onCancel:s})})();return}null==a||a(),(0,g.w)(this._containerService)}cancelGlobalExitConfirm(){this._skipUnloadPrevent=!0}dispose(){window.removeEventListener("beforeunload",this._handleBeforeUnload.bind(this)),this._exitModalIns.dispose(),super.dispose()}constructor(e,t,i,r,a,n,o){super(),this._containerService=e,this._workbenchService=t,this._mainDraftService=i,this._accountService=r,this._draftMaterialsService=a,this._videoEnvironmentService=n,this._mainEditorWidgetService=o,this._skipUnloadPrevent=!1,this._saveStatus=d.Z.IDLE,this._exitModalIns=new u.U,this._isTemplate=(0,p.JY)(this._videoEnvironmentService),this._init()}}y=(0,r.gn)([(0,r.fM)(0,s.t),(0,r.fM)(1,n.e),(0,r.fM)(2,o.n),(0,r.fM)(3,l.D),(0,r.fM)(4,c.D),(0,r.fM)(5,p.rO),(0,r.fM)(6,_.a),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===s.t?Object:s.t,void 0===n.e?Object:n.e,void 0===o.n?Object:o.n,void 0===l.D?Object:l.D,void 0===c.D?Object:c.D,void 0===p.rO?Object:p.rO,void 0===_.a?Object:_.a])],y)},907028:function(e,t,i){i.d(t,{I:function(){return s}});var r=i(772322);i(966156),i(225572);var a=i(368100),n=i(97257),o=i(801497);let s=e=>{let{title:t,content:i,handleCancel:s,handleOk:l}=null!=e?e:{};return(0,r.jsx)(a.Z,{visible:!0,closable:!1,maskClosable:!1,title:null!=t?t:o.ZP.t("exit_web_project",{},"\u786E\u8BA4\u9000\u51FA\u8349\u7A3F\uFF1F"),simple:!0,footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z,{type:"default",onClick:s,tabIndex:-1,children:o.ZP.t("cancel_web",{},"\u53D6\u6D88")}),(0,r.jsx)(n.Z,{type:"primary",status:"danger",onClick:l,children:o.ZP.t("exi_web_t",{},"\u9000\u51FA")})]}),children:null!=i?i:o.ZP.t("current_web_project_web_no_web_saved",{},"\u5F53\u524D\u8349\u7A3F\u6682\u672A\u4FDD\u5B58\u6210\u529F\uFF0C\u9000\u51FA\u53EF\u80FD\u9020\u6210\u8349\u7A3F\u4FE1\u606F\u4E22\u5931\u3002")})}},990654:function(e,t,i){i.d(t,{b:()=>el});var r=i("789786");i("966156");var a=i("368100"),n=i("437612"),o=i("230689"),s=i("919111"),l=i("707382"),d=i("318434"),c=i("418952"),u=i("690613"),h=i("197238"),p=i("593642"),_=i("265445"),m=i("999268"),f=i("131805"),g=i("475590"),v=i("641276"),y=i("468101"),S=i("493359"),w=i("247235"),b=i("907525"),M=i("948328"),T=i("426336"),k=i("173888"),x=i("606527"),I=i("303079"),P=i("28791"),E=i("744268"),C=i("596112"),D=i("613069"),F=i("273238"),A=i("722169"),R=i("729596"),j=i("407899"),O=i("594061"),B=i("356954");class V{getEventParams(){return{}}constructor(){this.eventName="change_video_first_frame"}}function N(e){(0,B.K)(e,V)}var U=i("257635"),L=i("425427"),W=i("559992"),Z=i("210270"),H=i("811750"),z=i("991817"),K=i("847264"),$=i("832251"),Y=i("446654"),Q=i("896413");class G extends y.l{get packageAssetsBuilder(){return this._packageAssetsBuilder}lockSave(e){return(0,_.vu)(this._mutex,e)}refreshSizeChecker(){this._uploadSizeChecker.refresh(this._draftWorkspaceManager.workspaceId)}appendSaveDraftParams(e){Object.assign(this._extraSaveDraftParams,e)}getPackageId(){return this._packageId}_setPackageId(e){this._packageId=e}_canDraftSave(){if(""===this._dataSdk.draftView.getDraftId()||""===this._cloudMetaManager.getMeta().draft.id)return(0,u.wf)(-1,"no draftId.");if(this._dataSdkAborted)return(0,u.wf)(-1,"dataSdk aborted.");if((0,O.Z)(this._containerService,{action:"data_sdk_init",duration:Date.now()-this.startSaveTimestamp}),!this._draftWorkspaceManager.workspaceId)return this._shouldSaveWhenWorkspaceReady=!0,(0,u.wf)(-1,"no workspaceId.");if(this._mutex.isLocked())return(0,u.wf)(-1,"save locked.");let{userGeneratedMaterials:e,autoGeneratedMaterials:t}=this._draftMaterialsService.getMaterials();return(0,S.Po)([...e,...t])?(0,u.wf)(0,"materials has syncing."):t.some(e=>H.di===e.filename&&e.status!==k.a.Success)?(0,u.wf)(0,"VideoAlgorithm json file is uploading."):((0,O.Z)(this._containerService,{action:"draft_can_save_check_ok",duration:Date.now()-this.startSaveTimestamp}),(0,u.ly)())}setOnlyCompleteOnce(e){this._isOnlyCompleteOnce=e}async _generateDraftSaveTask(){let e=this._cloudMetaManager.getMeta(),t=this.getPackageId(),i=this._containerService.createInstance(K.e,e,this.getPackageId(),this._dataSdk.getDraftStr(),this._draftWorkspaceManager.workspaceId,this._packageAssetsBuilder.buildPackageAssets(),this._uploadSizeChecker,this._extraSaveDraftParams,this._consumeHasFirstFrameChanged(t));this._videoEnvironmentService.debugDraftSave&&console.log(`[DraftSave] save task generated for ${t}`,i),(0,O.Z)(this._containerService,{action:"draft_save_task_created",duration:Date.now()-this.startSaveTimestamp});let[,r]=(await (0,g.Hp)(async e=>{let t=await this._draftCoverManager.getCoverTask();return e.isCancellationRequested?null:t},1e4)).pair();return r&&r!==this._lastCoverTask&&(i.setCoverTask(r),this._lastCoverTask=r),i.setPackageId(this.getPackageId()),(0,u.oW)(i)}async _generateSaveNewDraftTask(e){this._saveState=w.Z.SAVING;let{workspaceId:t,name:i,defaultSaveTask:r}=e,a=(0,p.k7)(),n=r?r.getCloudMeta():this._cloudMetaManager.getMeta(),o=r?r.getDraftJsonWithNewDraftId(a):this._dataSdk.getDraftStrWithNewDraftId(a),s=r?r.getPackageAssets():this._packageAssetsBuilder.buildPackageAssets(),l=this._containerService.createInstance(Y.g,n,y.J,o,t,s,this._uploadSizeChecker);if(l.setDraftId(a),l.setPackageId(y.J),l.setDraftName(i),l.updateCreateTime(Date.now()),!r){let e=await this._draftCoverManager.getCoverTask();l.setCoverTask(e),this._lastCoverTask=e}return await l.execute()}async _generateDraftMoveTask(e){let{workspaceId:t,name:i,defaultSaveTask:r}=e,a=this._containerService.createInstance($.R,r?r.getCloudMeta():this._cloudMetaManager.getMeta(),this.getPackageId(),r?r.getDraftJson():this._dataSdk.getDraftStr(),this._draftWorkspaceManager.workspaceId,t,r?r.getPackageAssets():this._packageAssetsBuilder.buildPackageAssets()),n=(0,p.k7)();a.setDraftName(i),a.setDraftId(n),a.updateCreateTime(Date.now());let o="",s="";a.onComplete(e=>{e.ok&&({newPackageId:o,newPackageKey:s}=e.value)});let l=await a.execute();if(!l.ok)return l;let d=r?r.getDraftJsonWithNewDraftId(s):this._dataSdk.getDraftStrWithNewDraftId(s),c=this._containerService.createInstance(K.e,r?r.getCloudMeta():this._cloudMetaManager.getMeta(),o,d,t,r?r.getPackageAssets():this._packageAssetsBuilder.buildPackageAssets(),this._uploadSizeChecker,{},!0);c.setDraftName(i),c.setDraftId(s),c.updateCreateTime(Date.now());let h=await c.execute();return h.ok?(0,u.oW)(s):h}async _doSave(e){try{var t,i,r,a;let n=this.getPackageId();(0,W.M)(this._containerService,{versionStacking:Number(!!this.draftSaveTaskQueue.getCommittingTask())+this.draftSaveTaskQueue.getWaitingQueue().length});let o={};if(e.getHasFirstFrameChanged()){;let e=this._containerService.invokeFunction(e=>e.get(Q.a)),t=await this._draftFirstFrameManager.getFirstFrameUrl(e.renderManager),i=null==t?void 0:null===(r=t.split("base64,"))||void 0===r?void 0:r[1];i&&(o.draft_frame_content=i),a=this._containerService,(0,B.K)(a,V)}let s=await e.execute(o);(0,O.Z)(this._containerService,{action:"draft_save_task_execute_done",duration:Date.now()-this.startSaveTimestamp});let l=(null===(t=s.cause)||void 0===t?void 0:t.ret)==="2010"||(null===(i=s.cause)||void 0===i?void 0:i.ret)==="2013";if(s.ok||l){l&&(s=(0,u.oW)((null==s?void 0:s.cause).data.package_id));let[,e]=s.pair();this.setPackageId(e),this._videoEnvironmentService.debugDraftSave&&console.log(`[DraftSave] first frame render for ${n}, current ${this.getPackageId()}, map: `,{...this._hasFirstFrameChangedMap}),(0,O.Z)(this._containerService,{action:"draft_save_finish",duration:Date.now()-this.startSaveTimestamp}),this._extraSaveDraftParams={}}return s}catch(t){let e=`doSave: ${(null==t?void 0:t.message)||"unknown error"}`;return(0,u.wf)(-1,e)}}async _doSaveAsNew(e){let{workspaceId:t}=e;return t===this._draftWorkspaceManager.workspaceId?await this._generateSaveNewDraftTask(e):await this._generateDraftMoveTask(e)}_consumeHasFirstFrameChanged(e){let t=this._hasFirstFrameChangedMap.get(e);return this._hasFirstFrameChangedMap.remove(e),null!=t&&t}_sendRenderFirstFrameRequest(e){let t=this._dataSdk.draftView.getCanvasConfig();if(this._firstFrameDataService.renderFirstFrame({draftId:this._dataSdk.draftView.getDraftId(),workspaceId:this._draftWorkspaceManager.workspaceId,packageId:this.getPackageId(),frameChange:e,draftInfo:{canvasConfig:{width:t.width,height:t.height,ratio:function(e){switch(e){case T.rxY.CanvasRatioOriginal:return 0;case T.rxY.CanvasRatio16To9:return 2;case T.rxY.CanvasRatio9To16:return 3;case T.rxY.CanvasRatio4To3:return 4;case T.rxY.CanvasRatio3To4:return 5;case T.rxY.CanvasRatio1To1:return 6;case T.rxY.CanvasRatio2To1:return 7;case T.rxY.CanvasRatio2_35To1:return 8;case T.rxY.CanvasRatio1_85To1:return 9;case T.rxY.CanvasRatio1_125To2_436:return 10;case T.rxY.CanvasRatioCustom:return 1;default:return 0}}(t.ratio)},duration:Math.floor(R.h.usToMs(this._dataSdk.draftView.getDuration()))}}),e){var i;i=this._containerService,(0,B.K)(i,V)}}_checkNeedRetry(e){var t,i,r;return(null===(t=e.cause)||void 0===t?void 0:t.code)==="ERR_NETWORK"||(null===(i=e.cause)||void 0===i?void 0:i.code)==="ECONNABORTED"||(null===(r=e.cause)||void 0===r?void 0:r.ret)==="2001"||e.code===h.pY.TimedOut}_prepare(){this._saveState===w.Z.IDLE||this._saveState===w.Z.SUCCESS?this._saveState=w.Z.PREPARE:this._saveState===w.Z.SAVING&&(this._needSaveAgain=!0)}_addEventListener(){this._register(this._dataSdk.onChangeDiff(e=>{if(this._videoEnvironmentService.debugDraftSave&&console.log(`[DraftSave] diff change for ${this.getPackageId()}`),e.actionOperateType!==T.aWQ.History&&(void 0===e.commit||!!e.commit)&&(0!==e[T.u4I.TRACK].length||0!==e[T.u4I.SEGMENT].length||0!==e[T.u4I.CONFIG].length))this._prepare(),this._saveDraftDebounce()})),this._register(this._dataSdk.onAbort(()=>{this._dataSdkAborted=!0})),this._register(this._dataSdk.onChangeFirstFrame(()=>{let e=this.getPackageId();this._videoEnvironmentService.debugDraftSave&&console.log(`[DraftSave] first frame change fired for ${e}`),this._hasFirstFrameChangedMap.put(e,!0)})),this._draftMaterialsService.onDidMaterialAdd(()=>{if(!!this._draftMaterialsService.isReady)(0,O.Z)(this._containerService,{action:"save_by_material_add",duration:0}),this._prepare(),this._saveDraftDebounce()}),this._draftMaterialsService.onDidMaterialRemove(()=>{if(!!this._draftMaterialsService.isReady)(0,O.Z)(this._containerService,{action:"save_by_material_remove",duration:0}),this._prepare(),this._saveDraftDebounce()}),this._draftMaterialsService.onDidMaterialReplace(()=>{if(!!this._draftMaterialsService.isReady)(0,O.Z)(this._containerService,{action:"save_by_material_remove",duration:0}),this._prepare(),this._saveDraftDebounce()}),this._draftMaterialsService.onMaterialAllDoneChange(e=>{e&&((0,O.Z)(this._containerService,{action:"save_by_material_all_done",duration:0}),this._prepare(),this._saveDraftDebounce())}),!this._draftWorkspaceManager.workspaceId&&this._register((0,v.V)(this._draftWorkspaceManager.onDidWorkspaceChange)(()=>{this._shouldSaveWhenWorkspaceReady&&((0,O.Z)(this._containerService,{action:"save_by_workspace_change",duration:0}),this._prepare(),this._saveDraftDebounce())})),this._register((0,j.n)(i.g,"online",()=>{this._isOnline=!0,this._needUploadWhenOnline&&(this._needUploadWhenOnline=!1,(0,O.Z)(this._containerService,{action:"save_by_network_change",duration:0}),this._prepare(),this._saveDraftDebounce())})),this._register((0,j.n)(i.g,"offline",()=>{this._isOnline=!1}))}async _getDrawFirstFrameLibra(){let e=this._configService.abTestManager.getBooleanAbTestValue("enable_draw_frame_from_fe"),t=await this._teaAdapterService.getABTestVar("enable_draw_frame_from_fe",!1);this._enableDrawFrameFromFe=null!=e?e:t}constructor(e,t,i,r,a,n,o,s,l,d,c,u,h,p,_,g,v){super(d),this._dataSdk=e,this._cloudMetaManager=t,this._draftCoverManager=i,this._referenceCountManager=r,this._draftPathStore=a,this._draftFirstFrameManager=n,this._draftWorkspaceManager=o,this.draftSaveService=s,this._containerService=l,this._draftMaterialsService=c,this._firstFrameDataService=u,this._userMaterialsService=h,this._videoEnvironmentService=p,this._loggerService=_,this._teaAdapterService=g,this._configService=v,this._isOnline=!0,this._packageId=y.J,this._isOnlyCompleteOnce=!1,this._enableDrawFrameFromFe=void 0,this._mutex=new m.L,this._needUploadWhenOnline=!1,this._extraSaveDraftParams={},this._dataSdkAborted=!1,this._hasFirstFrameChangedMap=new f.z(20),this._logger=this._loggerService.createLogger("draft-save"),this._shouldSaveWhenWorkspaceReady=!1,this._saveDraftDebounce=(0,A.debounce)(()=>{if(this._dataSdkAborted){this._logger.info("cant save because of dataSdkAborted.");return}!this._isOnline&&(this._needUploadWhenOnline=!0);let e=(0,U.kK)(this._containerService,"auto");this._videoEnvironmentService.debugDraftSave&&console.log(`[DraftSave] generate save task for current ${this.getPackageId()}, map: `,{...this._hasFirstFrameChangedMap}),this.generateSaveTask().then(t=>{if(t.ok){t.value.onComplete(t=>{var i;(null===(i=t.cause)||void 0===i?void 0:i.ret)!==Z.K.ERR_DRAFT_NOT_COMPLETE&&e(t)});return}e(t)})},this._nextSaveTimeout),this._packageAssetsBuilder=this._containerService.createInstance(z.r,this._draftPathStore,this._referenceCountManager,this._dataSdk),this._uploadSizeChecker=new b.A({userMaterialsService:this._userMaterialsService}),this._addEventListener()}}G=(0,r.gn)([(0,r.fM)(7,x._),(0,r.fM)(8,o.t),(0,r.fM)(9,D.H),(0,r.fM)(10,M.D),(0,r.fM)(11,I.G),(0,r.fM)(12,F.b),(0,r.fM)(13,L.rO),(0,r.fM)(14,P.yR),(0,r.fM)(15,C.w),(0,r.fM)(16,E.Ui),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof CloudMetaManager?Object:CloudMetaManager,"undefined"==typeof DraftCoverManager?Object:DraftCoverManager,"undefined"==typeof IReferenceCountManager?Object:IReferenceCountManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof DraftFirstFrameManager?Object:DraftFirstFrameManager,"undefined"==typeof DraftWorkspaceManager?Object:DraftWorkspaceManager,void 0===x._?Object:x._,void 0===o.t?Object:o.t,void 0===D.H?Object:D.H,void 0===M.D?Object:M.D,void 0===I.G?Object:I.G,void 0===F.b?Object:F.b,void 0===L.rO?Object:L.rO,void 0===P.yR?Object:P.yR,void 0===C.w?Object:C.w,void 0===E.Ui?Object:E.Ui])],G);var X=i("301867"),J=i("402655"),q=i("782153"),ee=i("545772"),et=i("801497"),ei=i("128745"),er=i("460787"),ea=i("24282"),en=i("31463"),eo=i("861810");class es{_getDumpLog(){return this._mainEditorWidgetService.renderManager.dumpLogInfo()}_getVeInfo(){var e;let{appVersion:t,veBuildId:i,veFullBuildVersion:r,isSIMD:a}=null!==(e=this._videoEnvironmentService)&&void 0!==e?e:{};return{appVersion:t,veVersion:i,videoEditorScmVersion:`${r}${a?"_simd":""}`}}getEventParams(){let e=this._getDumpLog(),{appVersion:t,veVersion:i,videoEditorScmVersion:r}=this._getVeInfo();return{app_version:t,ve_version:i,video_editor_scm_version:r,message:e}}constructor(e,t){this._videoEnvironmentService=e,this._mainEditorWidgetService=t,this.eventName="ve_emit_log"}}es=(0,r.gn)([(0,r.fM)(0,L.rO),(0,r.fM)(1,Q.a),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===L.rO?Object:L.rO,void 0===Q.a?Object:Q.a])],es);class el extends J.JT{get subDraftApplySpeedViewManager(){return this._subDraftApplySpeedViewManager}get draftTemplateManager(){return this._draftTemplateManager}get saveManager(){return this._saveManager}get offlineSaveManager(){return this._offlineManager}get coverManager(){return this._coverManager}get draftFirstFrameManager(){return this._draftFirstFrameManager}get cloudMetaManager(){return this._cloudMetaManager}get draftPathStore(){return this._draftPathStore}get draftWorkspaceManager(){return this._draftWorkspaceManager}getMaterialReferenceCount(e){return this._referenceCountManager.getReferenceCount(e)}getMaterialReferenceSegmentIds(e){return this._referenceCountManager.getReferenceSegmentIds(e)}dispose(){this.saveManager.dispose(),super.dispose()}constructor(e,t,i){super(),this._draftModelService=e,this._containerService=t,this._videoPermissionService=i,this._draftPathStore=new s.H,this.dataSdk=this._draftModelService.createModel(),this._cloudMetaManager=this._containerService.createInstance(l.r,this.dataSdk),this._draftTemplateManager=this._containerService.createInstance(ee.o,this._cloudMetaManager,this.dataSdk),this._coverManager=this._containerService.createInstance(d.s,this.dataSdk,this._draftTemplateManager,this.draftPathStore),this._draftFirstFrameManager=this._containerService.createInstance(X.v,this.dataSdk),this._subDraftApplySpeedViewManager=this._containerService.createInstance(er.M,this.dataSdk),this._referenceCountManager=this._containerService.createInstance(c.a,this.dataSdk),this._draftWorkspaceManager=this._containerService.createInstance(ea.I,""),this._draftWorkspaceManager.onDidWorkspaceChange(()=>{this._videoPermissionService.initDraftAllPermission(this._draftWorkspaceManager.workspaceId)}),this._saveManager=this._containerService.createInstance(G,this.dataSdk,this.cloudMetaManager,this.coverManager,this._referenceCountManager,this.draftPathStore,this._draftFirstFrameManager,this._draftWorkspaceManager),this._offlineManager=this._containerService.createInstance(ei.T,{getDraftId:()=>this.dataSdk.draftView.getDraftId()},this._saveManager),this._offlineManager.init().then(()=>{this._offlineManager.syncOfflineDraft()}),this._register(this.dataSdk.onChangeDiff(e=>{if(void 0===e.commit||e.commit){let e=this.dataSdk.draftView.getDraftId();this._videoPermissionService.setDraftId(e),this._videoPermissionService.initDraftAllPermission(this._draftWorkspaceManager.workspaceId)}})),this._register(this.dataSdk.onAbort(e=>{a.Z.error({escToExit:!1,maskClosable:!1,closeIcon:null,title:et.ZP.t("data_error_title",{},"Data error"),okText:et.ZP.t("re_fresh",{},"Refresh"),onOk:()=>{location.reload()},content:et.ZP.t("data_error_content",{},"Data error. Please refresh the page and try again.")}),!function(e){let t=e.createInstance(new eo.M(es,[]));e.invokeFunction(e=>{e.get(en.m).reportDevEvent(t.eventName,t.getEventParams())})}(this._containerService)}))}}el=(0,r.gn)([(0,r.fM)(0,n.F),(0,r.fM)(1,o.t),(0,r.fM)(2,q.u),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===n.F?Object:n.F,void 0===o.t?Object:o.t,void 0===q.u?Object:q.u])],el)},108692:function(e,t,i){i.d(t,{n:function(){return n}});var r=i(335290),a=i(936243);let n=(0,r.LO)(a.v)},823077:function(e,t,i){i.d(t,{D5:function(){return r},_3:function(){return a},aK:function(){return n}});let r=0,a=1,n="video-editor-canvas"},982313:function(e,t,i){i.d(t,{M:function(){return h}});var r=i(789786),a=i(82748),n=i(265796),o=i(475590),s=i(800788),l=i(264837),d=i(813072),c=i(847436),u=i(282573);class h{async check(e,t){if(this._checkedParams.find(t=>this._isSameParams(t,e)))return!0;let i=await this._doCheck(e,t);return i&&this._checkedParams.push(e),i}async preload(e){if(this._checkedParams.find(t=>this._isSameParams(t,e))||this._uncheckedParams.find(t=>this._isSameParams(t,e)))return;let t=await this._popupDataService.getPopupStatus(e);if(!!t.ok)t.value.popup?this._uncheckedParams.push(e):this._checkedParams.push(e)}async _doCheck(e,t){return!await this._shouldShowPopup(e)||this._showPopup(e,t)}async _shouldShowPopup(e){if(this._uncheckedParams.find(t=>this._isSameParams(t,e)))return!0;let t=await this._popupDataService.getPopupStatus(e);return!t.ok||t.value.popup}_showPopup(e,t){if(e.popup_scene===a.X.PopupSmartTool)return this._showPopupSmartTool(e,t);(0,s.bP)(e.popup_scene)}_showPopupSmartTool(e,t){switch(e.popup_item_id){case a._.SmartToolTypeEnum_DigitalHuman:return this._doShowPopup(e,l.s,t);case a._.SmartToolTypeEnum_VocalSeparation:return this._doShowPopup(e,c.X,t);case a._.SmartToolTypeEnum_VocalBeautify:return this._doShowPopup(e,u.s,t);default:(0,s.bP)(e.popup_item_id)}}_doShowPopup(e,t,i){let r=(0,o.PQ)();return t({onOk:()=>{r.resolve(!0),this._confirmPopup(e)},onCancel:()=>{r.resolve(!1)},containerService:i}),r.promise}_confirmPopup(e){this._popupDataService.confirmPopup(e)}_isSameParams(e,t){return(0,d.Z)(e,t)}constructor(e){this._popupDataService=e,this._checkedParams=[],this._uncheckedParams=[]}}h=(0,r.gn)([(0,r.fM)(0,n.V),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===n.V?Object:n.V])],h)},476907:function(e,t,i){i.d(t,{M:function(){return h}});var r=i(789786),a=i(690613),n=i(745860),o=i(920704),s=i(200247),l=i(596112),d=i(65458),c=i(358789),u=i(817488);class h extends c.g{async execute(){return this._task=this._intelligentDataService.createIntelligentTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform,smartToolType:u.v.Stable,reqJson:"",params:JSON.stringify({stable_level:this._stableParams.stableLevel}),scene:2}),await this._task}transfer(e){let t=e.taskDetails[0].transcodeVideoInfos,i=e.taskDetails[0].transcodeImageInfos,r=t.length?d.wM.Video:d.wM.Image,{vid:n}=e.taskDetails[0],o="",s="";if(n){let e;t.length?e=this._getResolution(t):i.length&&(e=this._getResolution(i)),e&&(o=e.url.replace(/^http:/,"https:"),s=e.key)}let l={type:d.FV.Stable,assetId:this._assetId,md5:e.taskDetails[0].md5,vid:n,url:o,key:s,groupType:r,resourceId:e.resourceId,resourceName:e.resourceName,taskId:e.taskId};return(0,a.oW)(l)}_getResolution(e){return e.find(e=>/480p?/.test(e.defination))||e.find(e=>/360p?/.test(e.defination))||e.find(e=>/720p?/.test(e.defination))}constructor(e,t,i,r,a,n,o){super(),this._assetId=e,this._platform=t,this._workspaceId=i,this._stableParams=r,this._accountService=a,this._teaAdapterService=n,this._intelligentDataService=o}}h=(0,r.gn)([(0,r.fM)(4,s.D),(0,r.fM)(5,l.w),(0,r.fM)(6,n.p),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,String,"undefined"==typeof IStableParams?Object:IStableParams,void 0===s.D?Object:s.D,void 0===l.w?Object:l.w,void 0===n.p?Object:n.p])],h)},811185:function(e,t,i){i.d(t,{J:function(){return u}});var r=i(789786),a=i(690613),n=i(548636),o=i(920704),s=i(200247),l=i(596112),d=i(65458),c=i(358789);class u extends c.g{async execute(){return this._task=this._videoTrackingDataService.createVideoTrackingTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform,trackingArea:this._trackingArea}),await this._task}transfer(e){var t;let i={type:d.FV.Reverse,assetId:this._assetId},r=null===(t=e.task_detail)||void 0===t?void 0:t[0];if(null==r?void 0:r.url)i.onlineData={url:null==r?void 0:r.url};else{if(null==r||!r.md5)return(0,a.wf)(-1,"reverse response invalid.");i.cloudData={md5:null==r?void 0:r.md5}}return(0,a.oW)(i)}constructor(e,t,i,r,a,n,o){super(),this._assetId=e,this._platform=t,this._workspaceId=i,this._trackingArea=r,this._accountService=a,this._teaAdapterService=n,this._videoTrackingDataService=o}}u=(0,r.gn)([(0,r.fM)(4,s.D),(0,r.fM)(5,l.w),(0,r.fM)(6,n.d),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,String,"undefined"==typeof VideoTrackingServiceParams?Object:VideoTrackingServiceParams,void 0===s.D?Object:s.D,void 0===l.w?Object:l.w,void 0===n.d?Object:n.d])],u)},457597:function(e,t,i){i.d(t,{K:function(){return r}});let r=(0,i(335290).yh)("toolbar-font-service")},584654:function(e,t,i){i.d(t,{r:function(){return c}});var r=i(789786),a=i(999268),n=i(587892),o=i(402655),s=i(320271),l=i(246457),d=i(110608);class c extends o.JT{getRecentFonts(){return this._recentFonts}addRecentFont(e){this._recentFonts=[e,...this._recentFonts.filter(t=>t.resourceId!==e.resourceId)].slice(0,3)}getFonts(){return this._fontList.get(this._useCommercial)}async getFontById(e,t){let i=this._cachedFonts.get(e);if(i)return i;let r=this.getRecentFonts().concat(this.getFonts()).find(t=>t.resourceId===e);if(r)return r;let a=await this._fontDataService.batchGetFontsByIds({ids:[e],source:t});if(a.ok){let t=a.value.list[0];return t&&this._cachedFonts.set(e,t),t}}setUseCommercial(e){if(e!==this._useCommercial)this._setUseCommercial(e)}getUseCommercial(){return this._useCommercial}async fetchMoreFonts(){await this._fetchFont()}_setUseCommercial(e){this._useCommercial=e,this._storageService.keyValue.set("fontCommercialOperationStatus",String(e)),0===this._fontList.get(this._useCommercial).length&&this._fetchFont()}async _fetchFontCategoryList(){let[e,t]=(await this._fontDataService.getFontCategories({panel:s.U_.ToolbarFonts})).pair();e?this._fontCategoryList=[]:(this._fontCategoryList=t.value.list,this._panelSource=t.value.panelSource)}_getCursor(){return this._cursor.get(this._useCommercial)}async _fetchFont(){let e=this._getCursor(),t=this._useCommercial;if(!this._fetchLock.tryLock())return;if(0===this._fontCategoryList.length&&await this._fetchFontCategoryList(),e>=this._fontCategoryList.length){this._fetchLock.unLock();return}let[i,r]=(await this._fontDataService.getFont({panel:s.U_.ToolbarFonts,category:this._fontCategoryList[e].key,categoryId:this._fontCategoryList[e].id,panelSource:this._panelSource,onlyCommercial:t,enableAlbum:!1,limit:1e3})).pair();this._cursor.set(t,e+1),!i&&(this._fontList.get(t).push(...r.value.list),this._onFontsUpdate.fire()),this._fetchLock.unLock(),this._fontList.get(this._useCommercial).length<7&&this._fetchFont()}constructor(e=!1,t,i){super(),this._useCommercial=e,this._fontDataService=t,this._storageService=i,this._fontCategoryList=[],this._panelSource="loki",this._fontList=new Map,this._cursor=new Map,this._fetchLock=new a.L,this._recentFonts=[],this._cachedFonts=new Map,this._onFontsUpdate=new n.Q,this.onFontsUpdate=this._onFontsUpdate.event,this._fontList.set(!0,[]),this._fontList.set(!1,[]),this._cursor.set(!0,0),this._cursor.set(!1,0)}}c=(0,r.gn)([(0,r.fM)(1,d.H),(0,r.fM)(2,l.d),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean,void 0===d.H?Object:d.H,void 0===l.d?Object:l.d])],c)},852247:function(e,t,i){i.d(t,{V:function(){return n}});var r=i(356954);class a{getEventParams(){return{time:this._params.time}}constructor(e){this._params=e,this.eventName="perf_graphic_cover_save"}}function n(e,t){(0,r.K)(e,a,[t])}},515918:function(e,t,i){function r(e,t){return new Promise((i,r)=>{let a=document.createElement("canvas");a.width=t.width,a.height=t.height;let n=a.getContext("2d");null==n||n.putImageData(new ImageData(e,t.width,t.height),0,0);try{i(a.toDataURL())}catch(e){r(e)}})}i.d(t,{AO:function(){return r},PK:function(){return n}});let a=/^data:image\/png;base64,/g;function n(e){return e.replace(a,"")}},658321:function(e,t,i){function r(e){return Object.values(e).reduce((e,t)=>{let{width:i,height:r,url:a,key:n}=t;return e[`${i}x${r}`]={full_url:a,width:null!=i?i:0,height:null!=r?r:0,aesKey:null!=n?n:""},e},{})}function a(e){let t={"360p":{width:360,height:360},"480p":{width:480,height:480},"720p":{width:720,height:720},"1080p":{width:1080,height:1080}};return Object.keys(e).reduce((i,r)=>{var a,n;let{url:o,key:s}=e[r],l=e[r].width||(null===(a=t[r])||void 0===a?void 0:a.width)||0,d=e[r].height||(null===(n=t[r])||void 0===n?void 0:n.height)||0;return i[`${l}x${d}`]={full_url:o,width:l,height:d,aesKey:null!=s?s:""},i},{})}i.d(t,{R:function(){return r},d:function(){return a}})},71659:function(e,t,i){i.d(t,{Zw:function(){return o},it:function(){return l},s4:function(){return s},xV:function(){return c}});var r=i(857670),a=i(426336),n=i(29188);function o(e,t,i){let o;if(t<2)return[];let s=[];o=e<a.pMA.times(n.CZ,t,"bigint")?(0,r.i1)(n.CZ):(0,r.i1)(a.pMA.div(e,t,"bigint"));for(let t=0n;t<=e;t+=o)s.push(t);if(s.pop(),i){let t=e-n.CZ;t&&s.push((0,r.i1)(t))}else s.push(e);return s.map(e=>({time:e,callbackData:Math.round(a.pMA.div(e,1e3))}))}function s(e){let t=(0,r.i1)(e);return{time:t,callbackData:Math.round(a.pMA.div(t,1e3))}}function l(e){return Number(e.replace("px",""))}function d(e){let t=Math.floor(e);return t%2==1?t-1:t}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:480;return e>1?{width:d(t*e),height:t}:{width:t,height:d(t/e)}}},383661:function(e,t,i){i.d(t,{K:function(){return r}});let r=(e,t)=>{let i={throttle:300,max:.9,...t||{}},r=Date.now(),a=!1,n=()=>{let t=Math.min((Date.now()-r)/e,i.max);i.onprogress(t),t>=i.max||window.requestAnimationFrame(n)};return window.requestAnimationFrame(n),()=>{}}},613527:function(e,t,i){i.d(t,{d:()=>v});var r=i("789786"),a=i("230689"),n=i("65458"),o=i("587892"),s=i("402655"),l=i("690613"),d=i("208041"),c=i("800788"),u=i("433140"),h=i("200247"),p=i("129219"),_=i("503914"),m=i("638336"),f=i("263958");class g extends s.JT{get source(){return p.Sc.Split}get product(){return(0,c.Y2)(this._product),this._product}get status(){return this._cancellation.token.isCancellationRequested?p.xR.Cancelled:this._job?(0,_.s)(this._job.status):p.xR.Running}get error(){return this._error}async _startJob(){if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let e=this._smartToolsService.makeBuilder(),t=await (0,m.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService),i=(0,m.R5)(this._segment,this._accountService.hasLogin);e.createSmartSplitTask(t,i),this._job=e.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,c.Y2)(1===e.length),this._onSuccess.fire(e[0])})}constructor(e,t,i,r,a,n,s){super(),this._segment=e,this._renderManager=t,this._draftPathStore=i,this._accountService=r,this._smartToolsService=a,this._containerService=n,this._resourceService=s,this._onProgress=new o.Q,this._onError=new o.Q,this._onSuccess=new o.Q,this._onCancel=new o.Q,this._cancellation=new d.A,this._error=(0,l.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new f.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}g=(0,r.gn)([(0,r.fM)(3,h.D),(0,r.fM)(4,n.dM),(0,r.fM)(5,a.t),(0,r.fM)(6,u.c),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===h.D?Object:h.D,void 0===n.dM?Object:n.dM,void 0===a.t?Object:a.t,void 0===u.c?Object:u.c])],g);class v{updateRenderManager(e){this._renderManager=e}startVideoSmartSplit(e){return this._containerService.createInstance(g,e,this._renderManager,this._draftPathStore)}constructor(e,t,i,r){this._cache=e,this._renderManager=t,this._draftPathStore=i,this._containerService=r}}v=(0,r.gn)([(0,r.fM)(3,a.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ProductCache?Object:ProductCache,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===a.t?Object:a.t])],v)},422693:function(e,t,i){i.d(t,{l:function(){return p}});var r=i(789786),a=i(772322),n=i(65458),o=i(801497),s=i(260963),l=i(597623),d=i(209264),c=i(153197),u=i(13751),h=i(126729);class p{setTimelineManager(e){this._timelineManager=e}prepare(e,t,i){let r=(0,c.kV)(e),n=i.touchPointer,o=i.toolType;if(r){let e=this._getPrepareTextByQuickImport(t,o);e&&this._notificationService.normal(e,{style:(0,d.s)()});return}if(n){var s;let{text:i,btnText:r}=null!==(s=this._getPrepareTextByTouchPointer(t,n))&&void 0!==s?s:{};if(!i)return;let{closeNotification:o}=this._notificationService.loading((0,a.jsxs)(a.Fragment,{children:[i," ",(0,a.jsx)("span",{className:"attribute-vc-toast-cancel",onClick:()=>{var t,i;null===(i=this._tokenEventQueueManager.getApplyingTokenEvent(e.id))||void 0===i||null===(t=i.token)||void 0===t||t.cancel(),null==o||o()},children:r})]}),{style:(0,d.s)()});return}}smartToolRemoved(e){this._notificationService.info(o.ZP.t("web_color_correction_toast_restart_others",{string0:this._getRemovedMessageByToolType(e)},"{string0} was removed. Other features that were applied will be applied again, and it will take some time."),{style:(0,d.s)()})}setLoading(e,t,i,r){var a;let n=this._getLoadingText(e,t,i,r);this._segmentLoadingState.set(e,{loading:!0,loadingText:n}),null===(a=this._timelineManager)||void 0===a||a.segmentManager.setTimelineSegmentLoading(e,!0,Date.now(),null!=n?n:o.ZP.t("load_web_ing",{},"loading"))}clearLoading(e){var t;this._segmentLoadingState.set(e,{loading:!1}),null===(t=this._timelineManager)||void 0===t||t.segmentManager.setTimelineSegmentLoading(e,!1,Date.now())}error(e,t){let i=this._getErrorText(e,t);i&&this._notificationService.error(i,{style:(0,d.s)()})}success(e){let t=this._getSuccessText(e);t&&this._notificationService.success(t,{style:(0,d.s)()})}getLoadingState(e){var t;return null!==(t=this._segmentLoadingState.get(e))&&void 0!==t?t:{loading:!1}}_getRemovedMessageByToolType(e){var t;return null!==(t=({[n.FV.VocalBeautify]:o.ZP.t("web_enhance_voice_feature_name",{},"Enhance voice"),[n.FV.VocalSeparation]:o.ZP.t("web_isolate_feature_name",{},"Isolate voice")})[e])&&void 0!==t?t:"Feature"}_getPrepareTextByTouchPointer(e,t){return({[`${u.V.CROP}_${n.FV.VocalSeparation}`]:{text:o.ZP.t("web_isolate_re_isolating",{},"Re-isolating voice..."),btnText:o.ZP.t("web_isolate_cancel_re_isolation",{},"Cancel")},[`${u.V.CROP}_${n.FV.VocalBeautify}`]:{text:o.ZP.t("web_enhance_voice_toast_re_enhance",{},"Clip duration changed. Re-enhancing voice..."),btnText:o.ZP.t("web_enhance_voice_cancel_re_enhance",{},"Cancel")}})[`${t}_${e}`]}_getPrepareTextByQuickImport(e,t){return e===n.FV.Pipeline?({[h.F2.Deflicker]:o.ZP.t("web_flicker_toast_uploading",{},"Flicker removal will start once your media is uploaded"),[h.F2.VideoNoiseReduction]:o.ZP.t("web_noise_toast_uploading",{},"Noise reduction will start once your media is uploaded")})[t]:({[n.FV.VocalBeautify]:o.ZP.t("web_enhance_voice_toast_uploading",{},"Voice enhancement will start once your media is uploaded"),[n.FV.VocalSeparation]:o.ZP.t("web_isolate_toast_uploading",{},"Voice isolation will start once your media is uploaded")})[e]}_getLoadingText(e,t,i,r){return this._tokenEventQueueManager.getApplyingTokenEvent(e).type===n.FV.Pipeline?this._pipelineManager.getLoadingText(r):({[n.FV.VocalBeautify]:o.ZP.t("web_enhance_voice_in_progress",{number0:i},"Enhancing voice... {number0}%"),[n.FV.Vc]:`${o.ZP.t("web_voice_text_coixe_effecting",{},"Voice effect is loading...")} ${i}%`,[n.FV.VocalSeparation]:o.ZP.t("web_isolate_in_progress",{number0:i},"Isolating voice... {number0}%")})[t]}_getErrorText(e,t){let{sourceType:i,sourceParams:r}=this._tokenEventQueueManager.getApplyingTokenEvent(e);return i===n.FV.Pipeline?this._pipelineManager.getFailedText(r.toolType):({[n.FV.VocalBeautify]:o.ZP.t("web_enhance_voice_something_went_wrong",{},"Something went wrong"),[n.FV.VocalSeparation]:o.ZP.t("web_isolate_failed_toast",{},"Couldn\u2019t isolate voice. Try again.")})[t]}_getSuccessText(e){if(!!e.sourceParams.enabled)return({[n.FV.VocalBeautify]:o.ZP.t("web_enhance_voice_toast_enhanced",{},"Voice enhanced"),[n.FV.VocalSeparation]:o.ZP.t("web_isolate_isolated_toast",{},"Voice isolated")})[e.sourceType]}constructor(e,t,i,r){this._tokenEventQueueManager=e,this._pipelineManager=t,this._timelineManager=i,this._notificationService=r,this._segmentLoadingState=(0,s.LO)(new Map)}}p=(0,r.gn)([(0,r.fM)(3,l.lT),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TokenEventQueueManager?Object:TokenEventQueueManager,"undefined"==typeof PipelineManager?Object:PipelineManager,Object,void 0===l.lT?Object:l.lT])],p)},600921:function(e,t,i){i.d(t,{m:function(){return S}});var r=i(789786),a=i(587892),n=i(402655),o=i(690613),s=i(208041),l=i(800788),d=i(129219),c=i(65458),u=i(230689),h=i(433140),p=i(200247),_=i(817554),m=i(426336),f=i(263958),g=i(503914),v=i(638336),y=i(105395);class S extends n.JT{get source(){return d.Sc.Gameplay}get product(){return(0,l.Y2)(this._product),this._product}get status(){return this._cancellation.token.isCancellationRequested?d.xR.Cancelled:this._job?(0,g.s)(this._job.status):d.xR.Running}get error(){return this._error}async _startJob(){var e;if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let t=this._smartToolsService.makeBuilder(),i=await (0,v.aP)(this._segment,this._draftPathStore,this._resourceService),r=(0,v.R5)(this._segment,this._accountService.hasLogin),a=(0,m.MnT)(this._segment.material);t.createGameplayTask(i,r,null!==(e=null==a?void 0:a.algorithm)&&void 0!==e?e:""),this._job=t.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,l.Y2)(1===e.length),this._downloadAndAddResourceService(e[0])})}async _downloadAndAddResourceService(e){var t,i;let r=[{md5:null!==(t=e.md5)&&void 0!==t?t:"",vid:null!==(i=e.vid)&&void 0!==i?i:"",url:e.url,key:e.key}].filter(e=>""!==e.md5||""!==e.vid),a=await this._containerService.invokeFunction(_.CH,{list:r},{resourceType:d.uG.SmartTools,resourceId:e.taskId,isGameplay:!0});if(!a.ok){this._error=a,this._onError.fire(this._error);return}e.groupType===c.wM.Image?this._accountService.hasLogin?this._handleImageProduct(e,a.value):this._handleFileProduct(e,a.value):this._accountService.hasLogin?this._handleVideoProduct(e,a.value):this._handleFileProduct(e,a.value)}async _handleImageProduct(e,t){let i=this._containerService.invokeFunction(_.Fq,t,this._draftPathStore),r=await this._containerService.invokeFunction(y.RG,i[0].id,i[0].path);if(!r.ok){this._error=r,this._onError.fire(this._error);return}this._product={path:i[0].path,groupType:d.FI.Image,resourceId:e.resourceId,resourceName:e.resourceName},this._onSuccess.fire(this._product)}async _handleVideoProduct(e,t){let i=this._containerService.invokeFunction(_.Rg,t,this._draftPathStore);(0,l.Y2)(i.length>=1);let r=await (0,_.TB)(this._resourceService,i[0].id);this._product={path:i[0].path,...r,groupType:d.FI.Video,resourceId:e.resourceId,resourceName:e.resourceName};let a=await this._containerService.invokeFunction(y.U3,this._renderManager,this._product);if(!a.ok){this._error=a,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}async _handleFileProduct(e,t){let i=this._containerService.invokeFunction(_.Jy,t,this._draftPathStore);(0,l.Y2)(i.length>=1);let r=await (0,_.gF)(this._resourceService,i[0].id);if(this._product={path:i[0].path,...r,groupType:d.FI.Video,resourceId:e.resourceId,resourceName:e.resourceName},e.groupType===c.wM.Video){let e=await this._containerService.invokeFunction(y.U3,this._renderManager,this._product);if(!e.ok){this._error=e,this._onError.fire(this._error);return}}else if(e.groupType===c.wM.Image){let t=await this._containerService.invokeFunction(y.F4,e.resourceId,this._draftPathStore.getDraftPathFromResourceKey(e.resourceId));if(!t.ok){this._error=t,this._onError.fire(this._error);return}}else(0,l.bP)(e.groupType);this._onSuccess.fire(this._product)}constructor(e,t,i,r,n,l,d){super(),this._segment=e,this._renderManager=t,this._draftPathStore=i,this._accountService=r,this._smartToolsService=n,this._containerService=l,this._resourceService=d,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellation=new s.A,this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new f.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}S=(0,r.gn)([(0,r.fM)(3,p.D),(0,r.fM)(4,c.dM),(0,r.fM)(5,u.t),(0,r.fM)(6,h.c),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===p.D?Object:p.D,void 0===c.dM?Object:c.dM,void 0===u.t?Object:u.t,void 0===h.c?Object:h.c])],S)},487620:function(e,t,i){i.d(t,{o:function(){return x}});var r=i(789786),a=i(587892),n=i(402655),o=i(690613),s=i(208041),l=i(800788),d=i(129219),c=i(108692),u=i(65458),h=i(126729),p=i(915208),_=i(230689),m=i(433140),f=i(200247),g=i(702049),v=i(817554),y=i(426336),S=i(263958),w=i(503914),b=i(638336),M=i(105395),T=i(732564),k=i(441247);class x extends n.JT{get source(){return d.Sc.Pipeline}get product(){return(0,l.Y2)(this._product.path),this._product}get status(){return this._cancellation.token.isCancellationRequested?d.xR.Cancelled:this._job?(0,w.s)(this._job.status):d.xR.Running}get error(){return this._error}async _startJob(){if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let e=this._smartToolsService.makeBuilder(),t=await (0,b.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService),i=this._segment.material.type===y.cVg.MetaTypePhoto?1:0,r=(0,b.R5)(this._segment,this._accountService.hasLogin),a=this._segment.id,n=this._mainDraftService.cloudMetaManager.getMeta().draft.id,o=g._L.getVar("web_idc");e.createPipelineTask({assetId:t,assetType:i,platform:r,segmentId:a,draftKey:n,resourceIdc:o,scene:3,params:this._params,assetWorkspaceId:this._segment.material.teamId}),this._job=e.build(),this._onProgress.fire(0),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress((e,t)=>{var i,r;this._onProgress.fire(e,t),this._midProductSource={pipelineId:null!==(i=null==t?void 0:t.pipelineId)&&void 0!==i?i:"",successMidResult:null!==(r=null==t?void 0:t.successMidResult)&&void 0!==r?r:[]}}),this._job.onSuccess(e=>{(0,l.Y2)(1===e.length),this._downloadAndAddResourceService(e[0])})}async _buildMidProduct(e){let{successMidResult:t}=e,i=t.map(e=>e.tool_type),r=this._segment.material.type===y.cVg.MetaTypePhoto?1:0,a=await this._buildMidPipelineValue(e,r);if(!a.ok){this._onCancelWithMidProdApply.fire(void 0);return}if(1===r){if(!(await this._handleImagePipelineTaskValue(a.value,i)).ok){this._onCancelWithMidProdApply.fire(void 0);return}this._onCancelWithMidProdApply.fire({product:this._product,successToolTypes:i})}else{let e=await this._handleVideoPipelineTaskValue(a.value,i);if(!(null==e?void 0:e.ok)||!(await this._containerService.invokeFunction(M.V7,this._renderManager,this._product)).ok){this._onCancelWithMidProdApply.fire(void 0);return}this._onCancelWithMidProdApply.fire({product:this._product,successToolTypes:i})}}async _buildMidPipelineValue(e,t){let{pipelineId:i,successMidResult:r}=e;if(!r.length)return(0,o.wf)(-1,"no successful pipeline middle result");let{md5:a="",vid:n=""}=r[r.length-1],s=await (0,b.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService),l={type:u.FV.Pipeline,assetId:s,groupType:k.Jg[t],pipelineId:i};return this._accountService.hasLogin&&!a?(0,o.wf)(-1,"pipeline should have md5 or matting_md5"):this._accountService.hasLogin||n?(this._accountService.hasLogin?l.cloudData={md5:a,path:a,mattingMd5:"",mattingPath:"",edgeProductMd5:"",edgeProductPath:""}:l.onlineData={vid:n,path:n,key:"",url:"",mattingKey:"",mattingUrl:"",mattingVid:"",mattingPath:"",edgeProductKey:"",edgeProductVid:"",edgeProductUrl:"",edgeProductPath:""},(0,o.oW)(l)):(0,o.wf)(-1,"pipeline should have vid or matting_vid")}async _downloadAndAddResourceService(e){if(e.groupType===u.wM.Video){let t=await this._handleVideoPipelineTaskValue(e,this._params.map(e=>e.toolType));if(!t.ok){this._error=t,this._onError.fire(this._error);return}let i=await this._containerService.invokeFunction(M.V7,this._renderManager,this._product);if(!i.ok){this._error=i,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}else{let t=await this._handleImagePipelineTaskValue(e,this._params.map(e=>e.toolType));if(!t.ok){this._error=t,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}}async _handleVideoPipelineTaskValue(e,t){var i,r,a,n,s,c,u,_,m,f,g,y,S,w,b,M,T,x,I,P,E,C,D,F,A,R,j,O,B,V,N,U,L,W,Z,H,z,K,$,Y,Q,G,X,J,q,ee,et,ei;let er,ea,en;let eo=!!((null===(i=e.cloudData)||void 0===i?void 0:i.md5)||(null===(r=e.onlineData)||void 0===r?void 0:r.vid)),es=!!((null===(a=e.cloudData)||void 0===a?void 0:a.mattingMd5)||(null===(n=e.onlineData)||void 0===n?void 0:n.mattingVid)),el=!!((null===(s=e.cloudData)||void 0===s?void 0:s.edgeProductMd5)||(null===(c=e.onlineData)||void 0===c?void 0:c.edgeProductVid)),ed=!t.filter(e=>h.F2.VideoMaskTask!==e).every(e=>e===h.F2.VideoReverseTask)&&this._accountService.hasLogin;if(eo){let t=[{md5:null!==(T=null===(g=e.cloudData)||void 0===g?void 0:g.md5)&&void 0!==T?T:"",vid:null!==(x=null===(y=e.onlineData)||void 0===y?void 0:y.vid)&&void 0!==x?x:"",url:null!==(I=null===(S=e.onlineData)||void 0===S?void 0:S.url)&&void 0!==I?I:"",key:null!==(P=null===(w=e.onlineData)||void 0===w?void 0:w.key)&&void 0!==P?P:"",path:null!==(C=null!==(E=null===(b=e.cloudData)||void 0===b?void 0:b.path)&&void 0!==E?E:null===(M=e.onlineData)||void 0===M?void 0:M.path)&&void 0!==C?C:""}],i=await this._containerService.invokeFunction(v.CH,{list:t},{resourceType:d.uG.PipelineVideo,pipelineId:e.pipelineId});if(!i.ok)return i;let r=this._containerService.invokeFunction(ed?v.Rg:v.Jy,i.value,this._draftPathStore,t.map(e=>`${p.CM}${e.path}`));(0,l.Y2)(1===r.length),[er]=r}if(es){let t=[{md5:null!==(B=null===(D=e.cloudData)||void 0===D?void 0:D.mattingMd5)&&void 0!==B?B:"",vid:null!==(V=null===(F=e.onlineData)||void 0===F?void 0:F.mattingVid)&&void 0!==V?V:"",url:null!==(N=null===(A=e.onlineData)||void 0===A?void 0:A.mattingUrl)&&void 0!==N?N:"",key:null!==(U=null===(R=e.onlineData)||void 0===R?void 0:R.mattingKey)&&void 0!==U?U:"",path:null!==(W=null!==(L=null===(j=e.cloudData)||void 0===j?void 0:j.mattingPath)&&void 0!==L?L:null===(O=e.onlineData)||void 0===O?void 0:O.mattingPath)&&void 0!==W?W:""}],i=await this._containerService.invokeFunction(v.CH,{list:t},{resourceType:d.uG.PipelineVideo,pipelineId:e.pipelineId});if(!i.ok)return i;let r=this._containerService.invokeFunction(v.Jy,i.value,this._draftPathStore,t.map(e=>`${p.CM}${e.path}`));(0,l.Y2)(r.length===t.length),[ea]=r}if(el){let t=[{md5:null!==(Q=null===(Z=e.cloudData)||void 0===Z?void 0:Z.edgeProductMd5)&&void 0!==Q?Q:"",vid:null!==(G=null===(H=e.onlineData)||void 0===H?void 0:H.edgeProductVid)&&void 0!==G?G:"",url:null!==(X=null===(z=e.onlineData)||void 0===z?void 0:z.edgeProductUrl)&&void 0!==X?X:"",key:null!==(J=null===(K=e.onlineData)||void 0===K?void 0:K.edgeProductKey)&&void 0!==J?J:"",path:null!==(ee=null!==(q=null===($=e.cloudData)||void 0===$?void 0:$.edgeProductPath)&&void 0!==q?q:null===(Y=e.onlineData)||void 0===Y?void 0:Y.edgeProductPath)&&void 0!==ee?ee:""}],i=await this._containerService.invokeFunction(v.CH,{list:t},{resourceType:d.uG.PipelineVideo,pipelineId:e.pipelineId});if(!i.ok)return i;let r=this._containerService.invokeFunction(v.Jy,i.value,this._draftPathStore,t.map(e=>`${p.CM}${e.path}`));(0,l.Y2)(r.length===t.length),[en]=r}let ec={url:"",key:""};if(e.cloudData&&er){let e=await (ed?(0,v.TB)(this._resourceService,er.id):(0,v.gF)(this._resourceService,er.id));ec.url=e.url,ec.key=e.key}else(null===(u=e.onlineData)||void 0===u?void 0:u.url)&&(null===(_=e.onlineData)||void 0===_?void 0:_.key)&&(ec.url=e.onlineData.url,ec.key=e.onlineData.key);if(e.cloudData&&ea){let e=await (0,v.gF)(this._resourceService,ea.id);this._product.matting={path:ea.path,url:e.url,key:e.key}}else(null===(m=e.onlineData)||void 0===m?void 0:m.mattingPath)&&e.onlineData.mattingUrl&&e.onlineData.mattingKey&&(this._product.matting={path:e.onlineData.mattingPath,url:e.onlineData.mattingUrl,key:e.onlineData.mattingKey});if(e.cloudData&&en){let e=await (0,v.gF)(this._resourceService,en.id);this._product.mattingEdge={path:en.path,url:e.url,key:e.key}}else(null===(f=e.onlineData)||void 0===f?void 0:f.edgeProductPath)&&e.onlineData.edgeProductUrl&&e.onlineData.edgeProductKey&&(this._product.mattingEdge={path:e.onlineData.edgeProductPath,url:e.onlineData.edgeProductUrl,key:e.onlineData.edgeProductKey});return this._product.path=null!==(et=null==er?void 0:er.path)&&void 0!==et?et:"",this._product.url=ec.url,this._product.key=ec.key,this._product.pipelineId=e.pipelineId,this._product.resourceId=null!==(ei=null==er?void 0:er.id)&&void 0!==ei?ei:"",this._product.productType=k.q2[e.groupType],(0,o.oW)(er)}async _handleImagePipelineTaskValue(e,t){var i,r,a,n,s,c,u,_,m,f,g,y,S,w;let b={md5:null!==(u=null===(i=e.cloudData)||void 0===i?void 0:i.md5)&&void 0!==u?u:"",vid:null!==(_=null===(r=e.onlineData)||void 0===r?void 0:r.vid)&&void 0!==_?_:"",url:null!==(m=null===(a=e.onlineData)||void 0===a?void 0:a.url)&&void 0!==m?m:"",key:null!==(f=null===(n=e.onlineData)||void 0===n?void 0:n.key)&&void 0!==f?f:"",path:null!==(y=null!==(g=null===(s=e.cloudData)||void 0===s?void 0:s.path)&&void 0!==g?g:null===(c=e.onlineData)||void 0===c?void 0:c.path)&&void 0!==y?y:""},T=await this._containerService.invokeFunction(v.CH,{list:[b]},{resourceType:d.uG.PipelinePhoto,pipelineId:e.pipelineId}),x=!t.some(e=>[h.F2.ImageMaskTask].includes(e))&&this._accountService.hasLogin;if(!T.ok)return T;let I=this._containerService.invokeFunction(x?v.Fq:v.Jy,T.value,this._draftPathStore,[`${p.CM}${b.path}`]);(0,l.Y2)(1===I.length);let P=I[0];if(e.cloudData){if(x){let e=await (0,v.Lo)(this._resourceService,P.id);this._product.url=e.url,this._product.key=e.key}else{let e=await (0,v.gF)(this._resourceService,P.id);this._product.url=e.url,this._product.key=e.key}}else this._product.url=b.url,this._product.key=b.key;this._product.path=null!==(S=null==P?void 0:P.path)&&void 0!==S?S:"",this._product.resourceId=null!==(w=null==P?void 0:P.id)&&void 0!==w?w:"",this._product.pipelineId=e.pipelineId,this._product.productType=k.q2[e.groupType];let E=await this._containerService.invokeFunction(x?M.RG:M.F4,P.id,P.path);return E.ok?(0,o.oW)(P):E}constructor(e,t,i,r,n,l,d,c,u){super(),this._segment=e,this._params=t,this._renderManager=i,this._draftPathStore=r,this._accountService=n,this._smartToolsService=l,this._containerService=d,this._resourceService=c,this._mainDraftService=u,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellation=new s.A,this._onCancelWithMidProdApply=new a.Q,this._product={},this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.cancelWithMidProdApply=()=>{var e;this._job?this._job.cancel():this._cancellation.cancel();let{successMidResult:t=[]}=null!==(e=this._midProductSource)&&void 0!==e?e:{},i=t.filter(e=>e.tool_type!==h.F2.VideoCut);this._midProductSource&&(this._midProductSource.successMidResult=i),this._midProductSource&&i.length?this._buildMidProduct(this._midProductSource):this._onCancelWithMidProdApply.fire(void 0)},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this.onCancelWithMidProdApply=this._onCancelWithMidProdApply.event,this._preTask=new S.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}x=(0,r.gn)([(0,r.fM)(4,f.D),(0,r.fM)(5,u.dM),(0,r.fM)(6,_.t),(0,r.fM)(7,m.c),(0,r.fM)(8,c.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,Object,void 0===T.zo?Object:T.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===f.D?Object:f.D,void 0===u.dM?Object:u.dM,void 0===_.t?Object:_.t,void 0===m.c?Object:m.c,void 0===c.n?Object:c.n])],x)},553637:function(e,t,i){i.d(t,{U:function(){return V},b:function(){return N}});var r=i(789786),a=i(587892),n=i(402655),o=i(690613),s=i(208041),l=i(800788),d=i(129219),c=i(896413),u=i(108692),h=i(65458),p=i(920704),_=i(420072),m=i(798184),f=i(230689),g=i(433140),v=i(545797),y=i(200247),S=i(127830),w=i(241254),b=i(817554),M=i(426336),T=i(503914),k=i(638336),x=i(105395),I=i(732564),P=i(254336),E=i(53230),C=i(474572),D=i(122312),F=i(205921),A=i(948328),R=i(196769),j=i(198990),O=i(271564),B=i(72978);function V(e,t){return t&&t.path?t:[{path:(0,M.hey)(e)?e.material.videoAlgorithm.path:"",type:M.cVg.MetaTypeVideo},{path:(0,M.hey)(e)?e.material.reversePath:"",type:M.cVg.MetaTypeVideo},{path:e.material.path,type:e.material.type}].find(e=>e.path)}class N extends n.JT{static generateKey(e,t,i,r){let[a,n]=null!=i?i:[];return`${e.id}_${V(e,r).path}_${t}_${a}_${n}`}static parseKey(e){let[t,i,r,a,n]=e.split("_");return{segmentId:t,path:i,mode:r,start:BigInt(a),end:BigInt(n)}}dispose(){this._onProgress.dispose(),this._onError.dispose(),this._onSuccess.dispose(),this._onCancel.dispose(),super.dispose()}get key(){return this._key}get mode(){return this._mode}get timeRange(){return this._timeRange}get source(){return d.Sc.Vc}get product(){return(0,l.Y2)(this._product),this._product}get status(){return this._job?(0,T.s)(this._job.status):d.xR.Running}get error(){return this._error}cancel(){this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()}async _startJob(){let e;if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;this._tokenStartTime=Date.now(),(0,B.X)(this._containerService,{segment:this._segment,time:0,status:"start",functionName:"voice_isolation"});let t=this._smartToolsService.makeBuilder(),i="";e=(0,k.R5)(this._segment,this._accountService.hasLogin);let r=V(this._segment,this._material);try{r.type===M.cVg.MetaTypeVideoOriginalSound?(i=await this._separateAudio(),e=this._accountService.hasLogin?p.hn.EverPhoto:p.hn.VideoArch):i=r.type===M.cVg.MetaTypeVideo?await this._separateAudio():await (0,k.EZ)(V(this._segment,this._material).path,this._draftPathStore,this._resourceService)}catch(e){var a;this._error=(0,o.wf)(-1,null!==(a=e.message)&&void 0!==a?a:"separateAudio error.")}if(!i){this._onError.fire(this._error);return}let n=(0,O.lr)(w._A.SoundSeparation);t.createVocalSeparationTask(i,e,this._mode,this._timeRange,n),this._job=t.build(),this._job.onCancel(()=>{(0,B.X)(this._containerService,{segment:this._segment,time:Date.now()-this._tokenStartTime,status:"cancel",functionName:"voice_isolation"}),this._onCancel.fire()}),this._job.onError(e=>{this._error=e,(0,B.X)(this._containerService,{segment:this._segment,time:Date.now()-this._tokenStartTime,status:"fail",functionName:"voice_isolation"}),this._onError.fire(this._error)}),this._job.onProgress(e=>{this.progress=e,this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,l.Y2)(1===e.length),(0,B.X)(this._containerService,{segment:this._segment,time:Date.now()-this._tokenStartTime,status:"success",functionName:"voice_isolation"}),this._onProgress.fire(100),this._downloadAndAddResourceService(e[0])})}_separateAudio(){return new Promise(async(e,t)=>{try{var i,r,a,n,o,s,l,d;let{workspaceId:t}=this._mainDraftService.draftWorkspaceManager||{},c=V(this._segment,this._material).path,u=null!==(n=null!==(a=this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c),S._g.UserVideo))&&void 0!==a?a:this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c),S._g.Video))&&void 0!==n?n:this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c),S._g.UserFile);await (0,_.Z)(u);let h=null!==(s=null!==(o=null===(i=u.getOriginResourceToken)||void 0===i?void 0:i.call(u))&&void 0!==o?o:null===(r=u.getVideoResourceToken)||void 0===r?void 0:r.call(u))&&void 0!==s?s:u.getUserFileResourceToken();await (0,m.x)(h);let{decryptKey:p}=(null==h?void 0:h.value)||{},{buffer:f}=(null==h?void 0:h.value)||{};if(!f)return;let g=new Blob([f],{type:"video/mp4"}),v=(0,j.h)({source:g,fileName:`${u.value.key}_extractor`}),{hasLogin:y}=this._accountService;if(y){let i=await (null===(l=this._veExtractAudioAndUploadMaterialManager)||void 0===l?void 0:l.extractAudioAndUpload({files:[v],decryptKey:p,fromWorkspaceId:t,toWorkspaceId:t,uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),r=null==i?void 0:i[0];if(null==r?void 0:r.ok)r.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this._error)}),r.value.onPrepareFailure(async t=>{e(await this._useFfmpeg(v))}),r.value.onTranscodeFailure(async()=>{e(await this._useFfmpeg(v))}),r.value.onDidDone(()=>{let t=r.value.getModel();e(null==t?void 0:t.assetId)});else{let t=await this._useFfmpeg(v);e(t)}}else{let t=await (null===(d=this._veExtraAudioAndUploadNoSignManager)||void 0===d?void 0:d.upload({files:[v],uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),i=null==t?void 0:t[0];(null==i?void 0:i.ok)?(i.value.onDidTranscode(()=>{let t=i.value.getModel();e(t.vid)}),i.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this._error)}),i.value.onPrepareFailure(async t=>{e(await this._useFfmpeg(v))}),i.value.onTranscodeFailure(async()=>{e(await this._useFfmpeg(v))})):e(await this._useFfmpeg(v))}}catch(e){t(e)}})}_useFfmpeg(e){let{hasLogin:t}=this._accountService,{workspaceId:i}=this._mainDraftService.draftWorkspaceManager;return new Promise(async(r,a)=>{var n,s;if(t){let t=await (null===(n=this._extractAudioAndUploadMaterialManager)||void 0===n?void 0:n.extractAudioAndUpload({files:[e],fromWorkspaceId:i,toWorkspaceId:i,uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),a=null==t?void 0:t[0];(null==a?void 0:a.ok)?(a.value.onDidDone(()=>{let e=a.value.getModel();r(null==e?void 0:e.assetId)}),a.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this.error)}),a.value.onPrepareFailure(e=>{this._onError.fire(null!=e?e:this.error)}),a.value.onTranscodeFailure(e=>{this._onError.fire(null!=e?e:this.error)})):this._onError.fire((0,o.wf)(-1,"extractor fail"))}else{let t=await (null===(s=this._extraAudioAndUploadNoSignManager)||void 0===s?void 0:s.extractAudioAndUpload({files:[e],uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),i=null==t?void 0:t[0];(null==i?void 0:i.ok)?(i.value.onDidTranscode(()=>{r(i.value.getModel().vid)}),i.value.onUploadFailure(e=>{this._onError.fire(this.error)}),i.value.onPrepareFailure(e=>{this._onError.fire(null!=e?e:this.error)}),i.value.onTranscodeFailure(e=>{this._onError.fire(null!=e?e:this.error)})):this._onError.fire((0,o.wf)(-1,"extractor fail"))}})}async _downloadAndAddResourceService(e){var t,i,r,a,n,o,s,c,u;let h=[{md5:null!==(n=null===(t=e.cloudData)||void 0===t?void 0:t.md5)&&void 0!==n?n:"",vid:null!==(o=null===(i=e.onlineData)||void 0===i?void 0:i.vid)&&void 0!==o?o:"",url:null!==(s=null===(r=e.onlineData)||void 0===r?void 0:r.url)&&void 0!==s?s:"",key:null!==(c=null===(a=e.onlineData)||void 0===a?void 0:a.key)&&void 0!==c?c:"",resourceId:null!==(u=e.taskId)&&void 0!==u?u:""}].filter(e=>""!==e.md5||""!==e.vid),p=await this._containerService.invokeFunction(b.CH,{list:h},{resourceType:d.uG.VC,isGameplay:!0});if(!p.ok)return p;let _=this._containerService.invokeFunction(b.Jy,p.value,this._draftPathStore);(0,l.Y2)(_.length>=1);let m={url:"",key:""};if(e.cloudData){let e=await (0,b.gF)(this._resourceService,_[0].id);m.url=e.url,m.key=e.key}else e.onlineData&&(m.url=e.onlineData.url,m.key=e.onlineData.key);this._product={path:_[0].path,...m};let f=await this._containerService.invokeFunction(x.P$,this._renderManager,this._product,p.value,_[0].id);if(!f.ok){this._error=f,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}constructor(e,t,i,r,n,l,d,c,u,h,p,_,m){super(),this._segment=e,this._mode=t,this._timeRange=i,this._material=r,this._renderManager=n,this._draftPathStore=l,this._accountService=d,this._smartToolsService=c,this._containerService=u,this._resourceService=h,this._mainEditorWidgetService=p,this._mainDraftService=_,this._draftMaterialsService=m,this.progress=0,this._tokenStartTime=Date.now(),this._extractAudioAndUploadMaterialManager=null,this._veExtractAudioAndUploadMaterialManager=null,this._extraAudioAndUploadNoSignManager=null,this._veExtraAudioAndUploadNoSignManager=null,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellation=new s.A,this._error=(0,o.wf)(-1,"voice effect failed!"),this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event;let f=this._containerService.createInstance(R.o);this._extractAudioAndUploadMaterialManager=this._containerService.createInstance(E.Z,{onCreated:()=>{},payinPayoutHelper:f,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._veExtractAudioAndUploadMaterialManager=this._containerService.createInstance(C.C,{onCreated:()=>{},payinPayoutHelper:f,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._extraAudioAndUploadNoSignManager=this._containerService.createInstance(D.d,{onCreated:e=>{let{}=e},payinPayoutHelper:f,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._veExtraAudioAndUploadNoSignManager=this._containerService.createInstance(F.D,{onCreated:()=>{},payinPayoutHelper:f,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._key=N.generateKey(this._segment,this._mode,this._timeRange,this._material),this._startJob()}}N=(0,r.gn)([(0,r.fM)(6,y.D),(0,r.fM)(7,h.dM),(0,r.fM)(8,f.t),(0,r.fM)(9,g.c),(0,r.fM)(10,c.a),(0,r.fM)(11,u.n),(0,r.fM)(12,A.D),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object,void 0===v.gx?Object:v.gx,Object,Object,void 0===I.zo?Object:I.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===y.D?Object:y.D,void 0===h.dM?Object:h.dM,void 0===f.t?Object:f.t,void 0===g.c?Object:g.c,void 0===c.a?Object:c.a,void 0===u.n?Object:u.n,void 0===A.D?Object:A.D])],N)},271564:function(e,t,i){i.d(t,{A9:function(){return x},AG:function(){return h},Bj:function(){return w},CC:function(){return M},FG:function(){return v},Hs:function(){return k},KU:function(){return I},QR:function(){return m},Yn:function(){return S},ef:function(){return p},jm:function(){return T},lr:function(){return P}});var r=i(426336),a=i(441247),n=i(800788),o=i(460254),s=i(188247),l=i(435359),d=i(722169),c=i(129219),u=i(241254);let h=e=>{let t=(0,r.MnT)(e.material);return!!(null==t?void 0:t.algorithm)},p=e=>{let t=(null==e?void 0:e.material.matting)||{};return((null==t?void 0:t.flag)||0)>1},_=e=>null==e?void 0:e.reverse,m=(e,t)=>_(e)&&[o.r.Video,o.r.UserVideo].includes(t.type),f=e=>{var t,i;return!!(null==e?void 0:null===(i=e.material.videoAlgorithm)||void 0===i?void 0:null===(t=i.algorithms)||void 0===t?void 0:t.length)},g=e=>{var t;return(null===(t=e.material.stable)||void 0===t?void 0:t.stableLevel)>0},v=(e,t)=>g(e)&&t.type===o.r.UserVideo,y=e=>{var t,i,a;return null==e?void 0:null===(a=e.material)||void 0===a?void 0:null===(i=a.videoAlgorithm)||void 0===i?void 0:null===(t=i.algorithms)||void 0===t?void 0:t.some(e=>e.type===r.zzh.ComplementFrame)},S=(e,t)=>y(e)&&[o.r.Video,o.r.UserVideo].includes(t.type),w=e=>!!(e&&(0,r.hey)(e))&&(h(e)||p(e)||f(e)||g(e)),b=e=>{let t=[],i=[],r=[],a=[];return e.forEach(e=>{"SegmentVideo"===e.__segment_struct_type&&(h(e)&&t.push(e.id),p(e)&&i.push(e.id),f(e)&&r.push(e.id),g(e)&&a.push(e.id))}),{haveGameplaySegIds:t,haveAiMattingSegIds:i,haveVideoAlgorithmSegIds:r,haveVideoStableIds:a}},M=(e,t)=>{let{haveGameplaySegIds:i,haveAiMattingSegIds:r,haveVideoAlgorithmSegIds:n}=b(t);if(e){if(i.includes(e))return a.Fw;if(r.includes(e))return a.Gi;else if(n.includes(e))return a.gy}return""};async function T(e,t,i){var a,o,s,l,d;let{draftId:c,material:u,mutableId:h,segmentId:p,crop:_,sourceStart:m,volume:f}=i,g=t.resourceRecords.getRecordBySegmentPath(u.path),v=null!==(o=null==g?void 0:g.decryptKey)&&void 0!==o?o:"",y=(0,r.dlx)(null!==(s=null==g?void 0:g.resPath)&&void 0!==s?s:"",null!==(l=null===(a=t.resourceRecords.getRecordBySegmentPath(i.coverPath))||void 0===a?void 0:a.resPath)&&void 0!==l?l:""),S=await t.getMediaFileInfo(y,v);return(0,n.ZB)(S,"invalid media file"),{draftId:c,videos:[{id:h,sourcePlatform:u.sourcePlatform,materialId:u.id,materialName:u.materialName,path:u.path,originalPath:u.path,isMutable:!0,width:S.width,height:S.height,rotation:S.rotation,mediaType:S.type,duration:S.duration,crop:_,sourceStart:m,volume:f,initialSpeed:null!==(d=e.cutSame.segmentId2initialSpeed[p])&&void 0!==d?d:1}]}}let k=(e,t)=>{let i;let{type:r}=e;if(r===o.r.Photo)i=e.dragSource.format;else if(r===o.r.Video){var a;i=null===(a=e.dragSource.originVideo)||void 0===a?void 0:a.format}else r===o.r.UserPhoto?i=e.dragSource.subType:r===o.r.UserVideo&&(i=e.dragSource.subType);return(0,s.bf)({id:t.id,type:"mutable"},{dragSourceType:r,fileType:i},t)},x={[l.zl.ORIGINAL]:{numberValue:0,strValue:"original"},[l.zl.RATIO_9_16]:{numberValue:1,strValue:"9:16"},[l.zl.RATIO_16_9]:{numberValue:2,strValue:"16:9"},[l.zl.RATIO_1_1]:{numberValue:3,strValue:"1:1"},[l.zl.RATIO_4_3]:{numberValue:4,strValue:"4:3"},[l.zl.RATIO_3_4]:{numberValue:5,strValue:"3:4"},[l.zl.RATIO_2_1]:{numberValue:7,strValue:"2:1"},[l.zl.FREE]:{numberValue:-1,strValue:"free"},[l.zl.MUTABLE_FIXED]:void 0};(0,d.keys)(x).filter(e=>"number"==typeof x[e]);function I(e){var t,i,r,a,n,o;return[...Object.keys(t=e).filter(e=>{var i,r;return(null===(r=t[e])||void 0===r?void 0:null===(i=r.get(c.Sc.Gameplay))||void 0===i?void 0:i.status)===c.xR.Error}),...Object.keys(i=e).filter(e=>{var t,r;return(null===(r=i[e])||void 0===r?void 0:null===(t=r.get(c.Sc.Matting))||void 0===t?void 0:t.status)===c.xR.Error}),...Object.keys(r=e).filter(e=>{var t,i;return(null===(i=r[e])||void 0===i?void 0:null===(t=i.get(c.Sc.Reverse))||void 0===t?void 0:t.status)===c.xR.Error}),...Object.keys(a=e).filter(e=>{var t,i;return(null===(i=a[e])||void 0===i?void 0:null===(t=i.get(c.Sc.Algorithm))||void 0===t?void 0:t.status)===c.xR.Error}),...Object.keys(n=e).filter(e=>{var t,i;return(null===(i=n[e])||void 0===i?void 0:null===(t=i.get(c.Sc.Stable))||void 0===t?void 0:t.status)===c.xR.Error}),...Object.keys(o=e).filter(e=>{var t,i;return(null===(i=o[e])||void 0===i?void 0:null===(t=i.get(c.Sc.Pipeline))||void 0===t?void 0:t.status)===c.xR.Error})]}let P=e=>({babi_param:JSON.stringify({scenario:u.HI.VideoEditor,feature_key:e,feature_entrance:u.zU.Editor,feature_entrance_detail:`${u.zU.Editor}-feature-${e}`})})},171477:function(e,t,i){i.d(t,{l:function(){return F}});var r=i(544633),a=i(426336),n=i(801497),o=i(218571),s=i(108692),l=i(896413),d=i(820193),c=i(433140),u=i(230689),h=i(652146),p=i(886475),_=i(29188),m=i(593642),f=i(937802),g=i(208041),v=i(777859),y=i(565508),S=i(550535),w=i(948328),b=i(985395),M=i(860660),T=i(860147),k=i(597623),x=i(209264),I=i(341850),P=i(800788),E=i(127830);async function C(e,t,i,r,a){var n;let{fileMD5:o,workspaceId:s}=a,l=await (0,S.J)({md5s:[o],fromWorkspaceId:s,toWorkspaceId:s,fetchRetryOptions:{delay:500,retryTimes:20},containerService:e});(0,P.Y2)(l.ok,l.msg);let c=null===(n=l.value)||void 0===n?void 0:n[0];t.addToAutoGenerated(c);let u=(0,d.nQ)(r,E._g.UserFile,c.getModel()),h=(0,y.do)(u.value),p=i.ensureManager.ensureMaterial({key:u.value.key,resource:u.value},h);return await p.waitForResourceValueReady(),i.renderManager.resourceRecords.getRecordBySegmentPath(h)}function D(e){var t;let{voice:i,mainDraftService:r,segment:n,path:o,start:s,duration:l,content:d,trackIndex:c}=e,{dataSdk:u}=r,p=(0,h.as)(u,n),f=u.api.batch.batchStart();if(p.length&&u.api.segment.delete({segIds:p.map(e=>e.id)}),u.draftView.getTracksByType(a.pNd.TrackTypeAudio).length>=_.Fb)return!1;let g=c;if(void 0===g){let{trackIndex:e,needToInsert:t}=u.draftView.findTrackIndexToInsert(a.pNd.TrackTypeAudio,s,l);g=e,t&&u.api.track.add({trackIndex:e,track:new a.fQ8({id:(0,m.Rl)(),type:a.pNd.TrackTypeAudio,flag:a.w9k.FlagNone})})}return!!g&&(u.api.audio.add({trackId:u.draftView.getAllTracks()[g].id,segmentId:(0,m.Rl)(),duration:l,audioPath:o,audioTitle:d,type:a.cVg.MetaTypeTextToAudio,startTime:s,text:{textSegmentId:n.id,shouldReplace:!0,resourceId:i.resourceId,toneType:i.speakerId,toneSpeaker:i.voiceName,toneEffectId:i.effectId,toneEffectName:i.effectName,speed:1,replaceAudioSegmentIds:[],toneCategoryId:"",toneCategoryName:"",tonePlatform:i.tonePlatform,isAiCloneTone:null!==(t=i.isCloneVoice)&&void 0!==t&&t}}),u.api.batch.batchEnd(f),!0)}function F(e,t){var i;let d=(0,f.G)(s.n),_=(0,f.G)(l.a),m=(0,f.G)(w.D),y=(0,f.G)(k.lT),S=(0,f.G)(c.c),P=(0,f.G)(u.t),E=(0,f.G)(I.k),[F,A]=(0,o.useState)(""),R=(0,o.useRef)(),j=(0,o.useRef)(new g.A),O=(0,o.useRef)(()=>{});let B=(i=e)?(0,M.p8)(i):{material_category:"",material_id:"",material_name:"",material_type:"",track_category:"",text_type:""},V="text_template"===B.text_type,N="text_template"===B.text_type?t.getSelectedSegmentChildIndex():void 0,U=N&&N>=0?1:0,L=V?t.getSelectedSegmentChildIndex():void 0,W=(0,r.default)((t,i)=>{var r,a,n;j.current.cancel(),null===(r=O.current)||void 0===r||r.call(O),A(""),R.current=void 0,(0,b.h)(P,{status:b.T.Cancel,applyToAll:i?1:0,applyToLocal:U,textLen:null===(n=e.material)||void 0===n?void 0:null===(a=n.text)||void 0===a?void 0:a.length,textSection:L,textType:(0,T.RK)(e),tone:t.effectName,toneId:t.effectId,autoUpdate:e.material.ttsAutoUpdate?1:0,ttsType:t.isCloneVoice?"my_voice":"public"})}),Z=(0,r.default)(async(t,i,r,a)=>{var o,s,l,c,u,f;if((0,h.md)(i)){y.normal(n.ZP.t("web_tts_toast_empty_text",{},"Can\u2019t generate speech. Enter some words and try again."),{style:(0,x.s)()});return}R.current&&W(R.current),A(t.resourceId),R.current=t;let w=!1;j.current=new g.A,O.current=(0,v.A)({onCancel:()=>{W(t),w=!0},notificationService:y,process:99});let{token:M}=j.current,[k,F]=(await (0,p.ql)(E,{workspaceId:d.draftWorkspaceManager.workspaceId,scene:I.KC.VideoEditor,content:i,speaker:t.speakerId,tonePlatform:t.tonePlatform,audioConfig:t.audioOptions})).pair();if(w||M.isCancellationRequested)return!1;if(k)return null===(c=O.current)||void 0===c||c.call(O),(0,b.h)(P,{status:b.T.Fail,applyToAll:0,applyToLocal:U,textLen:null===(f=e.material)||void 0===f?void 0:null===(u=f.text)||void 0===u?void 0:u.length,textSection:L,textType:(0,T.RK)(e),errorCode:String(k.code),tone:t.effectName,toneId:t.effectId,autoUpdate:e.material.ttsAutoUpdate?1:0,ttsType:t.isCloneVoice?"my_voice":"public"}),A(""),R.current=void 0,!1;let B=await C(P,m,_,S,{fileMD5:F.md5,workspaceId:d.draftWorkspaceManager.workspaceId});return D({voice:t,mainDraftService:d,segment:e,path:B.segmentPath,start:r,duration:F.durationUs,content:i,trackIndex:a})?y.success(n.ZP.t("text_reading_completed",{},"\u6587\u672C\u6717\u8BFB\u5B8C\u6210"),{style:(0,x.s)()}):y.normal(n.ZP.t("audio_track_is_full_and_cannot_be_added_to_target_location",{},"\u97F3\u9891\u8F68\u9053\u5DF2\u6EE1\uFF0C\u65E0\u6CD5\u6DFB\u52A0\u5230\u76EE\u6807\u4F4D\u7F6E"),{style:(0,x.s)()}),A(""),R.current=void 0,null===(o=O.current)||void 0===o||o.call(O),(0,b.h)(P,{status:b.T.Success,applyToAll:0,applyToLocal:U,textLen:null===(l=e.material)||void 0===l?void 0:null===(s=l.text)||void 0===s?void 0:s.length,textSection:L,textType:(0,T.RK)(e),tone:t.effectName,toneId:t.effectId,autoUpdate:e.material.ttsAutoUpdate?1:0,applyTime:F.durationMs,ttsType:t.isCloneVoice?"my_voice":"public"}),!0}),H=(0,r.default)(async t=>{var i;let r=[],o=[];for(let t of d.dataSdk.draftView.getAllTracks().filter(e=>e.type===a.pNd.TrackTypeText))t.segments.forEach(t=>{t.material.type===e.material.type&&r.push(t)});if(0===r.length)return;r.sort((e,t)=>a.pMA.div(e.targetTimerange.start-t.targetTimerange.start,1e6,"number"));let s=!1,l=0,c=!1;for(let e of(O.current=(0,v.A)({onCancel:()=>{c=!0,W(t,!0)},process:99,notificationService:y}),r)){let i=(0,h.k2)(e);if((0,h.md)(i)){l++;continue}let[r,a]=(await (0,p.ql)(E,{workspaceId:d.draftWorkspaceManager.workspaceId,scene:I.KC.VideoEditor,content:i,speaker:t.speakerId,tonePlatform:t.tonePlatform,audioConfig:t.audioOptions})).pair();if(c)return;if(r){l++,(0,b.h)(P,{status:b.T.Fail,applyToAll:1,applyToLocal:U,textLen:i.length,textSection:L,textType:(0,T.RK)(e),errorCode:String(r.code),tone:t.effectName,toneId:t.effectId,autoUpdate:e.material.ttsAutoUpdate?1:0,ttsType:t.isCloneVoice?"my_voice":"public"});continue}let n=(0,h.as)(d.dataSdk,e),{start:u}=e.targetTimerange;n.length&&({start:u}=n[0].targetTimerange);let f=await C(P,m,_,S,{fileMD5:a.md5,workspaceId:d.draftWorkspaceManager.workspaceId});if(D({voice:t,mainDraftService:d,segment:e,path:f.segmentPath,start:u,duration:a.durationUs,content:i})?o.push(e):(l++,s=!0),j.current.token.isCancellationRequested)break;(0,b.h)(P,{status:b.T.Success,applyToAll:1,applyToLocal:U,textLen:i.length,textSection:L,textType:(0,T.RK)(e),tone:t.effectName,toneId:t.effectId,autoUpdate:e.material.ttsAutoUpdate?1:0,applyTime:a.durationMs,ttsType:t.isCloneVoice?"my_voice":"public"})}return s&&y.normal(n.ZP.t("text_to_speech_apply_all_fail_toast",{},"\u97F3\u9891\u8F68\u9053\u8D85\u8FC7\u4E0A\u9650\uFF0C\u90E8\u5206\u7247\u6BB5\u751F\u6210\u5931\u8D25"),{style:(0,x.s)()}),l<r.length?y.success(n.ZP.t("text_reading_completed",{},"\u6587\u672C\u6717\u8BFB\u5B8C\u6210"),{style:(0,x.s)()}):y.normal(n.ZP.t("text_reading_failed_please_try_again",{},"\u6587\u672C\u6717\u8BFB\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),{style:(0,x.s)()}),null===(i=O.current)||void 0===i||i.call(O),o});return{applySpeech:Z,speechLoadingResourceId:F,cancelApplySpeech:W,applySpeechToAll:H}}},886475:function(e,t,i){i.d(t,{Mo:function(){return f},ce:function(){return v},jQ:function(){return m},ql:function(){return y}});var r=i(426336),a=i(690613),n=i(197238),o=i(475590),s=i(151251),l=i(127830),d=i(702049),c=i(492795),u=i(254336),h=i(820193),p=i(109450),_=i(341850);function m(e,t,i,r,n,o,l){let c=d._L.getVar("tts_domain"),u=`${"/"===c?"":c}/internal/api/v1/ws`;return new Promise(d=>{e.start({url:u,text:t,speaker:i,audioOptions:null!=o?o:{},tonePlatform:r,extra:l}),e.onError(e=>{d(e)}),e.onSuccess((e,t)=>{let{ext:i}=(0,s.UO)(u);d((0,a.oW)({name:null!=n?n:"",type:"audio/mpeg",ext:i,buffer:e,url:t}))})})}async function f(e){let{data:t,renderManager:i,uploadMaterialFromLocalMixinManager:a,draftMaterialsService:s,mainDraftService:d,resourceService:c,mainEditorWidgetService:_,bussinessMeta:m,uploadFlag:f,autoPromote:g,waitForReady:v,containerService:y}=e,{name:S,type:w,buffer:b}=t,M=`${S}`,T=`text_to_audio/${M}`,k=r.hPV.toAbsolutePath(T),x=await b.arrayBuffer();i.fs.writeFileSync(k,x);let I=await i.getMediaFileInfo(k,"");if(!(null==I?void 0:I.duration)||I.duration<=0)throw Error("generate tts duration invalid");i.recordResource({segmentPath:T,resPath:k});let P=new File([b],M,{type:w}),E=await a.upload({files:[P],dataDelta:[{key:S}],uploadParams:{skipTranscode:!0,bussinessMeta:m,uploadFlag:f,autoPromote:g,retry:{times:3}}});if(!E[0].ok)throw Error("generate tts upload task failure");let C=E[0].value;y&&(0,p.f)(y,C,{scenario:u.cn.EDIT,featureKey:"tts_algorithm_upload",featureEntrance:u.oH.EDITOR,featureEntranceDetail:`${u.oH.EDITOR}-tts_algorithm_upload`}),s.addToAutoGenerated(C);let D=(0,h.nQ)(c,l._g.UserFile,C.getModel()),F=_.ensureManager.ensureMaterial({key:D.value.key,resource:D.value},T,{metaTimeout:6e4}),A=await (0,o.Hp)(()=>new Promise((e,t)=>{C.onDidUpload(e),C.onUploadFailure(e=>{t(e)})}),6e4);if(!A.ok)throw Error(A.code===n.pY.TimedOut?"tts upload timeout":A.msg);return v&&await F.waitForResourceValueReady(),{path:T,mediaInfo:I,material:C}}function g(e){return e===c.x$.ElevenLabs?_.tz.ElevenLabs:e===c.x$.Microsoft?_.tz.Azure:_.tz.Sami}function v(e,t){let{content:i,speaker:r,tonePlatform:a,audioConfig:n}=t;return e.getAudition({text:i,speaker:r,platform:g(a),emotion:null==n?void 0:n.emotion,audioConfig:{speechRate:null==n?void 0:n.speech_rate,pitchRate:null==n?void 0:n.pitch_rate}})}function y(e,t){return new Promise(async i=>{let{workspaceId:r,scene:n,content:o,speaker:s,tonePlatform:l,audioConfig:d}=t,[c,u]=(await e.createSmartTask({workspaceId:r,scene:n,text:o,speaker:s,platform:g(l),audioConfig:{speechRate:null==d?void 0:d.speech_rate,pitchRate:null==d?void 0:d.pitch_rate,emotion:null==d?void 0:d.emotion},disableCaption:!0})).pair();if(c){i(c);return}u.onSuccess(e=>{var t,r;let{taskDetails:n,speed:o}=e,s=n.find(e=>e.resourceType===_.qb.TTSAudio);if(!s||100!==o){i((0,a.wf)(100001,"production exception"));return}i((0,a.oW)({md5:s.md5,size:Number(s.size||0),assertId:s.vid,durationMs:null!==(t=s.duration)&&void 0!==t?t:0,durationUs:s.duration?1000n*BigInt(null!==(r=s.duration)&&void 0!==r?r:0):0n}))})})}}}]);