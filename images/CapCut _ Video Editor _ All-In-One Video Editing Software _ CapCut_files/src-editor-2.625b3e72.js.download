"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["3115"],{58339:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"cursor-hd-icon":"cursor-hd-icon-nvKTnd",cursorHdIcon:"cursor-hd-icon-nvKTnd","icon-bg":"icon-bg-i7rKhv",iconBg:"icon-bg-i7rKhv","icon-border":"icon-border-jNUtAJ",iconBorder:"icon-border-jNUtAJ",dragging:"dragging-KqL9wr",adsorb:"adsorb-QNWDlE"}},897114:function(e,t,i){i.d(t,{Z:function(){return a}});let a={cover:"cover-YGFoTo","cover-wrapper":"cover-wrapper-kvyK9F",coverWrapper:"cover-wrapper-kvyK9F","cover-preview":"cover-preview-NoSSRr",coverPreview:"cover-preview-NoSSRr","cover-duration":"cover-duration-YuxsU_",coverDuration:"cover-duration-YuxsU_","cover-trigger":"cover-trigger-jPOS80",coverTrigger:"cover-trigger-jPOS80","cover-icon":"cover-icon-EMbTF2",coverIcon:"cover-icon-EMbTF2"}},479967:function(){},848218:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-rWCXCo",entryContainer:"entry-container-rWCXCo","view-box":"view-box-YGM4nW",viewBox:"view-box-YGM4nW",initializing:"initializing-I35U8M",hidden:"hidden-DMQoRs","hide-search-bar":"hide-search-bar-przf5W",hideSearchBar:"hide-search-bar-przf5W","scroll-container":"scroll-container-z2ov45",scrollContainer:"scroll-container-z2ov45","search-bar":"search-bar-sjcq8z",searchBar:"search-bar-sjcq8z","main-content":"main-content-uH7EmC",mainContent:"main-content-uH7EmC","favorite-header":"favorite-header-s801nG",favoriteHeader:"favorite-header-s801nG","back-btn":"back-btn-TUulrn",backBtn:"back-btn-TUulrn"}},962777:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px",hide:"hide-Lcf3Cq","entry-container":"entry-container-I9uJ3Z",entryContainer:"entry-container-I9uJ3Z",initializing:"initializing-wSireQ","tags-wrapper":"tags-wrapper-gBJN6N",tagsWrapper:"tags-wrapper-gBJN6N",tags:"tags-I0K9eP","view-box-wrapper":"view-box-wrapper-ZEKSLj",viewBoxWrapper:"view-box-wrapper-ZEKSLj","view-box":"view-box-xS5DcD",viewBox:"view-box-xS5DcD",hidden:"hidden-ozDkD1","scroll-container":"scroll-container-AFIVS_",scrollContainer:"scroll-container-AFIVS_","view-box-category":"view-box-category-qToX8m",viewBoxCategory:"view-box-category-qToX8m",active_category:"active_category-Ac3Dl_",activeCategory:"active_category-Ac3Dl_",active_category_back_btn_wrap:"active_category_back_btn_wrap-RkOf09",activeCategoryBackBtnWrap:"active_category_back_btn_wrap-RkOf09",active_category_content:"active_category_content-tAPnEG",activeCategoryContent:"active_category_content-tAPnEG",active_category_back_btn:"active_category_back_btn-nDsljM",activeCategoryBackBtn:"active_category_back_btn-nDsljM"}},433336:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-oAj9Cs",entryContainer:"entry-container-oAj9Cs",initializing:"initializing-TLOb4n",commercial_filter:"commercial_filter-k9lEhZ",commercialFilter:"commercial_filter-k9lEhZ","tags-wrapper":"tags-wrapper-fMnSnu",tagsWrapper:"tags-wrapper-fMnSnu","tags-wrapper-inner":"tags-wrapper-inner-Q_Og54",tagsWrapperInner:"tags-wrapper-inner-Q_Og54",tags:"tags-JlLBJr",collapsed:"collapsed-eMHdOo","filter-select":"filter-select-wtUnha",filterSelect:"filter-select-wtUnha","favorite-bar":"favorite-bar-rdsfAy",favoriteBar:"favorite-bar-rdsfAy","view-box-wrapper":"view-box-wrapper-Qb00Qo",viewBoxWrapper:"view-box-wrapper-Qb00Qo","view-box":"view-box-fiqYov",viewBox:"view-box-fiqYov",hidden:"hidden-mobcpN","fav-bar":"fav-bar-TS2JqO",favBar:"fav-bar-TS2JqO","scroll-container":"scroll-container-IfPvtx",scrollContainer:"scroll-container-IfPvtx","view-box-category":"view-box-category-OA3h1V",viewBoxCategory:"view-box-category-OA3h1V","favorite-header":"favorite-header-DZaeEA",favoriteHeader:"favorite-header-DZaeEA","back-btn":"back-btn-FnKTEu",backBtn:"back-btn-FnKTEu",text_basic_in_poly:"text_basic_in_poly-wCooPv",textBasicInPoly:"text_basic_in_poly-wCooPv"}},330186:function(){},347600:function(){},141157:function(){},603124:function(){},628545:function(){},795883:function(){},313820:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"manager-container":"manager-container-HB1UHj",managerContainer:"manager-container-HB1UHj"}},178244:function(e,t,i){i.d(t,{Z:function(){return a}});let a=()=>{}},53230:function(e,t,i){i.d(t,{Z:function(){return d}});var a=i(789786),r=i(801497),n=i(841616),o=i(230689),s=i(21961),l=i(339098);class d{async extractAudioAndUpload(e){let t=await (0,n.w)({...e,containerService:this._containerService,payinPayoutHelper:this._options.payinPayoutHelper,fastImportAnalyzeHelper:this._options.fastImportHelper}),i=!1;if(t.forEach(t=>{if(!t.ok){i=!0;return}this._options.onCreated({directoryNodeType:s.t.File,material:t.value,...e})}),i){var a;null===(a=this._notificationService)||void 0===a||a.error(r.ZP.t("transcoding_failed",{},"\u8F6C\u7801\u5931\u8D25"))}return t}constructor(e,t){this._options=e,this._containerService=t,this._notificationService=(0,l.O)(this._containerService,e.notificationGenerator)}}d=(0,a.gn)([(0,a.fM)(1,o.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IExtractAudioAndUploadMaterialParams?Object:IExtractAudioAndUploadMaterialParams,void 0===o.t?Object:o.t])],d)},607509:function(e,t,i){i.d(t,{N:function(){return y}});var a=i(789786),r=i(967750),n=i(800788),o=i(250851),s=i(273238),l=i(230689),d=i(966697),c=i(200247),u=i(801497),h=i(639605),p=i(260963),_=i(956580),g=i(658096),f=i.n(g),m=i(339098);let v=f().generate();class y{getUploadLink(e){return this._observableData.linkByWorkspaceId[e]}async registerUploadLink(e){var t,i,a;let{workspaceId:r}=e;if(!this._accountService.hasLogin){this._accountService.login({reportParams:{pageEnterFrom:d.d.FromPhone}});return}if((0,n.ZB)(r,"un expect undefined for workspaceId when login"),(null===(t=this._observableData.linkByWorkspaceId[r])||void 0===t?void 0:t.initializing)||(null===(i=this._observableData.linkByWorkspaceId[r])||void 0===i?void 0:i.link)){Object.values(h.d0).forEach(e=>{!this._observableData.linkByWorkspaceId[r].dataMap[e]&&(this._observableData.linkByWorkspaceId[r].dataMap[e]={uploadFileCount:0})});return}(0,p.z)(()=>{this._observableData.linkByWorkspaceId[r]={initializing:!0,initializeFailure:!1,link:"",dataMap:{[e.uploadFrom]:{uploadFileCount:0}}}});let o=this._uploadLinkService.getRegisteredUploadLink(r);if(o.ok){(0,p.z)(()=>{var t;this._observableData.linkByWorkspaceId[r]={initializing:!1,initializeFailure:!1,link:(null!==(t=o.value.url)&&void 0!==t?t:"").replace("www.capcut.com",location.host),dataMap:{[e.uploadFrom]:{uploadFileCount:0}}}});return}let s=await this._uploadLinkService.registerUploadLink({workspaceId:r});if(!s.ok){(0,p.z)(()=>{this._observableData.linkByWorkspaceId[r]={initializing:!1,initializeFailure:!0,link:"",dataMap:{[e.uploadFrom]:{uploadFileCount:0}}}}),null===(a=this._notificationService)||void 0===a||a.error(u.ZP.t("web_graphic_request_failure_tips",{},"Something went wrong. Try again later."));return}(0,p.z)(()=>{var t;this._observableData.linkByWorkspaceId[r]={initializing:!1,initializeFailure:!1,link:(null!==(t=s.value.url)&&void 0!==t?t:"").replace("www.capcut.com",location.host),dataMap:{[e.uploadFrom]:{uploadFileCount:0}}}})}constructor(e,t,i,a,n){this._options=e,this._uploadLinkService=t,this._accountService=a,this._containerService=n,this._observableData=(0,p.LO)({linkByWorkspaceId:{}}),this.messageId=v,this._longLinkManager=this._containerService.createInstance(_.V),this._longLinkManager.onDidUpload(async e=>{let{workspaceId:t,newUploadMaterialIds:i,uploadedCount:a,uploadFrom:n}=e;if(!this._observableData.linkByWorkspaceId[t])return;(0,p.z)(()=>{this._observableData.linkByWorkspaceId[t].dataMap[n].uploadFileCount=a});let o=await (0,r.x)({assetIds:i,fromWorkspaceId:t,toWorkspaceId:t,containerService:this._containerService});if(!o.ok){var s;null===(s=this._notificationService)||void 0===s||s.error(u.ZP.t("web_text_edit_title_disconnected",{},"Something went wrong."));return}o.value.forEach(e=>{var i,a;null===(i=(a=this._options).onCreated)||void 0===i||i.call(a,{material:e,fromWorkspaceId:t})})}),this._uploadLinkService.onDidLinkUpdate(e=>{if(!!this._observableData.linkByWorkspaceId[e])(0,p.z)(()=>{let t=this._uploadLinkService.getRegisteredUploadLink(e);t.ok&&(this._observableData.linkByWorkspaceId[e].link=t.value.url)})}),this._notificationService=(0,m.O)(this._containerService,e.notificationGenerator)}}y=(0,a.gn)([(0,a.fM)(1,o.r),(0,a.fM)(2,s.b),(0,a.fM)(3,c.D),(0,a.fM)(4,l.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUploadMaterialFromLink?Object:IUploadMaterialFromLink,void 0===o.r?Object:o.r,void 0===s.b?Object:s.b,void 0===c.D?Object:c.D,void 0===l.t?Object:l.t])],y)},205921:function(e,t,i){i.d(t,{D:function(){return d}});var a=i(789786),r=i(801497),n=i(230689),o=i(533112),s=i(21961),l=i(339098);class d{async upload(e){let t=await (0,o.B)({...e,fastImportAnalyzeHelper:this._options.fastImportHelper,payinPayoutHelper:this._options.payinPayoutHelper,containerService:this._containerService}),i=!1;if(t.forEach(t=>{if(!t.ok){i=!0;return}this._options.onCreated({directoryNodeType:s.t.File,material:t.value,...e})}),i){var a;null===(a=this._notificationService)||void 0===a||a.error(r.ZP.t("transcoding_failed",{},"\u8F6C\u7801\u5931\u8D25"))}return t}constructor(e,t){this._options=e,this._containerService=t,this._notificationService=(0,l.O)(this._containerService,e.notificationGenerator)}}d=(0,a.gn)([(0,a.fM)(1,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVeExtractAudioAndUploadMaterialNoSignParams?Object:IVeExtractAudioAndUploadMaterialNoSignParams,void 0===n.t?Object:n.t])],d)},474572:function(e,t,i){i.d(t,{C:()=>D});var a=i("789786"),r=i("801497"),n=i("230689"),o=i("690613"),s=i("65753"),l=i("173888"),d=i("426020"),c=i("775352"),u=i("273238"),h=i("986824"),p=i("641276"),_=i("800788"),g=i("116528"),f=i("860734"),m=i("495141"),v=i("48824"),y=i("903375");class S extends h.I{get md5(){return this._data.md5}getModel(){var e,t,i;return{...this._data,id:this.id,status:this.status,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidDone:this.onDidDone,onDidRemove:this.onDidRemove,uploading:null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.uploading,preparing:null===(t=this._prepareMaterialLifecycleHelper)||void 0===t?void 0:t.preparing,transcoding:null===(i=this._transcodeMaterialHelper)||void 0===i?void 0:i.transcoding}}canRetryPrepare(){var e,t;return null!==(t=null===(e=this._prepareMaterialLifecycleHelper)||void 0===e?void 0:e.canRetryPrepare())&&void 0!==t&&t}prepare(){var e;null===(e=this._prepareMaterialLifecycleHelper)||void 0===e||e.prepare()}canRetryUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canRetryUpload())&&void 0!==t&&t}upload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.upload()}changeUploadWorkspace(e){var t;if(!(0,y.p)(this))this._updateFromWorkspaceId(e),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.updateFromWorkspaceId(e)}canCancelUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canCancelUpload())&&void 0!==t&&t}cancelUpload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.cancelUpload(),super.cancelUpload()}canRetryTranscode(){var e,t;return null!==(t=null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.canRetryTranscode())&&void 0!==t&&t}transcode(){return(0,_.Y2)(this._transcodeMaterialHelper,"helper not found"),this._transcodeMaterialHelper.transcode()}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}sync2UserMaterial(){this._triggerSyncMaterialFromWorkspaceHelper(),this._syncFromWorkspaceHelper.sync2UserMaterial()}cancelSync2UserMaterial(){this.status===l.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}async delete(e){try{return!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]}),await super.delete(),(0,o.ly)()}catch(e){var t;return(0,o.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}get _needPrepare(){return!!this._prepareMaterialLifecycleHelper}_initUploadMaterialLifecycleHelper(e){var t;let{file:i}=e;this._uploadMaterialLifecycleHelper=new v.x({file:i,fromWorkspaceId:this.fromWorkspaceId,userMaterialUploadService:this._userMaterialUploadService,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,fastImportAnalyzeHelper:this._option.fastImportAnalyzeHelper,notificationService:this._option.notificationService,uploadParams:{uploadFlag:c.m5.Invisible}}),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.bootstrap({handler:{model:()=>this.getModel(),status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},onCancelUpload:()=>{this._onDidCancelUpload.fire()},updateStatus:this._updateStatus.bind(this),updateModel:e=>{this._partialUpdateModel(e)}},events:{onSuccess:this.onDidUpload,onError:this.onUploadFailure}})}_bindListenerWithLifecycle(){this._needPrepare&&(0,p.V)(this.onDidPrepare)(()=>{Promise.resolve().then(()=>{var e,t,i;if(this.hasBeenRemoved)return;let a=null===(e=this._prepareMaterialLifecycleHelper)||void 0===e?void 0:e.result;(0,_.ZB)(null==a?void 0:a.buffer);let r=new File([new Blob([null==a?void 0:a.buffer],{type:"audio/m4a"})],null!==(i=null==a?void 0:a.fileName)&&void 0!==i?i:"undefined.m4a",{type:"audio/m4a"});this._initUploadMaterialLifecycleHelper({file:r}),this._updateStatus(l.a.WaitingUpload),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.upload()})}),(0,p.V)(this.onDidUpload)(()=>{Promise.resolve().then(()=>{var e;if(null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.dispose(),!this.hasBeenRemoved)this._data.fileType===d.YB.Image?this._transcodeMaterialHelper=new g.Y({assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}):[d.YB.Audio,d.YB.Video].includes(this._data.fileType)?this._transcodeMaterialHelper=new f.D({assetId:this._data.assetId,fileType:this._data.fileType,fromWorkspaceId:this.fromWorkspaceId,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}):(0,_.ss)("unexpected logic"),this._updateStatus(l.a.Transcoding),this._transcodeMaterialHelper.listenTranscodeResult()})}),(0,p.V)(this.onDidTranscode)(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved){if(void 0===this.toWorkspaceId||this.fromWorkspaceId===this.toWorkspaceId){this._updateStatus(l.a.Success);return}this.sync2UserMaterial()}})}),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._updateStatus(l.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){(0,_.ZB)(this.toWorkspaceId),this._syncFromWorkspaceHelper=this._containerService.createInstance(m.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._option.notificationService})}_partialUpdateModel(e){this._data.key&&delete e.key,Object.assign(this._data,e),this._fireModelUpdate()}constructor(e,t,i,a){var r;super({fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,fromFolderId:e.fromFolderId,toFolderId:e.toFolderId,addModelToDraft:e.addModelToDraft,notificationService:e.notificationService}),this._option=e,this._userMaterialsService=t,this._userMaterialUploadService=i,this._containerService=a,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let n=this._option;this._data=n.data,this._prepareMaterialLifecycleHelper=n.prepareMaterialLifecycleHelper,null===(r=this._prepareMaterialLifecycleHelper)||void 0===r||r.bootstrap({handler:{status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},updateStatus:this._updateStatus.bind(this)},events:{onSuccess:this.onDidPrepare,onError:this.onPrepareFailure}}),setTimeout(()=>{var t;null===(t=this._prepareMaterialLifecycleHelper)||void 0===t||t.prepare(e.decryptKey)}),this._bindListenerWithLifecycle()}}S=(0,a.gn)([(0,a.fM)(1,u.b),(0,a.fM)(2,c.ec),(0,a.fM)(3,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVeExtractAudioAndUploadMaterialLifecycle?Object:IVeExtractAudioAndUploadMaterialLifecycle,void 0===u.b?Object:u.b,void 0===c.ec?Object:c.ec,void 0===n.t?Object:n.t])],S);var k=i("127830"),w=i("137348"),M=i("599735"),b=i("339098");async function T(e){try{let t=(0,b.O)(e.containerService,e.notificationGenerator),i=Promise.all(e.files.map(i=>(0,o.oW)(e.containerService.createInstance(S,{fromWorkspaceId:e.fromWorkspaceId,decryptKey:e.decryptKey,toWorkspaceId:e.toWorkspaceId,data:{sourceType:d.ov.EverCloud,assetType:k.pS.Material,key:"",filename:(0,w.F)({name:i.name,format:"m4a"}),fileType:d.YB.Audio,owner:"",md5:"",mime:"audio/m4a",duration:0,isAudioTranscoding:!1,size:i.size,createdAt:Date.now().valueOf(),updatedAt:Date.now().valueOf()},addModelToDraft:(0,M.s)(e.containerService),fastImportAnalyzeHelper:e.fastImportAnalyzeHelper,prepareMaterialLifecycleHelper:new s.s({file:i}),payinPayoutHelper:e.payinPayoutHelper,notificationService:t}))));return await i}catch(e){return[(0,o.wf)(-1,null==e?void 0:e.message)]}}var I=i("21961");class D{async extractAudioAndUpload(e){let t=await T({...e,containerService:this._containerService,payinPayoutHelper:this._options.payinPayoutHelper,fastImportAnalyzeHelper:this._options.fastImportHelper}),i=!1;if(t.forEach(t=>{if(!t.ok){i=!0;return}this._options.onCreated({directoryNodeType:I.t.File,material:t.value,...e})}),i){var a;null===(a=this._notificationService)||void 0===a||a.error(r.ZP.t("transcoding_failed",{},"\u8F6C\u7801\u5931\u8D25"))}return t}constructor(e,t){this._options=e,this._containerService=t,this._notificationService=(0,b.O)(this._containerService,e.notificationGenerator)}}D=(0,a.gn)([(0,a.fM)(1,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVeExtractAudioAndUploadMaterialParams?Object:IVeExtractAudioAndUploadMaterialParams,void 0===n.t?Object:n.t])],D)},115618:function(e,t,i){i.d(t,{F:function(){return r}});var a=i(173888);function r(e){return[a.a.PrepareFailure,a.a.Prepared,a.a.Preparing,a.a.UploadFailure,a.a.Uploading,a.a.WaitingUpload].includes(e)}},21078:function(e,t,i){i.d(t,{B:function(){return a}});function a(e){return Object.entries(e).map(e=>{let[t,i]=e;return null==i?"":`${t}=${i}`}).filter(Boolean).join("&")}},21961:function(e,t,i){i.d(t,{O:function(){return n},t:function(){return o}});var a,r,n=((a={}).Beginning="beginning",a.End="end",a);var o=((r={}).File="file",r.Folder="folder",r)},204676:function(e,t,i){i.d(t,{s:function(){return s}});var a=i(800788),r=i(21961);class n{constructor({id:e,data:t,path:i}){this.id=e,this.type=r.t.File,this.data=t,this.parent=null,this.path=i}}class o{constructor({id:e,data:t,path:i}){this.id=e,this.type=r.t.Folder,this.data=t,this.children=[],this.parent=null,this.path=i}}class s{batchAddNodes(e,t){e.forEach(e=>{e.type===r.t.File?this.createFile(e.path,e.data,t):e.type===r.t.Folder&&this.createFolder(e.path,e.data,t)})}createFile(e,t,i){var o;let s;this._assertPath(e),(0,a.Y2)(t);let l=null!==(o=null==i?void 0:i.insertPosition)&&void 0!==o?o:r.O.End,d=e.slice(0,e.length-1);(null==i?void 0:i.createFolderOnPathIfNotExist)?s=this._getOrCreateFolderByPath(d):(s=this.getFolderByPath(d),(0,a.ZB)(s,`The parent folder(path: ${d}) of file (id: ${e.join("/")}) does not exist.`));let c=new n({id:e[e.length-1],data:t,path:e});c.parent=s,l===r.O.End?s.children.push(c):s.children.unshift(c)}createFolder(e,t,i){var n;let s;this._assertPath(e),(0,a.ZB)(t);let l=null!==(n=null==i?void 0:i.insertPosition)&&void 0!==n?n:r.O.End,d=e.slice(0,e.length-1);(null==i?void 0:i.createFolderOnPathIfNotExist)?s=this._getOrCreateFolderByPath(d):(s=this.getFolderByPath(d),(0,a.ZB)(s,`The parent folder(path: ${d}) of file (id: ${e.join("/")}) does not exist.`));let c=new o({id:e[e.length-1],data:t,path:e});c.parent=s,l===r.O.End?s.children.push(c):s.children.unshift(c)}delete(e){var t;this._assertPath(e);let i=null!==(t=this.getFileByPath(e))&&void 0!==t?t:this.getFolderByPath(e);(0,a.Y2)(i,`File or folder ${e.join("/")} not found.`),(0,a.Y2)(i!==this.root,"Cannot delete the root directory.");let r=i.parent,n=r.children.indexOf(i);r.children.splice(n,1)}getFileById(e){(0,a.Y2)(e);let t=this.searchFiles(t=>t.id===e);return(t.length>1&&(0,a.Y2)(`There are multiple files with id ${e}.`),1===t.length)?t[0]:null}getFolderById(e){(0,a.Y2)(e);let t=this.searchFolders(t=>t.id===e);return(t.length>1&&(0,a.Y2)(`There are multiple folders with id ${e}.`),1===t.length)?t[0]:null}getFolderByPath(e){if(this._assertPath(e),!e.length)return null;let t=this._head;for(let i of e){let e=t.children.find(e=>e.id===i&&e.type===r.t.Folder);if(!e)return null;t=e}return t}getFileByPath(e){this._assertPath(e);let t=[...e],i=t.pop(),a=this.getFolderByPath(t);return null==a?void 0:a.children.find(e=>e.id===i&&e.type===r.t.File)}print(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root,i=arguments.length>1?arguments[1]:void 0,a=null!==(e=null==i?void 0:i.indent)&&void 0!==e?e:"",n=null==i?void 0:i.formatter;if(console.log(a+(t.type===r.t.File?"%c\u300CFile\u300D ":"%c\u300CFolder\u300D"),t.type===r.t.File?"font-size:13px; background:pink; color:#bf2c9f;":"font-size:13px; background:#FBCEB1; color:#FF5F1F;",n?n(t):t.id,t.data),t.type===r.t.Folder)for(let e of t.children)e.type===r.t.Folder?this.print(e,{indent:`${a}    `,formatter:n}):console.log(`${a}    ${e.type===r.t.File?"%c\u300CFile\u300D ":"%c\u300CFolder\u300D"}`,e.type===r.t.File?"font-size:13px; background:pink; color:#bf2c9f;":"font-size:13px; background:#FBCEB1; color:#FF5F1F;",`${n?n(e):e.id}`,e.data)}searchFiles(e){return this._searchNodes(t=>t.type===r.t.File&&e(t))}searchFolders(e){return this._searchNodes(t=>t.type===r.t.Folder&&e(t))}syncPreorderTraversal(e,t){let i=e=>{if(t(e),e.type===r.t.Folder)for(let t of e.children)i(t)};i(e)}syncPostorderTraversal(e,t){let i=e=>{if(e.type===r.t.Folder)for(let t of e.children)i(t);t(e)};i(e)}async asyncPreorderTraversal(e,t){let i=async e=>{if(await t(e),e.type===r.t.Folder)for(let t of e.children)i(t)};await i(e)}async asyncPostorderTraversal(e,t){let i=async e=>{if(e.type===r.t.Folder)for(let t of e.children)await i(t);await t(e)};await i(e)}updateFolder(e,t){this._assertPath(e);let i=this.getFolderByPath(e);(0,a.ZB)(i,`Update failed: The folder with the path of ${e} cannot be found.`),i.data=t}updateFile(e,t){this._assertPath(e);let i=this.getFileByPath(e);(0,a.ZB)(i,`Update failed: The file with the path of ${e} cannot be found.`),i.data=t}_searchNodes(e){let t=[];return this.syncPreorderTraversal(this.root,i=>{e(i)&&t.push(i)}),t}_getOrCreateFolderByPath(e){this._assertPath(e);let t=this._head;for(let i of e){let e=t.children.find(e=>e.type===r.t.Folder&&e.id===i);!e&&((e=new o({id:i,data:null,path:[...t.path,i]})).parent=t,t.children.push(e)),t=e}return t}_assertPath(e){(0,a.Y2)((null==e?void 0:e[0])===this.root.id,`The root path in the path: ${e.join("/")} is incorrect, the correct path is ${this.root.id}.`)}constructor({rootId:e,rootData:t=null}){this.root=new o({id:e,path:[e],data:t}),this._head=new o({id:"head",path:[],data:null}),this._head.children=[this.root]}}},754559:function(e,t,i){i.d(t,{I:function(){return a}});class a{constructor(){this.workspaceIdFromUrl=function(){let{searchParams:e}=new URL(window.location.href);return e.get("workspaceId")}(),this.spaceIdFromUrl=function(){let{searchParams:e}=new URL(window.location.href);return e.get("spaceId")}()}}},575747:function(e,t,i){i.d(t,{n:function(){return s}});var a=i(532611),r=i(127830),n=i(618026),o=i(981632);function s(e){var t;return(0,n.M)((1===(t=e).transcode_status&&!t.tags.includes(7001)&&!(0,a.JI)((0,o.D)(e.meta))&&!(t.preview_url&&Object.values(t.preview_url).filter(e=>!!e).length>0)&&(t.file_type="file"),{...t,assetType:r.pS.Material,file_type:t.file_type,image_async_resize:!1,asset_id:t.asset_id.toString(),owner:t.owner.toString()}))}},201225:function(e,t,i){i.d(t,{T:function(){return p}});var a=i(690613),r=i(387944),n=i(374904),o=i(426020),s=i(127830),l=i(607732),d=i(801497),c=i(948328),u=i(599735),h=i(339098);async function p(e){let t=(0,h.O)(e.containerService,e.notificationGenerator);try{var i,p,_;let h=0;(null===(i=e.checkUploadLimit)||void 0===i?void 0:i.totalSize)&&(h=e.containerService.invokeFunction(e=>e.get(c.D).getMaterials().userGeneratedMaterials.reduce((e,t)=>{var i;return e+(null!==(i=t.size)&&void 0!==i?i:0)},0)));let g="function"==typeof(null===(p=e.checkUploadLimit)||void 0===p?void 0:p.totalSize)?await e.checkUploadLimit.totalSize():null===(_=e.checkUploadLimit)||void 0===_?void 0:_.totalSize,f=Promise.all(e.files.map((i,c)=>{var p,_,f;let m=(null===(p=e.checkUploadLimit)||void 0===p?void 0:p.totalSize)?(0,l.J)(h+i.size,g,{notificationService:t}):(0,a.ly)();if(!m.ok)return m;if(e.acceptTypes&&!(0,n.J5)({file:i,accepts:e.acceptTypes})&&"file"!==i.type||i.size<=0)return!e.acceptTypesErrorTipDisabled&&(null==t||t.error(d.ZP.t("current_import_format_not_supported",{},"\u5F53\u524D\u5BFC\u5165\u683C\u5F0F\u4E0D\u652F\u6301"))),(0,a.wf)(-1,"un support file type");if(i.size<=0)return null==t||t.error(d.ZP.t("web_file_upload_toast_empty_file",{},"Can\u2019t upload empty file")),(0,a.wf)(-1,"invalid file size");let v=(0,l.m)(i.size,null===(_=e.checkUploadLimit)||void 0===_?void 0:_.singleSize,t);if(!v.ok)return v;let y=null===(f=e.dataDelta)||void 0===f?void 0:f[c];return h+=i.size,(0,a.oW)(e.containerService.createInstance(r.J,{fromFolderId:e.fromFolderId,file:i,data:{sourceType:o.ov.PublicSpace,key:"",md5:"",assetType:s.pS.Material,...y,fileType:(0,n.eF)({file:i}),filename:i.name,mime:i.type,size:i.size},autoUpload:e.autoUpload,uploadParams:e.uploadParams,addModelToDraft:(0,u.s)(e.containerService),fastImportAnalyzeHelper:e.fastImportAnalyzeHelper,payinPayoutHelper:e.payinPayoutHelper,captureCoverAndThumbHelper:e.captureCoverAndThumbHelper,notificationService:t}))}));return await f}catch(e){return[(0,a.wf)(-1,null==e?void 0:e.message)]}}},339098:function(e,t,i){i.d(t,{O:function(){return r}});var a=i(597623);function r(e,t){return t?t():e.invokeFunction(e=>e.get(a.lT))}},116528:function(e,t,i){i.d(t,{Y:function(){return h}});var a=i(999268),r=i(641276),n=i(690613),o=i(173888),s=i(426020),l=i(34159),d=i(730182),c=i(848784),u=i(881866);class h{get _assetId(){return this._params.assetId}get _fromWorkspaceId(){return this._params.fromWorkspaceId}get _handler(){return this._params.handler}get onDidTranscode(){return this._params.handler.onDidTranscode}get onTranscodeFailure(){return this._params.handler.onTranscodeFailure}get _updateStatus(){return this._params.handler.updateStatus}get _updateModel(){return this._params.handler.updateModel}get transcoding(){return this._transcoding}canRetryTranscode(){return this._handler.status()===o.a.TranscodeFailure}transcode(){return new Promise(async e=>{if(this._handler.status()===o.a.Transcoding)return e((0,n.wf)(-1,"current material is not transcoding"));try{let e=await this._params.userMaterialService.getEvercloudInstance(this._fromWorkspaceId);await e.triggerImageResize({ids:[this._assetId]}),this.listenTranscodeResult()}catch(t){e((0,n.wf)(-1,null==t?void 0:t.message))}return(0,r.V)(this.onDidTranscode)(()=>e((0,n.ly)())),(0,r.V)(this.onTranscodeFailure)(t=>e(null!=t?t:(0,n.wf)(-1,"unknown"))),(0,n.ly)()})}async listenTranscodeResult(){if(!this._mutex.tryLock())return;this._transcoding={progress:0,onSuccess:this._params.handler.onDidTranscode,error:void 0,onError:this._params.handler.onTranscodeFailure};let e=(0,c.c)(3,{onprogress:e=>{this._transcoding&&(this._transcoding.progress=e,this._params.handler.onProgress(e))}});try{let e=this._assetId,t=await this._params.userMaterialService.getEvercloudInstance(this._fromWorkspaceId),i=await (0,d.X)(e,{userMaterialInstance:t});if((0,u.tF)()&&await (0,u.wO)(),i.ok){let e=await t.getAssets({ids:[this._assetId],material:!1});if(!e||1!==e.length){this._updateStatus(o.a.TranscodeFailure);return}let i=(0,l.V)(null==e?void 0:e[0]);(null==i?void 0:i.fileType)===s.YB.Image?(this._updateModel(i),this._updateStatus(o.a.Transcoded),this._updateStatus(o.a.Success)):this._updateStatus(o.a.TranscodeFailure)}else this._updateStatus(o.a.TranscodeFailure)}finally{this._mutex.unLock(),e()}}constructor(e){this._params=e,this._mutex=new a.L}}},85539:function(e,t,i){i.d(t,{I:function(){return _}});var a=i(999268),r=i(475590),n=i(690613),o=i(745299),s=i(173888),l=i(426020),d=i(801497),c=i(948291),u=i(751217),h=i(795160),p=i(881866);class _{get _updateStatus(){return this._handler.updateStatus}get _updateModel(){return this._handler.updateModel}get _delete(){return this._handler.delete}get uploading(){return this._uploading}get _notificationService(){return this._params.notificationService}bootstrap(e){Object.entries(e.events).forEach(e=>{let[t,i]=e;this._uploading[t]=i}),this._handler=e.handler,this._getFileBlobUrl(this._params.file,this._handler.model().mime),this._analyzeFileInfo(this._params.file),this._generateCoverTrigger()}updateFromWorkspaceId(){}canRetryUpload(){return!!(this._handler.status()===s.a.UploadFailure&&this._params.file)}async upload(){if(!!this._mutex.tryLock()){if(this._handler.status()===s.a.Uploading){this._mutex.unLock();return}this._uploading.error=void 0,this._updateStatus(s.a.Uploading),(0,p.MI)()&&await (0,p.wO)();try{let{file:e}=this._params,t=await this._params.publicSpaceUploadService.upload({...this._params.uploadParams,file:e,onProgress:e=>{this.uploading.progress=e,this._handler.onProgress(e)},onFinish:e=>{if(!(0,p.qk)()){if(e.ok)this._updateModel({publicSpaceId:e.value.fileId,uri:e.value.uri}),this._updateStatus(s.a.Uploaded);else{switch(e.code){case o.F.Cancel:this._delete(),this.dispose();break;case o.F.Unknown:default:var t;null===(t=this._notificationService)||void 0===t||t.error(d.ZP.t("upload_failed",{},"upload failed"))}this._uploading.error=e,this._updateStatus(s.a.UploadFailure,{errInfo:e})}this._mutex.unLock()}}});if(!t.ok){this._mutex.unLock(),this._uploading.error=t,this._updateStatus(s.a.UploadFailure,{errInfo:t});return}this._uploadTaskId=t.value}catch(i){var e;this._mutex.unLock();let t=(0,n.wf)(-1,null!==(e=null==i?void 0:i.message)&&void 0!==e?e:"unexpected failure by calling upload");throw this._uploading.error=t,this._updateStatus(s.a.UploadFailure,{errInfo:t}),i}}}canCancelUpload(){return!!this._uploadTaskId}dispose(){var e;null===(e=this._quickImportAnalyzeTask)||void 0===e||e.cancel(),this._quickImportAnalyzeTask=void 0}_getFileBlobUrl(e,t){if(this._uploading){var i;this._uploading.originalBlobUrl=(0,c.S)(e),(null===(i=this._params.fastImportAnalyzeHelper)||void 0===i?void 0:i.isImageNeedCapture(t))||(this._uploading.blobUrl=this._uploading.originalBlobUrl,this._waitBlobUrlReadyDefer.resolve())}}async _analyzeFileInfo(e){let t=this._params.fastImportAnalyzeHelper;if(!t)return;let i=t.getTask(e);this._quickImportAnalyzeTask=i;let a=await i.done();if(!a.ok){this.uploading.isSupportFastImport=!1;let t=await this._calcMd5(e);t.ok&&this._updateModel({key:t.value,md5:t.value});return}this._uploading.isSupportFastImport=!0,a.value.data&&this._updateModel(a.value.data),this._generateThumbTriggerBinder()}async _generateThumbTrigger(){if(!this._params)return;let{captureCoverAndThumbHelper:e}=this._params;if(!e||this._hadGeneratedThumb)return;this._hadGeneratedThumb=!0;let{uploading:t}=this,i=this._handler.model();if(i.fileType===l.YB.Video&&(null==t?void 0:t.isSupportFastImport)&&(null==t?void 0:t.originalBlobUrl)){let a=await (null==e?void 0:e.getThumb({blobUrl:t.originalBlobUrl,fileType:i.fileType,duration:i.duration,size:{width:i.width,height:i.height}}));!(0,h.n)(this._handler.model())&&a.ok&&this._updateModel({thumb:a.value})}}async _generateCoverTrigger(){let{captureCoverAndThumbHelper:e,fastImportAnalyzeHelper:t}=this._params;if(!e||this._hadGeneratedCover){this._uploading.supportPreview=!1;return}this._hadGeneratedCover=!0;let{uploading:i}=this,a=this._handler.model();if([l.YB.Video,l.YB.Image].includes(a.fileType)&&(null==i?void 0:i.originalBlobUrl)){var r,n,o;let s=await (null==e?void 0:e.getCover({blobUrl:i.originalBlobUrl,fileType:a.fileType,mime:null!==(r=a.mime)&&void 0!==r?r:"",filename:a.filename}));if(!(0,u.B)(this._handler.model())&&s.ok?(this._uploading.coverBlob=null===(n=s.value)||void 0===n?void 0:n.url,this._uploading.supportPreview=!0,this._updateModel({cover:s.value})):this._uploading.supportPreview=!1,null==t?void 0:t.isImageNeedCapture(a.mime)){if(s.ok){this._uploading.blobUrl=null===(o=s.value)||void 0===o?void 0:o.url,this._waitBlobUrlReadyDefer.resolve();return}this._waitBlobUrlReadyDefer.reject("Get blobUrl fail.")}}}_waitBlobUrlReady(){return this._waitBlobUrlReadyDefer.promise}async _calcMd5(e){return await (await this._params.fileCalcMd5Service.getInstance()).calcFileMd5(e)}constructor(e){this._params=e,this._mutex=new a.L,this._hadGeneratedThumb=!1,this._hadGeneratedCover=!1,this._generateThumbTriggerBinder=this._generateThumbTrigger.bind(this),this._generateCoverTriggerBinder=this._generateCoverTrigger.bind(this),this._waitBlobUrlReadyBinder=this._waitBlobUrlReady.bind(this),this._quickImportAnalyzeTask=void 0,this.cancelUpload=()=>{var e,t;this._uploadTaskId&&this._params.publicSpaceUploadService.cancel(this._uploadTaskId),null===(e=(t=this._handler).onCancelUpload)||void 0===e||e.call(t),this.dispose()},this._uploading={generateThumbTrigger:this._generateThumbTriggerBinder,generateCoverTrigger:this._generateCoverTriggerBinder,waitBlobUrlReady:this._waitBlobUrlReadyBinder,isSupportFastImport:!!this._params.fastImportAnalyzeHelper&&void 0,blobUrl:void 0,coverBlob:void 0,progress:0,file:this._params.file},this._waitBlobUrlReadyDefer=(0,r.PQ)()}}},251180:function(e,t,i){i.d(t,{c:function(){return v}});var a=i(789786),r=i(173888),n=i(426020),o=i(230689),s=i(273238),l=i(775352),d=i(986824),c=i(641276),u=i(690613),h=i(800788),p=i(116528),_=i(860734),g=i(495141),f=i(48824),m=i(903375);class v extends d.I{get md5(){return this._data.md5}getModel(){var e,t,i;return{...this._data,id:this.id,status:this.status,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidDone:this.onDidDone,onDidRemove:this.onDidRemove,uploading:null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.uploading,preparing:null===(t=this._prepareMaterialLifecycleHelper)||void 0===t?void 0:t.preparing,transcoding:null===(i=this._transcodeMaterialHelper)||void 0===i?void 0:i.transcoding}}canRetryPrepare(){var e,t;return null!==(t=null===(e=this._prepareMaterialLifecycleHelper)||void 0===e?void 0:e.canRetryPrepare())&&void 0!==t&&t}prepare(){var e;null===(e=this._prepareMaterialLifecycleHelper)||void 0===e||e.prepare()}canRetryUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canRetryUpload())&&void 0!==t&&t}upload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.upload()}changeUploadWorkspace(e){var t;if(!(0,m.p)(this))this._updateFromWorkspaceId(e),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.updateFromWorkspaceId(e)}canCancelUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canCancelUpload())&&void 0!==t&&t}cancelUpload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.cancelUpload(),super.cancelUpload()}canRetryTranscode(){var e,t;return null!==(t=null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.canRetryTranscode())&&void 0!==t&&t}transcode(){return(0,h.Y2)(this._transcodeMaterialHelper,"helper not found"),this._transcodeMaterialHelper.transcode()}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}sync2UserMaterial(){this._triggerSyncMaterialFromWorkspaceHelper(),this._syncFromWorkspaceHelper.sync2UserMaterial()}cancelSync2UserMaterial(){this.status===r.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}async delete(e){try{return!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]}),await super.delete(),(0,u.ly)()}catch(e){var t;return(0,u.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}get _needPrepare(){return!!this._prepareMaterialLifecycleHelper}_initUploadMaterialLifecycleHelper(e){var t;let{file:i}=e;this._uploadMaterialLifecycleHelper=new f.x({file:i,fromWorkspaceId:this.fromWorkspaceId,fromFolderId:this.fromFolderId,userMaterialUploadService:this._userMaterialUploadService,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,fastImportAnalyzeHelper:this._option.fastImportAnalyzeHelper,uploadParams:this._option.uploadParams,notificationService:this._notificationService}),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.bootstrap({handler:{model:()=>this.getModel(),status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},onCancelUpload:()=>{this._onDidCancelUpload.fire()},updateStatus:this._updateStatus.bind(this),updateModel:e=>{this._partialUpdateModel(e)}},events:{onSuccess:this.onDidUpload,onError:this.onUploadFailure}})}_bindListenerWithLifecycle(){this._needPrepare&&(0,c.V)(this.onDidPrepare)(()=>{Promise.resolve().then(()=>{var e,t;if(this.hasBeenRemoved)return;let i=null===(e=this._prepareMaterialLifecycleHelper)||void 0===e?void 0:e.result;(0,h.ZB)(null==i?void 0:i.file),this._initUploadMaterialLifecycleHelper({file:null==i?void 0:i.file}),this._updateStatus(r.a.WaitingUpload),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.upload()})}),(0,c.V)(this.onDidUpload)(()=>{Promise.resolve().then(()=>{var e;if(null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.dispose(),!this.hasBeenRemoved)this._data.fileType===n.YB.Image?this._transcodeMaterialHelper=new p.Y({assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}):[n.YB.Audio,n.YB.Video].includes(this._data.fileType)?this._transcodeMaterialHelper=new _.D({assetId:this._data.assetId,fileType:this._data.fileType,fromWorkspaceId:this.fromWorkspaceId,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}):(0,h.ss)("unexpected logic"),this._updateStatus(r.a.Transcoding),this._transcodeMaterialHelper.listenTranscodeResult()})}),(0,c.V)(this.onDidTranscode)(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved){if(void 0===this.toWorkspaceId||this.fromWorkspaceId===this.toWorkspaceId){this._updateStatus(r.a.Success);return}this.sync2UserMaterial()}})}),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._updateStatus(r.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){(0,h.ZB)(this.toWorkspaceId),this._syncFromWorkspaceHelper=this._containerService.createInstance(g.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._notificationService})}_partialUpdateModel(e){this._data.key&&delete e.key,Object.assign(this._data,e),this._fireModelUpdate()}constructor(e,t,i,a){var r;super({fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,addModelToDraft:e.addModelToDraft,fromFolderId:e.fromFolderId,toFolderId:e.toFolderId,notificationService:e.notificationService}),this._option=e,this._userMaterialsService=t,this._userMaterialUploadService=i,this._containerService=a,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let n=this._option;this._data=n.data,this._prepareMaterialLifecycleHelper=n.prepareMaterialLifecycleHelper,null===(r=this._prepareMaterialLifecycleHelper)||void 0===r||r.bootstrap({handler:{status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},updateStatus:this._updateStatus.bind(this)},events:{onSuccess:this.onDidPrepare,onError:this.onPrepareFailure}}),setTimeout(()=>{var e;null===(e=this._prepareMaterialLifecycleHelper)||void 0===e||e.prepare()}),this._bindListenerWithLifecycle()}}v=(0,a.gn)([(0,a.fM)(1,s.b),(0,a.fM)(2,l.ec),(0,a.fM)(3,o.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IExtractAudioAndUploadMaterialLifecycle?Object:IExtractAudioAndUploadMaterialLifecycle,void 0===s.b?Object:s.b,void 0===l.ec?Object:l.ec,void 0===o.t?Object:o.t])],v)},667086:function(e,t,i){i.d(t,{k:function(){return v}});var a=i(789786),r=i(745299),n=i(273238),o=i(225698),s=i(173888),l=i(426020),d=i(230689),c=i(986824),u=i(641276),h=i(690613),p=i(800788),_=i(196392),g=i(483197),f=i(495141),m=i(85539);class v extends c.I{get md5(){return this._data.md5}getModel(){var e,t,i,a;return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidRemove:this.onDidRemove,onDidDone:this.onDidDone,status:this.status,uploading:null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.uploading,transcoding:null===(t=this._transcodeMaterialHelper)||void 0===t?void 0:t.transcoding,preparing:null===(i=this._prepareMaterialLifecycleHelper)||void 0===i?void 0:i.preparing,syncingUserMaterial:null===(a=this._syncFromWorkspaceHelper)||void 0===a?void 0:a.syncingUserMaterial}}canRetryPrepare(){(0,p.ss)("ExtractAudioAndUploadToPublicSpaceLifecycle::canRetryPrepare")}prepare(){(0,p.ss)("ExtractAudioAndUploadToPublicSpaceLifecycle::prepare")}canRetryUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canRetryUpload())&&void 0!==t&&t}upload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.upload()}canCancelUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canCancelUpload())&&void 0!==t&&t}cancelUpload(){var e;null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.cancelUpload(),super.cancelUpload()}canRetryTranscode(){var e,t;return null!==(t=null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.canRetryTranscode())&&void 0!==t&&t}transcode(){return(0,p.Y2)(this._transcodeMaterialHelper,"helper not found"),this._transcodeMaterialHelper.transcode()}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}cancelSync2UserMaterial(){this.status===s.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}sync2UserMaterial(){this._triggerSyncMaterialFromWorkspaceHelper(),(0,p.ZB)(this._syncFromWorkspaceHelper),this._syncFromWorkspaceHelper.sync2UserMaterial()}async delete(e){var t,i;try{return this._hasBeenSync?((0,p.Y2)(this._data.sourceType===l.ov.EverCloud),!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]})):[s.a.Uploading,s.a.UploadFailure,s.a.WaitingUpload].includes(this.status)&&(null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.cancelUpload()),await super.delete(),(0,h.ly)()}catch(e){return(0,h.wf)(-1,null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"unexpected error")}}get _needPrepare(){return!!this._prepareMaterialLifecycleHelper}bindListenerWithLifecycle(){this._needPrepare&&(0,u.V)(this.onDidPrepare)(()=>{Promise.resolve().then(()=>{var e,t,i;if(this.hasBeenRemoved)return;let a=null===(e=this._prepareMaterialLifecycleHelper)||void 0===e?void 0:e.result;(0,p.ZB)(null==a?void 0:a.file);let{_option:r}=this;this._uploadMaterialLifecycleHelper=new m.I({file:null==a?void 0:a.file,publicSpaceUploadService:this._publicSpaceUploadService,userMaterialService:this._userMaterialsService,fastImportAnalyzeHelper:r.fastImportAnalyzeHelper,fileCalcMd5Service:this._lazyFileMd5CalcService,notificationService:this._notificationService}),null===(t=this._uploadMaterialLifecycleHelper)||void 0===t||t.bootstrap({handler:{model:()=>this.getModel(),status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},updateStatus:this._updateStatus.bind(this),updateModel:e=>{this._partialUpdateModel(e)}},events:{onSuccess:this.onDidUpload,onError:this.onUploadFailure}}),this._updateStatus(s.a.WaitingUpload),null===(i=this._uploadMaterialLifecycleHelper)||void 0===i||i.upload()})}),(0,u.V)(this.onDidUpload)(()=>{Promise.resolve().then(()=>{var e,t;if(!this.hasBeenRemoved)null===(e=this._uploadMaterialLifecycleHelper)||void 0===e||e.dispose(),(0,p.Y2)(this._data.sourceType===l.ov.PublicSpace,"current material is not from publicSpace"),this._transcodeMaterialHelper=new _.L({taskId:this._data.publicSpaceId,fileType:this._data.fileType,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}),this._updateStatus(s.a.Transcoding),null===(t=this._transcodeMaterialHelper)||void 0===t||t.listenTranscodeResult()})}),(0,u.V)(this.onDidTranscode)(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved){if(this.toWorkspaceId){this.sync2UserMaterial();return}this._updateStatus(s.a.WaitForSync2UserMaterial)}})}),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._hasBeenSync=!0,this._updateFromWorkspaceId(this.toWorkspaceId),this._updateStatus(s.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){(!this._syncFromWorkspaceHelper||this._syncHelperType!==this._data.sourceType)&&(this._syncHelperType=this._data.sourceType,this._data.sourceType===l.ov.PublicSpace?this._syncFromWorkspaceHelper=this._containerService.createInstance(g.B,{vid:this._data.vid,toFolderId:this.toFolderId,toWorkspaceId:this.toWorkspaceId,payinPayoutHelper:this._option.payinPayoutHelper,userMaterialService:this._userMaterialsService,handler:{model:()=>this.getModel(),status:()=>this.status,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e),onProgress:()=>this._onModelUpdate.fire(this.getModel())}}):this._syncFromWorkspaceHelper=this._containerService.createInstance(f.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._notificationService}))}_partialUpdateModel(e){this._data.key&&delete e.key,Object.assign(this._data,e)}constructor(e,t,i,a,r){var n;super({fromWorkspaceId:void 0,toWorkspaceId:void 0,addModelToDraft:e.addModelToDraft,fromFolderId:e.fromFolderId,toFolderId:void 0,notificationService:e.notificationService}),this._option=e,this._publicSpaceUploadService=t,this._userMaterialsService=i,this._lazyFileMd5CalcService=a,this._containerService=r,this._hasBeenSync=!1,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let o=this._option;this._data=o.data,this._prepareMaterialLifecycleHelper=o.prepareMaterialLifecycleHelper,null===(n=this._prepareMaterialLifecycleHelper)||void 0===n||n.bootstrap({handler:{status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},updateStatus:this._updateStatus.bind(this)},events:{onSuccess:this.onDidPrepare,onError:this.onPrepareFailure}}),setTimeout(()=>{var e;null===(e=this._prepareMaterialLifecycleHelper)||void 0===e||e.prepare()}),this.bindListenerWithLifecycle()}}v=(0,a.gn)([(0,a.fM)(1,r.S),(0,a.fM)(2,n.b),(0,a.fM)(3,o.w),(0,a.fM)(4,d.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IExtractAudioAndUploadToPublicSpaceLifecycle?Object:IExtractAudioAndUploadToPublicSpaceLifecycle,void 0===r.S?Object:r.S,void 0===n.b?Object:n.b,void 0===o.w?Object:o.w,void 0===d.t?Object:d.t])],v)},745403:function(e,t,i){i.d(t,{P:function(){return r}});var a=i(986824);class r extends a.I{get _cloneTarget(){return this._params.lifecycle}get md5(){return this._cloneTarget.md5}get status(){return this._cloneTarget.status}getModel(){return{...this._cloneTarget.getModel(),id:this.id,addModelToDraft:this._addModelToDraftBinder}}updateToWorkspaceId(e){this._cloneTarget.updateToWorkspaceId(e)}updateToWorkspaceIdAndFolderId(e){this._cloneTarget.updateToWorkspaceIdAndFolderId(e)}canRetryPrepare(){return this._cloneTarget.canRetryPrepare()}prepare(){return this._cloneTarget.prepare()}canRetryUpload(){return this._cloneTarget.canRetryUpload()}upload(){return this._cloneTarget.upload()}canCancelUpload(){return this._cloneTarget.canCancelUpload()}cancelUpload(){return this._cloneTarget.cancelUpload()}canRetryTranscode(){return this._cloneTarget.canRetryTranscode()}transcode(){return this._cloneTarget.transcode()}cancelSync2UserMaterial(){return this._cloneTarget.cancelSync2UserMaterial()}canSync2UserMaterial(){return this._cloneTarget.canSync2UserMaterial()}sync2UserMaterial(){return this._cloneTarget.sync2UserMaterial()}delete(){return super.delete()}_listenOriginEventAndReFire(){let e=["onDidMd5Set","onPrepareStart","onDidPrepare","onPrepareFailure","onUploadStart","onDidUpload","onUploadFailure","onDidCancelUpload","onTranscoding","onDidTranscode","onTranscodeFailure","onSyncing2UserMaterial","onDidSync2UserMaterial","onSync2UserMaterialFailure","onModelUpdate","onResourceReady","onDidUnDone","onDidDone"];for(let i of(this._params.isListenOriginDeleted&&e.push("onDidDelete"),e)){var t=this;this._cloneTarget[i](function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];t[`_${i}`].fire(...a)})}}constructor(e){super({fromWorkspaceId:e.lifecycle.fromWorkspaceId,toWorkspaceId:e.lifecycle.toWorkspaceId,fromFolderId:e.lifecycle.fromFolderId,toFolderId:e.lifecycle.toFolderId,addModelToDraft:e.addModelToDraft,notificationService:e.notificationService}),this._params=e,this._addModelToDraftBinder=()=>this.addModelToDraft(this),this._listenOriginEventAndReFire()}}},162641:function(e,t,i){i.d(t,{q:function(){return p}});var a=i(789786),r=i(273238),n=i(173888),o=i(426020),s=i(230689),l=i(986824),d=i(690613),c=i(800788),u=i(483197),h=i(495141);class p extends l.I{get md5(){return this._data.md5}getModel(){var e;return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidRemove:this.onDidRemove,onDidDone:this.onDidDone,status:this.status,syncingUserMaterial:null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.syncingUserMaterial}}canRetryPrepare(){(0,c.ss)("PublicSpaceMediaLifecycle::canRetryPrepare")}prepare(){(0,c.ss)("PublicSpaceMediaLifecycle::prepare")}canRetryUpload(){return!1}upload(){(0,c.ss)("PublicSpaceMediaLifecycle::upload")}canCancelUpload(){return!1}cancelUpload(){(0,c.ss)("PublicSpaceMediaLifecycle::cancelUpload")}canRetryTranscode(){return!1}transcode(){(0,c.ss)("PublicSpaceMediaLifecycle::transcode")}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}cancelSync2UserMaterial(){this.status===n.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}sync2UserMaterial(e){this._triggerSyncMaterialFromWorkspaceHelper(),(0,c.ZB)(this._syncFromWorkspaceHelper),this._syncFromWorkspaceHelper.sync2UserMaterial(e)}async delete(e){try{return this._hasBeenSync&&((0,c.Y2)(this._data.sourceType===o.ov.EverCloud),!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]})),await super.delete(),(0,d.ly)()}catch(e){var t;return(0,d.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}bindListenerWithLifecycle(){this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._hasBeenSync=!0,this._updateFromWorkspaceId(this.toWorkspaceId),this._updateStatus(n.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){(!this._syncFromWorkspaceHelper||this._syncHelperType!==this._data.sourceType)&&(this._syncHelperType=this._data.sourceType,this._data.sourceType===o.ov.PublicSpace?this._syncFromWorkspaceHelper=this._containerService.createInstance(u.B,{vid:this._data.vid,toFolderId:this.toFolderId,toWorkspaceId:this.toWorkspaceId,payinPayoutHelper:this._option.payinPayoutHelper,userMaterialService:this._userMaterialsService,handler:{model:()=>this.getModel(),status:()=>this.status,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e),onProgress:()=>this._onModelUpdate.fire(this.getModel())}}):this._syncFromWorkspaceHelper=this._containerService.createInstance(h.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._notificationService}))}_partialUpdateModel(e){let{key:t,...i}=e;Object.assign(this._data,i),this._fireModelUpdate()}constructor(e,t,i){super({fromWorkspaceId:void 0,toWorkspaceId:e.toWorkspaceId,addModelToDraft:e.addModelToDraft,fromFolderId:void 0,toFolderId:void 0,notificationService:e.notificationService}),this._option=e,this._userMaterialsService=t,this._containerService=i,this._hasBeenSync=!1,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let a=this._option;if(this._data=a.data,this._updateStatus(n.a.WaitForSync2UserMaterial),this.toWorkspaceId){var r;this.sync2UserMaterial(null===(r=this._option)||void 0===r?void 0:r.syncAssetOptions)}this.bindListenerWithLifecycle()}}p=(0,a.gn)([(0,a.fM)(1,r.b),(0,a.fM)(2,s.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IPublicSpaceMediaLifecycle?Object:IPublicSpaceMediaLifecycle,void 0===r.b?Object:r.b,void 0===s.t?Object:s.t])],p)},751217:function(e,t,i){i.d(t,{B:function(){return r}});var a=i(426020);function r(e){if(a.YB.Image===e.fileType||a.YB.Video===e.fileType){var t;return!!(null===(t=e.cover)||void 0===t?void 0:t.url)}return!1}},795160:function(e,t,i){i.d(t,{n:function(){return r}});var a=i(426020);function r(e){return a.YB.Video===e.fileType&&!!e.thumb}},903375:function(e,t,i){i.d(t,{p:function(){return r}});var a=i(173888);function r(e){return![a.a.Unknown,a.a.Preparing,a.a.Prepared,a.a.PrepareFailure,a.a.WaitingUpload,a.a.Uploading,a.a.UploadFailure].includes(e.status)&&!!e.fromWorkspaceId&&!0}},137348:function(e,t,i){i.d(t,{F:function(){return r}});var a=i(801497);function r(e){let{name:t,format:i}=e,r=a.ZP.t("web_extract_text_extracted_audio",{},"Extracted"),n=t.substring(0,t.lastIndexOf("."));return i?`${r}-${n}.${i}`:`${r}-${n}`}},980867:function(e,t,i){i.d(t,{M:function(){return r}});var a=i(800788);function r(e){return e.uploading&&(e.uploading={...e.uploading},Object.defineProperty(e.uploading,"file",{get(){(0,a.ss)("this structure has been transfer to observable data, do not support this value, please try it in origin data")},set(){(0,a.ss)("this structure has been transfer to observable data, do not support this value, please try it in origin data")}})),e}},110494:function(e,t,i){i.d(t,{W:function(){return o}});var a=i(690613),r=i(763832),n=i(34159);async function o(e){try{let t=Object.assign({},{waitForFirstRequest:!1,delay:0,retryTimes:0},e.fetchRetryOptions),i=await e.userMaterialService.getEvercloudInstance(e.workspaceId),o=async()=>{try{let t=await i.getAssets({md5s:e.md5s,material:!1});if(!t)return(0,a.wf)(-1,"not found target assets");if(t.length!==e.md5s.length)return(0,a.wf)(-1,"found target assets failure");let r=new Map(t.map(e=>[e.md5,e])),o=[];for(let t of e.md5s){if(!r.has(t))return(0,a.wf)(-1,`can not find md5: ${t}`);o.push(r.get(t))}return(0,a.oW)(o.map(e=>(0,n.V)(e)))}catch(e){return(0,a.wf)(-1,null==e?void 0:e.message)}},s=async e=>{!(0===e&&!t.waitForFirstRequest)&&await (0,r._)(t.delay);let i=await o();if(!i.ok)return e>=t.retryTimes?i:s(e+1);return i};return await s(0)}catch(e){return(0,a.wf)(-1,null==e?void 0:e.message)}}},565598:function(e,t,i){i.d(t,{o:function(){return n}});var a=i(722169);let r=[{targets:["360","480","720"]},{targets:["720","1080","origin"]}];function n(e,t){let i=(null==t?void 0:t.originSize)?Math.max(t.originSize.width,t.originSize.height):void 0,n=(0,a.cloneDeep)(r);return i&&i<=720&&n[0].targets.push("origin"),(0,a.merge)({},{strategy:n},t).strategy.map(a=>{let r=a.targets.filter(t=>{let a=parseInt(t,10);return!(e&&!("origin"in e)&&Number.isNaN(a)||i&&i<a)});return!r.length||r.reduce((i,a)=>{var r,n;if(i)return i;let o=null!==(r=null==t?void 0:t.keyFormatter)&&void 0!==r?r:e=>"origin"!==e?`${e}`:"origin",s=null==e?void 0:e[o(a)];return!!(null!==(n=null==s?void 0:s.url)&&void 0!==n?n:null==s?void 0:s.preview_url)},!1)}).reduce((e,t)=>e&&t,!0)}},305872:function(e,t,i){i.d(t,{b:function(){return o}});var a=i(846313),r=i(402655),n=i(938918);class o extends r.JT{get phase(){return this.phaseEmitter.currentPhase<n.f.DraftLoaded?n.B.Started:this.phaseEmitter.currentPhase<n.f.Restored?n.B.DraftLoaded:n.B.Restored}didPassPhase(e){return this.phaseEmitter.currentPhase>=e}setWorkbenchLoaded(e){this.setLifecyclePhase(n.f.WorkbenchLoaded)}setDraftLoaded(){this.setLifecyclePhase(n.f.DraftLoaded)}setRenderLoaded(){this.setLifecyclePhase(n.f.RendererLoaded)}setRestored(){this.setLifecyclePhase(n.f.Restored)}setCompleted(){this.setLifecyclePhase(n.f.Completed)}setDestroyed(){this.setLifecyclePhase(n.f.Destroyed)}get onDraftLoaded(){return this.phaseEmitter.when(n.f.DraftLoaded)}get onRestored(){return this.phaseEmitter.when(n.f.Restored)}setLifecyclePhase(e){this.phaseEmitter.setPhase(e)}get isDestroyed(){return this.phaseEmitter.currentPhase===n.f.Destroyed}constructor(...e){super(...e),this.phaseEmitter=new a.K(n.f.Started,{checker:(e,t)=>e<=t})}}},559203:function(e,t,i){i.d(t,{S:function(){return l}});var a=i(789786),r=i(800788),n=i(782350),o=i(260963),s=i(936243);class l{get currentWorkspaceId(){return this.observableData.currentWorkspaceId}get workspaceList(){return this.observableData.workspaceList}get initiated(){return!!this.observableData.workspaceList.length}selectWorkspaceId(e){let t=this.observableData.workspaceList.find(t=>t.workspace_id===e);(0,r.Y2)(t,"unexpected selected"),(0,o.z)(()=>{this.observableData.currentWorkspaceId=e})}_listenWorkspaceListChange(){let e=()=>{(0,o.z)(()=>{this.observableData.workspaceList=this._workspaceService.workspaceList,this.observableData.workspaceList.length&&this._revisionCurrentWorkspaceId()})};this._workspaceService.available&&e(),this._workspaceService.onDidWorkspaceChange(()=>{e()})}_revisionCurrentWorkspaceId(){if(!this.observableData.workspaceList.find(e=>e.workspace_id===this.observableData.currentWorkspaceId))(0,o.z)(()=>{this.observableData.currentWorkspaceId=this._mainDraftService.draftWorkspaceManager.workspaceId})}_listenDraftWorkspaceChange(){this._mainDraftService.draftWorkspaceManager.onDidWorkspaceChange(()=>{let e=this._mainDraftService.draftWorkspaceManager.workspaceId;this._revisionCurrentWorkspaceId(),this.selectWorkspaceId(e)})}constructor(e,t){this._workspaceService=e,this._mainDraftService=t,this.observableData=(0,o.LO)({currentWorkspaceId:void 0,workspaceList:[]}),this._listenWorkspaceListChange(),this._listenDraftWorkspaceChange()}}l=(0,a.gn)([(0,a.fM)(0,n.W),(0,a.fM)(1,s.v),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.W?Object:n.W,void 0===s.v?Object:s.v])],l)},8462:function(e,t,i){i.d(t,{x:function(){return a}});let a=(0,i(335290).yh)("sync-report-to-slardar-service")},654259:function(e,t,i){i.d(t,{A:()=>F});var a=i("789786"),r=i("230689"),n=i("800788"),o=i("127830"),s=i("668830"),l=i("151394"),d=i("668970"),c=i("290237"),u=i("911290"),h=i("309180"),p=i("352625"),_=i("572029"),g=i("850513"),f=i("782350"),m=i("966697"),v=i("622204"),y=i("801497");class S extends v.j{fetchData(e){return this._textPresetDataService.getBrandTextPresets(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return y.ZP.t("web_space_brandkit_editor_preset_text",{},"Text Presets")}constructor(e,t,i,a,r){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;super(a,r,n,o),this._brandDataService=t,this._textPresetDataService=i,this._workspaceService=a,this._capcutAccountService=r,this.setInitialData(null==o?void 0:o.list,s)}}S=(0,a.gn)([(0,a.fM)(1,_.X),(0,a.fM)(2,g.J),(0,a.fM)(3,f.W),(0,a.fM)(4,m.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===_.X?Object:_.X,void 0===g.J?Object:g.J,void 0===f.W?Object:f.W,void 0===m.Gw?Object:m.Gw])],S);var k=i("752048");class w extends v.j{fetchData(e){return this._brandDataService.getBrandAdjustmentPresets(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return y.ZP.t("web_space_brandkit_editor_regulate_preset",{},"Adjust Presets")}constructor(e,t,i,a){let{managerConfig:r,preloadData:n,shouldPaginate:o}=e;(null==n?void 0:n.list)&&(n.list=(0,k.B)(n.list)),super(i,a,r,n),this._brandDataService=t,this._workspaceService=i,this._capcutAccountService=a,this.setInitialData(null==n?void 0:n.list,o)}}w=(0,a.gn)([(0,a.fM)(1,_.X),(0,a.fM)(2,f.W),(0,a.fM)(3,m.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===_.X?Object:_.X,void 0===f.W?Object:f.W,void 0===m.Gw?Object:m.Gw])],w);var M=i("343107");class b{_getManagerByType(e){switch(e){case o._g.Photo:return s.n;case o._g.Sticker:return l.C;case o._g.VideoBackground:return d.y;case o._g.Video:return c.g;case o._g.Audio:return u.B;case o._g.Font:return h.d;case o._g.BrandColor:return p.F;case o._g.TextPreset:return S;case o._g.AdjustmentPreset:return w;case o._g.TextTemplate:return M.n;default:(0,n.bP)(e,`getManagerByType: Invalid ResourceType:${e}`)}}constructor(e,t){this._options=e,this._containerService=t,this._workspaceId="",this.managers=new Map,this.getBrandManagerByType=e=>this.managers.get(e),this.setBrandCollectionData=e=>{for(let[t,i]of Object.entries(e)){let e=this._getManagerByType(t),a=this._containerService.createInstance(e,{managerConfig:{workspaceId:this._workspaceId,resourceType:t},list:i});this.managers.set(t,a)}},this.getOrCreateManagerByType=(e,t)=>{var i,a;let r=this._getManagerByType(e);if(this.managers.has(e)){let i=this.managers.get(e);return(null==t?void 0:t.shouldPaginate)&&(null==i||i.getAllBrands()),i}let n=this._containerService.createInstance(r,{managerConfig:{workspaceId:this._workspaceId,resourceType:e},preloadData:t?{list:null!==(i=null==t?void 0:t.data)&&void 0!==i?i:[],count:null!==(a=null==t?void 0:t.count)&&void 0!==a?a:0}:void 0,shouldPaginate:null==t?void 0:t.shouldPaginate});return this.managers.set(e,n),n},this._workspaceId=this._options.workspaceId}}b=(0,a.gn)([(0,a.fM)(1,r.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Object,void 0===r.t?Object:r.t])],b);var T=i("402093"),I=i("260963"),D=i("210823"),P=i("728631");class F{get workspaceManager(){return this._workspaceManager}get highlightTarget(){return this.observableData.highlightTarget}setHighlightTarget(e){this._workbenchService.activeSiderMenuByName(P.j.SiderMenuBrandKit,"manual"),(0,I.z)(()=>{this.observableData.highlightTarget=e})}constructor(e,t){this.containerService=e,this._workbenchService=t,this.observableData=(0,I.LO)({}),this._userBrandCollection=new Map,this.getOrCreateCollectionByWorkspace=e=>{!e&&(0,n.Y2)("getOrCreateCollectionByWorkspace: workspaceId cannot be empty");let t=this._userBrandCollection.get(e);return t?t:(t=this.containerService.createInstance(b,{workspaceId:e}),this._userBrandCollection.set(e,t),t)},this.removeCollection=e=>{this._userBrandCollection.delete(e)},this.isCollectionExisted=e=>!!this._userBrandCollection.get(e),this._workspaceManager=this.containerService.createInstance(T.S)}}F=(0,a.gn)([(0,a.fM)(0,r.t),(0,a.fM)(1,D.e),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===r.t?Object:r.t,void 0===D.e?Object:D.e])],F)},639605:function(e,t,i){i.d(t,{AW:function(){return u},J0:function(){return _},Pk:function(){return h},d0:function(){return c},de:function(){return p},h1:function(){return d}});var a,r,n,o,s,l=i(335290);var d=((a={})[a.RoomJoin=11001]="RoomJoin",a[a.RoomLeave=11002]="RoomLeave",a[a.RoomAcquireEdit=11003]="RoomAcquireEdit",a[a.RoomRemoveEdit=11004]="RoomRemoveEdit",a[a.WorkspaceRemove=11005]="WorkspaceRemove",a[a.WorkspaceUpdate=11006]="WorkspaceUpdate",a[a.WorkspaceNewMember=11007]="WorkspaceNewMember",a[a.WorkspaceFileMoveSuccess=11008]="WorkspaceFileMoveSuccess",a[a.WorkspaceUploadLinkStart=11009]="WorkspaceUploadLinkStart",a[a.WorkspaceUploadLinkSuccess=11010]="WorkspaceUploadLinkSuccess",a[a.DraftUpdateNotice=13002]="DraftUpdateNotice",a[a.CollabChange=13001]="CollabChange",a[a.WorkspaceUploadLinkFileStart=11011]="WorkspaceUploadLinkFileStart",a[a.WorkspaceUploadLinkFileSuccess=11012]="WorkspaceUploadLinkFileSuccess",a[a.RefreshBrandAssets=11013]="RefreshBrandAssets",a[a.RemoveBrandAssets=11014]="RemoveBrandAssets",a[a.UploadBrandAssets=11015]="UploadBrandAssets",a[a.TaskListRefresh=12002]="TaskListRefresh",a);var c=((r={}).COLLABORATOR="share_upload_link",r.PHONE="from_phone",r.BATCH_REPLACE="from_batch_replace",r);var u=((n={}).IMAGE="image",n.VIDEO="video",n.AUDIO="audio",n);var h=((o={}).DONE="done",o.CANCEL="cancel",o.FAIL="fail",o);var p=((s={}).DISCONNECTED="disconnected",s.CONNECTING="connecting",s.OPEN="open",s);let _=(0,l.yh)("websocket-service")},795636:function(e,t,i){i.d(t,{g:function(){return T}});var a=i(789786),r=i(274559),n=i(21961),o=i(619425),s=i(426020),l=i(173888),d=i(230689),c=i(127830),u=i(866006),h=i(622969),p=i(775352),_=i(273238),g=i(597623),f=i(587892),m=i(690613),v=i(800788),y=i(599735),S=i(117557),k=i(714619),w=i(211820),M=i(722169),b=i(115618);class T extends r.Z{addFileToFolderWhereFileLocated(e,t){var i,a,r,o;let s=e.fromWorkspaceId;if((0,v.ZB)(s),!e.fromFolderId)return this.createFileByPath(this.formatPathFromArray([this.root.path,e.id]),e,{deduplicationStrategy:null!==(r=null==t?void 0:t.deduplicationStrategy)&&void 0!==r?r:h.c.NotAdd,insertPosition:null!==(o=null==t?void 0:t.insertPosition)&&void 0!==o?o:n.O.Beginning,needClone:null==t?void 0:t.needClone,cloneOptions:null==t?void 0:t.cloneOptions});{let r=this.getFolderById(e.fromFolderId),o=null==r?void 0:r.path;return(0,v.ZB)(o),this.createFileByPath(this.formatPathFromArray([o,e.id]),e,{deduplicationStrategy:null!==(i=null==t?void 0:t.deduplicationStrategy)&&void 0!==i?i:h.c.NotAdd,insertPosition:null!==(a=null==t?void 0:t.insertPosition)&&void 0!==a?a:n.O.Beginning,needClone:null==t?void 0:t.needClone,cloneOptions:null==t?void 0:t.cloneOptions})}}addFileToCurrentPath(e,t,i){if(t.getModel().fileType===s.YB.File)return{hasDeduplicated:!1,hasAdded:!1};let a=!1;if((null==i?void 0:i.deduplicationStrategy)===h.c.NotAdd){if(this._checkDuplicateFileFromCloud(t))return{hasDeduplicated:!0,hasAdded:!1}}else(null==i?void 0:i.deduplicationStrategy)===h.c.DeleteExistFromCache?{hasDeleted:a}=this._duplicateFileAndDeleteExist(t,{onlyDeleteFromCache:!0}):(null==i?void 0:i.deduplicationStrategy)===h.c.DeleteExistFromCloud&&({hasDeleted:a}=this._duplicateFileAndDeleteExist(t,{onlyDeleteFromCache:!1}));let r=t;(null==i?void 0:i.needClone)&&(r=this._containerService.createInstance(S.G,{lifecycle:r,fromWorkspaceId:this._params.workspaceId,toWorkspaceId:this._params.workspaceId,addModelToDraft:(0,y.s)(this._containerService),options:i.cloneOptions,notificationService:this._notificationService})),super.addFileToCurrentPath(e,r,i);let n=this.getFileById(e);return(0,v.ZB)(n),this._updateParentFolderChild(n),{hasDeduplicated:a,hasAdded:!1}}addFolderToCurrentPath(e,t,i){if((null==i?void 0:i.deduplicationStrategy)===h.c.NotAdd&&this._checkDuplicateFolderFromCloud(t))return{hasDeduplicated:!0,hasAdded:!1};(null==i?void 0:i.shouldNotFetchMoreWhenOpen)&&this._foldersNotFetchMoreWhenOpen.add(t.assetId),super.addFolderToCurrentPath(e,t,i);let a=this.getFolderById(e);return(0,v.ZB)(a),this._updateParentFolderChild(a),{hasDeduplicated:!1,hasAdded:!0}}createFileByPath(e,t,i){if(t.getModel().fileType===s.YB.File)return{hasDeduplicated:!1,hasAdded:!1};let a=!1;if((null==i?void 0:i.deduplicationStrategy)===h.c.NotAdd){if(this._checkDuplicateFileFromCloud(t))return{hasDeduplicated:!0,hasAdded:!1}}else(null==i?void 0:i.deduplicationStrategy)===h.c.DeleteExistFromCache?{hasDeleted:a}=this._duplicateFileAndDeleteExist(t,{onlyDeleteFromCache:!0}):(null==i?void 0:i.deduplicationStrategy)===h.c.DeleteExistFromCloud&&({hasDeleted:a}=this._duplicateFileAndDeleteExist(t,{onlyDeleteFromCache:!1}));let r=t;(null==i?void 0:i.needClone)&&(r=this._containerService.createInstance(S.G,{lifecycle:r,fromWorkspaceId:this._params.workspaceId,toWorkspaceId:this._params.workspaceId,addModelToDraft:(0,y.s)(this._containerService),options:i.cloneOptions,notificationService:this._notificationService})),super.createFileByPath(e,r,i);let n=this.getFileByPath(e);return(0,v.ZB)(n),this._updateParentFolderChild(n),{hasDeduplicated:a,hasAdded:!0}}createFolderByPath(e,t,i){if((null==i?void 0:i.deduplicationStrategy)===h.c.NotAdd&&this._checkDuplicateFolderFromCloud(t))return{hasDeduplicated:!0,hasAdded:!1};(null==i?void 0:i.shouldNotFetchMoreWhenOpen)&&this._foldersNotFetchMoreWhenOpen.add(t.assetId),super.createFolderByPath(e,t,i);let a=this.getFolderByPath(e);return(0,v.ZB)(a),this._updateParentFolderChild(a),{hasDeduplicated:!1,hasAdded:!0}}batchAddNodes(e,t){if((null==t?void 0:t.deduplicationStrategy)===h.c.NotAdd){let t=[],i=!1;return e.forEach(e=>{if(e.type===n.t.File){if(this._checkDuplicateFileFromCloud(e.data)){i=!0;return}t.push(e)}else if(e.type===n.t.Folder){if(this._checkDuplicateFolderFromCloud(e.data)){i=!0;return}t.push(e)}}),super.batchAddNodes(t),{hasDeduplicated:i,hasAdded:!!t.length}}return super.batchAddNodes(e),{hasDeduplicated:!1,hasAdded:!!e.length}}async deleteFileById(e){let t;let i=super.getFileById(e);if((0,v.ZB)(i,`Folder or file with id ${e} cannot be found, so delete failed.`),(0,b.F)(i.data.status)){i.data.canCancelUpload()&&i.data.cancelUpload();let t=this.getParentFolder(i);return super.deleteFileById(e),t&&this._updateChildNum(t),(0,m.ly)()}if(i.type===n.t.File){let e=i.data.getModel();e.sourceType===s.ov.EverCloud&&({assetId:t}=e)}(0,v.ZB)(t);let a=await i.data.delete(),r=this.getParentFolder(i);return super.deleteFileById(e),r&&this._updateChildNum(r),a}async deleteFolderById(e){let t;let i=super.getFolderById(e);(0,v.ZB)(i,`Folder or file with id ${e} cannot be found, so delete failed.`),i.type===n.t.Folder&&({assetId:t}=i.data),(0,v.ZB)(t);let a=await this._userMaterialsService.deleteMaterials({assetIds:[t],workspaceId:this._params.workspaceId});if(a.ok){let t=this.getParentFolder(i);super.deleteFolderById(e),t&&this._updateChildNum(t)}return a}async fetchMore(e){let{currentFolderId:t}=e,i=this._fetchMoreParamsMap.get(t);if(null==i?void 0:i.fetchMoreMutex.isLocked)return;if(this._foldersNotFetchMoreWhenOpen.has(t)){console.warn("no permission, this folder has been configured not to fetch more"),this._updateFetchParams(t,{isFolderInitialize:!0,hasMore:!1});return}let a=this.getFolderById(t);(0,v.Y2)(a,"folder is undefined when fetch more");let{path:r}=a;if((0,v.Y2)(i,"fetchMoreParams is undefined when fetch more"),await i.fetchMoreMutex.acquire(),!i.hasMore){i.fetchMoreMutex.release();return}i.isFetchingData=!0,i.isFetchFailure=!1,this._onFetchMoreParamsChange.fire();let o=()=>{i.isFetchFailure=!0,i.isFetchingData=!1,this._onFetchMoreParamsChange.fire()};try{var l;let e=await this._userMaterialsService.getUserAssets((0,u.ib)({count:i.count,orderBy:"directory_create",order:1,workspaceId:this._params.workspaceId,parentId:null!==(l=this.currentFolder.data.assetId)&&void 0!==l?l:s.ZF,isCrossFolder:!1,assetTypes:[c.pS.Material,c.pS.Folder,c.pS.Exported],offset:i.offset},[],{hasMore:!0,offset:i.offset}));if(!e.ok){o();return}let{hasMore:a,offset:d,value:p}=e.value,_=[];p.forEach(e=>{if(e.assetType===c.pS.Material&&e.fileType!==s.YB.File){var t,i;let a=(0,w.Q)(e,{fromWorkspaceId:this._params.workspaceId,toWorkspaceId:void 0,fromFolderId:this.currentFolder.data.assetId,toFolderId:void 0,payinPayoutHelper:null===(i=this._params)||void 0===i?void 0:null===(t=i.options)||void 0===t?void 0:t.payinPayoutHelper,containerService:this._containerService});_.push({path:this.formatPathFromArray([r,a.id]),data:a,type:n.t.File})}e.assetType===c.pS.Folder&&_.push({path:this.formatPathFromArray([r,e.assetId]),data:e,type:n.t.Folder})});let{hasAdded:g}=this.batchAddNodes(_,{deduplicationStrategy:h.c.NotAdd});i.offset=d,i.hasMore=a,i.isFetchingData=!1,i.isFetchFailure=!1,i.isFolderInitialize=!0,this._updateFetchParams(t,i),!g&&(i.fetchMoreMutex.release(),i.hasMore&&(i.isFetchingData=!0,this._updateFetchParams(t,i),this.fetchMore({currentFolderId:t})))}catch(e){o()}finally{i.fetchMoreMutex.isLocked&&i.fetchMoreMutex.release()}}getFetchParams(e){return this._fetchMoreParamsMap.get(e)}print(){super.print({formatter:e=>{var t;return null!==(t=e.type===n.t.Folder?e.data.filename:e.data.getModel().filename)&&void 0!==t?t:""}})}_bootstrap(){this._initFetchParamOfCurrentFolder()}_updateChildNum(e){var t;let i=null===(t=this.getFolderChildNodes(null==e?void 0:e.id))||void 0===t?void 0:t.length;e.data.childFileNum=null!=i?i:0,this.dangerouslyUpdateFolder(e.id,e.data)}_updateParentFolderChild(e){let t=this.getParentFolder(e);t&&this._updateChildNum(t)}_initFetchParamOfCurrentFolder(){!this._fetchMoreParamsMap.get(this.currentFolder.id)&&this._fetchMoreParamsMap.set(this.currentFolder.id,this._getDefaultFetchMoreParams())}_updateFetchParams(e,t){let i=this._fetchMoreParamsMap.get(e);(0,v.Y2)(i),this._fetchMoreParamsMap.set(e,{...i,...t}),this._onFetchMoreParamsChange.fire()}_checkDuplicateFileFromCloud(e){let t=e.getModel();if(t.sourceType===s.ov.EverCloud)return!!t.assetId&&this._nodeFromCloudMap.has(t.assetId);return!1}_checkDuplicateFolderFromCloud(e){return this._nodeFromCloudMap.has(e.assetId)}_getDefaultFetchMoreParams(){return{isFetchingData:!1,isFetchFailure:!1,hasMore:!0,count:30,offset:0,isFolderInitialize:!1,fetchMoreMutex:new k.w}}_listenPathChangeAndFetchMore(){this.onPathChange(async e=>{let{action:t}=e;this._initFetchParamOfCurrentFolder(),this._onFetchMoreParamsChange.fire(),t!==o.l.Back&&await this.fetchMore({currentFolderId:this.currentFolder.id}),this._updateFetchParams(this.currentFolder.id,{isFolderInitialize:!0})})}_listenAddAndUpdateNodeMap(){this.onAdd(e=>{e.forEach(e=>{if(e.type===n.t.File){let t=e.data.getModel();if(t.sourceType===s.ov.PublicSpace){let t=e.data.onModelUpdate(()=>{let i=e.data.getModel();i.assetId&&(this._nodeFromCloudMap.set(i.assetId,e),t.dispose())});return}if(t.sourceType===s.ov.EverCloud&&t.fileType!==s.YB.File){if(void 0===t.assetId){if(e.data.status!==l.a.Success){let t=e.data.onModelUpdate(()=>{let i=e.data.getModel();i.assetId&&(this._nodeFromCloudMap.set(i.assetId,e),t.dispose())})}return}this._nodeFromCloudMap.set(t.assetId,e)}}else{let t=e.data;if(void 0===t.assetId)return;this._nodeFromCloudMap.set(t.assetId,e)}})})}_listenFolderNotExistWhenUpload(){this.onAdd(e=>{e.forEach(e=>{if(e.type===n.t.File){let t=e.data;t.onUploadFailure(e=>{if(t.fromWorkspaceId&&(null==e?void 0:e.code)===p.H9.FolderNotExist){let e=this.getFileById(t.id),i=this.extractParentPath(e.path);t.cancelUpload(),i===this.currentPath&&this.open(this.root.id);let a=this.extractCurrentId(i);this.deleteFolderById(a)}})}})})}_duplicateFileAndDeleteExist(e,t){var i;let a=null!==(i=null==t?void 0:t.onlyDeleteFromCache)&&void 0!==i&&i,r=e.getModel();if(r.sourceType===s.ov.EverCloud&&r.assetId){if(this._checkDuplicateFileFromCloud(e)){let e=this._nodeFromCloudMap.get(r.assetId);return a?super.deleteFileById(e.id):this.deleteFileById(e.id),{hasDeleted:!0}}}else(0,b.F)(e.status)&&e.onDidUpload(()=>{this._checkDuplicateFileFromCloud(e)&&this.syncPreorderTraversal(this.root.id,t=>{if(t.type===n.t.File){let i=t.data.getModel(),r=e.getModel();if(i.sourceType===s.ov.EverCloud&&r.sourceType===s.ov.EverCloud&&i.assetId===r.assetId&&i.id!==r.id){let e=t.data;a?super.deleteFileById(e.id):this.deleteFileById(e.id)}}})});return{hasDeleted:!1}}constructor(e,t,i,a){super((0,M.omit)(e,"options")),this._params=e,this._userMaterialsService=t,this._containerService=i,this._notificationService=a,this._fetchMoreParamsMap=new Map,this._onFetchMoreParamsChange=this._store.add(new f.Q),this._nodeFromCloudMap=new Map,this._foldersNotFetchMoreWhenOpen=new Set,this.onFetchMoreParamsChange=this._onFetchMoreParamsChange.event,this._bootstrap(),this._listenPathChangeAndFetchMore(),this._listenAddAndUpdateNodeMap(),this._listenFolderNotExistWhenUpload()}}T=(0,a.gn)([(0,a.fM)(1,_.b),(0,a.fM)(2,d.t),(0,a.fM)(3,g.lT),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IWorkspaceDirectoryManagerOptions?Object:IWorkspaceDirectoryManagerOptions,void 0===_.b?Object:_.b,void 0===d.t?Object:d.t,void 0===g.lT?Object:g.lT])],T)},402144:function(e,t,i){i.d(t,{W:function(){return d}});var a=i(789786),r=i(825686),n=i(782350),o=i(744268),s=i(70031),l=i(800788);class d{get _isSupportMultiWorkSpace(){return this._configurationService.isSupportMultiWorkSpace}async getIsSupportPay(e){if(void 0!==this._isSupportPay)return this._isSupportPay;let t=await this._payinPayoutService.isSupportPay(e);return this._isSupportPay=t,t}async showSpaceNotEnoughModal(e){let{workspaceId:t,payScene:i,reporterParams:a}=e,n=await this.getIsSupportPay(t),o=await this.getNotEnoughCancelType(e),l=await this.getNotEnoughOkType(e);this._payinPayoutService.showSpaceNotEnoughModal({workspaceId:t,reporterParams:{...(0,s.qA)({payScene:i},this._currentPage,r.K1.spaceLimitUpgrade),cancelType:o===s.hU.FREE_UP?"manage":"cancel",okType:[s.mq.EXPAND,s.mq.UPGRADE].includes(l)?"expansion":"manage",...null!=a?a:{}},modalProps:(0,s.Je)({payScene:i,isSpaceRoleSupportPay:this._payinPayoutService.isSpaceRoleSupportPay(t),isSupportPay:n,isSupportMultiWorkSpace:this._isSupportMultiWorkSpace,workspaceList:this._workspaceService.workspaceList,activateWorkspaceInfo:this._workspaceService.workspaceList.find(e=>e.workspace_id===t)})})}showExpandModal(e){var t;let{workspaceId:i,payScene:a,pageFrom:r,isUpgrade:n,reporterParams:o}=e;this._payinPayoutService.showPayModal({workspaceId:i,reporterParams:{...o,...(0,s.qA)({payScene:a},this._currentPage||(null===(t=e.reporterParams)||void 0===t?void 0:t.currentPage),r,null==o?void 0:o.pageFromExtra,null==o?void 0:o.reportVipInfo)},isUpgrade:n})}showPayUploadFullSpaceModal(e){let{workspaceId:t,payScene:i,uploadFileList:a}=e;this._payinPayoutService.showPayUploadFullSpaceModal({workspaceId:t,reporterParams:(0,s.qA)({payScene:i},this._currentPage,r.K1.spaceLimitUpgrade),uploadFileList:a})}addListenNotEnoughModalOK(e){if(!!e)this._payinPayoutService.onDidOk(e)}addListenNotEnoughModalCancel(e){if(!!e)this._payinPayoutService.onDidCancel(e)}addListenPaySuccess(e){if(!!e)this._payinPayoutService.onDidPaySuccess(e)}addListenPayFailed(e){if(!!e)this._payinPayoutService.onDidPayFailed(e)}triggerOnNotEnoughModalOK(e){(0,l.ss)("not implemented")}triggerOnNotEnoughModalCancel(e){(0,l.ss)("not implemented")}async getNotEnoughOkType(e){let{workspaceId:t,payScene:i}=e,a=await this.getIsSupportPay(t);return(0,s.mY)({payScene:i,isSpaceRoleSupportPay:this._payinPayoutService.isSpaceRoleSupportPay(t),isSupportPay:a,isSupportMultiWorkSpace:this._isSupportMultiWorkSpace,workspaceList:this._workspaceService.workspaceList})}async getNotEnoughCancelType(e){let{workspaceId:t,payScene:i}=e,a=await this.getIsSupportPay(t);return(0,s.MY)({payScene:i,isSpaceRoleSupportPay:this._payinPayoutService.isSpaceRoleSupportPay(t),isSupportPay:a})}constructor(e,t,i){this._payinPayoutService=e,this._workspaceService=t,this._configurationService=i,this._currentPage=""}}d=(0,a.gn)([(0,a.fM)(0,r.sX),(0,a.fM)(1,n.W),(0,a.fM)(2,o.Ui),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===r.sX?Object:r.sX,void 0===n.W?Object:n.W,void 0===o.Ui?Object:o.Ui])],d)},884058:function(e,t,i){i.d(t,{c:function(){return n}});var a=i(426336),r=i(127830);function n(e,t,i,n){let o=e.draftView.getSegmentById(n);if(!o||!(0,a.ot2)(o))return;let[s]=function(e){var t,i;if(!(0,a.ot2)(e)||!e.materialDraft)return[];let r=e.materialDraft.draft.getSegmentsByTrackType(a.pNd.TrackTypeVideo);if(!r.length)return[];let n=null===(i=e.materialDraft.draft.getMainTrack())||void 0===i?void 0:null===(t=i.segments)||void 0===t?void 0:t[0];return r.sort((e,t)=>e.id===(null==n?void 0:n.id)?-1:t.id===(null==n?void 0:n.id)?1:e.targetTimerange.duration-t.targetTimerange.duration>0n?-1:1),r}(o);if(!s)return;let l=i(s.material.path);if(!!l)return t.get(l,r._g.Video)}},535379:function(e,t,i){i.d(t,{X:function(){return s}});var a=i(690613),r=i(127830),n=i(917786);async function o(e,t){let i=[];t.forEach(e=>{let{longPreviewMaskId:t}=e;t&&i.push(t)});let r=await e.batchGetVideos({resourceIds:i});if(!r.ok)return r;let{value:n}=r;return(0,a.oW)(n.list)}async function s(e,t,i){if(!(0,n.Q)(t))return(0,a.oW)([]);let s=i.filter(e=>e.resource.type===r._g.DigitalHuman);if(!s.length)return(0,a.oW)([]);let l=s.map(e=>e.resource);return await o(e,l)}},928261:function(e,t,i){i.d(t,{IM:function(){return d},LG:function(){return f},QB:function(){return v},Xe:function(){return o},_n:function(){return p},be:function(){return _},gG:function(){return h},hi:function(){return s},ki:function(){return g},oP:function(){return n},rE:function(){return u},t4:function(){return r},uG:function(){return c},yV:function(){return m}});var a=i(426336);let r=["video","effect","videoEffect","audio","filter","text","textTemplate","sticker","imageSticker","pictureAdjust","adjust","tailLeader","mutable","mutablePoly","mutableAudio","combination","transition","dragVideoPlaceholder","dragAudioPlaceholder","handwrite"],n=["video","videoEffect","audio","filter","text","textTemplate","sticker","effect"];function o(e){return(null==e?void 0:e.type)==="transition"}function s(e){return(null==e?void 0:e.type)==="transition"}let l={video:!0,effect:!0,videoEffect:!0,audio:!0,filter:!0,text:!0,textTemplate:!0,sticker:!0,imageSticker:!0,pictureAdjust:!0,tailLeader:!0,mutable:!0,mutablePoly:!0,mutableAudio:!1,combination:!0};function d(e){return!!l[null==e?void 0:e.type]}function c(e){return(null==e?void 0:e.type)==="combination"}function u(e){return!!e&&void 0!==e.children}function h(e){if(!e)return!1;let{locked:t,filled:i}=e;return!t&&void 0!==i}function p(e){if(!e)return!1;let{locked:t}=e;return t}function _(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return e=>t.includes(e.type)}let g=[a.pNd.TrackTypeVideo,a.pNd.TrackTypeSticker,a.pNd.TrackTypeText,a.pNd.TrackTypeVideoEffect,a.pNd.TrackTypeFilter,a.pNd.TrackTypeAdjust],f=[a.pNd.TrackTypeSticker,a.pNd.TrackTypeText,a.pNd.TrackTypeVideoEffect,a.pNd.TrackTypeFilter,a.pNd.TrackTypeAdjust],m=[a.pNd.TrackTypeVideo],v=[a.pNd.TrackTypeAudio]},424369:function(e,t,i){i.d(t,{x:function(){return M}});var a=i(772322);i(853675),i(17435),i(55041),i(701840);var r=i(544633),n=i(302204),o=i(629913),s=i(519065),l=i(794571),d=i(298991),c=i(781566),u=i(374904),h=i(105789),p=i.n(h),_=i(989719),g=i(218571);i(513280);var f=i(150564);let{Item:m,SubMenu:v}=s.Z,y=e=>{e.preventDefault(),e.stopPropagation()},S=d.HM;function k(){return(0,a.jsx)(l.Z,{type:"horizontal",className:"contextmenu-divider"})}function w(e,t){let{icon:i,title:r,shortcut:s,onClick:l,disabled:d,onFileChange:h,tooltip:g,isFileUploader:v,isSelected:w,isSupportMultiUpload:M,needDivider:b,accept:T}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(m,{onClick:v?_.Z:l,onMouseDown:y,className:p()("contextmenu-item"),disabled:"function"==typeof d?d():d,children:[(0,a.jsx)(o.Z,{content:g,position:"bottom",children:(0,a.jsxs)("div",{className:"contextmenu-item-left",children:[i&&(0,a.jsx)("div",{className:"contextmenu-item-icon",children:(0,a.jsx)(i,{})}),(0,a.jsx)(n.Z.Text,{className:"contextmenu-item-title","data-lv-theme-force":"dark",ellipsis:{cssEllipsis:!0,showTooltip:!g,rows:1},children:r})]})}),(0,a.jsx)("div",{className:"contextmenu-item-shortcut",children:s}),v&&function(e,t,i,r){let n=`${u.NF.image.accept},${u.NF.video.accept}`;return(0,a.jsx)(c.b,{className:"contextmenu-file-uploader",onChange:e=>{null==t||t(e),S()},onClick:t=>{t.stopPropagation(),null==e||e(t)},onMouseDown:y,multiple:null!=i&&i,accept:null!=r?r:n})}(l,h,M,T),w&&(0,a.jsx)("div",{className:"contextmenu-item-selected",children:(0,a.jsx)("div",{className:"contextmenu-item-icon",children:(0,a.jsx)(f.JrY,{className:"contextmenu-item-selected-icon",height:16,width:16,color:"#5BC7DD"})})})]},r),("function"==typeof b?b():b)&&!t&&k()]})}let M=e=>{let{config:t}=e,i=(0,g.useRef)(null);(0,g.useEffect)(()=>{var e;let t=e=>e.stopPropagation();return null===(e=i.current)||void 0===e||e.addEventListener("mousedown",t),()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.removeEventListener("mousedown",t)}},[]);let n=(0,r.default)(e=>{y(e),S()}),o=t.filter(e=>e.isShow);return(0,a.jsx)(s.Z,{className:"contextmenu-wrapper",mode:"pop",onClick:n,onMouseDown:n,ref:i,onContextMenu:e=>{e.preventDefault()},children:o.map((e,t)=>{let{type:i}=e;switch(i){case"menu":return w(e,t===o.length-1);case"subMenu":return function(e,t){let{title:i,subMenuItems:r,icon:n,needDivider:o}=e,s=null==r?void 0:r.filter(e=>e.isShow);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v,{className:"contextmenu-item",title:(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"contextmenu-item-left",children:[n&&(0,a.jsx)("div",{className:"contextmenu-item-icon",children:(0,a.jsx)(n,{})}),(0,a.jsx)("div",{className:"contextmenu-item-title",children:i})]})}),triggerProps:{trigger:"hover",showArrow:!1,className:"contextmenu-sub-wrapper",popupAlign:{right:4}},children:null==s?void 0:s.map((e,t)=>w(e,t===s.length-1))},i),("function"==typeof o?o():o)&&!t&&k()]})}(e,t===o.length-1);default:return null}})})}},804163:function(e,t,i){i.d(t,{Bt:function(){return n},Jf:function(){return s},XF:function(){return o}});var a,r=i(435359);var n=((a={})[a.CropRatioFree=0]="CropRatioFree",a[a.CropRatio16To9=1]="CropRatio16To9",a[a.CropRatio9To16=2]="CropRatio9To16",a[a.CropRatio4To3=3]="CropRatio4To3",a[a.CropRatio3To4=4]="CropRatio3To4",a[a.CropRatio1To1=5]="CropRatio1To1",a[a.CropRatio2To1=6]="CropRatio2To1",a[a.CropRatio2_35To1=7]="CropRatio2_35To1",a[a.CropRatio1_85To1=8]="CropRatio1_85To1",a[a.CropRatio1_125To2_436=9]="CropRatio1_125To2_436",a);let o={[r.zl.FREE]:0,[r.zl.ORIGINAL]:0,[r.zl.RATIO_1_1]:1,[r.zl.RATIO_2_1]:2,[r.zl.RATIO_3_4]:3/4,[r.zl.RATIO_4_3]:4/3,[r.zl.RATIO_16_9]:16/9,[r.zl.RATIO_9_16]:9/16,[r.zl.MUTABLE_FIXED]:-1},s=10;r.zl.FREE,r.zl.RATIO_1_1,r.zl.RATIO_2_1,r.zl.RATIO_9_16,r.zl.RATIO_16_9,r.zl.RATIO_3_4,r.zl.RATIO_4_3},435359:function(e,t,i){i.d(t,{M$:function(){return n},zl:function(){return o}});var a,r,n=((a={}).move_frame="move_frame",a.custom_scale="custom_scale",a);var o=((r={}).FREE="FREE",r.ORIGINAL="ORIGINAL",r.RATIO_1_1="RATIO_1_1",r.RATIO_2_1="RATIO_2_1",r.RATIO_3_4="RATIO_3_4",r.RATIO_4_3="RATIO_4_3",r.RATIO_16_9="RATIO_16_9",r.RATIO_9_16="RATIO_9_16",r.MUTABLE_FIXED="MUTABLE_FIXED",r)},804612:function(e,t,i){i.d(t,{A:function(){return o}});var a=i(772322);i(218571);var r=i(584341),n=i(344686);let o=e=>{let{name:t,background:i,duration:o,visible:s,preAttachView:l,postAttachView:d,format:c}=e;return(0,a.jsx)("div",{className:n.Z.container,style:{background:i,visibility:s?"visible":"hidden"},children:(0,a.jsxs)("div",{className:n.Z.segmentWrapper,children:[l,(0,a.jsx)("div",{className:n.Z.info,children:(0,a.jsx)("span",{className:n.Z.name,children:t})}),(0,a.jsx)("div",{className:n.Z.info,style:{marginLeft:"4px"},children:(0,a.jsx)("span",{className:n.Z.duration,children:(0,r.ci)(1e3*o,c)})}),d]})})}},723777:function(e,t,i){i.d(t,{N:function(){return o}});var a=i(772322),r=i(804612),n=i(690984);let o=e=>{var t,i;let{imageInfo:o,segmentInfo:s,currentHoverTarget:l,preAttachView:d,postAttachView:c}=e,u=null!==(t=o.disabled)&&void 0!==t?t:"timeline"===l;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.A,{name:s.name,duration:s.duration,background:s.background,format:"?mm:ss:ff",visible:u,preAttachView:d,postAttachView:c}),(0,a.jsx)(n.K,{url:null!==(i=o.url)&&void 0!==i?i:"",withCredentials:o.withCredentials,visible:!u})]})}},306909:function(e,t,i){i.d(t,{Z:function(){return l}});var a=i(772322);i(784923);var r=i(498417),n=i(195291);i(656596);let o=(e,t,i)=>{var o,l;let d=null==i?void 0:null===(o=i.getContainer)||void 0===o?void 0:o.call(i);if(!d)return null===r.Z||void 0===r.Z?void 0:null===(l=r.Z[e])||void 0===l?void 0:l.call(r.Z,t);let c="string"==typeof t?{content:t,type:e}:{...t,type:e},u="";function h(e){var t;if(!e)return;let{top:i,left:a,width:r}=d.getBoundingClientRect();e.style.width=`${r}px`,e.style.top=`${i+24}px`,e.style.left=`${a}px`;let n=(null!==(t=null==d?void 0:d.className)&&void 0!==t?t:"").split(" "),o=n.length?n.map(e=>`${e}__ve-message-wrapper`).join(" "):"";e.className=`${e.className} ${o}`}if(s.instances.has(d)){let e=s.instances.get(d);u=null==e?void 0:e.add(c),h(null==e?void 0:e.__dom)}else{let e=document.createElement("div");e.classList.add("ve-message-wrapper"),(0,n.render)((0,a.jsx)(r.Z,{ref:t=>{var i;u=null!==(i=null==t?void 0:t.add(c))&&void 0!==i?i:"",t.__dom=e,s.instances.set(d,t)}}),e),h(e),document.body.appendChild(e)}return()=>{var e;u&&(null===(e=s.instances.get(d))||void 0===e||e.remove(u))}};class s extends r.Z{}s.instances=new Map,s.success=(e,t)=>o("success",e,t),s.info=(e,t)=>o("info",e,t),s.warning=(e,t)=>o("warning",e,t),s.error=(e,t)=>o("error",e,t),s.loading=(e,t)=>o("loading",e,t),s.normal=(e,t)=>o("normal",e,t);let l=s},61855:function(e,t,i){i.d(t,{l:function(){return a},t:function(){return r}});let a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",r="auto-replace-ok-button"},606386:function(e,t,i){i.d(t,{b:function(){return a}});let a=/^\/editor-template\/?/.test(window.location.pathname)?"/editor-template/:draftId":/^\/ssr-editor\//.test(window.location.pathname)?"/ssr-editor/:draftId":"/editor/:draftId"},210270:function(e,t,i){i.d(t,{K:function(){return a}});let a={ERR_SIGN:"1014",ERR_LOGIN:"1015",ERR_PARAM:"1016",ERR_NO_PERMISSION:"1017",ERR_DRAFT_PARSE_ERROR:"2002",ERR_GET_DRAFT_TEMPLATE_FILE_ERROR:"2003",ERR_GET_DRAFT_VERSION_LIST_ERROR:"2004",ERR_DRAFT_NOT_FOUND:"2005",ERR_SAVE_DRAFT:"2001",ERR_DRAFT_VERSION_CONFLICT:"2006",ERR_DRAFT_TYPE_ERROR:"2007",ERR_DRAFT_BROKEN:"2008",ERR_DRAFT_NOT_COMPLETE:"2009",ERR_DRAFT_DUPLICATE_CREATION:"2013",ERR_MUTATION_CHECK:"2014"}},70246:function(e,t,i){i.d(t,{D3:function(){return r},NW:function(){return n}});var a=i(210270);let r={BELOW_VERSION:40008,INSUFFICIENT_SPACE:20113,INVALID_NAME:40031,INVALID_MATERIAL_NAME:24001,DELETED_PACKAGE:40004,DELETED_MATERIAL:1e4,INVALID_MATERIAL:40006,INVALID_FORMAT:200206,INVALID_MATERIAL_INFORMATION:200204,INVALID_TOKEN:20127,AUTO_SAVE_OVERFLOW:-10001,EXT_NOT_MATCH_FORMAT:20233,ENCODING_NOT_SUPPORTED:20209,EXCEED_SIZE_LIMIT:-20001,INVALID_FORMAT_LOCAL:-20002,NETWORK_ERROR:300},n={[a.K.ERR_DRAFT_VERSION_CONFLICT]:r.BELOW_VERSION,[a.K.ERR_DRAFT_NOT_FOUND]:r.DELETED_PACKAGE,[a.K.ERR_DRAFT_NOT_COMPLETE]:r.DELETED_MATERIAL}},507828:function(e,t,i){i.d(t,{yv:function(){return n}});var a=i(772322),r=i(801497);let n=[{key:"select-all",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_select_all",{},"Select all")}),bindings:{windows:"ctrl+a",osx:"meta+a"},scene:["editor"],displayConfig:{category:"Globe"}},{key:"multi-select",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_Multi_selection",{},"\u591A\u9009")}),bindings:{windows:"ctrl+click",osx:"meta+click"},scene:["editor"],displayConfig:{category:"Globe"}},{key:"split",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("split_web",{},"\u5206\u5272")}),bindings:{windows:"ctrl+b",osx:"meta+b"},scene:["editor"],displayConfig:{category:"Timeline"}},{key:"zoom-in",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("zoom_web_i_web_n",{},"\u8F68\u9053\u653E\u5927")}),bindings:{windows:"ctrl+plus",osx:"meta+plus"},scene:["editor","editor-template"],displayConfig:{category:"Timeline"}},{key:"zoom-out",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("zoom_web_ou_web_t",{},"\u8F68\u9053\u7F29\u5C0F")}),bindings:{windows:"ctrl+-",osx:"meta+-"},scene:["editor","editor-template"],displayConfig:{category:"Timeline"}},{key:"scroll-vertical",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("timeline_scrolls_up_and_down",{},"\u65F6\u95F4\u7EBF\u4E0A\u4E0B\u6EDA\u52A8")}),bindings:{windows:"scroll",osx:"scroll"},ignore:!0,scene:["editor"],displayConfig:{category:"Timeline"}},{key:"scroll-horizontal",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("timeline_scrolls_left_and_right",{},"\u65F6\u95F4\u7EBF\u5DE6\u53F3\u6EDA\u52A8")}),bindings:{windows:"shift+scroll",osx:"shift+scroll"},ignore:!0,scene:["editor"],displayConfig:{category:"Timeline"}},{key:"previous",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("last_web_frame",{},"\u4E0A\u4E00\u5E27")}),bindings:{windows:"ctrl+left",osx:"meta+left"},scene:["editor","editor-template"],displayConfig:{category:"Timeline"}},{key:"next",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("next_web_fram_web_e",{},"\u4E0B\u4E00\u5E27")}),bindings:{windows:"ctrl+right",osx:"meta+right"},scene:["editor","editor-template"],displayConfig:{category:"Timeline"}},{key:"copy",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("copy_web",{},"\u590D\u5236")}),bindings:{windows:"ctrl+c",osx:"meta+c"},scene:["editor"],displayConfig:{category:"Globe"}},{key:"cut",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("cut_web",{},"\u526A\u5207")}),bindings:{windows:"ctrl+x",osx:"meta+x"},scene:["editor"],displayConfig:{category:"Globe"}},{key:"paste",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("past_web_e",{},"\u7C98\u8D34")}),bindings:{windows:"ctrl+v",osx:"meta+v"},scene:["editor"],displayConfig:{category:"Globe"}},{key:"delete",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("delete_web",{},"\u5220\u9664")}),bindings:{windows:["backspace","del","delete"],osx:["backspace","del","delete"]},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"backspace",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("delete_web",{},"\u5220\u9664")}),bindings:{windows:"backspace",osx:"backspace"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"undo",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("Undo_web",{},"\u64A4\u9500")}),bindings:{windows:"ctrl+z",osx:"meta+z"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"redo",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("red_web_o",{},"\u6062\u590D")}),bindings:{windows:"ctrl+shift+z",osx:"shift+meta+z"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"redo-backup",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("red_web_o",{},"\u6062\u590D")}),bindings:{windows:"ctrl+y",osx:"meta+y"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"up",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_up",{},"Up")}),bindings:{windows:"up",osx:"up"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"left",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_left",{},"Left")}),bindings:{windows:"left",osx:"left"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"right",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_right",{},"Right")}),bindings:{windows:"right",osx:"right"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"down",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_down",{},"Down")}),bindings:{windows:"down",osx:"down"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"up10",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_up_10",{},"Up 10px")}),bindings:{windows:"shift+up",osx:"shift+up"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"left10",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_left_10",{},"Left 10px")}),bindings:{windows:"shift+left",osx:"shift+left"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"right10",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_right_10",{},"Right 10px")}),bindings:{windows:"shift+right",osx:"shift+right"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"down10",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_down_10",{},"Down 10px")}),bindings:{windows:"shift+down",osx:"shift+down"},scene:["editor","editor-template"],displayConfig:{visible:!1}},{key:"previous-slot",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_last_slot",{},"\u4E0A\u4E00\u69FD\u4F4D")}),bindings:{windows:"ctrl+shift+left",osx:"shift+meta+left"},scene:["editor-template"],displayConfig:{category:"Timeline"}},{key:"next-slot",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_next_slot",{},"\u4E0B\u4E00\u69FD\u4F4D")}),bindings:{windows:"ctrl+shift+right",osx:"shift+meta+right"},scene:["editor-template"],displayConfig:{category:"Timeline"}},{key:"preview-line",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_curvespeed_text_tunnonoff_axis",{},"Turn on/off preview axis")}),bindings:{windows:"s",osx:"s"},scene:["editor"],displayConfig:{category:"Timeline"}},{key:"play-pause",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("play_web_puse",{},"\u64AD\u653E/\u6682\u505C")}),bindings:{windows:"space",osx:"space"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"newline",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("text_wrapping",{},"\u6587\u672C\u6362\u884C")}),bindings:{windows:"ctrl+enter",osx:"meta+enter"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"split-sentence",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_split_sentence",{},"Split sentence")}),bindings:{windows:"enter",osx:"enter"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"toggle-sidebar",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("expand_web_collapse_web_material",{},"\u5C55\u5F00/\u6536\u8D77\u7D20\u6750\u9762\u677F")}),bindings:{windows:"ctrl+/",osx:"meta+/"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"toggle-timeline",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_visualPolish_button_clickPanel",{},"Show/hide timeline")}),bindings:{windows:"ctrl+.",osx:"meta+."},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"import",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("import_web",{},"\u5BFC\u5165\u5A92\u4F53")}),bindings:{windows:"ctrl+i",osx:"meta+i"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"export",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("export_web_vid_eo",{},"\u5BFC\u51FA")}),bindings:{windows:"ctrl+e",osx:"meta+e"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"save",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("save_web",{},"\u4FDD\u5B58")}),bindings:{windows:"ctrl+s",osx:"meta+s"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"exit",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("exi_web_t",{},"\u9000\u51FA")}),bindings:{windows:"esc",osx:"esc"},scene:["editor","editor-template"],displayConfig:{category:"Globe"}},{key:"adsorb",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("attach_web",{},"\u5438\u9644\u5F00\u5173")}),bindings:{windows:"n",osx:"n"},scene:["editor"],displayConfig:{category:"Timeline"}},{key:"detach-audio",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("separate/restore_audio",{},"\u5206\u79BB/\u8FD8\u539F\u97F3\u9891")}),bindings:{windows:"ctrl+shift+s",osx:"shift+meta+s"},scene:["editor"],displayConfig:{category:"Timeline"}},{key:"fullscreen",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_fullscreen",{},"Fullscreen")}),bindings:{windows:"ctrl+shift+f",osx:"shift+meta+f"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"move",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_move",{},"Move")}),bindings:{windows:"V",osx:"V"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"hand-tool",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_hand_tool",{},"Hand tool")}),bindings:{windows:"H",osx:"H"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"canvas-zoom-in",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_zoom_in",{},"Zoom in")}),bindings:{windows:"shift+equal",osx:"shift+equal"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"canvas-zoom-out",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_zoom_out",{},"Zoom out")}),bindings:{windows:"shift+minus",osx:"shift+minus"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"canvas-zoom-to-fit",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_zoom_to_fit",{},"Zoom to fit")}),bindings:{windows:"shift+f",osx:"shift+f"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"canvas-zoom-to-50",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_zoom_to_fifty",{},"Zoom to 50%")}),bindings:{windows:"shift+0",osx:"shift+0"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"canvas-zoom-to-100",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_zoom_to_one_hundred",{},"Zoom to 100%")}),bindings:{windows:"shift+1",osx:"shift+1"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"canvas-zoom-to-200",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_check_hot_key_text_zoom_to_two_hundred",{},"Zoom to 200%")}),bindings:{windows:"shift+2",osx:"shift+2"},scene:["editor","editor-template"],displayConfig:{category:"Canva"}},{key:"toggle-beat",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_musicbeat_button_move_add_beat",{},"Add/Remove beats")}),bindings:{windows:"M",osx:"M"},scene:["editor"],displayConfig:{category:"Timeline"}},{key:"duplicate",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_overlay_button_duplicate",{},"Duplicate")}),bindings:{windows:"ctrl+d",osx:"meta+d"},scene:["editor"],displayConfig:{category:"Globe"}},{key:"flip-horizontal",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_overlay_button_flip_horizon",{},"Flip horizontally")}),bindings:{windows:"shift+h",osx:"shift+h"},scene:["editor"],displayConfig:{category:"Globe"}},{key:"flip-vertical",title:()=>(0,a.jsx)(a.Fragment,{children:r.ZP.t("web_overlay_button_flip_vertical",{},"Flip vertically")}),bindings:{windows:"shift+v",osx:"shift+v"},scene:["editor"],displayConfig:{category:"Globe"}}]},854585:function(e,t,i){i.d(t,{DZ:function(){return c},De:function(){return d},Yr:function(){return s},i$:function(){return r},rJ:function(){return n},t6:function(){return l},yD:function(){return o}});var a=i(426336);let r=[a.cVg.MetaTypeMusic,a.cVg.MetaTypeSound,a.cVg.MetaTypeTextToAudio,a.cVg.MetaTypeRecord,a.cVg.MetaTypeExtractMusic,a.cVg.MetaTypeVideoOriginalSound],n=[a.cVg.MetaTypeVideo],o=[a.cVg.MetaTypePhoto,a.cVg.MetaTypeImage,a.cVg.MetaTypeGif],s=[...n,...o],l=[a.C3w.MetaTypeMusic,a.C3w.MetaTypeSound,a.C3w.MetaTypeTextToAudio,a.C3w.MetaTypeRecord,a.C3w.MetaTypeExtractMusic,a.C3w.MetaTypeVideoOriginalSound],d=[a.C3w.MetaTypeVideo],c=[a.C3w.MetaTypePhoto,a.C3w.MetaTypeImage,a.C3w.MetaTypeGif];[...d,...c]},358793:function(e,t,i){i.d(t,{M:function(){return a}});let a=["image/heic"]},850649:function(e,t,i){i.d(t,{Fu:function(){return d},SZ:function(){return c},Yq:function(){return p}});var a,r=i(772322),n=i(271368),o=i(537783),s=i(589032),l=i(995370);var d=((a={}).SPLIT="split",a.TOGGLE_TIMELINE="toggle-timeline",a.COPY="copy",a.DELETE="delete",a.CUT="cut",a.PASTE="paste",a.DUPLICATE="duplicate",a.FLIP_HORIZONTAL="flip-horizontal",a.FLIP_VERTICAL="flip-vertical",a.SELECT_ALL="select-all",a.TIMELINE_ZOOM_IN="timeline-zoom-in",a.TIMELINE_ZOOM_OUT="timeline-zoom-out",a.ADSORB="adsorb",a.PREVIEW_LINE="preview-line",a.NEXT="next",a.PREVIOUS="previous",a.PREVIOUS_SLOT="previous-slot",a.NEXT_SLOT="next-slot",a.TOGGLE_BEAT="toggle-beat",a.DETACH_AUDIO="detach-audio",a.FULLSCREEN="fullscreen",a.EXIT="exit",a.MOVE="move",a.HAND_TOOL="hand-tool",a.CANVAS_ZOOM_IN="canvas-zoom-in",a.CANVAS_ZOOM_OUT="canvas-zoom-out",a.CANVAS_ZOOM_TO_FIT="canvas-zoom-to-fit",a.CANVAS_ZOOM_TO_50="canvas-zoom-to-50",a.CANVAS_ZOOM_TO_100="canvas-zoom-to-100",a.CANVAS_ZOOM_TO_200="canvas-zoom-to-200",a.PLAY_OR_PAUSE="play_or_pause",a);let c=["toggle-timeline","exit","timeline-zoom-in","timeline-zoom-out","previous","next","preview-line","fullscreen","move","hand-tool","canvas-zoom-in","canvas-zoom-out","canvas-zoom-to-fit","canvas-zoom-to-50","canvas-zoom-to-100","canvas-zoom-to-200","play_or_pause"];function u(e){let t=[];return t="string"==typeof e?(0,s.H)(e):(e.find(e=>"del"===e)?e.filter(e=>"delete"!==e):e).map(e=>(0,s.H)(e)).reduce((e,t)=>e.length?e.length&&t.length?[...e,(0,r.jsx)("span",{className:"divide",children:"/"},"divide"),...t]:e:t,[]),(0,r.jsx)("div",{className:"shortcut",children:t})}let h=l.V5||l.gn,p={adsorb:{keyBindings:{win:[n.VD.N],mac:[n.VD.N]},visual:u("N"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("attach_web",{},"\u5438\u9644\u5F00\u5173")})}},copy:{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.C],mac:[n.N9.COMMAND+n.VD.C]},visual:u(h?"meta+C":"ctrl+C"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("copy_web",{},"\u590D\u5236")})}},cut:{keyBindings:{mac:[n.N9.COMMAND+n.VD.X],win:[n.N9.CTRL_WIN+n.VD.X]},visual:u(h?"meta+X":"ctrl+X"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("cut_web",{},"\u526A\u5207")})}},paste:{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.V],mac:[n.N9.COMMAND+n.VD.V]},visual:u(h?"meta+V":"ctrl+V"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("past_web_e",{},"\u7C98\u8D34")})}},duplicate:{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.D],mac:[n.N9.COMMAND+n.VD.D]},visual:u(h?"meta+d":"ctrl+d"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_overlay_button_duplicate",{},"Duplicate")})}},"flip-horizontal":{keyBindings:{win:[n.N9.SHIFT+n.VD.H],mac:[n.N9.SHIFT+n.VD.H]},visual:u("shift+h"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_overlay_button_flip_horizon",{},"Flip horizontally")})}},"flip-vertical":{keyBindings:{win:[n.N9.SHIFT+n.VD.V],mac:[n.N9.SHIFT+n.VD.V]},visual:u("shift+v"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_overlay_button_flip_vertical",{},"Flip vertically")})}},delete:{keyBindings:{win:[n.VD.BACKSPACE,n.VD.DELETE],mac:[n.VD.BACKSPACE,n.VD.DELETE]},visual:u(["backspace","del","delete"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("delete_web",{},"\u5220\u9664")})}},split:{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.B],mac:[n.N9.COMMAND+n.VD.B]},visual:u(h?"meta+B":"ctrl+B"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("split_web",{},"\u5206\u5272")})}},"timeline-zoom-in":{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.EQUAL],mac:[n.N9.COMMAND+n.VD.EQUAL]},visual:u(h?"meta+plus":"ctrl+plus"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("zoom_web_i_web_n",{},"\u8F68\u9053\u653E\u5927")})}},"timeline-zoom-out":{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.MINUS],mac:[n.N9.COMMAND+n.VD.MINUS]},visual:u(h?"meta+-":"ctrl+-"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("zoom_web_ou_web_t",{},"\u8F68\u9053\u7F29\u5C0F")})}},"toggle-beat":{keyBindings:{win:[n.VD.M],mac:[n.VD.M]},visual:u("M"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_musicbeat_button_move_add_beat",{},"Add/Remove beats")})}},"detach-audio":{keyBindings:{win:[n.N9.CTRL_WIN+n.N9.SHIFT+n.VD.S],mac:[n.N9.COMMAND+n.N9.SHIFT+n.VD.S]},visual:u(h?"shift+meta+s":"ctrl+shift+s"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("separate/restore_audio",{},"\u5206\u79BB/\u8FD8\u539F\u97F3\u9891")})}},next:{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.ARROW_RIGHT],mac:[n.N9.COMMAND+n.VD.ARROW_RIGHT]},visual:u(h?"meta+right":"ctrl+right"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("next_web_fram_web_e",{},"\u4E0B\u4E00\u5E27")})}},previous:{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.ARROW_LEFT],mac:[n.N9.COMMAND+n.VD.ARROW_LEFT]},visual:u(h?"meta+left":"ctrl+left"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("last_web_frame",{},"\u4E0A\u4E00\u5E27")})}},"next-slot":{keyBindings:{win:[n.N9.CTRL_WIN+n.N9.SHIFT+n.VD.ARROW_RIGHT],mac:[n.N9.SHIFT+n.N9.COMMAND+n.VD.ARROW_RIGHT]},visual:u(h?["meta+shift+right"]:["ctrl+shift+right"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_next_slot",{},"\u4E0B\u4E00\u69FD\u4F4D")})}},"previous-slot":{keyBindings:{win:[n.N9.CTRL_WIN+n.N9.SHIFT+n.VD.ARROW_LEFT],mac:[n.N9.SHIFT+n.N9.COMMAND+n.VD.ARROW_LEFT]},visual:u(h?["meta+shift+left"]:["ctrl+shift+left"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_last_slot",{},"\u4E0A\u4E00\u69FD\u4F4D")})}},"preview-line":{keyBindings:{win:[n.VD.S],mac:[n.VD.S]},visual:u("S"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_curvespeed_text_tunnonoff_axis",{},"Turn on/off preview axis")})}},"toggle-timeline":{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.PERIOD],mac:[n.N9.COMMAND+n.VD.PERIOD]},visual:u(h?"meta+.":"ctrl+."),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_visualPolish_button_clickPanel",{},"Show/hide timeline")})}},"select-all":{keyBindings:{win:[n.N9.CTRL_WIN+n.VD.A],mac:[n.N9.COMMAND+n.VD.A]},visual:u(h?"meta+A":"ctrl+A"),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_select_all",{},"Select all")})}},fullscreen:{keyBindings:{win:[n.N9.CTRL_WIN+n.N9.SHIFT+n.VD.F],mac:[n.N9.COMMAND+n.N9.SHIFT+n.VD.F]},visual:u(h?["shift+meta+F"]:["shift+ctrl+F"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_materialSearch_button_full_screen",{},"Full screen")})}},exit:{keyBindings:{win:[n.VD.ESCAPE],mac:[n.VD.ESCAPE]},visual:u(["ESCAPE"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("exi_web_t",{},"\u9000\u51FA")})}},move:{keyBindings:{win:[n.VD.V],mac:[n.VD.V]},visual:u(["V"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_move",{},"Move")})}},"hand-tool":{keyBindings:{win:[n.VD.H],mac:[n.VD.H]},visual:u(["H"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_hand_tool",{},"Hand tool")})}},"canvas-zoom-in":{keyBindings:{win:[n.N9.SHIFT+n.VD.NUM_MINUS],mac:[n.N9.SHIFT+n.VD.NUM_MINUS]},visual:u(["shift+equal"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_zoom_in",{},"Zoom in")})}},"canvas-zoom-out":{keyBindings:{win:[n.N9.SHIFT+n.VD.NUM_PLUS],mac:[n.N9.SHIFT+n.VD.NUM_PLUS]},visual:u(["shift+minus"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_zoom_out",{},"Zoom out")})}},"canvas-zoom-to-fit":{keyBindings:{win:[n.N9.SHIFT+n.VD.F],mac:[n.N9.SHIFT+n.VD.F]},visual:u(["shift+F"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_zoom_to_fit",{},"Zoom to fit")})}},"canvas-zoom-to-50":{keyBindings:{win:[n.N9.SHIFT+n.VD.NUM_0],mac:[n.N9.SHIFT+n.VD.NUM_0]},visual:u(["shift+0"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_zoom_to_fifty",{},"Zoom to 50%")})}},"canvas-zoom-to-100":{keyBindings:{win:[n.N9.SHIFT+n.VD.NUM_1],mac:[n.N9.SHIFT+n.VD.NUM_1]},visual:u(["shift+1"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_zoom_to_one_hundred",{},"Zoom to 100%")})}},"canvas-zoom-to-200":{keyBindings:{win:[n.N9.SHIFT+n.VD.NUM_2],mac:[n.N9.SHIFT+n.VD.NUM_2]},visual:u(["shift+2"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_check_hot_key_text_zoom_to_two_hundred",{},"Zoom to 200%")})}},play_or_pause:{keyBindings:{win:[n.VD.SPACE],mac:[n.VD.SPACE]},visual:u(["space"]),title:()=>{let{i18n:e}=(0,o.$)();return(0,r.jsx)(r.Fragment,{children:e.t("web_materialSearch_shortcut_play_pause",{},"Play or pause")})}}}},704364:function(e,t,i){i.d(t,{j:function(){return r}});var a=i(218571);function r(e){let{fireImmediately:t,dataSdk:i}=e,r=(0,a.useRef)(""),n=(0,a.useCallback)(()=>{!r.current&&(r.current=i.api.batch.batchStart(t))},[]);return{start:n,end:(0,a.useCallback)(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];r.current&&(i.api.batch.batchEnd(r.current,{canUndoRedo:e}),r.current="")},[])}}},874641:function(e,t,i){i.d(t,{c:function(){return o}});var a=i(218571),r=i(937802),n=i(691805);function o(){let e=(0,r.G)(n.U),[t,i]=(0,a.useState)(e.getInputPreference()),o=(0,a.useMemo)(()=>t===n.Q.Rtl,[t]);return(0,a.useEffect)(()=>{let t=e.onDidInputPreferenceChange(e=>{i(e)});return()=>{t.dispose()}},[]),{inputPreference:t,isRtlMode:o}}},729466:function(e,t,i){i.d(t,{d:function(){return r}});var a=i(218571);function r(){let{onVisible:e,onHidden:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.useEffect)(()=>{let i=()=>{"visible"===document.visibilityState?null==e||e():null==t||t()};return document.addEventListener("visibilitychange",i),()=>{document.removeEventListener("visibilitychange",i)}},[e,t])}},227522:function(e,t,i){i.d(t,{R:function(){return s}});var a=i(218571),r=i(937802),n=i(896413),o=i(316255);function s(e){let{updateOnPlaying:t=!0}=null!=e?e:{},i=(0,r.G)(n.a),[s,l]=(0,a.useState)(i.playerManager.status.progress),{playing:d}=(0,o.g)(),c=(0,a.useRef)(d);return c.current=d,(0,a.useEffect)(()=>{let e=i.playerManager.onProgress(e=>{if(!!t||!c.current)l(e)});return()=>{e.dispose()}},[t]),(0,a.useEffect)(()=>{!d&&!t&&l(i.playerManager.status.progress)},[t,d]),{progress:s,playing:d}}},221963:function(e,t,i){i.d(t,{Z:function(){return n}});var a=i(425427),r=i(237225);function n(e,t){let{appVersion:i,veBuildId:n,veFullBuildVersion:o,isSIMD:s}=t,l=o.split(".",4).map(e=>(0,r.hk)(e)),d="";d=(0,a.JY)(t)?e.draftTemplateManager.getTemplateId():e.draftTemplateManager.getCombinationSegmentTemplateIds().join(",");let c=`${o}${s?"_simd":""}`;return{templateIds:d,appVersion:i,veVersion:n,videoeditorScmVersion:c,videoeditor_scm_version:c,videoeditorScmVersionV1:l[0],videoeditorScmVersionV2:l[1],videoeditorScmVersionV3:l[2],videoeditorScmVersionV4:l[3],videoeditorScmVersionSIMD:s?"simd":"common",buildCommitId:"",buildTime:""}}},572013:function(e,t,i){i.d(t,{Ce:function(){return n},mt:function(){return o},uG:function(){return s}});var a=i(426336),r=i(29188);function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[r.fQ.width,r.fQ.height],[i,a]=e;if(!(i>0)||!(a>0))return t;{let e;let[r,n]=t;return[(e=i/a<r/n?n/a:r/i)*i,e*a]}}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[r.fQ.width,r.fQ.height];return e===a.rxY.CanvasRatioOriginal?[-1,-1]:n(function(e){switch(e){case a.rxY.CanvasRatio16To9:return[16,9];case a.rxY.CanvasRatio9To16:return[9,16];case a.rxY.CanvasRatio4To3:return[4,3];case a.rxY.CanvasRatio3To4:return[3,4];case a.rxY.CanvasRatio1To1:return[1,1];case a.rxY.CanvasRatio2To1:return[2,1];case a.rxY.CanvasRatio2_35To1:return[235,100];case a.rxY.CanvasRatio1_85To1:return[185,100];case a.rxY.CanvasRatio1_125To2_436:return[1125,2436];case a.rxY.CanvasRatioOriginal:default:return[-1,-1]}}(e),t)}function s(e){let[t,i]=e;return i<=t?(t=t*r.g4/i,i=r.g4):(i=i*r.g4/t,t=r.g4),[t=Math.round(t),i=Math.round(i)]}},124262:function(e,t,i){i.d(t,{h:function(){return a}});let a=()=>{let{cookieEnabled:e}=navigator;return{isEnable:e}}},151251:function(e,t,i){i.d(t,{UO:function(){return r}});var a=i(293698);function r(e){var t,i,r,n;let o=/^(.*\/)?(.*?)(\..*?)?(\?.*)?$/,s=(0,a.PX)(e),l=null;if(s){let e=s.pathname.split("/").filter(Boolean).pop();e&&(l=o.exec(e))}return!l&&(l=o.exec(e)),{name:null!==(t=null==l?void 0:l[2])&&void 0!==t?t:"",ext:null!==(i=null==l?void 0:l[3])&&void 0!==i?i:"",fullName:`${null!==(r=null==l?void 0:l[2])&&void 0!==r?r:""}${null!==(n=null==l?void 0:l[3])&&void 0!==n?n:""}`}}},396032:function(e,t,i){i.d(t,{i:function(){return o},o:function(){return s}});var a=i(460254),r=i(140041),n=i(907031);function o(e){let t=r.co.primary;switch(e){case a.r.Video:case a.r.VideoTemplate:case a.r.UserVideo:case a.r.DigitalHuman:case a.r.Photo:case a.r.UserPhoto:t=r.co.video;break;case a.r.Audio:case a.r.UserAudio:t=r.co.audio;break;case a.r.Transition:t=n.gW;break;default:t=n.bv}return t}function s(e){switch(e){case a.r.Video:case a.r.VideoTemplate:case a.r.UserVideo:case a.r.Photo:case a.r.UserPhoto:return r.yh.video;case a.r.Audio:case a.r.UserAudio:return r.yh.audio;case a.r.Transition:return r.yh.transition;case a.r.BasicText:return r.yh.text;case a.r.TextTemplate:return r.yh.textTemplate;case a.r.Effects:return r.yh.effect;case a.r.Filter:return r.yh.filter;case a.r.Sticker:return r.yh.sticker;default:return}}},128518:function(e,t,i){i.d(t,{S:function(){return r},q:function(){return n}});var a=i(426336);function r(e){var t,i,r,n;if(!(0,a.ot2)(e))return!1;if((null==e?void 0:null===(i=e.material)||void 0===i?void 0:null===(t=i.matting)||void 0===t?void 0:t.flag)!==0n&&(null==e?void 0:null===(n=e.material)||void 0===n?void 0:null===(r=n.matting)||void 0===r?void 0:r.path))return!0;let o=null==e?void 0:e.materialDraft;if(!o)return!1;let s=o.draft.getSegmentsByTrackType(a.pNd.TrackTypeVideo);return!!s.length&&s.some(e=>{var t,i,a,r;return!!((null==e?void 0:null===(i=e.material)||void 0===i?void 0:null===(t=i.matting)||void 0===t?void 0:t.flag)!==0n&&(null==e?void 0:null===(r=e.material)||void 0===r?void 0:null===(a=r.matting)||void 0===a?void 0:a.path))})}function n(e){if(!e||!(0,a.ot2)(e)||!e.materialDraft)return!1;let t=e.materialDraft.draft.getSegmentsByTrackType(a.pNd.TrackTypeVideo);return!!t.length&&t.some(e=>(0,a.hey)(e)&&e.material.type===a.cVg.MetaTypeVideo)}},111061:function(e,t,i){i.d(t,{$2:function(){return v},$n:function(){return I},Bp:function(){return D},Ew:function(){return P},Fx:function(){return y},KO:function(){return U},OO:function(){return L},Qf:function(){return M},Rz:function(){return u},Sq:function(){return C},Yr:function(){return A},Zd:function(){return x},_l:function(){return k},dK:function(){return w},dL:function(){return S},ip:function(){return O},jj:function(){return T},oH:function(){return R},pt:function(){return p},ub:function(){return _},wJ:function(){return b}});var a=i(768261),r=i(697667),n=i(836946),o=i(426336),s=i(632555),l=i(563431),d=i(918155),c=i(111633);function u(e,t){let{x:i,y:a,width:r,height:o}=e;i*=t,a*=t;let s=[i+(r*=t)/2,a+(o*=t)/2],l=(0,n.qH)([i,a],-e.rotate,s),d=(0,n.qH)([i+r,a],-e.rotate,s),c=(0,n.qH)([i+r,a+o],-e.rotate,s);return[l,d,c,(0,n.qH)([i,a+o],-e.rotate,s)]}function h(e){let{x:t,y:i,width:a,height:r}=e,o=[t+a/2,i+r/2],s=(0,n.qH)([t,i],-e.rotate,o),l=(0,n.qH)([t+a,i],-e.rotate,o),d=(0,n.qH)([t+a,i+r],-e.rotate,o),c=(0,n.qH)([t,i+r],-e.rotate,o),u=(0,n.qH)([t,i+r/2],-e.rotate,o);return[s,l,u,(0,n.qH)([t+a,i+r/2],-e.rotate,o),c,d]}function p(e){return e.filter(e=>e.type===o.pNd.TrackTypeVideo||e.type===o.pNd.TrackTypeText||e.type===o.pNd.TrackTypeSticker)}function _(e,t){let[i,a]=e,{x:r=0,y:n=0,width:o=0,height:s=0}=t,l=Math.abs(r),d=Math.abs(r-i),c=Math.abs(r+o),u=Math.abs(r+o-i),h=Math.abs(n),p=Math.abs(n-a),_=Math.abs(n+s),g=Math.abs(n+s-a);return{left2Left:l,left2Right:d,right2Left:c,right2Right:u,top2Top:h,top2Bottom:p,bottom2Top:_,bottom2Bottom:g,center2Vertical:Math.abs(r+o/2-i/2),center2Horizontal:Math.abs(n+s/2-a/2)}}function g(e,t,i,a){if("x"===a){let a=Math.min(t.y,i.y),r=Math.max(t.y+t.height,i.y+i.height);e.adsorbedLinePosition={left:e.value,top:a,width:0,height:r-a}}else{let a=Math.min(t.x,i.x),r=Math.max(t.x+t.width,i.x+i.width);e.adsorbedLinePosition={left:a,top:e.value,width:r-a,height:0}}}let f=e=>e/90%2!=0,m=e=>{let{x:t,y:i,width:a,height:r}=e,n=i+r/2;t=t+a/2-r/2,i=n-a/2;let o=a;return{x:t,y:i,width:a=r,height:r=o}};function v(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_VALUE,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MAX_VALUE,s=null,l=null,d=f(e.rotate),{x:c,y:u,width:h,height:p}=d?m({x:e.x,y:e.y,width:e.width,height:e.height}):e,_=c+h/2,v=c+h,y=u+p/2,S=u+p;if([...t,{x:0,y:0,width:i[0],height:i[1],id:"",rotate:0}].forEach(t=>{var i,d;if(t.id===e.id||t.rotate%90!=0)return;let{x:k,y:w,width:M,height:b}=f(t.rotate)?m({x:t.x,y:t.y,width:t.width,height:t.height}):t,T=k+M/2,I=k+M,D=Number.MAX_VALUE,P=w+b/2,F=w+b,C=Number.MAX_VALUE,E={element:t,adsorbedLinePosition:null,lineType:t.id?"dashed":"solid"};if(!s){let e=[_,c,v];for(let t=0;t<=e.length-1;t++){let i=e[t],r=i-k,o=i-T,l=i-I,d=0===t,c=1===t,u=2===t,p=0,_="left";if(c?(p=0,_="left"):d?(p=h/2,_="centerX"):u&&(p=h,_="right"),Math.abs(r)<=a){n=Math.abs(r),D=k-p,s={value:k,draggingMatchingType:_,targetMatchingType:"left",adsorbedLeft:D,...E};break}if(Math.abs(o)<=a){n=Math.abs(o),D=T-p,s={value:T,draggingMatchingType:_,targetMatchingType:"centerX",adsorbedLeft:D,...E};break}if(Math.abs(l)<=a){n=Math.abs(l),D=I-p,s={value:I,draggingMatchingType:_,targetMatchingType:"right",adsorbedLeft:D,...E};break}}(null==s?void 0:null===(i=s.element)||void 0===i?void 0:i.id)===t.id&&g(s,{x:c,y:u,width:h,height:p},{x:k,y:w,width:M,height:b},"x")}if(!l){let e=[y,u,S];for(let t=0;t<=e.length-1;t++){let i=e[t],a=i-w,n=i-P,s=i-F,d=0===t,c=1===t,u=2===t,h="top",_=0;if(c?(_=0,h="top"):d?(_=p/2,h="centerY"):u&&(_=p,h="bottom"),Math.abs(a)<=r){o=Math.abs(a),C=w-_,l={value:w,draggingMatchingType:h,targetMatchingType:"top",adsorbedTop:C,...E};break}if(Math.abs(n)<=r){o=Math.abs(n),C=P-_,l={value:P,draggingMatchingType:h,targetMatchingType:"centerY",adsorbedTop:C,...E};break}if(Math.abs(s)<=r){o=Math.abs(s),C=F-_,l={value:F,draggingMatchingType:h,targetMatchingType:"bottom",adsorbedTop:C,...E};break}}(null==l?void 0:null===(d=l.element)||void 0===d?void 0:d.id)===t.id&&g(l,{x:c,y:u,width:h,height:p},{x:k,y:w,width:M,height:b},"y")}}),d){let{adsorbedLeft:e}=null!=s?s:{adsorbedLeft:0},{adsorbedTop:t}=null!=l?l:{adsorbedTop:0},i=m({x:e,y:t,width:h,height:p});s&&(s.adsorbedLeft=i.x),l&&(l.adsorbedTop=i.y)}return{minDistanceX:n,matchingCoordX:s,minDistanceY:o,matchingCoordY:l}}function y(e,t){let i=e<0,a=Math.abs(e),r=function(e,t){let i=e%90,a=i-t;return Math.abs(a)>Math.abs(i)?i:a}(a,90);if(!(Math.abs(r)<t))return{targetAngle:e,adsorbedAngle:0};let n=a-r;return{targetAngle:i?-n:n,adsorbedAngle:i?-r:r}}function S(e){switch(e){case r.Wk.topLeft:return{curIndex:0,oppositeIndex:5};case r.Wk.topRight:return{curIndex:1,oppositeIndex:4};case r.Wk.left:return{curIndex:2,oppositeIndex:3};case r.Wk.right:return{curIndex:3,oppositeIndex:2};case r.Wk.bottomLeft:return{curIndex:4,oppositeIndex:1};case r.Wk.bottomRight:return{curIndex:5,oppositeIndex:0};default:return{curIndex:0,oppositeIndex:0}}}function k(e){let{displaySize:t,resizeScale:i,rect:n,oldRect:o,keepCenter:s=!1,absorbCenter:l=!0,trigger:d="",rectangles:c=[]}=e,[u,h]=t,{left2Left:p,left2Right:g,right2Left:f,right2Right:m,top2Top:y,top2Bottom:S,bottom2Top:k,bottom2Bottom:w,center2Vertical:M,center2Horizontal:b}=_(t,{x:n.x,y:n.y,width:n.width,height:n.height}),{ifAdsorbX:T,ifAdsorbY:I}=function(e,t,i,r){let{left2Left:n,left2Right:o,right2Left:s,right2Right:l,top2Top:d,top2Bottom:c,bottom2Top:u,bottom2Bottom:h,center2Vertical:p,center2Horizontal:g}=_(t,{x:e.x,y:e.y,width:e.width,height:e.height}),f=a.aR/i;return{ifAdsorbX:n<=f||o<=f||s<=f||l<=f||p<=f&&r,ifAdsorbY:d<=f||c<=f||u<=f||h<=f||g<=f&&r}}(o,t,i,l),D=a.aR/i,P=a.aR/i,F=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={left:!1,right:!1,top:!1,bottom:!1};switch(e){case r.Wk.bottomLeft:t.bottom=!0,t.left=!0;break;case r.Wk.bottomRight:t.bottom=!0,t.right=!0;break;case r.Wk.left:t.left=!0;break;case r.Wk.topLeft:t.top=!0,t.left=!0;break;case r.Wk.topRight:t.top=!0,t.right=!0;break;case r.Wk.right:t.right=!0}return t}(d);d&&(P=D=a.A9/i);let{x:C,y:E,width:x,height:R,originalX:A,originalY:O}=n,U=!1;if(!d){let{minDistanceX:e,matchingCoordX:i,minDistanceY:a,matchingCoordY:r}=v(n,c,t,D,P);i&&e<=D&&(C=i.adsorbedLeft),r&&a<=P&&(E=r.adsorbedTop)}if(p<=D&&!F.right?(C=0,U=!0):g<=D&&!F.right?(C=u,U=!0):f<=D&&!F.left?C=-n.width:m<=D&&!F.left?C=u-n.width:M<=D&&l&&(C=u/2-n.width/2),C!==n.x&&s){let e=(n.x-C)*(U?1:-1),t=n.height/n.width*e;return x+=2*e,R+=2*t,C-=U?0:2*e,E-=t,A-=e,O-=t,{...n,x:C,y:E,width:x,height:R,originalX:A,originalY:O}}if(C!==n.x&&d){let e=(n.x-C)*(U?1:-1),t=n.height/n.width*e;return x+=e,R+=t,[r.Wk.bottomRight,r.Wk.topRight].includes(d)&&(C-=e),[r.Wk.topLeft,r.Wk.topRight].includes(d)&&(E-=t),{...n,x:C,y:E,width:x,height:R,originalX:A,originalY:O}}let L=!1;if(y<=P&&!F.bottom?(E=0,L=!0):S<=P&&!F.bottom?(E=h,L=!0):k<=P&&!F.top?E=-n.height:w<=P&&!F.top?E=h-n.height:b<=P&&l&&(E=h/2-n.height/2),E!==n.y&&s){let e=(n.y-E)*(L?1:-1),t=n.width/n.height*e;x+=2*t,R+=2*e,C-=t,E-=L?0:2*e,A-=t,O-=e}if(E!==n.y&&d){let e=(n.y-E)*(L?1:-1),t=n.width/n.height*e;x+=t,R+=e,[r.Wk.bottomLeft,r.Wk.topLeft].includes(d)&&(C-=t),[r.Wk.bottomRight,r.Wk.bottomLeft].includes(d)&&(E-=e)}return{...n,x:C,y:E,width:x,height:R,originalX:A,originalY:O}}function w(e,t,i,a){let r=h(e);0!==t&&(e.width+=t,e.x-=t,e.originalX-=t/2),0!==i&&(e.height+=i,e.y-=i,e.originalY-=i/2);let n=h(e),o=r[a][0]-n[a][0],s=r[a][1]-n[a][1];e.x+=o,e.y+=s}function M(e,t,i){0!==t&&(e.width+=2*t,e.x-=t,e.originalX-=t),0!==i&&(e.height+=2*i,e.y-=i,e.originalY-=i)}function b(e,t,i,a){let n=t.width/e.width,o=i[0],s=i[1],l=0,d=0;switch(a){case r.Wk.bottomRight:return l=t.x+(o-e.x)*n,[l,d=t.y+(s-e.y)*n];case r.Wk.topRight:return l=t.x+(o-e.x)*n,[l,d=t.y+t.height-(e.y+e.height-s)*n];case r.Wk.bottomLeft:return l=t.x+t.width-(e.x+e.width-o)*n,[l,d=t.y+(s-e.y)*n];case r.Wk.topLeft:return l=t.x+t.width-(e.x+e.width-o)*n,[l,d=t.y+t.height-(e.y+e.height-s)*n];default:return i}}function T(e,t,i){let a=(0,d.I)(i),r=(0,d.I)(-i),n=new c.O(t[0],t[1]),o=new c.O(t[0],t[1]).rotate(a);o.add(new c.O(e[0],e[1])).rotate(r).subtract(new c.O(t[0],t[1]));let s=o.dot(n)/n.length()**2,l=n.multiplyScalar(s);return[Math.sign(t[0])*l.x,Math.sign(t[1])*l.y]}function I(e,t,i){let a=h(e);if(0!==t){e.width+=t,e.scale.x&&(e.originalWidth=e.width/e.scale.x);e.x-=t/2}let r=h(e),n=a[i][0]-r[i][0],o=a[i][1]-r[i][1];e.x+=n,e.y+=o}function D(e,t,i){0!==t&&(e.width+=2*t,e.scale.x&&(e.originalWidth=e.width/e.scale.x),e.x-=t)}function P(e,t,i){return T(i,{[r.Wk.bottomRight]:[e.width/2,e.height/2],[r.Wk.bottomLeft]:[-e.width/2,e.height/2],[r.Wk.topLeft]:[-e.width/2,-e.height/2],[r.Wk.topRight]:[e.width/2,-e.height/2],[r.Wk.right]:[e.width/2,0],[r.Wk.left]:[-e.width/2,0]}[t],e.rotate)}let F=(e,t)=>{let[i,a]=e;return[i*Math.cos(t)-a*Math.sin(t),a*Math.cos(t)+i*Math.sin(t)]},C=(e,t,i)=>{let a=i*Math.PI/180,[r,n]=e,[o,s]=t,[l,d]=F([o-r,s-n],a);return[l+r,d+n]},E=(e,t,i)=>{let[a,r]=C(e,(0,l.iF)(t),i),[n,o]=[a-t.width/2,r-t.height/2];return{...t,x:n,y:o,rotate:t.rotate+i}};function x(e,t,i){var a,r,n,o;let[s,d]=t,c=i.length?i.at(-1):null,u=c?E((0,l.iF)(c),e,-c.rotate):e,h=u.x-u.originalX-(null!==(a=null==c?void 0:c.x)&&void 0!==a?a:0),p=u.y-u.originalY-(null!==(r=null==c?void 0:c.y)&&void 0!==r?r:0),_=null!==(n=null==c?void 0:c.width)&&void 0!==n?n:s,g=null!==(o=null==c?void 0:c.height)&&void 0!==o?o:d;return"SegmentVideo"===e.type?[h/_,p/g]:[h/_*2,-p/g*2]}function R(e,t,i){var a,r;let n=i.length?i.at(-1):null,o=n?E((0,l.iF)(n),e,-n.rotate):e,[s,d]=n?[n.width,n.height]:t,[c,u]=(0,l.iF)(o),[h,p]=[c-(null!==(a=null==n?void 0:n.x)&&void 0!==a?a:0),u-(null!==(r=null==n?void 0:n.y)&&void 0!==r?r:0)];return"SegmentVideo"===e.type?[(h-s/2)/s,(p-d/2)/d]:[(h-s/2)/s*2,-(p-d/2)/d*2]}function A(e){return e<0?e%360+360:e%360}function O(e,t,i){return(0,s.mK)(e,[t-i,t+i])}function U(e){let{tracks:t,duration:i,progress:a}=e,r=[];return t.forEach(e=>{let t=e.segments.map(e=>{var t,i,a,r,n,o;return{id:e.id,type:e.__segment_struct_type,start:null!==(n=null===(t=e.targetTimerange)||void 0===t?void 0:t.start)&&void 0!==n?n:0n,duration:null!==(o=null===(i=e.targetTimerange)||void 0===i?void 0:i.duration)&&void 0!==o?o:0n,scale:{...null===(a=e.clip)||void 0===a?void 0:a.scale},transform:{...null===(r=e.clip)||void 0===r?void 0:r.transform},material:e.material,materialDraft:e.materialDraft}}).sort((e,t)=>o.pMA.minus(t.start,e.start,"number")),n=t.findIndex(e=>{let t=e.start+e.duration;return a>=BigInt(e.start)&&(a===i?a<=BigInt(t):a<BigInt(t))});if(n>=0){let e=t[n];r.push({id:e.id,type:e.type,__segment_struct_type:e.type,timestamp:Date.now(),scale:e.scale,transform:e.transform,material:e.material,start:e.start,duration:e.duration,materialDraft:e.materialDraft})}}),r}let L=(e,t)=>{for(let a of e){var i;if(a.id===t)return a;let e=L(null!==(i=a.subRects)&&void 0!==i?i:[],t);if(e)return e}}},49299:function(e,t,i){i.d(t,{Et:function(){return d},LL:function(){return s},Me:function(){return c},iI:function(){return o},vf:function(){return l}});var a=i(426020),r=i(800788),n=i(219159);let o=e=>void 0!==e&&e.startsWith("blob:"),s=e=>void 0!==e&&e.startsWith("/.quick-import/"),l=e=>`incomplete_path_map_${e}`;function d(e,t,i){var n;if(i.sourceType!==a.ov.EverCloud)return()=>{};let o=l(e),s=i,d=null===(n=i.onModelUpdate)||void 0===n?void 0:n.call(i,e=>{s=e}),c=()=>{var e;let t=null!==(e=window.localStorage.getItem(o))&&void 0!==e?e:"";if(null!==t)try{return JSON.parse(t)}catch(e){}},u=()=>{var e;(0,r.ZB)(s.sourceType===a.ov.EverCloud);let{assetId:i,md5:n}=s,l=null!==(e=c())&&void 0!==e?e:{};l[t]={asset_id:i,md5:n},localStorage.setItem(o,JSON.stringify(l))};return i.uploading.onSuccess(()=>{u()}),()=>{var e,i;let a=null!==(i=c())&&void 0!==i?i:{};delete a[t],Object.keys(a).length?localStorage.setItem(o,JSON.stringify(a)):window.localStorage.removeItem(o),null==d||null===(e=d.dispose)||void 0===e||e.call(d)}}function c(e,t){let i=e,a=()=>{i&&((0,n.$)(t,{action:"quit",unavailableDuration:Date.now()-i,isNeedQuickImportSegmentsLength:!0},!0),i=0)};return window.addEventListener("unload",a),()=>{window.removeEventListener("unload",a)}}},295045:function(e,t,i){i.d(t,{S:function(){return a}});function a(e){let t=e;for(;t!==document.body&&!t.dataset.attrTextInput&&!t.dataset.exitRichTextEdit;){;if(t.dataset.inRichTextEditing||t.matches(".workbench-tool-bars")||t.matches(".tool-bar-panel-container")||t.matches(".video-editor-color-picker-panel")||t.matches(".lv-trigger"))return!0;if(!t.parentElement)break;t=t.parentElement}return!1}},127656:function(e,t,i){i.d(t,{Fl:function(){return S},IC:function(){return v},Nc:function(){return y},g$:function(){return m}});var a=i(29188),r=i(801497),n=i(593642),o=i(800788),s=i(234075),l=i.n(s),d=i(341079),c=i(798184),u=i(127830),h=i(234487),p=i(820193),_=i(426336),g=i(565508),f=i(722169);let m=async e=>{let t;let{mainDraftService:i,resourceService:s,payinPayoutHelper:f,containerService:m,draftMaterialsService:v,segmentId:y,onError:S,renderManager:k}=e,{dataSdk:w}=i,M=w.draftView.getSegmentById(y);if(!M||!(0,_.hey)(M)||!M.material.hasAudio||M.material.sourcePlatform===_.cvu.MaterialPlatformBrand)return"";let b=M.reverse?M.material.reversePath:M.material.path,T=M.reverse||M.material.sourcePlatform===_.cvu.MaterialPlatformDefault,I=M.material.extraTypeOption&_.Yzk.HasSeparatedAudio;if(I!==_.Yzk.HasSeparatedAudio){if(t=(0,n.Rl)(),w.draftView.findTargetTrackIndexByTimeRange([_.pNd.TrackTypeAudio],[],new _.tnv({start:M.targetTimerange.start,duration:M.targetTimerange.duration}),0)>=a.Fb){null==S||S(r.ZP.t("audio_track_is_full_and_cannot_be_added_to_target_location",{},"\u97F3\u9891\u8F68\u9053\u5DF2\u6EE1\uFF0C\u65E0\u6CD5\u6DFB\u52A0\u5230\u76EE\u6807\u4F4D\u7F6E"));return}if(!T){let e=i.draftPathStore.getResourceKeyFromDraftPath(b);(0,o.Y2)(e);let a=s.get(e,u._g.Video);(0,o.Y2)(a);let r=a.getVideoResourceToken();(0,o.Y2)(r),await (0,c.x)(r),(0,o.Y2)(r.value);let{buffer:n}=r.value,l=new File([n],M.material.materialName,{type:"video/mp4"}),[d]=await (0,h.u)({files:[l],fromWorkspaceId:i.draftWorkspaceManager.workspaceId,payinPayoutHelper:f,toWorkspaceId:i.draftWorkspaceManager.workspaceId,uploadParams:{skipTranscode:!0},containerService:m});if(!d.ok)return;v.addToAutoGenerated(d.value),d.value.onDidMd5Set(()=>{let e=(0,p.GL)(d.value.getModel(),u._g.UserVideo);s.add(e.key,e.resource);let a=(0,g.do)(e.resource);i.draftPathStore.recordDraftPathToResourceKey(a,d.value.getModel().key),i.draftPathStore.recordResourceKeyToDraftPath(d.value.getModel().key,a);let r=k.resourceRecords.pathRecords.get(b);k.recordResource({segmentPath:a,resPath:r});let n=i.dataSdk.draftView.getDraftIdAndSegById(t);if(!!n)i.dataSdk.api.segment.innerReplace({draftId:n.draftId,identifier:{id:t,material:{path:b}},substitute:{material:{path:a}}})})}}let D=w.api.batch.batchStart(),{trackIndex:P,needToInsert:F}=w.draftView.findTrackIndexToInsert(_.pNd.TrackTypeAudio,M.targetTimerange.start,M.targetTimerange.duration);return w.api.video.seprateAudio({segId:M.id,audioName:l().basename(M.material.materialName,l().extname(M.material.materialName)),audioPath:b,isSeparate:I!==_.Yzk.HasSeparatedAudio,needInsertTargetTrack:F,audioTargetTrackIndex:P,audioSegId:t}),I!==_.Yzk.HasSeparatedAudio&&w.api.keyframe.delete({segmentId:M.id,keyframeTypeList:[...d.z2,...d.C6]}),w.api.batch.batchEnd(D),""};function v(e,t){var i;let{segmentIds:a}=e.selection;return 1!==a.length?null:null!==(i=t.dataSdk.draftView.getSegmentById(a[0]))&&void 0!==i?i:null}function y(e,t){let{transitionIds:i}=e.selection;if(1!==i.length)return null;let a=t.dataSdk.draftView.getSegmentByTransitionId(i[0]);return(0,f.isNil)(a)?null:a}let S=e=>{var t,i,a;return _.pMA.minus(null!==(i=null==e?void 0:e.targetTimerange.start)&&void 0!==i?i:0n,null!==(a=null==e?void 0:null===(t=e.sourceTimerange)||void 0===t?void 0:t.start)&&void 0!==a?a:0n,"bigint")}},22495:function(e,t,i){i.d(t,{X:function(){return a}});function a(e){return e.every(e=>{var t,i;return(null===(t=e.speed)||void 0===t?void 0:t.speed)===1&&[0,-1].includes(null===(i=e.speed)||void 0===i?void 0:i.mode)&&!(null==e?void 0:e.reverse)})}},886858:function(e,t,i){i.d(t,{$:function(){return o},_:function(){return n}});var a=i(426336),r=i(544009);function n(e){var t,i,a,r;let n=null!==(a=e.attachInfo.startTime)&&void 0!==a?a:0n,o=null===(i=e.textAnimateMaterial)||void 0===i?void 0:null===(t=i.animations)||void 0===t?void 0:t.find(e=>"in"===e.type);return Number(n+(null!==(r=null==o?void 0:o.duration)&&void 0!==r?r:0n))}function o(e){var t,i,n,o,s,l,d,c,u,h;let p=null===(t=e.textAnimateMaterial)||void 0===t?void 0:t.animations.filter(e=>[a.VAL.Anim_In,a.VAL.Anim_Caption].includes(e.type)&&0n!==e.duration),_=null===(i=e.textAnimateMaterial)||void 0===i?void 0:i.animations.find(e=>e.type===a.VAL.Anim_Out&&0n!==e.duration),g=null===(n=e.textAnimateMaterial)||void 0===n?void 0:n.animations.find(e=>[a.VAL.Anim_Loop,a.VAL.Anim_Group].includes(e.type)&&0n!==e.duration);o=e.attachInfo.startTime;let f=null!==(s=e.attachInfo.duration)&&void 0!==s?s:0n,m=a.pMA.plus(0n,a.pMA.max(null!==(l=null==p?void 0:p.map(e=>{var t;return null!==(t=e.duration)&&void 0!==t?t:0}))&&void 0!==l?l:[0n],"bigint"),"bigint"),v=f-(null!==(d=null==_?void 0:_.duration)&&void 0!==d?d:0n),y=m,S=m;switch(null==g?void 0:g.type){case a.VAL.Anim_Loop:S=v;break;case a.VAL.Anim_Group:S=(y=null!==(c=null==g?void 0:g.start)&&void 0!==c?c:m)+(null!==(u=null==g?void 0:g.duration)&&void 0!==u?u:0n)}let[k,w]=(0,r.xe)([0n,f],[[0n,m],[y,S],[v,f]]);if(k)return[k,w];if(null==p?void 0:p.length)return[m,m];if(g&&0n===y){let e=a.pMA.div(null!==(h=g.duration)&&void 0!==h?h:0n,2,"bigint");return[y+e,y+e]}return[k,w]}},145748:function(e,t,i){i.d(t,{i:function(){return o}});var a=i(801497),r=i(709488),n=i(928261);let o=(e,t,i)=>{let{canSplit:o,currentSeekTime:s,segmentSelected:l}=i,d=e.draftView.getAllTracks();if(l.length>0){if(!o)return t.toast.normal(a.ZP.t("current_indivisible_fragment",{},"\u5F53\u524D\u65E0\u53EF\u5206\u5272\u7247\u6BB5")),[];let i=l.filter(e=>!(0,n.hi)(e)&&(0,r.FZ)(e,s)),d=i.map(e=>({segmentId:e.id,splitTime:s}));e.api.segment.split(d);let c=i.find(e=>"video"===e.type);return c&&t.guide.showFirstSplitSegmentGuide(c.id),i.map(t=>e.draftView.getSegmentById(t.id))}{let i=(0,r._U)(d,s),n=null==i?void 0:i.id;if(!n)return t.toast.normal(a.ZP.t("current_indivisible_fragment",{},"\u5F53\u524D\u65E0\u53EF\u5206\u5272\u7247\u6BB5")),[];{e.api.segment.split([{segmentId:n,splitTime:s}]),t.guide.showFirstSplitSegmentGuide(n);let i=e.draftView.getSegmentById(n);return i?[i]:[]}}}},282600:function(e,t,i){i.d(t,{r:function(){return a}});function a(e){return createImageBitmap(e)}},210487:function(e,t,i){i.d(t,{c:function(){return n}});var a=i(574548),r=i(782566);async function n(e,t,i){let{attrs:n}=t,{compress:o}=i,s=await (0,a.G)(e,{attrs:n});return(0,r.X)(s,{compress:o})}},217131:function(e,t,i){i.d(t,{c1:function(){return r},ts:function(){return a}});let a=100,r=102},215179:function(e,t,i){i.d(t,{Me:function(){return s},d0:function(){return d}});var a=i(249656),r=i(374904),n=i(426336);let o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(0,r.Gt)(e);return["video","audio","image"].includes(t)?t:"other"},s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(o(e)){case"video":return a.C3.MetaTypeVideo;case"audio":return a.C3.MetaTypeMusic;case"image":return a.C3.MetaTypePhoto;default:return a.C3.MetaTypeNone}},l=e=>{var t,i;let a=[];return null===(i=e.material)||void 0===i||null===(t=i.textInfoResources)||void 0===t||t.forEach(e=>{var t,i;null==e||null===(i=e.textAnimateMaterial)||void 0===i||null===(t=i.animations)||void 0===t||t.forEach(e=>{(null==e?void 0:e.resourceId)&&a.push(e.resourceId)})}),a};function d(e){var t,i,a,r,o,s,d,c,u,h,p,_,g,f,m,v,y,S,k,w,M,b,T,I,D,P,F;let C=[],E=e=>e&&C.push(e),x=e=>e.forEach(e=>E(e));return(0,n.hey)(e)&&x([null===(t=e.material)||void 0===t?void 0:t.materialId,null===(i=e.background)||void 0===i?void 0:i.imageId,null===(a=e.transition)||void 0===a?void 0:a.resourceId,e.templateId,...null!==(c=null===(o=e.animations)||void 0===o?void 0:null===(r=o.animations)||void 0===r?void 0:r.map(e=>e.resourceId))&&void 0!==c?c:[],...null!==(u=null===(s=e.videoEffects)||void 0===s?void 0:s.map(e=>e.resourceId))&&void 0!==u?u:[],...null!==(h=null===(d=e.figures)||void 0===d?void 0:d.map(e=>e.resourceId))&&void 0!==h?h:[]]),(0,n.Y9Q)(e)&&(x([null===(p=e.material)||void 0===p?void 0:p.musicId,null===(_=e.material)||void 0===_?void 0:_.effectId,null===(g=e.material)||void 0===g?void 0:g.videoId,null===(f=e.material)||void 0===f?void 0:f.textId,null===(m=e.material)||void 0===m?void 0:m.resourceId]),null===(v=e.voiceChange)||void 0===v||v.forEach(e=>{E(e.resourceId)})),(0,n.Ftn)(e)&&x([null===(y=e.material)||void 0===y?void 0:y.fontResourceId,null===(S=e.material)||void 0===S?void 0:S.fontId,e.material.captionTemplateInfo.resourceId,null===(k=e.effect)||void 0===k?void 0:k.resourceId,null===(w=e.shape)||void 0===w?void 0:w.resourceId,...BigInt(e.material.checkFlag)&n.PbZ.LightFlag?[null===(M=e.bloom)||void 0===M?void 0:M.resourceId]:[],...(null!==(T=null===(b=e.animations)||void 0===b?void 0:b.animations)&&void 0!==T?T:[]).map(e=>null==e?void 0:e.resourceId),...(null!==(I=e.effects)&&void 0!==I?I:[]).map(e=>null==e?void 0:e.resourceId)]),(0,n.Q2R)(e)&&x([e.material.resourceId,...e.material.resources.map(e=>e.resourceId),...l(e)]),(0,n.P2T)(e)&&x([null===(D=e.material)||void 0===D?void 0:D.resourceId]),(0,n.SiN)(e)&&x([null===(P=e.material)||void 0===P?void 0:P.resourceId]),(0,n.w5o)(e)&&x([null===(F=e.material)||void 0===F?void 0:F.resourceId]),C}},164361:function(e,t,i){i.d(t,{Z:function(){return s}});var a=i(772322);i(68972);var r=i(572651),n=i(105789),o=i.n(n);i(986401);let s=e=>{let{className:t,displayType:i="default",...n}=e;return(0,a.jsx)(r.Z.Group,{className:o()(`template-post-radio-group__${i}`,t),...n})}},264738:function(e,t,i){i.d(t,{Z:function(){return o}});var a=i(772322);i(339605);var r=i(667058),n=i(218571);let o=e=>{let{value:t,valueMap:i={on:!0,off:!1},onChange:o,...s}=e,l=(0,n.useCallback)(e=>{null==o||o(e?i.on:i.off)},[i,o]);return(0,a.jsx)(r.Z,{checked:i.on===t,onChange:l,...s})}},654144:function(e,t,i){i.d(t,{S:function(){return r}});var a=i(175994);function r(e){let t=!0;switch(!0){case!e.title:case!e.definition:case!e.template_type:case e.template_type===a.xw.clip_template&&!e.segment_template_collection:t=!1}return t}},941806:function(e,t,i){i.d(t,{Z:function(){return u}});var a=i(772322);i(218571);var r=i(670933),n=i(105789),o=i.n(n),s=i(165092),l=i(944396),d=i(990157),c=i(528854);let u=(0,r.f3)("store","modules")((0,r.Pi)(e=>{let{store:t,modules:i,onBack:r}=e,{active:n}=t[s.gq];return(0,a.jsxs)("div",{className:o()("template-post-header",l.Z.container,n?l.Z.active:void 0),children:[(0,a.jsx)("div",{className:l.Z.top,children:(0,a.jsx)(d.Z,{onBack:r})}),(0,a.jsx)("div",{className:l.Z.bottom,children:(0,a.jsx)(c.Z,{})})]})}))},857511:function(e,t,i){i.d(t,{DQ:function(){return a},K8:function(){return n},YE:function(){return o},dU:function(){return r}});let a="siderMenuBrandKit",r=Object.freeze(new Set(["lut","primary_color_wheels","log_color_wheels"])),n=Object.freeze(new Set(["font_style"])),o=Object.freeze(new Set(["curve","font_style","bubble"]))},446198:function(e,t,i){i.d(t,{_:function(){return r}});var a=i(676693);function r(e){return e-2*parseInt(a.Z["sider-menu-panel-padding-x"])}},576864:function(e,t,i){i.d(t,{D:function(){return a}});let a="siderMenuPhoto"},391701:function(e,t,i){i.d(t,{D:function(){return a},_:function(){return r}});let a="siderMenuText",r=110},277331:function(e,t,i){i.d(t,{D:function(){return a}});let a="siderMenuTransition"},102207:function(e,t,i){i.d(t,{D:function(){return a},y:function(){return r}});let a="timelineAdsorbButton",r="ABSORB_SWITCH_STORAGE_KEY"},158612:function(e,t,i){i.d(t,{A:function(){return r},F:function(){return n}});var a,r=((a={}).SELECTION="selection",a.SPLIT="split",a.DELETE="delete",a.REVERSE="reverse",a.CROP="crop",a.FLIP="flip",a.TRANSCRIBE="transcribe",a.SMART_SPLIT="smart-split",a.BEAT="beat",a.PARTIAL_EXPORT="partial-export",a.PLAY="play",a.ADSORB="adsorb",a.PREVIEW_LINE="preview-line",a.AUTO_REPLACE="auto-replace",a.BATCH_REPLACE="batch-replace",a.ZOOM="zoom",a.FULLSCREEN="fullscreen",a.COLLAPSE="collapse",a.COMBINATION_EXPAND="combination-expand",a.AUDIO_RECORDER="audio-recorder",a.AUDIO_RECORDER_TOOL="audio-recorder-tool",a.UPLOAD_AND_REPLACE="upload-and-replace",a.FREEZE="freeze",a.PREVIEW_VOLUME="preview-volume",a);let n=e=>{let t=[{name:"batch-replace",divider:!0},{name:"combination-expand"}];!e&&t.push({name:"auto-replace"}),t.push({name:"upload-and-replace"},{name:"selection"},{name:"split"},{name:"delete"},{name:"reverse"},{name:"crop"},{name:"flip"},{name:"freeze"},{name:"transcribe"},{name:"smart-split"},{name:"beat"},{name:"partial-export"});let i=[{name:"audio-recorder"},{name:"adsorb"},{name:"preview-line"}];return e&&i.push({name:"auto-replace"}),i.push({name:"zoom",divider:!0},{name:"fullscreen"},{name:"collapse"}),{left:t,center:[{name:"play"}],right:i,audioRecorderTool:[{name:"audio-recorder-tool"}]}}},832905:function(e,t,i){i.d(t,{q:function(){return r}});var a=i(218571);function r(e){let{dataSdk:t}=e,[i,r]=(0,a.useState)(!!t.draftView.getAllSegments().length);return(0,a.useEffect)(()=>{let e=t.onChangeDiff(()=>{r(!!t.draftView.getAllSegments().length)});return()=>{e.dispose()}},[]),i}},804728:function(e,t,i){i.d(t,{D4:function(){return n},DQ:function(){return a},jR:function(){return r}});let a="titlebarChecklist",r={TitlebarChecklist:"TitlebarChecklist"},n="checklist_red_dot_hidden"},308260:function(e,t,i){i.d(t,{P:function(){return s}});var a=i(772322),r=i(768133),n=i(568998),o=i(372870);i(94548);let s={titleBar:[{name:o.j.TitlebarFeedback,type:"Custom",position:"right",style:{marginRight:"4px"},showInMenu:{priority:r.Yg.Feedback,group:r.kS.Feedback,withMenu:!1,priorityInMenu:r.$9.Feedback},contributionSymbol:o.D,content:e=>(0,a.jsx)("div",{className:"lv_feedback",style:{width:32,height:32,cursor:"not-allowed"},onClick:e.onClick,onMouseOver:e.onHover,onMouseEnter:e.onEnter,children:(0,a.jsx)(n.KTU,{className:"lv_feedback-icon",style:{color:"var(--lvv-color-text-disable)"}})})}]}},882458:function(e,t,i){i.d(t,{D:function(){return a},j:function(){return r}});let a="titlebarFilmTask",r={TitlebarFilmTask:a}},346158:function(e,t,i){i.d(t,{P:function(){return n}});var a=i(603314),r=i(515379);let n={titleBar:[{name:a.j.TitlebarReadonlyTag,position:"left",type:"Custom",contributionSymbol:a.D,order:r.z.ReadonlyTag}]}},980224:function(e,t,i){i.d(t,{D:function(){return a},j:function(){return r}});let a="titlebarSignIn",r={TitlebarSignIn:a}},736571:function(e,t,i){i.d(t,{P:function(){return d}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(851621).D,name:r.j.ToolbarAudioBasic,type:"unpin",icon:()=>(0,a.jsx)(o.GCV,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.Audio],defaultActiveGroupList:[s.D.Audio]}],toolBarPanel:[{name:r.j.ToolbarAudioBasic,content:(0,a.jsx)(l.v,{})}]}},352318:function(e,t,i){i.d(t,{x:function(){return l}});var a=i(290563),r=i(230689),n=i(82748),o=i(937802),s=i(218571);function l(){let e=(0,o.G)(a.k),t=(0,o.G)(r.t);return{check:(0,s.useCallback)(async()=>await e.check({popup_item_id:n._.SmartToolTypeEnum_VocalSeparation,popup_scene:n.X.PopupSmartTool},t),[])}}},273791:function(e,t,i){i.d(t,{Z:()=>d});var a=i("772322"),r=i("195265"),n=i("218571"),o=i("172027"),s=i("284197");i("300798");let l="canvas-eye-dropper-cursor-none",d=(0,n.forwardRef)((e,t)=>{let{onColorPick:i,triggerTarget:d,pickerCanvas:c,ignoreClass:u=[],type:h="rgb"}=e,[p,_,g]=function(e){let[t,i]=(0,n.useState)(null),a=(0,n.useRef)(e);return(0,n.useEffect)(()=>{a.current=t},[t]),[t,a,e=>{i(e),a.current=e}]}(null),[f,m]=(0,n.useState)([0,0]),v=(0,n.useRef)(null),y=(0,n.useRef)(null),S=(0,n.useRef)(null),k=(0,n.useRef)(null),w=(0,n.useRef)(!1),{run:M}=(0,r.default)(()=>{w.current&&O()},1e3),b=(0,n.useCallback)(()=>{var e,t;g(null),null===(t=v.current)||void 0===t||null===(e=t.classList)||void 0===e||e.remove(l)},[]),T=(0,n.useCallback)(e=>{var t,i;if(!w.current||!v.current||!y.current||!S.current)return;if(!e.target.dataset.widgetId||u.some(t=>e.target.className.split(" ").includes(t))){b();return}null===(i=v.current)||void 0===i||null===(t=i.classList)||void 0===t||t.add(l);let a=y.current.getBoundingClientRect(),{clientX:r,clientY:n}=e,o=r-a.left,d=n-a.top;m([r,n]);let c=S.current.getImageData(o,d,1,1).data,p=`rgb(${c[0]}, ${c[1]}, ${c[2]})`;"hex"===h&&(p=(0,s.v)(p)),g(p)},[]),I=(0,n.useCallback)(function(e){e.stopPropagation(),e.preventDefault()},[]);function D(){window.removeEventListener("contextmenu",I,!0)}let P=(0,n.useCallback)(e=>{var t,a,r,n,o;if(!(2===e.button||!w.current||(null===(a=k.current)||void 0===a?void 0:null===(t=a.contains)||void 0===t?void 0:t.call(a,e.target))))w.current=!1,i(null!==(o=_.current)&&void 0!==o?o:""),g(null),null===(n=v.current)||void 0===n||null===(r=n.classList)||void 0===r||r.remove(l),D()},[i]),F=()=>{var e,t;w.current=!1,_.current=null,g(null),null===(t=v.current)||void 0===t||null===(e=t.classList)||void 0===e||e.remove(l),D()},C=(0,n.useCallback)(function(e){"Space"===e.code&&(window.removeEventListener("keydown",C),i(""),F())},[i]),E=(0,n.useCallback)(e=>{if(!v.current)return;let{clientX:t,clientY:i}=e,{x:a,y:r,width:n,height:o}=v.current.getBoundingClientRect();t>=a&&t<=a+n&&i>=r&&i<=r+o?T(e):b()},[]),x=(0,n.useCallback)(e=>{w.current&&e.stopPropagation()},[]),R=(0,n.useCallback)(()=>{document.removeEventListener("mouseup",P),v.current&&(document.removeEventListener("mousemove",E),document.removeEventListener("mousedown",x,!0),window.removeEventListener("resize",M),D())},[P]),A=(0,n.useCallback)(()=>{let e=document.querySelector(d);if(e!==v.current)R(),document.addEventListener("mouseup",P),e?(v.current=e,document.addEventListener("mousemove",E),document.addEventListener("mousedown",x,!0),window.addEventListener("resize",M)):v.current=null},[R,P]);(0,n.useEffect)(()=>(A(),()=>{R()}),[A,R]);let O=(0,n.useCallback)(()=>{!v.current&&A();let e=document.querySelector(c);if(y.current=e,e){let t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.offsetWidth,t.height=e.offsetHeight,i&&(S.current=i,i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0,t.width,t.height),window.addEventListener("contextmenu",I,!0),window.addEventListener("keydown",C)),setTimeout(()=>{w.current=!0})}},[A,C]);return(0,n.useImperativeHandle)(t,()=>({pickColorTrigger:O,cancelColorPick:()=>{var e,t;w.current=!1,g(null),null===(t=v.current)||void 0===t||null===(e=t.classList)||void 0===e||e.remove(l),D()},preparePickColor:A})),(0,a.jsxs)("div",{className:"canvas-eye-dropper",ref:k,children:[e.children,p&&(0,a.jsx)(o.Z,{activeColor:p,position:f})]})})},392486:function(e,t,i){i.d(t,{F0:function(){return c},N8:function(){return d},XH:function(){return l},dT:function(){return r},gy:function(){return n},h:function(){return o}});var a=i(736323);function r(e){let t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(t&&4===t.length){let e=parseInt(t[1],10),i=parseInt(t[2],10);return{r:e,g:i,b:parseInt(t[3],10)}}return null}let n=e=>{let t={luma:[],red:[],green:[],blue:[]},i=(e,i)=>{let a=e.length;for(let n=0;n<a;n+=2){let o={anchor:{x:e[n],y:e[n+1]}};if(n>=2&&(o.leftControl={x:e[n-2],y:e[n-1]}),n+2<a&&(o.rightControl={x:e[n+2],y:e[n+3]}),(n/2+1)%3==1){var r;null===(r=t[i])||void 0===r||r.push(o)}}};return i(e.yPoints,a.wD.Luma),i(e.rPoints,a.wD.Red),i(e.gPoints,a.wD.Green),i(e.bPoints,a.wD.Blue),t},o=(e,t)=>{var i,r,n;let o={activeLine:{color:null!==(r=null===(i=a.UX.find(e=>e.name===t))||void 0===i?void 0:i.lineColor)&&void 0!==r?r:"",points:[]},inactiveLines:[]};return(null!==(n=e[t])&&void 0!==n?n:[]).forEach(e=>{var t;let{x:i=0,y:a=0}=null!==(t=e.anchor)&&void 0!==t?t:{};o.activeLine.points.push([i,a])}),Object.keys(e).filter(e=>e!==t).sort((e,t)=>a.C7.indexOf(e)-a.C7.indexOf(t)).forEach(t=>{var i,r,n;let s=null!==(r=e[t])&&void 0!==r?r:[],l=[];s.forEach(e=>{var t;let{x:i=0,y:a=0}=null!==(t=e.anchor)&&void 0!==t?t:{};l.push([i,a])});let d=null!==(n=null===(i=a.UX.find(e=>e.name===t))||void 0===i?void 0:i.lineColor)&&void 0!==n?n:"";o.inactiveLines.push({color:d,points:l})}),o};function s(e){let t=[],i=e.length;t[0]=e[0]/2;let a=[];a[0]=0;let r=2;for(let n=1;n<i;n++)a[n]=1/r,r=(n<i-1?4:3.5)-a[n],t[n]=(e[n]-t[n-1])/r;for(let e=1;e<i;e++)t[i-e-1]-=a[i-e]*t[i-e];return t}let l=e=>({x:e[0],y:e[1]});function d(e,t){let[i,a,r,n]=t,o=.5;for(;o>=0&&o<=1;){let t=Math.pow(1-o,3)*i.x+3*Math.pow(1-o,2)*o*a.x+3*(1-o)*Math.pow(o,2)*r.x+Math.pow(o,3)*n.x;if(1e-5>Math.abs(t-e))return Math.pow(1-o,3)*i.y+3*Math.pow(1-o,2)*o*a.y+3*(1-o)*Math.pow(o,2)*r.y+Math.pow(o,3)*n.y;t<e?o+=1e-5:o-=1e-5}return null}function c(e){let t=[],i=function(e){if(e.length<2)return[];let t=[];t.length=2*e.length-2;let i=e.length-1;if(1===i)return t[0]={x:(2*e[0].x+e[1].x)/3,y:(2*e[0].y+e[1].y)/3},t[1]={x:2*t[0].x-e[0].x,y:2*t[0].y-e[0].y},t;let a=[];a[0]=e[0].x+2*e[1].x;for(let t=1;t<i-1;++t)a[t]=4*e[t].x+2*e[t+1].x;a[i-1]=(8*e[i-1].x+e[i].x)/2;let r=s(a);a[0]=e[0].y+2*e[1].y;for(let t=1;t<i-1;++t)a[t]=4*e[t].y+2*e[t+1].y;a[i-1]=(8*e[i-1].y+e[i].y)/2;let n=s(a);for(let a=0,o=0;a<i;++a,++o)t[o]={x:r[a],y:n[a]},o++,a<i-1?t[o]={x:2*e[a+1].x-r[a+1],y:2*e[a+1].y-n[a+1]}:t[o]={x:(e[i].x+r[i-1])/2,y:(e[i].y+n[i-1])/2};return t}(e);for(let a=0;a<e.length;a++)if(0===a){let r={pos:e[a],leftCtrlDeltaX:0,leftCtrlDeltaY:0,rightCtrlDeltaX:i[a].x-e[a].x,rightCtrlDeltaY:i[a].y-e[a].y};t.push(r)}else if(a===e.length-1){let r={pos:e[a],leftCtrlDeltaX:i[2*a-1].x-e[a].x,leftCtrlDeltaY:i[2*a-1].y-e[a].y,rightCtrlDeltaX:0,rightCtrlDeltaY:0};t.push(r)}else{let r={pos:e[a],leftCtrlDeltaX:i[2*a-1].x-e[a].x,leftCtrlDeltaY:i[2*a-1].y-e[a].y,rightCtrlDeltaX:i[2*a].x-e[a].x,rightCtrlDeltaY:i[2*a].y-e[a].y};t.push(r)}for(let e=0;e<t.length;e++){let i={x:t[e].leftCtrlDeltaX+t[e].pos.x,y:t[e].leftCtrlDeltaY+t[e].pos.y},a={x:t[e].rightCtrlDeltaX+t[e].pos.x,y:t[e].rightCtrlDeltaY+t[e].pos.y};if(t[e].leftCtrlDeltaX-=i.x>1?i.x-1:i.x<0?-(0-i.x):0,t[e].leftCtrlDeltaY-=i.y>1?i.y-1:i.y<0?-(0-i.y):0,t[e].rightCtrlDeltaX-=a.x>1?a.x-1:a.x<0?-(0-a.x):0,t[e].rightCtrlDeltaY-=a.y>1?a.y-1:a.y<0?-(0-a.y):0,0===e){let i=t[e+1].pos,a=t[e].pos,r=Math.abs(a.x-i.x),n=Math.abs(a.y-i.y);t[e].rightCtrlDeltaX/=r<.08?6:r<.12?3:r<.2?2:1,t[e].rightCtrlDeltaY/=n<.03?4:n<.06?2:1}else if(e===t.length-1){let i=t[e-1].pos,a=t[e].pos,r=Math.abs(a.x-i.x),n=Math.abs(a.y-i.y);t[e].leftCtrlDeltaX/=r<.08?6:r<.12?3:r<.2?2:1,t[e].leftCtrlDeltaY/=n>=.9&&r<.1?4:n<.03?4:n<.06?2:1}else{let i=t[e+1].pos,a=t[e-1].pos,r=t[e].pos,n=Math.abs(r.x-i.x)+Math.abs(r.x-a.x),o=Math.abs(r.y-i.y)+Math.abs(r.y-a.y);t[e].leftCtrlDeltaX/=n<.08?6:n<.12?3:n<.2?2:1,t[e].leftCtrlDeltaY/=o<.03?4:o<.06?2:1,t[e].rightCtrlDeltaX/=n<.08?6:n<.12?3:n<.2?2:1,t[e].rightCtrlDeltaY/=o<.03?4:o<.06?2:1}}let a=[];for(let e=0;e<t.length;e++){if(0!==e){let i={x:t[e].pos.x+t[e].leftCtrlDeltaX,y:t[e].pos.y+t[e].leftCtrlDeltaY};a.push(i)}if(e!==t.length-1){let i={x:t[e].pos.x+t[e].rightCtrlDeltaX,y:t[e].pos.y+t[e].rightCtrlDeltaY};a.push(i)}}return a}},232297:function(e,t,i){i.d(t,{v:function(){return a}});class a{get(e){try{var t;let i=JSON.parse(null!==(t=localStorage.getItem(this._key))&&void 0!==t?t:"{}");if(null==i?void 0:i.value)return i.value[e]}catch(e){}return null}set(e,t){try{let i=localStorage.getItem(this._key),a=i?JSON.parse(i):{value:{}};a.value[e]=t,localStorage.setItem(this._key,JSON.stringify(a))}catch(e){}}remove(e){if(e)try{let t=localStorage.getItem(this._key),i=t?JSON.parse(t):{value:{}};i.value[e]&&delete i.value[e]}catch(e){}else localStorage.removeItem(this._key)}constructor(e){this._key=e}}},209264:function(e,t,i){i.d(t,{J:function(){return n},s:function(){return o}});var a=i(40552),r=i.n(a);function n(){let e=getComputedStyle(document.documentElement);return r()(e.getPropertyValue("--attribute-panel-content-width"))}function o(){let{left:e}=document.getElementById("workbench-editor-container").getBoundingClientRect();return{left:e/2}}},303544:function(e,t,i){i.d(t,{P:function(){return d}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(70858).D,name:r.j.ToolbarFilterBasic,type:"unpin",icon:()=>(0,a.jsx)(o.AqX,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.Filter],defaultActiveGroupList:[s.D.Filter]}],toolBarPanel:[{name:r.j.ToolbarFilterBasic,content:(0,a.jsx)(l.v,{})}]}},685772:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarMutableAudioBasic",r="basic"},367152:function(e,t,i){i.d(t,{P:function(){return d}});var a=i(772322),r=i(801497),n=i(150564),o=i(108917),s=i(612809),l=i(728631);let d={toolBar:[{id:i(685772).D,name:l.j.ToolbarMutableAudioBasic,type:"unpin",icon:()=>(0,a.jsx)(n.GCV,{fontSize:20}),title:()=>r.ZP.t("audio_web",{},"Audio"),groups:[o.D.Mutable]}],toolBarPanel:[{name:l.j.ToolbarMutableAudioBasic,content:(0,a.jsx)(s.v,{})}]}},951853:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarPictureAdjustBasic",r="basic"},592563:function(e,t,i){i.d(t,{P:function(){return d}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(951853).D,name:r.j.ToolbarPictureAdjustBasic,type:"unpin",icon:()=>(0,a.jsx)(o.wwn,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.PictureAdjust],defaultActiveGroupList:[s.D.PictureAdjust]}],toolBarPanel:[{name:r.j.ToolbarPictureAdjustBasic,content:(0,a.jsx)(l.v,{})}]}},989994:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarTextTemplateMotion",r="motion"},877943:function(e,t,i){i.d(t,{D:function(){return a},j:function(){return r}});let a="toolbarTextTracking",r={ToolbarTextTracking:"ToolbarTextTracking"}},583897:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarTransitionBasic",r="basic"},97920:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarVideoBackground",r="background"},96233:function(e,t,i){i.d(t,{e:function(){return n},w:function(){return o}});var a,r,n=((a={})[a.TimeLapse=0]="TimeLapse",a[a.Fluorescent=1]="Fluorescent",a);var o=((r={})[r.Weak=1]="Weak",r[r.Recommend=2]="Recommend",r[r.Strong=3]="Strong",r)},780344:function(e,t,i){i.d(t,{P:function(){return d}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(532843).DQ,name:r.j.ToolbarVideoBasic,type:"unpin",icon:()=>(0,a.jsx)(o.eIr,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.Video,s.D.VideoCombination,s.D.MutableVideo],defaultActiveGroupList:[s.D.Video]}],toolBarPanel:[{name:r.j.ToolbarVideoBasic,content:(0,a.jsx)(l.v,{})}]}},171765:function(e,t,i){i.d(t,{P:function(){return c}});var a=i(772322),r=i(217626),n=i(728631),o=i(801497),s=i(150564),l=i(108917),d=i(612809);let c={toolBar:[{id:r.DQ,name:n.j.ToolbarVideoCutout,type:"unpin",icon:()=>(0,a.jsx)(s.YL9,{fontSize:20}),title:()=>o.ZP.t("web_retouch_text_smart_tools",{},"Smart tools"),groups:[l.D.Video,l.D.Unselected]}],toolBarPanel:[{name:n.j.ToolbarVideoCutout,content:(0,a.jsx)(d.v,{})}]}},907402:function(e,t,i){i.d(t,{P:function(){return d}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),l=i(612809);let d={toolBar:[{id:i(689342).DQ,name:r.j.ToolbarVideoElement,type:"unpin",icon:()=>(0,a.jsx)(o.maj,{fontSize:20,fill:"currentColor"}),title:()=>n.ZP.t("web_multi_track_tab_items",{},"Elements"),groups:[s.D.VideoCombination],defaultActiveGroupList:[s.D.VideoCombination],order:1,appendDividerAfter:!0}],toolBarPanel:[{name:r.j.ToolbarVideoElement,content:(0,a.jsx)(l.v,{})}]}},709479:function(e,t,i){i.d(t,{DQ:function(){return a},N3:function(){return r}});let a="toolbarVideoSpeed",r="speed"},314108:function(e,t,i){i.d(t,{i:function(){return a}});function a(e,t){return new Promise((i,a)=>{let r=setTimeout(()=>{a(e)},3e3);t.onAddClip(t=>{let{clipId:n,result:o}=t;e===n&&(0===o?i(e):a(e),clearTimeout(r))})})}},961656:function(e,t,i){i.d(t,{z:function(){return c}});var a=i(789786),r=i(108692),n=i(402655),o=i(426336),s=i(722169),l=i(200247),d=i(811750);class c extends n.JT{get attachmentManager(){return o.lLh.getInstance()}startListenSaveEvents(){this._listenSaveEvents()}updateRenderManager(e){this._renderManager=e}_listenSaveEvents(){this.attachmentManager.onChangeAttachment(this._handleChange.bind(this))}_handleAsyncTaskAttachmentChange(){let e=this._mainDraftService.dataSdk.getAttachmentAsyncTaskStr();this._saveDraftStr(d.ij,e),this._algorithmFilerManager.addUploadQueue(d.ij),this._upload()}_handleChange(e){let t=this.attachmentManager.get(e).getDraftStr(this._mainDraftService.dataSdk);this._saveDraftStr(e,t),this._algorithmFilerManager.addUploadQueue(e),this._upload()}_saveDraftStr(e,t){this._renderManager.fs.writeFileSync(o.hPV.toAbsolutePath(e),t,{skipExist:!1})}constructor(e,t,i){super(),this._algorithmFilerManager=e,this._mainDraftService=t,this._accountService=i,this._upload=(0,s.debounce)(()=>{this._algorithmFilerManager.setUploadDirty(!0),this._algorithmFilerManager.uploadWhileUnmount()},300),this._mainDraftService.dataSdk.onChangeDiff(e=>{this.attachmentManager.draftDidUpdate(this._mainDraftService.dataSdk,e),e[o.u4I.ATTACHMENT].find(e=>e.item.attachmentKey===o.d3H.AsyncTask)&&this._handleAsyncTaskAttachmentChange()})}}c=(0,a.gn)([(0,a.fM)(1,r.n),(0,a.fM)(2,l.D),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof AlgorithmFilerManager?Object:AlgorithmFilerManager,void 0===r.n?Object:r.n,void 0===l.D?Object:l.D])],c)},707382:function(e,t,i){i.d(t,{r:function(){return h}});var a=i(789786),r=i(569471),n=i(587892),o=i(729596),s=i(426336),l=i(200247),d=i(655521),c=i(136877),u=i(425427);class h extends d.G{_initMetaHook(){var e,t;!this._meta.createSource&&(this._meta.createSource=(0,r.I)(this._meta.uploadSource)),this._templateId=null!==(e=this._meta.draft.templateId)&&void 0!==e?e:"",(0,u.o2)(this._environmentService)&&this._templateId.indexOf(",")&&(this._templateId=""),this._templateType=null!==(t=this._meta.draft.itemType)&&void 0!==t?t:0}setMetaDraft(e){this._meta.draft=e,this._recordDirtyAndNotify()}resetMeta(e){this._meta=e,this._initMetaHook(),this._recordDirtyAndNotify()}refreshMetaDraft(e,t){this._meta.draft.id=e,this._meta.draft.name=t,this._meta.createSource.createTime=Date.now(),this._meta.uploadSource.createTime=Date.now(),this._recordDirtyAndNotify()}setTemplate(e,t){this._templateId=e,this._templateType=t,this._recordDirtyAndNotify()}setDraftTransferedFrom(e){this._meta.draft.transferedFrom=e,this._recordDirtyAndNotify()}getDraftTransferedFrom(){return this._meta.draft.transferedFrom}resetTemplate(){this._templateId="",this._templateType=0,this._recordDirtyAndNotify()}getMeta(){return this.dirty&&this._updateMeta(),this._meta}getTemplateId(){var e;return null!==(e=this._templateId)&&void 0!==e?e:""}_updateMeta(){this._onPreUpdateMeta.fire();let e=(0,r.I)(this._meta);e.uploadSource=this._makeSource(),e.draft.id=this._dataSdk.draftView.getDraftId(),e.draft.name=this._dataSdk.draftView.getDraftName();let{draft:t}=e,{webVideoEditorInfo:i={}}=t;!(null==i?void 0:i.created_from)&&(e.draft.webVideoEditorInfo={...i,created_from:(0,u.JY)(this._environmentService)&&(0,u.xA)(this._environmentService)?c.t5.EmptyCutsame:void 0}),e.draft.type=(0,u.JY)(this._environmentService)?c.hB.VideoTemplate:c.hB.VideoCut,e.draft.duration=parseInt(o.h.usToMs(this._dataSdk.draftView.getDuration()).toFixed(0),10),e.draft.updateTime=Date.now(),e.draft.templateId=""===this._templateId?void 0:this._templateId,e.draft.itemType=""===this._templateId?void 0:this._templateType,e.draft.segmentCount=this._dataSdk.cutSame.getMutableVideos().length,e.draft.version=this._dataSdk.draftView.getDraftMetadata().newVersion;let a=this._dataSdk.draftView.getMainTrack();a?e.draft.isMainTrackEmpty=0===a.segments.length:e.draft.isMainTrackEmpty=!0,this._environmentService.isFromThirdPartPlatform?e.draft.transferedFrom=c.ZZ.chatgpt:this._environmentService.isFromChatGPT&&(e.draft.transferedFrom=c.ZZ.chatgpt_search),this._meta=e,this._consumeDirtySignal()}constructor(e,t,i){super({draftChangeEvent:e.onChangeDiff},t,i),this._dataSdk=e,this._environmentService=i,this.uuid=(0,s.pB0)(),this._templateId="",this._templateType=0,this._onPreUpdateMeta=new n.Q,this.onPreUpdateMeta=this._onPreUpdateMeta.event}}h=(0,a.gn)([(0,a.fM)(1,l.D),(0,a.fM)(2,u.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===l.D?Object:l.D,void 0===u.rO?Object:u.rO])],h)},165312:function(e,t,i){i.d(t,{J:function(){return n}});var a=i(260963),r=i(393910);class n{info(e){var t;let i=this.now();this._logs.push({type:"info",date:i.formatted,message:e,time:i.time,duration:i.time-(null===(t=this._logs[this._logs.length-1])||void 0===t?void 0:t.time)})}warn(e){var t;let i=this.now();this._logs.push({type:"warn",date:i.formatted,message:e,time:i.time,duration:i.time-(null===(t=this._logs[this._logs.length-1])||void 0===t?void 0:t.time)})}error(e){var t;let i=this.now();this._logs.push({type:"error",date:i.formatted,message:e,time:i.time,duration:i.time-(null===(t=this._logs[this._logs.length-1])||void 0===t?void 0:t.time)})}showPanel(){(0,r.x)(this._logs)}now(){let e=new Date,t=e.getFullYear(),i=e.getMonth(),a=e.getDate(),r=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),s=e.getMilliseconds();return{formatted:`${t}/${i}/${a} ${r}:${n}:${o}.${s}`,time:e.getTime()}}constructor(){this._logs=(0,a.LO)([])}}},64604:function(e,t,i){i.d(t,{_:function(){return _}});var a=i(789786),r=i(426336),n=i(850427),o=i(196269),s=i(948328),l=i(108692),d=i(425427),c=i(433140),u=i(230689),h=i(434316),p=i(800788);class _ extends n.z{async preload(){let{templateIdFromUrl:e}=this._environmentService,t=this._preloadManager.preloadPackageData((0,h.fC)(),!0),[i,a]=(await t).pair();if(i)return this._debuggerLogger.info(`preload \u{52A0}\u{8F7D} packageInfo \u{5931}\u{8D25}`),null;if(this.hasQuickImport(a))return this._debuggerLogger.info(`preload \u{5B58}\u{5728}\u{5FEB}\u{901F}\u{5BFC}\u{5165}\u{7D20}\u{6750}`),null;let r=this._preloadManager.preloadDraftResources(t,{shouldDisableProgressiveLoading:!0},this.filterPackageAssets,this.filterOnlineResources),n=(0,o.BE)(this._containerService,e),s=n.pTemplateInfo,l=[t,r,s,n.templateResource],{waitForEnsureFinished:d,waitForMetasReady:c}=await r;return await Promise.all([d(),c()]),l}async resetDraft(e){let{draftIdFromUrl:t}=this._environmentService;try{var i,a,n,o,s,l,d;let[c,u,h,_]=e,[g,f]=(await c).pair();g&&(0,p.ZB)(f),await _;let m=await h;this.setTemplateInfo(m);let v=null!==(d=null==f?void 0:f.template)&&void 0!==d?d:null,y=null==f?void 0:null===(a=f.meta)||void 0===a?void 0:null===(i=a.draft)||void 0===i?void 0:i.name;await this.restoreDraft({meta:null==f?void 0:f.meta,draftJson:v,preloadResourcePromise:u,overrideDraftId:null!=t?t:null==f?void 0:null===(o=f.meta)||void 0===o?void 0:null===(n=o.draft)||void 0===n?void 0:n.id,overrideDraftName:y,draftDataVersion:null==f?void 0:null===(l=f.meta)||void 0===l?void 0:null===(s=l.uploadSource)||void 0===s?void 0:s.draft_ve_version,packageId:null==f?void 0:f.syncId}),this._dataSdk.api.draft.setCanvasSize({ratio:f.ratio||r.rxY.CanvasRatio16To9})}catch(e){}}setTemplateInfo(e){var t;this._draftTemplateManager.setTemplate(e.id,e.templateType),null===(t=this._canvasManager.modules.templateManager)||void 0===t||t.setTemplateInfo(e.id,e)}constructor(e,t,i,a,r,n,o,s,l,d,c,u){super(e,t,l,d,s),this._preloadManager=i,this._canvasManager=a,this._draftTemplateManager=r,this._timelineManager=n,this._debuggerLogger=o,this._containerService=c,this._environmentService=u}}_=(0,a.gn)([(0,a.fM)(7,s.D),(0,a.fM)(8,c.c),(0,a.fM)(9,l.n),(0,a.fM)(10,u.t),(0,a.fM)(11,d.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IPreloadManager?Object:IPreloadManager,"undefined"==typeof ICanvasManager?Object:ICanvasManager,"undefined"==typeof IDraftTemplateManager?Object:IDraftTemplateManager,"undefined"==typeof ITimelineManager?Object:ITimelineManager,"undefined"==typeof DebuggerLogger?Object:DebuggerLogger,void 0===s.D?Object:s.D,void 0===c.c?Object:c.c,void 0===l.n?Object:l.n,void 0===u.t?Object:u.t,void 0===d.rO?Object:d.rO])],_)},919111:function(e,t,i){i.d(t,{H:function(){return a}});class a{getResourceKeyFromDraftPath(e){return this.draftPathResourceKeyRecord[e]?this.draftPathResourceKeyRecord[e]:null}getDraftPathFromResourceKey(e){return this.resourceKeyDraftPathRecord[e]?this.resourceKeyDraftPathRecord[e]:null}recordDraftPathToResourceKey(e,t){this.draftPathResourceKeyRecord[e]=t}recordResourceKeyToDraftPath(e,t){if(this.resourceKeyDraftPathRecord[e]){let i=this.resourceKeyDraftPathRecord[e];i!==t&&console.warn("A existed resource key has been updated from: ",i,"to: ",t)}this.resourceKeyDraftPathRecord[e]=t}constructor(){this.draftPathResourceKeyRecord={},this.resourceKeyDraftPathRecord={}}}},847264:function(e,t,i){i.d(t,{e:function(){return m}});var a=i(789786),r=i(606527),n=i(230689),o=i(569471),s=i(475590),l=i(587892),d=i(690613),c=i(426336),u=i(493359),h=i(263757),p=i(948328),_=i(756024),g=i(204806);let f="cover.jpg";class m{getHasFirstFrameChanged(){return this._hasFirstFrameChanged}serialize(){let e={cloudMeta:this._cloudMeta,packageId:this._packageId,draftJson:this._draftJson,workspaceId:this._workspaceId,packageAssets:this._packageAssets};return c.HHr.stringify(e)}getCloudMeta(){return this._cloudMeta}getDraftJson(){return this._draftJson}getDraftJsonWithNewDraftId(e){try{let t=JSON.parse(this._draftJson);return t.id=e,JSON.stringify(t)}catch(e){return this._draftJson}}getPackageAssets(){return this._packageAssets}notifyComplete(e){this._onComplete.fire(e)}setCoverTask(e){this._makeCoverTask=e}setDraftName(e){this._cloudMeta.draft.name=e}setDraftId(e){this._cloudMeta.draft.id=e}setPackageId(e){this._packageId=e}setIsOffline(e){this._isOffline=e}getIsOffline(){return this._isOffline}getIsNeedCheck(){return this._isNeedCheck}setIsNeedCheck(e){this._isNeedCheck=e}updateCreateTime(e){this._cloudMeta.createSource.createTime=e,this._cloudMeta.uploadSource.createTime=e}getCoverUrl(){return this._newCoverUrl}async execute(e){var t;let{userGeneratedMaterials:i,autoGeneratedMaterials:a}=this._draftMaterialsService.getMaterials(),r=(0,u.wW)([...i,...a]);if(r){let e=`syncFailedMaterial:${r.syncingUserMaterial.error.msg}`,t=r.syncingUserMaterial.error.code;return(0,d.wf)(t,`${e}:${t}`)}this._updateCloudMeta();let n=await (0,g.gq)(this._containerService,this._cloudMeta.draft.size,this._uploadSizeChecker,this._workspaceId);if(!n.ok){let e=`notEnoughSpace:${n.msg}`,t=n.code;return(0,d.wf)(t,e)}let o=!1,l="";this._makeCoverTask?this._makeCoverTask.hasCover()?([,l]=(await (0,s.Hp)(async e=>{let t="";try{t=await this._makeCoverTask.getBase64Url()}catch(e){_.t.error("draft-save-task","getCoverTaskError",null==e?void 0:e.message)}return e.isCancellationRequested?null:t},1e4)).pair(),l&&(o=!0,this._newCoverUrl=l,this._cloudMeta.draft.cover=f)):this._cloudMeta.draft.cover=void 0:(this._cloudMeta.draft.cover=f,console.log("[saving]","use last cover"));let{renderSegmentList:c=[],renderMutableList:p=[]}=null!==(t=this._extraSaveDraftParams)&&void 0!==t?t:{},m=null==l?void 0:l.split("base64,")[1],v={workspaceId:this._workspaceId,packageType:2,packageKey:this._cloudMeta.draft.id,basePackageId:this._packageId,templateData:this._draftJson,templateMeta:JSON.stringify(this._cloudMeta),isCoverChange:o,coverImageContent:m,packageAssets:this._packageAssets,renderMutableList:p,renderSegmentList:c,deviceId:(0,h.Zw)(),...e};return this._saveComplete(v)}async _saveComplete(e){return await (0,s.Hp)(async t=>{let i=await this._draftSaveService.save(e);return t.isCancellationRequested?"":i},6e4)}_updateCloudMeta(){this._cloudMeta.draft.updateTime=Date.now();let e=this._packageAssets.reduce((e,t)=>e+=t.size,this._draftJson.length);this._cloudMeta.draft.size=e}constructor(e,t,i,a,r,n,s,d,c,u,h){this._packageId=t,this._draftJson=i,this._workspaceId=a,this._packageAssets=r,this._uploadSizeChecker=n,this._extraSaveDraftParams=s,this._hasFirstFrameChanged=d,this._draftSaveService=c,this._draftMaterialsService=u,this._containerService=h,this._isNeedCheck=!0,this._newCoverUrl="",this._isOffline=!1,this._onComplete=new l.Q,this.onComplete=this._onComplete.event,this._cloudMeta=(0,o.I)(e)}}m=(0,a.gn)([(0,a.fM)(8,r._),(0,a.fM)(9,p.D),(0,a.fM)(10,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ICloudDraftMeta?Object:ICloudDraftMeta,String,String,String,Array,"undefined"==typeof UploadSizeChecker?Object:UploadSizeChecker,"undefined"==typeof Partial?Object:Partial,Boolean,void 0===r._?Object:r._,void 0===p.D?Object:p.D,void 0===n.t?Object:n.t])],m)},285409:function(e,t,i){i.d(t,{Y:function(){return n}});var a=i(426336),r=i(444381);class n extends r.M{_findPath(e){return(0,a.hey)(e)?e.material.matting.path:""}_acquireByPath(e,t){let[i,a]=t.split(";");i&&super._acquireByPath(e,i),a&&super._acquireByPath(e,a)}_releaseByPath(e,t){let[i,a]=t.split(";");i&&super._releaseByPath(e,i),a&&super._releaseByPath(e,a)}}},114011:function(e,t,i){i.d(t,{E:function(){return n}});var a=i(426336),r=i(444381);class n extends r.M{_findPath(e){var t,i;return(0,a.hey)(e)&&(null===(t=e.smartCrop)||void 0===t?void 0:t.cachePath)?null===(i=e.smartCrop)||void 0===i?void 0:i.cachePath:""}}},805177:function(e,t,i){i.d(t,{g:function(){return n}});var a=i(444381),r=i(426336);class n extends a.M{_findPath(e){return(0,r.Y9Q)(e)&&e.material.type===r.cVg.MetaTypeTextToAudio?e.material.path:""}}},826913:function(e,t,i){i.d(t,{E:function(){return p}});var a=i(789786),r=i(426336),n=i(433140),o=i(230689),s=i(460254),l=i(909034),d=i(756024),c=i(690613),u=i(322401),h=i(789193);class p{updateRenderManager(e){this._renderManager=e}async replace(e,t){if(!this._renderManager)return(0,u.$)(h.F.RenderManagerUndefined);let i=Array.from(e,()=>(0,c.ly)()),a=e.map(e=>({mutableId:e.segmentId,type:e.type,value:e.value,draftId:t,error:void 0}));this._callbackOptions.beforeReplaceMutable(a,t);try{let o=Array.from(e,()=>Promise.resolve(void 0));for(let i=0;i<e.length;i++){let a=e[i];try{o[i]=a.type===s.r.Audio?(0,l.nP)(a.value,this._ensureManager,this._renderManager,this._resourceService):(0,l.RN)(a.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService,t)}catch(e){d.t.error(e)}}let c=await Promise.allSettled(o),p=[],_=new Map;for(let t=0;t<c.length;t++){let o=c[t];if("rejected"===o.status){i[t]=(0,u.$)(h.F.MissResource),a[t].error=i[t];continue}let l=e[t];if(l.type===s.r.UserAudio){var r,n;let e=await (null===(n=l.value)||void 0===n?void 0:null===(r=n.addModelToDraft)||void 0===r?void 0:r.call(n));if(e&&!e.ok){let e=(0,u.$)(h.F.MissResource);return a[t].error=e,e}}_.set(p.length,t),p.push(l.type===s.r.Audio?this._resourceToAudioParam(l.value,o.value.segmentPath,l):this._userResourceToAudioParam(l.value,o.value.segmentPath,l))}let g=this._dataSdk.api.template.setMutableAudios({audios:p,draftId:t});if(!g.ok||!g.value.length)return(0,u.$)(h.F.ReplaceSegment);for(let e=0;e<g.value.length;e++)i[_.get(e)]=g.value[e]}catch(e){return d.t.error(e),(0,u.$)(h.F.Unknown)}finally{this._callbackOptions.afterReplaceMutable(a,t)}return(0,c.oW)(i)}_resourceToAudioParam(e,t,i){return{segmentId:i.segmentId,path:t,musicId:e.resourceId,musicName:e.title,musicCategoryTitle:"music",type:r.cVg.MetaTypeMusic,sourceTime:(0,r.xrB)({start:i.sourceStart,duration:i.sourceDuration}),targetTime:(0,r.xrB)({start:i.targetStart,duration:i.targetDuration}),duration:(0,r.k3U)(e.duration,1000000n,"bigint")}}_userResourceToAudioParam(e,t,i){var a;return{segmentId:i.segmentId,path:t,musicId:"",musicName:null!==(a=e.filename)&&void 0!==a?a:"",musicCategoryTitle:"music",type:r.cVg.MetaTypeMusic,sourceTime:(0,r.xrB)({start:i.sourceStart,duration:i.sourceDuration}),targetTime:(0,r.xrB)({start:i.targetStart,duration:i.targetDuration}),duration:(0,r.k3U)(e.duration,1000000n,"bigint")}}constructor(e,t,i,a,r,n,o){this._dataSdk=e,this._renderManager=t,this._ensureManager=i,this._draftPathStore=a,this._callbackOptions=r,this._resourceService=n,this._containerService=o}}p=(0,a.gn)([(0,a.fM)(5,n.c),(0,a.fM)(6,o.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IReplaceSegmentCallbackOptions?Object:IReplaceSegmentCallbackOptions,void 0===n.c?Object:n.c,void 0===o.t?Object:o.t])],p)},681962:function(e,t,i){i.d(t,{z:function(){return m}});var a=i(789786),r=i(426336),n=i(335534),o=i(426020),s=i(433140),l=i(230689),d=i(460254),c=i(909034),u=i(690613),h=i(800788),p=i(756024),_=i(322401),g=i(789193),f=i(380455);class m{updateRenderManager(e){this._renderManager=e}async replace(e,t){if(!this._renderManager)return(0,_.$)(g.F.RenderManagerUndefined);let i=Array.from(e,()=>(0,u.ly)()),a=e.map(e=>({mutableId:e.mutableVideoId,type:e.type,value:e.value}));this._callbackOptions.beforeReplaceMutable(a,t);try{let a=Array.from(e,()=>Promise.resolve(void 0));for(let i=0;i<e.length;i++){let r=e[i];try{switch(r.type){case d.r.Video:a[i]=(0,c.y$)(r.value,this._ensureManager,this._renderManager,this._resourceService);break;case d.r.UserVideo:a[i]=(0,c.ti)(r.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService,t);break;case d.r.Photo:a[i]=(0,c.pv)(r.value,this._ensureManager,this._renderManager,this._resourceService);break;case d.r.UserPhoto:a[i]=(0,c.q3)(r.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService,t);break;default:(0,h.bP)(r,"option type error")}}catch(e){p.t.error(e)}}let s=await Promise.allSettled(a),l=await Promise.all(s.map(e=>{var t;return"fulfilled"===e.status?this._renderManager.getMediaFileInfo(e.value.resPath,null!==(t=e.value.decryptKey)&&void 0!==t?t:""):null})),f=[],m=new Map;for(let t=0;t<s.length;t++){let a;let c=s[t];if("rejected"===c.status){(0,u.oi)(c.reason)&&c.reason.code===n.D.OrderFailedFE?i[t]=(0,_.$)(g.F.OrderFailed):i[t]=(0,_.$)(g.F.MissResource);continue}let p=e[t];if(p.type===d.r.UserVideo||p.type===d.r.UserPhoto){var r,o;let e=await (null===(o=p.value)||void 0===o?void 0:null===(r=o.addModelToDraft)||void 0===r?void 0:r.call(o));if(e&&!e.ok)return(0,_.$)(g.F.MissResource)}let v=l[t];if(!v){i[t]=(0,_.$)(g.F.GetMediaFileInfo);continue}switch(p.type){case d.r.Video:case d.r.Photo:a=this._resourceToVideoParam(p.value,c.value.segmentPath,v,p);break;case d.r.UserVideo:case d.r.UserPhoto:a=this._userResourceToVideoParam(p.value,c.value.segmentPath,v,p);break;default:(0,h.bP)(p,"option type error")}m.set(f.length,t),f.push(a)}for(let e of f)0===e.crop.length&&(e.crop=this._dataSdk.cutSame.getMutableVideos(t).find(t=>t.id===e.id).crop);let v=this._dataSdk.api.template.setMutableVideos({videos:f,draftId:t});if(!v.ok)return(0,_.$)(g.F.ReplaceSegment);for(let e=0;e<v.value.length;e++)i[m.get(e)]=v.value[e]}catch(e){return p.t.error(e),(0,_.$)(g.F.Unknown)}finally{this._callbackOptions.afterReplaceMutable(a,t)}return(0,u.oW)(i)}async reset(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!this._renderManager)return(0,_.$)(g.F.RenderManagerUndefined);let a=this._dataSdk.cutSame.getMutableVideos(t).filter(t=>e.includes(t.id)),n=a.map(e=>{var t,i;return this._renderManager.getMediaFileInfo((0,r.dlx)("",null!==(i=null===(t=this._renderManager.resourceRecords.getRecordBySegmentPath(e.coverPath))||void 0===t?void 0:t.resPath)&&void 0!==i?i:""),"")}),o=await Promise.all(n);if(o.some(e=>null===e))return(0,_.$)(g.F.GetMediaFileInfo);let s=(0,u.oW)([]),l=this._dataSdk.api.batch.batchStart();try{a.map(e=>{this._dataSdk.api.video.setVideoAlgorithm({segmentId:e.segmentId,draftId:t,path:""},i)}),s=this._dataSdk.api.template.setMutableVideos({videos:a.map((e,t)=>({id:e.id,sourcePlatform:0,materialId:"",materialName:"",path:(0,r.ZK_)(this._renderManager.resourceRecords,"",e.coverPath),originalPath:"",isMutable:!1,width:o[t].width,height:o[t].height,rotation:o[t].rotation,mediaType:o[t].type,duration:o[t].duration,crop:[],sourceStart:0n,volume:0,initialSpeed:0})),draftId:t},i)}catch(e){return p.t.error(e),(0,_.$)(g.F.Unknown)}finally{this._dataSdk.api.batch.batchEnd(l)}return s.ok?s:(0,_.$)(g.F.ReplaceSegment)}_resourceToVideoParam(e,t,i,a){var r;return{id:a.mutableVideoId,sourcePlatform:f.t.toSourcePlatform(e.source,e.publishSource),materialId:e.resourceId,materialName:e.title,path:t,originalPath:t,isMutable:!0,width:i.width,height:i.height,rotation:i.rotation,mediaType:i.type,duration:i.duration,crop:null!==(r=a.crop)&&void 0!==r?r:[],sourceStart:a.sourceStartTime,volume:a.volume,initialSpeed:a.initialSpeed,visible:a.visible}}_userResourceToVideoParam(e,t,i,a){var n,s;return(0,h.Y2)(e.fileType===o.YB.Video||e.fileType===o.YB.Image),{id:a.mutableVideoId,sourcePlatform:r.cvu.MaterialPlatformDefault,materialId:"",materialName:null!==(n=e.filename)&&void 0!==n?n:"",path:t,originalPath:t,isMutable:!0,width:i.width,height:i.height,rotation:i.rotation,mediaType:i.type,duration:i.duration,crop:null!==(s=a.crop)&&void 0!==s?s:[],sourceStart:a.sourceStartTime,volume:a.volume,initialSpeed:a.initialSpeed,visible:a.visible}}constructor(e,t,i,a,r,n,o){this._dataSdk=e,this._renderManager=t,this._draftPathStore=i,this._ensureManager=a,this._callbackOptions=r,this._resourceService=n,this._containerService=o}}m=(0,a.gn)([(0,a.fM)(5,s.c),(0,a.fM)(6,l.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IReplaceSegmentCallbackOptions?Object:IReplaceSegmentCallbackOptions,void 0===s.c?Object:s.c,void 0===l.t?Object:l.t])],m)},780206:function(e,t,i){i.d(t,{$4:function(){return p},$j:function(){return s},b3:function(){return c},hm:function(){return d},j1:function(){return h},mM:function(){return l}});var a=i(426336),r=i(426791),n=i(716913),o=i(915345);let s=(e,t)=>!!t&&e[a.u4I.SEGMENT].some(e=>e.type===a.C8.MOVE&&e.item.trackIndex!==e.item.segment.trackRenderIndex&&e.item.id===t),l=e=>{let t=e.segment,i={};return t.forEach(e=>{i[e.type+e.item.segment.__segment_struct_type]=!0}),i[a.C8.UPDATE+a.Ocy.SegmentVideo]&&i[a.C8.ADD+a.Ocy.SegmentAudio]},d=e=>e.segment.some(e=>{let t=e.item.segment;return e.type===a.C8.UPDATE&&!(0,r.Z)(t.material)&&!(0,r.Z)(t.volume)}),c=e=>e.segment.some(e=>e.type===a.C8.UPDATE&&!(0,r.Z)(e.item.segment.material)&&!(0,r.Z)(e.item.segment.sourceTimerange)),u=e=>{let t=e.item.segment,i=t.__segment_struct_type;if(!i)return!1;let a=o.L[i];return!!a&&a.some(e=>{let i=(0,n.Z)(t,e);return!(0,r.Z)(i)})},h=e=>{if(e.actionOperateType===a.aWQ.History)return!0;let t=e[a.u4I.SEGMENT];return!!(e[a.u4I.TRACK].length>0)||t.some(e=>u(e))},p=(e,t)=>{let{segment:i}=e,r=[];return i.forEach(e=>{if(e.type!==a.C8.UPDATE)return;let{segment:t,id:i}=e.item;if(!(0,a.RFV)(t)||!i)return;let{material:n}=t;(null==n?void 0:n.path)&&r.push(i)}),!!r.find(e=>e===t)}},212664:function(e,t,i){i.d(t,{Z:function(){return r},t:function(){return n}});var a,r=((a={})[a.Init=0]="Init",a[a.Replace=1]="Replace",a);let n=(e,t)=>{let{dataSdk:{api:i,draftView:a}}=e;i.template.setTemplateMute(a,1===t)}},796500:function(e,t,i){i.d(t,{l:function(){return a}});let a=()=>({wasmType:WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))&&WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11]))?"simd":"common"})},864831:function(e,t,i){i.d(t,{b:function(){return o}});var a=i(356954);let r="click_cloud_entrance";class n{getEventParams(){return this._params}constructor(e){this._params=e,this.eventName=r}}function o(e,t,i){r===i&&(0,a.K)(e,n,[t])}},229749:function(e,t,i){i.d(t,{Lc:function(){return s},QO:function(){return d},b:function(){return n},o1:function(){return o},ps:function(){return q},yg:function(){return l}});var a=i(688974),r=i(215518);let n={name:"edit_type",description:"\u5165\u53E3\u5DE5\u5177\u7C7B\u578B\uFF08\u5DE5\u5177\u6574\u4F53\u94FE\u8DEF\u900F\u4F20\uFF09",paramType:r.Rs.String},o={name:"tab_name",description:"tab\u540D\u79F0",paramType:r.Rs.String},s={name:"sub_tab",description:"\u5B50tab\u540D\u79F0",paramType:r.Rs.String},l={name:"smart_ad_request_id",description:"\u8BF7\u6C42id",paramType:r.Rs.String},d={name:"smart_ad_video_id",description:"\u7ED3\u679C\u9875\u751F\u6210\u7684\u89C6\u9891id",paramType:r.Rs.String},c={name:"set_platform",description:"\u5206\u4EAB\u5E73\u53F0",paramType:r.Rs.String},u={name:"set_video_duration",description:"\u8BBE\u7F6E\u7684\u89C6\u9891\u65F6\u957F",paramType:r.Rs.String},h={name:"video_type",description:"\u89C6\u9891\u7C7B\u522B",paramType:r.Rs.String};r.Rs.String;let p={name:"smart_derivation_request_id",description:"\u6210\u7247\u6D3E\u751F\u8BF7\u6C42id",paramType:r.Rs.String},_={name:"mode",description:"\u6D3E\u751F\u65B9\u5F0F",paramType:r.Rs.String},g={name:"smart_derivation_video_id",description:"\u6210\u7247\u6D3E\u751F\u7ED3\u679C\u89C6\u9891id",paramType:r.Rs.String},f={name:"size",description:"\u5C3A\u5BF8",paramType:r.Rs.String},m={name:"origin_lauguage",description:"\u539F\u59CB\u8BED\u8A00",paramType:r.Rs.String},v={name:"translate_language",description:"\u7FFB\u8BD1\u8BED\u8A00",paramType:r.Rs.String},y={name:"is_generate_caption",description:"\u662F\u5426\u751F\u6210\u5B57\u5E55",paramType:r.Rs.Integer},S={name:"caption_template_id",description:"\u5B57\u5E55\u6A21\u677Fid",paramType:r.Rs.String},k={name:"choose_change_script",description:"\u9009\u62E9\u66F4\u6362\u6216\u6DFB\u52A0\u811A\u672C",paramType:r.Rs.Integer},w={name:"choose_change_style",description:"\u9009\u62E9\u66F4\u6362\u5305\u88C5\u98CE\u683C",paramType:r.Rs.String},M={name:"choose_change_hook",description:"\u9009\u62E9\u66F4\u6362\u7247\u5934\u7247\u5C3E",paramType:r.Rs.Integer},b={name:"is_change_script",description:"\u662F\u5426\u66F4\u6362\u6216\u6DFB\u52A0\u811A\u672C",paramType:r.Rs.Integer},T={name:"is_change_style",description:"\u662F\u5426\u66F4\u6362\u5305\u88C5\u98CE\u683C",paramType:r.Rs.Integer},I={name:"is_change_hook",description:"\u662F\u5426\u66F4\u6362\u7247\u5934\u7247\u5C3E",paramType:r.Rs.Integer},D={name:"product",description:"\u4EA7\u54C1\u540D",paramType:r.Rs.String},P={name:"product_feature",description:"\u4EA7\u54C1\u5356\u70B9",paramType:r.Rs.String},F={name:"brand",description:"\u54C1\u724C\u540D",paramType:r.Rs.String},C={name:"target_audience",description:"\u76EE\u6807\u7528\u6237",paramType:r.Rs.String},E={name:"price",description:"\u4EF7\u683C",paramType:r.Rs.String},x={name:"promotion",description:"\u4FC3\u9500\u4FE1\u606F",paramType:r.Rs.String},R={name:"replace_video_time",description:"\u66FF\u6362\u539F\u89C6\u9891\u7684\u521D\u59CB\u65F6\u95F4\u70B9\uFF0C\u5355\u4F4Dms",paramType:r.Rs.Integer},A={name:"replace_video_duration",description:"\u66FF\u6362\u539F\u89C6\u9891\u7684\u7247\u6BB5\u65F6\u957F\uFF0C\u5355\u4F4Dms",paramType:r.Rs.Integer},O={name:"replace_material_cnt",description:"\u9009\u62E9\u7684\u7247\u6BB5\u6570\u91CF",paramType:r.Rs.Integer},U={name:"rank",description:"\u6392\u5E8F\uFF0C\u4ECE\u5DE6\u81F3\u53F3\uFF0C\u4ECE\u4E0A\u81F3\u4E0B\uFF0C\u4ECE1\u5F00\u59CB\u8BA1\u6570",paramType:r.Rs.Integer};r.Rs.Integer,r.Rs.String,r.Rs.String,r.Rs.String,r.Rs.String,r.Rs.String,r.Rs.String,r.Rs.String,r.Rs.String,r.Rs.String,r.Rs.String;let L={name:"enter_from",description:"\u6765\u6E90",paramType:r.Rs.String};r.Rs.String;let W={name:"product_name",description:"\u4EA7\u54C1\u540D",paramType:r.Rs.String},j={name:"product_id",description:"\u4EA7\u54C1 ID",paramType:r.Rs.String},N={name:"product_link",description:"\u4EA7\u54C1\u94FE\u63A5",paramType:r.Rs.String},B={name:"video_tag",description:"\u89C6\u9891\u6807\u7B7E",paramType:r.Rs.String},V={name:"is_light_editor_change",description:"\u662F\u5426\u5728\u8F7B\u91CF\u7F16\u8F91\u5668\u4E2D\u7F16\u8F91\u8FC7",paramType:r.Rs.Integer},H={name:"ai_character_category",description:"ai\u6570\u5B57\u4EBA\u7C7B\u522B",paramType:r.Rs.String},z={name:"page_from",description:"\u9875\u9762\u6765\u6E90",paramType:r.Rs.String};r.Rs.String;let Z={name:"generate_type",description:"\u6210\u7247\u751F\u6210\u7C7B\u578B",paramType:r.Rs.String},G={name:"script_generate_scene",description:"\u751F\u6210\u811A\u672C\u4F7F\u7528\u7684\u6A21\u578B",paramType:r.Rs.String},$={name:"generate_method",description:"\u6210\u7247\u751F\u6210\u65B9\u5F0F",paramType:r.Rs.String},Y={name:"target_events",description:"\u6210\u7247\u5BF9\u5E94\u8282\u65E5",paramType:r.Rs.String},K={name:"entrance_from",description:"\u5165\u53E3\u4F4D\u7F6E\u5206\u7C7B",paramType:r.Rs.String},X={name:"entrance_from_item",description:"\u5177\u4F53\u5165\u53E3\u4F4D\u7F6E\u5143\u7D20",paramType:r.Rs.String},J={[a._.SMART_AD_EDIT]:{smartAdRequestId:l,smartAdVideoId:d,setPlatform:c,setVideoDuration:u,videoType:h,productName:W,productId:j,productLink:N,videoTag:B,isLightEditorChange:V,aiCharacterCategory:H,generateType:Z,scriptGenerateScene:G,generateMethod:$,targetEvents:Y},[a._.SMART_DERIVATION]:{smartDerivationRequestId:p,mode:_,smartDerivationVideoId:g,size:f,originLauguage:m,translateLanguage:v,isGenerateCaption:y,captionTemplateId:S,chooseChangeScript:k,chooseChangeStyle:w,chooseChangeHook:M,isChangeScript:b,isChangeStyle:T,isChangeHook:I,product:D,productFeature:P,brand:F,targetAudience:C,price:E,promotion:x,replaceVideoTime:R,replaceVideoDuration:A,replaceMaterialCnt:O,rank:U},[a._.TEXT_TO_VIDEO]:{},[a._.REMOVE_BACKGROUND]:{},[a._.EDIT]:{}},q={editType:n,tabName:o,subTab:s,enterFrom:L,pageFrom:z,entranceFrom:K,entranceFromItem:X,...J[a._.SMART_AD_EDIT],...J[a._.SMART_DERIVATION],...J[a._.TEXT_TO_VIDEO],...J[a._.REMOVE_BACKGROUND],...J[a._.EDIT]}},374497:function(e,t,i){i.d(t,{Tc:function(){return f},ex:function(){return g},fl:function(){return h},h$:function(){return y},t$:function(){return m},wr:function(){return S},yM:function(){return v}});var a=i(854585),r=i(928261),n=i(861631),o=i(248222),s=i(108692),l=i(896413),d=i(425427),c=i(426336),u=i(337081);function h(e,t,i){var s,l,d,h,p,_,g;let{preload:f,canUpdateMusic:m,productInfos:v}=e,{json:y,mutableVideos:S,mutableAudios:k,mutableTexts:w}=f,M=!0,b=0,T=0,I=0,D=0,P=[],F=[],C=["free"],{dataSdk:E}=null!=i?i:{};try{let n=c.HHr.parse(y);M=S.every(e=>e.volume<=0);let s=n.mutable_config.mutable_materials.map(e=>e.id);if(D=n.materials.stickers.filter(e=>s.includes(e.id)).length,t&&i)I=function(e,t){var i;let{dataSdk:a,subDraftApplySpeedViewManager:n}=t,s=n.getCombinationApplySpeedDraftViewById(e.id);if(!s)return 0;let l=null!==(i=a.cutSame.draftIdToMutableVideos[s.getDraftId()])&&void 0!==i?i:[],d=(0,o.Z)(l,e.materialDraft.draft.getDuration(),n,e);return(null==d?void 0:d.segments.filter((0,r.be)("mutablePoly"))).length}(t,i),P=(0,u.Ph)(t,i),F=(0,u.sW)(t,i);else{I=function(e){let{json:t,mutableVideos:i}=e.preload,r=c.HHr.parse(t);r.tracks.forEach(e=>{if(e.type===c.pNd.TrackTypeVideo)e.segments.forEach(e=>{if(e.__segment_struct_type="SegmentVideo",!!e.extra_material_refs)for(let t of e.extra_material_refs){let i=r.materials.transitions.find(e=>t===e.id);if(i){e.transition=i;break}}})});let n=Array.from(i).sort((e,t)=>{let{target_start:i}=e,{target_start:a}=t;return i-a}),o=0,s=0,l=[],d=0,u=e=>e.length>1&&e.filter(e=>!(null==e?void 0:e.meta_type)||!a.t6.includes(null==e?void 0:e.meta_type)).length>0;for(let e of n){if(l.length){if(e.target_start<d){l.push(e),d=Math.max(d,e.target_start+e.target_duration);continue}o+=u(l)?1:0,s=d,l=[],d=0}e.target_start>s+1&&(s=e.target_start),l.push(e),d=e.target_start+e.target_duration}return u(l)&&o++,o}(e);let t=function(e){let t=[],i=[],a={},r={};return e.materials.videos.forEach(e=>{var t,i,n;let o=(0,c.MnT)(e);(null==o?void 0:o.algorithm)&&(a[o.algorithm]=!0),e.reverse_path&&(r.reverse=!0);let{video_algorithm:s}=e;if((null==s?void 0:null===(t=s.algorithms)||void 0===t?void 0:t.length)>0||(null==s?void 0:null===(i=s.path)||void 0===i?void 0:i.length)>0)for(let t of(s.motion_blur_config&&(r.motion_blur=!0),s.deflicker&&(r.deflicker=!0),s.noise_reduction&&(r.noise_reduction=!0),e.video_algorithm.algorithms))t.type===c.zzh.ComplementFrame&&(r.complement_frame=!0);e.object_locked&&(r.object_locked=!0);let{matting:l}=e;(null==l?void 0:l.path)&&(3===l.flag&&(r.smart_matting=!0),5===l.flag&&(r.custom_matting=!0)),3===e.ai_matting&&(r.smart_matting=!0),(null===(n=e.stable)||void 0===n?void 0:n.stable_level)>0&&(r.stable=!0)}),e.materials.chromas.forEach(e=>{var t;(null===(t=e.color)||void 0===t?void 0:t.length)>0&&(r.chromas=!0)}),t=Object.keys(a),{gameplayList:t,videoAlgorithmList:i=Object.keys(r)}}(n);P=t.gameplayList,F=t.videoAlgorithmList}b=P.length,T=F.length,Array.isArray(v)&&(C=v.map(e=>e.goods_type))}catch{}let x=(0,n.tt)(e.templateType,e.producerAppId),R=null!==(h=null==t?void 0:t.materialDraft.draft.getDraftId())&&void 0!==h?h:"",A=null==E?void 0:E.cutSame,O={template_multiple_slots_cnt:I,template_can_replace_slots_cnt:null!==(p=null==A?void 0:null===(s=A.draftIdToMutableVideos[R])||void 0===s?void 0:s.length)&&void 0!==p?p:S.length,template_can_update_music_cnt:m?null!==(_=null==A?void 0:null===(l=A.draftIdToMutableAudios[R])||void 0===l?void 0:l.length)&&void 0!==_?_:k.length:0,template_material_is_mute:M?"1":"0",template_can_edit_text_cnt:null!==(g=null==A?void 0:null===(d=A.draftIdToMutableTexts[R])||void 0===d?void 0:d.length)&&void 0!==g?g:w.length,template_can_edit_sticker_cnt:D,template_pay_type:C.join(","),video_type_id:x,template_id:e.id,template_gameplay_cnt:b,template_algorithm_cnt:T};return b&&(O.template_gameplay_list=P.join(",")),T&&(O.template_algorithm_list=F.join(",")),O}function p(e,t){if(!e.length)return;let{dataSdk:i,draftTemplateManager:a}=t,{cutSame:r}=i;return e.reduce((e,i,r,n)=>{var o,s;let{templateId:l}=i,{template_multiple_slots_cnt:d,template_can_replace_slots_cnt:c,template_can_update_music_cnt:u,template_material_is_mute:p,template_can_edit_text_cnt:_,template_can_edit_sticker_cnt:g,template_pay_type:f,video_type_id:m,template_gameplay_cnt:v,template_gameplay_list:y,template_algorithm_cnt:S,template_algorithm_list:k,template_id:w}=h(a.getTemplateSync(l),i,t);return e.template_multiple_slots_cnt+=d,e.template_can_replace_slots_cnt+=c,e.template_can_update_music_cnt+=u,"0"===e.template_material_is_mute&&"1"===p&&(e.template_material_is_mute="1"),e.template_can_edit_text_cnt+=_,e.template_can_edit_sticker_cnt+=g,f&&(e.template_pay_type+=`${e.template_pay_type?",":""}${f}`),void 0!==m&&(e.video_type_list+=`${e.video_type_list?",":""}${m}`,1===n.length&&(e.video_type_id=m)),w&&(e.template_id+=`${e.template_id?",":""}${w}`),v&&y&&(e.template_gameplay_cnt+=v,e.template_gameplay_list=`${null!==(o=e.template_gameplay_list)&&void 0!==o?o:""}${e.template_gameplay_list?",":""}${y}`),S&&k&&(e.template_algorithm_cnt+=S,e.template_algorithm_list=`${null!==(s=e.template_algorithm_list)&&void 0!==s?s:""}${e.template_algorithm_list?",":""}${k}`),e},{template_multiple_slots_cnt:0,template_can_replace_slots_cnt:0,template_can_update_music_cnt:0,template_material_is_mute:"0",template_can_edit_text_cnt:0,template_can_edit_sticker_cnt:0,template_pay_type:"",video_type_list:"",template_id:"",template_algorithm_cnt:0,template_gameplay_cnt:0})}function _(e,t,i){if(!t){if(!i)throw TypeError("service need");return i.invokeFunction(t=>t.get(e))}return t}function g(e){let{containerService:t,mainDraftService:i,mainEditorWidgetService:a,videoEnvironmentService:r}=e,n=_(s.n,i,t),o=_(l.a,a,t),u=_(d.rO,r,t);if((0,d.JY)(u)){let e=n.draftTemplateManager.getTemplateId();return h(n.draftTemplateManager.getTemplateSync(e))}{let e=o.segmentSelection.subDraftSegment,t=o.selection.getSelectedSegments().filter(c.duj);return e&&t.push(e),p(t,n)}}function f(e){let{containerService:t,mainDraftService:i,videoEnvironmentService:a,mainEditorWidgetService:r}=e,n=_(s.n,i,t),o=_(d.rO,a,t),c=_(l.a,r,t);if((0,d.JY)(o)){let e=n.draftTemplateManager.getTemplateId();return h(n.draftTemplateManager.getTemplateSync(e))}let{subDraftSegments:u}=c.segmentSelection;return p(u,n)}function m(e,t){let{containerService:i,mainDraftService:a,videoEnvironmentService:r}=e,n=_(s.n,a,i),o=_(d.rO,r,i);return(0,d.JY)(o)&&!n.draftTemplateManager.getTemplateId()?{}:t?g(e):f(e)}function v(e){let{mainDraftService:t,mainEditorWidgetService:i}=e.invokeFunction(e=>({mainDraftService:e.get(s.n),mainEditorWidgetService:e.get(l.a)})),{subDraftTemplateId:a}=i.segmentSelection;if(!a)return{};let r=t.draftTemplateManager.getTemplateSync(a);return{templateId:a,videoTypeId:(0,n.tt)(r.templateType,r.producerAppId)}}let y=(e,t)=>{var i;let{subDraftApplySpeedViewManager:a,dataSdk:r}=t,n=a.getCombinationApplySpeedDraftViewById(e.id);return n?(null!==(i=r.cutSame.draftIdToMutableVideos[n.getDraftId()])&&void 0!==i?i:[]).length:0},S=(e,t)=>{var i,a;let{subDraftApplySpeedViewManager:r,dataSdk:n}=t,o=r.getCombinationApplySpeedDraftViewById(e.id);if(!o)return 0;let s=null!==(i=n.cutSame.draftIdToRelationVideoGroup[o.getDraftId()])&&void 0!==i?i:new Map;return Number((null!==(a=n.cutSame.draftIdToMutableVideos[o.getDraftId()])&&void 0!==a?a:[]).filter(e=>{let{relationVideoGroup:t}=e;return!(t&&s.has(t))&&!0}).length)+s.size||0}},763446:function(e,t,i){i.d(t,{R:function(){return n}});var a=i(195471);class r{getEventParams(){return this._params}constructor(e){this._params=e,this.eventName="export_time"}}function n(e,t){(0,a.K)(e,r,[t])}},258150:function(e,t,i){i.d(t,{Hs:function(){return w},Ju:function(){return m},zW:function(){return M}});var a=i(789786),r=i(108692),n=i(425427),o=i(782153),s=i(782350),l=i(960395),d=i(514869),c=i(322613),u=i(356954),h=i(102207),p=i(118830),_=i(918157),g=i(461571);let f="enter_edit_page",m=e=>{let t=(null==e?void 0:e.role)==="owner"||(null==e?void 0:e.workspace_id)==="0"||!(null==e?void 0:e.workspace_id);return{rawSpaceType:t?null==e?void 0:e.raw_space_type:3,spaceType:t?null==e?void 0:e.space_type:3}};class v{_getPermissions(){let e=this._videoPermissionService.isDraftOwner;if(this._videoPermissionService.getDraftPermission()===g.O.readonly){let t=this._mainDraftService.draftWorkspaceManager.workspaceId;return{permissions:e?"can_view_owner":"can_view_non_owner",space_user:(t?this._workspaceService.getWorkspace(t):void 0)?1:0,current_page:"view_edit_page"}}return{permissions:e?"can_edit_owner":"can_edit_non_owner"}}getReportExtraParams(){var e;return null!==(e=this._params.extraReportParams)&&void 0!==e?e:{}}getEventParams(){var e,t,i,a,r,n,o,s,l,u,g,f,v;let{searchParams:y}=new URL(window.location.href),S=this._mainDraftService.draftWorkspaceManager.workspaceId,k=S?this._workspaceService.getWorkspace(S):void 0,w=this._videoEnvironmentService.draftIdFromUrl?this._videoEnvironmentService.draftIdFromUrl:void 0,M=this._mainDraftService.cloudMetaManager.getMeta(),b=M.draft,T=null!==(t=function(){let{searchParams:e}=new URL(window.location.href),t=e.get("scenario");return t&&void 0!==d.Py[t]?t:null}())&&void 0!==t?t:null==b?void 0:b.createScenario,{createTime:I}=M.createSource,D=null!==(i=y.get("scriptDraftId"))&&void 0!==i?i:"",P=(0,p.J)(),F="false"!==localStorage.getItem(h.y)?"on":"off",C=this.getReportExtraParams();return{draft_permissions:this._params.draftSharePermission,space_permissions:this._params.workspaceSharePermission,absorb_status:F,url:location.href,enter_from:(0,_.i)(this._params.isNewDraft),draft_id:this._params.isNewDraft?void 0:w,from_script_draft_id:D,group_id:null!==(a=y.get("workspaceId"))&&void 0!==a?a:"none",position:null!==(n=null!==(r=y.get("__action_from"))&&void 0!==r?r:y.get("__tool_position"))&&void 0!==n?n:P,from_page:(0,p.X)(),article_title:null!==(o=y.get("article_title"))&&void 0!==o?o:void 0,article_type:null!==(s=y.get("article_type"))&&void 0!==s?s:void 0,tool_type:null!==(l=y.get("__tool_type"))&&void 0!==l?l:void 0,space_id:S,space_user_cnt:null==k?void 0:k.member_cnt,space_type:m(k).spaceType,raw_space_type:m(k).rawSpaceType,create_time:I,autocut_type:null!==(u=y.get("autocut_type"))&&void 0!==u?u:void 0,ai_video_id:null!==(g=y.get("ai_video_id"))&&void 0!==g?g:void 0,video_generate_type:null!==(f=y.get("__video_generate_type"))&&void 0!==f?f:void 0,...T?{scenario:T,scale:(0,c.a)(d.Py[T])||"custom"}:null,output_cnt:null!==(v=y.get("output_cnt"))&&void 0!==v?v:void 0,...this._getPermissions(),...JSON.parse((null==M?void 0:null===(e=M.draft)||void 0===e?void 0:e.smartToolsInfo)||"{}"),...this._params.paramsFromUrl||{},...C}}constructor(e,t,i,a,r){this._params=e,this._mainDraftService=t,this._workspaceService=i,this._videoEnvironmentService=a,this._videoPermissionService=r,this.eventName=f,e.draftPermission&&(this.eventName=e.draftPermission===g.O.readonly?"enter_view_edit_page":f)}}v=(0,a.gn)([(0,a.fM)(1,r.n),(0,a.fM)(2,s.W),(0,a.fM)(3,n.rO),(0,a.fM)(4,o.u),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IEnterEditPageParams?Object:IEnterEditPageParams,void 0===r.n?Object:r.n,void 0===s.W?Object:s.W,void 0===n.rO?Object:n.rO,void 0===o.u?Object:o.u])],v);class y extends v{constructor(...e){super(...e),this.eventName="enter_edit_page_server"}}async function S(e){let[t,i,a]=e.invokeFunction(e=>[e.get(l.q),e.get(r.n),e.get(n.rO)]),o=i.dataSdk.draftView.getDraftId()||a.draftIdFromUrl,s=i.draftWorkspaceManager.workspaceId,[d,c]=(await t.getDraftShareInfo({packageKey:o,workspaceId:s})).pair();return d?-1:c.access_type}async function k(e){let[t,i]=e.invokeFunction(e=>[e.get(r.n),e.get(n.rO)]),a=t.dataSdk.draftView.getDraftId()||i.draftIdFromUrl,o=await t.draftWorkspaceManager.getIsApplyAllowed(a);return void 0===o?-1:o?0:1}async function w(e,t){let i=void 0===t.draftSharePermission?S(e):Promise.resolve(t.draftSharePermission),a=void 0===t.workspaceSharePermission?k(e):Promise.resolve(t.workspaceSharePermission),[r,n]=await Promise.all([i,a]);(0,u.K)(e,v,[{...t,draftSharePermission:r,workspaceSharePermission:n}])}async function M(e,t){let i=void 0===t.draftSharePermission?S(e):Promise.resolve(t.draftSharePermission),a=void 0===t.workspaceSharePermission?k(e):Promise.resolve(t.workspaceSharePermission),[r,n]=await Promise.all([i,a]);(0,u.z)(e,y,[{...t,draftSharePermission:r,workspaceSharePermission:n}])}},546651:function(e,t,i){i.d(t,{w:function(){return c}});var a=i(789786),r=i(356954),n=i(108692),o=i(425427),s=i(918157),l=i(118830);class d{getEventParams(){var e,t,i,a,r;let{searchParams:n}=new URL(window.location.href),o=!this._videoEnvironmentService.draftIdFromUrl,d=(0,l.J)(),{createTime:c}=this._mainDraftService.cloudMetaManager.getMeta().createSource;return{create_time:c,enter_from:(0,s.i)(o),position:null!==(t=null!==(e=n.get("__action_from"))&&void 0!==e?e:n.get("__tool_position"))&&void 0!==t?t:d,from_page:(0,l.X)(),article_title:null!==(i=n.get("article_title"))&&void 0!==i?i:void 0,article_type:null!==(a=n.get("article_type"))&&void 0!==a?a:void 0,tool_type:null!==(r=n.get("__tool_type"))&&void 0!==r?r:void 0}}constructor(e,t){this._mainDraftService=e,this._videoEnvironmentService=t,this.eventName="exit_edit_page"}}function c(e){(0,r.K)(e,d,[])}d=(0,a.gn)([(0,a.fM)(0,n.n),(0,a.fM)(1,o.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.n?Object:n.n,void 0===o.rO?Object:o.rO])],d)},467098:function(e,t,i){i.d(t,{m:function(){return n}});var a=i(356954);class r{getEventParams(){return{prompt_source:"input",...this._params}}constructor(e){this._params=e,this.eventName="text_to_video_script_load_status"}}function n(e,t){(0,a.K)(e,r,[t])}},743508:function(e,t,i){i.d(t,{W:function(){return s}});var a=i(789786),r=i(108692),n=i(356954);class o{getEventParams(){return{project_type:"video",player_scale:this._params.scale}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="edit_player_scale"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,r.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===r.n?Object:r.n])],o)},165145:function(e,t,i){i.d(t,{U:function(){return n}});var a=i(31463);let r=async()=>{var e,t,i;let a=await (null===(i=navigator)||void 0===i?void 0:null===(t=i.storage)||void 0===t?void 0:null===(e=t.estimate)||void 0===e?void 0:e.call(t));if(!a||void 0===a.quota||void 0===a.usage)return;let{quota:r,usage:n,usageDetails:o={}}=a;for(let[e,t]of Object.entries(o))o[`p${e.charAt(0).toUpperCase()}${e.slice(1)}`]=t/r;return{pUsed:n/r,quota:r,usage:n,...o}};async function n(e){var t;let i=null!==(t=await r())&&void 0!==t?t:{};e.invokeFunction(e=>{e.get(a.m).reportDevEvent("browser_storage_usage",i)})}},592040:function(e,t,i){i.d(t,{DK:function(){return c},Wn:function(){return h},d:function(){return d}});var a,r,n=i(789786),o=i(356954),s=i(896413),l=i(210823);var d=((a={}).LEFT="left",a.RIGHT="right",a.UP="up",a.DOWN="down",a);var c=((r={})[r.MATERIAL_PANEL=1]="MATERIAL_PANEL",r[r.FUNCTION_PANEL=2]="FUNCTION_PANEL",r[r.TIMELINE_PANEL=3]="TIMELINE_PANEL",r);class u{getEventParams(){return{...this.getPanelScale(),...this._params}}getPanelScale(){let{width:e,height:t}=this._workbenchService.getWorkbenchSize(),i=e*t,a=this._mainEditorWidgetService.layoutManager.getBottomWidth()*this._mainEditorWidgetService.layoutManager.getBottomHeight(),r=this._mainEditorWidgetService.layoutManager.getTopWidth()*this._mainEditorWidgetService.layoutManager.getTopHeight(),n=this._workbenchService.getSiderBarPanelWidth();return{timeline_panel_scale:(a/i).toFixed(2),material_panel_scale:(n/e).toFixed(2),function_panel_scale:"0",player_panel_scale:(r/i).toFixed(2)}}constructor(e,t,i){this._params=e,this._workbenchService=t,this._mainEditorWidgetService=i,this.eventName="zoom_panel"}}function h(e,t){(0,o.K)(e,u,[t])}u=(0,n.gn)([(0,n.fM)(1,l.e),(0,n.fM)(2,s.a),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===l.e?Object:l.e,void 0===s.a?Object:s.a])],u)},911365:function(e,t,i){i.d(t,{C:function(){return s}});var a=i(789786),r=i(108692),n=i(356954);class o{getEventParams(){return{draft_id:this._mainDraftService.dataSdk.draftView.getDraftId(),material_type:this._params.material_type,time:this._params.time,status:this._params.status,reco_time_ms:this._params.reco_time_ms}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="objects_recognized"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,r.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===r.n?Object:r.n])],o)},709444:function(e,t,i){i.d(t,{E:function(){return n}});var a=i(356954);class r{getEventParams(){return{option:this._params.option,switch_type:this._params.switch_type}}constructor(e){this._params=e,this.eventName="absorb_options"}}function n(e,t){(0,a.K)(e,r,[t])}},309227:function(e,t,i){i.d(t,{o:function(){return n}});var a=i(356954);class r{getEventParams(){return{action_type:this._params.action_type}}constructor(e){this._params=e,this.eventName="move_timeline"}}function n(e,t){(0,a.K)(e,r,[t])}},613916:function(e,t,i){i.d(t,{p:function(){return n}});var a=i(356954);class r{getEventParams(){return{action_type:this._params.actionType,zoom_scale:this._params.zoomScale,zoom_type:this._params.zoomType}}constructor(e){this._params=e,this.eventName="zoom_timeline"}}function n(e,t){(0,a.K)(e,r,[t])}},26543:function(e,t,i){i.d(t,{E:function(){return n}});var a=i(356954);class r{getEventParams(){let{fail_reason:e,logid:t}=this._params;return{fail_reason:e,logid:t}}constructor(e){this._params=e,this.eventName="template_publish_material_add"}}function n(e,t){(0,a.K)(e,r,[t])}},885756:function(e,t,i){i.d(t,{j:function(){return s}});var a=i(789786),r=i(356954),n=i(896413);class o{getEventParams(){var e,t,i,a;return{action_method:this._params.method,compositing_type:this._params.compositingType,function_subcategory:this._params.subcategory,function_thirdcategory:this._params.thirdcategory,function_fourthcategory:this._params.fourthcategory,control_detail:this._params.detail,control_type:this._params.type,control_option:this._params.option,file_type:this._params.fileType,function_category:this._params.functionCategory,hsl_color:this._params.hslColor,material_category:this._params.materialCategory,material_id:this._params.materialId,material_type:this._params.materialType,template_id:null!==(t=this._mainEditorWidgetService.segmentSelection.subDraftTemplateId)&&void 0!==t?t:this._params.templateId,rgb_curve:this._params.rgbCurve,track_category:this._params.trackCategory,panel_category:this._params.panelCategory,ai_character_frame:this._params.ai_character_frame,ai_character_tone:this._params.ai_character_tone,is_apply_to_all:this._params.is_apply_to_all,voice_effects:this._params.voiceEffects,edit_type:this._params.editType,ratio_type:this._params.ratio_type,click_action:this._params.click_action,apply_before_params:JSON.stringify(null!==(i=this._params.apply_before_params)&&void 0!==i?i:[]),apply_after_params:JSON.stringify(null!==(a=this._params.apply_after_params)&&void 0!==a?a:[]),apply_change_params:null===(e=this._params.apply_change_params)||void 0===e?void 0:e.join(",")}}constructor(e,t){this._params=e,this._mainEditorWidgetService=t,this.eventName="click_video_function_edit_control"}}function s(e,t){(0,r.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,n.a),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===n.a?Object:n.a])],o)},243366:function(e,t,i){i.d(t,{x:function(){return s}});var a=i(789786),r=i(356954),n=i(108692);class o{getEventParams(){return{material_category:this._params.materialCategory,material_format:this._params.materialFormat,material_duration:this._params.materialDuration,material_resolution:this._params.materialResolution,material_size:this._params.materialSize,material_name:this._params.materialName,duration:this._params.duration,status:this._params.status,error_code:this._params.errorCode,function_name:this._params.functionName}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="function_status"}}function s(e,t){(0,r.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===n.n?Object:n.n])],o)},442692:function(e,t,i){i.d(t,{E:function(){return n}});var a=i(356954);class r{getEventParams(){let e={material_category:this._params.material_category,track_category:this._params.track_category};return void 0!==this._params.material_forthcategory&&(e.material_forthcategory=this._params.material_forthcategory),void 0!==this._params.material_forthcategory_id&&(e.material_forthcategory_id=this._params.material_forthcategory_id),void 0!==this._params.material_id&&(e.material_id=this._params.material_id),void 0!==this._params.material_name&&(e.material_name=this._params.material_name),e}constructor(e){this._params=e,this.eventName="material_track_double_click"}}function n(e,t){(0,a.K)(e,r,[t])}},250362:function(e,t,i){i.d(t,{O:function(){return s}});var a=i(356954);let r=e=>JSON.parse(null!=e?e:"[]").map(e=>Object.values(e).map(e=>e.trim())).flat().filter(Boolean).join(",");class n{getEventParams(){return{tool_type:this.tool_type,status:this.status,fail_reason:this.fail_reason,style:this.style,resolution:this.resolution,original_resolution:this.original_resolution,intelligent_request_id:this.intelligent_request_id,duration:this.duration,model_cnt:this.model_cnt,model_id:this.model_id,material_id:this.material_id,is_placeholder:this.is_placeholder,current_page:this.current_page,prompt:this.prompt,filling_request_id:this.filling_request_id,canva_scale:this.canva_scale,aspect_ratio:"all"===this.aspect_ratio||null===this.aspect_ratio?this.aspect_ratio:this._formatRatio(this.aspect_ratio,"other"),resp_text:this.resp_text,resp_tag:this.resp_tag,text_generate_id:this.text_generate_id,background_id:this.background_id,preprocess_type:this.preprocess_type,normal_cnt:this.normal_cnt,cutout_cnt:this.cutout_cnt,time:this.time,ai_character_id:this.ai_character_id,ai_character_tone:this.ai_character_tone,ai_character_frame:this.ai_character_frame,ai_character_enter_position:this.ai_character_enter_position,input_type:this.input_type,server_response_status_code:this.server_response_status_code,log_id:this.log_id}}_formatRatio(e,t){var i,a;if(!e)return;let[r,n]=e.split(",");return null!==(a=null!==(i=({[String(1)]:"1:1",[String(9/16)]:"9:16",[String(16/9)]:"16:9",[String(3)]:"3:1",[String(4)]:"4:1",[String(2)]:"2:1",[String(.8)]:"4:5",[String(4/3)]:"4:3"})[String(Number(r)/Number(n))])&&void 0!==i?i:t)&&void 0!==a?a:`${r}:${n}`}constructor(e){var t,i,a,n,o,s,l,d,c;this.eventName="smart_tool_generate_status",Object.assign(this,e),this.tool_type=e.tool_type,this.status=e.status,this.fail_reason=e.fail_reason,this.style=e.style,this.resolution=e.resolution,this.original_resolution=e.original_resolution,this.duration=null!==(t=e.duration)&&void 0!==t?t:0,this.current_page=e.current_page,this.model_cnt=null!==(i=e.model_cnt)&&void 0!==i?i:0,this.model_id=null!==(a=e.model_id)&&void 0!==a?a:"",this.material_id=null!==(n=e.material_id)&&void 0!==n?n:"",this.intelligent_request_id=null!==(o=e.intelligent_request_id)&&void 0!==o?o:"",this.background_id=null!==(s=e.background_id)&&void 0!==s?s:"",this.preprocess_type=null!==(l=e.preprocess_type)&&void 0!==l?l:"none",this.normal_cnt=null!==(d=e.normal_cnt)&&void 0!==d?d:0,this.cutout_cnt=null!==(c=e.cutout_cnt)&&void 0!==c?c:0,this.time=e.time,this.ai_character_id=e.ai_character_id,this.ai_character_frame=e.ai_character_frame,this.ai_character_tone=e.ai_character_tone,this.ai_character_enter_position=e.ai_character_enter_position,this.server_response_status_code=e.server_response_status_code,this.log_id=e.log_id;try{this.resp_text=r(e.resp_text),this.resp_tag=r(e.resp_tag)}catch(e){}}}class o extends n{getEventParams(){return super.getEventParams()}}function s(e,t){(0,a.K)(e,o,[t])}},154711:function(e,t,i){i.d(t,{c:function(){return l}});var a=i(896413),r=i(108692),n=i(356954),o=i(374497);class s{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="template_text_option"}}function l(e,t){let i=e.invokeFunction(e=>e.get(a.a)),l=e.invokeFunction(e=>e.get(r.n)),{subDraftTemplateId:d}=i.segmentSelection,c=null!=d?d:l.draftTemplateManager.getTemplateId();if(!c)return;let u=l.draftTemplateManager.getTemplateSync(c),h=(0,o.fl)(u);(0,n.K)(e,s,[{...h,action:t.action,panel:t.panel,template_id:c}])}},260660:function(e,t,i){i.d(t,{J:function(){return l}});var a=i(410138),r=i(827604),n=i(285266),o=i(254336),s=i(173888);function l(e,t,i){let l,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{isReportImmediately:!0},c=Date.now();d.isReportImmediately&&(0,n.G)(e,t.getModel(),{...i}),t.onUploadStart(()=>{c=Date.now(),(0,n.G)(e,t.getModel(),{...i})}),t.onDidUpload(()=>{(0,a.o)(e,t.getModel(),{...i,status:o.CF.SUCCESS,import_time:Date.now()-c})}),t.onUploadFailure(r=>{(0,a.o)(e,t.getModel(),{...i,status:o.CF.FAIL,error_code:null==r?void 0:r.code,fail_reason:null==r?void 0:r.msg,import_time:Date.now()-c})}),t.onDidCancelUpload(()=>{(0,a.o)(e,t.getModel(),{...i,status:o.CF.CANCEL,import_time:Date.now()-c})}),t.onTranscoding(()=>{l=Date.now()}),t.onDidTranscode(()=>{(0,r.x)(e,t.getModel(),{...i,status:o.CF.SUCCESS,transcode_time:Date.now()-l})}),t.onTranscodeFailure(()=>{(0,r.x)(e,t.getModel(),{...i,status:o.CF.FAIL,transcode_time:Date.now()-l})}),t.onDidDelete(()=>{t.getModel().status===s.a.Transcoding&&(0,r.x)(e,t.getModel(),{...i,status:o.CF.CANCEL,transcode_time:Date.now()-l})})}},74457:function(e,t,i){i.d(t,{R:function(){return u}});var a=i(789786),r=i(31463),n=i(356954),o=i(108692),s=i(639097),l=i(426336),d=i(800788);class c{_getPreviewFrameRateParams(){let{is_beauty:e,facial_beauty_detail:t,makeup_detail:i,body_detail:a,beauty_detail:r,is_face_prop:n,face_prop_detail:o}=(0,s.l)(this._mainDraftService.dataSdk);return{is_face_prop:n,face_prop_detail:o,is_beauty:e,figures_facial_beauty_detail:null!=t?t:"",figures_makeup_detail:null!=i?i:"",figures_body_detail:null!=a?a:"",figures_beauty_detail:null!=r?r:""}}_getExtraParams(){var e,t;return null!==(t=null===(e=({vesdk_event_editor_preview_frame_rate:this._getPreviewFrameRateParams})[this._params.eventName])||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}getEventParams(){let e={},t=this._getExtraParams();try{e=l.HHr.parse(this._params.msg)}catch(e){this._reportService.reportDevError("ve_report",e,{level:"error",reason:"ve_report_json_parse",describe:"ve report parse failed",str:this._params.msg}),(0,d.Y2)(e,"ve_report_json_parse")}return{...e,params_for_special:"vesdk_web",...t}}constructor(e,t,i){this._params=e,this._mainDraftService=t,this._reportService=i,this.eventName="",this.eventName=e.eventName}}function u(e,t){(0,n.K)(e,c,[t])}c=(0,a.gn)([(0,a.fM)(1,o.n),(0,a.fM)(2,r.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVEEventParams?Object:IVEEventParams,void 0===o.n?Object:o.n,void 0===r.m?Object:r.m])],c)},153334:function(e,t,i){i.d(t,{v:function(){return c}});var a=i(789786),r=i(31463),n=i(356954),o=i(108692),s=i(426336),l=i(892230);class d{_getPreviewFrameRateParams(){let{min_fps_avg_algorithm_cost_time:e,min_fps_progress:t,min_fps:i}=this._params;return{min_fps:i,min_fps_progress:t,min_fps_avg_algorithm_cost_time:e,min_fps_cpu_core_count:navigator.hardwareConcurrency,...function(e,t){let i=0,a=0,r=0,n=0,o=0,d=0,c=0,u=0;for(let p of e.draftView.getAllTracks()){var h;if(!!(null===(h=p.segments)||void 0===h?void 0:h.length))for(let e of p.segments){let{start:h,duration:_}=e.targetTimerange,g=s.pMA.div(h,1e3),f=s.pMA.div(_,1e3);if(!!(0,l.vX)(t,[g,g+f]))!(0,s.MDU)(p)&&(0,s.hey)(e)&&i++,(0,s.Ftn)(e)&&a++,(0,s.P2T)(e)&&n++,(0,s.hey)(e)&&o++,(0,s.Y9Q)(e)&&d++,(0,s.SiN)(e)&&c++,(0,s.w5o)(e)&&u++,(0,s.hey)(e)&&e.figures.length>0&&e.figures.some(e=>!(0,s.WPz)(e))&&r++}}return{min_fps_text_count:a,min_fps_pip_count:i,min_fps_use_beauty_track_num:r,min_fps_sticker_count:n,min_fps_video_count:o,min_fps_audio_count:d,min_fps_filter_count:c,min_fps_effect_count:u}}(this._mainDraftService.dataSdk,t)}}getEventParams(){return this._getPreviewFrameRateParams()}constructor(e,t,i){this._params=e,this._mainDraftService=t,this._reportService=i,this.eventName="ve_low_frame_rate"}}function c(e,t){(0,n.K)(e,d,[t])}d=(0,a.gn)([(0,a.fM)(1,o.n),(0,a.fM)(2,r.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVELowFrameRateEventParams?Object:IVELowFrameRateEventParams,void 0===o.n?Object:o.n,void 0===r.m?Object:r.m])],d)},930997:function(e,t,i){i.d(t,{c:function(){return o}});var a=i(356954),r=i(838587);class n{getEventParams(){return{totalUsage:this._params.bytes,...(0,r.GF)(this._params.breakdown)}}constructor(e){this._params=e,this.eventName="memory_measure_report"}}function o(e,t){(0,a.K)(e,n,[t])}},197517:function(e,t,i){i.d(t,{p:function(){return n}});var a=i(356954);class r{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="perf_graphic_cover_open"}}function n(e,t){(0,a.K)(e,r,[t])}},570444:function(e,t,i){i.d(t,{y:function(){return f}});var a=i(789786),r=i(425427),n=i(108692),o=i(861810),s=i(690613),l=i(28791),d=i(31463),c=i(230689),u=i(805794),h=i(356954),p=i(475231);class _{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="video_editor_data_layer_error"}}class g{_createLogger(e){return this._loggerService.createLogger(this._logId,{contextParams:e})}_handleDataLayerError(e,t,i,a){if(t&&["apply_action_error","apply_mutation_error"].includes(t)){var r,n,o;n=this._containerService,o={label:e,describe:t,errmsg:i,stack:null!==(r=null==a?void 0:a.stack)&&void 0!==r?r:""},(0,h.K)(n,_,[o])}}register(e,t){var i=this;let a=this._createLogger({type:"data_layer"});return e.register({tempReport:t,loggerProvider:{log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info(`LoggerCount: ${++i._dataLayerLoggerCount}`,...t)},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info(`LoggerCount: ${++i._dataLayerLoggerCount}`,...t)},warn:(e,t,i,a)=>{let r;r=a instanceof Error||(0,s.oi)(a)?a:Error(String(t));let n=`LoggerCount: ${++this._dataLayerLoggerCount}, ${i}`;this._reportService.reportDevError(String(e),r,{level:"warn",describe:String(t),reason:n})},error:(e,t,i,a,r)=>{let n=`LoggerCount: ${++this._dataLayerLoggerCount}, ${a}`;this._reportService.reportDevError(e,null!=r?r:Error(t),{level:"error",describe:String(t),reason:n}),this._handleDataLayerError(e,null!=t?t:"",null!=i?i:"",r)}},prefix:"data_layer",context:{ccLog:{host:u.i.CC,appId:348188,region:"va"}}}),e}constructor(e,t,i,a,r){this._loggerService=e,this._reportService=t,this._videoEnvironmentService=i,this._mainDraftService=a,this._containerService=r,this._logId="data_layer",this._dataLayerLoggerCount=0}}function f(e){return e.createInstance(new o.M(g,[])).register(u.B,p.i)}g=(0,a.gn)([(0,a.fM)(0,l.yR),(0,a.fM)(1,d.m),(0,a.fM)(2,r.rO),(0,a.fM)(3,n.n),(0,a.fM)(4,c.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===l.yR?Object:l.yR,void 0===d.m?Object:d.m,void 0===r.rO?Object:r.rO,void 0===n.n?Object:n.n,void 0===c.t?Object:c.t])],g)},820306:function(e,t,i){i.d(t,{n:function(){return s}});var a=i(789786),r=i(356954),n=i(108692);class o{getEventParams(){let{action:e,saveStatus:t,waitTime:i,packageId:a,failReason:r=""}=this._params;return{action:e,save_status:t,wait_time:i,fail_reason:r,package_id:a,quick_import_segments_length:this._mainDraftService.dataSdk.draftView.getQuickImportSegments().map(e=>e.id).join(",").length}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="draft_save_time"}}function s(e,t){let i=Date.now();return{onSaveDraftSuccess:a=>{(0,r.K)(e,o,[{action:t,saveStatus:"success",packageId:a,waitTime:Date.now()-i}])},onSaveDraftFail:a=>{(0,r.K)(e,o,[{action:t,saveStatus:"failed",waitTime:Date.now()-i,failReason:a}])}}}o=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDraftSaveTimeParams?Object:IDraftSaveTimeParams,void 0===n.n?Object:n.n])],o)},676021:function(e,t,i){i.d(t,{v:function(){return n}});var a=i(356954);class r{getEventParams(){return{blob_url:this._params.blobUrl,id:this._params.id}}constructor(e){this._params=e,this.eventName="quick_import_add_blob"}}function n(e,t){(0,a.K)(e,r,[t])}},219159:function(e,t,i){i.d(t,{$:function(){return s}});var a=i(789786),r=i(356954),n=i(108692);class o{getEventParams(){let{action:e,unavailableDuration:t,isNeedQuickImportSegmentsLength:i,extra:a}=this._params,r={action:e,unavailable_duration:t,extra:a};return i&&(r.quick_import_segments_length=this._mainDraftService.dataSdk.draftView.getQuickImportSegments().length),r}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="quick_import_dev"}}function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,r.K)(e,o,[t],{immediately:i})}o=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IQuickImportDev?Object:IQuickImportDev,void 0===n.n?Object:n.n])],o)},190825:function(e,t,i){i.d(t,{y:function(){return n}});var a=i(697959),r=i(426336);let n=async(e,t,i,n)=>{let o=(0,a.o)(e,t,n),s=[];for(let t of o){let a=new r.BzH;a.iParam1=i,a.iOpCode=r.wIK.CT_EDIT_CONVERT_CASE;let[,n]=await (0,r.mL_)(t.id,a),o=new r.xKN;o.material=new r.edz,o.material.baseContent=n,o.material.content=n,o.material.richTextCommand=a,o.material.text=r.hMI.getOriginContentFromContent(n);let l=(0,r.xXD)({__segment_struct_type:t.__segment_struct_type});r.T8X.pick(t,o,l),s.push({trackId:e.getTrackBySegmentId(t.id).id,trackIndex:e.getTrackIndexBySegmentId(t.id),segmentId:t.id,segmentDelta:o,sourceSegmentDelta:l})}return s}},184912:function(e,t,i){i.d(t,{V:function(){return u}});var a=i(789786),r=i(744268),n=i(596112),o=i(127830),s=i(800788),l=i(520980),d=i(425427),c=i(637836);class u extends r.aU{set useInCN(e){this._useInCN=e,this._updateResourcePanel(e)}get useInCN(){return this._useInCN}get isSupportMultiWorkSpace(){return this._isSupportMultiWorkSpace}get disableUserBrand(){return this._disableUserBrand}set disableUserBrand(e){this._disableUserBrand=e}_updateResourcePanel(e){this.resourcePanel=e?(0,s.ss)("video not support cn"):l.n}constructor(e,t,i){super(),this._options=e,this._videoEnvironmentService=t,this._teaAdapterService=i,this.disableRequestCache=!1,this.disableSidebarResourcePreload=!1,this.sideMenuShowBrandTypes=[o._g.Video,o._g.Photo,o._g.TextPreset,o._g.TextTemplate,o._g.AdjustmentPreset,o._g.Sticker,o._g.Audio],this._useInCN=e.useInCN,this._disableUserBrand=e.disableUserBrand,this._isSupportMultiWorkSpace=e.isSupportMultiWorkSpace,this.editorCategory=e.editorCategory,this._updateResourcePanel(e.useInCN),this.abTestManager=new c.Z(this._teaAdapterService,this._videoEnvironmentService),e.appConfiguration&&this.initAppConfiguration(e.appConfiguration)}}u=(0,a.gn)([(0,a.fM)(1,d.rO),(0,a.fM)(2,n.w),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof VideoConfigurationServiceProps?Object:VideoConfigurationServiceProps,void 0===d.rO?Object:d.rO,void 0===n.w?Object:n.w])],u)},294411:function(e,t,i){i.d(t,{m:()=>V});var a=i("789786"),r=i("920704"),n=i("73478"),o=i("230689"),s=i("745860"),l=i("396190"),d=i("537745"),c=i("966697"),u=i("596112"),h=i("866006"),p=i("108692"),_=i("260963"),g=i("292406"),f=i("928623"),m=i("373722"),v=i("578907"),y=i("725552"),S=i("426336"),k=i("690613"),w=i("154881"),M=i("988385"),b=i("948328"),T=i("775352"),I=i("597623"),D=i("817488"),P=i("196769"),F=i("818398"),C=i.n(F),E=i("257118"),x=i("648973"),R=i("484829"),A=i("801497"),O=i("943478"),U=i("210823"),L=i("452210"),W=i("896413"),j=i("763832"),N=i("800788");class B{insertAsyncTasks(e){let{taskId:t}=e,i=this._mainDraftService.dataSdk.api.attachment.insertAsyncTasks({asyncTaskEntities:[new S.I8_({localTaskId:t,serverTaskId:t,draftId:this._mainDraftService.dataSdk.draftView.getDraftId(),status:S.fvo.initial})]});return i.ok&&this._asyncTaskStatusMap.set(t,S.fvo.initial),i}updateAsyncTasksStatus(e){let{localTaskIds:t,status:i}=e,a=[S.fvo.expired,S.fvo.failed,S.fvo.canceled,S.fvo.create_failed,S.fvo.applied];for(let e of t){let t=this._asyncTaskStatusMap.get(e);if(!(void 0!==t&&a.includes(t)))this._mainDraftService.dataSdk.api.attachment.updateAsyncTasksStatus({localTaskIds:[e],status:i}),this._asyncTaskStatusMap.set(e,i)}}constructor(e){this._mainDraftService=e,this._asyncTaskStatusMap=new Map}}B=(0,a.gn)([(0,a.fM)(0,p.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===p.n?Object:p.n])],B);class V{get shouldShowDigitalHuman(){return"en"===A.ZP.language}handleDigitalHumanDelete(e){e.forEach(e=>{var t,i,a;(null!==(a=this._taskMap.get(null!==(i=null===(t=e.digitalHuman)||void 0===t?void 0:t.localTaskId)&&void 0!==i?i:""))&&void 0!==a?a:[]).forEach(e=>{e&&(null==e?void 0:e.status)!==R.dU.Applied&&(this._deleteTaskMap.set(e.taskId,e),this._taskMap.delete(e.taskId))})}),e.length&&this.updateTaskList()}handleResumeDigitalHuman(e){e.forEach(e=>{var t,i;let a=this._deleteTaskMap.get(null!==(i=null===(t=e.digitalHuman)||void 0===t?void 0:t.localTaskId)&&void 0!==i?i:"");a&&(this.resumeDigitalHumanTask(a.taskId,e.id,{callbacks:a.callbacks,progress:a.progress}),this._deleteTaskMap.delete(a.taskId))}),e.length&&this.updateTaskList()}isSegmentLoading(e){return Array.from(this._taskMap.values()).some(t=>t.some(t=>t.targetSegmentId===e&&(t.status===r.y.Process||t.status===r.y.Success)))}discardTask(e){this._taskMap.delete(e),this._digitalHumanAttachmentHelper.updateAsyncTasksStatus({localTaskIds:[e],status:S.fvo.canceled})}showRemoveBgToast(e){this.removeBgTaskList=(0,g.Z)(Array.from(this._taskMap.values())).filter(e=>e.status!==R.dU.Applied&&e.status!==r.y.Failure&&e.taskType===R.V5.RemoveBackground).map(e=>(0,f.Z)(e,["taskId","progress"])),0===this.removeBgTaskList.length&&this._removeBackgroundMessageManager.update([{taskId:"0",progress:e}])}updateTaskList(){if(this.taskList=(0,g.Z)(Array.from(this._taskMap.values())).filter(e=>e.status!==R.dU.Applied&&e.status!==r.y.Failure&&e.taskType===R.V5.Generate).map(e=>(0,f.Z)(e,["taskId","progress"])),this._messageManager.update(this.taskList),0===this.taskList.length){let e=(0,g.Z)(Array.from(this._taskMap.values())).filter(e=>e.status===R.dU.Applied&&!e.taskToasted&&e.taskType===R.V5.Generate);e.forEach(e=>{let t=this._taskMap.get(e.taskId);null==t||t.forEach(e=>{e&&(e.taskToasted=!0)})}),e.length&&this._messageManager.updateSuccess(e.length)}if(this.removeBgTaskList=(0,g.Z)(Array.from(this._taskMap.values())).filter(e=>e.status!==R.dU.Applied&&e.status!==r.y.Failure&&e.taskType===R.V5.RemoveBackground).map(e=>(0,f.Z)(e,["taskId","progress"])),this._removeBackgroundMessageManager.update(this.removeBgTaskList),0===this.removeBgTaskList.length){let e=(0,g.Z)(Array.from(this._taskMap.values())).filter(e=>e.status===R.dU.Applied&&!e.taskToasted&&e.taskType===R.V5.RemoveBackground);e.forEach(e=>{let t=this._taskMap.get(e.taskId);null==t||t.forEach(e=>{e&&(e.taskToasted=!0)})}),e.length&&this._removeBackgroundMessageManager.updateSuccess(e.length)}}async downloadDefaultImage(e,t){return new File([await fetch(e,{mode:"cors"}).then(e=>e.blob())],`${t.replaceAll(" ","")}.png`,{type:"image/png"})}async downloadDefaultVideo(e,t){return new File([await fetch(e,{mode:"cors"}).then(e=>e.blob())],`${t.replaceAll(" ","")}.mp4`,{type:"video/mp4"})}async uploadDefaultImage(e,t){var i;let a=await this.downloadDefaultImage(e,t),[r,n]=(await (0,M.E)({files:[a],fromWorkspaceId:null!==(i=this._mainDraftService.draftWorkspaceManager.workspaceId)&&void 0!==i?i:"",uploadParams:{uploadFlag:T.m5.Invisible},containerService:this._containerService,payinPayoutHelper:this._payinPayoutHelper,autoUpload:!0,addToUserGenerated:!1}))[0].pair();if(r)throw Error("upload fail");return this._draftMaterialsService.addToAutoGenerated(n),await new Promise((e,t)=>{null==n||n.onResourceReady(()=>e("")),null==n||n.onUploadFailure(()=>t(Error("upload fail")))}),n}async warmupService(){await i.e("7698").then(i.bind(i,997659))}async generateUploadZip(e){var t;let{BlobWriter:a,ZipWriter:r,TextReader:n,BlobReader:o}=await i.e("7698").then(i.bind(i,997659)),s=new a,l=new r(s),d={};for(let t=0;t<e.length;t++){let i=e[t],a=new o(i.buffer),r=`${t}_${i.name}`;await l.add(r,a),d[r]={offset:i.offset,phonemes:i.phonemes}}let c=new n(C().stringify(d));await l.add("meta.json",c),await l.close();let u=new File([await s.getData()],"digital-human-meta.zip",{type:"application/zip"}),h=await (null===(t=this._uploader)||void 0===t?void 0:t.upload({file:u}));if(2e3===h.UriStatus)return{uri:h.Uri,segmentId:e[0].segmentId};throw Error("upload fail")}bindTaskEvent(e,t,i){var a,n;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.V5.Generate,s=null!==(n=null===(a=e.taskParams)||void 0===a?void 0:a.taskId)&&void 0!==n?n:"",l={status:r.y.Process,taskId:s,progress:0,callbacks:[],cancel:e.cancel,segmentId:t,originalParams:i,taskType:o};!this._taskMap.has(s)&&this._taskMap.set(s,[]),this._taskMap.get(s).push(l),e.onProgress(e=>{l&&(l.progress=.9*e.progress,l.status=e.status,l.callbacks.forEach(e=>{e({...(0,m.Z)(l,"callbacks")})}),!this._taskProcessingUpdateMap.get(s)&&(this._digitalHumanAttachmentHelper.updateAsyncTasksStatus({localTaskIds:this._findLocalTaskIds(s),status:S.fvo.processing}),this._taskProcessingUpdateMap.set(s,!0)),this.updateTaskList(),l.targetSegmentId&&this._mainEditorWidgetService.timelineManager.segmentManager.setTimelineSegmentLoading(l.targetSegmentId,!0,E.$x,l.taskType===R.V5.Generate?`${A.ZP.t("web_edit_text_applying",{},"Applying...")}${l.progress}%`:A.ZP.t("remove_bg_remove_inprogress_toast",{percentage:l.progress},"Removing background...{percentage}%")),this._refreshUI())});let d=()=>{l&&(l.progress=100,l.status=r.y.Failure,l.callbacks.forEach(e=>{e({...(0,m.Z)(l,"callbacks")})}),this._digitalHumanAttachmentHelper.updateAsyncTasksStatus({localTaskIds:this._findLocalTaskIds(s),status:S.fvo.failed}),this.updateTaskList(),l.targetSegmentId&&this._mainEditorWidgetService.timelineManager.segmentManager.setTimelineSegmentLoading(l.targetSegmentId,!1,E.$x),this._refreshUI())};return e.onError(e=>{var t,i;l.failReason=e.msg;let{status:a,logId:r}=null!==(t=e.errorInfo)&&void 0!==t?t:{};l.serverResponseStatusCode=a,l.logId=r,d(),204402===e.code&&this._mainDraftService.dataSdk.api.segment.delete({segIds:[null!==(i=null==l?void 0:l.targetSegmentId)&&void 0!==i?i:""]})}),e.onCancel(d),e.onSuccess(e=>{l&&(l.progress=90,l.status=r.y.Success,l.data=e,l.callbacks.forEach(e=>{e({...(0,m.Z)(l,"callbacks")})}),this._digitalHumanAttachmentHelper.updateAsyncTasksStatus({localTaskIds:this._findLocalTaskIds(s),status:S.fvo.succeed}),this.updateTaskList(),l.targetSegmentId&&this._mainEditorWidgetService.timelineManager.segmentManager.setTimelineSegmentLoading(l.targetSegmentId,!0,E.$x,l.taskType===R.V5.Generate?`${A.ZP.t("web_edit_text_applying",{},"Applying...")}${l.progress}%`:A.ZP.t("remove_bg_remove_inprogress_toast",{percentage:l.progress},"Removing background...{percentage}%")),this._refreshUI())}),this.updateTaskList(),l}handleHumanTaskApplied(e,t){var i;let a=(null!==(i=this._taskMap.get(e))&&void 0!==i?i:[]).find(e=>e.segmentId===t);a&&(a.progress=100,a.status=R.dU.Applied,a.callbacks.forEach(e=>{e({...(0,m.Z)(a,"callbacks")})}),this._digitalHumanAttachmentHelper.updateAsyncTasksStatus({localTaskIds:this._findLocalTaskIds(e),status:S.fvo.applied}),this.updateTaskList(),a.targetSegmentId&&this._mainEditorWidgetService.timelineManager.segmentManager.setTimelineSegmentLoading(a.targetSegmentId,!1,E.$x),this._refreshUI())}_findLocalTaskIds(e){let t=this._mainDraftService.dataSdk.draftView.getAsyncTaskMap(),i=[];for(let[a,r]of t.entries())(null==r?void 0:r.serverTaskId)===e&&i.push(a);return i}_refreshUI(){setTimeout(()=>{this._workbenchService.refreshRender(O.Mp.ToolBar),this._workbenchService.refreshRender(O.Mp.EditorContainer),this._mainEditorWidgetService.timelineManager.refreshContributionUI(L.Y.TIMELINE_TOOL),this._mainEditorWidgetService.timelineManager.refreshContributionUI(L.Y.TIMELINE_CONTENT),this._mainEditorWidgetService.timelineManager.refreshContributionUI(L.Y.TIMELINE_CONTEXTMENU)})}async _generateDigitalHumanTask(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=await this._intelligentDataService.createIntelligentTask({assetId:e.tts_resource_id,workspaceId:null!==(t=this._mainDraftService.draftWorkspaceManager.workspaceId)&&void 0!==t?t:"",smartToolType:D.v.DigitalHuman,params:C().stringify(e),platform:r.hn.ImageX,reqJson:"",scene:0,pollingInterval:1e3,urlParams:{babi_param:JSON.stringify({scenario:"video_editor",feature_key:"ai_character",feature_entrance:(0,n.b1)(),feature_entrance_detail:`${(0,n.b1)()}-elements-aicharacter`})}});return a.ok||0===i?a:(await (0,j._)((0,v.Z)(1e3,2e3,!1)),await this._generateDigitalHumanTask(e,i-1))}async createDigitalHumanTask(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.V5.Generate,i=await this._generateDigitalHumanTask(e);if(i.ok){var a,r;let n=null!==(r=null===(a=i.value.taskParams)||void 0===a?void 0:a.taskId)&&void 0!==r?r:"";return this._digitalHumanAttachmentHelper.insertAsyncTasks({taskId:n}),this.bindTaskEvent(i.value,e.segmentId,e,t)}throw Error("")}getDigitalHumanTask(e,t){let i=this._taskMap.get(e);return null==i?void 0:i.find(e=>e.segmentId===t)}resumeDigitalHumanTask(e,t,i){if(!this._smartQueryTaskMap.has(e)){var a;let t=this._intelligentDataService.createIntelligentTaskQueryTask({taskId:e,assetId:"",workspaceId:null!==(a=this._mainDraftService.draftWorkspaceManager.workspaceId)&&void 0!==a?a:"",smartToolType:D.v.DigitalHuman,params:"",platform:r.hn.ImageX,reqJson:"",scene:0,region:"",hasLogin:this._accountService.hasLogin,pollingInterval:1e3});this._smartQueryTaskMap.set(e,t)}let n=this._smartQueryTaskMap.get(e),o=this.bindTaskEvent(n,t);return o.targetSegmentId=t,i&&Object.assign(o,{...i}),(0,m.Z)(o,"callbacks")}restoreDigitalHumanQueryTask(e){let t=this._mainDraftService.dataSdk.draftView.getSegmentById(e);if(!t||!(0,S.NHR)(t))throw Error("No digitalHuman Segment");let{localTaskId:i}=t.digitalHuman,a=this._mainDraftService.dataSdk.draftView.getAsyncTask(i);if((null==a?void 0:a.status)===S.fvo.applied)throw Error("Digital human end");let r=(null==a?void 0:a.serverTaskId)||i;if(!r)throw Error("No digitalHuman task");return this.resumeDigitalHumanTask(r,e)}addTaskListenner(e,t,i){let a=this._taskMap.get(e),r=null==a?void 0:a.find(e=>e.segmentId===t);r&&(r.callbacks.push(i),i((0,m.Z)(r,"callbacks")))}async getDigitalHumanList(e){let t=await this._getCategories();if(!t.ok)return t;let i=t.value[t.value.length-1];return(0,N.ZB)(i),(0,h.ky)(e)?e.config.category=i.id:e.category=i.id,this._digitalHumanDataService.getDigitalHumanList(e)}constructor(e,t,i,a,r,n,o,s,l,d,c){this._containerService=e,this._intelligentDataService=t,this._accountService=i,this._teaAdapterService=a,this._workbenchService=r,this._environmentService=n,this._mainEditorWidgetService=o,this._mainDraftService=s,this._notificationService=l,this._draftMaterialsService=d,this._digitalHumanDataService=c,this._uploader=null,this.taskList=[],this.removeBgTaskList=[],this._getCategories=(0,y.Z)(async()=>{let e=await this._digitalHumanDataService.getCategories({polyConfig:{categoryCount:2,detailCount:0}});return e.ok?(0,k.oW)(e.value.value.list):e}),this._taskMap=new Map,this._deleteTaskMap=new Map,this._smartQueryTaskMap=new Map,this._payinPayoutHelper=this._containerService.createInstance(P.o),this._messageManager=this._containerService.createInstance(x.J,R.V5.Generate),this._removeBackgroundMessageManager=this._containerService.createInstance(x.J,R.V5.RemoveBackground),this._digitalHumanAttachmentHelper=this._containerService.createInstance(B),this._taskProcessingUpdateMap=new Map,(async()=>{this._uploader=new w.jm({uniqueId:await this._teaAdapterService.getWebId(),userRegion:this._accountService.regionSettings.region,isBoe:!1,newIdc:this._accountService.regionSettings.webIdc,reqDomain:this._accountService.regionSettings.domain,imgUploader:{getSliceFunc:e=>e>1048576e3?0xa00000:5242880}})})(),this._mainDraftService.dataSdk.onChangeDiff(e=>{var t,i;let a=(null!==(t=e.segment)&&void 0!==t?t:[]).filter(e=>"delete"===e.type&&(0,S.NHR)(e.item.segment)).map(e=>e.item.segment),r=(null!==(i=e.segment)&&void 0!==i?i:[]).filter(e=>"add"===e.type&&(0,S.NHR)(e.item.segment)).map(e=>e.item.segment);this.handleDigitalHumanDelete(a),this.handleResumeDigitalHuman(r)})}}(0,a.gn)([_.LO,(0,a.w6)("design:type",Array)],V.prototype,"taskList",void 0),(0,a.gn)([_.LO,(0,a.w6)("design:type",Array)],V.prototype,"removeBgTaskList",void 0),(0,a.gn)([_.aD,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Number]),(0,a.w6)("design:returntype",void 0)],V.prototype,"showRemoveBgToast",null),(0,a.gn)([_.aD,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[]),(0,a.w6)("design:returntype",void 0)],V.prototype,"updateTaskList",null),V=(0,a.gn)([(0,a.fM)(0,o.t),(0,a.fM)(1,s.p),(0,a.fM)(2,c.Gw),(0,a.fM)(3,u.w),(0,a.fM)(4,U.e),(0,a.fM)(5,l.Y),(0,a.fM)(6,W.a),(0,a.fM)(7,p.n),(0,a.fM)(8,I.lT),(0,a.fM)(9,b.D),(0,a.fM)(10,d.T),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===o.t?Object:o.t,void 0===s.p?Object:s.p,void 0===c.Gw?Object:c.Gw,void 0===u.w?Object:u.w,void 0===U.e?Object:U.e,void 0===l.Y?Object:l.Y,void 0===W.a?Object:W.a,void 0===p.n?Object:p.n,void 0===I.lT?Object:I.lT,void 0===b.D?Object:b.D,void 0===d.T?Object:d.T])],V)},233828:function(e,t,i){i.d(t,{n:function(){return F}});var a=i(789786),r=i(772322);i(784923);var n=i(498417),o=i(561909),s=i(570126),l=i(801497),d=i(451536),c=i(108692),u=i(458906),h=i(70031),p=i(948328),_=i(639605),g=i(825686),f=i(613069),m=i(273238),v=i(782350),y=i(230689),S=i(200247),k=i(314181),w=i(196769),M=i(270679),b=i(143113),T=i(587892),I=i(141913);let D=()=>i.e("7540").then(i.bind(i,107666)),P=(0,I.PS)(D);class F{showModal(e,t){if(this._root)return;let i=null!=t?t:"export_fail_popup";(0,M.c)(this._containerService,{position:i}),(0,b.z)(this._containerService,{enter_from:i,action:"show"}),this._root=s.createRoot(this._container),this._root.render((0,r.jsx)(I.Xf,{fallback:null,children:(0,r.jsx)(P,{spaceList:this._workspaceService.workspaceList,defaultWorkspaceId:this._defaultWorkspaceId(e),draftTitle:this._draftName,draftSize:this._draftSize,showType:e,isDraftOwner:this._isDraftOwner,reportChangeDictionaryWindow:this._reportChangeDictionaryWindow.bind(this,i),onMove:this._moveSpace.bind(this),showExpand:this._showExpand.bind(this),onMaskClose:this._handleMaskClose.bind(this),onSpaceListChange:this._workspaceService.onDidWorkspaceChange.bind(this._workspaceService),getIsSupportPay:this._getIsSupportPay.bind(this)})}))}_reportChangeDictionaryWindow(e,t,i){(0,b.z)(this._containerService,{enter_from:e,action:t,to_workspace_id:i})}get _draftSize(){let{userGeneratedMaterials:e,autoGeneratedMaterials:t}=this._draftMaterialsService.getMaterials();return e.reduce((e,t)=>{var i;return e+(null!==(i=t.size)&&void 0!==i?i:0)},0)+t.reduce((e,t)=>{var i;return e+(null!==(i=t.size)&&void 0!==i?i:0)},0)}get _isDraftOwner(){var e,t;return!(null===(t=this._mainDraftService.cloudMetaManager.getMeta())||void 0===t?void 0:null===(e=t.createSource)||void 0===e?void 0:e.owner)||this._mainDraftService.cloudMetaManager.getMeta().createSource.owner===this._accountService.userProfile.uid}_defaultWorkspaceId(e){var t,i;if(e!==o.B.EXPORT)return this._mainDraftService.draftWorkspaceManager.workspaceId;return null!==(i=null===(t=this._exportService.getExportSpace())||void 0===t?void 0:t.workspace_id)&&void 0!==i?i:this._mainDraftService.draftWorkspaceManager.workspaceId}_handleMaskClose(){var e;null===(e=this._root)||void 0===e||e.unmount(),this._root=void 0,this._onModalClose.fire()}_showExpand(e,t){let i=this._containerService.createInstance(w.o);(0,u.T)({pageFrom:g.K1.spaceLimitUpgrade,payinPayoutHelper:i,workspaceId:e,payScene:h.Mm.MOVE_SPACE_MODAL,onPaySuccess(e){e&&t()}})}get _draftName(){return this._mainDraftService.dataSdk.draftView.getDraftName()}get _draftId(){return this._mainDraftService.dataSdk.draftView.getDraftId()}async _moveSpace(e,t){if(!e)return!1;if(t===o.B.EXPORT)this._exportService.setExportSpace(e);else{if(this._defaultWorkspaceId(t)===e.workspace_id)return!1;try{let{space_id:t,workspace_id:i}=e;this._mainDraftService.saveManager.isEmptyPackage?this._mainDraftService.draftWorkspaceManager.updateWorkspaceId(i):await this._moveWorkspaceDraft(i),(0,d.rH)({workspaceId:i,spaceId:t}),n.Z.success(l.ZP.t("web_default_space_text_move_tos_successfully",{string0:this._draftName||l.ZP.t("workspace_unname_draft",{},"\u672A\u547D\u540D\u8349\u7A3F"),string1:e.name},"{string0} moved to {string1}"))}catch(e){return n.Z.error(l.ZP.t("space_files_move_failed",{},"Move failed")),!1}}return!0}async _moveWorkspaceDraft(e){let t=this._mainDraftService.draftWorkspaceManager.workspaceId,i=this._workspaceService.workspaceList.find(e=>e.workspace_id===t);if(!t){this._mainDraftService.draftWorkspaceManager.updateWorkspaceId(e);return}let a=await this._userMaterialsService.getEvercloudInstance(e),r=await a.moveFromSpace({fromSpace:null==i?void 0:i.space_id,fromIdc:null==i?void 0:i.space_idc,resourceId:this._mainDraftService.saveManager.packageId,resourceType:3,meta:this._mainDraftService.cloudMetaManager.getMeta()}),{data:n}=await r.done(),{result_id:o}=n;this._mainDraftService.saveManager.setPackageId(o),this._mainDraftService.draftWorkspaceManager.updateWorkspaceId(e),this._websocketService.sendMessage({new_file_id:this._draftId,new_workspace_id:e,old_file_id:this._draftId,old_workspace_id:t})}async _getIsSupportPay(){let e=this._containerService.createInstance(w.o);return await e.getIsSupportPay(this._mainDraftService.draftWorkspaceManager.workspaceId)}constructor(e,t,i,a,r,n,o,s,l){this._workspaceService=e,this._mainDraftService=t,this._permissionService=i,this._draftMaterialsService=a,this._userMaterialsService=r,this._exportService=n,this._containerService=o,this._websocketService=s,this._accountService=l,this._onModalClose=new T.Q,this.onModalClose=this._onModalClose.event,this._container=document.createElement("div"),document.body.append(this._container),requestIdleCallback(()=>{D()})}}F=(0,a.gn)([(0,a.fM)(0,v.W),(0,a.fM)(1,c.n),(0,a.fM)(2,f.H),(0,a.fM)(3,p.D),(0,a.fM)(4,m.b),(0,a.fM)(5,k.AA),(0,a.fM)(6,y.t),(0,a.fM)(7,_.J0),(0,a.fM)(8,S.D),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===v.W?Object:v.W,void 0===c.n?Object:c.n,"undefined"==typeof IVideoPermissionService?Object:IVideoPermissionService,void 0===p.D?Object:p.D,void 0===m.b?Object:m.b,void 0===k.AA?Object:k.AA,void 0===y.t?Object:y.t,void 0===_.J0?Object:_.J0,void 0===S.D?Object:S.D])],F)},314181:function(e,t,i){i.d(t,{AA:function(){return h},KH:function(){return c},Po:function(){return u},YF:function(){return d},rF:function(){return l}});var a,r,n,o,s=i(335290);var l=((a={})[a.SUBTITLE_UNKONWN=0]="SUBTITLE_UNKONWN",a[a.SUBTITLE_SRT=1]="SUBTITLE_SRT",a[a.SUBTITLE_ASS=2]="SUBTITLE_ASS",a[a.SUBTITLE_LRC=3]="SUBTITLE_LRC",a[a.SUBTITLE_TXT=4]="SUBTITLE_TXT",a);var d=((r={})[r.Standard=240]="Standard",r[r.High=320]="High",r[r.UltraHigh=640]="UltraHigh",r);var c=((n={}).order_failed="20001",n);var u=((o={})[o.default=1]="default",o[o.template_post=21]="template_post",o[o.Gif=38]="Gif",o);let h=(0,s.yh)("export-service")},938240:function(e,t,i){i.d(t,{n:function(){return s}});var a=i(789786),r=i(108692),n=i(402655),o=i(445449);class s extends n.JT{_init(){this._initTriggerStartEdit(),this._checkEditTimeSave()}_initTriggerStartEdit(){let e=!1;this._mainDraftService.dataSdk.draftView.getDraftId()?!e&&(e=!0,this._startEdit()):this._mainDraftService.dataSdk.onChangeDiff(()=>{!e&&(e=!0,this._startEdit())})}_checkEditTimeSave(){let e;document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState?(this._disable=!1,this._isVisible=!0,this._startEditTime=Date.now(),this._intervalSaveEditTime()):(this._saveEditTime(),clearInterval(this._intervalHandle))},!0),window.addEventListener("beforeunload",()=>{e&&clearTimeout(e),this._saveEditTime(),this._disable=!0,e=setTimeout(()=>{this._disable=!1},5e3)}),this._intervalSaveEditTime()}_intervalSaveEditTime(){this._intervalHandle=setInterval(()=>{this._isVisible&&(this._disable=!1,this._saveEditTime())},6e4)}_saveEditTime(){let e=this._mainDraftService.dataSdk.draftView.getDraftId();if(this._disable||!e)return;let t=Date.now(),i=Math.round((t-this._startEditTime)/1e3);this._editTimeDataService.editTimeReportBeacon({draftId:e,editTime:i})&&(this._startEditTime=t)}async getDraftEditTime(){let e=this._mainDraftService.dataSdk.draftView.getDraftId();if(!e)return null;let t=await this._editTimeDataService.getDraftEditTime({draftId:e}),i=Math.round((Date.now()-this._startEditTime)/1e3);if(!t.ok)return null;{let{editDays:e=0,actualEditDays:a=0,actualEditTime:r=0}=null==t?void 0:t.value;return{edit_time:r+i,edit_days:a,finish_days:e}}}_startEdit(){let e=this._mainDraftService.dataSdk.draftView.getDraftId();return(this._startEditTime=Date.now(),e)?(this._startEditTime=Date.now(),this._editTimeDataService.editTimeReport({draftId:e,editTime:0})):Promise.resolve()}get startEditTime(){return this._startEditTime}dispose(){clearInterval(this._intervalHandle),super.dispose()}constructor(e,t){super(),this._mainDraftService=e,this._editTimeDataService=t,this._startEditTime=0,this._intervalHandle=null,this._isVisible=!0,this._disable=!1,this._init()}}s=(0,a.gn)([(0,a.fM)(0,r.n),(0,a.fM)(1,o.E),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===r.n?Object:r.n,void 0===o.E?Object:o.E])],s)},460787:function(e,t,i){i.d(t,{M:function(){return o}});var a=i(402655),r=i(800788),n=i(426336);class o extends a.JT{getCombinationApplySpeedDraftViewById(e){return this._segmentIdToDraftView.get(e)}_checkTemplateSplit(e){return!!(e.sourceTimerange.start>0)||e.sourceTimerange.duration!==e.materialDraft.draft.metadata.duration}constructor(e){super(),this._dataSdk=e,this._segmentIdToDraftView=new Map,this._register(this._dataSdk.onChangeDiff(e=>{let{[n.u4I.SEGMENT]:t}=e;t.forEach(e=>{let t;let{type:i,item:a}=e;if(i===n.C8.DELETE){let{segment:e}=a;(0,n.duj)(e)&&this._segmentIdToDraftView.delete(e.id);return}t=i===n.C8.UPDATE||i===n.C8.MOVE?a.id:a.segment.id;let o=this._dataSdk.draftView.getSegmentById(t);if(o&&(0,n.duj)(o)){let{segment:e}=a,{speed:s}=o;if(e.targetTimerange||e.reverse||e.speed||i===n.C8.UPDATE&&e.templateId){if(!this._checkTemplateSplit(o)&&s.mode===n.yY$.SpeedModeNormal&&1===s.speed){let e=this._dataSdk.draftView.getDraftById(o.materialDraft.draft.getDraftId());(0,r.Y2)(e),this._segmentIdToDraftView.set(t,e);return}let e=this._dataSdk.draftView.getTargetTimeRangeByCompositionSegment(t);(0,r.Y2)(e),this._segmentIdToDraftView.set(t,e)}}})}))}}},847436:function(e,t,i){i.d(t,{X:function(){return s}});var a=i(772322);i(966156);var r=i(368100),n=i(140515),o=i(801497);function s(e){(0,n.lT)(e.containerService,{action:n.UL.Show,tool_type:n.Dd.VoiceSeparation});let t=r.Z.confirm({icon:null,title:o.ZP.t("web_isolate_title_allow",void 0,"Allow CapCut to upload your audio to our server?"),content:(0,a.jsx)("div",{children:o.ZP.t("web_isolate_info_allow",void 0,"CapCut needs to upload your audio to our server to isolate your voice. Once the voice is isolated, your audio will be immediately deleted from our server.")}),okText:o.ZP.t("web_isolate_btn_allow",{},"Allow"),okButtonProps:{status:"default",type:"primary"},cancelText:o.ZP.t("web_isolate_btn_not_now",{},"Not now"),onOk:function(){e.onOk(),(0,n.lT)(e.containerService,{action:n.UL.Allow,tool_type:n.Dd.VoiceSeparation})},onCancel:function(){e.onCancel(),(0,n.lT)(e.containerService,{action:n.UL.Close,tool_type:n.Dd.VoiceSeparation})},cancelButtonProps:{onClick(){e.onCancel(),t.close(),(0,n.lT)(e.containerService,{action:n.UL.Reject,tool_type:n.Dd.VoiceSeparation})}}})}},155183:function(e,t,i){i.d(t,{a:()=>U});var a=i("789786"),r=i("230689"),n=i("108692"),o=i("587892"),s=i("402655"),l=i("690613"),d=i("208041"),c=i("800788"),u=i("65458"),h=i("920704"),p=i("578210");class _ extends s.JT{cancel(){this._cancellationTokenSource.cancel(),this._onCancel.fire(),this._task.cancel(),this._store.clear()}get error(){return this._error}get value(){return(0,c.ZB)(this._value,"smartToken status error."),[this._value]}get status(){return this._cancellationTokenSource.token.isCancellationRequested?u.W.Cancelled:this._error.ok?void 0!==this._value?u.W.Success:u.W.Running:u.W.Error}get onProgress(){return this._isFinished()?p.qA:this._onProgress.event}get onError(){return this._error.ok?this._onError.event:(0,p.jc)(this._error,this._cancellationTokenSource.token)}get onSuccess(){return this._value?(0,p.jc)([this._value],this._cancellationTokenSource.token):this._onSuccess.event}get onCancel(){return this._onCancel.event}_start(e){switch(e.status){case h.y.Success:this._transfer(e.value);break;case h.y.Failure:break;default:this._listenTask(e)}}_listenTask(e){this._register(e.onProgress(e=>{this._onProgress.fire(e.progress,e)})),this._register(e.onSuccess(e=>{this._transfer(e)})),this._register(e.onError(e=>{this._error=e,this._onError.fire(this._error)}))}_isFinished(){return!this._error.ok||void 0!==this._value}_transfer(e){let t=this._task.transfer(e);if(!t.ok){this._onError.fire(t);return}this._value=t.value,this._onSuccess.fire([this._value])}constructor(e){super(),this._task=e,this._onProgress=this._register(new o.Q),this._onError=this._register(new o.Q),this._onSuccess=this._register(new o.Q),this._onCancel=this._register(new o.Q),this._cancellationTokenSource=this._register(new d.A),this._error=(0,l.ly)(),this._task.execute().then(e=>{if(!this._cancellationTokenSource.token.isCancellationRequested)e.ok?this._start(e.value):(this._error=e,this._onError.fire(this._error))})}}var g=i("528582"),f=i("168080"),m=i("745860"),v=i("200247"),y=i("596112"),S=i("358789"),k=i("817488"),w=i("425427");class M extends S.g{async execute(){return this._task=this._intelligentDataService.createIntelligentTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform,smartToolType:k.v.Gameplay,reqJson:this._gameplayReqJson,scene:2}),await this._task}transfer(e){let t=e.taskDetails[0].transcodeVideoInfos,i=e.taskDetails[0].transcodeImageInfos,a=t.length?u.wM.Video:u.wM.Image,{vid:r}=e.taskDetails[0],n="",o="";if(r){let e;t.length?e=this._getResolution(t):i.length&&(e=this._getResolution(i)),e&&(n=e.url.replace(/^http:/,"https:"),o=e.key)}let s={type:u.FV.Gameplay,assetId:this._assetId,md5:e.taskDetails[0].md5,vid:r,url:n,key:o,groupType:a,resourceId:e.resourceId,resourceName:e.resourceName,taskId:e.taskId};return(0,l.oW)(s)}_getResolution(e){return e.find(e=>/480p?/.test(e.defination))||e.find(e=>/360p?/.test(e.defination))||e.find(e=>/720p?/.test(e.defination))}constructor(e,t,i,a,r,n,o,s){super(),this._assetId=e,this._platform=t,this._workspaceId=i,this._gameplayReqJson=a,this._environmentService=r,this._accountService=n,this._teaAdapterService=o,this._intelligentDataService=s}}M=(0,a.gn)([(0,a.fM)(4,w.rO),(0,a.fM)(5,v.D),(0,a.fM)(6,y.w),(0,a.fM)(7,m.p),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[String,void 0===h.hn?Object:h.hn,String,String,void 0===w.rO?Object:w.rO,void 0===v.D?Object:v.D,void 0===y.w?Object:y.w,void 0===m.p?Object:m.p])],M);var b=i("811185"),T=i("186488"),I=i("453059"),D=i("727040"),P=i("284943"),F=i("476907"),C=i("413787"),E=i("496530"),x=i("66859"),R=i("286575"),A=i("33818"),O=i("371167");class U{createVideoMattingTask(e,t){this._waitingTasks.push(this._containerService.createInstance(E.G,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId))}createGraphicMattingTask(e,t){this._waitingTasks.push(this._containerService.createInstance(T.P,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId))}createVcTask(e,t,i,a,r){this._waitingTasks.push(this._containerService.createInstance(C.w,{assetId:e,platform:t,voice:i,workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,urlParams:r,resourceType:a}))}createVocalSeparationTask(e,t,i,a,r){this._waitingTasks.push(this._containerService.createInstance(R.f,e,t,i,a,this._mainDraftService.draftWorkspaceManager.workspaceId,r))}createVocalBeautifyTask(e,t,i,a,r){this._waitingTasks.push(this._containerService.createInstance(A.a,e,t,i,a,this._mainDraftService.draftWorkspaceManager.workspaceId,r))}createReverseTask(e,t){this._waitingTasks.push(this._containerService.createInstance(D.g,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId))}createSmartSplitTask(e,t){this._waitingTasks.push(this._containerService.createInstance(P.o,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId))}createStableTask(e,t,i){this._waitingTasks.push(this._containerService.createInstance(F.M,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId,i))}createAlgorithmTask(e,t,i){this._waitingTasks.push(this._containerService.createInstance(f.x,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId,i))}createGameplayTask(e,t,i){this._waitingTasks.push(this._containerService.createInstance(M,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId,i))}createVideoTrackingTask(e,t,i){this._waitingTasks.push(this._containerService.createInstance(b.J,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId,i))}createPipelineTask(e){this._waitingTasks.push(this._containerService.createInstance(I.B,{...e,workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId}))}createSmartCropTask(e){this._waitingTasks.push(this._containerService.createInstance(x.S,e))}createObjectLockTask(e,t,i){this._waitingTasks.push(this._containerService.createInstance(O.X,e,t,this._mainDraftService.draftWorkspaceManager.workspaceId,i))}build(){return 1===this._waitingTasks.length?new _(this._waitingTasks[0]):new g.R(this._waitingTasks)}constructor(e,t){this._mainDraftService=e,this._containerService=t,this._waitingTasks=[]}}U=(0,a.gn)([(0,a.fM)(0,n.n),(0,a.fM)(1,r.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.n?Object:n.n,void 0===r.t?Object:r.t])],U)},993097:function(e,t,i){i.d(t,{g:function(){return p}});var a=i(789786),r=i(587892),n=i(402655),o=i(246457),s=i(210823),l=i(896413),d=i(407899),c=i(947915),u=i(397983);let h="lvve-recently-color";class p extends n.JT{get maxHeight(){return this._maxHeight}getRecentColors(){return this._recentColors}setRecentColors(e){let t=[],i=new Set;for(let a of e){if(!i.has(a))i.add(a),t.push(a)}for(;t.length>11;)t.pop();this._recentColors=t,this._saveRecentColors()}getScrollTop(e){var t;return null!==(t=this._scrollMap.get(e))&&void 0!==t?t:0}setScrollTop(e,t){this._scrollMap.set(e,t)}_addEvent(){this._register(this._mainEditorWidgetService.layoutManager.onDidLayoutScaleChange(this._reCalculateMaxHeight,this)),this._register(this._workbenchService.onToolbarModeSwitch(this._reCalculateMaxHeight,this)),this._register((0,d.n)(window,"resize",this._reCalculateMaxHeight))}_saveRecentColors(){this._browserStorageService.keyValue.set(h,JSON.stringify(this._recentColors))}_initRecentColors(){let e=this._browserStorageService.keyValue.query(h);if(!!e.ok&&!!e.value)try{let t=JSON.parse(e.value);this._recentColors=t}catch(e){}}_getCurrentHeight(){if(this._workbenchService.getToolbarIsfixedPanel()){let e=document.getElementById("float-mode-panel-container");return e&&(e.style.maxHeight=`${this._maxHeight+this._toolbarPanelHeaderHeight}px`,e.style.overflow="hidden"),this._workbenchService.getWorkbenchSize().height-this._workbenchService.getTitleBarHeight()-this._toolbarPanelHeaderHeight}return this._workbenchService.getWorkbenchSize().height-this._workbenchService.getTitleBarHeight()-this._mainEditorWidgetService.layoutManager.getBottomHeight()-this._toolbarPanelHeaderHeight-2*this._toolbarMargin}constructor(e,t,i,a){super(),this._browserStorageService=e,this._workbenchService=t,this._mainEditorWidgetService=i,this._onMaxHeightChange=new r.Q,this._scrollMap=new Map,this._recentColors=[],this._toolbarPanelHeaderHeight=parseFloat(u.Z["attribute-panel-header-height"]),this._toolbarMargin=8,this._reCalculateMaxHeight=()=>{let e=this._getCurrentHeight();this._maxHeight!==e&&(this._maxHeight=e,this._onMaxHeightChange.fire(this._maxHeight))},this.onMaxHeightChange=this._onMaxHeightChange.event,this.syncToAllConfig=new c.iP(a),this._initRecentColors(),this._maxHeight=this._getCurrentHeight(),this._addEvent()}}p=(0,a.gn)([(0,a.fM)(0,o.d),(0,a.fM)(1,s.e),(0,a.fM)(2,l.a),(0,a.fM)(3,o.d),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===o.d?Object:o.d,void 0===s.e?Object:s.e,void 0===l.a?Object:l.a,void 0===o.d?Object:o.d])],p)},867904:function(e,t,i){i.d(t,{M:function(){return P}});var a=i(789786),r=i(827322),n=i(426336),o=i(108692),s=i(896413),l=i(820193),d=i(234487),c=i(988385),u=i(938918),h=i(948328),p=i(160391),_=i(426020),g=i(230689),f=i(433140),m=i(31463),v=i(127830),y=i(775352),S=i(196769),k=i(999268),w=i(587892),M=i(402655),b=i(800788);function T(e,t){let i=t.getResourceKeyFromDraftPath(e)||e;return(0,b.Y2)(i,`getCoverResourceKey not found for path: ${e}`),i}function I(e){var t;return null!==(t=e.getModel().md5)&&void 0!==t?t:""}let D="GraphicCoverSpace";class P extends M.JT{get graphicPackageAssets(){return this._graphicPackageAssets}getFrames(e,t,i){return this._mainEditorWidgetService.renderManager.getVideoFrames(e,t,i)}cancelGetFrames(e){this._mainEditorWidgetService.renderManager.cancelGetVideoFrames(e)}setGraphicPackageAssets(e){this._graphicPackageAssets=e}clearCover(){this._mainDraftService.dataSdk.api.draft.clearCover()}async setGraphicDraftCover(e,t){let[i,a]=await Promise.all([this._uploadDraft(e),this._uploadCover(t.data)]),{materialLifecycle:r,jsonString:n,size:o}=i,{materialLifecycle:s,size:d,data:c}=a,u=function(e){var t;return null!==(t=e.getModel().md5)&&void 0!==t?t:""}(r),h=I(s),p=(0,l.GL)(s.getModel(),v._g.UserPhoto);this._resourceService.add(p.key,p.resource),this._resourceService.get(p.key,v._g.UserPhoto).getCoverResourceToken().start(),this._updateCache({jsonString:n,path:u,size:o,md5:r.md5},{data:c,height:t.height,path:h,size:d,width:t.width}),this._setGraphicCover({materialLifecycle:r,path:u},{width:t.width,height:t.height,materialLifecycle:s,path:h})}async setStaticCover(e){var t;(0,b.Y2)(e);let i=e.getModel(),{width:a,height:r}=i,n=await this._fetchCoverInfo(i);if(!n)throw Error("fetch cover info failed");let o=(0,l.GL)(e.getModel(),v._g.UserPhoto);this._resourceService.add(o.key,o.resource);let s=I(e);this._coverAssetMap.set(s,{path:s,size:null!==(t=i.size)&&void 0!==t?t:0,data:n.data,width:a,height:r}),this._updateStaticCover({materialLifecycle:e,path:s,width:a,height:r})}async getDraftJsonAsset(){await this._mutex.lockShared(),this._mutex.unLockShared();let e=this._mainDraftService.dataSdk.draftView.getCover();if(!!e)return this._draftAssetMap.get(e.graphicDraftPath)}async getDraftJsonString(){let e=await this.getDraftJsonAsset();return null==e?void 0:e.jsonString}async getCoverAsset(){await this._mutex.lockShared(),this._mutex.unLockShared();let e=this._mainDraftService.dataSdk.draftView.getCover();if(!!e)return this._coverAssetMap.get(e.imagePath)}_syncDataFromDraft(){return Promise.all([this._recoveryDraftAsset(),this._recoveryCoverAsset()])}async _recoveryDraftAsset(){var e;let t=this._mainDraftService.dataSdk.draftView.getCover();if(!t)return;let{graphicDraftPath:i}=t;if(!i)return;let a=this._draftMaterialService.getMaterialByKey(T(i,this._mainDraftService.draftPathStore));if(!a)return;let r=a.md5,n=await this._fetchDraftJsonString(r);this._draftAssetMap.set(i,{path:i,size:null!==(e=a.size)&&void 0!==e?e:0,jsonString:n,md5:a.md5})}async _recoveryCoverAsset(){var e;let t=this._mainDraftService.dataSdk.draftView.getCover();if(!t)return;let{imagePath:i}=t;if(!i)return;let a=this._draftMaterialService.getMaterialByKey(T(i,this._mainDraftService.draftPathStore));(0,b.ZB)(a,"cover asset material not found.");let r=await this._fetchCoverInfo(a);if(!!r)this._coverAssetMap.set(i,{path:i,size:null!==(e=a.size)&&void 0!==e?e:0,data:r.data,width:a.width,height:a.height}),this._onCoverChange.fire()}_fetchDraftJsonString(e){let t=this._resourceService.get(e,v._g.UserFile);(0,b.ZB)(t,`could not get draft file by ${e})`);let i=t.getContentResourceToken();return new Promise((e,t)=>{i.onReady(t=>{let{buffer:i}=t,a=new Uint8Array(i);e(new TextDecoder("utf-8").decode(a))}),i.onError(e=>{t(e)}),i.start()})}_fetchCoverInfo(e){let t=(0,l.nQ)(this._resourceService,v._g.UserPhoto,e).getResolutionResourceTokenByQueue([_.Mc["1080p"],_.Mc["720p"],_.Mc["480p"],_.Mc["360p"],_.Mc["2400p"],_.Mc.origin]);t.start();let i={previewUrl:void 0,previewKey:void 0,previewBuffer:void 0};return new Promise((e,a)=>{t.onReady(async t=>{let{buffer:n,url:o,key:s}=t;if(Object.assign(i,{previewUrl:o,previewKey:s,previewBuffer:n}),!i.previewBuffer){e(null);return}let{previewBuffer:l}=i;try{let t=await new Promise((e,t)=>{let i=new FileReader;i.onloadend=()=>{let t=i.result;e(t)},i.onerror=t;let a=new Blob([l],{type:"image/jpeg"});i.readAsDataURL(a)});new Image().src=(0,r.C)(t,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),e({data:t})}catch(e){a(e)}}),t.onError(e=>{a(e)})})}_setGraphicCover(e,t){let{materialLifecycle:i,path:a}=e,{materialLifecycle:r,width:n,height:o,path:s}=t;this._draftMaterialService.getOrCreateAutoGeneratedMaterialNamespace(D).replaceAllMaterials([i,r]),this._mainDraftService.draftPathStore.recordResourceKeyToDraftPath(s,s),this._mainDraftService.draftPathStore.recordDraftPathToResourceKey(s,s),this._mainDraftService.draftPathStore.recordResourceKeyToDraftPath(a,a),this._mainDraftService.draftPathStore.recordDraftPathToResourceKey(a,a);let l=this._mainDraftService.dataSdk.api.draft.setCover({graphicDraftPath:a,imageInfo:{path:s,width:n,height:o,name:"graphic_cover.jpg"},duration:this._coverDuration});if(l.ok)this._reportService.reportDevEvent("setGraphicCover-success",{draftPath:a,coverPath:s,duration:this._coverDuration.toString()});else{let e=Error(l.msg);throw this._reportService.reportDevError("setGraphicCover-error",e,{draftPath:a,coverPath:s,duration:this._coverDuration.toString()}),e}}_updateStaticCover(e){let{width:t,height:i,materialLifecycle:a,path:r}=e;this._draftMaterialService.getOrCreateAutoGeneratedMaterialNamespace(D).replaceAllMaterials([a]),this._mainDraftService.draftPathStore.recordResourceKeyToDraftPath(r,r),this._mainDraftService.draftPathStore.recordDraftPathToResourceKey(r,r);let n=this._mainDraftService.dataSdk.api.draft.setCover({imageInfo:{path:r,width:t,height:i,name:"static_cover.jpg"},duration:this._coverDuration});if(!n.ok)throw Error(n.msg);this.updateGraphicPackageAssets([])}_updateCache(e,t){this._draftAssetMap.set(e.path,e),this._coverAssetMap.set(t.path,t)}async _uploadDraft(e){let t=new File([new Blob([e],{type:"application/json"})],"graphic_cover.json",{type:"application/json"}),[i]=await (0,d.u)({files:[t],fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,packageDelta:{meta:{visible:!1}},uploadParams:{skipTranscode:!0,uploadFlag:y.m5.InvisibleNoOccupation,autoPromote:!0},payinPayoutHelper:this._payinPayoutHelper,containerService:this._containerService});if(!i.ok)throw Error(i.msg);let a=i.value;return new Promise((i,r)=>{a.onDidDone(()=>{i({materialLifecycle:a,jsonString:e,size:t.size})});a.onUploadFailure(e=>{r(null==e?void 0:e.msg)})})}async _uploadCover(e){let t=function(e,t){let i=e.split(","),a=i[0].match(/:(.*?);/)[1],r=atob(i[1]),n=r.length,o=new Uint8Array(n);for(;n--;)o[n]=r.charCodeAt(n);return new File([o],t,{type:a})}(e,"graphic_cover.jpg"),[i]=await (0,c.E)({files:[t],fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,packageDelta:{meta:{visible:!1}},uploadParams:{uploadFlag:y.m5.InvisibleNoOccupation,autoPromote:!0},payinPayoutHelper:this._payinPayoutHelper,containerService:this._containerService});if(!i.ok)throw Error(i.msg);let a=i.value;return new Promise((i,r)=>{a.onDidDone(()=>{i({materialLifecycle:a,size:t.size,data:e})});let n=e=>{r(null==e?void 0:e.msg)};a.onUploadFailure(n),a.onTranscodeFailure(n)})}updateGraphicPackageAssets(e){let t=new Set(e.map(e=>e.md5)),i=new Set,a=[],r=[];this._graphicPackageAssets.forEach(e=>{t.has(e.md5)?i.add(e.md5):r.push(e)}),e.forEach(e=>{!i.has(e.md5)&&a.push(e)}),r.forEach(e=>{this._mainDraftService.saveManager.packageAssetsBuilder.removeExternalAsset(e)}),a.forEach(e=>{this._mainDraftService.saveManager.packageAssetsBuilder.addExternalAsset(e)}),this._graphicPackageAssets=e}getCoverMaterial(){let e=this._mainDraftService.dataSdk.draftView.getCover();if(!e)return;let{imagePath:t}=e;if(!t)return;let i=this._draftMaterialService.getMaterialByKey(T(t,this._mainDraftService.draftPathStore));return(0,b.ZB)(i,"cover asset material not found."),i}constructor(e,t,i,a,r,o,s){super(),this._mainDraftService=e,this._draftMaterialService=t,this._mainEditorWidgetService=i,this._containerService=a,this._resourceService=r,this._lifecycleService=o,this._reportService=s,this._onCoverChange=new w.Q,this._onGetFrame=new w.Q,this._onRecovered=new w.Q,this._draftAssetMap=new Map,this._coverAssetMap=new Map,this._mutex=new k.L,this._coverDuration=1000000n/30n*5n,this._graphicPackageAssets=[],this._inited=!1,this.onCoverChange=this._onCoverChange.event,this.onGetFrame=this._onGetFrame.event,this.onRecovered=this._onRecovered.event,this._payinPayoutHelper=this._containerService.createInstance(S.o);let l=async()=>{try{await this._mutex.lock(),await this._syncDataFromDraft(),this._onRecovered.fire()}finally{this._mutex.unLock()}};this._lifecycleService.didPassPhase(u.B.DraftLoaded)&&!this._inited&&(this._inited=!0,l()),this._register(this._mainDraftService.dataSdk.onChangeDiff(e=>{let t=e.videoDocument.getDraftProperty();t&&(t.retouchCover||t.canvasConfig)&&this._onCoverChange.fire(),e.actionOperateType===n.aWQ.History&&(this._inited=!1),!this._inited&&(this._inited=!0,l())})),this._register(this._mainEditorWidgetService.onEventually(()=>{this._mainEditorWidgetService.renderManager.onGetFrames(e=>{this._onGetFrame.fire(e)})}))}}P=(0,a.gn)([(0,a.fM)(0,o.n),(0,a.fM)(1,h.D),(0,a.fM)(2,s.a),(0,a.fM)(3,g.t),(0,a.fM)(4,f.c),(0,a.fM)(5,p.g),(0,a.fM)(6,m.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===o.n?Object:o.n,void 0===h.D?Object:h.D,void 0===s.a?Object:s.a,void 0===g.t?Object:g.t,void 0===f.c?Object:f.c,void 0===p.g?Object:p.g,void 0===m.m?Object:m.m])],P)},882610:function(e,t,i){i.d(t,{p:()=>j});var a=i("789786"),r=i("204034"),n=i("260963"),o=i("71659"),s=i("515918"),l=i("649508"),d=i("108692"),c=i("896413"),u=i("298730"),h=i("426336"),p=i("632642"),_=i("867904"),g=i("731992"),f=i("173888"),m=i("230689"),v=i("433140"),y=i("966697"),S=i("127830"),k=i("550535"),w=i("820193"),M=i("988385"),b=i("254336"),T=i("948328"),I=i("673422");async function D(e,t){let i=e.modalOpenTime,a=await t;if(i===e.modalOpenTime)return a;throw Error("Task was aborted becacuse cover modal has been closed.")}var P=i("966614"),F=i("196769"),C=i("800788"),E=i("260660"),x=i("937093"),R=i("356954");class A{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="perf_cover_highlight_ready"}}var O=i("256179"),U=i("65263"),L=i("457564"),W=i("893245");class j{get modalOpenTime(){return this._modalOpenTime}refreshTracksInfo(){let e=this._mainDraftService.dataSdk.draftView.getAllTracks();this._isTracksEmpty=(0,u._3)(e),this._hasVideoSegment=(0,u.kv)(e),this._hasMatting=(0,u.W1)(e)}async openModal(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{modalType:r.w8.Edit,selectType:r.UQ.video},{width:a=0,height:n=1}=this._mainDraftService.dataSdk.draftView.getCanvasConfig(),s=this._mainDraftService.dataSdk.draftView.getDuration(),l=this._store;this._modalOpenTime=new Date().getTime(),l._draftModifyTimeWhenOpen!==l.draftModifyTime&&(l.setVideoParam(void 0),l.setHighlightParam(void 0),l.refreshDraftModifyTimeWhenOpen()),l.setVisible(!0),l.setModalType(null!==(e=i.modalType)&&void 0!==e?e:r.w8.Edit),l.modalType===r.w8.SelectFrame&&l.setSelectFramesForGraphicParams({onSelectFrame:i.onSelectFrame,onCancelSelect:i.onCancelSelect}),l.setAspectRatio(a/n),l.setDuration(s),this.moveMainEditorWidgetCanvasToModal({width:a,height:n}),l.setUpscalerSize((0,o.xV)(l.aspectRatio,1080)),l.setFrameSize((0,o.xV)(l.aspectRatio,480)),l.setHighlightFrameSize((0,o.xV)(l.aspectRatio,240)),l.setUploadMaterial(null),l.setIsOpeningGraphic(!1),l.setIsSettingCover(!1),l.setHighlightParam({candidateFrameList:[],selectedIndex:0,loading:!1,inited:!1}),this.startVideoSelect().then(()=>{this.getHighlightFrame()}),this._prevProgress=this._mainEditorWidgetService.playerManager.status.progress,this._mainEditorWidgetService.timelineManager.timelineUI.cursor.setFreeze(!0),l.setSelectType(null!==(t=i.selectType)&&void 0!==t?t:r.UQ.video),this._mainEditorWidgetService.playerManager.activeDefaultPlayer()}startVideoSelect(){return new Promise(async e=>{let t=this._store,i=performance.now();if(t.setVideoParam({inited:!1,loading:!0,frameList:[],getFrameCount:0}),t.setVideoSeekTo(0n),this._isTracksEmpty){let e=(0,o.xV)(t.aspectRatio,60),i=(0,l.o)(e.width,e.height,"black");(0,n.z)(()=>{t.videoParam&&(t.videoParam.frameList=Array(10).fill(i),t.videoParam.getFrameCount=10,t.videoParam.loading=!1)})}else{let e=(0,o.Zw)(t.duration,10,this._hasMatting);await this.safeGetFrame(e,t.frameSize,async i=>{let a=e.findIndex(e=>i.callbackData===e.callbackData),r=await (0,s.AO)(i.imageData,{width:i.width,height:i.height});(0,n.z)(()=>{if(t.videoParam){var e,i;t.videoParam.frameList[a]=r,t.videoParam.getFrameCount=(null!==(i=null===(e=t.videoParam)||void 0===e?void 0:e.getFrameCount)&&void 0!==i?i:0)+1,t.videoParam.loading=!1}})});for(let i=e.length;i<10;i++)(0,n.z)(()=>{if(t.videoParam){var a,r;t.videoParam.frameList[i]=t.videoParam.frameList[e.length-1],t.videoParam.getFrameCount=(null!==(r=null===(a=t.videoParam)||void 0===a?void 0:a.getFrameCount)&&void 0!==r?r:0)+1,t.videoParam.loading=!1}});(0,n.z)(()=>{t.videoParam.inited=!0})}(0,x.N)(this._containerService,{time:performance.now()-i}),e(0)})}async getHighlightFrame(){var e,t,i,a;let r=this._store;if(null===(e=r.highlightParam)||void 0===e?void 0:e.loading)return;if(r.setHighlightParam({inited:!0,loading:!0,candidateFrameList:[],selectedIndex:0}),this._isTracksEmpty||!this._hasVideoSegment){r.highlightErrorSet("empty"),r.highlightLoadingSet(!1);return}r.highlightLoadingSet(!0),r.highlightErrorSet();let n=performance.now(),{draftModifyTime:o}=r;try{await this.getCandidateHighlightFrame();let e=await this._coverApi.imagesHighlightAnalyse({top_k:5,image_base64_list:r.highlightParam.candidateFrameList.map(e=>e.url)});if(!e.ok)throw Error(e.msg);if(o!==r.draftModifyTime)return;let{value:i}=e;(null===(t=i.highlightImageIndex)||void 0===t?void 0:t.length)?(i.highlightImageIndex.sort((e,t)=>e-t),r.highlightListSet(i.highlightImageIndex),r.highlightErrorSet("success")):r.highlightErrorSet("empty")}catch(e){if(o!==r.draftModifyTime)return;r.highlightErrorSet("error")}finally{if(o===r.draftModifyTime){;r.highlightLoadingSet(!1),i=this._containerService,a={time:performance.now()-n},(0,R.K)(i,A,[a])}}}safeGetFrame(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12e4;return new Promise((r,n)=>{let o=this._store,s=e.reduce((e,t)=>({...e,[t.callbackData]:!1}),{}),l=null,d=this._coverPersistenceManager.getFrames(e,t.width,t.height),c=async e=>{if(e.taskId!==d)return;if(!o.visible){null==l||l.dispose(),this._coverPersistenceManager.cancelGetFrames(d),n(Error("get frames error"));return}if(void 0!==s[e.callbackData])s[e.callbackData]=!0,await i(e).catch(e=>n(e)),!Object.values(s).includes(!1)&&(null==l||l.dispose(),this._coverPersistenceManager.cancelGetFrames(d),clearTimeout(u),r(0))};l=this._coverPersistenceManager.onGetFrame(c);let u=setTimeout(()=>{null==l||l.dispose(),this._coverPersistenceManager.cancelGetFrames(d),clearTimeout(u),n(Error("get frames timeout"))},a)})}getCurrVideoFrameFile(){return new Promise((e,t)=>{let i=this._store;if(this._isTracksEmpty){let t=(0,o.xV)(i.aspectRatio,60);e((0,l.o)(t.width,t.height,"black"))}else this.safeGetFrame([(0,o.s4)(i.seekTo)],i.frameSize,async t=>{e(await (0,s.AO)(t.imageData,{width:t.width,height:t.height}))},1e4).catch(e=>t(e))})}getHighlightSelectedFrameFile(){return new Promise((e,t)=>{let i=this._store;this.safeGetFrame([(0,o.s4)(h.pMA.times(i.highlightParam.candidateFrameList[i.highlightParam.selectedIndex].process,1e3,"bigint"))],i.frameSize,async t=>{e(await (0,s.AO)(t.imageData,{width:t.width,height:t.height}))},1e4).catch(e=>t(e))})}seekToSet(e){var t;let i=this._store;if(!!(null===(t=i.videoParam)||void 0===t?void 0:t.inited))i.setVideoSeekTo(e),this._mainEditorWidgetService.playerManager.seek(e)}previewToSet(e,t,i){var a;let r=this._store;if(!!(null===(a=r.videoParam)||void 0===a?void 0:a.inited))(0,n.z)(()=>{r.videoParam.previewTo=e}),this._mainEditorWidgetService.playerManager.seekWithSpeed(e,t,i)}getCandidateHighlightFrame(){var e,t;let i=this._store;if(null===(t=i.highlightParam)||void 0===t?void 0:null===(e=t.candidateFrameList)||void 0===e?void 0:e.length)return Promise.resolve(0);(0,n.z)(()=>{i.highlightParam.candidateFrameList=[]});let a=(0,o.Zw)(i.duration,15,this._hasMatting);return this.safeGetFrame(a,i.highlightFrameSize,async e=>{let t=await (0,s.AO)(e.imageData,{width:e.width,height:e.height});(0,n.z)(()=>{let r=a.findIndex(t=>t.callbackData===e.callbackData);i.highlightParam.candidateFrameList[r]={url:t,process:e.callbackData}})})}closeModal(e){this._mainEditorWidgetService.timelineManager.timelineUI.cursor.setFreeze(!1);let t=this._store,i=this._mainEditorWidgetService.playerManager.status.progress!==this._prevProgress;(()=>{if(!!t.visible)this.recoverCanvasToMainEditorWidget(),t.visible&&i&&this._mainEditorWidgetService.playerManager.seek(this._prevProgress,h.Hqf.seekDone),(0,n.z)(()=>{var e,i,a;t.visible=!1,t.videoCanvas=void 0,null===(i=t.selectFramesForGraphicParams)||void 0===i||null===(e=i.onCancelSelect)||void 0===e||e.call(i),(null===(a=t.highlightParam)||void 0===a?void 0:a.loading)&&(t.highlightParam=void 0)}),this._mainEditorWidgetService.canvasManager.getIsVideoPreview()?this._mainEditorWidgetService.playerManager.activePreviewPlayer():this._mainEditorWidgetService.playerManager.activeDefaultPlayer()})()}async highlightSuperToMd5(){var e=this;let t=await this.getHighlightSelectedFrameFile(),i=async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=await D(e,e._coverApi.createImg({asset_id:t,workspace_id:e._mainDraftService.draftWorkspaceManager.workspaceId,platform:3,params:{...e._store.upscalerSize}}));if(!r.ok){if(a<2)return i(a+1);throw Error(r.msg)}let{md5:n}=r.value.value.taskDetail[0];if(!n){if(a<2)return i(a+1);throw Error("can not get md5")}return n},a=await i(),r=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let t=await (0,k.J)({md5s:[a],fetchRetryOptions:{retryTimes:10,delay:500,waitForFirstRequest:!0},fromWorkspaceId:e._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:e._mainDraftService.draftWorkspaceManager.workspaceId,containerService:e._containerService});if(!t.ok)throw Error(t.msg);return t.value},n=(await r())[0];await new Promise(e=>n.onResourceReady(()=>e(void 0)));let o=(0,g.l)(S._g.UserPhoto,{...n.getModel(),onProgress:n.onModelUpdate,onReady:n.onResourceReady},n.status===f.a.Success);return this._resourceService.add(o.key,o.resource),{materialLifecycle:n,base64:t}}async videoSuperToMd5(){var e=this;let t=await this.getCurrVideoFrameFile(),i=async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=await D(e,e._coverApi.createImg({asset_id:t,workspace_id:e._mainDraftService.draftWorkspaceManager.workspaceId,platform:3,params:{...e._store.upscalerSize}}));if(!r.ok){if(a<2)return i(a+1);throw Error(r.msg)}let{md5:n}=r.value.value.taskDetail[0];if(!n){if(a<2)return i(a+1);throw Error("videoSuperToMd5 createImg api result do not have md5")}return n},a=await i(),r=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let t=await (0,k.J)({md5s:[a],fetchRetryOptions:{retryTimes:10,delay:500,waitForFirstRequest:!0},fromWorkspaceId:e._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:e._mainDraftService.draftWorkspaceManager.workspaceId,containerService:e._containerService});if(!t.ok)throw Error(t.msg);return t.value},n=(await r())[0];await new Promise(e=>n.onResourceReady(()=>e(void 0)));let o=(0,w.GL)(n.getModel(),S._g.UserPhoto);return this._resourceService.add(o.key,o.resource),{materialLifecycle:n,base64:t}}checkIfNeedLogin(){return!!this._accountService.hasLogin||(this._accountService.login({reportParams:{pageEnterFrom:y.d.Cover}}),!1)}async moveMainEditorWidgetCanvasToModal(e){let{canvas:t}=this._mainEditorWidgetService,{width:i,height:a}=t.style;this._canvasOriginStyle={width:i,height:a};let r=e.width/e.height,n=t.width/t.height,o="";if(r===n)o=t.toDataURL();else{let t=this._mainEditorWidgetService.renderManager.getVideoFrames([{time:this._mainEditorWidgetService.playerManager.status.progress,callbackData:Math.round(h.pMA.div(this._mainEditorWidgetService.playerManager.status.progress,1e3))}],e.width,e.height);await new Promise(i=>{let a=this._mainEditorWidgetService.renderManager.onGetFrames(r=>{if(r.taskId===t)try{let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");null==i||i.putImageData(new ImageData(r.imageData,r.width,r.height),0,0),o=t.toDataURL()}finally{null==a||a.dispose(),i()}})})}this._store.visible&&o&&this._mainEditorWidgetService.canvasManager.setPreview({imageUrl:o}),!this._isTracksEmpty&&this._mainEditorWidgetService.playerManager.seek(0n),this._store.setVideoCanvas(t)}recoverCanvasToMainEditorWidget(){this._mainEditorWidgetService.canvas.style.width=this._canvasOriginStyle.width,this._mainEditorWidgetService.canvas.style.height=this._canvasOriginStyle.height,this._mainEditorWidgetService.canvasManager.bindCanvas(this._mainEditorWidgetService.canvas),this._mainEditorWidgetService.canvasManager.resetPreview()}async uploadCoverFile(e){var t;let{workspaceId:i}=this._mainDraftService.draftWorkspaceManager;if(!i)throw Error("workspaceId is undefined");let[a]=await (0,M.E)({files:[e],fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,payinPayoutHelper:this._payinPayoutHelper,containerService:this._containerService,captureCoverAndThumbHelper:this._containerService.createInstance(W.W,{captureImageFrameHelper:this._mainEditorWidgetService.captureImageFrameManager}),fastImportAnalyzeHelper:this._mainEditorWidgetService.fastImportAnalyzeManager});if(this._store.setUploadMaterial(null),!a.ok)throw Error(a.msg);let r=a.value;return this._store.setUploadMaterial({md5:r.md5,status:P.X.Pending,uploadProgress:0,isSupportPreview:null===(t=r.getModel().uploading)||void 0===t?void 0:t.supportPreview}),(0,E.J)(this._containerService,a.value,{action_type:b.jm.CLICK_ADD,material_source:b.O9.LOCAL,position:b.cg.COVER_EDIT,fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId}),new Promise((e,t)=>{r.onDidDone(()=>{var t;let i=r.getModel();this._draftMaterialsService.addToUserGenerated(r,{addFrom:T.a.Upload});let n=(0,g.l)(S._g.UserPhoto,{...i,onProgress:a.value.onModelUpdate,onReady:a.value.onDidDone},!0);if(this._resourceService.add(n.key,n.resource),this._store.setUploadMaterial({materialLifecycle:r,status:P.X.Online}),null===(t=i.uploading)||void 0===t?void 0:t.supportPreview)e(i.md5);else{let t=this._resourceService.get(n.key,S._g.UserPhoto);(0,C.Y2)(t);let a=t.getCoverResourceToken();a.start(),a.onReady(t=>{let{buffer:a}=t;this._store.setUploadMaterial({coverUrl:URL.createObjectURL(new Blob([a])),materialLifecycle:r,status:P.X.Online}),e(i.md5)})}}),r.onTranscodeFailure(()=>{this._store.setUploadMaterial({materialLifecycle:r,status:P.X.TranscodeFailed})}),r.onUploadFailure(()=>{this._store.setUploadMaterial({materialLifecycle:r,status:P.X.UploadFailed})}),r.onModelUpdate(()=>{var e,i,a,n,o,s,l,d,c,u,h,p,_,g,m;let v=r.getModel();switch(v.status){case f.a.Uploading:this._store.setUploadMaterial({coverUrl:null===(e=v.uploading)||void 0===e?void 0:e.coverBlob,status:P.X.Uploading,uploadProgress:null!==(a=null===(i=v.uploading)||void 0===i?void 0:i.progress)&&void 0!==a?a:0});break;case f.a.Uploaded:this._store.setUploadMaterial({status:P.X.Uploading,uploadProgress:1});break;case f.a.UploadFailure:this._store.setUploadMaterial({uploadCode:null===(o=v.uploading)||void 0===o?void 0:null===(n=o.error)||void 0===n?void 0:n.code,status:P.X.UploadFailed}),t(null===(l=v.uploading)||void 0===l?void 0:null===(s=l.error)||void 0===s?void 0:s.msg);case f.a.Transcoding:this._store.setUploadMaterial({coverUrl:null===(d=v.uploading)||void 0===d?void 0:d.coverBlob,status:P.X.Transcoding,transcodeProgress:null!==(u=null===(c=v.transcoding)||void 0===c?void 0:c.progress)&&void 0!==u?u:0});break;case f.a.Transcoded:(null===(h=this._store.uploadMaterial)||void 0===h?void 0:h.status)!==P.X.Online&&this._store.setUploadMaterial({status:P.X.Transcoding,transcodeProgress:1});break;case f.a.TranscodeFailure:this._store.setUploadMaterial({uploadCode:null===(_=v.transcoding)||void 0===_?void 0:null===(p=_.error)||void 0===p?void 0:p.code,status:P.X.TranscodeFailed}),t(null===(m=v.transcoding)||void 0===m?void 0:null===(g=m.error)||void 0===g?void 0:g.msg)}})})}async addCoverToGraphic(){let e;let{selectType:t,cover:i,selectFramesForGraphicParams:a}=this._store;switch(t){case r.UQ.highlight:{let{materialLifecycle:t}=await this.highlightSuperToMd5();e=t.md5;break}case r.UQ.video:{let{materialLifecycle:t}=await this.videoSuperToMd5();e=t.md5;break}case r.UQ.staticCover:case r.UQ.upload:break;default:(0,C.bP)(t)}e&&a.onSelectFrame(e),this.closeModal(!0)}async setStaticCoverWithoutEditor(){let e;let{selectType:t,uploadMaterial:i}=this._store,a=performance.now();switch(t){case r.UQ.upload:(0,C.Y2)(null==i?void 0:i.materialLifecycle),e=null==i?void 0:i.materialLifecycle;break;case r.UQ.highlight:e=(await this.highlightSuperToMd5()).materialLifecycle;break;case r.UQ.video:e=(await this.videoSuperToMd5()).materialLifecycle;break;case r.UQ.staticCover:this.closeModal(!0);return;default:(0,C.bP)(t)}if(!!e)switch(await this._coverPersistenceManager.setStaticCover(e),this.closeModal(),t){case r.UQ.upload:(0,O.T)(this._containerService,{time:performance.now()-a});break;case r.UQ.highlight:(0,U.B)(this._containerService,{time:performance.now()-a});break;case r.UQ.video:(0,L.S)(this._containerService,{time:performance.now()-a})}}constructor(e,t,i,a,r,n,o,s,l){this._store=e,this._coverPersistenceManager=t,this._coverApi=i,this._mainDraftService=a,this._mainEditorWidgetService=r,this._accountService=n,this._containerService=o,this._resourceService=s,this._draftMaterialsService=l,this._modalOpenTime=0,this._isTracksEmpty=!1,this._hasVideoSegment=!1,this._hasMatting=!1,this._canvasOriginStyle={width:"0px",height:"0px"},this._prevProgress=0n,this._payinPayoutHelper=this._containerService.createInstance(F.o),this._uploadMaterialFromLocalManager=this._containerService.createInstance(I.K,{payinPayoutHelper:this._payinPayoutHelper}),this._mainDraftService.dataSdk.onChangeDiff(()=>{this.refreshTracksInfo()}),this.refreshTracksInfo(),this._accountService.onDidLogin(()=>{this._store.setIsLogin(!0)}),this._accountService.onDidLogout(()=>{this._store.setIsLogin(!1)}),this._store.setIsLogin(this._accountService.hasLogin)}}j=(0,a.gn)([(0,a.fM)(3,d.n),(0,a.fM)(4,c.a),(0,a.fM)(5,y.Gw),(0,a.fM)(6,m.t),(0,a.fM)(7,v.c),(0,a.fM)(8,T.D),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===r.ZP?Object:r.ZP,void 0===_.M?Object:_.M,void 0===p.ZP?Object:p.ZP,void 0===d.n?Object:d.n,void 0===c.a?Object:c.a,void 0===y.Gw?Object:y.Gw,void 0===m.t?Object:m.t,void 0===v.c?Object:v.c,void 0===T.D?Object:T.D])],j)},800342:function(e,t,i){i.d(t,{A:function(){return n},Q:function(){return r}});var a,r=((a={})[a.Success=0]="Success",a);class n{get isParent(){return!this.props.iframe}get sender(){return this.isParent?window.parent:this.props.iframe.contentWindow}dispose(){this.callbacks.clear(),window.removeEventListener("message",this.listener)}on(e,t){let i=this.callbacks.get(e);!i&&(i=[]),i.push({cb:t}),this.callbacks.set(e,i)}off(e,t){let i=this.callbacks.get(e);if(!!i)this.callbacks.set(e,i.filter(e=>e.cb!==t))}once(e,t){let i=this.callbacks.get(e);!i&&(i=[]),i.push({cb:t,once:!0}),this.callbacks.set(e,i)}action(e,t){var i,a;e.actionId=null!==(a=null==t?void 0:t.actionId)&&void 0!==a?a:`action-${this._genActionId()}`,e.requireResponse=!1,null===(i=this.sender)||void 0===i||i.postMessage(JSON.stringify(e),window.location.origin)}awaitAction(e){return new Promise(t=>{var i;e.actionId=`awaitAction-${this._genActionId()}`,e.requireResponse=!0,this.once(e.event,i=>{i.actionId===e.actionId&&t(i.data)}),null===(i=this.sender)||void 0===i||i.postMessage(JSON.stringify(e),window.location.origin)})}_genActionId(){return`${Date.now().valueOf()}-${Math.floor(1e3*Math.random())}`}_handlerMsgFromEditor(e){let t=[];if(this.isParent||e.source===this.sender)try{let i=JSON.parse(e.data),a=this.callbacks.get(i.event);!a&&console.warn("unRegister event:",i),null==a||a.forEach(e=>{e.cb(i),e.once&&t.push(e.cb)}),t.forEach(e=>{this.off(i.event,e)})}catch(t){console.warn("invalid event",e.data)}}constructor(e){this.props=e,this.callbacks=new Map,this.listener=this._handlerMsgFromEditor.bind(this),window.addEventListener("message",this.listener)}}},604325:function(e,t,i){i.d(t,{f:function(){return g}});var a=i(789786),r=i(772322),n=i(670933),o=i(570126),s=i(34562),l=i(218571),d=i(411344),c=i(230689),u=i(937802),h=i(141913);let p=()=>Promise.all([i.e("197"),i.e("8479")]).then(i.bind(i,168138)),_=(0,h.PS)(p);class g{setCoverManagers(e){Object.assign(this._managers,{...e}),this._graphicEditorRef.current&&this._graphicEditorRef.current.forceRender(),this._coverSelectorRef.current&&this._coverSelectorRef.current.forceRender()}render(){requestIdleCallback(()=>{p()}),this._domContainer.render((0,r.jsx)(n.zt,{store:this._store,managers:this._managers,methods:this._methods,children:(0,r.jsxs)(u.$,{instantiationService:this._containerService,children:[(0,r.jsx)(s.Z,{}),(0,r.jsx)(h.Xf,{fallback:null,children:(0,r.jsx)(_,{})})]})}))}constructor(e,t,i,a){this._store=e,this._managers=t,this._methods=i,this._containerService=a,this._graphicEditorRef=l.createRef(),this._coverSelectorRef=l.createRef();let r=window.document.createElement("div");r.id="video-cover-container",window.document.body.append(r),this._domContainer=o.createRoot(r),this.render()}}g=(0,a.gn)([(0,d.Q)(),(0,a.fM)(3,c.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof CoverStore?Object:CoverStore,"undefined"==typeof VideoCoverManagers?Object:VideoCoverManagers,"undefined"==typeof VideoCoverMethods?Object:VideoCoverMethods,void 0===c.t?Object:c.t])],g)},519700:function(e,t,i){i.d(t,{L:function(){return _}});var a=i(789786),r=i(87290),n=i(782350),o=i(396190),s=i(290568),l=i(966697),d=i(200247),c=i(596112),u=i(160391),h=i(230982),p=i(375197);class _ extends r.P{_loadVideoStorageExpandPackage(){return Promise.all([i.e("4493"),i.e("7616"),i.e("3838"),i.e("5642"),i.e("4354"),i.e("6237"),i.e("7089"),i.e("2515"),i.e("523"),i.e("6884"),i.e("5883"),i.e("5794"),i.e("7239"),i.e("7754"),i.e("5769"),i.e("1878"),i.e("8989"),i.e("799"),i.e("4355"),i.e("8754"),i.e("6870"),i.e("5340"),i.e("2232"),i.e("2221"),i.e("9147"),i.e("4249"),i.e("7308"),i.e("1381"),i.e("554"),i.e("6068"),i.e("9002"),i.e("241"),i.e("491"),i.e("8331"),i.e("3767"),i.e("6576"),i.e("1927"),i.e("3270"),i.e("1068"),i.e("5679"),i.e("8792"),i.e("8800"),i.e("725"),i.e("5028"),i.e("4585"),i.e("5868"),i.e("1218"),i.e("3654"),i.e("8180"),i.e("605"),i.e("9955"),i.e("4617"),i.e("6926"),i.e("4481")]).then(i.bind(i,690855))}async prefetch(){if(!this._didPrefetch)this._didPrefetch=!0,this._register(this.lifecycleService.onRestored(()=>{(0,h.n)(()=>{this._loadVideoStorageExpandPackage()},{priorityLevel:p.q.IdlePriority})}))}constructor(e,t,i,a,r,n){super(e,t,i,a,r),this.accountService=e,this.workspaceService=t,this.teaAdapterService=i,this.environmentService=a,this.userService=r,this.lifecycleService=n,this._didPrefetch=!1}}_=(0,a.gn)([(0,a.fM)(0,d.D),(0,a.fM)(1,n.W),(0,a.fM)(2,c.w),(0,a.fM)(3,o.Y),(0,a.fM)(4,s.S),(0,a.fM)(5,u.g),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===l.Gw?Object:l.Gw,void 0===n.W?Object:n.W,void 0===c.w?Object:c.w,void 0===o.Y?Object:o.Y,void 0===s.S?Object:s.S,void 0===u.g?Object:u.g])],_)},744628:function(e,t,i){i.d(t,{A:function(){return p}});var a=i(789786),r=i(993757),n=i(461571),o=i(587892),s=i(800788),l=i(699338),d=i(966697),c=i(200247),u=i(639605),h=i(425427);class p extends r.${_init(){this._initPermission(),this._initWebsocket(),this._initDefaultDraftId()}_initPermission(){if(this._injectPermission){var e;let t=window.__get_file_edit_owner__,{permission:i,owner:a}=null!==(e=null==t?void 0:t.data)&&void 0!==e?e:{};i&&"0"!==a&&this._setDraftAllPermission(t.data)}}_initWebsocket(){this._initWebSocketCallbackMap(),this._registerWebSocketCallback()}_initWebSocketCallbackMap(){this._webSocketCallbackList=[{method:u.h1.RoomAcquireEdit,callback:this._onRoomEditPermissionAcquire.bind(this)},{method:u.h1.RoomRemoveEdit,callback:this._onRoomEditPermissionRemove.bind(this)}]}_onRoomEditPermissionAcquire(e){this.initDraftAllPermission(this._draftWorkspaceId),this.setDraftPermission(n.O.editable),this._onWsEditPermissionAcquire.fire(e)}_onRoomEditPermissionRemove(e){this.initDraftAllPermission(this._draftWorkspaceId),this.setDraftPermission(n.O.readonly),this._onWsEditPermissionRemove.fire(e)}_registerWebSocketCallback(){this._webSocketCallbackList.forEach(e=>{let{method:t,callback:i}=e;this._websocketService.registerCallback(t,i)})}_initDefaultDraftId(){var e;this._draftId=null!==(e=this._videoEnvironmentService.draftIdFromUrl)&&void 0!==e?e:""}_setDraftAllPermission(e){let{owner:t,editOwner:i,ownerNickname:a}=e;this._updateDraftOwnerUid(t),this._updateDraftOwnerNickname(a),this._updateDraftEditorUid(i);let r=this._calculateDraftPermission(e);this.setDraftPermission(r.draftPermission),this.updateDraftDuplicatePermission(r.draftDuplicatePermission)}async initDraftAllPermission(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._draftWorkspaceId=e;let t=await this._fetchPermissionInfo();if(!!t)this._setDraftAllPermission(t)}_calculateDraftPermission(e){var t;let{permissions:i}=e,a=n.O.readonly;return(null==i?void 0:i.edit)&&(null==i?void 0:i.view)&&(a=n.O.editable),{draftPermission:a,draftDuplicatePermission:null!==(t=null==i?void 0:i.copy)&&void 0!==t&&t}}async _fetchPermissionInfo(){let{uid:e}=this._accountService.userProfile,t=this._draftId;if(!this._draftWorkspaceId||!e||!t)return;let i=await this._draftPermissionDataService.getDraftPermission({draftId:t,workspaceId:this._draftWorkspaceId});if(i.ok&&"0"!==i.value.owner)return i.value}setDraftPermission(e){let t=e!==this._draftPermission;(!this._draftPermissionInited||t)&&(this._draftPermissionInited=!0,this._draftPermission=e,this._onDraftPermissionChange.fire(e))}updateDraftDuplicatePermission(e){let t=e!==this._draftDuplicatePermission;(!this._draftDuplicatePermissionInited||t)&&(this._draftDuplicatePermissionInited=!0,this._draftDuplicatePermission=e,this._onDraftDuplicatePermissionChange.fire(e))}_updateDraftOwnerUid(e){e!==this._draftOwner&&(this._draftOwner=e,this._onDraftOwnerChange.fire(e))}_updateDraftOwnerNickname(e){this._draftOwnerNickname=e}_updateDraftEditorUid(e){e!==this._draftEditor&&(this._draftEditor=e,this._onDraftEditorChange.fire(e))}getDraftPermission(){return(0,s.ZB)(this._draftPermission),this._draftPermission}getDraftDuplicatePermission(){return(0,s.ZB)(this._draftDuplicatePermission),this._draftDuplicatePermission}getDraftOwner(){return this._draftOwner}getDraftOwnerNickname(){return this._draftOwnerNickname}get isDraftOwner(){let{userProfile:e}=this._accountService;return e.uid===this._draftOwner}get isDraftPermissionInited(){return this._draftPermissionInited}get isDraftDuplicatePermissionInited(){return this._draftDuplicatePermissionInited}getDraftEditor(){return this._draftEditor}setDraftEditor(e){(0,s.ZB)(e),this._updateDraftEditorUid(e)}setDraftOwner(e,t){(0,s.ZB)(e),this._updateDraftOwnerUid(e),this._updateDraftOwnerNickname(t)}setDraftId(e){e!==this._draftId&&(this._draftId=e)}triggerPermissionFlowUpdate(e){this._onDraftPermissionFlowUpdate.fire(e)}constructor(e,t,i,a,r){super(),this._injectPermission=e,this._accountService=t,this._websocketService=i,this._videoEnvironmentService=a,this._draftPermissionDataService=r,this._draftId="",this._draftWorkspaceId="",this._draftOwner="",this._draftOwnerNickname="",this._draftEditor="",this._draftDuplicatePermission=!1,this._draftPermissionInited=!1,this._draftDuplicatePermissionInited=!1,this._webSocketCallbackList=[],this._onDraftOwnerChange=new o.Q,this._onDraftEditorChange=new o.Q,this._onDraftPermissionChange=new o.Q,this._onDraftDuplicatePermissionChange=new o.Q,this._onDraftPermissionFlowUpdate=new o.Q,this._onWsEditPermissionAcquire=new o.Q,this._onWsEditPermissionRemove=new o.Q,this.onDraftOwnerChange=this._onDraftOwnerChange.event,this.onDraftEditorChange=this._onDraftEditorChange.event,this.onDraftPermissionChange=this._onDraftPermissionChange.event,this.onDraftDuplicatePermissionChange=this._onDraftDuplicatePermissionChange.event,this.onDraftPermissionFlowUpdate=this._onDraftPermissionFlowUpdate.event,this.onWsEditPermissionAcquire=this._onWsEditPermissionAcquire.event,this.onWsEditPermissionRemove=this._onWsEditPermissionRemove.event,this._draftPermission=n.O.editable,this._init()}}p=(0,a.gn)([(0,a.fM)(1,c.D),(0,a.fM)(2,u.J0),(0,a.fM)(3,h.rO),(0,a.fM)(4,l.Y),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.O?Object:n.O,void 0===d.Gw?Object:d.Gw,void 0===u.J0?Object:u.J0,void 0===h.rO?Object:h.rO,void 0===l.Y?Object:l.Y])],p)},882685:function(e,t,i){i.d(t,{O:function(){return p}});var a=i(108692),r=i(896413),n=i(937802),o=i(641276),s=i(800788),l=i(426336),d=i(540731),c=i(801497),u=i(218571),h=i(230689);function p(e){let{segment:t,setModalVisible:i,setModalProgress:p,setModalType:_}=e,g=(0,n.G)(h.t),f=(0,n.G)(a.n),m=(0,n.G)(r.a),{segmentSelection:v}=m,{smartToolsManager:y}=m,S=(0,u.useRef)(null),k=(0,u.useCallback)(()=>{i(!1),p(0),_("smartSplit"),S.current=null},[p,_,i]),w=(0,u.useCallback)(()=>{m.timelineManager.timelineUI.toast.normal(c.ZP.t("web_track_toast_no_splitting_point",{},"No scene transitions found")),(0,d.H)(g,{status:"fail",fail_reason:"No scene transitions found"})},[]),M=(0,u.useCallback)(e=>{var t;m.timelineManager.timelineUI.toast.normal(c.ZP.t("web_track_toast_try_later",{},"Something went wrong. Try again later.")),(0,d.H)(g,{status:"fail",fail_reason:null!==(t=null==e?void 0:e.message)&&void 0!==t?t:""})},[]),b=(0,u.useCallback)(()=>{if(!t)return;_("smartSplit"),i(!0),p(0);let e=S.current;(0,s.ZB)(e),e.onCancel(()=>{k()}),e.onProgress(e=>{if(100===e){p(99);return}p(e)}),e.onError(()=>{m.timelineManager.timelineUI.toast.error(c.ZP.t("web_track_toast_no_splitting_point",{},"No scene transitions found")),k()}),e.onSuccess(e=>{try{var i;k();let a=(null!==(i=e.timestamp_us)&&void 0!==i?i:[]).map(e=>BigInt(e));if(a.length>0){let e=a.filter(e=>e>t.sourceTimerange.start&&e<t.sourceTimerange.start+t.sourceTimerange.duration).map(e=>t.reverse?l.pMA.div(t.sourceTimerange.duration-e+t.sourceTimerange.start,t.speed.speed,"bigint")+t.targetTimerange.start:l.pMA.div(e-t.sourceTimerange.start,t.speed.speed,"bigint")+t.targetTimerange.start);if(e.length>0){let i=[];e.map(e=>i.push({segmentId:t.id,splitTime:BigInt(e)})),(0,o.V)(f.dataSdk.onChangeDiff)(e=>{let i=[t.id];e.segment.forEach(e=>{let{item:t,type:a}=e;a===l.C8.ADD&&i.push(t.segment.id)}),v.setSelectedData({segmentIds:i})}),i.sort((e,t)=>Number(t.splitTime-e.splitTime)),f.dataSdk.api.segment.split(i),(0,d.H)(g,{status:"success"})}else w()}else w()}catch(e){M(e)}})},[t,_,i,p,k,m.timelineManager.timelineUI.toast,f.dataSdk.api.segment]),T=(0,u.useCallback)(e=>{var a,r,n;if(t){if(S.current&&S.current.cancel(),m.playerManager.pause(),null==t?void 0:null===(r=t.material)||void 0===r?void 0:null===(a=r.path)||void 0===a?void 0:a.startsWith("blob:")){_("smartSplitPrepare"),i(!0);return}try{let e=y.startVideoSmartSplit(t);S.current=e,b()}catch(e){(0,d.H)(g,{status:"fail",fail_reason:null!==(n=null==e?void 0:e.message)&&void 0!==n?n:""})}}},[m.playerManager,t,_,i,y,b]);return{startSmartSplit:T,cancelSmartSplit:(0,u.useCallback)(()=>{var e;null===(e=S.current)||void 0===e||e.cancel(),(0,d.H)(g,{status:"cancel"}),k()},[k])}}},629524:function(e,t,i){i.d(t,{d:function(){return n}});var a=i(129219),r=i(402655);class n extends r.JT{constructor(e,t,i){super(),this._intelligenceStore=e,this._register(i.onProgress(e=>this._intelligenceStore.actionSegmentIntelligentProgressSet(t,i.source,e))),this._register(i.onSuccess(()=>{this._intelligenceStore.actionSegmentIntelligentProgressSet(t,i.source,100),this._intelligenceStore.actionSegmentIntelligentStatusSet(t,i.source,a.xR.Success)})),this._register(i.onCancel(()=>{this._intelligenceStore.actionSegmentIntelligentProgressSet(t,i.source,0),this._intelligenceStore.actionSegmentIntelligentStatusSet(t,i.source,a.xR.Cancelled)})),this._register(i.onError(()=>{this._intelligenceStore.actionSegmentIntelligentProgressSet(t,i.source,0),this._intelligenceStore.actionSegmentIntelligentStatusSet(t,i.source,a.xR.Error)}))}}},270748:function(e,t,i){i.d(t,{G:function(){return s}});var a=i(271564),r=i(129219),n=i(260963),o=i(813072);class s{get intelligentStore(){return this._intelligentStore}mutableCancelIntelligent(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._smartToolsManager.cancelGamePlay(e,t),this._smartToolsManager.cancelVideoAlgorithm(e,t),this._smartToolsManager.cancelMutableMatting(e,t),this._smartToolsManager.cancelMutableReverse(e,t),this._smartToolsManager.cancelVideoStable(e,t),this._smartToolsManager.cancelPipelineModify(e,t)}getMutableIntermediateSegment(e){return{}}getIntelligentUploadAccept(e){if(!e.segmentId)return"";let t=this._dataSdk.draftView.getAllSegments();return(0,a.CC)(e.segmentId,t)}constructor(e,t,i){this._intelligentStore=e,this._dataSdk=t,this._smartToolsManager=i,(0,n.U5)(()=>{let e=new Set,t=new Set,i=new Set,{segmentIntelligentMap:a}=this._smartToolsManager.intelligenceStore;for(let[n,o]of Object.entries(a)){let a=o.get(r.Sc.Algorithm),s=o.get(r.Sc.Gameplay),l=o.get(r.Sc.Matting),d=o.get(r.Sc.Reverse),c=o.get(r.Sc.Stable),u=o.get(r.Sc.Pipeline);((null==a?void 0:a.status)===r.xR.Running||(null==s?void 0:s.status)===r.xR.Running||(null==l?void 0:l.status)===r.xR.Running||(null==d?void 0:d.status)===r.xR.Running||(null==c?void 0:c.status)===r.xR.Running||(null==u?void 0:u.status)===r.xR.Running)&&t.add(n),((null==a?void 0:a.status)===r.xR.Error||(null==s?void 0:s.status)===r.xR.Error||(null==l?void 0:l.status)===r.xR.Error||(null==d?void 0:d.status)===r.xR.Error||(null==c?void 0:c.status)===r.xR.Error||(null==u?void 0:u.status)===r.xR.Error)&&e.add(n),((null==a?void 0:a.status)===r.xR.Success||(null==s?void 0:s.status)===r.xR.Success||(null==l?void 0:l.status)===r.xR.Success||(null==d?void 0:d.status)===r.xR.Success||(null==c?void 0:c.status)===r.xR.Success||(null==u?void 0:u.status)===r.xR.Success)&&i.add(n)}return{processingSegIds:t,errorSegIds:e,finishSegIds:i}},(e,t)=>{!(0,o.Z)(e.processingSegIds,t.processingSegIds)&&this._intelligentStore.setProcessingSegIds(Array.from(e.processingSegIds)),!(0,o.Z)(e.errorSegIds,t.errorSegIds)&&this._intelligentStore.setErrorSegIds(Array.from(e.errorSegIds)),!(0,o.Z)(e.finishSegIds,t.finishSegIds)&&this._intelligentStore.setFinishSegIds(Array.from(e.finishSegIds))})}}},590798:function(e,t,i){i.d(t,{x:function(){return _},z:function(){return g}});var a=i(789786),r=i(426336),n=i(690613),o=i(800788),s=i(855021),l=i(230689),d=i(129219),c=i(732564),u=i(271564),h=i(538181);let p="ai_matting";function _(e){return e.reverse?e.material.reversePath:e.material.path}class g{updateRenderManager(e){this._renderManager=e}getOrCreateToken(e){(0,o.Y2)((0,r.hey)(e)),(0,o.Y2)(""!==e.material.path);let t=this._cache.getMattingCache(_(e));if(t)return t;let i=this._containerService.createInstance(s.s,e,this._renderManager,this._draftPathStore);return i.onSuccess(()=>{this._cache.setMattingCache(_(e),i)}),i}startMutableMatting(e){var t;let i=e,a=i.material.type;if(this._originalMaterialMap.set(i.id,this._intelligenceStore.idToOriginMaterial[i.id]),a===r.cVg.MetaTypeGif){this._intelligenceStore.actionSegmentIntelligentErrorSet(i.id,{type:d.Sc.Matting,status:d.xR.Error,error:(0,n.wf)(-1,"metaType gif not support")});return}let o=i.id;if(!i)return;let s=i.material.matting||{};if(1>=((null==s?void 0:s.flag)||0))return;null===(t=this._currentRequestMap[i.id])||void 0===t||t.cancel();let l=this.getOrCreateToken(i);if(this._currentRequestMap[i.id]=l,l.status===d.xR.Success)return this._replaceResource(i,l),l;let c=Date.now();return(0,h.Z)(this._containerService,{type:"algorithm",stage:"start",value:p,errorMsg:l.error.msg}),l.onSuccess(()=>{if((0,h.Z)(this._containerService,{type:"algorithm",stage:"success",value:p,costTime:Date.now()-c,errorMsg:l.error.msg}),l.onCancel(()=>{(0,h.Z)(this._containerService,{type:"algorithm",stage:"cancel",value:p,costTime:Date.now()-c,errorMsg:l.error.msg})}),!!(i=this._dataSdk.draftView.getSegmentById(o)))this._replaceResource(i,l)}),l.onError(e=>{(0,h.Z)(this._containerService,{type:"algorithm",stage:"fail",value:p,costTime:Date.now()-c,errorMsg:l.error.msg})}),l}cancelMutableMatting(e,t){!Array.isArray(e)&&(e=[e]),e.forEach(e=>{var i;null===(i=this._currentRequestMap[e])||void 0===i||i.cancel(),t&&this._recoverMutable(e),this._originalMaterialMap.delete(e)}),this._resetAiMatting(e)}_replaceMattingResult(e,t){if(!this._originalMaterialMap.get(e))return;let i=this._dataSdk.draftView.getSegmentById(e);if(!i)return;let a=this._dataSdk.draftView.getDraftIdAndSegById(i.id);if(!!a)this._dataSdk.api.segment.innerReplace({draftId:a.draftId,identifier:{id:i.id,material:{path:i.material.path,matting:{flag:i.material.matting.flag,path:i.material.matting.path}}},substitute:{material:{matting:{flag:1n<<6n|1n,path:t}}}})}async _recoverMutable(e){let t=this._originalMaterialMap.get(e);if(t){let i=await (0,u.jm)(this._dataSdk,this._renderManager,t),a=this._dataSdk.api.batch.batchStart();this._dataSdk.api.template.setMutableVideos(i),t.material.matting.path&&this._dataSdk.api.video.setMatting({segId:e,path:t.material.matting.path}),this._dataSdk.api.batch.batchEnd(a)}}_resetAiMatting(e){e.forEach(e=>{this._intelligenceStore.actionIntelligentReset(e,d.Sc.Matting)})}_replaceResource(e,t){this._replaceMattingResult(e.id,t.product.path)}constructor(e,t,i,a,r,n){this._cache=e,this._dataSdk=t,this._renderManager=i,this._draftPathStore=a,this._intelligenceStore=r,this._containerService=n,this._originalMaterialMap=new Map,this._currentRequestMap={}}}g=(0,a.gn)([(0,a.fM)(5,l.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ProductCache?Object:ProductCache,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===c.zo?Object:c.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IntelligenceStore?Object:IntelligenceStore,void 0===l.t?Object:l.t])],g)},9377:function(e,t,i){i.d(t,{m:function(){return l}});var a=i(789786),r=i(800788),n=i(426336),o=i(230689),s=i(89074);class l{setObjectLock(e,t){return(0,r.Y2)((0,n.hey)(e)&&e.material.type===n.cVg.MetaTypeVideo),this._containerService.createInstance(s.N,e,t,this._draftPathStore)}constructor(e,t){this._draftPathStore=e,this._containerService=t}}l=(0,a.gn)([(0,a.fM)(1,o.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===o.t?Object:o.t])],l)},873361:function(e,t,i){i.d(t,{F:function(){return r}});var a=i(783432);class r{set(e,t){this._getOrCreateSource(e).setToken(t)}get(e){return this._getOrCreateSource(e)}_getOrCreateSource(e){return!this._mapping.has(e)&&this._mapping.set(e,new a.y),this._mapping.get(e)}constructor(){this._mapping=new Map}}},129219:function(e,t,i){i.d(t,{FI:function(){return d},Sc:function(){return s},uG:function(){return l},xR:function(){return c}});var a,r,n,o,s=((a={}).Algorithm="Algorithm",a.Gameplay="Gameplay",a.Matting="Matting",a.Stable="Stable",a.Reverse="Reverse",a.Vc="Vc",a.SmartCrop="SmartCrop",a.Pipeline="Pipeline",a.Split="Split",a.ObjectLock="ObjectLock",a);var l=((r={})[r.MattingVideo=5]="MattingVideo",r[r.MattingPhoto=10]="MattingPhoto",r[r.Reverse=6]="Reverse",r[r.SmartTools=13]="SmartTools",r[r.PipelineVideo=14]="PipelineVideo",r[r.PipelinePhoto=15]="PipelinePhoto",r[r.VC=15]="VC",r);var d=((n={})[n.Video=0]="Video",n[n.Image=1]="Image",n);var c=((o={})[o.Running=0]="Running",o[o.Cancelled=1]="Cancelled",o[o.Error=2]="Error",o[o.Success=3]="Success",o)},910314:function(e,t,i){i.d(t,{B:function(){return d}});var a=i(789786),r=i(426336),n=i(65458),o=i(425427),s=i(108692),l=i(545797);class d{applyToDraft(e){var t;let i=null!==(t=this._tokenEventQueueManager.getFinishedTokenEventQueue(e.id))&&void 0!==t?t:[],[a]=i,{sourceType:r,sourceParams:s}=a;if(r===n.FV.Vc)return;let l=this._mainDraftService.dataSdk.draftView.getDraftIdAndSegById(e.id),d=this._mainDraftService.dataSdk.draftView.getDraftId(),c=(0,o.JY)(this._environmentService)||d!==(null==l?void 0:l.draftId),u=!0,h=this._mainDraftService.dataSdk.api.batch.batchStart();i.forEach(t=>{switch(t.type){case n.FV.Pipeline:u=!c,this._handlePipeline(e,r,s,a.result);break;case n.FV.VocalSeparation:this._handleVocalSeparation(e,t);break;case n.FV.VocalBeautify:this._handleVocalBeautify(e,t);break;case n.FV.Vc:this._handleVc(e,t)}}),this._mainDraftService.dataSdk.api.batch.batchEnd(h,{canUndoRedo:u})}_handlePipeline(e,t,i,a){t===n.FV.Pipeline&&i.enabled?this._pipelineManager.handleSuccess(e,i.toolType,a,!0):t===n.FV.Pipeline&&!i.enabled&&this._pipelineManager.handleEmptyUserAction(e,i.params,!0)}_handleVocalSeparation(e,t){if(!t.token){this._vocalSeparationManager.removeVocalSeparation(e);return}let{mode:i,timeRange:a,product:n}=t.token,[o,s]=null!=a?a:[e.sourceTimerange.start,e.sourceTimerange.duration+e.sourceTimerange.start];this._mainDraftService.dataSdk.api.audio.setVocalSeparation({segmentId:e.id,choice:i===l.gx.HUMAN?r.ZTd.Vocal:r.ZTd.Background,timeRange:new r.tnv({start:o,duration:s-o}),productionPath:n.path})}_handleVocalBeautify(e,t){if(!t.token){this._vocalBeautifyManager.removeVocalBeautify(e);return}let{step:i,timeRange:a,product:n}=t.token,[o,s]=null!=a?a:[e.targetTimerange.start,e.targetTimerange.duration+e.targetTimerange.start];this._mainDraftService.dataSdk.api.audio.setVocalBeautify({segmentId:e.id,enable:!0,timeRange:new r.tnv({start:o,duration:s-o}),ambientSoundLevel:i,productionPath:n.path})}_handleVc(e,t){if(!t.token){this._mainDraftService.dataSdk.api.audio.clearVoiceEffect({segmentId:e.id});return}let{product:i}=t.token,{voiceChange:a}=e,[r]=a;r&&(this._mainDraftService.dataSdk.api.audio.clearVoiceEffect({segmentId:e.id}),this._mainDraftService.dataSdk.api.audio.setVoiceEffect({audioEffectType:r.subType,name:r.name,segmentId:e.id,productionPath:i.path,resourceId:r.resourceId,speakerId:r.speakerId,resourcePath:r.path}))}constructor(e,t,i,a,r,n){this._tokenEventQueueManager=e,this._pipelineManager=t,this._vocalBeautifyManager=i,this._vocalSeparationManager=a,this._mainDraftService=r,this._environmentService=n}}d=(0,a.gn)([(0,a.fM)(4,s.n),(0,a.fM)(5,o.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof TokenEventQueueManager?Object:TokenEventQueueManager,"undefined"==typeof PipelineManager?Object:PipelineManager,"undefined"==typeof VocalBeautifyManager?Object:VocalBeautifyManager,"undefined"==typeof VocalSeparationManager?Object:VocalSeparationManager,void 0===s.n?Object:s.n,void 0===o.rO?Object:o.rO])],d)},263958:function(e,t,i){i.d(t,{J:function(){return l}});var a=i(587892),r=i(690613),n=i(800788),o=i(638336);let s=Object.freeze(function(e){return{dispose(){}}});class l{get error(){return(0,r.ly)()}get onError(){return s}get assetId(){return(0,n.Y2)(this._assetId),this._assetId}execute(){(0,o.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService).then(e=>{this._assetId=e,this._onSuccess.fire()}),setTimeout(()=>{this._onProgress.fire(0)},0)}constructor(e,t,i,r){this._segment=e,this._draftPathStore=t,this._resourceService=i,this._accountService=r,this._onSuccess=new a.Q,this._onProgress=new a.Q,this.onSuccess=this._onSuccess.event,this.onProgress=this._onProgress.event}}},72978:function(e,t,i){i.d(t,{X:function(){return h}});var a=i(860660),r=i(243366),n=i(108692),o=i(426336),s=i(948328),l=i(433140),d=i(420072),c=i(127830);async function u(e,t){let[i,a,r]=e.invokeFunction(e=>[e.get(s.D),e.get(n.n),e.get(l.c)]),{path:u,type:h}=t.material,p=a.draftPathStore.getResourceKeyFromDraftPath(u);if(p){let e,t,a;try{a=i.getMaterialByKey(p)}catch{}switch(h){case o.cVg.MetaTypeVideo:if(a){let{width:e,height:t,size:i=0,subType:r="",duration:n=0}=a;return{materialFormat:r,materialDuration:(1e3*n).toString(),materialResolution:`${e}x${t}`,materialSize:(i/1024).toString()}}if(e=c._g.Video,(t=r.get(p,e))&&(await (0,d.Z)(t)).ok){let{originVideo:e}=t.value,{width:i,height:a,size:r,format:n}=e;return{materialFormat:n,materialDuration:"",materialResolution:`${i}x${a}`,materialSize:(r/1024).toString()}}break;case o.cVg.MetaTypeMusic:if(a){let{size:e=0,subType:t=""}=a;return{materialFormat:t,materialResolution:"",materialSize:(e/1024).toString()}}}}}async function h(e,t){var i,o,s;let{segment:l,time:d,functionName:c,status:h}=t,p=e.invokeFunction(e=>e.get(n.n)),_=(0,a.p8)(l,!1,p),g=await u(e,l);(0,r.x)(e,{duration:d,functionName:c,materialCategory:_.material_category,materialDuration:String(l.targetTimerange.duration/1000n),materialName:_.material_name,materialResolution:null!==(i=null==g?void 0:g.materialResolution)&&void 0!==i?i:"",materialSize:null!==(o=null==g?void 0:g.materialSize)&&void 0!==o?o:"",materialFormat:null!==(s=null==g?void 0:g.materialFormat)&&void 0!==s?s:"",status:h})}},545590:function(e,t,i){i.d(t,{E:function(){return W},U:function(){return L}});var a=i(789786),r=i(587892),n=i(402655),o=i(690613),s=i(208041),l=i(800788),d=i(129219),c=i(896413),u=i(108692),h=i(65458),p=i(920704),_=i(420072),g=i(798184),f=i(230689),m=i(433140),v=i(520313),y=i(200247),S=i(127830),k=i(241254),w=i(817554),M=i(426336),b=i(503914),T=i(638336),I=i(105395),D=i(732564),P=i(254336),F=i(53230),C=i(474572),E=i(122312),x=i(205921),R=i(196769),A=i(198990),O=i(271564),U=i(72978);function L(e,t){return t&&t.path?t:[{path:e.vocalSeparation.productionPath,type:M.cVg.MetaTypeVocalSeparation},{path:(0,M.hey)(e)?e.material.videoAlgorithm.path:"",type:M.cVg.MetaTypeVideo},{path:(0,M.hey)(e)?e.material.reversePath:"",type:M.cVg.MetaTypeVideo},{path:e.material.path,type:e.material.type}].find(e=>e.path)}class W extends n.JT{static generateKey(e,t,i,a){let[r,n]=null!=i?i:[];return`${e.id}_${L(e,a).path}_${t}_${r}_${n}`}static parseKey(e){let[t,i,a,r,n]=e.split("_");return{segmentId:t,path:i,step:Number(a),start:BigInt(r),end:BigInt(n)}}dispose(){this._onProgress.dispose(),this._onError.dispose(),this._onSuccess.dispose(),this._onCancel.dispose(),super.dispose()}get key(){return this._key}get step(){return this._step}get timeRange(){return this._timeRange}get source(){return d.Sc.Vc}get product(){return(0,l.Y2)(this._product),this._product}get status(){return this._job?(0,b.s)(this._job.status):d.xR.Running}get error(){return this._error}cancel(){this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()}async _startJob(){let e;if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;this._tokenStartTime=Date.now(),(0,U.X)(this._containerService,{segment:this._segment,time:0,status:"start",functionName:"voice_beautify"});let t=this._smartToolsService.makeBuilder(),i="";e=(0,T.R5)(this._segment,this._accountService.hasLogin);let a=L(this._segment,this._material);try{a.type===M.cVg.MetaTypeVideoOriginalSound?(i=await this._separateAudio(),e=this._accountService.hasLogin?p.hn.EverPhoto:p.hn.VideoArch):i=a.type===M.cVg.MetaTypeVideo?await this._separateAudio():await (0,T.EZ)(L(this._segment,this._material).path,this._draftPathStore,this._resourceService)}catch(e){var r;this._error=(0,o.wf)(-1,null!==(r=e.message)&&void 0!==r?r:"separateAudio error.")}if(!i){this._onError.fire(this._error);return}let n=(0,O.lr)(k._A.VoiceOptimization);t.createVocalBeautifyTask(i,e,this._step,this._timeRange,n),this._job=t.build(),this._job.onCancel(()=>{(0,U.X)(this._containerService,{segment:this._segment,time:Date.now()-this._tokenStartTime,status:"cancel",functionName:"voice_beautify"}),this._onCancel.fire()}),this._job.onError(e=>{this._error=e,(0,U.X)(this._containerService,{segment:this._segment,time:Date.now()-this._tokenStartTime,status:"fail",functionName:"voice_beautify"}),this._onError.fire(this._error)}),this._job.onProgress(e=>{this.progress=e,this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,l.Y2)(1===e.length),(0,U.X)(this._containerService,{segment:this._segment,time:Date.now()-this._tokenStartTime,status:"success",functionName:"voice_beautify"}),this._onProgress.fire(100),this._downloadAndAddResourceService(e[0])})}_separateAudio(){return new Promise(async(e,t)=>{try{var i,a,r,n,o,s,l,d;let{workspaceId:t}=this._mainDraftService.draftWorkspaceManager||{},c=L(this._segment,this._material).path,u=null!==(n=null!==(r=this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c),S._g.UserVideo))&&void 0!==r?r:this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c),S._g.Video))&&void 0!==n?n:this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c),S._g.UserFile);await (0,_.Z)(u);let h=null!==(s=null!==(o=null===(i=u.getOriginResourceToken)||void 0===i?void 0:i.call(u))&&void 0!==o?o:null===(a=u.getVideoResourceToken)||void 0===a?void 0:a.call(u))&&void 0!==s?s:u.getUserFileResourceToken();await (0,g.x)(h);let{decryptKey:p}=(null==h?void 0:h.value)||{},{buffer:f}=(null==h?void 0:h.value)||{};if(!f)return;let m=new Blob([f],{type:"video/mp4"}),v=(0,A.h)({source:m,fileName:`${u.value.key}_extractor`}),{hasLogin:y}=this._accountService;if(y){let i=await (null===(l=this._veExtractAudioAndUploadMaterialManager)||void 0===l?void 0:l.extractAudioAndUpload({files:[v],fromWorkspaceId:t,decryptKey:p,toWorkspaceId:t,uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),a=null==i?void 0:i[0];if(null==a?void 0:a.ok)a.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this._error)}),a.value.onPrepareFailure(async t=>{e(await this._useFfmpeg(v))}),a.value.onTranscodeFailure(async()=>{e(await this._useFfmpeg(v))}),a.value.onDidDone(()=>{let t=a.value.getModel();e(null==t?void 0:t.assetId)});else{let t=await this._useFfmpeg(v);e(t)}}else{let t=await (null===(d=this._veExtraAudioAndUploadNoSignManager)||void 0===d?void 0:d.upload({files:[v],uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),i=null==t?void 0:t[0];(null==i?void 0:i.ok)?(i.value.onDidTranscode(()=>{let t=i.value.getModel();e(t.vid)}),i.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this._error)}),i.value.onPrepareFailure(async t=>{e(await this._useFfmpeg(v))}),i.value.onTranscodeFailure(async()=>{e(await this._useFfmpeg(v))})):e(await this._useFfmpeg(v))}}catch(e){t(e)}})}_useFfmpeg(e){let{hasLogin:t}=this._accountService,{workspaceId:i}=this._mainDraftService.draftWorkspaceManager;return new Promise(async(a,r)=>{var n,s;if(t){let t=await (null===(n=this._extractAudioAndUploadMaterialManager)||void 0===n?void 0:n.extractAudioAndUpload({files:[e],fromWorkspaceId:i,toWorkspaceId:i,uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),r=null==t?void 0:t[0];(null==r?void 0:r.ok)?(r.value.onDidDone(()=>{let e=r.value.getModel();a(null==e?void 0:e.assetId)}),r.value.onUploadFailure(e=>{this._onError.fire(null!=e?e:this.error)}),r.value.onPrepareFailure(e=>{this._onError.fire(null!=e?e:this.error)}),r.value.onTranscodeFailure(e=>{this._onError.fire(null!=e?e:this.error)})):this._onError.fire((0,o.wf)(-1,"extractor fail"))}else{let t=await (null===(s=this._extraAudioAndUploadNoSignManager)||void 0===s?void 0:s.extractAudioAndUpload({files:[e],uploadReportParams:{action_type:P.jm.VOICE_EFFECT,material_source:P.O9.EXTRA_AUDIO}})),i=null==t?void 0:t[0];(null==i?void 0:i.ok)?(i.value.onDidTranscode(()=>{a(i.value.getModel().vid)}),i.value.onUploadFailure(e=>{this._onError.fire(this.error)}),i.value.onPrepareFailure(e=>{this._onError.fire(null!=e?e:this.error)}),i.value.onTranscodeFailure(e=>{this._onError.fire(null!=e?e:this.error)})):this._onError.fire((0,o.wf)(-1,"extractor fail"))}})}async _downloadAndAddResourceService(e){var t,i,a,r,n,o,s,c,u;let h=[{md5:null!==(n=null===(t=e.cloudData)||void 0===t?void 0:t.md5)&&void 0!==n?n:"",vid:null!==(o=null===(i=e.onlineData)||void 0===i?void 0:i.vid)&&void 0!==o?o:"",url:null!==(s=null===(a=e.onlineData)||void 0===a?void 0:a.url)&&void 0!==s?s:"",key:null!==(c=null===(r=e.onlineData)||void 0===r?void 0:r.key)&&void 0!==c?c:"",resourceId:null!==(u=e.taskId)&&void 0!==u?u:""}].filter(e=>""!==e.md5||""!==e.vid),p=await this._containerService.invokeFunction(w.CH,{list:h},{resourceType:d.uG.VC,isGameplay:!0});if(!p.ok)return p;let _=this._containerService.invokeFunction(w.Jy,p.value,this._draftPathStore);(0,l.Y2)(_.length>=1);let g={url:"",key:""};if(e.cloudData){let e=await (0,w.gF)(this._resourceService,_[0].id);g.url=e.url,g.key=e.key}else e.onlineData&&(g.url=e.onlineData.url,g.key=e.onlineData.key);this._product={path:_[0].path,...g};let f=await this._containerService.invokeFunction(I.P$,this._renderManager,this._product,p.value,_[0].id);if(!f.ok){this._error=f,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}constructor(e,t,i,a,n,l,d,c,u,h,p,_){super(),this._segment=e,this._step=t,this._timeRange=i,this._material=a,this._renderManager=n,this._draftPathStore=l,this._accountService=d,this._smartToolsService=c,this._containerService=u,this._resourceService=h,this._mainEditorWidgetService=p,this._mainDraftService=_,this.progress=0,this._tokenStartTime=Date.now(),this._extractAudioAndUploadMaterialManager=null,this._veExtractAudioAndUploadMaterialManager=null,this._extraAudioAndUploadNoSignManager=null,this._veExtraAudioAndUploadNoSignManager=null,this._onProgress=new r.Q,this._onError=new r.Q,this._onSuccess=new r.Q,this._onCancel=new r.Q,this._cancellation=new s.A,this._error=(0,o.wf)(-1,"voice effect failed!"),this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event;let g=this._containerService.createInstance(R.o);this._extractAudioAndUploadMaterialManager=this._containerService.createInstance(F.Z,{onCreated:()=>{},payinPayoutHelper:g,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._veExtractAudioAndUploadMaterialManager=this._containerService.createInstance(C.C,{onCreated:()=>{},payinPayoutHelper:g,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._extraAudioAndUploadNoSignManager=this._containerService.createInstance(E.d,{onCreated:e=>{let{}=e},payinPayoutHelper:g,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._veExtraAudioAndUploadNoSignManager=this._containerService.createInstance(x.D,{onCreated:()=>{},payinPayoutHelper:g,fastImportHelper:this._mainEditorWidgetService.fastImportAnalyzeManager}),this._key=W.generateKey(this._segment,this._step,this._timeRange,this._material),this._startJob()}}W=(0,a.gn)([(0,a.fM)(6,y.D),(0,a.fM)(7,h.dM),(0,a.fM)(8,f.t),(0,a.fM)(9,m.c),(0,a.fM)(10,c.a),(0,a.fM)(11,u.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Object,void 0===v.Rk?Object:v.Rk,Object,Object,void 0===D.zo?Object:D.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===y.D?Object:y.D,void 0===h.dM?Object:h.dM,void 0===f.t?Object:f.t,void 0===m.c?Object:m.c,void 0===c.a?Object:c.a,void 0===u.n?Object:u.n])],W)},977194:function(e,t,i){i.d(t,{S:function(){return h}}),i(966156),i(784923);var a=i(368100),r=i(498417),n=i(937802),o=i(653890),s=i(238458),l=i(652146),d=i(690613),c=i(801497),u=i(797913);function h(){let e=(0,n.G)(o.h);if((0,n.G)(u.J).getAppConfigurationValue("toolbar.tts.skipCloneVoiceCheck"))return{checkCloneVoiceLeftWords:async()=>(0,d.oW)(!0),checkCloneVoiceLeftWordsWithInfo:async e=>!0,consumerCloneVoiceLeftWords:e=>{}};let t=async t=>{let i=await e.queryVoiceBenefit({benefitCategory:[s.B.CloneVoiceFreeLeft]});if(!i.ok)return i;let{quotaLeft:a}=i.value[s.B.CloneVoiceFreeLeft];return!a||a<(0,l.GE)(t)?(0,d.oW)(!1):(0,d.oW)(!0)},i=async e=>{let i=await t(e);return i.ok?!!i.value||(a.Z.info({title:c.ZP.t("web_voice_copy_text_limit_reached",{},"Character cap reached"),content:c.ZP.t("web_voice_copy_text_limit_reached_characters",{},"You\u2019ve run out of characters that can be read by custom voices for free. You can use other voices to continue reading the text. "),okText:c.ZP.t("web_voice_copy_btn_limit_reached_ok",{},"OK")}),!1):(r.Z.error(c.ZP.t("web_voice_copy_text_record_again_internet",{},"Connect to the internet and try again.")),!1)};return{checkCloneVoiceLeftWords:t,consumerCloneVoiceLeftWords:t=>{e.reportVoiceUsage({usageType:s.B.CloneVoiceFreeLeft,useQuota:(0,l.GE)(t)})},checkCloneVoiceLeftWordsWithInfo:i}}}}]);