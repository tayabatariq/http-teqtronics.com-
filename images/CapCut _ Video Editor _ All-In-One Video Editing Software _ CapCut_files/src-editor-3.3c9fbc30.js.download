"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["7178"],{739921:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","panel-container":"panel-container-R2S9Hf",panelContainer:"panel-container-R2S9Hf","brand-entry-skeleton":"brand-entry-skeleton-bb4IiU",brandEntrySkeleton:"brand-entry-skeleton-bb4IiU","rows-skeleton-container":"rows-skeleton-container-vN53Fj",rowsSkeletonContainer:"rows-skeleton-container-vN53Fj","brand-panel-skeleton":"brand-panel-skeleton-fpL3R2",brandPanelSkeleton:"brand-panel-skeleton-fpL3R2","brand-panel-header-skeleton":"brand-panel-header-skeleton-DS_qKr",brandPanelHeaderSkeleton:"brand-panel-header-skeleton-DS_qKr","brand-panel-skeleton-divider":"brand-panel-skeleton-divider-UyiZyj",brandPanelSkeletonDivider:"brand-panel-skeleton-divider-UyiZyj"}},656596:function(){},182517:function(e,t,i){i.d(t,{Z:function(){return a}});let a={jumpModeDuration:"100ms",mutableInnerPadding:"2px",mutableBtnIconSize:"16px",mutableBtnPaddingHorizontal:"8px",responsivePaddingHorizontal:"6px",spriteZIndex:"1",borderRadiusSeg:"8px"}},676693:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px"}},718726:function(){},625184:function(){},370109:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-IoDqTf",entryContainer:"entry-container-IoDqTf","view-box":"view-box-welAim",viewBox:"view-box-welAim",initializing:"initializing-NmOzTP",hidden:"hidden-Y6w1Sq",favorViewBox:"favorViewBox-YDmJTn"}},915123:function(e,t,i){i.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-mkIjtY",entryContainer:"entry-container-mkIjtY","view-box":"view-box-BYeodh",viewBox:"view-box-BYeodh",hidden:"hidden-Yvpc3m",initializing:"initializing-YuuqPi","tags-wrapper":"tags-wrapper-EPHyEC",tagsWrapper:"tags-wrapper-EPHyEC",tags:"tags-LKQUhA","fav-bar":"fav-bar-XAhurT",favBar:"fav-bar-XAhurT","search-bar":"search-bar-T8SV93",searchBar:"search-bar-T8SV93","view-box-category":"view-box-category-SoBMi5",viewBoxCategory:"view-box-category-SoBMi5","scroll-container":"scroll-container-KKagwk",scrollContainer:"scroll-container-KKagwk"}},528811:function(){},811900:function(){},431357:function(e,t,i){i.d(t,{R:function(){return _}});var a=i(789786),r=i(16526),n=i(254336),o=i(690613),s=i(800788),d=i(783122),l=i(273238),c=i(825686),u=i(230689),h=i(966697),p=i(21961);class _{async getOrCreateThirdpartyHelper(e,t,i){if(!this._capcutAccountService.hasLogin)return this._capcutAccountService.login({reportParams:{pageEnterFrom:t.pageEnterFrom}}),(0,o.wf)(-1,"no login");(0,s.ZB)(e,"un expect undefined for workspaceId when login");let a=`${e}-${JSON.stringify(i)}`,r=this._thirdpartyUploaderMap.get(a);if(r)return(0,o.oW)(r);let n=await this._initHelper(e,i);return this._thirdpartyUploaderMap.set(a,n),(0,o.oW)(n)}async _initHelper(e,t){let{_options:i}=this,a=await this._payinPayoutService.getInstance(e),o=(await this._idleThirdpartyUploadService.getInstance()).getOrCreateUploader(`${this._uploaderUniqueId}-${e}-${JSON.stringify(t)}`,{draftId:i.draftId,workspaceId:e,acceptMime:i.acceptMime,multiple:i.multiple,showTips:i.showTips,currentPage:i.currentPage,toolType:i.toolType,accept:i.accept,videoTypeId:null==t?void 0:t.videoTypeId,expandModalInstance:a,countLimit:i.countLimit,maxUploadSize:i.maxUploadSize,validateMaxUploadSize:i.validateMaxUploadSize});return o.onAddUploadFile(a=>{var s,l;let c=(0,r.J)({tasks:[a],fromWorkspaceId:e,toWorkspaceId:e,thirdpartyUploader:o,containerService:this._containerService,payinPayoutHelper:this._options.payinPayoutHelper}),u={[d.b.GOOGLE_DRIVE]:n.O9.GOOGLE_DRIVE,[d.b.DROPBOX]:n.O9.DROP_BOX,[d.b.SHOPIFY]:n.O9.SHOPIFY,[d.b.TTLIVE]:n.O9.TTLIVE}[a.platform]||"";for(let a of(null===(s=i.onBeforeCreated)||void 0===s||s.call(i,c,u),c))null===(l=i.onCreated)||void 0===l||l.call(i,{directoryNodeType:p.t.File,material:a,fromWorkspaceId:e,uploadReportParams:Object.assign({},t,{material_source:u})})}),o}constructor(e,t,i,a,r,n){this._options=e,this._idleThirdpartyUploadService=t,this._userMaterialsService=i,this._capcutAccountService=a,this._containerService=r,this._payinPayoutService=n,this._uploaderUniqueId=`upload-material-manager-${Date.now().valueOf()}-${Math.floor(1e3*Math.random())}`,this._thirdpartyUploaderMap=new Map}}_=(0,a.gn)([(0,a.fM)(1,d.E),(0,a.fM)(2,l.b),(0,a.fM)(3,h.Gw),(0,a.fM)(4,u.t),(0,a.fM)(5,c.sX),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUploadMaterialFromThirdparty?Object:IUploadMaterialFromThirdparty,void 0===d.E?Object:d.E,void 0===l.b?Object:l.b,void 0===h.Gw?Object:h.Gw,void 0===u.t?Object:u.t,void 0===c.sX?Object:c.sX])],_)},848784:function(e,t,i){i.d(t,{c:function(){return a}});let a=(e,t)=>{let i;let a={max:.9,...t||{}},r=Date.now(),n=!1,o=()=>{if(n)return;let t=Math.min(Math.floor((Date.now()-r)/e*100)/100,a.max);i!==t&&(i=t,a.onprogress(t)),t>=a.max?n=!0:window.requestAnimationFrame(o)};return window.requestAnimationFrame(o),()=>{n=!0}}},468101:function(e,t,i){i.d(t,{l:()=>g,J:()=>_});var a=i("789786"),r=i("587892"),n=i("402655"),o=i("271697"),s=i("690613"),d=i("763832"),l=i("247235"),c=i("461571"),u=i("613069"),h=i("197238");class p extends n.JT{getCommittingTask(){return this.committingTask}getWaitingQueue(){return this.waitingQueue}isEmpty(){return!this.committingTask&&!this.waitingQueue.length}add(e){if(this.waitingQueue.push(e),!this.committingTask){this.moveWaitingDraftToCommitting();return}this.draftQueueChange()}clear(){this.committingTask=null,this.waitingQueue=[],this.draftQueueChange()}moveWaitingDraftToCommitting(){var e;let t=null!==(e=this.waitingQueue.shift())&&void 0!==e?e:null;this.committingTask=t,this.draftQueueChange()}initListeners(){let{onError:e,onSuccess:t}=this.options.saveManagerEvent;e(this.handleSaveError),t(this.handleSaveSuccess)}draftQueueChange(){this._onDraftQueueChange.fire(this.committingTask,this.waitingQueue)}updatePackageId(e){var t;null===(t=this.committingTask)||void 0===t||t.setPackageId(e),this.waitingQueue.forEach(t=>{null==t||t.setPackageId(e)}),this.draftQueueChange()}constructor(e){super(),this.options=e,this.committingTask=null,this.waitingQueue=[],this._onDraftQueueChange=this._store.add(new r.Q),this.onDraftQueueChange=this._onDraftQueueChange.event,this.handleSaveError=e=>{var t,i,a;(null===(t=e.cause)||void 0===t?void 0:t.code)!=="ERR_NETWORK"&&(null===(i=e.cause)||void 0===i?void 0:i.code)!=="ECONNABORTED"&&(null===(a=e.cause)||void 0===a?void 0:a.ret)!=="2006"&&e.code!==h.pY.TimedOut&&this.clear()},this.handleSaveSuccess=e=>{let[,t]=e.pair();this.updatePackageId(t),this.moveWaitingDraftToCommitting()},this.initListeners()}}let _="0";class g extends n.JT{get saveState(){return this._saveState}get packageId(){return this.getPackageId()}set packageId(e){this.setPackageId(e)}get isEmptyPackage(){return this.getPackageId()===_}isSaving(){return this._saveState===l.Z.SAVING}needSave(){return!this.draftSaveTaskQueue.isEmpty()||this._needSaveAgain||this._saveState===l.Z.PREPARE||this._saveState===l.Z.SAVING||this._saveState===l.Z.FAIL}setPackageId(e){this._setPackageId(e),this.draftSaveTaskQueue.updatePackageId(e)}generateSaveTask(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t=arguments.length,i=Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];let r=this._latestSaveTask;return this._latestSaveTask=new Promise(async t=>{await r,this.startSaveTimestamp=Date.now();let a=this._check();if(!a.ok){0===a.code&&this._onBeforeTrySave.fire(),t((0,s.wf)(l.Z.FAIL,a.msg));return}this._onBeforeTrySave.fire(),e&&this.draftSaveTaskQueue.clear();let n=await this._generateDraftSaveTask(...i);n.ok&&(n.value.setPackageId(this.getPackageId()),this.draftSaveTaskQueue.add(n.value)),this.saveDraft(),t(n)}),this._latestSaveTask}async saveDraft(){var e;if(this._saveState===l.Z.SAVING||this.draftSaveTaskQueue.isEmpty())return(0,s.ly)();let t=this.draftSaveTaskQueue.getCommittingTask();if(!t&&(this.draftSaveTaskQueue.moveWaitingDraftToCommitting(),t=this.draftSaveTaskQueue.getCommittingTask()),t.getIsNeedCheck()){let e=this._check();if(!e.ok)return(0,s.wf)(l.Z.FAIL,e.msg)}this._needSaveAgain=!1,this._saveState=l.Z.SAVING,this._onSaving.fire();let i=await this._doSave(t);if(!i.ok&&this._checkNeedRetry(i)){if(await (0,d._)(2*this._nextSaveTimeout),this._store.isDisposed)return i;i=await this._doSave(t)}return this._store.isDisposed?i:(i.ok?(this._saveState=l.Z.SUCCESS,this._onSuccess.fire(i),!this.draftSaveTaskQueue.isEmpty()&&this._register((0,o.r)(()=>{this.saveDraft()},this._nextSaveTimeout))):(this._saveState=l.Z.FAIL,this._onError.fire(i)),null===(e=t.notifyComplete)||void 0===e||e.call(t,i),i)}async saveAsNewDraft(e){let t=await this._doSaveAsNew(e);return t.ok?this._onSuccess.fire(t):this._onError.fire(t),t}_checkNeedRetry(e){return!1}_check(){return this._permissionService.getDraftPermission()===c.O.readonly?(0,s.wf)(l.Z.FAIL,"draft is readonly"):this._canDraftSave()}constructor(e){super(),this._permissionService=e,this._saveState=l.Z.IDLE,this._needSaveAgain=!1,this._onBeforeTrySave=this._store.add(new r.Q),this.onBeforeTrySave=this._onBeforeTrySave.event,this._onSaving=this._store.add(new r.Q),this.onSaving=this._onSaving.event,this._onError=this._store.add(new r.Q),this.onError=this._onError.event,this._onSuccess=this._store.add(new r.Q),this.onSuccess=this._onSuccess.event,this.draftSaveTaskQueue=new p({saveManagerEvent:{onError:this.onError.bind(this),onSuccess:this.onSuccess.bind(this)}}),this._nextSaveTimeout=1500,this._maxSaveRetryTime=5,this.startSaveTimestamp=0}}g=(0,a.gn)([(0,a.fM)(0,u.H),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===u.H?Object:u.H])],g)},493359:function(e,t,i){i.d(t,{KL:function(){return s},Po:function(){return o},wW:function(){return n}});var a=i(173888),r=i(426020);function n(e){return e.find(e=>e.status===a.a.Sync2UserMaterialFailure?e:null)}function o(e){for(let t of e)if(t.status===a.a.Syncing2UserMaterial)return!0;return!1}function s(e){return e.sourceType===r.ov.EverCloud&&(e.status===a.a.Success||e.status===a.a.Transcoding||e.status===a.a.TranscodeFailure||e.status===a.a.Transcoded)||!1}},989611:function(e,t,i){i.d(t,{N:function(){return d}});var a=i(426020),r=i(599735),n=i(701004),o=i(19538),s=i(339098);function d(e){let{data:t}=e,i=(0,s.O)(e.containerService,e.notificationGenerator);return t.map(t=>{let s=(0,n.F)({data:{md5:t.md5,decryptKey:t.decryptKey,url:t.url,decryptType:t.decryptType},fileType:t.fileType});return e.containerService.createInstance(o.x,{data:{sourceType:a.ov.PublicSpace,uri:t.uri,url:t.url,key:t.key,md5:t.md5,size:t.size,...s},addModelToDraft:(0,r.s)(e.containerService),notificationService:i})})}},550535:function(e,t,i){i.d(t,{J:function(){return s}});var a=i(690613),r=i(211820),n=i(110494),o=i(273238);async function s(e){let t=await e.containerService.invokeFunction(t=>{let i=t.get(o.b);return(0,n.W)({fetchRetryOptions:e.fetchRetryOptions,workspaceId:e.fromWorkspaceId,md5s:e.md5s,userMaterialService:i})});if(!t.ok)return t;let i=t.value.map(t=>(0,r.Q)(t,{packageDelta:e.packageDelta,fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,payinPayoutHelper:e.payinPayoutHelper,containerService:e.containerService,addToUserGenerated:e.addToUserGenerated}));return(0,a.oW)(i)}},986824:function(e,t,i){i.d(t,{I:function(){return u}});var a=i(593642),r=i(587892),n=i(402655),o=i(690613),s=i(800788),d=i(173888),l=i(903375),c=i(820193);class u extends n.JT{get id(){return this._id}get _notificationService(){return this._options.notificationService}get fromWorkspaceId(){return this._fromWorkspaceId}get toWorkspaceId(){return this._toWorkspaceId}get fromFolderId(){return this._fromFolderId}get toFolderId(){return this._toFolderId}get hasBeenRemoved(){return this._hasBeenRemoved}_updateFromWorkspaceId(e){this._fromWorkspaceId=e}_updateToWorkspaceId(e){this._toWorkspaceId=e}_updateFromFolderId(e){this._fromWorkspaceId=e}_updateToFolderId(e){this._toFolderId=e}cancelUpload(){this.dispose()}delete(){return this._onDidDelete.fire(),this.dispose(),Promise.resolve((0,o.ly)())}get status(){return this._status}updateToWorkspaceId(e){var t;if(!this.hasBeenRemoved&&this.toWorkspaceId!==e){if(this._updateToWorkspaceId(e),null===(t=this.onAfterUpdateToWorkspaceId)||void 0===t||t.call(this),this.fromWorkspaceId!==this.toWorkspaceId)switch(this.status){case d.a.Success:case d.a.WaitForSync2UserMaterial:this._updateStatus(d.a.WaitForSync2UserMaterial),this.sync2UserMaterial();break;case d.a.Syncing2UserMaterial:case d.a.Sync2UserMaterialFailure:this.cancelSync2UserMaterial(),this._updateStatus(d.a.WaitForSync2UserMaterial),this.sync2UserMaterial()}}}updateToWorkspaceIdAndFolderId(e){let{workspaceId:t,folderId:i}=e;if(this.hasBeenRemoved||this.toFolderId===i)return;if(this._updateToFolderId(i),this.fromFolderId!==this.toFolderId)this.updateToWorkspaceId(t)}onAfterUpdateToWorkspaceId(){}_fireModelUpdate(){!this._hasBeenMd5Setted&&this.md5&&(this._hasBeenMd5Setted=!0,this._onDidMd5Set.fire()),this._onModelUpdate.fire(this.getModel())}addModelToDraft(e){return this._options.addModelToDraft(e)}dispose(){this._hasBeenRemoved=!0,this._onDidRemove.fire(),super.dispose()}_genSyncResultChecker(){let e=this.fromWorkspaceId,t=this.toWorkspaceId;return()=>e===this.fromWorkspaceId&&t===this.toWorkspaceId}_fireResourceReady(){this._onResourceReady.fire()}constructor(e){super(),this._options=e,this._hasBeenFireResourceReady=!1,this._hasBeenMd5Setted=!1,this._hasBeenRemoved=!1,this._status=d.a.Unknown,this._onDidMd5Set=this._store.add(new r.Q),this.onDidMd5Set=e=>{if(!this.md5)return this._onDidMd5Set.event(e);let t=!1;return setTimeout(()=>{if(!t)e()}),{dispose:()=>{t=!0}}},this._onPrepareStart=this._store.add(new r.Q),this.onPrepareStart=this._onPrepareStart.event,this._onDidPrepare=this._store.add(new r.Q),this.onDidPrepare=this._onDidPrepare.event,this._onPrepareFailure=this._store.add(new r.Q),this.onPrepareFailure=e=>{let t=!1;this.status===d.a.PrepareFailure&&setTimeout(()=>{var i;if(!t)e(null===(i=this.getModel().preparing)||void 0===i?void 0:i.error)});let i=this._onPrepareFailure.event(e);return{dispose:()=>{t=!0,i.dispose()}}},this._onUploadStart=this._store.add(new r.Q),this.onUploadStart=this._onUploadStart.event,this._onDidCancelUpload=this._store.add(new r.Q),this.onDidCancelUpload=this._onDidCancelUpload.event,this._onUploadFailure=this._store.add(new r.Q),this.onUploadFailure=e=>{let t=!1;this.status===d.a.UploadFailure&&setTimeout(()=>{var i;if(!t)e(null===(i=this.getModel().uploading)||void 0===i?void 0:i.error)});let i=this._onUploadFailure.event(e);return{dispose:()=>{t=!0,i.dispose()}}},this._onDidUpload=this._store.add(new r.Q),this.onDidUpload=e=>{if(!(0,l.p)(this))return this._onDidUpload.event(e);let t=!1;return setTimeout(()=>{if(!t)e()}),{dispose:()=>{t=!0}}},this._onTranscoding=this._store.add(new r.Q),this.onTranscoding=this._onTranscoding.event,this._onDidTranscode=this._store.add(new r.Q),this.onDidTranscode=this._onDidTranscode.event,this._onTranscodeFailure=this._store.add(new r.Q),this.onTranscodeFailure=e=>{let t=!1;this.status===d.a.TranscodeFailure&&setTimeout(()=>{var i;if(!t)e(null===(i=this.getModel().transcoding)||void 0===i?void 0:i.error)});let i=this._onTranscodeFailure.event(e);return{dispose:()=>{t=!0,i.dispose()}}},this._onSyncing2UserMaterial=this._store.add(new r.Q),this.onSyncing2UserMaterial=this._onSyncing2UserMaterial.event,this._onDidSync2UserMaterial=this._store.add(new r.Q),this.onDidSync2UserMaterial=this._onDidSync2UserMaterial.event,this._onSync2UserMaterialFailure=this._store.add(new r.Q),this.onSync2UserMaterialFailure=e=>{let t=!1;this.status===d.a.Sync2UserMaterialFailure&&setTimeout(()=>{var i;if(!t)e(null===(i=this.getModel().syncingUserMaterial)||void 0===i?void 0:i.error)});let i=this._onSync2UserMaterialFailure.event(e);return{dispose:()=>{t=!0,i.dispose()}}},this._onModelUpdate=this._store.add(new r.Q),this.onModelUpdate=this._onModelUpdate.event,this._onDidUnDone=this._store.add(new r.Q),this.onDidUnDone=this._onDidUnDone.event,this._onResourceReady=this._store.add(new r.Q),this.onResourceReady=e=>{if(!(0,c.fA)(this.getModel()))return this._onResourceReady.event(e);let t=!1;return setTimeout(()=>{if(!t)e()}),{dispose:()=>{t=!0}}},this._onDidDone=this._store.add(new r.Q),this.onDidDone=e=>{let t=this._onDidDone.event(e);if(this.status!==d.a.Success)return t;let i=!1;return setTimeout(()=>{if(!i)e()}),{dispose:()=>{i=!0,t.dispose()}}},this._onDidDelete=this._store.add(new r.Q),this.onDidDelete=this._onDidDelete.event,this._onDidRemove=this._store.add(new r.Q),this.onDidRemove=this._onDidRemove.event,this._updateStatus=(e,t)=>{if(this.hasBeenRemoved||this._status===e)return;let i=this._status;switch(this._status=e,i===d.a.Success&&this._onDidUnDone.fire(),this._fireModelUpdate(),e){case d.a.Preparing:this._onPrepareStart.fire();break;case d.a.Prepared:this._onDidPrepare.fire();break;case d.a.PrepareFailure:this._onPrepareFailure.fire(null==t?void 0:t.errInfo);break;case d.a.Uploading:this._onUploadStart.fire();break;case d.a.Uploaded:this._onDidUpload.fire();break;case d.a.UploadFailure:this._onUploadFailure.fire(null==t?void 0:t.errInfo);break;case d.a.Transcoding:this._onTranscoding.fire();break;case d.a.Transcoded:this._onDidTranscode.fire();break;case d.a.TranscodeFailure:this._onTranscodeFailure.fire(null==t?void 0:t.errInfo);break;case d.a.Syncing2UserMaterial:this._onSyncing2UserMaterial.fire();break;case d.a.Synced2UserMaterial:this._onDidSync2UserMaterial.fire();break;case d.a.Sync2UserMaterialFailure:this._onSync2UserMaterialFailure.fire(null==t?void 0:t.errInfo);break;case d.a.Success:this._fireResourceReady(),this._onDidDone.fire();break;case d.a.WaitForSync2UserMaterial:this._fireResourceReady();break;case d.a.WaitingUpload:break;case d.a.Unknown:(0,s.ss)("AbstractMaterialLifecycle::_updateStatus UserMaterialStatus.Unknown");default:(0,s.bP)(e,"impossible way, not found status")}},this._id=(0,a.Rl)(),this._fromWorkspaceId=this._options.fromWorkspaceId,this._toWorkspaceId=this._options.toWorkspaceId,this._fromFolderId=this._options.fromFolderId,this._toFolderId=this._options.toFolderId}}},268977:function(e,t,i){i.d(t,{A:function(){return s}});var a=i(224360),r=i(173888),n=i(723703),o=i(800788);class s{get _updateStatus(){return this._handler.updateStatus}get preparing(){return this._preparing}get result(){return(0,o.ZB)(this._successResult,"unExpect call function when no success"),this._successResult}bootstrap(e){Object.entries(e.events).forEach(e=>{let[t,i]=e;this._preparing[t]=i}),this._handler=e.handler}prepare(){this._updateStatus(r.a.Preparing);let e=this._ffmpegAdapterService.runTask(a.Q,{file:this._file},{name:this._file.name,outputFormat:"mp3"});e.onProgress(e=>{this._preparing.progress=e,this._handler.onProgress(e)}),e.onFail(e=>{this._preparing.error=e,this._updateStatus(r.a.PrepareFailure,{errInfo:e})}),e.onSuccess(e=>{this._successResult={file:e},this._updateStatus(r.a.Prepared)}),e.start()}dispose(){}constructor(e){this._params=e,this.canRetryPrepare=()=>!!(this._handler.status()===r.a.PrepareFailure&&this._params.file),this._file=e.file,this._ffmpegAdapterService=e.ffmpegAdapterService,this._preparing={progress:0,error:void 0,type:n.U.ExtractAudio}}}},196392:function(e,t,i){i.d(t,{L:function(){return l}});var a=i(999268),r=i(690613),n=i(800788),o=i(173888),s=i(838348),d=i(848784);class l{get _taskId(){return this._params.taskId}get _updateStatus(){return this._params.handler.updateStatus}get _updateModel(){return this._params.handler.updateModel}get transcoding(){return this._transcoding}canRetryTranscode(){return!1}transcode(){return(0,n.Y2)("unSupport retry transcode for video"),Promise.resolve((0,r.wf)(-1,"unSupport retry transcode for video"))}async listenTranscodeResult(){if(!this._mutex.tryLock())return;let e=(0,d.c)(1e4,{onprogress:e=>{this._transcoding&&(this._transcoding.progress=e,this._params.handler.onProgress(e))}});try{this._transcoding={progress:0,onSuccess:this._params.handler.onDidTranscode,error:void 0,onError:this._params.handler.onTranscodeFailure};let e=this._params.userMaterialService.getBaseEvercloud(),t=await e.getVideoAssetTranscodeStatusNoSign(this._taskId),i=await t.done();if("success"===i.status){let e=(0,s.C)(i.data);this._updateModel({key:"vid"in e?e.vid:void 0,...e}),this._updateStatus(o.a.Transcoded)}else this._transcoding.error=(0,r.wf)(-1,"un expect transcode failure"),this._updateStatus(o.a.TranscodeFailure)}catch(e){var t;(null===(t=this._transcoding)||void 0===t?void 0:t.error)&&(this._transcoding.error=(0,r.wf)(-1,e.message)),this._updateStatus(o.a.TranscodeFailure)}finally{e(),this._mutex.unLock()}}constructor(e){this._params=e,this._mutex=new a.L}}},860734:function(e,t,i){i.d(t,{D:function(){return h}});var a=i(999268),r=i(690613),n=i(763832),o=i(800788),s=i(426020),d=i(173888),l=i(314823),c=i(848784),u=i(881866);class h{get _assetId(){return this._params.assetId}get _fromWorkspaceId(){return this._params.fromWorkspaceId}get _updateStatus(){return this._params.handler.updateStatus}get _updateModel(){return this._params.handler.updateModel}get transcoding(){return this._transcoding}canRetryTranscode(){return!1}transcode(){return(0,o.Y2)("unSupport retry transcode for video"),Promise.resolve((0,r.wf)(-1,"unSupport retry transcode for video"))}async listenTranscodeResult(){if(!this._mutex.tryLock())return;let e=(0,c.c)(1e4,{onprogress:e=>{this._transcoding&&(this._transcoding.progress=e,this._params.handler.onProgress(e))}});try{var t,i,a,h,p;let e=this._assetId;this._transcoding={progress:0,onSuccess:this._params.handler.onDidTranscode,error:void 0,onError:this._params.handler.onTranscodeFailure};let c=await this._params.userMaterialService.getEvercloudInstance(this._fromWorkspaceId),_=await c.getVideoAssetTranscodeStatus({id:e}),g=await _.done();if("success"===g.status){let r=(0,l.J)(g.data);!(null===(t=g.data)||void 0===t?void 0:t.audio)&&await Promise.race([Promise.all([(async()=>{let t=await c.getAssetSpirtInfo({id:e});await t.done()})(),(async()=>{let t=await c.getAssetPreviewInfo({id:e});await t.done()})()]),(0,n._)(3e3)]);let h=await this._params.userMaterialService.getMaterialsByIds({workspaceId:this._params.fromWorkspaceId,assetIds:[e]});(0,o.Y2)(h.ok&&(null===(i=h.value)||void 0===i?void 0:i[0]));let{key:p,..._}=null===(a=h.value)||void 0===a?void 0:a[0];this._updateModel(_.fileType===s.YB.Video?{..._,videoTranscodeInfo:r}:{..._,audioTranscodeInfo:r}),(0,u.tF)()&&await (0,u.wO)(),this._updateStatus(d.a.Transcoded),this._updateStatus(d.a.Success)}"error"===g.status&&(this._transcoding.error=(0,r.wf)(null===(h=g.errInfo)||void 0===h?void 0:h.code,null===(p=g.errInfo)||void 0===p?void 0:p.msg),this._updateStatus(d.a.TranscodeFailure)),!(null==g?void 0:g.status)&&(this._transcoding.error=(0,r.wf)(-1,"un expect transcode failure"),this._updateStatus(d.a.TranscodeFailure))}catch(e){this._updateStatus(d.a.TranscodeFailure)}finally{e(),this._mutex.unLock()}}constructor(e){this._params=e,this._mutex=new a.L}}},48824:function(e,t,i){i.d(t,{x:function(){return v}});var a=i(999268),r=i(475590),n=i(690613),o=i(775352),s=i(315401),d=i(426020),l=i(173888),c=i(801497),u=i(948291),h=i(337171),p=i(458906),_=i(70031),g=i(751217),m=i(795160),f=i(881866);class v{get _updateStatus(){return this._handler.updateStatus}get _updateModel(){return this._handler.updateModel}get _delete(){return this._handler.delete}get uploading(){return this._uploading}get _notificationService(){return this._params.notificationService}bootstrap(e){var t,i;Object.entries(e.events).forEach(e=>{let[t,i]=e;this._uploading[t]=i}),this._handler=e.handler,!(null===(t=this._params.uploadParams)||void 0===t?void 0:t.skipTranscode)&&(this._analyzeFileInfo(this._params.file),this._getFileBlobUrl(this._params.file,this._handler.model().mime),this._generateCoverTrigger()),((null===(i=this._params.uploadParams)||void 0===i?void 0:i.skipTranscode)||this._handler.model().fileType===d.YB.File)&&this._handler.updateModel({url:(0,u.S)(this._params.file)})}updateFromWorkspaceId(e){if(this._fromWorkspaceId!==e)(()=>{this._uploadTaskId&&this._params.userMaterialUploadService.cancel(this._uploadTaskId),this._uploadTaskId=void 0,this._updatedAssetId=void 0,this._mutex=new a.L,this._handler.updateStatus(l.a.WaitingUpload)})(),this._fromWorkspaceId=e,this.upload()}canRetryUpload(){return!!(this._handler.status()===l.a.UploadFailure&&this._params.file)}async upload(e){var t,i,a,r;if(!!this._mutex.tryLock()){if(this._handler.status()===l.a.Uploading){this._mutex.unLock();return}if(this._params.uploadSizeChecker){let r=await (null===(t=this._params.uploadSizeChecker)||void 0===t?void 0:t.getSize(this._fromWorkspaceId)),s=this._params.checkUploadFlag&&(null===(i=this._params.uploadParams)||void 0===i?void 0:i.uploadFlag)===o.m5.InvisibleNoOccupation;if(r.ok&&!s&&this._params.file.size>r.value){this._uploading.error=(0,n.wf)(o.H9.Insufficient,"over size from locale"),e?null===(a=this._notificationService)||void 0===a||a.error(c.ZP.t("web_project_toast_not_enough_space",{},"This space doesn\u2019t have enough storage. Try another one.")):this._doWithNotInsufficientSpaceUpload(this._fromWorkspaceId),this._updateStatus(l.a.UploadFailure,{errInfo:this._uploading.error}),this._mutex.unLock();return}this._params.uploadSizeChecker.decrease({workspaceId:this._fromWorkspaceId,size:this._params.file.size})}if(this._uploading.error=void 0,this._updateStatus(l.a.Uploading),this._updatedAssetId){await this._tryFetchUserMaterialAndUpdate(this._updatedAssetId),this._mutex.unLock();return}try{let{file:e}=this._params;(0,f.MI)()&&await (0,f.wO)();let t=await this._params.userMaterialUploadService.upload({...this._params.uploadParams,folderId:this._fromFolderId,file:e,workspaceId:this._fromWorkspaceId,onUploadMetaReady:e=>{e.uploadId&&(this.uploading.uploadId=e.uploadId)},onProgress:e=>{this.uploading.progress=e,this._handler.onProgress(e)},onFinish:t=>{if(!(0,f.qk)()){if(t.ok)this._updatedAssetId=t.value.assetId,this._updateModel({assetId:t.value.assetId}),this._tryFetchUserMaterialAndUpdate(this._updatedAssetId);else{var i,a,r,n,s,d;switch(t.code){case o.H9.Insufficient:this._doWithNotInsufficientSpaceUpload(this._fromWorkspaceId);break;case o.H9.Cancel:console.warn("should be only call when uploading when change space");return;case o.H9.InvalidMaterialName:null===(i=this._notificationService)||void 0===i||i.error(c.ZP.t("web_space_file_name_error",{},"Inappropriate name, please try again"));break;case o.H9.InvalidFormat:null===(a=this._notificationService)||void 0===a||a.error(t.msg);break;case o.H9.NotMatchExtFormat:null===(r=this._notificationService)||void 0===r||r.warning(c.ZP.t("web_alert_toast_not_match",{placeholder0:e.name},`Couldn\u{2019}t upload {placeholder0}. File extension is inconsistent with the file format.`));break;case o.H9.InvalidMaterialInformation:case o.H9.EncodingNotSupport:null===(n=this._notificationService)||void 0===n||n.warning(c.ZP.t("web_alert_toast_not_support",{placeholder0:e.name},`Couldn\u{2019}t upload {placeholder0}. File encoding is not supported.`));break;case o.H9.FolderNotExist:null===(s=this._notificationService)||void 0===s||s.error(c.ZP.t("web_folder_toast_folder_deleted",{},"This folder was deleted"));break;case o.H9.Unknown:default:null===(d=this._notificationService)||void 0===d||d.warning(c.ZP.t("{placeholder0}_upload_failed",{placeholder0:e.name},"upload failed"))}this._uploading.error=t,this._updateStatus(l.a.UploadFailure,{errInfo:t})}this._mutex.unLock()}}});if(!t.ok){this._mutex.unLock(),this._uploading.error=t,this._updateStatus(l.a.UploadFailure,{errInfo:t});return}this._uploading.requestId=t.value.requestId,this._uploadTaskId=t.value.taskId}catch(t){this._mutex.unLock();let e=(0,n.wf)(-1,null!==(r=null==t?void 0:t.message)&&void 0!==r?r:"unexpected failure by calling upload");throw this._uploading.error=e,this._updateStatus(l.a.UploadFailure,{errInfo:e}),t}}}canCancelUpload(){return!!this._uploadTaskId}cancelUpload(){var e,t;this._uploadTaskId&&this._params.userMaterialUploadService.cancel(this._uploadTaskId),null===(e=(t=this._handler).onCancelUpload)||void 0===e||e.call(t),this.dispose()}dispose(){var e;this._uploadTaskId=void 0,this._params=null,null===(e=this._quickImportAnalyzeTask)||void 0===e||e.cancel(),this._quickImportAnalyzeTask=void 0}_waitBlobUrlReady(){return this._waitBlobUrlReadyDefer.promise}async _generateThumbTrigger(){if(!this._params)return;let{captureCoverAndThumbHelper:e}=this._params;if(!e||this._hadGeneratedThumb)return;this._hadGeneratedThumb=!0;let{uploading:t}=this,i=this._handler.model();if(i.fileType===d.YB.Video&&(null==t?void 0:t.isSupportFastImport)&&(null==t?void 0:t.blobUrl)){let a=await (null==e?void 0:e.getThumb({blobUrl:t.blobUrl,fileType:i.fileType,duration:i.duration,size:{width:i.width,height:i.height}}));!(0,m.n)(this._handler.model())&&a.ok&&this._updateModel({thumb:a.value})}}async _generateCoverTrigger(){let{captureCoverAndThumbHelper:e,fastImportAnalyzeHelper:t}=this._params;if(!e||this._hadGeneratedCover){this._uploading.supportPreview=!1;return}this._hadGeneratedCover=!0;let{uploading:i}=this,a=this._handler.model();if([d.YB.Video,d.YB.Image].includes(a.fileType)&&(null==i?void 0:i.originalBlobUrl)){var r,n,o;let s=await (null==e?void 0:e.getCover({blobUrl:i.originalBlobUrl,fileType:a.fileType,mime:null!==(r=a.mime)&&void 0!==r?r:"",filename:a.filename}));if(!s.ok){this._uploading.supportPreview=!1,this._waitBlobUrlReadyDefer.reject("Get blobUrl fail.");return}!(0,g.B)(this._handler.model())&&s.ok&&(this._uploading.coverBlob=null===(n=s.value)||void 0===n?void 0:n.url,this._uploading.supportPreview=!0,this._updateModel({cover:s.value})),(null==t?void 0:t.isImageNeedCapture(a.mime))&&(s.ok?(this._uploading.blobUrl=null===(o=s.value)||void 0===o?void 0:o.url,this._waitBlobUrlReadyDefer.resolve()):this._waitBlobUrlReadyDefer.reject("Get blobUrl fail."))}else this._uploading.supportPreview=!1}async _tryFetchUserMaterialAndUpdate(e){let t=await this._params.userMaterialService.getMaterialsByIds({workspaceId:this._fromWorkspaceId,assetIds:[e],fetchMode:s.$d.WaitForSync});if(!t.ok){let e=(0,n.wf)(h.H.GetDataError,"fetch user material failure");this.uploading.error=e,this._updateStatus(l.a.UploadFailure,{errInfo:e});return}let{duration:i,videoTranscodeInfo:a,audioTranscodeInfo:r,imgTranscodeInfo:o,...d}=t.value[0];this._updateModel(d),this._updateStatus(l.a.Uploaded)}_getFileBlobUrl(e,t){if(this._uploading){var i;this._uploading.originalBlobUrl=(0,u.S)(e),(null===(i=this._params.fastImportAnalyzeHelper)||void 0===i?void 0:i.isImageNeedCapture(t))||(this._uploading.blobUrl=this._uploading.originalBlobUrl,this._waitBlobUrlReadyDefer.resolve())}}_doWithNotInsufficientSpaceUpload(e){(0,p.i)({payinPayoutHelper:this._params.payinPayoutHelper,payScene:_.Mm.UPLOAD,workspaceId:e,uploadFileList:this.uploading.file?[this.uploading.file]:[],onPaySuccess:()=>{var t,i;this.upload(),null===(i=this._params)||void 0===i||null===(t=i.uploadSizeChecker)||void 0===t||t.refresh(e)},onCancel:()=>{var t,i;null===(i=this._params)||void 0===i||null===(t=i.uploadSizeChecker)||void 0===t||t.refresh(e)}})}async _analyzeFileInfo(e){let t=this._params.fastImportAnalyzeHelper;if(!t){this._uploading.isSupportFastImport=!1;return}let i=t.getTask(e);this._quickImportAnalyzeTask=i;let a=await i.done();if(!a.ok){this._uploading.isSupportFastImport=!1;return}this._uploading.isSupportFastImport=!0,a.value.data&&this._updateModel(a.value.data),this._generateThumbTriggerBinder()}constructor(e){var t,i;this._params=e,this._mutex=new a.L,this._hadGeneratedThumb=!1,this._hadGeneratedCover=!1,this._generateThumbTriggerBinder=this._generateThumbTrigger.bind(this),this._generateCoverTriggerBinder=this._generateCoverTrigger.bind(this),this._waitBlobUrlReadyBinder=this._waitBlobUrlReady.bind(this),this._quickImportAnalyzeTask=void 0,this._fromWorkspaceId=this._params.fromWorkspaceId,this._fromFolderId=null!==(i=null===(t=e.uploadParams)||void 0===t?void 0:t.folderId)&&void 0!==i?i:this._params.fromFolderId,this._uploading={generateThumbTrigger:this._generateThumbTriggerBinder,generateCoverTrigger:this._generateCoverTriggerBinder,waitBlobUrlReady:this._waitBlobUrlReadyBinder,isSupportFastImport:!!this._params.fastImportAnalyzeHelper&&void 0,blobUrl:void 0,coverBlob:void 0,progress:0,file:this._params.file},this._waitBlobUrlReadyDefer=(0,r.PQ)()}}},907525:function(e,t,i){i.d(t,{A:function(){return n}});var a=i(999268),r=i(690613);class n{increase(e){let t=this._spaceResetStorage.get(e.workspaceId);if(!!t)t.space+=e.size}decrease(e){let t=this._spaceResetStorage.get(e.workspaceId);if(!!t)t.space-=e.size}async getSize(e){await this._requestSpaceStorageLocker.lock();let t=this._spaceResetStorage.get(e);try{if(t&&Date.now()-t.updateTime<=6e4)return(0,r.oW)(t.space);let i={space:await this._params.userMaterialsService.getBaseEvercloud().resetSpaceStorage(e),updateTime:Date.now()};return this._spaceResetStorage.set(e,i),(0,r.oW)(i.space)}catch(e){return(0,r.wf)(-1,null==e?void 0:e.message)}finally{this._requestSpaceStorageLocker.unLock()}}refresh(e){this._spaceResetStorage.delete(e),this.getSize(e)}constructor(e){this._params=e,this._spaceResetStorage=new Map,this._requestSpaceStorageLocker=new a.L}}},198414:function(e,t,i){i.d(t,{E:function(){return _}});var a=i(789786),r=i(690613),n=i(800788),o=i(273238),s=i(173888),d=i(426020),l=i(31463),c=i(801497),u=i(986824),h=i(458906),p=i(70031);class _ extends u.I{get md5(){return this._data.md5}getModel(){return{...this._data,id:this.id,status:this.status,draftDelta:this._draftDelta,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidDone:this.onDidDone,onDidRemove:this.onDidRemove,syncingUserMaterial:this.syncingUserMaterial}}canRetryPrepare(){return!1}prepare(){(0,n.ss)("should not be called when canRetryUpload is false")}canRetryUpload(){return!1}upload(){(0,n.ss)("should not be called when canRetryUpload is false")}canCancelUpload(){return!1}cancelUpload(){(0,n.ss)("should not be called when canCancelUpload is false")}canRetryTranscode(){return!1}canSync2UserMaterial(){return void 0!==this.toWorkspaceId&&this.fromWorkspaceId!==this.toWorkspaceId}cancelSync2UserMaterial(){this.status===s.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}async sync2UserMaterial(){(0,n.Y2)(this.status!==s.a.Syncing2UserMaterial,"could not call this function before it change to final status");let e=this._genSyncResultChecker();this.syncingUserMaterial={progress:0};try{this._updateStatus(s.a.Syncing2UserMaterial);let{fromWorkspaceId:t,toWorkspaceId:i}=this;if((0,n.Y2)(this._data.sourceType===d.ov.EverCloud),(0,n.ZB)(t),(0,n.ZB)(i),this.toWorkspaceId!==this.fromWorkspaceId){let e=await this._userMaterialService.copyMaterialToWorkspace({fromWorkspaceId:t,toWorkspaceId:i,assetId:this._data.assetId,meta:""});if(!e.ok){this._updateStatus(s.a.Sync2UserMaterialFailure,{errInfo:e}),this.syncingUserMaterial.error=e,this._handleSyncError(e.code),this._reportService.reportDevError("sync-material-from-workspace",this.syncingUserMaterial.error);return}}e()&&(this._updateStatus(s.a.Synced2UserMaterial),this._afterSync2UserMaterial())}catch(t){if(e()){let e=(0,r.wf)(-1,null==t?void 0:t.message);this._updateStatus(s.a.Sync2UserMaterialFailure,{errInfo:e}),this.syncingUserMaterial.error=e}}}transcode(){(0,n.ss)("should not be called when transcode is false")}async delete(e){try{if((0,n.Y2)(this._data.sourceType===d.ov.EverCloud),(0,n.ZB)(this.fromWorkspaceId),!(null==e?void 0:e.onlyDeleteInCache)){let e=await this._userMaterialService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]});if(!e.ok)return e}return await super.delete(),(0,r.ly)()}catch(e){var t;return(0,r.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}_afterSync2UserMaterial(){this._updateStatus(s.a.Success)}_handleSyncError(e){let t=Number(e);if(!this._option.payinPayoutHelper){var i;null===(i=this._notificationService)||void 0===i||i.error(c.ZP.t("web_personal_invite_copy_wrong",{},"Couldn\u2019t copy"));return}if(t===o.F.Insufficient)(0,h.i)({payinPayoutHelper:this._option.payinPayoutHelper,payScene:p.Mm.SYNC,workspaceId:this.toWorkspaceId,onPaySuccess:()=>{this.sync2UserMaterial()}})}updateVideoTranscodeInfo(e){this._data.fileType===d.YB.Video&&(this._data.videoTranscodeInfo=e,this._fireModelUpdate())}constructor(e,t,i){let{data:a,toWorkspaceId:r,fromWorkspaceId:n,fromFolderId:o,toFolderId:d,...l}=e;super({toWorkspaceId:r,fromWorkspaceId:n,fromFolderId:o,toFolderId:d,addModelToDraft:e.addModelToDraft,notificationService:e.notificationService}),this._userMaterialService=t,this._reportService=i,this._addModelToDraftBinder=()=>this.addModelToDraft(this),this._option=l,this._data=a,this._updateFromWorkspaceId(e.fromWorkspaceId),this._updateToWorkspaceId(e.toWorkspaceId),this._draftDelta=e.packageDelta,this.canSync2UserMaterial()?this._updateStatus(s.a.WaitForSync2UserMaterial):this._updateStatus(s.a.Success)}}_=(0,a.gn)([(0,a.fM)(1,o.b),(0,a.fM)(2,l.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof FileMaterialLifecycleParams?Object:FileMaterialLifecycleParams,void 0===o.b?Object:o.b,void 0===l.m?Object:l.m])],_)},67557:function(e,t,i){i.d(t,{N:()=>v});var a=i("789786"),r=i("273238"),n=i("173888"),o=i("426020"),s=i("936243"),d=i("986824"),l=i("690613"),c=i("800788"),u=i("999268"),h=i("458906"),p=i("70031"),_=i("217123"),g=i("110494");class m{get _handler(){return this._params.handler}setToWorkspaceId(e){this._toWorkspaceId=e}canSync2UserMaterial(){return!0}sync2UserMaterial(){return new Promise((e,t)=>{if(this._handler.onSyncing2UserMaterial(),[_.f.Process].includes(this._params.syncTask.status))return(0,l.wf)(-1,"do not call this function before it done");this.syncingUserMaterial.error=void 0,this._fetchMaterialFailure?this._tryFetchUserMaterialAndUpdate():this._params.syncTask.retry()})}_listenSyncResult(){let{syncTask:e}=this._params,t=t=>{let i=null!=t?t:e.value;if(!i&&this._params.handler.status()===n.a.Syncing2UserMaterial){this._handler.onSync2UserMaterialFailure((0,l.wf)(-1,"not found task"));return}if(this._handler.status()!==n.a.Syncing2UserMaterial)return;let a=null==i?void 0:i.assets.find(e=>e.resourceId===this._params.uri);switch((0,c.ZB)(a,`not found sync task: ${this._params.uri}`),a.status){case _.f.Process:this._handler.onSyncing2UserMaterial();break;case _.f.Success:this._md5=a.md5,this._tryFetchUserMaterialAndUpdate();break;case _.f.Failure:default:var r;a.status===_.f.USER_SPACE_NOT_ENOUGH&&(0,h.i)({payinPayoutHelper:this._params.payinPayoutHelper,payScene:p.Mm.SYNC_TEMPLATE,workspaceId:this._toWorkspaceId,onPaySuccess:()=>{var e,t;let i=null===(t=this._params.syncTask)||void 0===t?void 0:null===(e=t.value)||void 0===e?void 0:e.assets.find(e=>e.resourceId===this._params.uri);(null==i?void 0:i.status)!==_.f.Success&&(this.syncingUserMaterial.error=void 0,this.sync2UserMaterial())}}),this.syncingUserMaterial.error=(0,l.wf)(a.status,null!==(r=a.message)&&void 0!==r?r:"unknown error"),this._handler.onSync2UserMaterialFailure(this.syncingUserMaterial.error)}};e.status!==_.f.Process?t():(e.onProgress(e=>{t(e)}),e.onSuccess(()=>{t()}),e.onError(()=>{t()}))}async _tryFetchUserMaterialAndUpdate(){if(this._fetchMaterialFailure=!1,!!this._mutex.tryLock())try{let e=await (0,g.W)({workspaceId:this._toWorkspaceId,md5s:[this._md5],userMaterialService:this._params.userMaterialService,fetchRetryOptions:{delay:1e3,retryTimes:3}});if(this._params.handler.status()!==n.a.Syncing2UserMaterial)return;if(!e.ok){this.syncingUserMaterial.error=(0,l.wf)(-1,"fetch user material failure"),this._fetchMaterialFailure=!0,this._handler.onSync2UserMaterialFailure(this.syncingUserMaterial.error);return}this._params.handler.updateModel({...e.value[0],sourceType:o.ov.EverCloud}),this._handler.onSynced2UserMaterial()}finally{this._mutex.unLock()}}constructor(e){this._params=e,this.syncingUserMaterial={progress:0},this._mutex=new u.L,this._fetchMaterialFailure=!1,this._md5=e.md5,this._toWorkspaceId=e.toWorkspaceId,this._listenSyncResult()}}var f=i("756024");class v extends d.I{onAfterUpdateToWorkspaceId(){var e;if(!!this.toWorkspaceId)null===(e=this._syncTemplateBuildInDataHelper)||void 0===e||e.setToWorkspaceId(this.toWorkspaceId)}get md5(){return this._data.md5}getModel(){var e;return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidRemove:this.onDidRemove,onDidDone:this.onDidDone,status:this.status,syncingUserMaterial:null===(e=this._syncTemplateBuildInDataHelper)||void 0===e?void 0:e.syncingUserMaterial}}canRetryPrepare(){(0,c.ss)("unSupport method")}prepare(){(0,c.ss)("unSupport method")}canRetryUpload(){return!1}upload(){(0,c.ss)("unSupport method")}canCancelUpload(){return!1}cancelUpload(){(0,c.ss)("unSupport method")}canRetryTranscode(){return!1}transcode(){(0,c.ss)("unSupport method")}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncTemplateBuildInDataHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}cancelSync2UserMaterial(){this.status===n.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}async sync2UserMaterial(){if(await this._triggerSyncMaterialFromWorkspaceHelper(),!!this._syncTemplateBuildInDataHelper)this._syncTemplateBuildInDataHelper.sync2UserMaterial()}async delete(e){try{return this._data.sourceType===o.ov.EverCloud&&!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]}),await super.delete(),(0,l.ly)()}catch(e){var t;return(0,l.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}async _triggerSyncMaterialFromWorkspaceHelper(){if(this._syncTemplateBuildInDataHelper)return;(0,c.Y2)(this._data.sourceType===o.ov.PublicSpace,"current material is not from publicSpace");let e=await this._option.syncParams.syncTask;if(!e.ok){f.t.error("[SyncTemplateBuildInMaterialLifecycle]create sync task error");return}this._syncTemplateBuildInDataHelper=new m({uri:this._option.syncParams.uri,syncTask:e.value,toWorkspaceId:this.toWorkspaceId,md5:this.md5,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{model:()=>this.getModel(),status:()=>this.status,onSyncing2UserMaterial:()=>{this._updateStatus(n.a.Syncing2UserMaterial)},onSynced2UserMaterial:()=>{this._updateStatus(n.a.Synced2UserMaterial),this._updateFromWorkspaceId(this.toWorkspaceId),this._updateStatus(n.a.Success)},onSync2UserMaterialFailure:e=>{this._updateStatus(n.a.Sync2UserMaterialFailure,{errInfo:e})},updateModel:e=>this._partialUpdateModel(e)}})}_partialUpdateModel(e){let{key:t,...i}=e;Object.assign(this._data,i)}constructor(e,t,i){super({fromWorkspaceId:void 0,toWorkspaceId:e.toWorkspaceId,addModelToDraft:e.addModelToDraft,fromFolderId:void 0,toFolderId:void 0,notificationService:e.notificationService}),this._option=e,this._userMaterialsService=t,this._mainDraftService=i,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let a=this._option;this._data=a.data,this._updateStatus(n.a.WaitForSync2UserMaterial),this.toWorkspaceId&&this.sync2UserMaterial()}}v=(0,a.gn)([(0,a.fM)(1,r.b),(0,a.fM)(2,s.v),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ISyncTemplateBuildInMaterialLifecycle?Object:ISyncTemplateBuildInMaterialLifecycle,void 0===r.b?Object:r.b,void 0===s.v?Object:s.v])],v)},215518:function(e,t,i){i.d(t,{FW:function(){return s},Lj:function(){return o},Rs:function(){return n}});var a,r=i(293698);var n=((a={})[a.String=0]="String",a[a.Integer=1]="Integer",a);function o(e){let t=(0,r.gO)(),a=0===Object.keys(t).length;if(location.search&&a){let e=r.m4.create(i.g.location.href);(0,r.PZ)(e.getAllQueryParameterValues()),t=(0,r.gO)()}let n=t[e.name];if(n)switch(e.paramType){case 0:default:return n;case 1:return n?function(e){let t=parseFloat(e);return isNaN(t)?0:t}(n):void 0}}function s(e){let t={};return e.forEach(e=>{t[e.name]=o(e)}),t}},339764:function(e,t,i){i.d(t,{d:function(){return r}});var a,r=((a={}).panel="panel",a.floor="floor",a)},97135:function(e,t,i){i.d(t,{y:function(){return o}});var a=i(260963),r=i(908503),n=i(980867);class o{get tasks(){return this._observableData.list}addMaterialLifecycle(e){(0,a.z)(()=>{this._observableData.list.unshift({workspaceId:e.workspaceId,material:(0,n.M)(e.material.getModel())})}),(0,r.M)({material:e.material,onUpdateModel:e=>this._updateMaterialModeByModel(e),onDeleteLifecycle:e=>this._deleteMaterialModel(e)})}_updateMaterialModeByModel(e){(0,a.z)(()=>{let t=this._observableData.list.findIndex(t=>t.material.id===e.id);-1!==t&&(this._observableData.list[t].material=(0,n.M)(e))})}_deleteMaterialModel(e){(0,a.z)(()=>{let t=this._observableData.list.findIndex(t=>t.material.id===e);-1!==t&&this._observableData.list.splice(t,1)})}constructor(){this._observableData=(0,a.LO)({list:[]})}}},666082:function(e,t,i){i.d(t,{u:function(){return T}});var a=i(789786);i(784923);var r=i(498417),n=i(402655),o=i(690613),s=i(800788),d=i(714619),l=i(230689),c=i(127830),u=i(315401),h=i(273238),p=i(260963),_=i(908503),g=i(801497),m=i(985759),f=i(980867),v=i(735244),y=i(21961),S=i(650248);class T extends n.JT{get workspaceId(){return this.observableData.workspaceId}findMaterialsById(e){let t=this._directoryManager.getFileById(e);return t?(0,o.oW)(t.data.getModel()):(0,o.wf)(-1,"not found target")}invokeMaterialLifecycleById(e,t){let i=this._directoryManager.getFileById(e);return i?(t(i.data),(0,o.ly)()):(0,o.wf)(-1,"not found")}backToParentFolder(){this._directoryManager.back()}async fetchMoreFoldersAndMaterials(){await this._directoryManager.fetchMore({currentFolderId:this._directoryManager.currentFolder.id})}async retryFetchMaterials(){await this._bootstrap()}retryMaterial(e){let t=this._directoryManager.getFileById(e);if(!t){r.Z.error(g.ZP.t("web_graphic_request_failure_tips",{},"Something went wrong. Try again later."));return}(0,v.B)(t.data)}openFolder(e){this._directoryManager.open(e.assetId)}async deleteMaterial(e,t){if(!(null==t?void 0:t.forceDelete)){let i=async i=>{let{title:a,content:n}=i;await (0,m.W)({title:a,content:n,okText:g.ZP.t("confirm_deletion",{},"Delete"),onBeforeOk:async()=>{try{let i;if(e.assetType===c.pS.Material?i=await this._directoryManager.deleteFileById(e.id):e.assetType===c.pS.Folder&&(i=await this._directoryManager.deleteFolderById(e.assetId)),i&&!i.ok&&i.code===u.tz.DeleteNotEmptyFolder){r.Z.error(g.ZP.t("web_folder_toast_folder_not_deleted_not_empty",{},"Can\u2019t delete a folder with a file or a subfolder in it"));return}(0,s.Y2)(null==i?void 0:i.ok),!(null==t?void 0:t.forceDelete)&&r.Z.success(g.ZP.t("delete_successfully",{},"Delete Successfully."))}catch(e){if(!(null==t?void 0:t.forceDelete))throw r.Z.error(g.ZP.t("delete_failed",{},"Delete Failed.")),e}},cancelText:g.ZP.t("cancel_web",{},"Cancel")})};e.assetType===c.pS.Material&&await i({title:g.ZP.t("are_you_sure_to_delete_the_selected_material?",{},"Confirm you want to delete the selected items?"),content:g.ZP.t("workspace_delete_desc",{},"Confirm you want to delete this file? Once deleted, it cannot be recovered.")}),e.assetType===c.pS.Folder&&await i({title:g.ZP.t("web_space_folder_delete_title",{},"Delete folder?"),content:g.ZP.t("web_space_folder_delete_des",{},"All items in this folder will be permanently deleted.")})}}cancelUploadMaterial(e){this._directoryManager.deleteFileById(e)}async _bootstrap(){try{if(this._initMutex.isLocked)return;await this._initMutex.acquire(),this._initMaterialsFromDirectory(),await this.fetchMoreFoldersAndMaterials(),(0,p.z)(()=>{this.observableData.isInitialize=!0})}catch(e){(0,p.z)(()=>{this.observableData.isInitialize=!0,this.observableData.isInitializedError=!0})}finally{this._initMutex.release()}}_updateMaterialModeByModel(e){(0,p.z)(()=>{let t=this.observableData.materials.findIndex(t=>t.assetType===c.pS.Material&&t.id===e.id);-1!==t&&(this.observableData.materials[t]=(0,f.M)(e))})}_bindLifecycleAction(e){let t=this._directoryManager.getFileById(e.id),i=(null==t?void 0:t.path)?this._directoryManager.extractParentPath(t.path):void 0;(0,_.M)({material:e,onUpdateModel:e=>{if(i===this._directoryPath)this._updateMaterialModeByModel(e)}})}_listenDirectoryChange(){this._directoryManager.onPathChange(()=>{(0,p.z)(()=>{this._directoryPath=this._directoryManager.currentPath,this.observableData.parentFolder=this._directoryManager.currentFolder.data,this.observableData.isRootFolder=this._directoryManager.root.path===this._directoryPath;let e=[];this._directoryManager.nodesInCurrentPath.forEach(t=>{if(t.type===y.t.File){let i=t.data;this._bindLifecycleAction(i),e.push((0,f.M)(i.getModel()))}else t.type===y.t.Folder&&e.push(t.data)}),this.observableData.materials=e})}),this._directoryManager.onAdd((e,t)=>{(0,p.z)(()=>{e.forEach(e=>{if(!this._isNodeInCurrentFolder(e.path))this.observableData.parentFolder=this._directoryManager.currentFolder.data,this.observableData.isRootFolder=this._directoryManager.root.path===this._directoryPath,this._addDirectoryNodeToMaterials(e,t)})})}),this._directoryManager.onDelete(e=>{if(this._isNodeInCurrentFolder(e.path))return;let t=this.observableData.materials.findIndex(t=>t.assetType===c.pS.Material&&t.id===e.id||t.assetType===c.pS.Folder&&t.assetId===e.id);-1!==t&&this.observableData.materials.splice(t,1)}),this._directoryManager.onFetchMoreParamsChange(()=>{(0,p.z)(()=>{let{isFetchFailure:e,isFetchingData:t,hasMore:i,count:a,offset:r,isFolderInitialize:n}=this._directoryManager.getFetchParams(this._directoryManager.currentFolder.id);this.observableData.isFetchFailure=e,this.observableData.isFetchingData=t,this.observableData.isInitialize=n,this.observableData.fetchParams={hasMore:i,count:a,offset:r}})})}_addDirectoryNodeToMaterials(e,t){(0,p.z)(()=>{if(e.type===y.t.File){let i=e.data;this._bindLifecycleAction(i),(null==t?void 0:t.insertPosition)===y.O.Beginning?this.observableData.materials.unshift((0,f.M)(i.getModel())):this.observableData.materials.push((0,f.M)(i.getModel()))}else(null==t?void 0:t.insertPosition)===y.O.Beginning?this.observableData.materials.unshift(e.data):this.observableData.materials.push(e.data)})}_initMaterialsFromDirectory(){(0,p.z)(()=>{this.observableData.materials=[],this._directoryManager.nodesInCurrentPath.forEach(e=>{this._addDirectoryNodeToMaterials(e)})})}_isNodeInCurrentFolder(e){return this._directoryPath!==this._directoryManager.extractParentPath(e)}constructor(e,t,i){super(),this._params=e,this._containerService=t,this._userMaterialsService=i,this._initMutex=new d.w,this._directoryManager=this._params.directoryManager,this._directoryPath=this._directoryManager.currentPath,this.observableData=(0,p.LO)({isInitialize:!1,isInitializedError:!1,isFetchingData:!1,isFetchFailure:!1,fetchParams:{hasMore:!0,count:30,offset:0},workspaceId:this._params.workspaceId,materials:[],parentFolder:this._directoryManager.currentFolder.data,isRootFolder:this._directoryManager.root.path===this._directoryPath}),this._updateMaterialModeByModelWithThrottle=(0,S.Z)(this._updateMaterialModeByModel,1e3),this._bootstrap(),this._listenDirectoryChange()}}T=(0,a.gn)([(0,a.fM)(1,l.t),(0,a.fM)(2,h.b),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof WorkspaceMaterialsManagerParams?Object:WorkspaceMaterialsManagerParams,void 0===l.t?Object:l.t,void 0===h.b?Object:h.b])],T)},757483:function(e,t,i){i.d(t,{R:function(){return n}});var a=i(587892),r=i(402655);class n extends r.JT{get onFinishExportInSdkIframe(){return this._finishExportAndBackEvent.event}emitFinishExportEventInSdkIframe(e){this._finishExportAndBackEvent.fire(e)}constructor(){super(),this._finishExportAndBackEvent=new a.Q}}},911290:function(e,t,i){i.d(t,{B:function(){return u}});var a=i(789786),r=i(572029),n=i(378481),o=i(782350),s=i(966697),d=i(801497),l=i(622204),c=i(752048);class u extends l.j{fetchData(e){return this._audioDataService.getBrandAudios(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return d.ZP.t("web_space_brandkit_editor_brand_music",{},"Audio")}constructor(e,t,i,a,r){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;(null==o?void 0:o.list)&&(o.list=(0,c.B)(o.list)),super(a,r,n,o),this._brandDataService=t,this._audioDataService=i,this._workspaceService=a,this._capcutAccountService=r,this.setInitialData(null==o?void 0:o.list,s)}}u=(0,a.gn)([(0,a.fM)(1,r.X),(0,a.fM)(2,n.F),(0,a.fM)(3,o.W),(0,a.fM)(4,s.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===r.X?Object:r.X,void 0===n.F?Object:n.F,void 0===o.W?Object:o.W,void 0===s.Gw?Object:s.Gw])],u)},668970:function(e,t,i){i.d(t,{y:function(){return c}});var a=i(789786),r=i(572029),n=i(131829),o=i(782350),s=i(966697),d=i(622204),l=i(801497);class c extends d.j{fetchData(e){return this._backgroundService.getBrandBackgrounds(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return l.ZP.t("web_space_brandkit_editor_brand_history",{},"Backgrounds")}constructor(e,t,i,a,r){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;super(a,r,n,o),this._brandDataService=t,this._backgroundService=i,this._workspaceService=a,this._capcutAccountService=r,this.setInitialData(null==o?void 0:o.list,s)}}c=(0,a.gn)([(0,a.fM)(1,r.X),(0,a.fM)(2,n.k),(0,a.fM)(3,o.W),(0,a.fM)(4,s.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===r.X?Object:r.X,void 0===n.k?Object:n.k,void 0===o.W?Object:o.W,void 0===s.Gw?Object:s.Gw])],c)},622204:function(e,t,i){i.d(t,{j:function(){return p}});var a=i(789786),r=i(155841),n=i(782350),o=i(966697),s=i(866006),d=i(260963),l=i(587892),c=i(690613),u=i(800788),h=i(756024);class p{get value(){return this.observableData.data}setInitialData(e,t){(null==e?void 0:e.length)?(0,d.z)(()=>{this.setBrandList(e),this.observableData.isReady=!0}):new Promise(async e=>{t?await this.loadMoreBrands():await this.getAllBrands(),this.setReady(),e()})}appendBrand(e){!this.observableData.data.find(t=>t.key===e.key)&&((0,d.z)(()=>{this.observableData.data.unshift({...e,hasOperatePermission:this._getBrandOperatePermission(e)}),this.observableData.count++}),this._onDidAddBrand.fire(e.key))}setLoading(e){this.observableData.isLoading=e}setHasMore(e){this.observableData.hasMore=e}setBrandList(e){let t=new Set(this.observableData.data.map(e=>e.key));e.forEach(e=>{!t.has(e.key)&&(this.observableData.data.push({...e,hasOperatePermission:this._getBrandOperatePermission(e)}),t.add(e.key))})}setReady(){(0,d.z)(()=>{this.observableData.isReady=!0})}async loadMoreBrands(){await this._getMoreBrands(this._requestToken)}_setFailure(e){(0,d.z)(()=>{this.observableData.isFailure=e})}async _getMoreBrands(e){if(this._setFailure(!1),this.observableData.isLoading||!this.observableData.hasMore)return;(0,d.z)(()=>{this.setLoading(!0)});let t=await this.fetchData(e);(0,d.z)(()=>{var e;if(this.setLoading(!1),!t.ok){this._setFailure(!0),h.t.error("getMoreBrands error dataservice api fail"),this.setHasMore(!1),this._tryAutoLoadMore();return}let i=t.value,a=null!==(e=i.value.list)&&void 0!==e?e:[];this.setBrandList(a),this.setHasMore(i.hasMore),this._requestToken=i}),this._tryAutoLoadMore()}_tryAutoLoadMore(){if(!!this._getAllSymbol){if(this.observableData.isFailure){if(!(this._getAllFailureCount>=this._getAllFailureMaxCount))return;this._getAllFailureCount++}this._getMoreBrands(this._requestToken).then(()=>{!this.observableData.isFailure&&(this._getAllFailureCount=0)})}}_getBrandOperatePermission(e){if((0,u.Y2)(this._capcutAccountService.hasLogin),this._capcutAccountService.uniqueId===e.userId)return!0;let t=this._workspaceService.workspaceList.find(e=>e.workspace_id===this.workspaceId);return(0,u.ZB)(t),!!(t.role&&[r.eB.Admin,r.eB.Owner].includes(t.role))||!1}constructor(e,t,i,a){var r,n,o;this._workspaceService=e,this._capcutAccountService=t,this._getAllSymbol=!1,this._getAllFailureCount=0,this._getAllFailureMaxCount=3,this._onDidAddBrand=new l.Q,this.onDidAddBrand=this._onDidAddBrand.event,this.observableData=(0,d.LO)({isReady:!1,count:0,data:[],hasMore:!0,isLoading:!1,isFailure:!1}),this.deleteBrandById=async e=>{let t=null;if(await (0,d.z)(()=>Promise.all(e.map(async e=>{let i=this.observableData.data.findIndex(t=>t.key===e);if(-1!==i){let a=await this.deleteBrandResource({workspaceId:this.workspaceId,id:e});(null==a?void 0:a.ok)?(this.observableData.data.splice(i,1),this.observableData.count--):t=a}return null}))),null!==t){var i,a;return(0,c.wf)(null!==(i=null==t?void 0:t.code)&&void 0!==i?i:0,null!==(a=null==t?void 0:t.msg)&&void 0!==a?a:"unknown error")}return(0,c.ly)()},this.deleteBrandByIdSync=e=>{(0,d.z)(()=>e.forEach(e=>{let t=this.observableData.data.findIndex(t=>t.key===e);return -1!==t&&(this.observableData.data.splice(t,1),this.observableData.count--),null}))},this.updateBrandById=async e=>{let t=e.map(e=>this.observableData.data.findIndex(t=>t.key===e.key));if(!t.every(e=>e>-1))return(0,c.wf)(-1,"updateBrandById failure, because one of brand key do not exsist");let i=null;if(await (0,d.z)(()=>Promise.all(t.map(async(t,a)=>{let r={...this.observableData.data[t],...e[a]},n=await this.updateBrandResource({workspaceId:this.workspaceId,id:r.key,title:r.title,color:r.color});(null==n?void 0:n.ok)?this.observableData.data.splice(t,1,r):i=n}))),null!==i){var a,r;return(0,c.wf)(null!==(a=null==i?void 0:i.code)&&void 0!==a?a:0,null!==(r=null==i?void 0:i.msg)&&void 0!==r?r:"unknown error")}return(0,c.ly)()},this.updateBrandByIdSync=e=>{let t=e.map(e=>this.observableData.data.findIndex(t=>t.key===e.key));if(!!t.every(e=>e>-1))(0,d.z)(()=>t.forEach((t,i)=>{let a={...this.observableData.data[t],...e[i]};this.observableData.data.splice(t,1,a)}))},this.getBrandById=e=>this.observableData.data.find(t=>t.key===e),this.getAllBrands=async()=>{this._getAllSymbol=!0,await this._getMoreBrands({workspaceId:this.workspaceId})},this.resourceType=i.resourceType,this.workspaceId=i.workspaceId;let u=!a||a.count>(null===(r=a.list)||void 0===r?void 0:r.length);this._requestToken=new s.yt(void 0,{offset:null!==(o=null==a?void 0:null===(n=a.list[(null==a?void 0:a.list.length)-1])||void 0===n?void 0:n.key)&&void 0!==o?o:"",hasMore:u},{workspaceId:this.workspaceId}),(0,d.z)(()=>{var e;this.observableData.count=null!==(e=null==a?void 0:a.count)&&void 0!==e?e:0,this.observableData.hasMore=u})}}p=(0,a.gn)([(0,a.fM)(0,n.W),(0,a.fM)(1,o.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.W?Object:n.W,void 0===o.Gw?Object:o.Gw,"undefined"==typeof ManagerConfig?Object:ManagerConfig,Object])],p)},668830:function(e,t,i){i.d(t,{n:function(){return u}});var a=i(789786),r=i(572029),n=i(462235),o=i(782350),s=i(966697),d=i(801497),l=i(622204),c=i(752048);class u extends l.j{fetchData(e){return this._photoDataService.getBrandPhotos(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return d.ZP.t("web_space_brandkit_editor_brand_picture",{},"Photo")}constructor(e,t,i,a,r){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;(null==o?void 0:o.list)&&(o.list=(0,c.B)(o.list)),super(a,r,n,o),this._brandDataService=t,this._photoDataService=i,this._workspaceService=a,this._capcutAccountService=r,this.setInitialData(null==o?void 0:o.list,s)}}u=(0,a.gn)([(0,a.fM)(1,r.X),(0,a.fM)(2,n.B),(0,a.fM)(3,o.W),(0,a.fM)(4,s.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===r.X?Object:r.X,void 0===n.B?Object:n.B,void 0===o.W?Object:o.W,void 0===s.Gw?Object:s.Gw])],u)},124394:function(e,t,i){i.d(t,{do:function(){return d}});var a=i(426336),r=i(915208),n=i(127830);let o=e=>n.is.has(e.type)&&e.md5?a.P4R.ensureRootPath(`${(0,r.gM)()}${e.md5}`):a.P4R.ensureRootPath((0,r.uL)(e)),s=new Set([n._g.TextTemplate,n._g.Font,n._g.TextPreset,n._g.TextMotion,n._g.SubtitleTemplate,n._g.TextGlow]),d=e=>s.has(e.type)?o(e):(0,r.uL)(e)},502237:function(e,t,i){i.d(t,{J:function(){return s}});var a=i(772322),r=i(58339),n=i(105789),o=i.n(n);let s=e=>{let{dragging:t,adsorb:i}=e;return(0,a.jsxs)("svg",{className:o()({[r.Z.cursorHdIcon]:!0,[r.Z.dragging]:t,[r.Z.adsorb]:i}),width:"12",height:"18",viewBox:"0 0 12 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("mask",{id:"path-1-inside-1_1578_341598",fill:"white",children:(0,a.jsx)("path",{d:"M0 3C0 1.34314 1.34315 0 3 0H9C10.6569 0 12 1.34315 12 3V11.8287C12 12.7494 11.5772 13.6191 10.8531 14.1879L6 18L1.14686 14.1879C0.422795 13.6191 0 12.7494 0 11.8287V3Z"})}),(0,a.jsx)("path",{className:r.Z.iconBg,d:"M0 3C0 1.34314 1.34315 0 3 0H9C10.6569 0 12 1.34315 12 3V11.8287C12 12.7494 11.5772 13.6191 10.8531 14.1879L6 18L1.14686 14.1879C0.422795 13.6191 0 12.7494 0 11.8287V3Z"}),(0,a.jsx)("path",{className:r.Z.iconBorder,d:"M6 18L4.76457 19.5728L6 20.5432L7.23543 19.5728L6 18ZM1.14686 14.1879L-0.0885728 15.7607L1.14686 14.1879ZM10.8531 14.1879L12.0886 15.7607L10.8531 14.1879ZM3 2H9V-2H3V2ZM10 3V11.8287H14V3H10ZM2 11.8287V3H-2V11.8287H2ZM9.61771 12.6151L4.76457 16.4272L7.23543 19.5728L12.0886 15.7607L9.61771 12.6151ZM7.23543 16.4272L2.38228 12.6151L-0.0885728 15.7607L4.76457 19.5728L7.23543 16.4272ZM-2 11.8287C-2 13.3632 -1.29534 14.8128 -0.0885728 15.7607L2.38228 12.6151C2.14093 12.4255 2 12.1356 2 11.8287H-2ZM10 11.8287C10 12.1356 9.85907 12.4255 9.61771 12.6151L12.0886 15.7607C13.2953 14.8128 14 13.3632 14 11.8287H10ZM9 2C9.55228 2 10 2.44772 10 3H14C14 0.238577 11.7614 -2 9 -2V2ZM3 -2C0.238579 -2 -2 0.23857 -2 3H2C2 2.44771 2.44771 2 3 2V-2Z",fill:"#090C14",mask:"url(#path-1-inside-1_1578_341598)"})]})}},690984:function(e,t,i){i.d(t,{K:()=>d});var a=i("772322"),r=i("827322");let n="drag-image-container-i3ryDb",o="image-hQ_bpZ";var s=i("641077");let d=e=>{let{url:t,visible:i,withCredentials:d}=e;return(0,a.jsx)("div",{className:n,style:{visibility:i?"visible":"hidden"},children:(0,a.jsx)(s.Z,{className:o,src:(0,r.C)(t,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),crossOrigin:d?"use-credentials":"anonymous"})})}},297222:function(e,t,i){i.d(t,{Z:function(){return o}});var a=i(195265),r=i(218571);let n=(e,t,i,a)=>{let r=t.getBoundingClientRect(),n=e.clientX+t.scrollLeft-r.left-a;return n<i.left&&(n=i.left),n>i.right&&(n=i.right),{x:n,y:0}},o=e=>{let{bounds:t,onMouseDown:i,onDrag:o,onStop:s,onReset:d,setRef:l,children:c,operationWidth:u=0}=e,h=(0,r.useRef)(),[p,_]=(0,r.useState)(!1),g=(0,r.useRef)(!1),m=(0,r.useCallback)(e=>{i(e),_(!0),g.current=!1},[i,_]),f=e=>{var i;if(!p||g.current)return;let a=null===(i=h.current)||void 0===i?void 0:i.parentElement;a&&o(e,n(e,a,t,u))},v=(0,r.useCallback)(e=>{var i;if(g.current=!0,!p)return;let a=null===(i=h.current)||void 0===i?void 0:i.parentElement;a&&s(e,n(e,a,t,u)),_(!1)},[s,p,_,t]),{run:y}=(0,a.default)(()=>{if(!!p)d(),_(!1)},16);return(0,r.useEffect)(()=>(document.body.addEventListener("mousemove",f),document.body.addEventListener("mouseup",v),document.body.addEventListener("mouseleave",y),()=>{document.body.removeEventListener("mousemove",f),document.body.removeEventListener("mouseup",v),document.body.removeEventListener("mouseleave",y)}),[f,v,y]),(0,r.useEffect)(()=>{null==l||l(h.current)},[h.current]),r.cloneElement(r.Children.only(c),{ref:h,onMouseDown:m})}},596762:function(e,t,i){function a(e,t){let{x:i=0,y:a=0,width:r,height:n}=e,o=t.getContext("2d");"image"in e?(t.width=r,t.height=n,null==o||o.drawImage(e.image,i,a,r,n,0,0,r,n)):"imageData"in e&&(t.width=e.imageData.width,t.height=e.imageData.height,null==o||o.putImageData(e.imageData,0,0))}function r(e,t){if(!e||!t)return;let i=t.getContext("2d");null==i||i.drawImage(e,0,0)}i.d(t,{Lp:function(){return r},iQ:function(){return a}})},368536:function(e,t,i){i.d(t,{ZP:function(){return _},Zw:function(){return p}});var a,r=i(772322);i(837510),i(55041),i(931598);var n=i(324160),o=i(948747),s=i(519065),d=i(16464),l=i(218571),c=i(105789),u=i.n(c),h=i(568998);i(435716);let p={media_card:{width:135,height:76},square:{width:135,height:135},rect:{width:135,height:135},strip:{height:72},text_card:{width:120,height:120},min_card:{width:60,height:60}},_=(0,l.forwardRef)((e,t)=>{let{className:i="",children:c,type:_="square",label:g="",tl:m,tr:f,bl:v,br:y,actionMenus:S=[],onHoverDelay:T=300,onHover:k,onHoverEnd:b,onSelect:I,onClick:M,onContextMenu:w,onInView:P,isDepModel:D=!1,selected:A=!1,attrs:R={},width:x=null!==(a=p[_].width)&&void 0!==a?a:"100%",height:F=p[_].height,shouldHandleClickLoading:E=!1,spinProps:O}=e,[C,V]=(0,l.useState)(!1),[B,j]=(0,l.useState)(0),[U,L]=(0,l.useState)(!1),[N,z]=(0,n.default)();(0,l.useEffect)(()=>{z&&(null==P||P())},[z]);let G=()=>{if(!A)V(!1),null==I||I()},W=async e=>{G();try{E&&L(!0),await (null==M?void 0:M(e))}finally{E&&L(!1)}};return(0,r.jsxs)("div",{className:u()("card-item-wrapper",i),style:{width:x},ref:t,onMouseEnter:()=>{if(!!k){if(0===T){k();return}j(Number(setTimeout(()=>k(),T)))}},onMouseLeave:()=>{B&&clearTimeout(B),null==b||b()},...R,children:[(0,r.jsx)(d.Z,{trigger:"contextMenu",popupVisible:C,onVisibleChange:e=>{S.length&&V(e)},droplist:S.length?(0,r.jsx)(s.Z,{className:"card-item-menu",children:S.map((e,t)=>(0,r.jsx)(s.Z.Item,{className:e.className,onClick:()=>{var t;null===(t=e.fn)||void 0===t||t.call(e),V(!1)},children:e.label},`${t}`))}):null,children:(0,r.jsxs)("div",{onClick:W,onContextMenu:e=>{null==w||w(e)},style:{width:x,height:F},className:u()("card-item",{"card-item--active":A,[`card-item--${_}`]:!0}),ref:N,children:[(0,r.jsxs)("div",{className:"card-item__content",children:[(0,r.jsx)("div",{className:"children",children:E&&U?(0,r.jsx)(o.Z,{loading:!0,...O}):null!=c?c:"Default"}),(0,r.jsx)("div",{className:"tl",children:m}),(0,r.jsx)("div",{className:"tr",children:f}),(0,r.jsx)("div",{className:"bl",children:v}),(0,r.jsx)("div",{className:"br",children:y})]}),D&&(0,r.jsx)(h.dhu,{style:{position:"absolute",right:5,top:5}})]})}),g&&(0,r.jsx)("div",{className:"card-item-label",style:{height:16,width:x},children:g})]})})},811750:function(e,t,i){i.d(t,{di:function(){return n},fQ:function(){return o},ij:function(){return r},uJ:function(){return s}});var a=i(426336);let r=a.JFE.AttachmentAsyncTask,n=a.JFE.AttachmentVideoAlgorithm,o=a.JFE.AttachmentAiWriter,s=a.JFE.AttachmentAiStory},140041:function(e,t,i){i.d(t,{A4:function(){return f},A5:function(){return _},Ad:function(){return y},D1:function(){return I},DE:function(){return p},GU:function(){return u},Gg:function(){return o},Hj:function(){return d},Y0:function(){return g},co:function(){return m},eP:function(){return n},f5:function(){return k},j6:function(){return c},lJ:function(){return s},rm:function(){return h},rx:function(){return r},uK:function(){return S},wb:function(){return T},xL:function(){return l},yF:function(){return b},yh:function(){return v}});var a=i(907031);let r=6,n=.25,o=8,s=5,d=150,l=100,c=.09,u=1,h=2e5,p=10,_=.2,g=60,m={video:a.Xj,combination:a.Xj,videoEffect:a.Xj,tailLeader:a.Xj,audio:a.Kw,text:a.bv,textTemplate:a.bv,effect:a.bv,filter:a.bv,pictureAdjust:a.bv,adjust:a.bv,sticker:a.bv,imageSticker:a.bv,handwrite:a.bv,primary:a.gW,dragVideoPlaceholder:a.Xj,dragAudioPlaceholder:a.Kw},f={top:{propName:"scrollTop",step:-10},right:{propName:"scrollLeft",step:10},bottom:{propName:"scrollTop",step:10},left:{propName:"scrollLeft",step:-10}},v={transition:{left:0,top:39},video:{left:0,top:35},audio:{left:0,top:22},text:{left:0,top:10},effect:{left:0,top:10},filter:{left:0,top:10},sticker:{left:0,top:10}},y=100,S="cover-entrance",T=33,k=50,b=100,I=1e3},768182:function(e,t,i){function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=10**t;return Math.floor(e*i)/i}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,i=e,r="B";return i>=t&&(i=a(i/t),r="KB"),i>=t&&(i=a(i/t),r="MB"),i>=t&&(i=a(i/t,1),r="GB"),`${i}${r}`}i.d(t,{a:function(){return r},m:function(){return l}});let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r(e-t)},o=e=>"Visitor"===e,s=e=>r(e),d=e=>r(e),l=e=>{let{workspace_id:t,name:i,space_id:a,role:r,caller_nickname:l,member_limit:c,member_cnt:u,owner:h,owner_name:p,quota:_,usage:g,avatar_color:m,region:f,space_idc:v,space_host:y,space_res_host:S,space_type:T,raw_space_type:k}=e;return{spaceIdc:v,spaceHost:y,spaceResHost:S,spaceType:T,rawSpaceType:k,workspaceId:t,workspaceName:i,spaceId:a,role:r,callerNickname:l,memberLimit:c,memberCnt:u,owner:h,ownerName:p,quota:_,usage:g,avatarColor:m,region:f,noPermission:o(r),remainSize:n(_,g),usedSize:s(g),totalSize:d(_)}}},92490:function(e,t,i){i.d(t,{z:function(){return c}});var a=i(552216),r=i(674076),n=i(124262),o=i(499845);let s={checked:!1,res:{isCompatible:!0,cause:{}}},d=!1;function l(e){let t=window.ccWebSlardar;try{t&&!d&&t("sendEvent",{type:"event",name:"compatibility",metrics:{},categories:{reason:JSON.stringify(e)}}),t&&(d=!0)}catch(e){}}function c(){if("node"!==o.env.JUPITER_TARGET&&void 0!==window._compatible)return console.log("checkCompatibility ===> compatibility no check",window._compatible),window._compatible;if(console.log("checkCompatibility ===> compatibility need check",window._compatible),s.checked)return d||l(s.res),s.res;let e={isCompatible:!0,cause:{}},{isMobile:t,mobileType:i}=(0,a.z)();if(t)return e.isCompatible=!1,e.cause={type:"device",details:{mobile_type:i}},s.checked=!0,s.res=e,l(e),e;let{unsupported:c,browserVersion:u,chromeOrEdge:h}=(0,r.Y3)(),{isEnable:p}=(0,n.h)();return p?(s.checked=!0,s.res=e,l(e),e):(e.isCompatible=!1,e.cause={type:"setting",details:{browser_unsupported_feature:["Cookies"]}},s.checked=!0,s.res=e,l(e),e)}},929105:function(e,t,i){i.d(t,{T:function(){return c}});var a=i(801497),r=i(426336),n=i(460254),o=i(426020),s=i(109685),d=i(188247),l=i(729596);function c(e){var t,i,c,u,h,p,_,g;e.initialSpeed=null!==(h=e.initialSpeed)&&void 0!==h?h:1;let m=function(e){switch(e){case n.r.Video:case n.r.UserVideo:return"video";case n.r.Photo:case n.r.UserPhoto:case n.r.Gif:return"image";case n.r.Audio:case n.r.UserAudio:return"audio";default:return"other"}}(e.resource.type),f="audio"===m;if(f&&!(null===(t=e.segmentSelected)||void 0===t?void 0:t.length))return e.expandedSegmentId?{type:"",value:0}:{type:"",value:0,get errmsg(){return a.oc.t("web_musicreplace_toast_click_track_first",{},"Select music track first to replace music")},groupType:m};if(f&&e.segment&&(null===(i=e.firstUnFilledMusicSegment)||void 0===i?void 0:i.id)==="end-limit"&&!e.selectedMutableAudioSegment)return(null!==(p=e.selectedMutableAudioSegment)&&void 0!==p?p:e.firstUnFilledMusicSegment).loading=!1,{type:"",value:0,get errmsg(){return a.oc.t("web_musicreplace_text_cut_music",{},"Trim current music to add new music")},groupType:m};if(e.selectedMutableAudioSegment&&!f)return{type:"",value:0,get errmsg(){return a.oc.t("web_musicreplace_cannot_add_video",{},"Couldn\u2019t add video or image to sound track")},groupType:m};if(!(0,r.OvQ)(e.slot))return{type:"",value:0,get helpTip(){return a.oc.t("web_not_choose_any_add_to_canvas",{},"\u5F53\u524D\u672A\u9009\u4E2D\u4EFB\u4F55\u69FD\u4F4D\uFF0C\u6211\u4EEC\u5C06\u4E3A\u4F60\u6DFB\u52A0\u81F3\u753B\u5E03\u6240\u793A\u753B\u9762\u5904")}};let v=0n;e.resource.type===n.r.Video||e.resource.type===n.r.Audio?v=l.h.secondToUs(e.resource.data.duration):(e.resource.type===n.r.UserVideo||e.resource.type===n.r.UserAudio)&&(e.resource.data.fileType===o.YB.Video||e.resource.data.fileType===o.YB.Audio)&&(v=l.h.secondToUs(e.resource.data.duration));let y=r.pMA.div(v,e.slot.targetDuration);if((0,s.KL)(e.resource.data))return{type:"",value:0,get errmsg(){return a.oc.t("web_multi_track_toast_material_no",{},"Can\u2019t use this material")},groupType:m};let{segments:S}=(null===(u=e.tracksMutable)||void 0===u?void 0:null===(c=u[0])||void 0===c?void 0:c[0])||{};if(S){let t=S.map(e=>"mutablePoly"===e.type?e.mutable.children:e).flat().find(t=>t.id===e.slot.segmentId);if(t){let i="";e.resource.type===n.r.Photo?i=e.resource.data.format:e.resource.type===n.r.Video?i=null===(_=e.resource.data.originVideo)||void 0===_?void 0:_.format:(e.resource.type===n.r.UserPhoto||e.resource.type===n.r.UserVideo)&&(i=null!==(g=e.resource.data.mime)&&void 0!==g?g:"");let[r,o]=(0,d.Is)({id:e.slot.segmentId,type:t.type},{dragSourceType:e.resource.type,fileType:i},e.segment);if(!r)return{type:"",value:0,get errmsg(){return null!=o?o:a.oc.t("web_editor_toast_unsupported_format",{},"Can\u2019t add. This file format is unsupported.")},errType:"format_limit",groupType:m}}}if("video"!==m&&"image"!==m)return{type:"",value:0,get errmsg(){return a.oc.t("web_slots_can_only_be_filled_with_videos_or_images",{},"\u69FD\u4F4D\u53EA\u80FD\u586B\u5145\u89C6\u9891\u6216\u56FE\u7247")},errType:"format_limit",groupType:m};if("video"===m){if(v>l.h.secondToUs(1800))return{type:"",value:0,get errmsg(){return a.oc.t("web_file_slot_limit",{},"\u7D20\u6750\u65F6\u957F\u4E0D\u53EF\u8D85\u8FC7 30 \u5206\u949F")},errType:"duration_limit",groupType:m};if(y<.5*e.initialSpeed)return{type:"",value:0,get errmsg(){return a.oc.t("web_the_length_of_the_material_cannot_be_less_than_half_the_length_of_the_slot",{},"Couldn\u2019t add. Video duration needs to be longer than the duration of the video to be added.")},errType:"duration_limit",groupType:m}}return y>=1*e.initialSpeed||"image"===m?{type:"trim",value:r.pMA.times(e.slot.targetDuration,e.initialSpeed,"bigint"),groupType:m}:{type:"speed",value:y,groupType:m}}},53600:function(e,t,i){i.d(t,{Ci:function(){return v},G8:function(){return m},J9:function(){return h},K9:function(){return g},VX:function(){return p},Vh:function(){return u},Y8:function(){return y},dR:function(){return c},f5:function(){return l},rH:function(){return _},u8:function(){return s}});var a=i(827322),r=i(593062),n=i(606386);let o=["draftId","__action_from","__from_page","__tool_type","entryId","permission","folderId","scenario","create_id"],s=["workspaceId","spaceId","is_preview_template"];function d(e,t){let i;let{excludeQuery:a=[]}=null!=t?t:{},r=new URL(i=/^\/[^/]/.test(e)?`${window.location.origin}${e}`:e.startsWith("//")?`${window.location.protocol}${e}`:e);return new URL(window.location.href).searchParams.forEach((e,t)=>{if(!(o.includes(t)||a.includes(t))&&null===r.searchParams.get(t))r.searchParams.set(t,e)}),r.toString()}function l(e,t){window.location.replace((0,a.C)(d(e,t),null,{logType:"js.window.location",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}))}function c(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{protocol:a,host:r,search:n,pathname:o}=i.g.location,s=new URLSearchParams(n);s.get("create_id")||t?s.set("create_id",e):s.get("utm_content")?s.set("utm_content",e):s.set("templateId",e);let d=`${a}//${r}${o}?${s.toString()}`;i.g.history.replaceState({},"",d)}function u(e,t){window.location.href=(0,a.C)(d(e,{excludeQuery:t}),null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})}function h(e){window.history.replaceState({},document.title,d(e))}function p(e,t,i){let a=(0,r.MY)(e);h(`${a({draftId:t})}${i?`?entryId=${i}`:""}`)}function _(e){let t=new URL(window.location.href);Object.entries(e).forEach(e=>{let[i,a]=e;t.searchParams.set(i,a)}),window.history.replaceState({},document.title,t)}function g(e){let t=new URL(window.location.href);"string"==typeof e?t.searchParams.delete(e):e.forEach(e=>t.searchParams.delete(e)),window.history.replaceState({},document.title,t)}function m(e,t){let i=Object.entries(t).map(e=>{let[t,i]=e;return null==i?"":`${t}=${encodeURIComponent(i)}`}).filter(Boolean),a=e.includes("?")?"&":"?";return e+a+i.join("&")}let f=(0,r.EQ)(n.b);function v(){var e,t,i;let a=f(window.location.pathname),{searchParams:r}=new URL(window.location.href),o=r.get("draftId");return o&&p(n.b,o),null!==(i=null!==(t=null==a?void 0:null===(e=a.params)||void 0===e?void 0:e.draftId)&&void 0!==t?t:o)&&void 0!==i?i:null}function y(){let{searchParams:e}=new URL(window.location.href),t=e.get("create_id")||e.get("utm_content")||void 0;return t&&!/^\d+$/.test(t)&&(t=void 0,e.has("create_id")&&e.delete("create_id"),e.has("utm_content")&&e.delete("utm_content"),h(`${window.location.protocol}//${window.location.host}${window.location.pathname}?${e.toString()}`)),t}},632555:function(e,t,i){i.d(t,{jG:function(){return o},kL:function(){return d},mK:function(){return n},vX:function(){return r},zb:function(){return s}});var a=i(521641);function r(e,t){let[i,a]=t;return i<e&&e<a}function n(e,t){let[i,a]=t;return i<=e&&e<=a}function o(e,t,i){return Math.min(Math.max(e,t),i)}function s(e,t,i){return o(Math.abs(e),Math.abs(t),Math.abs(i))}function d(e,t){let i=new a.Z(e),r=new a.Z(t);return i.multipliedBy(r).toNumber()}},794720:function(e,t,i){i.d(t,{r:function(){return r}});var a=i(854585);let r=e=>{if(a.rJ.includes(e))return"video";if(a.yD.includes(e))return"image";if(a.i$.includes(e))return"audio";else return"other"}},351045:function(e,t,i){i.d(t,{Dd:function(){return n},TJ:function(){return o},WE:function(){return r}});var a=i(801497);let r={get NORMAL(){return a.ZP.t("web_mix_mode_text_normal",{},"Normal")}},n=[{resourceId:"6758324989931295240",get name(){return a.ZP.t("web_mix_mode_text_overlay",{},"Overlay")}},{resourceId:"6758325170760323597",get name(){return a.ZP.t("web_mix_mode_text_screen",{},"Screen")}},{resourceId:"6758324839670354445",get name(){return a.ZP.t("web_mix_mode_text_darken",{},"Darken")}},{resourceId:"6758324919789949453",get name(){return a.ZP.t("web_mix_mode_text_brighten",{},"Brighten")}},{resourceId:"6758325264670790152",get name(){return a.ZP.t("web_mix_mode_text_hard_light",{},"Hard light")}},{resourceId:"6758325895519277582",get name(){return a.ZP.t("web_mix_mode_text_multiply",{},"Multiply")}},{resourceId:"6758325439212556814",get name(){return a.ZP.t("web_mix_mode_text_soft_light",{},"Soft light")}},{resourceId:"6758325619253056013",get name(){return a.ZP.t("web_mix_mode_text_linear_burn",{},"Linear burn")}},{resourceId:"6758325724848853518",get name(){return a.ZP.t("web_mix_mode_text_color_burn",{},"Color burn")}},{resourceId:"6758325800031752712",get name(){return a.ZP.t("web_mix_mode_text_color_dodge",{},"Color dodge")}}];function o(e){var t,i;return(null==e?void 0:null===(t=e.mixMode)||void 0===t?void 0:t.name)&&e.mixMode.name!==r.NORMAL?null===(i=n.filter(t=>{var i;return t.resourceId===(null==e?void 0:null===(i=e.mixMode)||void 0===i?void 0:i.resourceId)})[0])||void 0===i?void 0:i.name:""}},918157:function(e,t,i){i.d(t,{f:function(){return n},i:function(){return o}});var a,r=i(293698);var n=((a={}).NEW="new",a.DRAFT="draft",a.SCRIPT="script",a.CREATE_PROJECT="create_project",a.LOGIN="login",a.SIGNUP="signup",a.CREATE_NEW="create_new",a.PROJECT="project",a.NEW_FUNCTION_POPUP="new_function_popup",a.EMAIL="email",a.SHARE_LINK="share_link",a.ENTRANCE="entrance",a);function o(e){let{searchParams:t}=new URL(window.location.href),a=t.get("enter_from");if(t.get("scriptDraftId"))return"script";if(!e){if((0,r.cs)()){if("email"===r.m4.create(i.g.location.href).getAllQueryParameterValues().utm_campaign)return"email";return"share_link"}return"draft"}return null!=a?a:"new"}},810883:function(e,t,i){i.d(t,{S:function(){return d},j:function(){return s}});var a=i(153107),r=i(213099),n=i(798184),o=i(210487);function s(e){let t=e.getCoverResourceToken();return t.startImmediately(),new Promise((e,i)=>{(0,n.x)(t).then(t=>{if(!t.ok)throw Error(t.msg);let{value:i}=t;i.buffer&&e({coverUrl:(0,a.Aw)(i.buffer)})}).catch(e=>{i(e)})})}function d(e){let t=e.getCoverResourceToken();return t.startImmediately(),new Promise((e,i)=>{(0,n.x)(t).then(t=>{if(!t.ok)throw Error(t.msg);let{value:i}=t;if(i.buffer){let t=(0,a.Aw)(i.buffer);(0,o.c)(t,{attrs:{crossOrigin:"anonymous"}},{compress:{height:r.c}}).then(i=>{e({image:i,width:i.width,height:i.height,coverUrl:t,timestamp:0n,sourceTimestamp:0n})})}})})}},645778:function(e,t,i){let a;i.d(t,{FW:function(){return s},c7:function(){return l},j6:function(){return d}});var r=i(426336),n=i(431356),o=i(634696);let s=async(e,t,i,a,n)=>{try{var s;let{segment:d,progress:l,workspaceId:c}=n,{speed:u,material:h,targetTimerange:p,sourceTimerange:_,reverse:g}=d,{stable:m,materialName:f}=h,v=(0,o.RX)(h,e,i,a),{start:y,duration:S}=null!=p?p:{},T=r.pMA.minus(l,y),k=(g?r.pMA.minus(S,T):T)*u.speed,b=r.pMA.plus(k,null==_?void 0:_.start),I=(null==m?void 0:m.stableLevel)?{draw_frame_stabilization_asset:!0,pipeline_id:(0,o.eI)(d.id,i.dataSdk)}:null,M=null==f?void 0:null===(s=f.replace)||void 0===s?void 0:s.call(f,/(.*\/)*([^.]+).*/gi,"$2"),w={...v,file_type:0,trigger_scene:7,preview_frame:{position:[Math.round(b/1e3)],frame_num:1},workspace_id:c,file_name:M,result_control_param:{sync_ever_photo:!0,invisible:!1,no_occupy:!1},...I},[P,D]=(await t.createDrawFrameTask(w)).pair();if(P)throw P;return{...v,task_id:D.taskId,req_id:D.reqId}}catch(e){throw e}},d=()=>{clearInterval(a)},l=(e,t)=>new Promise((i,r)=>{try{let o=0;a=setInterval(async()=>{o>=n.kG&&r(Error("query draw frame task timeout")),o++;let[a,s]=(await e.queryDrawFrameTask({...t,trigger_scene:7})).pair();a&&r(a);let{status:l,md5:c}=null!=s?s:{};0===l&&c&&(d(),i(c)),0!==l&&1!==l&&r(Error("query draw frame status error."))},500)}catch(e){d(),r(e)}})},431356:function(e,t,i){i.d(t,{NA:function(){return n},Uy:function(){return o},X8:function(){return r},kG:function(){return a},oS:function(){return s}});let a=60,r=1,n=BigInt(3e6),o="segment_freeze",s=1e3},634696:function(e,t,i){i.d(t,{Ji:function(){return f},Ky:function(){return _},LP:function(){return c},RX:function(){return h},eI:function(){return l},p9:function(){return m},rs:function(){return g},u:function(){return v},yi:function(){return d}});var a=i(426336),r=i(126729),n=i(127830),o=i(722169),s=i(431356);function d(e,t){if(!e)return!1;let{start:i,duration:r}=e,n=a.pMA.plus(i,r,"bigint");return t>a.pMA.plus(i,s.X8,"bigint")&&t<a.pMA.minus(n,s.X8,"bigint")}let l=(e,t)=>{var i;return null===(i=t.draftView.getVideoAlgorithm(e))||void 0===i?void 0:i.pipelineId},c=(e,t,i)=>{let{materialId:a,path:r}=e,o=a;if(!a&&r){let e=t.draftPathStore.getResourceKeyFromDraftPath(r),a=i.get(e,n._g.UserVideo);o=null==a?void 0:a.value.md5}return o},u=(e,t)=>{var i;let a=null===(i=t.getMaterialsByMd5(e))||void 0===i?void 0:i[0];return{resource_id:null==a?void 0:a.assetId,resource_type:6}},h=(e,t,i,r)=>{let{sourcePlatform:n}=e,o=c(e,i,r);switch(n){case a.cvu.MaterialPlatformDefault:return u(o,t);case a.cvu.MaterialPlatformArtist:return{resource_id:o,resource_type:7};case a.cvu.MaterialPlatformBrand:return{resource_id:o,resource_type:8,asset_workspace_id:e.teamId};default:return null}},p=0n,_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0n;p=e},g=e=>BigInt(p||e),m=(e,t)=>{var i;let{material:r,trackRenderIndex:n}=null!=e?e:{};null===(i=t.reportBusinessEvent)||void 0===i||i.call(t,"click_function",{action_type:"click",function_name:"freeze",material_category:(null==r?void 0:r.sourcePlatform)===a.cvu.MaterialPlatformDefault?"media":"material_lib",track_category:0===n?"video":"vice_video"})},f=e=>{var t;let i=e.material.matting.flag,r=null===(t=e.adjust)||void 0===t?void 0:t.enableSmartColorAdjust,n=e.material.videoAlgorithm.algorithms.some(e=>e.type===a.zzh.NoiseReduction),o=e.material.videoAlgorithm.algorithms.some(e=>e.type===a.zzh.Deflicker);return i||r||n||o},v=(e,t,i,n)=>{var s,d,l,c;let u;let h=e.material.matting.flag,p=null===(s=e.adjust)||void 0===s?void 0:s.enableSmartColorAdjust,_=e.material.videoAlgorithm.algorithms.some(e=>e.type===a.zzh.NoiseReduction),g={enable:!0,toolType:r.F2.ImageMaskTask,param:{}},m={enable:!0,toolType:r.F2.PictureIntelligentToning,param:{level:null===(l=e.adjust)||void 0===l?void 0:null===(d=l.smartAdjustColor)||void 0===d?void 0:d.value}},f={enable:!0,toolType:r.F2.ImageNoiseReduction,param:{level:null===(c=e.material.videoAlgorithm.noiseReduction)||void 0===c?void 0:c.level}},v=[];if(h&&(t.pipelineManager.recordUserActionDelta(i.id,g),v.push((0,o.omit)(g,"enable")),u=r.F2.ImageMaskTask),p&&(t.pipelineManager.recordUserActionDelta(i.id,m),v.push((0,o.omit)(m,"enable")),u=r.F2.PictureIntelligentToning),_&&(t.pipelineManager.recordUserActionDelta(i.id,f),v.push((0,o.omit)(f,"enable")),u=r.F2.ImageNoiseReduction),!!v.length&&!!u)t.switchIntelligentByPipeline(i,u,v,n)}},217974:function(e,t,i){i.d(t,{Q:function(){return h}}),i(966156);var a=i(368100),r=i(426336),n=i(936154),o=i(970787),s=i(443038),d=i(896413),l=i(801497);function c(e){let{dataSdk:t,segmentIds:i,transitionIds:a,fromWhere:l,containerService:c,selectedSegments:u,draftTemplateManager:h}=e,p=a.map(e=>t.draftView.getSegmentByTransitionId(e)),_=[...u.map(e=>(0,n.q)(e)),...p.map(e=>(0,n.q)(e,!0))],g=i.length>0?a:a.filter(e=>{let a=t.draftView.getSegmentByTransitionId(e).id;return!i.includes(a)});c.invokeFunction(a=>{let r=a.get(d.a);(0,o.m)(t,r.renderManager,i,g,e.draftId)}),(0,s.v)(c,{action_type:l,is_batch:_.length>1?1:0,material_category:_.map(e=>e.material_category).join(","),track_category:_.map(e=>e.track_category).join(","),material_subcategory:_.map(e=>e.material_subcategory).join(","),material_subcategory_id:_.map(e=>e.material_subcategory_id).join(","),material_thirdcategory:_.map(e=>e.material_thirdcategory).join(","),material_thirdcategory_id:_.map(e=>e.material_thirdcategory_id).join(","),material_id:_.map(e=>e.material_id).join(","),material_name:_.map(e=>e.material_name).join(",")});let m=u.filter(r.duj);m&&h&&m.forEach(e=>{h.removeTemplateMetaInfoById(e.templateId)})}let u=null;function h(e){let{dataSdk:t,segmentIds:i,transitionIds:n}=e;if(!i.length&&!(null==n?void 0:n.length)||null!==u)return Promise.reject();let o=i.map(e=>t.draftView.getSegmentById(e)),s=o.filter(r.duj);return s.length>0?new Promise((t,i)=>{u=a.Z.confirm({title:l.ZP.t("web_multi_track_text_delete_template",{num:s.length},"{num, plural, one {Delete template?} other {Delete templates?}}"),content:l.ZP.t("web_multi_track_text_is_editing",{},"Your changes won\u2019t be saved."),okButtonProps:{status:"danger"},okText:l.ZP.t("web_delete",{},"\u5220\u9664"),cancelText:l.ZP.t("web_cancel",{},"\u5173\u95ED"),icon:null,onOk:()=>{c({...e,selectedSegments:o}),t(null)},afterClose:()=>{u=null,i()}})}):(c({...e,selectedSegments:o}),Promise.resolve())}},155981:function(e,t,i){i.d(t,{c:function(){return a}});let a="HiddenWhenPermissionUpdate"},398566:function(e,t,i){i.d(t,{Z:function(){return c}});var a=i(772322),r=i(218571),n=i(150564),o=i(801497),s=i(130685),d=i(584341),l=i(897114);let c=e=>{let{value:t,onChange:i,width:c,height:u,duration:h,limit:p=1/0,onLimit:_}=e,g=(0,r.useMemo)(()=>c&&u?[c/u*160,160]:[160,160],[c,u]),m=(0,r.useCallback)(async e=>{let{files:t}=e.target,a=null==t?void 0:t[0];if(!a)return;if(a.size>p){null==_||_();return}let r=await (0,s.r)(a,{mimeType:a.type});null==i||i(r)},[p,_,i]);return(0,a.jsx)("div",{className:l.Z.cover,children:(0,a.jsxs)("div",{className:l.Z.coverWrapper,style:{width:`${g[0]}px`,height:`${g[1]}px`},children:[(0,a.jsx)("div",{className:l.Z.coverPreview,style:{backgroundImage:`url(${t})`},children:!t&&(0,a.jsx)(n.LL2,{})}),void 0!==h&&(0,a.jsx)("span",{className:l.Z.coverDuration,children:`${(0,d.ci)(h)}`}),(0,a.jsxs)("label",{className:l.Z.coverTrigger,children:[(0,a.jsx)("input",{accept:"image/*",onChange:m,type:"file",value:""}),(0,a.jsx)(n.icq,{fill:"currentColor",className:l.Z.coverIcon}),(0,a.jsx)("div",{children:t?o.ZP.t("web_posttemplate_button_change_cover",{},"Change cover"):o.ZP.t("web_posttemplate_title_add_cover",{},"Add cover")})]})]})})}},773768:function(e,t,i){i.d(t,{Z:function(){return d}});var a=i(772322),r=i(218571),n=i(644241),o=i(472334),s=i(145952);let d=(0,r.memo)(e=>{let{containerWidth:t,skeletons:i}=e;return(0,a.jsx)("div",{className:s.Z.entirePanelSkeleton,children:(0,a.jsx)(o.ZP,{skeletonWidth:t,isLoading:!0,skeletons:null!=i?i:n.iz})})})},205874:function(e,t,i){i.d(t,{P:function(){return c}});var a=i(772322),r=i(150564),n=i(801497),o=i(576864),s=i(728631),d=i(434397),l=i(446198);let c={siderMenu:[{id:o.D,name:s.j.SiderMenuPhoto,position:"top",icon:()=>(0,a.jsx)(r.ltp,{}),tooltips:()=>n.ZP.t("web_materialSearch_title_image",{},"Images"),title:()=>n.ZP.t("web_materialSearch_title_image",{},"Images")}],siderMenuPanel:[{name:s.j.SiderMenuPhoto,skeleton:e=>{let{containerWidth:t}=e;return(0,a.jsx)(d.y,{containerWidth:(0,l._)(t)})}}]}},204573:function(e,t,i){i.d(t,{CH:function(){return s},DQ:function(){return a},_Z:function(){return r},jB:function(){return n}});let a="siderMenuTextEditMedia",r="transcript",n=["bar","masonry-list"];var o,s=((o={}).SIL="<sil>",o.IM="IM",o.RM="RM",o.C="C",o)},532085:function(e,t,i){i.d(t,{l:function(){return l}});var a=i(789786),r=i(260963),n=i(595416),o=i(587892),s=i(693511),d=i(242785);class l{get textLinesEmpty(){return 0===this.textLines.length||this.textLines.every(e=>e.words.every(e=>e.deleted))}_registerDataUpdateEmitter(){this.dataUpdateEmitter&&this._timelineManager.coverManager.registerTrackCoverDataUpdateEvent(this.dataUpdateEmitter.event)}update(e){var t;null===(t=this.dataUpdateEmitter)||void 0===t||t.fire(e)}setTextLines(e){this.textLines=e}setTrackId(e){this.trackId=e,this.update({trackId:e})}setSubTab(e){this.subTab=e}setSelectWords(e,t){this.selectedLineAndWord=[],this.selectDirection=t,this.textLines.forEach(t=>{t.words.forEach(i=>{if(e.map(e=>e.id).includes(i.id)){i.selected=!0;let e=this.selectedLineAndWord.find(e=>e.id===t.id);e?e.words.push(i):this.selectedLineAndWord.push({...t,words:[i]})}else i.selected=!1})}),this.update({selectedLineAndWord:this.selectedLineAndWord})}setWillDeleteLineAndWord(e,t){let i=[];e.forEach(e=>i.push(...e.words)),i.forEach(e=>e.willDelete=t),this.willDeleteLineAndWord=t?e:[],this.update({willDeleteLineAndWord:this.willDeleteLineAndWord})}setWordsDeleted(e,t){e.forEach(e=>e.deleted=t)}playWord(e,t){let i=t.find(e=>e.id===this.trackId);if(!i)return;let a=i.segments.find(t=>t.targetTimerange.start<e&&t.targetTimerange.start+t.targetTimerange.duration>e);if(!a)return;let r={},n=e-a.targetTimerange.start+a.sourceTimerange.start;return this.textLines.forEach(e=>{if((this.resourceUuidMap[e.resourceUuid]||[]).includes(a.id)&&e.sourceStart<n&&e.sourceEnd>n)e.playing=!0,r.line=e;else{e.playing=!1;return}e.words.forEach(e=>{e.start<=n&&e.end>n?(e.playing=!0,r.word=e):e.playing=!1})}),r}setGenerating(e){this.generating=e}setSegIds(e){this.segIds=e}setFilterSegIds(e){this.filterSegIds=e}setResourceUuidMap(e){this.resourceUuidMap=e,this.update({resourceUuidMap:e})}setResourceUuidMaterialMap(e){this.resourceUuidMaterialMap=e}setResourceUuidArr(e){this.resourceUuidArr=e}setHasChanged(e){this.hasChanged=e}setGenerateData(e){this.generateData=e}setLang(e){this.lang=e}setShowDeletedWord(e){this.showDeletedWord=e}setShowWaterWordsPanel(e){this.showWaterWordsPanel=e}setPauseMinDuration(e){this.pauseMinDuration=e}setTranscribeType(e){this.transcribeType=e}setDeletedTrackIdMap(e){e.forEach(e=>{this.deletedTrackIdMap[e.new]=e.old,this.deletedTrackIdMap[e.old]=e.new})}setShowRegenerateCaptionModal(e){this.showRegenerateCaptionModal=e}reset(){this.setSelectWords([],this.selectDirection),this.setWillDeleteLineAndWord([],!1),this.setShowRegenerateCaptionModal(!1)}constructor(e,t){this._timelineManager=e,this._idleGraphicToolkitService=t,this.trackId="",this.lang="",this.transcribeType="video",this.segIds=[],this.filterSegIds=[],this.resourceUuidMap={},this.resourceUuidMaterialMap={},this.resourceUuidArr=[],this.textLines=[],this.deletedTrackIdMap={},this.subTab=n.hk.ENTRY,this.selectedLineAndWord=[],this.willDeleteLineAndWord=[],this.selectDirection=n.N8.Forward,this.generating={visible:!1},this.showDeletedWord=!1,this.showWaterWordsPanel=!1,this.generateData={},this.hasChanged=!1,this.pauseMinDuration=.5,this.dataUpdateEmitter=null,this.showRegenerateCaptionModal=!1,(0,r.ky)(this),this.dataUpdateEmitter=new o.Q,this._registerDataUpdateEmitter(),t.getInstance().then(e=>{this.graphicToolkitService=e})}}l=(0,a.gn)([(0,a.fM)(1,d.r),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===s.j?Object:s.j,void 0===d.r?Object:d.r])],l)},260025:function(e,t,i){i.d(t,{H:()=>m});var a=i("789786"),r=i("722169"),n=i("176022"),o=i("230689"),s=i("966697"),d=i("255034"),l=i("260963"),c=i("207204"),u=i("356954"),h=i("426336");let p={[h.Ocy.SegmentFilter]:"filter",[h.Ocy.SegmentText]:"text_template",[h.Ocy.SegmentAudio]:"audio",[h.Ocy.SegmentSticker]:"sticker",[h.Ocy.SegmentPictureAdjust]:"picture_adjust",[h.Ocy.SegmentImageSticker]:"image_sticker",[h.Ocy.SegmentHandwrite]:"hand_write",[h.Ocy.SegmentTailLeader]:"tail_leader",[h.Ocy.SegmentVideo]:"video",[h.Ocy.SegmentVideoEffect]:"effect",[h.Ocy.SegmentTextTemplate]:"text_template",[h.Ocy.SegmentComposition]:"composition",[h.Ocy.SegmentAdcube]:"adcube",[h.Ocy.SegmentPluginEffect]:"plugin_effect",[h.Ocy.SegmentShape]:"shape"};class _{getEventParams(){let{action:e,vipMaterial:t,vipFunction:i}=this._params;return{action:e,vip_material:t,vip_function:i}}constructor(e){this._params=e,this.eventName="vip_toast"}}var g=i("183346");class m{_getBadgeType(){let e=this._subscriptionContextService.subscriptionContext;if(!e)return null;let{enableVip:t,enableSVip:i,currentVipLevel:a}=e;return t?i?"pro"===a?"pro-available":"pro-unavailable":"legacy-vip":null}_handleChangeCommercialContext(){(0,l.z)(()=>{this._observeCheckListManagerData.vipBadgeType=this._getBadgeType()})}get observeCheckListManagerData(){return this._observeCheckListManagerData}get observeVipSegmentsMap(){return this._observeCheckListManagerData.vipSegmentsMap}get isUsingVipMaterialOrTools(){var e,t,i,a;let r=null!==(i=null===(e=this._observeCheckListManagerData.validEffects)||void 0===e?void 0:e.vipValidEffects)&&void 0!==i?i:[],n=null!==(a=null===(t=this._observeCheckListManagerData.validTools)||void 0===t?void 0:t.vipValidTools)&&void 0!==a?a:[];return r.length+n.length>0}get isVip(){return this._accountService.isVip}updateValidEffects(e){var t;(0,l.z)(()=>{this._observeCheckListManagerData.validEffects={...this._observeCheckListManagerData.validEffects,...e}}),(null===(t=e.vipValidEffects)||void 0===t?void 0:t.length)&&this.showGuideIfNeed({vipMaterial:"effect"})}setValidTools(e){var t,i,a,n;let o=(0,r.difference)(e.vipValidTools,null!==(a=null===(t=this._observeCheckListManagerData.validTools)||void 0===t?void 0:t.vipValidTools)&&void 0!==a?a:[]);(0,l.z)(()=>{this._observeCheckListManagerData.validTools=e}),(null===(i=e.vipValidTools)||void 0===i?void 0:i.length)&&this.showGuideIfNeed({vipFunction:null===(n=o[0])||void 0===n?void 0:n.reportId})}updateHiddenTools(e){(0,l.z)(()=>{this._observeCheckListManagerData.validTools={...this._observeCheckListManagerData.validTools,vipHiddenTools:e}})}setVipSegmentsMap(e){var t,i;let a;let n=(0,r.difference)(Object.keys(e),Object.keys(null!==(t=this._observeCheckListManagerData.vipSegmentsMap)&&void 0!==t?t:{}));if((0,l.z)(()=>{this._observeCheckListManagerData.vipSegmentsMap=e}),n[0]){let t=null===(i=e[n[0]])||void 0===i?void 0:i.__segment_struct_type;a=t?p[t]:"none"}Object.keys(e).length>0&&this.showGuideIfNeed({vipMaterial:a})}resetAllValids(){(0,l.z)(()=>{this._observeCheckListManagerData.validEffects={vipValidEffects:[],bussinessValidEffects:[],personalValidEffects:[]},this._observeCheckListManagerData.validTools={vipValidTools:[]},this._observeCheckListManagerData.vipSegmentsMap={}})}showGuideIfNeed(e){var t;if(this._hasVipToastShowed)return;this._hasVipToastShowed=!0;let i=null===(t=this._accountService.userVipInfo)||void 0===t?void 0:t.flag,a=this._guideService.getShowStateByKey(g.F3.ChecklistBtnGuide);!i&&!a&&(this._guideService.onStateChange(t=>{var i,a;if(!!t.show&&t.key===g.F3.ChecklistBtnGuide)i=this._containerService,a={action:"show",...e},(0,u.K)(i,_,[a])}),this._guideService.trigger((0,c.U)()))}constructor(e,t,i,a){this._accountService=e,this._guideService=t,this._containerService=i,this._subscriptionContextService=a,this._hasVipToastShowed=!1,this._observeCheckListManagerData=(0,l.LO)({validEffects:{vipValidEffects:[],bussinessValidEffects:[],personalValidEffects:[]},validTools:{vipValidTools:[],vipHiddenTools:[]},vipBadgeType:null}),this._subscriptionContextService.onDidChangeSubscriptionContext(this._handleChangeCommercialContext.bind(this))}}m=(0,a.gn)([(0,a.fM)(0,s.Gw),(0,a.fM)(1,n.W),(0,a.fM)(2,o.t),(0,a.fM)(3,d.v),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===s.Gw?Object:s.Gw,void 0===n.W?Object:n.W,void 0===o.t?Object:o.t,void 0===d.v?Object:d.v])],m)},515379:function(e,t,i){i.d(t,{r:function(){return n},z:function(){return o}});var a,r,n=((a={})[a.Collaborator=12]="Collaborator",a[a.JoinSpace=11]="JoinSpace",a[a.Export=10]="Export",a[a.TemplatePost=10]="TemplatePost",a[a.TemplateEditMore=9]="TemplateEditMore",a[a.CheckList=8]="CheckList",a[a.CopyRight=8]="CopyRight",a[a.FeedBack=7]="FeedBack",a[a.FilmTask=6]="FilmTask",a[a.ExportTask=6]="ExportTask",a[a.ToolbarViewMode=2]="ToolbarViewMode",a[a.PCDownload=9]="PCDownload",a[a.Settings=1]="Settings",a);var o=((r={})[r.SaveStatus=10]="SaveStatus",r[r.Remame=9]="Remame",r[r.ReadonlyTag=8]="ReadonlyTag",r[r.Duplicate=7]="Duplicate",r[r.UpdateNotice=6]="UpdateNotice",r)},913417:function(e,t,i){i.d(t,{Z:function(){return l}});var a=i(772322);i(225572);var r=i(97257),n=i(105789),o=i.n(n),s=i(801497),d=i(150564);i(330186);let l=e=>{let{loading:t=!1,disabled:i,active:n=!1,showIcon:l,onMouseEnter:c,onMouseLeave:u,onClick:h,visuallyDisabled:p}=e;return(0,a.jsxs)(r.Z,{id:"export-video-btn",size:"small",type:"primary",loading:t,disabled:i,className:o()("export-video-btn",{active:n,"lv-btn-disabled":p}),onClick:h,onMouseEnter:c,onMouseLeave:u,"data-ssr-i18n-key":"export_web_vid_eo","data-ssr-i18n-value":s.oc.t("export_web_vid_eo"),children:[l&&(0,a.jsx)(d.QqL,{color:i||p?"var(--lvv-color-text-disable)":"var(--lvv-color-text-content-primary)",fontSize:"14",style:{verticalAlign:-3}}),s.oc.t("export_web_vid_eo",{},"Export")]})}},972068:function(e,t,i){i.d(t,{B9:function(){return o},QR:function(){return d},jS:function(){return s}});var a,r,n,o=((a={})[a.error=1]="error",a[a.lte_1080p_36000s=2]="lte_1080p_36000s",a[a.gt_1080p_5400s=3]="gt_1080p_5400s",a);var s=((r={}).VIDEO="video",r.IMAGE="image",r);var d=((n={}).INSUFFICIENT_SPACE="20113",n.BELOW_VERSION="40008",n.INVALID_NAME="40031",n.INVALID_MATERIAL_NAME="24001",n.DELETED_PACKAGE="40004",n.DELETED_MATERIAL="10000",n.INVALID_MATERIAL="40006",n.INVALID_FORMAT="200206",n.INVALID_MATERIAL_INFORMATION="200204",n.INVALID_TOKEN="20127",n.SAVE_TIMEOUT="CUSTOM_SAVE_TIMEOUT",n)},824271:function(e,t,i){i.d(t,{P:function(){return s}});var a=i(772322),r=i(882458),n=i(768133),o=i(185017);let s={titleBar:[{name:r.j.TitlebarFilmTask,type:"Custom",position:"right",style:{marginRight:"4px"},showInMenu:{priority:n.Yg.FilmTask,group:n.kS.FilmTask,withMenu:!1,priorityInMenu:n.$9.FilmTask},contributionSymbol:r.D,content:e=>(0,a.jsx)(o.Z,{disabled:!0,onClick:e.onClick,onMouseOver:e.onHover,onMouseEnter:e.onEnter})}]}},285001:function(e,t,i){i.d(t,{D:function(){return a},j:function(){return r}});let a="titlebarRename",r={TitlebarRename:"TitlebarRename",TitlebarDraftMenu:"TitlebarDraftMenu"}},735842:function(e,t,i){i.d(t,{P:function(){return c}});var a=i(772322),r=i(348609),n=i(326106),o=i(302343),s=i(879601),d=i(515379),l=i(768133);let c={titleBar:[{name:r.j.TitlebarSettings,type:n._.Custom,position:"right",orderLevel:o.r.low,order:d.r.Settings,content:()=>(0,a.jsx)(s.V,{isDisabled:!0}),contributionSymbol:r.D,showInMenu:{priority:l.Yg.Settings,group:l.kS.Settings,withMenu:!1,priorityInMenu:l.$9.Settings}}]}},894542:function(e,t,i){i.d(t,{P:function(){return n}});var a=i(768133),r=i(980224);i(491715);let n={titleBar:[{name:r.j.TitlebarSignIn,type:"Custom",position:"right",showInMenu:{priority:a.Yg.SignIn,group:a.kS.SignIn,withMenu:!1,priorityInMenu:a.$9.SignIn},contributionSymbol:r.D,content:()=>null}]}},67323:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarAudioSpeed",r="speed"},114848:function(e,t,i){i.d(t,{w:function(){return u}});var a=i(772322);i(837510),i(17435);var r=i(948747),n=i(629913),o=i(218571),s=i(732077),d=i(368536),l=i(736323),c=i(801497);let u=(0,o.memo)(e=>{let{onSelect:t,activeId:i,list:o}=e;return(0,a.jsx)("div",{className:"attribute-color-curves-list",children:o.map((e,o)=>{let u=function(e){let t=l.kT.find(t=>{let{key:i}=t;return e.toLocaleLowerCase().includes(i.toLocaleLowerCase())});return t?c.ZP.t(t.i18nKey,{},t.keyRealName):e}(e.name),h=(0,a.jsx)(d.ZP,{className:"attribute-color-curves-item-card",selected:i===e.name,onClick:()=>t(e),children:(0,a.jsx)(s.Z,{src:e.icon.urlList[0],crossOrigin:"anonymous",skeleton:(0,a.jsx)(r.Z,{spinColor:"gray",size:20,webp:!0})})});return(0,a.jsxs)("div",{className:"attribute-color-curves-item",children:[h,(0,a.jsx)(n.Z,{position:"bottom",content:u,checkOverflow:!0,children:(0,a.jsx)("div",{className:"attribute-color-curves-item-name",children:u})})]},u||o)})})})},952221:function(e,t,i){i.d(t,{P:function(){return l}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),d=i(612809);let l={toolBar:[{id:i(498614).D,name:r.j.ToolbarEffectBasic,type:"unpin",icon:()=>(0,a.jsx)(o.t33,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.Effect],defaultActiveGroupList:[s.D.Effect]}],toolBarPanel:[{name:r.j.ToolbarEffectBasic,content:(0,a.jsx)(d.v,{})}]}},70858:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarFilterBasic",r="basic"},884382:function(e,t,i){i.d(t,{P:function(){return d}});var a=i(772322),r=i(929303),n=i(801497),o=i(150564),s=i(108917);let d={toolBar:[{name:r.j.ToolbarStickerTracking,type:"unpin",icon:()=>(0,a.jsx)(o.nHE,{fontSize:20}),title:()=>n.ZP.t("web_elements_title_tracking",{},"Camera tracking"),groups:[s.D.Sticker]}],toolBarPanel:[{name:r.j.ToolbarStickerTracking}]}},641157:function(e,t,i){i.d(t,{P:function(){return l}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),d=i(612809);let l={toolBar:[{id:i(443981).DQ,name:r.j.ToolbarTextPreset,type:"unpin",icon:()=>(0,a.jsx)(o.AhC,{fontSize:20}),title:()=>n.ZP.t("web_materialSearch_button_preset",{},"Presets"),groups:[s.D.Text,s.D.TextTemplate,s.D.Caption],order:3,defaultActiveGroupList:[s.D.Caption]}],toolBarPanel:[{name:r.j.ToolbarTextPreset,content:(0,a.jsx)(d.v,{})}]}},861913:function(e,t,i){i.d(t,{P:function(){return l}});var a=i(772322),r=i(728631),n=i(801497),o=i(150564),s=i(108917),d=i(612809);let l={toolBar:[{id:i(583897).D,name:r.j.ToolbarTransitionBasic,type:"unpin",icon:()=>(0,a.jsx)(o.$cv,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.Transition],defaultActiveGroupList:[s.D.Transition]}],toolBarPanel:[{name:r.j.ToolbarTransitionBasic,content:(0,a.jsx)(d.v,{})}]}},764048:function(e,t,i){i.d(t,{D:function(){return a},N:function(){return r}});let a="toolbarVideoMotion",r="motion"},257118:function(e,t,i){i.d(t,{$x:function(){return f},Nw:function(){return v},Ny:function(){return D},TY:function(){return k},U3:function(){return y},fN:function(){return S},iM:function(){return F},p:function(){return A},pg:function(){return b},rx:function(){return I},uK:function(){return w},vs:function(){return R},xS:function(){return x},xf:function(){return M}});var a=i(426336),r=i(550535),n=i(820193),o=i(722169),s=i(565508),d=i(817554),l=i(909034),c=i(731992),u=i(127830),h=i(593642),p=i(800788),_=i(787347),g=i(128518),m=i(380455);let f=1,v=e=>(0,a.Ftn)(e)||(0,a.Q2R)(e),y=e=>(0,a.NHR)(e),S=e=>{var t;let i=e.digitalHuman;return null==i?void 0:null===(t=i.ttsMetas)||void 0===t?void 0:t.map(e=>e.text).join(" ")},T=e=>{let t=e[0].offset;e.forEach(e=>{(0,a.dDv)(t,e.offset)&&(e.offset=t),t=(0,a.yt6)(e.offset,e.mediaInfo.duration,"bigint")})},k=e=>{let{segments:t,dataSdk:i,trackIndex:r}=e,n=[...t],o=n[0].targetTimerange.start;n.forEach(e=>{let t=e.targetTimerange.start;(0,a.dDv)(o,t)&&(t=o,i.api.segment.move({segmentId:e.id,targetTrackIndex:r,sourceTrackIndex:r,targetStartTime:t})),o=(0,a.yt6)(t,e.targetTimerange.duration,"bigint")})},b=e=>{T(e);let t=e[0].offset,i=[],r=[];for(let n of e){let e=(0,a.rX1)((0,a.yt6)(n.offset,n.mediaInfo.duration),t);if((0,a.dDv)(e,720000000n))i.push(r),r=[{...n,digitalHumanOffset:0n}],t=n.offset;else{let e=(0,a.rX1)(n.offset,t,"bigint");r.push({...n,digitalHumanOffset:e})}}return r.length&&i.push(r),i};async function I(e,t,i,r,n,o){let{ensureManager:s}=n,d=(0,c.l)(u._g.Mask,e),l=s.ensureEffect(d);await l.waitForResourceValueReady();let h={name:e.name,resourceType:e.maskType,resourceId:e.resourceId,segId:null!=o?o:"",isKeyframe:!1,path:s.getEffectPathForEnsuredEffect(e.resourceId),width:1,height:1,sourcePlatform:a.nj7.EffectPlatformArtist,positionInfo:a.HHr.stringify({face_center_x:t,face_center_y:i,face_radius:r})};return{segmentId:o,maskParam:h}}let M=async(e,t,i,r)=>{if(!i)return{segmentId:r,backgroundParam:null};if(i.type===a.cVg.MetaTypeCanvasColor)return{segmentId:r,backgroundParam:{...i,imageId:"",sourcePlatform:a.nj7.EffectPlatformLoki}};let n=t.find(e=>e.resourceId===i.value);if(!n)return{};let o=(0,c.l)(u._g.VideoBackground,n),d=(0,s.do)(o.resource);try{let t=e.ensureManager.ensureEffect(o,d);await t.waitForResourceValueReady()}catch(e){}return e.playerManager.pause(),{segmentId:r,backgroundParam:{type:a.cVg.MetaTypeCanvasImage,value:d,imageId:n.resourceId,sourcePlatform:m.t.formatEffectSourcePlatform(n.source)}}},w=(e,t,i)=>{let{mediaFileInfo:r,resource:n,resourceRecord:o}=e;return(0,a.lFK)({segmentId:(0,h.Rl)(),path:null==o?void 0:o.segmentPath,type:a.cVg.MetaTypeImage,materialName:n.getModel().filename,startTime:i.start,duration:i.duration,sourceStartTime:0n,sourceDuration:0n,materialId:"",originMaterialId:"",source:void 0,sourcePlatform:void 0,mediaInfo:r,size:{width:r.width,height:r.height}})},P=new Map,D=async e=>{var t,i,r;let{imageUrl:n,digitalHumanId:o,digitalHumanService:s,containerService:d,mainEditorWidgetService:l,position:c}=e,u="";if(P.has(o))u=null!==(t=P.get(o))&&void 0!==t?t:"";else{let e=await s.downloadDefaultVideo(n,o);u=`/.preview-temp-file/${e.name}`,await (0,_.WZ)(e,u,l.renderManager),P.set(o,u)}let p=await l.renderManager.getMediaFileInfo(u,"");return(0,a.lFK)({segmentId:(0,h.Rl)(),path:u,type:a.cVg.MetaTypeVideo,materialName:o,startTime:c.start,duration:c.duration,sourceStartTime:0n,sourceDuration:0n,materialId:"",originMaterialId:"",source:void 0,sourcePlatform:void 0,mediaInfo:p,size:{width:null!==(i=null==p?void 0:p.width)&&void 0!==i?i:0,height:null!==(r=null==p?void 0:p.height)&&void 0!==r?r:0}})},A=async e=>{var t,i,r;let{imageUrl:n,digitalHumanId:o,digitalHumanService:s,containerService:d,mainEditorWidgetService:l,position:c}=e,u="";if(P.has(o))u=null!==(t=P.get(o))&&void 0!==t?t:"";else{let e=await s.downloadDefaultImage(n,o);u=`/.preview-temp-file/${e.name}`,await (0,_.WZ)(e,u,l.renderManager),P.set(o,u)}let p=await l.renderManager.getMediaFileInfo(u,"");return(0,a.lFK)({segmentId:(0,h.Rl)(),path:u,type:a.cVg.MetaTypeImage,materialName:o,startTime:c.start,duration:c.duration,sourceStartTime:0n,sourceDuration:0n,materialId:"",originMaterialId:"",source:void 0,sourcePlatform:void 0,mediaInfo:p,size:{width:null!==(i=null==p?void 0:p.width)&&void 0!==i?i:0,height:null!==(r=null==p?void 0:p.height)&&void 0!==r?r:0}})},R=async e=>{var t,i,a,r,n,o;let{imageUrl:s,digitalHumanId:c,digitalHumanService:u,containerService:h,mainDraftService:_,mainEditorWidgetService:g,resourceService:m}=e,f=await u.uploadDefaultImage(s,c),v=[{md5:null==f?void 0:f.md5,vid:"",url:"",key:""}].filter(e=>{var t;return null!==(t=e.md5)&&void 0!==t?t:e.vid}),[y,S]=(await h.invokeFunction(d.CH,{list:v},{resourceType:5},{addToUserGenerated:!1})).pair();if(y||!S)throw Error("ensure material error");let T=await (0,l.q3)(null==S?void 0:null===(t=S[0])||void 0===t?void 0:t.getModel(),_.dataSdk,g.ensureManager,g.renderManager,_.draftPathStore,m,h),k=await (null==S?void 0:null===(n=S[0])||void 0===n?void 0:null===(r=n.getModel)||void 0===r?void 0:null===(a=r.call(n))||void 0===a?void 0:null===(i=a.addModelToDraft)||void 0===i?void 0:i.call(a));(0,p.Y2)(!k||k.ok);let b=await g.renderManager.getMediaFileInfo(T.resPath,null!==(o=T.decryptKey)&&void 0!==o?o:"");if(!b||!T)throw Error("ensure image error");return{mediaFileInfo:b,resource:null==S?void 0:S[0],resourceRecord:T}},x=(e,t)=>{let{position:i,imageInfo:a,...r}=e,{mainDraftService:n}=t,o=a&&i?w(a,r.segmentId,i):void 0;return n.dataSdk.api.video.updateDigitalHuman({videoParams:o?[o]:void 0,...r})},F=async(e,t)=>{var i,s,d,c,u;let{segmentId:h,digitalHumanId:_,taskId:m,resourceId:v,data:y,sourceTimerangeParam:S,volume:T,options:k}=e,{containerService:b,mainDraftService:I,mainEditorWidgetService:M,resourceService:w}=t,P=null==y?void 0:y.taskDetails,D=(null==P?void 0:P.map(e=>e.md5))||[],[A,R]=(await (0,r.J)({md5s:D,fromWorkspaceId:I.draftWorkspaceManager.workspaceId||"",toWorkspaceId:I.draftWorkspaceManager.workspaceId||"",containerService:b,addToUserGenerated:!1})).pair(),x=null==y?void 0:y.taskDetails.findIndex(e=>"rgb"===e.resource_name),F=null==y?void 0:y.taskDetails.findIndex(e=>"alpha"===e.resource_name);if(A||(0,o.isNil)(x)||(0,o.isNil)(F))return;await Promise.all(R.map(e=>new Promise((t,i)=>{if((0,n.fA)(e.getModel())){t("");return}e.onDidTranscode(()=>t("")),e.onResourceReady(()=>t("")),e.onPrepareFailure(()=>i(Error("prepare failure"))),e.onTranscodeFailure(()=>i(Error("transcode failure")))})));let E=await Promise.all(R.map(async e=>{var t,i;let a=null==e?void 0:null===(t=e.getModel)||void 0===t?void 0:t.call(e),r=await (null==a?void 0:null===(i=a.addModelToDraft)||void 0===i?void 0:i.call(a));return(0,p.Y2)(!r||r.ok),a})),O=await Promise.all(E.map(e=>(0,l.ti)(e,I.dataSdk,M.ensureManager,M.renderManager,I.draftPathStore,w,b))),C=await Promise.all(O.map(e=>{var t;return M.renderManager.getMediaFileInfo(e.resPath,null!==(t=e.decryptKey)&&void 0!==t?t:"")})),V=R.map((e,t)=>{let i=null==O?void 0:O[t],r=null==E?void 0:E[t],n=null==C?void 0:C[t];return(0,a.lFK)({segmentId:h,path:null==i?void 0:i.segmentPath,materialName:r.filename,startTime:0n,duration:n.duration,type:a.cVg.MetaTypeVideo,sourceStartTime:0n,sourceDuration:0n,materialId:"",source:void 0,sourcePlatform:void 0,mediaInfo:n,volume:T,size:{width:n.width,height:n.height}})}),B=I.dataSdk.draftView.getSegmentById(h),j=(0,g.q)(B),U=!1;j&&B&&(U=(0,g.S)(B));let L=I.dataSdk.api.video.updateDigitalHumanRendered({segmentId:h,digitalPath:O[x].segmentPath,videoParam:V[x],mattingPath:null!==(s=null===(i=O[F])||void 0===i?void 0:i.segmentPath)&&void 0!==s?s:"",sourceTimerangeParam:S});return(null==k?void 0:k.closeMatting)?I.dataSdk.api.video.clearMatting({segId:h,path:null!==(c=null===(d=O[F])||void 0===d?void 0:d.segmentPath)&&void 0!==c?c:""}):j&&!U&&(null===(u=O[F])||void 0===u?void 0:u.segmentPath)&&I.dataSdk.api.video.clearMatting({segId:h,path:O[F].segmentPath}),M.timelineManager.segmentManager.setTimelineSegmentLoading(h,!1,f),L}},183609:function(e,t,i){i.d(t,{O:()=>V});var a=i("789786"),r=i("433140"),n=i("230689"),o=i("806622"),s=i("426336"),d=i("593642"),l=i("690613"),c=i("800788"),u=i("426020"),h=i("786022"),p=i("932099"),_=i("909034"),g=i("298730"),m=i("756024"),f=i("473595"),v=i("82978"),y=i("857670"),S=i("460254"),T=i("380455");class k{updateRenderManager(e){this._renderManager=e}async add(e,t,i){var a,r,n;let o;if(!this._renderManager)return(0,p.u_)(v.o.RenderManagerUndefined);let s=(0,l.oW)(""),c=(0,g.ty)(this._dataSdk,[{targetStart:t.start,duration:this._getDuration(e,t),trackIndex:t.trackIndex,newTrack:null!==(a=t.needInsertTargetTrack)&&void 0!==a&&a,type:"audio"}]);if(!c.ok)return this._callbackOptions.toast(c.msg),s=(0,p.u_)(v.o.TrackLimit);let u=(0,d.Rl)(),{uiSegmentId:h}=this._callbackOptions.beforeAddSegment(e,t,u);try{let a;this._callbackOptions.beforeEnsureResource(e);try{a=await this._ensureResource(e)}catch(e){return m.t.error(e),s=(0,p.u_)(v.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,a)}if(!a)return s=(0,p.u_)(v.o.MissResource);if(e.type===S.r.UserAudio){let t=await (null===(n=e.value)||void 0===n?void 0:null===(r=n.addModelToDraft)||void 0===r?void 0:r.call(n));if(t&&!t.ok)return s=(0,p.u_)(v.o.MissResource)}let d=this._dataSdk.api.batch.batchStart();try{if(!(s=this._addAudioTrackIfNeeded(t)).ok)return s;t.duration=this._getDuration(e,t);let r=this._dataSdk.draftView.getAllTracks()[t.trackIndex].id;if(o=e.type===S.r.Audio?this._resourceToAudioParam(e.value,t,r,u,a.segmentPath,i):this._userResourceToAudioParam(e.value,t,r,u,a.segmentPath,i),!(s=this._dataSdk.api.audio.add(o)).ok)return s=(0,p.u_)(v.o.AddSegment)}catch(e){return m.t.error(e),s=(0,p.u_)(v.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(d)}}catch(e){m.t.error(e),s=(0,p.u_)(v.o.Unknown)}finally{if(this._callbackOptions.afterAddSegment(s.ok?null==o?void 0:o.segmentId:void 0,h),s.ok&&(null==o?void 0:o.segmentId)){let{segmentId:e}=o;f.f.add(e,{searchId:null==i?void 0:i.searchId})}}return s}async batchAdd(e,t,i){var a,r,n,o,s,c,u,h,_,f;if(!this._renderManager)return(0,p.u_)(v.o.RenderManagerUndefined);let y=(0,l.ly)(),T=t.start,k=(0,g.ty)(this._dataSdk,e.map(e=>{var i;let a=this._getDuration(e,t),r=T;return T+=a,{targetStart:r,duration:a,trackIndex:t.trackIndex,newTrack:null!==(i=t.needInsertTargetTrack)&&void 0!==i&&i,type:"audio"}}));if(!k.ok)return this._callbackOptions.toast(k.msg),y=(0,p.u_)(v.o.TrackLimit);let b=Array.from(e,()=>void 0),I=Array.from(e,()=>(0,p.u_)(v.o.AddSegment));null===(a=(r=this._callbackOptions).beforeBatchAddSegment)||void 0===a||a.call(r,e,t);try{let a=[];null===(n=(o=this._callbackOptions).beforeBatchEnsureResource)||void 0===n||n.call(o,e);try{let t=[];for(let i of e)t.push(this._ensureResource(i));a=(await Promise.allSettled(t)).map(e=>"fulfilled"===e.status?e.value:void 0)}catch(e){return m.t.error(e),y=(0,p.u_)(v.o.EnsureResource)}finally{null===(s=(c=this._callbackOptions).afterBatchEnsureResource)||void 0===s||s.call(c,e,a)}for(let t of e)if(t.type===S.r.UserAudio){let e=await (null===(h=t.value)||void 0===h?void 0:null===(u=h.addModelToDraft)||void 0===u?void 0:u.call(h));if(e&&!e.ok)return y=(0,p.u_)(v.o.MissResource)}let r=this._dataSdk.api.batch.batchStart();try{if(!(y=this._addAudioTrackIfNeeded(t)).ok)return y;for(let r=0;r<e.length;r++){let n=e[r],o=a[r];if(!o)continue;t.duration=this._getDuration(n,t);let s=this._dataSdk.draftView.getAllTracks()[t.trackIndex].id;if(b[r]=n.type===S.r.Audio?this._resourceToAudioParam(n.value,t,s,(0,d.Rl)(),o.segmentPath,null==i?void 0:i[r]):this._userResourceToAudioParam(n.value,t,s,(0,d.Rl)(),o.segmentPath,null==i?void 0:i[r]),!!b[r])I[r]=this._dataSdk.api.audio.add(b[r]),I[r].ok&&(t.start+=t.duration)}}catch(e){return m.t.error(e),y=(0,p.u_)(v.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(r)}}catch(e){m.t.error(e),y=(0,p.u_)(v.o.Unknown)}finally{null===(_=(f=this._callbackOptions).afterBatchAddSegment)||void 0===_||_.call(f,I.map((e,t)=>{var i;return e.ok?null===(i=b[t])||void 0===i?void 0:i.segmentId:void 0}))}return y}addBySegment(e,t){var i,a,r;let n=this._addAudioTrackIfNeeded(t);if(!n.ok)return n;let o=(0,d.Rl)();return this._dataSdk.api.segment.insert({segmentId:o,referenceSegment:e,trackIndex:t.trackIndex,targetStartTime:t.start,targetDuration:null!==(i=t.duration)&&void 0!==i?i:e.targetTimerange.duration,sourceStartTime:null!==(a=t.sourceStart)&&void 0!==a?a:e.sourceTimerange.start,sourceDuration:null!==(r=t.sourceDuration)&&void 0!==r?r:e.sourceTimerange.duration}).ok?(0,l.oW)(o):(0,p.u_)(v.o.AddSegment)}addToCurrentProgress(e,t){if(!this._renderManager)return(0,p.u_)(v.o.RenderManagerUndefined);let i=(0,y.i1)(this._renderManager.progress),{needToInsert:a,trackIndex:r}=this._dataSdk.draftView.findTrackIndexToInsert(s.pNd.TrackTypeAudio,i,(0,s.k3U)((()=>{if(e.type===S.r.Audio)return e.value.duration;if(e.value.fileType===u.YB.Audio)return e.value.duration;(0,c.ss)("no user Audio type, do not use this function")})(),1000000n,"bigint"));return this.add(e,{start:i,trackIndex:r,needInsertTargetTrack:a},t)}_resourceToAudioParam(e,t,i,a,r,n){var o,d,l,c,u;return{trackId:i,segmentId:a,audioPath:r,audioTitle:e.title,startTime:t.start,duration:(0,s.k3U)(e.duration,1e6,"bigint"),sourceStartTime:0n,sourceDuration:null!==(o=t.duration)&&void 0!==o?o:0n,sourcePlatformType:e.isFromBrand?s.QZ3.AudioPlatformBrand:T.t.toSourcePlatform(e.source,e.publishSource),audioId:e.resourceId,appId:h.kJ,type:(null!==(d=null==n?void 0:n.type)&&void 0!==d?d:void 0!==e.effectType)?T.t.toMetaType(e.effectType):s.cVg.MetaTypeMusic,audioCategoryTitle:null!==(l=null==n?void 0:n.materialThirdcategory)&&void 0!==l?l:"",audioCategoryId:String(null!==(c=null==n?void 0:n.materialThirdcategoryId)&&void 0!==c?c:""),teamId:null!==(u=e.workspaceId)&&void 0!==u?u:""}}_userResourceToAudioParam(e,t,i,a,r,n){var o,d,l,h,p;return(0,c.Y2)(e.fileType===u.YB.Audio),{trackId:i,segmentId:a,audioPath:r,audioTitle:null!==(o=e.filename)&&void 0!==o?o:"",startTime:t.start,duration:(0,s.k3U)(e.duration,1e6,"bigint"),sourceStartTime:0n,sourceDuration:null!==(d=t.duration)&&void 0!==d?d:0n,audioId:"",type:null!==(l=null==n?void 0:n.type)&&void 0!==l?l:s.cVg.MetaTypeMusic,audioCategoryTitle:null!==(h=null==n?void 0:n.materialThirdcategory)&&void 0!==h?h:"",audioCategoryId:String(null!==(p=null==n?void 0:n.materialThirdcategoryId)&&void 0!==p?p:"")}}_getDuration(e,t){return t.duration?t.duration:e.type===S.r.UserAudio?((0,c.Y2)(e.value.fileType===u.YB.Audio),(0,s.k3U)(e.value.duration,1000000n,"bigint")):(0,s.k3U)(e.value.duration,1000000n,"bigint")}_addAudioTrackIfNeeded(e){let t=(0,l.ly)();if(e.needInsertTargetTrack){let i=(0,p.HU)(this._dataSdk);if(!i.ok)return t=(0,p.u_)(v.o.AddTrack);0===e.trackIndex&&(e.trackIndex=1),!(i=this._dataSdk.api.track.add({trackIndex:e.trackIndex,track:new s.fQ8({id:(0,d.Rl)(),type:s.pNd.TrackTypeAudio,flag:s.w9k.FlagNone})})).ok&&(t=(0,p.u_)(v.o.AddTrack))}return t}async _ensureResource(e){if(!!this._renderManager)return e.type===S.r.Audio?await (0,_.nP)(e.value,this._ensureManager,this._renderManager,this._resourceService):await (0,_.RN)(e.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService)}constructor(e,t,i,a,r,n,o){this._dataSdk=e,this._renderManager=t,this._ensureManager=i,this._draftPathStore=a,this._callbackOptions=r,this._resourceService=n,this._containerService=o}}k=(0,a.gn)([(0,a.fM)(5,r.c),(0,a.fM)(6,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===r.c?Object:r.c,void 0===n.t?Object:n.t])],k);var b=i("335534");class I{updateRenderManager(e){this._renderManager=e}async add(e,t,i){var a,r,n,o,c,u,h,f;let y;if(!this._renderManager)return(0,p.u_)(v.o.RenderManagerUndefined);let T=(0,l.oW)(""),k=(0,g.ty)(this._dataSdk,[{targetStart:t.start,duration:null!==(a=t.duration)&&void 0!==a?a:p.H6,trackIndex:t.trackIndex,newTrack:null!==(r=t.needInsertTargetTrack)&&void 0!==r&&r,type:"video"}]);if(!k.ok)return this._callbackOptions.toast(k.msg),T=(0,p.u_)(v.o.TrackLimit);let I=(0,d.Rl)(),{uiSegmentId:M}=this._callbackOptions.beforeAddSegment(e,t,I);try{let a;this._callbackOptions.beforeEnsureResource(e);try{a=e.type===S.r.Photo?await (0,_.pv)(e.value,this._ensureManager,this._renderManager,this._resourceService):await (0,_.q3)(e.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService)}catch(e){return m.t.error(e),(0,l.oi)(e)&&e.code===b.D.OrderFailedFE?(null===(n=(o=this._callbackOptions).onOrderError)||void 0===n||n.call(o,e),T=(0,p.u_)(v.o.OrderFailed)):T=(0,p.u_)(v.o.EnsureResource),T}finally{this._callbackOptions.afterEnsureResource(e,a)}if(!a)return T=(0,p.u_)(v.o.MissResource);if(e.type===S.r.UserPhoto){let t=await (null===(u=e.value)||void 0===u?void 0:null===(c=u.addModelToDraft)||void 0===c?void 0:c.call(u));if(t&&!t.ok)return T=(0,p.u_)(v.o.MissResource)}let r=await this._renderManager.getMediaFileInfo(a.resPath,null!==(h=a.decryptKey)&&void 0!==h?h:"");if(!r)return T=(0,p.u_)(v.o.GetMediaFileInfo);let g=this._dataSdk.api.batch.batchStart();try{if(t.needInsertTargetTrack){let e=(0,p.HU)(this._dataSdk);if(!e.ok||0!==t.trackIndex&&!(e=this._dataSdk.api.track.add({trackIndex:t.trackIndex,track:new s.fQ8({id:(0,d.Rl)(),type:s.pNd.TrackTypeVideo,flag:s.w9k.FlagSubVideo})})).ok)return T=(0,p.u_)(v.o.AddTrack)}if(y=e.type===S.r.Photo?this._resourceToPhotoParam(e.value,t,I,a.segmentPath,r,i):this._userResourceToPhotoParam(e.value,t,I,a.segmentPath,r,i),!(T=this._dataSdk.api.video.add({trackIndex:t.trackIndex,videos:[y]})).ok)return T=(0,p.u_)(v.o.AddSegment);null==i||null===(f=i.batchTask)||void 0===f||f.call(i)}catch(e){return m.t.error(e),T=(0,p.u_)(v.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(g)}}catch(e){m.t.error(e),T=(0,p.u_)(v.o.Unknown)}finally{this._callbackOptions.afterAddSegment(T.ok?null==y?void 0:y.segmentId:void 0,M)}return T}addToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;if(!this._renderManager)return(0,p.u_)(v.o.RenderManagerUndefined);let a=!this._dataSdk.draftView.getMainTrack(),r=0,n=(0,y.i1)(this._renderManager.progress);return t?n=(0,p.Pr)(this._dataSdk,n):{needToInsert:a,trackIndex:r}=this._dataSdk.draftView.findTrackIndexToInsert(s.pNd.TrackTypeVideo,n,p.H6),this.add(e,{start:n,trackIndex:r,needInsertTargetTrack:a},i)}_resourceToPhotoParam(e,t,i,a,r,n){var o,d,l,c;return(0,s.lFK)({segmentId:i,path:a,materialName:e.title,startTime:t.start,duration:null!==(l=t.duration)&&void 0!==l?l:p.H6,sourceStartTime:0n,sourceDuration:0n,materialId:e.resourceId,originMaterialId:null===(o=e.order)||void 0===o?void 0:o.id,source:e.source,sourcePlatform:T.t.toSourcePlatform(null!==(c=null===(d=e.order)||void 0===d?void 0:d.source)&&void 0!==c?c:e.source,e.publishSource),categoryId:null==n?void 0:n.materialThirdcategoryId,categoryName:null==n?void 0:n.materialThirdcategory,mediaInfo:r,teamId:e.workspaceId})}_userResourceToPhotoParam(e,t,i,a,r,n){var o;return(0,c.Y2)(e.fileType===u.YB.Image),(0,s.lFK)({segmentId:i,path:a,materialName:e.filename,startTime:t.start,duration:null!==(o=t.duration)&&void 0!==o?o:p.H6,sourceStartTime:0n,sourceDuration:0n,materialId:"",originMaterialId:"",source:void 0,sourcePlatform:void 0,categoryId:null==n?void 0:n.materialThirdcategoryId,categoryName:null==n?void 0:n.materialThirdcategory,mediaInfo:r})}constructor(e,t,i,a,r,n,o){this._dataSdk=e,this._renderManager=t,this._ensureManager=i,this._draftPathStore=a,this._callbackOptions=r,this._resourceService=n,this._containerService=o}}I=(0,a.gn)([(0,a.fM)(5,r.c),(0,a.fM)(6,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===r.c?Object:r.c,void 0===n.t?Object:n.t])],I);var M=i("687271"),w=i("231502"),P=i("650127"),D=i("670010"),A=i("899452"),R=i("815525"),x=i("808909"),F=i("501205"),E=i("282193"),O=i("728517");function C(e,t,i){let a=i.value;return i.value=async function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=performance.now(),n=await a.apply(this,t);return n.performanceDuration=performance.now()-r,n},i}class V{updateRenderManager(e){this._addVideoSegmentHelper.updateRenderManager(e),this._addPhotoSegmentHelper.updateRenderManager(e),this._addAudioSegmentHelper.updateRenderManager(e),this._addStickerSegmentHelper.updateRenderManager(e),this._addFilterSegmentHelper.updateRenderManager(e),this._addEffectSegmentHelper.updateRenderManager(e),this._addTextSegmentHelper.updateRenderManager(e),this._addTextTemplateSegmentHelper.updateRenderManager(e),this._addTransitionHelper.updateRenderManager(e),this._addVideoTemplateSegmentHelper.updateRenderManager(e),this._addDigitalHumanSegmentHelper.updateRenderManager(e),this._addAdjustmentPresetSegmentHelper.updateRenderManager(e)}async addVideo(e,t,i){return{result:await this._addVideoSegmentHelper.add({type:S.r.Video,value:e},t,i),performanceDuration:0}}async batchAddVideo(e,t,i){return{result:await this._addVideoSegmentHelper.batchAdd(e,t,i),performanceDuration:0}}addVideoBySegment(e,t){return this._addVideoSegmentHelper.addBySegment(e,t)}async addVideoToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return{result:await this._addVideoSegmentHelper.addToCurrentProgress({type:S.r.Video,value:e},t,i),performanceDuration:0}}async addUserVideo(e,t,i){return{result:await this._addVideoSegmentHelper.add({type:S.r.UserVideo,value:e},t,i),performanceDuration:0}}async addUserVideoToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{result:await this._addVideoSegmentHelper.addToCurrentProgress({type:S.r.UserVideo,value:e},t),performanceDuration:0}}async addGif(e,t){return{result:await this._addVideoSegmentHelper.add({type:S.r.Gif,value:e},t),performanceDuration:0}}async addGifToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{result:await this._addVideoSegmentHelper.addToCurrentProgress({type:S.r.Gif,value:e},t),performanceDuration:0}}async addPhoto(e,t,i){return{result:await this._addPhotoSegmentHelper.add({type:S.r.Photo,value:e},t,i),performanceDuration:0}}async addPhotoToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return{result:await this._addPhotoSegmentHelper.addToCurrentProgress({type:S.r.Photo,value:e},t,i),performanceDuration:0}}async addUserPhoto(e,t,i){return{result:await this._addPhotoSegmentHelper.add({type:S.r.UserPhoto,value:e},t,i),performanceDuration:0}}async addUserPhotoToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return{result:await this._addPhotoSegmentHelper.addToCurrentProgress({type:S.r.UserPhoto,value:e},t,i),performanceDuration:0}}async addAudio(e,t,i){return{result:await this._addAudioSegmentHelper.add({type:S.r.Audio,value:e},t,i),performanceDuration:0}}async addAdjustemtPreset(e,t,i){return{result:await this._addAdjustmentPresetSegmentHelper.add({type:S.r.AdjustmentPreset,value:e},t,i),performanceDuration:0}}async addAdjustemtPresetToCurrentProgress(e,t){return{result:await this._addAdjustmentPresetSegmentHelper.addToCurrentProgress({type:S.r.AdjustmentPreset,value:e},t),performanceDuration:0}}async batchAddAudio(e,t,i){return{result:await this._addAudioSegmentHelper.batchAdd(e,t,i),performanceDuration:0}}addAudioBySegment(e,t){return this._addAudioSegmentHelper.addBySegment(e,t)}async addUserAudio(e,t){return{result:await this._addAudioSegmentHelper.add({type:S.r.UserAudio,value:e},t),performanceDuration:0}}async addAudioToCurrentProgress(e,t){return{result:await this._addAudioSegmentHelper.addToCurrentProgress({type:S.r.Audio,value:e},t),performanceDuration:0}}async addUserAudioToCurrentProgress(e){return{result:await this._addAudioSegmentHelper.addToCurrentProgress({type:S.r.UserAudio,value:e}),performanceDuration:0}}async addSticker(e,t,i){return{result:await this._addStickerSegmentHelper.add({type:S.r.Sticker,value:e},t,i),performanceDuration:0}}async addStickerToCurrentProgress(e,t){return{result:await this._addStickerSegmentHelper.addToCurrentProgress({type:S.r.Sticker,value:e},t),performanceDuration:0}}async addFilter(e,t,i){return{result:await this._addFilterSegmentHelper.add({type:S.r.Filter,value:e},t,i),performanceDuration:0}}async addFilterToCurrentProgress(e,t){return{result:await this._addFilterSegmentHelper.addToCurrentProgress({type:S.r.Filter,value:e},t),performanceDuration:0}}async addEffect(e,t,i){return{result:await this._addEffectSegmentHelper.add({value:e,type:S.r.Effects},t,i),performanceDuration:0}}async addEffectToCurrentProgress(e,t){return{result:await this._addEffectSegmentHelper.addToCurrentProgress({value:e,type:S.r.Effects},t),performanceDuration:0}}async addText(e,t,i){return{result:await this._addTextSegmentHelper.add({type:S.r.BasicText,value:e},t,i),performanceDuration:0}}async addTextPreset(e,t,i){return{result:await this._addTextSegmentHelper.add({type:S.r.TextPreset,value:e},t,i),performanceDuration:0}}async addBrandTextPreset(e,t,i){return{result:await this._addTextSegmentHelper.add({type:S.r.BrandText,value:e},t,i),performanceDuration:0}}async addTextToCurrentProgress(e,t){return{result:await this._addTextSegmentHelper.addToCurrentProgress({type:S.r.BasicText,value:e},t),performanceDuration:0}}async addBrandTextToCurrentProgress(e,t){return{result:await this._addTextSegmentHelper.addToCurrentProgress({type:S.r.BrandText,value:e},t),performanceDuration:0}}async addTextPresetToCurrentProgress(e,t){return{result:await this._addTextSegmentHelper.addToCurrentProgress({type:S.r.TextPreset,value:e},t),performanceDuration:0}}async addTextToCurrentProgressBySegmentId(e,t,i){return{result:await this._addTextSegmentHelper.addToCurrentProgressBySegmentId({type:S.r.BasicText,value:e},t,i),performanceDuration:0}}async addTextPresetToCurrentProgressBySegmentId(e,t,i){return{result:await this._addTextSegmentHelper.addToCurrentProgressBySegmentId({type:S.r.TextPreset,value:e},t,i),performanceDuration:0}}async addTextTemplate(e,t,i){return{result:await this._addTextTemplateSegmentHelper.add({type:S.r.TextTemplate,value:e},t,i),performanceDuration:0}}async addTextTemplateToCurrentProgress(e,t){return{result:await this._addTextTemplateSegmentHelper.addToCurrentProgress({type:S.r.TextTemplate,value:e},t),performanceDuration:0}}async addTransition(e,t,i){return{result:await this._addTransitionHelper.add({type:S.r.Transition,value:e},t,i),performanceDuration:0}}async addTransitionToCurrentProgress(e,t){return{result:await this._addTransitionHelper.addToCurrentProgress({type:S.r.Transition,value:e},t),performanceDuration:0}}async addTransitionToCurrentProgressBySegment(e,t,i){return{result:await this._addTransitionHelper.addToCurrentProgressBySegment({type:S.r.Transition,value:e},t,i),performanceDuration:0}}addSubtitles(e){return this._addCaptionSegmentHelper.addSubtitles(e)}addLyrics(e){return this._addCaptionSegmentHelper.addLyrics(e)}async addVideoTemplate(e,t,i){return{result:await this._addVideoTemplateSegmentHelper.add({type:S.r.VideoTemplate,value:e},t,i),performanceDuration:0}}async addVideoTemplateToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return{result:await this._addVideoTemplateSegmentHelper.addToCurrentProgress({type:S.r.VideoTemplate,value:e},t,i),performanceDuration:0}}async addDigitalHuman(e,t,i){return{result:await this._addDigitalHumanSegmentHelper.add({type:S.r.DigitalHuman,value:e},t,i),performanceDuration:0}}async addDigitalHumanToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return{result:await this._addDigitalHumanSegmentHelper.addToCurrentProgress({type:S.r.DigitalHuman,value:e},t,i),performanceDuration:0}}constructor(e,t,i,a,r,n,s,d,l){this._dataSdk=e,this._ensureManager=i,this._preloadManager=a,this._selection=r,this._draftPathStore=n,this._callbackOptions=s,this._resourceService=d,this._containerService=l,this._addVideoSegmentHelper=new o.v(this._dataSdk,t,this._ensureManager,this._draftPathStore,this._callbackOptions,this._resourceService,this._containerService),this._addPhotoSegmentHelper=this._containerService.createInstance(I,this._dataSdk,t,this._ensureManager,this._draftPathStore,this._callbackOptions),this._addAudioSegmentHelper=this._containerService.createInstance(k,this._dataSdk,t,this._ensureManager,this._draftPathStore,this._callbackOptions),this._addStickerSegmentHelper=this._containerService.createInstance(M.Q,this._dataSdk,t,this._ensureManager,this._callbackOptions),this._addFilterSegmentHelper=this._containerService.createInstance(P.n,this._dataSdk,t,this._ensureManager,this._callbackOptions),this._addEffectSegmentHelper=this._containerService.createInstance(w.v,this._dataSdk,t,this._ensureManager,this._callbackOptions),this._addTextSegmentHelper=this._containerService.createInstance(D.D,this._dataSdk,t,this._ensureManager,this._selection,this._callbackOptions),this._addTextTemplateSegmentHelper=this._containerService.createInstance(A.n,this._dataSdk,t,this._ensureManager,this._callbackOptions),this._addTransitionHelper=this._containerService.createInstance(x.x,this._dataSdk,t,this._ensureManager,this._callbackOptions),this._addCaptionSegmentHelper=this._containerService.createInstance(F.U,this._dataSdk,this._callbackOptions),this._addVideoTemplateSegmentHelper=this._containerService.createInstance(R.z,this._dataSdk,t,this._ensureManager,this._preloadManager,this._callbackOptions),this._addDigitalHumanSegmentHelper=this._containerService.createInstance(E.x,this._dataSdk,t,this._ensureManager,this._callbackOptions),this._addAdjustmentPresetSegmentHelper=this._containerService.createInstance(O.Z,this._dataSdk,t,this._ensureManager,this._callbackOptions)}}(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVideo?Object:IVideo,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddVideoOptions?Object:IAddVideoOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addVideo",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Array,"undefined"==typeof PositionActionParam?Object:PositionActionParam,Array]),(0,a.w6)("design:returntype",Promise)],V.prototype,"batchAddVideo",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVideo?Object:IVideo,void 0,"undefined"==typeof IAddVideoOptions?Object:IAddVideoOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addVideoToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserVideoLifecycleModel?Object:IUserVideoLifecycleModel,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddVideoOptions?Object:IAddVideoOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addUserVideo",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserVideoLifecycleModel?Object:IUserVideoLifecycleModel,void 0]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addUserVideoToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IGif?Object:IGif,"undefined"==typeof PositionActionParam?Object:PositionActionParam]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addGif",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IGif?Object:IGif,void 0]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addGifToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IPhoto?Object:IPhoto,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddPhotoOptions?Object:IAddPhotoOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addPhoto",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IPhoto?Object:IPhoto,void 0,"undefined"==typeof IAddPhotoOptions?Object:IAddPhotoOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addPhotoToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserPhotoLifecycleModel?Object:IUserPhotoLifecycleModel,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddPhotoOptions?Object:IAddPhotoOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addUserPhoto",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserPhotoLifecycleModel?Object:IUserPhotoLifecycleModel,void 0,"undefined"==typeof IAddPhotoOptions?Object:IAddPhotoOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addUserPhotoToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IAudio?Object:IAudio,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddAudioOptions?Object:IAddAudioOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addAudio",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IBrandAdjustmentPreset?Object:IBrandAdjustmentPreset,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddAdjustmentPresetOptions?Object:IAddAdjustmentPresetOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addAdjustemtPreset",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IBrandAdjustmentPreset?Object:IBrandAdjustmentPreset,"undefined"==typeof IAddAdjustmentPresetOptions?Object:IAddAdjustmentPresetOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addAdjustemtPresetToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Array,"undefined"==typeof PositionActionParam?Object:PositionActionParam,Array]),(0,a.w6)("design:returntype",Promise)],V.prototype,"batchAddAudio",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserAudioLifecycleModel?Object:IUserAudioLifecycleModel,"undefined"==typeof PositionActionParam?Object:PositionActionParam]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addUserAudio",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IAudio?Object:IAudio,"undefined"==typeof IAddAudioOptions?Object:IAddAudioOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addAudioToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserAudioLifecycleModel?Object:IUserAudioLifecycleModel]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addUserAudioToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ISticker?Object:ISticker,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddStickerOptions?Object:IAddStickerOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addSticker",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ISticker?Object:ISticker,"undefined"==typeof IAddStickerOptions?Object:IAddStickerOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addStickerToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IFilter?Object:IFilter,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddFilterOptions?Object:IAddFilterOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addFilter",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IFilter?Object:IFilter,"undefined"==typeof IAddFilterOptions?Object:IAddFilterOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addFilterToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IEffect?Object:IEffect,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddEffectOptions?Object:IAddEffectOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addEffect",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IEffect?Object:IEffect,"undefined"==typeof IAddEffectOptions?Object:IAddEffectOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addEffectToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof BasicTextSource?Object:BasicTextSource,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addText",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITextPreset?Object:ITextPreset,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTextPreset",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITextPreset?Object:ITextPreset,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addBrandTextPreset",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof BasicTextSource?Object:BasicTextSource,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTextToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITextPreset?Object:ITextPreset,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addBrandTextToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITextPreset?Object:ITextPreset,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTextPresetToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof BasicTextSource?Object:BasicTextSource,String,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTextToCurrentProgressBySegmentId",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITextPreset?Object:ITextPreset,String,"undefined"==typeof IAddTextOptions?Object:IAddTextOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTextPresetToCurrentProgressBySegmentId",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITextTemplate?Object:ITextTemplate,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddTextTemplateOptions?Object:IAddTextTemplateOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTextTemplate",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITextTemplate?Object:ITextTemplate,"undefined"==typeof IAddTextTemplateOptions?Object:IAddTextTemplateOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTextTemplateToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITransition?Object:ITransition,"undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof IAddTransitionOptions?Object:IAddTransitionOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTransition",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITransition?Object:ITransition,"undefined"==typeof IAddTransitionOptions?Object:IAddTransitionOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTransitionToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITransition?Object:ITransition,"undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof IAddTransitionOptions?Object:IAddTransitionOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addTransitionToCurrentProgressBySegment",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVideoTemplate?Object:IVideoTemplate,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddVideoTemplateOptions?Object:IAddVideoTemplateOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addVideoTemplate",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IVideoTemplate?Object:IVideoTemplate,void 0,"undefined"==typeof IAddVideoTemplateOptions?Object:IAddVideoTemplateOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addVideoTemplateToCurrentProgress",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDigitalHuman?Object:IDigitalHuman,"undefined"==typeof PositionActionParam?Object:PositionActionParam,"undefined"==typeof IAddDigitalHumanOptions?Object:IAddDigitalHumanOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addDigitalHuman",null),(0,a.gn)([C,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDigitalHuman?Object:IDigitalHuman,Boolean,"undefined"==typeof IAddDigitalHumanOptions?Object:IAddDigitalHumanOptions]),(0,a.w6)("design:returntype",Promise)],V.prototype,"addDigitalHumanToCurrentProgress",null),V=(0,a.gn)([(0,a.fM)(7,r.c),(0,a.fM)(8,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IPreloadManager?Object:IPreloadManager,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===r.c?Object:r.c,void 0===n.t?Object:n.t])],V)},815525:function(e,t,i){i.d(t,{j:function(){return f},z:function(){return v}});var a=i(789786),r=i(426336),n=i(932099),o=i(593642),s=i(690613),d=i(909034),l=i(827084),c=i(433140),u=i(127830),h=i(298730),p=i(756024),_=i(82978),g=i(857670),m=i(108692);async function f(e,t){let i=r.y4D.GetMutableVideos(e,""),a=(0,r.GUA)(e),n=[],o=[];for(let e=0;e<i.length;){var s,d,l,c,u,h;let n=i[e],p=(0,r.dlx)(null!==(u=null===(s=t.resourceRecords.getRecordBySegmentPath(n.path))||void 0===s?void 0:s.resPath)&&void 0!==u?u:"",null!==(h=null===(d=t.resourceRecords.getRecordBySegmentPath(a.get(n.id).coverPath))||void 0===d?void 0:d.resPath)&&void 0!==h?h:"");if((null===(l=t.resourceRecords.getRecordBySegmentPath(n.path))||void 0===l?void 0:l.resPath)&&(null===(c=t.resourceRecords.getRecordBySegmentPath(n.path))||void 0===c?void 0:c.resPath)===p){i.splice(e,1);continue}o.push(t.getMediaFileInfo(p,"")),++e}let p=await Promise.all(o);for(let t=0;t<i.length;t++){let o=i[t],s=p[t];if(!s)continue;let d=e.getSegmentById(o.segmentId);if(!!d&&!!(0,r.hey)(d)){if(d&&(0,r.hey)(d)){let e={id:o.id,path:a.get(o.id).coverPath,originalPath:o.path,crop:o.crop,sourceStart:o.sourceStart,sourcePlatform:o.sourcePlatform,materialId:o.materialId,originMaterialId:o.originMaterialId,materialName:o.materialName,volume:o.volume,initialSpeed:d.speed.speed,width:s.width,height:s.height,duration:s.duration,rotation:s.rotation,mediaType:s.type,isMutable:!0};n.push(e)}}}return n}class v{updateRenderManager(e){this._renderManager=e}async add(e,t,i){var a;let c;if(!this._renderManager)return(0,n.u_)(_.o.RenderManagerUndefined);let g=(0,s.oW)(""),m=(0,h.ty)(this._dataSdk,[{targetStart:t.start,duration:(0,r.k3U)(e.value.duration,1000000n,"bigint"),trackIndex:t.trackIndex,newTrack:null!==(a=t.needInsertTargetTrack)&&void 0!==a&&a,type:"combination"}]);if(!m.ok)return this._callbackOptions.toast(m.msg),g=(0,n.u_)(_.o.TrackLimit);let f=(0,o.Rl)(),{uiSegmentId:v}=this._callbackOptions.beforeAddSegment(e,t,f);try{let a,s;let h=(0,l.Bc)(e.value.id);this._resourceService.add(h,{key:h,type:u._g.VideoTemplate,id:e.value.id});let m=this._resourceService.get(h,u._g.VideoTemplate);this._callbackOptions.beforeEnsureResource(e);try{a=await (0,d.X7)(m,this._preloadManager,this._ensureManager,this._renderManager.fs),{videoTemplate:e.value,originVideoAlgorithmInfo:s}=a}catch(e){return p.t.error(e),g=(0,n.u_)(_.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e)}let{draft:v}=a;if(a.preloadMaterialItems&&this._preloadManager.syncTemplateResources(e.value.id,a.preloadMaterialItems,void 0,e=>{e.forEach(e=>{let{key:t,md5:i,newMd5:a}=e;if(i&&a&&e.md5!==e.newMd5){let e=this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(t),i=this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(a);e&&i&&e!==i&&c&&this._dataSdk.api.segment.innerReplace({draftId:c.subDraftVideoDocument.getDraftId(),identifier:{material:{path:e}},substitute:{material:{path:i}}})}})}),!(c=await this._resourceToTemplateCombinationAddParams(e.value,t,f,v,i)))return g=(0,n.u_)(_.o.SubDraftError);c.originVideoAlgorithmInfo=s;let y=this._dataSdk.api.batch.batchStart();try{if(t.needInsertTargetTrack){let e=(0,n.HU)(this._dataSdk);if(!e.ok||0!==t.trackIndex&&!(e=this._dataSdk.api.track.add({trackIndex:t.trackIndex,track:new r.fQ8({id:(0,o.Rl)(),type:r.pNd.TrackTypeVideo,flag:r.w9k.FlagSubVideo})})).ok)return g=(0,n.u_)(_.o.AddTrack)}if(!(g=this._dataSdk.api.templateCombination.templateCombinationAdd(c)).ok)return g=(0,n.u_)(_.o.AddSegment)}catch(e){return p.t.error(e),g=(0,n.u_)(_.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(y)}}catch(e){p.t.error(e),g=(0,n.u_)(_.o.Unknown)}finally{this._callbackOptions.afterAddSegment(g.ok?null==c?void 0:c.segmentId:void 0,v)}return g}addToCurrentProgress(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;if(!this._renderManager)return(0,n.u_)(_.o.RenderManagerUndefined);let a=!this._dataSdk.draftView.getMainTrack(),o=0,s=(0,g.i1)(this._renderManager.progress);return t?s=(0,n.Pr)(this._dataSdk,s):{needToInsert:a,trackIndex:o}=this._dataSdk.draftView.findTrackIndexToInsert(r.pNd.TrackTypeVideo,s,(0,r.k3U)(e.value.duration,1000000n,"bigint")),this.add(e,{start:s,trackIndex:o,needInsertTargetTrack:a},i)}async _resourceToTemplateCombinationAddParams(e,t,i,a,n){var s;let d;if(!this._renderManager)return;try{(d=a)&&(d=(0,r.MoK)(d))}catch(e){p.t.error(e)}if(!d)return;let l=r.pN8.deserialize(d),c=l.clone(!0),u=new r.wKd;u.fixMaterialDraftMutableConfig(l,c),u.fixVideoTrackingConfig(l,c);let h=new r.WuX({type:r.cVg.MetaTypeCombination,name:e.name,combinationId:(0,o.Rl)(),draft:c}),_=h.draft;_.property.maintrackAdsorb=!1,_.property.fps=this._dataSdk.draftView.getDraftProperty().fps,_.property.renderIndexTrackModeOn!==this._dataSdk.draftView.getDraftProperty().renderIndexTrackModeOn&&(_.property.renderIndexTrackModeOn?new r.eK().rebuildRenderIndexFromTrack(_,0):new r.eK().rebuildTrackFromRenderIndex(_)),_.property.renderIndexTrackModeOn=this._dataSdk.draftView.getDraftProperty().renderIndexTrackModeOn;let g=await f(_,this._renderManager);return{segmentId:i,type:r.pNd.TrackTypeVideo,duration:null!==(s=t.duration)&&void 0!==s?s:e.duration,startTime:t.start,trackIndex:t.trackIndex,draftContentStr:e.preload.json,templateId:e.id,needSetTemplateId:!0,templateScene:r.XOM.TemplateSceneDefault,size:{width:0,height:0},mute:e.mute,material:{materialName:e.name,categoryId:null==n?void 0:n.materialThirdcategoryId,categoryName:null==n?void 0:n.materialThirdcategory},workspace:r.P4R.ensureRootPath(""),subDraft:d,subDraftVideoDocument:_,materialDraft:h,setMutableVideosOptions:g}}constructor(e,t,i,a,r,n,o){this._dataSdk=e,this._renderManager=t,this._ensureManager=i,this._preloadManager=a,this._callbackOptions=r,this._resourceService=n,this._mainDraftService=o}}v=(0,a.gn)([(0,a.fM)(5,c.c),(0,a.fM)(6,m.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IPreloadManager?Object:IPreloadManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===c.c?Object:c.c,void 0===m.n?Object:m.n])],v)},932099:function(e,t,i){i.d(t,{B7:function(){return h},H6:function(){return c},HU:function(){return m},Pr:function(){return v},Ru:function(){return u},jA:function(){return f},n5:function(){return l},rk:function(){return p},u$:function(){return g},u_:function(){return y},zx:function(){return _}});var a=i(426336),r=i(593642),n=i(690613),o=i(300387),s=i(82978),d=i(857670);let l=13,c=5000000n,u=3000000n,h=3000000n,p=3000000n,_=3000000n,g=500000n;function m(e){return void 0===e.draftView.getMainTrack()?e.api.track.add({trackIndex:0,track:new a.fQ8({id:(0,r.Rl)(),type:a.pNd.TrackTypeVideo,flag:a.w9k.FlagNone})}):(0,n.ly)()}function f(e,t,i,r,n,s){var d,l,c;return{trackIndex:r,segmentId:n,timeRange:{start:t.start,duration:null!==(d=t.duration)&&void 0!==d?d:u},filter:(0,a.ABm)({path:i,name:e.name,effectId:e.effectId,resId:e.resourceId,value:1,categoryId:null!==(l=null==s?void 0:s.materialThirdcategoryId)&&void 0!==l?l:"",categoryName:null!==(c=null==s?void 0:s.materialThirdcategory)&&void 0!==c?c:"",sourcePlatform:o.t.formatEffectSourcePlatform(e.source)})}}function v(e,t){let i=e.draftView.getMainTrack();if(!i||0===i.segments.length)return 0n;for(let e of i.segments){let{start:i}=e.targetTimerange,a=e.targetTimerange.start+e.targetTimerange.duration,r=(0,d.i1)((i+a)/2n);if(t>=i&&t<r)return i;if(t>=r&&t<a)return a}return i.segments[i.segments.length-1].targetTimerange.start+i.segments[i.segments.length-1].targetTimerange.duration}function y(e){var t;return(0,n.wf)(e,null!==(t=s.i.get(e))&&void 0!==t?t:"")}},397163:function(e,t,i){i.d(t,{l:function(){return n}});var a=i(475590),r=i(690613);class n{updateRenderSdk(e){this._renderManager=e}async getImageFrame(e){let{blobUrl:t,filename:i}=e;try{let e=await this._getFileFromBlobUrl(t,i);await this._renderManager.insertBlob(t,e);let n=this._renderManager.getImageFrame(t),o=await (0,a.Hp)(()=>new Promise(e=>{let i=this._renderManager.onGetFrames(a=>{if(a.taskId===n){let r=document.createElement("canvas");r.width=a.width,r.height=a.height,r.getContext("2d").putImageData(new ImageData(a.imageData,a.width,a.height),0,0),r.toBlob(a=>{e(URL.createObjectURL(a)),this._renderManager.removeBlob(t),null==i||i.dispose()})}})}),6e4);if(o.ok)return(0,r.oW)({blobUrl:o.value});return(0,r.wf)(-1,null==o?void 0:o.msg)}catch(e){return(0,r.wf)(-1,null==e?void 0:e.message)}}_getFileFromBlobUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return fetch(e).then(e=>e.blob()).then(e=>new File([e],t))}}},318434:function(e,t,i){i.d(t,{s:()=>I});var a=i("789786"),r=i("999268"),n=i("641276"),o=i("402655"),s=i("426336"),d=i("160391"),l=i("230689"),c=i("425427"),u=i("896413"),h=i("800788"),p=i("827084"),_=i("798184"),g=i("877033"),m=i("273340"),f=i("433140"),v=i("430687"),y=i("462235"),S=i("537745"),T=i("127830"),k=i("50712");class b{hasCover(){return""!==this._draftCoverPath||void 0!==this._segment||""!==this._templateId||this._firstFrameAsCover}async getBase64Url(){if(void 0!==this._cacheUrl)return this._cacheUrl;if(!this.hasCover())return"";let e=await this._getCoverSource();return e.buffer||e.url?(this._cacheUrl=await (0,k.u)(e),this._cacheUrl):""}async _getCoverSource(){if(this._draftCoverPath){let e=this._draftPathStore.getResourceKeyFromDraftPath(this._draftCoverPath);(0,h.Y2)(e),console.log("[saving]","use draft cover");let t=await this._getBuffer(e,T._g.UserPhoto);return(0,h.ZB)(t),{buffer:t,width:this._width,height:this._height}}if(this._templateId)return{buffer:await this._getTemplateCoverBuffer(),width:this._width,height:this._height};if(this._firstFrameAsCover)return{url:await new Promise((e,t)=>{let i=this._mainEditorWidgetService.renderManager.getVideoFrames([{time:0n,callbackData:0}],this._width,this._height),a=this._mainEditorWidgetService.renderManager.onGetFrames(r=>{if(r.taskId===i){let i=document.createElement("canvas");i.width=this._width,i.height=this._height,i.getContext("2d").putImageData(new ImageData(r.imageData,r.width,r.height),0,0),i.toBlob(i=>{try{let t=URL.createObjectURL(i);e(t)}catch(e){t(e)}finally{null==a||a.dispose()}})}})}),width:this._width,height:this._height};if((0,h.ZB)(this._segment),this._segment.material.sourcePlatform===s.cvu.MaterialPlatformDefault){var e;console.log("[saving]","use cloud video segment");let t=this._draftPathStore.getResourceKeyFromDraftPath(this._segment.material.path);if(!t)return{width:this._width,height:this._height};return{buffer:await this._getBuffer(t,(e=this._segment.material).type===s.cVg.MetaTypePhoto||e.type===s.cVg.MetaTypeImage?T._g.UserPhoto:T._g.UserVideo),width:this._width,height:this._height}}let t=await this._getUrl(this._segment);return t?(console.log("[saving]","use online video segment"),{url:t,width:this._width,height:this._height}):{width:this._width,height:this._height}}_setCoverSegmentOrTemplateId(e){if((0,c.o2)(this._environmentService)){this._handleMultiTrackSegment(e);return}this._handleTemplateSegment(e)}_handleTemplateSegment(e){let t=e.cutSame.getMutableVideos(),i=this._findFirstVisibleSegmentInMutableVideos(e,t);if(i)this._segment=i;else{var a;this._templateId=null!==(a=this._templateManager.getTemplateId())&&void 0!==a?a:""}}_handleMultiTrackSegment(e){let t=e.draftView.getAllTracks();if(0===t.length)return;let i=t[0].segments[0];if(!!i&&!!(0,s.hey)(i)){if((0,s.duj)(i)){this._templateId=i.templateId;return}this._segment=i}}_findFirstVisibleSegmentInMutableVideos(e,t){let i=t.filter(e=>e.visible)[0];if(!i)return;let{segmentId:a}=i;if(!a)return;let r=e.draftView.getSegmentById(a);if(!!r){if(i.filled)return r}}async _getTemplateCoverBuffer(){let e=this._resourceService.get((0,p.Bc)(this._templateId),T._g.VideoTemplate);(0,h.ZB)(e);let t=e.getCoverResourceToken();return await (0,_.x)(t),(0,h.Y2)(t.value),t.value.buffer}async _getBuffer(e,t){let i=this._resourceService.get(e,t);if(!i)return;let a=i.getCoverResourceToken();return(await (0,_.x)(a),(0,h.Y2)(a.value),a.value.shouldAutoDecrypt||!a.value.decryptKey)?a.value.buffer:await (0,g.Z)(a.value.buffer,a.value.decryptKey)}_getUrl(e){if(e.material.type===s.cVg.MetaTypePhoto)return e.material.source===s.CHB.MaterialSourceTuchong?this._getUrlByOnlineTuchongPhoto(e.material.materialId,e.material.source):this._getUrlByOnlinePhoto(e.material.materialId);return e.material.type===s.cVg.MetaTypeGif?this._getUrlByOnlineGif(e.material.materialId):e.material.source===s.CHB.MaterialSourceTuchong?this._getUrlByOnlineTuchongVideo(e.material.materialId,e.material.source):(0,s.oP0)(e)?this._getUrlByOnlineDigitalHuman(e.material.materialId):this._getUrlByOnlineVideo(e.material.materialId)}async _getUrlByOnlineGif(e){let t=this._resourceService.get(e,T._g.Gif);if(!t)return"";let i=t.getCoverResourceToken();return await (0,_.x)(i),(0,h.Y2)(i.value),i.value.url}async _getUrlByOnlinePhoto(e){let t=await this._photoDataService.batchGetPhotos({resourceIds:[e]});return t.ok?t.value.list[0].coverUrl:""}async _getUrlByOnlineTuchongPhoto(e,t){let i=await this._photoDataService.batchGetTuchongPhotos({items:[{id:e,effectType:m.g.Image,source:t}]});return i.ok?i.value.list[0].coverUrl:""}async _getUrlByOnlineVideo(e){var t;let i=await this._videoDataService.batchGetVideos({resourceIds:[e]});if(!i.ok)return"";let a=i.value.list[0];return null!==(t=null==a?void 0:a.coverUrl)&&void 0!==t?t:""}async _getUrlByOnlineDigitalHuman(e){var t;let i=await this._digitalHumanDataService.getDigitalHumanByIds({resourceIds:[e]});if(!i.ok)return"";let a=i.value.list[0];return null!==(t=null==a?void 0:a.coverUrl)&&void 0!==t?t:""}async _getUrlByOnlineTuchongVideo(e,t){let i=await this._videoDataService.batchGetTuchongVideos({items:[{id:e,effectType:m.g.Video,source:t}]});return i.ok?i.value.list[0].coverUrl:""}constructor(e,t,i,a,r,n,o,s,d,l){this._templateManager=t,this._draftPathStore=i,this.firstFrameAsCover=a,this._environmentService=r,this._resourceService=n,this._videoDataService=o,this._photoDataService=s,this._digitalHumanDataService=d,this._mainEditorWidgetService=l,this._draftCoverPath="",this._templateId="",this._firstFrameAsCover=!1;let c=e.draftView.getCover();(null==c?void 0:c.imagePath)?this._draftCoverPath=c.imagePath:a?this._firstFrameAsCover=a:this._setCoverSegmentOrTemplateId(e);let u=e.draftView.getCanvasConfig();this._width=u.width,this._height=u.height}}b=(0,a.gn)([(0,a.fM)(4,c.rO),(0,a.fM)(5,f.c),(0,a.fM)(6,v.u),(0,a.fM)(7,y.B),(0,a.fM)(8,S.T),(0,a.fM)(9,u.a),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof IDraftTemplateManager?Object:IDraftTemplateManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,Boolean,void 0===c.rO?Object:c.rO,void 0===f.c?Object:f.c,void 0===v.u?Object:v.u,void 0===y.B?Object:y.B,void 0===S.T?Object:S.T,void 0===u.a?Object:u.a])],b);class I extends o.JT{async getCoverTask(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(await this._sharedMutex.lockShared(),this._sharedMutex.unLockShared(),this._needCover||e){let t=this._containerService.createInstance(b,this._dataSdk,this._templateManager,this._draftPathStore,e);this._lastCoverTask=t,this._needCover=!1}return this._lastCoverTask}async _waitInitCacheBase64Url(){await this._sharedMutex.lock(),(0,n.V)(this._lifecycleService.onRestored)(()=>{this._sharedMutex.unLock(),this._needCover=!0})}constructor(e,t,i,a,n){super(),this._dataSdk=e,this._templateManager=t,this._draftPathStore=i,this._containerService=a,this._lifecycleService=n,this._needCover=!0,this._sharedMutex=new r.L,this._waitInitCacheBase64Url(),this._register(this._dataSdk.onChangeCanvasSize(()=>{this._needCover=!0})),this._register(this._dataSdk.onChangeDiff(e=>{var t,i;if(e.actionOperateType===s.aWQ.History)return;if(e.isRecovery){this._needCover=!0;return}for(let t of e[s.u4I.CONFIG])if((null===(i=t.item.property)||void 0===i?void 0:i.staticCoverImagePath)!==void 0){this._needCover=!0;return}if((0!==e[s.u4I.SEGMENT].length||0!==e[s.u4I.TRACK].length)&&(null===(t=this._dataSdk.draftView.getCover())||void 0===t?!void 0:!t.imagePath))this._needCover=!0}))}}I=(0,a.gn)([(0,a.fM)(3,l.t),(0,a.fM)(4,d.g),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof IDraftTemplateManager?Object:IDraftTemplateManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===l.t?Object:l.t,void 0===d.g?Object:d.g])],I)},991817:function(e,t,i){i.d(t,{r:function(){return g}});var a=i(789786),r=i(800788),n=i(493359),o=i(948328),s=i(426020),d=i(315201),l=i(433140),c=i(230689),u=i(31463),h=i(127830),p=i(426336);class _{get value(){return this._result}push(e){var t;let i=`${e.md5}-${null!==(t=e.source_path)&&void 0!==t?t:""}-${e.meta}`;if(!this._set.has(i))this._result.push(e),this._set.add(i)}constructor(){this._result=[],this._set=new Set}}class g{addExternalAsset(e){this._externalAssets.set(e.md5,e)}removeExternalAsset(e){this._externalAssets.delete(e.md5)}buildPackageAssets(){var e,t,i,a,o,d;let{userGeneratedMaterials:l,autoGeneratedMaterials:c}=this._draftMaterialsService.getMaterials(),u=new _;for(let i of l)if(i.sourceType===s.ov.EverCloud){let a=null!==(e=this._draftPathStore.getDraftPathFromResourceKey(i.key))&&void 0!==e?e:"";if(!(0,n.KL)(i))continue;let r=this._referenceCountManager.getReferenceCount(a);r>0&&u.push({md5:i.md5,size:i.size,source_path:a,meta:JSON.stringify((null===(t=i.draftDelta)||void 0===t?void 0:t.meta)?i.draftDelta.meta:{visible:!0})}),r<0&&this._reportNoReferencesUserMaterials({material:i,count:r})}for(let e of c){if(!(0,n.KL)(e))continue;if((0,r.Y2)(e.sourceType===s.ov.EverCloud),p.gyO.includes(null!==(i=e.sourcePath)&&void 0!==i?i:e.filename)){u.push({md5:e.md5,size:e.size,source_path:null!==(o=e.sourcePath)&&void 0!==o?o:e.filename,meta:JSON.stringify(null===(a=e.draftDelta)||void 0===a?void 0:a.meta)});continue}let t=this._draftPathStore.getDraftPathFromResourceKey(e.key);if(!!t)0!==this._referenceCountManager.getReferenceCount(t)&&u.push({md5:e.md5,size:e.size,source_path:t,meta:JSON.stringify(null===(d=e.draftDelta)||void 0===d?void 0:d.meta)})}for(let[e,t]of this._externalAssets)u.push(t);return this._addTemplateAssets(u),u.value}_addTemplateAssets(e){let t=this._dataSdk.draftView.getAllSubDraft(!0).map(e=>e.getDraftId());for(let a of(t.push(this._dataSdk.draftView.getDraftId()),t))for(let t of this._dataSdk.cutSame.getMutableVideos(a)){var i;let{coverPath:a}=t,r=this._draftPathStore.getResourceKeyFromDraftPath(a);if(!r)continue;let n=this._resourceService.get(r,h._g.UserPhoto);if(!n||!(0,d.R)(n.value))continue;let o=n.value;e.push({md5:o.md5,size:o.size,source_path:a,meta:JSON.stringify(null===(i=o.draftDelta)||void 0===i?void 0:i.meta)})}}_reportNoReferencesUserMaterials(e){let{material:t,count:i}=e,a={md5:t.md5,id:t.id,status:t.status,file_type:t.fileType,source_type:t.sourceType,name:t.filename,url:t.url,count:i,asset_id:""};t.sourceType===s.ov.EverCloud&&(a.asset_id=t.assetId),this._reportService.reportDevEvent("no_references_user_materials",a)}constructor(e,t,i,a,r,n,o){this._draftPathStore=e,this._referenceCountManager=t,this._dataSdk=i,this._draftMaterialsService=a,this._resourceService=r,this._containerService=n,this._reportService=o,this._externalAssets=new Map}}g=(0,a.gn)([(0,a.fM)(3,o.D),(0,a.fM)(4,l.c),(0,a.fM)(5,c.t),(0,a.fM)(6,u.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IReferenceCountManager?Object:IReferenceCountManager,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===o.D?Object:o.D,void 0===l.c?Object:l.c,void 0===c.t?Object:c.t,void 0===u.m?Object:u.m])],g)},473595:function(e,t,i){i.d(t,{f:function(){return a}});let a=new class e{add(e,t){this._map.set(e,t)}get(e){return this._map.get(e)}del(e){return this._map.delete(e)}constructor(){this._map=new Map}}},235248:function(e,t,i){i.d(t,{D:function(){return n}});var a=i(426336),r=i(444381);class n extends r.M{_findPath(e){var t,i,r;return(0,a.hey)(e)?null!==(r=null===(i=e.figures[0])||void 0===i?void 0:null===(t=i.algorithmArtifactPath)||void 0===t?void 0:t.replace(/^\/__opfs_system_root\//,""))&&void 0!==r?r:"":""}}},328100:function(e,t,i){i.d(t,{S:function(){return n}});var a=i(426336),r=i(444381);class n extends r.M{_findPath(e){return(0,a.hey)(e)?e.material.reversePath:""}}},629982:function(e,t,i){i.d(t,{m:function(){return n}});var a=i(426336),r=i(444381);class n extends r.M{_findPath(e){return(0,a.hey)(e)?e.background.image:""}}},932762:function(e,t,i){i.d(t,{G:function(){return v}});var a=i(789786),r=i(460254),n=i(335534),o=i(426020),s=i(433140),d=i(230689),l=i(909034),c=i(426336),u=i(919111),h=i(690613),p=i(800788),_=i(756024),g=i(322401),m=i(789193),f=i(380455);class v{updateRenderManager(e){this._renderManager=e}async replace(e){var t,i,a,o,s,d,u;if(!this._renderManager)return(0,g.$)(m.F.RenderManagerUndefined);try{let n,d=Promise.resolve(void 0);try{switch(e.type){case r.r.Video:d=(0,l.y$)(e.value,this._ensureManager,this._renderManager,this._resourceService);break;case r.r.UserVideo:d=(0,l.ti)(e.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService);break;case r.r.Photo:d=(0,l.pv)(e.value,this._ensureManager,this._renderManager,this._resourceService);break;case r.r.UserPhoto:d=(0,l.q3)(e.value,this._dataSdk,this._ensureManager,this._renderManager,this._draftPathStore,this._resourceService,this._containerService);break;case r.r.Gif:d=(0,l.M3)(e.value,this._ensureManager,this._renderManager,this._resourceService);break;default:(0,p.bP)(e,"option type error")}}catch(e){return _.t.error(e),(0,g.$)(m.F.EnsureResource)}let u=await d;if(!u)return(0,g.$)(m.F.MissResource);let h=await this._renderManager.getMediaFileInfo(u.resPath,null!==(t=u.decryptKey)&&void 0!==t?t:"");if(!h)return(0,g.$)(m.F.GetMediaFileInfo);switch(e.type){case r.r.Video:case r.r.Photo:n=this._resourceToVideoParam(e.value,u.segmentPath,h,e);break;case r.r.UserVideo:case r.r.UserPhoto:n=this._userResourceToVideoParam(e.value,u.segmentPath,h,e);let f=await (null===(a=e.value)||void 0===a?void 0:null===(i=a.addModelToDraft)||void 0===i?void 0:i.call(a));if(f&&!f.ok)return(0,g.$)(m.F.MissResource);break;case r.r.Gif:n=this._gifResourceToVideoParam(e.value,u.segmentPath,h,e);break;default:(0,p.bP)(e,"option type error")}let v=this._dataSdk.api.batch.batchStart();for(let e of n.segIds){let t=this._dataSdk.draftView.getSegmentById(e);t&&((0,c.Y9Q)(t)||(0,c.hey)(t))&&(null===(s=t.voiceChange)||void 0===s?void 0:null===(o=s[0])||void 0===o?void 0:o.subType)===c.xbm.AudioEffectTypeVCVoiceChange&&this._dataSdk.api.audio.clearVoiceEffect({segmentId:e})}let y=this._dataSdk.api.video.setMaterial(n);if(this._dataSdk.api.batch.batchEnd(v),!y.ok)return(0,g.$)(m.F.ReplaceSegment)}catch(e){if(_.t.error(e),(0,h.oi)(e)&&e.code===n.D.OrderFailedFE)return null===(d=(u=this._callbackOptions).onOrderError)||void 0===d||d.call(u,e),(0,g.$)(m.F.OrderFailed);return(0,g.$)(m.F.Unknown)}finally{}return(0,h.ly)()}_resourceToVideoParam(e,t,i,a){return{segIds:a.segmentIds,video:{path:t,type:a.type===r.r.Photo?c.cVg.MetaTypePhoto:c.cVg.MetaTypeVideo,materialName:"video clip",startTime:a.targetStartTime,duration:i.duration,sourceStartTime:a.sourceStartTime,sourceDuration:a.sourceDuration,materialId:e.resourceId,size:{width:i.width,height:i.height},hasAudio:"AudioVideo"===i.type,source:e.source,sourcePlatform:f.t.toSourcePlatform(e.source,e.publishSource)}}}_userResourceToVideoParam(e,t,i,a){return(0,p.Y2)(e.fileType===o.YB.Video||e.fileType===o.YB.Image),{segIds:a.segmentIds,video:{path:t,type:e.fileType===o.YB.Image?c.cVg.MetaTypePhoto:c.cVg.MetaTypeVideo,materialName:e.filename,hasAudio:"AudioVideo"===i.type,startTime:a.targetStartTime,duration:i.duration,sourceStartTime:a.sourceStartTime,sourceDuration:a.sourceDuration,materialId:e.key,size:{width:i.width,height:i.height},source:void 0,sourcePlatform:c.cvu.MaterialPlatformDefault}}}_gifResourceToVideoParam(e,t,i,a){return{segIds:a.segmentIds,video:{path:t,type:c.cVg.MetaTypeGif,materialName:e.name,hasAudio:"AudioVideo"===i.type,startTime:a.targetStartTime,duration:a.targetDuration,sourceStartTime:a.sourceStartTime,sourceDuration:a.sourceDuration,materialId:e.id,size:{width:i.width,height:i.height},source:void 0,sourcePlatform:c.cvu.MaterialPlatformGiphy}}}constructor(e,t,i,a,r,n,o){this._dataSdk=e,this._renderManager=t,this._draftPathStore=i,this._ensureManager=a,this._callbackOptions=r,this._resourceService=n,this._containerService=o}}v=(0,a.gn)([(0,a.fM)(5,s.c),(0,a.fM)(6,d.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,void 0===u.H?Object:u.H,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IReplaceSegmentCallbackOptions?Object:IReplaceSegmentCallbackOptions,void 0===s.c?Object:s.c,void 0===d.t?Object:d.t])],v)},789193:function(e,t,i){i.d(t,{F:function(){return r},x:function(){return n}});var a,r=((a={})[a.NoError=0]="NoError",a[a.TransitionSegmentLimit=1]="TransitionSegmentLimit",a[a.TransitionDurationLimit=2]="TransitionDurationLimit",a[a.EnsureResource=3]="EnsureResource",a[a.MissResource=4]="MissResource",a[a.GetMediaFileInfo=5]="GetMediaFileInfo",a[a.ReplaceSegment=6]="ReplaceSegment",a[a.ReplaceCheck=7]="ReplaceCheck",a[a.RenderManagerUndefined=8]="RenderManagerUndefined",a[a.OrderFailed=9]="OrderFailed",a[a.Unknown=10]="Unknown",a);let n=new Map([[0,"No error"],[1,"Transition segment limit error"],[2,"Transition duration limit error"],[3,"Ensure resource error"],[4,"Miss resource error"],[5,"Get media file info error"],[6,"Replace segment error"],[7,"Replace check error"],[8,"Render manager undefined"],[9,"Failed to order adobe / pond5 material"],[10,"Unknown error"]])},909034:function(e,t,i){i.d(t,{C_:function(){return b},Gx:function(){return U},M3:function(){return D},RN:function(){return R},X7:function(){return z},Z0:function(){return x},_s:function(){return N},j1:function(){return E},kF:function(){return B},mr:function(){return j},nP:function(){return A},oi:function(){return G},pv:function(){return O},q3:function(){return C},rj:function(){return F},sT:function(){return W},ti:function(){return P},v5:function(){return V},wA:function(){return L},y$:function(){return w}});var a=i(820193),r=i(787347),n=i(565508),o=i(289732),s=i(426020),d=i(173888),l=i(731992),c=i(420072),u=i(315201),h=i(127830),p=i(594735),_=i(800788),g=i(49299),m=i(343601),f=i(676021),v=i(264336),y=i(219159),S=i(756024),T=i(382621),k=i(517614);let b="TEMP";function I(e,t,i){var a;let r=!!((null===(a=t.uploading)||void 0===a?void 0:a.isSupportFastImport)&&i),n=!!t.url;r&&n&&(0,y.$)(e,{action:"ensure_resource_both_fast_import_and_url",extra:`name=${t.filename};url=${t.url};md5=${t.md5};status=${t.status}`})}let M=e=>`/.quick-import/${e}`;async function w(e,t,i,r){let o=(0,a.nQ)(r,h._g.Video,e),s=(0,n.do)(o.value),d=t.ensureMaterial({key:o.value.key,resource:o.value},s,{needOrder:!0});return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function P(e,t,i,d,l,c,u,p){let _,S,T,k;let w=(0,a.nQ)(c,h._g.UserVideo,e),P=(0,n.do)(w.value),D=w.value,A=(0,a.fA)(D),R="",x=0;if(!A){var F,E;let i=null===(F=e.uploading)||void 0===F?void 0:F.file;(null===(E=D.uploading)||void 0===E?void 0:E.isSupportFastImport)&&i?(S=_=M(w.value.key),x=Date.now(),T=(0,g.Et)(t.draftView.getDraftId(),_,D),k=(0,g.Me)(x,u),R=await (0,r.WZ)(i,_,d),(0,f.v)(u,{blobUrl:R,id:D.id}),(0,y.$)(u,{action:"start"}),l.recordDraftPathToResourceKey(S,D.key),l.recordResourceKeyToDraftPath(D.key,S)):D.sourceType===s.ov.EverCloud&&D.thirdpartyStreamImportUrl?await (0,m.M)(D.thirdpartyStreamImportUrl)&&(S=_=`/.thirdparty-stream-import/${w.value.key}`,(0,r.M9)(d,{url:D.thirdpartyStreamImportUrl,uniquePath:_,fetchOption:JSON.stringify({method:"GET",mode:"no-cors",redirect:"follow"})}),l.recordDraftPathToResourceKey(S,D.key),l.recordResourceKeyToDraftPath(D.key,S)):D.url&&(S=_=`${b}_${D.filename}`,l.recordDraftPathToResourceKey(S,D.key),l.recordResourceKeyToDraftPath(D.key,S),(0,r.M9)(d,{url:D.url,uniquePath:_})),I(u,D,i)}let O=(async()=>{let e=i.ensureMaterial({key:w.value.key,resource:w.value},P,A?void 0:{draftPathStrategy:o.S.ForceGenerateNew});await e.waitForResourceValueReady(),!A&&(P=l.getDraftPathFromResourceKey(D.key)),S=P})();return _?O.then(()=>{var e,i;t.api.segment.innerReplace({draftId:"",identifier:Object.assign({material:{path:_}},null===(e=D.innerReplaceArgs)||void 0===e?void 0:e.identifier),substitute:Object.assign({material:{path:P}},null===(i=D.innerReplaceArgs)||void 0===i?void 0:i.substitute)}),null==T||T(),null==k||k(),(0,v.b)(u,{blobUrl:R,filePath:null!=_?_:"",substitutePath:P}),x&&(0,y.$)(u,{action:"finish",unavailableDuration:Date.now()-x})}):await O,d.resourceRecords.getRecordBySegmentPath(S)}async function D(e,t,i,r){let o=(0,a.nQ)(r,h._g.Gif,e),s=(0,n.do)(o.value),d=t.ensureMaterial({key:o.value.key,resource:o.value},s);return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function A(e,t,i,r){let o=(0,a.nQ)(r,h._g.Audio,e),s=(0,n.do)(o.value),d=t.ensureMaterial({key:o.value.key,resource:o.value},s);return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function R(e,t,i,l,c,u,p,_){let S,T;let k=(0,a.nQ)(u,h._g.UserAudio,e),w=k.value,P=(0,n.do)(k.value),D=w.status===d.a.Success,A=()=>void 0,R=()=>void 0,x="",F=0;if(!D){var E,O;let i=null===(E=e.uploading)||void 0===E?void 0:E.file;(null===(O=w.uploading)||void 0===O?void 0:O.isSupportFastImport)&&i?(T=S=M(k.value.key),F=Date.now(),A=(0,g.Et)(t.draftView.getDraftId(),S,w),R=(0,g.Me)(F,p),x=await (0,r.WZ)(i,S,l),(0,f.v)(p,{blobUrl:x,id:w.id}),(0,y.$)(p,{action:"start"}),c.recordDraftPathToResourceKey(T,w.key),c.recordResourceKeyToDraftPath(w.key,T)):w.sourceType===s.ov.EverCloud&&w.thirdpartyStreamImportUrl?await (0,m.M)(w.thirdpartyStreamImportUrl)&&(T=S=`/.thirdparty-stream-import/${k.value.key}`,(0,r.M9)(l,{url:w.thirdpartyStreamImportUrl,uniquePath:S,type:"third_part_res",fetchOption:JSON.stringify({method:"GET",mode:"no-cors",redirect:"follow"})}),c.recordDraftPathToResourceKey(T,w.key),c.recordResourceKeyToDraftPath(w.key,T)):w.url&&(T=S=`${b}_${w.filename}`,c.recordDraftPathToResourceKey(T,w.key),c.recordResourceKeyToDraftPath(w.key,T),(0,r.M9)(l,{url:w.url,uniquePath:S})),I(p,w,i)}let C=(async()=>{let e=i.ensureMaterial({key:k.value.key,resource:k.value},P,D?void 0:{draftPathStrategy:o.S.ForceGenerateNew});await e.waitForResourceValueReady(),!D&&(P=c.getDraftPathFromResourceKey(w.key)),T=P})();return T?(C.then(()=>{t.api.segment.innerReplace({draftId:"",identifier:{material:{path:S}},substitute:{material:{path:P}}})}),A(),null==R||R(),(0,v.b)(p,{blobUrl:x,filePath:null!=S?S:"",substitutePath:P}),F&&(0,y.$)(p,{action:"finish",unavailableDuration:Date.now()-F})):await C,l.resourceRecords.getRecordBySegmentPath(T)}async function x(e,t,i,r){let o=(0,a.nQ)(r,e.effectType,e),s=(0,n.do)(o.value),d=t.ensureEffect({key:o.value.key,resource:o.value},s,{needUnzip:!0});return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function F(e,t,i,r){let o=(0,a.nQ)(r,h._g.Filter,e),s=(0,n.do)(o.value),d=t.ensureEffect({key:o.value.key,resource:o.value},s,{needUnzip:!0});return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function E(e,t,i,r){await (0,T.Q)(t,[...k.Wh,k.No]);let o=(0,a.nQ)(r,h._g.AdjustmentPreset,e),s=(0,n.do)(o.value),d=t.ensureEffect({key:o.value.key,resource:o.value},s,{needUnzip:!0});return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function O(e,t,i,r){let o=(0,a.nQ)(r,h._g.Photo,e),s=(0,n.do)(o.value),d=t.ensureMaterial({key:o.value.key,resource:o.value},s,{needOrder:!0});return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function C(e,t,i,s,l,c,u,p){let _,m,S;let T=(0,a.nQ)(c,h._g.UserPhoto,e),k=T.value,b=(0,n.do)(T.value),I=M(T.value.key),w=k.status===d.a.Success,P="",D=0;if(!w){var A,R;let i=null===(A=e.uploading)||void 0===A?void 0:A.file;if((null===(R=k.uploading)||void 0===R?void 0:R.isSupportFastImport)&&i){_=I,D=Date.now();m=(0,g.Et)(t.draftView.getDraftId(),I,k),S=(0,g.Me)(D,u),P=await (0,r.WZ)(i,I,s),(0,f.v)(u,{blobUrl:P,id:k.id}),(0,y.$)(u,{action:"start"}),l.recordDraftPathToResourceKey(_,k.key),l.recordResourceKeyToDraftPath(k.key,_)}}let x=(async()=>{let e=i.ensureMaterial({key:T.value.key,resource:T.value},b,w?void 0:{draftPathStrategy:o.S.ForceGenerateNew});await e.waitForResourceValueReady(),!w&&(b=l.getDraftPathFromResourceKey(k.key)),_=b})();return _?x.then(()=>{t.api.segment.innerReplace({draftId:"",identifier:{material:{path:I}},substitute:{material:{path:b}}}),m(),null==S||S(),(0,v.b)(u,{filePath:I,substitutePath:b,blobUrl:P}),D&&(0,y.$)(u,{action:"finish",unavailableDuration:Date.now()-D})}):await x,s.resourceRecords.getRecordBySegmentPath(_)}async function V(e,t,i,r){let o=(0,a.nQ)(r,h._g.Sticker,e),s=(0,n.do)(o.value);S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u7279\u6548\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u5F00\u59CB\uFF1AfullDependentResourceResult");let d=t.ensureEffect({key:o.value.key,resource:o.value},s);return await d.waitForResourceValueReady(),S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u7279\u6548\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u7ED3\u675F===\uFF1AfullDependentResourceResult"),i.resourceRecords.getRecordBySegmentPath(s)}async function B(e,t,i){let a=(0,l.l)(h._g.Font,e),r=t.ensureEffect(a);await r.waitForResourceValueReady();let n=t.getEffectPathForEnsuredEffect(e.resourceId),o="";if(n){let e=i.fs.readdirSync(n).find(e=>!e.endsWith(".json"));e&&(o=`${n}/${e}`)}return o}async function j(e,t,i,r){let o=(0,a.nQ)(r,h._g.TextPreset,e),s=(0,n.do)(o.value),d=t.ensureEffect({key:o.value.key,resource:o.value},s,{needUnzip:!0});return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function U(e,t,i){var a,r,o,s,d;let c=(0,l.l)(h._g.TextTemplate,e);S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u5F00\u59CB\uFF1AfullTextTemplateResource");let u=await t.getFullResource(c.key,c.resource);S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u7ED3\u675F===\uFF1AfullTextTemplateResource");let p=null!==(s=null===(r=e.brandExtraInfo)||void 0===r?void 0:null===(a=r.dependResourceList)||void 0===a?void 0:a.map(e=>e.resourceId))&&void 0!==s?s:[],g=null!==(d=null===(o=e.brandExtraInfo)||void 0===o?void 0:o.brandFonts)&&void 0!==d?d:[],m=u.dependencyResources.filter(e=>!p.includes(e.key));S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7D20\u6750\u4F9D\u8D56\u8D44\u6E90\u4E0B\u8F7D\u5F00\u59CB\uFF1AfullDependentResourceResult");let f=await Promise.allSettled(m.map(e=>t.getFullResource(`${e.type}_${e.key}`,{key:`${e.type}_${e.key}`,type:e.type,resourceId:e.key})));S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7D20\u6750\u4F9D\u8D56\u8D44\u6E90\u4E0B\u8F7D\u7ED3\u675F===\uFF1AfullDependentResourceResult",f);let v=f.reduce((e,t)=>("fulfilled"===t.status?e.push(t.value):console.error("[ensure]: some resources have failed to getFullResource ",t.reason),e),[]),y={};v.forEach(e=>{let t=e.value;y[t.resourceId]=(0,n.do)(t)});let T=(0,n.do)(u.value),k=t.ensureEffect(c,T,{needUnzip:!0,dependentResourcePathMap:y});try{S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7279\u6548\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u5F00\u59CB\uFF1AensureManager.ensureEffect"),await k.waitForResourceValueReady(),S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7279\u6548\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u7ED3\u675F===\uFF1AensureManager.ensureEffect")}catch(e){console.error("[ensure]: some resources have failed to ensure ",e)}S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u6587\u672C\u6A21\u7248\u8D44\u6E90\u8BFB\u53D6\u5F00\u59CB\uFF1Afs.readdirSync"),v.forEach(e=>{let t=e.value;if(t.type===h._g.Font){let e=y[t.resourceId];if(!i.fs.isDir(e))return;let a=i.fs.readdirSync(e).find(t=>{let a=i.fs.combineFilePath(e,t);return i.fs.isFile(a)&&!t.endsWith(".json")});a&&(y[t.resourceId]+=`/${a}`)}}),S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u6587\u672C\u6A21\u7248\u8D44\u6E90\u8BFB\u53D6\u7ED3\u675F===\uFF1Afs.readdirSync");let b=i.resourceRecords.getRecordBySegmentPath(T);return(0,_.ZB)(b,"Text Template record should be written"),g.length>0&&(await Promise.allSettled(g.map(e=>B(e,t,i)))).forEach((e,t)=>{"fulfilled"===e.status&&e.value&&(y[g[t].resourceId]=e.value)}),{resourceRecord:b,dependentResourcePathMap:y}}async function L(e,t,i){let a=(0,l.l)(h._g.SubtitleTemplate,e);S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u7236\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u5F00\u59CB\uFF1AfullSubtitleTemplateResource");let r=await t.getFullResource(a.key,a.resource);S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u7236\u7D20\u6750\u8D44\u6E90\u4E0B\u8F7D\u7ED3\u675F===\uFF1AfullSubtitleTemplateResource");let o=r.dependencyResources;S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u5B50\u7D20\u6750\u4F9D\u8D56\u8D44\u6E90\u4E0B\u8F7D\u5F00\u59CB\uFF1AfullDependentResourceResult",o);let s=await Promise.allSettled(o.map(e=>t.getFullResource(`${e.type}_${e.key}`,{key:`${e.type}_${e.key}`,type:e.type,resourceId:e.key})));S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u5B50\u7D20\u6750\u4F9D\u8D56\u8D44\u6E90\u4E0B\u8F7D\u7ED3\u675F===\uFF1AfullDependentResourceResult",s);let d=s.reduce((e,t)=>("fulfilled"===t.status?e.push(t.value):console.error("[ensure]: some resources have failed to getFullResource ",t.reason),e),[]),c={};d.forEach(e=>{let t=e.value;c[t.resourceId]=(0,n.do)(t)});let u=(0,n.do)(r.value),p=t.ensureEffect(a,u,{needUnzip:!0,dependentResourcePathMap:c});try{S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u8D44\u6E90zip\u5305\u4E0B\u8F7D\u5F00\u59CB\uFF1AensureManager.ensureEffect"),await p.waitForResourceValueReady(),S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u8D44\u6E90zip\u5305\u4E0B\u8F7D\u7ED3\u675F===\uFF1AensureManager.ensureEffect")}catch(e){console.error("[ensure]: some resources have failed to ensure ",e)}S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u5B57\u5E55\u6A21\u7248\u8D44\u6E90\u8BFB\u53D6\u5F00\u59CB\uFF1Afs.readdirSync",u),d.forEach(e=>{let t=e.value;if(t.type===h._g.Font){let e=c[t.resourceId];if(!i.fs.isDir(e))return;let a=i.fs.readdirSync(e).find(t=>{let a=i.fs.combineFilePath(e,t);return i.fs.isFile(a)&&!t.endsWith(".json")});a&&(c[t.resourceId]+=`/${a}`)}}),S.t.timeLog("[perf-log] -> \u6DFB\u52A0\u5B57\u5E55\u6A21\u7248","\u5B57\u5E55\u6A21\u7248\u8D44\u6E90\u8BFB\u53D6\u7ED3\u675F===\uFF1Afs.readdirSync");let g=i.resourceRecords.getRecordBySegmentPath(u);return(0,_.ZB)(g,"Subtitle Template record should be written"),{resourceRecord:g,dependentResourcePathMap:c}}async function N(e,t,i,r){let o=(0,a.nQ)(r,h._g.Transition,e),s=(0,n.do)(o.value),d=t.ensureEffect({key:o.value.key,resource:o.value},s,{needUnzip:!0});return await d.waitForResourceValueReady(),i.resourceRecords.getRecordBySegmentPath(s)}async function z(e,t,i,a,r,n){if(await (0,c.Z)(e),!(0,u.R)(e.value))throw Error("video template get error");let o=e.value,s=t.preloadTemplateResources(e,{shouldDisableProgressiveLoading:!0}),d=await s,{waitForMetasReady:l,oldResourceIdToNewResourceIdMap:h,waitForEnsureFinished:_,rawPreloadMaterialsMap:g,preloadMaterialItems:m,preloadEffectItems:f}=d;try{await Promise.all([l(),_()])}catch(e){if(-1===e.code);else throw e}let v=(0,p.V)(i,o.preload.json,d,r,n,a);return{draft:v,videoTemplate:o,preloadMaterialItems:m,preloadEffectItems:f,originVideoAlgorithmInfo:e.getOriginVideoAlgorithmInfo()}}async function G(e,t,i,r,o,s){let d;let l=(0,a.nQ)(r,h._g.DigitalHuman,e),c=(0,n.do)(l.value),u=t.ensureMaterial({key:l.value.key,resource:l.value},c);await u.waitForResourceValueReady();let p=i.resourceRecords.getRecordBySegmentPath(c);return e.maskVideo&&(d=i.resourceRecords.getRecordBySegmentPath(`/${e.maskVideo.key}`)),{videoResourceRecord:p,maskResourceRecord:d}}async function W(e,t,i,a){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=(0,l.l)(h._g.TextGlow,e,r);a.add(n.key,n.resource);let o=t.ensureEffect(n);await o.waitForResourceValueReady();let s=t.getEffectPathForEnsuredEffect(e.resourceId);return i.resourceRecords.getRecordBySegmentPath(s)}},325805:function(e,t,i){i.d(t,{BS:function(){return l},Gt:function(){return d},JP:function(){return u}});var a,r,n=i(789786),o=i(356954),s=i(200247);var d=((a={}).CLICK="click",a.RIGHTCLICK="rightclick",a.SHORTKEY="shortkey",a.TIMELINE_SHORTKEY="timeline_shortkey",a);var l=((r={}).UNDO="undo",r.REDO="redo",r.COPY="copy",r.PASTE="paste",r.COPYCUT="copycut",r.DELETE="delete",r.CUT="cut",r.DIVIDE_AUDIO="divide_audio",r.UNDIVIDE_AUDIO="undivide_audio",r.REVERSE="reverse",r.UNDO_REVERSE="undo_reverse",r.MIRROR="mirror",r.UNDO_MIRROR="undo_mirror",r.CROP="crop",r.FULL_SCREEN_EDIT="full_screen_edit",r.COLLAPSE_TIMELINE="collapse_timeline",r.SHOW_TIMELINE="show_timeline",r.ZOOM="zoom",r.DRAG="drag",r.MOVE="move",r.RECORD_AUDIO="record_audio",r.AUTO_SPLIT="auto_split",r);class c{getEventParams(){return{...this._params}}constructor(e,t){this._params=e,this._accountService=t,this.eventName="click_function"}}function u(e,t){(0,o.K)(e,c,[t])}c=(0,n.gn)([(0,n.fM)(1,s.D),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===s.D?Object:s.D])],c)},905948:function(e,t,i){i.d(t,{w:function(){return d}});var a=i(783280),r=i(443619),n=i(864831),o=i(85446),s=i(825686);function d(e){e.invokeFunction(t=>{t.get(s.sX).onDidReporterProcessing((t,i)=>{(0,a.t)(e,i,t),(0,r.I)(e,i,t),(0,n.b)(e,i,t),(0,o.c)(e,i,t)})})}},807407:function(e,t,i){i.d(t,{t:function(){return s}});var a=i(789786),r=i(108692),n=i(356954);class o{getEventParams(){let e={action:this._params.action,action_type:"click"};return void 0!==this._params.material_type&&(e.material_type=this._params.material_type),void 0!==this._params.material_category&&(e.material_category=this._params.material_category),void 0!==this._params.position&&(e.position=this._params.position),e}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="material_canvas_edit"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,r.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===r.n?Object:r.n])],o)},544724:function(e,t,i){i.d(t,{c:function(){return l}});var a=i(789786),r=i(356954),n=i(108692);class o{getEventParams(){var e,t;let i=null!==(t=this._mainDraftService.dataSdk.cutSame.getMutableVideos())&&void 0!==t?t:[],a=(null==i?void 0:i.length)||0,r=(null==i?void 0:null===(e=i.filter(e=>null==e?void 0:e.filled))||void 0===e?void 0:e.length)||0;return{fragment_cnt:a,filled_fragment_cnt:r,is_all_filled:(null==i?void 0:i.every(e=>null==e?void 0:e.filled))?1:0}}constructor(e){this._mainDraftService=e,this.eventName="edit_page_close"}}o=(0,a.gn)([(0,a.fM)(0,n.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.n?Object:n.n])],o);let s=e=>{(0,r.K)(e,o)},d=null,l=e=>{if(d)return d;let t=()=>{s(e)};return window.addEventListener("beforeunload",t),d=()=>{window.removeEventListener("beforeunload",t)}}},371290:function(e,t,i){i.d(t,{D$:function(){return d},EL:function(){return s},MO:function(){return l}});var a=i(515336);let r=a.EL,n=a.D$,o=a.MO;function s(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];r(...t)}function d(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];n(...t)}function l(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];o(...t)}},800165:function(e,t,i){i.d(t,{P:function(){return n}});var a=i(356954);class r{getEventParams(){return{popup_type:"script_input_popup",popup_from:"button",...this._params}}constructor(e){this._params=e,this.eventName="ai_writer_popup"}}function n(e,t){(0,a.K)(e,r,[t])}},938228:function(e,t,i){i.d(t,{n:function(){return n}});var a=i(356954);class r{getEventParams(){return{status:"success"}}constructor(){this.eventName="pwa_install_status"}}function n(e){(0,a.K)(e,r,[])}},538181:function(e,t,i){i.d(t,{Z:function(){return n}});var a=i(356954);class r{getEventParams(){return{intelligent_cost_time:this._params.costTime,intelligent_error_msg:this._params.errorMsg,intelligent_log_id:this._params.logId,intelligent_stage:this._params.stage,intelligent_type:this._params.type,intelligent_value:this._params.value}}constructor(e){this._params=e,this.eventName="web_template_intelligent_process"}}function n(e,t){(0,a.K)(e,r,[t])}},649962:function(e,t,i){i.d(t,{E:function(){return s},K:function(){return n}});var a,r=i(356954);var n=((a={}).MOVE_MATERIAL="move_material",a.CROP="crop",a);class o{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="absorb_track"}}function s(e,t){(0,r.K)(e,o,[t])}},969177:function(e,t,i){i.d(t,{o:function(){return s}});var a=i(789786),r=i(108692),n=i(356954);class o{getEventParams(){return{draft_id:this._mainDraftService.dataSdk.draftView.getDraftId(),current_page:this._params.current_page,track_category:this._params.track_category,is_soundtrack:this._params.is_soundtrack}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="click_audio_soundtrack_ban"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,r.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===r.n?Object:r.n])],o)},324230:function(e,t,i){i.d(t,{Q:function(){return l}});var a=i(789786),r=i(108692),n=i(896413),o=i(356954),s=i(861631);class d{getEventParams(){return{template_id:this._params.templateId,video_type_id:this._params.videoTypeId,click_type:this._params.clickType}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="click_same_clip_replace"}}function l(e,t){let i=e.invokeFunction(e=>e.get(n.a)),a=e.invokeFunction(e=>e.get(r.n)),{subDraftTemplateId:l}=i.segmentSelection,c=null!=l?l:a.draftTemplateManager.getTemplateId();if(!c)return;let u=a.draftTemplateManager.getTemplateSync(c),h=(0,s.tt)(u.templateType,u.producerAppId);(0,o.K)(e,d,[{templateId:c,videoTypeId:h,clickType:t.clickType}])}d=(0,a.gn)([(0,a.fM)(1,r.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===r.n?Object:r.n])],d)},806242:function(e,t,i){i.d(t,{Bl:function(){return v},IV:function(){return f},n9:function(){return m}});var a=i(150280),r=i(426336);let n=a.i8[r.cVg.MetaTypeSaturation],o=a.i8[r.cVg.MetaTypeTemperature],s=a.i8[r.cVg.MetaTypeHue],d=a.iT[r.cVg.MetaTypeBrightness],l=a.iT[r.cVg.MetaTypeContrast],c=a.iT[r.cVg.MetaTypeLightSensation],u=a.iT[r.cVg.MetaTypeHighlight],h=a.iT[r.cVg.MetaTypeShadow],p=a.vW[r.cVg.MetaTypeSharpen],_=a.vW[r.cVg.MetaTypeVignetting],g=a.vW[r.cVg.MetaTypeFade],m={[n]:"vibrance",[o]:"temperature",[s]:"hue",[d]:"brightness",[l]:"contrast",[c]:"shine",[u]:"highlight",[h]:"shadow",[p]:"sharpness",[_]:"vignette",[g]:"fade",[a.vW[r.cVg.MetaTypeParticle]]:"grain"},f=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e){case r.pNd.TrackTypeNone:return"none";case r.pNd.TrackTypeVideo:return t?"video":"vice_video";case r.pNd.TrackTypeAudio:return"audio";case r.pNd.TrackTypeSticker:return"sticker";case r.pNd.TrackTypeText:return"text";case r.pNd.TrackTypeVideoEffect:return"video_effect";case r.pNd.TrackTypeFilter:return"filter";case r.pNd.TrackTypeAdjust:return"adjust";case r.pNd.TrackTypeTextToVideoText:return"text_to_video_text";case r.pNd.TrackTypeTextToVideoTextAudio:return"video_text_audio";case r.pNd.TrackTypeComposition:return"composition";case r.pNd.TrackTypePluginEffect:return"plugin_effect";case r.pNd.TrackTypeAdCube:return"ad_cube";default:return"other"}},v="9001"},841297:function(e,t,i){i.d(t,{Ey:function(){return Z},fi:function(){return X}});var a=i(789786),r=i(425427),n=i(108692),o=i(896413),s=i(426020),d=i(230689),l=i(782350),c=i(433140),u=i(275481),h=i(966697),p=i(127830),_=i(981632),g=i(351045),m=i(136877),f=i(918513),v=i(426336),y=i(337081),S=i(133864),T=i(320271),k=i(343828),b=i(594670),I=i(281118),M=i(801497),w=i(860660),P=i(501887),D=i(150280),A=i(806242),R=i(322613),x=i(341079),F=i(677056),E=i(959542),O=i(722169),C=i(948328),V=i(374497),B=i(153197),j=i(473595),U=i(918157),L=i(118830),N=i(811750),z=i(554946),G=i(594662);let W={get in(){return M.ZP.t("in_web",{},"\u5165\u573A")},get out(){return M.ZP.t("out_web",{},"\u51FA\u573A")},get group(){return M.ZP.t("combo_web",{},"\u7EC4\u5408")}},H={get NORMAL(){return M.ZP.t("web_mix_mode_text_normal",{},"Normal")}},Z={change_voice_param_depth:"Depth",change_voice_param_noise:"Noise",change_voice_param_strength:"Strength",change_voice_param_frequency:"Frequency",change_voice_param_quantity:"Quantity",change_voice_param_room_size:"Room size",change_voice_param_timbre:"Timbre",change_voice_param_pitch:"Pitch"};function $(e){let t="none";return t=e.material.musicId?"material":e.material.type===v.cVg.MetaTypeTextToAudio?"text":e.material.type===v.cVg.MetaTypeVideoOriginalSound?"video":"upload"}function Q(e){var t,i;let a="none",r="none",n="none";for(let o of null!==(i=null===(t=e.animations)||void 0===t?void 0:t.animations)&&void 0!==i?i:[])switch(o.type){case v.VAL.Anim_In:a=o.name;break;case v.VAL.Anim_Out:r=o.name;break;case v.VAL.Anim_Loop:n=o.name}return"none"!==n?n:"none"!==a||"none"!==r?`${a}:${r}`:"none"}function K(e,t){let i="none";return e.length?(i=e.map(e=>{let i=t.get(`${p._g.Video}_${e.id}`,p._g.Video);return i?i.value.isBusiness?"true":"false":"none"}).join(",")).split(",").every(e=>"none"===e)?"none":i:i}function Y(e,t){return"none"===e&&"none"===t?"none":"none"===e?t:"none"===t?e:`${e}&${t}`}function q(e,t){return e.every(e=>"none"===e[t])?"none":e.map(e=>e[t]).join(",")}function J(e){return e.every(e=>"none"===e)?"none":e.join(",")}class X{getEventParams(){let e=this._getIsTemplate()?this._getTemplateInfoRelatedParams():this._getTemplateSegmentRelatedParams(),t=(0,z.Wu)(this._mainDraftService.dataSdk);return{...this._getSmartToolParams(),...this._getBaseParams(),...this._getTemplateParams(),...this._getTtsParams(),...this._getSvgParams(),...this._getColorSpaceParam(),...this._getCanvasRelatedParams(),...this._getSearchParamsRelatedParams(),...this._getUserRelatedParams(),...this._getSegmentRelatedParams(),...this._getVipParams(),...this._getDataSdkParams(),...this._getRecorderReportParams(),...this._getAiWriterParams(),...this._getVideoNoiseReductionParams(),...this._getVideoDeflickerParams(),...this._getVocalSeparationParams(),...this._getVocalBeautifyParams(),...this._getObjectLockParams(),...e,...this._getDraftCollaboratorParams(),...t}}_isPartExport(){return"part_export"===this._params.editExportType||"part_export_sametime"===this._params.editExportType}_getIsTemplate(){return(0,r.JY)(this._videoEnvironmentService)}_getDataSdkParams(){let e=this._mainDraftService.dataSdk.draftView,t={draft_id:e.getDraftId(),is_audio_denoise:"false",is_normal_speed:"false",is_curve_speed:"false",is_rotate:"false",tone_change:"false"},i=e.getCanvasConfig(),a={canvas_scale:(0,R.a)(i.ratio)||"\u9002\u5E94",screen:""};i.width>0&&i.height>0&&i.width>i.height?a.screen="horizontal_screen":a.screen="vertical_screen";let r=e.getAllTracks(),n=[],o=[],s=[],d=[],l=[],c=[];for(let e of r){let{type:t}=e;t===v.pNd.TrackTypeVideo?n.push(e):t===v.pNd.TrackTypeAudio?o.push(e):t===v.pNd.TrackTypeText?s.push(e):t===v.pNd.TrackTypeSticker?d.push(e):t===v.pNd.TrackTypeFilter?l.push(e):t===v.pNd.TrackTypeVideoEffect&&c.push(e)}let u=this._getVideoParams(n),h=this._getAudioParams(o),p=this._getTextParams(s),_=this._getStickerParams(d,{}),g=this._getFilterParams(l),m=this._getEffectParams(c),f=this._getSmartAbilityParams(n),S=(0,y.Ay)(n),T=this._getDraftGlobalParams(r),k=this._getBeautyParams(r),b=this._getPluginParams(r),I=this._getCommercialParams(r),M=this._getVideoTrackingParams(r),w=this._getBrandMaterialParams();return{...t,...a,...u,...h,voice_effect_cnt:Number(u.video_voice_effect_cnt)+Number(h.audio_voice_effect_cnt),voice_effect:[u.video_voice_effect,h.audio_voice_effect].filter(Boolean).join(","),voice_effect_adjust:`${u.video_voice_effect_adjust},${h.audio_voice_effect_adjust}`,...p,..._,...g,...m,...f,...S,...T,...k,...I,...b,...M,...w}}_getVideoParams(e){var t,i,a,r,n,o,s,d,l,c,u;let h=e.length?e[0]:null,p=e.length?e.slice(1).reverse():[],_=[],m=[],f=[],y=[],S=[],T=[],k=[],b=[],I=[],M=[],w=[],P=[],D=[],A=[],R=[],x=[],F=[],E=[],O=[],C=[],V=[],B=[],U=[],L=[],N=!1,z=!1,G=!1,W=!1,Z=!1,$=this._getIsTemplate();for(let e of null!==(t=null==h?void 0:h.segments)&&void 0!==t?t:[]){if(!(0,v.hey)(e))continue;let t=j.f.get(e.id);if(($&&!L.length||!$&&e.templateId)&&L.push((null==t?void 0:t.recommendId)||""),this._parseVideoSegment({segment:e,isMainTrack:!0,materials:k,giphys:w,brands:D,materialPhotos:I,animations:_,speeds:f,curveSpeeds:S,voices:F,cutouts:R,brandCanvas:C,masks:V,cropMaterials:B}),e.transition?O.push({name:e.transition.name,id:e.transition.resourceId,category_name:e.transition.categoryName,category_id:e.transition.categoryId}):O.push({name:"none",id:"none",category_name:"none",category_id:"none"}),(null===(i=e.realtimeDenoise)||void 0===i?void 0:i.isDenoise)&&(N=!0),e.speed)switch(e.speed.mode){case v.yY$.SpeedModeNormal:1!==e.speed.speed&&(z=!0);break;case v.yY$.SpeedModeCurve:G=!0}if(e.clip.rotation&&(W=!0),(null===(a=e.voiceChange)||void 0===a?void 0:a.length)&&(Z=!0),e.mixMode){let t="";e.mixMode.name&&e.mixMode.name!==H.NORMAL&&(t=null!==(n=null===(r=g.Dd.filter(t=>{var i;return t.resourceId===(null===(i=e.mixMode)||void 0===i?void 0:i.resourceId)})[0])||void 0===r?void 0:r.name)&&void 0!==n?n:""),U.push(t)}}for(let e of p)for(let t of e.segments){if(!!(0,v.hey)(t)){if(this._parseVideoSegment({segment:t,isMainTrack:!1,materials:b,giphys:P,brands:A,materialPhotos:M,animations:m,speeds:y,curveSpeeds:T,voices:E,cutouts:x,brandCanvas:C,masks:V,cropMaterials:B}),(null===(o=t.realtimeDenoise)||void 0===o?void 0:o.isDenoise)&&(N=!0),t.speed)switch(t.speed.mode){case v.yY$.SpeedModeNormal:1!==t.speed.speed&&(z=!0);break;case v.yY$.SpeedModeCurve:G=!0}if((null===(s=t.voiceChange)||void 0===s?void 0:s.length)&&(Z=!0),t.mixMode){let e="";t.mixMode.name&&t.mixMode.name!==H.NORMAL&&(e=null!==(l=null===(d=g.Dd.filter(e=>{var i;return e.resourceId===(null===(i=t.mixMode)||void 0===i?void 0:i.resourceId)})[0])||void 0===d?void 0:d.name)&&void 0!==l?l:""),U.push(e)}}}let Q={video_cnt:null!==(c=null==h?void 0:h.segments.length)&&void 0!==c?c:0,pip_track_cnt:p.length,mix_mode_all:U.filter(e=>""!==e).join(","),video_animation:Y(_.map(e=>{let{type:t,name:i,duration:a}=e;return`${t}:${i}:${a}`}).join(",")||"none",m.map(e=>{let{type:t,name:i,duration:a}=e;return`${t}:${i}:${a}`}).join(",")||"none"),cut_speed:Y(J(f),J(y)),speed_curve_detail:Y(J(S),J(T)),cutout_material:Y(R.join(",")||"none",x.join(",")||"none"),cutout_cnt:R.length+x.length,material_cnt:k.length+b.length,material:Y(q(k,"name")||"none",q(b,"name")||"none"),material_id:Y(q(k,"id")||"none",q(b,"id")||"none"),material_category:Y(q(k,"category_name")||"none",q(b,"category_name")||"none"),material_category_id:Y(q(k,"category_id")||"none",q(b,"category_id")||"none"),material_search_id:Y(q(k,"search_id")||"none",q(b,"search_id")||"none"),is_commercial:Y(K(k,this._resourceService),K(b,this._resourceService)),online_photo_id:Y(q(I,"id")||"none",q(M,"id")||"none"),photo_search_id:Y(q(I,"search_id")||"none",q(M,"search_id")||"none"),giphy_material_cnt:w.length+P.length,giphy_material:Y(q(w,"name")||"none",q(P,"name")||"none"),giphy_material_id:Y(q(w,"id")||"none",q(P,"id")||"none"),giphy_material_category:Y(q(w,"category_name")||"none",q(P,"category_name")||"none"),giphy_material_category_id:Y(q(w,"category_id")||"none",q(P,"category_id")||"none"),brand_material_cnt:D.length+A.length,brand_material:Y(q(D,"name")||"none",q(D,"name")||"none"),brand_material_id:Y(q(D,"id")||"none",q(D,"id")||"none"),brand_canvas:C.length?C.join(","):"none",audio_original_change:Y(q(F,"name"),q(E,"name")),video_voice_effect_cnt:F.length+E.length,video_voice_effect:q([...F,...E],"name"),video_voice_effect_adjust:[...null==F?void 0:F.map(e=>e.adjust)].join(","),transitions:q(O,"name")||"none",transitions_id:q(O,"id")||"none",transitions_category:q(O,"category_name")||"none",transitions_category_id:q(O,"category_id")||"none",mask_cnt:V.length,mask_name:V.length>0?V.map(e=>e.name).join(","):"none",mask_track_category:V.length>0?V.map(e=>e.track_category).join(","):"none",mask_material_category:V.length>0?V.map(e=>e.material_category).join(","):"none",crop_material:B.join(",")};N&&(Q.is_audio_denoise="true"),z&&(Q.is_normal_speed="true"),G&&(Q.is_curve_speed="true"),W&&(Q.is_rotate="true"),Z&&(Q.tone_change="true");let{searchParams:X}=new URL(window.location.href);return Q.rec_id=null!==(u=L.join(",")||X.get("rec_id"))&&void 0!==u?u:void 0,Q}_getBrandMaterialParams(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=0,i=0,a=0,r=0,n=0,o=0,s=0,d=0,l=0,c=0;return e.forEach(e=>{(0,v.hey)(e)&&(e.material.sourcePlatform===v.cvu.MaterialPlatformBrand&&(t++,e.material.type===v.cVg.MetaTypeVideo?i++:e.material.type===v.cVg.MetaTypePhoto&&a++),e.background.sourcePlatform===v.nj7.EffectPlatformBrand&&(t++,d++)),(0,v.Y9Q)(e)&&v.cvu.MaterialPlatformBrand&&(t++,r++),(0,v.P2T)(e)&&v.cvu.MaterialPlatformBrand&&(t++,n++),(0,v.E6P)(e)&&v.cvu.MaterialPlatformBrand&&(t++,o++),(0,v.Q2R)(e)&&(e.material.sourcePlatform===v.cvu.MaterialPlatformBrand&&(t++,l++),e.material.textInfoResources.forEach(e=>{e.textMaterial.fontSourcePlatform===v.nj7.EffectPlatformBrand&&(t++,s++)})),(0,v.Ftn)(e)&&(e.effects.some(e=>e.sourcePlatform===v.cvu.MaterialPlatformBrand)&&(t++,c++),e.material.fontSourcePlatform===v.nj7.EffectPlatformBrand&&(t++,s++))}),t?{brand_material_cnt:t,brand_video_cnt:i,brand_photo_cnt:a,brand_music_cnt:r,brand_sticker_cnt:n,brand_font_cnt:s,brand_background_cnt:d,use_brand_text_presets:l+c?1:0,use_brand_adjustment_preset:o?1:0}:{}}_parseVideoSegment(e){var t,i,a,r,n,o,s,d;let{segment:l,isMainTrack:c,materials:u,giphys:h,brands:p,materialPhotos:_,cropMaterials:g,brandCanvas:m,animations:f,speeds:y,curveSpeeds:S,voices:T,masks:k,cutouts:b}=e;if(!(0,v.hey)(l))return;if(l.material){let{sourcePlatform:e}=l.material;if(e===v.cvu.MaterialPlatformArtist){if(l.material.type===v.cVg.MetaTypeVideo){let e=null===(a=j.f.get(l.id))||void 0===a?void 0:a.searchId;u.push({name:l.material.materialName,id:l.material.materialId,category_name:l.material.categoryName,category_id:l.material.categoryId,search_id:e||"none"})}}else e===v.cvu.MaterialPlatformGiphy?h.push({name:l.material.materialName,id:l.material.materialId,category_name:l.material.categoryName,category_id:l.material.categoryId}):e===v.cvu.MaterialPlatformBrand&&p.push({name:l.material.materialName,id:l.material.materialId,category_name:l.material.categoryName,category_id:l.material.categoryId})}if(l.material.type===v.cVg.MetaTypePhoto&&[v.cvu.MaterialPlatformArtist,v.cvu.MaterialPlatformTuchongAdobe,v.cvu.MaterialPlatformTuchongDeposit,v.cvu.MaterialPlatformTuchongPond5].includes(l.material.sourcePlatform)){let e=null===(r=j.f.get(l.id))||void 0===r?void 0:r.searchId;_.push({name:l.material.materialName,id:l.material.materialId,category_name:l.material.categoryName,category_id:l.material.categoryId,search_id:e||"none"})}if(JSON.stringify(l.material.crop)!==JSON.stringify({upperLeftX:0,upperLeftY:0,upperRightX:1,upperRightY:0,lowerLeftX:0,lowerLeftY:1,lowerRightX:1,lowerRightY:1})){let{type:e}=l.material,t="";e===v.cVg.MetaTypeVideo?t="video":e===v.cVg.MetaTypePhoto&&(t="image"),g.push(t)}for(let e of(l.background&&l.background.sourcePlatform===v.nj7.EffectPlatformBrand&&m.push(l.background.imageName),null!==(n=null===(t=l.animations)||void 0===t?void 0:t.animations)&&void 0!==n?n:[]))f.push({type:null!==(o=W[e.type])&&void 0!==o?o:"",name:null!==(s=e.name)&&void 0!==s?s:"",duration:v.pMA.div(e.duration,1e6,"number")});l.speed?y.push(String(l.speed.speed)):y.push("none"),l.speed.curveSpeed?S.push(String(l.speed.curveSpeed.name)):S.push("none"),(null===(i=l.voiceChange)||void 0===i?void 0:i.length)&&T.push({name:l.voiceChange[0].name,id:l.voiceChange[0].resourceId,category_name:l.voiceChange[0].categoryName,category_id:l.voiceChange[0].categoryId,adjust:null===(d=l.voiceChange[0].audioAdjustParams)||void 0===d?void 0:d.map(e=>Z[e.name])});let I=(0,v.P2G)(l);if(I){let e=(0,w.Of)(l.material.type,l.material.sourcePlatform),t="";(0,v.kjj)(l)?t="template":"giphy"===e?t="sticker":"heycan"===e||"brand"===e||(t=e||"media"),k.push({name:I.name,track_category:c?"video":"vice_video",material_category:t})}l.material.matting.flag>1n&&b.push(l.material.type===v.cVg.MetaTypeVideo?"video":"image")}_getAudioParams(e){let t=0,i=0,a=0,r=[],n=[],o=0,s=0,d=!1,l=!1,c=!1,u=!1,h=[],p=[];for(let T of e)for(let e of T.segments){var _,g,m,f,y,S;if(!(0,v.Y9Q)(e)||!e.material)continue;let T=null===(_=j.f.get(e.id))||void 0===_?void 0:_.searchId;switch(e.material.type){case v.cVg.MetaTypeSound:++o,p.push({id:e.material.effectId,name:e.material.name,category_id:e.material.categoryId,category_name:e.material.categoryName,search_id:T||"none"});break;case v.cVg.MetaTypeMusic:default:{let o={id:e.material.musicId,name:e.material.name,category_id:e.material.categoryId,category_name:e.material.categoryName,search_id:T||"none"};e.material.musicId?(++i,r.push(o)):++t,"video"===$(e)&&++a,n.push({...o,music_source:$(e),is_auto_audio:(null===(f=e.beat)||void 0===f?void 0:f.enableAiBeats)?1:0,is_manual_audio:(null===(y=e.beat)||void 0===y?void 0:y.userBeats.length)?1:0,gear:(null===(S=e.beat)||void 0===S?void 0:S.enableAiBeats)?e.beat.gear:"none"})}}switch(e.material.sourcePlatform===v.QZ3.AudioPlatformBrand&&++s,e.speed.mode){case v.yY$.SpeedModeNormal:1!==e.speed.speed&&(d=!0);break;case v.yY$.SpeedModeCurve:l=!0}(null===(g=e.realtimeDenoise)||void 0===g?void 0:g.isDenoise)&&(c=!0),(null===(m=e.voiceChange)||void 0===m?void 0:m.length)&&(u=!0,h.push({name:e.voiceChange[0].name,id:e.voiceChange[0].resourceId,category_name:e.voiceChange[0].categoryName,category_id:e.voiceChange[0].categoryId,adjust:e.voiceChange[0].audioAdjustParams.map(e=>Z[e.name])}))}let T={audio_all_cnt:t+i+o,audio_local_cnt:t,audio_music_cnt:i,sound_effect_cnt:o,extra_audio_cnt:a,brand_music_cnt:s,audio_music:q(r,"name")||"none",audio_music_id:q(r,"id")||"none",audio_music_category:q(r,"category_name")||"none",audio_music_category_id:q(r,"category_id")||"none",music_search_id:q(r,"search_id")||"none",sound_effect:q(p,"name")||"none",sound_effect_id:q(p,"id")||"none",sound_effect_category:q(p,"category_name")||"none",sound_effect_category_id:q(p,"category_id")||"none",sound_effect_search_id:q(p,"search_id")||"none",is_auto_audio:q(n,"is_auto_audio"),is_auto:q(n,"is_auto_audio"),is_manual_audio:q(n,"is_manual_audio"),auto_audio_speed:q(n,"gear"),music_name:q(n,"name"),music_source:q(n,"music_source"),audio_voice_effect_cnt:h.length,audio_voice_effect:q(h,"name"),audio_voice_effect_adjust:[...null==h?void 0:h.map(e=>e.adjust)].join(",")};return c&&(T.is_audio_denoise="true"),d&&(T.is_normal_speed="true"),l&&(T.is_curve_speed="true"),u&&(T.tone_change="true"),T}_getTextParams(e){var t,i;let a=0,r=0,n=0,o=0,s=[],d=[],l=[],c=[],u=[],h=!1,p=0,_=[],g=0,m=[],f=[],y=0,S=null===(t=this._mainEditorWidgetService.checkListManager.observeCheckListManagerData.validEffects.vipValidEffects)||void 0===t?void 0:t.map(e=>e.resourceId);for(let t of e)for(let e of t.segments)if((0,v.Ftn)(e)){for(let t of(e.effects.length?++a:++r,e.bloom&&BigInt(e.material.checkFlag)&v.PbZ.LightFlag&&(p=1,_.push(e.bloom.resourceId)),e.material.type===v.cVg.MetaTypeSubtitle?(++n,e.material.addType===v.RZH.RecognizeAdd?s.push("subtitle_recognition"):s.push("other")):e.material.type===v.cVg.MetaTypeLyrics&&(++o,s.push("lyric_recognition")),e.material&&d.push({shadow:e.material.hasShadow,font:e.material.fonts.map(e=>e.title).join(",")||"none",color:e.material.textColor||"none",borderColor:e.material.borderColor||"none",textBgColor:e.material.backgroundColor||"none",textShadowColor:e.material.shadowColor||"none",isBold:e.material.boldWidth>0?"1":"0",isUnderline:e.material.underline?"1":"0",isItalic:e.material.italicDegree>0?"1":"0"}),e.material.fonts))t.sourcePlatform===v.nj7.EffectPlatformBrand&&l.push(t.title);for(let t of e.effects)c.push({id:t.resourceId||"none",name:t.name||"none",category_id:t.categoryId||"none",category_name:t.categoryName||"none"});u.push(Q(e)),(null===(i=e.clip)||void 0===i?void 0:i.rotation)&&(h=!0);let{resourceId:t}=e.material.captionTemplateInfo;t&&(f.push(t),(null==S?void 0:S.includes(t))&&y++)}else(0,v.Q2R)(e)&&(++g,e.material&&m.push({id:e.material.resourceId||"none",name:e.material.name||"none",category_id:e.material.categoryId||"none",category_name:e.material.categoryName||"none"}));let T={text_all_cnt:r+a,text_cnt:r,text_special_effect_cnt:a,subtitle_recognition_cnt:n,lyric_recognition_cnt:o,text_shadow:d.some(e=>e.shadow)?"true":"false",text_animation:J(u),text_font:q(d,"font"),text_color:q(d,"color"),text_border_color:q(d,"borderColor"),text_bg_color:q(d,"textBgColor"),text_shadow_color:q(d,"textShadowColor"),is_bold:q(d,"isBold"),is_underline:q(d,"isUnderline"),is_italic:q(d,"isItalic"),brand_font:l.length?l.join(","):"none",text_subtitle_cnt:s.length,text_subtitle_source:s.join(","),text_special_effect:q(c,"name")||"none",text_special_effect_id:q(c,"id")||"none",text_special_effect_category:q(c,"category_name")||"none",text_special_effect_category_id:q(c,"category_id")||"none",text_template_cnt:g,text_template:q(m,"name")||"none",text_template_id:q(m,"id")||"none",text_template_category:q(m,"category_name")||"none",text_template_category_id:q(m,"category_id")||"none",is_caption_template:f.length>0?1:0,caption_template_id:f.join(","),caption_template_cnt:f.length,vip_caption_template_cnt:y,text_glow:p,text_glow_type:_};return h&&(T.is_rotate="true"),T}_getStickerParams(e,t){let i=0,a=0,r=0,n=[],o=[],s=!1;for(let c of e)for(let e of c.segments){var d,l;if(!!(0,v.P2T)(e)){if(++i,e.material){t[e.material.resourceId];let i=j.f.get(e.id),o=null===(l=j.f.get(e.id))||void 0===l?void 0:l.searchId;n.push({name:e.material.name||"none",id:e.material.resourceId||"none",category_id:e.material.categoryId||"none",category_name:e.material.categoryName||"none",search_id:o||"none"}),e.material.sourcePlatform===v.nj7.EffectPlatformBrand&&++a,(null==i?void 0:i.recommendId)&&++r}o.push(Q(e)),(null===(d=e.clip)||void 0===d?void 0:d.rotation)&&(s=!0)}}let c={sticker_cnt:i,sticker_animation:J(o),brand_sticker_cnt:a,similar_sticker_cnt:r,sticker:q(n,"name")||"none",sticker_id:q(n,"id")||"none",sticker_category:q(n,"category_name")||"none",sticker_category_id:q(n,"category_id")||"none",sticker_search_id:q(n,"search_id")||"none"};return s&&(c.is_rotate="true"),c}_getFilterParams(e){let t=0,i=[];for(let a of e)for(let e of a.segments){if(!!(0,v.SiN)(e))++t,e.material&&i.push({name:e.material.name||"none",id:e.material.resourceId||"none",category_id:e.material.categoryId||"none",category_name:e.material.categoryName||"none"})}return{global_filter_cnt:t,filter:q(i,"name"),filter_id:q(i,"id"),filter_category:q(i,"category_name"),filter_category_id:q(i,"category_id")}}_getEffectParams(e){let t=0,i=0,a=[],r=[];for(let o of e)for(let e of o.segments){var n;if(!(0,v.w5o)(e))continue;let o=e.material.type===v.cVg.MetaTypeVideoEffect,s=e.material.type===v.cVg.MetaTypeFaceEffect;o?++t:s&&++i;let d=null===(n=j.f.get(e.id))||void 0===n?void 0:n.searchId,l={name:e.material.name||"none",id:e.material.resourceId||"none",category_id:e.material.categoryId||"none",category_name:e.material.categoryName||"none",search_id:d||"none"};o?a.push(l):s&&r.push(l)}let o={global_special_effect_cnt:t,global_special_effect:q(a,"name")||"none",global_special_effect_id:q(a,"id")||"none",global_special_effect_category:q(a,"category_name")||"none",global_special_effect_category_id:q(a,"category_id")||"none",special_effect_search_id:q(a,"search_id")||"none",global_body_effect_cnt:i,global_body_effect:q(r,"name")||"none",global_body_effect_id:q(r,"id")||"none",global_body_effect_category:q(r,"category_name")||"none",global_body_effect_category_id:q(r,"category_id")||"none"},s={special_effect_cnt:t+i,special_effect:[o.global_special_effect,o.global_body_effect].join(","),special_effect_id:[o.global_special_effect_id,o.global_body_effect_id].join(","),special_effect_category:[o.global_special_effect_category,o.global_body_effect_category].join(","),special_effect_category_id:[o.global_special_effect_category_id,o.global_body_effect_category_id].join(","),local_special_effect_cnt:0,local_special_effect:"",local_special_effect_id:"",local_special_effect_category:"",local_special_effect_category_id:""};return{...o,...s}}_getSmartAbilityParams(e){let t=!1,i=!1,a=!1;for(let o of e)for(let e of o.segments){var r,n;if(!(0,v.hey)(e))continue;t=t||!!(null===(r=e.adjust)||void 0===r?void 0:r.enableSmartColorAdjust),i=i||!!(null===(n=e.material.stable)||void 0===n?void 0:n.stableLevel);let o=e.material.videoAlgorithm.algorithms.find(e=>e.type===v.zzh.ComplementFrame);a=a||!!o}return{is_ai_color_correction:t?1:0,is_stabilize:i?1:0,is_smooth_slow_mo:a?1:0}}_getDraftGlobalParams(e){let t=this._mainDraftService.dataSdk.draftView.getDraftProperty().videoMute,i=!1,a=!1,n=!1,o=[],s=0;for(let d of e){let e=d.type===v.pNd.TrackTypeVideo&&!i;if(d.type===v.pNd.TrackTypeVideo&&(i=!0),[v.pNd.TrackTypeAudio,v.pNd.TrackTypeTextToVideoTextAudio].includes(d.type)||(d.type===v.pNd.TrackTypeVideo?a&&(n=!0):a=!0),!(0,r.JY)(this._videoEnvironmentService)&&![v.pNd.TrackTypeComposition,v.pNd.TrackTypeAdCube,v.pNd.TrackTypePluginEffect].includes(d.type))for(let t of d.segments){if(!t.commonKeyframes.length)continue;let i={track_category:(0,A.IV)(d.type,e),keyframe_count:0,keyframe_types:[],material_category:""};for(let e of t.commonKeyframes){let{keyframeList:t}=e;t.length>0&&(e.propertyType!==v.Eu.KFTypePositionY&&(i.keyframe_count+=t.length),i.keyframe_types.push(e.propertyType))}if(i.keyframe_count<1)continue;let a=(0,w.p8)(t);i.material_category=a.material_category,o.push(i)}e&&t?s++:(0,F.MR)(d)&&s++}let d={};for(let e of o)!d[e.track_category]&&(d[e.track_category]=new Set),e.keyframe_types.forEach(t=>{if(x.pW[t]){var i,a;d[e.track_category].add(null!==(a=null===(i=x.pW[t])||void 0===i?void 0:i.control_type)&&void 0!==a?a:t)}});let l={};for(let e of Object.keys(d))l[e]=[...d[e]].join(",");return{is_free_tier:n?1:0,is_keyframe:o.length?"true":"false",keyframe_cnt:o.reduce((e,t)=>e+t.keyframe_count,0),keyframe_track_category:J(o.map(e=>e.track_category)),keyframe_detail:JSON.stringify(l),soundtrack_off_cnt:s}}_getBeautyParams(e){let t=this._mainDraftService.dataSdk.draftView.getDraftId(),i=0,a=[],r=[],n=[],o=[],s=0,d=[],l=0,c="",u="",h="",p=!1,_=!1,g=[],m=0;for(let F of e)for(let e of F.segments)if((0,v.hey)(e)){for(let t of e.figures){if((0,v.WPz)(t))continue;i=1;let{categoryId:e}=t,s=(0,P.W)(t);e===T.U_.AutoBeauty&&a.push(s),e===T.U_.AutoBeautyBody&&r.push(s),e===T.U_.AutoBeautyMakeup&&n.push(s),e===T.U_.AutoBeautyShape&&o.push(s)}if(e.adjust){var f,y,S,k,b,I,M,w,R,x;let{adjust:i}=e,a=!1,r=!1,n=!1;for(let e of Object.keys(D.i8)){let t=null!==(S=D.i8[e])&&void 0!==S?S:"";(0,O.isObject)(i[t])&&(null===(y=i[t])||void 0===y?void 0:y.value)&&(a=!0,c+=c?`,${A.n9[t]}`:A.n9[t])}for(let e of Object.keys(D.iT)){let t=null!==(b=D.iT[e])&&void 0!==b?b:"";(0,O.isObject)(i[t])&&(null===(k=i[t])||void 0===k?void 0:k.value)&&(r=!0,u+=u?`,${A.n9[t]}`:A.n9[t])}for(let e of Object.keys(D.vW)){let t=null!==(M=D.vW[e])&&void 0!==M?M:"";(0,O.isObject)(i[t])&&(null===(I=i[t])||void 0===I?void 0:I.value)&&(n=!0,h+=h?`,${A.n9[t]}`:A.n9[t])}if((null===(f=i.hsl)||void 0===f?void 0:f.some(e=>e.hue||e.lightness||e.saturation))&&(p=!0),i.colorCurves){_=!0;let i=null!==(x=null===(R=E.u.get(t))||void 0===R?void 0:null===(w=R.activeName)||void 0===w?void 0:w[e.id])&&void 0!==x?x:"Custom";g.push(i),m+=1}(a||r||n||p||_)&&(l+=1)}}else(0,v.w5o)(e)&&e.material.type===v.cVg.MetaTypeFaceEffect&&(s=1,d.push(e.material.effectId));return{is_beauty:i,beauty_detail:a.length?a.join(","):"",body_detail:r.length?r.join(","):"",makeup_detail:n.length?n.join(","):"",facial_beauty_detail:o.length?o.join(","):"",is_face_prop:s,face_prop_detail:d.length?d.join(","):"",color_adjustment_apply:l?1:0,color_adjustment_cnt:l,color_adjustment_basic_color:c,color_adjustment_basic_lightness:u,color_adjustment_basic_effects:h,color_adjustment_hsl_color:p?1:0,color_adjustment_curve_preset:g.join(","),color_adjustment_curve:m}}_getCommercialParams(e){let t={video:new Set,photo:new Set,transition:new Set,specialEffect:new Set,music:new Set,soundEffect:new Set,tone:new Set,textFont:new Set,textEffect:new Set,textTemplate:new Set,sticker:new Set,filter:new Set},i=e=>{for(let c of e)for(let e of c.segments){var a,r,n,o,s,d,l;if((0,v.hey)(e)){let i=e.material.type;if(i===v.cVg.MetaTypeVideo){let i=this._resourceService.get(`${p._g.Video}_${e.material.materialId}`,p._g.Video);i&&i.value.isBusiness&&t.video.add(e.material.materialId)}else if(i===v.cVg.MetaTypePhoto){let i=this._resourceService.get(`${p._g.Photo}_${e.material.materialId}`,p._g.Photo);i&&i.value.isBusiness&&t.photo.add(e.material.materialId)}let d=this._resourceService.get(`${p._g.Transition}_${null!==(n=null===(a=e.transition)||void 0===a?void 0:a.resourceId)&&void 0!==n?n:""}`,p._g.Transition);d&&d.value.isBusiness&&t.transition.add(null!==(s=null===(o=e.transition)||void 0===o?void 0:o.resourceId)&&void 0!==s?s:""),null===(r=e.videoEffects)||void 0===r||r.forEach(e=>{let i=this._resourceService.get(`${p._g.Effects}_${e.resourceId}`,p._g.Effects);i&&i.value.isBusiness&&t.specialEffect.add(e.resourceId)})}else if((0,v.Y9Q)(e)){let i=this._resourceService.get(`${p._g.Audio}_${e.material.musicId}`,p._g.Audio);i&&i.value.isBusiness&&t.music.add(e.material.musicId);let a=this._resourceService.get(`${p._g.Audio}_${e.material.effectId}`,p._g.Audio);a&&a.value.isBusiness&&t.soundEffect.add(e.material.effectId);let r=this._resourceService.get(`${p._g.Tone}_${e.material.resourceId}`,p._g.Tone);r&&r.value.isBusiness&&t.tone.add(e.material.resourceId)}else if((0,v.Ftn)(e)){let i=[e.material.fontResourceId];for(let a of(e.material.fonts.forEach(e=>{i.push(e.resourceId)}),i)){let e=this._resourceService.get(`${p._g.Font}_${a}`,p._g.Font);e&&e.value.isBusiness&&t.textFont.add(a)}let a=[null!==(l=null===(d=e.effect)||void 0===d?void 0:d.resourceId)&&void 0!==l?l:""];for(let i of(e.effects.forEach(e=>{a.push(e.resourceId)}),a)){let e=this._resourceService.get(`${p._g.TextPreset}_${i}`,p._g.TextPreset);e&&e.value.isBusiness&&t.textEffect.add(i)}}else if((0,v.Q2R)(e)){let i=this._resourceService.get(`${p._g.TextTemplate}_${e.material.resourceId}`,p._g.TextTemplate);i&&i.value.isBusiness&&t.textTemplate.add(e.material.resourceId)}else if((0,v.P2T)(e)){let i=this._resourceService.get(`${p._g.Sticker}_${e.material.resourceId}`,p._g.Sticker);i&&i.value.isBusiness&&t.sticker.add(e.material.resourceId)}else if((0,v.SiN)(e)){let i=this._resourceService.get(`${p._g.Filter}_${e.material.resourceId}`,p._g.Filter);i&&i.value.isBusiness&&t.filter.add(e.material.resourceId)}else if((0,v.w5o)(e)){let i=this._resourceService.get(`${p._g.Effects}_${e.material.resourceId}`,p._g.Effects);i&&i.value.isBusiness&&t.specialEffect.add(e.material.resourceId)}else(0,v.kjj)(e)&&i(e.material.draft.getAllTracks())}};return i(e),{commercial_video_cnt:t.video.size,commercial_photo_cnt:t.photo.size,commercial_transition_cnt:t.transition.size,commercial_special_effect_cnt:t.specialEffect.size,commercial_music_cnt:t.music.size,commercial_sound_effect_cnt:t.soundEffect.size,commercial_tone_cnt:t.tone.size,commercial_text_font_cnt:t.textFont.size,commercial_text_effect_cnt:t.textEffect.size,commercial_text_template_cnt:t.textTemplate.size,commercial_sticker_cnt:t.sticker.size,commercial_filter_cnt:t.filter.size}}_getVideoTrackingParams(e){let t=0;for(let a of e)if([v.pNd.TrackTypeText,v.pNd.TrackTypeSticker].includes(a.type))for(let e of a.segments){var i;((0,v.P2T)(e)||(0,v.Ftn)(e)||(0,v.Q2R)(e))&&(null===(i=e.videoTracking)||void 0===i?void 0:i.enableVideoTracking)&&t++}return{tracking_cnt:t}}_getSmartToolParams(){var e,t,i,a,r,n,o,s,d,l,c,u,h,p,_;let g=this._mainDraftService.cloudMetaManager.getMeta(),v=this._mainDraftService.dataSdk.draftView,y=this._getIsTemplate(),S=(null==g?void 0:null===(e=g.draft)||void 0===e?void 0:e.transferedFrom)===m.ZZ.ad_script?null==g?void 0:null===(t=g.draft)||void 0===t?void 0:t.scriptInfo:{},T=(null==g?void 0:null===(i=g.draft)||void 0===i?void 0:i.autocutInfo)?{...JSON.parse((null==g?void 0:null===(a=g.draft)||void 0===a?void 0:a.smartToolsInfo)||"{}"),task_id:null==g?void 0:null===(r=g.draft)||void 0===r?void 0:r.autocutInfo.taskId,intelligent_request_id:null!==(p=null==g?void 0:null===(n=g.draft)||void 0===n?void 0:n.autocutInfo.intelligentRequestId)&&void 0!==p?p:"",autocut_template_id:null==g?void 0:null===(o=g.draft)||void 0===o?void 0:o.autocutInfo.autocutTemplateId}:{},k=(null==g?void 0:null===(s=g.draft)||void 0===s?void 0:s.transferedFrom)===m.ZZ.url_to_video?{...JSON.parse((null==g?void 0:null===(d=g.draft)||void 0===d?void 0:d.smartToolsInfo)||"{}"),template_id:null!==(_=null==g?void 0:null===(l=g.draft)||void 0===l?void 0:l.templateId)&&void 0!==_?_:""}:{};return{...this._getTextToVideoReportParams(),...this._getLongToShortReportParams(),...this._getAiVideoReportParams(),...S,...T,...k,original_edittype:(0,f.F)(y,null==g?void 0:null===(c=g.draft)||void 0===c?void 0:c.transferedFrom),tool_type:(0,f.XX)(null==g?void 0:null===(u=g.draft)||void 0===u?void 0:u.transferedFrom),is_smart_tool:(0,f.GT)(null===(h=g.draft)||void 0===h?void 0:h.transferedFrom)?"1":"0",is_smart_crop:(0,f.Cr)(v)?"1":"0",tts_trace_id:null==k?void 0:k.trace_id}}_getDraftCollaboratorParams(){return{is_share:this._collaboratorDataService.getIsShareOpen()}}_getLongToShortReportParams(){let e=new URLSearchParams(new URL(window.location.href).search);return{task_type:e.get("task_type"),task_language:e.get("task_language")}}_getTextToVideoReportParams(){var e,t;let{searchParams:i}=new URL(window.location.href),a=this._mainDraftService.cloudMetaManager.getMeta(),{userGeneratedMaterials:r}=this._draftMaterialsService.getMaterials();return{text_to_video_material_source:r.find(e=>{var t,i;return(null===(i=e.draftDelta)||void 0===i?void 0:null===(t=i.meta)||void 0===t?void 0:t.visible)&&this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(e.key)})?"upload":"smart_match",...JSON.parse((null==a?void 0:null===(e=a.draft)||void 0===e?void 0:e.smartToolsInfo)||"{}"),video_generate_type:null!==(t=i.get("__video_generate_type"))&&void 0!==t?t:void 0}}_getAiVideoReportParams(){let{userGeneratedMaterials:e}=this._draftMaterialsService.getMaterials(),t=e.map(e=>{if(e.fileType===s.YB.Video&&e.sourceType===s.ov.EverCloud){var t;let i=(0,_.D)(null!==(t=e.meta)&&void 0!==t?t:"");if(30===i.smart_tool_type)return{ai_video_request_model:i.ai_video_request_model,ai_video_request_id:i.ai_video_request_id,ai_video_prompt:i.prompt}}}).filter(Boolean);return{ai_video_cnt:t.length,ai_video_request_model:t.map(e=>e.ai_video_request_model).join(","),ai_video_request_id:t.map(e=>e.ai_video_request_id).join(","),ai_video_prompt:t.map(e=>e.ai_video_prompt).join("&")}}_getRecorderReportParams(){let{userGeneratedMaterials:e}=this._draftMaterialsService.getMaterials(),t=0,i=0,a=!1,r=!1;for(let n of e){let{meta:e,fileType:o,filename:d}=n,{isWebRecorderMaterial:l,isRecorderExtensionMaterial:c}=this._getRecorderTypeFromName(null!=d?d:"");if(!!l||!!c)o===s.YB.Video&&t++,o===s.YB.Audio&&i++,l&&(a=!0),c&&(r=!0)}return{is_record_plugin:r?1:0,is_with_record:a||r?1:0,screen_record_cnt:t,audio_record_cnt:i}}_getRecorderTypeFromName(e){return{isWebRecorderMaterial:e.startsWith("recorder_"),isRecorderExtensionMaterial:e.startsWith("ext_recorder_")}}_getRecorderTypeFromMeta(e){var t;let i=(0,_.D)(null!=e?e:""),a=null==i?void 0:null===(t=i.recorderInfo)||void 0===t?void 0:t.from;return{isWebRecorderMaterial:"web"===a,isRecorderExtensionMaterial:"extension"===a}}_getBaseParams(){var e,t,i,a,r;let n=this._mainDraftService.cloudMetaManager.getMeta(),{searchParams:o}=new URL(window.location.href),{templateMap:s}=this._params,d=this._getIsTemplate(),l=!1;Object.values(s).forEach(e=>{(0,y._M)(e)&&(l=!0)});let c=this._mainDraftService.dataSdk.draftView.getAllSegments().filter(B.kV).map(e=>e.id),u=!this._videoEnvironmentService.draftIdFromUrl;return{is_enter_template_blank:(null===(e=n.draft.webVideoEditorInfo)||void 0===e?void 0:e.created_from)===m.t5.EmptyCutsame?1:0,current_page:d?"template_editor":"editor",enter_from:(0,U.i)(u),from_page:(0,L.X)(),enter_position:null!==(a=o.get("__action_from"))&&void 0!==a?a:void 0,edittype:d?"template":"edit",scenario:null==n?void 0:null===(t=n.draft)||void 0===t?void 0:t.createScenario,create_time:null!==(r=null==n?void 0:null===(i=n.createSource)||void 0===i?void 0:i.createTime)&&void 0!==r?r:0,edit_days:this._params.edit_days,edit_time:this._params.edit_time,finish_days:this._params.finish_days,save_time:this._params.saveTime,is_sample_video:this._params.isSampleVideo?1:0,format:this._params.format,fps:this._params.fps,has_watermark:this._params.hasWatermark,resolution:this._params.resolution,gif_resolution:this._params.gifResolution,bit_rate_type:this._params.bitRateType,video_duration:this._params.duration,video_id:this._params.videoId,video_title:this._params.videoTitle,video_type_list:this._params.videoTypeList,edit_export_type:this._params.editExportType,is_same_dots:l?1:0,quick_import_segments:(0,y.kQ)(c),is_cover_added:this._params.isCoverAdded}}_getMaterialBySegment(e){let{path:t,sourcePlatform:i}=null==e?void 0:e.material,a=this._mainDraftService.draftPathStore.getResourceKeyFromDraftPath(t);try{if(a&&i===v.cvu.MaterialPlatformDefault)return this._draftMaterialsService.getMaterialByKey(a);return}catch{return}}_getTemplateParams(){var e,t,i,a,r,n,o;let s=[],d=[],l=[],c=[],u=[],h=[],p=[],g=[],m=[],f=[],S=[],T=[],k=0,b=0,I=null!==(t=(0,V.t$)({mainDraftService:this._mainDraftService,mainEditorWidgetService:this._mainEditorWidgetService,videoEnvironmentService:this._videoEnvironmentService},["part_export_sametime","part_export"].includes(this._params.editExportType)))&&void 0!==t?t:{},M=this._getIsTemplate(),w=this._mainDraftService.draftTemplateManager.getTemplateId(),P=null===(e=this._mainDraftService.cloudMetaManager.getMeta().draft.webVideoEditorInfo)||void 0===e?void 0:e.template_infos,D=M?[w]:[],A=[];for(let e of(this._isPartExport()?A.push(...this._mainEditorWidgetService.selection.getSelectedSegments()):A.push(...this._mainDraftService.dataSdk.draftView.getAllSegments()),A)){if(""!==e.templateId&&(0,v.duj)(e)){u.push((0,V.h$)(e,this._mainDraftService));if(d.push((null===(i=e.materialDraft)||void 0===i?void 0:i.draft.getDraftName().endsWith("from_template"))?"template":"edit"),s.push(e.material.materialName),D.push(e.templateId),l.push(""!==e.material.categoryName?e.material.categoryName:"none"),c.push(""!==e.material.categoryId?e.material.categoryId:"none"),h.push(`${e.material.width}:${e.material.height}`),!M&&P)for(let t of P)t.template_id===e.templateId&&(p.push(t.template_from),g.push(t.template_search_id),m.push(t.template_search_keyword),f.push(t.template_search_keyword_source),S.push(t.template_search_scene),T.push(t.template_source_tab_name))}if((0,v.hey)(e)){let t=this._getMaterialBySegment(e);(null==t?void 0:t.meta)&&(null===(a=(0,_.D)(null==t?void 0:t.meta))||void 0===a?void 0:a.is_from_tt_live)&&(k=1)}}if(M&&P&&1===P.length&&(p.push(P[0].template_from),g.push(P[0].template_search_id),m.push(P[0].template_search_keyword),f.push(P[0].template_search_keyword_source),S.push(P[0].template_search_scene),T.push(P[0].template_source_tab_name),l.push((null===(r=P[0])||void 0===r?void 0:r.template_category)||"none"),c.push((null===(n=P[0])||void 0===n?void 0:n.template_category_id)||"none")),M){let e=this._mainDraftService.dataSdk.draftView.getCanvasConfig();h.push(`${e.width}:${e.height}`);let t=this._params.templateMap[w];b=this._mainDraftService.dataSdk.cutSame.getMutableVideos().filter(e=>!e.visible).length,u.push((0,y.i1)(t)),s.push(t.name)}else b=this._mainDraftService.dataSdk.draftView.getAllSegments().reduce((e,t)=>(0,v.duj)(t)?e.concat(this._mainDraftService.dataSdk.cutSame.getMutableVideos(t.materialDraft.draft.getDraftId())):e,[]).filter(e=>!e.visible).length;let R=this._mainDraftService.dataSdk.draftView.getAllSubDraft(!1).map(e=>e.getDraftId()),x=this._mainDraftService.draftTemplateManager.getDraftChangedSummary(R),F=(0,y.$0)(this._mainDraftService.draftTemplateManager),{searchParams:E}=new URL(window.location.href);return{...I,...F,template:s.join(","),template_id:D.join(","),template_add_source:d.join(","),template_category:l.join(","),template_category_id:c.join(","),template_cnt:s.length,template_fragment_cnt:u.join(","),template_scale:h.join(","),template_from:(0,y.kQ)(p),template_search_id:(0,y.kQ)(g),template_search_keyword:(0,y.kQ)(m),template_search_keyword_source:(0,y.kQ)(f),template_search_scene:(0,y.kQ)(S),template_source_tab_name:(0,y.kQ)(T),work_space_template_from:null!==(o=E.get("work_space_template_from"))&&void 0!==o?o:void 0,used_ttlive_material:k,template_hide_cnt:b,template_text_adjusted:x.is_change_text?1:0,template_is_smart_crop:x.is_smart_crop?"1":"0",template_is_move_material:x.is_move_material?"1":"0"}}_getTtsParams(){let e=0,t=0,i=0;return this._mainDraftService.dataSdk.draftView.getAllSegments().forEach(a=>{(0,v.Y9Q)(a)&&(a.material.type===v.cVg.MetaTypeTextToAudio?e=1:a.material.type===v.cVg.MetaTypeVideoOriginalSound&&t++,a.material.isAiCloneTone&&(i=1))}),{use_tts:e,template_audio_local_cnt:t,is_clone:i}}_getSvgParams(){let e=0;return this._mainDraftService.dataSdk.draftView.getAllSegments().forEach(t=>{(0,v.P2T)(t)&&e++}),{svg_sticker_cnt:e}}_getColorSpaceParam(){return{color_space:M.ZP.t("standard_sdr__rec_709",{},"\u6807\u51C6 SDR - Rec.709")}}_getTemplateSegmentRelatedParams(){let e=new Set,t=this._isPartExport()?this._mainEditorWidgetService.selection.getSelectedSegments():this._mainDraftService.dataSdk.draftView.getAllSegments(),{cutSame:i}=this._mainDraftService.dataSdk,a=[],r=0,n=0,o=0,s=0,d=[],l=[],c=[],u=[],h=[];for(let p of t){if(!(0,v.duj)(p))continue;let{templateId:t}=p,_=p.materialDraft.draft.getDraftId();if(_&&!e.has(_)&&t){e.add(_);let g=this._params.templateMap[t];a.push((0,V.wr)(p,this._mainDraftService)),r+=(0,y.Ph)(p,this._mainDraftService).length,n+=(0,y.Cw)(g,p,this._mainDraftService),o+=(0,y.r$)(g),s+=(0,y.ke)(_,i,g),d.push((0,y.Op)(g)),l.push((0,y.Em)(_,i,g)),c.push((0,y.dP)(_,i,g)),u.push((0,y.r1)(g)),h.push((0,y.dT)(g))}}let{templateFilterCnt:p,templateFilterIds:_}=(0,y.cI)(t);return{actual_fragment_cnt:(0,y.kQ)(a),can_update_music:(0,y.kQ)(d),change_song_status:(0,y.kQ)(l),updated_music:(0,y.kQ)(c),is_commercial_template:(0,y.kQ)(u),is_from_cloud:(0,y.bf)()?"true":"false",is_mute:(0,y.kQ)(h),template_gameplay_cnt:r,template_algorithm_cnt:n,template_text_cnt:o,template_filter_cnt:p,template_filter_id:_,template_modified_cnt:s}}_getTemplateInfoRelatedParams(){let e=this._mainDraftService.dataSdk.draftView.getDraftId(),t=this._mainDraftService.draftTemplateManager.getTemplateId(),i=this._params.templateMap[t],{cutSame:a}=this._mainDraftService.dataSdk,r=this._mainDraftService.dataSdk.draftView.getAllSegments(),{templateFilterCnt:n,templateFilterIds:o}=(0,y.cI)(r);return{actual_fragment_cnt:(0,y.BE)(e,a,i),can_update_music:(0,y.Op)(i),change_song_status:(0,y.Em)(e,a,i),updated_music:(0,y.dP)(e,a,i),is_commercial_template:(0,y.r1)(i),is_from_cloud:(0,y.bf)()?"true":"false",is_mute:(0,y.dT)(i),template_gameplay_cnt:(0,y.jw)(i),template_algorithm_cnt:(0,y.Cw)(i),template_text_cnt:(0,y.r$)(i),template_filter_cnt:n,template_filter_id:o,template_modified_cnt:(0,y.ke)(e,a,i)}}_getCanvasRelatedParams(){return{aspect_ratio:this._mainDraftService.dataSdk.draftView.getCanvasConfig().ratio}}_getSearchParamsRelatedParams(){var e,t,i;let a=this._mainDraftService.dataSdk.draftView.getAllSegments(),{searchParams:r}=new URL(window.location.href),n=this._themeService.getTheme();return{mix_mode_all:a.filter(v.hey).map(g.TJ).filter(Boolean).join(","),output_cnt:null!==(e=r.get("output_cnt"))&&void 0!==e?e:void 0,prompt:r.get("autocut_prompt_cnt")?Number(r.get("autocut_prompt_cnt")):void 0,prompt_character_cnt:r.get("autocut_prompt_cnt")?Number(r.get("autocut_prompt_cnt")):void 0,rank:null!==(t=r.get("rank"))&&void 0!==t?t:void 0,theme:n===k.h.Dark?"dark":"light",tools_in_edit:null!==(i=r.get("__tool_type"))&&void 0!==i?i:void 0}}_getUserRelatedParams(){var e;let t=this._accountService.userVipInfo,i=this._mainDraftService.draftWorkspaceManager.workspaceId,{workspaceExpandInfoMap:a}=this._workspaceService;return{membership_type_now:(0,I.F)(t),cloud_storage_now:(0,I.$)(null==a?void 0:null===(e=a[i])||void 0===e?void 0:e.spaceList)}}_getSegmentRelatedParams(){let e=this._mainDraftService.dataSdk.draftView.getAllTracks(),t=this._mainDraftService.dataSdk.draftView.getAllSegments();return{is_beauty:(0,y.RF)(t),video_animation:(0,y.An)(e),video_cnt:(0,y.Ym)(e)}}_getVipParams(){let{checkListManager:e}=this._mainEditorWidgetService,{validEffects:t,validTools:i}=e.observeCheckListManagerData;return(0,S.DB)(t,i)}_getPluginParams(e){let t={},i=new Set,a=0;for(let n of e)for(let e of n.segments){if(!(0,v.hey)(e)&&!(0,v.Y9Q)(e))continue;let n=this._getMaterialBySegment(e);if(n&&(null==n?void 0:n.meta)){var r;let o=null===(r=(0,_.D)(null==n?void 0:n.meta))||void 0===r?void 0:r.plug_in_name;if(o){let r;let{filename:s,id:d=""}=n,l=t[o]||[];r=(0,v.hey)(e)&&e.material.type===v.cVg.MetaTypePhoto?"image":(0,v.hey)(e)?"video":"audio",l.push({id:d,name:s,type:r}),++a,t[o]=l,i.add(r)}}}return{is_third_party:a>0?1:0,plug_in_name:Object.keys(t).join(","),plug_in_material_type:Array.from(i).join(","),plug_in_material_num:a,plug_in_material_json:JSON.stringify(t)}}_getAiWriterParams(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=0,i=0,a=0,r=0,n=0,o=v.lLh.getInstance().get(N.fQ);return o&&e.forEach(e=>{let s=e.id;switch(o.getSegmentAiWriterType(s,this._mainDraftService.dataSdk)){case v.TUZ.GenerateTitle:t+=1;break;case v.TUZ.GenerateText:i+=1;break;case v.TUZ.Rewrite:a+=1;break;case v.TUZ.Shorter:r+=1;break;case v.TUZ.Longer:n+=1}}),{ai_generate_title_cnt:t,ai_generate_body_text_cnt:i,ai_rewrite_text_cnt:a,ai_write_shorter_text_cnt:r,ai_write_longer_text_cnt:n}}_getVideoNoiseReductionParams(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=[],i={[v.rqx.Strong_NR]:"strong",[v.rqx.Weak_NR]:"weak",[v.rqx.None_NR]:""};for(let a of e){if(!(0,v.hey)(a))continue;let{algorithms:e,noiseReduction:r}=a.material.videoAlgorithm;if(!!e.some(e=>e.type===v.zzh.NoiseReduction)&&void 0!==(null==r?void 0:r.level)&&!!i[null==r?void 0:r.level])t.push(i[r.level])}return t.length?{denoise_cnt:t.length,denoise_level:t.join(",")}:{denoise_cnt:0}}_getVideoDeflickerParams(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=[],i=[];for(let a of e){if(!(0,v.hey)(a))continue;let{algorithms:e,deflicker:r}=a.material.videoAlgorithm;if(!!e.some(e=>e.type===v.zzh.Deflicker)&&!!r)t.push(G.s1[r.level]),i.push(G.Ec[r.mode])}return t.length?{deflicker_cnt:t.length,deflicker_level:t.join(","),deflicker_type:i.join(",")}:{deflicker_cnt:0}}_getObjectLockParams(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=[],i={[v.NGh.Face]:"head_tracking",[v.NGh.Body]:"body_tracking",[v.NGh.LeftHand]:"hands_tracking",[v.NGh.RightHand]:"hands_tracking",[v.NGh.Custom]:"custom_tracking"};for(let a of e)if((0,v.hey)(a)){let{objectLocked:e}=a.material;e&&t.push(i[e.lockedType])}return t.length?{camera_tracking_cnt:t.length,camera_tracking_object:t.join(",")}:{camera_tracking_cnt:0}}_getVocalSeparationParams(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=[];for(let i of e)((0,v.hey)(i)||(0,v.Y9Q)(i))&&i.vocalSeparation.choice!==v.ZTd.None&&t.push(i.vocalSeparation.choice===v.ZTd.Vocal?1:0);return{voice_isolation_cnt:t.length,voice_isolation_level:t.length>0?t.join(","):void 0}}_getVocalBeautifyParams(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=[];for(let i of e)((0,v.hey)(i)||(0,v.Y9Q)(i))&&i.vocalBeautify&&i.vocalBeautify.enable&&t.push(i.vocalBeautify.ambientSoundLevel);return{voice_enhance_cnt:t.length,voice_enhance_level:t.length>0?t.join(","):void 0}}constructor(e,t,i,a,r,n,o,s,d,l,c){this._params=e,this._mainDraftService=t,this._videoEnvironmentService=i,this._containerService=a,this._mainEditorWidgetService=r,this._accountService=n,this._workspaceService=o,this._themeService=s,this._draftMaterialsService=d,this._resourceService=l,this._collaboratorDataService=c,this.eventName="_export_info"}}X=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.fM)(2,r.rO),(0,a.fM)(3,d.t),(0,a.fM)(4,o.a),(0,a.fM)(5,h.Gw),(0,a.fM)(6,l.W),(0,a.fM)(7,b.X),(0,a.fM)(8,C.D),(0,a.fM)(9,c.c),(0,a.fM)(10,u.U),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IExportInfoParams?Object:IExportInfoParams,void 0===n.n?Object:n.n,void 0===r.rO?Object:r.rO,void 0===d.t?Object:d.t,void 0===o.a?Object:o.a,void 0===h.Gw?Object:h.Gw,void 0===l.W?Object:l.W,void 0===b.X?Object:b.X,void 0===C.D?Object:C.D,void 0===c.c?Object:c.c,void 0===u.U?Object:u.U])],X)},998828:function(e,t,i){i.d(t,{f:function(){return u},p:function(){return h}});var a=i(789786),r=i(356954),n=i(896413),o=i(426336),s=i(860660),d=i(860147),l=i(722169);class c{getEventParams(){let{validEffects:{vipValidEffects:e=[]},validTools:t={}}=this._mainEditorWidgetService.checkListManager.observeCheckListManagerData,{vipValidTools:i=[]}=t;return{apply_to_local:this._params.applyToLocal,apply_to_all:this._params.applyToAll,current_page:this._params.currentPage,material_category:this._params.materialCategory,panel:this._params.panel,function_category:this._params.functionCategory,control_type:this._params.controlType,action_method:this._params.actionMethod,control_detail:this._params.controlDetail,control_option:this._params.controlOption,function_subcategory:this._params.controlType&&["scale","position x","position y","rotate"].includes(this._params.controlType)?"transform":void 0,template_id:this._mainEditorWidgetService.segmentSelection.subDraftTemplateId||void 0,...this._params.textParams,is_vip:!!((null==e?void 0:e.length)+(null==i?void 0:i.length))}}constructor(e,t){this._params=e,this._mainEditorWidgetService=t,this.eventName="click_new_text_confirm"}}function u(e,t){(0,r.K)(e,c,[t])}function h(e){var t,i;let{segment:a,textParams:r,richTextEditorManager:n,instantiationService:c}=e,h=(0,s.p8)(a),p="text_template"===h.text_type,_=p?0:n.getSelectedText()===a.material.text?0:1,g=(0,o.Ftn)(a)&&!(0,l.isNil)(a.bloom)&&BigInt(a.material.checkFlag)&o.PbZ.LightFlag;u(c,{applyToLocal:_,currentPage:"editor",materialCategory:h.material_category,panel:"player",textParams:{...r,text_content:null!==(t=r.text_content)&&void 0!==t?t:p?"":a.material.text,text_source:(0,d.r2)(a),text_type:null!==(i=null==r?void 0:r.text_type)&&void 0!==i?i:(0,d.RK)(a),text_section:p?n.getSelectedSegmentChildIndex():void 0,track_category:h.track_category,text_glow:g?1:0,text_glow_type:(0,o.Ftn)(a)&&!(0,l.isNil)(a.bloom)?a.bloom.resourceId:void 0}})}c=(0,a.gn)([(0,a.fM)(1,n.a),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===n.a?Object:n.a])],c)},890392:function(e,t,i){i.d(t,{Af:function(){return l},ps:function(){return d},rf:function(){return u}});var a,r,n=i(789786),o=i(356954),s=i(200247);var d=((a={}).UPLOAD="upload",a.DROPBOX="dropbox",a.GOOGLE_DRIVE="google_drive",a.LOCAL="local",a.FROM_COMPUTER="from_computer",a.DRAG="drag",a.FROM_PHONE="from_phone",a.EXTRA_AUDIO="extra_audio",a.FROM_VIDEO="from_video",a.SHARE_UPLOAD_LINK="share_upload_link",a.FROM_SHOPIFY="shopify",a);var l=((r={}).BOTTOM="bottom",r.DROP_DOWN="drop_down",r.CANVAS="canvas",r.PHONE_UPLOAD="phone_upload",r.BROWSER_OUTSIDE="browser_outside",r.FROM_VIDEO="from_video",r.PANEL="panel",r.FROM_COMPUTER="from_computer",r);class c{getEventParams(){return{click_type:this._params.click_type,position:this._params.position,is_login:this._accountService.hasLogin?1:0}}constructor(e,t){this._params=e,this._accountService=t,this.eventName="click_import"}}function u(e,t){(0,o.K)(e,c,[t])}c=(0,n.gn)([(0,n.fM)(1,s.D),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===s.D?Object:s.D])],c)},65263:function(e,t,i){i.d(t,{B:function(){return n}});var a=i(356954);class r{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="perf_cover_highlight_set_cover"}}function n(e,t){(0,a.K)(e,r,[t])}},937093:function(e,t,i){i.d(t,{N:function(){return n}});var a=i(356954);class r{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="perf_cover_video_frame_ready"}}function n(e,t){(0,a.K)(e,r,[t])}},862678:function(e,t,i){i.d(t,{y:function(){return n}});var a=i(356954);class r{getEventParams(){let{total:e,preload:t}=this._params;return{total:e,preload:t}}constructor(e){this._params=e,this.eventName="draft-collab-apply-duration"}}function n(e,t){(0,a.K)(e,r,[t])}},970244:function(e,t,i){i.d(t,{B7:function(){return r},gl:function(){return n}});var a=i(426336);let r=3e3;a.pNd.TrackTypeVideo,a.pNd.TrackTypeText,a.pNd.TrackTypeTextToVideoText,a.pNd.TrackTypeSticker,a.pNd.TrackTypeVideoEffect,a.pNd.TrackTypeFilter,a.pNd.TrackTypeAdjust;let n=!1},761811:function(e,t,i){i.d(t,{g:function(){return r}});var a=i(426336);let r=(e,t)=>{let{segId:i,textInfo:r}=t,n=e.getSegmentById(i);if(!n||!(0,a.Q2R)(n))return;if(!n.material.version){let r=a.ysb.updateTextTemplateText(n,t);if(!r)return;let o=(0,a.xXD)({__segment_struct_type:n.__segment_struct_type});return a.T8X.pick(n,r,o),{trackId:e.getTrackBySegmentId(n.id).id,trackIndex:e.getTrackIndexBySegmentId(n.id),segmentId:i,segmentDelta:r,sourceSegmentDelta:o}}let o=n.material.textInfoResources,{index:s,content:d}=r;if(s<0||s>=o.length)return;let l=o[s].textMaterial,c=a.ic0.combineModifyFlags([a.XHM.ModifyContent]),u=(0,a.U_g)({content:d,replaceStyleRichText:r.replaceStyleRichText});if(!u.replaceStyleRichText&&(u.replaceStyleRichText=l.content),!u.replaceStyleRichText){let e=a.ysb.getDefaultRichTexts(n.material.path);s<e.length&&(u.replaceStyleRichText=e[s])}!u.replaceStyleRichText&&(u.replaceStyleRichText=`<size=15>${d}</size>`);let h=n.clone();a.ysb.updateTextMaterial(h,u,l.id,c);let p=new a.kph;p.material=new a._0h,p.material.textInfoResources=h.material.textInfoResources,p.material.nonTextInfoResources=h.material.nonTextInfoResources;let _=(0,a.xXD)({__segment_struct_type:n.__segment_struct_type});return a.T8X.pick(n,p,_),{trackId:e.getTrackBySegmentId(n.id).id,trackIndex:e.getTrackIndexBySegmentId(n.id),segmentId:n.id,segmentDelta:p,sourceSegmentDelta:_}}},181613:function(e,t,i){i.d(t,{N:function(){return d}});var a=i(789786),r=i(147954),n=i(210823),o=i(307891),s=i(230689);class d{get screenRecorderEvent(){return this._screenRecorderEvent}get enteringAudioRecordMode(){return o.W.getInstance().enteringAudioRecordMode}constructor(e,t){this._containerService=e,this._workbenchService=t,this._screenRecorderEvent=new r.I,i.e("6522").then(i.bind(i,131016)).then(e=>{let{MiddlewareRegsiter:t}=e;this._containerService.createInstance(t)})}}d=(0,a.gn)([(0,a.fM)(0,s.t),(0,a.fM)(1,n.e),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===s.t?Object:s.t,void 0===n.e?Object:n.e])],d)},637836:function(e,t,i){i.d(t,{Z:function(){return r}});var a=i(425427);let r=class e{initAndExposeAbTest(){this._teaAdapterService.getABTestVar("enable_simd_optimization",{enable:!1}),this._teaAdapterService.getABTestVar("enable_matting_optimization",{enable:!1}),this._teaAdapterService.getABTestVar("enable_use_freid_v2",{enable:!1}),this._teaAdapterService.getABTestVar("matting_thread_num",0),this._teaAdapterService.getABTestVar("skeleton_thread_num",0),this._teaAdapterService.getABTestVar("enable_et_data_capturing",{enable:!1}),this._teaAdapterService.getABTestVar("ve_enable_stream_fetch_api",{enable:!1}),this._teaAdapterService.getABTestVar("ve_enable_audio_worklet",{enable:!1}),this._teaAdapterService.getABTestVar("skeleton_model_size_type",0),this._teaAdapterService.getABTestVar("enable_facefitting_optimization",{enable:!1}),this._teaAdapterService.getABTestVar("ve_enable_refresh_opt",{enable:!1}),this._teaAdapterService.getABTestVar("ve_opt_render_handle_preload",{enable:!1}),this._teaAdapterService.getABTestVar("ve_enable_swing_effect_algorithm_preload",{enable:!1}),this._teaAdapterService.getABTestVar("enable_bach_algorithm_preload",{enable:!1}),this._teaAdapterService.getABTestVar("enable_segment_xshader_reuse",{enable:!1}),this._teaAdapterService.getABTestVar("enable_video_segment_lazy_load_tween_system",{enable:!1}),this._teaAdapterService.getABTestVar("lua_gc_throttle_wait_time",0),this._teaAdapterService.getABTestVar("enable_looki_hook",!1),this._teaAdapterService.getABTestVar("enable_looki_uid",!1),this._teaAdapterService.getABTestVar("enable_looki_ip",!1),this._teaAdapterService.getABTestVar("enable_png_decode_simg_opt",!1),this._teaAdapterService.getABTestVar("enable_new_engine_transition",!1),this._teaAdapterService.getABTestVar("enable_delay_thread_optimization",{enable:!1}),this._teaAdapterService.getABTestVar("veabtest_enable_switch_sticker",!1),this._teaAdapterService.getABTestVar("stickers_enableHotWords",!1).then(e=>{window.localStorage.setItem("stickers_enableHotWords",e?"enabled":"disabled")}),this._teaAdapterService.getABTestVar("enable_new_algorithm_system_node_parallel",{enable:!1}),this._environmentService.appSubType===a.cP.MultiTrack&&this._teaAdapterService.getABTestVar("enable_video_cover_optimization",{enableCoverInExport:!1,enableCoverInTimeline:!0}).then(e=>{window.localStorage.setItem("enable_video_cover_optimization",JSON.stringify(e))}),this._teaAdapterService.getABTestVar("use_editor_with_combine_tab",{enable:1}),this._teaAdapterService.getABTestVar("animseq_preload_count",-1),this._teaAdapterService.getABTestVar("enable_ai_writer",!1),this._teaAdapterService.getABTestVar("text-template-use-vimo",!1),this._teaAdapterService.getABTestVar("enable_stream_fetch_opt",!0),this._teaAdapterService.getABTestVar("veabtest_audio_reader_unit_refactor",!0),this._teaAdapterService.getABTestVar("enable_video_denoise",!1),this._teaAdapterService.getABTestVar("enable_draw_frame_from_fe",!1),this._teaAdapterService.getABTestVar("enable_age_gate_signup",!1),this._teaAdapterService.getABTestVar("ve_enable_track_clip_opt",!1),this._teaAdapterService.getABTestVar("capcut_web_diversion_pc",{ab_group:0})}constructor(e,t){this._teaAdapterService=e,this._environmentService=t,this.getBooleanAbTestValue=(e,t)=>{var i,a;return!!((null===(a=window)||void 0===a?void 0:null===(i=a._libra_abtest)||void 0===i?void 0:i[e])||t)},this.getAbTestValue=async(e,t)=>{var i,a;let r=null===(a=window)||void 0===a?void 0:null===(i=a._libra_abtest)||void 0===i?void 0:i[e];return void 0===r&&(r=await this._teaAdapterService.getABTestVar(e,t)),r||t}}}},861807:function(e,t,i){i.d(t,{u:function(){return a}});let a=(0,i(335290).yh)("customUndoRedo")},484829:function(e,t,i){i.d(t,{BA:function(){return d},V5:function(){return s},dU:function(){return o}});var a,r,n=i(335290);var o=((a={})[a.Applied=100]="Applied",a);var s=((r={})[r.Generate=0]="Generate",r[r.RemoveBackground=1]="RemoveBackground",r);let d=(0,n.yh)("digital-human-service")},425427:function(e,t,i){i.d(t,{JY:function(){return h},Nn:function(){return c},US:function(){return l},cP:function(){return d},o2:function(){return u},rO:function(){return _},xA:function(){return p}});var a,r,n=i(335290),o=i(396190),s=i(722169);var d=((a={})[a.MultiTrack=0]="MultiTrack",a[a.Template=1]="Template",a[a.ThirdParty=2]="ThirdParty",a);var l=((r={}).Editor="editor",r.Template="template",r);function c(e){return 2===e.appSubType}function u(e){return 0===e.appSubType}function h(e){return 1===e.appSubType}function p(e){let{draftIdFromUrl:t,templateIdFromUrl:i}=e;return!!h(e)&&(""===t||(0,s.isNil)(t))&&(""===i||(0,s.isNil)(i))}let _=(0,n.LO)(o.Y)},87927:function(e,t,i){i.d(t,{U:function(){return a}});let a=(0,i(335290).yh)("generate-caption-service")},15755:function(e,t,i){i.d(t,{D:function(){return s}});var a=i(789786),r=i(587892),n=i(402655),o=i(108692);class s extends n.JT{startGenerateCaptionTask(e){this._onCaptionTaskChange.fire(e)}constructor(e){super(),this._mainDraftService=e,this._onCaptionTaskChange=new r.Q,this.onCaptionTaskChange=this._onCaptionTaskChange.event}}s=(0,a.gn)([(0,a.fM)(0,o.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===o.n?Object:o.n])],s)},183346:function(e,t,i){i.d(t,{AS:function(){return u},F3:function(){return n},PC:function(){return l},Zq:function(){return c},gh:function(){return s},kb:function(){return d},lr:function(){return o}});var a,r=i(335290);var n=((a={}).EditorAreaBaseGuide="EditorAreaBaseGuide",a.EditorAreaIsNewEmptyGuide="EditorAreaIsNewEmptyGuide",a.FirstToSplitSegmentPopoverGuide="FirstToSplitSegmentPopoverGuide",a.TranslationOpenMenuTabFixedGuide="TranslationOpenMenuTabFixedGuide",a.KeyframeControlPopoverGuide="KeyframeControlPopoverGuide",a.SpeedModeBadgeGuide="SpeedModeBadgeGuide",a.SpeedModeCurveBadgeGuide="SpeedModeCurveBadgeGuide",a.VideoPictureAdjustBadgeGuide="VideoPictureAdjustBadgeGuide",a.MagicToolsRetouchBadgeGuide="MagicToolsRetouchBadgeGuide",a.MagicToolsBadgeGuide="MagicToolsBadgeGuide",a.MagicToolsSmartCropBadgeGuide="MagicToolsSmartCropBadgeGuide",a.MagicToolsObjectLockBadgeGuide="MagicToolsObjectLockBadgeGuide",a.AudioEffectsBadgeGuide="AudioEffectsBadgeGuide",a.VideoAudioBadgeGuide="VideoAudioBadgeGuide",a.VideoAudioEffectsBadgeGuide="VideoAudioEffectsBadgeGuide",a.TemplateVideoToolbarBackgroundBadge="TemplateVideoToolbarBackgroundBadge",a.FaceEffectTabClickBadgeGuide="FaceEffectTabClickBadgeGuide",a.ScreenRecordEntryBadgeGuide="ScreenRecordEntryBadgeGuide",a.MagicToolsChromaBadgeGuide="MagicToolsChromaBadgeGuide",a.MagicToolsRemoveBackgroundBadgeGuide="MagicToolsRemoveBackgroundBadgeGuide",a.ElementDigitalHumanGuide="ElementDigitalHumanGuide",a.VideoStickerTrackingBadgeGuide="VideoStickerTrackingBadgeGuide",a.VideoTextTrackingBadgeGuide="VideoTextTrackingBadgeGuide",a.VideoTextTemplateTrackingBadgeGuide="VideoTextTemplateTrackingBadgeGuide",a.VideoChromaBadgeGuide="VideoChromaBadgeGuide",a.GoogleDriveUploadGuide="GoogleDriveUpload",a.DropboxUploadGuide="DropboxUploadGuide",a.ShopifyUploadGuide="ShopifyUploadGuide",a.ChecklistBtnGuide="ChecklistBtnGuide",a.ElementTabGuide="ElementTabGuide",a.toolbarViewSwitchBtn="toolbarViewSwitchBtn",a.ExportVideoBtn="ExportVideoBtn",a.ExportLimit="ExportLimit",a.ExportGifBadgeGuide="ExportGifBadgeGuide",a.TemplateSlotIsFull="TemplateSlotIsFull",a.TextToSpeechBadgeGuide="TextToSpeechBadgeGuide",a.TextTospeechCloneVoiceBadgeGuide="TextTospeechCloneVoiceBadgeGuide",a.TextPresetBadgeGuide="TextPresetBadgeGuide",a.TextPresetSubtitleTemplatesBadgeGuide="TextPresetSubtitleTemplatesBadgeGuide",a.RefPlayerSyncMarkerGuide="RefPlayerSyncMarkerGuide",a.RefPlayerSyncMarkerTimelineGuide="RefPlayerSyncMarkerTimelineGuide",a.VideoBasicBadgeGuide="VideoBasicBadgeGuide",a.VideoBasicNoiseReductionBadgeGuide="VideoBasicNoiseReductionBadgeGuide",a.VideoBasicDeflicker="VideoBasicDeflicker",a.AddFirstVideoToTrack="AddFirstVideoToTrack",a.AddVideoToEmptyTrack="AddVideoToEmptyTrack",a.FirstToReplaceVideo="FirstToReplaceVideo",a.FirstToSplitSegment="FirstToSplitSegment",a.FirstAddMaterialToTemplate="FirstAddMaterialToTemplate",a.FirstEnterCutSame="FirstEnterCutSame",a.HasNoFilled="HasNoFilled",a.HasCroped="HasCroped",a.Muted="Muted",a.FirstEnterWithRelationVideoGroup="FirstEnterWithRelationVideoGroup",a.FirstToBatchReplaceMutable="FirstToBatchReplaceMutable",a.ContinueToBatchReplaceMutable="ContinueToBatchReplaceMutable",a.ToggleTimelineModeEntry="ToggleTimelineModeEntry",a.AllSlotFilled="AllSlotFilled",a.AIGCTimeLineGuide="AIGCTimeLineGuide",a.TOOLBAR_DIGIT_HUMAN_GUIDE_KEY="toolbar_digital_human_guide_key",a.AdjustGuideKey="adjust_guide_hide",a.TemplateSlotsForRightPanel="TemplateSlotsForRightPanel",a.TemplateSlotsBatchReplaceRightPanel="TemplateSlotsBatchReplaceRightPanel",a.VocalSeparationAudioBasicPanel="VocalSeparationAudioBasicPanel",a.VocalSeparation="VocalSeparation",a.VocalBeautify="VocalBeautify",a.TemplateRatioResizeBadge="TemplateRatioResizeBadge",a.UploadFirstAudibleFile="UploadFirstAudibleFile",a.UploadFirstLocalFile="UploadFirstLocalFile",a);let o={MagicToolsBadgeGuide:{value:"MagicToolsBadgeGuide",children:[{value:"MagicToolsRemoveBackgroundBadgeGuide",children:[{value:"VideoChromaBadgeGuide"}]},{value:"MagicToolsRetouchBadgeGuide"}]},VideoAudioBadgeGuide:{value:"VideoAudioBadgeGuide",children:[{value:"VideoAudioEffectsBadgeGuide"}]},SpeedModeBadgeGuide:{value:"SpeedModeBadgeGuide",children:[{value:"SpeedModeCurveBadgeGuide"}]},TextToSpeechBadgeGuide:{value:"TextToSpeechBadgeGuide",children:[{value:"TextTospeechCloneVoiceBadgeGuide"}]},TextPresetBadgeGuide:{value:"TextPresetBadgeGuide",children:[{value:"TextPresetSubtitleTemplatesBadgeGuide"}]},VideoBasicBadgeGuide:{value:"VideoBasicBadgeGuide",children:[{value:"VideoBasicNoiseReductionBadgeGuide"}]}},s="GuideKeysTree",d="FeatureGuideStateStorageKey",l=[{key:"FirstToBatchReplaceMutable",liveEndTime:"2033/11/08",publishTime:"2024/01/01"},{key:"FirstEnterCutSame",liveEndTime:"2033/11/08",publishTime:"2024/01/01"},{key:"FirstAddMaterialToTemplate",liveEndTime:"2033/11/08",publishTime:"2024/01/01"},{key:"HasCroped",liveEndTime:"2033/11/08",publishTime:"2024/01/01"},{key:"TemplateSlotIsFull",liveEndTime:"2033/11/08",publishTime:"2024/01/01"}],c=[{key:"FirstToSplitSegmentPopoverGuide",liveEndTime:"2033/11/08",publishTime:"2023/09/22"},{key:"TranslationOpenMenuTabFixedGuide",liveEndTime:"2034/09/28",publishTime:"2023/09/22"},{key:"KeyframeControlPopoverGuide",liveEndTime:"2034/10/25",publishTime:"2023/09/22"},{key:"SpeedModeBadgeGuide",liveEndTime:"2034/10/22",publishTime:"2023/09/22"},{key:"SpeedModeCurveBadgeGuide",liveEndTime:"2034/10/25",publishTime:"2023/09/22"},{key:"VideoPictureAdjustBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2023/09/22"},{key:"MagicToolsRetouchBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2023/09/22"},{key:"MagicToolsBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2023/09/22"},{key:"AudioEffectsBadgeGuide",liveEndTime:"2034/10/24",publishTime:"2023/09/22"},{key:"VideoAudioBadgeGuide",liveEndTime:"2034/10/24",publishTime:"2023/09/22"},{key:"VideoAudioEffectsBadgeGuide",liveEndTime:"2034/10/24",publishTime:"2023/09/22"},{key:"TextPresetBadgeGuide",liveEndTime:"2034/10/24",publishTime:"2024/03/21"},{key:"TextPresetSubtitleTemplatesBadgeGuide",liveEndTime:"2034/10/24",publishTime:"2024/03/21"},{key:"FaceEffectTabClickBadgeGuide",liveEndTime:"2023/11/19",publishTime:"2023/09/22"},{key:"ScreenRecordEntryBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2023/09/22"},{key:"MagicToolsChromaBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2023/09/22"},{key:"MagicToolsRemoveBackgroundBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2023/09/22"},{key:"MagicToolsSmartCropBadgeGuide",liveEndTime:"2034/12/11",publishTime:"2023/12/11"},{key:"MagicToolsObjectLockBadgeGuide",liveEndTime:"2034/05/08",publishTime:"2024/05/08"},{key:"VideoStickerTrackingBadgeGuide",liveEndTime:"2024/09/22",publishTime:"2023/11/08"},{key:"VideoTextTrackingBadgeGuide",liveEndTime:"2024/09/22",publishTime:"2023/11/08"},{key:"VideoTextTemplateTrackingBadgeGuide",liveEndTime:"2024/09/22",publishTime:"2023/11/08"},{key:"VideoChromaBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2023/09/22"},{key:"FirstEnterWithRelationVideoGroup",liveEndTime:"2034/09/22",publishTime:"2024/01/01"},{key:"ToggleTimelineModeEntry",liveEndTime:"2034/09/22",publishTime:"2024/01/01"},{key:"adjust_guide_hide",liveEndTime:"2024/09/22",publishTime:"2023/11/08"},{key:"TemplateSlotsForRightPanel",liveEndTime:"2034/09/22",publishTime:"2024/01/22"},{key:"TemplateSlotsBatchReplaceRightPanel",liveEndTime:"2034/09/22",publishTime:"2024/01/22"},{key:"VideoBasicNoiseReductionBadgeGuide",liveEndTime:"2024/05/30",publishTime:"2024/04/18"},{key:"ExportGifBadgeGuide",liveEndTime:"2034/09/22",publishTime:"2024/05/01"},{key:"VocalSeparationAudioBasicPanel",liveEndTime:"2024/07/22",publishTime:"2024/01/22"},{key:"VocalSeparation",liveEndTime:"2024/07/22",publishTime:"2024/01/22"},{key:"VocalBeautify",liveEndTime:"2024/07/22",publishTime:"2024/01/22"},{key:"TemplateVideoToolbarBackgroundBadge",liveEndTime:"2024/07/01",publishTime:"2024/04/01"},{key:"TemplateRatioResizeBadge",liveEndTime:"2024/07/01",publishTime:"2024/04/01"}],u=(0,r.yh)("guide-configuration-service")},896413:function(e,t,i){i.d(t,{U:function(){return n},a:function(){return o}});var a,r=i(335290);var n=((a={})[a.Waiting=0]="Waiting",a[a.Eventually=1]="Eventually",a);let o=(0,r.yh)("main-editor-widget")},528582:function(e,t,i){i.d(t,{R:function(){return u}});var a=i(587892),r=i(402655),n=i(690613),o=i(208041),s=i(800788),d=i(65458),l=i(920704),c=i(578210);class u extends r.JT{cancel(){this._cancellationTokenSource.cancel(),this._store.clear(),this._onCancel.fire()}get error(){return this._error}get value(){return(0,s.ZB)(this._value,"SmartJob status error."),this._value}get status(){return this._cancellationTokenSource.token.isCancellationRequested?d.W.Cancelled:this._error.ok?void 0!==this._value?d.W.Success:d.W.Running:d.W.Error}get onProgress(){return!this._error.ok||this._value?c.qA:this._onProgress.event}get onError(){return this._error.ok?this._onError.event:(0,c.jc)(this._error,this._cancellationTokenSource.token)}get onSuccess(){return this._value?(0,c.jc)(this._value,this._cancellationTokenSource.token):this._onSuccess.event}get onCancel(){return this._onCancel.event}_start(e,t){switch(e.status){case l.y.Success:this._transfer(e.value,t);break;case l.y.Failure:break;default:this._listenTask(e,t)}}_fireProgress(e){let t=100*this._progress.size,i=0;for(let[e,t]of this._progress)i+=t;i===t?(this._value=this._getValue(),this._onSuccess.fire(this._value)):this._onProgress.fire(Math.floor(i/this._progress.size),e)}_getValue(){return this._tasks.map(e=>this._values.get(e))}_listenTask(e,t){this._register(e.onProgress(e=>{this._progress.set(t,e.progress),this._fireProgress(e)})),this._register(e.onSuccess(e=>{let i=this._transfer(e,t);this._values.set(t,i),this._progress.set(t,100),this._fireProgress()})),this._register(e.onError(e=>{this._store.clear(),this._error=e}))}_transfer(e,t){let i=t.transfer(e);return i.ok?i.value:(this._onError.fire(i),this._store.clear(),{})}constructor(e){super(),this._tasks=e,this._onProgress=new a.Q,this._onError=new a.Q,this._onSuccess=new a.Q,this._onCancel=new a.Q,this._cancellationTokenSource=this._register(new o.A),this._progress=new Map,this._values=new Map,this._error=(0,n.ly)();let t=[];for(let e of this._tasks)this._progress.set(e,0),this._values.set(e,{}),t.push(e.execute());Promise.all(t).then(e=>{let t=e.find(e=>!e.ok);if(t){this._error=t,this._onError.fire(this._error);return}(0,s.Y2)(e.length===this._tasks.length);for(let t=0;t<e.length;t++){let i=e[t];(0,s.Y2)(i.ok),this._start(i.value,this._tasks[t])}}).catch(e=>{this._error=e,this._onError.fire(this._error)})}}},358789:function(e,t,i){i.d(t,{g:function(){return a}});class a{cancel(){this._task.then(e=>{e.ok&&e.value.cancel()})}}},286575:function(e,t,i){i.d(t,{f:function(){return d}});var a=i(789786),r=i(690613),n=i(545797),o=i(920704),s=i(65458);class d{async execute(){let e=this._vocalSeparationDataService.createVocalSeparationTask({assetId:this._assetId,platform:this._platform,mode:this._mode,timeRange:this._timeRange,workspaceId:this._workspaceId},this._urlParams);return await e}cancel(){}transfer(e){let t={type:s.FV.VocalSeparation,assetId:this._assetId,taskId:e.taskId},[i]=e.taskDetails,{transcodeAudioInfos:a}=i,[n]=a;if(i.md5)t.cloudData={md5:i.md5,key:n.key};else{if(!i.vid||!n.url)return(0,r.wf)(-1,"vocal separation response invalid.");t.onlineData={vid:i.vid,url:n.url,key:n.key}}return(0,r.oW)(t)}constructor(e,t,i,a,r,n,o){this._assetId=e,this._platform=t,this._mode=i,this._timeRange=a,this._workspaceId=r,this._urlParams=n,this._vocalSeparationDataService=o}}d=(0,a.gn)([(0,a.fM)(6,n.ty),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,void 0===n.gx?Object:n.gx,Object,String,Object,void 0===n.ty?Object:n.ty])],d)},578210:function(e,t,i){i.d(t,{jc:function(){return r},qA:function(){return a}});let a=Object.freeze(function(e){return{dispose(){}}});function r(e,t){return function(i){let a=setTimeout(()=>{if(!t.isCancellationRequested)i(e)},0);return{dispose(){clearTimeout(a)}}}}},46808:function(e,t,i){i.d(t,{O:function(){return h}});var a=i(789786),r=i(230689),n=i(31463),o=i(28791),s=i(108692),d=i(425427),l=i(221963);function c(e){return["vesdk_event_editor_preview_frame_rate","vesdk_editor_preview_flush_fps_by_interval"].includes(e)}class u{build(){return{...(0,l.Z)(this._mainDraftService,this._environmentService),log_name:this._loggerName}}constructor(e,t){this._mainDraftService=e,this._environmentService=t,this._loggerName="user_track"}}u=(0,a.gn)([(0,a.fM)(0,s.n),(0,a.fM)(1,d.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===s.n?Object:s.n,void 0===d.rO?Object:d.rO])],u);class h{reportBySlardar(e,t){if(!this._notNeedReportToSlardarEvents.includes(e)){if(c(e)){let i=function(e,t){let i={...t};if(!c(e))return i;let a=["avClockDiff","carton_rate","carton_time","curr_frame_rate","duration","first_frame_rate","gop_size","is_contain_matting","media_time","resolution_height","resolution_width","slightly_carton_rate","track_number"];return("vesdk_event_editor_preview_frame_rate"===e?a:[...a,"start_time","video_number","image_number","effect_number","avg_cost_time","max_cost_time"]).forEach(e=>{let a=t[e];i[e]=null!=a?Number(a):a}),i}(e,t);this._reportService.reportDevEvent(e,i);return}this._logger.info(`${e} %v`,t),"editor_init"!==e&&this._reportService.reportDevEvent(e,t)}}constructor(e,t,i){this._containerService=e,this._reportService=t,this._loggerService=i,this._notNeedReportToSlardarEvents=["video_editor_data_layer_error","ve_on_crash_emit"],this._logger=this._loggerService.createLogger("tea-to-slardar",{contextParams:this._containerService.createInstance(u)})}}h=(0,a.gn)([(0,a.fM)(0,r.t),(0,a.fM)(1,n.m),(0,a.fM)(2,o.yR),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===r.t?Object:r.t,void 0===n.m?Object:n.m,void 0===o.yR?Object:o.yR])],h)},745428:function(e,t,i){i.d(t,{P:function(){return g}});var a=i(789786),r=i(919111),n=i(800788),o=i(426336),s=i(230689),d=i(431220),l=i(361459),c=i(129219),u=i(732564),h=i(271564),p=i(538181);function _(e){return e.reverse?e.material.reversePath:e.material.path}class g{updateRenderManager(e){this._renderManager=e}startVideoAlgorithm(e){var t,i;let a=e,r=a.id;if(!a)return;let{videoAlgorithm:n}=a.material,o=(null==a?void 0:null===(t=a.material)||void 0===t?void 0:t.path)||"";if(0===n.algorithms.length||!o)return;this._originalMaterialMap.set(a.id,this._intelligenceStore.idToOriginMaterial[r]);let s=this._getVideoAlgorithmId(n);null===(i=this._currentRequestMap[a.id])||void 0===i||i.cancel();let d=this._getOrCreateToken(a);if(this._currentRequestMap[a.id]=d,d.status===c.xR.Success)return this._replaceResource(a,d),d;let l=Date.now();return(0,p.Z)(this._containerService,{type:"algorithm",stage:"start",value:s,errorMsg:d.error.msg}),d.onSuccess(e=>{if((0,p.Z)(this._containerService,{type:"algorithm",stage:"success",value:s,costTime:Date.now()-l,errorMsg:d.error.msg}),!!(a=this._dataSdk.draftView.getSegmentById(r)))this._replaceResource(a,d)}),d.onError(e=>{(0,p.Z)(this._containerService,{type:"algorithm",stage:"fail",value:s,costTime:Date.now()-l,errorMsg:d.error.msg})}),d.onCancel(()=>{(0,p.Z)(this._containerService,{type:"algorithm",stage:"cancel",value:s,costTime:Date.now()-l,errorMsg:d.error.msg})}),d}cancelVideoAlgorithm(e,t){!Array.isArray(e)&&(e=[e]),e.forEach(e=>{var i;null===(i=this._currentRequestMap[e])||void 0===i||i.cancel(),t&&this._recoverMutable(e),this._originalMaterialMap.delete(e)})}_getOrCreateToken(e){(0,n.Y2)((0,o.hey)(e)),(0,n.Y2)(""!==e.material.path);let t=this._cache.getAlgorithmCache(_(e));if(t)return t;let i=this._containerService.createInstance(l.l,e,this._renderManager,this._draftPathStore);return i.onSuccess(()=>{this._cache.setAlgorithmCache(_(e),i)}),i}_getVideoAlgorithmId(e){if(e){let{algorithms:t=[]}=e||{};if((null==t?void 0:t.length)>0){let{algorithmId:e,type:i}=t[0];return`algorithmId: ${e}, type: ${i}`}}return""}_replaceVideoAlgorithmResult(e,t){let{path:i,resourceId:a,resourceName:r}=t;if(!this._originalMaterialMap.get(e))return;let n=this._dataSdk.draftView.getSegmentById(e);if(!n)return;let o=this._dataSdk.draftView.getDraftIdAndSegById(n.id);if(!!o)this._dataSdk.api.segment.innerReplace({draftId:o.draftId,identifier:{id:n.id,material:{path:n.material.path}},substitute:{material:{path:i,materialId:a,materialName:r,sourcePlatform:0,videoAlgorithm:{path:i}}}})}async _recoverMutable(e){let t=this._originalMaterialMap.get(e);if(t){let e=await (0,h.jm)(this._dataSdk,this._renderManager,t);this._dataSdk.api.template.setMutableVideos(e)}}_replaceResource(e,t){this._replaceVideoAlgorithmResult(e.id,{path:t.product.path,resourceId:t.product.resourceId,resourceName:t.product.resourceName})}constructor(e,t,i,a,r,n){this._cache=e,this._dataSdk=t,this._renderManager=i,this._draftPathStore=a,this._intelligenceStore=r,this._containerService=n,this._originalMaterialMap=new Map,this._currentRequestMap={}}}g=(0,a.gn)([(0,a.fM)(5,s.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===d.v?Object:d.v,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===u.zo?Object:u.zo,void 0===r.H?Object:r.H,"undefined"==typeof IntelligenceStore?Object:IntelligenceStore,void 0===s.t?Object:s.t])],g)},82963:function(e,t,i){i.d(t,{L:function(){return r}});var a=i(260963);class r{setProcessingSegIds(e){this.processingSegIds=e}setErrorSegIds(e){this.errorSegIds=e}setFinishSegIds(e){this.finishSegIds=e}constructor(){this.processingSegIds=[],this.errorSegIds=[],this.finishSegIds=[],(0,a.ky)(this)}}},550473:function(e,t,i){i.d(t,{I:()=>R});var a=i("789786");i("784923");var r=i("498417"),n=i("426336"),o=i("126729"),s=i("420072"),d=i("230689"),l=i("433140"),c=i("200247"),u=i("127830"),h=i("487620"),p=i("800788"),_=i("801497"),g=i("722169"),m=i("547314"),f=i("129219"),v=i("260963"),y=i("243366"),S=i("860660"),T=i("948328"),k=i("657056"),b=i("597623"),I=i("271564"),M=i("425427"),w=i("772322"),P=i("150564"),D=i("825259");let A=e=>{let{content:t,onCancel:i}=e;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("span",{className:D.Z.content,children:t}),(0,w.jsx)("span",{onClick:i,className:D.Z.cancelBtn,children:_.ZP.t("web_noise_cancel_multiple_trim_reduce",{},"Cancel")})]})};class R{get _control(){return n.lLh.getInstance().get("attachment_video_algorithm.json")}get dataSdk(){return this._dataSdk}get timelineManager(){return this._timelineManager}get segmentManager(){return this._timelineManager.segmentManager}get intelligenceStore(){return this._intelligenceStore}updateRenderManager(e){this._renderManager=e}setTimelineManager(e){this._timelineManager=e}handleSwitchIntelligent(e){let{segment:t,params:i,options:a}=e,r=this.getTokenBySegmentId(t.id);null==r||r.cancel();let{isEqual:n,isEmpty:o,nextParams:s}=this.checkApplyDelta(t,i),d=this.getPipelineId(t);if(n&&!(!d&&(null==a?void 0:a.forcePipeline))){this.handleEqualUserAction(t);return}if(o){this.handleEmptyUserAction(t,s);return}this.setLoadingState(t.id,{loading:!0,loadingText:void 0,progress:0}),this.recordUserActionDelta(t.id,i),this.getUserActionDelta(t.id).every(e=>!e.enable)&&this._notificationService.info(_.ZP.t("web_color_correction_toast_restart_others",{string0:this.getToastWhenDisabling(i.toolType)},"{string0} was removed. Other features that were applied will be applied again, and it will take some time."));let l=this.switchIntelligent(t,i.toolType,s,null==a?void 0:a.onFinished);return this.addTokenBySegmentId(t.id,l),l}switchIntelligent(e,t,i,a,r){(0,p.Y2)((0,n.hey)(e)),(0,p.Y2)(""!==e.material.path);let o=this._containerService.createInstance(h.o,e,i,this._renderManager,this._draftPathStore);if(this._reportFn(e,{toolType:t,functionName:this._getFunctionName(t),status:"start",duration:0}),this._segmentIdDurationMap.set(e.id,performance.now()),this._segmentIdLoadingTimestamp=new Date().getTime(),this._segmentIdMaterialMap.set(e.id,this._intelligenceStore.idToOriginMaterial[e.id]),this._segmentIdTokenMap.set(e.id,o),o.onSuccess(i=>{r||this.handleSuccess(e,t,i),null==a||a()}),o.onError(i=>{this.handleError(e,t,i),null==a||a()}),o.onProgress((t,i)=>{this.handleProgress(t,i,e)}),o.onCancel(()=>{this.handleCancel(e,t)}),o.onCancelWithMidProdApply(t=>{let{product:i,successToolTypes:r}=null!=t?t:{};this.handleCancelWithMidProdApply(e,i,r),null==a||a()}),(0,n.hey)(e)){var s,d;this._intelligenceStore.actionSetIntermediateMaterial(e.id,null===(s=(d=e.material).clone)||void 0===s?void 0:s.call(d))}let l=this._segmentIdGlobalLoadingMessageContentMap.get(e.id);if(l){let t=function(e){let{notificationService:t,content:i,onCancel:a}=e;return t.normal((0,w.jsx)(A,{content:i,onCancel:a}),{},{duration:0,icon:(0,w.jsx)(P.gbz,{className:D.Z.loadingIcon,size:24})}).closeNotification}({content:l,onCancel:()=>{o.cancelWithMidProdApply()},notificationService:this._notificationService});this._segmentIdGlobalLoadingMessageCloseMap.set(e.id,t)}return o}handleSuccess(e,t,i,a){var r;this._playManager.pause(),this.deleteTokenBySegmentId(e.id),this._updatePipelineId(e,i);let n=this._getNextParams(e).nextParams;this._updateAllIntelligent(e,n,i,a);let o=this._getSuccessText(e,t,n);this.segmentManager.setTimelineSegmentLoading(e.id,!1,this._segmentIdLoadingTimestamp),this.setLoadingState(e.id,{loading:!1,loadingText:void 0,progress:0}),this.deleteUserActionDelta(e.id),o&&this._notificationService.success(o),this._reportFn(e,{toolType:t,functionName:this._getFunctionName(t),status:"success",duration:this._segmentIdDurationMap.get(e.id)?performance.now()-this._segmentIdDurationMap.get(e.id):0}),this._segmentIdDurationMap.delete(e.id),this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),null===(r=this._segmentIdGlobalLoadingMessageCloseMap.get(e.id))||void 0===r||r(),this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)}handleCancelWithMidProdApply(e,t,i){var a;this._playManager.pause(),this.deleteTokenBySegmentId(e.id);let r=this._getNextParams(e).nextParams.filter(e=>null==i?void 0:i.includes(e.toolType));t&&r.length?(this._updatePipelineId(e,t),this._updateAllIntelligent(e,r,t)):this.deleteAllIntelligent(e),this.segmentManager.setTimelineSegmentLoading(e.id,!1,this._segmentIdLoadingTimestamp),this.setLoadingState(e.id,{loading:!1,loadingText:void 0,progress:0}),this.deleteUserActionDelta(e.id),this._segmentIdDurationMap.delete(e.id),this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),null===(a=this._segmentIdGlobalLoadingMessageCloseMap.get(e.id))||void 0===a||a(),this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)}handleError(e,t,i){var a;this.deleteTokenBySegmentId(e.id),this.segmentManager.setTimelineSegmentLoading(e.id,!1,this._segmentIdLoadingTimestamp),this.setLoadingState(e.id,{loading:!1,loadingText:void 0,progress:0}),this.deleteUserActionDelta(e.id);let r=this._getNextParams(e).nextParams,n=this._getPipelineFailedMessageContent(t,r);n&&this._notificationService.error(n),this._reportFn(e,{toolType:t,functionName:this._getFunctionName(t),status:"fail",duration:this._segmentIdDurationMap.get(e.id)?performance.now()-this._segmentIdDurationMap.get(e.id):0,errorCode:i.code.toString()}),this._segmentIdDurationMap.delete(e.id),this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),null===(a=this._segmentIdGlobalLoadingMessageCloseMap.get(e.id))||void 0===a||a(),this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)}handleProgress(e,t,i){var a;let r=this.getLoadingText(t),{tool_type:n}=null!=t?t:{};if(t&&n===o.F2.VideoCut){let{nextParams:e}=this._getNextParams(i),a=e.findIndex(e=>e.toolType===o.F2.VideoCut)+1;if(a<e.length){let{toolType:i}=e[a];r=this.getLoadingText({...t,tool_type:i,process:0})}}this.segmentManager.setTimelineSegmentLoading(i.id,!0,this._segmentIdLoadingTimestamp,null!=r?r:_.ZP.t("load_web_ing",{},"loading")),this.setLoadingState(i.id,{loading:!0,loadingText:r,progress:null!==(a=null==t?void 0:t.process)&&void 0!==a?a:0,toolType:null==t?void 0:t.tool_type})}handleCancel(e,t){var i;this.getTokenBySegmentId(e.id)&&this._reportFn(e,{toolType:t,functionName:this._getFunctionName(t),status:"cancel",duration:this._segmentIdDurationMap.get(e.id)?performance.now()-this._segmentIdDurationMap.get(e.id):0}),this.deleteTokenBySegmentId(e.id),this.segmentManager.setTimelineSegmentLoading(e.id,!1,this._segmentIdLoadingTimestamp),this.setLoadingState(e.id,{loading:!1,loadingText:void 0,progress:0}),this.deleteUserActionDelta(e.id),this._segmentIdDurationMap.delete(e.id),this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),null===(i=this._segmentIdGlobalLoadingMessageCloseMap.get(e.id))||void 0===i||i(),this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)}cancelPipelineModify(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];(Array.isArray(e)?e:[e]).forEach(e=>{var i;if(this._segmentIdDurationMap.delete(e),null===(i=this._segmentIdTokenMap.get(e))||void 0===i||i.cancel(),t){let t=this._segmentIdMaterialMap.get(e);t&&this._recoverMutable(t)}this.deleteTokenBySegmentId(e),this._intelligenceStore.actionIntelligentReset(e,f.Sc.Pipeline)})}addTokenBySegmentId(e,t){this._segmentIdTokenMap.set(e,t)}getTokenBySegmentId(e){return this._segmentIdTokenMap.get(e)}deleteTokenBySegmentId(e){this._segmentIdTokenMap.delete(e)}setLoadingState(e,t){this._segmentIdLoadingState.set(e,t)}getLoadingState(e){var t;return null!==(t=this._segmentIdLoadingState.get(e))&&void 0!==t?t:{loading:!1,loadingText:void 0,progress:0}}recordUserActionDelta(e,t){var i;let a=null!==(i=this._segmentIdUserActionDelta.get(e))&&void 0!==i?i:[];this._segmentIdUserActionDelta.set(e,a.filter(e=>e.toolType!==t.toolType).concat(t))}getUserActionDelta(e){var t;return null!==(t=this._segmentIdUserActionDelta.get(e))&&void 0!==t?t:[]}deleteUserActionDelta(e){this._segmentIdUserActionDelta.delete(e)}checkApplyDelta(e,t){let{oldData:i,newData:a,nextParams:r}=this._getNextParams(e,t),{algorithmList:n}=a;return{isEqual:(0,g.isEqual)(i,a),isEmpty:0===n.filter(e=>e.enable).length&&!a.isReverse&&!a.isMatting,nextParams:r}}getIntelligentState(e,t){var i,a,r,s,d,l,c,u,h,p,_,m,f,v,y,S,T,k,b,I,M,w,P,D,A,R,x,F,E,O;switch(t){case o.F2.VideoReverseTask:return{toolType:t,enable:!!e.reverse,param:{}};case o.F2.VideoMaskTask:case o.F2.ImageMaskTask:return{toolType:t,enable:!!(null===(a=e.material)||void 0===a?void 0:null===(i=a.matting)||void 0===i?void 0:i.flag),param:{}};case o.F2.VideoIntelligentToning:case o.F2.PictureIntelligentToning:{let i=null===(s=e.adjust)||void 0===s?void 0:null===(r=s.smartAdjustColor)||void 0===r?void 0:r.value;if((0,g.isNil)(i))return;return{toolType:t,enable:!!(null===(d=e.adjust)||void 0===d?void 0:d.enableSmartColorAdjust),param:{level:i}}}case o.F2.VideoStabilization:{let i=null===(c=e.material)||void 0===c?void 0:null===(l=c.stable)||void 0===l?void 0:l.stableLevel;if((0,g.isNil)(i))return;return{toolType:t,enable:!!(null===(h=e.material)||void 0===h?void 0:null===(u=h.stable)||void 0===u?void 0:u.stableLevel),param:{level:i}}}case o.F2.VideoSlowMotion:{let i=null===(m=e.material)||void 0===m?void 0:null===(_=m.videoAlgorithm)||void 0===_?void 0:null===(p=_.algorithms)||void 0===p?void 0:p.find(e=>e.type===n.zzh.ComplementFrame),a=null===(y=e.material)||void 0===y?void 0:null===(v=y.videoAlgorithm)||void 0===v?void 0:null===(f=v.complementFrameConfig)||void 0===f?void 0:f.mode;if((0,g.isNil)(a))return;return{toolType:t,enable:!!i,param:{name:a}}}case o.F2.TemplateCVTask:{let i=(0,n.MnT)(e.material),{algorithm:a}=null!=i?i:{};if((0,g.isNil)(a))return;return{toolType:t,enable:!!a,param:{req_json:null==i?void 0:i.algorithm}}}case o.F2.ImageNoiseReduction:case o.F2.VideoNoiseReduction:{let i=null===(k=e.material)||void 0===k?void 0:null===(T=k.videoAlgorithm)||void 0===T?void 0:null===(S=T.algorithms)||void 0===S?void 0:S.find(e=>e.type===n.zzh.NoiseReduction);if((0,g.isNil)(i))return;return{toolType:t,enable:!!i,param:{level:null===(M=e.material)||void 0===M?void 0:null===(I=M.videoAlgorithm)||void 0===I?void 0:null===(b=I.noiseReduction)||void 0===b?void 0:b.level}}}case o.F2.Deflicker:{let i=null===(D=e.material)||void 0===D?void 0:null===(P=D.videoAlgorithm)||void 0===P?void 0:null===(w=P.algorithms)||void 0===w?void 0:w.find(e=>e.type===n.zzh.Deflicker);if((0,g.isNil)(i))return;return{toolType:t,enable:!!i,param:{level:null===(x=e.material)||void 0===x?void 0:null===(R=x.videoAlgorithm)||void 0===R?void 0:null===(A=R.deflicker)||void 0===A?void 0:A.level,mode:null===(O=e.material)||void 0===O?void 0:null===(E=O.videoAlgorithm)||void 0===E?void 0:null===(F=E.deflicker)||void 0===F?void 0:F.mode}}}default:return}}handleEqualUserAction(e){this.setLoadingState(e.id,{loading:!1,loadingText:void 0,progress:0}),this.deleteUserActionDelta(e.id)}handleEmptyUserAction(e,t,i){this._updateAllIntelligent(e,t,{path:"",url:"",key:"",pipelineId:""},i),this.setLoadingState(e.id,{loading:!1,loadingText:void 0,progress:0}),this.deleteUserActionDelta(e.id)}getToastWhenDisabling(e){return({[o.F2.VideoIntelligentToning]:_.ZP.t("web_color_correction_name_correction",{},"AI color correction"),[o.F2.PictureIntelligentToning]:_.ZP.t("web_color_correction_name_correction",{},"AI color correction"),[o.F2.VideoStabilization]:_.ZP.t("web_video_stable_text_stablize",{},"Stabilize"),[o.F2.VideoSlowMotion]:_.ZP.t("web_frame_fill_text_smooth_slow",{},"Smooth slow-mo"),[o.F2.VideoReverseTask]:_.ZP.t("reverse_web",{},"\u89C6\u9891\u5012\u653E"),[o.F2.VideoMaskTask]:_.ZP.t("web_auto_remove",{},"\u667A\u80FD\u62A0\u50CF"),[o.F2.ImageMaskTask]:_.ZP.t("web_auto_remove",{},"\u667A\u80FD\u62A0\u50CF"),[o.F2.TemplateCVTask]:_.ZP.t("gameplay",{},"gameplay"),[o.F2.VideoNoiseReduction]:_.ZP.t("web_noise_feature_name",{},"Reduce image noise"),[o.F2.ImageNoiseReduction]:_.ZP.t("web_noise_feature_name",{},"Reduce image noise"),[o.F2.Deflicker]:_.ZP.t("web_flicker_feature_name",{},"Remove flicker"),[o.F2.VideoCut]:""})[e]}deleteAllIntelligent(e){var t,i,a,r,o,s,d,l,c,u,h,p,_,g;if(![n.cVg.MetaTypeVideo,n.cVg.MetaTypePhoto].some(t=>e.material.type===t))return;let m=e.id;e.reverse&&this.dataSdk.api.video.reverse({segId:m,isReverse:!1,reversePath:""}),(null===(i=e.material)||void 0===i?void 0:null===(t=i.matting)||void 0===t?void 0:t.flag)&&(this.dataSdk.api.video.clearMatting({segId:m,path:""}),e.material.type===n.cVg.MetaTypePhoto&&this.dataSdk.api.video.setVideoAlgorithm({segmentId:m,path:"",timeRange:e.targetTimerange})),(null===(a=e.adjust)||void 0===a?void 0:a.enableSmartColorAdjust)&&this.dataSdk.api.video.setSmartColorAdjust({enable:!1,segmentId:m,path:null,smartAdjustColor:void 0}),(null===(o=e.material)||void 0===o?void 0:null===(r=o.stable)||void 0===r?void 0:r.stableLevel)&&this.dataSdk.api.video.setStable({stableLevel:0,matrixPath:"",segmentId:m,path:""});let f=null===(l=e.material)||void 0===l?void 0:null===(d=l.videoAlgorithm)||void 0===d?void 0:null===(s=d.algorithms)||void 0===s?void 0:s.find(e=>e.type===n.zzh.ComplementFrame),v=null===(h=e.material)||void 0===h?void 0:null===(u=h.videoAlgorithm)||void 0===u?void 0:null===(c=u.algorithms)||void 0===c?void 0:c.find(e=>e.type===n.zzh.NoiseReduction),y=null===(g=e.material)||void 0===g?void 0:null===(_=g.videoAlgorithm)||void 0===_?void 0:null===(p=_.algorithms)||void 0===p?void 0:p.find(e=>e.type===n.zzh.Deflicker);f&&this.dataSdk.api.video.setVideoAlgorithm({segmentId:m,path:"",enable:!1,algorithm:{algorithmId:"",type:n.zzh.ComplementFrame},complementFrameConfig:{mode:n.zAn.OpticalFlow}}),v&&this.dataSdk.api.video.setVideoAlgorithm({segmentId:m,path:"",enable:!1,algorithm:{algorithmId:"",type:n.zzh.NoiseReduction},complementFrameConfig:{mode:n.zAn.Origin}}),y&&this.dataSdk.api.video.setVideoAlgorithm({segmentId:m,path:"",enable:!1,algorithm:{algorithmId:"",type:n.zzh.Deflicker},complementFrameConfig:{mode:n.zAn.Origin}})}async _recoverMutable(e){let t=await (0,I.jm)(this._dataSdk,this._renderManager,e);this._dataSdk.api.template.setMutableVideos(t)}getLoadingText(e){if(!e)return;let{tool_type:t,process:i}=e;return({[o.F2.PictureIntelligentToning]:_.ZP.t("web_color_correction_loading_correction",{number0:i},"Applying AI color correction... {number0}%"),[o.F2.VideoIntelligentToning]:_.ZP.t("web_color_correction_loading_correction",{number0:i},"Applying AI color correction... {number0}%"),[o.F2.VideoStabilization]:_.ZP.t("web_video_stable_text_being_applied",{number0:i},"Stabilizing... {number0}%"),[o.F2.VideoSlowMotion]:_.ZP.t("web_frame_fill_text_processing_hundred",{number0:i},"Applying smooth slow-mo... {number0}%"),[o.F2.VideoReverseTask]:`${_.ZP.t("reverse_web",{},"\u89C6\u9891\u5012\u653E")}...${i}%`,[o.F2.VideoMaskTask]:_.ZP.t("web_video_stable_text_auto_cut_all",{number0:i},"Removing background... {number0}%"),[o.F2.ImageMaskTask]:_.ZP.t("web_video_stable_text_auto_cut_all",{number0:i},"Removing background... {number0}%"),[o.F2.VideoNoiseReduction]:_.ZP.t("web_noise_in_progress",{number0:i},"Reducing image noise... {number0}%"),[o.F2.ImageNoiseReduction]:_.ZP.t("web_noise_in_progress",{number0:i},"Reducing image noise... {number0}%"),[o.F2.Deflicker]:_.ZP.t("web_flicker_removing_flicker",{number0:i},"Removing flicker\u2026 {number0}%")})[t]}getProductResourceType(e){let t=this._getAppliedToolTypes(e);return this.getPipelineId(e)?this._accoutService.hasLogin&&(!t.isReverse||t.algorithmList.length)?u._g.UserVideo:u._g.UserFile:void 0}setGlobalLoadingMessageContent(e,t){this._segmentIdGlobalLoadingMessageContentMap.set(e.id,t)}setGlobalSuccessMessageContent(e,t){this._segmentIdGlobalSuccessMessageContentMap.set(e.id,t)}_getAppliedToolTypes(e){var t,i;let a=this._getOrderedToolType(e);return{isReverse:!!(null===(t=this.getIntelligentState(e,o.F2.VideoReverseTask))||void 0===t?void 0:t.enable),isMatting:!!(null===(i=this.getIntelligentState(e,o.F2.VideoMaskTask))||void 0===i?void 0:i.enable),algorithmList:a}}_getToolType(e,t){if((0,I.AG)(e))return o.F2.TemplateCVTask;let i=e.material.type===n.cVg.MetaTypeVideo;return({[n.G3_.SmartColor]:i?o.F2.VideoIntelligentToning:o.F2.PictureIntelligentToning,[n.G3_.Stable]:o.F2.VideoStabilization,[n.G3_.ComplementFrame]:o.F2.VideoSlowMotion,[n.G3_.NoiseReduction]:i?o.F2.VideoNoiseReduction:o.F2.ImageNoiseReduction,[n.G3_.Deflicker]:o.F2.Deflicker})[t.type]}_getOrderedToolType(e){var t,i;return(null!==(i=null===(t=this.dataSdk.draftView.getVideoAlgorithm(e.id))||void 0===t?void 0:t.algorithms)&&void 0!==i?i:[]).map(t=>this.getIntelligentState(e,this._getToolType(e,t))).filter(e=>!(0,g.isUndefined)(e)).filter(e=>e.enable)}_getNextParams(e,t){var i,a;let r=e.material.type===n.cVg.MetaTypeVideo,s={[o.F2.VideoReverseTask]:!0,[o.F2.VideoMaskTask]:!0,[o.F2.ImageMaskTask]:!0},d=t?this.getUserActionDelta(e.id).filter(e=>e.toolType!==t.toolType).concat(t):this.getUserActionDelta(e.id),l=this._getAppliedToolTypes(e),c=l.algorithmList.filter(e=>!d.find(t=>t.toolType===e.toolType)).concat(d.filter(e=>e.enable&&!s[e.toolType])),u=d.find(e=>e.toolType===o.F2.VideoReverseTask),h=d.find(e=>[o.F2.VideoMaskTask,o.F2.ImageMaskTask].some(t=>t===e.toolType)),p={isReverse:!!(u?u.enable:null===(i=this.getIntelligentState(e,o.F2.VideoReverseTask))||void 0===i?void 0:i.enable),isMatting:!!(h?h.enable:null===(a=this.getIntelligentState(e,o.F2.VideoMaskTask))||void 0===a?void 0:a.enable),algorithmList:c},_=[];return p.isReverse&&_.push({toolType:o.F2.VideoReverseTask,param:{}}),p.isMatting&&_.push({toolType:r?o.F2.VideoMaskTask:o.F2.ImageMaskTask,param:{}}),_.push(...c.map(e=>(0,g.omit)(e,"enable"))),{oldData:l,newData:p,nextParams:_}}_updateAllIntelligent(e,t,i,a){let s;(0,p.Y2)(this.dataSdk),!a&&(s=this.dataSdk.api.batch.batchStart());let d=Object.values({video:[o.F2.VideoReverseTask,o.F2.VideoMaskTask,o.F2.VideoIntelligentToning,o.F2.VideoStabilization,o.F2.VideoSlowMotion,o.F2.TemplateCVTask,o.F2.VideoNoiseReduction,o.F2.Deflicker],image:[o.F2.ImageMaskTask,o.F2.PictureIntelligentToning,o.F2.TemplateCVTask,o.F2.ImageNoiseReduction]}[e.material.type===n.cVg.MetaTypeVideo?"video":"image"]).map(t=>this.getIntelligentState(e,t)).filter(e=>e),l=t.reduce((e,t)=>(e[t.toolType]=t,e),{}),c=this._dataSdk.draftView.getDraftIdAndSegById(e.id),u=(null==c?void 0:c.draftId)||this._dataSdk.draftView.getDraftId(),h=this._dataSdk.draftView.getDraftId(),g=(0,M.JY)(this._environmentService)||h!==(null==c?void 0:c.draftId);d.forEach(t=>{if((null==t?void 0:t.enable)&&!l[t.toolType])switch(t.toolType){case o.F2.VideoReverseTask:this.dataSdk.api.video.reverse({segId:e.id,isReverse:!1,reversePath:""}),this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:"",timeRange:e.targetTimerange});break;case o.F2.VideoMaskTask:this.dataSdk.api.video.clearMatting({segId:e.id,path:""});break;case o.F2.ImageMaskTask:this.dataSdk.api.video.clearMatting({segId:e.id,path:""}),this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:"",timeRange:e.targetTimerange});break;case o.F2.PictureIntelligentToning:case o.F2.VideoIntelligentToning:this.dataSdk.api.video.setSmartColorAdjust({enable:!1,segmentId:e.id,path:null,smartAdjustColor:void 0});break;case o.F2.VideoStabilization:this.dataSdk.api.video.setStable({stableLevel:0,matrixPath:"",segmentId:e.id,path:""});break;case o.F2.VideoSlowMotion:this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:"",enable:!1,algorithm:{algorithmId:"",type:n.zzh.ComplementFrame},timeRange:e.targetTimerange,complementFrameConfig:{mode:t.param.name}});break;case o.F2.ImageNoiseReduction:case o.F2.VideoNoiseReduction:this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:"",enable:!1,algorithm:{algorithmId:"",type:n.zzh.NoiseReduction},timeRange:e.targetTimerange});break;case o.F2.Deflicker:this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:"",enable:!1,algorithm:{algorithmId:"",type:n.zzh.Deflicker},timeRange:e.targetTimerange});break;default:return}}),t.forEach(t=>{switch(t.toolType){case o.F2.VideoReverseTask:this._renderManager.clearTrackingRelation(e.id,!0)&&r.Z.warning(_.ZP.t("web_tracking_toast_tracking_removed_reversed",{},"The video is reversed. Tracking is removed.")),e.material.objectLocked&&(this.dataSdk.api.video.removeObjectLocked({segmentId:e.id}),r.Z.warning(_.ZP.t("web_camera_tracking_reversed",{},"Clip reversed. Camera tracking is removed."))),this._replaceReverseResult(e,i,u,g);break;case o.F2.VideoMaskTask:this._replaceVideoMattingResult(e,i,u,g);break;case o.F2.ImageMaskTask:this._replaceImageMattingResult(e,i,u,g);break;case o.F2.PictureIntelligentToning:case o.F2.VideoIntelligentToning:this.dataSdk.api.video.setSmartColorAdjust({enable:!0,segmentId:e.id,path:i.path,smartAdjustColor:{value:t.param.level,type:n.cVg.MetaTypeSmartColorAdjust,subType:n.DeX.MetaSubTypeNone,effectId:"",resId:"",platform:"all",path:""}});break;case o.F2.VideoStabilization:this._renderManager.clearTrackingRelation(e.id,!0)&&r.Z.warning(_.ZP.t("web_tracking_text_stabilized_no_tracking",{},"The video is stabilized. Tracking is removed.")),e.material.objectLocked&&(this.dataSdk.api.video.removeObjectLocked({segmentId:e.id}),r.Z.warning(_.ZP.t("web_camera_tracking_stabilized",{},"Clip stabilized. Camera tracking is removed."))),this._replaceStableResult(e,i,u,g,t);break;case o.F2.VideoSlowMotion:this._renderManager.clearTrackingRelation(e.id,!0)&&r.Z.warning(_.ZP.t("web_tracking_text_smooth_slow_mo_no_tracking",{},"Smooth slow motion applied. Tracking is removed.")),g?this._replaceTemplateVideoAlgorithmResult(e,i,u):this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:i.path,enable:!0,algorithm:{algorithmId:"",type:n.zzh.ComplementFrame},timeRange:e.targetTimerange,complementFrameConfig:{mode:t.param.name}});break;case o.F2.TemplateCVTask:this._replaceImageToVideoGamePlayResult(e,i,u);break;case o.F2.ImageNoiseReduction:case o.F2.VideoNoiseReduction:this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:i.path,enable:!0,algorithm:{algorithmId:"",type:n.zzh.NoiseReduction},noiseReduction:{segmentId:e.id,level:t.param.level},timeRange:e.targetTimerange});break;case o.F2.Deflicker:this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:i.path,enable:!0,algorithm:{algorithmId:"",type:n.zzh.Deflicker},deflicker:{segmentId:e.id,mode:t.param.mode,level:t.param.level},timeRange:e.targetTimerange});break;default:return}}),!a&&this.dataSdk.api.batch.batchEnd(s,{canUndoRedo:!g})}_replaceReverseResult(e,t,i,a){let{path:r}=t;a?this._segmentInnerReplace(e,{material:{reversePath:r,videoAlgorithm:{path:r}}},i):(this.dataSdk.api.video.reverse({segId:e.id,isReverse:!0,reversePath:r}),this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:r,timeRange:e.targetTimerange}))}_replaceVideoMattingResult(e,t,i,a){var r;let o=(0,m.t)({mattingPath:t.matting.path,edgeMattingPath:null===(r=t.mattingEdge)||void 0===r?void 0:r.path});a?this._segmentInnerReplace(e,{material:{matting:{flag:BigInt(n.R6k.webAiMattingFlag|n.R6k.enableFlag),path:o}}},i):this.dataSdk.api.video.setMatting({segId:e.id,path:o})}_replaceImageMattingResult(e,t,i,a){let{path:r}=t;a?this._segmentInnerReplace(e,{material:{matting:{flag:BigInt(n.R6k.webAiMattingFlag|n.R6k.enableFlag),path:r},videoAlgorithm:{path:r}}},i):(this.dataSdk.api.video.setMatting({segId:e.id,path:r}),this.dataSdk.api.video.setVideoAlgorithm({segmentId:e.id,path:r,timeRange:e.targetTimerange}))}_replaceStableResult(e,t,i,a,r){let{path:n}=t;a?this._segmentInnerReplace(e,{material:{stable:{stableLevel:r.param.level,matrixPath:""},videoAlgorithm:{path:n}}},i):this.dataSdk.api.video.setStable({stableLevel:r.param.level,matrixPath:"",segmentId:e.id,path:n})}_replaceTemplateVideoAlgorithmResult(e,t,i){let{path:a}=t;this._segmentInnerReplace(e,{material:{videoAlgorithm:{path:a}}},i)}_replaceImageToVideoGamePlayResult(e,t,i){let{path:a,resourceId:r,productType:o}=t;this._segmentInnerReplace(e,{material:{path:a,type:o,materialId:r,sourcePlatform:n.cvu.MaterialPlatformDefault,duration:e.targetTimerange.duration}},i)}_segmentInnerReplace(e,t,i){this._dataSdk.api.segment.innerReplace({draftId:i,identifier:{id:e.id,material:{path:e.material.path}},substitute:t})}getPipelineId(e){var t;return null===(t=this.dataSdk.draftView.getVideoAlgorithm(e.id))||void 0===t?void 0:t.pipelineId}_updatePipelineId(e,t){var i,a,r;let n=this._dataSdk.draftView.getTrackBySegmentId(e.id);this._control.updateAttachmentJson(e.id,n.id,{pipelineId:t.pipelineId,materialId:e.material.id,path:t.path,mattingPath:(0,m.t)({mattingPath:null!==(r=null===(i=t.matting)||void 0===i?void 0:i.path)&&void 0!==r?r:"",edgeMattingPath:null===(a=t.mattingEdge)||void 0===a?void 0:a.path})},this._dataSdk)}getFailedText(e){this._getSpecificToolTypeFailedContent(e)}_getSpecificToolTypeFailedContent(e){switch(e){case o.F2.VideoNoiseReduction:case o.F2.ImageNoiseReduction:return _.ZP.t("web_noise_toast_fail",{},"Couldn\u2019t reduce image noise. Try again.");case o.F2.VideoIntelligentToning:case o.F2.PictureIntelligentToning:return _.ZP.t("web_color_correction_toast_not_applied",{},"Couldn\u2019t apply AI color correction");case o.F2.VideoStabilization:return _.ZP.t("web_video_stable_text_fail_stable",{},"Couldn\u2019t stabilize");case o.F2.VideoSlowMotion:return _.ZP.t("web_frame_fill_text_failed_frame",{},"Couldn\u2019t apply smooth slow-mo");case o.F2.VideoReverseTask:return _.ZP.t("fail_operate_retry",{},"\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");case o.F2.VideoMaskTask:case o.F2.ImageMaskTask:return _.ZP.t("web_smart_keying_failed",{},"\u667A\u80FD\u62A0\u50CF\u5931\u8D25");case o.F2.Deflicker:return _.ZP.t("web_flicker_toast_fail",{},"Couldn\u2019t remove flicker. Try again.");default:return""}}_getPipelineFailedMessageContent(e,t){var i;if(!(null===(i=navigator)||void 0===i?void 0:i.onLine))return _.ZP.t("network_unavailable__please_try_again_later",{},"Network error. Try again later.");let a=_.ZP.t("web_noise_something_went_wrong",{},"Something went wrong");return t.length>1?a:this._getSpecificToolTypeFailedContent(e)}_getSuccessText(e,t,i){let a=this._segmentIdGlobalSuccessMessageContentMap.get(e.id);if(a)return a;if(i.length>1)return _.ZP.t("web_noise_toast_multiple_success",{},"Features applied");switch(t){case o.F2.VideoSlowMotion:return _.ZP.t("web_editor_toolsmodify_toast_slowmo_success",{},"Smooth slow-mo applied");case o.F2.VideoMaskTask:return _.ZP.t("web_editor_toolsmodify_toast_removebg_success",{},"Background removed");case o.F2.VideoNoiseReduction:case o.F2.ImageNoiseReduction:return _.ZP.t("web_noise_toast_reduced",{},"Image noise reduced");case o.F2.Deflicker:return _.ZP.t("web_flicker_removed_toast",{},"Flicker removed");case o.F2.VideoStabilization:return _.ZP.t("web_editor_toolsmodify_toast_stabilize_success",{},"Video stabilized");default:return""}}_getFunctionName(e){return({[o.F2.VideoIntelligentToning]:"ai_color_correction",[o.F2.PictureIntelligentToning]:"ai_color_correction",[o.F2.VideoStabilization]:"stabilize",[o.F2.VideoSlowMotion]:"smooth_slow_mo",[o.F2.VideoReverseTask]:void 0,[o.F2.VideoMaskTask]:void 0,[o.F2.ImageMaskTask]:void 0,[o.F2.TemplateCVTask]:void 0,[o.F2.VideoNoiseReduction]:"denoise",[o.F2.ImageNoiseReduction]:"denoise",[o.F2.VideoCut]:"video_cut",[o.F2.Deflicker]:"deflicker"})[e]}async _reportFn(e,t){let i=(0,S.p8)(e),{path:a,type:r}=e.material,d=this._draftPathStore.getResourceKeyFromDraftPath(a),l={materialCategory:i.material_category,materialFormat:"",materialDuration:"",materialResolution:"",materialSize:"",materialName:i.material_name,panelCategory:i.panel_category,...t};if(d){let e,t,i;try{i=this._draftMaterialsService.getMaterialByKey(d)}catch{}switch(r){case n.cVg.MetaTypeVideo:if(i){let{width:e,height:t,size:a=0,subType:r="",duration:n=0}=i;Object.assign(l,{materialFormat:r,materialDuration:(1e3*n).toString(),materialResolution:`${e}x${t}`,materialSize:(a/1024).toString()})}else if(e=u._g.Video,(t=this._resourceService.get(d,e))&&(await (0,s.Z)(t)).ok){let{originVideo:e}=t.value,{width:i,height:a,size:r,format:n}=e;Object.assign(l,{materialFormat:n,materialDuration:"",materialResolution:`${i}x${a}`,materialSize:(r/1024).toString()})}break;case n.cVg.MetaTypePhoto:if(i){let{width:e,height:t,size:a=0,subType:r=""}=i;Object.assign(l,{materialFormat:r,materialResolution:`${e}x${t}`,materialSize:(a/1024).toString()});break}if(e=u._g.Photo,(t=this._resourceService.get(d,e))&&(await (0,s.Z)(t)).ok){let{format:e}=t.value;Object.assign(l,{materialFormat:e})}}}let c=t.toolType===o.F2.ImageMaskTask||t.toolType===o.F2.VideoMaskTask;!c&&(0,y.x)(this._containerService,l),c&&(0,k.TK)(this._containerService,l)}_initSegmentSplitListener(){this._dataSdk.onChangeDiff(e=>{var t,i,a,r,o;let s,d;let{actionOperateType:l,hasMainTrackSegmentTargetTimeChange:c,isRecovery:u,isInBatchMode:h,segment:p}=e;if(l!==n.aWQ.Local||!c||u||h||2!==p.length||!p.every(e=>[n.C8.UPDATE,n.C8.ADD].includes(e.type)))return;for(let e of p)e.type===n.C8.UPDATE?s=e.item:e.type===n.C8.ADD&&(d=e.item);if(!d||!s)return;let{segment:_}=d;if(!(0,n.hey)(_))return;let g=this._dataSdk.draftView.getSegmentById(s.id);if(!g||!(0,n.hey)(g)||(null===(t=g.material)||void 0===t?void 0:t.path)!==(null==_?void 0:null===(i=_.material)||void 0===i?void 0:i.path))return;let{start:m,duration:f}=null!==(a=null==g?void 0:g.sourceTimerange)&&void 0!==a?a:{},{start:v}=null!==(r=null==_?void 0:_.sourceTimerange)&&void 0!==r?r:{};if(v!==m+f||!v)return;let y=this.getTokenBySegmentId(g.id);if(!y)return;let S=this.getUserActionDelta(g.id);this._segmentIdUserActionDelta.set(_.id,S),this._segmentIdDurationMap.set(_.id,null!==(o=this._segmentIdDurationMap.get(g.id))&&void 0!==o?o:performance.now()),this._segmentIdTokenMap.set(_.id,y);let[{toolType:T}]=S;y.onSuccess(e=>{this.handleSuccess(_,T,e)}),y.onError(e=>{this.handleError(_,T,e)}),y.onProgress((e,t)=>{this.handleProgress(e,t,_)}),y.onCancel(()=>{this.handleCancel(_,T)}),y.onCancelWithMidProdApply(e=>{let{product:t,successToolTypes:i}=null!=e?e:{};this.handleCancelWithMidProdApply(_,t,i)})})}constructor(e,t,i,a,r,n,o,s,d,l,c,u){this._dataSdk=e,this._timelineManager=t,this._renderManager=i,this._draftPathStore=a,this._intelligenceStore=r,this._playManager=n,this._containerService=o,this._resourceService=s,this._draftMaterialsService=d,this._notificationService=l,this._accoutService=c,this._environmentService=u,this._segmentIdTokenMap=(0,v.LO)(new Map),this._segmentIdLoadingState=(0,v.LO)(new Map),this._segmentIdUserActionDelta=(0,v.LO)(new Map),this._segmentIdDurationMap=new Map,this._segmentIdMaterialMap=new Map,this._segmentIdGlobalLoadingMessageContentMap=new Map,this._segmentIdGlobalLoadingMessageCloseMap=new Map,this._segmentIdGlobalSuccessMessageContentMap=new Map,this._segmentIdLoadingTimestamp=new Date().getTime(),this._initSegmentSplitListener()}}R=(0,a.gn)([(0,a.fM)(6,d.t),(0,a.fM)(7,l.c),(0,a.fM)(8,T.D),(0,a.fM)(9,b.lT),(0,a.fM)(10,c.D),(0,a.fM)(11,M.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IntelligenceStore?Object:IntelligenceStore,"undefined"==typeof PlayerManager?Object:PlayerManager,void 0===d.t?Object:d.t,void 0===l.c?Object:l.c,void 0===T.D?Object:T.D,void 0===b.lT?Object:b.lT,void 0===c.D?Object:c.D,void 0===M.rO?Object:M.rO])],R)},855021:function(e,t,i){i.d(t,{s:function(){return k}});var a=i(789786),r=i(587892),n=i(402655),o=i(690613),s=i(208041),d=i(800788),l=i(129219),c=i(65458),u=i(920704),h=i(230689),p=i(433140),_=i(200247),g=i(817554),m=i(426336),f=i(263958),v=i(503914),y=i(638336),S=i(105395),T=i(732564);class k extends n.JT{get source(){return l.Sc.Matting}get product(){return(0,d.Y2)(this._product),this._product}get status(){return this._cancellation.token.isCancellationRequested?l.xR.Cancelled:this._job?(0,v.s)(this._job.status):l.xR.Running}get error(){return this._error}async _startJob(){if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let e=this._smartToolsService.makeBuilder(),t="",i=u.hn.EverPhoto;this._segment.reverse?(t=await (0,y.Dc)(this._segment,this._draftPathStore,this._resourceService),i=(0,y._Y)(this._accountService.hasLogin)):(t=await (0,y.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService),i=(0,y.R5)(this._segment,this._accountService.hasLogin)),this._segment.material.type===m.cVg.MetaTypePhoto?e.createGraphicMattingTask(t,i):e.createVideoMattingTask(t,i),this._job=e.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,d.Y2)(1===e.length),this._downloadAndAddResourceService(e[0])})}async _downloadAndAddResourceService(e){var t,i,a,r,n,o,s,l,c,u,h,p,_,f,v,y,T;let k=[{md5:null!==(u=null===(t=e.cloudData)||void 0===t?void 0:t.md5)&&void 0!==u?u:"",vid:null!==(h=null===(i=e.onlineData)||void 0===i?void 0:i.vid)&&void 0!==h?h:"",url:null!==(p=null===(a=e.onlineData)||void 0===a?void 0:a.url)&&void 0!==p?p:"",key:null!==(_=null===(r=e.onlineData)||void 0===r?void 0:r.key)&&void 0!==_?_:""},{md5:null!==(f=null===(n=e.cloudData)||void 0===n?void 0:n.edgeProductMd5)&&void 0!==f?f:"",vid:null!==(v=null===(o=e.onlineData)||void 0===o?void 0:o.edgeProductVid)&&void 0!==v?v:"",url:null!==(y=null===(s=e.onlineData)||void 0===s?void 0:s.edgeProductUrl)&&void 0!==y?y:"",key:null!==(T=null===(l=e.onlineData)||void 0===l?void 0:l.edgeProductKey)&&void 0!==T?T:""}].filter(e=>""!==e.md5||""!==e.vid),b=await this._containerService.invokeFunction(g.CH,{list:k},{resourceType:this._segment.material.type===m.cVg.MetaTypePhoto?10:5});if(!b.ok)return b;let I=this._containerService.invokeFunction(g.Jy,b.value,this._draftPathStore);(0,d.Y2)(I.length>=1);let M={url:"",key:""};if(e.cloudData){let e=await (0,g.gF)(this._resourceService,I[0].id);M.url=e.url,M.key=e.key}else e.onlineData&&(M.url=e.onlineData.url,M.key=e.onlineData.key);if(I[1]){if(e.cloudData){let e=await (0,g.gF)(this._resourceService,I[1].id);M.edgeProductUrl=e.url,M.edgeProductKey=e.key}else e.onlineData&&(M.edgeProductUrl=e.onlineData.edgeProductUrl,M.edgeProductKey=e.onlineData.edgeProductKey)}if(this._product={path:I[0].path,edgeProductPath:null===(c=I[1])||void 0===c?void 0:c.path,...M},this._segment.material.type===m.cVg.MetaTypePhoto){let e=await this._containerService.invokeFunction(S.F4,I[0].id,I[0].path);if(!e.ok){this._error=e,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}else{let e=await this._containerService.invokeFunction(S.Nv,this._renderManager,this._product);if(!e.ok){this._error=e,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}}constructor(e,t,i,a,n,d,l){super(),this._segment=e,this._renderManager=t,this._draftPathStore=i,this._accountService=a,this._smartToolsService=n,this._containerService=d,this._resourceService=l,this._onProgress=new r.Q,this._onError=new r.Q,this._onSuccess=new r.Q,this._onCancel=new r.Q,this._cancellation=new s.A,this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new f.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}k=(0,a.gn)([(0,a.fM)(3,_.D),(0,a.fM)(4,c.dM),(0,a.fM)(5,h.t),(0,a.fM)(6,p.c),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,void 0===T.zo?Object:T.zo,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===_.D?Object:_.D,void 0===c.dM?Object:c.dM,void 0===h.t?Object:h.t,void 0===p.c?Object:p.c])],k)},85031:function(e,t,i){i.d(t,{c:function(){return w}});var a=i(789786),r=i(587892),n=i(402655),o=i(690613),s=i(208041),d=i(800788),l=i(426336),c=i(129219),u=i(896413),h=i(108692),p=i(722169),_=i(65458),g=i(126729),m=i(920704),f=i(230689),v=i(433140),y=i(326236),S=i(200247),T=i(263958),k=i(503914),b=i(817554),I=i(638336),M=i(271564);class w extends n.JT{get source(){return c.Sc.SmartCrop}get product(){return(0,d.Y2)(this._product),this._product}get status(){return this._cancellation.token.isCancellationRequested?c.xR.Cancelled:this._job?(0,k.s)(this._job.status):c.xR.Running}get error(){return this._error}get _pipelineManager(){return this._mainEditorWidgetService.smartToolsManager.pipelineManager}async _preStartJob(e){let t=this._pipelineManager.getPipelineId(this._segment);if(this._segment.reverse)try{if(t)for(;!this._cancellation.token.isCancellationRequested;){let e=await this._pipelineDataService.getPipelineOriginTask({pipelineId:t,workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId});if(!e.ok){this._onError.fire(e);return}let{pipeline_status:i,pipeline_result:a}=e.value;if(i===g.nI.Failed||i===g.nI.NotFound){this._onError.fire((0,o.wf)(-1,"query pipeline origin failed"));return}if(i===g.nI.Success){(0,d.Y2)(a.vid),this._startJob({vid:a.vid});return}}else if(e){this._onError.fire((0,o.wf)(-1,"rerun pipeline failed"));return}else{this._rerunPipeline();return}}catch(e){var i;this._onError.fire((0,o.Mx)(null!==(i=null==e?void 0:e.ret)&&void 0!==i?i:-1,"smart crop pre task failed",e))}else this._startJob()}_rerunPipeline(){let e={toolType:g.F2.VideoReverseTask,param:{},enable:!0},{isEqual:t}=this._pipelineManager.checkApplyDelta(this._segment,e);(0,d.Y2)(t),!this._pipelineManager.handleSwitchIntelligent({segment:this._segment,params:e,options:{forcePipeline:!0,onFinished:()=>this._preStartJob(!0)}})&&this._onError.fire((0,o.wf)(-1,"create pipeline token failed"))}async _startJob(e){if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let t=this._smartToolsService.makeBuilder(),i=await (0,I.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService),a=(0,I.R5)(this._segment,this._accountService.hasLogin);e&&(a=m.hn.VideoArch,i=e.vid);let{extra:r,...n}=this._params;t.createSmartCropTask({...n,assetId:i,platform:a,workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,assetWorkspaceId:(0,I.LL)(this._segment,this._mainDraftService.draftWorkspaceManager.workspaceId)}),this._job=t.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress((e,t)=>{this._onProgress.fire(e,t)}),this._job.onSuccess(e=>{var t,i,a;(0,d.Y2)(1===e.length);let r=e[0].cropProduct;if(null==r?void 0:null===(t=r.crop_box_list)||void 0===t?void 0:t.length){let e=JSON.stringify({id:this._segment.id,ratio_index:null!==(a=null===(i=M.A9[this._params.extra.crop_ratio])||void 0===i?void 0:i.numberValue)&&void 0!==a?a:0,custom_ratio:this._params.extra.crop_ratio_number,shift_speed:this._params.keyFrameFps,lens_stability:this._params.stableWeight,box_info:{crop_box_list:r.crop_box_list,face_box_list:[]}}),t=new TextEncoder().encode(e).buffer;this._handleChange(this._cache_path,t),this._onSuccess.fire({...r,cache_path:this._cache_path})}else this._onError.fire((0,o.wf)(-1,"smart crop result crop_box_list empty"))})}_handleChange(e,t){this._saveDraftStr(e,t),this._algorithmFilerManager.addUploadQueue(e,!0),this._upload()}_saveDraftStr(e,t){let i=l.P4R.ensureRootPath(e);this._mainEditorWidgetService.renderManager.fs.writeFileSync(i,t,{skipExist:!1})}constructor(e,t,i,a,n,d,c,u,h,_,g){super(),this._segment=e,this._params=t,this._draftPathStore=i,this._algorithmFilerManager=a,this._accountService=n,this._containerService=d,this._smartToolsService=c,this._resourceService=u,this._mainEditorWidgetService=h,this._pipelineDataService=_,this._mainDraftService=g,this._onProgress=new r.Q,this._onError=new r.Q,this._onSuccess=new r.Q,this._onCancel=new r.Q,this._cancellation=new s.A,this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.addFileProductToResourceServiceCB=(e,t)=>{this._containerService.invokeFunction(b.Jy,[e],this._draftPathStore,[t])},this._upload=(0,p.debounce)(()=>{this._algorithmFilerManager.setUploadDirty(!0),this._algorithmFilerManager.uploadWhileUnmountAndCustomize(this.addFileProductToResourceServiceCB)},150),this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event;let m=`smart_crop/${this._segment.id}`;this._cache_path=`${m}/${(0,l.pB0)()}-totalCacheV2`,this._cache_path_config=`${m}/config`,this._preTask=new T.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onSuccess(()=>{this._preStartJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}w=(0,a.gn)([(0,a.fM)(4,S.D),(0,a.fM)(5,f.t),(0,a.fM)(6,_.dM),(0,a.fM)(7,v.c),(0,a.fM)(8,u.a),(0,a.fM)(9,y.Z),(0,a.fM)(10,h.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof SmartCropParams?Object:SmartCropParams,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof AlgorithmFilerManager?Object:AlgorithmFilerManager,void 0===S.D?Object:S.D,void 0===f.t?Object:f.t,void 0===_.dM?Object:_.dM,void 0===v.c?Object:v.c,void 0===u.a?Object:u.a,void 0===y.Z?Object:y.Z,void 0===h.n?Object:h.n])],w)},876241:function(e,t,i){i.d(t,{W:function(){return y}});var a=i(789786),r=i(587892),n=i(402655),o=i(690613),s=i(208041),d=i(800788),l=i(129219),c=i(65458),u=i(230689),h=i(433140),p=i(200247),_=i(817554),g=i(263958),m=i(503914),f=i(638336),v=i(105395);class y extends n.JT{get source(){return l.Sc.Stable}get product(){return(0,d.Y2)(this._product),this._product}get status(){return this._cancellation.token.isCancellationRequested?l.xR.Cancelled:this._job?(0,m.s)(this._job.status):l.xR.Running}get error(){return this._error}async _startJob(){var e;if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let t=this._smartToolsService.makeBuilder(),i=await (0,f.aP)(this._segment,this._draftPathStore,this._resourceService),a=(0,f.R5)(this._segment,this._accountService.hasLogin);t.createStableTask(i,a,{stableLevel:null===(e=this._segment.material.stable)||void 0===e?void 0:e.stableLevel}),this._job=t.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{(0,d.Y2)(1===e.length),this._downloadAndAddResourceService(e[0])})}async _downloadAndAddResourceService(e){var t,i;let a=[{md5:null!==(t=e.md5)&&void 0!==t?t:"",vid:null!==(i=e.vid)&&void 0!==i?i:"",url:e.url,key:e.key}].filter(e=>""!==e.md5||""!==e.vid),r=await this._containerService.invokeFunction(_.CH,{list:a},{resourceType:l.uG.SmartTools,resourceId:e.taskId,isGameplay:!0});if(!r.ok){this._error=r,this._onError.fire(this._error);return}e.groupType===c.wM.Image?this._accountService.hasLogin?this._handleImageProduct(e,r.value):this._handleFileProduct(e,r.value):this._accountService.hasLogin?this._handleVideoProduct(e,r.value):this._handleFileProduct(e,r.value)}async _handleImageProduct(e,t){let i=this._containerService.invokeFunction(_.Fq,t,this._draftPathStore),a=await this._containerService.invokeFunction(v.RG,i[0].id,i[0].path);if(!a.ok){this._error=a,this._onError.fire(this._error);return}this._product={path:i[0].path,groupType:l.FI.Image,resourceId:e.resourceId,resourceName:e.resourceName},this._onSuccess.fire(this._product)}async _handleVideoProduct(e,t){let i=this._containerService.invokeFunction(_.Rg,t,this._draftPathStore);(0,d.Y2)(i.length>=1);let a=await (0,_.TB)(this._resourceService,i[0].id);this._product={path:i[0].path,...a,groupType:l.FI.Video,resourceId:e.resourceId,resourceName:e.resourceName};let r=await this._containerService.invokeFunction(v.U3,this._renderManager,this._product);if(!r.ok){this._error=r,this._onError.fire(this._error);return}this._onSuccess.fire(this._product)}async _handleFileProduct(e,t){let i=this._containerService.invokeFunction(_.Jy,t,this._draftPathStore);(0,d.Y2)(i.length>=1);let a=await (0,_.gF)(this._resourceService,i[0].id);if(this._product={path:i[0].path,...a,groupType:l.FI.Video,resourceId:e.resourceId,resourceName:e.resourceName},e.groupType===c.wM.Video){let e=await this._containerService.invokeFunction(v.U3,this._renderManager,this._product);if(!e.ok){this._error=e,this._onError.fire(this._error);return}}else if(e.groupType===c.wM.Image){let t=await this._containerService.invokeFunction(v.F4,e.resourceId,this._draftPathStore.getDraftPathFromResourceKey(e.resourceId));if(!t.ok){this._error=t,this._onError.fire(this._error);return}}else(0,d.bP)(e.groupType);this._onSuccess.fire(this._product)}constructor(e,t,i,a,n,d,l){super(),this._segment=e,this._renderManager=t,this._draftPathStore=i,this._accountService=a,this._smartToolsService=n,this._containerService=d,this._resourceService=l,this._onProgress=new r.Q,this._onError=new r.Q,this._onSuccess=new r.Q,this._onCancel=new r.Q,this._cancellation=new s.A,this._error=(0,o.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new g.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(this._error)})),this._preTask.execute()}}y=(0,a.gn)([(0,a.fM)(3,p.D),(0,a.fM)(4,c.dM),(0,a.fM)(5,u.t),(0,a.fM)(6,h.c),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===p.D?Object:p.D,void 0===c.dM?Object:c.dM,void 0===u.t?Object:u.t,void 0===h.c?Object:h.c])],y)},929625:function(e,t,i){i.d(t,{S:function(){return u}});var a=i(587892),r=i(475028),n=i(690613),o=i(286399);let s=(0,r.i)(100,"web_tts_toast_error_occurred"),d=(0,r.i)(101,"web_tts_toast_language_unsupported"),l=(0,r.i)(102,"web_tts_toast_error_occurred"),c=(0,r.i)(103,"web_tts_toast_characters_limit");class u{async start(e){let[t,i]=(await this._ttsDataService.getToken()).pair();if(!t)this._url=this._client.start({url:e.url,token:i.token,appkey:i.appKey,config:{...o.v,ssml:"",speaker:e.speaker,text:e.text,audio_config:{...e.audioOptions},extra:e.extra},onClose:this._onClose,onSocketError:this._onSocketError,onServerError:this._onServerError,onMessage:this._onMessage,onComplete:this._onComplete})}constructor(e,t){this._client=e,this._ttsDataService=t,this._buffers=[],this._error=(0,n.ly)(),this._onSuccess=new a.Q,this._onError=new a.Q,this.onCancelEvent=new a.Q,this._ttsConfig={},this._url="",this._onClose=()=>{this._buffers.length>0&&(this._onSuccess.fire(new Blob(this._buffers,{type:"audio/mp3"}),this._url),this._buffers.length=0)},this._onSocketError=()=>{this._error=s(),this._onError.fire(this._error)},this._onServerError=e=>{0x2687c52===e.status_code?this._error=d():0x2687c53===e.status_code?this._error=c():this._error=l(),this._onError.fire(this._error),this._buffers.length&&(this._buffers.length=0)},this._onMessage=e=>{e.buffer&&this._buffers.push(e.buffer)},this._onComplete=()=>{},this.onSuccess=this._onSuccess.event,this.onError=this._onError.event,this.onCancel=this.onCancelEvent.event}}},247461:function(e,t,i){i.d(t,{u:function(){return n}});var a=i(558874),r=i(990764);class n{createConverter(e){let{ttsDataService:t,generateTtsDataService:i}=e;return new r.R(i,t)}constructor(){this._client=new a.rT}}},652146:function(e,t,i){i.d(t,{BO:function(){return n},GE:function(){return d},as:function(){return r},k2:function(){return o},md:function(){return s}});var a=i(426336);function r(e,t){let i=t.material.textToAudioIds;if(0===i.length)return[];let a=[];return e.draftView.getAllTracks().forEach(e=>{var t,r;return null===(t=(r=e.segments).forEach)||void 0===t?void 0:t.call(r,e=>{i.includes(e.id)&&a.push(e)})}),a}function n(e,t){let{dataSdk:i}=t,r=function(e,t){if(!t)return[];let i=[],r=(function(e,t){if(!t)return[];let i=[];return e.draftView.getAllTracks().forEach(e=>{var r,n;return null===(r=(n=e.segments).forEach)||void 0===r?void 0:r.call(n,e=>{(0,a.Y9Q)(e)&&e.material.resourceId===t&&i.push(e)})}),i})(e,t).map(e=>e.id);return e.draftView.getAllTracks().forEach(e=>{var t,n;return null===(t=(n=e.segments).forEach)||void 0===t?void 0:t.call(n,e=>{if((0,a.Ftn)(e)||(0,a.Q2R)(e)){let{textToAudioIds:t=[]}=e.material;Array.isArray(t)&&t.some(e=>r.includes(e))&&i.push(e)}})}),i}(i,e);i.api.text.deleteTextToAudioIds({segmentIds:r.map(e=>e.id)})}function o(e,t){if((0,a.Ftn)(e))return e.material.text;if((0,a.Q2R)(e)){let a=e.material.textInfoResources;if(t){let e=a.find(e=>e.textMaterial.id===t);if(e){var i;return null!==(i=e.textMaterial.text)&&void 0!==i?i:""}}return a.map(e=>e.textMaterial.text).join(" ")}return""}function s(e){return!e||"\b"===e}function d(e){let t=0;if(!e)return t;for(let i of e){if(!/\n/.test(i))t+=1}return t}}}]);