"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["630"],{513280:function(){},435716:function(){},925022:function(e,t,r){r.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-RRfiXh",entryContainer:"entry-container-RRfiXh","view-box":"view-box-slW5om",viewBox:"view-box-slW5om",initializing:"initializing-bKHntD",hidden:"hidden-x34gx0","poly-entry":"poly-entry-XeWIwO",polyEntry:"poly-entry-XeWIwO","scroll-container":"scroll-container-6ntxxC",scrollContainer:"scroll-container-6ntxxC","search-bar":"search-bar-zo5DzX",searchBar:"search-bar-zo5DzX","search-bar-new-style":"search-bar-new-style-G_10CC",searchBarNewStyle:"search-bar-new-style-G_10CC","favorite-header":"favorite-header-MTinbz",favoriteHeader:"favorite-header-MTinbz",backBtn:"backBtn-Ht_1Kt"}},986401:function(){},843930:function(){},410079:function(){},164736:function(e,t,r){r.d(t,{Z:function(){return a}});let a={"sider-menu-panel-margin-top":"10px",siderMenuPanelMarginTop:"10px","sider-menu-panel-padding-x":"16px",siderMenuPanelPaddingX:"16px","size-height-editor-nav":"56px",sizeHeightEditorNav:"56px","size-width-min-editor":"1080px",sizeWidthMinEditor:"1080px","size-height-min-editor":"550px",sizeHeightMinEditor:"550px","size-height-min-editor-bd":"320px",sizeHeightMinEditorBd:"320px","size-height-min-timeline":"128px",sizeHeightMinTimeline:"128px","size-width-min-editor-player":"500px",sizeWidthMinEditorPlayer:"500px","size-width-min-editor-attr":"320px",sizeWidthMinEditorAttr:"320px","size-height-min-editor-tl":"128px",sizeHeightMinEditorTl:"128px","size-height-min-batch-replace-tl":"200px",sizeHeightMinBatchReplaceTl:"200px","size-height-editor-collapsed-tl":"70px",sizeHeightEditorCollapsedTl:"70px","entry-container":"entry-container-MEnZ8c",entryContainer:"entry-container-MEnZ8c","view-box":"view-box-xeL5tZ",viewBox:"view-box-xeL5tZ",initializing:"initializing-j9MP5E",hidden:"hidden-PKi8Ha","scroll-container":"scroll-container-mgw0G9",scrollContainer:"scroll-container-mgw0G9"}},926615:function(){},94548:function(){},266285:function(){},235066:function(){},452487:function(){},243773:function(){},793173:function(){},825259:function(e,t,r){r.d(t,{Z:function(){return a}});let a={loadingIcon:"loadingIcon-DQwMze",loading:"loading-bHvoRY",content:"content-QPU9Tb",cancelBtn:"cancelBtn-MntmvO"}},962965:function(e,t,r){e.exports=r.p+"static/image/loading.cc0edf54.webp"},394931:function(e,t,r){r.d(t,{Z:function(){return o}}),r(147442);var a=r(144144),i=r(759006),n=r(937567);new i.i().start(),(0,a.oe)(n.ENTRY_SCRIPT_EXECUTION);let o=()=>null},122312:function(e,t,r){r.d(t,{d:function(){return c}});var a=r(789786),i=r(801497),n=r(207033),o=r(230689),s=r(21961),l=r(339098);class c{async extractAudioAndUpload(e){let t=await (0,n.y)({...e,fastImportAnalyzeHelper:this._options.fastImportHelper,payinPayoutHelper:this._options.payinPayoutHelper,containerService:this._containerService}),r=!1;if(t.forEach(t=>{if(!t.ok){r=!0;return}this._options.onCreated({directoryNodeType:s.t.File,material:t.value,...e})}),r){var a;null===(a=this._notificationService)||void 0===a||a.error(i.ZP.t("transcoding_failed",{},"\u8F6C\u7801\u5931\u8D25"))}return t}constructor(e,t){this._options=e,this._containerService=t,this._notificationService=(0,l.O)(this._containerService,e.notificationGenerator)}}c=(0,a.gn)([(0,a.fM)(1,o.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IExtractAudioAndUploadMaterialNoSignParams?Object:IExtractAudioAndUploadMaterialNoSignParams,void 0===o.t?Object:o.t])],c)},956580:function(e,t,r){r.d(t,{V:function(){return s}});var a=r(789786),i=r(639605),n=r(587892),o=r(402655);class s extends o.JT{constructor(e){super(),this._websocketService=e,this._onDidUpload=this._store.add(new n.Q),this._uploadedCountCounter=new Map,this._uploadedAssetIds=[],this.onDidUpload=this._onDidUpload.event,this._onUploadFileSuccess=e=>{var t;if(!e.ok||e.value.status!==i.Pk.DONE)return;let{upload_from:r=i.d0.PHONE,asset_id:a="",workspace_id:n=""}=e.value,o=this._uploadedAssetIds.includes(a),s=`${n}_${r}`,l=null!==(t=this._uploadedCountCounter.get(s))&&void 0!==t?t:0;!o&&(l+=1,this._uploadedAssetIds.push(a)),this._uploadedCountCounter.set(s,l),this._onDidUpload.fire({workspaceId:n,uploadFrom:r,newUploadMaterialIds:[a],uploadedCount:l})},this._websocketService.registerCallback(i.h1.WorkspaceUploadLinkFileSuccess,this._onUploadFileSuccess)}}s=(0,a.gn)([(0,a.fM)(0,i.J0),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===i.J0?Object:i.J0])],s)},673422:function(e,t,r){r.d(t,{K:function(){return m}});var a=r(789786),i=r(775352),n=r(273238),o=r(988385),s=r(28791),l=r(230689),c=r(690613),d=r(374904),u=r(458906),h=r(70031),p=r(347477),_=r(507967),g=r(907525),f=r(21961);class m{get accepts(){return this.getAcceptsByType(this._options.acceptTypes)}get acceptTypes(){return this._options.acceptTypes}getAcceptsByType(e){var t;let r=e=>{let t=e.acceptType.filter(e=>{var t;return!((null===(t=this._options)||void 0===t?void 0:t.disableTypes)||[]).includes(e)});return[...t,...e.acceptSuffix.filter(e=>{var t;return!((null===(t=this._options)||void 0===t?void 0:t.disableTypes)||[]).includes(e)})].join(",")};return null!==(t=null==e?void 0:e.reduce((e,t)=>`${e?",":""}${e}${r(d.NF[t])},`,""))&&void 0!==t?t:"*/*"}async selectToUpload(e){var t;let r=await (0,p.IL)(e.acceptTypes?this.getAcceptsByType(e.acceptTypes):this.accepts,e.multiple);if(!!(null==r?void 0:r.length))null==e||null===(t=e.onFilesSelected)||void 0===t||t.call(e,{files:r,acceptedFiles:r}),this.upload({...e,files:r})}async upload(e){var t,r,a,n,s,l,c;let d=!1;(null==e?void 0:null===(t=e.uploadParams)||void 0===t?void 0:t.uploadFlag)!==i.m5.InvisibleNoOccupation&&(null==e?void 0:null===(r=e.uploadParams)||void 0===r?void 0:r.uploadFlag)!==i.m5.NoOccupation&&(d=(await this._showExpandWhenNoSpace({files:e.files,fromWorkspaceId:e.fromWorkspaceId,checkUploadFlag:e.checkUploadFlag,uploadFlag:null===(l=e.uploadParams)||void 0===l?void 0:l.uploadFlag})).hasLargeFile);let u=await (0,o.E)({...e,checkUploadLimit:{singleSize:this._singleFileSizeLimit,isNoNeedSingleSizeLimitToast:d},autoUpload:e.autoUpload,acceptTypes:null!==(c=e.acceptTypes)&&void 0!==c?c:this._options.acceptTypes,disableTypes:null===(a=this._options)||void 0===a?void 0:a.disableTypes,uploadSizeChecker:this._uploadSizeChecker,payinPayoutHelper:this._options.payinPayoutHelper,fastImportAnalyzeHelper:this._options.fastImportHelper,captureCoverAndThumbHelper:this._captureCoverAndThumbHelper,containerService:this._containerService,checkUploadFlag:e.checkUploadFlag,acceptTypesErrorTipDisabled:this._options.acceptTypesErrorTipDisabled,notificationGenerator:this._options.notificationGenerator});return null===(n=(s=this._options).onBeforeCreated)||void 0===n||n.call(s,{tasks:u,files:e.files}),u.forEach(t=>{var r,a;if(!!t.ok)null===(r=(a=this._options).onCreated)||void 0===r||r.call(a,{directoryNodeType:f.t.File,material:t.value,isFromLocal:!0,fromFolderId:e.fromFolderId,...e})}),u}async _showExpandWhenNoSpace(e){let t=!1,r=e.files.reduce((e,r)=>(r.size>this._singleFileSizeLimit&&(t=!0),e+r.size),0),a=e.checkUploadFlag&&e.uploadFlag===i.m5.InvisibleNoOccupation,n=e.fromWorkspaceId?await this._uploadSizeChecker.getSize(e.fromWorkspaceId):(0,c.wf)(-1,"no space"),o=!a&&n.ok&&r>n.value;return(n.ok&&o||t)&&this._options.payinPayoutHelper&&(0,u.i)({payinPayoutHelper:this._options.payinPayoutHelper,payScene:h.Mm.UPLOAD,workspaceId:e.fromWorkspaceId,uploadFileList:e.files}),{hasLargeFile:t}}constructor(e,t,r,a){var i;this._options=e,this._userMaterialsService=t,this._loggerService=r,this._containerService=a,this._singleFileSizeLimit=0x500000000,this._captureCoverAndThumbHelper=null!==(i=this._options.captureCoverAndThumbHelper)&&void 0!==i?i:this._containerService.createInstance(_.i),this._uploadSizeChecker=new g.A({userMaterialsService:this._userMaterialsService})}}m=(0,a.gn)([(0,a.fM)(1,n.b),(0,a.fM)(2,s.yR),(0,a.fM)(3,l.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUploadMaterialFromLocalParams?Object:IUploadMaterialFromLocalParams,void 0===n.b?Object:n.b,void 0===s.yR?Object:s.yR,void 0===l.t?Object:l.t])],m)},619425:function(e,t,r){r.d(t,{l:function(){return i}});var a,i=((a={}).Back="back",a.Forward="forward",a)},24282:function(e,t,r){r.d(t,{I:function(){return _}});var a=r(789786);r(966156);var i=r(368100),n=r(999268),o=r(587892),s=r(402655),l=r(800788),c=r(782350),d=r(31463),u=r(960395),h=r(273238),p=r(801497);class _ extends s.JT{get workspaceId(){return(0,l.ZB)(this._workspaceId,"draft workspaceId shouldn't empty."),this._workspaceId}async updateWorkspaceId(e){if((0,l.ZB)(this._workspaceId,"draft workspaceId shouldn't empty."),this._workspaceId!==e)await this._mutex.lock(),this._updateWorkspaceId(e),await this._changeBaseEvercloud(e),this._onDidWorkspaceChange.fire(),this._mutex.unLock()}async getWorkspaceName(e){if(this._externalInfo.workspaceName)return this._externalInfo.workspaceName;let{workspaceName:t}=await this._updateWorkspaceExternalInfo(e);return t}async getIsApplyAllowed(e){if(this._externalInfo.applyAllowed)return this._externalInfo.applyAllowed;let{applyAllowed:t}=await this._updateWorkspaceExternalInfo(e);return t}async getIsWorkspaceMember(e){if(this._externalInfo.isWorkspaceMember)return this._externalInfo.isWorkspaceMember;let{isWorkspaceMember:t}=await this._updateWorkspaceExternalInfo(e);return t}async _updateWorkspaceExternalInfo(e){let t=this._workspaceId,[r,a]=(await this._permissionDataService.getWorkspaceInfoExternal({packageKey:e,workspaceId:t,sourceType:4})).pair();return!r&&(this._externalInfo={workspaceName:a.workspace_name,applyAllowed:a.apply_allowed,isWorkspaceMember:a.is_workspace_member}),this._externalInfo}async _changeBaseEvercloud(e){if(!e)return;let t=Date.now(),r=this._workspaceService.getWorkspace(e);if(!!r&&this._baseEvercloud.spaceId!==r.space_id)try{await this._baseEvercloud.changeSpace({spaceId:r.space_id,dcName:r.space_idc,netconf:{base:r.space_host,media:r.space_res_host}})}catch(a){throw this._reportService.reportDevError("draftWorkspaceManager",a,{workspaceId:e,spaceId:r.space_id,timeout:(Date.now()-t).toString()}),i.Z.error({title:p.ZP.t("service_wrong",{},"Service error"),content:p.ZP.t("some_mistakes_retry",{},"An error occurred. Refresh and try again."),okText:p.ZP.t("REFRESH",{},"Refresh"),okButtonProps:{style:{backgroundColor:"var(--lvv-color-main-default)"}},onOk:()=>{window.location.reload()},escToExit:!1,maskClosable:!1,closable:!1}),a}}_updateWorkspaceId(e){this._externalInfo={},this._workspaceId=e}constructor(e,t,r,a,i){super(),this._workspaceId=e,this._userMaterialsService=t,this._workspaceService=r,this._reportService=a,this._permissionDataService=i,this._onDidWorkspaceChange=this._store.add(new o.Q),this._externalInfo={},this._mutex=new n.L,this._baseEvercloud=this._userMaterialsService.getBaseEvercloud(),this.onDidWorkspaceChange=this._onDidWorkspaceChange.event,this._mutex.tryLock(),this._changeBaseEvercloud(this._workspaceId).then(()=>{this._mutex.unLock()})}}_=(0,a.gn)([(0,a.fM)(1,h.b),(0,a.fM)(2,c.W),(0,a.fM)(3,d.m),(0,a.fM)(4,u.q),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[String,void 0===h.b?Object:h.b,void 0===c.W?Object:c.W,void 0===d.m?Object:d.m,void 0===u.q?Object:u.q])],_)},387133:function(e,t,r){r.d(t,{y:function(){return a}});function a(e,t){return -1===t.sourcePath.indexOf("/")?t.sourcePath||e.md5||"":e.md5}},967750:function(e,t,r){r.d(t,{x:function(){return s}});var a=r(273238),i=r(690613),n=r(763832),o=r(211820);async function s(e){let t=Object.assign({},{waitForFirstRequest:!1,delay:0,retryTimes:0},e.fetchRetryOptions),r=async()=>{let t=await e.containerService.invokeFunction(t=>t.get(a.b).getMaterialsByIds({workspaceId:e.fromWorkspaceId,assetIds:e.assetIds}));return t.ok?t.value.length!==e.assetIds.length?(0,i.wf)(-1,"found target assets failure"):t:t},s=async e=>{!(0===e&&!t.waitForFirstRequest)&&await (0,n._)(t.delay);let a=await r();if(!a.ok)return e>=t.retryTimes?a:s(e+1);return a};try{let t=await s(0);if(!t.ok)return t;let r=t.value.map(t=>(0,o.Q)(t,{fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,payinPayoutHelper:e.payinPayoutHelper,containerService:e.containerService,packageDelta:e.packageDelta}));return(0,i.oW)(r)}catch(e){return(0,i.wf)(-1,null==e?void 0:e.message)}}},533112:function(e,t,r){r.d(t,{B:function(){return h}});var a=r(690613),i=r(225698),n=r(374904),o=r(426020),s=r(127830),l=r(65753),c=r(599735),d=r(169790),u=r(339098);async function h(e){try{let[t]=e.containerService.invokeFunction(e=>[e.get(i.w)]),r=(0,u.O)(e.containerService,e.notificationGenerator),h=Promise.all(e.files.map(async i=>{let u=await (await t.getInstance()).calcFileMd5(i);return u.ok?(0,a.oW)(e.containerService.createInstance(d.n,{file:i,data:{assetType:s.pS.Material,sourceType:o.ov.PublicSpace,key:u.value,filename:i.name,fileType:(0,n.eF)({file:i}),md5:u.value,mime:i.type,size:i.size},addModelToDraft:(0,c.s)(e.containerService),fastImportAnalyzeHelper:e.fastImportAnalyzeHelper,prepareMaterialLifecycleHelper:new l.s({file:i}),payinPayoutHelper:e.payinPayoutHelper,notificationService:r})):u}));return await h}catch(e){return[(0,a.wf)(-1,null==e?void 0:e.message)]}}},65753:function(e,t,r){r.d(t,{s:function(){return l}});var a=r(173888),i=r(723703),n=r(690613),o=r(800788),s=r(327478);class l{get _updateStatus(){return this._handler.updateStatus}get preparing(){return this._preparing}get result(){return(0,o.ZB)(this._successResult,"unExpect call function when no success"),this._successResult}bootstrap(e){Object.entries(e.events).forEach(e=>{let[t,r]=e;this._preparing[t]=r}),this._handler=e.handler}async prepare(e){if(this._updateStatus(a.a.Preparing),!this._veToolkitInstance){let e=new URL(r(267057),r.b).href,t=new URL(r(428275),r.b).href,a=new URL(r(610062),r.b).href;this._veToolkitInstance=await s.B.createInstance({audioExtractor:{source:e,wasm:t,worker:a}})}try{let t=this._veToolkitInstance.createAudioExtractorTask(this._file,null!=e?e:"");if(!t){let e=(0,n.wf)(-1,"not exist audioExtractor");this._preparing.error=e,this._updateStatus(a.a.PrepareFailure,{errInfo:e})}let r=(await t.run(e=>{this._handler.onProgress(e)})).data;r&&(this._successResult={buffer:r,fileName:`ve_audio_extractor_${this._file.name}`},this._updateStatus(a.a.Prepared))}catch(t){let e=(0,n.wf)(-1,"extractor audio error");this._preparing.error=e,this._updateStatus(a.a.PrepareFailure,{errInfo:e})}}constructor(e){this._params=e,this._veToolkitInstance=null,this.canRetryPrepare=()=>!!(this._handler.status()===a.a.PrepareFailure&&this._params.file),this.dispose=()=>{this._veToolkitInstance=null},this._file=e.file,this._preparing={progress:0,error:void 0,type:i.U.ExtractAudio}}}},495141:function(e,t,r){r.d(t,{k:function(){return h}});var a=r(789786),i=r(999268),n=r(690613),o=r(173888),s=r(31463),l=r(273238),c=r(458906),d=r(70031),u=r(801497);class h{get _assetId(){return this._params.assetId}get _fromWorkspaceId(){return this._params.fromWorkspaceId}get _toWorkspaceId(){return this._params.toWorkspaceId}get _updateStatus(){return this._params.handler.updateStatus}get _notificationService(){return this._params.notificationService}canSync2UserMaterial(){return!0}async sync2UserMaterial(){if(!this._mutex.tryLock())return(0,n.wf)(-1,"do not call this function before it done");this._updateStatus(o.a.Syncing2UserMaterial),this.syncingUserMaterial.error=void 0;try{let e=await this._params.userMaterialService.copyMaterialToWorkspace({assetId:this._assetId,fromWorkspaceId:this._fromWorkspaceId,toWorkspaceId:this._toWorkspaceId,meta:""});if(!e.ok)return this._updateStatus(o.a.Sync2UserMaterialFailure,{errInfo:e}),this.syncingUserMaterial.error=e,this._reportService.reportDevError("sync-material-from-workspace",this.syncingUserMaterial.error),this._handleError(e.code),e;return this._updateStatus(o.a.Synced2UserMaterial),(0,n.ly)()}catch(e){throw this.syncingUserMaterial.error=(0,n.wf)(-1,null==e?void 0:e.message),this._reportService.reportDevError("sync-material-from-workspace",this.syncingUserMaterial.error),this._updateStatus(o.a.Sync2UserMaterialFailure,{errInfo:this.syncingUserMaterial.error}),e}finally{this._mutex.unLock()}}_handleError(e){let t=Number(e);if(!this._params.payinPayoutHelper){var r;null===(r=this._notificationService)||void 0===r||r.error(u.ZP.t("web_personal_invite_copy_wrong",{},"Couldn\u2019t copy"));return}if(t===l.F.Insufficient)(0,c.i)({payinPayoutHelper:this._params.payinPayoutHelper,payScene:d.Mm.SYNC,workspaceId:this._params.toWorkspaceId,onPaySuccess:()=>{this.sync2UserMaterial()}})}constructor(e,t){this._params=e,this._reportService=t,this.syncingUserMaterial={progress:0},this._mutex=new i.L}}h=(0,a.gn)([(0,a.fM)(1,s.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ISyncFromWorkspaceHelper?Object:ISyncFromWorkspaceHelper,void 0===s.m?Object:s.m])],h)},337171:function(e,t,r){r.d(t,{H:function(){return i}});var a,i=((a={})[a.Insufficient=-2]="Insufficient",a[a.GetDataError=-3]="GetDataError",a[a.FileExtendNotMatch=-4]="FileExtendNotMatch",a)},117557:function(e,t,r){r.d(t,{G:function(){return l}});var a=r(789786),i=r(173888),n=r(230689),o=r(986824),s=r(198414);class l extends o.I{get id(){return this._clonedId}get md5(){return this._cloneTarget.md5}get status(){return this._cloneTarget.status}getModel(){return{...this._cloneTarget.getModel(),id:this.id,addModelToDraft:this._addModelToDraftBinder}}updateToWorkspaceId(e){this._cloneTarget.updateToWorkspaceId(e)}updateToWorkspaceIdAndFolderId(e){this._cloneTarget.updateToWorkspaceIdAndFolderId(e)}canRetryPrepare(){return this._cloneTarget.canRetryPrepare()}prepare(){return this._cloneTarget.prepare()}canRetryUpload(){return this._cloneTarget.canRetryUpload()}upload(){return this._cloneTarget.upload()}canCancelUpload(){return this._cloneTarget.canCancelUpload()}cancelUpload(){var e;(null===(e=this._params.options)||void 0===e?void 0:e.isCancelOriginUpload)?this._cloneTarget.cancelUpload():super.cancelUpload()}canRetryTranscode(){return this._cloneTarget.canRetryTranscode()}transcode(){return this._cloneTarget.transcode()}cancelSync2UserMaterial(){return this._cloneTarget.cancelSync2UserMaterial()}canSync2UserMaterial(){return this._cloneTarget.canSync2UserMaterial()}sync2UserMaterial(){return this._cloneTarget.sync2UserMaterial()}delete(){return super.delete()}_listenOriginEventAndReFire(){var e;let t=["onDidMd5Set","onPrepareStart","onDidPrepare","onPrepareFailure","onUploadStart","onDidUpload","onUploadFailure","onDidCancelUpload","onTranscoding","onDidTranscode","onTranscodeFailure","onSyncing2UserMaterial","onDidSync2UserMaterial","onSync2UserMaterialFailure","onModelUpdate","onResourceReady","onDidUnDone","onDidDone"];for(let a of((null===(e=this._params.options)||void 0===e?void 0:e.isListenOriginDeleted)&&t.push("onDidDelete"),t)){var r=this;this._cloneTarget[a](function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];r[`_${a}`].fire(...t)})}}_listenDidDone(){this._params.lifecycle.onDidDone(()=>{let e=this._cloneFileMaterialLifecycleFromParams();this._cloneTarget=e})}_cloneFileMaterialLifecycleFromParams(){return this._containerService.createInstance(s.E,{data:this._params.lifecycle.getModel(),fromWorkspaceId:this._params.fromWorkspaceId,toWorkspaceId:this._params.toWorkspaceId,addModelToDraft:this._params.addModelToDraft,notificationService:this._params.notificationService})}constructor(e,t){super({fromWorkspaceId:e.lifecycle.fromWorkspaceId,toWorkspaceId:e.lifecycle.toWorkspaceId,addModelToDraft:e.addModelToDraft,fromFolderId:e.lifecycle.fromFolderId,toFolderId:e.lifecycle.toFolderId,notificationService:e.notificationService}),this._params=e,this._containerService=t,this._addModelToDraftBinder=()=>this.addModelToDraft(this),this._clonedId=this._params.lifecycle.id,this._params.lifecycle.status===i.a.Success?this._cloneTarget=this._cloneFileMaterialLifecycleFromParams():(this._cloneTarget=this._params.lifecycle,this._listenDidDone()),this._listenOriginEventAndReFire()}}l=(0,a.gn)([(0,a.fM)(1,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IClonedFileMaterialLifecycle?Object:IClonedFileMaterialLifecycle,void 0===n.t?Object:n.t])],l)},881866:function(e,t,r){function a(){let{searchParams:e}=new URL(window.location.href);return!!e.get("debug")}function i(){let{searchParams:e}=new URL(window.location.href),t=e.get("__keep_uploading__");return a()&&"1"===t}function n(){let{searchParams:e}=new URL(window.location.href),t=e.get("__keep_uploading__");return a()&&"2"===t}function o(){let{searchParams:e}=new URL(window.location.href),t=e.get("__keep_uploading__");return a()&&"3"===t}async function s(){await new Promise(()=>{})}r.d(t,{MI:function(){return i},qk:function(){return n},tF:function(){return o},wO:function(){return s}})},383168:function(e,t,r){r.d(t,{m:function(){return o}});var a=r(641276),i=r(463263),n=r(173888);class o extends i.p{bindListenerWithLifecycle(){(0,a.V)(this.onDidUpload)(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved){if(void 0===this.toWorkspaceId||this.fromWorkspaceId===this.toWorkspaceId){this._updateStatus(n.a.Success);return}this._triggerSyncMaterialFromWorkspaceHelper()}})}),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._updateStatus(n.a.Success)})})}}},19538:function(e,t,r){r.d(t,{x:function(){return c}});var a=r(789786),i=r(273238),n=r(173888),o=r(936243),s=r(986824),l=r(800788);class c extends s.I{onAfterUpdateToWorkspaceId(){if(!this.toWorkspaceId)return}get md5(){return this._data.md5}getModel(){return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidDone:this.onDidDone,onDidRemove:this.onDidRemove,status:this.status}}canRetryPrepare(){(0,l.ss)("unSupport method")}prepare(){(0,l.ss)("unSupport method")}canRetryUpload(){return!1}upload(){(0,l.ss)("unSupport method")}canCancelUpload(){return!1}cancelUpload(){(0,l.ss)("unSupport method")}canRetryTranscode(){return!1}transcode(){(0,l.ss)("unSupport method")}canSync2UserMaterial(){return!1}cancelSync2UserMaterial(){}sync2UserMaterial(){}delete(){(0,l.ss)("unSupport method")}_triggerSyncMaterialFromWorkspaceHelper(){}constructor(e,t,r){super({fromWorkspaceId:void 0,toWorkspaceId:void 0,addModelToDraft:e.addModelToDraft,fromFolderId:void 0,toFolderId:void 0,notificationService:e.notificationService}),this._option=e,this._userMaterialsService=t,this._mainDraftService=r,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let a=this._option;this._data=a.data,this._updateStatus(n.a.Success)}}c=(0,a.gn)([(0,a.fM)(1,i.b),(0,a.fM)(2,o.v),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IPreviewTemplateBuildInMaterialLifecycle?Object:IPreviewTemplateBuildInMaterialLifecycle,void 0===i.b?Object:i.b,void 0===o.v?Object:o.v])],c)},463263:function(e,t,r){r.d(t,{p:function(){return f}});var a=r(789786),i=r(173888),n=r(426020),o=r(230689),s=r(986824),l=r(641276),c=r(690613),d=r(800788),u=r(116528),h=r(860734),p=r(495141),_=r(273238),g=r(903375);class f extends s.I{get md5(){return this._data.md5}canRetryPrepare(){return!1}prepare(){(0,d.ss)("Do not need prepare in upload-material-lifecycle.")}getModel(){var e;return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidDone:this.onDidDone,onDidRemove:this.onDidRemove,status:this.status,uploading:this._uploadMaterialLifecycleHelper.uploading,transcoding:null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.transcoding}}canRetryUpload(){return this._uploadBootstrap(),this._uploadMaterialLifecycleHelper.canRetryUpload()}upload(e){if(!!this.fromWorkspaceId)this._uploadBootstrap(),this._uploadMaterialLifecycleHelper.upload(e)}changeUploadWorkspace(e){if(this._uploadBootstrap(),!(0,g.p)(this))this._updateFromWorkspaceId(e),this._uploadMaterialLifecycleHelper.updateFromWorkspaceId(e)}canCancelUpload(){var e,t;return this._uploadBootstrap(),null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canCancelUpload())&&void 0!==t&&t}cancelUpload(){this._uploadBootstrap(),this._uploadMaterialLifecycleHelper.cancelUpload(),super.cancelUpload()}canRetryTranscode(){var e,t;return null!==(t=null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.canRetryTranscode())&&void 0!==t&&t}transcode(){return(0,d.Y2)(this._transcodeMaterialHelper,"helper not found"),this._transcodeMaterialHelper.transcode()}cancelSync2UserMaterial(){this.status===i.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}sync2UserMaterial(){this._triggerSyncMaterialFromWorkspaceHelper(),(0,d.Y2)(this._syncFromWorkspaceHelper,"helper not found"),this._syncFromWorkspaceHelper.sync2UserMaterial()}async delete(e){try{return!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]}),await super.delete(),(0,c.ly)()}catch(e){var t;return(0,c.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}bindListenerWithLifecycle(){(0,l.V)(this.onDidUpload)(()=>{Promise.resolve().then(()=>{if(this._uploadMaterialLifecycleHelper.dispose(),!this.hasBeenRemoved){if(this._data.fileType===n.YB.Image)this._transcodeMaterialHelper=new u.Y({assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}});else if([n.YB.Audio,n.YB.Video].includes(this._data.fileType))this._transcodeMaterialHelper=new h.D({assetId:this._data.assetId,fileType:this._data.fileType,fromWorkspaceId:this.fromWorkspaceId,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}});else{this._updateStatus(i.a.Transcoded);return}this._updateStatus(i.a.Transcoding),this._transcodeMaterialHelper.listenTranscodeResult()}})}),(0,l.V)(this.onDidTranscode)(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved){if(void 0===this.toWorkspaceId||this.fromWorkspaceId===this.toWorkspaceId){this._updateStatus(i.a.Success);return}this.sync2UserMaterial()}})}),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._updateStatus(i.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){(0,d.ZB)(this.toWorkspaceId),this._syncFromWorkspaceHelper=this._containerService.createInstance(p.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._notificationService})}_partialUpdateModel(e){this._data.key&&delete e.key,Object.assign(this._data,e),this._fireModelUpdate()}_uploadBootstrap(){if(!this._hadUploadBootstrap)this._hadUploadBootstrap=!0,this._uploadMaterialLifecycleHelper.bootstrap({handler:{model:()=>this.getModel(),status:()=>this.status,delete:()=>{this.delete()},onProgress:()=>{this._fireModelUpdate()},onCancelUpload:()=>{this._onDidCancelUpload.fire()},updateStatus:this._updateStatus.bind(this),updateModel:e=>{this._partialUpdateModel(e)}},events:{onSuccess:this.onDidUpload,onError:this.onUploadFailure}})}constructor(e,t,r){super({fromWorkspaceId:e.fromWorkspaceId,toWorkspaceId:e.toWorkspaceId,addModelToDraft:e.addModelToDraft,fromFolderId:e.fromFolderId,toFolderId:e.toFolderId,notificationService:e.notificationService}),this._option=e,this._userMaterialsService=t,this._containerService=r,this._hadUploadBootstrap=!1,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let{data:a,uploadMaterialLifecycleHelper:n,autoUpload:o=!0}=this._option;this._data=a,this._uploadMaterialLifecycleHelper=n,this._updateStatus(i.a.WaitingUpload),o&&this.upload(),this.bindListenerWithLifecycle()}}f=(0,a.gn)([(0,a.fM)(1,_.b),(0,a.fM)(2,o.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUploadMaterialLifecycle?Object:IUploadMaterialLifecycle,void 0===_.b?Object:_.b,void 0===o.t?Object:o.t])],f)},387944:function(e,t,r){r.d(t,{J:function(){return v}});var a=r(789786),i=r(745299),n=r(273238),o=r(225698),s=r(173888),l=r(426020),c=r(230689),d=r(986824),u=r(641276),h=r(690613),p=r(800788),_=r(196392),g=r(483197),f=r(495141),m=r(85539);class v extends d.I{get md5(){return this._data.md5}getModel(){var e,t;return{...this._data,id:this.id,addModelToDraft:this._addModelToDraftBinder,onModelUpdate:this.onModelUpdate,onResourceReady:this.onResourceReady,onDidRemove:this.onDidRemove,onDidDone:this.onDidDone,status:this.status,uploading:this._uploadMaterialLifecycleHelper.uploading,transcoding:null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.transcoding,syncingUserMaterial:null===(t=this._syncFromWorkspaceHelper)||void 0===t?void 0:t.syncingUserMaterial}}canRetryPrepare(){(0,p.ss)("UploadMaterialToPublicSpaceLifecycle::canRetryPrepare")}prepare(){(0,p.ss)("UploadMaterialToPublicSpaceLifecycle::canRetryPrepare")}canRetryUpload(){return this._uploadMaterialLifecycleHelper.canRetryUpload()}upload(){this._uploadMaterialLifecycleHelper.upload()}canCancelUpload(){var e,t;return null!==(t=null===(e=this._uploadMaterialLifecycleHelper)||void 0===e?void 0:e.canCancelUpload())&&void 0!==t&&t}cancelUpload(){this._uploadMaterialLifecycleHelper.cancelUpload(),super.cancelUpload()}canRetryTranscode(){var e,t;return null!==(t=null===(e=this._transcodeMaterialHelper)||void 0===e?void 0:e.canRetryTranscode())&&void 0!==t&&t}transcode(){return(0,p.Y2)(this._transcodeMaterialHelper,"helper not found"),this._transcodeMaterialHelper.transcode()}canSync2UserMaterial(){var e,t;return null!==(t=null===(e=this._syncFromWorkspaceHelper)||void 0===e?void 0:e.canSync2UserMaterial())&&void 0!==t&&t}cancelSync2UserMaterial(){this.status===s.a.Syncing2UserMaterial&&this._updateToWorkspaceId(this.fromWorkspaceId)}sync2UserMaterial(){this._triggerSyncMaterialFromWorkspaceHelper(),(0,p.ZB)(this._syncFromWorkspaceHelper),this._syncFromWorkspaceHelper.sync2UserMaterial()}async delete(e){try{return this._hasBeenSync?((0,p.Y2)(this._data.sourceType===l.ov.EverCloud),!(null==e?void 0:e.onlyDeleteInCache)&&await this._userMaterialsService.deleteMaterials({workspaceId:this.fromWorkspaceId,assetIds:[this._data.assetId]})):[s.a.Uploading,s.a.UploadFailure,s.a.WaitingUpload].includes(this.status)&&this._uploadMaterialLifecycleHelper.cancelUpload(),await super.delete(),(0,h.ly)()}catch(e){var t;return(0,h.wf)(-1,null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"unexpected error")}}bindListenerWithLifecycle(){(0,u.V)(this.onDidUpload)(()=>{var e;if(this._uploadMaterialLifecycleHelper.dispose(),!this.hasBeenRemoved)(0,p.Y2)(this._data.sourceType===l.ov.PublicSpace,"current material is not from publicSpace"),this._transcodeMaterialHelper=new _.L({taskId:this._data.publicSpaceId,fileType:this._data.fileType,userMaterialService:this._userMaterialsService,handler:{status:()=>this.status,onProgress:()=>this._onModelUpdate.fire(this.getModel()),onDidTranscode:this.onDidTranscode,onTranscodeFailure:this.onTranscodeFailure,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e)}}),this._updateStatus(s.a.Transcoding),null===(e=this._transcodeMaterialHelper)||void 0===e||e.listenTranscodeResult()}),(0,u.V)(this.onDidTranscode)(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved){if(this.toWorkspaceId){this._triggerSyncMaterialFromWorkspaceHelper(),this._syncFromWorkspaceHelper.sync2UserMaterial();return}this._updateStatus(s.a.WaitForSync2UserMaterial)}})}),this.onDidSync2UserMaterial(()=>{Promise.resolve().then(()=>{if(!this.hasBeenRemoved)this._hasBeenSync=!0,this._updateFromWorkspaceId(this.toWorkspaceId),this._updateStatus(s.a.Success)})})}_triggerSyncMaterialFromWorkspaceHelper(){(!this._syncFromWorkspaceHelper||this._syncHelperType!==this._data.sourceType)&&(this._syncHelperType=this._data.sourceType,this._data.sourceType===l.ov.PublicSpace?this._syncFromWorkspaceHelper=this._containerService.createInstance(g.B,{vid:this._data.vid,toFolderId:this.toFolderId,toWorkspaceId:this.toWorkspaceId,payinPayoutHelper:this._option.payinPayoutHelper,userMaterialService:this._userMaterialsService,handler:{model:()=>this.getModel(),status:()=>this.status,updateStatus:this._updateStatus.bind(this),updateModel:e=>this._partialUpdateModel(e),onProgress:()=>this._onModelUpdate.fire(this.getModel())}}):this._syncFromWorkspaceHelper=this._containerService.createInstance(f.k,{assetId:this._data.assetId,fromWorkspaceId:this.fromWorkspaceId,toWorkspaceId:this.toWorkspaceId,userMaterialService:this._userMaterialsService,payinPayoutHelper:this._option.payinPayoutHelper,handler:{status:()=>this.status,updateStatus:this._updateStatus.bind(this)},notificationService:this._notificationService}))}_partialUpdateModel(e){this._data.key&&delete e.key,Object.assign(this._data,e),this._fireModelUpdate()}constructor(e,t,r,a,i){super({fromWorkspaceId:void 0,toWorkspaceId:void 0,addModelToDraft:e.addModelToDraft,fromFolderId:e.fromFolderId,toFolderId:void 0,notificationService:e.notificationService}),this._option=e,this._publicSpaceUploadService=t,this._userMaterialsService=r,this._lazyFileMd5CalcService=a,this._containerService=i,this._hasBeenSync=!1,this._addModelToDraftBinder=()=>this.addModelToDraft(this);let n=this._option,{autoUpload:o=!0}=n;this._data=n.data,this._uploadMaterialLifecycleHelper=new m.I({file:e.file,publicSpaceUploadService:this._publicSpaceUploadService,userMaterialService:this._userMaterialsService,fastImportAnalyzeHelper:n.fastImportAnalyzeHelper,fileCalcMd5Service:this._lazyFileMd5CalcService,captureCoverAndThumbHelper:n.captureCoverAndThumbHelper,uploadParams:n.uploadParams,notificationService:e.notificationService}),this._uploadMaterialLifecycleHelper.bootstrap({handler:{model:()=>this.getModel(),status:()=>this.status,delete:()=>{this.delete()},onCancelUpload:()=>{this._onDidCancelUpload.fire()},onProgress:e=>{this._fireModelUpdate()},updateStatus:this._updateStatus.bind(this),updateModel:e=>{this._partialUpdateModel(e)}},events:{onSuccess:this.onDidUpload,onError:this.onUploadFailure}}),this._updateStatus(s.a.WaitingUpload),o&&this._uploadMaterialLifecycleHelper.upload(),this.bindListenerWithLifecycle()}}v=(0,a.gn)([(0,a.fM)(1,i.S),(0,a.fM)(2,n.b),(0,a.fM)(3,o.w),(0,a.fM)(4,c.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUploadMaterialToPublicSpaceLifecycle?Object:IUploadMaterialToPublicSpaceLifecycle,void 0===i.S?Object:i.S,void 0===n.b?Object:n.b,void 0===o.w?Object:o.w,void 0===c.t?Object:c.t])],v)},701004:function(e,t,r){r.d(t,{F:function(){return o}});var a=r(426020),i=r(73435),n=r(180685);function o(e){switch(e.fileType){case a.YB.Video:{let t=(0,i.i)(100,100);return{fileType:a.YB.Video,duration:0,width:0,height:0,isVideoTranscoding:!1,videoTranscodeInfo:{"360p":{url:e.data.url,key:e.data.decryptKey}},cover:t,thumb:(0,n.y)(t)}}case a.YB.Audio:return{fileType:a.YB.Audio,duration:0,isAudioTranscoding:!1,audioTranscodeInfo:{"128kb":{url:e.data.url,key:e.data.decryptKey}}};case a.YB.Image:return{fileType:a.YB.Image,cover:{url:e.data.url,key:e.data.decryptKey,decryptType:e.data.decryptType},width:0,height:0,isImgTranscoding:!1,imgTranscodeInfo:{"360p":{url:e.data.url,key:e.data.decryptKey,decryptType:e.data.decryptType}}};default:return{fileType:a.YB.File,url:e.data.url,decryptKey:e.data.decryptKey}}}},692387:function(e,t,r){r.d(t,{vK:function(){return g},vm:function(){return d}});var a,i,n=r(789786),o=r(966697),s=r(195471),l=r(21078),c=r(293698);var d=((a={})[a.FAIL=0]="FAIL",a[a.SUCCESS=1]="SUCCESS",a);let u="jianying";var h=((i={})[i.VA=`${u}_va`]="VA",i[i.GCP=`${u}_useast2a`]="GCP",i[i.SG=`${u}_sg`]="SG",i);let p={1:h.GCP,0:h.VA,2:h.SG};class _{getFragmentSize(e){if(!e)return 0;let t=e/1024/1024;return t<=200?t/2:t/10}getEventParams(){let{uploadType:e,status:t,fileSize:r,fileExtension:a,scenario:i,featureKey:n,featureEntrance:o,featureEntranceDetail:s,templateId:d}=this._params,h=new URLSearchParams(location.search).get("enter_from")||(0,c.gO)().enter_from;return{upload_type:e,status:t,file_size:r?r/1024:0,slice_count:Math.ceil(this.getFragmentSize(r)),business_name:u,space_name:`${u}_${p[this._accountService.userProfile.idc]}`,file_extension:a,scenario:i,feature_key:n,feature_entrance:o,feature_entrance_detail:s,combine_key:(0,l.B)({scenario:i,feature_key:n,feature_entrance:o,feature_entrance_detail:s,template_id:d||(0,c.gO)().create_id,enter_from:h}),template_id:d||(0,c.gO)().create_id,enter_from:h||""}}constructor(e,t){this._params=e,this._accountService=t,this.eventName="auth_file_upload_status"}}function g(e,t){try{(0,s.K)(e,_,[t])}catch(e){}}_=(0,n.gn)([(0,n.fM)(1,o.Gw),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===o.Gw?Object:o.Gw])],_)},865632:function(e,t,r){r.d(t,{K:function(){return i},b:function(){return n}});var a=r(335290);let i="root_of_draft",n=(0,a.yh)("draft-directory-service")},577397:function(e,t,r){r.d(t,{Y:function(){return l}});var a=r(789786),i=r(865632),n=r(230689),o=r(127830),s=r(358132);class l{get draftMaterialsDirectory(){return this._draftMaterialsDirectory}constructor(e){this._draftMaterialsDirectory=e.createInstance(s.q,{rootId:i.K,rootData:{assetId:i.K,assetType:o.pS.Folder,filename:"\u6839\u76EE\u5F55",childFileNum:0}})}}l=(0,a.gn)([(0,a.fM)(0,n.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.t?Object:n.t])],l)},948328:function(e,t,r){r.d(t,{D:function(){return o},a:function(){return n}});var a,i=r(335290);var n=((a={}).Upload="uploaded",a.Freeze="freeze",a);let o=(0,i.yh)("draft-materials")},136734:function(e,t,r){r.d(t,{e:function(){return u}});var a=r(641276),i=r(587892),n=r(402655),o=r(800788),s=r(173888),l=r(426020),c=r(903375),d=r(677406);class u extends n.JT{get isReady(){return this._isReady}bootstrap(e){let t=[];(null==e?void 0:e.autoMaterials)&&e.autoMaterials.forEach(e=>{var t,r,a;let i=e.getModel();this._addAndBindMaterial(e,"auto"),this.getOrCreateAutoGeneratedMaterialNamespace(null!==(a=null===(r=i.draftDelta)||void 0===r?void 0:null===(t=r.meta)||void 0===t?void 0:t.id)&&void 0!==a?a:d.U).addMaterials([e])}),e.materials.forEach(e=>{var r,a,i,n,o,s;let l=e.getModel();if(!(null===(r=l.draftDelta)||void 0===r?void 0:r.meta)||(null===(i=l.draftDelta)||void 0===i?void 0:null===(a=i.meta)||void 0===a?void 0:a.visible)){this._addAndBindMaterial(e,"user"),t.push(e);return}this._addAndBindMaterial(e,"auto"),this.getOrCreateAutoGeneratedMaterialNamespace(null!==(s=null===(o=l.draftDelta)||void 0===o?void 0:null===(n=o.meta)||void 0===n?void 0:n.id)&&void 0!==s?s:d.U).addMaterials([e])}),t.forEach(e=>{this._referenceData.userGeneratedMaterials.add(e.id)}),this._onDidMaterialAdd.fire(e.materials.map(e=>e.id)),this._isReady=!0,this._onDidReady.fire()}getMaterials(){let e=[],t=[];for(let r of(this._referenceData.userGeneratedMaterials.forEach(t=>{e.push(this._materials.get(t).getModel())}),this._namespaceMap.values()))t.push(...r.getMaterials());return{userGeneratedMaterials:e,autoGeneratedMaterials:t}}getUnUploadedMaterials(){let e=[];for(let t of this._materials.values())!(0,c.p)(t)&&e.push(t.getModel());return e}getMaterialById(e){let t=this._materials.get(e);return(0,o.ZB)(t),t.getModel()}invokeFunctionWithLifeCycleById(e,t){let r=this._materials.get(e);(0,o.ZB)(r),t(r)}invokeFunctionWithLifeCycle(e){for(let t of this._materials.values())e(t)}isMaterialAllDone(){if(!this._isReady)return!1;for(let e of this._getUsedMaterialIds())if(this._materials.get(e).status!==s.a.Success)return!1;return!0}hasMaterialSyncing(){if(!this._isReady)return!1;for(let e of this._getUsedMaterialIds()){let t=this._materials.get(e);if(t.status===s.a.Preparing||t.status===s.a.WaitingUpload||t.status===s.a.Uploading||t.status===s.a.Transcoding||t.status===s.a.WaitForSync2UserMaterial||t.status===s.a.Syncing2UserMaterial)return!0}return!1}getMaterialsByMd5(e){let t=[];for(let r of this._materials.values())r.md5===e&&t.push(r.getModel());return(0,o.Y2)(t.length,`material is not found by md5(${e}), please check`),t}getMaterialsByAssetId(e){for(let t of this._materials.values()){let r=t.getModel();if(r.sourceType===l.ov.EverCloud&&r.assetId===e)return r}(0,o.ss)(`material is not found by assetId(${e}), please check`)}getMaterialByKey(e){for(let t of this._materials.values())if(t.getModel().key===e)return t.getModel();(0,o.ss)("not found resource key")}isMaterialExistByKey(e){for(let t of this._referenceData.userGeneratedMaterials){let r=this._materials.get(t);if((null==r?void 0:r.getModel().key)===e)return!0}for(let t of this._namespaceMap.values())if(t.getMaterials().find(t=>t.key===e))return!0;return!1}isMaterialExistInUserGeneratedByMd5(e){for(let t of this._referenceData.userGeneratedMaterials){let r=this._materials.get(t);if((null==r?void 0:r.md5)===e)return!0}return!1}isMaterialExistInUserGenerated(e){return this._referenceData.userGeneratedMaterials.has(e)}addToUserGenerated(e,t){this._addAndBindMaterial(e,"user"),this._referenceData.userGeneratedMaterials.add(e.id),this._onDidMaterialAdd.fire([e.id],t),e.onDidDelete(()=>{this.removeFromUserGenerated(e.id)}),this._removeWhenDuplicateMd5(e)}removeFromUserGenerated(e){let t=this._materials.get(e);(0,o.Y2)(t,"material not found, could not remove"),this._referenceData.userGeneratedMaterials.delete(e),this._onDidMaterialRemove.fire([t.getModel()]),this._checkAndNotifyMaterialDoneState()}addToAutoGenerated(e){this.getOrCreateAutoGeneratedMaterialNamespace(d.U).addMaterials([e])}batchAddToAutoGenerated(e){this.getOrCreateAutoGeneratedMaterialNamespace(d.U).addMaterials(e)}removeFromAutoGenerated(e){this.getOrCreateAutoGeneratedMaterialNamespace(d.U).removeMaterials([e])}getOrCreateAutoGeneratedMaterialNamespace(e){if(this._namespaceMap.has(e))return this._namespaceMap.get(e);let t=new d.m({namespace:e,handler:{findById:e=>this._materials.get(e).getModel(),add:e=>{this._addAndBindMaterial(e,"auto")},remove:e=>{this._checkAndNotifyMaterialDoneState()},replace:(e,t)=>{this._replaceAndBindMaterial(e,t,"auto")},onDidAdd:e=>{this._onDidMaterialAdd.fire(e)},onDidRemove:e=>{this._onDidMaterialRemove.fire(e)},onDidReplace:(e,t)=>{this._onDidMaterialReplace.fire(e,t)}}});return this._namespaceMap.set(e,t),t}_addAndBindMaterial(e,t){if(this._materials.has(e.id))return;let r=[e.onDidDone,e.onSyncing2UserMaterial].map(e=>e(()=>{this._checkAndNotifyMaterialDoneState()}));(0,a.V)(e.onDidRemove)(()=>{r.forEach(e=>null==e?void 0:e.dispose())}),this._materials.set(e.id,e),e.status===s.a.Success||(this._checkAndNotifyMaterialDoneState(!1),(0,a.V)(e.onDidCancelUpload)(()=>{"user"===t?this.removeFromUserGenerated(e.id):this.removeFromAutoGenerated(e.id)}))}_replaceAndBindMaterial(e,t,r){this._addAndBindMaterial(t,r),this._checkAndNotifyMaterialDoneState()}_checkAndNotifyMaterialDoneState(e){void 0===e&&(e=this.isMaterialAllDone()),this._preNotifyMaterialIsDone!==e&&(this._preNotifyMaterialIsDone=e,this._onMaterialAllDoneChange.fire(this._preNotifyMaterialIsDone))}_getUsedMaterialIds(){let e=new Set;for(let t of(this._referenceData.userGeneratedMaterials.forEach(t=>{e.add(t)}),this._namespaceMap.values()))t.getMaterials().forEach(t=>{e.add(t.id)});return[...e]}_removeWhenDuplicateMd5(e){let t=()=>{let t=[];for(let r of[...this._referenceData.userGeneratedMaterials]){if(r===e.id)continue;let a=this._materials.get(r);(null==a?void 0:a.status)===s.a.Success&&(null==a?void 0:a.md5)===e.md5&&(this.removeFromUserGenerated(r),t.push(this._materials.get(r).getModel()))}this._onMaterialDuplicate.fire(t)};e.status===s.a.Success?t():(0,a.V)(e.onDidDone)(()=>{t()})}constructor(){super(),this._isReady=!1,this._onDidReady=this._store.add(new i.Q),this.onDidReady=this._onDidReady.event,this._namespaceMap=new Map,this._preNotifyMaterialIsDone=!0,this._onMaterialAllDoneChange=this._store.add(new i.Q),this.onMaterialAllDoneChange=this._onMaterialAllDoneChange.event,this._onDidMaterialAdd=this._store.add(new i.Q),this.onDidMaterialAdd=this._onDidMaterialAdd.event,this._onDidMaterialRemove=this._store.add(new i.Q),this.onDidMaterialRemove=this._onDidMaterialRemove.event,this._onMaterialDuplicate=this._store.add(new i.Q),this.onMaterialDuplicate=this._onMaterialDuplicate.event,this._onDidMaterialReplace=this._store.add(new i.Q),this.onDidMaterialReplace=this._onDidMaterialReplace.event,this._materials=new Map,this._referenceData={userGeneratedMaterials:new Set},this.getOrCreateAutoGeneratedMaterialNamespace(d.U)}}},160391:function(e,t,r){r.d(t,{g:function(){return a}});let a=(0,r(335290).yh)("lifecycle")},938918:function(e,t,r){r.d(t,{B:function(){return o},f:function(){return n}});var a,i,n=((a={})[a.Started=1]="Started",a[a.WorkbenchLoaded=2]="WorkbenchLoaded",a[a.DraftLoaded=3]="DraftLoaded",a[a.RendererLoaded=4]="RendererLoaded",a[a.Restored=5]="Restored",a[a.Completed=6]="Completed",a[a.Destroyed=7]="Destroyed",a);var o=((i={})[i.Started=1]="Started",i[i.DraftLoaded=3]="DraftLoaded",i[i.Restored=5]="Restored",i)},851832:function(e,t,r){r.d(t,{p:function(){return T}});var a=r(789786),i=r(260963),n=r(55449),o=r(587892),s=r(402655),l=r(800788),c=r(559203),d=r(97135),u=r(599883),h=r(948328),p=r(426020),_=r(273238),g=r(722169),f=r(666082),m=r(317832),v=r(21961),y=r(622969),S=r(186521),M=r(936243);class T extends s.JT{get isInitialize(){let{workspaceManager:e,workspaceMaterialsManagerMap:t}=this,{currentWorkspaceId:r}=e;return!!(r&&t.get(r))||!1}get workspaceManager(){return this._workspaceManager}get uploadMaterialsManager(){return this._uploadWorkspaceMaterialsManager}get uploadDraftMaterialsManager(){return this._uploadDraftMaterialsManager}get draftMaterialsManager(){return this._draftMaterialsManager}get workspaceMaterialsManagerMap(){return this._workspaceMaterialsManagerMap}get workspaceMaterialsManager(){let{currentWorkspaceId:e}=this._workspaceManager;if(!!e)return this.workspaceMaterialsManagerMap.get(e)}get onRefreshVideosTranscodeUrl(){return this._refreshVideoTranscodeUrlEvent.event}addUploadMaterialLifecycle(e){let{workspaceId:t,material:r,needClone:a,deduplicationStrategy:i,cloneOptions:n}=e;if(t){let o=this._workspaceMaterialsManagerMap.get(t);(0,l.Y2)(o,"not found target manager, please check your logic"),this._uploadWorkspaceMaterialsManager.addMaterialLifecycle({...e,workspaceId:t});let s=this._workspaceDirectoryService.getOrCreateDirectoryManager(t);if(r.fromFolderId){let e=s.getFolderById(r.fromFolderId),t=null==e?void 0:e.path;(0,l.ZB)(t),s.createFileByPath(s.formatPathFromArray([t,r.id]),r,{deduplicationStrategy:null!=i?i:y.c.NotAdd,insertPosition:v.O.Beginning,needClone:a,cloneOptions:n})}else s.createFileByPath(s.formatPathFromArray([s.root.path,r.id]),r,{deduplicationStrategy:null!=i?i:y.c.NotAdd,insertPosition:v.O.Beginning,needClone:a,cloneOptions:n})}else this._uploadDraftMaterialsManager.addMaterialLifecycle({material:e.material}),this._draftMaterialsService.addToUserGenerated(e.material,{addFrom:h.a.Upload})}unshiftMaterialLifecycle(e){(0,l.ZB)(e.fromWorkspaceId);let t=this._workspaceDirectoryService.getOrCreateDirectoryManager(e.fromWorkspaceId);t.createFileByPath(t.formatPathFromArray([t.root.id,e.material.id]),e.material)}getFullMaterialLifecycleModel(e){try{return this._draftMaterialsService.getMaterialById(e)}catch{}for(let t of this._workspaceMaterialsManagerMap.values()){let r=t.findMaterialsById(e);if(r.ok)return r.value}(0,l.ss)("not found target model")}async refreshVideosTranscodeUrl(){let{currentWorkspaceId:e}=this._workspaceManager;if(!e)return;let t=new Map,r=[],a=this._workspaceDirectoryService.getOrCreateDirectoryManager(e);a.syncPreorderTraversal(a.root.id,e=>{e.type===v.t.File&&e.data.getModel().fileType===p.YB.Video&&r.push(e.data.getModel())});let i=this._getUserMaterialInfos(r,"space"),n=i.reduce((e,t)=>{let r=e.get(t.assetId);return r?e.set(t.assetId,r.concat(t)):e.set(t.assetId,[t]),e},new Map),o=async r=>{let a=[];r.forEach(e=>{if(t.has(e)&&n.has(e)){let r=n.get(e);this._updateVideoMaterialTranscodeInfo(r,t.get(e))}else a.push(e)});let i=(0,g.uniq)(a);if(!!i.length)try{let r=await this._userMaterialsService.tryGetMaterialsByIds({assetIds:i,workspaceId:e});if(!r.ok)return;r.value.forEach(e=>{let{assetId:r}=e;t.set(r,e);let a=n.get(r);this._updateVideoMaterialTranscodeInfo(a,e)})}catch(e){}},s=0;for(;20*s<i.length;)await o(i.slice(20*s,(s+1)*20).map(e=>e.assetId)),s++}emitRefreshVideosTranscodeUrlEvent(){this._refreshVideoTranscodeUrlEvent.fire()}_getUserMaterialInfos(e,t){return e.map(e=>({id:e.id,assetId:e.assetId,materialFrom:t}))}_updateVideoMaterialTranscodeInfo(e,t){e.forEach(e=>{let{id:r,materialFrom:a}=e,{videoTranscodeInfo:i}=t;if("space"===a){var n;null===(n=this.workspaceMaterialsManager)||void 0===n||n.invokeMaterialLifecycleById(r,e=>{e.updateVideoTranscodeInfo(i)})}else this._draftMaterialsService.invokeFunctionWithLifeCycleById(r,e=>{e.updateVideoTranscodeInfo(i)})})}_listenWorkspaceIdChangeAndDoInitialize(){(0,i.EH)(()=>{let{currentWorkspaceId:e}=this._workspaceManager;if(!e||this._workspaceMaterialsManagerMap.has(e))return;let t=this._instantiationService.createInstance(f.u,{workspaceId:e,payinPayoutHelper:this._instantiationService.createInstance(this._options.payinPayoutHelperConstructor),directoryManager:this._workspaceDirectoryService.getOrCreateDirectoryManager(e)});this._workspaceMaterialsManagerMap.set(e,t)})}_listenDraftWorkspaceIdChange(){this._mainDraftService.draftWorkspaceManager.onDidWorkspaceChange(()=>{let e=this._mainDraftService.draftWorkspaceManager.workspaceId;e&&!this._workspaceMaterialsManagerMap.get(e)&&this._workspaceMaterialsManagerMap.set(e,this._instantiationService.createInstance(f.u,{workspaceId:e,payinPayoutHelper:this._instantiationService.createInstance(this._options.payinPayoutHelperConstructor),directoryManager:this._workspaceDirectoryService.getOrCreateDirectoryManager(e)}))})}constructor(e,t,r,a,i,n){super(),this._options=e,this._instantiationService=t,this._draftMaterialsService=r,this._mainDraftService=a,this._userMaterialsService=i,this._workspaceDirectoryService=n,this._uploadWorkspaceMaterialsManager=new d.y,this._uploadDraftMaterialsManager=new S.R,this._workspaceMaterialsManagerMap=new Map,this._workspaceManager=this._instantiationService.createInstance(c.S);let s={draftEditorAdapter:this._options.DraftEditorAdapterConstructor?this._instantiationService.createInstance(this._options.DraftEditorAdapterConstructor):void 0};this._draftMaterialsManager=this._instantiationService.createInstance(u.m,s),this._listenWorkspaceIdChangeAndDoInitialize(),this._listenDraftWorkspaceIdChange(),this._refreshVideoTranscodeUrlEvent=new o.Q}}T=(0,a.gn)([(0,a.fM)(1,n.T),(0,a.fM)(2,h.D),(0,a.fM)(3,M.v),(0,a.fM)(4,_.b),(0,a.fM)(5,m.V),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IMediaSiderMenuServiceOptions?Object:IMediaSiderMenuServiceOptions,void 0===n.T?Object:n.T,void 0===h.D?Object:h.D,void 0===M.v?Object:M.v,void 0===_.b?Object:_.b,void 0===m.V?Object:m.V])],T)},908503:function(e,t,r){r.d(t,{M:function(){return a}});function a(e){let{material:t,onUpdateModel:r,onDeleteLifecycle:a,onDidUploadLifecycleDone:i}=e,n=[t.onModelUpdate(()=>{r(t.getModel())}),t.onDidDone(()=>{null==i||i(t.id)})];return a&&n.push(t.onDidCancelUpload(()=>{n.forEach(e=>e.dispose()),a(t.id)}),t.onDidDelete(()=>{n.forEach(e=>e.dispose()),a(t.id)})),n}},735244:function(e,t,r){r.d(t,{B:function(){return o}}),r(784923);var a=r(498417),i=r(801497),n=r(173888);function o(e){if((null==e?void 0:e.status)===n.a.UploadFailure){if(!e.canRetryUpload()){a.Z.error(i.ZP.t("web_graphic_request_failure_tips",{},"Something went wrong. Try again later."));return}e.upload(!0);return}if((null==e?void 0:e.status)===n.a.TranscodeFailure){if(!e.canRetryTranscode()){a.Z.error(i.ZP.t("web_graphic_request_failure_tips",{},"Something went wrong. Try again later."));return}e.transcode();return}if((null==e?void 0:e.status)===n.a.Sync2UserMaterialFailure){if(!e.canSync2UserMaterial()){a.Z.error(i.ZP.t("web_graphic_request_failure_tips",{},"Something went wrong. Try again later."));return}e.sync2UserMaterial();return}}},343107:function(e,t,r){r.d(t,{n:function(){return d}});var a=r(789786),i=r(572029),n=r(358243),o=r(782350),s=r(966697),l=r(622204),c=r(801497);class d extends l.j{fetchData(e){return this._textTemplateDataService.getBrandTextTemplates(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return c.ZP.t("web_space_brandkit_preset_text",{},"Text presets")}constructor(e,t,r,a,i){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;super(a,i,n,o),this._brandDataService=t,this._textTemplateDataService=r,this._workspaceService=a,this._capcutAccountService=i,this.setInitialData(null==o?void 0:o.list,s)}}d=(0,a.gn)([(0,a.fM)(1,i.X),(0,a.fM)(2,n.g),(0,a.fM)(3,o.W),(0,a.fM)(4,s.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===i.X?Object:i.X,void 0===n.g?Object:n.g,void 0===o.W?Object:o.W,void 0===s.Gw?Object:s.Gw])],d)},290237:function(e,t,r){r.d(t,{g:function(){return u}});var a=r(789786),i=r(430687),n=r(572029),o=r(782350),s=r(966697),l=r(801497),c=r(622204),d=r(752048);class u extends c.j{fetchData(e){return this._videoDataService.getBrandVideos(e)}updateBrandResource(e){return this._brandDataService.updateBrandResource(e)}deleteBrandResource(e){return this._brandDataService.deleteBrandResource(e)}get titleText(){return l.ZP.t("web_space_brandkit_editor_brand_video",{},"Videos")}constructor(e,t,r,a,i){let{managerConfig:n,preloadData:o,shouldPaginate:s}=e;(null==o?void 0:o.list)&&(o.list=(0,d.B)(o.list)),super(a,i,n,o),this._videoDataService=t,this._brandDataService=r,this._workspaceService=a,this._capcutAccountService=i,this.setInitialData(null==o?void 0:o.list,s)}}u=(0,a.gn)([(0,a.fM)(1,i.u),(0,a.fM)(2,n.X),(0,a.fM)(3,o.W),(0,a.fM)(4,s.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IUserBrandManagerOptions?Object:IUserBrandManagerOptions,void 0===i.u?Object:i.u,void 0===n.X?Object:n.X,void 0===o.W?Object:o.W,void 0===s.Gw?Object:s.Gw])],u)},795772:function(e,t,r){r.d(t,{C:function(){return a}});let a=(0,r(335290).yh)("user-brand")},589140:function(e,t,r){r.d(t,{N3:function(){return i},NZ:function(){return a},VY:function(){return n},it:function(){return o},mx:function(){return s}});let a=21001,i=0x4000016,n="709",o="348188",s="36ab246bababe651ca877ddabc929e61"},437354:function(e,t,r){r.d(t,{O:function(){return u}});var a=r(789786),i=r(402655),n=r(800788),o=r(426020),s=r(782350),l=r(230689),c=r(127830),d=r(795636);class u extends i.JT{getOrCreateDirectoryManager(e){var t;(0,n.ZB)(null===(t=this._workspaceService)||void 0===t?void 0:t.workspaceList);let r=this._workspaceService.workspaceList.some(t=>t.workspace_id===e);return((0,n.Y2)(r,`workspaceid ${e} is invalid.`),this._directoryManagerOfWorkspaceMap.has(e))?this._directoryManagerOfWorkspaceMap.get(e):(this._directoryManagerOfWorkspaceMap.set(e,this._containerService.createInstance(d.g,{rootId:o.ZF,rootData:{assetId:o.ZF,assetType:c.pS.Folder,filename:"\u6839\u76EE\u5F55",childFileNum:0},workspaceId:e,options:{payinPayoutHelper:this._options.payinPayoutHelperConstructor?this._containerService.createInstance(this._options.payinPayoutHelperConstructor):void 0}})),this._directoryManagerOfWorkspaceMap.get(e))}constructor(e,t,r){super(),this._options=e,this._workspaceService=t,this._containerService=r,this._directoryManagerOfWorkspaceMap=new Map}}u=(0,a.gn)([(0,a.fM)(1,s.W),(0,a.fM)(2,l.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IWorkspaceDirectoryServiceOptions?Object:IWorkspaceDirectoryServiceOptions,void 0===s.W?Object:s.W,void 0===l.t?Object:l.t])],u)},671910:function(e,t,r){r.d(t,{C8:function(){return u},DQ:function(){return s},GQ:function(){return A},Id:function(){return v},Ie:function(){return c},Oj:function(){return I},P4:function(){return p},Qg:function(){return T},TU:function(){return E},V9:function(){return d},X5:function(){return y},Xu:function(){return _},db:function(){return M},dv:function(){return h},hd:function(){return l},iM:function(){return S},nC:function(){return R},oH:function(){return b},rU:function(){return k},v8:function(){return g}});var a,i,n=r(127830),o=r(801497);let s="material_user_brand",l=200,c=1500,d=8,u=15,h=22,p=12,_=50,g={height:67.5,width:120},f={width:120,height:67.5,aspectRatio:120/67.5},m={width:120,height:120,aspectRatio:1},v={[n._g.VideoBackground]:f,[n._g.Sticker]:f,[n._g.TextPreset]:m,[n._g.Photo]:f,[n._g.Video]:f,[n._g.Audio]:{width:120,height:67.5,aspectRatio:1},[n._g.AdjustmentPreset]:{width:70,height:70,aspectRatio:1},[n._g.TextTemplate]:m},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams(t);return e?`/my-cloud/${e}/brand-library?${r.toString()}`:`/my-cloud?${r.toString()}`},S=e=>!!e&&e>=p,M=e=>{var t,r,a;return null!==(a=null!==(r=null!==(t=null==e?void 0:e.title)&&void 0!==t?t:null==e?void 0:e.name)&&void 0!==r?r:null==e?void 0:e.key)&&void 0!==a?a:""},T=e=>{var t,r,a;let i=null!==(a=null!==(r=null!==(t=null==e?void 0:e.title)&&void 0!==t?t:null==e?void 0:e.name)&&void 0!==r?r:null==e?void 0:e.key)&&void 0!==a?a:"",n=i.lastIndexOf(".");return n>-1?i.substring(n):""},b=e=>{let t=M(e),r=t.lastIndexOf(".");return r>-1?t.substring(0,r):t};var k=((a={})[a.NO_SUPPORT_FROM_PC=0]="NO_SUPPORT_FROM_PC",a[a.NO_SUPPORT_FROM_APP=1]="NO_SUPPORT_FROM_APP",a[a.NO_SUPPORT_FROM_VIDEO=2]="NO_SUPPORT_FROM_VIDEO",a[a.NO_SUPPORT_FROM_GRAPHIC=3]="NO_SUPPORT_FROM_GRAPHIC",a[a.NO_SUPPORT_GIF=4]="NO_SUPPORT_GIF",a[a.NO_SUPPORT_COMMON=5]="NO_SUPPORT_COMMON",a);let w=null,I=e=>w?w[e]:(w={0:o.ZP.t("web_brandkit_editor_toast_web_unsupported",{},"This preset contains effects from CapCut Desktop and is currently unavailable in CapCut Online"),1:o.ZP.t("web_space_brandkit_app_preset_contains",{},"This preset is currently unavailable in CapCut Online"),3:o.ZP.t("web_space_brandkit_web_preset_video_editor",{},"This preset contains effects from the image editor and is currently unavailable in the video editor"),2:o.ZP.t("web_space_brandkit_web_preset_editor",{},"This preset contains effects from the video editor and is currently unavailable in the image editor"),4:o.ZP.t("web_brandkit_imageeditor_hover_gif_unavailable",{},"Can\u2019t add a GIF sticker in the image editor"),5:o.ZP.t("web_brandkit_multitracks_text_preset_unavailable",{},"This preset is unavailable in the editor")})[e];var E=((i={})[i.DEL_SUCCESS=0]="DEL_SUCCESS",i[i.DEL_FAIL=1]="DEL_FAIL",i[i.RENAME_FAIL=2]="RENAME_FAIL",i[i.RENAME_SENSITIVE_WORD=3]="RENAME_SENSITIVE_WORD",i[i.RENAME_DUPLICATE=4]="RENAME_DUPLICATE",i);let P={2504:2,2334:3,2505:1,2506:1,2509:4},D=null,A=e=>D?D[e]:(D={0:o.ZP.t("web_brandkit_toast_asset_deleted",{},"Deleted"),1:o.ZP.t("web_brandkit_toast_asset_delete_failed",{},"Couldn't delete"),2:o.ZP.t("web_brandkit_errormessage_rename_failed",{},"Couldn\u2019t rename"),3:o.ZP.t("web_brandkit_errormessage_sensitive_words_found",{},"The name may contain words that violate our Community Guidelines."),4:o.ZP.t("web_brand_name_save_failed",{},"The name is duplicate, please try others.")})[e],C="Error",R=e=>{if(void 0===e)return C;let t=P[e.toString(10)];return t?A(t):C}},70031:function(e,t,r){r.d(t,{Je:function(){return S},MY:function(){return g},Mm:function(){return l},hU:function(){return u},mY:function(){return p},mq:function(){return c},qA:function(){return y}});var a,i,n,o=r(772322),s=r(801497);var l=((a={}).SYNC="SYNC",a.UPLOAD="UPLOAD",a.SYNC_TEMPLATE="SYNC_TEMPLATE",a.SELECTED_SPACE_UPLOAD="SELECTED_SPACE_UPLOAD",a.UPGRADE="UPGRADE",a.AUTO_SAVE="AUTO_SAVE",a.SAVE="SAVE",a.EXPORT="EXPORT",a.MOVE_SPACE_MODAL="MOVE_SPACE_MODAL",a);var c=((i={}).UPGRADE="UPGRADE",i.FREE_UP="FREE_UP",i.EXPAND="EXPAND",i.CHANGE_LOCATION="CHANGE_LOCATION",i.TRY_AGAIN="TRY_AGAIN",i.OK="OK",i);let d={UPGRADE:()=>s.ZP.t("web_livestudio_button_upgraded",{},"Upgrade"),FREE_UP:()=>s.ZP.t("web_livestudio_button_abandon_project",{},"Free up"),EXPAND:()=>s.ZP.t("to_expand_space",{},"Expand"),CHANGE_LOCATION:()=>s.ZP.t("editor_save_storageerror_change",{},"Change storage location"),TRY_AGAIN:()=>s.ZP.t("retry_web",{},"Try again"),OK:()=>s.ZP.t("ok_we_b",{},"OK")};var u=((n={}).FREE_UP="FREE_UP",n.CANCEL="CANCEL",n.ABANDON_PROJECT="ABANDON_PROJECT",n);let h={FREE_UP:()=>s.ZP.t("web_livestudio_button_abandon_project",{},"Free up"),ABANDON_PROJECT:()=>s.ZP.t("abandon_draft",{},"Abandon project"),CANCEL:()=>s.ZP.t("web_livestudio_button_cancelled",{},"Cancel")},p=e=>{let{payScene:t,isSpaceRoleSupportPay:r,isSupportMultiWorkSpace:a,workspaceList:i,isSupportPay:n}=e;return n&&r&&"SELECTED_SPACE_UPLOAD"===t?"UPGRADE":n&&r||"SELECTED_SPACE_UPLOAD"!==t?n&&r?"EXPAND":!n&&r&&i.length>1&&a&&"SYNC"!==t||!r&&a?"CHANGE_LOCATION":"SYNC"===t||"SYNC_TEMPLATE"===t?"TRY_AGAIN":"OK":"FREE_UP"},_=e=>d[p(e)](),g=e=>{let{payScene:t,isSpaceRoleSupportPay:r,isSupportPay:a}=e;return a&&r&&"SELECTED_SPACE_UPLOAD"===t?"FREE_UP":"SELECTED_SPACE_UPLOAD"===t?"CANCEL":"SYNC"===t?"ABANDON_PROJECT":"CANCEL"},f=e=>h[g(e)](),m=e=>{let{payScene:t,isSpaceRoleSupportPay:r,activateWorkspaceInfo:a,isSupportMultiWorkSpace:i,workspaceList:n,isSupportPay:l}=e;return l&&r&&"SELECTED_SPACE_UPLOAD"===t?s.ZP.t("web_livestudio_text_no_space_update",{placeholder0:null==a?void 0:a.name,"color-strong0":e=>(0,o.jsx)("b",{children:e})},"Your space <color-strong0>{placeholder0}</color-strong0> doesn\u2019t have enough storage left. You can upgrade your space, or free up storage."):"SELECTED_SPACE_UPLOAD"===t?s.ZP.t("web_livestudio_text_no_space_clean",{placeholder0:null==a?void 0:a.name,"color-strong0":e=>(0,o.jsx)("b",{children:e})},"Your space <color-strong0>{placeholder0}</color-strong0> doesn\u2019t have enough storage left. You can delete some files to free up storage."):l&&r&&"AUTO_SAVE"===t?s.ZP.t("web_expansion_text_upgrade_storage",{},"Your space storage is almost full. Upgrade your space and try again."):l&&r?s.ZP.t("delete_or_enlarge",{},"Your cloud space has reached the storage limit. You can delete some of your cloud files or expand your cloud storage."):!l&&r&&n.length>1&&i||!r&&i?s.ZP.t("editor_save_storageerror_desc1",{placeholder1:null==a?void 0:a.name},`The storage for "${null==a?void 0:a.name}" is running low, please expand the space. You can also change the storage location, or clean up the file and try again.`):"EXPORT"===t?s.ZP.t("export_failed_cloud_spac_reached",{},"The space has reached the storage limit. Delete some files and try again."):s.ZP.t("cloud_web_space_web_limited",{},"Cloud Space has reached its limit. Web doesn't support purchasing more Cloud Space at the moment.")},v=e=>{let{payScene:t,isSupportPay:r}=e;return"SELECTED_SPACE_UPLOAD"===t?s.ZP.t("web_livestudio_title_can_not_save",{},"Couldn\u2019t save project"):"AUTO_SAVE"===t?s.ZP.t("web_expansion_title_can_not_save",{},"Couldn\u2019t save project"):r?s.ZP.t("couldnot_save",{},"Couldn\u2019t save"):s.ZP.t("cannot_web_save_web_peoject",{},"Couldn't save project")},y=(e,t,r,a,i)=>{let{payScene:n}=e,o="auto_save_fail";switch(n){case"AUTO_SAVE":o="auto_save_fail";break;case"SYNC":o="sync_fail";break;case"UPLOAD":case"SELECTED_SPACE_UPLOAD":o="upload_fail";break;case"EXPORT":o="export_fail";break;case"SYNC_TEMPLATE":o="sync_template_fail";break;case"MOVE_SPACE_MODAL":o="change_dictionary_window"}return{enterFrom:o,currentPage:t,pageFrom:r,pageFromExtra:a,reportVipInfo:i}},S=e=>({okText:_(e),cancelText:f(e),content:m(e),title:v(e)})},670863:function(e,t,r){r.d(t,{u:function(){return o}});var a=r(789786),i=r(31463),n=r(50712);class o{async generateFirstFrameUrl(){return this._renderManager.isFirstFrameRender?await this._generateFirstFrame():""}cancelFirstFrameTask(){var e;null===(e=this._disposer)||void 0===e||e.dispose(),this._renderManager.cancelGetVideoFrames(this._currentTaskId),clearTimeout(this._timeout)}async _generateFirstFrame(){let e=await new Promise(e=>{let t=Date.now();this._currentTaskId=this._renderManager.getVideoFrames([{time:0n,callbackData:0}],this._width,this._height),this._disposer=this._renderManager.onGetFrames(r=>{if(this._reportService.reportDevEvent("ve_draw_first_frame",{duration:Date.now()-t,status:"start",isMatchTask:r.taskId===this._currentTaskId?1:0}),r.taskId===this._currentTaskId){let a=document.createElement("canvas");a.width=this._width,a.height=this._height;let i=a.getContext("2d"),n=new ImageData(r.imageData,r.width,r.height);i.putImageData(n,0,0),a.toBlob(a=>{try{let i=URL.createObjectURL(a);i?(this._reportService.reportDevEvent("ve_draw_first_frame",{duration:Date.now()-t,status:"success"}),e(i)):(this._reportService.reportDevEvent("ve_draw_first_frame",{duration:Date.now()-t,status:"fail",failReason:"ve draw first frame blobUrl is empty",hasFrameData:r.imageData?1:0}),e(""))}catch(r){this._reportService.reportDevError("ve_draw_first_frame_error",r),this._reportService.reportDevEvent("ve_draw_first_frame",{duration:Date.now()-t,status:"fail",failReason:r.message}),e("")}finally{this.cancelFirstFrameTask()}})}}),this._timeout=setTimeout(()=>{this._reportService.reportDevEvent("ve_draw_first_frame",{duration:Date.now()-t,status:"fail",failReason:"ve draw first frame timeout"}),this.cancelFirstFrameTask();let r=Error("ve draw first frame timeout");this._reportService.reportDevError("ve_draw_first_frame_error",r),e("")},6e4)});return e?await (0,n.u)({url:e,width:this._width,height:this._height}):""}constructor(e,t,r,a){this._renderManager=r,this._reportService=a,this._currentTaskId="",this._disposer=null;let{width:i,height:n}=e.draftView.getCanvasConfig();i>n?(this._width=t/n*i,this._height=t):(this._width=t,this._height=t/i*n)}}o=(0,a.gn)([(0,a.fM)(3,i.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Number,"undefined"==typeof RenderManager?Object:RenderManager,void 0===i.m?Object:i.m])],o)},300387:function(e,t,r){r.d(t,{t:function(){return s}});var a=r(273340),i=r(249656),n=r(426336);let o={third_resource_tuchong_deposit:i.n9.MaterialPlatformTuchongDeposit,third_resource_tuchong_adobe:i.n9.MaterialPlatformTuchongAdobe,third_resource_tuchong_pond5:i.n9.MaterialPlatformTuchongPond5},s={toHeycanEffectType:function(e){switch(e){case n.cVg.MetaTypeTextEffect:return a.g.WordArt;case n.cVg.MetaTypeSticker:return a.g.Sticker;case n.cVg.MetaTypeSound:return a.g.AudioEffect;case n.cVg.MetaTypeMusic:return a.g.Song;case n.cVg.MetaTypeVideo:return a.g.Video;case n.cVg.MetaTypeTextTemplate:return a.g.TextTemplate;case n.cVg.MetaTypeVideoEffect:return a.g.SpecialEffect;case n.cVg.MetaTypeFaceEffect:return a.g.FaceTool;case n.cVg.MetaTypePhoto:return a.g.Image;case n.cVg.MetaTypeFilter:return a.g.Filter;default:throw Error(`unknown meta type ${e}`)}},toMetaType:function(e){switch(e){case a.g.WordArt:return n.cVg.MetaTypeTextEffect;case a.g.Sticker:return n.cVg.MetaTypeSticker;case a.g.AudioEffect:return n.cVg.MetaTypeSound;case a.g.Song:return n.cVg.MetaTypeMusic;case a.g.Video:return n.cVg.MetaTypeVideo;case a.g.TextTemplate:return n.cVg.MetaTypeTextTemplate;case a.g.SpecialEffect:return n.cVg.MetaTypeVideoEffect;case a.g.FaceTool:return n.cVg.MetaTypeFaceEffect;case a.g.Image:return n.cVg.MetaTypePhoto;case a.g.Filter:return n.cVg.MetaTypeFilter;default:return n.cVg.MetaTypeNone}},toSourcePlatform:(e,t)=>{let r;switch(e){case i.Hw.HEYCAN:return n.nj7.EffectPlatformArtist;case i.Hw.LOKI:return n.nj7.EffectPlatformLoki;case i.Hw.MUSIC:return n.QZ3.AudioPlatformLibrary;case i.Hw.TUCHONG:if(r=t&&o[t])return r;case i.Hw.BRAND:return n.cvu.MaterialPlatformBrand;default:return n.nj7.EffectPlatformArtist}},formatEffectSourcePlatform:e=>{switch(e){case i.Hw.HEYCAN:return n.nj7.EffectPlatformArtist;case i.Hw.BRAND:return n.nj7.EffectPlatformBrand;case i.Hw.LOKI:default:return n.nj7.EffectPlatformLoki}}}},137309:function(e,t,r){r.d(t,{o:function(){return i}});var a=r(426336);async function i(e,t){let{resourceRecords:r}=t,i=new Set([a.pNd.TrackTypeSticker,a.pNd.TrackTypeText,a.pNd.TrackTypeVideoEffect,a.pNd.TrackTypeFilter,a.pNd.TrackTypeAdjust,a.pNd.TrackTypeTextToVideoText,a.pNd.TrackTypePluginEffect]),n=[];e.draftView.getTracksByTypes(Object.values(a.pNd).filter(e=>!i.has(e))).forEach(e=>{e.segments.forEach(e=>{((0,a.hey)(e)&&e.voiceChange||(0,a.Y9Q)(e)&&e.voiceChange)&&e.voiceChange.forEach(a=>{let i=r.pathRecords.get(a.path);if(t.fs.isDir(i)){let a=t.getAudioPathAndSourceTimeRange(e),o=t.prepareAudioSample2(r.pathRecords.get(a.path),i,a.sourceTimeRange.start,a.sourceTimeRange.start+a.sourceTimeRange.duration,r.decryptRecords.get(r.pathRecords.get(a.path)));o&&n.push(o)}})})}),await Promise.all(n)}},236926:function(e,t,r){r.d(t,{O:function(){return c},T:function(){return u}});var a=r(789786),i=r(31463),n=r(853315),o=r(690613),s=r(722169);class l{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="editor_layer_render"}}function c(e,t){(0,n.K)(e,l,[t],{important:!0})}class d{getEventParams(){let{stage:e,error:t}=this._params,r=(0,s.omit)(this._params,"error");if(r.errorMessage="missing error instance",r.errorCause="missing error instance",t){this._reportService.reportDevError("editor_layer_render_fail",t,{msg:e});let a=(0,o.oi)(t)?t.cause:t;r.errorMessage=`${null==a?void 0:a.name}-${null==a?void 0:a.message}`,r.errorCause=a instanceof Error?`${null==a?void 0:a.name}-${a.cause}`:"missing error cause"}return r}constructor(e,t){this._params=e,this._reportService=t,this.eventName="editor_layer_render_fail"}}function u(e,t){(0,n.K)(e,d,[t],{important:!0})}d=(0,a.gn)([(0,a.fM)(1,i.m),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IEditorLayerRenderFailParams?Object:IEditorLayerRenderFailParams,void 0===i.m?Object:i.m])],d)},966614:function(e,t,r){r.d(t,{X:function(){return i}});var a,i=((a={})[a.None=0]="None",a[a.Local=1]="Local",a[a.Online=2]="Online",a[a.Transcoding=3]="Transcoding",a[a.Downloading=4]="Downloading",a[a.Preparing=5]="Preparing",a[a.Pending=6]="Pending",a[a.Uploading=7]="Uploading",a[a.TranscodeFailed=8]="TranscodeFailed",a[a.DownloadFailed=9]="DownloadFailed",a[a.UploadFailed=10]="UploadFailed",a[a.LoginSyncing=11]="LoginSyncing",a[a.LoginSyncFailed=12]="LoginSyncFailed",a[a.LoginSynced=13]="LoginSynced",a[a.NoTranscodeInformation=14]="NoTranscodeInformation",a[a.TranscodeNotSupported=15]="TranscodeNotSupported",a)},642379:function(e,t,r){r.d(t,{Z:()=>u});var a=r("772322"),i=r("827322"),n=r("598321"),o=r("248552"),s=r("359281");let l="icon-GgMZ1G";var c=r("105789"),d=r.n(c);function u(e){let{className:t,style:r}=e;return(0,n.i)()?(0,a.jsx)(o.Tu,{type:"entrance",className:t}):(0,a.jsx)("img",{src:(0,i.C)(s,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),alt:"",className:d()(l,t),style:r})}},509330:function(e,t,r){r.d(t,{g:function(){return i}});var a=r(836946);function i(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{width:e.width,height:e.height},i=[r.width/2,r.height/2],n=(0,a.qH)([0,r.height],t,i),o=(0,a.qH)([r.width,r.height],t,i),s=(0,a.qH)([0,0],t,i),l=(0,a.qH)([r.width,0],t,i),c=[e.left,r.height-e.top],d=[e.left,r.height-e.top-e.height],u=[e.left+e.width,r.height-e.top],h=[e.left+e.width,r.height-e.top-e.height],p=function(e,t,r){let i=t.map(t=>(0,a.Ii)(e[0],t)),n=t.map(t=>(0,a.Ii)(e[1],t)),o=t.map(t=>(0,a.Ii)(e[2],t)),s=[i,n,o,t.map(t=>(0,a.Ii)(e[3],t))],l=s.map(e=>e[0]),c=s.map(e=>e[1]),d=s.map(e=>e[2]),u=s.map(e=>e[3]),h=t.map(e=>!(0,a.A2)(r,e)),p=t.map(t=>(0,a.Io)(e[0],e[2],t)),_={};return h[0]&&(_.tl={d:Math.min(...p[0]?[l[0],l[2]]:[l[1],l[3]]),target:p[0]?"height":"width"}),h[1]&&(_.tr={d:Math.min(...p[1]?[c[0],c[2]]:[c[1],c[3]]),target:p[1]?"height":"width"}),h[2]&&(_.br={d:Math.min(...p[2]?[d[0],d[2]]:[d[1],d[3]]),target:p[2]?"height":"width"}),h[3]&&(_.bl={d:Math.min(...p[3]?[u[0],u[2]]:[u[1],u[3]]),target:p[3]?"height":"width"}),_}([{begin:n,end:o},{begin:o,end:l},{begin:s,end:l},{begin:n,end:s}],[c,u,h,d],[n,o,l,s]),_=[p.tl,p.tr,p.bl,p.br],g=2*_.reduce((e,t)=>t&&"height"===t.target&&t.d>e?t.d:e,0),f=2*_.reduce((e,t)=>t&&"width"===t.target&&t.d>e?t.d:e,0),m=(g+r.height)/r.height;return Math.max(m,(f+r.width)/r.width)}},736055:function(e,t,r){r.d(t,{L:()=>v});var a=r("772322");r("966156"),r("225572");var i=r("368100"),n=r("97257"),o=r("488935"),s=r("831998"),l=r("537783"),c=r("801497"),d=r("218571"),u=r("134392"),h=r("795910"),p=r("937802"),_=r("230689");let g=(e,t)=>"reverse"===e?`${c.oc.t("reverse_web",{},"\u89C6\u9891\u5012\u653E")}...${t}%`:"reversePrepare"===e?`${c.oc.t("web_rewind_pre_processing",{},"Rewind is in pre-processing...")}...`:"mattingPrepare"===e?`${c.oc.t("web_pre_processing",{},"Keying is in pre-processing...")}...`:"videoTracking"===e?`${c.oc.t("web_elements_text_tracking",{number0:t},"Tracking")}`:"smartSplit"===e?`${c.oc.t("web_track_text_loading",{},"Splitting scene")}...${t}%`:"smartSplitPrepare"===e?`${c.oc.t("web_track_loading_transcoding",{},"Transcoding...")}...`:"objectLock"===e?`${c.oc.t("web_camera_tracking_applying_progress",{number0:t},"Apply camera tracking... {number0}%")}`:`${c.oc.t("web_edit_keying_process",{},"\u62A0\u50CF\u4E2D")}...${t}%`,f=e=>"matting"===e?c.oc.t("web_confirm_stop_keying",{},"\u786E\u5B9A\u505C\u6B62\u62A0\u50CF"):null,m=e=>"matting"===e?c.oc.t("web_keying_in_progress_stopping_the_keying_undo_the_keying_effect",{},"\u6B63\u5728\u62A0\u50CF\u4E2D\uFF0C\u505C\u6B62\u62A0\u50CF\u5C06\u64A4\u9500\u62A0\u50CF\u6548\u679C"):null,v=e=>{let{visible:t,progress:r,cancelIntelligent:c,type:v}=e,{i18n:y}=(0,l.$)(),[S]=(0,s.F)(),M=(0,p.G)(_.t),T=(0,p.G)(u.d),b="dark"===S?o.l:o.S,[k,w]=(0,d.useState)(!1),I=()=>{"matting"===v?w(!0):c(),"matting"===v&&(0,h.r)(M,{action:"show"})};return(0,d.useEffect)(()=>(t?T.disableKeybinding():T.restoreKeybinding(),()=>{T.restoreKeybinding()}),[t]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.Z,{className:"matting-loading-modal",visible:t,onCancel:()=>{I()},maskClosable:!1,autoFocus:!0,focusLock:!0,children:[(0,a.jsx)(b,{suffixDot:!1,title:g(v,r)}),(0,a.jsx)(n.Z,{onClick:()=>{I()},children:y.t("cancel_web",{},"\u53D6\u6D88")})]}),(0,a.jsx)(i.Z,{simple:!0,maskClosable:!1,visible:k,cancelText:y.t("cancel_web",{},"\u53D6\u6D88"),onCancel:()=>{w(!1),"matting"===v&&(0,h.r)(M,{action:"cancel"})},okText:y.t("confirm_ok",{},"\u786E\u5B9A"),onOk:()=>{w(!1),c(),"matting"===v&&(0,h.r)(M,{action:"confirm"})},title:f(v),children:m(v)})]})}},21185:function(e,t,r){r.d(t,{Z:function(){return v}});var a=r(772322),i=r(953032),n=r(218571),o=r(690674),s=r(857670),l=r(426336),c=r(892230),d=r(168370),u=r(105789),h=r.n(u),p=r(502237),_=r(378440),g=r(670933),f=r(387666),m=r(832905);let v=(0,g.f3)("store","modules")((0,g.Pi)(e=>{let{store:t,modules:r,hidden:u,className:g,type:v="default",...y}=e,{[o.U_]:S}=t,M=(0,m.q)({dataSdk:r.dataSdk}),{player:T}=r,b=(0,n.useRef)(!1),{tracks:k,progress:w,duration:I,tracksMutable:E,trackStartTime:P,isTemplate:D}=S,A="slots"===v,[C,R]=(0,n.useState)(),x=null!=C?C:Math.min(100,100*l.pMA.div(w,I,"number")).toFixed(2),O=(0,n.useRef)(null),F=(0,n.useMemo)(()=>{var e,t;return(null==k?void 0:k.length)===1&&(null==k?void 0:null===(t=k[0])||void 0===t?void 0:null===(e=t[0].segments)||void 0===e?void 0:e.length)===0},[k]),N=(0,n.useMemo)(()=>{var e,t,r;return D&&A?(null!==(r=null===(t=E[0])||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.segments)&&void 0!==r?r:[]).reduce((e,t,r)=>0===r?e:(e.push(l.pMA.div(l.pMA.plus(t.start,P,"bigint"),I)),e),[]):[]},[D,A,I,E,P]),V=(0,n.useCallback)((e,t)=>e,[]),L=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=l.pMA.times(I,e,"bigint"),a=(0,s.i1)(r);T.timelineSeek(a,t)},[T,I]),j=(0,n.useRef)(),U=(0,n.useCallback)(e=>{var r,a;if(e.preventDefault(),!O.current)return;b.current=t[o.VT].unionPlaying;let i=null===(r=(a=O.current).getBoundingClientRect)||void 0===r?void 0:r.call(a),n=e.clientX-i.left,s=V(c.Xb.div(n,O.current.clientWidth),O.current.clientWidth);L(s),j.current=n,R(c.Xb.mul(s,100))},[t,V,L]),{run:B}=(0,i.default)(e=>{let{x:t}=e;if(!O.current||void 0===j.current)return;b.current=!1;let r=c.Xb.div(c.Xb.add(j.current,t),O.current.clientWidth);L(r=V(Math.min(Math.max(r,0),1),O.current.clientWidth)),R(c.Xb.mul(r,100))},16),W=(0,n.useCallback)(()=>{j.current=void 0,R(e=>{void 0!==e&&L(c.Xb.div(e,100),b.current)})},[L]);return(0,d.c)({enable:M,refs:[O],onStart:U,onDrag:B,onEnd:W}),(0,a.jsx)("div",{className:h()(f.Z.timelineCollapse,g,f.Z[`timeline-collapse--${v}`],{[f.Z["timeline-collapse--hidden"]]:u,[f.Z["timeline-collapse--disabled"]]:!M}),...y,children:(0,a.jsx)("div",{className:f.Z.timelineCollapseContainer,ref:O,children:(0,a.jsxs)("div",{className:f.Z.timelineCollapsePlayground,children:[(0,a.jsx)("div",{className:f.Z.timelineCollapsePlayBar,style:{width:`${M?x:0}%`},children:(0,a.jsx)("div",{className:f.Z.timelineCollapsePlayBarArrow,style:{visibility:F?"hidden":"visible"},children:"slots"===v?(0,a.jsx)(_.r,{}):(0,a.jsx)(p.J,{dragging:void 0!==C})})}),!!N.length&&(0,a.jsx)("div",{className:f.Z.timelineCollapsePlayAxises,children:N.map(e=>(0,a.jsx)("div",{className:f.Z.timelineCollapsePlayAxis,style:{left:`${100*e}%`}},e))})]})})})}))},119946:function(e,t,r){r.d(t,{FN:function(){return n},jg:function(){return o}});var a=r(306909);let i="sider-attribute",n={normal:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.Z.normal(e,{...t,getContainer:()=>document.getElementById(i)})},success:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.Z.success(e,{...t,getContainer:()=>document.getElementById(i)})},error:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.Z.error(e,{...t,getContainer:()=>document.getElementById(i)})},warning:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.Z.warning(e,{...t,getContainer:()=>document.getElementById(i)})}},o=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return t?`rgba(${255*e[0]}, ${255*e[1]}, ${255*e[2]}, ${e[3]})`:`rgb(${255*e[0]}, ${255*e[1]}, ${255*e[2]})`}},342030:function(e,t,r){r.d(t,{$4:function(){return _},Ah:function(){return d},BA:function(){return s},Cf:function(){return u},N_:function(){return c},R$:function(){return p},RD:function(){return o},Tv:function(){return l},YU:function(){return i},Yb:function(){return m},bQ:function(){return h},tt:function(){return n},wi:function(){return g}});var a=r(171579);let i={resourceType:"normal_func",resourceId:"intelligent_matting",benefitType:"intelligent_matting"},n={resourceType:"normal_func",resourceId:"color_matting",benefitType:"color_matting"},o={resourceType:"normal_func",resourceId:"intelligent_adjust",benefitType:"intelligent_adjust"},s={resourceType:"normal_func",resourceId:"stable",benefitType:"stable"},l={resourceType:"normal_func",resourceId:"intelligent_crop",benefitType:"intelligent_crop"},c={resourceType:"normal_func",resourceId:"subtitle_recognition_web",benefitType:"subtitle_recognition_web"},d={resourceType:"normal_func",resourceId:"audio_denoise",benefitType:"audio_denoise"},u={resourceType:"normal_func",resourceId:"smooth_slow_motion",benefitType:"smooth_slow_motion"},h={resourceType:"aigc",resourceId:"aigc_digital_human_compose_web",benefitType:"aigc_digital_human_compose_web"},p={resourceType:"aigc",resourceId:"digital_test",benefitType:"digital_test"},_={resourceType:"aigc",resourceId:"digital_test",benefitType:"digital_test"},g={resourceType:"aigc",resourceId:"voice_clone_default_web",benefitType:"voice_clone_default_web"},f=[i,n,o,s,l,c,d,u,h],m=(0,a.m)(f)},768133:function(e,t,r){r.d(t,{$9:function(){return i},Yg:function(){return a},kS:function(){return n}});let a={CopyRight:0,Feedback:1,FilmTask:2,FixedMode:3,Settings:4,SignIn:4},i={SignIn:-1,CopyRight:0,FilmTask:1,FixedMode:2,Feedback:3,Settings:4},n={FilmTask:"none",CopyRight:"none",Feedback:"help",Settings:"settings",FixedMode:"none",SignIn:"sign-in"}},687730:function(e,t,r){r.d(t,{Kw:function(){return o},T5:function(){return s},j9:function(){return n}});var a=r(426336),i=r(801497);let n=[{get name(){return i.oc.t("web_materialSearch_text_auto_canvas",{},"Original aspect ratio")},value:a.rxY.CanvasRatioOriginal,width:-1,height:-1,event:"original"},{name:"16:9",value:a.rxY.CanvasRatio16To9,width:16,height:9,event:"16:9"},{name:"4:3",value:a.rxY.CanvasRatio4To3,width:4,height:3,event:"4:3"},{name:"2:1",value:a.rxY.CanvasRatio2To1,width:2,height:1,event:"2:1"},{name:"9:16",value:a.rxY.CanvasRatio9To16,width:9,height:16,event:"9:16"},{name:"1:1",value:a.rxY.CanvasRatio1To1,width:1,height:1,event:"1:1"},{name:"3:4",value:a.rxY.CanvasRatio3To4,width:3,height:4,event:"3:4"}],o=[...n,{name:"4:5",value:a.rxY.CanvasRatio4To5,width:4,height:5,event:"4:5"}];function s(e,t){return e.find(e=>e.value===t)}},108917:function(e,t,r){r.d(t,{D:function(){return i}});var a,i=((a={}).VideoCombination="video-combination",a.Audio="audio",a.Video="video",a.Text="text",a.TextTemplate="text-template",a.Sticker="sticker",a.Filter="filter",a.Effect="effect",a.Transition="transition",a.Mutable="mutable",a.Caption="caption",a.PictureAdjust="picture-adjust",a.MutableText="mutable-text",a.MutableTextTemplate="mutable-text-template",a.MutableVideo="mutable-video",a.Unselected="unselected",a)},907031:function(e,t,r){r.d(t,{$3:function(){return I},$K:function(){return ea},AZ:function(){return J},BC:function(){return b},E9:function(){return w},GB:function(){return Q},Ge:function(){return O},Gy:function(){return T},I1:function(){return h},JQ:function(){return H},KN:function(){return ed},Kr:function(){return k},Kw:function(){return c},Mf:function(){return U},Q_:function(){return A},Qm:function(){return eo},S5:function(){return C},S7:function(){return R},SA:function(){return en},St:function(){return M},Tv:function(){return Z},Ue:function(){return ec},Xj:function(){return l},Xy:function(){return F},YK:function(){return G},Zg:function(){return f},Zn:function(){return u},Zv:function(){return er},aL:function(){return es},ay:function(){return j},bv:function(){return s},cw:function(){return V},dO:function(){return Y},eS:function(){return y},ek:function(){return ee},gD:function(){return E},gT:function(){return z},gW:function(){return d},hn:function(){return q},i:function(){return ei},jy:function(){return K},kH:function(){return $},ku:function(){return et},mP:function(){return W},pP:function(){return el},pi:function(){return L},pz:function(){return S},qh:function(){return m},ro:function(){return _},tm:function(){return D},vm:function(){return g},w0:function(){return p},wZ:function(){return v},wu:function(){return B},xL:function(){return x},xN:function(){return N},y5:function(){return P},yL:function(){return X}});var a,i=r(996820),n=r(29188),o=r(426336);let s=parseFloat(i.Z["height-seg-hd"]),l=parseFloat(i.Z["height-seg-bd-low"]),c=parseFloat(i.Z["height-seg-bd-audio"]),d=parseFloat(i.Z["height-seg-bd"]),u=parseFloat(i.Z.heightTrackSpace),h=parseFloat(i.Z.heightTemplateTrackSpace),p=parseFloat(i.Z.trackLeftPadding),_=parseFloat(i.Z.segInnerMargin),g=1,f=1,m=parseFloat(i.Z.trackBeautyScrollWidth),v=parseFloat(i.Z.trackListPaddingTop),y=parseFloat(i.Z.trackListPaddingBottom),S=parseFloat(i.Z.widthTimelineHdMuteTemplate),M=parseFloat(i.Z.heightAxis),T=10,b=3;parseFloat(i.Z.widthEdge);let k=1.25,w=1,I=0,E=16,P=200,D=5,A=108e5,C=100,R=1.25,x=3,O=4,F=200,N=12,V="nunito_for_arco, Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, \u5FAE\u8F6F\u96C5\u9ED1, Arial, sans-serif",L="rgba(255, 255, 255, 0.12)",j="rgba(7, 50, 71, 0.12)",U="rgba(229, 233, 250, 0.4)",B="rgba(24, 51, 78, 0.4)",W="rgba(255, 255, 255, 0.12)",Z="rgba(7, 50, 71, 0.12)",G=2,H=4,Q=1e9,K=100,z=75,Y=1e6,J=100,$=20,q=50,X=10,ee=parseFloat(i.Z["height-seg-template-post"]),et=[...Object.keys({5:{step:o.pMA.div(1000000n,n.zD,"bigint"),group:2},25:{step:o.pMA.div(1000000n,n.zD,"bigint"),group:3},31.25:{step:o.pMA.div(1000000n,n.zD,"bigint"),group:5},40:{step:o.pMA.div(1000000n,n.zD,"bigint"),group:10},50:{step:o.pMA.div(1000000n,n.zD,"bigint"),group:5}}).map(Number),100,200,300,500,1e3,3e3,6e3,12e3,18e3,3e4,6e4,18e4,36e4,72e4,108e4,18e5,36e5,108e5];et.sort((e,t)=>e-t);let er="TIMELINE_CURSOR_ID",ea="SPLICT_ICON_ID",ei="SEGMENT_ACTIVE_FRONT_ID",en="SEGMENT_ACTIVE_REAR_ID",eo="TRANSITION_ACTIVE_FRONT_ID",es="TRANSITION_ACTIVE_REAR_ID",el="placeholder",ec=2;var ed=((a={}).MULTI_TRACK="multiTrack",a.CUT_SAME="cutSame",a.TEMPLATE_POST="templatePost",a)},672983:function(e,t,r){r.d(t,{f:function(){return n}});var a=r(218571),i=r(348752);function n(e,t,r){let n=(0,a.useRef)(0),o=(0,a.useRef)([0,0]),s=(0,a.useCallback)(e=>{if((0,i.G3)(e))return n.current+=e.deltaY,Math.abs(n.current)>=r&&(t(n.current,"roller"),n.current=0),e.preventDefault(),e.stopPropagation(),!1;if((0,i.To)(e)){o.current[0]+=e.deltaX,o.current[1]+=e.deltaY;let a=1;o.current[0]*o.current[1]>0?a=1:o.current[0]*o.current[1]<0?a=-1:0===o.current[0]?a=o.current[1]<0?-1:1:0===o.current[1]&&(a=o.current[0]<0?-1:1);let i=a*Math.sqrt(Math.pow(o.current[0],2)+Math.pow(o.current[1],2))*5;return Math.abs(i)>=r&&(t(i,"touchpad"),o.current=[0,0]),e.preventDefault(),e.stopPropagation(),!1}},[t,r]);(0,a.useEffect)(()=>{var t;return null===(t=e.current)||void 0===t||t.addEventListener("wheel",s),()=>{var t;null===(t=e.current)||void 0===t||t.removeEventListener("wheel",s)}},[e.current,s])}},989489:function(e,t,r){r.d(t,{x:function(){return o}});var a=r(218571),i=r(937802),n=r(896413);function o(){let e=(0,i.G)(n.a),t=(0,a.useCallback)(()=>{let t=e.richTextEditorManager;if(!t.getModsEmojiLoaded())e.ensureManager.ensureEmoji(!0).then(()=>{t.actionModsEmojiLoadedSet(!0)}).catch(e=>{}).finally(()=>{})},[e]);(0,a.useEffect)(()=>{let r=e.onEventually(()=>{t()});return()=>{r.dispose()}},[e,t])}},316255:function(e,t,r){r.d(t,{g:function(){return o}});var a=r(218571),i=r(937802),n=r(896413);function o(){let{playerManager:e}=(0,i.G)(n.a),[t,r]=(0,a.useState)(e.status.isPlaying||e.status.isRangePlaying);return(0,a.useEffect)(()=>{let t=e.onPlay(()=>{r(!0)}),a=e.onPause(()=>{r(!1)}),i=e.onEnd(()=>{r(!1)});return()=>{t.dispose(),a.dispose(),i.dispose()}},[]),{playing:t}}},161247:function(e,t,r){r.d(t,{U:function(){return i}});var a=r(218571);function i(){let e=(0,a.useRef)(document.getElementById("ssr-root")),[t,r]=(0,a.useState)(!e.current);return(0,a.useEffect)(()=>{if(e.current&&e.current.parentNode){let t=new MutationObserver(a=>{a.forEach(a=>{"childList"===a.type&&Array.from(a.removedNodes).includes(e.current)&&(r(!0),e.current=null,t.disconnect())})});return t.observe(e.current.parentNode,{childList:!0}),()=>t.disconnect()}},[]),t}},893245:function(e,t,r){r.d(t,{W:function(){return c}});var a=r(789786),i=r(690613),n=r(507967),o=r(210360),s=r(426020),l=r(358793);class c extends n.i{_isImageNeedCapture(e){return!!e&&l.M.includes(e)}async getCover(e){let{fileType:t,blobUrl:r,mime:a}=e;if(t===s.YB.Image&&this._isImageNeedCapture(a)&&this._captureImageFrameHelper){var n;let t=await this._captureImageFrameHelper.getImageFrame({filename:null!==(n=e.filename)&&void 0!==n?n:"",blobUrl:r});return t.ok?(0,i.oW)({url:t.value.blobUrl}):(0,i.wf)(-1,"img not loaded")}return super.getCover(e)}constructor(e,t){super(t),this.videoCaptureService=t,this._captureImageFrameHelper=e.captureImageFrameHelper}}c=(0,a.gn)([(0,a.fM)(1,o.T),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Object,void 0===o.T?Object:o.T])],c)},918585:function(e,t,r){r.d(t,{a:function(){return i}});var a,i=((a={})[a.IDLE=0]="IDLE",a[a.PREPARING=1]="PREPARING",a[a.UPLOADING=2]="UPLOADING",a[a.REPLACING=3]="REPLACING",a[a.SUCCESS=4]="SUCCESS",a[a.CANCELED=5]="CANCELED",a[a.FAILED=6]="FAILED",a)},857670:function(e,t,r){r.d(t,{G8:function(){return c},KL:function(){return s},Wl:function(){return d},i1:function(){return l},qf:function(){return u}});var a=r(426336),i=r(17018);let n=BigInt(1e6),o=BigInt(30);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"round",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return Number(1e3*Math[t](e*r/1e3)/r)}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"round",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o;return a.pMA.div(e*r,n,"bigint",t)*n/r}let c=n/o,d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0n,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0n,l=Number((a+s)*o/n),c=Number(((0,i.d)(e-r,t).integer+a)*o/n);return c>=l?l:c},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0n,s=BigInt(e)*n/o;return(0,i.e)(s-a,t).integer+r}},305799:function(e,t,r){function a(e,t){let r=0;for(let a of e){if(!t(a))break;r++}return e.slice(r)}r.d(t,{NO:function(){return i}});function i(e,t){var r,i;return r=a(e,t),i=t,a(r.reverse(),i).reverse()}},970787:function(e,t,r){r.d(t,{I:function(){return i},m:function(){return n}});var a=r(426336);function i(e,t,r){let{segIds:i}=r,n=e.api.batch.batchStart();i.forEach(r=>{let i=e.draftView.getSegmentById(r);i&&(0,a.hey)(i)&&i.transition&&t.clearVideoTransition(i.transition.id)}),i.forEach(e=>{t.clearTrackingRelation(e)}),e.api.segment.delete(r),e.api.batch.batchEnd(n)}function n(e,t,r,a,n){if(!r.length&&!a.length)return;let o=e.api.batch.batchStart();a.length&&e.api.video.clearTransition({segIds:a.map(t=>{var r;return null===(r=e.draftView.getSegmentByTransitionId(t))||void 0===r?void 0:r.id}).filter(Boolean)}),r.length&&i(e,t,{segIds:r,draftId:n,selectedSegIds:r}),e.api.batch.batchEnd(o)}},237322:function(e,t,r){r.d(t,{A:function(){return s},M:function(){return l}});var a=r(231811),i=r(654033),n=r(836946),o=r(509330);function s(e){let{box:t,videoHeight:r,videoWidth:o,rotate:s,scale:l}=e,c=l-1,d=c*o/2,u=c*r/2,h=[o/2,r/2],p=(0,i.a)([-d,r+u],s,h),_=(0,i.a)([o-d,r+u],s,h),g=(0,i.a)([-d,-u],s,h),f={begin:p,end:_},m={begin:p,end:g},v=[t.left,r-t.top],y=[t.left+t.width,r-t.top],S=[t.left,r-t.height-t.top],M=[t.left+t.width,r-t.height-t.top],T=o*l,b=r*l,k=(0,a.FH)((0,n.Ii)(m,v)/T),w=(0,a.FH)((0,n.Ii)(f,v)/b),I=(0,a.FH)((0,n.Ii)(m,y)/T),E=(0,a.FH)((0,n.Ii)(f,y)/b),P=(0,a.FH)((0,n.Ii)(m,S)/T),D=(0,a.FH)((0,n.Ii)(f,S)/b),A=(0,a.FH)((0,n.Ii)(m,M)/T);return{upperLeftX:k,upperLeftY:w,upperRightX:I,upperRightY:E,lowerLeftX:P,lowerLeftY:D,lowerRightX:A,lowerRightY:(0,a.FH)((0,n.Ii)(f,M)/b)}}function l(e){let{upperLeftX:t,upperLeftY:r,upperRightX:s,upperRightY:l,lowerLeftX:c,lowerLeftY:d,shellHeight:u,shellWidth:h}=e,p=(0,n.qp)({begin:[0,0],end:[h,0]},{begin:[t*h,-r*u],end:[s*h,-l*u]}),_=Math.round(p>180?-(360-p):p),g=(0,o.g)({width:h,height:u,left:0,top:0},_),f=u*(g-1)/2,m=h*(g-1)/2,v=[-m+t*h*g,f-r*u*g],y=[-m+s*h*g,f-l*u*g],S=[-m+c*h*g,f-d*u*g],M=[h/2,-u/2],T=(0,i.a)([0,0],-_,M),b=(0,i.a)([h,0],-_,M),k=(0,i.a)([0,-u],-_,M),w=(0,n.Ii)({begin:T,end:b},v),I=(0,n.Ii)({begin:T,end:k},v),E=(0,a.Et)(v,y),P=(0,a.Et)(v,S);return{scale:g,rotate:_,box:{left:I,top:w,width:E,height:P}}}},632858:function(e,t,r){r.d(t,{v:function(){return i}});var a=r(426336);class i{static get instance(){return!i._instance&&(i._instance=new i),i._instance}saveData(e,t,r){let a=this._cacheMap.get(e);!a&&(a=new Map,this._cacheMap.set(e,a)),a.set(t,{draftPath:"",handleType:0,...r})}getData(e,t){let r=this._cacheMap.get(e);return null==r?void 0:r.get(t)}getAllData(e){return this._cacheMap.get(e)}clearData(e){let t=this._cacheMap.get(e);t&&(t.clear(),this._cacheMap.delete(e))}removeData(e,t){let r=this._cacheMap.get(e);r&&r.delete(t)}destroy(){this._disposable.dispose()}constructor(){this._cacheMap=new Map,this._disposable=a.tyu.event(e=>{let{identifier:t,substitute:r}=e;this._cacheMap.forEach(e=>{e.forEach(e=>{let{segment:i}=e;return i&&(0,a.nrl)(i,t)&&(0,a.pcG)(i,r)})})})}}},615585:function(e,t,r){r.d(t,{u:function(){return a}});let a=(e,t)=>{let{trackRenderIndex:r,targetTimerange:a}=e;return t.filter((e,t)=>t>r).reduce((e,t)=>{let r=t.segments.filter(e=>!(e.targetTimerange.start+e.targetTimerange.duration<a.start||e.targetTimerange.start>=a.start+a.duration)).map(e=>e.id);return e.push(...r),e},[])}},679827:function(e,t,r){r.d(t,{l:function(){return l}});var a=r(108692),i=r(425427),n=r(136877),o=r(215518),s=r(229749);function l(e,t){var r,l,c;let d=(0,o.FW)(e),{editType:u,edittype:h}=function(e){var t;let{mainDraftService:r,videoEnvironmentService:l}=e.invokeFunction(e=>({mainDraftService:e.get(a.n),videoEnvironmentService:e.get(i.rO)}));return t=(0,i.JY)(l)?l.currentTemplateId:r.draftTemplateManager.getCombinationSegmentTemplateIds()[0],{editType:function(e){switch(e){case n.ZZ.festival_marketing_editor:return"festival_marketing_editor";case n.ZZ.smart_ad_edit:return"smart_ad_edit";case n.ZZ.smart_derivation:return"smart_derivation";case n.ZZ.ai_character:return"ai_character";case n.ZZ.business_script_edit:return"business_script_edit";case n.ZZ.video_template_edit:return"video_template_edit";case n.ZZ.smart_ad_edit_for_tts:return"smart_ad_edit_for_tts";case n.ZZ.quick_cut:return"quick_cut";case n.ZZ.remove_background:return"remove_background"}return(0,o.Lj)(s.b)}(r.cloudMetaManager.getMeta().draft.transferedFrom),edittype:"edit"}}(t);return{...d,edit_type:null!=u?u:"edit",edittype:h,enter_from:null!==(r=d.enter_from)&&void 0!==r?r:"direct",page_from:null!==(l=d.page_from)&&void 0!==l?l:"direct",tab_name:null!==(c=d.tab_name)&&void 0!==c?c:"other"}}},492430:function(e,t,r){r.d(t,{Y:function(){return s}});var a=r(772322),i=r(507828),n=r(589032),o=r(995370);function s(e){let t=i.yv.find(t=>t.key===e);if(!!t){let e=o.V5?"osx":"windows",r=t.bindings[e],i=[];return i="string"==typeof r?(0,n.H)(r):(r.find(e=>"del"===e)?r.filter(e=>"delete"!==e):r).map(e=>(0,n.H)(e)).reduce((e,t)=>e.length?e.length&&t.length?[...e,(0,a.jsx)("span",{className:"divide",children:"/"},"divide"),...t]:e:t,[]),(0,a.jsx)("div",{className:"shortcut",children:i})}}},649086:function(e,t,r){r.d(t,{z:function(){return i}});let a=0;function i(){return++a}},269620:function(e,t,r){r.d(t,{F:function(){return a}});class a{getProjectionRadius(e){let t=this.dot(e,this._axisX),r=this.dot(e,this._axisY);return this._halfWidth*t+this._halfHeight*r}dot(e,t){return Math.abs(e[0]*t[0]+e[1]*t[1])}isCollision(e){let t=[this._centerPoint[0]-e._centerPoint[0],this._centerPoint[1]-e._centerPoint[1]];for(let r of[this._axisX,this._axisY,e._axisX,e._axisY])if(this.getProjectionRadius(r)+e.getProjectionRadius(r)<=this.dot(t,r))return!1;return!0}constructor(e){let{center:t,height:r,width:a,angle:i}=e;this._centerPoint=[t.x,t.y],this._halfHeight=r/2,this._halfWidth=a/2;let n=i/180*Math.PI;this._axisX=[Math.cos(n),Math.sin(n)],this._axisY=[-Math.sin(n),Math.cos(n)]}}},563431:function(e,t,r){r.d(t,{$D:function(){return h},S5:function(){return c},f2:function(){return g},fG:function(){return s},iF:function(){return o},jy:function(){return u},nS:function(){return l},sc:function(){return p},tS:function(){return f},wg:function(){return _}});let a=(e,t,r)=>(t.x-e.x)*(r.y-e.y)-(r.x-e.x)*(t.y-e.y),i=(e,t,r)=>{let{x:a,y:i}=e,{x:n,y:o}=t;return{x:(a-n)*Math.cos(r)-(i-o)*Math.sin(r)+n,y:(a-n)*Math.sin(r)+(i-o)*Math.cos(r)+o}},n=(e,t)=>{let{topLeft:r,topRight:a,bottomLeft:n,bottomRight:o}=e,s={x:r.x+(a.x-r.x)/2,y:r.y+(n.y-r.y)/2};return{topLeft:i(r,s,t),topRight:i(a,s,t),bottomLeft:i(n,s,t),bottomRight:i(o,s,t)}},o=e=>[e.x+e.width/2,e.y+e.height/2],s=(e,t)=>{let{topLeft:r,topRight:i,bottomLeft:n,bottomRight:o}=e;return a(r,n,t)*a(o,i,t)>=0&&a(n,o,t)*a(i,r,t)>=0},l=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t.x>=e.x-r&&t.x<=e.x+e.width+r&&t.y>=e.y-r&&t.y<=e.y+e.height+r},c=(e,t)=>{let{x:r,y:a,width:n,height:s,rotate:c}=e,[d,u]=o(e);return l({x:r,y:a,width:n,height:s},i(t,{x:d,y:u},-(c/180)*Math.PI))},d=(e,t)=>{let{topLeft:r,topRight:a,bottomLeft:i,bottomRight:n}=e,o=(r.x+a.x+n.x+i.x)/4,s=(r.y+a.y+n.y+i.y)/4,l=t.x-o,c=t.y-s,d=Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2)),u=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),h=(a.y-r.y)/d,p=(a.x-r.x)/d;return{x:2*(l*p+c*h)/d,y:2*(l*h-c*p)/u}},u=function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,{height:i,width:o,x:s,y:l,rotate:c}=e,d=i*r+a,u=o*r+a,h=t.x+s*r,p=t.y+l*r;return n({topLeft:{x:h-a,y:p-a},topRight:{x:h+u,y:p-a},bottomLeft:{x:h-a,y:p+d},bottomRight:{x:h+u,y:p+d}},c/180*Math.PI)},h=e=>{var t,r;let{rect:a,point:i,getWrapSize:n,scale:o,offset:s=0}=e,l=n(),c=null!==(t=null==l?void 0:l.left)&&void 0!==t?t:0;return d(u(a,{x:c,y:null!==(r=null==l?void 0:l.top)&&void 0!==r?r:0},o,s),i)},p=(e,t,r)=>{if(!(null==e?void 0:e.current))return;let[a,i]=t,{left:n,top:o,width:s,height:l}=e.current.getBoundingClientRect(),{clientX:c,clientY:d}=r;return{x:(c-n)*a/s,y:(d-o)*i/l}},_=(e,t)=>{let{x:r,y:a,width:n,height:s,rotate:l}=t,[c,d]=o(t),u=i(e,{x:c,y:d},-(l/180)*Math.PI);return Math.min(u.x-r,u.y-a,r+n-u.x,a+s-u.y)},g=(e,t)=>!!(e.x<0)||!!(e.x+e.width>t[0])||!!(e.y<0)||!!(e.y+2*e.height>t[1])||!1;function f(e,t){return e.x===t.x&&e.y===t.y}},544009:function(e,t,r){r.d(t,{HA:function(){return f},xe:function(){return u}});var a=r(857670),i=r(836946),n=r(298730),o=r(566504),s=r(426336),l=r(209342);let c=(e,t,r,a,i)=>{let n=0,o=0,{resourceType:s,config:c}=e||{},{rotation:d}=c||{},u=t*i[0],h=r*i[1],p=(null!=d?d:0)%360;switch(s){case l.X.LINE:let _=t*a[0],g=-r*a[1];n=0,o=0,p>45&&p<=135?(u=t-(n=_),h=r):p>135&&p<=225?(o=g,u=t,h=r-o):p>225&&p<=315?(u=_,h=r):(u=t,h=g);break;case l.X.RECTANGLE:default:n=u*a[0]/2,o=-(h*a[1])/2}return{maskX:n,maskY:o,maskWidth:u,maskHeight:h}},d=(e,t)=>{let[r,a]=t;return e.filter(e=>{var t;let{start:i=0n,duration:n=0n}=null!==(t=e.targetTimerange)&&void 0!==t?t:{},o=i+n;return i>=r&&i<=a||o>=r&&o<=a||i<=r&&o>=a})},u=(e,t)=>{let r=e[0],a=e[1],i=r,n=a;t.sort((e,t)=>Number(e[0]-t[0]));for(let e=0;e<t.length;e++){let[r,a]=t[e];if(r!==a){if(i>=n||r<=i&&a>=n)return[0n,0n];r>i&&(n=r),r<=i&&a<n&&(i=a)}}return[i-r,n-r]},h=(e,t)=>{var r,a;if(!t.length)return 0n;let i=t.map(e=>{let{start:t,duration:r}=e.targetTimerange;return[t,t+r]});i.sort((e,t)=>Number(e[0]-t[0]));let n=null!==(r=e.targetTimerange.start)&&void 0!==r?r:0n,o=n+(null!==(a=e.targetTimerange.duration)&&void 0!==a?a:0n),[s]=u([n,o],i);return s},p=(e,t)=>{var r,i,n,o,l,c,d,p,_,g,f,m;if(!(null===(i=e.animations)||void 0===i?void 0:null===(r=i.animations)||void 0===r?void 0:r.length)&&!e.commonKeyframes.length)return h(e,t);let v=null===(n=e.animations)||void 0===n?void 0:n.animations.filter(e=>[s.VAL.Anim_In,s.VAL.Anim_Caption].includes(e.type)&&0n!==e.duration),y=null===(o=e.animations)||void 0===o?void 0:o.animations.find(e=>e.type===s.VAL.Anim_Out&&0n!==e.duration),S=null===(l=e.animations)||void 0===l?void 0:l.animations.find(e=>[s.VAL.Anim_Loop,s.VAL.Anim_Group].includes(e.type)&&0n!==e.duration),M=null!==(c=e.targetTimerange.start)&&void 0!==c?c:0n,T=null!==(d=e.targetTimerange.duration)&&void 0!==d?d:0n,b=s.pMA.plus(0n,s.pMA.max(null!==(p=null==v?void 0:v.map(e=>{var t;return null!==(t=e.duration)&&void 0!==t?t:0}))&&void 0!==p?p:[0n],"bigint"),"bigint"),k=T-(null!==(_=null==y?void 0:y.duration)&&void 0!==_?_:0n),w=b,I=b;switch(null==S?void 0:S.type){case s.VAL.Anim_Loop:I=k;break;case s.VAL.Anim_Group:I=(w=null!==(g=null==S?void 0:S.start)&&void 0!==g?g:b)+(null!==(f=null==S?void 0:S.duration)&&void 0!==f?f:0n)}let[E]=u([0n,T],[[0n,b],[w,I],[k,T]]);return E?E:(null==v?void 0:v.length)?(0,a.i1)(b+M,"floor")-M:S&&0n===w?s.pMA.div(null!==(m=S.duration)&&void 0!==m?m:0n,2,"bigint")+b:E},_=(e,t)=>{if(!(0,s.OvQ)(t))return 0;let r=e.findIndex(e=>e.id===t.id);if(!r)return 0;let a=e[r-1];if(!a.transition)return 0n;let{transition:{duration:i,isOverlap:n}}=a;return n?i/2n:i},g=async(e,t,r,a,n,l,d,u)=>{var h,p,_;let{segmentId:g,commonKeyframes:f,targetStart:m}=e,v=s.pMA.minus(null!==(p=null==n?void 0:n.targetTimerange.start)&&void 0!==p?p:0n,null!==(_=null==n?void 0:null===(h=n.sourceTimerange)||void 0===h?void 0:h.start)&&void 0!==_?_:0n,"bigint");if(!f.length)return s.pMA.min([t,r],"bigint");let y=new Set(["KFTypePositionX","KFTypePositionY","KFTypeScale","KFTypeScaleX","KFTypeScaleY","KFTypeAlpha","KFTypeMaskPostion","KFTypeMaskPostionX","KFTypeMaskPostionY","KFTypeMaskSize","KFTypeMaskSizeX","KFTypeMaskSizeY","KFTypeGlobalAlpha"]),S=new Map;f.forEach(e=>{let{propertyType:t,keyframeList:r}=e;r.forEach(e=>{let{timeOffset:r,...a}=e;S.has(r)?S.get(r)[t]=a:S.set(r,{[t]:a})})});let M=[...new Set(f.flatMap(e=>{let{propertyType:a,keyframeList:i}=e;return i.length>1&&y.has(a)?i.filter(e=>{let{timeOffset:a}=e;return a>t&&a<=r}).map(e=>{let{timeOffset:t}=e;return t}):[]}))].sort((e,t)=>s.pMA.minus(e,t)),[T,b]=a,k=T*b,w=0,I=1/0,E=s.pMA.min([t,r],"bigint"),P=(e,t,r)=>{var a,n,o,s,l,d,u,h,p,_,g,f,m,v,y;let M=(null===(a=S.get(t))||void 0===a?void 0:a.KFTypeAlpha)||(null===(n=S.get(t))||void 0===n?void 0:n.KFTypeGlobalAlpha),k=null===(o=S.get(t))||void 0===o?void 0:o.KFTypeMaskPostion,w=null===(s=S.get(t))||void 0===s?void 0:s.KFTypeMaskPostionX,I=null===(l=S.get(t))||void 0===l?void 0:l.KFTypeMaskPostionY,E=null===(d=S.get(t))||void 0===d?void 0:d.KFTypeMaskSize,P=null===(u=S.get(t))||void 0===u?void 0:u.KFTypeMaskSizeX,D=null===(h=S.get(t))||void 0===h?void 0:h.KFTypeMaskSizeY,A=null===(p=S.get(t))||void 0===p?void 0:p.KFTypeScale,C=null===(_=S.get(t))||void 0===_?void 0:_.KFTypeScaleX,R=null===(g=S.get(t))||void 0===g?void 0:g.KFTypeScaleY,x=null!==(f=null==A?void 0:A.values)&&void 0!==f?f:[1,1];(null==C?void 0:C.values)&&(x[0]=null==C?void 0:C.values[0]),(null==R?void 0:R.values)&&(x[1]=null==R?void 0:R.values[0]);let O=null!==(m=null==M?void 0:M.values[0])&&void 0!==m?m:1,F=null!==(v=null==k?void 0:k.values)&&void 0!==v?v:[0,0];(null==w?void 0:w.values)&&(F[0]=null==w?void 0:w.values[0]),(null==I?void 0:I.values)&&(F[1]=null==I?void 0:I.values[0]);let N=null!==(y=null==E?void 0:E.values)&&void 0!==y?y:[1,1];(null==P?void 0:P.values)&&(N[0]=null==P?void 0:P.values[0]),(null==D?void 0:D.values)&&(N[1]=null==D?void 0:D.values[0]);let{maskX:V,maskY:L,maskWidth:j,maskHeight:U}=c(r.mask,T,b,F,N),{width:B,height:W}=(0,i.uu)((0,i.uu)(e,{x:0,y:0,width:T,height:b}),{x:V,y:L,width:j,height:U});return B*W*O*(r.isText?x[0]*x[1]:1)},D=s.pMA.plus(m,v,"bigint");for(let t of M){let r=await l.getSegmentRectangles({draftView:d.draftView,getSegmentById:e=>d.draftView.getSegmentById(e,void 0,!1),canvasSize:a,segIds:[g],selectedSegmentsIds:u.getSelectedSegmentsIds(),current:s.pMA.plus(D,t,"bigint"),parentSegIds:n?[n.id]:void 0}),i=d.draftView.getSegmentById(g,void 0,!1),c={},h=!1;if(i&&(0,o.ov)(i)){let e=(0,s.P2G)(i);e&&(c.mask=e,h=e.config.invert)}c.isText=(0,s.Ub2)(e);let p=P(r[0],t,c);if(p/k>.99)return t;h?p<I&&(I=p,E=t):p>w&&(w=p,E=t)}return E},f=async(e,t,r,i,o)=>{var l,c,u,h,f,m,v,y,S,M,T,b,k;let w=i.draftView.getCanvasConfig(),I=i.draftView.getDraftId(),E=null!==(h=null==t?void 0:null===(l=t.materialDraft)||void 0===l?void 0:l.draft.getDraftId())&&void 0!==h?h:null,P=null!==(f=null!=E?E:I)&&void 0!==f?f:"",D=null!==(m=i.cutSame.draftIdToMutableVideos[P])&&void 0!==m?m:[],A=null!==(v=i.cutSame.draftIdToMutableTexts[P])&&void 0!==v?v:[],C=(0,n.dx)(D,A,e),R=i.draftView.getSegmentById(e),x=null!==(y=null==R?void 0:R.targetTimerange.start)&&void 0!==y?y:0n,O=s.pMA.plus(x,null!==(S=null==R?void 0:R.targetTimerange.duration)&&void 0!==S?S:0n,"bigint"),F=d((null!==(M=null==t?void 0:null===(c=t.materialDraft)||void 0===c?void 0:c.draft)&&void 0!==M?M:i.draftView).getAllEffects(),[x,O]),N=Array.isArray(C)?C[0]:C;if(!N||!R)return null;let{targetStart:V}=N,L=null!==(T=null==t?void 0:null===(u=t.sourceTimerange)||void 0===u?void 0:u.start)&&void 0!==T?T:0n,j=s.pMA.max([s.pMA.minus(L,V,"bigint"),0n],"bigint"),U=(0,s.udP)(N,t),B=s.pMA.max([p(R,F),_(D,N),j],"bigint"),W=s.pMA.plus(j,U,"bigint"),Z=await g(N,B,W,[w.width,w.height],t,r,i,o),G=s.pMA.plus(V,Z,"bigint"),H=s.pMA.minus(G,null!=L?L:0n,"bigint"),Q=i.draftView.getTargetTimeRangeBySegmentId(e),K=null!==(b=null==Q?void 0:Q.start)&&void 0!==b?b:L,z=s.pMA.plus(K,null!==(k=null==Q?void 0:Q.duration)&&void 0!==k?k:0n,"bigint"),Y=H;t&&(Y=s.pMA.plus(t.targetTimerange.start,i.draftView.getTargetStartBySpeed(H,t.targetTimerange.duration,t.speed),"bigint"));let J=(0,a.i1)(Y,"round");return J<K?(0,a.i1)(Y,"ceil"):J>=z?(0,a.i1)(Y,"floor"):J}},589032:function(e,t,r){r.d(t,{H:function(){return s}});var a=r(772322),i=r(801497),n=r(448767),o=r(568998);let s=e=>{let t=e.split("+"),r=[],s=0;return t.forEach(e=>{switch(e){case"ctrl":r.push(n.Mq?(0,a.jsx)(o.eY4,{},s++):(0,a.jsx)("span",{children:"ctrl"},s++));break;case"shift":r.push(n.Mq?(0,a.jsx)(o.ceu,{},s++):(0,a.jsx)("span",{children:"shift"},s++));break;case"alt":r.push((0,a.jsx)("span",{children:"alt"},s++));break;case"meta":r.push((0,a.jsx)(o.oze,{},s++));break;case"del":case"delete":!n.Mq&&r.push((0,a.jsx)("span",{children:"delete"},s++));break;case"backspace":r.push(n.Mq?(0,a.jsx)(o.Ytq,{},s++):(0,a.jsx)("span",{children:i.oc.t("backspace",{},"\u9000\u683C")},s++));break;case"esc":r.push((0,a.jsx)("span",{children:"esc"},s++));break;case"space":r.push((0,a.jsx)("span",{children:i.oc.t("pause",{},"\u7A7A\u683C")},s++));break;case"plus":case"equal":r.push((0,a.jsx)(o.ir$,{},s++));break;case"-":case"minus":r.push((0,a.jsx)(o.tNd,{},s++));break;case"left":r.push((0,a.jsx)(o.xuu,{},s++));break;case"right":r.push((0,a.jsx)(o.xuu,{style:{transform:"rotate(180deg)"}},s++));break;case"up":r.push((0,a.jsx)(o.xuu,{style:{transform:"rotate(90deg)"}},s++));break;case"down":r.push((0,a.jsx)(o.xuu,{style:{transform:"rotate(270deg)"}},s++));break;case"scroll":r.push((0,a.jsx)("span",{children:i.oc.t("up_web_down",{},"\u6EDA\u8F6E\u4E0A\u4E0B")},s++));break;case"click":r.push((0,a.jsx)("span",{children:i.oc.t("web_left_click",{},"\u53F3\u952E\u4F9D\u6B21\u5355\u51FB")},s++));break;default:r.push((0,a.jsx)("span",{className:"letter uppercase",children:e},s++))}}),r}},860147:function(e,t,r){r.d(t,{Cq:function(){return o},Gs:function(){return s},K9:function(){return c},RK:function(){return d},b4:function(){return l},r2:function(){return u}});var a=r(800788),i=r(566504),n=r(426336);function o(e){var t;return(0,a.ZB)(e),(0,n.Ftn)(e)&&(null==e?void 0:null===(t=e.material)||void 0===t?void 0:t.type)===n.cVg.MetaTypeSubtitle}function s(e){return(0,n.Ftn)(e)||(0,n.Q2R)(e)}function l(e){var t;return(0,n.Ftn)(e)&&(null==e?void 0:null===(t=e.material)||void 0===t?void 0:t.type)===n.cVg.MetaTypeText}function c(e){var t;return(0,n.Ftn)(e)&&(null==e?void 0:null===(t=e.material)||void 0===t?void 0:t.type)===n.cVg.MetaTypeLyrics}function d(e){let t="text";return(o(e)||c(e))&&(t="subtitle"),(0,n.Q2R)(e)&&(t="text-template"),t}function u(e){var t,r,a,s;if(t=e,(0,i.hr)(t)&&o(t)&&(null==t?void 0:null===(r=t.material)||void 0===r?void 0:r.addType)===n.RZH.RecognizeAdd)return"subtitle_recognition";if(c(e))return"lyric_recognition";if(a=e,(0,i.hr)(a)&&o(a)&&(null==a?void 0:null===(s=a.material)||void 0===s?void 0:s.addType)===n.RZH.ManualAdd)return"manual_subtitle";return"other"}},142290:function(e,t,r){r.d(t,{Bx:function(){return s},Me:function(){return c},gU:function(){return o}});var a=r(860147),i=r(425427),n=r(426336);let o=(e,t,r)=>!(0,i.JY)(r)&&((0,a.b4)(e)&&t.syncToAllConfig.shouldSyncToAllText()||(0,a.K9)(e)&&t.syncToAllConfig.shouldSyncToAllLyric()||(0,a.Cq)(e)&&t.syncToAllConfig.shouldSyncToAllSubtitle()),s=(e,t,r)=>!(0,i.JY)(r)&&((0,a.b4)(e)&&t.syncToAllConfig.shouldSyncToAllTextMotion()||(0,a.K9)(e)&&t.syncToAllConfig.shouldSyncToAllLyricMotion()||(0,a.Cq)(e)&&t.syncToAllConfig.shouldSyncToAllSubtitleMotion()),l=(e,t)=>e===n.cVg.MetaTypeSubtitle||e===n.cVg.MetaTypeLyrics||e===n.cVg.MetaTypeText?t.draftView.getSegmentsByTrackTypeAndMaterialType(n.pNd.TrackTypeText,e):[],c=(e,t)=>(0,n.Ftn)(e)&&((0,a.b4)(e)||(0,a.K9)(e)||(0,a.Cq)(e))?l(e.material.type,t):[]},343601:function(e,t,r){r.d(t,{M:function(){return a}});async function a(e){let t=new Headers;t.append("Referer",""),t.append("range","bytes=0-2047");try{return await fetch(e,{method:"GET",headers:t,redirect:"follow"}),!0}catch(e){return!1}}},534302:function(e,t,r){r.d(t,{f:function(){return i}});var a=r(632555);function i(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];for(let i of t){let{start:t,duration:n}=i.targetTimerange;if(!function(e,t,r){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3],n=r+e.duration;return!t.some(t=>{let{start:o,duration:s}=t.targetTimerange;return(!i||t.id!==e.id)&&((0,a.vX)(r,[o,o+s])||(0,a.vX)(n,[o,o+s])||r<=o&&o+s<=n)})}({id:i.id,duration:n},e,t,r))return!1}return!0}},47391:function(e,t,r){r.d(t,{G:function(){return i}});var a=r(574548);async function i(e,t){let{mimeType:r}=t,i=new Blob([e],{type:r}),n=URL.createObjectURL(i);try{return await (0,a.G)(n)}finally{URL.revokeObjectURL(n)}}},968172:function(e,t,r){r.d(t,{N:function(){return i}});var a=r(708940);function i(e,t,r){let i,n,{compress:o}=r;(0,a.G)(o)?n=(i=o.width)*e.naturalHeight/e.naturalWidth:(0,a.f)(o)?i=(n=o.height)*e.naturalWidth/e.naturalHeight:(i=e.naturalWidth,n=e.naturalHeight);let s=document.createElement("canvas");s.width=i,s.height=n;let l=s.getContext("2d");if(!l)throw Error("[htmlImage2CanvasSync] create context failed!");return l.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,i,n),s}},782566:function(e,t,r){r.d(t,{X:function(){return i}});var a=r(708940);function i(e,t){let r,i,{compress:n}=t;return(0,a.G)(n)?i=(r=n.width)*e.naturalHeight/e.naturalWidth:(0,a.f)(n)?r=(i=n.height)*e.naturalWidth/e.naturalHeight:(r=e.naturalWidth,i=e.naturalHeight),createImageBitmap(e,{resizeWidth:r,resizeHeight:i})}},978594:function(e,t,r){r.d(t,{W:function(){return a}});function a(e){let t;return t=e>=72e6?e/36e5:e>=36e6?2e4:e>=18e6?1e4:e>=36e5?5e3:e>=18e5?3e3:e>=6e5?2e3:e>=6e4?1e3:e>=1e4?500:e>=5e3?125:100}},708940:function(e,t,r){function a(e){return"number"==typeof(null==e?void 0:e.width)&&e.width>0}function i(e){return"number"==typeof(null==e?void 0:e.height)&&e.height>0}r.d(t,{G:function(){return a},f:function(){return i}})},601193:function(e,t,r){r.d(t,{j:function(){return o}});var a=r(502562),i=r(245806),n=r.n(i);async function o(e){let{func:t,currents:r,targets:i,cubicParams:o,duration:s,animationName:l,eventTracker:c}=e,d=n()(...o);async function u(e,a){await t(i.map((t,a)=>{let i=r[a];return i+(t-i)*e}),a)}let h=Math.round(performance.now());return Promise.race([new Promise(e=>{let t=Math.round(performance.now()),r=[];!async function a(){let i=Math.round(performance.now()),n=(i-h)/s;r.push(i-t),t=i,n>=1?(await u(1,!0),!function(){var e;let a=Math.round(performance.now()),i=a-h,n=a-t;r.push(n),null==c||null===(e=c.track)||void 0===e||e.call(c,"js_animate_performance",{fps:Math.round(1e3/(i/(r.length-1))),target_duration:s,actual_duration:i,max_cost:Math.max(...r),animation_name:l})}(),e(0)):(await u(d(n)),requestAnimationFrame(a))}()}),await (0,a._)(s+300,Error("[js_animate_performance] animation time out"))])}},990157:function(e,t,r){r.d(t,{Z:()=>f});var a=r("772322");r("225572");var i=r("97257");r("218571");var n=r("105789"),o=r.n(n),s=r("801497"),l=r("150564");let c="btn-fg51tX",d="btn-icon-v2XDi6",u="btn-text-oZvtkG";var h=r("356954");class p{getEventParams(){return{}}constructor(){this.eventName="template_publish_back"}}var _=r("937802"),g=r("230689");let f=e=>{let{onBack:t}=e,r=(0,_.G)(g.t);return(0,a.jsxs)("div",{className:o()("template-post-back-btn",c),children:[(0,a.jsx)(i.Z,{size:"mini",type:"default",className:d,icon:(0,a.jsx)(l.ZEK,{}),onClick:()=>{var e;e=r,(0,h.K)(e,p,[]),null==t||t()}}),(0,a.jsx)("span",{className:u,children:s.ZP.t("web_posttemplate_button_back_to_editor",{},"Back to editor")})]})}},862893:function(e,t,r){r.d(t,{Ko:function(){return v},Mi:function(){return b},Q3:function(){return w},UZ:function(){return p},Uu:function(){return d},XY:function(){return E},bE:function(){return P},v1:function(){return m},vj:function(){return I},zY:function(){return y}});var a=r(539525),i=r(700056),n=r(813072),o=r(648653),s=r(249656),l=r(426336),c=r(257118);let d=(0,a.Z)(l.hey,l.Y9Q,l.Ftn,l.Q2R,l.P2T);function u(e){return!!(null==e?void 0:e.materialId)&&!!(null==e?void 0:e.sourcePlatform)||!!(null==e?void 0:e.material_id)&&!!(null==e?void 0:e.source_platform)}function h(e){return{id:e.id,cover_path:"",platform:"all",freeze_group:"",relation_video_group:"",is_user_modified:!1}}function p(e){var t;let r=(0,i.Z)(e);return null===(t=r.tracks)||void 0===t||t.forEach(e=>{let t=e.type;t===l.pNd.TrackTypeText&&(t=l.pNd.TrackTypeSticker),e.type=t}),r}function _(e,t){var r;return(null!==(r=null==e?void 0:e[t])&&void 0!==r?r:[]).reduce((e,t)=>(e[t.id]=t,e),{})}function g(e,t,r,a){var i,n;let o=new Set(a);e.extra_material_refs=null===(i=e.extra_material_refs)||void 0===i?void 0:i.filter(e=>!o.has(e)),t[r]=null===(n=t[r])||void 0===n?void 0:n.filter(e=>!o.has(e.id))}function f(e){return Object.keys(null!=e?e:{}).reduce((t,r)=>{var a;return(null!==(a=null==e?void 0:e[r])&&void 0!==a?a:[]).forEach(e=>t[e.id]=e),t},{})}function m(e,t,r){var a,n,o,s,c,d,p,m,v,y,S,M;let T=(0,i.Z)(e),b=_(T.materials,"effects"),k=_(T.materials,"manual_deformations"),w=_(T.materials,"audio_effects"),I=_(T.materials,"vocal_separations"),E=_(T.materials,"chromas"),P=(null!==(a=T.tracks)&&void 0!==a?a:[]).reduce((e,t)=>{var r;return(null!==(r=t.segments)&&void 0!==r?r:[]).forEach(t=>{var r;return e[null!==(r=t.id)&&void 0!==r?r:""]=t}),e},{}),D=f(T.materials),A=new Map;T.extra_info=null;let C={align_mode:"",mutable_materials:[]},R={},x={};for(let e of r){if(!(0,l.hey)(e))continue;let t=e.material.path,r=null===(n=e.material.freeze)||void 0===n?void 0:n.sourceMaterialPath;t&&r&&(R[t]=r,x[r]=t)}let O={};for(let e of r){if(!(0,l.hey)(e))continue;let t=e.material.path;O[t]=(null!==(o=O[t])&&void 0!==o?o:0)+1}let F={},N={};for(let e of r){let r=P[e.id],a=D[e.material.id];if(!!r&&!!a)if((0,l.hey)(e)){;let i=h(a),n="";if(u(e.material)?(n=A.get(e.material.materialId)||`videos/covers/${e.material.id}.jpeg`,A.set(e.material.materialId,n)):a.path&&(n=A.get(a.path)||`videos/covers/${e.material.id}.jpeg`,A.set(a.path,n)),i.cover_path=n,!function(e,t){let{crop_scale:r}=t;if(e.clip){var a,i,n;let{scale:o={}}=e.clip;e.clip.scale={x:(null!==(a=o.x)&&void 0!==a?a:0)*r,y:(null!==(i=o.y)&&void 0!==i?i:0)*r},t.crop_scale=1,1!==r&&(null===(n=e.common_keyframes)||void 0===n||n.forEach(e=>{if([l.Eu.KFTypeScaleX,l.Eu.KFTypeScaleY].includes(e.property_type)){var t;null===(t=e.keyframe_list)||void 0===t||t.forEach(e=>{var t;if((null===(t=e.values)||void 0===t?void 0:t.length)===1){let t=e.values[0];e.values=[t*r]}})}}))}}(r,a),r.reverse&&(a.reverse_path=""),a.matting&&(a.matting.path=""),!function(e,t){let r=(0,l.MnT)(t);(null==r?void 0:r.path)&&(t.is_ai_generate_content=!1,r.path="",(0,l.Jqc)(t,r)),t.has_audio=!1,e.intensifies_audio=!1,t.intensifies_path=""}(r,a),t.is_mute?(r.volume=0,null===(s=r.common_keyframes)||void 0===s||s.forEach(e=>{var t;if(e.property_type===l.Eu.KFTypeVolume)null===(t=e.keyframe_list)||void 0===t||t.forEach(e=>{e.values=[0]})})):r.volume=(null!==(c=r.volume)&&void 0!==c?c:0)>0?r.volume:1,S=0,(M=a).video_algorithm&&(M.video_algorithm.path=""),t.is_group){let t=e.material.path;if((null!==(d=O[t])&&void 0!==d?d:0)>1){if(!F[t]){let e=Object.keys(F).length;F[t]=`v${e}`}i.relation_video_group=null!==(p=F[t])&&void 0!==p?p:""}}if(t.is_freeze_group){let t=e.material.path,r="";if(R[t]?r=R[t]:x[t]&&(r=t),r){let e=Object.keys(N).length;N[t]=`v${e}`}i.freeze_group=null!==(m=N[r])&&void 0!==m?m:""}let{extra_material_refs:o=[]}=r,_=o.filter(e=>{var t,r;return(null===(t=w[e])||void 0===t?void 0:t.type)===l.cVg.MetaTypeAudioEffect&&[l.xbm.AudioEffectTypeVCVoiceChange,l.xbm.AudioEffectTypeSpeechToSong].includes(null===(r=w[e])||void 0===r?void 0:r.sub_type)});g(r,T.materials,"audio_effects",_);let f=o.filter(e=>!!I[e]);g(r,T.materials,"vocal_separations",f);let v=o.filter(e=>{var t;return(null===(t=b[e])||void 0===t?void 0:t.type)===l.cVg.MetaTypeFigure});g(r,T.materials,"effects",v);let y=o.filter(e=>!!k[e]);g(r,T.materials,"manual_deformations",y);let P=o.filter(e=>!!E[e]);g(r,T.materials,"chromas",P),!function(e,t){var r;let{object_locked:a}=t;if(!!a)a.effect&&(a.effect.path=""),a.cache_path="",e.common_keyframes=null===(r=e.common_keyframes)||void 0===r?void 0:r.filter(e=>e.property_type!==l.Eu.KFTypeObjectLocked)}(r,a),!function(e,t){var r;let{smart_motion:a}=t;if(!!a)a.effect&&(a.effect.path=""),a.cache_path="",a.beats_path="",e.common_keyframes=null===(r=e.common_keyframes)||void 0===r?void 0:r.filter(e=>e.property_type!==l.Eu.KFTypeSmartMotion)}(r,a),C.mutable_materials.push(i)}else if((0,l.Y9Q)(e)){let e=h(a);r.intensifies_audio=!1,a.intensifies_path="",C.mutable_materials.push(e)}else if((0,l.Ftn)(e)){let e=h(a),t=(null!==(v=a.content)&&void 0!==v?v:"").replaceAll("<select>","").replaceAll("</select>","");a.content=t,C.mutable_materials.push(e)}else(0,l.Q2R)(e)&&(null==a||null===(y=a.text_info_resources)||void 0===y||y.forEach(e=>{var t,r;let a=D[null!==(t=e.text_material_id)&&void 0!==t?t:""];if(!a)return;let i=(null!==(r=a.content)&&void 0!==r?r:"").replaceAll("<select>","").replaceAll("</select>","");a.content=i,C.mutable_materials.push(h(a))}))}return C.align_mode=t.align_mode,T.mutable_config=C,{template:T,mutableVideoCovers:A}}function v(e,t){var r,a,n,o;let s=(0,i.Z)(e),l=new Set(t.map(e=>{var t,r;return null!==(r=null==e?void 0:null===(t=e.material)||void 0===t?void 0:t.id)&&void 0!==r?r:""}));return null===(a=s.materials)||void 0===a||null===(r=a.videos)||void 0===r||r.forEach(e=>{e.source_platform=0,e.id&&l.has(e.id)&&(e.path="")}),null===(o=s.materials)||void 0===o||null===(n=o.audios)||void 0===n||n.forEach(e=>{e.music_id="",e.effect_id="",e.source_platform=0}),s}function y(e,t){return{template_draft:{editable_materials:t.filter(t=>{let r=e[t.id];return!!r&&r.trackFlag===l.w9k.FlagSubVideo&&(0,l.hey)(r)}).map(e=>({editable_material_keyframes:[],id:e.material.id,intelligent_type:"",platform:"all",tracking:{target:""}})),version:"1.1.0"}}}function S(e,t){return e.startsWith(`/${t}`)}function M(e,t){return`/${t}${e}`}function T(e,t){var r,a,i,n,o;let c=e[t.material_id],d="";switch(t.source_platform){case l.cvu.MaterialPlatformArtist:d=`heycan://${t.material_id}`;break;case l.cvu.MaterialPlatformGiphy:d=`giphy://${t.material_id}`;break;case l.cvu.MaterialPlatformTuchongAdobe:case l.cvu.MaterialPlatformTuchongDeposit:case l.cvu.MaterialPlatformTuchongPond5:(null==c?void 0:null===(r=c.order)||void 0===r?void 0:r.source)&&(null==c?void 0:null===(a=c.order)||void 0===a?void 0:a.id)?d=`tuchong://${null===(i=c.order)||void 0===i?void 0:i.source}/${null===(n=c.order)||void 0===n?void 0:n.id}`:(null==c?void 0:c.source)&&(null==c?void 0:c.resourceId)&&(c.source===s.Hw.TUCHONG?d=`tuchong://${c.source}/${c.resourceId}`:c.source===s.Hw.HEYCAN&&(d=`heycan://${t.material_id}`))}return{schema:d,source:null!==(o=null==c?void 0:c.source)&&void 0!==o?o:0}}function b(e,t,r,a,o,s,d,h){var p,_,g,m,v,y,b,k;let w=(0,i.Z)(d),I=f(w.materials),E=new Set((null!==(m=null===(p=w.mutable_config)||void 0===p?void 0:p.mutable_materials)&&void 0!==m?m:[]).map(e=>e.id)),P=null!==(v=null===(_=w.materials)||void 0===_?void 0:_.videos)&&void 0!==v?v:[],D=null!==(y=null===(g=w.materials)||void 0===g?void 0:g.audios)&&void 0!==y?y:[],A=JSON.stringify(w),C=null!==(b=s.reduce((e,t)=>(e[t.segmentId]=t,e),{}))&&void 0!==b?b:{},R=null!==(k=s.reduce((e,t)=>(e[t.materialId]=t,e),{}))&&void 0!==k?k:{},x=[];a.filter(e=>!(!e.source_path||[l.Fxj,l.VQb].includes(e.source_path))&&A.includes(e.source_path)).forEach(e=>{let t=P.filter(t=>{var r;return null===(r=t.path)||void 0===r?void 0:r.includes(e.source_path)});t.length?t.forEach(t=>{var a,i;let n=E.has(null==t?void 0:t.id),o=I[null==t?void 0:t.id],s=n?"":e.source_path;!n&&s&&!S(s,"videos")&&o&&!R[t.id]&&(s=M(s,"videos"),o.path=s),x.push({md5:e.md5,spaceId:r.space_id,spaceIdc:r.space_idc,path:s,coverPath:n&&null!==(i=h.get(null!==(a=null==t?void 0:t.path)&&void 0!==a?a:""))&&void 0!==i?i:"",isPublic:!n})}):x.push({md5:e.md5,spaceId:r.space_id,spaceIdc:r.space_idc,path:e.source_path,isPublic:!0})}),x=function(e,t,r,a){let i=a.filter(e=>!e.path),n=a.filter(e=>!!e.path),o=[],s=[];n.forEach(a=>{var i,n,l;let d=null===(i=r[a.path])||void 0===i?void 0:i.id;if(t[d]){let t=e[d];(null===(l=a.path)||void 0===l?void 0:l.includes(null===(n=t.material)||void 0===n?void 0:n.path))?o.push(a):!(0,c.U3)(t)&&s.push(a)}else o.push(a)});let d=s.reduce((e,a)=>{let i=r[a.path];return!e[i.id]&&(e[i.id]={fileInfo:[],videoAlgorithm:t[i.id]}),e[i.id].fileInfo.push(a),e},{}),u=Object.keys(d).map(t=>{let r=d[t],a=e[t],i=r.fileInfo.reduce((e,t)=>{var r,i;let n=null===(i=a.material)||void 0===i?void 0:null===(r=i.matting)||void 0===r?void 0:r.path;if(null==n?void 0:n.includes(t.path)){let[r,i]=n.split(";");a.material.type===l.cVg.MetaTypePhoto?e.result=t.path:(e.matting=r,e.edgeProduct=i)}else e.result=t.path;return e},{});return{pipelineId:r.videoAlgorithm.pipelineId,pipelinePath:i,isPublic:!0}});return i.concat(o,u)}(e,C,o,x);let O=P.filter(e=>!!E.has(e.id)&&u(e)),F=new Set;for(let t of Object.keys(e)){let r=e[t];(0,c.U3)(r)&&(0,l.hey)(r)&&F.add(r.material.materialId)}let N=O.map(e=>{var r,a,i,n,o;let{schema:s,source:l}=T(t,e),c=F.has(e.material_id),d=null!==(r=e.path)&&void 0!==r?r:"",u=I[e.id];return d&&!S(d,"videos")&&u&&(d=M(d,"videos"),u.path=d),{materialId:null!==(a=e.material_id)&&void 0!==a?a:"",materialSchema:s,materialSource:l,materialType:null!==(i=e.type)&&void 0!==i?i:"",coverPath:null!==(o=h.get(null!==(n=e.material_id)&&void 0!==n?n:""))&&void 0!==o?o:"",isPublic:!1,path:c?d:""}}),V=P.filter(e=>!E.has(e.id)&&u(e)).map(e=>{var r,a,i;let n=I[e.id],{schema:o,source:s}=T(t,e),l=null!==(r=e.path)&&void 0!==r?r:"";return l&&!S(l,"videos")&&n&&!R[e.id]&&(l=M(l,"videos"),n.path=l),{materialId:null!==(a=e.material_id)&&void 0!==a?a:"",materialSchema:o,materialSource:s,materialType:null!==(i=e.type)&&void 0!==i?i:"",path:l,isPublic:!0}}),L=D.filter(e=>!!(e.music_id||e.effect_id)).map(e=>{var r,a,i;let n=I[e.id],{schema:o,source:s}=function(e,t){var r,a;let i=null!==(r=t.music_id||t.effect_id)&&void 0!==r?r:"",n=e[i],o="";switch(t.source_platform){case l.QZ3.AudioPlatformArtist:o=`heycan://${i}`;break;case l.QZ3.AudioPlatformBrand:o=`brand://${i}`;break;case l.QZ3.AudioPlatformLibrary:o=`lib://${i}`}return{schema:o,source:null!==(a=null==n?void 0:n.source)&&void 0!==a?a:0}}(t,e),c=null!==(r=e.path)&&void 0!==r?r:"";return c&&!S(c,"audios")&&n&&(c=M(c,"audios"),n.path=c),{materialId:null!==(a=e.music_id||e.effect_id)&&void 0!==a?a:"",materialSchema:o,materialSource:s,materialType:null!==(i=e.type)&&void 0!==i?i:"",path:c,isPublic:!0}}),j=x.concat(N,V,L);return{template:w,fileInfo:j.filter((e,t)=>j.findIndex(t=>(0,n.Z)(e,t))===t)}}function k(e,t){var r;let a=new Set;return null===(r=t.segments)||void 0===r||r.forEach(t=>{var r,i,n,o;let s=e[t.id];if(!!s)(null==s?void 0:null===(r=s.speed)||void 0===r?void 0:r.mode)===l.yY$.SpeedModeCurve?a.add("curve_speed"):a.add("speed"),s.chroma&&a.add("chroma"),t.gameplay_algorithm&&(t.gameplay_is_aigc?a.add("ai_painting"):a.add("cartoon")),s.videoMask&&s.videoMask.length>0&&a.add("mask"),s.filter&&a.add("filter"),(null===(n=s.animations)||void 0===n?void 0:null===(i=n.animations)||void 0===i?void 0:i.length)&&a.add("animation"),(null===(o=t.material)||void 0===o?void 0:o.object_locked)&&a.add("lock_object")}),Array.from(a)}function w(e,t){var r;let a=new Set,i=null!==(r=null==t?void 0:t.tracks)&&void 0!==r?r:[];return i.filter(e=>e.type===l.pNd.TrackTypeVideo&&e.flag===l.w9k.FlagNone).forEach(t=>{a.add("clipping"),k(e,t).forEach(e=>a.add(e))}),i.filter(e=>e.type===l.pNd.TrackTypeVideo&&e.flag===l.w9k.FlagSubVideo).forEach(t=>{a.add("pip"),a.add("clipping"),k(e,t).forEach(e=>a.add(e))}),i.map(e=>{var t;return null!==(t=e.segments)&&void 0!==t?t:[]}).flat().forEach(t=>{let r=e[t.id];if(!!r)r.filter&&a.add("filter")}),i.filter(e=>e.type===l.pNd.TrackTypeText||e.type===l.pNd.TrackTypeSticker).map(e=>{var t;return null!==(t=e.segments)&&void 0!==t?t:[]}).flat().forEach(t=>{var r,i,n,o;let s=e[t.id];(null==s?void 0:null===(r=s.material)||void 0===r?void 0:r.type)===l.cVg.MetaTypeText&&(a.add("text"),(null===(o=s.effect)||void 0===o?void 0:o.name)?a.add("text_effect"):a.add("new_text")),(null==s?void 0:null===(i=s.material)||void 0===i?void 0:i.type)===l.cVg.MetaTypeTextTemplate&&a.add("text_template"),(null==s?void 0:null===(n=s.material)||void 0===n?void 0:n.type)===l.cVg.MetaTypeSubtitle&&(a.add("text"),a.add("text_recognition"))}),i.filter(e=>e.type===l.pNd.TrackTypeAudio).map(e=>{var t;return null!==(t=e.segments)&&void 0!==t?t:[]}).flat().forEach(t=>{var r;let i=e[t.id];(null==i?void 0:null===(r=i.material)||void 0===r?void 0:r.type)===l.cVg.MetaTypeTextToAudio&&a.add("text_reading")}),i.filter(e=>e.type===l.pNd.TrackTypeVideoEffect).length&&a.add("effect"),i.some(e=>{var t;return a.has("keyframe")||(null===(t=e.segments)||void 0===t?void 0:t.some(e=>{var t;return null===(t=e.common_keyframes)||void 0===t?void 0:t.some(e=>{var t;return(null===(t=e.keyframe_list)||void 0===t?!!void 0:!!t.length)&&(a.add("keyframe"),!0)})}))}),Array.from(a)}function I(e,t){var r;return(null!==(r=null==t?void 0:t.tracks)&&void 0!==r?r:[]).find(t=>{var r,a,i,n;return!(![l.pNd.TrackTypeVideo,l.pNd.TrackTypeAudio].includes(null!==(r=t.type)&&void 0!==r?r:"")||[l.$SW.HideFlag,l.$SW.MuteFlag].includes(null!==(a=t.attribute)&&void 0!==a?a:""))&&(t.type===l.pNd.TrackTypeAudio?(null!==(i=t.segments)&&void 0!==i?i:[]).find(t=>{var r,a,i;let n=e[t.id];return(null==n?!void 0:null===(r=n.material)||void 0===r?!void 0:!r.musicId)&&(null==n?!void 0:null===(a=n.material)||void 0===a?!void 0:!a.effectId)&&(null!==(i=n.volume)&&void 0!==i?i:0)>0}):(null!==(n=t.segments)&&void 0!==n?n:[]).find(t=>{var r,a,i;let n=e[t.id];return!u(null==n?void 0:n.material)&&(null==n?void 0:null===(r=n.material)||void 0===r?void 0:r.type)===l.cVg.MetaTypeVideo&&(null==n?void 0:null===(a=n.material)||void 0===a?void 0:a.hasAudio)&&(null!==(i=null==n?void 0:n.volume)&&void 0!==i?i:0)>0}))})?o.f.other:o.f.library}function E(e,t){var r,a,i;let n=(null!==(a=null===(r=t.mutable_config)||void 0===r?void 0:r.mutable_materials)&&void 0!==a?a:[]).reduce((e,t)=>(e[t.id]=!0,e),{});return!!(null!==(i=null==t?void 0:t.tracks)&&void 0!==i?i:[]).find(t=>{var r;return t.type===l.pNd.TrackTypeAudio&&(null!==(r=t.segments)&&void 0!==r?r:[]).find(t=>{var r,a,i;return!!n[null!==(i=null===(a=e[t.id])||void 0===a?void 0:null===(r=a.material)||void 0===r?void 0:r.id)&&void 0!==i?i:""]})})||!1}function P(e,t){var r,a;let i=(null!==(a=null===(r=t.mutable_config)||void 0===r?void 0:r.mutable_materials)&&void 0!==a?a:[]).reduce((e,t)=>(e[t.id]=t,e),{}),n={};for(let t of e){let e=i[t.material.id];if(!(null==e?void 0:e.freeze_group)||t.material.freeze)continue;let r=t.sourceTimerange.start;(!n[e.freeze_group]||r<n[e.freeze_group])&&(n[e.freeze_group]=r)}return e.sort((e,t)=>{var r,a;return(null===(r=e.targetTimerange)||void 0===r?void 0:r.start)>(null===(a=t.targetTimerange)||void 0===a?void 0:a.start)?1:-1}).map(e=>{var t;let{material:r,sourceTimerange:a,targetTimerange:o,smartCrop:s}=e,{matting:c,freeze:d,objectLocked:u,smartMotion:h}=r,p=i[r.id],_={material_id:r.id,target_start:l.pMA.div(o.start,1e3,"number"),duration:l.pMA.div(a.duration,1e3,"number"),video_width:r.width,video_height:r.height,relation_video_group:null==p?void 0:p.relation_video_group,ai_matting:Number(null!==(t=null==c?void 0:c.flag)&&void 0!==t?t:0),is_reversed:e.reverse,is_object_locked:!!u,is_smart_motion:!!h,is_smart_crop:!!s};if(_.freeze_group=null==p?void 0:p.freeze_group,_.freeze_group&&d){let e=d.timestamp,t=n[_.freeze_group];_.freeze_timestamp=l.pMA.div(l.pMA.minus(e,t,"bigint"),1e3,"number")}let g=(0,l.MnT)(r);if(g){let{adjustableConfig:e,adjustParams:t,algorithm:r,abilityFlag:a}=g;_.gameplay_algorithm=r,_.gameplay_algorithm,_.gameplay_ability_flag=a,e&&(_.gameplay_adjustable_config={lightwave_repeat_duration:Number(e.lightwaveRepeatDuration),stopmotion_gap_duration:Number(e.stopmotionGapDuration),stopmotion_first_render_time:Number(e.stopmotionFirstRenderTime),prompt:e.prompt,strength:e.strength,beat_source:e.beatSource,beat_gear:e.beatGear,speed:e.speed}),t&&(_.gameplay_adjust_params=t.map(e=>({name:e.name,value:e.value,default_value:e.defaultValue})))}return _})}},903554:function(e,t,r){r.d(t,{Z:function(){return g}});var a=r(772322),i=r(218571),n=r(670933),o=r(105789),s=r.n(o),l=r(801497),c=r(893354),d=r(623087),u=r(165092),h=r(175994),p=r(54059),_=r(979708);let g=(0,n.f3)("store","modules")((0,n.Pi)(e=>{let{store:t,modules:r}=e,n=(0,i.useRef)(null),{mainDraftService:o,mainEditorWidgetService:g,templatePostManager:f}=r,{[u.gq]:{active:m},[u.s9]:{formValue:v,formConfig:y}}=t;f.formManager.bindFormInstance(n);let S=o.dataSdk.draftView.getCanvasConfig(),{duration:M}=o.dataSdk.draftView.getDraftMetadata(),T=(0,i.useCallback)(e=>new Promise((t,r)=>{let a=g.timelineManager.templatePost.getTemplatePostMutableSegments();if(e.template_type===h.xw.video_template&&!a.length){c.Z.warning(l.ZP.t("web_posttemplate_text_select_one_material",{},"Include at least 1 clip to be replaced"),{getContainer:()=>document.getElementById(p.$I)}),r();return}t()}),[]),b=(0,i.useCallback)(()=>f.formManager.submit(),[]),k=(0,i.useCallback)(e=>{f.formManager.setFormValue(e)},[f]);return(0,a.jsx)("div",{id:p.$I,className:s()(p.$I,_.Z.view,m?_.Z.active:void 0),children:(0,a.jsxs)("div",{className:_.Z.wrapper,children:[(0,a.jsx)("div",{className:_.Z.title,children:l.ZP.t("web_posttemplate_button_post_as_template",{},"Post as template")}),(0,a.jsx)("div",{className:_.Z.content,children:(0,a.jsx)(d.Z,{ref:n,value:v,config:y,beforeSubmit:T,onChange:k,onSubmit:b,active:m,coverSize:(null==S?void 0:S.width)&&S.height?[S.width,S.height]:void 0,duration:Number(M)/1e3})})]})})}))},111937:function(e,t,r){r.d(t,{DQ:function(){return n},Gn:function(){return o}});var a=r(368536);r(801497);var i=r(155416);let n="siderMenuCaption";a.Zw.square;let o={[i.rF.SUBTITLE_SRT]:"srt",[i.rF.SUBTITLE_TXT]:"txt",[i.rF.SUBTITLE_ASS]:"ass",[i.rF.SUBTITLE_LRC]:"lrc"}},155416:function(e,t,r){r.d(t,{RF:function(){return o},b4:function(){return s},rF:function(){return l}});var a,i,n,o=((a={}).AutoSubtitles="AutoSubtitles",a.IdentifyLyrics="IdentifyLyrics",a);var s=((i={}).Subtitle="subtitle",i.Lyric="lyric",i.Transcribe="trim_with_transcript",i);var l=((n={})[n.SUBTITLE_UNKONWN=0]="SUBTITLE_UNKONWN",n[n.SUBTITLE_SRT=1]="SUBTITLE_SRT",n[n.SUBTITLE_ASS=2]="SUBTITLE_ASS",n[n.SUBTITLE_LRC=3]="SUBTITLE_LRC",n[n.SUBTITLE_TXT=4]="SUBTITLE_TXT",n)},6183:function(e,t,r){r.d(t,{P:function(){return c}});var a=r(772322);r(363791);var i=r(193568),n=r(150564),o=r(801497),s=r(586210),l=r(728631);let c={siderMenu:[{id:s.DQ,name:l.j.SiderMenuElement,position:"top",icon:()=>(0,a.jsx)(n.maj,{}),tooltips:()=>o.ZP.t("web_left_panel_tab_elements",{},"Elements"),title:()=>o.ZP.t("web_left_panel_tab_elements",{},"Elements")}],siderMenuPanel:[{name:l.j.SiderMenuElement,skeleton:()=>(0,a.jsx)(i.Z,{})}]}},864:function(e,t,r){r.d(t,{D:function(){return a}});let a="siderMenuFilter"},330509:function(e,t,r){r.d(t,{P:function(){return c}});var a=r(772322);r(363791);var i=r(193568),n=r(150564),o=r(801497),s=r(539309),l=r(728631);let c={siderMenu:[{id:s.DQ,name:l.j.SiderMenuPlugin,position:"top",icon:()=>(0,a.jsx)(n.rjZ,{}),tooltips:()=>o.ZP.t("web_store_title_app",{},"Plugins"),title:()=>o.ZP.t("web_store_title_app",{},"Plugins"),appendDividerBefore:!0}],siderMenuPanel:[{name:l.j.SiderMenuPlugin,skeleton:()=>(0,a.jsx)(i.Z,{})}]}},326211:function(e,t,r){r.d(t,{D:function(){return a}});let a="siderMenuShortcut"},389301:function(e,t,r){r.d(t,{P:()=>_});var a=r("772322"),i=r("150564"),n=r("801497"),o=r("118249"),s=r("728631"),l=r("105789"),c=r.n(l),d=r("472334"),u=r("164736");let h=e=>{let{containerWidth:t}=e;return(0,a.jsx)("div",{className:u.Z.entryContainer,children:(0,a.jsx)("div",{className:c()(u.Z.viewBox,{[u.Z.initializing]:!0}),children:(0,a.jsx)(d.ZP,{skeletonWidth:t,skeletons:["waterfall-hori-list"],isLoading:!0})})})};var p=r("446198");let _={siderMenu:[{id:o.DQ,name:s.j.SiderTabTemplate,position:"top",icon:()=>(0,a.jsx)(i.BdQ,{}),tooltips:()=>n.ZP.t("web_newtemplates_title_templates",{},"Templates"),title:()=>n.ZP.t("web_newtemplates_title_templates",{},"Templates")}],siderMenuPanel:[{name:s.j.SiderTabTemplate,skeleton:e=>{let{containerWidth:t}=e;return(0,a.jsx)(h,{containerWidth:(0,p._)(t)})}}]}},595416:function(e,t,r){r.d(t,{N8:function(){return l},_g:function(){return s},hk:function(){return o}});var a,i,n,o=((a={}).ENTRY="entry",a.TRANSCRIPTING="transcripting",a.EDIT_LIST="editList",a.NO_CONTENT="noContent",a.ERROR_PANEL="errorPanel",a.CONTINUE_GENERATE="continueGenerate",a);var s=((i={}).AutoSubtitles="AutoSubtitles",i.IdentifyLyrics="IdentifyLyrics",i);var l=((n={}).Forward="Forward",n.Backward="Backward",n)},340234:function(e,t,r){r.d(t,{P:()=>v});var a=r("772322"),i=r("150564"),n=r("801497"),o=r("391701"),s=r("728631");r("738683");var l=r("233189"),c=r("376933"),d=r("472334"),u=r("127830"),h=r("105789"),p=r.n(h),_=r("911378"),g=r("433336");let f=e=>{let{containerWidth:t}=e;return(0,a.jsx)("div",{className:_.Z.entryContainer,children:(0,a.jsxs)(c.Z,{className:p()(_.Z.viewBox),activeTab:u._g.TextTemplate,children:[(0,a.jsx)(l.Z.TabPane,{title:n.ZP.t("text_overlay",{},"Text Template"),children:(0,a.jsx)("div",{className:p()(g.Z.entryContainer,{[g.Z.initializing]:!0}),children:(0,a.jsx)(d.ZP,{isLoading:!0,skeletons:["bar","small-bar","bar","small-bar","base-list"],skeletonWidth:t})})},u._g.TextTemplate),(0,a.jsx)(l.Z.TabPane,{title:n.ZP.t("new_web_text",{},"Text effects")},u._g.TextPreset)]})})};var m=r("446198");let v={siderMenu:[{id:o.D,name:s.j.SiderMenuText,position:"top",icon:()=>(0,a.jsx)(i.lFi,{}),tooltips:()=>n.ZP.t("text_web",{},"Text"),title:()=>n.ZP.t("text_web",{},"Text")}],siderMenuPanel:[{name:s.j.SiderMenuText,skeleton:e=>{let{containerWidth:t}=e;return(0,a.jsx)(f,{containerWidth:(0,m._)(t)})}}]}},133864:function(e,t,r){r.d(t,{DB:function(){return l},FT:function(){return d},QH:function(){return n},U5:function(){return s},oS:function(){return o},tu:function(){return i}});var a=r(127830);let i=e=>{let t=e.map(e=>e.name).join(","),r=e.map(e=>e.resourceId).join(",");return{material_name:t,material_id:r,vip_material_name:t,vip_material_id:r,vip_material_type:e.map(e=>e.metaType).join(",")}},n=e=>{let t=e.map(e=>e.reportId).join(",");return{vip_function_name:e.map(e=>e.reportId).join(","),vip_function_id:t}},o=(e,t)=>({total_cnt:e.length+t.length,vip_material_cnt:e.length,vip_function_cnt:t.length,...t.length?n(t):{},...e.length?i(e):{}}),s=(e,t)=>{let r=e.length+t.length,a=[...e,...t];return{total_cnt:r,copyright_personal_use_cnt:e.length,copyright_commercial_use_cnt:t.length,...r?i(a):{}}},l=(e,t)=>{var r,a,i;let n=null!==(r=e.vipValidEffects)&&void 0!==r?r:[],s=null!==(a=null==t?void 0:t.vipValidTools)&&void 0!==a?a:[],l=o(n,[...s,...null!==(i=null==t?void 0:t.vipHiddenTools)&&void 0!==i?i:[]]),{material_name:c}=l,{material_id:d}=l;return c&&(l.vip_material_name=c,delete l.material_name),d&&(l.vip_material_id=d,delete l.material_id),l},c={[a._g.TextGlow]:"text_glow",[a._g.SubtitleTemplate]:"caption_template",[a._g.AutoBeautyShape]:"auto-beauty",[a._g.AutoBeautyFace]:"auto-beauty2",[a._g.AutoBeautyMakeup]:"makeup",[a._g.AutoBeautyBody]:"auto-beauty3"},d=(e,t)=>{var r,a,i;let n=null!==(r=e.vipValidEffects)&&void 0!==r?r:[],o=null!==(a=null==t?void 0:t.vipValidTools)&&void 0!==a?a:[],s=[...o,...null!==(i=null==t?void 0:t.vipHiddenTools)&&void 0!==i?i:[]].map(e=>{var t,r,a;return null!==(a=null!==(r=c[null==e?void 0:null===(t=e.effect)||void 0===t?void 0:t.resourceType])&&void 0!==r?r:e.reportId)&&void 0!==a?a:e.name});return n.forEach(e=>{e.resourceType&&c[e.resourceType]&&s.push(c[e.resourceType])}),{vipRightName:[...new Set(s)].join(",")}}},345276:function(e,t,r){r.d(t,{DQ:function(){return a},jR:function(){return i}});let a="titlebarCollaborator",i={TitlebarCollaborator:a}},554814:function(e,t,r){r.d(t,{DQ:function(){return a},jR:function(){return i},qb:function(){return o}});let a="titlebarCopyright",i={TitlebarCopyright:"TitlebarCopyright"};var n,o=((n={}).Yellow="yellow",n.Green="green",n.Red="red",n.None="none",n)},157488:function(e,t,r){r.d(t,{K:function(){return d}});var a=r(772322);r(17435);var i=r(629913);r(218571);var n=r(801497),o=r(958444),s=r(105789),l=r.n(s),c=r(517847);r(528811);let d=(0,r(670933).Pi)(e=>{let{observableData:t,onCursorChange:r,onClick:s,onMouseOver:d,onMouseEnter:u}=e,{cursorMode:h,isDisabled:p}=t,_=e=>{if(!p)null==r||r(e)},g=e=>e===c.W.Mouse?(0,a.jsx)(o.CNV,{size:"20"}):e===c.W.Hand?(0,a.jsx)(o.g9w,{size:"20"}):void 0,f={[c.W.Mouse]:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:n.ZP.t("web_graphic_header_dropdown_move",{},"Move")}),(0,a.jsx)("span",{className:"cursor-menu-tooltip-shortcut",children:"V"})]}),[c.W.Hand]:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:n.ZP.t("web_graphic_header_dropdown_hand_tool",{},"Hand tool")}),(0,a.jsx)("span",{className:"cursor-menu-tooltip-shortcut",children:"H"})]})};return(0,a.jsx)("div",{style:{display:"flex"},onClick:s,onMouseOver:d,onMouseEnter:u,children:[c.W.Mouse,c.W.Hand].map(e=>(0,a.jsx)(i.Z,{position:"bottom",triggerProps:{trigger:"hover",popupAlign:{bottom:5}},content:f[e],mini:!0,children:(0,a.jsx)("div",{className:l()("cursor-menu-content",{active:e===h,disabled:p}),onClick:()=>_(e),children:(0,a.jsx)("div",{className:"cursor-menu-item",children:(0,a.jsx)("span",{className:"menu-left-just",children:g(e)})})})},e))})})},806124:function(e,t,r){r.d(t,{K:function(){return s}});var a=r(772322);r(17435);var i=r(629913);r(218571);var n=r(105789),o=r.n(n);r(387210);let s=(0,r(670933).Pi)(e=>{var t;let{observableData:r,tooltips:n,renderIcon:s,onClick:l,onMouseOver:c,onMouseEnter:d}=e,{isDisabled:u}=r,h=()=>{if(!u)null==l||l()};return(0,a.jsx)(i.Z,{position:"bottom",triggerProps:{trigger:"hover",popupAlign:{bottom:5}},mini:!0,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:null==n?void 0:n.content()}),(0,a.jsx)("span",{className:"custom-tooltip-shortcut",children:null==n?void 0:null===(t=n.subContent)||void 0===t?void 0:t.call(n)})]}),children:(0,a.jsx)("div",{className:o()("custom-tooltip-content",{active:!u,disabled:u}),onClick:()=>h(),onMouseOver:c,onMouseEnter:d,children:(0,a.jsx)("div",{className:"custom-tooltip-content-menu-item",children:(0,a.jsx)("span",{className:"menu-left-just",children:s})})})})})},540266:function(e,t,r){r.d(t,{C2:function(){return v},DQ:function(){return l},Fs:function(){return p},Gm:function(){return f},HJ:function(){return u},JY:function(){return _},Jp:function(){return M},ZV:function(){return g},aN:function(){return m},cf:function(){return T},jR:function(){return c},kr:function(){return S},to:function(){return d},y7:function(){return h},zH:function(){return y}});var a,i,n,o=r(772322),s=r(801497);let l="titlebarExport",c={TitlebarExport:l},d=4096,u={240:"240p",320:"320p",640:"640p"},h={360:"360p",480:"480p",720:"720p",1080:"1080p",1440:"2k",2160:"4k"},p={get 720(){return s.oc.t("web_recommend_video_resolution2",{},"Recommended on TikTok Ads Manager")},get 1080(){return s.oc.t("web_recommend_video_resolution1",{},"Recommended on TikTok")}},_={DEFINITION:Object.entries(h).map(e=>{let[t,r]=e;return{key:r,value:Number(t)}}),QUALITY:[{label:()=>(0,o.jsx)(o.Fragment,{children:s.oc.t("high_web_quality",{},"\u8F83\u9AD8\u753B\u8D28")}),value:2},{label:()=>(0,o.jsx)(o.Fragment,{children:s.oc.t("recommend_web_quality",{},"\u63A8\u8350\u753B\u8D28")}),value:1},{label:()=>(0,o.jsx)(o.Fragment,{children:s.oc.t("exporeted_v_cloud",{},"\u8F83\u5FEB\u5BFC\u51FA")}),value:0}],FPS:[{key:"24fps",value:24},{key:"25fps",value:25},{key:"30fps",value:30},{key:"50fps",value:50},{key:"60fps",value:60}],FORMAT:[{key:" MP4",value:"mp4"},{key:"MOV",value:"mov"}]},g={24:"24fps",25:"25fps",30:"30fps",50:"50fps",60:"60fps"},f={get 0(){return s.oc.t("exporeted_v_cloud",{},"\u8F83\u5FEB\u5BFC\u51FA")},get 1(){return s.oc.t("recommend_web_quality",{},"\u63A8\u8350\u753B\u8D28")},get 2(){return s.oc.t("high_web_quality",{},"\u8F83\u9AD8\u753B\u8D28")}};var m=((a={}).DUPLICATE="200407",a.NOT_LOGIN="1015",a.INSUFFICIENT_SPACE="200406",a.INVALID_NAME="200409",a);let v="/my-cloud",y="/asset-management-material";var S=((i={}).CLICK="click",i.TRIGGER="trigger",i);var M=((n={})[n.DEFAULT=0]="DEFAULT",n[n.TEMPLATE=3]="TEMPLATE",n);let T={id:"ecommerce-export-logger",prefix:"EcommerceExportLogger"}},372870:function(e,t,r){r.d(t,{D:function(){return a},j:function(){return i}});let a="titlebarFeedback",i={TitlebarFeedback:a}},49189:function(e,t,r){r.d(t,{P:function(){return s}});var a=r(772322),i=r(962688),n=r(402309),o=r(515379);let s={titleBar:[{name:i.jR.TitlebarSaveStatus,position:"left",type:"Custom",contributionSymbol:i.DQ,content:e=>(0,a.jsx)(n.s,{onClick:e.onClick,onMouseOver:e.onHover,isDisabled:!0}),onlyShowedWhenEditable:!0,order:o.z.SaveStatus}]}},991340:function(e,t,r){r.d(t,{Z:function(){return o}});var a=r(772322);r(55041);var i=r(519065);r(218571);var n=r(958444);r(544499);let o=e=>{var t;let{onLanguageChange:r,getCurrentLocale:o,getSupportLocales:s}=e;return(0,a.jsx)(i.Z,{className:"user-menu-container",selectedKeys:[o()],children:null==s?void 0:null===(t=s())||void 0===t?void 0:t.map(e=>(0,a.jsxs)(i.Z.Item,{onClick:()=>r(e.locale,e.text),children:[e.text,e.locale===o()?(0,a.jsx)(n.EgK,{size:20}):null]},e.locale))})}},348609:function(e,t,r){r.d(t,{D:function(){return a},j:function(){return i}});let a="titlebarSettings",i={TitlebarSettings:a}},238621:function(e,t,r){r.d(t,{DQ:function(){return a},Dj:function(){return o},T7:function(){return n},jR:function(){return i},rc:function(){return s}});let a="titlebarTemplateEditMore",i={TitlebarTemplateEditMore:"TitlebarTemplateEditMore"},n="template-edit-more-btn",o=20,s=".workbench-layout-header-container>.header-right"},682430:function(e,t,r){r.d(t,{Z:function(){return l}});var a=r(772322),i=r(218571),n=r(150564),o=r(105789),s=r.n(o);r(210113);let l=(0,i.forwardRef)((e,t)=>{let{active:r,onClick:i,onMouseOver:o,onMouseEnter:l,visuallyDisabled:c,...d}=e;return(0,a.jsx)("div",{ref:t,...d,id:"attribute-view-switch-btn",className:s()("attribute-view-nav-action-btn",{active:r,disabled:c}),onClick:i,onMouseOver:o,onMouseEnter:l,children:(0,a.jsx)(n.m5T,{className:"nav-action-icon"})})})},420092:function(e,t,r){r.d(t,{DQ:function(){return a},N3:function(){return n},YN:function(){return o},jR:function(){return i}});let a="titlebarToolbarViewMode",i={TitlebarToolbarViewMode:a},n="basic",o="lvve_toolbar_panel_mode"},170087:function(e,t,r){r.d(t,{D:function(){return a},N:function(){return i}});let a="toolbarAudioVoiceChanger",i="effects"},613049:function(e,t,r){r.d(t,{P:function(){return c}});var a=r(772322),i=r(728631),n=r(801497),o=r(150564),s=r(108917),l=r(612809);let c={toolBar:[{id:r(170087).D,name:i.j.ToolbarAudioVoiceChanger,type:"unpin",icon:()=>(0,a.jsx)(o.BMK,{fontSize:20}),title:()=>n.ZP.t("web_voice_title_effectstab",{},"Voice changer"),groups:[s.D.Audio]}],toolBarPanel:[{name:i.j.ToolbarAudioVoiceChanger,content:(0,a.jsx)(l.v,{})}]}},27844:function(e,t,r){r.d(t,{Z:function(){return o}});var a=r(772322);r(17435);var i=r(629913);r(218571),r(811900);var n=r(186087);let o=e=>{let{label:t,labelSizeType:r,tip:o,labelMarginBottom:s,style:l,children:c}=e;return(0,a.jsxs)("div",{style:l,children:[t?(0,a.jsxs)("div",{className:`attribute-label attribute-label--${null!=r?r:"default"}`,style:{marginBottom:s},children:[t,!!o&&(0,a.jsx)(i.Z,{content:o,children:(0,a.jsx)(n.Z,{className:"attribute-label--icon"})})]}):null,(0,a.jsx)("div",{children:c})]})}},940500:function(e,t,r){r.d(t,{Q:function(){return d}});var a=r(772322);r(908657);var i=r(237034),n=r(218571),o=r(105789),s=r.n(o),l=r(289647),c=r(568998);r(628545);let d=e=>{let{name:t,title:r,shouldCollapse:o=!1,className:d="",extra:u,onClick:h,style:p,showPoint:_,isEntry:g,noBottom:f,id:m}=e,v=(0,n.useMemo)(()=>r||u?(0,a.jsxs)("div",{className:"attribute-block-header",children:[(0,a.jsx)("div",{className:s()("attribute-block-header-text",{"show-guide-point":_}),children:null!=r?r:""}),u]}):null,[r,u]);return o?(0,a.jsx)(i.Z.Item,{className:s()("attribute-block",d),id:m,name:t,header:v,showExpandIcon:o,expandIcon:(0,a.jsx)(l.Z,{}),style:p,children:e.children}):(0,a.jsxs)("div",{className:s()("attribute-block",d),onClick:h,style:p,id:m,children:[v?(0,a.jsxs)("div",{className:s()("attribute-block-header-wrapper",{"attribute-block-header-wrapper-entry":g,"attribute-block-header-wrapper-no_bottom":f}),children:[v,g&&(0,a.jsx)(c.O_V,{className:"attribute-block-header-wrapper-icon"})]}):null,e.children]})}},554946:function(e,t,r){r.d(t,{CC:function(){return f},Wu:function(){return m}});var a=r(218571),i=r(517649),n=r(426336),o=r(860660),s=r(937802),l=r(695324),c=r(885756),d=r(544846),u=r(230689);let h="remove_background",p="chroma_key",_="color_picker",g={[i.bR.intensity]:"intensity",[i.bR.shadow]:"shadow",[i.bR.spill]:"overflow"},f=e=>{let t=(0,a.useRef)("slide"),r=(0,s.G)(u.t),i=(0,a.useCallback)(()=>{let t=(0,o.p8)(e);return{materialCategory:t.material_category,materialId:t.material_id,materialType:t.material_type,trackCategory:t.track_category,panelCategory:t.panel_category,functionCategory:"smart_tools"}},[e]),f=(0,a.useCallback)((a,o)=>{(0,l.b)(r,{relatedEvent:l.Z.ClickVideoFunctionEditControl});let s={...i(),subcategory:h,thirdcategory:p,fourthcategory:a?g[a]:_,method:a?t.current:"",detail:o,type:a?void 0:_,materialType:(0,n.E6P)(e)?"image":"video"};(0,c.j)(r,s)},[e,i]);return{reportAdjust:f,changeActionMethod:e=>{t.current=e},reportReset:(0,a.useCallback)(()=>{let e={...i(),subcategory:h,functionSubcategory:h,functionThirdcategory:p};(0,d.F)(r,e)},[i])}},m=e=>{let t=e.draftView.getAllSegments(),r=0,a="",i="";return t.filter(e=>(0,n.hey)(e)&&e.chroma).forEach((e,t)=>{let{chroma:o}=e;if(!(null==o?void 0:o.color))return;r+=1;let s=(0,n.E6P)(e)?"image":"video";a+=0===t?s:`,${s}`;let l=o.intensityValue?"intensity":"";[l,o.shadowValue?"shadow":""].forEach(e=>{e&&(i+=i.length?`,${e}`:e)})}),{chroma_key_material:a,chroma_key_cnt:r,chroma_key_detail:i}}},736323:function(e,t,r){r.d(t,{C7:function(){return c},UX:function(){return o},aR:function(){return d},fW:function(){return s},iZ:function(){return l},kT:function(){return u},wD:function(){return n}});var a,i,n=((a={}).Luma="luma",a.Red="red",a.Green="green",a.Blue="blue",a);let o=[{name:"luma",color:"rgb(255,255,255)",borderColor:"rgb(230,232,236)",lineColor:"#000"},{name:"red",color:"rgb(254,1,0)",borderColor:"rgb(229,5,6)",lineColor:"rgb(254,1,0)"},{name:"green",color:"rgb(0,221,0)",borderColor:"rgb(0,202,9)",lineColor:"rgb(0,221,0)"},{name:"blue",color:"rgb(21,0,254)",borderColor:"rgb(20,3,236)",lineColor:"rgb(21,0,254)"}],s=["Custom","Lighten","Darken","Fade","Contrast","Cool tone","Warm tone","Vintage"],l=.03,c=["blue","green","red"];var d=((i={}).choosePreset="choose_preset",i.addPoint="add_point",i.dragPoint="drag_point",i.deletePoint="delete_point",i.seeOriginal="see_original",i.colorPicker="color_picker",i.reset="reset",i);let u=[{key:"custom",i18nKey:"web_adjust_screen_text_setting_by",keyRealName:"Custom"},{key:"light",i18nKey:"web_adjust_screen_text_lighten",keyRealName:"Lighten"},{key:"dark",i18nKey:"web_adjust_screen_text_darken",keyRealName:"Darken"},{key:"fade",i18nKey:"web_adjust_screen_text_fade_curve",keyRealName:"Fade"},{key:"contrast",i18nKey:"web_adjust_screen_text_contrast_curve",keyRealName:"Contrast"},{key:"cool",i18nKey:"web_adjust_screen_text_cool_tone",keyRealName:"Cool tone"},{key:"warm",i18nKey:"web_adjust_screen_text_warm_tone",keyRealName:"Warm tone"},{key:"vintage",i18nKey:"web_adjust_screen_text_vintage",keyRealName:"Vintage"}]},486872:function(e,t,r){r.d(t,{LO:function(){return O},Y$:function(){return R}});var a=r(772322);r(837510),r(701840);var i=r(1297),n=r(544633),o=r(948747),s=r(794571),l=r(218571),c=r(736323),d=r(114848),u=r(717026),h=r(426336),p=r(937802),_=r(108692),g=r(896413),f=r(232297),m=r(959542),v=r(704364),y=r(731992),S=r(230689),M=r(127830),T=r(940500),b=r(436597),k=r(517614),w=r(722169),I=r(313952),E=r(229465),P=r(231471),D=r(262319);let A=new f.v("color-controls-curves-type"),C=e=>{e.forEach(e=>{var t,r,a,i,n,o,s,l,c,d,u,p;e.anchor=new h.KS6({x:null!==(s=null===(t=e.anchor)||void 0===t?void 0:t.x)&&void 0!==s?s:0,y:null!==(l=null===(r=e.anchor)||void 0===r?void 0:r.y)&&void 0!==l?l:0}),e.leftControl=new h.KS6({x:null!==(c=null===(a=e.leftControl)||void 0===a?void 0:a.x)&&void 0!==c?c:0,y:null!==(d=null===(i=e.leftControl)||void 0===i?void 0:i.y)&&void 0!==d?d:0}),e.rightControl=new h.KS6({x:null!==(u=null===(n=e.rightControl)||void 0===n?void 0:n.x)&&void 0!==u?u:0,y:null!==(p=null===(o=e.rightControl)||void 0===o?void 0:o.y)&&void 0!==p?p:0})})},R=e=>{var t,r,a,i;e[c.wD.Luma]=null!==(t=null==e?void 0:e[c.wD.Luma])&&void 0!==t?t:[],e[c.wD.Red]=null!==(r=null==e?void 0:e[c.wD.Red])&&void 0!==r?r:[],e[c.wD.Blue]=null!==(a=null==e?void 0:e[c.wD.Blue])&&void 0!==a?a:[],e[c.wD.Green]=null!==(i=null==e?void 0:e[c.wD.Green])&&void 0!==i?i:[],C(e[c.wD.Luma]),C(e[c.wD.Red]),C(e[c.wD.Blue]),C(e[c.wD.Green])};function x(e){return{[c.wD.Luma]:e.luma,[c.wD.Red]:e.red,[c.wD.Green]:e.green,[c.wD.Blue]:e.blue}}let O=(0,E.n)(e=>{var t;let r;let{segment:f,presetList:E,report:C,onApplyColorAdjustToAll:O}=e,F=(0,p.G)(_.n),N=(0,p.G)(g.a),V=(0,D.jL)(f),L=(0,v.j)({fireImmediately:!0,dataSdk:F.dataSdk}),[j,U]=(0,l.useState)(null!==(t=A.get(null==f?void 0:f.id))&&void 0!==t?t:c.wD.Luma),{value:B}=(0,P.cL)(f),[W,Z]=function(e){let[t,r]=(0,l.useState)(e?x(e):{});return(0,i.default)(()=>{r(e?x(e):{})},[e]),[t,r]}(B),G=(0,l.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];N.playerManager.pause();let a=(0,y.l)(M._g.CurvePreset,k.JN),i=N.ensureManager.ensureEffect(a);await i.waitForResourceValueReady();let n=N.ensureManager.getEffectPathForEnsuredEffect(k.JN.resourceId);R(e),(0,D.xG)(F.dataSdk,f,{segId:f.id,isKeyframe:!0,materials:[{type:h.cVg.MetaTypeColorCurves,path:n,colorCurvesParams:{resourceId:k.JN.resourceId,path:n,...e}}]},t),null==r||r()},[]),H=(0,n.default)(function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];t&&L.start(),G(e,t)}),Q=(0,l.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];await G(e,t),t&&L.end()},[]),K=(0,l.useCallback)((e,t)=>{N.renderManager.toggleVideoChromaPick(e,t)},[]),z=(0,l.useCallback)(e=>{A.set(f.id,e),U(e)},[]),Y=(0,p.G)(S.t),J=(0,l.useRef)(new m.W({onChange:H,onAfterChange:Q,onToggleVideoChromaPick:K,onToggleColorType:z,reportCurveAdjust:(e,t,r)=>{null==C||C({rgbCurve:t,type:r,fourthCategory:e})},segment:f,containerService:Y})),{activeId:$,handleSelect:q}=(0,b.Y)(f,J.current,E,!1),X=(0,l.useRef)();r=(0,l.useCallback)(()=>{if(J.current.updateSegment(f),(null==V?void 0:V.colorCurves)&&!J.current.isPreview){let e=x(V.colorCurves);J.current.updatePointsData(e),!(0,w.isEqual)(e,W)&&Z(e)}X.current=(null==V?void 0:V.colorCurves)?h.vI$.deserialize(h.vI$.serialize(V.colorCurves)):void 0},[f,W]);let ee=I.s.getRaw(X.current),et=I.s.getRaw(null==V?void 0:V.colorCurves);return!(0,w.isEqual)(ee,et)&&r(),(0,l.useEffect)(()=>{let e=O(()=>J.current.saveDataApplyToAll());return()=>{e.dispose()}},[O]),(0,a.jsx)("div",{children:E.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.Q,{name:"list",className:"attribute-color-curves-block",children:(0,a.jsx)(d.w,{onSelect:q,activeId:$,list:E})}),(0,a.jsx)(s.Z,{}),(0,a.jsx)(T.Q,{name:"chart",children:(0,a.jsx)(u.L,{points:W,curveEditorModel:J.current,curveColorType:j,segment:f})})]}):(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"panel-fallback-loading",children:(0,a.jsx)(o.Z,{webp:!0,size:25})})})})})},162183:function(e,t,r){r.d(t,{Q:function(){return n}});var a=r(772322),i=r(27844);function n(e,t,r){return n=>{let o=n.label?n.label:null!=t?t:"";return(0,a.jsx)(i.Z,{label:o,labelSizeType:r,labelMarginBottom:n.labelMarginBottom,children:(0,a.jsx)(e,{...n})})}}},284197:function(e,t,r){r.d(t,{v:function(){return a}});function a(e){let t=e.match(/rgb\((\d+), (\d+), (\d+)\)/);if(!t)throw Error("Invalid RGB color format");let[,r,a,i]=t,n=parseInt(r,10).toString(16).padStart(2,"0"),o=parseInt(a,10).toString(16).padStart(2,"0"),s=parseInt(i,10).toString(16).padStart(2,"0");return`#${n}${o}${s}`}},240662:function(e,t,r){r.d(t,{P:function(){return c}});var a=r(772322),i=r(150564),n=r(801497),o=r(734412),s=r(108917),l=r(612809);let c={toolBar:[{name:o.jR.ToolbarDigitalHuman,type:"unpin",icon:()=>(0,a.jsx)(i.mGL,{fontSize:20}),title:()=>n.ZP.t("web_edit_button_ai_character_two",{},"AI Characters"),groups:[s.D.Video,s.D.Text,s.D.TextTemplate,s.D.Caption],defaultActiveGroupList:[s.D.Video]}],toolBarPanel:[{name:o.jR.ToolbarDigitalHuman,content:(0,a.jsx)(l.v,{})}]}},767732:function(e,t,r){r.d(t,{D:function(){return a},N:function(){return i}});let a="toolbarMutableTextBasic",i="basic"},236843:function(e,t,r){r.d(t,{DQ:function(){return a},N3:function(){return i}}),r(801497);let a="toolbarMutableTextPreset",i="preset"},76031:function(e,t,r){r.d(t,{D:function(){return a},N:function(){return i}});let a="toolbarStickerBasic",i="basic"},438506:function(e,t,r){r.d(t,{D:function(){return a},N:function(){return i}});let a="toolbarStickerMotion",i="motion"},894800:function(e,t,r){r.d(t,{P:function(){return c}});var a=r(772322),i=r(728631),n=r(801497),o=r(150564),s=r(108917),l=r(612809);let c={toolBar:[{id:r(996788).DQ,name:i.j.ToolbarTextBasic,type:"unpin",icon:()=>(0,a.jsx)(o.lFi,{fontSize:20}),title:()=>n.ZP.t("basic_web",{},"Basic"),groups:[s.D.Text,s.D.Caption,s.D.MutableText],order:2,defaultActiveGroupList:[s.D.Text]}],toolBarPanel:[{name:i.j.ToolbarTextBasic,content:(0,a.jsx)(l.v,{})}]}},471202:function(e,t,r){r.d(t,{D:function(){return a},N:function(){return i}});let a="toolbarTextMotion",i="motion"},301048:function(e,t,r){r.d(t,{P:function(){return l}});var a=r(772322),i=r(877943),n=r(801497),o=r(150564),s=r(108917);let l={toolBar:[{name:i.j.ToolbarTextTracking,type:"unpin",icon:()=>(0,a.jsx)(o.nHE,{fontSize:20}),title:()=>n.ZP.t("web_elements_title_tracking",{},"Camera tracking"),groups:[s.D.Text,s.D.Caption]}],toolBarPanel:[{name:i.j.ToolbarTextTracking}]}},870375:function(e,t,r){r.d(t,{C8:function(){return n},DQ:function(){return a},N3:function(){return i}});let a="toolbarTextTts",i="text_to_speech",n={web_tts_toast_language_unsupported:"Can\u2019t generate speech. Current voice changers don\u2019t support the language of the text.",web_tts_toast_error_occurred:"Something went wrong. Try again later.",web_tts_toast_characters_limit:"Couldn\u2019t generate speech. The text reached the characters limit."}},959632:function(e,t,r){r.d(t,{P:function(){return c}});var a=r(772322),i=r(728631),n=r(801497),o=r(150564),s=r(108917),l=r(612809);let c={toolBar:[{id:r(870375).DQ,name:i.j.ToolbarTextTts,type:"unpin",icon:()=>(0,a.jsx)(o.m5_,{fontSize:20}),title:()=>n.ZP.t("web_materialSearch_title_tts",{},"TTS"),groups:[s.D.Text,s.D.TextTemplate,s.D.Caption],order:1}],toolBarPanel:[{name:i.j.ToolbarTextTts,content:(0,a.jsx)(l.v,{})}]}},594662:function(e,t,r){r.d(t,{Ec:function(){return R},r7:function(){return x},s1:function(){return C}});var a=r(772322);r(17435),r(35867);var i=r(629913),n=r(113152),o=r(218571),s=r(940500),l=r(682942),c=r(309428),d=r(937802),u=r(426336),h=r(230689),p=r(126729),_=r(238458),g=r(966697),f=r(801497),m=r(105789),v=r.n(m),y=r(478889),S=r(76350),M=r(642379),T=r(27844),b=r(896413),k=r(183346),w=r(542761),I=r(860660),E=r(951149),P=r(96233),D=r(262088),A=r(722169);let C={[P.w.Recommend]:"recommended",[P.w.Weak]:"weak",[P.w.Strong]:"strong"},R={[P.e.Fluorescent]:"fluorescent_light",[P.e.TimeLapse]:"timelapse"},x=e=>{var t,r,m;let x=(0,d.G)(g.Gw),O=(0,d.G)(b.a),F=(0,d.G)(k.AS),N=(0,d.G)(h.t),V=(0,o.useRef)(!1),[L,j]=(0,o.useState)(!1),{segment:U,commercialToolsResult:B,enableVipFeature:W,report:Z}=e,G=U.material.type===u.cVg.MetaTypeVideo,H=p.F2.Deflicker,{delta:Q,checked:K,disabled:z,loading:Y,loadingText:J,switchIntelligent:$}=(0,c.x)({segment:U,toolType:H}),q=(0,o.useMemo)(()=>[{value:P.e.Fluorescent,label:f.ZP.t("web_flicker_type_fluorescent",{},"Fluorescent light")},{value:P.e.TimeLapse,label:f.ZP.t("web_flicker_time_lapse",{},"Time-lapse")}],[]),X=(0,o.useMemo)(()=>[{value:P.w.Weak,label:f.ZP.t("web_flicker_level_weak",{},"Weak")},{value:P.w.Recommend,label:f.ZP.t("web_flicker_level_recommended",{},"Recommended")},{value:P.w.Strong,label:f.ZP.t("web_flicker_level_strong",{},"Strong")}],[]),{mode:ee,level:et}=null!==(m=null!==(r=null==Q?void 0:Q.param)&&void 0!==r?r:U.material.videoAlgorithm.deflicker)&&void 0!==m?m:{mode:P.e.Fluorescent,level:P.w.Recommend},[er,ea]=(0,o.useState)(ee),[ei,en]=(0,o.useState)(et),{enable:eo,reason:es}=(0,D.H)({segment:U}),{isVip:el}=x;(0,o.useEffect)(()=>{(0,A.isNil)(ee)||ea(ee),(0,A.isNil)(et)||en(et)},[ee,et]);let ec=(null===(t=B.web_vip_feature_video_deflicker)||void 0===t?void 0:t.benefitStatus)===_.p.Pay&&W||el,ed=(0,o.useMemo)(()=>{let e=f.ZP.t("web_flicker_feature_name",{},"Remove flicker");return(0,a.jsxs)("div",{className:y.Z.noiseReductionTitleWrap,children:[(0,a.jsx)(i.Z,{checkOverflow:!0,content:e,children:(0,a.jsx)("span",{className:v()(y.Z.title,ec&&y.Z.titleVip),children:e})}),ec?(0,a.jsx)(S.ZP,{className:"vip-tag"}):(0,a.jsx)(M.Z,{className:"free-tag"})]})},[ec]),eu=(0,I.p8)(U),eh=(0,o.useCallback)(e=>{(0,E.J)(N,{action:e,right_type:"function",right_category:"video",right_name:"deflicker",right_id:"deflicker",material_category:eu.material_category})},[N,eu.material_category]),ep=()=>{if(!z){if(L&&(F.setViewStateToLocalAndServer(k.F3.VideoBasicDeflicker,!0),j(!1)),O.playerManager.pause(),G){let{start:e,duration:t}=U.sourceTimerange,{duration:r,videoAlgorithm:a}=U.material;t!==r&&$({toolType:p.F2.VideoCut,param:{start:e,end:e+t},enable:!K})}$({toolType:H,param:{level:ei,mode:er},enable:!K}),eh("click"),(0,w.Q)(N,{status:K?"off":"on",functionCategory:"basic",functionSubCategory:"deflicker",functionThirdCategory:"basic",panelCategory:"video",trackCategory:eu.track_category})}};(0,o.useEffect)(()=>{if(!!V.current){if(V.current=!1,O.playerManager.pause(),G){let{start:e,duration:t}=U.sourceTimerange,{duration:r}=U.material;t!==r&&$({toolType:p.F2.VideoCut,param:{start:e,end:e+t},enable:!0})}$({toolType:H,param:{level:ei,mode:er},enable:!0})}},[ei,er]);let e_=(0,o.useRef)(null);return(0,o.useEffect)(()=>{eh("show")},[]),(0,o.useEffect)(()=>{!F.getViewStateFromLocal(k.F3.VideoBasicDeflicker)&&x.hasLogin&&j(!0)},[F,x]),(0,a.jsxs)(s.Q,{name:"deflicker",className:y.Z.noiseReductionBlock,children:[(0,a.jsx)("div",{onClick:e=>{var t,r;let a=null==e_?void 0:null===(t=e_.current)||void 0===t?void 0:t.querySelector("button"),i=!1;try{i=null!==(r=null==a?void 0:a.contains(e.target))&&void 0!==r&&r}catch{}Y&&i&&ep()},ref:e_,children:(0,a.jsx)(l.K,{className:y.Z.noiseReductionSwitch,title:ed,checked:K,loading:Y,disabled:z||!eo,disabledTip:z?J:eo?"":es,onChange:ep,showGuidePoint:L})}),K&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.Z,{label:f.ZP.t("web_flicker_type",{},"Type"),children:(0,a.jsx)(n.Z,{size:"small",value:er,onChange:e=>{V.current=!0,Z({method:"panel",type:"deflicker_type",option:R[e],subcategory:"deflicker"}),ea(e)},children:q.map(e=>{let{value:t,label:r}=e;return(0,a.jsx)(n.Z.Option,{value:t,children:r},t)})})}),(0,a.jsx)(T.Z,{label:f.ZP.t("web_flicker_level",{},"Level"),tip:f.ZP.t("web_flicker_level_hovertip",{},"Select \u201CWeak\u201D if the screen changes quickly.\nSelect \u201CStrong\u201D if the screen changes slowly."),children:(0,a.jsx)(n.Z,{size:"small",value:ei,onChange:e=>{V.current=!0,Z({method:"panel",type:"deflicker_level",option:C[e],subcategory:"deflicker"}),en(e)},children:X.map(e=>{let{value:t,label:r}=e;return(0,a.jsx)(n.Z.Option,{value:t,children:r},t)})})})]})]})}},532843:function(e,t,r){r.d(t,{DQ:function(){return a},N3:function(){return o},_M:function(){return n}});let a="toolbarVideoBasic";var i,n=((i={})[i.Normal=0]="Normal",i[i.Mask=1]="Mask",i[i.Color=2]="Color",i);let o="basic"},986572:function(e,t,r){r.d(t,{P:function(){return c}});var a=r(772322),i=r(728631),n=r(801497),o=r(150564),s=r(108917),l=r(612809);let c={toolBar:[{id:r(764048).D,name:i.j.ToolbarVideoMotion,type:"unpin",icon:()=>(0,a.jsx)(o._SE,{fontSize:20}),title:()=>n.ZP.t("web_materialSearch_text_motion",{},"Motion"),groups:[s.D.Video,s.D.VideoCombination,s.D.Unselected]}],toolBarPanel:[{name:i.j.ToolbarVideoMotion,content:(0,a.jsx)(l.v,{})}]}},102054:function(e,t,r){r.d(t,{N:function(){return a}});let a=(0,r(218571).lazy)(()=>r.e("3837").then(r.bind(r,478683)))},728517:function(e,t,r){r.d(t,{Z:function(){return _}});var a=r(789786),i=r(426336),n=r(690613),o=r(433140),s=r(82978),l=r(932099),c=r(593642),d=r(756024),u=r(857670),h=r(909034),p=r(550786);class _{updateRenderManager(e){this._renderManager=e}async add(e,t,r){let a;if(!this._renderManager)return(0,l.u_)(s.o.RenderManagerUndefined);let o=(0,n.oW)(""),u=(0,c.Rl)(),{uiSegmentId:_}=this._callbackOptions.beforeAddSegment(e,t,u);try{let r;try{this._callbackOptions.beforeEnsureResource(e),r=await (0,h.j1)(e.value,this._ensureManager,this._renderManager,this._resourceService)}catch(e){return d.t.error(e),o=(0,l.u_)(s.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,r)}if(!r)return o=(0,l.u_)(s.o.MissResource);let n={};try{let e=this._renderManager.fs.readdirSync(r.resPath).filter(e=>e.endsWith(".json"));n=JSON.parse(this._renderManager.fs.readFileSync(`${r.resPath}/${e}`,{encoding:"utf-8"}))}catch(e){return o=(0,l.u_)(s.o.AddSegment)}let _=this._dataSdk.api.batch.batchStart();try{var g;if(t.needInsertTargetTrack){let e=(0,l.HU)(this._dataSdk);if(!e.ok||0!==t.trackIndex&&!(e=this._dataSdk.api.track.add({trackIndex:t.trackIndex,track:new i.fQ8({id:(0,c.Rl)(),type:i.pNd.TrackTypeAdjust,flag:i.w9k.FlagNone})})).ok)return o=(0,l.u_)(s.o.AddTrack)}if(a={materials:(0,p.E)(n),name:e.value.title,trackIndex:t.trackIndex,timeRange:{start:t.start,duration:null!==(g=t.duration)&&void 0!==g?g:l.zx},segmentId:u},!(o=this._dataSdk.api.adjustment.add(a)).ok)return o=(0,l.u_)(s.o.AddSegment)}catch(e){return d.t.error(e),o=(0,l.u_)(s.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(_)}}catch(e){d.t.error(e),o=(0,l.u_)(s.o.Unknown)}finally{this._callbackOptions.afterAddSegment(o.ok?u:void 0,_)}return o}addToCurrentProgress(e,t){if(!this._renderManager)return(0,l.u_)(s.o.RenderManagerUndefined);let r=(0,u.i1)(this._renderManager.progress),{needToInsert:a,trackIndex:n}=this._dataSdk.draftView.findTrackIndexToInsert(i.pNd.TrackTypeAdjust,r,l.Ru);return this.add(e,{start:r,trackIndex:n,needInsertTargetTrack:a},t)}constructor(e,t,r,a,i){this._dataSdk=e,this._renderManager=t,this._ensureManager=r,this._callbackOptions=a,this._resourceService=i}}_=(0,a.gn)([(0,a.fM)(4,o.c),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===o.c?Object:o.c])],_)},501205:function(e,t,r){r.d(t,{U:function(){return c}});var a=r(426336),i=r(932099),n=r(593642),o=r(690613),s=r(756024),l=r(82978);class c{addSubtitles(e){return this._addCaptions({...e,type:a.cVg.MetaTypeSubtitle})}addLyrics(e){return this._addCaptions({...e,type:a.cVg.MetaTypeLyrics})}_addCaptions(e){let{type:t,segmentInfos:r,coverOld:c,trackIndex:d,needInsertTrack:u}=e,h=(0,o.oW)(""),p=this._dataSdk.api.batch.batchStart();try{if(c){let e=this._dataSdk.draftView.getSegmentsByTrackTypeAndMaterialType(a.pNd.TrackTypeText,t);e.length>0&&this._dataSdk.api.segment.delete({segIds:e.map(e=>e.id)})}let e=this._dataSdk.draftView.getAllTracks(),o=d&&!c?Math.max(1,d):void 0;if(void 0===o){let e=r[0],s=r[(null==r?void 0:r.length)-1],{start:c}=e.timeRange,d=(a.pMA.plus(s.timeRange.start,s.timeRange.duration,"bigint")||i.B7)-c,{trackIndex:u,needToInsert:p}=this._dataSdk.draftView.findTrackIndexToInsert(a.pNd.TrackTypeText,c,d);if(o=u,p&&((0,i.HU)(this._dataSdk),!this._dataSdk.api.track.add({trackIndex:u,track:new a.fQ8({id:(0,n.Rl)(),type:a.pNd.TrackTypeText,flag:a.ic0.textFlagType(t)})}).ok))return h=(0,i.u_)(l.o.AddTrack)}else if((e.length-1<o||u)&&((0,i.HU)(this._dataSdk),!this._dataSdk.api.track.add({trackIndex:o,track:new a.fQ8({id:(0,n.Rl)(),type:a.pNd.TrackTypeText,flag:a.ic0.textFlagType(t)})}).ok))return h=(0,i.u_)(l.o.AddTrack);if(r.forEach(e=>{e.clip&&(e.clip.transformY=-.7),e.material&&(e.material.fontSize||(e.material.fontSize=5))}),!(h=this._dataSdk.api.text.addSubtitles({type:t,segInfos:r,trackIndex:o})).ok)return h=(0,i.u_)(l.o.AddSegment)}catch(e){s.t.error(e),h=(0,i.u_)(l.o.Unknown)}finally{var _,g,f;this._dataSdk.api.batch.batchEnd(p);let e=this._dataSdk.draftView.getSegmentById(null!==(f=null===(_=r[0])||void 0===_?void 0:_.segmentId)&&void 0!==f?f:"")&&h.ok?null===(g=r[0])||void 0===g?void 0:g.segmentId:void 0;this._callbackOptions.afterAddSegment(e)}return h}constructor(e,t){this._dataSdk=e,this._callbackOptions=t}}},650127:function(e,t,r){r.d(t,{n:function(){return p}});var a=r(789786),i=r(932099),n=r(426336),o=r(433140),s=r(593642),l=r(690613),c=r(909034),d=r(756024),u=r(82978),h=r(857670);class p{updateRenderManager(e){this._renderManager=e}async add(e,t,r){let a;if(!this._renderManager)return(0,i.u_)(u.o.RenderManagerUndefined);let o=(0,l.ly)(),h=(0,s.Rl)(),{uiSegmentId:p}=this._callbackOptions.beforeAddSegment(e,t,h);try{let l;this._callbackOptions.beforeEnsureResource(e);try{l=await (0,c.rj)(e.value,this._ensureManager,this._renderManager,this._resourceService)}catch(e){return d.t.error(e),o=(0,i.u_)(u.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,l)}if(!l)return o=(0,i.u_)(u.o.MissResource);let p=this._dataSdk.api.batch.batchStart();try{if(t.needInsertTargetTrack){let e=(0,i.HU)(this._dataSdk);if(!e.ok||0!==t.trackIndex&&!(e=this._dataSdk.api.track.add({trackIndex:t.trackIndex,track:new n.fQ8({id:(0,s.Rl)(),type:n.pNd.TrackTypeFilter,flag:n.w9k.FlagNone})})).ok)return o=(0,i.u_)(u.o.AddTrack)}if(a=(0,i.jA)(e.value,t,l.segmentPath,t.trackIndex,h,r),!(o=this._dataSdk.api.filter.add(a)).ok)return o=(0,i.u_)(u.o.AddSegment)}catch(e){return d.t.error(e),o=(0,i.u_)(u.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(p)}}catch(e){d.t.error(e),o=(0,i.u_)(u.o.Unknown)}finally{this._callbackOptions.afterAddSegment(o.ok?null==a?void 0:a.segmentId:void 0,p)}return o}addToCurrentProgress(e,t){if(!this._renderManager)return(0,i.u_)(u.o.RenderManagerUndefined);let r=(0,h.i1)(this._renderManager.progress),{needToInsert:a,trackIndex:o}=this._dataSdk.draftView.findTrackIndexToInsert(n.pNd.TrackTypeFilter,r,i.Ru);return this.add(e,{start:r,trackIndex:o,needInsertTargetTrack:a},t)}constructor(e,t,r,a,i){this._dataSdk=e,this._renderManager=t,this._ensureManager=r,this._callbackOptions=a,this._resourceService=i}}p=(0,a.gn)([(0,a.fM)(4,o.c),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===o.c?Object:o.c])],p)},687271:function(e,t,r){r.d(t,{Q:function(){return f}});var a=r(789786),i=r(433140),n=r(932099),o=r(426336),s=r(593642),l=r(690613),c=r(498526),d=r(909034),u=r(756024),h=r(82978),p=r(857670),_=r(380455),g=r(473595);class f{updateRenderManager(e){this._renderManager=e}async add(e,t,r){let a;if(!this._renderManager)return(0,n.u_)(h.o.RenderManagerUndefined);let i=(0,l.oW)(""),p=(0,s.Rl)(),{uiSegmentId:_}=this._callbackOptions.beforeAddSegment(e,t,p);try{let l;this._callbackOptions.beforeEnsureResource(e);try{u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u7D20\u6750\u4E0B\u8F7D\u5F00\u59CB\uFF1AensureStickerResource"),l=await (0,d.v5)(e.value,this._ensureManager,this._renderManager,this._resourceService),u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u7D20\u6750\u4E0B\u8F7D\u7ED3\u675F\uFF1AensureStickerResource")}catch(e){return u.t.error(e),i=(0,n.u_)(h.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,l)}if(!l)return i=(0,n.u_)(h.o.MissResource);let _=this._dataSdk.api.batch.batchStart();u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u6DFB\u52A0\u7D20\u6750\u6279\u91CF\u4EFB\u52A1\u5F00\u59CB: batch.batchStart");try{if(t.needInsertTargetTrack){let e=(0,n.HU)(this._dataSdk);if(!e.ok||0!==t.trackIndex&&!(e=this._dataSdk.api.track.add({trackIndex:t.trackIndex,track:new o.fQ8({id:(0,s.Rl)(),type:o.pNd.TrackTypeSticker,flag:o.w9k.FlagNone})})).ok)return i=(0,n.u_)(h.o.AddTrack);u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u65B0\u589E\u8F68\u9053\uFF1Atrack.add")}a=this._resourceToStickerParam(e.value,t,p,l.segmentPath,r);let d=new c.vB(a.segInfo.segId,a.segInfo.material.resourceId,"sticker",null,this._dataSdk,this._renderManager);if(await d.setSegmentTransformParamsIfNeed(a),u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u8F6C\u6362\u7247\u6BB5\u6570\u636E\u5C42\u53C2\u6570\uFF1AsetSegmentTransformParamsIfNeed"),i=this._dataSdk.api.sticker.add(a),u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u65B0\u589E\u7247\u6BB5\u5230\u8F68\u9053\uFF1Asticker.add"),!i.ok)return i=(0,n.u_)(h.o.AddSegment)}catch(e){return u.t.error(e),i=(0,n.u_)(h.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(_),u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u6DFB\u52A0\u7D20\u6750\u6279\u91CF\u4EFB\u52A1\u7ED3\u675F: batch.batchEnd")}}catch(e){u.t.error(e),i=(0,n.u_)(h.o.Unknown)}finally{if(this._callbackOptions.afterAddSegment(i.ok?null==a?void 0:a.segInfo.segId:void 0,_),u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u6DFB\u52A0\u7ED3\u675F\u94A9\u5B50: afterAddSegment"),i.ok&&(null==a?void 0:a.segInfo.segId)){let{segId:e}=a.segInfo;g.f.add(e,{searchId:null==r?void 0:r.searchId,recommendId:null==r?void 0:r.recommendId})}}return i}addToCurrentProgress(e,t){if(!this._renderManager)return(0,n.u_)(h.o.RenderManagerUndefined);let r=(0,p.i1)(this._renderManager.progress),{needToInsert:a,trackIndex:i}=this._dataSdk.draftView.findTrackIndexToInsert(o.pNd.TrackTypeSticker,r,n.rk);return u.t.timeLog("[perf-log] -> \u6DFB\u52A0\u8D34\u7EB8","\u786E\u5B9A\u9700\u8981\u63D2\u5165\u7684\u8F68\u9053\uFF1AfindTrackIndexToInsert"),this.add(e,{start:r,trackIndex:i,needInsertTargetTrack:a},t)}_resourceToStickerParam(e,t,r,a,i){var s,l,c,d,u,h;return{trackIndex:t.trackIndex,segInfo:{segId:r,material:(0,o.Gh5)({name:e.name,path:a,iconUrl:null!==(d=null!==(c=e.previewUrl)&&void 0!==c?c:null===(s=e.icon.urlList)||void 0===s?void 0:s[0])&&void 0!==d?d:e.icon.uri,previewCoverUrl:null!==(u=null===(l=e.icon.urlList)||void 0===l?void 0:l[0])&&void 0!==u?u:e.icon.uri,resourceId:e.resourceId,sourcePlatform:e.isFromBrand?o.nj7.EffectPlatformBrand:_.t.toSourcePlatform(e.source),categoryName:null==i?void 0:i.materialThirdcategory,categoryId:null==i?void 0:i.materialThirdcategoryId,stickerId:e.effectId}),timeRange:{start:t.start,duration:null!==(h=t.duration)&&void 0!==h?h:n.rk},clip:{transformX:null==i?void 0:i.transformX,transformY:null==i?void 0:i.transformY}}}}constructor(e,t,r,a,i){this._dataSdk=e,this._renderManager=t,this._ensureManager=r,this._callbackOptions=a,this._resourceService=i}}f=(0,a.gn)([(0,a.fM)(4,i.c),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===i.c?Object:i.c])],f)},899452:function(e,t,r){r.d(t,{n:function(){return M}});var a=r(789786),i=r(234075),n=r.n(i),o=r(82978),s=r(932099),l=r(909034),c=r(380455),d=r(725341),u=r(593642),h=r(690613),p=r(426336),_=r(820193),g=r(756024),f=r(211808),m=r(433140),v=r(127830),y=r(249656),S=r(498526);class M{updateRenderManager(e){this._renderManager=e}async add(e,t){let r,a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._renderManager)return(0,s.u_)(o.o.RenderManagerUndefined);let n=(0,h.oW)(""),c=(0,u.Rl)(),{uiSegmentId:d}=this._callbackOptions.beforeAddSegment(e,t,c);try{var _,m;let d,h;let v={};this._callbackOptions.beforeEnsureResource(e);let y=e.value.source;try{if(g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7D20\u6750\u4E0B\u8F7D\u5F00\u59CB\uFF1AensureTextTemplateResource"),{resourceRecord:d,dependentResourcePathMap:v}=await (0,l.Gx)(e.value,this._ensureManager,this._renderManager),e.value.isFromBrand){if(a=await this._loadBrandTextTemplateSchema(e.value),y=(0,f.hh)(null!==(_=null==a?void 0:a.effect.source_platform)&&void 0!==_?_:f.BQ.loki),a)e.value.scriptTemplateVersion=a.effect.effect_version;else throw Error("get brandTextTemplatePresetSchema failed")}g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u7D20\u6750\u4E0B\u8F7D\u7ED3\u675F\uFF1AensureTextTemplateResource")}catch(e){return g.t.error(e),n=(0,s.u_)(o.o.EnsureResource)}finally{this._callbackOptions.afterEnsureResource(e,d)}if(!d)return n=(0,s.u_)(o.o.MissResource);g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u8BFB\u53D6\u6587\u672C\u6A21\u7248\u5F00\u59CB\uFF1A_getTemplateTexts");let{texts:M,duration:T}=null!==(m=this._getTemplateTextsAndDuration(d.resPath))&&void 0!==m?m:{texts:[],duration:-1};g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u8BFB\u53D6\u6587\u672C\u6A21\u7248\u7ED3\u675F\uFF1A_getTemplateTexts"),void 0===t.duration&&T>-1&&(t.duration=BigInt(1e6*T)),!e.value.scriptTemplateVersion&&(g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u8BFB\u53D6\u6587\u672C\u6A21\u7248\u53C2\u6570\u5F00\u59CB\uFF1AgetTemplateParam"),h=await this._renderManager.getTemplateParam(d.resPath),g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u8BFB\u53D6\u6587\u672C\u6A21\u7248\u53C2\u6570\u7ED3\u675F\uFF1AgetTemplateParam"));let b=null==a?void 0:a.style.clip,k={scaleX:null==b?void 0:b.scale_x,scaleY:null==b?void 0:b.scale_y,transformX:null==b?void 0:b.transform_x,transformY:null==b?void 0:b.transform_y,rotation:null==b?void 0:b.rotation,...i};if(r=this._resourceToTextTemplateParam({...e.value,source:y},t,c,d.segmentPath,v,M,h,k),!(k.scaleX||k.scaleY)){let e=new S.vB(r.params.segmentId,r.params.material.resourceId,"textTemplate",null,this._dataSdk,this._renderManager);await e.setSegmentTransformParamsIfNeed(r)}g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u8F6C\u6362\u7247\u6BB5\u6570\u636E\u5C42\u53C2\u6570\uFF1AsetSegmentTransformParamsIfNeed");let w=this._dataSdk.api.batch.batchStart();try{if(t.needInsertTargetTrack){let e=(0,s.HU)(this._dataSdk);if(!e.ok||0!==t.trackIndex&&!(e=this._dataSdk.api.track.add({trackIndex:t.trackIndex,track:new p.fQ8({id:(0,u.Rl)(),type:p.pNd.TrackTypeText,flag:p.w9k.FlagNone})})).ok)return n=(0,s.u_)(o.o.AddTrack);g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u65B0\u589E\u8F68\u9053\uFF1Atrack.add")}if(n=this._dataSdk.api.textTemplate.add(r),g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u65B0\u589E\u7247\u6BB5\u5230\u8F68\u9053\uFF1AtextTemplate.add"),!n.ok)return n=(0,s.u_)(o.o.AddSegment);e.value.isFromBrand&&this._restorePresetStyle(r.params.segmentId,a)}catch(e){return g.t.error(e),n=(0,s.u_)(o.o.Unknown)}finally{this._dataSdk.api.batch.batchEnd(w),g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u6DFB\u52A0\u7D20\u6750\u6279\u91CF\u4EFB\u52A1\u7ED3\u675F: batch.batchEnd")}}catch(e){g.t.error(e),n=(0,s.u_)(o.o.Unknown)}finally{this._callbackOptions.afterAddSegment(n.ok?null==r?void 0:r.params.segmentId:void 0,d),g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u6DFB\u52A0\u7ED3\u675F\u94A9\u5B50: afterAddSegment")}return n}addToCurrentProgress(e,t){if(!this._renderManager)return(0,s.u_)(o.o.RenderManagerUndefined);let{needToInsert:r,trackIndex:a}=this._dataSdk.draftView.findTrackIndexToInsert(p.pNd.TrackTypeText,this._renderManager.progress,s.rk);return g.t.timeLog("[perf-log] -> \u6DFB\u52A0\u6587\u672C\u6A21\u7248","\u786E\u5B9A\u9700\u8981\u63D2\u5165\u7684\u8F68\u9053\uFF1AfindTrackIndexToInsert"),this.add(e,{start:this._renderManager.progress,trackIndex:a,needInsertTargetTrack:r},t)}_loadBrandTextTemplateSchema(e){return new Promise((t,r)=>{let a=(0,_.nQ)(this._resourceService,v._g.TextTemplate,e).getPresetSchemaResourceToken();a.start(),a.onReady(()=>{var e;let r=new TextDecoder("utf-8").decode(null===(e=a.value)||void 0===e?void 0:e.buffer);t(r?JSON.parse(r):void 0)}),a.onError(r)})}_restorePresetStyle(e,t){let r=this._dataSdk.draftView.getSegmentById(e);if(!r||!(0,p.Q2R)(r))return;let a=t.paragraphs.map(e=>this._paragraphToTextMaterialParam(e,r.material.resources)),i=this._genUpdateMaterialOptions(r,a);i&&this._dataSdk.api.textTemplate.setMaterial({updates:[i]});let n=this._genUpdateLayoutOptions(r,a);n&&this._dataSdk.api.textTemplate.setMaterial({updates:[n]})}_genUpdateMaterialOptions(e,t){return(0,d.o)(this._dataSdk.draftView,e.id,t.map((t,r)=>{let a=e.material.textInfoResources[r];return(0,p.u3w)({textMaterialId:null==a?void 0:a.textMaterial.id,textMaterial:t,modifyFlags:[p.XHM.ModifyTextAll],selectionUpdate:!1,draftPath:""})}))}_genUpdateLayoutOptions(e,t){return(0,d.o)(this._dataSdk.draftView,e.id,t.map((t,r)=>{let a=e.material.textInfoResources[r];return(0,p.u3w)({textMaterialId:null==a?void 0:a.textMaterial.id,textMaterial:t,modifyFlags:[p.XHM.ModifyAlignment,p.XHM.ModifyTypesetting,p.XHM.ModifyLetterSpacing,p.XHM.ModifyLineSpacing],selectionUpdate:!1,draftPath:""})}))}_paragraphToTextMaterialParam(e,t){let{content:r,style:a}=e,{fontResourceId:i,effectResourceId:n}=this._parseFontAndEffectResourceId(e),o=t.find(e=>e.resourceId===i),s=t.find(e=>e.resourceId===n),l={};t.forEach(e=>l[e.resourceId]=e.path);let c=p.hMI.fixPathsInRichText(r,l),d=!p.hMI.isUsingOldTextShadowSmooth(c);return(0,p.U_g)({content:p.hMI.getOriginContentFromContent(r),replaceStyleRichText:c,alignment:a.alignment,typesetting:a.type_setting,globalAlpha:a.global_alpha,bgStyle:a.background_style,bgColor:a.background_color,bgAlpha:a.background_alpha,bgRoundRadiusScale:a.background_angle,bgWidth:a.background_width,bgHeight:a.background_height,bgHorizontalOffset:a.background_horizontal_offset,bgVerticalOffset:a.background_vertical_offset,borderColor:a.border_color,borderWidth:a.border_width,fontResId:e.font_resource_id,fontPath:null==o?void 0:o.path,fontSourcePlatform:null==o?void 0:o.sourcePlatform,fonts:o?[(0,p.bJb)({id:(0,u.Rl)(),resourceId:o.resourceId,path:o.path,sourcePlatform:o.sourcePlatform})]:void 0,fontSize:a.font_size,letterSpacing:a.letter_spacing,lineSpacing:a.line_spacing,styleName:a.style_name,textColor:a.color,textAlpha:a.text_alpha,hasShadow:a.shadow_checked,shadowColor:a.shadow_color,shadowAlpha:a.shadow_alpha,shadowAngle:a.shadow_angle,shadowSmoothing:a.shadow_smoothing,shadowSmoothingUseDiffuse:d,shadowDistance:a.shadow_distance,useEffectDefaultColor:a.use_effect_default_color,boldWidth:a.has_bold_width,italicDegree:a.italic_degree,hasUnderline:a.has_underline,underlineWidth:a.border_width,ktvColor:a.ktv_color,checkFlag:Number(a.check_flag),effectPath:null==s?void 0:s.path})}_parseFontAndEffectResourceId(e){let{fontIdPathsOut:t,effectIdPathsOut:r}=p.hMI.getAllFontAndEffectIdsFromText(e.content),a=t.length>0?t[0].id:e.font_resource_id;return{fontResourceId:a,effectResourceId:r.length>0?r[0].id:e.flower_resource_id}}_resourceToTextTemplateParam(e,t,r,a,i,n){var o;let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};return{params:{segmentId:r,material:{version:e.scriptTemplateVersion,path:a,name:e.name,effectId:e.effectId,resourceId:e.resourceId,sourcePlatform:c.t.formatEffectSourcePlatform(e.source),timeRange:new p.tnv({start:t.start,duration:null!==(o=t.duration)&&void 0!==o?o:s.B7}),formulaId:"",categoryId:d.materialThirdcategoryId,categoryName:d.materialThirdcategory,resourceTexts:n,clip:{transformX:d.transformX,transformY:d.transformY,scaleX:d.scaleX,scaleY:d.scaleY,rotation:d.rotation},ttsAutoUpdate:d.ttsAutoUpdate},resources:e.dependentResources.map(e=>{var t;return new p.r8x({panel:e.type,path:i[e.resourceId],resourceId:e.resourceId,sourcePlatform:c.t.formatEffectSourcePlatform(null!==(t=e.source)&&void 0!==t?t:y.Hw.LOKI)})}),trackIndex:t.trackIndex,type:p.cVg.MetaTypeTextTemplate},json:l}}_readContentJsonFromTextTemplatePath(e){if(!this._renderManager)return;let{fs:t}=this._renderManager,r=n().join(e,"content.json");if(!!t.isExist(r))return t.readFileSync(r,{encoding:"utf8"})}_getTemplateTextsAndDuration(e){let t=this._readContentJsonFromTextTemplatePath(e);if(!t)return;let r=[],a=JSON.parse(t),i=e=>{e.forEach(e=>{e.text_params&&r.push(e.text_params.text),i(e.children)})};if("ScriptTemplate"===a.type)a.children.forEach(e=>{var t,a;if("text"!==e.type)return;let i=null!==(a=null===(t=e.text_params)||void 0===t?void 0:t.richText)&&void 0!==a?a:"";r.push(p.hMI.getOriginContentFromContent(i))});else{var n;i((null==a?void 0:null===(n=a.root)||void 0===n?void 0:n.children)||[])}return{texts:r,duration:a.root.duration}}constructor(e,t,r,a,i){this._dataSdk=e,this._renderManager=t,this._ensureManager=r,this._callbackOptions=a,this._resourceService=i}}M=(0,a.gn)([(0,a.fM)(4,m.c),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===m.c?Object:m.c])],M)},808909:function(e,t,r){r.d(t,{x:function(){return m}});var a=r(789786),i=r(433140),n=r(932099),o=r(700933),s=r(799985),l=r(68659),c=r(426336),d=r(909034),u=r(801497),h=r(690613),p=r(800788),_=r(756024),g=r(82978),f=r(300387);class m{updateRenderManager(e){this._renderManager=e}async add(e,t,r){var a,i,l,f,m,v;if(!this._renderManager)return(0,n.u_)(g.o.RenderManagerUndefined);let y=(0,h.ly)(),S=this._dataSdk.draftView.getTrackBySegmentId(t.id);(0,p.Y2)(S);let M=new c.Uof().findNextSegment(S,t);if(!M||!(0,c.hey)(M))return this._callbackOptions.toast(u.ZP.t("web_transition_toast_between_two_clips",{},"Transition can only be added between two segments")),y=(0,n.u_)(g.o.TransitionSegmentLimit);let T=n.u$;if(!(null===(a=t.transition)||void 0===a?void 0:a.duration)){let[,e,r]=(0,o.c6)(this._dataSdk.draftView.getTracksByType(c.pNd.TrackTypeVideo),t.id);if(e&&r&&(0,c.hey)(e)&&(0,c.hey)(r)&&(T=(0,s.uJ)(e,r)),T<0){let t=c.pMA.minus(null!==(i=null==e?void 0:e.targetTimerange.duration)&&void 0!==i?i:0n,null!==(l=null==r?void 0:r.targetTimerange.duration)&&void 0!==l?l:0n)>0?r:e,a=(0,c.duj)(t)?u.ZP.t("web_template_clips_toast_add_transition_failed",{},"Can\u2019t add transition. The clip is too short."):u.ZP.t("web_clips_too_short_to_preview",{},"Video clips are too short to preview and add transitions");return this._callbackOptions.toast(a,"error"),y=(0,n.u_)(g.o.TransitionDurationLimit)}}let b=`${t.id}_transition`,{uiTransitionId:k}=this._callbackOptions.beforeAddTransition(e,t.id,b);try{let a;this._callbackOptions.beforeEnsureResource(e);try{a=await (0,d._s)(e.value,this._ensureManager,this._renderManager,this._resourceService)}catch(e){_.t.error(e)}finally{this._callbackOptions.afterEnsureResource(e,a)}if(!a)return y=(0,n.u_)(g.o.MissResource);let i=!1;try{let e=this._renderManager.fs.readFileSync(`${a.resPath}/extra.json`,{encoding:"utf-8"}),t=JSON.parse(e);i=null==t?void 0:null===(m=t.transition)||void 0===m?void 0:m.isOverlap}catch(e){_.t.error(e)}let o=null!==(v=null===(f=t.transition)||void 0===f?void 0:f.duration)&&void 0!==v?v:T;if(!this._dataSdk.api.video.setTransition(this._resourceToTransitionParam(e.value,a.segmentPath,o,t.id,i,r)).ok)return y=(0,n.u_)(g.o.AddTransition);y=(0,h.oW)({segment:t,nextSegment:M})}catch(e){_.t.error(e),y=(0,n.u_)(g.o.Unknown)}finally{this._callbackOptions.afterAddTransition(k,y.ok?t.id:void 0)}return y}async addToCurrentProgress(e,t){if(!this._renderManager)return(0,n.u_)(g.o.RenderManagerUndefined);let{progress:r}=this._renderManager,a=this._dataSdk.draftView.getTracksByType(c.pNd.TrackTypeVideo),i=null,o=null,s=-1,d=l.E2,h=null;for(let e of a)for(let t=0;t<e.segments.length;t++){let a=e.segments[t];if(a.targetTimerange.start<=r&&a.targetTimerange.start+a.targetTimerange.duration>=r){var p,_;let n,l;o=e,i=a,s=t;let u=null!==(p=o.segments[s-1])&&void 0!==p?p:null,g=null!==(_=o.segments[s+1])&&void 0!==_?_:null,f=i.targetTimerange.start+i.targetTimerange.duration/2n;r<f?(n=u,l=i):(n=i,l=g);let m=this._checkAddTransition(n,l,i,!0);if(!m.ok&&(r<f?(n=i,l=g):(n=u,l=i),!(m=this._checkAddTransition(n,l,i,!0)).ok))break;let v=BigInt(Math.abs(Number(n.targetTimerange.start+n.targetTimerange.duration-r)));v<d&&n&&(0,c.hey)(n)&&(d=v,h=n)}}return h?await this.add(e,h,t):(this._callbackOptions.toast(u.ZP.t("web_transition_toast_between_two_clips",{},"Transition can only be added between two segments")),(0,n.u_)(g.o.TransitionSegmentLimit))}async addToCurrentProgressBySegment(e,t,r){if(!this._renderManager)return(0,n.u_)(g.o.RenderManagerUndefined);let{progress:a}=this._renderManager,i=this._dataSdk.draftView.getSegmentAtPositionById(t.id);if(!(i&&t&&(0,c.hey)(t)))return this._callbackOptions.toast(u.ZP.t("web_transition_toast_between_two_clips",{},"Transition can only be added between two segments")),(0,n.u_)(g.o.TransitionSegmentLimit);{var o,s;let l,d;let{trackIndex:u,segmentIndex:h}=i,p=this._dataSdk.draftView.getAllTracks()[u],_=null!==(o=p.segments[h-1])&&void 0!==o?o:null,f=null!==(s=p.segments[h+1])&&void 0!==s?s:null,m=t.targetTimerange.start+t.targetTimerange.duration/2n;a<t.targetTimerange.start||a>t.targetTimerange.start+t.targetTimerange.duration?(l=t,d=f):a<m?(l=_,d=t):(l=t,d=f);let v=this._checkAddTransition(l,d,t,!1);return v.ok?l&&(0,c.hey)(l)?await this.add(e,l,r):(0,n.u_)(g.o.TransitionSegmentLimit):(this._callbackOptions.toast(v.msg),(0,n.u_)(v.code))}}_resourceToTransitionParam(e,t,r,a,i,n){var o,s;return{segId:a,name:e.name,resourceId:e.resourceId,effectId:e.effectId,path:t,duration:r,isOverlap:i,categoryId:null!==(o=null==n?void 0:n.materialThirdcategoryId)&&void 0!==o?o:"",categoryName:null!==(s=null==n?void 0:n.materialThirdcategory)&&void 0!==s?s:"",sourcePlatform:f.t.formatEffectSourcePlatform(e.source),thirdResourceId:e.thirdResourceId||"",requestId:""}}_checkAddTransition(e,t,r,a){if(!e||!t)return(0,h.wf)(g.o.TransitionSegmentLimit,u.ZP.t("web_transition_toast_between_two_clips",{},"Transition can only be added between two segments"));if(e.targetTimerange.start+e.targetTimerange.duration>t.targetTimerange.start||t.targetTimerange.start-(e.targetTimerange.start+e.targetTimerange.duration)>1n)return(0,h.wf)(g.o.TransitionSegmentLimit,u.ZP.t("web_transition_toast_between_two_clips",{},"Transition can only be added between two segments"));if(!a&&(0,c.hey)(e)&&e.transition)return t.id===r.id?(0,h.wf)(g.o.TransitionSegmentLimit,u.ZP.t("web_transition_toast_added_front",{},"Transition has been added before the current segment")):(0,h.wf)(g.o.TransitionSegmentLimit,u.ZP.t("web_transition_toast_added_back",{},"Transition has been added after the current segment"));return(0,h.ly)()}constructor(e,t,r,a,i){this._dataSdk=e,this._renderManager=t,this._ensureManager=r,this._callbackOptions=a,this._resourceService=i}}m=(0,a.gn)([(0,a.fM)(4,i.c),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IAddSegmentCallbackOptions?Object:IAddSegmentCallbackOptions,void 0===i.c?Object:i.c])],m)},498526:function(e,t,r){r.d(t,{Sp:function(){return l},iN:function(){return s},vB:function(){return p}});var a=r(232297),i=r(426336),n=r(265557),o=r(214063);let s=()=>{var e;let t=document.querySelector("#card-drag-effect img"),r=null==t?void 0:null===(e=t.getBoundingClientRect)||void 0===e?void 0:e.call(t);return r?[r.left+r.width/2,r.top+r.height/2]:[]},l=()=>{let{width:e=0,height:t=0,x:r,y:a}=document.querySelector("#canvas-cover").getBoundingClientRect();return{clientWidth:e,clientHeight:t,x:r,y:a}},c=(e,t,r)=>{let a=r/720.007129;return[e*a,t*a]},d=(e,t,r,a)=>{let i=Math.max(Math.min(e,t)/3,120).toFixed(2),n=Math.max(r,a);return Number((Number(i)/n).toFixed(6))};async function u(e,t,r,a,i){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=0;for(;s<n;){var l;let n=await a.getSegmentRectangles({draftView:r.draftView,getSegmentById:e=>r.draftView.getSegmentById(e,void 0,!1),canvasSize:t,segIds:[e],selectedSegmentsIds:i.getSelectedSegmentsIds()});if((null===(l=n[0])||void 0===l?void 0:l.height)&&0!==n[0].height)return[n[0].width,n[0].height];s++,await new Promise(e=>setTimeout(e,o))}return[]}async function h(e,t,r){return t.api.draft.ensureDraftCanvasSize({materialSize:[0,0],ratio:i.rxY.CanvasRatio16To9,isVideo:!1},!1),await (0,o.D)(e,t,r)}class p{_getScale(e,t,r,a){let i=d(e,t,r,a);return"textTemplate"===this._segmentType?1.1*i:i}_getDefaultScale(){return"textTemplate"===this._segmentType?.26:"sticker"===this._segmentType?.481994:1}_getScaleCache(){return this._effectStorage.get(this._resourceId)}_setScaleCache(e){var t;let r=[e,...null!==(t=this._getScaleCache())&&void 0!==t?t:[]];this._effectStorage.set(this._resourceId,r)}_waitForRect(e,t,r){let{clientWidth:a,clientHeight:i}=l();return new Promise(n=>{let o=null,s=null,l=async()=>{let l=await u(this._segmentId,[a,i],e,t,r);0!==l[0]&&0!==l[1]?(null==s||s.dispose(),null!==o&&clearTimeout(o),n(l)):n([])};o=setTimeout(()=>{null==s||s.dispose(),n([])},5e3),s=t.onFrameRender(l)})}_clearTransform(){this._transformX=null,this._transformY=null}async setSegmentTransformParamsIfNeed(e,t){var r,a,o,s,d,u;this._clearTransform();let p="sticker"===this._segmentType;if(!p&&"textTemplate"!==this._segmentType)return;let _=1,g=1,{clientWidth:f,clientHeight:m}=l();if(null==t?void 0:null===(r=t.every)||void 0===r?void 0:r.call(t,e=>"number"==typeof e)){let[e,r]=t,[a,i]=c(e,r,f),n=this._getScale(f,m,a,i);_=Number(n),g=Number(n),this._report({originSize:t,scale:n},"getOriginRect")}else{let t=this._getScaleCache(),r=null==t?void 0:null===(o=t.find)||void 0===o?void 0:null===(a=o.call(t,e=>e.canvasRatio===f/m))||void 0===a?void 0:a.scale;if(r&&Number(r)>0)_=Number(r),g=Number(r),this._report({scale:r},"scaleCacheMatch");else{;let[t,r]=await (p?(s=e,d=this._dataSdk,u=this._renderManager,s.segInfo?(s.segInfo.timeRange||(s.segInfo.timeRange={start:0n,duration:0n}),s.segInfo.timeRange.start||(s.segInfo.timeRange.start=0n),s.segInfo.timeRange.duration||(s.segInfo.timeRange.duration=100000n),(0,n.P)(s,d,u)):[0,0]):h(e,this._dataSdk,this._renderManager));({clientWidth:f,clientHeight:m}=l());let a=0===t||0===r?this._getDefaultScale():this._getScale(f,m,t*f,r*m);t>0&&r>0&&this._setScaleCache({canvasRatio:f/m,scale:a}),_=a,g=a,this._report({scale:a},"rescaleWhenAdd")}}p?e.segInfo.clip=(0,i.cE6)({...e.segInfo.clip,scaleX:_,scaleY:g}):e.params.material.clip=(0,i.cE6)({...e.params.material.clip,scaleX:_,scaleY:g})}async setSegmentScaleIfNeed(e,t,r,a){if(null===this._transformX||null===this._transformY)return;let{clientWidth:i,clientHeight:n}=l(),[o,s]=await this._waitForRect(e,t,r),c=o&&s,d=c?this._getScale(i,n,o,s):this._getDefaultScale();c&&d&&d>0&&this._setScaleCache({canvasRatio:i/n,scale:d});let u=e.api.batch.batchStart(),h=e.api.segment.scale([{segmentId:this._segmentId,x:d,y:d,isKeyframe:!1}]),p=e.api.segment.translate([{segmentId:this._segmentId,x:this._transformX,y:this._transformY,isKeyframe:!1}]);await Promise.allSettled([h,p]),e.api.batch.batchEnd(u,{canUndoRedo:!1}),null==a||a(),this._report({isGetRect:c?1:0,scale:d,transformInfo:[this._transformX,this._transformY]},"setScaleAfterAdd")}constructor(e,t,r,i,n,o){this._segmentId=e,this._resourceId=t,this._segmentType=r,this._dataSdk=n,this._renderManager=o,this._transformX=null,this._transformY=null,this._effectStorage=new a.v("lvve-editor-effect-resource-scale"),this._report=(e,t)=>{if("function"!=typeof(null==i?void 0:i.track))return;let{clientWidth:r,clientHeight:a}=l();i.track("editor-effect-drag-scale",{eventType:t,_segmentType:this._segmentType,segmentId:this._segmentId,screenSize:{clientWidth:r,clientHeight:a},...e})}}}},850427:function(e,t,r){r.d(t,{z:function(){return u}});var a=r(789786),i=r(108692),n=r(690613),o=r(948328),s=r(594735),l=r(107486),c=r(433140),d=r(49299);class u{async restoreDraft(e){var t,r,a,i;let{meta:o,draftJson:l,preloadResourcePromise:c,overrideDraftId:d,overrideDraftName:u,isForceAutoMaterial:h,draftDataVersion:p,packageId:_}=e,g=await c;if(this.draftMaterialsService.bootstrap({autoMaterials:h?[...null!==(t=null==g?void 0:g.userMaterialLifeCycles)&&void 0!==t?t:[],...null!==(r=null==g?void 0:g.invalidUserMaterialLifeCycles)&&void 0!==r?r:[]]:void 0,materials:h?[]:[...null!==(a=null==g?void 0:g.userMaterialLifeCycles)&&void 0!==a?a:[],...null!==(i=null==g?void 0:g.invalidUserMaterialLifeCycles)&&void 0!==i?i:[]]}),!l||!g)throw Error("get empty package info");let f=(0,s.V)(this._ensureManager,l,g,d,u);this._dataSdk.api.draft.setCanvasSize({ratio:f.canvas_config.ratio,containerHeight:f.canvas_config.height,containerWidth:f.canvas_config.width},!1,!1),this._dataSdk.resetDraft();let m=this._dataSdk.recoveryDraft(f);return p&&this._dataSdk.updateDataVersion(p),_&&this._mainDraftService.saveManager.setPackageId(_),o&&this._mainDraftService.cloudMetaManager.resetMeta(o),(0,n.oW)(m)}removeDeletedMaterials(){let e=this.draftMaterialsService.getMaterials();e.userGeneratedMaterials.forEach(e=>{!this._comingPackageAssets.find(t=>t.md5===e.md5)&&this.draftMaterialsService.removeFromUserGenerated(e.id)}),e.autoGeneratedMaterials.forEach(e=>{!this._comingPackageAssets.find(t=>t.md5===e.md5)&&this.draftMaterialsService.removeFromAutoGenerated(e.id)})}hasQuickImport(e){var t;return Object.values(null!==(t=e.preloadResources.materials)&&void 0!==t?t:{}).some(e=>(0,d.LL)(e.path))}constructor(e,t,r,a,i){this._dataSdk=e,this._ensureManager=t,this._resourceService=r,this._mainDraftService=a,this.draftMaterialsService=i,this._comingPackageAssets=[],this.filterPackageAssets=e=>{this._comingPackageAssets=e;let t=this.draftMaterialsService.getMaterials(),r=[...t.autoGeneratedMaterials,...t.userGeneratedMaterials].filter(e=>this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(e.key)&&e.md5).map(e=>e.md5);return e.filter(e=>!r.includes(e.md5))},this.filterOnlineResources=e=>{let t={};return Object.entries(e).forEach(e=>{let[r,a]=e,i=this._resourceService.get(a.key,a.resource.type);(null==i?void 0:i.status)!==l.n.complete&&(t[r]=a)}),t}}}u=(0,a.gn)([(0,a.fM)(2,c.c),(0,a.fM)(3,i.n),(0,a.fM)(4,o.D),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof IEnsureManager?Object:IEnsureManager,void 0===c.c?Object:c.c,void 0===i.n?Object:i.n,void 0===o.D?Object:o.D])],u)},161442:function(e,t,r){r.d(t,{B:function(){return a}});class a{addCollabMessage(e){this._waitingMessage=e,!this._committingMessage&&this.moveWaitingToCommitting()}getWaitingMessage(){return this._waitingMessage}getCommittingMessage(){return this._committingMessage}isEmpty(){return!this._waitingMessage&&!this._committingMessage}moveWaitingToCommitting(){this._committingMessage=this._waitingMessage,this._waitingMessage=null}constructor(){this._waitingMessage=null,this._committingMessage=null}}},756192:function(e,t,r){r.d(t,{X:function(){return g}});var a=r(789786),i=r(730963),n=r(230689),o=r(433140),s=r(426336),l=r(948328),c=r(425427),d=r(91474),u=r(108692),h=r(566504),p=r(896413),_=r(970787);class g{get _isTemplate(){return this._videoEnvironmentService.appSubType===c.cP.Template}checkMaterialsInCanvas(e){let t=this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(e.key);if(!t)return!1;let{segIds:r,materialIds:a,subDraftIds:i}=this._getDataInfoByDraftPath(t);return this._isTemplate?!!a.length:!!r.length||!!i.length}removeMaterialsInCanvas(e){if(this._isTemplate?this._removeByTemplate(e):this._removeByMultiTrack(e),e.key){let t=this._draftMaterialsService.getMaterials(),r=0;if(t.autoGeneratedMaterials.forEach(t=>{t.key===e.key&&r++}),t.userGeneratedMaterials.forEach(t=>{t.key===e.key&&r++}),1===r){let t=(0,i.G)(e.fileType);this._resourceService.delete(e.key,t),this._mainEditorWidgetService.ensureManager.clearEnsureTask(e.key,t)}}}_removeByMultiTrack(e){let t=this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(e.key);if(!t)return;let{segIds:r,subDraftIds:a,materialIds:i}=this._getDataInfoByDraftPath(t);r.length&&(0,_.I)(this._mainDraftService.dataSdk,this._mainEditorWidgetService.renderManager,{segIds:r,selectedSegIds:r}),a.length&&i.length&&a.forEach(e=>{this._replaceSegmentManager.resetMutableVideo(i,e)})}_removeByTemplate(e){let t=this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(e.key);if(!t)return;let{materialIds:r}=this._getDataInfoByDraftPath(t);r.length&&this._replaceSegmentManager.resetMutableVideo(r)}_getDataInfoByDraftPath(e){let t=this._mainDraftService.dataSdk.draftView.getAllTracks().filter(e=>{let{type:t}=e;return[s.pNd.TrackTypeVideo,s.pNd.TrackTypeAudio,s.pNd.TrackTypeTextToVideoTextAudio].includes(t)}),r={segIds:[],subDraftIds:[],materialIds:[]};if(!e)return r;for(let o of t)for(let t of o.segments.filter(h.Sn)){var a,i,n;if(s.hPV.isPathEqual(t.material.path,e))r.segIds.push(t.id),r.materialIds.push(t.material.id);else if(null===(a=t.materialDraft)||void 0===a?void 0:a.draft.tracks){for(let a of null===(i=t.materialDraft)||void 0===i?void 0:i.draft.tracks)for(let i of a.segments.filter(h.Sn))if(s.hPV.isPathEqual(i.material.path,e)){r.subDraftIds.push(null===(n=t.materialDraft)||void 0===n?void 0:n.draft.metadata.id),r.materialIds.push(i.material.id);break}}}return r}constructor(e,t,r,a,i,n){this._containerService=e,this._draftMaterialsService=t,this._resourceService=r,this._mainDraftService=a,this._mainEditorWidgetService=i,this._videoEnvironmentService=n,this._replaceSegmentManager=this._containerService.createInstance(d.m,this._mainDraftService.dataSdk,this._mainEditorWidgetService.renderManager,this._mainEditorWidgetService.ensureManager,this._mainDraftService.draftPathStore,{beforeReplaceMutable:()=>{},afterReplaceMutable:()=>{},onAddError:()=>{},onOrderError:()=>{}}),this._mainEditorWidgetService.onEventually(()=>{this._replaceSegmentManager.updateRenderManager(this._mainEditorWidgetService.renderManager)})}}g=(0,a.gn)([(0,a.fM)(0,n.t),(0,a.fM)(1,l.D),(0,a.fM)(2,o.c),(0,a.fM)(3,u.n),(0,a.fM)(4,p.a),(0,a.fM)(5,c.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.t?Object:n.t,void 0===l.D?Object:l.D,void 0===o.c?Object:o.c,void 0===u.n?Object:u.n,void 0===p.a?Object:p.a,void 0===c.rO?Object:c.rO])],g)},128745:function(e,t,r){r.d(t,{T:()=>I});var a=r("789786"),i=r("143953"),n=r("907525"),o=r("847264"),s=r("55449"),l=r("800788"),c=r("426336"),d=r("772322");r("225572"),r("966156");var u=r("97257"),h=r("368100"),p=r("801497"),_=r("195291"),g=r("218571");r("170535");let f=e=>{let{handleSaveOfflineData:t,handleAbandonOfflineData:r}=e,[a,i]=(0,g.useState)(!1);return(0,d.jsx)(h.Z,{visible:!0,escToExit:!1,maskClosable:!1,closeIcon:null,className:"offline-version-conflict-modal",autoFocus:!1,title:p.ZP.t("web_offline_title_project_edited",{},"\u79BB\u7EBF\u72B6\u6001\u4E0B\u672C\u5730\u5DE5\u7A0B\u6709\u66F4\u65B0"),footer:(0,d.jsxs)("div",{className:"longer-container",children:[(0,d.jsx)(u.Z,{onClick:r,children:p.ZP.t("web_offline_btn_old_project_use",{},"\u4F7F\u7528\u4FEE\u6539\u524D\u7684\u7248\u672C")}),(0,d.jsx)(u.Z,{loading:a,type:"primary",onClick:()=>{i(!0),t()},children:p.ZP.t("web_offline_btn_new_project_use",{},"\u5E94\u7528\u672C\u5730\u4FEE\u6539")})]}),children:p.ZP.t("web_offline_desc_project_edited",{},"\u6211\u4EEC\u68C0\u6D4B\u5230\u5F53\u524D\u5DE5\u7A0B\u5728\u79BB\u7EBF\u72B6\u6001\u4E0B\uFF0C\u5185\u5BB9\u6709\u7F16\u8F91\u66F4\u65B0\uFF0C\u4F60\u53EF\u4EE5\u9009\u62E9\u5E94\u7528\u8FD9\u4E9B\u66F4\u65B0\u6216\u4F7F\u7528\u4FEE\u6539\u524D\u7684\u7248\u672C")})};async function m(e,t){let{handleSaveOfflineData:r,handleAbandonOfflineData:a}=t,i=document.createElement("div");document.body.append(i),await e.allowToRender(),_.render((0,d.jsx)(f,{handleAbandonOfflineData:()=>{a(),_.unmountComponentAtNode(i)},handleSaveOfflineData:r}),i)}var v=r("230689"),y=r("200247"),S=r("425427"),M=r("447273"),T=r("594061"),b=r("273238"),k=r("123869");let w={id:"lvweb-offline-data",version:1,table:{name:"offline",key:"key",index:[{name:"updateTime",unique:!1}]}};class I extends i.UW{onSyncComplete(e){this._isSyncCompolete&&e(),this._onSyncCompleteListeners.push(e)}_fireSyncComplete(){this._onSyncCompleteListeners.forEach(e=>e())}async syncOfflineDraft(){let e=await super.syncOfflineDraft();this._fireSyncComplete(),this._isSyncCompolete=!0;let[t,r]=e.pair();return t?(0,M.T)(this.containerService,{saveStatus:"failed",failReason:t.msg}):r&&(0,M.T)(this.containerService,{saveStatus:"success"}),e}offlineDataToSaveTask(e){return c.HHr.parse(unescape(atob(e))).map(e=>{let{cloudMeta:t,packageId:r,draftJson:a,workspaceId:i,packageAssets:n,userChange:s}=c.HHr.parse(e);(0,l.ZB)(t),(0,l.ZB)(r),(0,l.ZB)(a),(0,l.ZB)(i),(0,l.ZB)(n);let d=this.containerService.createInstance(o.e,t,r,a,i,n,this._uploadSizeChecker,{},!0);return d.setIsOffline(!0),d.setIsNeedCheck(!1),d})}saveTaskToOfflineData(e){return btoa(escape(JSON.stringify(e.map(e=>e.serialize()))))}applyAndSaveOfflineData(e,t){return new Promise(r=>{m(this._i18nService,{handleSaveOfflineData:()=>{this.saveOfflineData(e,t),r(!0)},handleAbandonOfflineData:async()=>{await this.deleteAll(),r(!0)}})})}saveOfflineData(e,t){this.draftSaveManager.onSuccess(this.handleOfflineSaveComplete),[...null!=e?e:[],...null!=t?t:[]].forEach(e=>{this.draftSaveManager.draftSaveTaskQueue.add(e)}),(0,T.Z)(this.containerService,{action:"save_by_offline_data",duration:0}),this.draftSaveManager.saveDraft()}async clearAndreloadWindow(){await this.deleteAll(),window.location.reload()}constructor(e,t,r,a,i,o,s,l){super(t,{getDraftId:()=>e.getDraftId()||a.draftIdFromUrl||"",getUid:()=>r.userProfile.uid,dbSchema:w},i),this.draftSaveManager=t,this.instantiationService=i,this.containerService=o,this._userMaterialsService=s,this._i18nService=l,this._isSyncCompolete=!1,this._onSyncCompleteListeners=[],this.handleOfflineSaveComplete=async e=>{e.ok&&this.draftSaveManager.draftSaveTaskQueue.isEmpty()&&await this.clearAndreloadWindow()},this._uploadSizeChecker=new n.A({userMaterialsService:this._userMaterialsService})}}I=(0,a.gn)([(0,a.fM)(2,y.D),(0,a.fM)(3,S.rO),(0,a.fM)(4,s.T),(0,a.fM)(5,v.t),(0,a.fM)(6,b.b),(0,a.fM)(7,k.S),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IOfflineSaveManagerOptions?Object:IOfflineSaveManagerOptions,"undefined"==typeof IVideoDraftSaveManager?Object:IVideoDraftSaveManager,void 0===y.D?Object:y.D,void 0===S.rO?Object:S.rO,void 0===s.T?Object:s.T,void 0===v.t?Object:v.t,void 0===b.b?Object:b.b,void 0===k.S?Object:k.S])],I)},204806:function(e,t,r){r.d(t,{gq:function(){return u}});var a=r(70246),i=r(995370),n=r(690613),o=r(426336),s=r(782350),l=r(127830);let c=i.ED?1024:1e3,d=c*c*c,u=async(e,t,r,i)=>{if(e.invokeFunction(e=>{let t=e.get(s.W);if(!t.workspaceExpandInfoMap)return!1;let r=t.workspaceExpandInfoMap[i];return!!r&&r.isAutoSubscribe}))return(0,n.ly)();let o=await r.getSize(i);return o.ok&&o.value<=0&&t>20*d?(0,n.wf)(a.D3.INSUFFICIENT_SPACE,"INSUFFICIENT_SPACE error"):(0,n.ly)()};o.cVg.MetaTypePhoto,l._g.Photo,o.cVg.MetaTypeVideo,l._g.Video,o.cVg.MetaTypeSticker,l._g.Sticker,o.cVg.MetaTypeFilter,l._g.Filter,o.cVg.MetaTypeMusic,l._g.Audio,o.cVg.MetaTypeTransition,l._g.Transition,o.cVg.MetaTypeGif,l._g.Gif,o.cVg.MetaTypeVideoMask,l._g.Mask,o.cVg.MetaTypeCanvasImage,l._g.VideoBackground,o.cVg.MetaTypeFont,l._g.Font,o.cVg.MetaTypeVideoEffect,l._g.Effects,o.cVg.MetaTypeTextEffect,l._g.TextPreset,o.cVg.MetaTypeAudioEffect,l._g.VoiceChange,o.cVg.MetaTypeVideoMix,l._g.Mix,o.cVg.MetaTypeFaceEffect,l._g.FaceProp,o.cVg.MetaTypeText,l._g.TextPreset,o.cVg.MetaTypeTextTemplate,l._g.TextTemplate,o.cVg.MetaTypeTextToAudio,l._g.UserFile,o.cVg.MetaTypeDigitalHuman,l._g.DigitalHuman,o.cVg.MetaTypeSound,l._g.Audio,o.cVg.MetaTypeCombination,l._g.VideoTemplate},834506:function(e,t,r){r.d(t,{N:function(){return o}});var a=r(426336),i=r(402655),n=r(800788);class o extends i.JT{getReferenceCount(e){var t,r;return null!==(r=null===(t=this.getReferenceSegmentIds(e))||void 0===t?void 0:t.size)&&void 0!==r?r:-1}getReferenceSegmentIds(e){return this._materialsCounter.get(e)}acquire(e,t){!this._materialsCounter.has(e)&&this._materialsCounter.set(e,new Set),this._materialsCounter.get(e).add(t)}release(e,t){(0,n.Y2)(this._materialsCounter.has(e)),this._materialsCounter.get(e).delete(t)}_refreshWatcherCache(){let e=this._dataSdk.draftView.getAllSegments();for(let t of this._watchers)t.refreshCache(e);for(let e of this._customWatchers)e.refresh(this._dataSdk)}_afterChangeDiff(e){for(let t of this._watchers)t.afterChangeDiff(e,this._dataSdk);for(let t of this._customWatchers)t.afterChangeDiff(e,this._dataSdk)}constructor(e){super(),this._dataSdk=e,this._materialsCounter=new Map,this._watchers=[],this._customWatchers=[],this._register(this._dataSdk.onChangeDiff(e=>{if(e.actionOperateType===a.aWQ.History){this._materialsCounter.clear(),this._refreshWatcherCache();return}this._afterChangeDiff(e)}))}}},568601:function(e,t,r){r.d(t,{B:function(){return n}});var a=r(444381),i=r(426336);class n extends a.M{_findPath(e){if(!(0,i.Y9Q)(e))return"";let{material:t}=e,{type:r}=t;return(null==t?void 0:t.musicId)&&r===i.cVg.MetaTypeVideoOriginalSound?t.path:""}}},274618:function(e,t,r){r.d(t,{P:function(){return n}});var a=r(426336),i=r(444381);class n extends i.M{_findPath(e){return(0,a.hey)(e)?e.material.sourcePlatform===a.cvu.MaterialPlatformDefault?e.material.path:"":""}}},393101:function(e,t,r){r.d(t,{I:function(){return n}});var a=r(444381),i=r(426336);class n extends a.M{_findPath(e){var t,r;return((0,i.Y9Q)(e)||(0,i.hey)(e))&&(null===(r=e.voiceChange)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.subType)===i.xbm.AudioEffectTypeVCVoiceChange?e.voiceChange[0].productionPath:""}}},16e3:function(e,t,r){r.d(t,{Y:function(){return n}});var a=r(444381),i=r(426336);class n extends a.M{_findPath(e){if((0,i.P2T)(e)||(0,i.Ftn)(e)||(0,i.Q2R)(e)){var t,r;return null!==(r=null===(t=e.videoTracking)||void 0===t?void 0:t.trackers.map(e=>e.dataPath).join(";"))&&void 0!==r?r:""}return""}_acquireByPath(e,t){t&&t.split(";").forEach(t=>{super._acquireByPath(e,t)})}_releaseByPath(e,t){t&&t.split(";").forEach(t=>{super._releaseByPath(e,t)})}}},91474:function(e,t,r){r.d(t,{m:function(){return h}});var a=r(789786);r(784923);var i=r(498417),n=r(433140),o=r(230689),s=r(681962),l=r(826913),c=r(932762),d=r(801497);function u(e,t,r){let a=r.value;return r.value=async function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=performance.now(),n=await a.apply(this,t);return n.performanceDuration=performance.now()-i,n},r}class h{updateRenderManager(e){this._replaceMutableVideoHelper.updateRenderManager(e),this._replaceMutableAudioHelper.updateRenderManager(e),this._replaceVideoSegmentHelper.updateRenderManager(e)}async replaceMutableVideo(e,t){return{result:await this._replaceMutableVideoHelper.replace(e,t),performanceDuration:0}}async resetMutableVideo(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{result:await this._replaceMutableVideoHelper.reset(e,t,r),performanceDuration:0}}async replaceMutableAudio(e,t){let r=await this._replaceMutableAudioHelper.replace(e,t);if(!r.ok){let e=d.ZP.t("file_failed_to_download",{},"file download failed");i.Z.error(e)}return{result:r,performanceDuration:0}}async replaceVideo(e){return{result:await this._replaceVideoSegmentHelper.replace(e),performanceDuration:0}}constructor(e,t,r,a,i,n,o){this._dataSdk=e,this._ensureManager=r,this._draftPathStore=a,this._callbackOptions=i,this._resourceService=n,this._containerService=o,this._replaceMutableVideoHelper=new s.z(this._dataSdk,t,this._draftPathStore,this._ensureManager,this._callbackOptions,this._resourceService,this._containerService),this._replaceMutableAudioHelper=new l.E(this._dataSdk,t,this._ensureManager,this._draftPathStore,this._callbackOptions,this._resourceService,this._containerService),this._replaceVideoSegmentHelper=new c.G(this._dataSdk,t,this._draftPathStore,this._ensureManager,this._callbackOptions,this._resourceService,this._containerService)}}(0,a.gn)([u,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IReplaceMutableVideoOptions?Object:IReplaceMutableVideoOptions,String]),(0,a.w6)("design:returntype",Promise)],h.prototype,"replaceMutableVideo",null),(0,a.gn)([u,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Array,String,void 0]),(0,a.w6)("design:returntype",Promise)],h.prototype,"resetMutableVideo",null),(0,a.gn)([u,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IReplaceMutableAudioOptions?Object:IReplaceMutableAudioOptions,String]),(0,a.w6)("design:returntype",Promise)],h.prototype,"replaceMutableAudio",null),(0,a.gn)([u,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IReplaceVideoOption?Object:IReplaceVideoOption]),(0,a.w6)("design:returntype",Promise)],h.prototype,"replaceVideo",null),h=(0,a.gn)([(0,a.fM)(5,n.c),(0,a.fM)(6,o.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,Object,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IReplaceSegmentCallbackOptions?Object:IReplaceSegmentCallbackOptions,void 0===n.c?Object:n.c,void 0===o.t?Object:o.t])],h)},915345:function(e,t,r){r.d(t,{L:function(){return s}});var a=r(426336);let i={id:!0,visible:!0,sourceTimerange:!0,commonKeyframes:!0,targetTimerange:!0,material:!0},n={[a.Ocy.SegmentVideo]:{...i,commonKeyframes:!0,transition:!0,speed:!0,animations:!0,clip:{flip:!0},digitalHuman:!0,adjust:!0,material:!0,reverse:!0,sourceTimerange:!0,targetTimerange:!0,materialDraft:!0,templateId:!0,vocalSeparation:!0,vocalBeautify:!0},[a.Ocy.SegmentAudio]:{...i,commonKeyframes:!0,material:!0,speed:!0,fade:!0,beat:!0,sourceTimerange:!0,targetTimerange:!0,materialDraft:!0,vocalSeparation:!0,vocalBeautify:!0},[a.Ocy.SegmentText]:{...i,videoTracking:!0,animations:!0},[a.Ocy.SegmentSticker]:{...i,videoTracking:!0,animations:!0},[a.Ocy.SegmentVideoEffect]:{...i,material:!0},[a.Ocy.SegmentFilter]:{...i,material:!0},[a.Ocy.SegmentTextTemplate]:{...i,videoTracking:!0},[a.Ocy.SegmentPictureAdjust]:{...i,material:!0}},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=[];for(let a in e)if(e.hasOwnProperty(a)){let i=e[a];if("object"!=typeof i||Array.isArray(i)){let e=t?`${t}.${a}`:a;r.push(e)}else{let e=t?`${t}.${a}`:a;r.push(...o(i,e))}}return r},s=(e=>{let t={};return Object.keys(e).forEach(r=>{t[r]=o(e[r],"")}),t})(n)},380455:function(e,t,r){r.d(t,{t:function(){return s}});var a=r(273340),i=r(249656),n=r(426336);let o={third_resource_tuchong_deposit:i.n9.MaterialPlatformTuchongDeposit,third_resource_tuchong_adobe:i.n9.MaterialPlatformTuchongAdobe,third_resource_tuchong_pond5:i.n9.MaterialPlatformTuchongPond5},s={toHeycanEffectType:function(e){switch(e){case n.cVg.MetaTypeTextEffect:return a.g.WordArt;case n.cVg.MetaTypeSticker:return a.g.Sticker;case n.cVg.MetaTypeSound:return a.g.AudioEffect;case n.cVg.MetaTypeMusic:return a.g.Song;case n.cVg.MetaTypeVideo:return a.g.Video;case n.cVg.MetaTypeTextTemplate:return a.g.TextTemplate;case n.cVg.MetaTypeVideoEffect:return a.g.SpecialEffect;case n.cVg.MetaTypeFaceEffect:return a.g.FaceTool;case n.cVg.MetaTypePhoto:return a.g.Image;case n.cVg.MetaTypeFilter:return a.g.Filter;default:throw Error(`unknown meta type ${e}`)}},toMetaType:function(e){switch(e){case a.g.WordArt:return n.cVg.MetaTypeTextEffect;case a.g.Sticker:return n.cVg.MetaTypeSticker;case a.g.AudioEffect:return n.cVg.MetaTypeSound;case a.g.Song:return n.cVg.MetaTypeMusic;case a.g.Video:return n.cVg.MetaTypeVideo;case a.g.TextTemplate:return n.cVg.MetaTypeTextTemplate;case a.g.SpecialEffect:return n.cVg.MetaTypeVideoEffect;case a.g.FaceTool:return n.cVg.MetaTypeFaceEffect;case a.g.Image:return n.cVg.MetaTypePhoto;case a.g.Filter:return n.cVg.MetaTypeFilter;default:return n.cVg.MetaTypeNone}},toSourcePlatform:(e,t)=>{let r;switch(e){case i.Hw.HEYCAN:return n.nj7.EffectPlatformArtist;case i.Hw.LOKI:return n.nj7.EffectPlatformLoki;case i.Hw.MUSIC:return n.QZ3.AudioPlatformLibrary;case i.Hw.TUCHONG:if(r=t&&o[t])return r;case i.Hw.BRAND:return n.cvu.MaterialPlatformBrand;default:return n.nj7.EffectPlatformArtist}},formatEffectSourcePlatform:e=>{switch(e){case i.Hw.HEYCAN:return n.nj7.EffectPlatformArtist;case i.Hw.BRAND:return n.nj7.EffectPlatformBrand;case i.Hw.LOKI:default:return n.nj7.EffectPlatformLoki}},transformPersistLVVEEffectSourcePlatformToSourcePlatform:e=>{switch(e){case n.nj7.EffectPlatformArtist:return i.Hw.HEYCAN;case n.nj7.EffectPlatformBrand:return i.Hw.BRAND;case n.nj7.EffectPlatformLoki:default:return i.Hw.LOKI}}}},30947:function(e,t,r){r.d(t,{GS:function(){return n},PS:function(){return i}});let a=(e,t)=>`EFFECT_AB-${t}`,i=(e,t,r,i)=>e.keyValue.set(a(r,i),JSON.stringify(t)),n=(e,t,r)=>{let i;let n={int:{},float:{},boolean:{},string:{}},o=e.keyValue.query(a(t,r));if(!o.ok)return n;let s=o.value;if(s){try{i=JSON.parse(s)}catch(e){return n}Object.entries(i).forEach(e=>{let[t,r]=e;switch(typeof r){case"boolean":n.boolean[t]=r;break;case"string":n.string[t]=r;break;case"number":Number.isInteger(r)?n.int[t]=r:n.float[t]=r}})}return n}},161637:function(e,t,r){r.d(t,{k:function(){return s}});var a=r(108692),i=r(425427),n=r(195471);class o{getEventParams(){return{type:this._params.type,action:this._params.action,template_id:this._params.template_id,draft_id:this._params.draft_id,current_page:this._params.current_page}}constructor(e){this._params=e,this.eventName="template_edit_new_guide"}}function s(e,t){e.invokeFunction(r=>{var s;let l=r.get(a.n),c=r.get(i.rO);(0,n.K)(e,o,[{...t,template_id:null!==(s=c.currentTemplateId)&&void 0!==s?s:"",draft_id:l.dataSdk.draftView.getDraftId(),current_page:"template_editor"}])})}},531632:function(e,t,r){r.d(t,{J:function(){return u}});var a=r(176022),i=r(801497),n=r(183346),o=r(210823),s=r(161637),l=r(230689);function c(e){return{[n.F3.EditorAreaIsNewEmptyGuide]:{key:n.F3.EditorAreaIsNewEmptyGuide,steps:[{get target(){let e=document.querySelector("#workbench .menu-panel-list-wrapper");return null!=e?e:null},get title(){return i.ZP.t("web_guide_title_templates",{},"Template resources")},get content(){return i.ZP.t("web_guide_desc_templates",{},"Select a template here to start a video")},get confirmLabel(){return i.ZP.t("web_guide_btn_templates_ok",{},"OK")},placement:"right",show(){(0,s.k)(e,{type:"use_template",action:"show"})},confirm(){(0,s.k)(e,{type:"use_template",action:"close"})},cancel(){(0,s.k)(e,{type:"use_template",action:"close"})},clickTargetToClose:!0}],mask:!0}}}function d(e){let t=e.get(a.W),r=e.get(n.AS),i=e.get(o.e),s=e.get(l.t),d=i.onSiderMenuPanelWidthChange(async e=>{if("auto"===e&&!r.getViewStateFromLocal(n.F3.EditorAreaIsNewEmptyGuide)){let e=".smooth-width-transition";try{await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return new Promise((r,a)=>{let i=Date.now(),n=setInterval(()=>{document.querySelector(e)?(clearInterval(n),r()):Date.now()-i>t&&(clearInterval(n),a(Error("Timeout waiting for DOM element")))},50)})}(e,15e3);let a=document.querySelector(e);a&&await new Promise((e,i)=>{let o=()=>{e(void 0),setTimeout(()=>{t.trigger(c(s)[n.F3.EditorAreaIsNewEmptyGuide]),r.setViewStateToLocal(n.F3.EditorAreaIsNewEmptyGuide,!0),a.removeEventListener("transitionend",o)},300)};a.addEventListener("transitionend",o),setTimeout(()=>{a.removeEventListener("transitionend",o),i(Error("fallback"))},1e4)})}catch(e){t.trigger(c(s)[n.F3.EditorAreaIsNewEmptyGuide]),r.setViewStateToLocal(n.F3.EditorAreaIsNewEmptyGuide,!0)}finally{d.dispose()}}})}function u(e){e.invokeFunction(d)}},443619:function(e,t,r){r.d(t,{I:function(){return o}});var a=r(356954);let i="cancel_sub_popup";class n{getEventParams(){return this._params}constructor(e){this._params=e,this.eventName=i}}function o(e,t,r){i===r&&(0,a.K)(e,n,[t])}},140515:function(e,t,r){r.d(t,{Dd:function(){return u},UL:function(){return c},Yp:function(){return d},lT:function(){return p}});var a,i,n,o=r(789786),s=r(108692),l=r(356954);var c=((a={}).Show="show",a.GoBack="go_back",a.Continue="continue",a.LearnMore="learn_more",a.Cancel="cancel",a.Close="close",a.Reject="reject",a.Allow="allow",a);var d=((i={}).AiCharacter="ai_character",i);var u=((n={}).VoiceSeparation="voice_isolation",n.VoiceBeautify="enhance_voice",n);class h{getEventParams(){return{...this._params}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="compliance_popup"}}function p(e,t){(0,l.K)(e,h,[t])}h=(0,o.gn)([(0,o.fM)(1,s.n),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[Object,void 0===s.n?Object:s.n])],h)},534359:function(e,t,r){r.d(t,{Hs:function(){return o},zW:function(){return s}});var a=r(258150);let i=a.Hs,n=a.zW;function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];i(...t)}function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n(...t)}},534124:function(e,t,r){r.d(t,{_:function(){return a}});let a=e=>{var t,r;let a=null!==(r=null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.fragments)&&void 0!==r?r:[];return Array.isArray(a)&&a.some(e=>!!e.relation_video_group)}},752075:function(e,t,r){r.d(t,{Lw:function(){return o},U2:function(){return s}});var a=r(356954),i=r(58377);class n{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="ai_writer_option_click"}}function o(e,t){(0,a.K)(e,n,[t])}function s(e){switch(e){case i.U.Longer:return"writer_longer";case i.U.Shorter:return"write_shorter";case i.U.Rewrite:return"rewrite";case i.U.GenerateText:return"generate_text";case i.U.GenerateTitle:return"generate_title";default:return""}}},54949:function(e,t,r){r.d(t,{N:function(){return n},a:function(){return s}});var a,i=r(356954);var n=((a={}).MOVE="move",a.ZOOM_IN="zoom_in",a.ZOOM_OUT="zoom_out",a.ROTATE="rotate",a);class o{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="batch_player_action"}}function s(e,t){(0,i.K)(e,o,[t])}},937567:function(e,t,r){r.r(t),r.d(t,{ATOMIC_TASKS:function(){return ek},BODY_SCRIPT_EXECUTION:function(){return j},CHECK_WEBGL2:function(){return y},COMPILE_JS:function(){return u},COMPILE_WASM:function(){return h},COMPILE_WORKER:function(){return p},CREATE_MODULE:function(){return f},CREATE_OBJECT:function(){return a},DOWNLOAD_DRAFT:function(){return w},DOWNLOAD_EFFECTS:function(){return I},DOWNLOAD_JS:function(){return c},DOWNLOAD_MATERIALS_BUILTIN:function(){return D},DOWNLOAD_MATERIALS_DEFAULT:function(){return ed},DOWNLOAD_MATERIALS_EVERCLOUD:function(){return E},DOWNLOAD_MATERIALS_ONLINE:function(){return P},DOWNLOAD_SEGMENTS_FIRST_FRAME:function(){return A},DOWNLOAD_SIDE_MODULE_WASM:function(){return l},DOWNLOAD_WASM:function(){return s},DOWNLOAD_WORKER:function(){return d},EDITOR_LOAD_DRAFT:function(){return b},EDITOR_NEW_WORKSPACE:function(){return M},EDITOR_PRELOAD_DRAFT:function(){return T},ENSURE_DEFAULT_AUDIO:function(){return eM},ENSURE_DEFAULT_AUDIO_DENOISE_MODEL:function(){return eT},ENSURE_DEFAULT_SPRITE:function(){return eb},ENTRY_SCRIPT_EXECUTION:function(){return U},FIRST_FRAME_JSONP:function(){return H},FORMAT_PRELOAD:function(){return N},FS_MOUNT:function(){return n},GENERATE_DIFF_DATA:function(){return ea},GET_CLOUD_VISIBLE_INFO:function(){return F},GET_PACKAGE_INFO:function(){return R},GET_TEMPLATE_INFO:function(){return x},HEAD_SCRIPT_EXECUTION:function(){return L},IMPORT_MAIN_JS:function(){return g},INIT_CACHE:function(){return o},INIT_CONTAINER_SERVICE:function(){return en},INIT_EVER_CLOUD_TOKEN:function(){return eh},INIT_GLOBAL_SERVICE:function(){return ei},INIT_I18N:function(){return S},INIT_MAIN_EDITOR_WIDGET:function(){return eo},INIT_PROJECT_TAB:function(){return e_},INIT_WEBMS_SDK:function(){return ep},INIT_WORKSPACE_INITIALIZE:function(){return es},INIT_WORKSPACE_SET_SPACE_INFO:function(){return el},INSTANTIATE:function(){return _},LAYER_RENDER:function(){return J},LOAD_BUSINESS_DRAFT:function(){return k},LOAD_CONTRIBUTIONS:function(){return ec},LOAD_DRAFT_WAIT_PROMISE:function(){return W},LOAD_MODULE:function(){return i},LOAD_WASM:function(){return v},LOGIN_CHECK:function(){return Z},LVVE_DESERIALIZE_JSON:function(){return q},LVVE_FILL_JSON:function(){return $},LVVE_FIX_JSON:function(){return ee},LVVE_READ_JSON:function(){return X},LVVE_SET_MUTABLE:function(){return z},LVVE_UPGRADE:function(){return et},PACKAGE_INFO_JSONP:function(){return Q},PRELOAD_INJECTED_DRAFT_RESOURCES:function(){return O},PRERENDER_FIRST_FRAME:function(){return G},REACT_RENDER:function(){return V},RENDER_INITIAL_TIMELINE:function(){return eg},RESTORE_FIRST_FRAME:function(){return er},SEEK_FIRST_FRAME:function(){return em},SET_CANVAS_SIZE:function(){return ef},SIDE_CODE_SCRIPT_EXECUTION:function(){return B},TEMPLATE_INFO_JSONP:function(){return K},TRANSFORM_TO_BLOB_URL:function(){return m},TTV:function(){return Y},USER_INTERACT_SCENARIO:function(){return C},WAIT_EDITOR_WIDGET_LIFECYCLE_CHANGE:function(){return ey},WAIT_FOR_VE_UTILS:function(){return eS},WAIT_RESOURCE_META:function(){return eu},WEB_CALL_VE_SEEK:function(){return ev}});let a="EDITOR_SDK_CREATE_OBJECT",i="EDITOR_SDK_LOAD_MODULE",n="EDITOR_SDK_FS_MOUNT",o="LOADER_INIT_CACHE",s="LOADER_DOWNLOAD_WASM",l="LOADER_DOWNLOAD_WASM_SIDE_MODULE",c="LOADER_DOWNLOAD_JS",d="LOADER_DOWNLOAD_WORKER",u="LOADER_COMPILE_JS",h="LOADER_COMPILE_WASM",p="LOADER_COMPILE_WORKER",_="LOADER_INSTANTIATE",g="LOADER_IMPORT_MAIN_JS",f="LOADER_CREATE_MODULE",m="LOADER_TRANSFORM_TO_BLOB_URL",v="LOADER_LOAD_WASM",y="CHECK_WEBGL2",S="INIT_I18N",M="EDITOR_NEW_WORKSPACE",T="EDITOR_PRELOAD_DRAFT",b="EDITOR_LOAD_DRAFT",k="LOAD_BUSINESS_DRAFT",w="DOWNLOAD_DRAFT",I="DOWNLOAD_EFFECTS",E="DOWNLOAD_MATERIALS_EVERCLOUD",P="DOWNLOAD_MATERIALS_ONLINE",D="DOWNLOAD_MATERIALS_BUILTIN",A="DOWNLOAD_SEGMENTS_FIRST_FRAME",C="USER_INTERACT_SCENARIO",R="GET_PACKAGE_INFO",x="GET_TEMPLATE_INFO",O="PRELOAD_INJECTED_DRAFT_RESOURCES",F="GET_CLOUD_VISIBLE_INFO",N="FORMAT_PRELOAD",V="REACT_RENDER",L="HEAD_SCRIPT_EXECUTION",j="BODY_SCRIPT_EXECUTION",U="ENTRY_SCRIPT_EXECUTION",B="SIDE_CODE_SCRIPT_EXECUTION",W="LOAD_DRAFT_WAIT_PROMISE",Z="LOGIN_CHECK",G="PRERENDER_FIRST_FRAME",H="FIRST_FRAME_JSONP",Q="PACKAGE_INFO_JSONP",K="TEMPLATE_INFO_JSONP",z="LVVE_SET_MUTABLE",Y="ttv",J="LAYER_RENDER",$="LVVE_FILL_JSON",q="LVVE_DESERIALIZE_JSON",X="LVVE_READ_JSON",ee="LVVE_FIX_JSON",et="LVVE_UPGRADE",er="RESTORE_FIRST_FRAME",ea="GENERATE_DIFF_DATA",ei="INIT_GLOBAL_SERVICE",en="INIT_CONTAINER_SERVICE",eo="INIT_MAIN_EDITOR_WIDGET",es="INIT_WORKSPACE_INITIALIZE",el="INIT_WORKSPACE_SET_SPACE_INFO",ec="LOAD_CONTRIBUTIONS",ed="DOWNLOAD_MATERIALS_DEFAULT",eu="WAIT_RESOURCE_META",eh="INIT_EVER_CLOUD_TOKEN",ep="INIT_WEBMS_SDK",e_="INIT_PROJECT_TAB",eg="RENDER_INITIAL_TIMELINE",ef="SET_CANVAS_SIZE",em="SEEK_FIRST_FRAME",ev="WEB_CALL_VE_SEEK",ey="WAIT_EDITOR_WIDGET_LIFECYCLE_CHANGE",eS="WAIT_FOR_VE_UTILS",eM="ENSURE_DEFAULT_AUDIO",eT="ENSURE_DEFAULT_AUDIO_DENOISE_MODEL",eb="ENSURE_DEFAULT_SPRITE",ek=[s,c,d,u,h,p,o,_,g,f,m,v,l,y,S,M,b,k,er,w,I,E,P,D,A,R,x,V,L,j,U,B,G,H,Q,K,Z,$,q,X,ee,n,a,i,ei,en,eo,es,el,ec,ed,eu,eh,z,e_,eg,ep,ef,ey,ea,em,eS,eM,eT,eb]},344085:function(e,t,r){r.d(t,{T:function(){return n}});var a=r(356954);class i{getEventParams(){return{url:location.href,url_path:location.pathname,title:document.title}}constructor(){this.eventName="page_view"}}function n(e){(0,a.K)(e,i,[])}},206994:function(e,t,r){r.d(t,{b:function(){return i}});var a=r(31463);function i(e,t){e.invokeFunction(e=>{e.get(a.m).reportDevEvent("sub_draft_depth",{depth:t})})}},157604:function(e,t,r){r.d(t,{D1:function(){return h},LB:function(){return g},hi:function(){return p},x3:function(){return u}});var a,i,n,o=r(860660),s=r(356954),l=r(425427),c=r(896413),d=r(108692);var u=((a={}).Position="position",a.Rotate="rotate",a.Scale="scale",a.EditText="edit_text",a);var h=((i={}).Canvas="canvas",i.Shortcut="shortcut",i);var p=((n={}).Default="",n.MoveUp1Px="move_up_1px",n.MoveDown1Px="move_down_1px",n.MoveLeft1Px="move_left_1px",n.MoveRight1Px="move_right_1px",n.MoveUp10Px="move_up_10px",n.MoveDown10Px="move_down_10px",n.MoveLeft10Px="move_left_10px",n.MoveRight10Px="move_right_10px",n);class _{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="material_canvas_transform"}}function g(e,t){var r;let a=e.invokeFunction(e=>e.get(l.rO));if((0,l.JY)(a))return;let i=e.invokeFunction(e=>e.get(c.a)),{dataSdk:n}=e.invokeFunction(e=>e.get(d.n)),{draftId:u,subDraftId:h}=i.segmentSelection,p=t.segmentIds.map(e=>n.draftView.getSegmentById(e));if(!p)return;let g=p.map(e=>(0,o.p8)(e)),f="",m="",v="";g.forEach((e,t)=>{f=f.concat(`${t>0?",":""}${e.material_type}`),m=m.concat(`${t>0?",":""}${e.material_category}`),v=v.concat(`${t>0?",":""}${e.track_category}`)}),(0,s.K)(e,_,[{draft_id:null!==(r=null!=h?h:u)&&void 0!==r?r:"",material_type:f,material_category:m,track_category:v,action:t.action,action_type:t.actionType,shortcut_value:t.shortcutValue,template_id:i.segmentSelection.subDraftTemplateId||void 0}])}},667014:function(e,t,r){r.d(t,{SC:function(){return s},rK:function(){return o},vV:function(){return c}});var a,i,n=r(356954);var o=((a={}).Success="success",a.Failed="fail",a.Cancel="cancel",a);var s=((i={}).Cancel="cancel",i.ServiceError="server_error",i.NetworkError="network_error",i.NoSubject="no_object",i.Timeout="timeout",i);class l{getEventParams(){var e;return{material_type:null!==(e=this._params.materialType)&&void 0!==e?e:"image",material_format:this._params.materialFormat,material_resolution:this._params.materialResolution,crop_resolution:this._params.cropResolution,time:this._params.time,status:this._params.status,fail_reason:this._params.failReason}}constructor(e){this._params=e,this.eventName="smart_crop_status"}}function c(e,t){(0,n.K)(e,l,[t])}},199644:function(e,t,r){r.d(t,{l:function(){return s}});var a=r(789786),i=r(108692),n=r(356954);class o{getEventParams(){return{action:this._params.action,current_tool:this._params.current_tool,target_tool:this._params.target_tool}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="smart_exclude_pop"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,i.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===i.n?Object:i.n])],o)},209537:function(e,t,r){r.d(t,{V:function(){return s}});var a=r(789786),i=r(108692),n=r(356954);class o{getEventParams(){return{draft_id:this._mainDraftService.dataSdk.draftView.getDraftId(),material_type:this._params.material_type,reco_time_ms:this._params.reco_time_ms}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="recognizing_objects"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,i.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===i.n?Object:i.n])],o)},720196:function(e,t,r){r.d(t,{e:function(){return s}});var a=r(789786),i=r(108692),n=r(356954);class o{getEventParams(){return{draft_id:this._mainDraftService.dataSdk.draftView.getDraftId(),material_type:this._params.material_type,material_format:this._params.material_format,material_resolution:this._params.material_resolution,crop_resolution:this._params.crop_resolution,duration:this._params.duration,time:this._params.time,status:this._params.status,fail_reason:this._params.fail_reason}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="smart_crop_status"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,i.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===i.n?Object:i.n])],o)},710763:function(e,t,r){r.d(t,{T:function(){return l},r:function(){return c}});var a=r(789786),i=r(108692),n=r(356954),o=r(860660);class s{getEventParams(){return{action_type:this._params.action_type,batch_cnt:this._params.batch_cnt,material_category:this._params.material_category}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="batch_selection"}}function l(e){let{ids:t,action:r,draftView:a,transitionIds:i}=e,n=[];return t.forEach(e=>{let t=a.getSegmentById(e),r=!!(null==i?void 0:i.includes(e));if(!t&&!r){console.error(`warning: BatchSelectionReport get invalid segmentId: ${e}`);return}n.push(r?"trans":(0,o.p8)(t).material_category)}),{action_type:r,batch_cnt:t.length,material_category:n.join(",")}}function c(e,t){(0,n.K)(e,s,[t])}s=(0,a.gn)([(0,a.fM)(1,i.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===i.n?Object:i.n])],s)},221242:function(e,t,r){r.d(t,{H:function(){return n}});var a=r(356954);class i{getEventParams(){return{absorb_status:this._params.absorb_status,is_batch:this._params.is_batch,material_category:this._params.material_category,material_id:this._params.material_id,material_name:this._params.material_name,material_subcategory:this._params.material_subcategory,material_subcategory_id:this._params.material_subcategory_id,material_thirdcategory:this._params.material_thirdcategory,material_thirdcategory_id:this._params.material_thirdcategory_id,track_category:this._params.track_category}}constructor(e){this._params=e,this.eventName="move_material_segment"}}function n(e,t){(0,a.K)(e,i,[t])}},836172:function(e,t,r){r.d(t,{e:function(){return n}});var a=r(356954);class i{getEventParams(){return{option:this._params.option,switch_type:this._params.switch_type}}constructor(e){this._params=e,this.eventName="preview_axis_options"}}function n(e,t){(0,a.K)(e,i,[t])}},34044:function(e,t,r){r.d(t,{M:function(){return n}});var a=r(356954);class i{getEventParams(){return Object.assign({duration:this._params.duration,seek_type:this._params.seek_type,template_id:this._params.template_id||void 0})}constructor(e){this._params=e,this.eventName="seek_cut_material"}}function n(e,t){(0,a.K)(e,i,[t])}},632172:function(e,t,r){r.d(t,{s:function(){return n}});var a=r(356954);class i{getEventParams(){return{duration:this._params.duration,seek_type:this._params.seek_type}}constructor(e){this._params=e,this.eventName="seek_timeline"}}function n(e,t){(0,a.K)(e,i,[t])}},540731:function(e,t,r){r.d(t,{H:function(){return n}});var a=r(356954);class i{getEventParams(){let e={status:this._params.status};return void 0!==this._params.fail_reason&&(e.fail_reason=this._params.fail_reason),e}constructor(e){this._params=e,this.eventName="auto_split_result"}}function n(e,t){(0,a.K)(e,i,[t])}},143113:function(e,t,r){r.d(t,{z:function(){return d}});var a=r(789786),i=r(356954),n=r(782350),o=r(108692);let s=e=>{let t=(null==e?void 0:e.role)==="owner"||(null==e?void 0:e.workspace_id)==="0"||!(null==e?void 0:e.workspace_id);return{rawSpaceType:t?null==e?void 0:e.raw_space_type:3,spaceType:t?null==e?void 0:e.space_type:3}},l=e=>(null!=e?e:0)/1024/1024/1024;class c{getEventParams(){let{action:e,enter_from:t,to_workspace_id:r}=this._params,a=this._mainDraftService.draftWorkspaceManager.workspaceId,i={action:e,enter_from:t};return a&&Object.assign(i,this.getFromWorkspaceInfo(a)),r&&Object.assign(i,this.getToWorkspaceInfo(r)),i}getFromWorkspaceInfo(e){let{workspaceList:t}=this._workspaceService,r=t.find(t=>t.workspace_id===e),a=s(r);return{from_space_id:null==r?void 0:r.space_id,from_space_limit:l(null==r?void 0:r.quota),from_space_used:l(null==r?void 0:r.usage),from_space_user_cnt:null==r?void 0:r.member_cnt,from_workspace_raw_space_type:a.rawSpaceType,from_workspace_space_type:a.spaceType}}getToWorkspaceInfo(e){let{workspaceList:t}=this._workspaceService,r=t.find(t=>t.workspace_id===e),a=s(r);return{to_space_id:null==r?void 0:r.space_id,to_space_limit:l(null==r?void 0:r.quota),to_space_used:l(null==r?void 0:r.usage),to_space_user_cnt:null==r?void 0:r.member_cnt,to_workspace_raw_space_type:a.rawSpaceType,to_workspace_space_type:a.spaceType}}constructor(e,t,r){this._params=e,this._workspaceService=t,this._mainDraftService=r,this.eventName="change_dictionary_window"}}function d(e,t){(0,i.K)(e,c,[t])}c=(0,a.gn)([(0,a.fM)(1,n.W),(0,a.fM)(2,o.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===n.W?Object:n.W,void 0===o.n?Object:o.n])],c)},270679:function(e,t,r){r.d(t,{c:function(){return n}});var a=r(356954);class i{getEventParams(){return{position:this._params.position}}constructor(e){this._params=e,this.eventName="click_change_dictionary"}}function n(e,t){(0,a.K)(e,i,[t])}},991153:function(e,t,r){r.d(t,{$:function(){return l}});var a=r(789786),i=r(230689),n=r(356954),o=r(841297);class s{getEventParams(){let{status:e,reason:t}=this._params;return{...this._exportParams.getEventParams(),status:e,fail_reason:t}}constructor(e,t){this._params=e,this._containerService=t,this.eventName="template_publish_status",this._exportParams=this._containerService.createInstance(o.fi,this._params)}}function l(e,t){(0,n.K)(e,s,[t])}s=(0,a.gn)([(0,a.fM)(1,i.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ITemplatePostReportParams?Object:ITemplatePostReportParams,void 0===i.t?Object:i.t])],s)},823129:function(e,t,r){r.d(t,{e:function(){return n}});var a=r(356954);class i{getEventParams(){return{is_auto:this._params.isAuto,method:this._params.method}}constructor(e){this._params=e,this.eventName="audio_spot_add"}}function n(e,t){(0,a.K)(e,i,[t])}},345685:function(e,t,r){r.d(t,{u:function(){return s}});var a=r(789786),i=r(108692),n=r(356954);class o{getEventParams(){return{action:this._params.action,is_auto:this._params.is_auto,method:this._params.method}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="audio_spot_delete"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,i.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===i.n?Object:i.n])],o)},288154:function(e,t,r){r.d(t,{P:function(){return s}});var a=r(789786),i=r(108692),n=r(356954);class o{getEventParams(){return{action_type:this._params.action_type,keyframe_cnt:this._params.keyframe_cnt,material_category:this._params.material_category,option_type:this._params.option_type,track_category:this._params.track_category,function_category:this._params.function_category,function_subcategory:this._params.function_subcategory,material_id:this._params.material_id,apply_to_all:this._params.apply_to_all,control_detail:this._params.control_detail,control_type:this._params.control_type}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="click_keyframe_option"}}function s(e,t){(0,n.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,i.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IParams?Object:IParams,void 0===i.n?Object:i.n])],o)},339693:function(e,t,r){r.d(t,{X:function(){return n}});var a=r(356954);class i{getEventParams(){let{cbValue:{rc:e,worker2mainCostTime:t}}=this._params;return{rc:e,worker2mainCostTime:t}}constructor(e){this._params=e,this.eventName="ve_async_api_performance_report"}}function n(e,t){(0,a.K)(e,i,[t])}},409519:function(e,t,r){r.d(t,{n:function(){return s}});var a=r(789786),i=r(356954),n=r(108692);class o{getEventParams(){let{action:e,calcMd5Duration:t,analyzeFileDuration:r,materialName:a,materialSize:i,isFastImport:n,duration:o}=this._params;return{action:e,calc_md5_duration:t,analyze_file_duration:r,is_cals_md5_long_then_analyze_file:t&&r?t>r?1:0:void 0,material_name:a,material_size:i,is_fast_import:void 0===n?void 0:n?1:0,duration:o}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="import_material_analyze"}}function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,i.K)(e,o,[t],{immediately:r})}o=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IImportMaterialAnalyze?Object:IImportMaterialAnalyze,void 0===n.n?Object:n.n])],o)},718901:function(e,t,r){r.d(t,{l:function(){return n}});var a=r(356954);class i{getEventParams(){let{report:e}=this._params;return{...e}}constructor(e){this._params=e,this.eventName="perf_widget_transform_report"}}function n(e,t){(0,a.K)(e,i,[t])}},489753:function(e,t,r){r.d(t,{r:function(){return n}});var a=r(356954);class i{getEventParams(){return{time:this._params.time}}constructor(e){this._params=e,this.eventName="track_video_first_frame_time"}}function n(e,t){(0,a.K)(e,i,[t])}},356954:function(e,t,r){r.d(t,{K:function(){return i},z:function(){return n}});var a=r(195471);function i(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0;(0,a.K)(e,t,r,i)}function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0;(0,a.z)(e,t,r,i)}},475231:function(e,t,r){r.d(t,{i:function(){return l}});var a=r(114861),i=r(629351),n=r(415266),o=r(405051),s=r(141314);let l=new class e{report(e){this._reportActionArgs(e)}_reportActionArgs(e){let{draftId:t}=e;if(!t)return;let r={workspace_id:function(){let{searchParams:e}=new URL(window.location.href);return e.get("workspaceId")}(),draft_key:t,commit_action_data:{mutations:{logger_count:++this._loggerCount,apiNamespace:e.apiNamespace,apiName:e.apiName,args:e.args}}},a=this._urlGenerator.url("COMMIT_ACTION");try{this._getNetworkClient().post(a,r,{withCredentials:!0})}catch(e){}}_getNetworkClient(){return!this._networkClient&&(this._networkClient=new o.yk().build(o.kk),(0,a.V)(this._networkClient),(0,i.V)(this._networkClient,{appVersion:"999.999.999"})),this._networkClient}constructor(){this._loggerCount=0,this._urlGenerator=new s.w(n.c)}}},874916:function(e,t,r){r.d(t,{L:function(){return s}});var a=r(789786),i=r(356954),n=r(108692);class o{getEventParams(){let{saveStatus:e,failReason:t,packageId:r}=this._params,a={save_status:e,package_id:r,action:"auto",quick_import_segments:this._mainDraftService.dataSdk.draftView.getQuickImportSegments().map(e=>e.id).join(",")};return t&&(a.fail_reason=t),a}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="draft_save"}}function s(e,t){(0,i.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IAutoDraftSaveParams?Object:IAutoDraftSaveParams,void 0===n.n?Object:n.n])],o)},559992:function(e,t,r){r.d(t,{M:function(){return s}});var a=r(789786),i=r(356954),n=r(108692);class o{getEventParams(){let{versionStacking:e}=this._params;return{version_stacking:e}}constructor(e,t){this._params=e,this._mainDraftService=t,this.eventName="incremental_save"}}function s(e,t){(0,i.K)(e,o,[t])}o=(0,a.gn)([(0,a.fM)(1,n.n),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDraftSaveQueueParams?Object:IDraftSaveQueueParams,void 0===n.n?Object:n.n])],o)},594061:function(e,t,r){r.d(t,{Z:function(){return n}});var a=r(356954);class i{getEventParams(){return this._params}constructor(e){this._params=e,this.eventName="upgrade_draft_step"}}function n(e,t){(0,a.K)(e,i,[t])}},485634:function(e,t,r){r.d(t,{c:function(){return n}});var a=r(356954);class i{getEventParams(){return{...this._params,decrypt_key:this._params.decryptKey,resource_path:this._params.resourcePath}}constructor(e){this._params=e,this.eventName="ve_get_media_info"}}function n(e,t){(0,a.K)(e,i,[t])}},848339:function(e,t,r){r.d(t,{_J:function(){return o},kw:function(){return s},nV:function(){return c}});var a,i,n=r(356954);var o=((a={}).Unknown="unknown",a.WebGLContextLost="webgl_context_lost",a);var s=((i={}).Display="render_error_modal_display",i.ReloadClick="render_error_modal_reload_click",i);class l{getEventParams(){return{...this._params}}constructor(e){this._params=e,this.eventName="render_layer_error"}}function c(e,t){(0,n.K)(e,l,[t])}},431535:function(e,t,r){r.d(t,{O:function(){return n}});var a=r(356954);class i{getEventParams(){let{sync2UserMaterialInfos:e}=this._params;return{msg:JSON.stringify({sync2UserMaterialInfos:e})}}constructor(e){this._params=e,this.eventName="sync_template_resources"}}function n(e,t){(0,a.K)(e,i,[{sync2UserMaterialInfos:t}])}},128563:function(e,t,r){r.d(t,{n:function(){return n}});var a=r(356954);class i{getEventParams(){let{templateId:e,producerBizId:t,userBizId:r,missEffect:a,missOnline:i,scene:n}=this._params,o=[];a.length&&o.push("miss_effect"),i.length&&o.push("miss_online");let{searchParams:s}=new URL(window.location.href);return{template_id:e,reason:o.join(","),miss_effect:a.filter(Boolean).map(e=>e.replace("loki://","")).join(","),miss_online:i.filter(Boolean).join(","),user_bizid:"number"!=typeof r||r<0?-1:r,producer_bizid:"number"!=typeof t||t<0?-1:t,channel:"tiktok_anchor"===s.get("utm_medium")?"tiktok_anchor":void 0,scene:n}}constructor(e){this._params=e,this.eventName="sync_template_production_recall"}}function n(e,t,r,n,o){var s;let l=null===(s=r.unresolvedEverCloudMaterials)||void 0===s?void 0:s.filter(e=>{var t;return null==e?void 0:null===(t=e.online)||void 0===t?void 0:t.resourceId}).map(e=>{var t;return null==e?void 0:null===(t=e.online)||void 0===t?void 0:t.resourceId}),c=null==n?void 0:n.unresolvedEffects;if(!c.length&&!l.length)return;let{id:d,userBizId:u=-1,producerBizId:h=-1}=t;(0,a.K)(e,i,[{templateId:d,missOnline:l,missEffect:c,userBizId:u,producerBizId:h,scene:o}])}},147954:function(e,t,r){r.d(t,{I:function(){return i}});var a=r(587892);class i{get onEnterAudioRecordingMode(){return this._onEnterAudioRecordingMode.event}enterAudioRecordingModeChange(e){this._onEnterAudioRecordingMode.fire(e)}constructor(){this._onEnterAudioRecordingMode=new a.Q}}},307891:function(e,t,r){r.d(t,{W:function(){return c},_:function(){return l}});var a,i=r(789786),n=r(260963),o=r(148347),s=r(352269);var l=((a={})[a.PROCESSING=0]="PROCESSING",a[a.SUCCESS=1]="SUCCESS",a[a.ERROR=2]="ERROR",a);class c{get isRecorderActive(){return this.isActive||this.isAudioRecorderPanelVisible}get isAudioRecording(){return this.isAudioRecorderPanelVisible&&[o.rf.RECORDING,o.rf.PAUSED].includes(this.recordStatus)}get convertingStreamAssets(){return this.streamConvertingQueue.filter(e=>{let{status:t}=e;return 0===t})}get hasConvertingStreamAssets(){return this.convertingStreamAssets.length>0}get hasErrorStreamAssets(){return this.streamConvertingQueue.filter(e=>{let{status:t}=e;return 2===t}).length>0}get videoDevices(){return this.devices.filter(e=>e.kind.includes("videoinput"))}get audioDevices(){return this.devices.filter(e=>e.kind.includes("audioinput"))}get remainingRecordTime(){return s.wo-this.recordProceedTime}static getInstance(){var e;return this._instance=null!==(e=this._instance)&&void 0!==e?e:new c}toggleRecorder(e){this.isActive=e}toggleIsAudioRecorderPanelVisible(e){this.isAudioRecorderPanelVisible=e}toggleRecorderUI(e,t){e===o.t9.AUDIO?this.toggleIsAudioRecorderPanelVisible(t):(t&&(this.isAudioRecorderPanelVisible=!1),this.toggleRecorder(t))}toggleMicrophone(e){this.isMicMuted=e}toggleRecorderExtension(e,t){this.isExtensionActive=e,this.customDraftData=e?t:void 0,this.customDraftData&&this.setRecordStatus(o.rf.FINISHED)}setRecordSourceType(e){this.sourceType=e}setCaptureStream(e){this.captureStream=e}setRecordStatus(e){this.recordStatus=e}setRecordStartTime(e){this.recordStartTime=e}setRecordProceedTime(e){this.recordProceedTime=e}setDevices(e){this.devices=e}setExtensionInstalled(e){this.isExtensionInstalled=e}setExtensionInstallLink(e){this.extensionInstallLink=e}setIsRestarting(e){this.isRestarting=e}setCaptureInfo(e){this.captureInfo=e}setHasResize(e){this.hasResize=e}setCameraInfo(e){this.cameraInfo={...this.cameraInfo,...e}}setMicInfo(e){this.micInfo={...this.micInfo,...e}}setTeleprompterInfo(e){Object.assign(this.teleprompterInfo,e)}setContainerRect(e){this.containerRect=e}setIsPreparing(e){this.isPreparing=e}setIsSavingRecord(e){this.isSavingRecord=e}setIsReplacingRecord(e){this.isReplacingRecord=e}setPermissionForbidden(e){this.permissionForbidden=e}addScreenRecorderMaterialsPath(e){this.screenRecorderMaterialsPath=[...this.screenRecorderMaterialsPath,e]}setStreamConvertingItem(e,t){let r=this.streamConvertingQueue,a=r.findIndex(t=>e===t.uploadId);-1===a?this.streamConvertingQueue.push({uploadId:e,...t}):a>-1&&0!==t.status&&(r[a]={...r[a],...t},this.streamConvertingQueue=[...r])}batchSetStreamConvertingItems(e){let t=this.streamConvertingQueue;e.forEach(e=>{let r=t.findIndex(t=>{let{uploadId:r}=t;return r===e.uploadId});r>-1&&(t[r]={...t[r],...e})}),this.streamConvertingQueue=[...t]}setMicGainDB(e){this.micGainDB=e}setConflictInfo(e){Object.assign(this.conflictInfo,e)}setShowRecordGuideBadge(e){this.showRecordGuideBadge=e}setEnteringAudioRecordMode(e){this.enteringAudioRecordMode=e}setIsSpaceStorageEnough(e){this.isSpaceStorageEnough=e}constructor(){this.isActive=!1,this.sourceType=null,this.recordStatus=o.rf.INIT,this.recordStartTime=-1,this.recordProceedTime=0,this.hasResize=!1,this.isMicMuted=!1,this.isRestarting=!1,this.customDraftData=void 0,this.devices=[],this.streamConvertingQueue=[],this.micGainDB=0,this.enteringAudioRecordMode=!1,this.extensionInstallLink="https://chromewebstore.google.com/detail/capcut-screen-recorder/dojcmakgodofecjmdnncjkbhmddlmnpf",this.isExtensionInstalled=!1,this.cameraInfo={isActive:!1,position:{y:-1,x:-1},size:{width:200,height:200},stream:void 0,isMoved:!1},this.teleprompterInfo={position:{x:0,y:0},textAreaSize:s.sU,fontSize:20,content:""},this.containerRect=null,this.micInfo={isActive:!1,stream:void 0,volume:0},this.isSavingRecord=!1,this.isReplacingRecord=!1,this.isPreparing=!1,this.permissionForbidden=0,this.screenRecorderMaterialsPath=[],this.conflictInfo={showModal:!1},this.showRecordGuideBadge="true"!==localStorage.getItem(s.Xn),this.isExtensionActive=!1,this.isSpaceStorageEnough=!0,(0,n.ky)(this)}}(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"toggleRecorder",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"toggleIsAudioRecorderPanelVisible",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.t9?Object:o.t9,Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"toggleRecorderUI",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"toggleMicrophone",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean,"undefined"==typeof RecordDraftDesc?Object:RecordDraftDesc]),(0,i.w6)("design:returntype",void 0)],c.prototype,"toggleRecorderExtension",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.t9?Object:o.t9]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setRecordSourceType",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setCaptureStream",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===o.rf?Object:o.rf]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setRecordStatus",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Number]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setRecordStartTime",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Number]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setRecordProceedTime",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setDevices",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setExtensionInstalled",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setExtensionInstallLink",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setIsRestarting",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setCaptureInfo",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setHasResize",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof Partial?Object:Partial]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setCameraInfo",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof Partial?Object:Partial]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setMicInfo",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof Partial?Object:Partial]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setTeleprompterInfo",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setContainerRect",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setIsPreparing",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setIsSavingRecord",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setIsReplacingRecord",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Number]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setPermissionForbidden",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String]),(0,i.w6)("design:returntype",void 0)],c.prototype,"addScreenRecorderMaterialsPath",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[String,Object]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setStreamConvertingItem",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array]),(0,i.w6)("design:returntype",void 0)],c.prototype,"batchSetStreamConvertingItems",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Number]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setMicGainDB",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",["undefined"==typeof Partial?Object:Partial]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setConflictInfo",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setShowRecordGuideBadge",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setEnteringAudioRecordMode",null),(0,i.gn)([n.aD,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Boolean]),(0,i.w6)("design:returntype",void 0)],c.prototype,"setIsSpaceStorageEnough",null)},520980:function(e,t,r){r.d(t,{n:function(){return n}});var a=r(127830),i=r(320271);let n={[a._g.CurveHSL]:i.U_.CurveHSL,[a._g.Integration]:i.U_.Integration,[a._g.CurvePreset]:i.U_.CurveAdjustPreset,[a._g.VoiceChange]:i.U_.VoiceChange,[a._g.AISkeletonBody]:i.U_.Beauty2,[a._g.SkeletonBody]:i.U_.SkeletonBody,[a._g.TextTemplate]:i.U_.TextTemplate,[a._g.ShootProp]:i.U_.ShootProp,[a._g.Play]:i.U_.Play,[a._g.Beauty]:i.U_.Beauty,[a._g.AutoBeautyBody]:i.U_.AutoBeautyBody,[a._g.AutoBeautyShape]:i.U_.AutoBeautyShape,[a._g.AutoBeautyFace]:i.U_.AutoBeauty,[a._g.AutoBeautyMakeup]:i.U_.AutoBeautyMakeup,[a._g.Sticker]:i.U_.Default,[a._g.Effects]:i.U_.Effects,[a._g.FaceProp]:i.U_.FaceProp,[a._g.Tone]:i.U_.Tone,[a._g.Filter]:i.U_.Filter,[a._g.VideoBackground]:i.U_.Canvas,[a._g.TextPreset]:i.U_.Flower,[a._g.VideoMotion]:i.U_.Video,[a._g.TextMotion]:i.U_.Text,[a._g.StickerMotion]:i.U_.Sticker,[a._g.Transition]:i.U_.Transitions,[a._g.Mix]:i.U_.Mix,[a._g.Bubble]:i.U_.Bubble,[a._g.Font]:i.U_.Fonts,[a._g.SystemFonts]:i.U_.SystemFonts,[a._g.Mask]:i.U_.Videomask,[a._g.CurveSpeed]:i.U_.Curvespeed,[a._g.ShapeAnimation]:i.U_.ShapeAnimation,[a._g.Graffiti]:i.U_.Graffiti,[a._g.PathAnimation]:i.U_.PathAnimation,[a._g.AiAvatarMask]:i.U_.AiavatarMask,[a._g.Emoji]:i.U_.Emoji,[a._g.SmartColorAdjust]:i.U_.SmartColorAdjust,[a._g.TextGlow]:i.U_.TextGlow,[a._g.ObjectLock]:i.U_.ObjectLock,[a._g.MattingStroke]:i.U_.MattingStroke}},384833:function(e,t,r){r.d(t,{O:function(){return i}});var a=r(587892);class i{get canUndo(){return this._undoStack.length>1}get canRedo(){return!!this._redoStack.length}get hasUndoStack(){return this._undoStack.length>0}clearUndoStack(){this._undoStack.length=0}clearRedoStack(){this._redoStack.length=0}undo(){if(!this.canUndo)return[];let e=this._undoStack.pop();this._redoStack.push(e);let t=this._undoStack[this._undoStack.length-1];return this._onChangeCustomStack.fire(t,this._undoStack.length<=1),[e]}redo(){if(!this.canRedo)return[];let e=this._redoStack.pop();return this._undoStack.push(e),this._onChangeCustomStack.fire(e),[e]}push(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];t&&this.clearRedoStack(),this._undoStack.push(...e),this._onChangeCustomStack.fire(this._undoStack[this._undoStack.length-1])}reset(){if(!!this._undoStack.length||!!this._redoStack.length)this.clearRedoStack(),this.clearUndoStack(),this._onChangeCustomStack.fire(null,!0)}dispose(){this._onChangeCustomStack.dispose()}constructor(){this._serviceBrand=void 0,this._undoStack=[],this._redoStack=[],this._onChangeCustomStack=new a.Q,this.onChangeCustomStack=this._onChangeCustomStack.event}}},319708:function(e,t,r){r.d(t,{R:()=>y});var a,i=r("789786");r("784923");var n=r("498417"),o=r("948328"),s=r("825686"),l=r("905806"),c=r("801497"),d=r("782350"),u=r("230689"),h=r("966697"),p=r("426336"),_=r("356954");var g=((a={}).Click="click",a);class f{getEventParams(){return{action:this._params.action}}constructor(e){this._params=e,this.eventName="duplicate_to_button"}}var m=r("108692"),v=r("782153");class y{async _updateExpandModalInstance(e,t){let r=await this._payinPayoutService.getInstance(e);this._expandModalInstance=r,t.emit("updateExpandModalInstance",{expandModalInstance:r})}async _initPayinstance(){this._defaultWorkspaceId&&(this._expandModalInstance=await this._payinPayoutService.getInstance(this._defaultWorkspaceId),this._isSupportPay=await this._payinPayoutService.isSupportPay(this._defaultWorkspaceId))}async showModal(){var e,t;if(this._isEmptyDraft){n.Z.error(c.ZP.t("web_collaborate_cant_duplicate_tooltip",{},"Can\u2019t duplicate. No media in this project."));return}let{showLvDuplicateDraftModal:a}=await r.e("6120").then(r.bind(r,482929));!this._expandModalInstance&&await this._initPayinstance();let i=a({currentDraft:{name:this._draftName,size:this._draftSize,packageKey:this._draftId,meta:this._draftMeta},currentWorkspace:{workspace_id:this._mainDraftService.draftWorkspaceManager.workspaceId},workspaceList:this._workspaceService.workspaceList,expandModalInstance:this._expandModalInstance,isSupportExpand:this._isSupportPay,setDuplicateExpandWorkspaceId:e=>{this._updateExpandModalInstance(e,i)},openSceneType:"editor",reqDomain:this._accountService.userProfile.reqDomain,cookieConsent:l.gx,isOwner:this._videoPermissionService.isDraftOwner});e=this._containerService,t={action:g.Click},(0,_.K)(e,f,[t])}get _draftSize(){let{userGeneratedMaterials:e,autoGeneratedMaterials:t}=this._draftMaterialsService.getMaterials();return e.reduce((e,t)=>{var r;return e+(null!==(r=t.size)&&void 0!==r?r:0)},0)+t.reduce((e,t)=>{var r;return e+(null!==(r=t.size)&&void 0!==r?r:0)},0)}get _defaultWorkspaceId(){var e,t;let{userProfile:r}=this._accountService;return null!==(t=null==r?void 0:null===(e=r.defaultSpaceInfo)||void 0===e?void 0:e.workspaceId)&&void 0!==t?t:r.spaceInfo.workspaceId}get _draftName(){return this._mainDraftService.dataSdk.draftView.getDraftName()||c.ZP.t("workspace_unname_draft",{},"Untitled project")}get _draftId(){return this._mainDraftService.dataSdk.draftView.getDraftId()}get _draftMeta(){let e={...this._mainDraftService.cloudMetaManager.getMeta()};return e.createSource={...e.createSource,owner:this._accountService.userProfile.uid,createTime:Date.now()},p.HHr.stringify(e)}get _isEmptyDraft(){return!this._draftSize&&!this._mainDraftService.dataSdk.draftView.getDraftDuration()}constructor(e,t,r,a,i,n,o){this._accountService=e,this._workspaceService=t,this._mainDraftService=r,this._draftMaterialsService=a,this._payinPayoutService=i,this._containerService=n,this._videoPermissionService=o,this._expandModalInstance=null,this._isSupportPay=!1}}y=(0,i.gn)([(0,i.fM)(0,h.Gw),(0,i.fM)(1,d.W),(0,i.fM)(2,m.n),(0,i.fM)(3,o.D),(0,i.fM)(4,s.sX),(0,i.fM)(5,u.t),(0,i.fM)(6,v.u),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0===h.Gw?Object:h.Gw,void 0===d.W?Object:d.W,void 0===m.n?Object:m.n,void 0===o.D?Object:o.D,void 0===s.sX?Object:s.sX,void 0===u.t?Object:u.t,void 0===v.u?Object:v.u])],y)},692848:function(e,t,r){r.d(t,{T:function(){return h}});var a=r(789786),i=r(587892),n=r(402655),o=r(801868),s=r(230689),l=r(938240),c=r(108692),d=r(426336),u=r(425427);class h extends n.JT{initIsTextChange(){let e=this._getIsTemplate(),t=!1;e&&this._mainDraftService.dataSdk.onChangeDiff(e=>{e[d.u4I.SEGMENT].forEach(e=>{var r,a;if(!![d.C8.DELETE,d.C8.UPDATE].includes(e.type)){if(d.C8.UPDATE===e.type){let{segment:a}=e.item;(0,d.YJd)(a)&&(a.clip||(null===(r=a.material)||void 0===r?void 0:r.text))&&(t=!0)}if(d.C8.DELETE===e.type){let{segment:r}=e.item;(0,d.Ftn)(r)&&(r.clip||(null===(a=r.material)||void 0===a?void 0:a.text))&&(t=!0)}t&&this._mainDraftService.draftTemplateManager.updateDraftChangedSummary(this._mainDraftService.dataSdk.draftView.getDraftId(),{is_change_text:!0})}})})}getExportSaveModalOpening(){return this._isExportSaveModalOpening}getExportModalVisible(){return this._modalVisible}getPartialExportModalVisible(){return this._partialExportModalVisible}getGifExportModalVisible(){return this._gifExportModalVisible}getIsCaptionsExporting(){return this._isCaptionsExporting}getPartialExportInfo(){return this._partialExportInfo}setExportSaveModalOpening(e){this._isExportSaveModalOpening=e}setExportModalVisible(e){this._modalVisible=e,this._onDidExportModalVisibleChange.fire()}setPartialExportModalVisible(e){this._partialExportModalVisible=e,this._onDidPartialExportModalVisibleChange.fire()}setGifExportModalVisible(e){this._gifExportModalVisible=e,this._onDidGifExportModalVisibleChange.fire()}setIsCaptionsExporting(e){this._isCaptionsExporting=e}setPartialExportInfo(e){this._partialExportInfo=e}getExportSpace(){return this._exportSpace}setExportSpace(e){this._exportSpace=e,this._onDidExportSpaceChange.fire()}createExportTask(e){return this._exportDataService.createExportTask(e)}cancelExportTask(e){return this._exportDataService.cancelExportTask(e)}setExportReady(){this._exportReady=!0,this._onExportReady.fire()}getExportReady(){return this._exportReady}triggerVideoExport(e){this._onTriggerVideoExport.fire(e)}_getIsTemplate(){return(0,u.JY)(this._videoEnvironmentService)}async createExportTaskLifecycle(e){return await this._exportDataService.createExportTaskLifeCycle(e)}getExportResultInSdkIframe(){return this._exportResultInIframeSdk}setExportResultInSdkIframe(e){Object.assign(this._exportResultInIframeSdk,e)}constructor(e,t,r,a){super(),this._exportDataService=e,this._containerservice=t,this._mainDraftService=r,this._videoEnvironmentService=a,this._modalVisible=!1,this._partialExportModalVisible=!1,this._gifExportModalVisible=!1,this._isCaptionsExporting=!1,this._isExportSaveModalOpening=!1,this._exportReady=!1,this._exportResultInIframeSdk={packageId:"",status:"pending"},this._onDidExportSpaceChange=this._register(new i.Q),this._onDidExportModalVisibleChange=this._register(new i.Q),this._onDidGifExportModalVisibleChange=this._register(new i.Q),this._onDidPartialExportModalVisibleChange=this._register(new i.Q),this._onExportReady=this._register(new i.Q),this._onTriggerVideoExport=this._register(new i.Q),this.editTimeManager=this._containerservice.createInstance(l.n),this.onDidExportSpaceChange=this._onDidExportSpaceChange.event,this.onDidExportModalVisibleChange=this._onDidExportModalVisibleChange.event,this.onDidPartialExportModalVisibleChange=this._onDidPartialExportModalVisibleChange.event,this.onDidGifExportModalVisibleChange=this._onDidGifExportModalVisibleChange.event,this.onExportReady=this._onExportReady.event,this.onTriggerVideoExport=this._onTriggerVideoExport.event,this.initIsTextChange()}}h=(0,a.gn)([(0,a.fM)(0,o.hv),(0,a.fM)(1,s.t),(0,a.fM)(2,c.n),(0,a.fM)(3,u.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===o.hv?Object:o.hv,void 0===s.t?Object:s.t,void 0===c.n?Object:c.n,void 0===u.rO?Object:u.rO])],h)},359670:function(e,t,r){r.d(t,{k:function(){return f}});var a=r(789786),i=r(930559),n=r(12387),o=r(966697),s=r(200247),l=r(108692),c=r(136877),d=r(425427),u=r(123869),h=r(961087);let p="feelgoodExportedDraft_1",_="feelgoodLeavePageExclusion",g="feelgoodCommittedEvent";class f{async _templateLeftQuestionnaire(){await this._initAwaitLocker.awaitForInit();let e=this._getIsTemplate(),t=Promise.resolve(null);e&&(null==(t=(0,i.ak)({userInfo:this._accountService.userProfile,language:this._i18nService.currentLocale}))||t.then(e=>{var t;null==e||null===(t=e.triggerEvent(n.q.templateSatific,{questionnaire:{style:{right:0,bottom:"60px",left:"14px",popDirection:"right"},onSubmitEnd:()=>{this.addFeelgoodCommittedEvent(n.q.templateExported)},entryUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/common/images/LvIconQuestionnaire.svg"}}))||void 0===t||t.catch(()=>{})}))}async getInstance(){return await this._initAwaitLocker.awaitForInit(),!this._feelgoodInstance&&(this._feelgoodInstance=await (0,i.cX)({userInfo:this._accountService.userProfile,language:this._i18nService.currentLocale})),this._feelgoodInstance}_bindEvents(){window.addEventListener("beforeunload",()=>this._handleBeforeunload)}_getDraftMeta(){return this._mainDraftService.cloudMetaManager.getMeta()}_getIsTemplate(){return(0,d.JY)(this._videoEnvironmentService)}_getIsFromAdScript(){var e;let t=this._getDraftMeta();return(null==t?void 0:null===(e=t.draft)||void 0===e?void 0:e.transferedFrom)===c.ZZ.ad_script}clearFeelgoodExportedDraft(){localStorage.removeItem(p)}getFeelgoodExportedDraft(){try{var e;return JSON.parse(null!==(e=localStorage.getItem(p))&&void 0!==e?e:"{}")}catch{return{}}}addFeelgoodExportedDraft(e){let t=this.getFeelgoodExportedDraft();localStorage.setItem(p,JSON.stringify({...t,[e]:!0}))}clearFeelgoodLeavePageExclusion(){localStorage.removeItem(_)}getFeelgoodLeavePageExclusion(){try{var e;return JSON.parse(null!==(e=localStorage.getItem(_))&&void 0!==e?e:"{}")}catch{return{}}}addFeelgoodLeavePageExclusion(e){let t=this.getFeelgoodLeavePageExclusion();localStorage.setItem(_,JSON.stringify({...t,[e]:!0}))}getFeelgoodEventCommitted(){try{var e;return JSON.parse(null!==(e=localStorage.getItem(g))&&void 0!==e?e:"{}")}catch{return{}}}addFeelgoodCommittedEvent(e){let t=this.getFeelgoodEventCommitted();localStorage.setItem(g,JSON.stringify({...t,[e]:!0}))}isFeelgoodEventCommitted(e){let t=this.getFeelgoodEventCommitted();return e.reduce((e,r)=>e||t[r],!1)}dispose(){window.removeEventListener("beforeunload",()=>this._handleBeforeunload)}constructor(e,t,r,a){this._accountService=e,this._mainDraftService=t,this._videoEnvironmentService=r,this._i18nService=a,this._feelgoodInstance=null,this._initAwaitLocker=new h.G,this._handleBeforeunload=()=>{let e=this._getIsFromAdScript(),t=this._getIsTemplate(),r=this.getFeelgoodLeavePageExclusion();e&&!r[n.q.toolsAigcQuit]&&(0,i.dq)({triggerEventKey:n.q.toolsAigcQuit,leaveCurrPageTime:Date.now().valueOf()}),t&&!r[n.q.tempalteQuit]&&(0,i.dq)({isAutoTrigger:!0,triggerEventKey:n.q.tempalteQuit,triggerCfg:{questionnaire:{style:{left:"calc(50% - 200px)",bottom:"auto",top:"25%"},entryUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/common/images/LvIconQuestionnaire.svg"}},leaveCurrPageTime:Date.now().valueOf(),availableTime:864e5}),this.clearFeelgoodLeavePageExclusion()},this._templateLeftQuestionnaire(),this._bindEvents(),this._accountService.hasLogin&&this._initAwaitLocker.initDone(),this._accountService.onDidLogin(()=>{this._initAwaitLocker.initDone()})}}f=(0,a.gn)([(0,a.fM)(0,s.D),(0,a.fM)(1,l.n),(0,a.fM)(2,d.rO),(0,a.fM)(3,u.S),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===o.Gw?Object:o.Gw,void 0===l.n?Object:l.n,void 0===d.rO?Object:d.rO,void 0===u.S?Object:u.S])],f)},12387:function(e,t,r){r.d(t,{o:function(){return o},q:function(){return n}});var a,i=r(335290);var n=((a={}).toolsAigcCompleted="questionnaire001_tools_aigc_completed",a.toolsAigcQuit="questionnaire003_tools_aigc_quit_3",a.tempalteQuit="cut_same_template_quit",a.templateSatific="cut_same_template_editor_fix",a.templateExported="cut_same_template_exported",a);let o=(0,i.yh)("feelgood-service")},699163:function(e,t,r){r.d(t,{U:()=>c});var a=r("772322"),i=r("402655"),n=r("801497"),o=r("195291"),s=r("907028"),l=r("958444");class c extends i.JT{showModal(e){let t,r;(null==e?void 0:e.showUploadingContent)&&(t=(0,a.jsxs)("div",{className:"exit-modal-upload-file-title",children:[(0,a.jsx)(l.L_4,{className:"uploading-file-title-icon"}),(0,a.jsx)("div",{className:"uploading-file-title-content",children:n.ZP.t("web_draft_trans_title_leave",{},"Leave this page?")})]}),r=n.ZP.t("web_draft_trans_text_synced",{},"Some media aren\u2019t synced to space. If you leave this page, those media will be lost."));let i=(0,s.I)({title:t,content:r,handleOk:()=>{var t;null==e||null===(t=e.onOk)||void 0===t||t.call(e),o.unmountComponentAtNode(this._container)},handleCancel:()=>{var t;null==e||null===(t=e.onCancel)||void 0===t||t.call(e),o.unmountComponentAtNode(this._container)}}),c=o.createPortal(i,this._container);o.render(c,this._container)}dispose(){document.body.removeChild(this._container),super.dispose()}constructor(){super();let e=document.createElement("div");e.className="__exit-confirm-modal-wrapper__",document.body.append(e),this._container=e}}},174745:function(e,t,r){r.d(t,{k:function(){return p}});var a=r(789786),i=r(800788),n=r(183346),o=r(195511),s=r(223706),l=r(200247),c=r(102974),d=r(976699),u=r(545713),h=r(176022);class p extends u.b{setViewStateToLocal(e,t){if(!this._guideService.isMuted)localStorage.setItem(e,JSON.stringify(t)),t&&this._updateFeatureGuideState(e)}async _getGuideInitState(){let e=await this._newGuideUserDataService.getNewGuideUser();try{(0,i.Y2)(e.ok);let{isActiveUser:t,activeTime:r}=e.value;if(t){this._setGuidesStateToHide(n.PC);let e=await this._tagStateDataService.getTagState({tags:n.Zq.map(e=>e.key)});(0,i.Y2)(e.ok);let t=(0,c.Z)((0,d.Z)(e.value,e=>e));this._getHideAndShowGuidesConfig(n.Zq,t,r),this._findFeatureNodeAndShowRootGuide()}else this._setGuidesStateToHide(n.Zq)}catch(e){this._setGuidesStateToHide(n.Zq)}}_getHideAndShowGuidesConfig(e,t,r){let a=[],i=[],n=Number(new Date);for(let o of e){let{liveEndTime:e}=o;n-(Number(new Date(e))+86399e3)>0?i.push(o):-1!==t.findIndex(e=>e===o.key)?i.push(o):Number(new Date(o.publishTime))>Number(r)?a.push(o):i.push(o)}let o=this._getAllFeatureGuideState();this._setGuidesStateToHide(i.filter(e=>void 0===o[e.key]||o[e.key])),this._setGuidesStateToShow(a)}_setGuidesStateToHide(e){e.forEach(e=>{this.setViewStateToLocal(e.key,!0)})}_setGuidesStateToShow(e){e.forEach(e=>{this.removeViewStateFromLocal(e.key)})}_findFeatureNodeAndShowRootGuide(){try{var e;let t=JSON.parse(null!==(e=localStorage.getItem(n.gh))&&void 0!==e?e:"");t&&Object.keys(t).forEach(e=>{let r=t[e],a=n.lr[e];if(r&&a){let e=this._findNewNodePaths(r,a),t=this._getAllFeatureGuideState();e.forEach(e=>{e.forEach(e=>{t[e]=!1})}),Object.keys(t).forEach(e=>{!t[e]&&this.removeViewStateFromLocal(e)}),localStorage.setItem(n.kb,JSON.stringify(t))}})}catch(e){}localStorage.setItem(n.gh,JSON.stringify(n.lr))}_updateFeatureGuideState(e){let t=this._getAllFeatureGuideState();void 0!==t[e]&&(t[e]=!0),localStorage.setItem(n.kb,JSON.stringify(t))}_getAllFeatureGuideState(){try{var e;return JSON.parse(null!==(e=localStorage.getItem(n.kb))&&void 0!==e?e:"{}")}catch(e){return{}}}_findNewNodePaths(e,t){let r=[];return!function e(t,a,i){var n,o,s;!(null==t?void 0:null===(n=t.children)||void 0===n?void 0:n.length)&&(null==a?void 0:null===(o=a.children)||void 0===o?void 0:o.length)?r.push([...i,a.value]):null==a||null===(s=a.children)||void 0===s||s.forEach(n=>{var o;let s=null==t?void 0:null===(o=t.children)||void 0===o?void 0:o.find(e=>e.value===n.value);s?e(s,n,[...i,a.value]):r.push([...i,a.value])})}(e,t,[]),r}constructor(e,t,r,a){super(e,r),this._tagStateDataService=e,this._newGuideUserDataService=t,this._guideService=r,this._accountService=a,this._accountService.hasLogin?this._getGuideInitState():this._accountService.onDidChangeProfile(e=>{this._getGuideInitState()}),this._guideService.onStateChange(e=>{let{key:t}=e;t&&this.setViewStateToServer(t)})}}p=(0,a.gn)([(0,a.fM)(0,o.o),(0,a.fM)(1,s.f),(0,a.fM)(2,h.W),(0,a.fM)(3,l.D),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===o.o?Object:o.o,void 0===s.f?Object:s.f,void 0===h.W?Object:h.W,void 0===l.D?Object:l.D])],p)},166621:function(e,t,r){r.d(t,{w:function(){return a}});function a(e){let t=document.createElement("div");t.style.display="none",t.appendChild(e),document.body.appendChild(t)}},906136:function(e,t,r){r.d(t,{B:function(){return a}});let a=(0,r(335290).yh)("scheduler-service")},18784:function(e,t,r){r.d(t,{G:function(){return o}});var a=r(230982),i=r(375197),n=r(402655);class o extends n.JT{_schedule(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{cb:r,options:n}=e;(0,a.n)(async(e,t,a)=>{await Promise.resolve(r()),e.execute(()=>this._doNext(n.groupId,!1))},{priorityLevel:t?i.q.ImmediatePriority:n.priorityLevel})}_doNext(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._callbackQueueMap.get(e),a=this._groups.get(e);if(!r||!a)return;let i=r.shift();if(!i||a.currentConcurrency>a.concurrency){a.currentConcurrency--;return}this._schedule(i,t)}registerGroup(e){this._groups.set(e.groupId,{...e,currentConcurrency:0})}updateGroup(e,t){let r=this._groups.get(e);if(!r)return;r={...t,currentConcurrency:r.currentConcurrency},this._groups.set(e,r);let a=this._callbackQueueMap.get(e);if(a&&0!==a.length)for(;r.currentConcurrency<r.concurrency;){let e=a.shift();if(!e)break;this._schedule(e),r.currentConcurrency++}}postTask(e,t){let r=this._groups.get(t.groupId);if(!r)return;let a={cb:e,options:t};r.currentConcurrency<r.concurrency&&(this._schedule(a),r.currentConcurrency++);let i=this._callbackQueueMap.get(r.groupId);this._callbackQueueMap.set(r.groupId,[...null!=i?i:[],a])}constructor(...e){super(...e),this._callbackQueueMap=new Map,this._groups=new Map}}},65458:function(e,t,r){r.d(t,{FV:function(){return s},W:function(){return c},dM:function(){return d},wM:function(){return l}});var a,i,n,o=r(335290);var s=((a={})[a.Algorithm=0]="Algorithm",a[a.Gameplay=1]="Gameplay",a[a.Matting=2]="Matting",a[a.Reverse=3]="Reverse",a[a.SmartSplit=4]="SmartSplit",a[a.Stable=5]="Stable",a[a.Vc=6]="Vc",a[a.Pipeline=7]="Pipeline",a[a.SmartCrop=8]="SmartCrop",a[a.VocalSeparation=9]="VocalSeparation",a[a.VocalBeautify=10]="VocalBeautify",a[a.ObjectLock=11]="ObjectLock",a);var l=((i={})[i.Video=0]="Video",i[i.Image=1]="Image",i);var c=((n={})[n.Running=0]="Running",n[n.Cancelled=1]="Cancelled",n[n.Error=2]="Error",n[n.Success=3]="Success",n);let d=(0,o.yh)("smart-tools-service")},451960:function(e,t,r){r.d(t,{H:function(){return o}});var a=r(789786),i=r(230689),n=r(155183);class o{makeBuilder(){return this._containerService.createInstance(n.a)}constructor(e){this._containerService=e}}o=(0,a.gn)([(0,a.fM)(0,i.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===i.t?Object:i.t])],o)},168080:function(e,t,r){r.d(t,{x:function(){return h}});var a=r(789786),i=r(690613),n=r(745860),o=r(920704),s=r(200247),l=r(596112),c=r(65458),d=r(358789),u=r(817488);class h extends d.g{async execute(){return this._task=this._intelligentDataService.createIntelligentTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform,smartToolType:u.v.Algorithm,reqJson:"",params:JSON.stringify(this._algorithmParams),scene:2}),await this._task}transfer(e){let t=e.taskDetails[0].transcodeVideoInfos,r=e.taskDetails[0].transcodeImageInfos,a=t.length?c.wM.Video:c.wM.Image,{vid:n}=e.taskDetails[0],o="",s="";if(n){let e;t.length?e=this._getResolution(t):r.length&&(e=this._getResolution(r)),e&&(o=e.url.replace(/^http:/,"https:"),s=e.key)}let l={type:c.FV.Algorithm,assetId:this._assetId,md5:e.taskDetails[0].md5,vid:n,url:o,key:s,groupType:a,resourceId:e.resourceId,resourceName:e.resourceName,taskId:e.taskId};return(0,i.oW)(l)}_getResolution(e){return e.find(e=>/480p?/.test(e.defination))||e.find(e=>/360p?/.test(e.defination))||e.find(e=>/720p?/.test(e.defination))}constructor(e,t,r,a,i,n,o){super(),this._assetId=e,this._platform=t,this._workspaceId=r,this._algorithmParams=a,this._accountService=i,this._teaAdapterService=n,this._intelligentDataService=o}}h=(0,a.gn)([(0,a.fM)(4,s.D),(0,a.fM)(5,l.w),(0,a.fM)(6,n.p),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,String,"undefined"==typeof IAlgorithmParams?Object:IAlgorithmParams,void 0===s.D?Object:s.D,void 0===l.w?Object:l.w,void 0===n.p?Object:n.p])],h)},453059:function(e,t,r){r.d(t,{B:function(){return d}});var a=r(789786),i=r(690613),n=r(326236),o=r(200247),s=r(65458),l=r(358789),c=r(441247);class d extends l.g{async execute(){return this._task=this._pipelineDataService.createPipelineTask(this._params),await this._task}transfer(e){var t;let{pipeline_id:r,pipeline_result:a}=e,n=null!==(t=null==a?void 0:a.product_asset_type)&&void 0!==t?t:this._params.assetType,o={type:s.FV.Pipeline,assetId:this._params.assetId,groupType:c.Jg[n],pipelineId:r};return this._accountService.hasLogin&&!(a.md5||a.matting_md5)?(0,i.wf)(-1,"pipeline should have md5 or matting_md5"):this._accountService.hasLogin||a.vid||a.matting_vid?(this._accountService.hasLogin?o.cloudData={md5:a.md5,path:a.path,mattingMd5:a.matting_md5,mattingPath:a.matting_path,edgeProductMd5:a.edge_product_md5,edgeProductPath:a.edge_product_path}:o.onlineData={key:a.key,url:a.url,vid:a.vid,path:a.path,mattingKey:a.matting_key,mattingUrl:a.matting_url,mattingVid:a.matting_vid,mattingPath:a.matting_path,edgeProductKey:a.edge_product_key,edgeProductUrl:a.edge_product_url,edgeProductVid:a.edge_product_vid,edgeProductPath:a.edge_product_path},(0,i.oW)(o)):(0,i.wf)(-1,"pipeline should have vid or matting_vid")}constructor(e,t,r){super(),this._params=e,this._pipelineDataService=t,this._accountService=r}}d=(0,a.gn)([(0,a.fM)(1,n.Z),(0,a.fM)(2,o.D),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ICreatePipelineTaskParams?Object:ICreatePipelineTaskParams,void 0===n.Z?Object:n.Z,void 0===o.D?Object:o.D])],d)},727040:function(e,t,r){r.d(t,{g:function(){return u}});var a=r(789786),i=r(690613),n=r(807664),o=r(920704),s=r(200247),l=r(596112),c=r(65458),d=r(358789);class u extends d.g{async execute(){return this._task=this._reverseDataService.createReverseTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform}),await this._task}transfer(e){let t={type:c.FV.Reverse,assetId:this._assetId};if(e.vid&&e.url)t.onlineData={vid:e.vid,url:e.url,key:e.key};else{if(!e.md5)return(0,i.wf)(-1,"reverse response invalid.");t.cloudData={md5:e.md5}}return(0,i.oW)(t)}constructor(e,t,r,a,i,n){super(),this._assetId=e,this._platform=t,this._workspaceId=r,this._accountService=a,this._teaAdapterService=i,this._reverseDataService=n}}u=(0,a.gn)([(0,a.fM)(3,s.D),(0,a.fM)(4,l.w),(0,a.fM)(5,n.N),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,String,void 0===s.D?Object:s.D,void 0===l.w?Object:l.w,void 0===n.N?Object:n.N])],u)},496530:function(e,t,r){r.d(t,{G:function(){return u}});var a=r(789786),i=r(690613),n=r(5026),o=r(920704),s=r(200247),l=r(596112),c=r(65458),d=r(358789);class u extends d.g{async execute(){return this._task=this._mattingDataService.createVideoMattingTask({assetId:this._assetId,workspaceId:this._workspaceId,tmpId:this._accountService.hasLogin?"":await this._teaAdapterService.getWebId(),platform:this._platform}),await this._task}transfer(e){let t={type:c.FV.Matting,assetId:this._assetId};if(e.vid&&e.url)t.onlineData={vid:e.vid,url:e.url,key:e.key,edgeProductVid:e.edgeProductVid,edgeProductUrl:e.edgeProductUrl,edgeProductKey:e.edgeProductKey};else{if(!e.md5)return(0,i.wf)(-1,"reverse response invalid.");t.cloudData={md5:e.md5,edgeProductMd5:e.edgeProductMd5}}return(0,i.oW)(t)}constructor(e,t,r,a,i,n){super(),this._assetId=e,this._platform=t,this._workspaceId=r,this._accountService=a,this._teaAdapterService=i,this._mattingDataService=n}}u=(0,a.gn)([(0,a.fM)(3,s.D),(0,a.fM)(4,l.w),(0,a.fM)(5,n.s),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,String,void 0===s.D?Object:s.D,void 0===l.w?Object:l.w,void 0===n.s?Object:n.s])],u)},33818:function(e,t,r){r.d(t,{a:function(){return l}});var a=r(789786),i=r(690613),n=r(520313),o=r(920704),s=r(65458);class l{async execute(){let e=this._vocalBeautifyDataService.createVocalBeautifyTask({assetId:this._assetId,platform:this._platform,step:this._step,timeRange:this._timeRange,workspaceId:this._workspaceId},this._urlParams);return await e}cancel(){}transfer(e){let t={type:s.FV.VocalBeautify,assetId:this._assetId,taskId:e.taskId},[r]=e.taskDetails,{transcodeAudioInfos:a}=r,[n]=a;if(r.md5)t.cloudData={md5:r.md5,key:n.key};else{if(!r.vid||!n.url)return(0,i.wf)(-1,"vocal beautify response invalid.");t.onlineData={vid:r.vid,url:n.url,key:n.key}}return(0,i.oW)(t)}constructor(e,t,r,a,i,n,o){this._assetId=e,this._platform=t,this._step=r,this._timeRange=a,this._workspaceId=i,this._urlParams=n,this._vocalBeautifyDataService=o}}l=(0,a.gn)([(0,a.fM)(6,n.TW),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[String,void 0===o.hn?Object:o.hn,void 0===n.Rk?Object:n.Rk,Object,String,Object,void 0===n.TW?Object:n.TW])],l)},202159:function(e,t,r){r.d(t,{v:function(){return a}});let a=(0,r(335290).yh)("sync-file-open-time-service")},947915:function(e,t,r){r.d(t,{iP:function(){return g}});var a=r(789786),i=r(587892),n=r(246457);let o="style_sync_to_all_subtitle",s="style_sync_to_all_lyric",l="style_sync_to_all_normal_text",c="style_sync_to_all_subtitle_tts",d="style_sync_to_all_lyric_tts",u="style_sync_to_all_normal_text_tts",h="style_sync_to_all_subtitle_motion",p="style_sync_to_all_lyric_motion",_="style_sync_to_all_normal_text_motion";class g{shouldSyncToAllLyric(){return this._lyric}setSyncToAllLyric(e){this._lyric=e,this._updateLocalStorageData(s,e)}shouldSyncToAllSubtitle(){return this._subtitle}setSyncToAllSubtitle(e){this._subtitle=e,this._updateLocalStorageData(o,e)}shouldSyncToAllText(){return this._normalText}setSyncToAllText(e){this._normalText=e,this._updateLocalStorageData(l,e)}shouldSyncToAllLyricTts(){return this._lyricTts}setSyncToAllLyricTts(e){this._lyricTts=e,this._updateLocalStorageData(d,e)}shouldSyncToAllSubtitleTts(){return this._subtitleTts}setSyncToAllSubtitleTts(e){this._subtitleTts=e,this._updateLocalStorageData(c,e)}shouldSyncToAllTextTts(){return this._normalTextTts}setSyncToAllTextTts(e){this._normalTextTts=e,this._updateLocalStorageData(u,e)}shouldSyncToAllLyricMotion(){return this._lyricMotion}setSyncToAllLyricMotion(e){this._lyricMotion=e,this._updateLocalStorageData(p,e)}shouldSyncToAllSubtitleMotion(){return this._subtitleMotion}setSyncToAllSubtitleMotion(e){this._subtitleMotion=e,this._updateLocalStorageData(h,e)}shouldSyncToAllTextMotion(){return this._normalTextMotion}setSyncToAllTextMotion(e){this._normalTextMotion=e,this._updateLocalStorageData(_,e)}_updateLocalStorageData(e,t){this._storageService.keyValue.set(e,String(t)),this._onDidChange.fire(e,t)}_initDataByLocalStorage(){let[e,t]=this._storageService.keyValue.query(s).pair();!e&&(this._lyric=void 0===t?this._lyric:"true"===t);let[r,a]=this._storageService.keyValue.query(o).pair();!r&&(this._subtitle=void 0===a?this._lyric:"true"===a);let[i,n]=this._storageService.keyValue.query(l).pair();!i&&(this._normalText="true"===n);let[g,f]=this._storageService.keyValue.query(d).pair();!g&&(this._lyricTts="true"===f);let[m,v]=this._storageService.keyValue.query(c).pair();!m&&(this._subtitleTts="true"===v);let[y,S]=this._storageService.keyValue.query(u).pair();!y&&(this._normalTextTts="true"===S);let[M,T]=this._storageService.keyValue.query(p).pair();!M&&(this._lyricMotion="true"===T);let[b,k]=this._storageService.keyValue.query(h).pair();!b&&(this._subtitleMotion="true"===k);let[w,I]=this._storageService.keyValue.query(_).pair();!w&&(this._normalTextMotion="true"===I)}constructor(e){this._storageService=e,this._lyric=!0,this._subtitle=!0,this._normalText=!1,this._lyricTts=!1,this._subtitleTts=!1,this._normalTextTts=!1,this._lyricMotion=!1,this._subtitleMotion=!1,this._normalTextMotion=!1,this._onDidChange=new i.Q,this._initDataByLocalStorage(),this.onDidChange=this._onDidChange.event}}g=(0,a.gn)([(0,a.fM)(0,n.d),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.d?Object:n.d])],g)},632642:function(e,t,r){r.d(t,{ZP:function(){return s}});var a=r(789786),i=r(578209),n=r(654042),o=r(515918);class s{createImg(e){return this._aiToolDataService.createAiTask({assetId:(0,o.PK)(e.asset_id),workspaceId:e.workspace_id,aiToolType:6,platform:e.platform,params:e.params,syncCall:!0,useBase64:!0,scene:i.dZ.GraphEditor})}imagesHighlightAnalyse(e){return this._aiToolDataService.imageHighlightAnalyse({workspaceId:e.workspace_id,imageBase64List:e.image_base64_list.map(e=>(0,o.PK)(e)),topK:e.top_k})}constructor(e){this._aiToolDataService=e}}s=(0,a.gn)([(0,a.fM)(0,n.H),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===n.H?Object:n.H])],s)},34562:function(e,t,r){r.d(t,{Z:function(){return g}});var a=r(772322);r(916058);var i=r(566782),n=r(218571),o=r(195291),s=r(105789),l=r.n(s),c=r(881308),d=r(670933),u=r(150564),h=r(801497),p=r(383661);let _=n.forwardRef((e,t)=>{var r;let{store:s,managers:d}=e,{showEditorGraphic:_,isOpeningGraphic:g,graphicEditorIframe:f}=s,[m,v]=(0,n.useState)(0),{graphicEditorManager:y}=d,[,S]=(0,n.useReducer)(e=>e+1,1);(0,n.useImperativeHandle)(t,()=>({forceRender:S})),(0,n.useEffect)(()=>{if(_){v(0);let e=(0,p.K)(3e3,{onprogress:e=>{v(e)},max:.9});return()=>{null==e||e()}}v(0)},[_]);let[M,T]=(0,n.useState)(!(null!==(r=null==y?void 0:y.isReady)&&void 0!==r&&r)||g);(0,n.useEffect)(()=>{if(_&&y){var e;T(!(null!==(e=null==y?void 0:y.isReady)&&void 0!==e&&e)||g),!(null==y?void 0:y.isReady)&&(null==y||y.ready().then(()=>{T(!1)}))}else T(!0)},[_,y,g]);let b=window.document.body,k=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(f){var e;null===(e=k.current)||void 0===e||e.appendChild(f)}return()=>{f&&f.remove()}},[f]),(0,n.useEffect)(()=>{function e(e){e.preventDefault(),e.returnValue=""}return _&&window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[_]),(0,o.createPortal)((0,a.jsxs)("div",{className:l()(c.Z.coverGraphicEditorMask,{[c.Z.active]:_}),children:[M&&_?(0,a.jsx)("div",{className:c.Z.loadingMask,children:(0,a.jsxs)("div",{className:c.Z.loadingTips,children:[(0,a.jsx)(u.d3f,{width:80,height:80}),(0,a.jsxs)("div",{children:[(0,a.jsx)(i.Z,{animation:!0,showText:!1,percent:100*m,width:"100%"}),(0,a.jsx)("span",{className:c.Z.tips,children:h.ZP.t("web_graphic_cover_loading_editing_cover",{},"Opening image editor...")})]})]})}):null,(0,a.jsx)("div",{ref:k,className:l()(c.Z.coverGraphicEditorContainer,{[c.Z.active]:_&&!M})})]}),b)}),g=(0,d.f3)("store","managers")((0,d.Pi)(_))},262418:function(e,t,r){r.d(t,{PB:function(){return l},fh:function(){return o},sV:function(){return s}});var a,i,n,o=((a={}).ExportWindow="export_window",a.TrackBar="track_bar",a);var s=((i={}).AddCover="add_cover",i.EditCover="edit_cover",i.DownloadCover="download_cover",i.DeleteCover="delete_cover",i.ConfirmDeleteCover="confirm_delete_cover",i.CancelDeleteCover="cancel_delete_cover",i);var l=((n={}).Draft="draft",n.Exported="exported",n.Material="material",n)},860933:function(e,t,r){r.d(t,{G:()=>x});var a=r("789786"),i=r("108692"),n=r("896413"),o=r("425427"),s=r("604325"),l=r("204034"),c=r("882610");r("784923");var d=r("498417"),u=r("827322"),h=r("801497"),p=r("800342"),_=r("230689"),g=r("852247");class f{get isReady(){return this._isReady}get element(){return this._iframe}async ready(){await this._initialPromise}async insertCoverByInit(e){await this._initialPromise,this._bridge.action({event:"INSERT_COVER_TO_CANVAS",data:e})}dispose(){this._bridge.dispose()}_handlerGetDraftResource(){this._bridge.on("GET_DRAFT_RESOURCE",async e=>{try{let t=await this.props.prefetchDraftResource;this._bridge.action({event:"GET_DRAFT_RESOURCE",data:{code:p.Q.Success,msg:"success",data:t.value}},{actionId:e.actionId})}catch(t){this._bridge.action({event:"GET_DRAFT_RESOURCE",data:{code:-1,msg:`unexpected error:${null==t?void 0:t.message}`}},{actionId:e.actionId})}})}_prefetchMaterialAsset(e){let t=this._prefetchMaterialMap.get(e);if(t)return t;if(!this.props.prefetchMaterialAsset)throw Error("not found prefetchMaterialAsset props");let r=this.props.prefetchMaterialAsset({md5:e});return this._prefetchMaterialMap.set(e,r),r}_handlerGetMaterialAsset(){this._bridge.on("GET_MATERIAL_ASSET",async e=>{try{let t=await this._prefetchMaterialAsset(e.data.md5);this._bridge.action({event:"GET_MATERIAL_ASSET",data:{code:p.Q.Success,msg:"success",data:t}},{actionId:e.actionId})}catch(t){this._bridge.action({event:"GET_MATERIAL_ASSET",data:{code:-1,msg:`unexpected error:${null==t?void 0:t.message}`}},{actionId:e.actionId})}})}_handlerGetDraftAction(){this._bridge.on("GET_VIDEO_COVER_DRAFT",async e=>{try{let t=await this._coverPersistenceManager.getDraftJsonString();this._bridge.action({event:"GET_VIDEO_COVER_DRAFT",data:{code:p.Q.Success,msg:"success",data:{draft:t}}},{actionId:e.actionId})}catch(t){this._bridge.action({event:"GET_VIDEO_COVER_DRAFT",data:{code:-1,msg:`unexpected error:${null==t?void 0:t.message}`}},{actionId:e.actionId})}})}_handlerSaveAction(){this._bridge.on("SAVE_COVER",async e=>{try{this._coverPersistenceManager.updateGraphicPackageAssets(e.data.packageAssets),await this._coverPersistenceManager.setGraphicDraftCover(e.data.draft,e.data.cover),this._bridge.action({event:"SAVE_COVER",data:{code:p.Q.Success,msg:"success"}},{actionId:e.actionId}),(0,g.V)(this._containerService,{time:Date.now()-e.data.startedAt}),this.props.onClose()}catch(t){d.Z.error(h.ZP.t("web_network_error",{},"An error occurred. Try again later.")),this._bridge.action({event:"SAVE_COVER",data:{code:-1,msg:`unexpected error:${null==t?void 0:t.message}`}},{actionId:e.actionId})}})}_handlerSelectVideoFrame(){this._bridge.on("SELECT_VIDEO_FRAME",async e=>{let t=e=>{var t;return{event:"SELECT_VIDEO_FRAME",data:{code:-1,msg:`unexpected error:${null!==(t=null==e?void 0:e.message)&&void 0!==t?t:e}`}}};try{let r=await this.props.selectFrameFromVideo();if(r){let t;this._bridge.action((t=r,{event:"SELECT_VIDEO_FRAME",data:{code:p.Q.Success,msg:"success",data:{md5:t}}}),{actionId:e.actionId})}else this._bridge.action(t("not found md5"),{actionId:e.actionId})}catch(r){d.Z.error(h.ZP.t("web_network_error",{},"An error occurred. Try again later.")),this._bridge.action(t(r),{actionId:e.actionId})}})}constructor(e,t,r,a,i,n){var s;this._coverPersistenceManager=e,this._coverStore=t,this.props=r,this._mainDraftService=a,this._videoEnvironmentService=i,this._containerService=n,this._isReady=!1,this._prefetchMaterialMap=new Map,this._initialPromise=new Promise((e,t)=>{this._initialResolve=e,this._initialReject=t});let l=window.document.createElement("iframe");l.setAttribute("style","height: 100%;width: 100%;border: none;"),this._coverStore.setGraphicEditorIframe(l),this._iframe=l;let c="",d={enter_from:"cover_edit",from_page:this._videoEnvironmentService.appSubType===o.cP.Template?"template_editor":"editor",original_edittype:this._videoEnvironmentService.appSubType===o.cP.Template?"template":"edit",workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,videoDraftId:this._mainDraftService.dataSdk.draftView.getDraftId(),coverId:r.coverId,width:r.width,height:r.height,unit:null!==(s=null==r?void 0:r.unit)&&void 0!==s?s:"px"};for(let e in d)d[e]&&(c+=`&${e}=${d[e]}`);l.src=(0,u.C)(`/editor-graphic${r.draftId?`/${r.draftId}`:""}/?editorType=web${c}`,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),this._bridge=new p.A({iframe:l}),this._bridge.on("READY",()=>{var e;this._isReady=!0,null===(e=r.onReady)||void 0===e||e.call(r),this._initialResolve()}),this._bridge.on("CANCEL_GRAPHIC",()=>{this.props.onClose()}),r.coverId&&this._prefetchMaterialAsset(r.coverId),this._handlerGetMaterialAsset(),this._handlerGetDraftResource(),this._handlerGetDraftAction(),this._handlerSaveAction(),this._handlerSelectVideoFrame()}}f=(0,a.gn)([(0,a.fM)(3,i.n),(0,a.fM)(4,o.rO),(0,a.fM)(5,_.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof CoverPersistenceManager?Object:CoverPersistenceManager,"undefined"==typeof CoverStore?Object:CoverStore,"undefined"==typeof IGraphicEditor?Object:IGraphicEditor,void 0===i.n?Object:i.n,void 0===o.rO?Object:o.rO,void 0===_.t?Object:_.t])],f);var m=r("575755"),v=r("966697"),y=r("200247"),S=r("596112"),M=r("127830"),T=r("867904"),b=r("632642"),k=r("587892"),w=r("402655"),I=r("800788"),E=r("658321"),P=r("565508"),D=r("197517"),A=r("273238"),C=r("763446"),R=r("426336");class x extends w.JT{get onCoverChange(){return this._onCoverChange.event}get onCoverLoaded(){return this._onCoverLoaded.event}get coverLoaded(){return this._coverLoaded}get cover(){return this._cover}async _triggerPersistenceCoverChange(){let e=await this._coverPersistenceManager.getCoverAsset();if(e){let t={url:e.data,width:e.width,height:e.height,path:e.path};this._cover=t,this._onCoverChange.fire(t)}else this._cover=null,this._onCoverChange.fire(null)}_updateControllerManagers(){this._videoCoverEditorController.setCoverManagers({coverSelectorManager:this._coverSelectorManager,graphicEditorManager:this._graphicEditorManager})}async goToEditCover(e){this._mainEditorWidgetService.playerManager.pause();let t=await this._coverPersistenceManager.getDraftJsonAsset(),r=await this._coverPersistenceManager.getCoverAsset();this._coverStore.setCoverPosition(e),t?await this._openGraphicEditor():(r?this._coverStore.setCover({url:r.data,width:r.width,height:r.height,path:r.path}):this._coverStore.setCover(void 0),this._coverSelectorManager.openModal({selectType:this._coverStore.cover?l.UQ.staticCover:l.UQ.video}))}async getDraftJsonAsset(){return await this._coverPersistenceManager.getDraftJsonAsset()}async getGraphicCoverExportReportParams(){let e=await this.getDraftJsonAsset();if(null==e?void 0:e.jsonString){let{reportParams:t}=R.HHr.parse(e.jsonString)||{};return{cover_info:JSON.stringify({original_edittype:this._environmentService.appSubType===o.cP.Template?"template":"edit",edittype:"picture_edit",picture_id:null==t?void 0:t.picture_id,current_page:this._environmentService.appSubType===o.cP.Template?"template_editor":"editor"})}}}async reporterGraphicExportTime(){let[e,t]=await Promise.all([this.getDraftJsonAsset(),this._coverPersistenceManager.getCoverAsset()]);if(null==e?void 0:e.jsonString){let{packageId:t,reportParams:r}=R.HHr.parse(e.jsonString);(0,C.R)(this._containerService,{...r,edittype:"picture_edit",original_edittype:this._environmentService.appSubType===o.cP.Template?"template":"edit",current_page:this._environmentService.appSubType===o.cP.Template?"template_editor":"editor",draft_id:t,is_cover_added:this._coverStore.addCoverForOpeningWhenExport?2:1})}}closeCoverSelectorModal(){this._coverStore.setVisible(!1)}clearCover(){this._coverPersistenceManager.clearCover(),this._coverStore.setCover(void 0)}init(){this._accountService.onDidLogin(()=>{this._coverStore.setIsLogin(!0)}),this._accountService.onDidLogout(()=>{this._coverStore.setIsLogin(!1)}),this._triggerPersistenceCoverChange(),this._coverPersistenceManager.onCoverChange(()=>{this._triggerPersistenceCoverChange()})}dispose(){super.dispose()}constructor(e,t,r,a,i,n,o,d){super(),this._mainDraftService=e,this._containerService=t,this._accountService=r,this._draftCoverDataService=a,this._teaAdapterService=i,this._mainEditorWidgetService=n,this._userMaterialsService=o,this._environmentService=d,this._coverLoaded=!1,this._graphicEditorManager=null,this._cover=null,this._onCoverChange=new k.Q,this._onCoverLoaded=new k.Q,this._openGraphicEditor=async e=>{let t,r,a;let{workspaceId:i}=this._mainDraftService.draftWorkspaceManager;if(!i)return;if(!this._accountService.hasLogin){this._accountService.login({reportParams:{pageEnterFrom:v.d.Cover}}),this._coverStore.toggleIsOpeningGraphic(!1);return}let n=this._coverStore;n.switchEditorGraphic(!0);let{width:o=0,height:s=1}=this._mainDraftService.dataSdk.draftView.getCanvasConfig(),{selectType:c,uploadMaterial:d,cover:u}=n,h=performance.now(),p=null;if(e){var _,g,m,y,S,T,b,k,w,A,C,R,x,O,F,N,V,L,j,U,B;switch(c){case l.UQ.upload:{null==d||d.resourceKey;let e=null==d?void 0:null===(_=d.materialLifecycle)||void 0===_?void 0:_.getModel();(0,I.Y2)(e),p={width:e.width,height:e.height,coverKey:null!==(y=null===(g=e.cover)||void 0===g?void 0:g.key)&&void 0!==y?y:"",url:null!==(S=null===(m=e.cover)||void 0===m?void 0:m.url)&&void 0!==S?S:"",md5:e.md5,transcodeInfo:(0,E.R)(null!==(T=e.imgTranscodeInfo)&&void 0!==T?T:{})};break}case l.UQ.highlight:{let e=(await this._coverSelectorManager.highlightSuperToMd5()).materialLifecycle.getModel();p={width:e.width,height:e.height,coverKey:null!==(w=null===(b=e.cover)||void 0===b?void 0:b.key)&&void 0!==w?w:"",url:null!==(A=null===(k=e.cover)||void 0===k?void 0:k.url)&&void 0!==A?A:"",md5:e.md5,transcodeInfo:(0,E.R)(null!==(C=e.imgTranscodeInfo)&&void 0!==C?C:{})};break}case l.UQ.video:{let e=await this._coverSelectorManager.videoSuperToMd5(),t=e.materialLifecycle.getModel();(0,P.do)({type:M._g.UserPhoto,...e.materialLifecycle.getModel()}),p={width:t.width,height:t.height,coverKey:null!==(O=null===(R=t.cover)||void 0===R?void 0:R.key)&&void 0!==O?O:"",url:null!==(F=null===(x=t.cover)||void 0===x?void 0:x.url)&&void 0!==F?F:"",md5:t.md5,transcodeInfo:(0,E.R)(null!==(N=t.imgTranscodeInfo)&&void 0!==N?N:{})};break}case l.UQ.staticCover:{let e=this._coverPersistenceManager.getCoverMaterial();(0,I.Y2)(e),p={width:e.width,height:e.height,coverKey:null!==(j=null===(V=e.cover)||void 0===V?void 0:V.key)&&void 0!==j?j:"",url:null!==(U=null===(L=e.cover)||void 0===L?void 0:L.url)&&void 0!==U?U:"",md5:e.md5,transcodeInfo:(0,E.d)(null!==(B=e.imgTranscodeInfo)&&void 0!==B?B:{})};break}default:(0,I.bP)(c)}}else try{let e=JSON.parse(await this._coverPersistenceManager.getDraftJsonString());r=e.packageId,a={workspaceId:i,referencedAssets:e.draftUsedEverAsserts.map(t=>({md5:t.md5,sourcePath:t.source_path,materials:e.materials})),materials:e.materials}}catch(e){}this._graphicEditorManager?(p&&this._graphicEditorManager.insertCoverByInit({background:[l.UQ.upload,l.UQ.staticCover].includes(n.selectType)?"#000000":void 0,material:p}),(0,D.p)(this._containerService,{time:performance.now()-h,status:"success"})):(this._graphicEditorManager=this._containerService.createInstance(f,this._coverPersistenceManager,this._coverStore,{draftId:r,width:o,height:s,unit:"px",prefetchDraftResource:a?await this._draftCoverDataService.getDraftCover(a):Promise.reject(Error("not found result")),trackerReport(e,t){throw Error("Function not implemented.")},onUpdatePackageAssets(e){throw Error("Function not implemented.")},prefetchMaterialAsset:e=>{throw Error("Function not implemented")},selectFrameFromVideo:()=>new Promise(e=>{this._coverSelectorManager.openModal({modalType:l.w8.SelectFrame,onSelectFrame:t=>{e(t)},onCancelSelect:()=>{e()}})}),onClose:()=>{this._coverStore.switchEditorGraphic(!1),this._graphicEditorManager=null,this._updateControllerManagers()},onReady:()=>{(0,D.p)(this._containerService,{time:performance.now()-h,status:"success"})}}),this._updateControllerManagers(),p&&this._graphicEditorManager.insertCoverByInit({background:[l.UQ.upload,l.UQ.staticCover].includes(n.selectType)?"#000000":void 0,material:p})),this._coverSelectorManager.closeModal(),n.toggleIsOpeningGraphic(!1)},this._coverStore=new l.ZP,this._coverApi=this._containerService.createInstance(b.ZP),this._coverPersistenceManager=this._containerService.createInstance(T.M),this._coverSelectorManager=this._containerService.createInstance(c.p,this._coverStore,this._coverPersistenceManager,this._coverApi),this._videoCoverEditorController=this._containerService.createInstance(s.f,this._coverStore,{coverSelectorManager:this._coverSelectorManager,graphicEditorManager:this._graphicEditorManager},{openGraphicEditor:this._openGraphicEditor}),this._register(this._coverPersistenceManager.onRecovered(()=>{this._coverLoaded=!0,this._onCoverLoaded.fire()})),this.init()}}x=(0,a.gn)([(0,a.fM)(0,i.n),(0,a.fM)(1,_.t),(0,a.fM)(2,y.D),(0,a.fM)(3,m.C),(0,a.fM)(4,S.w),(0,a.fM)(5,n.a),(0,a.fM)(6,A.b),(0,a.fM)(7,o.rO),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===i.n?Object:i.n,void 0===_.t?Object:_.t,void 0===y.D?Object:y.D,void 0===m.C?Object:m.C,void 0===S.w?Object:S.w,void 0===n.a?Object:n.a,void 0===A.b?Object:A.b,void 0===o.rO?Object:o.rO])],x)},876026:function(e,t,r){r.d(t,{c:function(){return d}});var a=r(789786),i=r(108692),n=r(234487),o=r(948328),s=r(230689),l=r(426336),c=r(196769);class d{uploadWhileUnmount(){this.isUploadDirty&&this._uploadAlgorithmFile()}uploadWhileUnmountAndCustomize(e){this.isUploadDirty&&this._uploadAlgorithmFileCustomize(e)}addUploadQueue(e,t){t&&!this._draftMaterialNamespaceCustom[e]&&(this._draftMaterialNamespaceCustom[e]=this._draftMaterialsService.getOrCreateAutoGeneratedMaterialNamespace(e)),this.uploadQueue.add(e)}setUploadDirty(e){this.isUploadDirty=e}updateRenderManager(e){this._renderManager=e}async _uploadAlgorithmFileCustomize(e){let t=this.uploadQueue.values();if(!!this.uploadQueue.size&&"doing"!==this.updateStatus){for(let r of(this.updateStatus="doing",t))await this._linkAssetByLocalPathCustomize(r,e),this.uploadQueue.delete(r);this.updateStatus="idle",this.setUploadDirty(!1)}}async _linkAssetByLocalPathCustomize(e,t){let r;let a=l.P4R.ensureRootPath(e);try{r=this._renderManager.fs.readFileSync(a)}catch(e){return{status:"fail"}}if(!r)return{status:"fail"};let i=new File([r],e,{type:"application/json"});try{let[r]=await (0,n.u)({files:[i],fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,payinPayoutHelper:this._payinPayoutHelper,containerService:this._containerService});if(r.ok)return null==t||t(r.value,e),this._draftMaterialNamespaceCustom[e].replaceAllMaterials([r.value]),{status:"success"};return{status:"fail"}}catch(e){return{status:"fail"}}}async _uploadAlgorithmFile(){if(!this.isUploadDirty)return;let e=this.uploadQueue.values();if(!!this.uploadQueue.size&&"doing"!==this.updateStatus){for(let t of(this.updateStatus="doing",e))await this._linkAssetByLocalPath(t),this.uploadQueue.delete(t);this.updateStatus="idle",this.setUploadDirty(!1)}}async _linkAssetByLocalPath(e){let t;let r=l.hPV.toAbsolutePath(e);try{t=this._renderManager.fs.readFileSync(r)}catch(e){return{status:"fail"}}if(!t)return{status:"fail"};let a=new File([t],e,{type:"application/json"});try{let[t]=await (0,n.u)({files:[a],fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,payinPayoutHelper:this._payinPayoutHelper,containerService:this._containerService});if(t.ok){var i,o;let[r]=this._draftMaterialNamespace.getMaterials().filter(t=>t.filename===e||t.sourcePath===e);r?this._draftMaterialNamespace.replaceMaterial(r.id,t.value):this._draftMaterialNamespace.addMaterials([t.value]);let a=t.value.getModel(),n=null!==(o=null===(i=a.filename)||void 0===i?void 0:i.replace(/^\/__opfs_system_root\//,""))&&void 0!==o?o:"";return this._mainDraftService.draftPathStore.recordDraftPathToResourceKey(n,t.value.getModel().key),this._mainDraftService.draftPathStore.recordResourceKeyToDraftPath(t.value.getModel().key,n),{status:"success"}}return{status:"fail"}}catch(e){return{status:"fail"}}}constructor(e,t,r){this._mainDraftService=e,this._draftMaterialsService=t,this._containerService=r,this.uploadQueue=new Set,this.isUploadDirty=!1,this.updateStatus="idle",this._draftMaterialNamespaceCustom={},this._payinPayoutHelper=this._containerService.createInstance(c.o),this._draftMaterialNamespace=this._draftMaterialsService.getOrCreateAutoGeneratedMaterialNamespace("Algorithm")}}d=(0,a.gn)([(0,a.fM)(0,i.n),(0,a.fM)(1,o.D),(0,a.fM)(2,s.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===i.n?Object:i.n,void 0===o.D?Object:o.D,void 0===s.t?Object:s.t])],d)},309428:function(e,t,r){r.d(t,{x:function(){return _}}),r(966156);var a=r(368100),i=r(896413),n=r(65458),o=r(937802),s=r(199644),l=r(218571),c=r(129219),d=r(230689),u=r(126729),h=r(597623),p=r(801497);function _(e){var t,r,_;let{segment:g,toolType:f}=e,m=(0,o.G)(i.a),v=(0,o.G)(h.lT),y=(0,o.G)(d.t),{smartToolsManager:S}=m,{pipelineManager:M,smartCropManager:T,smartToolsTaskPipelineManager:b}=S,k=(0,l.useRef)(M.getTokenBySegmentId(g.id)),w=(null===(t=T.getSmartCropToken(g.id))||void 0===t?void 0:t.status)===c.xR.Running&&[u.F2.VideoReverseTask,u.F2.VideoSlowMotion,u.F2.VideoStabilization,u.F2.VideoNoiseReduction,u.F2.Deflicker].includes(f),I=w?p.ZP.t("web_edit_text_smart_ratio_failure",{},"Auto reframe is being applied. Try again later."):void 0,E=!!g.smartCrop,{loading:P,loadingText:D}=b.getLoadingState(g.id),A=b.getApplyingSourceType(g.id),C=!!(A&&A!==n.FV.Pipeline),{progress:R}=M.getLoadingState(g.id),x=M.getUserActionDelta(g.id),O=null==x?void 0:x.find(e=>e.toolType===f),F=!!(O?O.enable:null===(r=M.getIntelligentState(g,f))||void 0===r?void 0:r.enable),N=(null==x?void 0:null===(_=x.slice(-1)[0])||void 0===_?void 0:_.toolType)===f,V=!!(null==x?void 0:x.some(e=>e.enable)),L=!!(null==x?void 0:x.some(e=>!e.enable));return{delta:O,checked:F,loading:P,loadingText:D||I,progress:R,disabled:P&&V&&!N||P&&L&&!F||w||C,switchIntelligent:(0,l.useCallback)(e=>{if(E&&[u.F2.VideoStabilization,u.F2.VideoReverseTask,u.F2.VideoSlowMotion].includes(e.toolType)){let t={current_tool:"smart_crop",target_tool:u.FL[e.toolType]};(0,s.l)(y,{action:"show",...t}),a.Z.confirm({title:p.ZP.t("web_edit_text_apply_confirm",{string0:M.getToastWhenDisabling(e.toolType),string1:p.ZP.t("web_edit_title_smart_crop",{},"Auto reframe")},"Apply {string0}? Doing so will remove {string1}."),okText:p.ZP.t("web_edit_button_confirm_apply",{},"Apply"),cancelText:p.ZP.t("web_edit_button_cancel",{},"Cancel"),onOk:()=>{(0,s.l)(y,{action:"confirm",...t}),T.removeSmartCrop(g.id);let r=S.handleSwitchIntelligentByPipeline({segment:g,params:e});k.current=r},onCancel:()=>{(0,s.l)(y,{action:"cancel",...t})},maskClosable:!1});return}k.current&&k.current.cancel();let{isEqual:t,isEmpty:r,nextParams:i}=M.checkApplyDelta(g,e);if(t){M.handleEqualUserAction(g);return}if(r){S.handleEmptyUserAction(g,f,i);return}i.filter(e=>e.toolType!==u.F2.VideoCut).length>=2&&M.setGlobalLoadingMessageContent(g,p.ZP.t("web_noise_toast_multiple_re_reduce",{},"Previously applied features need to be reapplied")),M.setLoadingState(g.id,{loading:!0,loadingText:void 0,progress:0}),M.recordUserActionDelta(g.id,e),M.getUserActionDelta(g.id).every(e=>!e.enable)&&v.info(p.ZP.t("web_color_correction_toast_restart_others",{string0:M.getToastWhenDisabling(e.toolType)},"{string0} was removed. Other features that were applied will be applied again, and it will take some time.")),S.switchIntelligentByPipeline(g,f,i),k.current=b.getApplyingToken(g.id),M.addTokenBySegmentId(g.id,k.current)},[E,M,g,S,f,y,T,v])}}},783432:function(e,t,r){r.d(t,{y:function(){return i}});var a=r(587892);class i{get token(){return this._token}setToken(e){this._token=e,this._onDidStartToken.fire(e)}constructor(){this._onDidStartToken=new a.Q,this.onDidStartToken=this._onDidStartToken.event}}},431220:function(e,t,r){r.d(t,{v:function(){return o}});var a=r(129219),i=r(553637),n=r(545590);class o{getMattingCache(e){let t=this._mattingStore.get(e);if(t&&t.status===a.xR.Success)return t}setMattingCache(e,t){this._mattingStore.set(e,t)}getVcCache(e){let t=this._vcStore.get(e);if(t&&t.status===a.xR.Success)return t}setVcCache(e,t){this._vcStore.set(e,t)}getVocalSeparationCache(e){var t,r;let n=this._vocalSeparationStore.get(e);if((null==n?void 0:n.status)===a.xR.Success)return n;let{start:o,end:s}=i.b.parseKey(e),[l]=null!==(r=Array.from(this._vocalSeparationStore).find(e=>{let[t]=e,{start:r,end:a}=i.b.parseKey(t);return o>=r&&s<=a}))&&void 0!==r?r:[];return(null===(t=this._vocalSeparationStore.get(null!=l?l:""))||void 0===t?void 0:t.status)===a.xR.Success?n:void 0}setVocalSeparationCache(e,t){this._vocalSeparationStore.set(e,t)}getVocalBeautifyCache(e){var t,r;let i=this._vocalBeautifyStore.get(e);if((null==i?void 0:i.status)===a.xR.Success)return i;let{start:o,end:s}=n.E.parseKey(e),[l]=null!==(r=Array.from(this._vocalBeautifyStore).find(e=>{let[t]=e,{start:r,end:a}=n.E.parseKey(t);return o>=r&&s<=a}))&&void 0!==r?r:[];return(null===(t=this._vocalBeautifyStore.get(null!=l?l:""))||void 0===t?void 0:t.status)===a.xR.Success?i:void 0}setVocalBeautifyCache(e,t){this._vocalBeautifyStore.set(e,t)}getReverseCache(e){let t=this._reverseStore.get(e);if(t&&t.status===a.xR.Success)return t}setReverseCache(e,t){this._reverseStore.set(e,t)}getVideoTrackingCache(e){let t=this._videoTrackingStore.get(e);if(t&&t.status===a.xR.Success)return t}setVideoTrackingCache(e,t){this._videoTrackingStore.set(e,t)}getStableCache(e){let t=this._stableStore.get(e);if(t&&t.status===a.xR.Success)return t}setStableCache(e,t){this._stableStore.set(e,t)}getAlgorithmCache(e){let t=this._algorithmStore.get(e);if(t&&t.status===a.xR.Success)return t}setAlgorithmCache(e,t){this._algorithmStore.set(e,t)}getGameplayCache(e){let t=this._gameplayStore.get(e);if(t&&t.status===a.xR.Success)return t}setGameplayCache(e,t){this._gameplayStore.set(e,t)}constructor(){this._mattingStore=new Map,this._vcStore=new Map,this._vocalSeparationStore=new Map,this._vocalBeautifyStore=new Map,this._reverseStore=new Map,this._videoTrackingStore=new Map,this._stableStore=new Map,this._algorithmStore=new Map,this._gameplayStore=new Map}}},257838:function(e,t,r){r.d(t,{f:()=>es});var a=r("789786"),i=r("402655"),n=r("426336"),o=r("732564"),s=r("779085"),l=r("629524"),c=r("311669"),d=r("126729"),u=r("230689"),h=r("433140"),p=r("597623"),_=r("745428"),g=r("601559"),f=r("590798"),m=r("550473"),v=r("616924"),y=r("431220"),S=r("690613"),M=r("800788"),T=r("538181"),b=r("271564"),k=r("129219"),w=r("254539"),I=r("855021");let E="reverse";function P(e){return`${e.material.path}-${e.material.reversePath}`}class D{updateRenderManager(e){this._renderManager=e}getOrCreateToken(e){(0,M.Y2)((0,n.hey)(e)),(0,M.Y2)(""!==e.material.path);let t=this._cache.getReverseCache(P(e));if(t)return t;let r=this._containerService.createInstance(w.I,e,this._renderManager,this._draftPathStore);return r.onSuccess(()=>{this._cache.setReverseCache(P(e),r)}),r}startMutableReverse(e){var t;let r=e,a=r.material.type;if(this._originalMaterialMap.set(r.id,this._intelligenceStore.idToOriginMaterial[r.id]),a===n.cVg.MetaTypeGif){this._intelligenceStore.actionSegmentIntelligentErrorSet(r.id,{type:k.Sc.Reverse,status:k.xR.Error,error:(0,S.wf)(-1,"metaType gif not support")});return}let i=r.id;if(!r)return;let{reverse:o}=r;if(!o)return;null===(t=this._currentRequestMap[r.id])||void 0===t||t.cancel();let s=this.getOrCreateToken(r);if(this._currentRequestMap[r.id]=s,s.status===k.xR.Success)return this._replaceResource(r,s),s;let l=Date.now();return(0,T.Z)(this._containerService,{type:"algorithm",stage:"start",value:E,errorMsg:s.error.msg}),s.onSuccess(()=>{if((0,T.Z)(this._containerService,{type:"algorithm",stage:"success",value:E,costTime:Date.now()-l,errorMsg:s.error.msg}),s.onCancel(()=>{(0,T.Z)(this._containerService,{type:"algorithm",stage:"cancel",value:E,costTime:Date.now()-l,errorMsg:s.error.msg})}),!!(r=this._dataSdk.draftView.getSegmentById(i)))this._replaceResource(r,s)}),s.onError(e=>{(0,T.Z)(this._containerService,{type:"algorithm",stage:"fail",value:E,costTime:Date.now()-l,errorMsg:s.error.msg})}),s}cancelMutableReverse(e,t){!Array.isArray(e)&&(e=[e]),e.forEach(e=>{var r;null===(r=this._currentRequestMap[e])||void 0===r||r.cancel(),t&&this._recoverReverse(e),this._originalMaterialMap.delete(e)}),this._resetReverse(e)}_replaceReverseResult(e,t){if(!this._originalMaterialMap.get(e))return;let r=this._dataSdk.draftView.getSegmentById(e);if(!r)return;let a=this._dataSdk.draftView.getDraftIdAndSegById(r.id);if(!!a)this._dataSdk.api.segment.innerReplace({draftId:a.draftId,identifier:{id:r.id,material:{path:r.material.path,videoAlgorithm:{path:r.material.videoAlgorithm.path}}},substitute:{material:{reversePath:t,videoAlgorithm:{path:t}}}})}_replaceResource(e,t){this._replaceReverseResult(e.id,t.product.path)}async _recoverReverse(e){let t=this._originalMaterialMap.get(e);if(t){let r=await (0,b.jm)(this._dataSdk,this._renderManager,t),a=this._dataSdk.api.batch.batchStart();this._dataSdk.api.template.setMutableVideos(r),t.material.reversePath&&this._dataSdk.api.video.reverse({segId:e,isReverse:!0,reversePath:t.material.reversePath}),this._dataSdk.api.batch.batchEnd(a)}}_resetReverse(e){e.forEach(e=>{this._intelligenceStore.actionIntelligentReset(e,k.Sc.Reverse)})}cancelReverse(e){(0,M.Y2)((0,n.hey)(e)),(0,M.Y2)(""!==e.material.path);let t=e.clone();t.reverse=!1,t.material.reversePath="";let r=this._cache.getMattingCache((0,f.x)(t));if(r)return r;let a=this._containerService.createInstance(I.s,e,this._renderManager,this._draftPathStore);return a.onSuccess(()=>{this._cache.setMattingCache((0,f.x)(e),a)}),a}constructor(e,t,r,a,i,n){this._cache=e,this._dataSdk=t,this._renderManager=r,this._draftPathStore=a,this._intelligenceStore=i,this._containerService=n,this._originalMaterialMap=new Map,this._currentRequestMap={}}}D=(0,a.gn)([(0,a.fM)(5,u.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ProductCache?Object:ProductCache,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IntelligenceStore?Object:IntelligenceStore,void 0===u.t?Object:u.t])],D);var A=r("836392");class C{updateRenderManager(e){this._renderManager=e}setVideoTracking(e,t){return(0,M.Y2)((0,n.hey)(e)),this._containerService.createInstance(A.y,e,t,this._renderManager,this._draftPathStore)}cancelVideoTracking(e){(0,M.Y2)((0,n.hey)(e));let t=this._containerService.createInstance(I.s,e,this._renderManager,this._draftPathStore);return t.onSuccess(()=>{this._cache.setMattingCache((0,f.x)(e),t)}),t}constructor(e,t,r,a){this._cache=e,this._renderManager=t,this._draftPathStore=r,this._containerService=a}}C=(0,a.gn)([(0,a.fM)(3,u.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ProductCache?Object:ProductCache,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===u.t?Object:u.t])],C);var R=r("613527"),x=r("873361"),O=r("919111"),F=r("876241");function N(e){return e.material.path}class V{updateRenderManager(e){this._renderManager=e}startVideoStable(e){var t,r;let a=e.id;if(!e)return;let i=e.material.stable,n=(null==e?void 0:null===(t=e.material)||void 0===t?void 0:t.path)||"";if(!((null==i?void 0:i.stableLevel)>0)||!n)return;this._originalMaterialMap.set(e.id,this._intelligenceStore.idToOriginMaterial[a]),null===(r=this._currentRequestMap[e.id])||void 0===r||r.cancel();let o=this._getOrCreateToken(e);return(this._currentRequestMap[e.id]=o,o.status===k.xR.Success)?(this._replaceResource(e,o),o):(o.onSuccess(()=>{if(!!this._dataSdk.draftView.getSegmentById(a))this._replaceVideoStableResult(a,{path:o.product.path,resourceId:o.product.resourceId,resourceName:o.product.resourceName})}),o)}cancelVideoStable(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];!Array.isArray(e)&&(e=[e]),e.map(e=>{var r;null===(r=this._currentRequestMap[e])||void 0===r||r.cancel(),t&&this._recoverMutable(e),this._originalMaterialMap.delete(e)})}_getOrCreateToken(e){(0,M.Y2)((0,n.hey)(e)),(0,M.Y2)(""!==e.material.path);let t=this._cache.getStableCache(N(e));if(t)return t;let r=this._containerService.createInstance(F.W,e,this._renderManager,this._draftPathStore);return r.onSuccess(()=>{this._cache.setStableCache(N(e),r)}),r}_replaceResource(e,t){(0,M.Y2)(t.status===k.xR.Success);try{this._replaceVideoStableResult(e.id,{path:t.product.path,resourceId:t.product.resourceId,resourceName:t.product.resourceName})}catch(e){}}_replaceVideoStableResult(e,t){let{path:r,resourceId:a,resourceName:i}=t;if(!this._originalMaterialMap.get(e))return;let n=this._dataSdk.draftView.getSegmentById(e);if(!n)return;let o=this._dataSdk.draftView.getDraftIdAndSegById(e);if(!!o)this._dataSdk.api.segment.innerReplace({draftId:o.draftId,identifier:{id:n.id,material:{path:n.material.path}},substitute:{material:{path:r,materialId:a,materialName:i,sourcePlatform:0}}})}async _recoverMutable(e){let t=this._originalMaterialMap.get(e);if(t){let e=await (0,b.jm)(this._dataSdk,this._renderManager,t);this._dataSdk.api.template.setMutableVideos(e)}}constructor(e,t,r,a,i,n){this._cache=e,this._dataSdk=t,this._renderManager=r,this._draftPathStore=a,this._intelligenceStore=i,this._containerService=n,this._originalMaterialMap=new Map,this._currentRequestMap={}}}V=(0,a.gn)([(0,a.fM)(5,u.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===y.v?Object:y.v,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof RenderManager?Object:RenderManager,void 0===O.H?Object:O.H,"undefined"==typeof IntelligenceStore?Object:IntelligenceStore,void 0===u.t?Object:u.t])],V);var L=r("948328"),j=r("865908"),U=r("270748"),B=r("82963"),W=r("801497"),Z=r("906419");class G extends i.JT{setTimelineManager(e){this._timelineManager=e,this._initCropListeners()}_initCropListeners(){if(this._store.clear(),!this._timelineManager)return;let{segmentManager:e}=this._timelineManager;this._register(e.onSegmentCropStart(()=>{var e,t;this._segmentSourceTimeRangeMap=null===(t=this._segmentSelection.selectionData)||void 0===t?void 0:null===(e=t.getSelectedSegments())||void 0===e?void 0:e.reduce((e,t)=>{var r;let{start:a=0n,duration:i=0n}=null!==(r=t.sourceTimerange)&&void 0!==r?r:{};return e[t.id]={start:a,duration:i},e},{})})),this._register(e.onSegmentCropEnd(()=>{var e,t,r,a,i;let o=null===(e=this._segmentSelection.selectionData)||void 0===e?void 0:e.getSelectedSegments();if(Array.isArray(o))for(let e of o){let o=(null===(t=e.material)||void 0===t?void 0:t.type)===n.cVg.MetaTypeVideo;if(!(0,n.hey)(e)||!o||!(null===(r=this._segmentSourceTimeRangeMap)||void 0===r?void 0:r[e.id]))continue;let{start:s=0n,duration:l=0n}=e.sourceTimerange,{start:c=0n,duration:d=0n}=null!==(i=null===(a=this._segmentSourceTimeRangeMap)||void 0===a?void 0:a[e.id])&&void 0!==i?i:{};if(!(s>=c)||!(l<=d))this._pipelineRerun({seg:e,start:s,duration:l})}this._segmentSourceTimeRangeMap={}}))}hasNoiseReductionUsed(e,t){return e.type===n.zzh.NoiseReduction&&void 0!==(null==t?void 0:t.level)}hasDeflickerUsed(e){return e.type===n.zzh.Deflicker}_pipelineRerun(e){let{seg:t,start:r,duration:a}=e,{algorithms:i,noiseReduction:o}=t.material.videoAlgorithm,{duration:s}=t.material,l=i.reduce((e,r)=>{if(this.hasNoiseReductionUsed(r,o)){if(this.noiseReductionCheck(t))return e.concat(n.zzh.NoiseReduction);this._notificationService.error(W.ZP.t("web_noise_toast_reduce_removed",{},"Image noise reduction removed because the clip is longer than 15 minutes")),this._removeSmartTool({segment:t,toolType:d.F2.VideoNoiseReduction})}if(this.hasDeflickerUsed(r)){if(this.deflickerCheck(t).enable)return e.concat(n.zzh.Deflicker);this._notificationService.error(W.ZP.t("web_flicker_toast_reduce_removed",{},"Flicker removal canceled because the clip is longer than 15 minutes")),this._removeSmartTool({segment:t,toolType:d.F2.Deflicker})}return e},[]);if(l.length<1)return;let{nextParams:c}=this._pipelineManager.checkApplyDelta(t,{toolType:d.F2.VideoCut,enable:!0,param:{start:r,end:r+a}}),u=(0,Z.Z)(c,"toolType"),h=u[d.F2.VideoCut];if(!h)return;let p=(s===a?[]:[h]).concat(c.filter(e=>e.toolType!==d.F2.VideoCut)),_=u[d.F2.VideoNoiseReduction],g=u[d.F2.Deflicker],f=this._getRegenerateText(c,u);if(this._pipelineManager.getUserActionDelta(t.id).length&&(_||g)){let e=this._pipelineManager.getTokenBySegmentId(t.id);null==e||e.cancel(),this._pipelineManager.setGlobalLoadingMessageContent(t,f.loading),this._pipelineManager.setGlobalSuccessMessageContent(t,f.success),l.forEach(e=>{let r=this._getToolTypeWithPersistType(e);if(!!r)this._pipelineManager.recordUserActionDelta(t.id,{toolType:r,enable:!0,param:u[e]}),this._pipelineManager.switchIntelligent(t,r,p)});return}this._pipelineManager.setGlobalLoadingMessageContent(t,f.loading),this._pipelineManager.setGlobalSuccessMessageContent(t,f.success),this._pipelineManager.switchIntelligent(t,d.F2.VideoCut,p)}deflickerCheck(e){let{duration:t}=e.sourceTimerange,{duration:r}=e.targetTimerange,{videoAlgorithm:a,width:i,height:o}=e.material,s=a.algorithms.some(e=>e.type===n.zzh.ComplementFrame),l=BigInt(9e8);return t>l||s&&r>l?{enable:!1,reason:W.ZP.t("web_flicker_toast_time_limit",{},"Can\u2019t remove flicker in clips longer than 15 minutes")}:i<128||o<128||i>=4080||o>=4080?{enable:!1,reason:W.ZP.t("web_flicker_hovertip_resolution_limit",{},"You can only remove flicker in clips with both width and height between 128 and 4096 pixels.")}:{enable:!0}}noiseReductionCheck(e){if(!this._getIsVideoSeg(e))return!0;let{duration:t}=e.sourceTimerange,{duration:r}=e.targetTimerange,{algorithms:a}=e.material.videoAlgorithm,i=a.some(e=>e.type===n.zzh.ComplementFrame),o=BigInt(9e8);return!(t>o)&&(!i||!(r>o))&&!0}_removeSmartTool(e){let{segment:t,toolType:r,videoOnly:a=!0}=e;if(a&&!this._getIsVideoSeg(t))return;let{duration:i}=t.sourceTimerange,{duration:n}=t.material;i!==n&&this._pipelineManager.handleSwitchIntelligent({segment:t,params:{toolType:d.F2.VideoCut,param:{},enable:!1}}),this._pipelineManager.handleSwitchIntelligent({segment:t,params:{toolType:r,enable:!1,param:{}}})}_getIsVideoSeg(e){var t;return(null===(t=e.material)||void 0===t?void 0:t.type)===n.cVg.MetaTypeVideo}_getRegenerateText(e,t){return e.length>2?{loading:W.ZP.t("web_noise_toast_multiple_trim_reduce",{},"Clip duration changed. Reapplying features..."),success:W.ZP.t("web_noise_toast_multiple_success",{},"Features applied")}:t[d.F2.VideoNoiseReduction]?{loading:W.ZP.t("web_noise_toast_trim_re_reduce",{},"Clip duration changed. Re-reducing image noise..."),success:W.ZP.t("web_noise_toast_reduced",{},"Image noise reduced")}:t[d.F2.Deflicker]?{loading:W.ZP.t("web_flicker_toast_trim_re_reduce",{},"Clip duration changed. Removing flicker again..."),success:W.ZP.t("web_flicker_label_removed",{},"Flicker removed")}:{loading:W.ZP.t("web_noise_toast_multiple_trim_reduce",{},"Clip duration changed. Reapplying features..."),success:W.ZP.t("web_noise_toast_multiple_success",{},"Features applied")}}_getToolTypeWithPersistType(e){return e===n.zzh.NoiseReduction?d.F2.VideoNoiseReduction:e===n.zzh.Deflicker?d.F2.Deflicker:void 0}constructor(e,t,r,a){super(),this._timelineManager=e,this._pipelineManager=t,this._segmentSelection=r,this._notificationService=a}}G=(0,a.gn)([(0,a.fM)(3,p.lT),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Object,"undefined"==typeof PipelineManager?Object:PipelineManager,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===p.lT?Object:p.lT])],G);var H=r("13751"),Q=r("248283"),K=r("65458"),z=r("108692"),Y=r("545797"),J=r("545590"),$=r("553637"),q=r("914893"),X=r("910314"),ee=r("422693"),et=r("260963"),er=r("722169");class ea{copy(e,t){let r=this._finishedTokenEventQueue.get(t);this._finishedTokenEventQueue.set(e,r);let a=this._applyingTokenEvent.get(t);this._applyingTokenEvent.set(e,a);let i=this._waitingTokenEventQueue.get(t);this._waitingTokenEventQueue.set(e,i)}addToWaitingQueue(e,t){!this._waitingTokenEventQueue.get(e)&&this._waitingTokenEventQueue.set(e,[]);let r=(0,er.isArray)(t)?t:[t];this._waitingTokenEventQueue.get(e).push(...r)}getApplyingTokenEvent(e){return this._applyingTokenEvent.get(e)}getWaitingTokenQueue(e){return this._waitingTokenEventQueue.get(e)}getFinishedTokenEventQueue(e){return this._finishedTokenEventQueue.get(e)}isNeedApplyEmpty(e){var t;return!this._applyingTokenEvent.get(e)&&!(null===(t=this._waitingTokenEventQueue.get(e))||void 0===t?void 0:t.length)}moveWaitingToCommitting(e){var t;let r=(null!==(t=this._waitingTokenEventQueue.get(e))&&void 0!==t?t:[]).shift();this._applyingTokenEvent.set(e,r)}moveCommittingToFinished(e){let t=this._applyingTokenEvent.get(e);!this._finishedTokenEventQueue.get(e)&&this._finishedTokenEventQueue.set(e,[]),this._finishedTokenEventQueue.get(e).push(t),this._applyingTokenEvent.delete(e)}moveCommittingToWaiting(e){let t=this._applyingTokenEvent.get(e);!this._waitingTokenEventQueue.get(e)&&this._waitingTokenEventQueue.set(e,[]),this._waitingTokenEventQueue.get(e).unshift(t),this._applyingTokenEvent.delete(e)}clear(e){this._applyingTokenEvent.delete(e),this._waitingTokenEventQueue.delete(e),this._finishedTokenEventQueue.delete(e)}constructor(){this._finishedTokenEventQueue=(0,et.LO)(new Map),this._applyingTokenEvent=(0,et.LO)(new Map),this._waitingTokenEventQueue=(0,et.LO)(new Map)}}var ei=r("756024");class en{copy(e,t){this.getApplyingToken(t.id)&&(this._tokenEventQueueManager.copy(e.id,t.id),this._tokenEventQueueManager.moveCommittingToWaiting(e.id),this._startApplyToken(e))}setVc(e,t,r){var a;null===(a=this.getApplyingToken(e.id))||void 0===a||a.cancel();let i=()=>{let a=q.u.generateKey(e,t,r),i=this._vcManager.setVc(e,t,r);return this._smartTokenMapping.set(a,i),this._bindSmartJob(e.id,i),i},n=i();return this._tokenEventQueueManager.addToWaitingQueue(e.id,{sourceType:K.FV.Vc,sourceParams:{enabled:!0,voice:t},type:K.FV.Vc,token:n,createToken:i}),this._startApplyToken(e),n}setVocalBeautify(e,t){var r,a;null===(r=this.getApplyingToken(e.segment.id))||void 0===r||r.cancel();let{segment:i,step:n,timeRange:o,material:s}=e,l={enabled:!0,...e};this._tokenEventQueueManager.addToWaitingQueue(e.segment.id,{sourceType:K.FV.VocalBeautify,sourceParams:l,type:K.FV.VocalBeautify,createToken:()=>{let t=J.E.generateKey(i,n,o,s),r=this._vocalBeautifyManager.setVocalbeautify(e);return this._smartTokenMapping.set(t,r),this._bindSmartJob(i.id,r),r}});let c=null!==(a=this._getNeedRerunTokenQueue(K.FV.VocalBeautify,i,l))&&void 0!==a?a:[];this._tokenEventQueueManager.addToWaitingQueue(e.segment.id,c),this._startApplyToken(e.segment,void 0,t)}removeVocalBeautify(e,t){var r,a;null===(r=this.getApplyingToken(e.id))||void 0===r||r.cancel();let i={segment:e,enabled:!1};this._tokenEventQueueManager.addToWaitingQueue(e.id,[{sourceType:K.FV.VocalBeautify,sourceParams:i,type:K.FV.VocalBeautify,createToken:()=>null}]);let n=null!==(a=this._getNeedRerunTokenQueue(K.FV.VocalBeautify,e,i))&&void 0!==a?a:[];n.length&&this._tipsManager.smartToolRemoved(K.FV.VocalBeautify),this._tokenEventQueueManager.addToWaitingQueue(e.id,n),this._startApplyToken(e,void 0,t)}switchIntelligentByPipeline(e,t,r,a){var i,n;null===(i=this.getApplyingToken(e.id))||void 0===i||i.cancel();let o={params:r,toolType:t,enabled:!0};this._tokenEventQueueManager.addToWaitingQueue(e.id,[{sourceType:K.FV.Pipeline,sourceParams:o,type:K.FV.Pipeline,createToken:()=>{let a=this._pipelineManager.switchIntelligent(e,t,r,void 0,!0);return this._smartTokenMapping.set(e.id,a),this._bindSmartJob(e.id,a),a}}]);let s=null!==(n=this._getNeedRerunTokenQueue(K.FV.Pipeline,e,o))&&void 0!==n?n:[];this._tokenEventQueueManager.addToWaitingQueue(e.id,s),this._startApplyToken(e,void 0,a)}handleEmptyUserAction(e,t,r){var a;let i={toolType:t,params:r,enabled:!1};this._tokenEventQueueManager.addToWaitingQueue(e.id,[{sourceType:K.FV.Pipeline,sourceParams:i,type:K.FV.Pipeline,createToken:()=>null}]);let n=null!==(a=this._getNeedRerunTokenQueue(K.FV.Pipeline,e,i))&&void 0!==a?a:[];n.length&&this._tipsManager.smartToolRemoved(K.FV.VocalBeautify),this._tokenEventQueueManager.addToWaitingQueue(e.id,n),this._startApplyToken(e)}setVocalSeparation(e,t){var r,a;null===(r=this.getApplyingToken(e.segment.id))||void 0===r||r.cancel();let i={enabled:!0,...e};this._tokenEventQueueManager.addToWaitingQueue(e.segment.id,[{sourceType:K.FV.VocalSeparation,sourceParams:i,type:K.FV.VocalSeparation,createToken:()=>{let{segment:t,mode:r,timeRange:a,material:i}=e,n=this._vocalSeparationManager.setVocalSeparation(e);return this._smartTokenMapping.set($.b.generateKey(t,r,a,i),n),this._bindSmartJob(t.id,n),n}}]);let n=null!==(a=this._getNeedRerunTokenQueue(K.FV.VocalSeparation,e.segment,i))&&void 0!==a?a:[];this._tokenEventQueueManager.addToWaitingQueue(e.segment.id,n),this._startApplyToken(e.segment,void 0,t)}removeVocalSeparation(e,t){var r,a;null===(r=this.getApplyingToken(e.id))||void 0===r||r.cancel();let i={segment:e,mode:Y.gx.NONE,enabled:!1};this._tokenEventQueueManager.addToWaitingQueue(e.id,[{sourceType:K.FV.VocalSeparation,sourceParams:i,type:K.FV.VocalSeparation,createToken:()=>null}]);let n=null!==(a=this._getNeedRerunTokenQueue(K.FV.VocalSeparation,e,i))&&void 0!==a?a:[];n.length&&this._tipsManager.smartToolRemoved(K.FV.VocalSeparation),this._tokenEventQueueManager.addToWaitingQueue(e.id,n),this._startApplyToken(e,void 0,t)}getLoadingState(e){return this._tipsManager.getLoadingState(e)}setTimelineManager(e){this._timelineManager=e,this._tipsManager.setTimelineManager(e)}getApplyingToken(e){var t;return null===(t=this._tokenEventQueueManager.getApplyingTokenEvent(e))||void 0===t?void 0:t.token}getApplyingSourceType(e){var t;return null===(t=this._tokenEventQueueManager.getApplyingTokenEvent(e))||void 0===t?void 0:t.sourceType}getApplyingSourceParams(e){var t;return null===(t=this._tokenEventQueueManager.getApplyingTokenEvent(e))||void 0===t?void 0:t.sourceParams}_startApplyToken(e,t,r){var a;if(this._tokenEventQueueManager.getApplyingTokenEvent(e.id)||this._tokenEventQueueManager.isNeedApplyEmpty(e.id))return;this._tokenEventQueueManager.moveWaitingToCommitting(e.id);let i=this._tokenEventQueueManager.getApplyingTokenEvent(e.id),n=null!==(a=i.token)&&void 0!==a?a:i.createToken(t);if(i.token=n,!n||n.status===k.xR.Success){null===this._isFromCache&&(this._isFromCache=!0);let t=null;try{t=null==n?void 0:n.product}catch{ei.t.warn("not product")}this._handleSuccess(t,e,r);return}if(this._tipsManager.prepare(e,i.type,i.sourceParams),this._tipsManager.setLoading(e.id,i.type,0),this._isFromCache=!1,n.onProgress((t,r)=>{this._handleProgress(e,i.type,t,r)}),n.onCancel(()=>{this._resetLoading(e.id)}),n.onError(()=>{this._tipsManager.error(e.id,i.sourceType),this._resetLoading(e.id),null==r||r(!1)}),n.onSuccess(t=>this._handleSuccess(t,e,r)),n.source===k.Sc.Pipeline)n.onCancelWithMidProdApply(()=>{this._resetLoading(e.id)})}_handleSuccess(e,t,r){var a;let i=this._tokenEventQueueManager.getApplyingTokenEvent(t.id);i.result=e,this._tokenEventQueueManager.moveCommittingToFinished(t.id);let[n]=null!==(a=this._tokenEventQueueManager.getWaitingTokenQueue(t.id))&&void 0!==a?a:[];if(!n){this._actionRunManager.applyToDraft(t),this._resetLoading(t.id),this._isFromCache||this._tipsManager.success(i),this._isFromCache=null,null==r||r(!0);return}let o=this._getNewMaterial(t,i,e);this._startApplyToken(t,o,r)}_resetLoading(e){this._tipsManager.clearLoading(e),this._tokenEventQueueManager.clear(e)}_getNeedRerunTokenQueue(e,t,r){switch(e){case K.FV.VocalBeautify:return this._getNeedRerunTokenQueueByVovalBeautify(t,r);case K.FV.VocalSeparation:return this._getNeedRerunTokenQueueByVocalSeparation(t,r);case K.FV.Pipeline:return this._getNeedRerunTokenQueueByPipeline(t,r);case K.FV.Vc:return this._getNeedRerunTokenQueueByVc(t,r)}}_getNeedRerunTokenQueueByVc(e,t){return[]}_getNeedRerunTokenQueueByPipeline(e,t){var r;let a=[];e.vocalSeparation.choice!==n.ZTd.None&&a.push({sourceParams:t,sourceType:K.FV.Pipeline,type:K.FV.VocalSeparation,createToken:t=>{let r=e.vocalSeparation.choice===n.ZTd.Vocal?Y.gx.HUMAN:Y.gx.BACKGROUND,a=[e.vocalSeparation.timeRange.start,e.vocalSeparation.timeRange.start+e.vocalSeparation.timeRange.duration],i=this._vocalSeparationManager.setVocalSeparation({segment:e,mode:r,timeRange:a,material:t});return this._smartTokenMapping.set($.b.generateKey(e,r,a,t),i),this._bindSmartJob(e.id,i),i}});let i=null!==(r=this._getNeedRerunTokenQueueByVocalSeparation(e,t))&&void 0!==r?r:[];return i.forEach(e=>{e.sourceType=K.FV.Pipeline}),a.push(...i),a}_getNeedRerunTokenQueueByVocalSeparation(e,t){var r,a;let i=[];(null===(r=e.vocalBeautify)||void 0===r?void 0:r.enable)&&i.push({sourceParams:t,sourceType:K.FV.VocalSeparation,type:K.FV.VocalBeautify,createToken:r=>{var a;let i=e.vocalBeautify.ambientSoundLevel,n=null!==(a=t.timeRange)&&void 0!==a?a:[e.vocalBeautify.timeRange.start,e.vocalBeautify.timeRange.start+e.vocalBeautify.timeRange.duration],o=this._vocalBeautifyManager.setVocalbeautify({segment:e,step:e.vocalBeautify.ambientSoundLevel,timeRange:n,material:r,enable:!0});return this._smartTokenMapping.set(J.E.generateKey(e,i,n,r),o),this._bindSmartJob(e.id,o),o}});let n=null!==(a=this._getNeedRerunTokenQueueByVovalBeautify(e,t))&&void 0!==a?a:[];return n.forEach(e=>{e.sourceType=K.FV.VocalSeparation}),i.push(...n),i}_getNeedRerunTokenQueueByVovalBeautify(e,t){var r;return(null===(r=e.voiceChange)||void 0===r?void 0:r.length)?e.voiceChange.filter(e=>!!e.speakerId).map(r=>({sourceType:K.FV.VocalBeautify,sourceParams:t,type:K.FV.Vc,createToken:t=>{let a={resourceId:r.resourceId,extra:{speaker_id:r.speakerId}},i=this._vcManager.setVc(e,a,t);return this._smartTokenMapping.set(q.u.generateKey(e,a,t),i),this._bindSmartJob(e.id,i),i}})):[]}_handleProgress(e,t,r,a){this._tipsManager.setLoading(e.id,t,r,a)}_getNewMaterial(e,t,r){let a;switch(t.type){case K.FV.VocalBeautify:a=(0,J.U)(e,{path:null==r?void 0:r.path,type:n.cVg.MetaTypeVocalBeautify});break;case K.FV.VocalSeparation:a=(0,$.U)(e,{path:null==r?void 0:r.path,type:n.cVg.MetaTypeVocalSeparation});break;case K.FV.Vc:a=(0,q.U)(e,{path:null==r?void 0:r.path,type:n.cVg.MetaTypeAudioEffect});break;case K.FV.Pipeline:var i;a={path:null!==(i=null==r?void 0:r.path)&&void 0!==i?i:e.material.path,type:n.cVg.MetaTypeVideo}}return a}_bindSmartJob(e,t){this._intelligenceStore.actionSegmentSmartJobSet(e,t),new l.d(this._intelligenceStore,e,t)}_listenerWithSplit(){this._mainDraftService.dataSdk.onChangeDiff(e=>{let t,r;let{actionOperateType:a,isRecovery:i,isInBatchMode:o,segment:s}=e;if(a!==n.aWQ.Local||i||o||2!==s.length||!s.every(e=>[n.C8.UPDATE,n.C8.ADD].includes(e.type)))return;for(let e of s)e.type===n.C8.UPDATE?t=e.item:e.type===n.C8.ADD&&(r=e.item);if(!r||!t)return;let{segment:l}=r;if(!(0,n.hey)(l)&&!(0,n.Y9Q)(l))return;let c=this._mainDraftService.dataSdk.draftView.getSegmentById(t.id);if(!!c&&(!!(0,n.hey)(c)||!!(0,n.Y9Q)(c)))this.copy(l,c)})}constructor(e,t,r,a,i,n,o,s,l,c,d){this._pipelineManager=e,this._vocalBeautifyManager=t,this._vcManager=r,this._vocalSeparationManager=a,this._draftPathStore=i,this._timelineManager=n,this._smartTokenMapping=o,this._intelligenceStore=s,this._resourceService=l,this._mainDraftService=c,this._containerService=d,this._tokenEventQueueManager=new ea,this._isFromCache=null,this._actionRunManager=this._containerService.createInstance(X.B,this._tokenEventQueueManager,this._pipelineManager,this._vocalBeautifyManager,this._vocalSeparationManager),this._tipsManager=this._containerService.createInstance(ee.l,this._tokenEventQueueManager,this._pipelineManager,this._timelineManager),this._listenerWithSplit()}}en=(0,a.gn)([(0,a.fM)(8,h.c),(0,a.fM)(9,z.n),(0,a.fM)(10,u.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof PipelineManager?Object:PipelineManager,"undefined"==typeof VocalBeautifyManager?Object:VocalBeautifyManager,"undefined"==typeof VcManager?Object:VcManager,"undefined"==typeof VocalSeparationManager?Object:VocalSeparationManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,Object,"undefined"==typeof SmartTokenMapping?Object:SmartTokenMapping,"undefined"==typeof IntelligenceStore?Object:IntelligenceStore,void 0===h.c?Object:h.c,void 0===z.n?Object:z.n,void 0===u.t?Object:u.t])],en);var eo=r("9377");class es extends i.JT{get pipelineManager(){return this._pipelineManager}get intelligentStoreManager(){return this._mutableIntelligentManager}get vocalSeparationManager(){return this._vocalSeparationManager}get vocalBeautifyManager(){return this._vocalBeautifyManager}get smartCropManager(){return this._smartCropManager}get basicSmartToolManager(){return this._basicSmartToolManager}setTimelineManager(e){this._timelineManager=e,this.pipelineManager.setTimelineManager(e),this.smartCropManager.setTimelineManager(e),this._basicSmartToolManager.setTimelineManager(e),this.smartToolsTaskPipelineManager.setTimelineManager(e)}updateRenderManager(e){this._renderManager=e,this._mattingManager.updateRenderManager(e),this._reverseManager.updateRenderManager(e),this._smartSplitManager.updateRenderManager(e),this._stableManager.updateRenderManager(e),this._gameplayManager.updateRenderManager(e),this._algorithmManager.updateRenderManager(e),this._pipelineManager.updateRenderManager(e),this._vcManager.updateRenderManager(e),this._vocalSeparationManager.updateRenderManager(e),this._vocalBeautifyManager.updateRenderManager(e),this._vcManager.updateRenderManager(e),this._videoTrackingManager.updateRenderManager(e),this._smartCropManager.updateRenderManager(e)}setMatting(e){let t=this._mattingManager.getOrCreateToken(e);return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}setVc(e,t,r){return this.smartToolsTaskPipelineManager.setVc(e,t,r)}setVocalSeparation(e,t){this.smartToolsTaskPipelineManager.setVocalSeparation(e,t)}removeVocalSeparation(e,t){this.smartToolsTaskPipelineManager.removeVocalSeparation(e,t)}setVocalBeautify(e,t){this.smartToolsTaskPipelineManager.setVocalBeautify(e,t)}removeVocalBeautify(e,t){this.smartToolsTaskPipelineManager.removeVocalBeautify(e,t)}setVcSpeech(e,t,r){let a=this._vcManager.setVcSpeech(e,t,r);return this.smartTokenMapping.set(`speech_${e.id}_${e.material.path}_${t.resourceId}`,a),a}setReverse(e){let t=this._reverseManager.getOrCreateToken(e);return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}cancelReverse(e){let t=this._reverseManager.cancelReverse(e);return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}setVideoTracking(e,t){let r=this._videoTrackingManager.setVideoTracking(e,t);return this.smartTokenMapping.set(e.id,r),this._bindSmartJob(e.id,r),r}cancelVideoTracking(e){return this._videoTrackingManager.cancelVideoTracking(e)}startVideoSmartSplit(e){let t=this._smartSplitManager.startVideoSmartSplit(e);return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}startVideoStable(e){let t=this._stableManager.startVideoStable(e);if(!!t)return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}cancelVideoStable(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._stableManager.cancelVideoStable(e,t)}startGamePlay(e){let t=this._gameplayManager.startGamePlay(e);if(!!t)return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}cancelPipelineModify(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._pipelineManager.cancelPipelineModify(e,t)}cancelGamePlay(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._gameplayManager.cancelGamePlay(e,t)}setObjectLock(e,t){let r=this._objectLockManager.setObjectLock(e,t);return this.smartTokenMapping.set(e.id,r),this._bindSmartJob(e.id,r),r}startVideoAlgorithm(e){let t=this._algorithmManager.startVideoAlgorithm(e);if(!!t)return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}cancelVideoAlgorithm(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._algorithmManager.cancelVideoAlgorithm(e,t)}startMutableMatting(e){let t=this._mattingManager.startMutableMatting(e);if(!!t)return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}cancelMutableMatting(e,t){this._mattingManager.cancelMutableMatting(e,t)}startMutableReverse(e){let t=this._reverseManager.startMutableReverse(e);if(!!t)return this.smartTokenMapping.set(e.id,t),this._bindSmartJob(e.id,t),t}cancelMutableReverse(e,t){this._reverseManager.cancelMutableReverse(e,t)}getMutablePipelineParams(e,t){var r;let a;let i={};switch(!0){case(0,b.ef)(e):a=e.material.type===n.cVg.MetaTypeVideo?d.F2.VideoMaskTask:d.F2.ImageMaskTask;break;case(0,b.QR)(e,t):a=d.F2.VideoReverseTask;break;case(0,b.FG)(e,t):a=d.F2.VideoStabilization;break;case(0,b.Yn)(e,t):a=d.F2.VideoSlowMotion;break;case(0,b.AG)(e):{let t=(0,n.MnT)(e.material);i={req_json:null==t?void 0:t.algorithm},a=d.F2.TemplateCVTask;break}default:return null}let{nextParams:o}=this.pipelineManager.checkApplyDelta(e,{param:i,enable:!0,toolType:a}),s=o.filter(e=>![d.F2.VideoNoiseReduction,d.F2.ImageNoiseReduction,d.F2.VideoCut].includes(e.toolType));return this.pipelineManager.recordUserActionDelta(e.id,{...null!==(r=s[0])&&void 0!==r?r:{},enable:!0}),{toolType:a,params:s}}switchIntelligentByPipeline(e,t,r,a){this.smartToolsTaskPipelineManager.switchIntelligentByPipeline(e,t,r,a)}handleEmptyUserAction(e,t,r){this.smartToolsTaskPipelineManager.handleEmptyUserAction(e,t,r)}handleSwitchIntelligentByPipeline(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=this._pipelineManager.handleSwitchIntelligent(...t);if(!!a)return this.smartTokenMapping.set(t[0].segment.id,a),this._bindSmartJob(t[0].segment.id,a),a}cacheOriginSegment(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._dataSdk.draftView.getDraftId(),r=this._dataSdk.cutSame.draftIdToMutableVideos[t].find(t=>t.id===e),a=r?this._dataSdk.draftView.getSegmentById(r.segmentId):void 0;r&&a&&(0,n.hey)(a)&&this.intelligenceStore.actionSetOriginSegment({draftId:t,mutableId:e,segmentId:r.segmentId,coverPath:r.coverPath,material:a.material.clone(),crop:r.crop,sourceStart:r.sourceStart,volume:r.volume})}_bindSmartJob(e,t){this.intelligenceStore.actionSegmentSmartJobSet(e,t),this._register(new l.d(this.intelligenceStore,e,t))}constructor(e,t,r,a,i,n,o,s,l,d,u){super(),this._dataSdk=e,this._renderManager=t,this._timelineManager=r,this._draftPathStore=a,this._playManager=i,this._algorithmFilerManager=n,this._segmentSelection=o,this._containerService=s,this._resourceService=l,this._draftMaterialsService=d,this._notificationService=u,this.smartTokenMapping=new x.F,this.intelligenceStore=new c.b,this._productCache=new y.v,this.getVcManager=()=>this._vcManager,this._mattingManager=new f.z(this._productCache,this._dataSdk,this._renderManager,this._draftPathStore,this.intelligenceStore,this._containerService),this._vcManager=new v.X(this._productCache,this._renderManager,this._draftPathStore,this._containerService),this._vocalSeparationManager=new H.p(this._productCache,this._dataSdk,this._renderManager,this._draftPathStore,this._containerService),this._vocalBeautifyManager=new Q.O(this._productCache,this._dataSdk,this._renderManager,this._draftPathStore,this._containerService),this._reverseManager=new D(this._productCache,this._dataSdk,this._renderManager,this._draftPathStore,this.intelligenceStore,this._containerService),this._smartSplitManager=new R.d(this._productCache,this._renderManager,this._draftPathStore,this._containerService),this._stableManager=new V(this._productCache,this._dataSdk,this._renderManager,this._draftPathStore,this.intelligenceStore,this._containerService),this._gameplayManager=new g.$(this._productCache,this._dataSdk,this._renderManager,this._draftPathStore,this.intelligenceStore,this._containerService),this._algorithmManager=new _.P(this._productCache,this._dataSdk,this._renderManager,this._draftPathStore,this.intelligenceStore,this._containerService),this._pipelineManager=this._containerService.createInstance(m.I,this._dataSdk,this._timelineManager,this._renderManager,this._draftPathStore,this.intelligenceStore,this._playManager),this._videoTrackingManager=new C(this._productCache,this._renderManager,this._draftPathStore,this._containerService),this._smartCropManager=this._containerService.createInstance(j.v,this._algorithmFilerManager,this._timelineManager,this._renderManager),this._mutableIntelligentStore=new B.L,this._mutableIntelligentManager=this._containerService.createInstance(U.G,this._mutableIntelligentStore,this._dataSdk,this),this._basicSmartToolManager=this._containerService.createInstance(G,this._timelineManager,this._pipelineManager,this._segmentSelection),this.smartToolsTaskPipelineManager=this._containerService.createInstance(en,this._pipelineManager,this._vocalBeautifyManager,this._vcManager,this._vocalSeparationManager,this._draftPathStore,this._timelineManager,this.smartTokenMapping,this.intelligenceStore),this._objectLockManager=this._containerService.createInstance(eo.m,this._draftPathStore)}}es=(0,a.gn)([(0,a.fM)(7,u.t),(0,a.fM)(8,h.c),(0,a.fM)(9,L.D),(0,a.fM)(10,p.lT),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===o.zo?Object:o.zo,Object,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===s.X?Object:s.X,"undefined"==typeof AlgorithmFilerManager?Object:AlgorithmFilerManager,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===u.t?Object:u.t,void 0===h.c?Object:h.c,void 0===L.D?Object:L.D,void 0===p.lT?Object:p.lT])],es)},503914:function(e,t,r){r.d(t,{s:function(){return o}});var a=r(65458),i=r(129219),n=r(800788);function o(e){switch(e){case a.W.Running:return i.xR.Running;case a.W.Cancelled:return i.xR.Cancelled;case a.W.Error:return i.xR.Error;case a.W.Success:return i.xR.Success;default:(0,n.bP)(e)}}},638336:function(e,t,r){r.d(t,{Dc:function(){return m},EZ:function(){return p},LL:function(){return h},OJ:function(){return v},R5:function(){return S},_Y:function(){return M},aP:function(){return g},hi:function(){return _},if:function(){return u},qk:function(){return y}});var a=r(800788),i=r(426336),n=r(420072),o=r(315201),s=r(426020),l=r(920704),c=r(127830),d=r(722169);async function u(e,t,r,l,d){let{path:u}=e.material,{sourcePlatform:h}=e.material,{materialId:p}=e.material,_="";switch(h){case i.cvu.MaterialPlatformArtist:case i.cvu.MaterialPlatformGiphy:_=p;break;case i.cvu.MaterialPlatformDefault:{let h=r.get(t.getResourceKeyFromDraftPath(u),[i.cVg.MetaTypePhoto,i.cVg.MetaTypeGif,i.cVg.MetaTypeImage].includes(e.material.type)?c._g.UserPhoto:c._g.UserVideo);await (0,n.Z)(h),(0,a.Y2)((0,o.R)(h.value)),h.value.sourceType===s.ov.PublicSpace?((0,a.ZB)(h.value.vid,"vid must be existed"),_=l.hasLogin?d?h.value.assetId:h.value.md5:h.value.vid):_=d?h.value.assetId:h.value.md5;break}case i.cvu.MaterialPlatformBrand:_=p;break;default:_=p}return _}function h(e,t){let r;let{teamId:a,sourcePlatform:n}=e.material;if(n===i.cvu.MaterialPlatformBrand)r=a;else r=t;return r}async function p(e,t,r){var i,l,u;let h=(0,d.isString)(e)?e:e.material.path,p="",_=null!==(i=r.get(t.getResourceKeyFromDraftPath(h),c._g.UserAudio))&&void 0!==i?i:r.get(t.getResourceKeyFromDraftPath(h),c._g.UserFile);if(await (0,n.Z)(_),(0,a.Y2)((0,o.R)(_.value)),_.value.sourceType===s.ov.PublicSpace){let{vid:e}=null!==(l=_.value)&&void 0!==l?l:{};(0,a.ZB)(e,"vid must be existed"),p=e}else{let{assetId:e}=null!==(u=_.value)&&void 0!==u?u:{};p=e}return p}async function _(e,t,r){var i,l,u;let h=(0,d.isString)(e)?e:e.material.path,p="",_=null!==(i=r.get(t.getResourceKeyFromDraftPath(h),c._g.UserVideo))&&void 0!==i?i:r.get(t.getResourceKeyFromDraftPath(h),c._g.UserFile);if(await (0,n.Z)(_),(0,a.Y2)((0,o.R)(_.value)),_.value.sourceType===s.ov.PublicSpace){let{vid:e}=null!==(l=_.value)&&void 0!==l?l:{};(0,a.ZB)(e,"vid must be existed"),p=e}else{let{assetId:e}=null!==(u=_.value)&&void 0!==u?u:{};p=e}return p}async function g(e,t,r){let{path:l}=e.material,{sourcePlatform:d}=e.material,{materialId:u}=e.material,h="";switch(d){case i.cvu.MaterialPlatformArtist:case i.cvu.MaterialPlatformGiphy:h=u;break;case i.cvu.MaterialPlatformDefault:{let d=r.get(t.getResourceKeyFromDraftPath(l),e.material.type===i.cVg.MetaTypePhoto?c._g.UserPhoto:c._g.UserVideo);await (0,n.Z)(d),(0,a.Y2)((0,o.R)(d.value)),d.value.sourceType===s.ov.PublicSpace?((0,a.ZB)(d.value.vid,"vid must be existed"),h=d.value.vid):h=d.value.assetId;break}default:h=u}return h}async function f(e,t,r,i){var s;let l=null!==(s=r.get(t.getResourceKeyFromDraftPath(i),c._g.UserFile))&&void 0!==s?s:r.get(t.getResourceKeyFromDraftPath(i),c._g.UserVideo);if(!!l)return await (0,n.Z)(l),(0,a.Y2)((0,o.R)(l.value)),l.value}async function m(e,t,r){let i=await f(e,t,r,e.material.reversePath),n="";return i?(i.sourceType===s.ov.PublicSpace?((0,a.ZB)(i.vid,"vid must be existed"),n=i.vid):n=i.md5,n):n}async function v(e,t,r){var i;let n=await f(e,t,r,null===(i=e.material.videoAlgorithm)||void 0===i?void 0:i.path),o="";return n?(n.sourceType===s.ov.PublicSpace?((0,a.ZB)(n.vid,"vid must be existed"),o=n.vid):o=n.assetId,o):o}async function y(e,t,r){let i=e.material.matting.path.split(";"),l=[];for(let e of i){let i=r.get(t.getResourceKeyFromDraftPath(e),c._g.UserFile);await (0,n.Z)(i),(0,a.Y2)((0,o.R)(i.value)),i.value.sourceType===s.ov.PublicSpace?((0,a.ZB)(i.value.vid,"vid must be existed"),l.push(i.value.vid)):l.push(i.value.md5)}return l}function S(e,t){let{sourcePlatform:r}=e.material;switch(r){case i.cvu.MaterialPlatformArtist:return l.hn.HeyCan;case i.cvu.MaterialPlatformGiphy:return l.hn.Giphy;case i.cvu.MaterialPlatformDefault:return t?l.hn.EverPhoto:l.hn.VideoArch;case i.cvu.MaterialPlatformBrand:return l.hn.UserBrand;default:return l.hn.HeyCan}}function M(e){return e?l.hn.EverPhoto:l.hn.VideoArch}},89074:function(e,t,r){r.d(t,{N:function(){return m}});var a=r(789786),i=r(587892),n=r(402655),o=r(208041),s=r(800788),l=r(129219),c=r(263958),d=r(65458),u=r(690613),h=r(433140),p=r(168550),_=r(200247),g=r(503914),f=r(638336);class m extends n.JT{get source(){return l.Sc.ObjectLock}get product(){return(0,s.Y2)(this._product),this._product}get status(){return this._cancellation.token.isCancellationRequested?l.xR.Cancelled:this._job?(0,g.s)(this._job.status):l.xR.Running}get error(){return this._error}async _startJob(){var e,t;let r,a;if(this._store.clear(),this._cancellation.token.isCancellationRequested)return;let i=this._smartToolsService.makeBuilder();this._segment.reverse||(null===(t=this._segment.material)||void 0===t?void 0:null===(e=t.videoAlgorithm)||void 0===e?void 0:e.path)?(r=await (0,f.OJ)(this._segment,this._draftPathStore,this._resourceService),a=(0,f._Y)(this._accountService.hasLogin)):(r=await (0,f.if)(this._segment,this._draftPathStore,this._resourceService,this._accountService,!0),a=(0,f.R5)(this._segment,this._accountService.hasLogin)),i.createObjectLockTask(r,a,this._editParams),this._job=i.build(),this._job.onError(e=>{this._error=e,this._onError.fire(this._error)}),this._job.onProgress(e=>{this._onProgress.fire(e)}),this._job.onSuccess(e=>{this._downloadAndFormatProduct(e)})}async _downloadAndFormatProduct(e){let[t]=e,r=await this._handleObjectLockTaskValue(t);if(!r.ok){this._error=r,this._onError.fire(this._error);return}this._product=r.value,this._onSuccess.fire(this._product)}async _handleObjectLockTaskValue(e){var t;let r;let{outputUrl:a,cacheUrl:i}=null!==(t=e.onlineData)&&void 0!==t?t:{};return a&&i&&(r=await new Promise(e=>{let t=this._downloadService.download({key:"objectLock",url:a,uniqueId:a,decryptHash:""},{databaseFirst:!1});t.onSuccess(()=>{try{var r;let a=new TextDecoder().decode(null===(r=t.value)||void 0===r?void 0:r.buffer),{output_info:n,frame_info:o}=JSON.parse(a),{code:s,detect_timestamp:l,start_timestamp:c,message:d}=n;e((0,u.oW)({cacheUrl:i,outputInfo:{code:s,detectTimestamp:l,message:d,startTimestamp:c},frameInfo:o}))}catch(t){e((0,u.wf)(-1,"object track json parse error.",t))}}),t.onFail(()=>{e((0,u.wf)(-1,"object track json download failed."))})})),null!=r?r:(0,u.wf)(-1,"object track json url is empty.")}constructor(e,t,r,a,n,s,l){super(),this._segment=e,this._editParams=t,this._draftPathStore=r,this._accountService=a,this._smartToolsService=n,this._resourceService=s,this._downloadService=l,this._onProgress=new i.Q,this._onError=new i.Q,this._onSuccess=new i.Q,this._onCancel=new i.Q,this._cancellation=new o.A,this._error=(0,u.ly)(),this.cancel=()=>{this._job?this._job.cancel():this._cancellation.cancel(),this._onCancel.fire()},this.onProgress=this._onProgress.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this.onCancel=this._onCancel.event,this._preTask=new c.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),this._register(this._preTask.onProgress(e=>{this._onProgress.fire(Math.floor(e/2))})),this._register(this._preTask.onSuccess(()=>{this._startJob()})),this._register(this._preTask.onError(e=>{this._error=e,this._onError.fire(e)})),this._preTask.execute()}}m=(0,a.gn)([(0,a.fM)(3,_.D),(0,a.fM)(4,d.dM),(0,a.fM)(5,h.c),(0,a.fM)(6,p.tx),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof SegmentVideoReadonly?Object:SegmentVideoReadonly,"undefined"==typeof ObjectLockCloudEditParams?Object:ObjectLockCloudEditParams,"undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===_.D?Object:_.D,void 0===d.dM?Object:d.dM,void 0===h.c?Object:h.c,void 0===p.tx?Object:p.tx])],m)},286399:function(e,t,r){r.d(t,{v:function(){return a}});let a={pitch_rate:10,speech_rate:10,sample_rate:24e3}},238073:function(e,t,r){r.d(t,{o:function(){return u}});var a=r(652146),i=r(937802),n=r(108692),o=r(171477),s=r(426336),l=r(140041),c=r(298522),d=r(977194);function u(e,t){let{applySpeech:r}=(0,o.l)(e,t),u=(0,i.G)(n.n),{checkCloneVoiceLeftWordsWithInfo:h,consumerCloneVoiceLeftWords:p}=(0,d.S)(),{run:_}=(0,c.Z)(async(t,i)=>{if((0,s.Ftn)(t)&&!t.material.ttsAutoUpdate||(0,s.Q2R)(t)&&!t.material.textInfoResources[0].textMaterial.ttsAutoUpdate)return;let n=(0,a.as)(u.dataSdk,t);if(0===n.length)return;let o=n.some(e=>e.material.isAiCloneTone);if(!o||!!await h(null!=i?i:(0,a.k2)(t)))await Promise.all(n.map(async n=>{let{resourceId:o,toneEffectId:s,toneEffectName:l,toneSpeaker:c,toneType:d,isAiCloneTone:h,tonePlatform:p}=n.material,_=(0,a.as)(u.dataSdk,e),{start:g}=t.targetTimerange;return _.length&&({start:g}=_[0].targetTimerange),await r({speakerId:d,voiceName:c,effectName:l,effectId:s,resourceId:o,isCloneVoice:h,tonePlatform:p},null!=i?i:(0,a.k2)(t),g)})).then(e=>{e.every(Boolean)&&o&&p(null!=i?i:(0,a.k2)(t))})},{wait:l.D1,maxWait:1500,leading:!0});return{onAutoUpdateTTS:_}}},777859:function(e,t,r){r.d(t,{r:()=>_,A:()=>p});var a=r("772322");r("966156"),r("225572");var i=r("368100"),n=r("97257"),o=r("218571"),s=r("488935"),l=r("801497");r("54734");var c=r("670933");let d=(0,c.Pi)(function(e){let{process:t,cancel:r}=e,[i,n]=(0,o.useState)(0);return(0,o.useEffect)(()=>()=>{n(t)},[t]),(0,o.useEffect)(()=>{let e=setInterval(()=>{var e;n(Math.trunc(Math.random()*(t-(e=i))+e))},1e3);return()=>{clearInterval(e)}},[i,t]),(0,a.jsxs)(a.Fragment,{children:[l.ZP.t("text_reading_aloud__",{},"\u6587\u672C\u6717\u8BFB\u4E2D..."),"\xa0",i,"%",(0,a.jsx)("span",{className:"attribute-vc-toast-cancel",onClick:r,children:l.ZP.t("web_voice_text_analyzing_cancel",{},"Cancel")})]})});var u=r("209264");let h=e=>{let{onCancel:t,theme:r,title:i,buttonProps:o}=e,c="dark"===r?s.l:s.S;return(0,a.jsxs)("div",{className:"modal-speeching",children:[(0,a.jsx)(c,{className:"animation-loading",suffixDot:!1,title:i||l.ZP.t("text_reading_aloud__",{},"\u6587\u672C\u6717\u8BFB\u4E2D...")}),(0,a.jsx)(n.Z,{type:"primary",size:"small",onClick:t,...o,children:l.ZP.t("cancel_web",{},"\u53D6\u6D88")})]})},p=e=>{let{onCancel:t,notificationService:r,process:i}=e;return r.normal((0,a.jsx)(d,{process:i,cancel:t}),{style:(0,u.s)()},{duration:864e5}).closeNotification},_=e=>{let{onCancel:t,theme:r,title:n}=e,o=i.Z.info({closable:!1,maskClosable:!1,style:{width:320},icon:null,footer:null,content:(0,a.jsx)(h,{onCancel:()=>{o.close(),t()},buttonProps:{type:"secondary"},theme:r,title:n})});return o}},990764:function(e,t,r){r.d(t,{R:()=>p});var a=r("492795"),i=r("408435"),n=r("587892"),o=r("475028");let s=(0,o.i)(100,"web_tts_toast_error_occurred");(0,o.i)(101,"web_tts_toast_language_unsupported");let l=(0,o.i)(102,"web_tts_toast_error_occurred");(0,o.i)(103,"web_tts_toast_characters_limit");class c{start(e){return this._start(e)}async _start(e){var t;let{text:r,speaker:a}=e,i=await this._generateTtsDataService.getGenerateTts({scriptList:[r],timbreInfoList:[{id:a,source:this._source}]});if(!i.ok){this._onError.fire(l());return}let{list:n}=i.value,o=null===(t=n[0])||void 0===t?void 0:t.url;if(!o){this._onError.fire(l());return}try{let e=await fetch(o).then(e=>e.arrayBuffer()),t=new Blob([e],{type:"audio/mp3"}),r=URL.createObjectURL(t);this._onSuccess.fire(t,r)}catch(e){this._onError.fire(s())}}constructor(e,t,r){this._generateTtsDataService=e,this._ttsDataService=t,this._source=r,this._buffers=[],this._onSuccess=new n.Q,this._onError=new n.Q,this._onCancel=new n.Q,this.onSuccess=this._onSuccess.event,this.onError=this._onError.event,this.onCancel=this._onCancel.event,this.onCancelEvent=this._onCancel}}var d=r("929625"),u=r("558874"),h=r("402655");class p extends h.JT{_getOrCreateConverter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.x$.Sami,t=this._pool.get(e);return!t&&(t=this._createConverter(e),this._addListeners(t),this._pool.set(e,t)),t}_addListeners(e){e.onSuccess((e,t)=>{this._onSuccess.fire(e,t)}),e.onError(e=>{this._onError.fire(e)}),e.onCancel(()=>{this._onCancel.fire()})}_createConverter(e){switch(e){case a.x$.ElevenLabs:return new c(this._generateTtsDataService,this._ttsDataService,i.S.ElevenLabs);case a.x$.Vimo:return new c(this._generateTtsDataService,this._ttsDataService,i.S.Vimo);case a.x$.Sami:default:return new d.S(this._client,this._ttsDataService)}}start(e){this._getOrCreateConverter(e.tonePlatform).start(e)}constructor(e,t){super(),this._generateTtsDataService=e,this._ttsDataService=t,this._pool=new Map,this._client=new u.rT,this._onError=this._register(new n.Q),this._onSuccess=this._register(new n.Q),this._onCancel=this._register(new n.Q),this.onCancelEvent=this._register(new n.Q),this.onCancel=this._onCancel.event,this.onError=this._onError.event,this.onSuccess=this._onSuccess.event,this._register(this.onCancelEvent.event(()=>{this._pool.forEach(e=>{e.onCancelEvent.fire()})}))}}},282527:function(e,t,r){r.d(t,{o:function(){return h}});var a=r(426336),i=r(545797),n=r(218571),o=r(65458),s=r(896413),l=r(108692),c=r(797913),d=r(800788);class u{toggleVocalSeparationType(e,t){(0,d.Y2)((0,a.Y9Q)(e)||(0,a.hey)(e),"not audio or video");let{choice:r}=e.vocalSeparation,i=this.getApplyingToken(e.id);if(i&&i.cancel(),r===t)return;if(this._mainEditorWidgetService.playerManager.pause(),t===a.ZTd.None)return this._mainEditorWidgetService.smartToolsManager.removeVocalSeparation(e,t=>this.play(e,t));let{material:n}=e,{start:o}=e.sourceTimerange,{duration:s}=e.sourceTimerange,l=o+s;s<10n*60n*1000n*1000n?l=(o=o-5000000n>0n?o-5000000n:0n)+s+5000000n<=n.duration?o+s+5000000n:n.duration:(o=0n,l=n.duration),this._mainEditorWidgetService.smartToolsManager.setVocalSeparation({segment:e,mode:this._mapMode(t),timeRange:[o,l]},t=>this.play(e,t))}getApplyingToken(e){return this._mainEditorWidgetService.smartToolsManager.smartToolsTaskPipelineManager.getApplyingToken(e)}getLoadingState(e){return this._mainEditorWidgetService.smartToolsManager.smartToolsTaskPipelineManager.getLoadingState(e)}getIsShow(e){let t=window.ip_location_info,{Subdivisions:r}=null!=t?t:{};if((null==r?void 0:r.length)&&4896861===r[0].GeoNameID||!this._videoConfigurationService.abTestManager.getBooleanAbTestValue("cc_web_vocal_separation_enabled")&&!a.TQ4||!e)return!1;let i=this._mainDraftService.dataSdk.draftView.getSegmentById(e);if(!i||(0,a.NHR)(i)||a.bZh.isCombination(i))return!1;if((0,a.hey)(i))return!0;if((0,a.Y9Q)(i))return i.material.type!==a.cVg.MetaTypeSound&&i.material.type!==a.cVg.MetaTypeTextToAudio&&!i.material.musicId}getDisabled(e){if(!e)return!1;let t=this._mainEditorWidgetService.smartToolsManager.smartToolsTaskPipelineManager.getApplyingSourceType(e);return!!t&&t!==o.FV.VocalSeparation}getApplyingMode(e){if(!e)return a.ZTd.None;let t=this._mainEditorWidgetService.smartToolsManager.smartToolsTaskPipelineManager.getApplyingSourceType(e),r=this._mainDraftService.dataSdk.draftView.getSegmentById(e);if(t!==o.FV.VocalSeparation){var n,s;return null!==(s=null===(n=r.vocalSeparation)||void 0===n?void 0:n.choice)&&void 0!==s?s:a.ZTd.None}let{mode:l}=this._mainEditorWidgetService.smartToolsManager.smartToolsTaskPipelineManager.getApplyingSourceParams(e);switch(l){case i.gx.NONE:return a.ZTd.None;case i.gx.HUMAN:return a.ZTd.Vocal;case i.gx.BACKGROUND:default:return a.ZTd.Background}}play(e,t){let{start:r,duration:a}=e.targetTimerange;t&&this._mainEditorWidgetService.playerManager.rangePlay(r,r+a,!0)}_mapMode(e){switch(e){case i.gx.NONE:return a.ZTd.None;case i.gx.HUMAN:return a.ZTd.Vocal;case i.gx.BACKGROUND:return a.ZTd.Background;case a.ZTd.None:return i.gx.NONE;case a.ZTd.Vocal:return i.gx.HUMAN;case a.ZTd.Background:return i.gx.BACKGROUND;default:return}}constructor(e){this._containerService=e;let[t,r,a]=this._containerService.invokeFunction(e=>[e.get(s.a),e.get(l.n),e.get(c.J)]);this._mainEditorWidgetService=t,this._mainDraftService=r,this._videoConfigurationService=a}}function h(e){return(0,n.useMemo)(()=>new u(e),[])}}}]);