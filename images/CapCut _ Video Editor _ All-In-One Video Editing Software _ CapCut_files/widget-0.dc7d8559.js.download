"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["9473"],{307998:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"first-frame-wrapper":"first-frame-wrapper-hK7eVA",firstFrameWrapper:"first-frame-wrapper-hK7eVA",image:"image-Iahi_k",hidden:"hidden-qKH1Sp"}},942501:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"player-empty-placeholder":"player-empty-placeholder-HN9cDB",playerEmptyPlaceholder:"player-empty-placeholder-HN9cDB","player-empty-placeholder-icon":"player-empty-placeholder-icon-dYxEAM",playerEmptyPlaceholderIcon:"player-empty-placeholder-icon-dYxEAM","player-empty-placeholder-title":"player-empty-placeholder-title-aSVxD6",playerEmptyPlaceholderTitle:"player-empty-placeholder-title-aSVxD6"}},278915:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"preview-loading":"preview-loading-e51S4c",previewLoading:"preview-loading-e51S4c","lv-spin-tip":"lv-spin-tip-cINDZr",lvSpinTip:"lv-spin-tip-cINDZr","loading-spinner":"loading-spinner-wqxm2f",loadingSpinner:"loading-spinner-wqxm2f","lv-icon":"lv-icon-AqwcLs",lvIcon:"lv-icon-AqwcLs","preview-loading-mark":"preview-loading-mark-d14l6K",previewLoadingMark:"preview-loading-mark-d14l6K"}},846012:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"figure-face-box":"figure-face-box-fmMhEo",figureFaceBox:"figure-face-box-fmMhEo","figure-face-box-corner":"figure-face-box-corner-dYkg96",figureFaceBoxCorner:"figure-face-box-corner-dYkg96","top-left":"top-left-GZO0ne",topLeft:"top-left-GZO0ne","top-right":"top-right-Vf4F60",topRight:"top-right-Vf4F60","bottom-right":"bottom-right-lMUT6i",bottomRight:"bottom-right-lMUT6i","bottom-left":"bottom-left-ocP_hU",bottomLeft:"bottom-left-ocP_hU"}},387217:function(e,t,i){i.d(t,{Z:function(){return r}});let r={fixedRectangle:"fixedRectangle-LlO2xU"}},645162:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"buffer-fail-toast":"buffer-fail-toast-ulz_BX",bufferFailToast:"buffer-fail-toast-ulz_BX",action:"action-LcD3l3"}},315688:function(){},246685:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"third-platform-pure-mask-wrapper":"third-platform-pure-mask-wrapper-Nkyt1O",thirdPlatformPureMaskWrapper:"third-platform-pure-mask-wrapper-Nkyt1O"}},949235:function(){},332128:function(e,t,i){i.d(t,{Z:function(){return r}});let r={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px",borderRadiusSeg:"8px",jumpModeDuration:"100ms",mutableInnerPadding:"2px",mutableBtnIconSize:"16px",mutableBtnPaddingHorizontal:"8px",responsivePaddingHorizontal:"6px",spriteZIndex:"1","mutable-poly-modal":"mutable-poly-modal-UZ8qHf",mutablePolyModal:"mutable-poly-modal-UZ8qHf",hide:"hide-Cjk1zf","jump-mode":"jump-mode-lf5vlS",jumpMode:"jump-mode-lf5vlS","lv-trigger-arrow-container":"lv-trigger-arrow-container-UCVbl8",lvTriggerArrowContainer:"lv-trigger-arrow-container-UCVbl8","lv-trigger-arrow":"lv-trigger-arrow-bSXfuL",lvTriggerArrow:"lv-trigger-arrow-bSXfuL","mutable-poly-modal-children":"mutable-poly-modal-children-GjNrVO",mutablePolyModalChildren:"mutable-poly-modal-children-GjNrVO","with-color-dot":"with-color-dot-iIRC6A",withColorDot:"with-color-dot-iIRC6A","poly-disabled":"poly-disabled-HMrKUE",polyDisabled:"poly-disabled-HMrKUE"}},212233:function(e,t,i){i.d(t,{Z:function(){return r}});let r={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px",borderRadiusSeg:"8px","timeline-axis-marker-container":"timeline-axis-marker-container-t9kLxG",timelineAxisMarkerContainer:"timeline-axis-marker-container-t9kLxG","markers-canvas":"markers-canvas-ofIsoW",markersCanvas:"markers-canvas-ofIsoW"}},698452:function(){},322568:function(e,t,i){e.exports=i.p+"static/area_locked.511c4519.zip"},994800:function(e,t,i){e.exports=i.p+"static/makeup-root.e90995a7.zip"},958835:function(e,t,i){e.exports=i.p+"static/image/canvas-empty-file-cover.d3ffb49c.png"},673291:function(e,t,i){e.exports=i.p+"static/image/tiktok-preview.930aec80.png"},102597:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAAAoCAYAAAC2LgceAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAA9gSURBVHgB7VpbrF1FGf7/mbV3JUopMfFC25M2oqgF7INcWkSKBmLUSFoxEozRB30whRSU0FCDpfgCxks1JJgQYxSBB0m4GeKTrUkxxhhAWjEGkyotxUgCPT0k9Oyz1vz+t5k1e599SiXtm9POWWuv68w3339fAP9vJ91wqRPP7KEVvFnDfcXis+0J95a8unnza09w91hr8nHfNE19Dsq75HhTdtpyvoGmH091b9vAs2vXnn0UprRFYDFImyDATkTYlI8RjV9DlGyLcoL0H+D4RXpm4un5euuw6J7++eSD82v5N+rvVO7H6jmRTwY5JttA/Bt5yycCAkrn4zHKMdm3cwFtXx5s4+ff+hTZpb0ddbtWv//svTANLGXSAHbyuG7Kc8AJsKgA4WBBNfkpE6cxkGSbHKOJFyy6yxYAU/9sBUsWSebHzwlk4Nh8SXBhYCqwGBwKAmTQ4waSAZQBzGCNv90WR/4lot0zH3jnzYvAenof7eHNpsl54xJgUTWxpcCqXu+t82f2R+zZtrJ2IMnK+nONSfnRUX4H0vNydUAoTNF7BCj+EaKcE+TAGKbXBQVS+KM3+khqrFRiBKuQICUFS37vXfOhd10p5+VR8MxTtFOBKtOrpwpO1XEAajGwQ+g940fejRHoAxmTRGGHniMDSXoWO+6BnEHCHDCQgrKIVPRU/IQ9PPkmBhjECIMm8n7U3yJ6Al5k9GJmFVYA8fMp98QA8ZbFD1LXH+u6dtMLBw7/SGFg8VtDAzg4vtKOYn2sxuUECjrrs3HG9dTE+lwFuOqKeiFE1Fzc8wSDMytGG58wSOCLAoyyKKj4qdiqAvNtNQ6slpnIWe8Lx9CUYwJc6ki3cuwN6tY2qWEdlWeK1TwnG9rq1xfgJN/IjxH0INVIJ6juS71y5Rap0gmYnEWmiE1y0JSyiBxf3ETTOxSEPeTiSHYe7LqE/RjHVQjqVGSPWNyo6CgHS4BL5IAZy0JKX214Ma6gflkrMGrkbHI9OAmmt4otNHHcxTGDkdEN2fK5rkVX4PKuKAxxpROjs43ZFBtT5KKwSVkUit6S3r+6h0qBKUwiBUtAkJF0Xaf6ScTOwIICWpfsd+rwGvEw1i8CCvs5Y8agamH8aqgtQPBBweSQyViEQA4aFQYpSJkdPmERNTX5rGwJK/PfYLFuApJYWMyKW57qgxNDKlDkyScHSiZvaLAjkpIxKrlCTzYuZZsyja/h96Sgo13TwERTCpOZdxPlxb5Nyn5PwZXKPQrAGMDk3otZ0MyabOlC6JwhzhYF0IBRUQyme0Rpmz4ycSTMBjQUAzRuX4r5N+BctJhEKl7gLJJRKFiqZfKcDYmkomyAsbivWAwW9V4AUq2EqfhH/XkbVK+YM0g0ps9w4ndweTPrbqZe2COiJmKn+MQsWuYfBXcw9XkOFjhA8kcYZqDYsiS3vp27AOT7RUcJa+SYXI/BxFQWjWxxpHUKlOk+mUWTJ1NPrEYuA/b3F56DXz38k8IW20wqu6z4K/Dq6yGzgWDVe2dg3Xnr4OorP2V6SoAJ7jO5OyDAmQNJBhQ6J7FngLxFFXFyC+aAZb0jCrpTyhmAXbJzCX2roARjj09Hl9Y9Ib0u2L6BRZMKm6rJ2v7c66/B47+9H051W3XOanj4Z4/A6pUzxibXVRhMvE10sYhZAQpsomrBfF8VsuoiUIYom0QJkOmfTp0PMwoJO2Vzwmii5jPG4i6SgpSCObEd39NMikgvdlknua8Dp6cdPnIIvvC1zbDnsb2w4qwVyqA+5sQSQVCl6QwksWLZqRR9VIkVz7LXVQKY6x8w/SMTIwyuTflYxDJBZRLaGHRxgrknskimPrItIbN0FpjWIpmHeXraoZcOwX3338eWLuQYRleUWAxT7mjBkky+5b6QQFkkbGkZnAWQjtDyvS1453sW+HfH97fcO2Zu4nck9j2kk/4WsPgce/5tY9tOt3I938vnO2a7dLnUPGOqrJoDlC2drgmePrCk/fTn98Kt39xuK82/9z+/H27ftQMOPH8Ajh2bnXrP1hu2w9YbtyuIR+dm4YFf3AuPP/oQHGG2LtXeceZZsP6iy2DrbXfBu1fNGHNckRd9pe5Hzy5yJjVIXXGrskgW0UQPMYr5X9y2ff1WWH3OquInmaHLoYYr7hzh+/6+P/4BHvr1Q2PPmWVA/sLArFt3Afzr0Iuw+YufWxKk3ESshFGzc0fhui1XwJGXXoQ3a68zqPt+9yQ8++en4Ie//A2878MXujdsANn/rAqw1krQuMrTTs4gdODAwwU133E6sy67eANsuGijOYxM55I2ib1HLXIdirm3t02CJe01nohEnd/fffebApWbPEvZdBJAjYHGz//O1i/Bg3v26+9Ixesp40yuMLONbxBbcw9Cju67IoYBc1AqqY9u6kubIcFwGSmzLDVi4Yf6Kr5i6KYX84ACLjlxOX/gr/vhpJo/5olHHoS30v7NAP/jb8/BuR+8oEjX2OOxeg2fFHVmbHKXPIcbdjGVY4PhdDHc8pUtcKrauvMvVGTn5haz6oEHn4Rz2L3oswIAbz9zuU5kbgoLP7v5+p4lPvSn/7QPXj4yzsDjR4/BoKucXD9eRyGa8RCwmtB6jOYeNfb+lTAFPAxpmulgnaq2YcPHYPnys2ApJ2Xl6hlYyT5ZKmFY8P3p47rjrntNhBSFoPt37vgGPPHoA2PXDfj80J1W54u2UO3rbwErNJ1G9/msxmOueyzEMEUdB6fL07L23V3fA3S/ZxpgveGp4lEwJT+tDVQLRAOTTLynJXMHbOCWqZGjXnOYQLlRo/L+ZjAgE8OAxXKFOGHJQlpSwZ+Kdsu3dsD56z6yqDBSt0hUfL/szRsAOBWuZXq286naNkxxf4aM0NuwM5JMJAgC1X6mgpUsFvNkGnrGsUT1eiczLU5fwZlVqxcLAo5f26uN8eMzLFq33PJt2LjhcnWdNRe1BGJ5pQnHMwOE0wW3yZnRgIWRMSy+bsjEOKORRGRv2EoyIaskp2TTDLK4ZX8oKFhJXQgsQeV4Fqtv9/zgHth46WXq2BU/JfsPDhxa+lLFzNKpWJihIpLIhwkAJ2BXjjZ6TeW+0JR27nlnw8k0ybKaiolQnKo6FV7eLGANXdzAGQQe9kO1ggRLikin4UQOmLC4BaE4XNZdzRYQ+wAqRwpeMcIE0xCLYOkcqjmqfxKsYk/88P/oZ+W2coaNRqCqxpm1YtJtLSRBMo+gcVjUCgB5bkd4pbEXSewl2+loWTgQNNi0qoE4p5HFNupWqyuSq9Lz7qx63S5MRAxWAVqaWhlwHKveEty8bTu8lfb5a6+H96xewzFkw1pN+kB7QunLtHelD4UAoaBp+R2u3UhGkXXIAh9Y4AnMyxan0x3Rc05aWQmWM895KI/KY2NFz1BE1ZiYlWif2aAlhN1h0XxVZhaWpNSlH90IN9148oCJmrhkw8fhttvvZiI03KN1Bkr6iHIfcsDOXbZ8vMkutoDUkTMKjYay0OK3y/DEIbz22usszQu9BVrOaRUolV63psqaXB6vfCFyWqdUYtGip6qM3Kev+gzMzs5WipzfIw5o6uO1UhMn0zXbbtgBWzZ/GR5Wbx4nVE5OiNv9F19yBVx86eV6JLVm+tRwZCfWVyyrJAv5OKfx6kuvqJfR6ap5EkyfnKD3bnwtRZJExMi/GXALWtK+6P6ZM6dYk+wJOxjqhSfLiYMXC8TJtNS4586TK/Lk49D7kvtVQcdqpbec5woVNwP0r83ZVRj34XKcKscDqUEDt7bqHWQrqxFMq2A185ofMnp3DhBQb8xEqZb9/GEFmt6JwQHzDy20aqXXo6exe8/YwhQsTqKaZwGsQ7OIOcebMtE8d54yh1FZhJlVDG7vZPYfdVRrY8C66JdUMYXelwkGjllnub9VvWq5/wQimBgkS8aOO7XQjLp0lAe1onfXjKqRTKZCVfbOX6JEcB0UQ87VuQgGZV0RwWRWTsXGyieFVZrl1I6eCfVaXoKq6uKiq6lhNPYRVCYhs6X3tTt3c+o8OqGnndFyVcV/5FDPnG2JYpib8tvrj8PEqp5G/L5WHeKGU7ANT+KfvL8eipvkExVOqXjZ1oAK9o1B+XYAPHY0+S6iZ5y3omUyUbLKrhUV2oXOqiviiCYLikHFEuw4OMlSKKIms0wuYslz6UZSA85fOebdJ7dd6rg2oB98iMhxednLbAyE2sFW+wAlO8aA8Vgig4MtX8foY9sAjvBZAesxBmN9sU4CiJh9MuumOgq9wClJ+yYW3YRZO7vTZPlwWSj5uMLqcVqn6wysXBVuW4/XdIbRGR1dHNErLqS59MweyqJCvVhBxRrHsw+DPCkAsdXwTeqTGHkwDAjEkYpYw+MdMDBBO7NrYYEv5+taGVsDoxE/ZMQWcp7dihH8Hg8efHkNT/6gAND4FycKUpAvURo3+eAfgGWrZiUyU8iuoDv/PoDHo+IlBYQOvUQVXHGDhzPRRCpvqVcAyVki4pQNTnFkEfrWezwGUkjKGBBQsoIWpRzMIYjUedZX8nd8XMBpRRL5HS2faZkE81zpGcn4mV/dAN6YFylgziWGtoW1+vrDh17ZPWiG27TqK7oJzUmNtVWQxiC0rVVUDBjXPa5rBCgrvBprdOJkYOkxt0hSftJENWY2wVg+SQubYaJEgj1Awfc14SgmX9NMI2WMMCcwaJJJafjBklUYJgaIKc7hH7Mn6jaN+L4FBonBmJ/nbcdOqLCI2bRAlq5eILOurNN3XXLNGXcUHI69enwP/9gU3BLah1ykLOk62fKxFvybgMwqn2h+qM/KRClYIUABCIUhuT6n1Rvo2QET++RGw9JGYIGusAbt+wetCKLpnKimfZ5VR+uRAJgaYYAaLgPF1oFpBwqIiBcxSB3ronkG7bgwS7x3dj41TyYVIhbdziKSPZdfjZ+Aapja5v4zt5sB2WbfJYGJloqViYTQs7ZGVrAMxc/pqhl32DOJXGwqS58/tgCsGIO1pdK0kXqAVlkKAojst6pvRKysG3tY+cpnQUwsGSczlkUnyXjn+T0MTpoXUYow6oYsWhEWGKyFpOrcymcopa+o4ZgWVwc67R9/8kpc/Jlkbq+88NqmjuJOBmwTqTUat0AmJv3Wqrlkx9BYBJXJpmxlJ7YWGSfLleXvsXQ07nYqk0YSmeqy6FeAeo6B4hUcdgROMFbInX6IjMIQBkbA6FhBdwvMouN8BzPoODuUIwFH4j4OYZKEN1JpHqAG0qyiIA3Riyuwl+d351UbcG+NzX8BAuZKji1ioL0AAAAASUVORK5CYII="},954980:function(e,t,i){i.d(t,{Z:function(){return r}}),i(772322),i(218571);let r="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPG1hc2sgaWQ9InBhdGgtMS1vdXRzaWRlLTFfNDE1OV82MTgyNTgiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjAuMjkzOTQ1IiB5PSItMi41MDQyMmUtMDciIHdpZHRoPSIyMyIgaGVpZ2h0PSIyMyIgZmlsbD0iYmxhY2siPgo8cmVjdCBmaWxsPSJ3aGl0ZSIgeD0iMC4yOTM5NDUiIHk9Ii0yLjUwNDIyZS0wNyIgd2lkdGg9IjIzIiBoZWlnaHQ9IjIzIi8+CjxwYXRoIGQ9Ik03LjA1MDE4IDIwLjY5MjVDNy4wNTAxOCAyMS4xMzc5IDYuNTExNjEgMjEuMzYxIDYuMTk2NjMgMjEuMDQ2TDIuMTAwNDMgMTYuOTQ5OEw2LjE5NjYzIDEyLjg1MzZDNi41MTE2MSAxMi41Mzg3IDcuMDUwMTggMTIuNzYxNyA3LjA1MDE4IDEzLjIwNzJMNy4wNTAxOCAxNi4wMDAxQzExLjgxMTYgMTYuMDAwMSAxNiAxMS43MTEyIDE2IDYuOTQ5NzVMMTMuMzA3NyA2Ljk0OTc1QzEyLjg2MjIgNi45NDk3NSAxMi42MzkxIDYuNDExMTggMTIuOTU0MSA2LjA5NjE5TDE3LjA1MDMgMkwyMS4xNDY1IDYuMDk2MTlDMjEuNDYxNSA2LjQxMTE4IDIxLjIzODQgNi45NDk3NSAyMC43OTI5IDYuOTQ5NzVMMTggNi45NDk3NUMxOCAxMi44MTU3IDEyLjkxNjIgMTguMDAwMSA3LjA1MDE4IDE4LjAwMDFMNy4wNTAxOCAyMC42OTI1WiIvPgo8L21hc2s+CjxwYXRoIGQ9Ik03LjA1MDE4IDIwLjY5MjVDNy4wNTAxOCAyMS4xMzc5IDYuNTExNjEgMjEuMzYxIDYuMTk2NjMgMjEuMDQ2TDIuMTAwNDMgMTYuOTQ5OEw2LjE5NjYzIDEyLjg1MzZDNi41MTE2MSAxMi41Mzg3IDcuMDUwMTggMTIuNzYxNyA3LjA1MDE4IDEzLjIwNzJMNy4wNTAxOCAxNi4wMDAxQzExLjgxMTYgMTYuMDAwMSAxNiAxMS43MTEyIDE2IDYuOTQ5NzVMMTMuMzA3NyA2Ljk0OTc1QzEyLjg2MjIgNi45NDk3NSAxMi42MzkxIDYuNDExMTggMTIuOTU0MSA2LjA5NjE5TDE3LjA1MDMgMkwyMS4xNDY1IDYuMDk2MTlDMjEuNDYxNSA2LjQxMTE4IDIxLjIzODQgNi45NDk3NSAyMC43OTI5IDYuOTQ5NzVMMTggNi45NDk3NUMxOCAxMi44MTU3IDEyLjkxNjIgMTguMDAwMSA3LjA1MDE4IDE4LjAwMDFMNy4wNTAxOCAyMC42OTI1WiIgZmlsbD0iIzE2MTYxRCIvPgo8cGF0aCBkPSJNMi4xMDA0MyAxNi45NDk4TDEuMTEwNDggMTUuOTU5OUMwLjU2Mzc1IDE2LjUwNjYgMC41NjM3NSAxNy4zOTMgMS4xMTA0OCAxNy45Mzk4TDIuMTAwNDMgMTYuOTQ5OFpNNy4wNTAxOCAxNi4wMDAxTDUuNjUwMTggMTYuMDAwMUM1LjY1MDE4IDE2Ljc3MzMgNi4yNzY5OCAxNy40MDAxIDcuMDUwMTggMTcuNDAwMUw3LjA1MDE4IDE2LjAwMDFaTTE2IDYuOTQ5NzVMMTcuNCA2Ljk0OTc1QzE3LjQgNi41Nzg0NCAxNy4yNTI1IDYuMjIyMzUgMTYuOTkgNS45NTk4QzE2LjcyNzQgNS42OTcyNSAxNi4zNzEzIDUuNTQ5NzUgMTYgNS41NDk3NUwxNiA2Ljk0OTc1Wk0xNy4wNTAzIDJMMTguMDQwMyAxLjAxMDA1QzE3LjQ5MzUgMC40NjMzMTYgMTYuNjA3MSAwLjQ2MzMxNiAxNi4wNjA0IDEuMDEwMDVMMTcuMDUwMyAyWk0xOCA2Ljk0OTc1TDE4IDUuNTQ5NzVDMTcuMjI2OCA1LjU0OTc1IDE2LjYgNi4xNzY1NSAxNi42IDYuOTQ5NzVMMTggNi45NDk3NVpNNy4wNTAxOCAxOC4wMDAxTDcuMDUwMTggMTYuNjAwMUM2LjY3ODg4IDE2LjYwMDEgNi4zMjI3OCAxNi43NDc2IDYuMDYwMjMgMTcuMDEwMUM1Ljc5NzY4IDE3LjI3MjcgNS42NTAxOCAxNy42Mjg4IDUuNjUwMTggMTguMDAwMUw3LjA1MDE4IDE4LjAwMDFaTTEzLjMwNzcgNi45NDk3NUwxMy4zMDc3IDguMzQ5NzVMMTMuMzA3NyA2Ljk0OTc1Wk0xMi45NTQxIDYuMDk2MTlMMTEuOTY0MiA1LjEwNjI0TDEyLjk1NDEgNi4wOTYxOVpNMjEuMTQ2NSA2LjA5NjE5TDIyLjEzNjQgNS4xMDYyNEwyMS4xNDY1IDYuMDk2MTlaTTYuMTk2NjMgMTIuODUzNkw1LjIwNjY4IDExLjg2MzdMNi4xOTY2MyAxMi44NTM2Wk03LjA1MDE4IDIwLjY5MjVMOC40NTAxOCAyMC42OTI1TDcuMDUwMTggMjAuNjkyNVpNMS4xMTA0OCAxNy45Mzk4TDUuMjA2NjggMjIuMDM2TDcuMTg2NTggMjAuMDU2MUwzLjA5MDM4IDE1Ljk1OTlMMS4xMTA0OCAxNy45Mzk4Wk01LjIwNjY4IDExLjg2MzdMMS4xMTA0OCAxNS45NTk5TDMuMDkwMzggMTcuOTM5OEw3LjE4NjU4IDEzLjg0MzZMNS4yMDY2OCAxMS44NjM3Wk04LjQ1MDE4IDE2LjAwMDFMOC40NTAxOCAxMy4yMDcyTDUuNjUwMTggMTMuMjA3Mkw1LjY1MDE4IDE2LjAwMDFMOC40NTAxOCAxNi4wMDAxWk03LjA1MDE4IDE3LjQwMDFDMTIuNjA0OCAxNy40MDAxIDE3LjQgMTIuNDY0MyAxNy40IDYuOTQ5NzVMMTQuNiA2Ljk0OTc1QzE0LjYgMTAuOTU4MSAxMS4wMTg0IDE0LjYwMDEgNy4wNTAxOCAxNC42MDAxTDcuMDUwMTggMTcuNDAwMVpNMTMuMzA3NyA4LjM0OTc1TDE2IDguMzQ5NzVMMTYgNS41NDk3NUwxMy4zMDc3IDUuNTQ5NzVMMTMuMzA3NyA4LjM0OTc1Wk0xNi4wNjA0IDEuMDEwMDVMMTEuOTY0MiA1LjEwNjI0TDEzLjk0NDEgNy4wODYxNEwxOC4wNDAzIDIuOTg5OTVMMTYuMDYwNCAxLjAxMDA1Wk0yMi4xMzY0IDUuMTA2MjRMMTguMDQwMyAxLjAxMDA1TDE2LjA2MDQgMi45ODk5NUwyMC4xNTY1IDcuMDg2MTRMMjIuMTM2NCA1LjEwNjI0Wk0xOCA4LjM0OTc1TDIwLjc5MjkgOC4zNDk3NUwyMC43OTI5IDUuNTQ5NzVMMTggNS41NDk3NUwxOCA4LjM0OTc1Wk0xNi42IDYuOTQ5NzVDMTYuNiAxMi4wNTkgMTIuMTI2NiAxNi42MDAxIDcuMDUwMTggMTYuNjAwMUw3LjA1MDE4IDE5LjQwMDFDMTMuNzA1OCAxOS40MDAxIDE5LjQgMTMuNTcyNCAxOS40IDYuOTQ5NzVMMTYuNiA2Ljk0OTc1Wk04LjQ1MDE4IDIwLjY5MjVMOC40NTAxOCAxOC4wMDAxTDUuNjUwMTggMTguMDAwMUw1LjY1MDE4IDIwLjY5MjVMOC40NTAxOCAyMC42OTI1Wk0xMy4zMDc3IDUuNTQ5NzVDMTQuMTA5NSA1LjU0OTc1IDE0LjUxMSA2LjUxOTE3IDEzLjk0NDEgNy4wODYxNEwxMS45NjQyIDUuMTA2MjRDMTAuNzY3MiA2LjMwMzE4IDExLjYxNDkgOC4zNDk3NSAxMy4zMDc3IDguMzQ5NzVMMTMuMzA3NyA1LjU0OTc1Wk0yMC4xNTY1IDcuMDg2MTRDMTkuNTg5NiA2LjUxOTE3IDE5Ljk5MTEgNS41NDk3NSAyMC43OTI5IDUuNTQ5NzVMMjAuNzkyOSA4LjM0OTc1QzIyLjQ4NTcgOC4zNDk3NSAyMy4zMzM0IDYuMzAzMTggMjIuMTM2NCA1LjEwNjI0TDIwLjE1NjUgNy4wODYxNFpNNy4xODY1OCAxMy44NDM2QzYuNjE5NjEgMTQuNDEwNiA1LjY1MDE4IDE0LjAwOSA1LjY1MDE4IDEzLjIwNzJMOC40NTAxOCAxMy4yMDcyQzguNDUwMTggMTEuNTE0NSA2LjQwMzYxIDEwLjY2NjcgNS4yMDY2OCAxMS44NjM3TDcuMTg2NTggMTMuODQzNlpNNS4yMDY2OCAyMi4wMzZDNi40MDM2MSAyMy4yMzI5IDguNDUwMTggMjIuMzg1MiA4LjQ1MDE4IDIwLjY5MjVMNS42NTAxOCAyMC42OTI1QzUuNjUwMTggMTkuODkwNyA2LjYxOTYxIDE5LjQ4OTEgNy4xODY1OCAyMC4wNTYxTDUuMjA2NjggMjIuMDM2WiIgZmlsbD0id2hpdGUiIG1hc2s9InVybCgjcGF0aC0xLW91dHNpZGUtMV80MTU5XzYxODI1OCkiLz4KPC9zdmc+Cg=="},242692:function(e,t,i){i.d(t,{Z:function(){return r}}),i(772322),i(218571);let r=i.p+"static/svg/checkerboard.b1ba29b5.svg"},378440:function(e,t,i){i.d(t,{r:function(){return n}});var r=i(772322);i(218571);let n=e=>(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:22,height:23,fill:"none",viewBox:"0 0 22 23",...e,children:[(0,r.jsxs)("g",{filter:"url(#icon-timeline-dot_svg__a)",shapeRendering:"crispEdges",children:[(0,r.jsx)("circle",{cx:11,cy:8.723,r:5,fill:"#fff"}),(0,r.jsx)("circle",{cx:11,cy:8.723,r:5.5,stroke:"#073247",strokeOpacity:.16})]}),(0,r.jsx)("defs",{children:(0,r.jsxs)("filter",{id:"icon-timeline-dot_svg__a",width:22,height:22,x:0,y:.723,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,r.jsx)("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),(0,r.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,r.jsx)("feOffset",{dy:3}),(0,r.jsx)("feGaussianBlur",{stdDeviation:2.5}),(0,r.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,r.jsx)("feColorMatrix",{values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),(0,r.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_2337_396428"}),(0,r.jsx)("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_2337_396428",result:"shape"})]})})]})},246098:function(e,t,i){i.d(t,{G:function(){return s}});var r=i(465482),n=i(588336),a=i(218571);function s(e){let t=(0,a.useMemo)(()=>e.getContextMenuConfig(),[e]),i=(0,r.Zk)();return(0,a.useMemo)(()=>(0,n.Q)(t,i),[t,i])}},105166:function(e,t,i){i.d(t,{K:function(){return o}});var r=i(896413),n=i(937802),a=i(641276),s=i(218571);let o=e=>{let t=(0,n.G)(r.a),[i,o]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=(0,a.V)(t.onEventually)(()=>{o(!0)});return()=>e.dispose()},[]),(0,s.useMemo)(()=>e.renderManager,[i])}},128665:function(e,t,i){i.d(t,{b:function(){return S}});var r=i(772322);i(17435),i(701840);var n=i(544633),a=i(629913),s=i(794571),o=i(218571),l=i(670933),d=i(230689),u=i(105789),c=i.n(u),h=i(883700),g=i(801497),m=i(150564),p=i(726413),f=i(937802),_=i(553748),v=i(752075),y=i(668771),M=i(959593);let S=(0,l.Pi)(e=>{let{texts:t,currentSelectIdx:i,onIdxChange:l,onAgree:u,onAbort:S,onPromptEditor:w,promptText:T,generateType:b,aiWriterManager:k}=e,[x,I]=(0,o.useState)(i),R=(0,f.G)(d.t),C=t[x],D={prompt_text_cnt:T.length,prompt_text_detail:T,ai_writer_option:(0,v.U2)(b),script:C.text,script_id:C.scriptId,smart_script_id:C.smartScriptId,script_request_id:C.scriptRequestId,rank:x+1},A=k.getCurrentTextSelectionId(),P=(0,n.default)(()=>{if(x!==t.length-1)I(x+1),l(x+1),(0,_.u)(R,{action:"next",...D})}),E=(0,n.default)(()=>{if(0!==x)I(x-1),l(x-1),(0,_.u)(R,{action:"previous",...D})}),N=(0,n.default)(()=>{null==u||u()}),j=(0,n.default)(()=>{null==S||S()}),O=(0,n.default)(()=>{(0,_.u)(R,{action:"edit_prompt",...D}),null==w||w()}),L=(0,n.default)(e=>{(0,_.u)(R,{action:e,...D})});return(0,o.useEffect)(()=>{(0,_.u)(R,{action:"show",...D})},[x]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:h.Z.textAction,onClick:O,children:g.ZP.t("web_ai_writer_btn_edit_prompt",{},"Edit prompt")}),(0,r.jsx)(s.Z,{type:"vertical",className:h.Z.divider}),(0,r.jsx)(M.d,{text:t[x].text,promptText:T,toolType:p.B.AiWrite,className:c()(h.Z.segmentWidgetToolbarButton),onReportAction:L,reportParams:D}),(0,r.jsx)(a.Z,{content:g.ZP.t("web_ai_writer_btn_previous",{},"Previous"),position:"bottom",children:(0,r.jsx)("div",{className:c()(h.Z.segmentWidgetToolbarButton,{[h.Z.disabled]:0===x}),onClick:E,children:(0,r.jsx)(m.s$$,{})})}),(0,r.jsxs)("div",{className:h.Z.textView,style:{width:36,marginLeft:-4,marginRight:-4},children:[(0,r.jsx)("span",{children:x+1}),(0,r.jsx)("span",{children:"/"}),(0,r.jsx)("span",{children:t.length})]}),(0,r.jsx)(a.Z,{content:g.ZP.t("web_ai_writer_btn_next",{},"Next"),position:"bottom",children:(0,r.jsx)("div",{className:c()(h.Z.segmentWidgetToolbarButton,{[h.Z.disabled]:x===t.length-1}),onClick:P,children:(0,r.jsx)(m._Qn,{})})}),(0,r.jsx)(s.Z,{type:"vertical",className:h.Z.divider}),(0,r.jsx)(a.Z,{content:g.ZP.t("web_ai_writer_btn_discard",{},"Discard"),position:"bottom",children:(0,r.jsx)("div",{className:c()(h.Z.segmentWidgetToolbarButton),onClick:j,children:(0,r.jsx)(m.x8P,{})})}),(0,r.jsx)(a.Z,{content:g.ZP.t("web_ai_writer_btn",{},"Accept"),position:"bottom",children:(0,r.jsx)("div",{className:c()(h.Z.segmentWidgetToolbarButton),onClick:N,children:(0,r.jsx)(m.JrY,{})})}),A&&(0,r.jsx)(y.G,{aiWriterManager:k,widgetId:A})]})})},493362:function(e,t,i){i.d(t,{jQ:function(){return d},tY:function(){return l}}),i(827322);var r=i(29188),n=i(446352),a=i(426336),s=i(801497),o=i(541524);function l(e){let t=e.slice(1).filter(e=>n._3.has(e.type)),i=0;return t.forEach(e=>{"video"===e.type&&++i}),i>=r.m}async function d(e){let t,i,{dataSdk:r,renderManager:n,selectedSegment:d,timelineManager:u,selection:c,canvasSize:h,pos:g}=e;if(!d)return;let m=d.id,p=d.trackRenderIndex,f=r.api.batch.batchStart(),_=r.draftView.getAllTracks();if(0===p&&!function(e,t,i,r){let n=e.id,d=(0,o.Z)(t,e=>e.type===a.pNd.TrackTypeVideo),u=t[d].segments,c=t[e.trackRenderIndex],h=c.segments.find(t=>t.id===e.id),g={segmentId:n,sourceTrackIndex:e.trackRenderIndex,targetStartTime:e.targetTimerange.start,targetTrackIndex:d};if(h&&u.some(e=>(function(e,t){let{start:i,duration:r}=e.targetTimerange,{start:n,duration:a}=t.targetTimerange;return i>=n&&i<n+a||n>=i&&n<i+r})(e,h))){if(l(t))return i.timelineUI.toast.normal(s.oc.t("no_web_spce_web_tracks",{},"\u89C6\u9891\u8F68\u9053\u5DF2\u6EE1\uFF0C\u65E0\u6CD5\u6DFB\u52A0\u5230\u76EE\u6807\u4F4D\u7F6E")),!1;g.targetTrackIndex+=1,r.api.track.add({trackIndex:g.targetTrackIndex,track:new a.wOM({type:c.type,flag:a.w9k.FlagSubVideo,attribute:c.attribute})})}return r.api.segment.move(g),!0}(d,_,u,r))return;r.api.segment.scale([{segmentId:m,x:.3,y:.3}]);let[v,y]=h,[M]=await n.getSegmentRectangles({draftView:r.draftView,canvasSize:[v,y],segIds:[m],selectedSegmentsIds:c.getSelectedSegmentsIds(),getSegmentById:e=>r.draftView.getSegmentById(e)}),{width:S,height:w}=M,T=(v/2-S/2-30)/v,b=(y/2-w/2-30)/y;switch(g){case"bottomLeft":t=-T,i=-b;break;case"bottomRight":t=T,i=-b;break;case"topLeft":t=-T,i=b;break;case"topRight":t=T,i=b;break;default:t=0,i=0}t*=2,i*=2,r.api.segment.translate([{segmentId:m,x:t,y:i}]),r.api.batch.batchEnd(f)}},95565:function(e,t,i){i.d(t,{e:function(){return r}});let r=(0,i(218571).createContext)(void 0)},216030:function(e,t,i){i.d(t,{Q:function(){return S}});var r=i(772322),n=i(426336),a=i(105789),s=i.n(a),o=i(218571),l=i(670933),d=i(952538),u=i(566504),c=i(989489),h=i(238073),g=i(708354),m=i(489910),p=i(298042),f=i(95565),_=i(98702),v=i(356843),y=i(318235),M=i(183765);let S=(0,l.Pi)(e=>{let{segment:t,selectedSegmentChildIndex:i,rect:a,resizeScale:l,displayCursor:S=!0,initialCursorPos:w,maxLength:T=d.RI,isTemplate:b=!1,getWrapSize:k,actionSetIsShowAttributeByCanvasClick:x}=e,I=(0,o.useContext)(f.e),R=(0,o.useContext)(M.f),C=(0,o.useContext)(_.p),{editingTextName:D}=C,{onAutoUpdateTTS:A}=(0,h.o)(t,I);(0,c.x)();let P=(0,o.useRef)(null),E=(0,o.useRef)(null),[N,j]=(0,o.useState)(S&&!I.getHasSelection());(0,o.useEffect)(()=>{let e=I.onDidChangeSelection(()=>{j(S&&!I.getHasSelection())});return()=>{e.dispose()}},[S,I]);let O=(0,o.useRef)(null),L=(0,o.useRef)(),{cursorStyle:B,inputStyle:F}=(0,g.j)({editorUtil:R,enabled:S,rect:a,getWrapSize:k,resizeScale:l}),U=(0,o.useMemo)(()=>i<0||!a.subRects[i]?a:a.subRects[i],[a,i]),{domRef:V,mark:Z}=(0,p.B)("[IRichTextEditor]",!1),G=(0,o.useCallback)((e,t)=>{I.reportTextContentEdit(e,t)},[I]),z=(0,o.useCallback)(async e=>{var i,r;I.actionMutableTextSelectionRangeSet(null!==(i=null==t?void 0:t.id)&&void 0!==i?i:null,0,0),I.actionTextEditingExitEdit();let a=I.getText(),{savedText:s}=C;if(a!==s){let e=(0,n.OTo)({segId:null!==(r=null==t?void 0:t.id)&&void 0!==r?r:"",textMaterial:(0,n.U_g)({content:a}),modifyFlags:[n.XHM.ModifyContent]});await R.textUpdateMaterial({...e,draftId:L.current},{throttle:!0})}O.current&&e!==O.current&&(O.current=null,t&&(await A(t,e),G(t,e)))},[I,R,A,t,C,G]),{focus:Y}=(0,v.x)({ref:E,maxLength:T,editorUtil:R,store:C,isTemplate:b,performanceMark:Z,onEscapePress:z}),H=(0,o.useCallback)(async e=>{await R.textMoveCursorByPos(e.x,e.y)},[R]),K=(0,o.useCallback)(async e=>{await R.textSelectToPos({x:e.x,y:e.y})},[R]),W=(0,o.useCallback)(()=>{Y(),R.textEditUpdateSnapshot()},[R,Y]),q=(0,o.useCallback)(async()=>{await R.textSelectAll(),Y()},[R,Y]),X=(0,o.useCallback)(async()=>{await R.textSelectWord(),Y()},[R,Y]);return((0,m.D)({ref:P,editorUtil:R,rect:a,getWrapSize:k,scale:l,performanceMark:Z,onSelectionStart:H,onSelectionUpdate:K,onSelectionEnd:W,onSelectAll:q,focus:Y,onSelectWord:X,onFocusOut:z,actionSetIsShowAttributeByCanvasClick:x}),(0,o.useEffect)(()=>(Z("text_edit_begin_edit"),L.current=I.getSubDraftId(),R.textEnterSubDraft(L.current),R.textBeginEdit(a.id,D,null==w?void 0:w.x,null==w?void 0:w.y).then(()=>{w||R.textSelectAll(),Y()}),()=>{R.textEndEdit(a.id,D)}),[a.id]),(0,o.useEffect)(()=>{if(t){let i="";if((0,u.Bl)(t)&&D)t.material.textInfoResources.forEach(e=>{let{textMaterial:t}=e;if(t.name===D){var r;i=null!==(r=t.text)&&void 0!==r?r:""}});else{var e;i=null!==(e=t.material.text)&&void 0!==e?e:""}i=i.replace("\b",""),I.actionTextEditingTextInit(i),O.current=i}else I.actionMutableTextSelectionRangeSet(null,0,0),I.actionTextEditingExitEdit()},[I,D,t,null==t?void 0:t.id]),t)?(0,r.jsxs)("div",{className:s()(y.Z.richTextEditorContainer),"data-in-rich-text-editing":"true",children:[(0,r.jsx)("textarea",{ref:E,tabIndex:-1,className:y.Z.inputProxy,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:"false",wrap:"off",style:F}),(0,r.jsx)("div",{ref:P,className:y.Z.richTextEditor,style:{width:`${U.width*l}px`,height:`${U.height*l}px`,transform:`translate(${U.x*l}px, ${U.y*l}px) rotate(${U.rotate}deg)`},children:(0,r.jsx)("div",{ref:V,tabIndex:-1,className:s()(y.Z.cursor,{[y.Z.cursorVisible]:N}),style:B})})]}):null})},692474:function(e,t,i){i.d(t,{YJ:function(){return c},_Y:function(){return d},vB:function(){return h}});var r=i(498526),n=i(426336),a=i(460254),s=i(127830);function o(e){let{clientX:t,clientY:i}=e,{clientWidth:a,clientHeight:s,x:o,y:l}=(0,r.Sp)(),[d=t,u=i]=(0,r.iN)();return{transformX:2*n.pMA.div(d-o-n.pMA.div(a,2),a),transformY:-(2*n.pMA.div(u-l-n.pMA.div(s,2),s))}}function l(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[r,n,s,l,d]=t;switch(n){case a.r.Video:return r.addVideoToCurrentProgress(s,void 0,{searchId:null==d?void 0:d.searchId});case a.r.Photo:return r.addPhotoToCurrentProgress(s);case a.r.UserPhoto:return r.addUserPhotoToCurrentProgress(s);case a.r.UserVideo:return r.addUserVideoToCurrentProgress(s);case a.r.DigitalHuman:return r.addDigitalHumanToCurrentProgress(s);case a.r.UserAudio:return r.addUserAudioToCurrentProgress(s);case a.r.Audio:return r.addAudioToCurrentProgress(s,{searchId:null==d?void 0:d.searchId});case a.r.Sticker:{let e=l&&o(l);return r.addStickerToCurrentProgress(s,{...e,searchId:null==d?void 0:d.searchId})}case a.r.Gif:return r.addGifToCurrentProgress(s);case a.r.Filter:return r.addFilterToCurrentProgress(s);case a.r.Effects:return r.addEffectToCurrentProgress(s);case a.r.BasicText:return r.addTextToCurrentProgress(s,l&&o(l));case a.r.TextPreset:if(s.isFromBrand)return r.addBrandTextToCurrentProgress(s,l&&o(l));return r.addTextPresetToCurrentProgress(s,l&&o(l));case a.r.TextTemplate:return r.addTextTemplateToCurrentProgress(s,l&&o(l));case a.r.VideoTemplate:return r.addVideoTemplateToCurrentProgress(s);case a.r.AdjustmentPreset:return r.addAdjustemtPresetToCurrentProgress(s)}}function d(e,t,i){return l(e,i.type,i.dragSource,t,i.delta)}let u={[s._g.UserAudio]:a.r.UserAudio,[s._g.UserPhoto]:a.r.UserPhoto,[s._g.UserVideo]:a.r.UserVideo};function c(e,t,i){return l(e,u[t],i)}function h(e,t,i,r,n,a){switch(i){case s._g.UserPhoto:return e.addUserPhoto(r,{start:t.progress,trackIndex:n,needInsertTargetTrack:!0},{batchTask:a});case s._g.UserVideo:return e.addUserVideo(r,{start:t.progress,trackIndex:n,needInsertTargetTrack:!0},{batchTask:a})}}},558595:function(e,t,i){i.d(t,{f:function(){return d},i:function(){return l}});var r=i(800788),n=i(460254),a=i(456012);let s=e=>({volume:e.volume,sourceStartTime:0n,mutableVideoId:e.id,initialSpeed:1});function o(e,t,i){let a=t.map(e=>{let{type:t,resource:i,mutableVideo:a,autoUnhide:o}=e;switch(t){case n.r.Video:return{type:n.r.Video,value:i,...s(a),visible:o};case n.r.UserVideo:return{type:n.r.UserVideo,value:i,...s(a),visible:o};case n.r.Photo:return{type:n.r.Photo,value:i,...s(a),visible:o};case n.r.UserPhoto:return{type:n.r.UserPhoto,value:i,...s(a),visible:o};default:(0,r.ss)(`Invalid type: ${t}`)}});return e.replaceMutableVideo(a,i)}function l(e,t,i){return o(e,t.map((e,t)=>({...e,type:e.dragData.type,resource:e.dragData.dragSource,autoUnhide:e.autoUnhide})),i)}function d(e,t,i){return o(e,t.map(e=>({...e,type:(0,a.Q)(e.resourceType)})),i)}},893525:function(e,t,i){i.d(t,{y:function(){return u}});var r=i(772322),n=i(456012),a=i(781566),s=i(426336),o=i(374904),l=i(801497),d=i(150564);function u(e){let{mainEditorWidgetService:t,canvasManager:i,segmentOperationManager:u,selection:c,isTemplate:h,isEditingTemplate:g,containerService:m,onError:p,reporter:f,onFileUploadClick:_,onCrop:v}=e,y=c.getSelectedSingleSegment();if(!y||(0,s.duj)(y))return null;let{segmentSelection:M}=t,S={items:[]};if((0,s.hey)(y)&&!(0,s.NHR)(y)&&!h&&!g&&S.items.push({type:"icon",order:11,icon:(0,r.jsx)(d.VJ1,{}),tooltip:l.ZP.t("web_crop",{},"Crop"),onClick:()=>{f("crop",y),y&&v(y.id)}}),h||c.isInSubDraftContext()){if((0,s.hey)(y)){let e=`${o.NF.image.accept},${o.NF.video.accept}`,s=!y.visible;S.items.push({type:"icon",order:0,icon:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.S31,{size:20}),(0,r.jsx)(a.b,{accept:e,onClick:e=>{if(s){e.preventDefault();return}_(e)},onChange:async e=>{await (0,n.K)({canvasManager:i,mainEditorWidgetService:t,isReplaceMutable:!!M.segmentMutable,event:e,onError:p,containerService:m}),e.target.value=""}})]}),tooltip:s?"":l.ZP.t("web_overlay_button_replace",{},"Replace"),onClick:()=>{},disabled:s})}}else((0,s.Ftn)(y)||(0,s.Q2R)(y)||(0,s.P2T)(y))&&S.items.push({type:"icon",icon:(0,r.jsx)(d.Doy,{}),tooltip:l.ZP.t("web_overlay_button_duplicate",{},"Duplicate"),order:11,onClick:()=>{f("duplicate",y),u.duplicateSelectedSegments()},needDivider:!0});return S}i(218571)},968621:function(e,t,i){i.d(t,{T:function(){return o}});var r=i(789786),n=i(432871),a=i(210823),s=i(728631);class o{openMediaTab(){this._workbenchService.activeSiderMenuByName(s.j.SiderMenuMedia,"auto")}openTextBasicPanel(){this._workbenchService.updateToolBarViewMode({showGroup:"text-template",selectionIds:this._selection.getSelectedSegmentsIds(),panelActivationMode:n.B.ForceAct,activePanelName:s.j.ToolbarTextTemplateBasic})}dispose(){}constructor(e,t){this._selection=e,this._workbenchService=t}}o=(0,r.gn)([(0,r.fM)(1,a.e),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ISelection?Object:ISelection,void 0===a.e?Object:a.e])],o)},371002:function(e,t,i){i.d(t,{S:()=>g});var r=i("789786"),n=i("687730"),a=i("572013"),s=i("446352"),o=i("426336"),l=i("493713"),d=i("517847"),u=i("450029");let c={previewCover:"tiktok"};var h=i("260963");class g{get isOperatingCanvas(){return this._isOperatingCanvas.isOperateScale||this._isOperatingCanvas.isOperateTrans}get percent(){return this.duration?100*o.pMA.div(this.progress,this.duration,"number"):0}get widgetBaseInteractivityStatus(){return!this.disableInteract}get widgetInteractivityStatus(){return this.widgetBaseInteractivityStatus&&this.widgetInteractivityStatusFromOutside&&!this.readonly&&!this.widgetSelectedOnlyFromOutside}get widgetSelectedOnly(){return this.widgetSelectedOnlyFromOutside}get disableInteract(){return this.disableInteractFromOutside||this.isDraggingMaterial||this.loading||this.readonly}get readonly(){return this.readonlyFromOutside}get isDragMode(){return this.cursorMode===d.W.Hand}get isMaskEditMode(){return this.editMode===u.G.Mask}get isTrackingEditMode(){return this.editMode===u.G.Tracking}get isCanvasEmpty(){return this.draftLoaded&&this.tracks.every(e=>0===e.segments.length)}get isMultiSelection(){return this.selectedSegmentIds.length>1}get allSegments(){return this.tracks.map(e=>e.segments).flat()}get selectedSingleSegmentId(){return 1===this.selectedSegmentIds.length?this.selectedSegmentIds[0]:null}get isDraggingCanvasMode(){return this.cursorMode===d.W.Hand}get canvasSize(){let{canvasConfig:e}=this,t=e?[e.width,e.height]:[0,0];return(0,a.Ce)(t)}actionDraftLoadedSet(){this.draftLoaded=!0}actionTracksSet(e){this.tracks=e}actionCanvasConfigSet(e){this.canvasConfig=e}actionAtomicDisableInteractivitySet(e){this.atomicDisableInteractivity=e}actionDisableInteractFromOutsideSet(e){this.disableInteractFromOutside=e}actionReadonlyFromOutsideSet(e){this.readonlyFromOutside=e}setDoNotRenderRectangles(e){this.doNotRenderRectangles=e}actionLoadingSet(e){this.loading=e}actionHasRenderedSet(){this.hasRendered=!0}actionCanvasRectanglesSet(e){if(0!==this.canvasRectangles.length||0!==e.length)this.canvasRectangles=e}actionDisabledRectangleIdsSet(e){this.disabledRectangleIdsSet.add(e)}actionDisabledRectangleIdsRemove(e){this.disabledRectangleIdsSet.delete(e)}actionDisabledRectangleIdsClear(){this.disabledRectangleIdsSet.clear()}actionDurationSet(e){this.duration=e}actionSelectedSegmentIdsSet(e){(this.selectedSegmentIds.length!==e.length||e.some(e=>!this.selectedSegmentIds.includes(e)))&&(this.selectedSegmentIds=e)}actionSelectedSegmentChildIndexSet(e){this.selectedSegmentChildIndex=e}actionCurrentFaceIdSet(e){this.currentFaceId=e}actionFaceInfoListSet(e){this.faceInfoList=e}actionFixedRectangleSet(e){this.fixedRectangle=e}actionCursorModeSet(e){this.cursorMode=e}actionEditModeSet(e){this.editMode=e}updateWidgetMenu(){this.widgetMenuUpdateTrigger=performance.now()}actionIsPlayingSet(e){this.isPlaying=e}actionProgressSet(e){this.progress!==e&&(this.progress=e)}actionCanvasSpaceRefSet(e){this.canvasSpaceRef=e}actionVideoPreviewStatusSet(e){this.videoPreviewStatus=e}actionVideoPreviewLoadedSet(e){this.videoPreviewLoaded=e}actionVideoPreviewDurationSet(e){this.videoPreviewDuration=e}actionVideoPreviewProgressSet(e){this.videoPreviewProgress=e}actionVideoPreviewInfoReset(){this.videoPreviewProgress=0n,this.videoPreviewDuration=0n}actionFirstFrameInfoSet(e){this.firstFrameInfo=e}actionPreviewInfoSet(e){this.previewInfo=e}actionIsFullscreenSet(e){this.isFullscreen=e}actionCanvasAdjustedSet(e){this.canvasAdjusted=e}actionCanvasRatioSet(e){this.canvasRatio=e}actionVisibleAspectRatioSelectModalSet(e){this.visibleAspectRatioSelectModal=e}actionCanvasResizingSet(e){this.canvasResizing=e}actionUserScaleSet(e,t){if(this.userScale!==e)this.userScale=e,this._isOperatingCanvas.isOperateScale=!0,this.actionDebounceIsOperatingScale(!1),this.canvasAdjusted!==t&&this.actionCanvasAdjustedSet(t)}actionDebounceIsOperatingScale(e){this._isOperatingCanvas.isOperateScale=e}actionUserTranslateSet(e){this.userTranslate=e}actionBaseScaleSet(e){this.baseScale=e}actionBaseTranslateSet(e){this.baseTranslate=e}actionIsDraggingMaterialSet(e){this.isDraggingMaterial=e}actionPlayerConfigSet(e){this.playerConfig=e}actionHasLoginSet(e){this.hasLogin=e}actionCoverUrlSet(e){this.coverUrl=e}actionNeedZoomToFitSet(e){this.needZoomToFit=e}actionSetIsProgressivelyLoading(e){this.isProgressivelyLoading=e}actionSetIsStreamLoading(e){this.isStreamLoading=e}actionEnableFaceQuerySet(e){this.enableFaceQuery=e}actionWidgetInteractivityStatusFromOutsideSet(e){this.widgetInteractivityStatusFromOutside=e}actionTrackingRectSet(e){this.trackingRect=e}actionTrackingRectSegmentIdSet(e){this.trackingRectSegmentId=e}actionTrackingRectActiveSet(e){this.trackingRectActive=e}actionTrackingRectCallbackSet(e){this.trackingRectCallback=e}actionWidgetSelectedOnlyFromOutsideSet(e){this.widgetSelectedOnlyFromOutside=e}actionIsDisabledSelectWidgetSet(e){this.isDisabledSelectWidget=e}actionUpdateFailedSegment(e,t){t?this.failedSegments.add(e):this.failedSegments.delete(e)}actionIsWaitingEditorReadyToSwitchSet(e){this.isWaitingEditorReadyToSwitch=e}actionIsRotateWidgetHoveredSet(e){this.isRotateWidgetHovered=e}actionCurrentWidgetRectangleSet(e){this.currentWidgetRectangle=e}actionAiWatermarkConfigSet(e){this.aiWatermarkConfig=Object.assign({},this.aiWatermarkConfig,e)}constructor(){var e=this;this.tracks=[],this.draftLoaded=!1,this.duration=0n,this.canvasConfig=null,this.loading=!1,this.isProgressivelyLoading=!1,this.isStreamLoading=!1,this.hasRendered=!1,this.canvasRectangles=[],this.disabledRectangleIdsSet=new Set,this.selectedSegmentIds=[],this.currentFaceId=null,this.faceInfoList=[],this.fixedRectangle=null,this.selectedSegmentChildIndex=-1,this.widgetUpdateTrigger=0,this.widgetMenuUpdateTrigger=0,this.cursorMode=d.W.Mouse,this.editMode=u.G.Video,this.isPlaying=!1,this.progress=0n,this.videoPreviewStatus=s.bC.INIT,this.videoPreviewLoaded=!1,this.videoPreviewDuration=0n,this.videoPreviewProgress=0n,this.firstFrameInfo=null,this.previewInfo=null,this.canvasSpaceRef=null,this.isFullscreen=!1,this.canvasRatio=n.j9["0"],this.visibleAspectRatioSelectModal=!1,this.canvasAdjusted=!1,this.canvasResizing=!1,this.userScale=1,this.baseScale=1,this.userTranslate={x:0,y:0},this.baseTranslate={x:0,y:0},this._isOperatingCanvas={isOperateTrans:!1,isOperateScale:!1},this.isDraggingMaterial=!1,this.playerConfig=c,this.hasLogin=!1,this.coverUrl="",this.needZoomToFit=!1,this.disableInteractFromOutside=!1,this.readonlyFromOutside=!1,this.doNotRenderRectangles=!1,this.enableFaceQuery=!1,this.trackingRect=null,this.trackingRectCallback=null,this.trackingRectActive=!1,this.trackingRectSegmentId=void 0,this.failedSegments=new Set,this.isWaitingEditorReadyToSwitch=!1,this.atomicDisableInteractivity={disableScale:!1,disableDrag:!1,disableRotate:!1},this.aiWatermarkConfig={enable:!1,url:"",width:0,height:0,position:{x:0,y:0}},this.widgetInteractivityStatusFromOutside=!0,this.widgetSelectedOnlyFromOutside=!1,this.isDisabledSelectWidget=!1,this.currentWidgetRectangle=void 0,this.isRotateWidgetHovered=!1,this.actionPlayerWidgetUpdateTriggerSet=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();e.widgetUpdateTrigger=t},(0,h.ky)(this,{},{autoBind:!0})}}(0,r.gn)([(0,l.Ds)(1e3),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],g.prototype,"actionDebounceIsOperatingScale",null)},707721:function(e,t,i){i.d(t,{t:()=>el});var r=i("772322"),n=i("937802"),a=i("141913"),s=i("609591"),o=i("523267"),l=i("549603"),d=i("670933"),u=i("218571");i("17435"),i("914303"),i("931598");var c=i("544633"),h=i("629913"),g=i("694893"),m=i("16464"),p=i("557598"),f=i("729466"),_=i("743508"),v=i("770311"),y=i("425427"),M=i("797913"),S=i("641077"),w=i("426336"),T=i("230689"),b=i("396858"),k=i("503791"),x=i("35389"),I=i("217221"),R=i("772664"),C=i("97181"),D=i("378521"),A=i("817368"),P=i("38476"),E=i("801497"),N=i("150564"),j=i("105789"),O=i.n(j),L=i("800793"),B=i("271368"),F=i("334769"),U=i("48312"),V=i("883019"),Z=i("538676"),G=i("604453"),z=i("764357"),Y=i("200231"),H=i("334789"),K=i("653525"),W=i("375853"),q=i("188817");let X=(0,a.PS)(()=>Promise.all([i.e("987"),i.e("6457"),i.e("7492")]).then(i.bind(i,594820))),Q=(0,a.PS)(()=>i.e("5484").then(i.bind(i,530457))),J=(0,d.f3)("store","canvasManager")((0,d.Pi)(e=>{var t,s,o,l,d,j,J,$,ee,et;let{canvasManager:ei,store:er,isNewEditPage:en,isTemplate:ea,onPlayerResizeReady:es,...eo}=e,el=(0,n.G)(T.t),{playerController:ed,selectionManager:eu}=ei.modules,{canvasRatio:ec,doNotRenderRectangles:eh,firstFrameInfo:eg,isCanvasEmpty:em,isDragMode:ep,isFullscreen:ef,isMaskEditMode:e_,isPlaying:ev,playerConfig:ey,userScale:eM,selectedSingleSegmentId:eS,isDraggingMaterial:ew,loading:eT,canvasConfig:eb,isDraggingCanvasMode:ek,needZoomToFit:ex,previewInfo:eI,hasRendered:eR,actionHasRenderedSet:eC,readonly:eD}=er,eA=(0,u.useRef)(null),eP=(0,u.useRef)(null),eE=(0,u.useRef)(null),eN=(0,u.useRef)(null),ej=(0,u.useRef)(null),[eO,eL]=(0,u.useState)(!1),eB=(0,u.useRef)(null);(0,u.useEffect)(()=>{en&&!ea&&eC()},[en,ea]);let eF=(0,C.H)(ei),[eU,eV]=(0,u.useState)(!0);(0,u.useEffect)(()=>{eV(em)},[em]),!function(e,t,i){let{canvasRectangles:r,selectedSingleSegmentId:n}=e,a=(0,F.F)(t),s=(0,u.useCallback)(e=>{let i=e.shiftKey?-1:1,s=n?a.draftView.getSegmentById(n):null;if(!s)return;if((0,w.Q2R)(s)){let e=t.modules.selectionManager.getSelectedSegmentChildIndex(),r=s.material.textInfoResources.length;if(e>=0&&r>1){t.modules.selectionManager.selectChildByIndex((e+i+r)%r);return}}let o=r.findIndex(e=>e.id===s.id);if(-1===o)return;let l=(o+i+r.length)%r.length;t.modules.selectionManager.selectSegments([r[l].id])},[n,r,a]),o=(0,c.default)(e=>!["TEXTAREA","INPUT","SELECT"].includes(e.target.tagName));(0,L.bx)({keyBindings:{win:[B.VD.TAB,B.VD.TAB+B.N9.SHIFT],mac:[B.VD.TAB,B.VD.TAB+B.N9.SHIFT]},shouldPreventDefault:!0,handler:s,when:o},i.current)}(er,ei,eE);let eZ=(0,n.G)(y.rO),{ratio:eG,displaySize:ez,onRatioChange:eY,orientation:eH}=(0,P.Lg)({presetCache:!ea&&en&&!eZ.templateIdFromUrl&&!eZ.isInSdkIframe,presetUrlScenario:!ea&&en,store:er,canvasManager:ei,isEmpty:em,canvasConfig:eb,widgetContainerRef:ej,canvasRatio:ec,selectedScenario:eZ.scenarioFromUrl,defaultRatio:{value:null==eg?void 0:null===(t=eg.draft_info)||void 0===t?void 0:t.canvas_config.ratio,width:null!==(J=null==eg?void 0:null===(s=eg.draft_info)||void 0===s?void 0:s.canvas_config.width)&&void 0!==J?J:-1,height:null!==($=null==eg?void 0:null===(o=eg.draft_info)||void 0===o?void 0:o.canvas_config.height)&&void 0!==$?$:-1}}),eK=(0,U.u)(eI),eW=em&&!ea&&!eK,{firstFrameSize:eq}=(0,V.L)({firstFrameInfo:eg});(0,u.useEffect)(()=>{eg&&!ed.isVEPlayerLoaded&&(eL(!0),eC(),eV(!1))},[ed.isVEPlayerLoaded,eg]);let eX=(0,Z.l)(ei);(0,u.useEffect)(()=>{let e;return eX&&(eC(),e=setTimeout(()=>{var e;eL(!1),null===(e=document.getElementById("ssr-root"))||void 0===e||e.remove()},200)),()=>{clearTimeout(e)}},[eX,eL]);let{isShowTiktok:eQ,canShowTiktok:eJ,hideTiktok:e$,showTiktok:e0}=(0,G.s)({isCanvasEmpty:em,isTemplate:ea,ratio:eG}),{exitFullscreen:e5}=(0,A.O)({store:er,canvasManager:ei,isTemplate:ea});(0,f.d)({onHidden:()=>{ei.modules.playerController.pause()}});let e8=(0,c.default)(()=>{var e;return null===(e=ej.current)||void 0===e?void 0:e.getBoundingClientRect()}),{canvasResizeReady:e1,resizeScale:e2,userTranslate:e4,canvasSize:e6,onUserScaleChange:e3,updateUserTranslate:e9}=(0,D.FL)({store:er,canvasManager:ei,isDragMode:ep,canvasBoxRef:eE,playerContentRef:eN,displaySize:ez,useFirstFrame:eO,firstFrameSize:eq,orientation:eH});(0,u.useEffect)(()=>{e1&&(null==es||es())},[e1,es]),(0,D.Hp)({store:er,refEl:eN,userScale:eM,onUserScaleChange:e3});let e7=(0,D.Nc)({store:er,userScale:eM,onUserScaleChange:e3,playerContentRef:eN,updateUserTranslate:e9});(0,u.useEffect)(()=>{ex&&(e7(),er.actionNeedZoomToFitSet(!1))},[ex,e7]),(0,u.useEffect)(()=>{ep?eN.current.style.cursor="grab":eN.current.style.cursor=""},[ep]),(0,D.C2)({store:er,playerContentRef:eN,userScale:eM,userTranslate:e4,updateUserTranslate:e9,isTemplate:ea});let{isBoxSelecting:te}=(0,z.x)({store:er,canvasManager:ei,enable:!em&&!e_&&!ep&&!ea&&!ev&&!eu.subDraftId,canvasResizeScale:e2,playerDom:eA.current,canvasDom:ej.current}),{currentSegmentVideo:tt,maskWidgetContainerVisible:ti}=(0,Y.H)(ei,eS,e_),tr=e_&&!!eS;(0,u.useEffect)(()=>{if(er.actionCanvasSpaceRefSet(eE.current),!!eE.current)ei.modules.playerController.activeDefaultPlayer(),ei.modules.playerController.setFullscreenContainer(eE.current)},[eE.current]);let tn=null!==ei.modules.selectionManager.segmentMutable,{contextMenu:ta,isContextMenuVisible:ts,showContextMenu:to,hideContextMenu:tl}=(0,K.a)(ei),td=(0,u.useCallback)(async e=>{await eY(e),ei.setCanvasRatio(),(0,_.W)(el,{scale:e})},[eY,el]);return(0,H.K)(ej,ei,er,ea),(0,n.G)(M.J),(0,r.jsxs)(g.Z,{ref:eA,className:O()(W.Z.player,{[W.Z.isEmptyCanvas]:eW,[W.Z.isEmptyCanvas__original]:eW&&eG.value===w.rxY.CanvasRatioOriginal}),...eo,children:[eW&&(0,r.jsx)(b.Z,{isNew:en,ref:eB,display:{width:ez[0]*e2,height:ez[1]*e2},playerContentRef:eN,isDragging:ew,ratio:eG}),(0,r.jsx)(g.Z.Content,{id:"player-content",onMouseDown:()=>{!ep&&(ev&&e_?ei.modules.playerController.pause():(ei.modules.selectionManager.reset(),eF.actionMutableTextSelectionRangeSet(eS,0,0)))},ref:eN,children:(0,r.jsx)("div",{className:W.Z.canvasSpace,children:(0,r.jsxs)("div",{ref:eE,style:{visibility:e1?"visible":"hidden"},tabIndex:-1,className:O()(W.Z.canvasWrapper,{[W.Z.dragActive]:ew,[W.Z.fullscreen]:ef}),children:[(0,r.jsx)(k.Z,{visible:eO&&!eW,src:null!==(et=null!==(ee=null==eg?void 0:null===(l=eg.image)||void 0===l?void 0:l.preview_url_webp_480p_image_data)&&void 0!==ee?ee:null==eg?void 0:null===(d=eg.image)||void 0===d?void 0:d.preview_url_webp_480p)&&void 0!==et?et:null==eg?void 0:null===(j=eg.image)||void 0===j?void 0:j.preview_url_480p,width:(null==eq?void 0:eq[0])*e2,height:(null==eq?void 0:eq[1])*e2}),eJ&&eQ&&(0,r.jsx)(S.Z,{src:"tiktok"===ey.previewCover?i(673291):i(542132),className:W.Z.tiktokPreviewMask,width:ez[0]*e2,height:ez[1]*e2,wrapperStyle:{width:`${e6[0]}px`,height:`${e6[1]}px`}}),(0,r.jsx)(m.Z,{trigger:"contextMenu",position:"bl",droplist:tn||eD?null:ta,popupVisible:ts,triggerProps:{duration:{exit:0,enter:200,appear:200}},children:(0,r.jsxs)("div",{id:"canvas-cover",className:W.Z.canvasCover,style:{width:`${ez[0]*e2}px`,height:`${ez[1]*e2}px`},ref:ej,onContextMenu:to,onKeyDown:tl,tabIndex:-1,children:[eK,(0,r.jsx)(q.Z,{}),(0,r.jsx)(R.Z,{playerRef:eA,canvasCoverRef:ej,resizeScale:e2,getWrapperSize:e8,disabled:ef||ev&&!er.fixedRectangle||ek||tr||eh,isBoxSelecting:te,displaySize:ez,isTemplate:ea}),tt&&ti?(0,r.jsx)(a.Xf,{fallback:null,children:(0,r.jsx)(X,{segment:tt,displaySize:ez,resizeScale:e2})}):null,(0,r.jsx)(a.Xf,{fallback:null,children:(0,r.jsx)(Q,{scale:e2,displaySize:ez})})]},"canvas-cover")}),(0,r.jsx)(I.Z,{}),ef&&(0,r.jsx)(x.Z,{disabled:eU,cancelFullscreen:e5})]})})}),(0,r.jsx)(g.Z.Footer,{className:O()({[W.Z.disabled]:eU,[W.Z.footerHidden]:ea}),children:!eT&&!eD&&(0,r.jsxs)("div",{className:W.Z.tools,ref:eP,children:[!ea&&(0,r.jsx)(p.ZP,{ratio:eG,disabled:!eR,onRatioChange:td,dropdownMenuClassName:W.Z.playerRatioSelect}),eJ&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(h.Z,{mini:!0,position:"bottom",content:eQ?E.ZP.t("close_web_preview",{},"Close preview"):E.ZP.t("tt_web_preview",{},"TikTok preview"),children:(0,r.jsx)("span",{className:O()(W.Z.btn,W.Z.btnTiktok,{[W.Z.active]:eQ,[W.Z.disabled]:em}),onClick:()=>{if(!eU)eQ?(e$(),(0,v.d)(el,{action:v.G.Off})):(e0(),(0,v.d)(el,{action:v.G.On}))},children:(0,r.jsx)(N.Zwp,{})})})})]})})]})}));var $=i("479177"),ee=i("590241"),et=i("79006"),ei=i("732275"),er=i("346794"),en=i("362076");let ea=(0,d.f3)("store","canvasManager")((0,d.Pi)(e=>{let{canvasManager:t,isNewEditPage:i,isTemplate:d,store:c}=e,{videoPreviewLoaded:h,isPlaying:g}=c,[m]=(0,o.Fg)(),p=(0,n.G)(s.i),f=(0,u.useMemo)(()=>p.createXgPresetVideoPlayer.bind(p),[p]),{templateIdFromUrl:_}=(0,n.G)(y.rO),{ready:v,showTemplateVideo:M,coverUrl:S,videoUrl:w,mute:T,shouldWaitEditorReady:b,handlePlayerResizeReady:k,handlePreviewPlayerError:x}=(0,et.a)({canvasManager:t,canvasStore:c,templateIdFromUrl:_,isTemplate:d,isNew:i}),{isNewEmpty:I}=(0,ei.k)(t);return((0,er.X)(t,g),(0,u.useEffect)(()=>{!g&&t.modules.playerController.play()},[]),I)?(0,r.jsx)("div",{className:en.Z.playerContainer,children:(0,r.jsx)($.r,{isDark:"dark"===m})}):v?(0,r.jsxs)("div",{className:en.Z.playerContainer,children:[(M||b)&&(0,r.jsx)(a.Xf,{children:(0,r.jsx)(ee.Z,{isTemplate:d,isNewEditPage:i,shouldDisplayError:!0,videoUrl:w,mute:T,createPresetVideoPlayer:f,onError:x,fixPosition:!M&&b})}),!M&&(0,r.jsx)(J,{tabIndex:-1,isTemplate:d,isNewEditPage:i,onPlayerResizeReady:k,coverUrl:S}),(0,r.jsx)(l.Z,{shouldShowVideoPreviewLoading:M&&!h||!M&&b,shouldShowPlayerLoading:!M})]}):null}));var es=i("105166");let eo=(0,d.f3)("store","canvasManager")((0,d.Pi)(e=>{let{canvasManager:t,options:i}=e;return(0,es.K)(t)?(0,r.jsx)(ea,{...i}):(0,r.jsx)(l.Z,{shouldShowVideoPreviewLoading:!0,shouldShowPlayerLoading:!0})}));class el{constructor(e,t){this._context=e,this._options=t,this.render=()=>(0,r.jsx)(n.$,{instantiationService:this._context.containerService,children:(0,r.jsx)(d.zt,{store:this._context.canvasStore,canvasManager:this._context.canvasManager,children:(0,r.jsx)(eo,{options:this._options})})})}}},755922:function(e,t,i){i.d(t,{r:function(){return n}});var r=i(218571);function n(e){return(0,r.useMemo)(()=>{let{uploadManager:t}=e.modules;return t.thirdpartyLogin.bind(t)},[e.modules.uploadManager])}},285322:function(e,t,i){i.d(t,{i:function(){return n}});var r=i(563431);let n=(e,t)=>{if(!!t)for(let i=e.length-1;i>=0;i-=1){let n=e[i],{subRects:a}=n,s=a.findLast(e=>(0,r.S5)(e,t));if(s)return[s.id,n.id];if((0,r.S5)(n,t))return[n.id]}}},663570:function(e,t,i){i.d(t,{Z:function(){return l}});var r=i(772322),n=i(544633),a=i(670933),s=i(218571),o=i(40760);let l=(0,a.f3)("store","canvasManager")((0,a.Pi)(e=>{let{rect:t,dataSet:i,scale:a,canvasManager:l,store:d}=e,{currentFaceId:u,faceInfoList:c,selectedSingleSegmentId:h}=d,{selectionManager:g}=l.modules,m=(0,s.useMemo)(()=>{if(h){var e;return null!==(e=l.dataSDK.draftView.getSegmentById(h))&&void 0!==e?e:null}return null},[h]),p=(0,n.default)(e=>{g.selectFaceId(e)}),f=(0,n.default)(()=>l.renderManager.refreshCurrentFrame()),_=(0,n.default)(e=>l.dataSDK.api.video.setFigureFaceId(e));return m&&null!=u&&c.length&&t.id===h?(0,r.jsx)(r.Fragment,{children:c.map(e=>(0,r.jsx)(o.Z,{faceInfo:e,rect:t,scale:a,currentFaceId:u,segment:m,setFaceId:p,refreshCurrentFrame:f,setFigureFaceId:_,dataSet:i},e.id))}):null}))},296856:function(e,t,i){i.d(t,{h:function(){return c}});var r=i(544633),n=i(218571),a=i(896413),s=i(591010),o=i(937802),l=i(800793),d=i(271368),u=i(157604);function c(e){let{isVideoSegment:t,isMultiWidget:i,canvasConfig:c,displaySize:h,ifWidgetShortcutCanMove:g,widgetActive:m,handleWidgetTranslate:p,handleWidgetTranslateEnd:f,handleWidgetTranslateStart:_}=e,v=(0,o.G)(a.a),y=(0,n.useRef)(0),M=(0,n.useRef)(0),S=(0,n.useRef)(!1),w=(0,n.useRef)({ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1}),T=(0,n.useRef)(),b=(0,n.useMemo)(()=>g&&m,[g,m]),k=(0,r.default)(()=>{let{actionType:e,selectSource:t}=v.selection;return e!==s.U.AddSegment&&t===s.k.Timeline}),x=(0,r.default)(e=>{let t=S.current?10:1;if(!c)return t;let i=h[0]/c.width,r=h[1]/c.height;return"x"===e?t*i:t*r}),I=(0,r.default)(()=>{let e=k();return b&&!e}),R=(0,r.default)(()=>{w.current.ArrowUp=!0,0===y.current&&0===M.current&&_(),M.current-=x("y"),p({x:y.current,y:M.current})}),C=(0,r.default)(()=>{w.current.ArrowDown=!0,0===y.current&&0===M.current&&_(),M.current+=x("y"),p({x:y.current,y:M.current})}),D=(0,r.default)(()=>{w.current.ArrowLeft=!0,0===y.current&&0===M.current&&_(),y.current-=x("x"),p({x:y.current,y:M.current})}),A=(0,r.default)(()=>{w.current.ArrowRight=!0,0===y.current&&0===M.current&&_(),y.current+=x("x"),p({x:y.current,y:M.current})});function P(e){S.current=e.shiftKey}function E(e){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.code)&&(w.current[e.code]=!1,T.current=e.code),(y.current||M.current)&&!e.shiftKey&&Object.values(w.current).every(e=>!e)&&(y.current=0,M.current=0,f({shortcutValue:function(){if("ArrowUp"===T.current)return S.current?u.hi.MoveUp10Px:u.hi.MoveUp1Px;if("ArrowDown"===T.current)return S.current?u.hi.MoveDown10Px:u.hi.MoveDown1Px;if("ArrowLeft"===T.current)return S.current?u.hi.MoveLeft10Px:u.hi.MoveLeft1Px;else if("ArrowRight"===T.current)return S.current?u.hi.MoveRight10Px:u.hi.MoveRight1Px;return u.hi.Default}()})),S.current=e.shiftKey}let{registerConfig:N,unRegisterConfig:j}=(0,l.iC)({keyBindings:{win:[d.VD.ARROW_UP],mac:[d.VD.ARROW_UP]},when:I,handler:R},document.body),{registerConfig:O,unRegisterConfig:L}=(0,l.iC)({keyBindings:{win:[d.VD.ARROW_DOWN],mac:[d.VD.ARROW_DOWN]},when:I,handler:C},document.body),{registerConfig:B,unRegisterConfig:F}=(0,l.iC)({keyBindings:{win:[d.VD.ARROW_LEFT],mac:[d.VD.ARROW_LEFT]},when:I,handler:D},document.body),{registerConfig:U,unRegisterConfig:V}=(0,l.iC)({keyBindings:{win:[d.VD.ARROW_RIGHT],mac:[d.VD.ARROW_RIGHT]},when:I,handler:A},document.body),{registerConfig:Z,unRegisterConfig:G}=(0,l.iC)({keyBindings:{win:[d.N9.SHIFT+d.VD.ARROW_UP],mac:[d.N9.SHIFT+d.VD.ARROW_UP]},when:I,handler:R},document.body),{registerConfig:z,unRegisterConfig:Y}=(0,l.iC)({keyBindings:{win:[d.N9.SHIFT+d.VD.ARROW_DOWN],mac:[d.N9.SHIFT+d.VD.ARROW_DOWN]},when:I,handler:C},document.body),{registerConfig:H,unRegisterConfig:K}=(0,l.iC)({keyBindings:{win:[d.N9.SHIFT+d.VD.ARROW_LEFT],mac:[d.N9.SHIFT+d.VD.ARROW_LEFT]},when:I,handler:D},document.body),{registerConfig:W,unRegisterConfig:q}=(0,l.iC)({keyBindings:{win:[d.N9.SHIFT+d.VD.ARROW_RIGHT],mac:[d.N9.SHIFT+d.VD.ARROW_RIGHT]},when:I,handler:A},document.body);(0,n.useEffect)(()=>(b&&(N(),O(),B(),U(),Z(),z(),H(),W(),window.addEventListener("keydown",P),window.addEventListener("keyup",E)),()=>{j(),L(),F(),V(),G(),Y(),K(),q(),window.removeEventListener("keydown",P),window.removeEventListener("keyup",E)}),[b])}},334825:function(e,t,i){i.d(t,{y:function(){return c}});var r=i(218571),n=i(426336),a=i(937802),s=i(896413),o=i(425427),l=i(599639),d=i(142290);let u=(e,t)=>{var i;let{draftId:r,subDraftId:n,subDraftSegmentId:a}=e.modules.selectionManager;return null!==(i=t===a?r:n)&&void 0!==i?i:void 0},c=(e,t)=>{let i=(0,a.G)(s.a),c=i.richTextEditorManager.getEditorUtil(),h=(0,a.G)(o.rO),g=(0,a.G)(l.m),m=(0,o.JY)(h)||i.segmentSelection.subDraftId,p=function(t,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[{...i,segmentId:t}];if(r){let r=e.draftView.getSegmentById(t);r&&(0,d.gU)(r,g,h)&&(n=(0,d.Me)(r,e).map(e=>({...i,segmentId:e.id})))}return n},f=(0,r.useCallback)(function(i){let{shouldRefresh:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{id:a,scaleX:s,scaleY:o,translateX:l,translateY:d}=i,c=u(t,a),h=e.draftView.getSegmentById(a),g=1,f=1;h&&(0,n.hey)(h)&&(g=2,f=-2),e.api.segment.updateLayout(p(a,{draftId:c,layout:{translateX:void 0!==l?l*g:l,translateY:void 0!==d?d*f:d,scaleX:s,scaleY:o},isKeyframe:!m},r&&!c))},[m]),_=(0,r.useCallback)(async(i,r)=>{let{shouldRefresh:a=!1}=r,{id:s,fixedWidth:o,translateX:l,translateY:d}=i,h=u(t,s);a?(e.api.segment.translate(p(s,{draftId:h,x:l,y:d,isKeyframe:!m},!h)),await c.textUpdateMaterial({segId:s,textMaterial:{fixedWidth:o},modifyFlags:[n.XHM.ModifyFixedWidth],isKeyframe:!m,draftId:h},{throttle:!0})):e.api.text.setFixedSize({draftId:h,segmentId:s,fixedWidth:o,x:l,y:d,isKeyframe:a})},[m]),v=(0,r.useCallback)(function(i){let{shouldRefresh:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{id:a,translateX:s,translateY:o}=i,l=u(t,a),d=e.draftView.getSegmentById(a),c=1,h=1;d&&(0,n.hey)(d)&&(c=2,h=-2),e.api.segment.translate(p(a,{draftId:l,x:s*c,y:o*h,isKeyframe:!m},r&&!l))},[m]);return{onWidgetDragPoint:f,onWidgetDrag:v,onWidgetRotate:(0,r.useCallback)(function(i){let{shouldRefresh:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{id:n,rotate:a}=i,s=u(t,n);e.api.segment.rotate(p(n,{draftId:s,rotation:a,isKeyframe:!m},r&&!s))},[m]),onWidgetDragSide:_}}},979627:function(e,t,i){i.d(t,{U:function(){return r}});let r="[screenshot-manager] "},718494:function(e,t,i){i.d(t,{h:function(){return n}});var r,n=((r={})[r.Pending=0]="Pending",r[r.Running=1]="Running",r[r.Completed=2]="Completed",r[r.Failed=3]="Failed",r)},431650:function(e,t,i){i.d(t,{$:function(){return r}});class r{static from(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.timeRange;return{recordable:e,timeRanges:[t]}}static is(e){return e instanceof r}constructor(e,t){this.recordable=e,this.timeRanges=t}}},753809:function(e,t,i){i.d(t,{Bd:function(){return n},HX:function(){return h},I:function(){return r},I0:function(){return p},PU:function(){return l},Rw:function(){return s},a8:function(){return o},aO:function(){return m},ky:function(){return d},mi:function(){return u},rH:function(){return a},rv:function(){return c},vk:function(){return g}});let r={path:"/integration/audio/empty.mp3"},n="6776502040345448973",a="__REALTIME_DENOISE__",s={panel:"integration",resourceId:n,effectId:"485795",md5:"b07e8afaad96368f7a5056a9dc3ab1f2",url:new URL(i(984337),i.b).href,en:{url:new URL(i(182982),i.b).href},ja:{url:new URL(i(816762),i.b).href},ko:{url:new URL(i(500492),i.b).href},th:{url:new URL(i(172053),i.b).href},"zh-hans":{url:new URL(i(882398),i.b).href},"zh-hant":{url:new URL(i(517295),i.b).href},minorityLang:{url:new URL(i(140059),i.b).href}},o={url:new URL(i(984321),i.b).href,path:"/ai_matting/algorithmConfig.json"},l={url:new URL(i(307926),i.b).href,filename:"NotoColorEmoji-git.ttf",fontFamily:"NotoColorEmoji"},d={url:new URL(i(980329),i.b).href,path:"/editor/mattingBlend"},u={url:new URL(i(322568),i.b).href,path:"/editor/areaLocked"},c={url:new URL(i(491466),i.b).href,path:"/integration/audio/rnnoise/rnnoise_v2.0.model",dir:"/integration/audio"},h={url:new URL(i(848094),i.b).href,path:"/integration/audio/snr/audio_metrics_v1.4.model",dir:"/integration/audio"},g={url:"https://sf16-web-buz.capcut.com/obj/capcut-web-buz-us/adjustment-preset.png",path:"/integration/preset/adjutment/background",dir:"/integration/preset"},m={name:"makeup-root",resourceId:"7280056145232794113",resourceIdOnHeycan:"7406275420099824901",md5:"0196e5c1dc9d5498f4fa44dd090c49dd",url:new URL(i(994800),i.b).href,path:"/editor/effect/0196e5c1dc9d5498f4fa44dd090c49dd",dir:"/editor/effect"},p={name:"makeup-root",resourceId:"7406275420099824901",md5:"0196e5c1dc9d5498f4fa44dd090c49dd",url:new URL(i(994800),i.b).href,path:"/editor/effect/0196e5c1dc9d5498f4fa44dd090c49dd",dir:"/editor/effect"}},189577:function(e,t,i){i.d(t,{P:()=>Q});var r=i("789786"),n=i("827322"),a=i("314882"),s=i("753809"),o=i("565508"),l=i("838771"),d=i("475590"),u=i("402655"),c=i("690613"),h=i("849002"),g=i("800788"),m=i("426336"),p=i("811750"),f=i("144144"),_=i("798184"),v=i("315201"),y=i("420072"),M=i("731992"),S=i("433140"),w=i("235297"),T=i("627084"),b=i("230689"),k=i("744268"),x=i("596112"),I=i("127830"),R=i("234075"),C=i.n(R),D=i("108692"),A=i("425427"),P=i("782153"),E=i("289732"),N=i("208118"),j=i("513619"),O=i("292406"),L=i("614022"),B=i("989719");let F=new Uint8Array([73,68,51,4,0,0,0,0,0,124,84,88,88,88,0,0,0,18,0,0,3,109,97,106,111,114,95,98,114,97,110,100,0,113,116,32,32,0,84,88,88,88,0,0,0,17,0,0,3,109,105,110,111,114,95,118,101,114,115,105,111,110,0,48,0,84,88,88,88,0,0,0,24,0,0,3,99,111,109,112,97,116,105,98,108,101,95,98,114,97,110,100,115,0,113,116,32,32,0,84,83,83,69,0,0,0,15,0,0,3,76,97,118,102,53,57,46,50,55,46,49,48,48,0,0,0,0,0,0,0,0,0,0,0,255,251,80,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,73,110,102,111,0,0,0,15,0,0,0,3,0,0,5,181,0,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,109,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,76,97,118,99,53,57,46,51,55,0,0,0,0,0,0,0,0,0,0,0,0,36,3,128,0,0,0,0,0,0,5,181,89,74,176,250,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,251,144,100,0,15,240,0,0,105,0,0,0,8,0,0,13,32,0,0,1,0,0,1,164,0,0,0,32,0,0,52,128,0,0,4,76,65,77,69,51,46,49,48,48,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,76,65,77,69,51,46,49,48,48,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,255,251,146,100,64,143,240,0,0,105,0,0,0,8,0,0,13,32,0,0,1,0,0,1,164,0,0,0,32,0,0,52,128,0,0,4,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,76,65,77,69,51,46,49,48,48,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,255,251,146,100,64,143,240,0,0,105,0,0,0,8,0,0,13,32,0,0,1,0,0,1,164,0,0,0,32,0,0,52,128,0,0,4,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85]);var U=i("919111"),V=i("396974"),Z=i("461571"),G=i("4731"),z=i("780910"),Y=i("968172"),H=i("217131"),K=i("276711"),W=i("937567"),q=i(966465).Buffer;let X=/^.*?\/(.*)_v[0-9].*?.model/;class Q extends u.JT{_mark(e){this._videoEnvironmentService.isDebug&&performance.mark(`[EnsureManager]${e}`)}get progressiveLoadingStore(){return this._progressiveLoadingStore}get failedResourceMap(){return this._failedResourceMap}getFSPathFromDraftPath(e){return this._draftPathFSPathRecord[e]?this._draftPathFSPathRecord[e]:null}enableWriteToFS(e){this._renderManager=e,!this._fsRenderManagerBarrier.isOpen()&&this._fsRenderManagerBarrier.open()}enableCompleteWrite(e){this._renderManager=e,this.enableWriteToFS(e),!this._completeRenderManagerBarrier.isOpen()&&this._completeRenderManagerBarrier.open()}ensureDefaultResources(){(0,f.Ie)(W.ENSURE_DEFAULT_AUDIO);let e=this._ensureDefaultAudio();e.then(()=>{(0,f.oe)(W.ENSURE_DEFAULT_AUDIO)}),(0,f.Ie)(W.ENSURE_DEFAULT_AUDIO_DENOISE_MODEL);let t=this._ensureAudioDenoiseModel();t.then(()=>{(0,f.oe)(W.ENSURE_DEFAULT_AUDIO_DENOISE_MODEL)}),(0,f.Ie)(W.ENSURE_DEFAULT_SPRITE);let i=this._ensureDefaultSprite();i.then(()=>{(0,f.oe)(W.ENSURE_DEFAULT_SPRITE)});let r=this._ensureAudioMetricsModel();return{pEnsureAudioDenoiseModel:t,pEnsureDefaultAudio:e,pEnsureDefaultSprite:i,pEnsureAudioMetricsModel:r,pEnsurePresetAdjustment:this._ensurePresetAdjustment()}}ensureDefaultFontResources(){return Promise.all([this._ensureDefaultFontForEnglish(),this._ensureDefaultFontForOtherLanguages()])}async ensurePostRenderDefaultResources(){await this.ensureFontForMinorityLanguages()}ensureAttachments(e){let t=m.lLh.getInstance(),i=new m.BjE,r=[];m.gyO.forEach(e=>{try{if(t.get(e))return;let n=i.createAttachmentControl(e);r.push({name:e,attachment:n})}catch{}}),e[p.ij]&&this._mainDraftService.offlineSaveManager.onSyncComplete(()=>{this._mainDraftService.dataSdk.recoveryAttachmentAsyncTask(m.HHr.parse(e[p.ij]))}),e[p.di]&&this._mainDraftService.offlineSaveManager.onSyncComplete(()=>{this._mainDraftService.dataSdk.recoveryAttachmentVideoAlgorithms(m.HHr.parse(e[p.di]))}),e[p.fQ]&&this._mainDraftService.offlineSaveManager.onSyncComplete(()=>{this._mainDraftService.dataSdk.recoveryAttachmentAiWriter(m.HHr.parse(e[p.fQ]))}),e[p.uJ]&&this._mainDraftService.offlineSaveManager.onSyncComplete(()=>{this._mainDraftService.dataSdk.recoveryAttachmentAiStory(m.HHr.parse(e[p.uJ]))}),t.register(r)}ensureEmoji(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!this._emojiPromise&&(this._emojiPromise=this._ensureEmojiFontResource(e)),this._emojiPromise}async ensureBuiltInModules(e){let t=[];e.hasObjectLocked&&t.push((0,N.X)(()=>this._ensureAndUnzipResource(s.mi.path,s.mi.url),{numTry:3})),e.hasMattingBlend&&t.push((0,N.X)(()=>this._ensureAndUnzipResource("/editor",s.ky.url),{numTry:3})),e.hasMakeup&&t.push(this.ensureMakeupRoot()),e.hasMattingStroke&&t.push(this._ensureAiMattingAlgorithmConfigFile()),await Promise.all(t)}ensureMakeupRoot(){return(0,N.X)(()=>this._ensureAndUnzipResource(s.aO.path,s.aO.url),{numTry:3})}getRenderManager(){return(0,g.ZB)(this._renderManager),this._renderManager}async writeToFS(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait(),i?await this.getRenderManager().fs.unzipToPath({src:(0,n.C)(t,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),destPath:e}):this.getRenderManager().fs.writeFileSync(e,t),console.log("[ensure] resource write to file ",e,i)}ensureMaterial(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{draftPathStrategy:r,overrideSupportStream:n,keepFsPathEqualToDraftPath:a,metaTimeout:s,isFirstFrameStreamMaterial:o,needOrder:l,isZippedUserFile:d,shouldDownloadOriginalMaterial:u,shouldPreloadStreamAsset:c,useMaskVideo:h}=i;return this.ensureResource({needUnzip:!1,resourceCategory:E.s.MATERIAL,pathInDraft:t,onSuccess:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.info("[ensure] ensure material success",t)},onError:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.error("[ensure] ensure material error",t)},material:e,draftPathStrategy:r,overrideSupportStream:n,keepFsPathEqualToDraftPath:a,metaTimeout:s,isFirstFrameStreamMaterial:o,needOrder:l,isZippedUserFile:d,shouldDownloadOriginalMaterial:u,shouldPreloadStreamAsset:c,useMaskVideo:h})}getEffectPathMap(){return this._effectPathMap}getMaterialPathMap(){return this._materialPathMap}getEffectPathForEnsuredEffect(e){return(0,g.Y2)(this._effectPathMap[e],"you should ensure the effect before getting its path"),this._effectPathMap[e]}ensureEffect(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{needUnzip:r=!0,dependentResourcePathMap:n,disableAutoEnsureResourceValue:a,shouldPreload:s}=i,o=r&&![I._g.VideoBackground,I._g.CurveSpeed].includes(e.resource.type),l=this.ensureResource({needUnzip:o,resourceCategory:E.s.EFFECT,pathInDraft:t,onSuccess:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.info("[ensure] ensure effect success",t)},onError:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.error("[ensure] ensure effect error",t)},material:e,disableAutoEnsureResourceValue:a,shouldPreload:s}),d=()=>l.waitForResourceMetaReady().then(()=>this.ensureEffectDependentResource(e,n)),u=a?null:d();return{waitForResourceMetaReady:()=>l.waitForResourceMetaReady(),waitForResourceValueReady:async()=>(!u&&(u=d()),Promise.all([l.waitForResourceValueReady(),...await u]))}}ensureCoverUrl(e){let t=`${(0,o.do)(e.value)}_cover_drag`,i=()=>(0,c.oW)(t),r=()=>(0,c.wf)(-1,""),n=(async()=>{try{let r=e.getCoverResourceToken();await (0,_.x)(r);return await this.warmupFileResource(r.value.key,r,t,t,void 0,!1),i()}catch(e){return r()}})();return{waitForResourceValueReady:()=>n}}async ensureEffectDependentResource(e,t){var i;let r=[],n=await this.getFullResource(e.key,e.resource),a=n.value,s=null!==(i=null==a?void 0:a.modelNames)&&void 0!==i?i:[];for(let e of s)r.push(this.ensureModel(e).then(e=>e.waitForResourceValueReady()));if(console.log("[ensure] ensured base model names",s),Array.isArray(null==a?void 0:a.requirements)&&a.requirements.length>0){let e=null==a?void 0:a.requirements;!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait();let t=this.getRenderManager().peekEffectResource(e),i=(0,j.Z)(t.map(e=>{var t;return null===(t=X.exec(e))||void 0===t?void 0:t[1]}));for(let e of i)r.push(this.ensureModel(e).then(e=>e.waitForResourceValueReady()));console.log("[ensure] ensured base model names",i)}return[I._g.TextTemplate,I._g.SubtitleTemplate].includes(e.resource.type)&&t&&r.push(this.ensureTextTemplateDependentResources(n,t)),r}async ensureTextTemplateDependentResources(e,t){let i=e.dependencyResources.map(e=>{console.log("[dependent] start",e.key,e.type);let i=t[e.key];if(!i)return console.warn(`[ensure] cannot find a path for ${e.key}`),!0;e.type===I._g.Font&&C().extname(i)&&(i=C().dirname(i));let r=this.ensureEffect({key:`${e.type}_${e.key}`,resource:{key:`${e.type}_${e.key}`,type:e.type,resourceId:e.key}},i);return r.waitForResourceValueReady()}),r=await Promise.all(i);return(0,O.Z)(r)}getFullResourceSync(e,t){let i=t.type;this._resourceService.add(e,t);let r=this._resourceService.get(e,i);return(0,v.R)(r.value)?r:null}async getFullResource(e,t){let i=t.type;console.log("[ensure] get resource value for",e,i),this._resourceService.add(e,t);let r=this._resourceService.get(e,i);return await (0,y.Z)(r),r}createEnsureResourceUniqueKey(e,t,i){return`${e}-${t}-${null!=i?i:""}`}_recordResource(e,t,i,r,n){this._draftPathStore.recordDraftPathToResourceKey(t,e),this._draftPathFSPathRecord[t]=i,this.getRenderManager().recordResource({segmentPath:t,resPath:i,decryptKey:r}),n&&this.getRenderManager().recordResource({segmentPath:i,resPath:i,decryptKey:r})}async warmupMultiFilesResource(e,t,i,r,n,a){let s=await (0,_.x)(t.getContentResourceToken());if(!s.ok)throw Error(s.msg);let{value:o}=s,l=await o.files(),d=m.P4R.ensureRootPath(r);this._recordResource(e,i,d,n,a),this.getRenderManager().fs.mkdirSync(d,{recursive:!0});try{for(let[t,r]of Object.entries(l))if(r.isDirectory)this.getRenderManager().fs.mkdirSync(C().join(d,t),{recursive:!0});else{let s=C().join(i,t),o=C().join(d,t);this.getRenderManager().fs.writeFileSync(o,r.arrayBuffer,{recursive:!0}),this._recordResource(e,s,o,n,a)}}catch(e){console.log("[ensure] failed to write file",e)}}async warmupZippedFileResource(e,t,i,r,n,a){let s=await (0,_.x)(t);if(!s.ok)throw Error(s.msg);let{value:o}=s,l=m.P4R.ensureRootPath(r);await this.writeToFS(r,o.buffer,!0),console.log("[ensure] warmup zipped file file",i,l,t),this._recordResource(e,i,l,n,a)}async warmupFileResource(e,t,i,r,n,a){let s=await (0,_.x)(t);if(!s.ok)throw Error(s.msg);let{value:o}=s,l=m.P4R.ensureRootPath(r);this.getRenderManager().fs.writeFileSync(l,o.buffer),console.log("[ensure] warmup single file",i,l,t),this._recordResource(e,i,l,n,a)}_preloadResourceValue(e,t){let i=this.getFullResourceSync(e,{type:t});if(i){let e=(0,G.fc)(t,i),r=this._videoPermissionService.getDraftPermission()===Z.O.readonly;e.startImmediately(r)}}async _getResourceValue(e,t,i,r,n){try{let a;let s=await this.getFullResource(e,{type:t});if(console.log("[ensure] resource ready for",e,t,s.value),i){let e=await (0,G.mE)(t,s);if(!e.ok)throw e;a=e.value}else a=r?(0,G.bf)(t,s):n?s.getMaskVideoResourceToken():(0,G.fc)(t,s);let o=this._videoPermissionService.getDraftPermission()===Z.O.readonly,l=await (0,_.x)(a,!0,!0,o);if(!l.ok)throw Error(l.msg);let{value:d}=l;return[d,a,s]}catch(i){throw console.log("[ensure] get resource error for",i,e,t),i}}ensureResource(e){let{pathInDraft:t,material:i,needUnzip:r,resourceCategory:n,draftPathStrategy:a=E.S.Default,overrideSupportStream:s,keepFsPathEqualToDraftPath:l,metaTimeout:u,isFirstFrameStreamMaterial:c,needOrder:h,disableAutoEnsureResourceValue:p,isZippedUserFile:f,shouldDownloadOriginalMaterial:_,shouldPreload:v,shouldPreloadStreamAsset:y,useMaskVideo:M}=e;this._mark(`EnsureResourceBegin:${i.key}`);let S=i.resource.type===I._g.Font||i.resource.type===I._g.TextPreset,w=this.createEnsureResourceUniqueKey(i.key,i.resource.type,M?t:"");return this._ensureTaskMap[w]?console.log("[ensure] reusing previous ensure task",t,i):(console.log("[ensure] create a new ensure task for",t,i),this._failedResourceMap.delete(w),this._ensureTaskMap[w]=(()=>{let T;this._ensureStartTimeMap[w]=performance.now();let b=()=>(this._mark(`EnsureResourceEnd:${i.key}`),this._ensureEndTimeMap[w]=p||h?-1:performance.now(),!0),k=e=>(console.error("[ensure] failed to ensure",i,e),this._ensureTaskMap[w]=null,this._failedResourceMap.set(w,{resourceType:i.resource.type,key:i.key}),this._ensureStartTimeMap[w]=void 0,this._ensureEndTimeMap[w]=void 0,this._ensureConditionMap[w]=void 0,!1);console.log("[ensure] ensuring resource for",i.resource),n!==E.s.EFFECT&&(0,g.ZB)(t,"Only effect path generation is supported now");let x=t,I=async n=>{try{let e;let a=n.value;if(this._mark(`EnsureResourceValueStart:${i.key}`),e=h?(0,z.FH)(n,s):(0,z.mj)(n,this._configurationService,!M&&s),console.log("[ensure] finalized pathInDraft",{pathInDraft:t,fullResourceMeta:a,isFirstFrameStreamMaterial:c,canStream:e,useMaskVideo:M}),e&&!c){console.log("[ensure] ensure stream",t,n);let{orderedStreamWarmer:i,streamWarmer:r,needToken:a}=e;this._ensureConditionMap[w]="stream";let s="";if(a){let[,e]=(await this._everCloudTokenDataService.getEvercloudToken()).pair();e&&(s=e.token)}if(!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait(),i){let e=await i(this.getRenderManager(),x,n);if(e.ok)return b();throw k(),e}if(r){let e=this._videoPermissionService.getDraftPermission();return r(this.getRenderManager(),x,T,n,{shouldDownloadOriginalMaterial:_,everCloudToken:e===Z.O.readonly?"":s,preloadBlockCount:y?this._videoEnvironmentService.preloadStreamBlockCount:void 0,useMaskVideo:M}),b()}}this._ensureConditionMap[w]="download";let[o,l,d]=await this._getResourceValue(i.key,i.resource.type,h,_,M);console.log("[ensure] resource loaded",i.resource.type,o,l,c),!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait(),this._mark(`WriteResourceValueBegin:${i.key}`);let u=this.getRenderManager().resourceRecords.pathRecords.safeGet(x);if(u&&this.getRenderManager().fs.isExist(u))return b();if(f?await this.warmupZippedFileResource(i.key,l,x,T,o.decryptKey,S):r?await this.warmupMultiFilesResource(i.key,d,x,T,o.decryptKey,S):await this.warmupFileResource(i.key,l,x,T,o.decryptKey,S),e&&c){!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait(),console.log("[ensure] ensure stream",t,n,c);let{streamWarmer:i,needToken:r}=e,a="";if(r){let[,e]=(await this._everCloudTokenDataService.getEvercloudToken()).pair();e&&(a=e.token)}if(i){let e=this._videoPermissionService.getDraftPermission();i(this.getRenderManager(),x,T,n,{everCloudToken:e===Z.O.readonly?"":a,preloadBlockCount:y?this._videoEnvironmentService.preloadStreamBlockCount:void 0,useMaskVideo:M})}}return this._mark(`WriteResourceValueEnd:${i.key}`),b()}catch(t){throw console.error("[ensure] ensure resource error",e,t),k(t),t}},R=(async()=>{try{this._mark(`EnsureResourceMetaStart:${i.key}`),this._resourceService.add(i.key,i.resource);let e=this.getFullResourceSync(i.key,i.resource);if(!e){let t,r;e=await ((0,L.Z)(u)&&u>=0?(t=()=>this.getFullResource(i.key,i.resource),r=u,(0,d.Hp)(t,r).then(e=>{if(e.ok)return e.value;throw console.log("[ensure] failed to get full resource within time limit",i,u),Error(`${e.code}-${e.msg}`)})):this.getFullResource(i.key,i.resource))}let r=(0,o.do)(e.value);if(a!==E.S.ForceGenerateNew&&x?a===E.S.ForceKeepOrigin&&((0,g.Y2)(t,"pathInDraft must exist when draftPathStrategy is ForceKeepOrigin"),x=t):x=r,l?((0,g.Y2)(t,"pathInDraft must exist when keepFsPathEqualToDraftPath is enabled"),(0,g.Y2)(a!==E.S.ForceGenerateNew,"draftPathStrategy can't equal to ForceGenerateNew when keepFsPathEqualToDraftPath is enabled"),T=m.P4R.ensureRootPath(t)):T=(0,o._r)(e.value),n===E.s.EFFECT){let t=e.value;this._effectPathMap[t.resourceId]=x}else t&&(this._materialPathMap[t]=x);return this._draftPathStore.recordResourceKeyToDraftPath(i.key,x),this._draftPathStore.recordDraftPathToResourceKey(x,i.key),this._draftPathFSPathRecord[x]=T,S&&(this._draftPathStore.recordDraftPathToResourceKey(T,i.key),this._draftPathFSPathRecord[T]=T),v&&this._preloadResourceValue(i.key,i.resource.type),this._mark(`EnsureResourceMetaEnd:${i.key}`),e}catch(e){throw k(e),e}})(),C=()=>R.then(async e=>{let t=setTimeout(()=>{console.warn("ensure resource longer than 1 minutes: ",e)},6e4),i=await I(e);return clearTimeout(t),i});p&&(this._ensureConditionMap[w]="progressive");let D=p?null:C();return{waitForResourceMetaReady:()=>R,waitForResourceValueReady:()=>(!D&&(D=C()),D)}})()),this._ensureTaskMap[w]}clearEnsureTask(e,t){let i=this.createEnsureResourceUniqueKey(e,t);this._ensureTaskMap[i]=null}async progressivelyEnsureEffects(e,t,i){try{!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait(),!this.progressiveResourceLoader&&(this.progressiveResourceLoader=new l.D(this._isTemplate,this,this.getRenderManager(),this._progressiveLoadingStore,this._containerService)),await this.progressiveResourceLoader.beginProgressivelyLoadResources(e,{effects:t},i),console.debug("[progressive] started progressively ensuring effects",t)}catch(e){console.debug("[progressive] progressively ensure effects error",e)}}async ensureBuiltInMaterial(e,t,i){var r,n;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{duplicatedPath:s}=a,o=`${t.startsWith("/")?"":"/"}${t}`,{key:l}=e.value,d=null!==(r=this._draftPathStore.getDraftPathFromResourceKey(i.builtIn.md5))&&void 0!==r?r:this._draftPathStore.getDraftPathFromResourceKey(l),u=null!=d?d:o;if(s){let e=`${s.startsWith("/")?"":"/"}${s}`,i=null!=d?d:e;this._materialPathMap[t]=i,this._materialPathMap[o]=i;return}if("template.json"===t)return;let c=".zip",h=t.endsWith(c),g=m.hPV.toAbsolutePath(u);h&&!d&&(u=C().join(C().dirname(u),C().basename(u,c)),g=C().join(C().dirname(g),C().basename(g,c)));let p=this._draftPathStore.getResourceKeyFromDraftPath(u);if(p){let{md5:e}=i.builtIn;p!==l&&-1===p.indexOf(e)&&(u=C().join(C().dirname(u),l+C().basename(u)),g=C().join(C().dirname(g),l+C().basename(g)))}this._draftPathStore.recordDraftPathToResourceKey(u,l),this._draftPathStore.recordResourceKeyToDraftPath(l,u),this._draftPathFSPathRecord[u]=g;let f=e=>h?e.slice(0,-c.length):e;if(this._materialPathMap[f(t)]=u,this._materialPathMap[f(o)]=u,d&&this.getRenderManager().resourceRecords.pathRecords.safeGet(d))return;if(this._ensureBuiltInTaskMap[l]){await this._ensureBuiltInTaskMap[l];return}let _=this.createEnsureResourceUniqueKey(i.builtIn.key,i.builtIn.mime_type||"");try{this._ensureStartTimeMap[_]=performance.now();let t=this._downloadBuiltInMaterial(i,u,g,h,e,null==i?void 0:null===(n=i.preloadMaterial)||void 0===n?void 0:n.is_first_frame_stream_material);this._ensureBuiltInTaskMap[l]=t;let r=await t;return this._ensureEndTimeMap[_]=performance.now(),r}catch(e){throw this._ensureStartTimeMap[_]=void 0,this._ensureEndTimeMap[_]=void 0,this._ensureConditionMap[_]=void 0,this._ensureBuiltInTaskMap[l]=null,e}}async _downloadBuiltInMaterial(e,t,i,r,n,a){let s;let o=this.createEnsureResourceUniqueKey(e.builtIn.key,e.builtIn.mime_type||""),l=(0,z.ln)(e,this._configurationService);if(l&&!a){this._ensureConditionMap[o]="stream",!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait(),(0,z.v)(l.type,this.getRenderManager(),t,i,e.builtIn);return}this._ensureConditionMap[o]="download",await (0,_.x)(n);let{buffer:d}=n.value;if("shouldAutoDecrypt"in n.value){let{shouldAutoDecrypt:e,decryptKey:t}=n.value;!e&&(s=t)}return await this.writeToFS(i,d,r),l&&a?(!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait(),(0,z.v)(l.type,this.getRenderManager(),t,i,e.builtIn)):this.getRenderManager().recordResource({segmentPath:t,resPath:i,decryptKey:s}),d}async ensureFolder(e){let t=m.P4R.ensureRootPath(e);!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait(),this.getRenderManager().recordResource({segmentPath:e,resPath:t})}getModelMap(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&(this._modelPromise=null),!this._modelPromise&&(this._modelPromise=(async()=>{try{let e=await this._teaAdapterService.getWebId(),t=await this._modelDataService.getModel({webId:e,veVersion:this._videoEnvironmentService.sdkVersion});if(!t.ok)throw this._modelPromise=null,Error(t.msg);let i=t.value.list.reduce((e,t)=>(e[t.name]=t,e),{});return console.log("[ensure] model map loaded",i),this._modelMap=i,i}catch(e){throw this._modelPromise=null,e}})()),this._modelPromise}async getWarmupResourceWithToken(e){let{material:t,overrideSupportStream:i}=e;this.createEnsureResourceUniqueKey(t.key,t.resource.type),this._resourceService.add(t.key,t.resource);let r=await this.getFullResource(t.key,{type:t.resource.type});if((0,z.mj)(r,this._configurationService,i))return console.log("[warmup-resource] material support stream, no need warmup",r),(0,c.wf)(-1,"resource no need warmup");let[n,a,s]=await this._getResourceValue(t.key,t.resource.type);return a.start(),(0,c.oW)(()=>{null==a||a.cancel()})}__unsafeGetModelPath(e){let t=this._modelMap[e];return t?m.hPV.genModelPath(e,t.md5):(console.warn(`model ${e} not found`),e)}async _ensureAndUnzipResource(e,t,i){let r=await a.wA.fetchWithCache(t,{perfName:i});try{!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait(),await this.getRenderManager().fs.unzipToPath({src:(0,n.C)(r,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),destPath:e})}catch(e){throw await a.wA.deleteCache(t,{ignoreSearch:!0}),e}}async ensureModel(e){let t=(await this.getModelMap())[e];(0,g.ZB)(t,`Cannot find model for ${e}`);let i=(0,M.l)(I._g.ArithmeticModel,{...t,key:`${t.key}-${e}`}),r=m.hPV.genModelPath(e,t.md5);return this.ensureResource({needUnzip:!1,resourceCategory:E.s.MODEL,pathInDraft:r,onSuccess:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.info("[ensure] ensure model success",t)},onError:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.error("[ensure] ensure model error",t)},material:i})}async _ensureDefaultAudio(){!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait(),this.getRenderManager().fs.writeFileSync(s.I.path,F)}async _ensureEmojiFontResource(e){var t,i;let r=await a.wA.fetchWithCache(s.PU.url);!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait();let n=this.getRenderManager(),o=`${m.P56}/${s.PU.filename}`;n.fs.writeFileSync(o,r),e&&n.setDefaultFontPath(m.P56,!1),null===(i=document.fonts)||void 0===i||null===(t=i.add)||void 0===t||t.call(i,new FontFace(s.PU.fontFamily,r))}async _ensureDefaultFontForEnglish(){return await window.pDefaultFontResource,(0,N.X)(()=>this._ensureAndUnzipResource(m.P56,window._defaultFontResource.en.url),{numTry:3})}async _ensureDefaultFontForOtherLanguages(){await window.pDefaultFontResource;try{let e=[window._defaultFontResource.ja.url,window._defaultFontResource.ko.url,window._defaultFontResource.th.url,window._defaultFontResource["zh-hans"].url,window._defaultFontResource["zh-hant"].url];await Promise.all(e.map(e=>(0,N.X)(()=>this._ensureAndUnzipResource(m.P56,e))))}catch(e){}}async _writeDefaultSpriteBase64(){let e=new Image;try{e.fetchPriority&&(e.fetchPriority="high")}catch(e){}e.src=(0,n.C)(K.H,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),e.setAttribute("crossOrigin","");let t=B.Z,i=new Promise(e=>{t=e});e.onload=t,await i;let r=(0,Y.N)(e,void 0,{compress:{height:H.c1}}),a=K.H.split(",")[1],s=new Uint8Array(q.from(a,"base64"));return!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait(),this.getRenderManager().fs.writeFileSync(m.BeO.templateSlotLostVideoHolderPath,s),this.getRenderManager().resourceRecords.setRecords({segmentPath:m.BeO.templateSlotLostVideoHolderPath,resPath:m.BeO.templateSlotLostVideoHolderPath}),r}async _ensureDefaultSprite(){if(this._writeDefaultSpriteTask)return this._writeDefaultSpriteTask;try{return this._writeDefaultSpriteTask=this._writeDefaultSpriteBase64(),await this._writeDefaultSpriteTask}catch(e){throw this._writeDefaultSpriteTask=null,e}}async ensureFontForMinorityLanguages(){try{let e=[s.Rw.minorityLang.url];await Promise.all(e.map(async e=>{await (0,N.X)(()=>this._ensureAndUnzipResource(m.P56,e))}))}catch(e){}}async _ensureAiMattingAlgorithmConfigFile(){let e=await a.wA.fetchWithCache(s.a8.url);!this._completeRenderManagerBarrier.isOpen()&&await this._completeRenderManagerBarrier.wait();let t=this.getRenderManager(),i=m.P4R.ensureRootPath(s.a8.path);t.fs.writeFileSync(i,e)}async _ensureAudioDenoiseModel(){let e=null,t=window._defaultDenoiseModelResource?window._defaultDenoiseModelResource:s.rv;if(window.pDefaultDenoiseModelResource){let t=await window.pDefaultDenoiseModelResource;t&&(e=t)}!e&&(e=await a.wA.fetchWithCache(t.url)),!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait();let i=m.P4R.ensureRootPath(t.path),r=m.P4R.ensureRootPath(t.dir);this.getRenderManager().fs.writeFileSync(i,e),this.getRenderManager().recordResource({segmentPath:r,resPath:r})}getEnsureResourcePerformance(e,t){var i;let r=this.createEnsureResourceUniqueKey(e,t),n=this._ensureStartTimeMap[r],a=this._ensureEndTimeMap[r],s=null!==(i=this._ensureConditionMap[r])&&void 0!==i?i:"unknown";return n&&a&&!(a<n)?{start:n,end:a,duration:a-n,condition:s}:null}async _ensureAudioMetricsModel(){let e=await a.wA.fetchWithCache(s.HX.url);!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait();let t=m.P4R.ensureRootPath(s.HX.path),i=m.P4R.ensureRootPath(s.HX.dir);this.getRenderManager().fs.writeFileSync(t,e),this.getRenderManager().recordResource({segmentPath:i,resPath:i})}async _ensurePresetAdjustment(){let e=await a.wA.fetchWithCache(s.vk.url);!this._fsRenderManagerBarrier.isOpen()&&await this._fsRenderManagerBarrier.wait();let t=m.P4R.ensureRootPath(s.vk.path),i=m.P4R.ensureRootPath(s.vk.dir);this.getRenderManager().fs.writeFileSync(t,e),this.getRenderManager().recordResource({segmentPath:i,resPath:i})}constructor(e,t,i,r,n,a,s,o,l,d,u){super(),this._isTemplate=e,this._draftPathStore=t,this._resourceService=i,this._modelDataService=r,this._teaAdapterService=n,this._everCloudTokenDataService=a,this._containerService=s,this._mainDraftService=o,this._configurationService=l,this._videoEnvironmentService=d,this._videoPermissionService=u,this._completeRenderManagerBarrier=new h.U,this._fsRenderManagerBarrier=new h.U,this._renderManager=null,this._emojiPromise=null,this._modelPromise=null,this._ensureTaskMap={},this._ensureBuiltInTaskMap={},this._progressiveLoadingStore=new V.b,this.progressiveResourceLoader=null,this._modelMap={},this._effectPathMap={},this._materialPathMap={},this._draftPathFSPathRecord={},this._ensureStartTimeMap={},this._ensureEndTimeMap={},this._ensureConditionMap={},this._failedResourceMap=new Map,this._writeDefaultSpriteTask=null}}Q=(0,r.gn)([(0,r.fM)(2,S.c),(0,r.fM)(3,w.o),(0,r.fM)(4,x.w),(0,r.fM)(5,T.o),(0,r.fM)(6,b.t),(0,r.fM)(7,D.n),(0,r.fM)(8,k.Ui),(0,r.fM)(9,A.rO),(0,r.fM)(10,P.u),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean,void 0===U.H?Object:U.H,void 0===S.c?Object:S.c,void 0===w.o?Object:w.o,void 0===x.w?Object:x.w,void 0===T.o?Object:T.o,void 0===b.t?Object:b.t,void 0===D.n?Object:D.n,void 0===k.Ui?Object:k.Ui,void 0===A.rO?Object:A.rO,void 0===P.u?Object:P.u])],Q)},208118:function(e,t,i){i.d(t,{X:function(){return n}});var r=i(763832);let n=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{delayMs:i=500,numTry:a=2}=t;try{return await e()}catch(d){var s;let o=a-1,l=null==d?void 0:null===(s=d.cause)||void 0===s?void 0:s.status;if(o<=0||403===l)throw d;return await (0,r._)(i),await n(e,{...t,numTry:o})}}},771255:function(e,t,i){i.d(t,{g:function(){return n}});var r,n=((r={})[r.FAILED=0]="FAILED",r[r.IDLE=1]="IDLE",r[r.PREPARE=2]="PREPARE",r[r.UPLOADING=3]="UPLOADING",r[r.REPLACING=4]="REPLACING",r[r.WAITING=5]="WAITING",r[r.CANCELED=6]="CANCELED",r[r.SUCCESS=7]="SUCCESS",r)},693936:function(e,t,i){i.d(t,{k:function(){return h}});var r=i(772322);i(278346);var n=i(186730),a=i(218571),s=i(557038),o=i(989719),l=i(374704),d=i(105789),u=i.n(d),c=i(389123);let h=a.forwardRef((e,t)=>{let{topPart:i,bottomPart:d,onResizeStart:h,onResize:g,onResizeEnd:m,topRef:p,bottomRef:f,topMaskRef:_,bottomMaskRef:v,resizeBoxRef:y,contribution:M}=e,[S,w]=(0,a.useState)(d.height),[T,b]=(0,a.useState)(!1);(0,a.useImperativeHandle)(t,()=>({setBottomHeight:w}));let k=(0,a.useCallback)(()=>{b(!1),null==m||m()},[m]),x=(0,a.useCallback)(()=>{b(!0),null==h||h()},[h]),{run:I}=(0,l.j)((e,t)=>{g(t.height)},16);(0,a.useEffect)(()=>{S?g(S):g(f.current.offsetHeight)},[S,f,g]);let{topPartDragConfig:R,bottomPartDragConfig:C}=M,{onDragRejected:D=o.Z,onDragAccepted:A=o.Z,maskView:P,accept:E}=null!=R?R:{},{onDragEnter:N=o.Z,onDragOver:j=o.Z,onDragLeave:O=o.Z,onDragRejected:L=o.Z,onDragAccepted:B=o.Z,maskView:F,accept:U,multiple:V}=null!=C?C:{},{getInputProps:Z,getRootProps:G,isDragActive:z}=(0,s.b)({onDropRejected:null!=D?D:o.Z,onDropAccepted:null!=A?A:o.Z,accept:E}),{getInputProps:Y,getRootProps:H,isDragActive:K}=(0,s.b)({onDropRejected:null!=L?L:o.Z,onDropAccepted:null!=B?B:o.Z,onDragEnter:null!=N?N:o.Z,onDragOver:null!=j?j:o.Z,onDragLeave:null!=O?O:o.Z,accept:U,multiple:V});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:p,className:c.Z.topPartContainer,children:(0,r.jsxs)("div",{...G(),className:c.Z.topPartContainer,children:[(0,r.jsx)("input",{...Z()}),i.render(),z?(0,r.jsx)("div",{className:c.Z.layoutMaskContainer,ref:_,children:P?P.render():null}):null]})}),(0,r.jsx)(n.Z,{resizeTriggers:{top:(0,r.jsx)("div",{className:c.Z.resizeTrigger})},ref:y,onMovingEnd:k,directions:["top"],onMoving:I,height:S,onMovingStart:x,className:u()(T?c.Z.containerResizing:c.Z.resizeContainer),children:(0,r.jsx)("div",{id:"_timeline-container",ref:f,style:{height:`${S}px`},className:c.Z.bottomPartContainer,children:(0,r.jsxs)("div",{...H(),className:c.Z.bottomPartContainer,children:[(0,r.jsx)("input",{...Y()}),d.render(),K?(0,r.jsx)("div",{className:c.Z.layoutMaskContainer,ref:v,children:F?F.render():null}):null]})})})]})})},487421:function(e,t,i){i.d(t,{v:function(){return n}});var r,n=((r={}).topPart="topPart",r.bottomPart="bottomPart",r)},831228:function(e,t,i){i.d(t,{i:function(){return o}});var r=i(772322),n=i(218571),a=i(896413),s=i(937802);function o(e){let{onMounted:t,onUnmounted:i}=e,o=(0,s.G)(a.a);return(0,n.useEffect)(()=>(o.setFreeze(!0),()=>{o.setFreeze(!1)})),(0,r.jsx)("div",{})}},80587:function(e,t,i){i.d(t,{g:()=>U});var r=i("789786"),n=i("772322"),a=i("445684"),s=i("265829"),o=i("583697"),l=i("108692"),d=i("425427"),u=i("782153"),c=i("896413"),h=i("729596"),g=i("230982"),m=i("375197"),p=i("937802"),f=i("402655"),_=i("426336"),v=i("230689"),y=i("127830"),M=i("160391"),S=i("260963"),w=i("670933");i("218571");var T=i("570126"),b=i("298730"),k=i("631175"),x=i("461405"),I=i("378847"),R=i("527067"),C=i("167726");let D=(0,w.f3)("store","draftOperationManager","slotViewManager")((0,w.Pi)(e=>{var t,i;let{store:r,dataSdk:a,selection:s,segmentSelection:o,slotViewManager:l,handleGlobalSlotModalConfirm:d}=e,{isTemplate:u}=r,c=null==l?void 0:null===(i=l.slotStore)||void 0===i?void 0:null===(t=i.global_modal)||void 0===t?void 0:t.material;return(0,n.jsxs)(n.Fragment,{children:[c&&(0,n.jsx)(R.T,{visible:r.isGlobalSlotModalVisible,slot:c,onClose:()=>{r.setGlobalSlotModalVisible(!1),l.dispatchSlotAction(C.q,"close")},onConfirm:()=>{r.setGlobalSlotModalVisible(!1),l.dispatchSlotAction(C.q,"click"),null==d||d()},onExpose:()=>{l.dispatchSlotAction(C.q,"expose")}}),u?(0,n.jsx)(I.ZP,{segmentSelection:o}):(0,n.jsx)(x.ZP,{dataSdk:a,selection:s})]})}));var A=i("721734"),P=i("953049"),E=i("261447"),N=i("816114"),j=i("444802"),O=i("141913"),L=i("804727"),B=i("825686"),F=i("800788");class U extends f.JT{get _pipelineManager(){return this._mainEditorWidgetService.smartToolsManager.pipelineManager}updateRenderManager(e){this._draftOperationManager.updateRenderManager(e)}setAutoReplace(){this._modalStore.setAutoReplace(this._callbackOptions.getTimelineSwitch().autoReplace)}showModal(e){let{crop:t,trim:i,transcribe:r,isTemplate:n,freezing:a,transferPermission:s,passwordFlow:o,draftViolation:l,globalModal:d,smartToolUndertake:u}=e;if(d&&this._modalStore.setGlobalSlotModalVisible(!0),t?n?this._modalStore.actionIsMutableCropModalVisibleSet(!0):this._modalStore.setMultiTrackCropModalVisible(!0):i?n?this._modalStore.actionIsMutableTrimModalVisibleSet(!0):this._modalStore.actionIsMultiTrackTrimModalVisibleSet(!0):r?this._modalStore.actionIsMultiTrackTranscribeModalVisibleSet(!0):a?this._modalStore.actionIsMultiTrackFreezingModalVisibleSet(!0):s?this._modalStore.actionIsTransferPermissionModalVisibleSet(!0):o?this._modalStore.actionIsPasswordFlowVisibleSet(!0):l?this._modalStore.actionIsDraftViolationSet(!0):u&&this._modalStore.actionIsSmartToolUndertakeModalVisibleSet(!0),this._modalStore.actionIsTemplateSet(!!n),this._modalStore.actionIsUseVideoCropperSet(!!this._mainEditorWidgetService.segmentSelection.observeData.subDraftId),this.setAutoReplace(),!this._modalContainer){this._modalContainer=this._render();let e=(0,S.U5)(()=>this._modalStore.isModalVisible,e=>{this._modalContainer&&(this._modalContainer.style.display=e?"block":"none")});this._register({dispose:e})}}async _ensureTrimResource(e,t,i){let r=this._mainDraftService.dataSdk.draftView.getSegmentById(e);if(r&&(0,_.hey)(r)){let e=t,s=i,{material:l}=r;if(!e||!s){var n,a;let{path:t}=l;s=null!==(n=(0,o.$d)(l))&&void 0!==n?n:void 0,e=null!==(a=this._mainDraftService.draftPathStore.getResourceKeyFromDraftPath(t))&&void 0!==a?a:void 0,(0,F.Y2)(e),(0,F.Y2)(s)}let d=await this._modalResourceManager.getTrimVideoResourceInfo(e,s);if(!d)return!1;let{width:u,height:c,materialName:g}=l,{decryptKey:m,headers:p,previewUrl:f,url:_,value:v}=d,{start:y}=(0,o.Xd)(h.h.usToMs(this._playerManager.status.progress),r);return this._modalStore.setTrimInfo({segment:r,videoInfo:{decryptKey:m,headers:p,url:_,width:u,height:c,duration:1e3*d.duration,previewUrl:f,start:y,type:s,key:e,value:v}}),!0}return!1}async showMultiTrackTrimModal(e,t,i){await this._ensureTrimResource(e,t,i)&&((this._playerManager.status.isPlaying||this._playerManager.status.isRangePlaying)&&this._playerManager.pause(),this.showModal({trim:!0}))}async showMutableTrimModal(e,t){if(await this._ensureTrimResource(e)){let i=(0,b.dx)(this._mainDraftService.dataSdk.cutSame.draftIdToMutableVideos[null!=t?t:this._mainDraftService.dataSdk.draftView.getDraftId()],[],e);i&&(this._modalStore.actionSegmentMutableSet(null!=i?i:null),(this._playerManager.status.isPlaying||this._playerManager.status.isRangePlaying)&&this._playerManager.pause(),this.showModal({trim:!0,isTemplate:!0}))}}async _ensureCropResource(e){let t=this._mainDraftService.dataSdk.draftView.getSegmentById(e);if(t&&(0,_.hey)(t)){var i,r,n,a,s,l;let{material:e,reverse:d}=t,u=d?e.reversePath:e.path,{width:c,height:g}=e,m=d?null!==(s=this._pipelineManager.getProductResourceType(t))&&void 0!==s?s:y._g.UserFile:(0,o.$d)(e);if(!m)return!1;let p=this._mainDraftService.draftPathStore.getResourceKeyFromDraftPath(u);(0,F.Y2)(p);let f=await this._modalResourceManager.getCropResourceMeta({resourceKey:p,resourceType:m});if(!f)return!1;let{decryptKey:v,headers:M,previewUrl:S,url:w}=f,{duration:T,seek:b,start:k}=(0,o.Xd)(h.h.usToMs(this._playerManager.status.progress),t);return this._modalStore.setCropInfo({segment:t,videoInfo:{decryptKey:v,url:w,headers:M,height:g,duration:T,width:c,start:k,previewUrl:S,seek:b,isImage:[_.cVg.MetaTypePhoto,_.cVg.MetaTypeGif,_.cVg.MetaTypeImage].includes(null===(i=t.material)||void 0===i?void 0:i.type),format:null!==(l=null==e?void 0:null===(a=e.materialName)||void 0===a?void 0:null===(n=a.split("."))||void 0===n?void 0:null===(r=n.pop())||void 0===r?void 0:r.toLowerCase())&&void 0!==l?l:""}}),!0}return!1}async showMultiTrackCropModal(e,t){var i,r,n,a,s;let o=null===(r=this._modalStore.cropInfo)||void 0===r?void 0:null===(i=r.segment)||void 0===i?void 0:i.id;if(await this._ensureCropResource(e)){(this._playerManager.status.isPlaying||this._playerManager.status.isRangePlaying)&&this._playerManager.pause(),this._modalStore.setOpenSource(null==t?void 0:t.openSource),this.showModal({crop:!0}),o&&o!==e&&this.cropModalManager.reset(),this.cropModalManager.checkSmartCropApplying(e);let i=(null===(a=this._modalStore.cropInfo)||void 0===a?void 0:null===(n=a.segment)||void 0===n?void 0:n.smartCrop)?j.J.Smart:j.J.Normal;this.cropModalManager.observableData.smartState.isSmartCropApplying&&(i=j.J.Smart),this.cropModalManager.setMode(null!==(s=null==t?void 0:t.cropMode)&&void 0!==s?s:i),this.cropModalManager.setRatioSelectOpen(!!(null==t?void 0:t.showRatioSelectDropdown))}}async showMutableCropModal(e,t,i){if(await this._ensureCropResource(e)){let r=(0,b.dx)(this._mainDraftService.dataSdk.cutSame.draftIdToMutableVideos[null!=t?t:this._mainDraftService.dataSdk.draftView.getDraftId()],[],e);r&&(this._modalStore.actionSegmentMutableSet(null!=r?r:null),(this._playerManager.status.isPlaying||this._playerManager.status.isRangePlaying)&&this._playerManager.pause(),this._modalStore.setOpenSource(i),this.showModal({crop:!0,isTemplate:!0}))}}showTransferPermissionModal(e){this._modalStore.setTransferPermissionInfo(e),this.showModal({transferPermission:!0})}showPasswordFlowModal(e){this._modalStore.setPasswordFlowOptions(e),this.showModal({passwordFlow:!0})}hidePasswordFlowModal(){this._modalStore.actionIsPasswordFlowVisibleSet(!1)}showDraftViolationModal(){this.showModal({draftViolation:!0})}hideMultiTrackFreezingModal(){this._modalStore.actionIsMultiTrackFreezingModalVisibleSet(!1)}setTimelineManager(e){this._timelineManager=e}get cropModalManager(){return!this._cropModalManager&&(this._cropModalManager=this._containerService.createInstance(E.W,this,this._modalStore)),this._cropModalManager}constructor(e,t,i,r,o,l,u,c,h,f,_,v,y,M){super(),this._mainEditorWidgetService=e,this._playerManager=t,this._ensureManager=i,this._selection=r,this._segmentSelection=o,this._callbackOptions=c,this._mainDraftService=h,this._lifecycleService=f,this._containerService=_,this._environmentService=v,this._videoPermissionService=y,this._payinPayoutService=M,this.modalGuard=new P.s,this._handleGlobalSlotModalConfirm=()=>{let{workspaceId:e}=this._mainDraftService.draftWorkspaceManager;this._payinPayoutService.showPayModal({workspaceId:e,reporterParams:{pageFrom:B.K1.UpgradeToPro,currentPage:this._modalStore.isTemplate?"template_editor":"editor"},isUpgrade:!0})},this._render=()=>{let{cropModalManager:e}=this,t=this._containerService.createInstance(N.p),i=document.createElement("div");return i.classList.add(k.Z.editorWidgetModal),document.body.append(i),(0,T.createRoot)(i).render((0,n.jsx)(p.$,{instantiationService:this._containerService,children:(0,n.jsx)(w.zt,{store:this._modalStore,permissionService:this._videoPermissionService,modalResourceManager:this._modalResourceManager,draftOperationManager:this._draftOperationManager,cropModalManager:e,ensureManager:this._ensureManager,framesManager:t,timelineManager:this._timelineManager,slotViewManager:this._slotViewManager,children:(0,n.jsx)(O.SV,{fallback:(0,n.jsx)("div",{}),children:(0,n.jsx)(D,{dataSdk:this._mainDraftService.dataSdk,selection:this._selection,segmentSelection:this._segmentSelection,handleGlobalSlotModalConfirm:this._handleGlobalSlotModalConfirm})})})})),i},this._lifecycleService.onRestored(()=>{(0,g.n)(()=>{let e=this._environmentService.appSubType===d.cP.Template,t=this._environmentService.appSubType===d.cP.MultiTrack;e?((0,I.Pp)(),(0,I._l)()):t&&Promise.all([(0,x.pd)(),(0,x.GO)()]).then(()=>{(0,I.Pp)(),(0,I._l)()})},{priorityLevel:m.q.LowPriority})}),this._modalStore=new A.v,this._modalResourceManager=this._containerService.createInstance(s.q,this._modalStore),this._slotViewManager=this._containerService.createInstance(L.I,["global_modal"]),this._draftOperationManager=this._containerService.createInstance(a.P,u,l),this._modalStore.actionSegmentId2initialSpeedSet(h.dataSdk.cutSame.segmentId2initialSpeed);let b=(0,S.U5)(()=>this._modalStore.isModalVisible,e=>{e?!this._modalContainer&&(this._modalContainer=this._render(),this._modalContainer.style.display="block"):this._modalContainer&&(this._modalContainer.style.display="none")});if(this._register({dispose:b}),!this._environmentService.activeSmartTool){let e=(0,S.U5)(()=>{var e;return null===(e=this._slotViewManager)||void 0===e?void 0:e.isInitialized},e=>{var t,i,r;e&&(null===(r=this._slotViewManager)||void 0===r?void 0:null===(i=r.slotStore)||void 0===i?void 0:null===(t=i.global_modal)||void 0===t?void 0:t.plan_id)!==void 0&&this.showModal({globalModal:!0})});this._register({dispose:e})}}}U=(0,r.gn)([(0,r.fM)(8,l.n),(0,r.fM)(9,M.g),(0,r.fM)(10,v.t),(0,r.fM)(11,d.rO),(0,r.fM)(12,u.u),(0,r.fM)(13,B.sX),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.a?Object:c.a,"undefined"==typeof IPlayerManager?Object:IPlayerManager,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof ReplaceSegmentManager?Object:ReplaceSegmentManager,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof ModalCallbackOptions?Object:ModalCallbackOptions,void 0===l.n?Object:l.n,void 0===M.g?Object:M.g,void 0===v.t?Object:v.t,void 0===d.rO?Object:d.rO,void 0===u.u?Object:u.u,void 0===B.sX?Object:B.sX])],U)},128171:function(e,t,i){i.d(t,{i:()=>s});var r=i("587892"),n=i("995234");class a{get onMutableReplaceTaskSlotAdd(){return this._onMutableReplaceTaskSlotAdd.event}get allSlots(){return[...this._mapping.values()]}set(e,t){this._getOrCreateSource(e).setToken(t)}delete(e){this._mapping.delete(e)}get(e){return this._getOrCreateSource(e)}_getOrCreateSource(e){if(!this._mapping.has(e)){let t=new n.y;this._mapping.set(e,t),this._onMutableReplaceTaskSlotAdd.fire(t)}return this._mapping.get(e)}constructor(){this._mapping=new Map,this._onMutableReplaceTaskSlotAdd=new r.Q}}class s{get onMutableReplaceTaskChange(){return this._onMutableReplaceTaskChange.event}get onMutableReplaceTaskAdd(){return this._mutableReplaceTaskMapping.onMutableReplaceTaskSlotAdd}get allSlots(){return this._mutableReplaceTaskMapping.allSlots}get(e){return this._mutableReplaceTaskMapping.get(e)}set(e,t){return this._mutableReplaceTaskMapping.set(e,t)}constructor(){this._mutableReplaceTaskMapping=new a,this._onMutableReplaceTaskChange=new r.Q}}},839226:function(e,t,i){i.d(t,{hF:function(){return g}});var r,n=i(789786),a=i(641276),s=i(587892),o=i(402655),l=i(800788),d=i(426336),u=i(951603);var c=((r={}).Auto="auto",r.Play="play",r.Pause="pause",r);class h extends o.JT{async seek(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.Hqf.normal,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto",r="play"===i||"auto"===i&&this._isPlaying,n=t;this._veState===d.jey.PLAY_EOF&&[d.Hqf.normal,d.Hqf.onGoing].includes(t)?n=d.Hqf.seekDone:r&&(n=d.Hqf.seekDone),await this._renderManager.seekTime(e,n),r?this.play():this.pause()}seekAndPause(e){this.seek(e,d.Hqf.seekDone,"pause")}async rangePlay(e,t){await this._renderManager.setTimeRange(0n,t),await this._renderManager.seekTime(e,d.Hqf.seekDone),this._rangePlayEndtime=t,this._renderManager.play()}reset(e){e.then(()=>{this._onRenderManagerReset()})}exitRangePlay(){if(this._rangePlayEndtime!==-1n)this._rangePlayEndtime=-1n,this._renderManager.setTimeRange(0n,-1n)}seekWithSpeed(e,t,i){return this._renderManager.seekWithSpeed(e,d.Hqf.onGoing,t,i)}flushSeekCmd(){this._renderManager.flushSeekCmd()}play(){return this.exitRangePlay(),this._renderManager.play()}pause(){return this.exitRangePlay(),this._renderManager.pause()}get isPlaying(){return this._veState===d.jey.PLAYING}get _veState(){return this._renderManager.state}_onRenderManagerError(e){this._onError.fire(e)}_onRenderManagerProgressChange(e){u.kg.debug(`_onRenderManagerProgressChange({ progress: ${e.progress}, isSeek: ${e.isSeek} })`),this._onProgressChange.fire(e)}_onRenderManagerFrameRender(e){if(this._isWaitPlayingStart&&(this._isWaitPlayingStart=!1,this._isPlaying=!0,this._rangePlayEndtime!==-1n?this._onRangePlay.fire():this._onPlay.fire()),this.isPlaying&&this._rangePlayEndtime!==-1n&&e.progress>=this._rangePlayEndtime){u.kg.info("rangePlay end");let e=this._rangePlayEndtime;(0,a.V)(this.onPause)(()=>{this._renderManager.seekTime(e,d.Hqf.seekDone)}),this.exitRangePlay(),this._renderManager.pause()}}_onRenderManagerReset(){(0,a.V)(e=>{let t=this._renderManager.onFrameRender(()=>{e()});return null!=t?t:{dispose:()=>null}})(()=>{this._onProgressChange.fire({progress:this._renderManager.progress,isSeek:!1}),this._renderManager.state===d.jey.PAUSED&&this._onPause.fire()})}_onRenderManagerSeekDonePlay(){this._renderManager.play()}_onRenderManagerStateChange(e){switch(u.kg.info(`_onRenderManagerStateChange(${d.jey[e]})`),e){case d.jey.PLAYING:this._isWaitPlayingStart=!0;break;case d.jey.PAUSED:this._isPlaying=!1,this._isWaitPlayingStart=!1,this._onPause.fire();break;case d.jey.PLAY_EOF:this._isPlaying=!1,this._isWaitPlayingStart=!1,this._onEnd.fire();break;case d.jey.SEEK_DONE:this._onSeeked.fire()}}setFullscreenContainer(e){if(this._fullscreenContainer=e,this._fullscreenContainer){var t;null===(t=this._fullscreenContainer)||void 0===t||t.removeEventListener("fullscreenchange",this.fullscreenchangeHandler)}this._fullscreenContainer.addEventListener("fullscreenchange",this.fullscreenchangeHandler),this._register({dispose:()=>{var e;null===(e=this._fullscreenContainer)||void 0===e||e.removeEventListener("fullscreenchange",this.fullscreenchangeHandler)}})}requestFullscreen(e){(0,l.Y2)(this._fullscreenContainer,"fullscreenContainer is undefined"),(0,l.Y2)(this._fullscreenContainer.requestFullscreen||this._fullscreenContainer.webkitRequestFullscreen,"requestFullscreen not support"),this._fullScreenSourceFrom=e,this._fullscreenContainer.requestFullscreen?this._fullscreenContainer.requestFullscreen():this._fullscreenContainer.webkitRequestFullscreen&&this._fullscreenContainer.webkitRequestFullscreen()}exitFullscreen(e){(0,l.Y2)(document.exitFullscreen||document.webkitExitFullscreen,"exitFullscreen not support"),this._fullScreenSourceFrom=e,document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}retryStreamAsset(e){return Promise.resolve(this._renderManager.retryStreamAsset(e))}constructor(e){super(),this._isPlaying=!1,this._isWaitPlayingStart=!1,this._rangePlayEndtime=-1n,this._onEnd=this._register(new s.Q),this._onError=this._register(new s.Q),this._onFullscreenChange=this._register(new s.Q),this._onPause=this._register(new s.Q),this._onPlay=this._register(new s.Q),this._onRangePlay=this._register(new s.Q),this._onProgressChange=this._register(new s.Q),this._onFrameRender=this._register(new s.Q),this._onSeeked=this._register(new s.Q),this._onStreamStart=this._register(new s.Q),this._onStreamStop=this._register(new s.Q),this._onStreamFail=this._register(new s.Q),this.fullscreenchangeHandler=()=>{var e;(0,l.Y2)(document,"document not support");let t=!!(null===(e=document)||void 0===e?void 0:e.fullscreenElement);this._onFullscreenChange.fire(t,this._fullScreenSourceFrom),this._fullScreenSourceFrom=void 0},this._renderManager=e.renderManager,this.onEnd=this._onEnd.event,this.onError=this._onError.event,this.onFullscreenChange=this._onFullscreenChange.event,this.onPause=this._onPause.event,this.onPlay=this._onPlay.event,this.onRangePlay=this._onRangePlay.event,this.onProgressChange=this._onProgressChange.event,this.onFrameRender=this._onFrameRender.event,this.onSeeked=this._onSeeked.event,this.onStreamStart=this._onStreamStart.event,this.onStreamStop=this._onStreamStop.event,this.onStreamFail=this._onStreamFail.event,this._fullScreenSourceFrom=void 0;let t=this._renderManager.onError(this._onRenderManagerError.bind(this));t&&this._register(t),(t=this._renderManager.onProgressChange(this._onRenderManagerProgressChange.bind(this)))&&this._register(t),(t=this._renderManager.onFrameRender(this._onRenderManagerFrameRender.bind(this)))&&this._register(t),(t=this._renderManager.onSeekDonePlay(this._onRenderManagerSeekDonePlay.bind(this)))&&this._register(t),(t=this._renderManager.onStateChange(this._onRenderManagerStateChange.bind(this)))&&this._register(t),(t=this._renderManager.onStreamStart(e=>{let{asset_id:t}=e;return this._onStreamStart.fire(t)}))&&this._register(t),(t=this._renderManager.onStreamStop(e=>{let{asset_id:t}=e;return this._onStreamStop.fire(t)}))&&this._register(t),(t=this._renderManager.onStreamFail(e=>{let{assetId:t,httpStatus:i,isBlock:r,isGetMediaInfo:n}=e;return this._onStreamFail.fire({assetId:t,httpStatus:i,isBlock:r,isGetMediaInfo:n})}))&&this._register(t)}}(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof BigInt?Object:BigInt,void 0===d.Hqf?Object:d.Hqf,void 0===c?Object:c]),(0,n.w6)("design:returntype",Promise)],h.prototype,"seek",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof BigInt?Object:BigInt,"undefined"==typeof BigInt?Object:BigInt]),(0,n.w6)("design:returntype",Promise)],h.prototype,"rangePlay",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof Promise?Object:Promise]),(0,n.w6)("design:returntype",void 0)],h.prototype,"reset",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],h.prototype,"exitRangePlay",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof BigInt?Object:BigInt,Number,Number]),(0,n.w6)("design:returntype",void 0)],h.prototype,"seekWithSpeed",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],h.prototype,"flushSeekCmd",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],h.prototype,"play",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],h.prototype,"pause",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IVeVideoPlayerError?Object:IVeVideoPlayerError]),(0,n.w6)("design:returntype",void 0)],h.prototype,"_onRenderManagerError",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],h.prototype,"_onRenderManagerReset",null),(0,n.gn)([u.um,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],h.prototype,"_onRenderManagerSeekDonePlay",null);let g=e=>((0,l.Y2)(e,"video player must sdk."),new h({renderManager:e}))},940282:function(e,t,i){i.d(t,{Y:function(){return n}});var r,n=((r={})[r.FigureBeauty=0]="FigureBeauty",r[r.SmartCrop=1]="SmartCrop",r)},196269:function(e,t,i){i.d(t,{A4:function(){return g},BE:function(){return h}});var r=i(690613),n=i(426336),a=i(420072),s=i(315201),o=i(433140),l=i(827084),d=i(127830),u=i(896413);async function c(e){try{await (0,a.Z)(e)}catch(t){let e=t.cause;if("1033"!==e&&"1000"!==e)return null;throw(0,r.Mx)(-1200,"template status is not normal",Error("",{cause:e}))}return(0,s.R)(e.value)?e.value:null}function h(e,t){let i=e.invokeFunction(e=>e.get(o.c)),r=(0,l.Bc)(t);i.add(r,{type:d._g.VideoTemplate,key:r,id:t});let n=i.get(r,d._g.VideoTemplate);return{pTemplateInfo:c(n),templateResource:n}}async function g(e,t){let[i,r]=(await t).pair();if(i||!(null==r?void 0:r.template))return;let a=[],{tracks:s}=n.HHr.parse(r.template);for(let t of s)if("video"===t.type)for(let i of t.segments)(null==i?void 0:i.template_id)&&a.push((async()=>{let{pTemplateInfo:t}=h(e,i.template_id),r=await t;r&&function(e,t){e.invokeFunction(e=>{var i;null===(i=e.get(u.a).canvasManager.modules.templateManager)||void 0===i||i.appendTemplateInfoToInfoMap(t.id,t)})}(e,r)})());await Promise.all(a)}},611881:function(e,t,i){i.d(t,{Wp:function(){return b},cY:function(){return T},fN:function(){return k},of:function(){return w},py:function(){return M}});var r=i(940282),n=i(820193),a=i(426020),s=i(731992),o=i(173888),l=i(127830),d=i(289732),u=i(208118),c=i(906419),h=i(966614),g=i(759037),m=i(811750),p=i(426336);let f=(e,t)=>{let i=[],r=[],n=[];for(let a of t){let{online:t,pathInDraft:s,preloadMaterial:o}=a;n.push(t);let l=e.ensureMaterial(t,s,{draftPathStrategy:a.useMaskVideo?d.S.ForceKeepOrigin:d.S.ForceGenerateNew,overrideSupportStream:o.support_stream,keepFsPathEqualToDraftPath:a.useMaskVideo,metaTimeout:void 0,isFirstFrameStreamMaterial:o.is_first_frame_stream_material,shouldPreloadStreamAsset:!0,useMaskVideo:a.useMaskVideo});i.push((0,g.b)(l.waitForResourceMetaReady())),r.push((0,g.b)(l.waitForResourceValueReady()))}return{waitForOnlineMaterialMetasReady:()=>Promise.all(i),waitForOnlineMaterialValuesReady:()=>Promise.all(r),onlineMaterialList:n}},_={[a.YB.Video]:l._g.UserVideo,[a.YB.Image]:l._g.UserPhoto,[a.YB.File]:l._g.UserFile,[a.YB.Audio]:l._g.UserAudio},v=(e,t)=>t?d.S.ForceKeepOrigin:e.isVideoAlgorithmProduct||"number"==typeof e.algorithmType&&[r.Y.FigureBeauty,r.Y.SmartCrop].includes(e.algorithmType)?d.S.ForceKeepOrigin:d.S.ForceGenerateNew,y=(e,t)=>!!t||"number"==typeof e.algorithmType&&[r.Y.FigureBeauty,r.Y.SmartCrop].includes(e.algorithmType),M=e=>{var t;return(null===(t=e.preloadMaterial)||void 0===t?void 0:t.support_stream)&&["video","image","audio"].includes(e.asset.material.groupType)&&e.asset.material.fileStatus===h.X.Online},S=(e,t,i,r,a,u)=>{let c=[],h=[],m=[],p=new Map,f=new Set;for(let k of(u.forEach(e=>{p.set(e.md5,e),f.add(e.md5)}),[...r,...a].forEach(i=>{var r,a,s,o;let d=p.get(i.asset.md5);if(f.delete(i.asset.md5),!d){console.error("[startup] cannot find a lifecycle for EverCloud material",i);return}let u=d.getModel();if(!(null===(r=u.draftDelta)||void 0===r?void 0:r.sourcePath))return;let S=(0,n.fA)(d.getModel()),w=t.isAutoTest?S?void 0:1e4:S?void 0:6e4,T=(0,n.GL)(u,_[u.fileType],t.isAutoTest);m.push(T);let b=T.resource.type===l._g.UserFile&&!!(null===(s=T.resource)||void 0===s?void 0:null===(a=s.sourcePath)||void 0===a?void 0:a.includes("matting")),k=e.ensureMaterial(T,i.pathInDraft,{metaTimeout:w,isZippedUserFile:b,draftPathStrategy:v(i,b),overrideSupportStream:M(i),keepFsPathEqualToDraftPath:y(i,b),isFirstFrameStreamMaterial:null==i?void 0:null===(o=i.preloadMaterial)||void 0===o?void 0:o.is_first_frame_stream_material,shouldDownloadOriginalMaterial:t.isAutoTest&&!S,shouldPreloadStreamAsset:!0});c.push((0,g.b)(k.waitForResourceMetaReady())),h.push((0,g.b)(k.waitForResourceValueReady()))}),f)){var S,w,T,b;let t=p.get(k),r=t.getModel();if((null===(w=r.draftDelta)||void 0===w?void 0:null===(S=w.meta)||void 0===S?void 0:S.group)==="graphic"||!(null===(T=r.draftDelta)||void 0===T?void 0:T.sourcePath))continue;if(["attachment_video_algorithm.json","async_task_service.json"].includes(r.draftDelta.sourcePath)){i.recordResourceKeyToDraftPath(r.key,r.draftDelta.sourcePath),i.recordDraftPathToResourceKey(r.draftDelta.sourcePath,r.key);continue}if((null===(b=r.draftDelta)||void 0===b?!void 0:!b.meta)||!!r.draftDelta.meta.visible)e.ensureMaterial((0,s.l)(_[r.fileType],{...r,onProgress:t.onModelUpdate,onReady:t.onDidDone},t.status===o.a.Success),r.draftDelta.sourcePath,{draftPathStrategy:d.S.ForceGenerateNew,shouldPreloadStreamAsset:!0})}return{waitForCloudMaterialMetasReady:()=>Promise.all(c),waitForCloudMaterialValuesReady:()=>Promise.all(h),everCloudMaterialList:m}},w=(e,t,i,r,n,a,s)=>{let o=f(e,r),l=o.waitForOnlineMaterialValuesReady(),d=S(e,t,i,n,a,s),u=d.waitForCloudMaterialValuesReady();return{waitForMaterialsEnsured:()=>Promise.all([l,u]),pOnlineMaterials:l,pCloudMaterials:u,waitForOnlineMaterialMetasReady:o.waitForOnlineMaterialMetasReady,waitForCloudMaterialMetasReady:d.waitForCloudMaterialMetasReady,onlineMaterialList:o.onlineMaterialList,everCloudMaterialList:d.everCloudMaterialList}},T=async e=>(await e.getBuiltinResourceTokens()).filter(e=>{var t;return!(null===(t=e.value)||void 0===t?void 0:t.url)}),b=async(e,t,i,r)=>{let n=await t.getBuiltinResourceTokens(),{builtInMaterials:a,remainingBuiltInResources:s,duplicatedBuiltinResourceMap:o}=r,l={...(0,c.Z)([...a,...s],e=>e.builtIn.path)};return Promise.all(n.filter(e=>{var t;return!!(null===(t=e.value)||void 0===t?void 0:t.url)}).map(r=>{let n=i[r.value.key],a=o[n],s=n!==a;return(0,u.X)(async()=>{var i,o;let d=await e.ensureBuiltInMaterial(r,n,l[n],{duplicatedPath:s?a:void 0,isFirstFrameStreamMaterial:null===(o=l[n])||void 0===o?void 0:null===(i=o.preloadMaterial)||void 0===i?void 0:i.is_first_frame_stream_material});if(n===m.di){let e;try{e=p.HHr.parse(new TextDecoder("utf-8").decode(d))}catch{}t.setOriginVideoAlgorithmInfo(e)}},{numTry:2})}))},k=(e,t)=>Promise.all(t.map(t=>e.ensureFolder(t)))},868028:function(e,t,i){i.d(t,{s:function(){return o}});var r=i(547314),n=i(215179),a=i(966614),s=i(374904);let o=(e,t)=>{var i;return{md5:t.md5,meta:null!==(i=t.package_meta)&&void 0!==i?i:{},path:t.source_path,size:t.size,material:function(e,t){var i,o,l,d,u,c,h,g,m,p;let f,_,v;let y=["cover.jpg","template.json"].includes(null==(p=t)?void 0:p.source_path)?"other":(0,s.Gt)(p.mime),M=a.X.Online,S={},w=e.isAutoTest?t.preview_url.bucket_key_720p||t.preview_url.bucket_key_1080p||t.preview_url.bucket_key_480p||t.preview_url.bucket_key_360p:t.preview_url.bucket_key_360p||t.preview_url.bucket_key_480p||t.preview_url.bucket_key_720p||t.preview_url.bucket_key_1080p,{player_480p:T,player_360p:b,player_720p:k,audio_128kb:x}=t.play_info,I=T.primary_url?{url:T.primary_url,key:T.url_key}:b.primary_url?{url:b.primary_url,key:b.url_key}:k.primary_url?{url:k.primary_url,key:k.url_key}:void 0,R=x.primary_url?{url:x.primary_url,key:x.url_key}:void 0;switch(y){case"video":if(f=I,w&&(_={url:w,key:t.preview_key}),t.meta)try{if("string"!=typeof t.meta)({meta:S}=t);else{let e=JSON.parse(t.meta);S={...S,...e}}}catch(e){}if(void 0!==t.transcode_status&&3!==t.transcode_status||((0,r._)(S)?M=a.X.Online:!I&&(M=a.X.Transcoding)),(null===(u=t.sprite_frame)||void 0===u?void 0:u.detail_infos)&&(null===(c=t.sprite_frame)||void 0===c?void 0:c.common_info)){let{single_frame_width:e,single_frame_height:i}=t.sprite_frame.common_info;v=t.sprite_frame.detail_infos.map(t=>({url:t.url,key:t.encrypted_key,count:t.frame_count,width:t.width,height:t.height,x:t.width/e,y:t.height/i,ratio:e/i}))}break;case"image":if(t.meta)try{if("string"!=typeof t.meta)({meta:S}=t);else{let e=JSON.parse(t.meta);S={...S,...e}}}catch(e){}w?_={url:w,key:t.preview_key}:M=a.X.Transcoding;break;case"audio":f=R,void 0!==t.transcode_status||!R&&(M=a.X.Transcoding)}return!(null===(o=t.tags)||void 0===o?void 0:null===(i=o.includes)||void 0===i?void 0:i.call(o,7001))&&(M=a.X.Online),{assetId:String(t.asset_id),name:t.filename,md5:t.md5,type:null!==(h=t.mime)&&void 0!==h?h:"",metaType:(0,n.Me)(t.mime),groupType:y,size:t.size,ext:t.sub_type,duration:t.duration,width:null!==(g=t.width)&&void 0!==g?g:0,height:null!==(m=t.height)&&void 0!==m?m:0,encryptedCover:_,encryptedSprites:v,progressDownload:0,progressTranscode:M===a.X.Online?1:0,fileStatus:M,updatedAt:t.updated_at,meta:S,playInfo:f,downloadUrl:t.origin_download_link,spaceId:2===t.owner_type?t.owner:"0",hasMaterialTag:null===(d=t.tags)||void 0===d?void 0:null===(l=d.includes)||void 0===l?void 0:l.call(d,7001)}}(e,t)}}},617660:function(e,t,i){i.d(t,{G:function(){return r}});function r(e){let{preload:t}=e,{json:i,avs:r,effects:n,online:a,builtIns:s}=t;return{template:i,packageAssets:[],preloadResources:{materials:r,effects:n},resourceInfos:{onlineResourceList:a,everCloudResourceList:[],errorList:[],builtInResourceList:s},preloadConfig:{},attachments:{}}}},967877:function(e,t,i){i.d(t,{p:()=>f});var r=i("772322");i("966156"),i("784923");var n=i("368100"),a=i("498417"),s=i("801497"),o=i("150564");i("225572");var l=i("97257");i("381773");let d=e=>{let{Icon:t,title:i,description:n,hiddenCancelBtn:a,hiddenOkBtn:s,onOk:o,onCancel:d,okText:u,cancelText:c}=e.config;return(0,r.jsxs)("div",{className:"lv-modal repair-modal",children:[(0,r.jsx)(t,{className:"repair-icon"}),(0,r.jsxs)("div",{className:"repair-content",children:[(0,r.jsx)("div",{className:"title",children:i}),(0,r.jsx)("div",{className:"description",children:n})]}),(0,r.jsxs)("div",{className:"repair-footer",children:[!a&&(0,r.jsx)(l.Z,{type:"secondary",onClick:d,children:c}),!s&&(0,r.jsx)(l.Z,{type:"primary",onClick:o,children:u})]})]})};var u=i("800788"),c=i("722169"),h=i("426336"),g=i("872155"),m=i("603647");let p=(e,t)=>{let{status:i,onOk:n,onCancel:a}=t,l={Icon:o.Bbg,title:s.oc.t("web_draft_trans_title_media_repair",{},"Media lost"),okText:s.oc.t("web_draft_trans_button_restore",{},"Restore media"),cancelText:s.oc.t("web_draft_trans_button_open",{},"Open project"),description:s.oc.t("web_draft_trans_text_restore",{},"Some media are lost in this project. You can restore them, or open the project without restoring them."),onCancel:()=>a(i),onOk:()=>n(i),hiddenCancelBtn:!1,hiddenOkBtn:!1};return(0,r.jsx)(d,{config:{...l,...(0,g.i)(i,e)}})},f=e=>{var t;let{onError:i,onCancel:r,onSuccess:o,incompletePathMap:l,reportRepairStep:d,userMaterialLifeCycles:g,updateDraft:f}=e,_=null===(t=Object.keys(l))||void 0===t?void 0:t.length,v=null,y=null;try{let e=e=>{if(e===m.N.default){y();return}e===m.N.success?(null==v||v.close(),o()):e===m.N.fail?(null==v||v.close(),i()):(0,u.ss)("Invalid ok condition")},t=e=>{e===m.N.default?(d({action:"reject_repair"}),null==v||v.close(),r()):e===m.N.doing?(d({action:"user_cancel_when_repairing"}),null==v||v.close(),r()):(0,u.ss)("Invalid ok condition")},a=i=>p(l,{status:i,onOk:e,onCancel:t});y=async()=>{d({action:"confirm_to_repair"}),v.update({modalRender:()=>a(m.N.doing)});let e={};(0,c.forEach)(l,(t,i)=>{e[t.md5]=i});try{let i=g.map(t=>new Promise((i,r)=>{t.onDidDone(()=>{let r=e[t.md5],n=t.getModel();l[r]={...l[r],path:h.hPV.genRelativeFilePath({md5:t.md5,ext:n.subType}),status:"success",saved:!1},v.update({modalRender:()=>a(m.N.doing)}),i()}),t.onTranscodeFailure(r)}));await Promise.allSettled(i);let r=(0,c.pickBy)(l,e=>"success"===e.status&&!e.saved);if(!(0,c.isEmpty)(r)){let e=await f(r);if("success"===e){var t;d({action:"repair_save_draft_success",desc:`${null===(t=Object.values(r))||void 0===t?void 0:t.map(e=>e.asset_id).join("__")}`}),Object.keys(r).forEach(e=>{l[e].saved=!0})}}d({action:"repair_success"}),v.update({modalRender:()=>a(m.N.success)})}catch(e){console.error("[repair]",e),v.update({modalRender:()=>a(m.N.fail)}),d({action:"get_lost_material_fail",desc:(null==e?void 0:e.message)||"error"});return}},v=n.Z.confirm({modalRender:()=>p(l,{status:m.N.default,onCancel:t,onOk:e}),maskClosable:!1,escToExit:!1,icon:null,wrapStyle:{zIndex:999},maskStyle:{background:"rgba(0, 0, 0, 0.6)",backdropFilter:"blur(100px)",zIndex:999}})}catch(e){a.Z.error(s.oc.t("web_draft_trans_text_restored_medi",{placeholder0:_,num:_},`Couldn't restore ${_} media`)),i()}return v}},945903:function(e,t,i){i.d(t,{F:function(){return n},a:function(){return a}});var r=i(426336);let n=(e,t,i)=>{if(t&&i&&(0,r.hey)(t)&&(0,r.hey)(i)){let r=t.materialDraft,n=i.materialDraft?i.materialDraft.clone():void 0;if(r&&n){let t=r.draft.getAllSegments(),a=n.draft.getAllSegments();if(t.length===a.length){let r=new Map;for(let e=0;e<a.length;e++)r.set(t[e].id,a[e].id);for(let t of a){let i=e.draftView.getVideoTracking(t);if(i)for(let e of[...i.trackers]){let t=e.targetSegmentId;r.has(t)&&(e.targetSegmentId=r.get(e.targetSegmentId))}}i.materialDraft=n}}}},a=(e,t)=>{if(!e||!t||!(0,r.hey)(e)||!(0,r.hey)(t))return;let i=e.materialDraft,n=t.materialDraft;if(!i||!n)return;let a=i.draft,o=n.draft;if(!a||!o)return;let l=a.property.mutableConfig,d=o.property.mutableConfig;if(!l||!d)return;let u=l.mutableMaterials,c=d.mutableMaterials;if(u.length===c.length&&!(u.length<=0))for(let e=0;e<u.length;++e){let[t,i,n]=s(a,u[e].id);if(t<0||i<0)continue;let{tracks:l}=o;if(t>=l.length||i>l[t].segments.length)continue;let d=l[t].segments[i],h="";if(n>=0){if((0,r.Q2R)(d)){let e=d.material.textInfoResources;n>=e.length||(h=e[n].textMaterial.id)}}else(0,r.hey)(d)?h=d.material.id:(0,r.Ftn)(d)&&(h=d.material.id);c[e].id=h}},s=(e,t)=>{let i=!1,n=-1,a=-1,s=-1,{tracks:o}=e;for(n=0;n<o.length;++n){let{segments:e}=o[n];for(a=0;a<e.length;++a){let n=e[a];if((0,r.hey)(n)||(0,r.Ftn)(n)){if(n.material.id===t){i=!0;break}}else if((0,r.Q2R)(n)){for(let e of(s=0,n.material.textInfoResources)){if(e.textMaterial.id===t){i=!0;break}s++}if(i)break}}if(i)break}return!i&&(n=-1,a=-1,s=-1),[n,a,s]}},496287:function(e,t,i){i.d(t,{M:function(){return s}});var r=i(593642),n=i(426336),a=i(632858);let s=(e,t)=>{let i=new Map,s=e.draftView.getAllTracks().length,o=0,l=t.map(t=>{var r,o;let l=e.draftView.getDraftId(),d=a.v.instance.getData(l,t.segmentId),{trackType:u,needInsertTargetTrack:c}=t;if(c){let{flag:a}=null!==(r=e.draftView.getTrackBySegmentId(t.segmentId))&&void 0!==r?r:{};(i.get(t.targetTrackIndex)||t.targetTrackIndex>s+1)&&(t.targetTrackIndex=s+1),i.set(t.targetTrackIndex,{type:u,flag:a||n.w9k.FlagSubVideo,sourceTrackIndex:t.sourceTrackIndex}),t.targetTrackIndex>s&&(s=t.targetTrackIndex)}else t.targetTrackIndex>s&&(t.targetTrackIndex=s);return{...t,inTrackTypes:null!==(o=t.inTrackTypes)&&void 0!==o?o:[],pasteSegmentInfo:d}}),d=e.api.batch.batchStart(),u=e.draftView.getAllTracks();for(let[t,{type:a,flag:s}]of(i.size>0&&0===u.length&&e.api.track.add({trackIndex:0,track:new n.wOM({id:(0,r.Rl)(),type:n.pNd.TrackTypeVideo,flag:n.w9k.FlagNone})}),i)){let i=t;"audio"!==a?o++:i=t+o,e.api.track.add({trackIndex:i,track:new n.wOM({id:(0,r.Rl)(),type:a,flag:s})})}for(let e of l)"audio"===e.trackType?(e.targetTrackIndex+=o,e.sourceTrackIndex+=o):0!==e.sourceTrackIndex&&(e.sourceTrackIndex+=o);let c=e.api.segment.paste(l);return e.api.batch.batchEnd(d),c}},591010:function(e,t,i){i.d(t,{U:function(){return s},k:function(){return a}});var r,n,a=((r={}).Unknown="Unknow",r.Shortcut="Shortcut",r.Canvas="Canvas",r.Timeline="Timeline",r);var s=((n={})[n.Default=0]="Default",n[n.Click=1]="Click",n[n.DoubleClick=2]="DoubleClick",n[n.AddSegment=3]="AddSegment",n[n.SubDraftPanelClick=4]="SubDraftPanelClick",n)},625852:function(e,t,i){i.d(t,{g:function(){return n}});var r=i(690674);class n{get markerStore(){return this._timelineManagerStore[r.U_].axisMarkerStore}updateMarkers(e){this._timelineManagerStore[r.U_].axisMarkerStore.updateData(e)}deleteOneMarker(e){this._timelineManagerStore[r.U_].axisMarkerStore.deleteOne(e)}deleteAllMarkers(){this._timelineManagerStore[r.U_].axisMarkerStore.deleteAll()}constructor(e){this._timelineManagerStore=e}}},612183:function(e,t,i){i.d(t,{s:function(){return h}});var r=i(772322);i(966156),i(353772);var n=i(368100),a=i(199e3),s=i(150564),o=i(801497);i(74361);var l=i(690674),d=i(587892),u=i(402655);let c="never_remind_upload_and_quick_replace";class h extends u.JT{get qrCodeReplaceConfirm(){return this._qrCodeReplaceConfirm}addUploadingMaterials(e){this._uploadingMaterials.push(...e)}addLinkMaterial(e){this._uploadingMaterials.push(e),this._onLinkMaterialUploaded.fire(e)}removeMaterialTasks(){this._uploadingMaterials=[]}resetQrCodeStatus(){this._qrCodeReplaceConfirm=!1,this._uploadingMaterials=[]}get uploadingMaterialsLifecycles(){return this._uploadingMaterials}_setStatus(e){this._neverRemind&&(e?localStorage.setItem(c,"true"):this._neverRemind=!1),this._confirming=!1,this._modalInstance=void 0}_getUnfilledMutableVideos(){let e=this._dataSdk.draftView.getDraftId(),{subDraftId:t}=this._timlineManagerStore[l.qk],{draftIdToMutableVideos:i}=this._dataSdk.cutSame;return i[null!=t?t:e].filter(e=>!e.filled)}showModal(){if(0===this._getUnfilledMutableVideos().length)return Promise.resolve({ok:!1});if(localStorage.getItem(c))return Promise.resolve({ok:!0});{if(this._confirming)return Promise.resolve({ok:void 0});this._confirming=!0;let e=(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(a.Z,{defaultChecked:this._neverRemind,onChange:e=>{this._neverRemind=e},className:"replace-confirm-checkbox",children:`${o.ZP.t("web_batch_text_no_remind",{},"Don't remind me again next time")}`})});return new Promise(t=>{this._modalInstance=n.Z.confirm({title:o.ZP.t("web_batch_text_raplace_clips",{},"Replace clips with these media"),content:e,onOk:()=>{this._setStatus(!0),t({ok:!0})},okText:o.ZP.t("web_batch_button_confirm",{},"Confirm"),okButtonProps:{type:"primary"},onCancel:()=>{this._setStatus(!1),t({ok:!1})},cancelText:o.ZP.t("web_batch_button_cancle",{},"Cancel")})})}}showQrCodeUploadModal(e){return 0===this._getUnfilledMutableVideos().length?Promise.resolve({ok:!1}):new Promise(t=>{this._confirming&&t({ok:void 0}),n.Z.confirm({title:(0,r.jsxs)("div",{className:"replace-confirm-tips-modal-title",children:[(0,r.jsx)("div",{className:"replace-confirm-tips-modal-title_icon",children:(0,r.jsx)(s.Rrw,{color:"rgba(255, 175, 2, 1)",size:24})}),(0,r.jsx)("div",{children:o.ZP.t("web_same_editor_text_phone_replace",{num:e},"You\u2019re uploading media from your phone. Replace clips with this media?")})]}),icon:null,onOk:()=>{t({ok:!0}),this._qrCodeReplaceConfirm=!0,this._confirming=!1},okText:o.ZP.t("web_confirm",{},"Confirm"),okButtonProps:{type:"primary"},onCancel:()=>{t({ok:!1}),this._confirming=!1,this.resetQrCodeStatus()},cancelText:o.ZP.t("web_cancel",{},"Cancel")})})}constructor(e,t,i){super(),this._dataSdk=e,this._payInPayoutService=t,this._timlineManagerStore=i,this._neverRemind=!1,this._confirming=!1,this._uploadingMaterials=[],this._qrCodeReplaceConfirm=!1,this._modalInstance=void 0,this._onLinkMaterialUploaded=this._register(new d.Q),this.onLinkMaterialUploaded=this._onLinkMaterialUploaded.event,this._payInPayoutService.onDidOpen(()=>{var e;null===(e=this._modalInstance)||void 0===e||e.close(),this._confirming=!1})}}},10753:function(e,t,i){i.d(t,{P:function(){return a}});var r=i(843168),n=i(892230);class a extends r.J{get entities(){return[...this._tracks]}register(e){this._tracks=e.map(e=>({...e,get startY(){return this.refEl.y},get endY(){return this.refEl.y+this.refEl.height}})),this._sortTracks()}unregister(e){let t=[];return this._tracks=this._tracks.filter(i=>!e.includes(i.id)||(t.push(i),!1)),t}update(e){let t=this._tracks.find(t=>{let{id:i}=t;return i===e.id});t&&Object.assign(t,e)}replace(e){let t={...e,get startY(){return this.refEl.y},get endY(){return this.refEl.y+this.refEl.height}},i=this._tracks.findIndex(t=>{let{id:i}=t;return i===e.id});i>-1&&this._tracks.splice(i,1);let r=this._tracks.findIndex(t=>{let{index:i}=t;return i-e.index>=0});r=r>-1?r:this._tracks.length,this._tracks.splice(r,0,t)}find(e){return this._tracks.find(e)}findById(e){let t=this._tracks.findIndex(t=>t.id===e);return[this._tracks[t],t]}findBySegment(e){let[t]=this.context.registry.segment.findById(e);return t?this.findById(t.trackId):[void 0,-1]}findByIndex(e){let t=this._tracks.findIndex(t=>t.index===e);return[this._tracks[t],t]}findByRange(e){return this._tracks.filter(t=>(0,n.mK)(t.startY,[e[0],e[1]])||(0,n.vX)(t.endY,[e[0],e[1]])||(0,n.mK)(e[0],[t.startY,t.endY])||(0,n.mK)(e[1],[t.startY,t.endY]))}_sortTracks(){this._tracks.sort((e,t)=>e.index-t.index)}constructor(...e){super(...e),this._tracks=[]}}},441181:function(e,t,i){i.d(t,{b:function(){return a}});var r=i(112825),n=i(700933);class a{getRefElStyle(e){let{refEl:t}=e;return{left:t.x,width:t.width}}updateRefElStyle(e,t){void 0!==t.x&&(t.x=Math.max(t.x,0)),this._context.event.emit(r.B.updateStyle,{id:e.id,...t})}batchUpdateStyle(e){this._context.event.emit(r.B.batchUpdateStyle,e)}cleanSegmentsTransform(e){this.batchUpdateStyle(e.map(e=>({id:e.id,x:this._context.unit.us2px(e.start)})))}cleanTransform(e){let t=[];e.forEach(e=>{let i=this._context.registry.segment.findByTrack(e.id);[...i,...this._context.registry.transition.findByTrack(e.id)].forEach(e=>{t.push({id:e.id,x:this._context.unit.us2px(e.start)})})}),this.batchUpdateStyle(t)}replaceHoverPlaceholderTrack(e,t){[].concat(e).forEach(e=>{(0,n.Oe)(e,this._context.store.mainTrack)&&this._context.event.emit(r.B.updateData,{id:e.id,replaceHover:t})})}keyframeKeepActive(e){this._context.event.emit(r.B.keyframeKeepActive,e)}constructor(e){this._context=e}}},362220:function(e,t,i){i.d(t,{Z:function(){return l}});var r=i(907031),n=i(969242),a=i(857670),s=i(722169),o=i(379939);let l=class e{get zoom(){return this.context.store.zoom}establish(){var e;this._fetchContainerSize(),window.addEventListener("scroll",this._fetchContainerSize),null===(e=document.querySelector("body"))||void 0===e||e.addEventListener("scroll",this._fetchContainerSize),window.addEventListener("resize",this._fetchContainerSize);let{layoutManager:t}=this.context.userConfig.modules,i=()=>{t.resizeBox&&(this._containerResizeDisposer=new ResizeObserver(this._fetchContainerSize),this._containerResizeDisposer.observe(t.resizeBox))};i(),t.onDidLayoutUpdate(()=>{var e;null===(e=this._containerResizeDisposer)||void 0===e||e.disconnect(),this._containerResizeDisposer=void 0,i()});let r=document.getElementById(o.h);r&&(this._timelinetMutationDisposer=new MutationObserver(e=>{for(let t of e)"attributes"===t.type&&"class"===t.attributeName&&(this._fetchContainerSize(),this.context.registry.placeholder.refreshBlockPosition())}),this._timelinetMutationDisposer.observe(r,{attributes:!0,attributeFilter:["class"]})),this._fetchContainerSize(),this._initContainerScroll()}relinquish(){var e,t;window.removeEventListener("scroll",this._fetchContainerSize),window.removeEventListener("resize",this._fetchContainerSize),null===(e=this._containerResizeDisposer)||void 0===e||e.disconnect(),this._containerResizeDisposer=void 0,null===(t=this._timelinetMutationDisposer)||void 0===t||t.disconnect(),this._timelinetMutationDisposer=void 0}us2px(e){return(0,n.vY)(this.zoom,e)}px2us(e){return(0,n.TF)(this.zoom,e)}relative2absolute(e){let{x:t,y:i}=e;return{x:t-this.scrollLeft,y:i-this.scrollTop}}absolute2relative(e){let{x:t,y:i}=e;return{x:t+this.scrollLeft,y:i+this.scrollTop}}absolute2fixed(e){let{x:t,y:i}=e;return{x:t+this._screenLeft+this.context.store.operationWidth,y:i+this._screenTop+r.St}}fixed2absolute(e){let{x:t,y:i}=e;return{x:t-this._screenLeft-this.context.store.operationWidth,y:i-this._screenTop-r.St}}relative2fixed(e){let{x:t,y:i}=e;return{x:t+this._screenLeft-this.scrollLeft+this.context.store.operationWidth,y:i+this._screenTop-this.scrollTop+r.St}}fixed2relative(e){let{x:t,y:i}=e;return{x:t-this._screenLeft+this.scrollLeft-this.context.store.operationWidth,y:i-this._screenTop+this.scrollTop-r.St}}roundMouseTime(e){return this.zoom>=1e3?e:(0,a.i1)(e,"floor")}_initContainerScroll(){if(!!this.context.store.container&&!!this.context.store.vertivalContainer)this.scrollLeft=this.context.store.container.scrollLeft,this.scrollTop=this.context.store.vertivalContainer.scrollTop}constructor(e){this.containerWidth=0,this.containerHeight=0,this.scrollLeft=0,this.scrollTop=0,this._screenLeft=0,this._screenTop=0,this.fetchScroll=e=>{e?this.scrollLeft=this.context.store.container.scrollLeft:this.scrollTop=this.context.store.vertivalContainer.scrollTop},this._fetchContainerSize=(0,s.debounce)(()=>{if(!this.context.store.container)return;let{top:e,left:t,width:i,height:r}=this.context.store.container.getBoundingClientRect();this._screenTop=e+window.scrollY,this._screenLeft=t+window.scrollX,this.containerWidth=i,this.containerHeight=r},100),this.context=e}}},509955:function(e,t,i){i.d(t,{Z:function(){return n}});var r=i(260963);let n=class e{stage(e){this._state=e}reset(){this._state="default"}setContainer(e){this._container=e}_removeClassList(){if(this._container){let{classList:e}=this._container;for(let t of Array.from(e))t.startsWith("cursor-segment-")&&e.remove(t)}}constructor(e){this._context=e,this._state="default",this._container=null,this.switchCursor=e=>{if(!!this._container)switch(this._removeClassList(),e){case"insert":this._container.classList.add("cursor-segment-insert");break;case"edge-front":this._container.classList.add("cursor-segment-front");break;case"edge-rear":this._container.classList.add("cursor-segment-rear");break;case"drag":this._container.classList.add("cursor-segment-drag");break;case"ew-resize":this._container.classList.add("cursor-segment-ew-resize");break;case"disable":this._container.classList.add("cursor-segment-disable");break;case"drag-cursor":this._container.classList.add("cursor-segment-drag-cursor")}},(0,r.ky)(this),(0,r.U5)(()=>this._state,this.switchCursor)}}},193330:function(e,t,i){i.d(t,{A:()=>b});var r=i("789786"),n=i("202426"),a=i("928261"),s=i("804497"),o=i("858151"),l=i("969167"),d=i("700933"),u=i("426336");function c(e,t){let{segmentId:i,trackId:r}=e;switch(t.type){case"start":case"duration":return{...(0,u.mFk)({segId:i,clipType:"start"===t.type?u.ZXd.ClipStart:u.ZXd.ClipDuration,clipTime:t.value}),trackId:r};case"spread":return{segId:i,duration:t.value};default:throw Error("unknown crop type")}}var h=i("936154"),g=i("690674"),m=i("695324"),p=i("970930"),f=i("545797"),_=i("230689"),v=i("108692"),y=i("896413"),M=i("800788"),S=i("13751"),w=i("248283"),T=i("801497");class b{setRenderer(e){this._renderer=e}handleSegmentCropping(e){var t,i;this._store[g.U_].setIsCroping(!0),null===(t=this._renderer)||void 0===t||t.updateDataById(e.segment.id,{cropSituation:e}),null===(i=this._renderer)||void 0===i||i.events.interact.emit(n.TY.onSegmentCropping,e)}handleSegmentCrop(e,t){var i,r,n,a,u,f,_,y,M,S,w,T,b;let k,x;let{environment:I,draftOperation:R}=this._modules,{isTemplate:C}=I,D="start"===t.type;if(null===(i=this._renderer)||void 0===i||i.updateDataById(t.segment.id,{cropSituation:void 0}),C?(k=(0,s.kt)(this._store[g.U_].tracksMutable,{id:t.segment.id}),x=(0,o.Lo)(this._store[g.U_].tracksMutable,{id:t.segment.id})):(k=(0,s.kt)(this._store[g.U_].tracks,{id:t.segment.id}),x=(0,o.Lo)(this._store[g.U_].tracks,{id:t.segment.id})),0!==x&&!(0,l.Jj)(this._store[g.U_].quickImportSegmentsSub,{...k,...D?{start:t.value}:{duration:t.value-(null!==(r=null==k?void 0:k.start)&&void 0!==r?r:0n)}},"crop"))return;let A=this._store[g.qk].segmentSelected[0];if((null==k?void 0:k.type)==="mutableAudio"&&C){let i={segmentId:k.id,musicName:k.title,duration:null==k?void 0:null===(n=k.prolong)||void 0===n?void 0:n.total};if("start"===t.type?(i.targetTime={start:t.value,duration:k.duration+(k.start-t.value)},i.sourceTime={start:(null!==(M=null===(y=k.prolong)||void 0===y?void 0:y.start)&&void 0!==M?M:0n)-(k.start-t.value),duration:k.duration+(k.start-t.value)}):"duration"===t.type&&(i.targetTime={start:k.start,duration:t.value-k.start},i.sourceTime={start:null!==(w=null===(S=k.prolong)||void 0===S?void 0:S.start)&&void 0!==w?w:0n,duration:t.value-k.start}),k.start=null!==(T=null===(a=i.targetTime)||void 0===a?void 0:a.start)&&void 0!==T?T:0n,k.duration=null!==(b=null===(u=i.targetTime)||void 0===u?void 0:u.duration)&&void 0!==b?b:0n,!(null===(f=i.targetTime)||void 0===f?void 0:f.duration)||!(null===(_=i.sourceTime)||void 0===_?void 0:_.duration))return;let r=R.batchStart();R.mutable.updateMutableAudios([i]),this._handleVocal(k.id,e),R.batchEnd(r)}else{(0,m.b)(this._containerService,{relatedEvent:m.Z.CutMaterialSegment});let i=(0,o.ql)(this._store[g.U_].tracks[x][0].segments,{clipTime:t.value,segment:A,type:t.type,trackIndex:x}),r=x>0&&i.length;if(this._store[g.U_].segmentCrop(A,t),r){let[r,n]=(0,d.c6)(R.tracks,t.segment.id),a=D?null==r?void 0:r.transition:null==n?void 0:n.transition;setTimeout(()=>{let n=R.batchStart();R.segment.multiSegmentMove(i),R.segment.segmentTimeRangeUpdate(c({segmentId:A.id,trackId:t.segment.trackId},t)),this._handleVocal(A.id,e),a&&(D?r:A)&&R.transition.addTransition({...a,segId:D?r.id:A.id}),R.batchEnd(n)},0)}else{let e=R.batchStart();R.segment.segmentTimeRangeUpdate(c({segmentId:A.id,trackId:t.segment.trackId},t)),R.batchEnd(e)}this._store[g.U_].setIsCroping(!1);let n=this._containerService.invokeFunction(e=>e.get(v.n)).dataSdk.draftView.getSegmentById(A.id);if(n){let e=(0,h.q)(n);(0,p.y)(this._containerService,{...e,absorb_status:this._store[g.U_].absorbStatus})}}}handleTransitionCrop(e){(0,m.b)(this._containerService,{relatedEvent:m.Z.CutMaterialSegment});let t=this._store[g.qk].segmentSelected[0];this._store[g.U_].segmentTransitionCrop({id:t.id},e),this._modules.draftOperation.transition.updateTransition(c({segmentId:e.transition.segmentId,trackId:e.transition.trackId},e));let i=this._containerService.invokeFunction(e=>e.get(v.n)).dataSdk.draftView.getSegmentById(e.transition.segmentId);if(i){let e=(0,h.q)(i,!0);(0,p.y)(this._containerService,{...e,absorb_status:this._store[g.U_].absorbStatus})}}handleAttach(e){return(t,i)=>{(0,a.Xe)(i)&&this._modules.draftOperation.transition.addTransitionByDragData(t,e.id)}}_handleVocal(e,t){let i=this._modules.dataSdk.draftView.getSegmentById(e);if(i&&((0,u.hey)(i)||(0,u.Y9Q)(i))){let r=i.sourceTimerange.start,n=i.sourceTimerange.duration,a=r+n;if(n>15n*60n*1000n*1000n){i.vocalSeparation&&i.vocalSeparation.choice!==u.ZTd.None&&(this._mainEditorWidgetService.smartToolsManager.removeVocalSeparation(i),t.normal(T.ZP.t("web_isolate_removed_clip_too_long",{},"Voice isolation removed because the clip is longer than 15 minutes"))),i.vocalBeautify&&i.vocalBeautify.enable&&(this._mainEditorWidgetService.smartToolsManager.removeVocalBeautify(i),t.normal(T.ZP.t("web_enhance_voice_toast_enhancement_removed",{},"Voice enhancement removed because the clip is longer than 15 minutes")));return}if(i.vocalSeparation&&i.vocalSeparation.choice!==u.ZTd.None&&i.vocalSeparation.timeRange&&(r<i.vocalSeparation.timeRange.start||a>i.vocalSeparation.timeRange.start+i.vocalSeparation.timeRange.duration)){let{material:r}=i,{start:a}=i.sourceTimerange,{duration:s}=i.sourceTimerange,o=a+s;n<10n*60n*1000n*1000n?o=(a=a-5000000n>0n?a-5000000n:0n)+s+5000000n<=r.duration?a+s+5000000n:r.duration:(a=0n,o=r.duration),t.normal(T.ZP.t("web_isolate_re_isolating",{},"Re-isolating voice...")),this._mainEditorWidgetService.smartToolsManager.setVocalSeparation({segment:i,mode:this._mapMode(i.vocalSeparation.choice),timeRange:[a,o],touchPointer:S.V.CROP},t=>{let i=this._modules.dataSdk.draftView.getSegmentById(e);i&&((0,u.hey)(i)||(0,u.Y9Q)(i))&&t&&this._mainEditorWidgetService.playerManager.rangePlay(i.targetTimerange.start,i.targetTimerange.start+i.targetTimerange.duration,!0)});return}if(i.vocalBeautify&&i.vocalBeautify.enable&&i.vocalBeautify.timeRange&&(r<i.vocalBeautify.timeRange.start||a>i.vocalBeautify.timeRange.start+i.vocalBeautify.timeRange.duration)){let{material:t}=i,{start:r}=i.sourceTimerange,{duration:a}=i.sourceTimerange,s=r+a;n<10n*60n*1000n*1000n?s=(r=r-5000000n>0n?r-5000000n:0n)+a+5000000n<=t.duration?r+a+5000000n:t.duration:(r=0n,s=t.duration),this._mainEditorWidgetService.smartToolsManager.setVocalBeautify({enable:!0,segment:i,step:i.vocalBeautify.ambientSoundLevel,timeRange:[r,s],touchPointer:w.J.CROP},t=>{let i=this._modules.dataSdk.draftView.getSegmentById(e);i&&((0,u.hey)(i)||(0,u.Y9Q)(i))&&t&&this._mainEditorWidgetService.playerManager.rangePlay(i.targetTimerange.start,i.targetTimerange.start+i.targetTimerange.duration,!0)})}}}_mapMode(e){switch(e){case u.ZTd.None:return f.gx.NONE;case u.ZTd.Vocal:return f.gx.HUMAN;case u.ZTd.Background:return f.gx.BACKGROUND;default:(0,M.bP)(e)}}constructor(e,t,i,r){this._store=e,this._modules=t,this._containerService=i,this._mainEditorWidgetService=r,this._renderer=null}}b=(0,r.gn)([(0,r.fM)(2,_.t),(0,r.fM)(3,y.a),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineManagerModules?Object:TimelineManagerModules,void 0===_.t?Object:_.t,void 0===y.a?Object:y.a])],b)},656494:function(e,t,i){i.d(t,{Xe:function(){return l},ar:function(){return d},so:function(){return u}});var r=i(426336),n=i(29188),a=i(786013),s=i(724081),o=i(799985);function l(e){var t,i,o,l,d,u;let{segmentCO:c,controllerManager:h}=e,{style:g,data:{track:m,segmentIndex:p,trackIndex:f,segment:_}}=c,{modules:v}=h,y=_.slots.find(e=>"transition"===e.type),M=null===(t=m.segments[p-1])||void 0===t?void 0:t.slots.find(e=>"transition"===e.type),{start:S,duration:w}=_,T=(0,a.O)(_,m.segments,f),b=(0,s.vV)(_,v.draftOperation),{keyframeGroup:k}=c,x="segment";return"mutableAudio"===_.type?x=_.type:_.mutable&&(x="mutable"),{id:_.id,registeredType:x,type:_.type,trackId:m.id,prolongStart:null===(i=_.prolong)||void 0===i?void 0:i.start,prolongDuration:null===(o=_.prolong)||void 0===o?void 0:o.duration,prolongTotal:null===(l=_.prolong)||void 0===l?void 0:l.total,start:S,duration:w,availAttach:T,handleAttach:h.crop.handleAttach(_),handleAttachHover:console.log,availReplace:h.replace.getAvailReplace(_),handleReplace:h.replace.getHandleReplace(_),handleReplaceHover:h.replace.getHandleReplaceHover(_),handleReplaceBlur:h.replace.getHandleReplaceBlur(_),handleCrop:h.crop.handleSegmentCrop.bind(h.crop,v.timelineUI.toast),handleCroping:h.crop.handleSegmentCropping.bind(h.crop),prevTransition:M,transition:y,cropMin:(null===(d=_.animations)||void 0===d?void 0:d.length)?r.pMA.times(n.CZ,2,"bigint"):BigInt(0),refEl:g,refTimes:b,keyframeMap:_.keyframesMap,keyframeInfos:null!==(u=null==k?void 0:k.children.filter(e=>e.data&&e.style).map(e=>({value:e.data.keyframeVal,refEl:e.style})))&&void 0!==u?u:[]}}function d(e){let{transitionCO:t,controllerManager:i}=e,{style:n,data:{transition:a,track:s,nextSegment:l,segment:d}}=t,u=d.start+d.duration-r.pMA.div(a.duration,2,"bigint"),c=l?(0,o.s2)(d.duration,l.duration):a.duration;return{id:a.id,start:u,duration:a.duration,prolongStart:r.pMA.div(c-a.duration,2,"bigint"),prolongDuration:a.duration,prolongTotal:c,isOverlap:a.isOverlap,registeredType:"transition",trackId:s.id,segmentId:d.id,segmentStart:d.start,segmentDuration:d.duration,handleCrop:i.crop.handleTransitionCrop.bind(i.crop),refEl:n}}function u(e){let{segmentCO:t,controllerManager:i}=e,{style:r,data:{segment:n}}=t;return{registeredType:"placeholder",refEl:r,id:n.id,zIndex:0,availAttach:[],availReplace:["audio","video"],handleAttach:console.log,handleAttachHover:console.log,handleReplace:i.replace.getHandleReplacePlaceholder(n),handleReplaceHover:i.replace.getHandleReplaceHover(n),handleReplaceBlur:i.replace.getHandleReplaceBlur(n)}}},571657:function(e,t,i){i.d(t,{k:function(){return u}});var r=i(620266),n=i(426336),a=i(136498),s=i(690674),o=i(68659),l=i(345299),d=i(800788);let u={name:"tracks-default",runner:(e,t,i)=>{let{sourceFrom:u,value:c}=t,{dataSdk:h,store:g,mode:m}=i;if(m!==r.s.TRACKS||u!==r.G.DATA_SDK)return;let{segment:p,track:f}=e,{[n.u4I.SEGMENT]:_,[n.u4I.TRACK]:v}=c,y=new Map,M=new Map;_.forEach(e=>{let t;let{item:i,type:r}=e,{path:a}=i;if(!a||a.length<=1){t=r===n.C8.ADD?i.segment.id:i.id;let a=y.get(t);!a&&y.set(t,a=[]),a.push(e)}}),v.forEach(e=>{let{item:t}=e,i=t.trackId,r=M.get(i);!r&&M.set(i,r=[]),r.push(e)}),[...y.entries()].forEach(e=>{var t;let i,[r,n]=e,{segment:u,trackId:c=null,index:m=-1}=null!==(t=(0,a.VV)(r,h))&&void 0!==t?t:{},f=(0,a.pP)(g[s.U_].tracks,r),_=f.segment,v=f.index,y=f.trackId,M=null;switch(u&&(M=(0,o.tr)(u,h)),(0,a.tA)(_,M)){case l.P.ADD:(0,d.Y2)(M),(0,d.Y2)(c),i={nextIndex:m,nextTrackId:c,nextValue:M,notifyOperationList:n,prevIndex:-1,prevTrackId:null,prevValue:null,type:l.P.ADD};break;case l.P.UPDATE:(0,d.Y2)(M),(0,d.Y2)(_),(0,d.Y2)(c),(0,d.Y2)(y),i={nextIndex:m,nextTrackId:c,nextValue:M,notifyOperationList:n,prevIndex:v,prevTrackId:y,prevValue:_,type:l.P.UPDATE};break;case l.P.DELETE:(0,d.Y2)(_),(0,d.Y2)(y),i={nextIndex:-1,nextTrackId:null,nextValue:null,notifyOperationList:n,prevIndex:v,prevTrackId:y,prevValue:_,type:l.P.DELETE};break;default:(0,d.ss)()}p.push(i)}),[...M.entries()].forEach(e=>{var t;let i,[r,n]=e,u=h.draftView.getTrackById(r,!1),{track:c=null,index:m=-1}=null!==(t=(0,a.yG)(g[s.U_].tracks,r))&&void 0!==t?t:{},p=null,_=-1;if(u&&(p=(0,o.zz)(u),_=h.draftView.getTrackIndexById(r)),!!c||!!p){switch((0,a.tA)(c,p)){case l.P.ADD:(0,d.Y2)(p),i={type:l.P.ADD,prevValue:null,nextValue:p,prevIndex:-1,nextIndex:_,notifyOperationList:n};break;case l.P.UPDATE:(0,d.Y2)(p),(0,d.Y2)(c),i={type:l.P.UPDATE,prevValue:c,nextValue:p,prevIndex:m,nextIndex:_,notifyOperationList:n};break;case l.P.DELETE:(0,d.Y2)(c),i={type:l.P.DELETE,prevValue:c,nextValue:null,prevIndex:m,nextIndex:-1,notifyOperationList:n};break;default:(0,d.ss)()}f.push(i)}})}}},828890:function(e,t,i){i.d(t,{o:function(){return f},q:function(){return p}});var r=i(426336),n=i(690674),a=i(857670),s=i(804497),o=i(80140),l=i(458321),d=i(928261),u=i(632555),c=i(800788),h=i(794720),g=i(394236);let m=(e,t,i)=>{let{id:n,targetTimerange:s}=e,o=i.draftView.getPlayHeadByKeyframeTimeOffset(n,t),l=r.pMA.div(o,a.G8,"number","round"),d=Math.round(l),u=Math.floor(r.pMA.div(r.pMA.plus(s.start,s.duration),a.G8,"number"));return l<=u&&d>=u&&(d=u),d},p=(e,t)=>{let i=new Map,{segmentId:n,commonKeyframes:a}=e,s=t.draftView.getSegmentById(n);(0,c.Y2)(s),a.forEach(e=>{var r;let n=e.propertyType;null===(r=e.keyframeList)||void 0===r||r.forEach((e,r)=>{let{timeOffset:a,id:o}=e;if(void 0!==a&&o){let e=m(s,a,t);if(i.has(a)){var l,d;let t=i.get(a),s=null!==(l=null==t?void 0:t.keyframe_types)&&void 0!==l?l:[];s.push(n);let u=null!==(d=null==t?void 0:t.keyframe_details)&&void 0!==d?d:[];u.push({id:o,type:n,index:r}),i.set(a,{frame:e,offset:a,keyframe_types:s,keyframe_details:u})}else i.set(a,{frame:e,offset:a,keyframe_types:[n],keyframe_details:[{id:o,type:n,index:r}]})}})});let o=Array.from(i.keys()).sort((e,t)=>r.pMA.minus(e,t)),l=new Map;return o.forEach((e,t)=>{var r,n;let a=-1,s=-1,d=i.get(e);if(t>0){let e=i.get(o[t-1]);a=null!==(r=null==e?void 0:e.frame)&&void 0!==r?r:-1}if(t<o.length-1){let e=i.get(o[t+1]);s=null!==(n=null==e?void 0:e.frame)&&void 0!==n?n:-1}if(d){let i={...d,currentKeyframeIndex:t};a>=0&&(i.preKeyframeFrameIndex=a),s>=0&&(i.nextKeyframeFrameIndex=s),l.set(e,i)}}),l};class f{copyKeyFrame(e){let{keyframeStore:t,tracks:i}=this._store[n.U_],{keyframeSelectInfo:a}=t;if(!a)return;let{seg_id:l,keyframes_infos:d}=a,u=(0,s.kt)(i,{id:l});if(!u)return;t.setKeyframeCopyCacheSegment(u),t.setCacheKeyframeSelectInfo(a);let c=new Map;d.forEach(e=>{let{keyframe_details:t}=e;t.forEach(e=>{let{type:t,index:i}=e,n=c.get(t);if(n){var a,s;null===(a=n.selectedIndexs)||void 0===a||a.push(BigInt(i)),null===(s=n.selectedIndexs)||void 0===s||s.sort((e,t)=>r.pMA.minus(e,t)),c.set(t,n)}else c.set(t,{keyframeType:t,selectedIndexs:[BigInt(i)]})})}),(0,o.m)(this._dataSdk,{segId:l,keyframesInfo:Array.from(c.values())});let h=this._dataSdk.draftView.getSegmentById(l);h&&(0,g.Y)(this._containerService,h,a,"copy",e)}async deleteSelectedKeyFrame(e){let{keyframeStore:t,tracks:i}=this._store[n.U_],{keyframeSelectInfo:a}=t;if(!a)return;let{seg_id:o,keyframes_infos:l}=a;if((0,s.kt)(i,{id:o})){let i=new Map;try{l.sort((e,t)=>r.pMA.minus(e.offset,t.offset)).forEach(e=>{let{keyframe_details:t}=e;t.forEach(e=>{i.set(e.id,{segId:o,keyframeId:e.id,keyframeTypeList:[e.type]})})});let n=Array.from(i.values()),s=this._dataSdk.api.batch.batchStart();await Promise.all(n.map(e=>this._dataSdk.api.keyframe.delete({segmentId:e.segId,keyframeId:e.keyframeId,keyframeTypeList:e.keyframeTypeList}))),this._dataSdk.api.batch.batchEnd(s);let d=this._dataSdk.draftView.getSegmentById(o);d&&(0,g.Y)(this._containerService,d,a,"remove",e),t.setKeyframeSelectInfo(void 0)}catch(e){}}}getKeyframePlayHead(){let{segmentSelected:e}=this._store[n.qk],{progress:t}=this._store[n.U_];if(1!==e.length||!(0,d.IM)(e[0]))return t;let{keyframesMap:i,id:s}=e[0],o=Array.from(i.keys());if(!o.length)return t;let l=r.pMA.div(a.G8,2,"bigint","floor"),h=this._getKeyframeTimeOffsetByPlayHead(s,t);for(let e of((0,c.ZB)(h),o))if((0,u.mK)(e,[h-l,h+l]))return this._getRawPositionByTimeOffset(s,e);return t}pasteKeyframe(e){if(!this.canPasteKeyframe())return;let{keyframeStore:t}=this._store[n.U_],{segmentSelected:i}=this._store[n.qk],{keyframeCopyCacheSegment:r,cacheKeyframeSelectInfo:a}=t,s=r.id,o=i[0].id;(0,l.O)(this._dataSdk,{dstSegId:o,srcSegId:s,currentTime:this.getKeyframePlayHead()});let d=this._dataSdk.draftView.getSegmentById(s);d&&a&&(0,g.Y)(this._containerService,d,a,"paste",e)}canPasteKeyframe(){let{keyframeStore:e}=this._store[n.U_],{segmentSelected:t}=this._store[n.qk],{keyframeCopyCacheSegment:i,cacheKeyframeSelectInfo:r}=e;return!!(1===t.length&&(0,d.IM)(t[0])&&i&&this._isSameType(t[0],i))}setKeyframeSelectInfo(e){this._store[n.U_].keyframeStore.setKeyframeSelectInfo(e)}updateKeyframePlayHead(e){return Promise.resolve(void 0)}updateCommonKeyframe(e){this._dataSdk.api.keyframe.update({segmentId:e.segId,keyframeId:e.keyframeId,keyframeType:e.keyframeType,dataParam:e.dataParam})}getPlayHeadByKeyframeTimeOffset(e,t){return 0n}getFormatFrameWithSpeedMode(e,t){return m(e,t,this._dataSdk)}getKeyframeMap(e){return p(e,this._dataSdk)}_isSameType(e,t){return e.type===t.type&&("video"!==e.type||(0,h.r)(e.metaType)===(0,h.r)(t.metaType))}_getKeyframeTimeOffsetByPlayHead(e,t){let i="number"==typeof t?r.pMA.times(t,1e3,"bigint"):t,n=this._dataSdk.draftView.getSegmentById(e);if(n)return new r.b8q().getKeyframeTimeOffsetByTimeline(this._dataSdk.draftView,n,i)}_getRawPositionByTimeOffset(e,t){let i=this._dataSdk.draftView.getSegmentById(e);if(i)return new r.b8q().getTimelineByKeyframeTimeOffset(this._dataSdk.draftView,i,t)}constructor(e,t,i){this._dataSdk=e,this._store=t,this._containerService=i}}},32666:function(e,t,i){i.d(t,{F:function(){return a}});var r=i(690674),n=i(426336);class a{muteTrack(e,t){this._dataSdk.api.track.mute({trackId:e,muted:t})}isMainTrackMute(){return!!this._dataSdk.draftView.getDraftProperty().videoMute}isAllSubTrackMute(){let{subTrackIdToMuted:e}=this._store[r.U_];return e.size>0&&Array.from(e.values()).every(e=>e)}constructor(e,t){this._store=e,this._dataSdk=t,this._dataSdk.onChangeDiff(e=>{let t=this._dataSdk.draftView.getAllTracks().filter(e=>e.type===n.pNd.TrackTypeAudio||e.type===n.pNd.TrackTypeVideo),i=new Map,a=this._store[r.U_].subTrackIdToMuted,s=!1;for(let e of t)if(!(0,n.MDU)(e)){let t=!!(e.attribute&Number(n.$SW.MuteFlag));i.set(e.id,t),a.get(e.id)!==t&&(s=!0)}s&&this._store[r.U_].setSubTrackMutedMap(i);let o=!!this._dataSdk.draftView.getDraftProperty().videoMute;this._store[r.U_].setMainTrackMuted(o)})}}},671314:function(e,t,i){i.d(t,{C:function(){return a}});var r=i(426336),n=i(800788);class a{addTransition(e){this._dataSdk.api.video.setTransition(e)}addTransitionByDragData(e,t){this.addTransitionByTransitionSource(e.dragSource,t,e.delta)}addTransitionByTransitionSource(e,t,i){let a=this._dataSdk.draftView.getSegmentById(t);return(0,n.Y2)(a&&(0,r.hey)(a)),this._addSegmentManager.addTransition(e,a,i)}multiRemoveTransition(e){}removeTransition(e,t){}updateTransition(e){this._dataSdk.api.video.updateTransition(e)}constructor(e,t){this._addSegmentManager=e,this._dataSdk=t}}},22929:function(e,t,i){i.d(t,{z:function(){return o}});var r=i(789786),n=i(433140),a=i(820193),s=i(460254);class o{showModal(e){this._modalManager.showModal(e)}openMultiTrackSegmentTrimModal(e,t,i){if(![s.r.Photo,s.r.Video,s.r.UserVideo,s.r.UserPhoto].includes(i))return;let r=(0,a.nQ)(this._resourceService,i,t);this._modalManager.showMultiTrackTrimModal(e,r.key,i)}openMutableSegmentTrimModal(e,t){this._modalManager.showMutableTrimModal(e,t)}openMutableSegmentCropModal(e,t){this._modalManager.showMutableCropModal(e,t,"track")}constructor(e,t){this._modalManager=e,this._resourceService=t}}o=(0,r.gn)([(0,r.fM)(1,n.c),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ModalManager?Object:ModalManager,void 0===n.c?Object:n.c])],o)},37197:function(e,t,i){i.d(t,{n:function(){return s}});var r=i(928261),n=i(153107),a=i(827084);class s{get groupMap(){return this._groupMap}build(e){let{action:t,segment:i,templateResourceKey:s}=e,o="add"===t?this._addRelation.bind(this):this._removeRelation.bind(this),l=["audio","mutableAudio"].includes(i.type)?"waves":"thumbnails",d="add"===t?e=>{var t;return null===(t=this._groupMap.get(l))||void 0===t?void 0:t.add(e)}:e=>{var t;return null===(t=this._groupMap.get(l))||void 0===t?void 0:t.delete(e)};if("combination"===i.type){var u;let e=(0,a.Bc)(null!==(u=i.templateId)&&void 0!==u?u:"");e&&o(e,i.id)}if(["video","audio","combination"].includes(i.type))o((0,n.$Q)(i,this._draftPathStore),i.id),d(i.id);else if(["mutable","mutablePoly","mutableAudio"].includes(i.type)){if("end-limit"===i.id)return;o((0,n.$Q)(i,this._draftPathStore),i.id),d(i.id),(0,r.gG)(i.mutable)&&o(i.mutable.mutableId,i.id),s&&o(s,i.id),(0,r.rE)(i.mutable)&&(o(i.id,i.id),i.mutable.children.forEach(e=>{o((0,n.$Q)(e,this._draftPathStore),i.id),(0,r.gG)(e.mutable)&&o(e.mutable.mutableId,i.id)})),(0,r._n)(i.mutable)&&o(i.id,i.id)}}reset(){this._resourceKey2SegmentIds.clear(),this._groupMap.set("thumbnails",new Set),this._groupMap.set("waves",new Set)}getSegmentIdByResourceKey(e){return this._resourceKey2SegmentIds.get(e)}_addRelation(e,t){if(!!e)this._resourceKey2SegmentIds.has(e)?this._resourceKey2SegmentIds.get(e).add(t):this._resourceKey2SegmentIds.set(e,new Set([t]))}_removeRelation(e,t){let i=this._resourceKey2SegmentIds.get(e);i&&(i.delete(t),0===i.size&&this._resourceKey2SegmentIds.delete(e))}constructor(e){this._draftPathStore=e,this._groupMap=new Map,this._resourceKey2SegmentIds=new Map,this._groupMap.set("thumbnails",new Set),this._groupMap.set("waves",new Set)}}},58781:function(e,t,i){i.d(t,{U:function(){return n}});var r,n=((r={}).Photo="Photo",r.Video="Video",r)},36982:function(e,t,i){i.d(t,{m:function(){return c}});var r=i(789786),n=i(587892),a=i(849002),s=i(800788),o=i(690674),l=i(425427),d=i(108692),u=i(426336);class c{get onTemplateInfoLoaded(){return this._onTemplateInfoLoaded.event}get templateIdToInfo(){return this._store[o.jU].templateIdToInfo}async bootstrap(){await this._refreshTemplateInfo(),this._bootstrapBarrier.open(),this._onTemplateInfoLoaded.fire(this._store[o.jU].templateIdToInfo)}async getTemplateInfo(e){(0,s.Y2)(this._bootstrapBarrier.isOpen(),"get template should called after bootstrap");let t=await this._mainDraftService.draftTemplateManager.getTemplate(e);return this._store[o.jU].setTemplateInfo(e,t),t}async _refreshTemplateInfo(){if(!(0,l.xA)(this._environmentService))if((0,l.JY)(this._environmentService)){let{currentTemplateId:e}=this._environmentService;(0,s.Y2)(e),this._store[o.jU].setTemplateInfo(e,await this._mainDraftService.draftTemplateManager.getTemplate(e))}else this._dataSdk.draftView.getAllSegments().filter(u.duj).map(e=>e.templateId).forEach(async e=>{this._store[o.jU].setTemplateInfo(e,await this._mainDraftService.draftTemplateManager.getTemplate(e))})}constructor(e,t,i,r){this._dataSdk=e,this._store=t,this._environmentService=i,this._mainDraftService=r,this._onTemplateInfoLoaded=new n.Q,this._bootstrapBarrier=new a.U}}c=(0,r.gn)([(0,r.fM)(2,l.rO),(0,r.fM)(3,d.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,void 0===l.rO?Object:l.rO,void 0===d.n?Object:d.n])],c)},791727:function(e,t,i){i.d(t,{W:()=>Y});var r=i("789786"),n=i("772322"),a=i("176022"),s=i("801497"),o=i("989719"),l=i("276513"),d=i("813072"),u=i("218571"),c=i("523267"),h=i("80539");let g="multi-track-tips-example-tUfTu1",m=()=>{let[e]=(0,c.Fg)();return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:s.oc.t("web_textvideo_toast_drag_to_replace",{},"You can drag to quick replace the current materials ")}),(0,n.jsxs)("div",{className:g,children:[(0,n.jsx)("img",{src:(h.Q.Dark,"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/common/images/replace_video_tips_dark.png")}),(0,n.jsx)("span",{children:s.oc.t("web_textvideo_button_replace",{},"Replace")})]})]})};var p=i("690674");i("353772");var f=i("199000"),_=i("729596");let v="nolonger-notice-ckWGhi",y="cut-same-tips-container-ntzpBx",M="cut-same-tips-title-dXtcPi",S="cut-same-tips-header-zbnq_q",w="cut-same-tips-desc-plQ2kI",T="cut-same-tips-content-q2E6dj",b=e=>(0,n.jsx)("div",{className:y,children:(0,n.jsx)("div",{className:M,children:e})}),k=(e,t)=>(0,n.jsxs)("div",{className:y,children:[(0,n.jsx)("div",{className:S,children:e}),(0,n.jsx)("div",{className:w,children:t})]}),x=(e,t)=>(0,n.jsxs)("div",{className:y,children:[(0,n.jsx)("div",{className:S,children:e}),(0,n.jsx)("div",{className:w,children:t}),(0,n.jsx)("div",{className:T,children:(0,n.jsx)("video",{src:"//lf16-web-buz.capcut.com/obj/capcut-web-buz-sg/ies/lvweb/video_online/upload/edit-tips.mp4",autoPlay:!0,loop:!0})})]}),I=(e,t)=>(0,n.jsxs)("div",{className:y,children:[(0,n.jsx)("div",{className:S,children:e}),(0,n.jsx)("div",{className:w,children:t}),(0,n.jsx)("div",{className:T,children:(0,n.jsx)("video",{src:"//lf16-web-buz.capcut.com/obj/capcut-web-buz-sg/ies/lvweb/video_online/upload/timeline-mode-entry-tips.mp4",autoPlay:!0,loop:!0})})]}),R=(e,t)=>(0,n.jsxs)("div",{className:y,children:[(0,n.jsx)("div",{className:S,children:e}),(0,n.jsx)("div",{className:w,children:t}),(0,n.jsx)("div",{className:T,children:(0,n.jsx)("video",{src:"//lf16-web-buz.capcut.com/obj/capcut-web-buz-sg/ies/lvweb/video_online/upload/same-materials-fill-tips.mp4",autoPlay:!0,loop:!0})})]}),C=e=>{let{info:t,setNoLongerNotice:i}=e,[r,a]=(0,u.useState)(!0),o="";if("trim"===t.type){let e=_.h.usToSecond(t.value).toFixed(1);o=s.ZP.t("web_cropped_to_x_seconds",{placeholder0:e},"Video trimmed to {placeholder0}s and added to slot")}else{let e=t.value.toFixed(1);o=s.ZP.t("web_adjusted_to_x_speed",{placeholder0:e},"Video added to slot with its speed adjusted to {placeholder0}")}let l=(0,u.useCallback)(e=>{a(e),null==i||i(e)},[i]);return(0,n.jsxs)("div",{className:y,children:[(0,n.jsx)("div",{className:M,children:o}),(0,n.jsx)("div",{className:v,children:(0,n.jsx)(f.Z,{checked:r,onChange:l,children:s.ZP.t("web_no_more_prompts_next_time",{},"\u4E0B\u6B21\u4E0D\u518D\u63D0\u793A")})})]})},D=e=>{let{store:t}=e,{maxMaterialsCountsForMutableVideo:i=0}=t[p.U_]||{};return(0,n.jsx)("div",{className:w,children:s.ZP.t(i<2?"web_same_editor_text_replace_clip":"web_same_editor_text_replace_clips",{count1:()=>(0,n.jsx)("span",{children:i},"count1")},i<2?"Upload <count1>0</count1> media to replace the clip":"Upload <count1>0</count1> media to replace the clips")})},A=e=>{let{store:t}=e;return(0,n.jsxs)("div",{className:y,children:[(0,n.jsx)("div",{className:S,children:s.ZP.t("web_same_editor_title_quick_replace",{},"Quickly replace clips")}),(0,n.jsx)(D,{store:t})]})};var P=i("230689"),E=i("464533"),N=i("136877"),j=i("700933"),O=i("426336"),L=i("183346"),B=i("108692"),F=i("323937"),U=i("49191"),V=i("999268"),Z=i("763832"),G=i("161637");let z="guide-timeline-dom";class Y{start(){this._store[p.U_].isTemplate?(this.showTemplateGuide(),this._showAutoReplaceGuideIfNeed(),this._showToggleTimelineModeEntryIfNeed()):this._showTextToVideoGuideIfNeed(),this._showAIGCGuide()}async showGuideIfNeed(e){}showEmptyTrackGuide(e){this._guideService.trigger({key:L.F3.AddVideoToEmptyTrack,steps:[{target:()=>this._selectInsertedTrack(e),title:s.ZP.t("web_textvideo_title_add_media",{},"Add media"),content:s.ZP.t("web_textvideo_text_user_created",{},"Use your own media to create videos."),placement:"tl",showCloseIcon:!0,confirm:this._destroyGuideDom.bind(this),cancel:this._destroyGuideDom.bind(this)}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),placeholderRadius:8})}showFirstToReplaceVideoGuide(e){this._guideService.trigger({key:L.F3.FirstToReplaceVideo,steps:[{target:".lv-layout-sider",title:s.ZP.t("web_textvideo_text_edit_your_script",{},"Edit your script"),content:s.ZP.t("web_textvideo_toast_edit_script_here",{},"You can edit your script here. The text to speech will refresh with text update"),placement:"right",showCloseIcon:!0,confirm:o.Z},{target:()=>this._selectInsertedSegment(e),title:s.ZP.t("web_textvideo_toast_drag_drop_clips",{},"Drag to replace materials"),content:(0,u.createElement)(m),placement:"tl",showCloseIcon:!0,confirm:this._destroyGuideDom.bind(this),cancel:this._destroyGuideDom.bind(this)}],showSkipButton:!1,okText:s.ZP.t("web_Get_it",{},"Got it"),placeholderRadius:8})}showFirstSplitSegmentGuide(e){this._guideService.trigger({key:L.F3.FirstToSplitSegment,steps:[{target:()=>this._selectSplitAndNext(e),title:s.ZP.t("drag_web_transistion",{},"\u62D6\u62FD\u8F6C\u573A\u6548\u679C\u5230\u5206\u5272\u5904\u6216\u70B9\u51FB\u8F6C\u573A\u6548\u679C\uFF0C\u53EF\u6DFB\u52A0\u89C6\u9891\u8F6C\u573A"),content:"",placement:"tl",showCloseIcon:!0,confirm:this._destroyGuideDom.bind(this),cancel:this._destroyGuideDom.bind(this)}],mask:!0,showSkipButton:!1,okText:s.ZP.t("web_Get_it",{},"Got it"),placeholderRadius:8})}showRefPlayerMarkerGuide(e){let t=()=>{this._destroyGuideDom()};if(!!document.querySelector("#timeline-axis-marker-canvas"))this._guideService.trigger({key:L.F3.RefPlayerSyncMarkerTimelineGuide,steps:[{target:this._getRefPlayerMarkerGuideAndScroll(e),title:s.ZP.t("web_reference_tooltip_mark_sync_timeline",{},"Marks synced to timeline"),content:"",confirmLabel:s.ZP.t("web_reference_btn_ok_timeline",{},"OK"),confirm:t,cancel:t}],mask:!1,placeholderBorderColor:"transparent"})}async showTemplateGuide(){let e=this._dataSdk.draftView.getDraftId();if(!!e)this._dataSdk.cutSame.draftIdToMutableVideos[e].length>=3?await this.showBatchReplaceGuide():this.showSimpleReplaceGuide(),this._store[p.U_].setFirstSegmentRender(!0)}showAddMaterialToTemplateTips(e,t,i){return{ifShowTips:!this._guideService.getShowStateByKey(L.F3.FirstAddMaterialToTemplate),showGuide:()=>this.addMaterialShowGuideIfNeed(e,t,i)}}async addMaterialShowGuideIfNeed(e,t,i){let{segmentId:r,mutableId:a,info:o}=e,{isBatchReplacePanelVisible:l}=this._store[p.U_];await this._mutex.lock(),l?await this._waitDomAppear(`.segment-child[data-mutableid="${a}"]`,3e3):t&&a&&await this._waitDomAppear(`.mutable-poly-modal-children .segment-child[data-mutableid="${a}"]`,3e3),this._mutex.unLock();let d=s.ZP.t("web_guide_desc_edit_material_on_your_own",{strong0:e=>(0,n.jsx)("b",{children:e})},'You can click "Edit" to trim or crop the material if you\u2019re not satisfied with the effect.');"video"===o.groupType&&("speed"===o.type&&1!==o.value&&(d=s.ZP.t("web_guide_desc_edit_material_times",{number0:o.value.toFixed(1),strong0:e=>(0,n.jsx)("b",{children:e})},'Video added to slot with its speed adjusted to <strong0>{number0}</strong0>. You can click <strong0>"Edit"</strong0> to trim or crop it.')),"trim"===o.type&&o.value>0n&&(d=s.ZP.t("web_guide_desc_trim_material_duration",{number0:(0,U.T)(_.h.usToSecond(o.value),1),strong0:e=>(0,n.jsx)("b",{children:e})},'Video trimmed to <strong0>{number0}s</strong0> and added to the slot. You can click <strong0>"Edit"</strong0> to trim or crop it.'))),"image"===o.groupType&&(d=s.ZP.t("web_guide_desc_edit_material",{strong0:e=>(0,n.jsx)("b",{children:e})},'Material is cropped to fit the slot. You can click <strong0>"Edit"</strong0> to recrop it.'));let u=this._guideService.trigger({key:L.F3.FirstAddMaterialToTemplate,steps:[{target:()=>l?document.querySelector(`.segment-child[data-mutableid="${a}"]`):t&&a?this._selectPoly(r,a,i):this._selectMono(r,i),content:x(s.ZP.t("web_guide_title_edit_material",{},'Click "Edit" to adjust'),d),placement:"tl",showCloseIcon:!1,show:()=>{(0,G.k)(this._containerService,{type:"edit",action:"show"})},confirm:()=>{this._destroyGuideDom.call(this),(0,G.k)(this._containerService,{type:"edit",action:"close"})},cancel:()=>{this._destroyGuideDom.call(this),(0,G.k)(this._containerService,{type:"edit",action:"close"})},clickTargetToClose:!0,resizeObserverSelectors:[".timeline-container"],mutationObserverSelectors:["#workbench"]}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),className:F.Z["cut-same-tips-wrap"],maskClassName:F.Z["cut-same-tips-mask"],mask:!1,placeholderRadius:0,placeholderBorderColor:"transparent"});if(u){let e=this._panel.onTimelinePanelModeChange(()=>{u.clear(),e.dispose(),t.dispose()}),t=this._panel.onCollapsedStatusChange(()=>{u.clear(),e.dispose(),t.dispose()})}}showSimpleReplaceGuide(){let e;if(this._guideConfiguration.getViewStateFromLocal(L.F3.FirstEnterCutSame))return;if(this._store[p.U_].isBatchReplacePanelVisible)for(let i of this._store[p.U_].flattedSegments){var t;if(!i.mutable.locked&&(null===(t=i.mutable)||void 0===t?void 0:t.mutableId)){e=i.mutable.mutableId;break}}else e:for(let[t]of this._store[p.U_].tracksMutable)for(let i of t.segments)if(!i.mutable.locked){e=i.id;break e}if(!!e)this._guideService.trigger({key:L.F3.FirstEnterCutSame,steps:[{target:()=>{if(this._store[p.U_].isBatchReplacePanelVisible)return this._selectBatchReplaceSlot(e);!document.querySelector(".guide-timeline-dom")&&document.body.appendChild(this._guideDom);let t=this._getMonoTarget(e).target.getBoundingClientRect(),{width:i=0,height:r=0,top:n=0,left:a=0}=null!=t?t:{};return this._sizeTheGuide({width:i,height:r,top:n,left:a}),this._guideDom},content:k(s.ZP.t("web_click_on_replace",{},"Replace it with your own material"),s.ZP.t("web_guide_desc_replace_with_your_own",{},"Click the button to replace, or drag the material to the slot")),placement:"tl",showCloseIcon:!0,show:()=>{(0,G.k)(this._containerService,{type:"replace",action:"show"})},confirm:()=>{this._destroyGuideDom.call(this),(0,G.k)(this._containerService,{type:"replace",action:"close"})},cancel:()=>{this._destroyGuideDom.call(this),(0,G.k)(this._containerService,{type:"replace",action:"close"})},clickTargetToClose:!0}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),mask:!0,placeholderBorderWidth:"1px"})}onFirstEnterCutSameGuideEnd(e){if(this._guideService.getShowStateByKey(L.F3.FirstEnterCutSame))e();else{let t=this._guideService.onStateChange(i=>{let{key:r,show:n}=i;if(r===L.F3.FirstEnterCutSame&&!n){var a;null===(a=t.dispose)||void 0===a||a.call(t),e()}});return t}}showNoFilledTips(e){let t=()=>{this._guideService.trigger({key:L.F3.HasNoFilled,steps:[{target:this._selectMono(e),content:b(s.ZP.t("web_you_can_export_after_all_the_slots_are_filled",{},"You can export after all the slots are filled")),placement:"tl",showCloseIcon:!1,confirm:this._destroyGuideDom.bind(this),cancel:this._destroyGuideDom.bind(this)}],showSkipButton:!1,get okText(){return s.ZP.t("web_a_template_got_it",{},"Got it")},className:F.Z["cut-same-tips-wrap"],maskClassName:F.Z["cut-same-tips-mask"],blurToNext:!0,repeat:!0})};if(this._panel.isCollapsed){this._panel.setCollapsed(!this._panel.isCollapsed),setTimeout(t,500);return}t()}async showTrimTips(e,t,i,r){let{isBatchReplacePanelVisible:a}=this._store[p.U_],{segmentId:o,mutableId:l}=e;t&&l&&await this._waitDomAppear(`.mutable-poly-modal-children .segment-child[data-mutableid="${l}"]`),a&&await this._waitDomAppear(`.segment-child[data-mutableid="${l}"]`);let d=()=>{var e;this._destroyGuideDom(),null===(e=i.onClose)||void 0===e||e.call(i)},u=this._guideService.trigger({key:L.F3.HasCroped,steps:[{target:()=>a?document.querySelector(`.segment-child[data-mutableid="${l}"]`):t&&l?this._selectPoly(o,l,r):this._selectMono(o),content:(0,n.jsx)(C,{info:e.info,setNoLongerNotice:e=>{null==u||u.stopShowAgain(e)}}),placement:"tl",confirm:d,cancel:d,showCloseIcon:!1}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),className:F.Z["cut-same-tips-wrap"],maskClassName:F.Z["cut-same-tips-mask"],mask:!1,blurToNext:!0,placeholderRadius:0,placeholderBorderColor:"transparent"})}showMuteTips(e,t){let i=()=>{var e;this._destroyGuideDom(),null===(e=t.onClose)||void 0===e||e.call(t)};return this._guideService.trigger({key:L.F3.Muted,steps:[{target:()=>this._selectMono(e),title:s.ZP.t("web_musicreplace_text_mute_music",{},"Sound muted"),content:s.ZP.t("web_musicreplace_text_add_music",{},"Sound in the template is muted due to copyright restrictions. You can add sound on your own."),placement:"tl",showCloseIcon:!0,confirm:i,cancel:i}],showSkipButton:!1,okText:s.ZP.t("web_musicreplace_text_ok",{},"OK"),maskClassName:`${F.Z["cut-same-tips-mask"]}`,mask:!0})}_showAutoReplaceGuideIfNeed(){if(!this._guideService.getShowStateByKey(L.F3.FirstEnterWithRelationVideoGroup)){let e=this._mainDraftService.dataSdk.onChangeDiff(t=>{if(t.actionOperateType!==O.aWQ.History){if(1===t[O.u4I.SEGMENT].length&&t[O.u4I.SEGMENT][0].type===O.C8.UPDATE){let[{item:{id:r,segment:n}}]=t[O.u4I.SEGMENT];if((0,O.RFV)(n)){let t=this._store[p.U_].flattedSegments,a=t.find(e=>e.id===r);if(null==a?void 0:a.relation_video_group){var i;let s=t.filter(e=>e.id!==r&&e.relation_video_group===a.relation_video_group);s.length&&1===Array.from(new Set(s.map(e=>e.path))).length&&s[0].path!==(null===(i=n.material)||void 0===i?void 0:i.path)&&(this.showAutoReplaceGuide(),e.dispose())}}}}})}}showAutoReplaceGuide(){let e=document.querySelector("#auto-replace-btn"),t=document.querySelector(".mutable-poly-modal-children");if(e&&t){let i=e.getBoundingClientRect(),r=t.getBoundingClientRect();i.left>=r.left&&i.right<=r.right&&i.top>=r.top&&i.bottom<=r.bottom&&this._selection.setSelectedData({segmentIds:[]})}let i=this._guideService.trigger({key:L.F3.FirstEnterWithRelationVideoGroup,steps:[{target:"#auto-replace-btn",content:R(s.ZP.t("web_autofill_title_quick_replace",{},"Quickly replace clips"),s.ZP.t("web_autofill_text_same_photo",{},"Replace all clips marked with the same color dots with a single clip.")),placement:"top",showCloseIcon:!0,show:()=>{(0,G.k)(this._containerService,{type:"same_clip",action:"show"})},confirm:()=>{(0,G.k)(this._containerService,{type:"same_clip",action:"close"})},cancel:()=>{(0,G.k)(this._containerService,{type:"same_clip",action:"close"})},clickTargetToClose:!0,resizeObserverSelectors:[".timeline-container"],mutationObserverSelectors:["#workbench"]}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),className:F.Z["cut-same-tips-wrap"],maskClassName:`${F.Z["cut-same-tips-mask"]} ${F.Z["cut-same-unuse-mask"]}`,mask:!1,blurToNext:!1,placeholderRadius:0,placeholderBorderColor:"transparent"});if(i){let e=this._panel.onTimelinePanelModeChange(()=>{i.clear(),e.dispose(),t.dispose()}),t=this._panel.onCollapsedStatusChange(()=>{i.clear(),e.dispose(),t.dispose()})}}async showBatchReplaceGuide(){let e="#timeline-quick-upload-btn";await this._waitDomAppear(e,2e4);let t=this._guideService.trigger({key:L.F3.FirstToBatchReplaceMutable,steps:[{target:e,content:(0,n.jsx)(A,{store:this._store}),placement:"top",showCloseIcon:!0,show:()=>{(0,G.k)(this._containerService,{type:"batch_replace",action:"show"})},confirm:()=>{(0,G.k)(this._containerService,{type:"batch_replace",action:"close"})},cancel:()=>{(0,G.k)(this._containerService,{type:"batch_replace",action:"close"})},clickTargetToClose:!0}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),mask:!0,blurToNext:!1});if(t){let i=document.querySelector(e),r=(0,l.Z)(()=>{t&&(t.clear(),(0,G.k)(this._containerService,{type:"batch_replace",action:"close"})),null==i||i.removeEventListener("mouseenter",r)},200);null==i||i.addEventListener("mouseenter",r);let n=t.onClose(()=>{null==i||i.removeEventListener("mouseenter",r),n.dispose()})}}_showToggleTimelineModeEntryIfNeed(){let e=this._playerManager.onPlay(()=>{let t=this._playerManager.onPause(()=>{this.showToggleTimelineModeEntry(),t.dispose(),e.dispose()})})}showToggleTimelineModeEntry(){let e=this._guideService.trigger({key:L.F3.ToggleTimelineModeEntry,steps:[{target:"#timeline-batch-replace-btn",content:I(s.ZP.t("web_guide_title_see_template_timeline",{},"See Timeline"),s.ZP.t("web_guide_desc_see_template_timeline",{},"Switch to the timeline for preview and fine-tuning")),placement:"tl",showCloseIcon:!0,show:()=>{(0,G.k)(this._containerService,{type:"timeline",action:"show"})},confirm:()=>{(0,G.k)(this._containerService,{type:"timeline",action:"close"})},cancel:()=>{(0,G.k)(this._containerService,{type:"timeline",action:"close"})},clickTargetToClose:!0,resizeObserverSelectors:[".timeline-container"],mutationObserverSelectors:["#workbench"]}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),className:F.Z["cut-same-tips-wrap"],maskClassName:`${F.Z["cut-same-tips-mask"]} ${F.Z["cut-same-unuse-mask"]}`,mask:!1,blurToNext:!1,placeholderRadius:0,placeholderBorderColor:"transparent"});if(e){let t=this._panel.onTimelinePanelModeChange(()=>{e.clear(),t.dispose(),i.dispose()}),i=this._panel.onCollapsedStatusChange(()=>{e.clear(),t.dispose(),i.dispose()})}}_showAIGCGuide(){let e=this._cloudMetaManager.getMeta();this._guideConfiguration.getViewStateFromLocal(L.F3.EditorAreaBaseGuide)&&e.draft.transferedFrom===N.ZZ.ad_script&&this._guideService.trigger({key:L.F3.AIGCTimeLineGuide,steps:[{target:"#timeline-part-view",title:s.ZP.t("web_adjust_the_time_here",{},"Adjust here"),content:s.ZP.t("web_subtitles_and_audios_are _ready_ drag_in_the_track_to_adjust_time_if_there's_any_uncoorinated",{},"Captions and audios are ready. You can adjust more in multi-track editor."),placement:"top",showCloseIcon:!0}],showSkipButton:!1,okText:s.ZP.t("web_a_template_got_it",{},"Got it"),mask:!0,blurToNext:!1,placeholderRadius:16})}_destroyGuideDom(){let{attributes:e}=this._guideDom;for(;e.length;){let t=e[0];this._guideDom.removeAttribute(t.name)}this._guideDom.className="guide-timeline-dom",this._guideDom.style.position="absolute",document.body.contains(this._guideDom)&&document.body.removeChild(this._guideDom)}_getMonoTarget(e,t){let i=document.querySelector(".timeline-bd"),r=document.querySelector(".timeline-bd-vertical-scroll");return{scrollBody:{vertical:r,horizontal:i},target:{getBoundingClientRect:()=>{let i=this._coordinate.context.registry.getBoundingClientRect(e,t);return i?i:this._guideDom}}}}_toScroll(e,t){if(!e.vertical||!e.horizontal||!t)return;let i=e.horizontal.getBoundingClientRect(),r=e.vertical.getBoundingClientRect(),n=t.getBoundingClientRect();if(!i||!r||!n)return;let a=!1;if((n.right<i.left||n.left>i.right)&&(e.horizontal.scrollLeft+=n.left-i.left,a=!0),(n.bottom<r.top||n.top>r.bottom)&&(e.vertical.scrollTop+=n.top-r.top,a=!0),!a||!!(n=t.getBoundingClientRect()))return!document.querySelector(`.${z}`)&&document.body.appendChild(this._guideDom),{$el:t,rect:n}}_getAndScroll(e,t){let{scrollBody:i,target:r}=this._getMonoTarget(e,t);return this._toScroll(i,r)}_getRefPlayerMarkerGuideAndScroll(e){let t={horizontal:document.querySelector(".timeline-bd"),vertical:document.querySelector(".timeline-bd-vertical-scroll")},i=document.querySelector("#timeline-axis-marker-canvas");if(!i)return this._guideDom;let r=this._toScroll(t,{getBoundingClientRect:()=>{var r,n;let{top:a,left:s}=i.getBoundingClientRect(),o=s+e-(null!==(n=null===(r=t.horizontal)||void 0===r?void 0:r.scrollLeft)&&void 0!==n?n:0);return{top:a,left:o,right:o+8,width:8,height:9}}});if(!r)return this._guideDom;let{width:n,left:a,top:s,height:o}=r.rect;return this._sizeTheGuide({width:n,left:a,top:s,height:o}),this._guideDom}_sizeTheGuide(e){let{left:t,width:i,top:r,height:n}=e;t&&i&&r&&n&&(this._guideDom.style.left=`${t-3}px`,this._guideDom.style.width=`${i+6}px`,this._guideDom.style.top=`${r-3}px`,this._guideDom.style.height=`${n+6}px`)}_selectInsertedSegment(e){let t=this._getAndScroll(e);if(!t)return this._guideDom;let{width:i,left:r,top:n,height:a}=t.rect;return this._sizeTheGuide({width:i,left:r,top:n,height:a}),this._guideDom}_selectInsertedTrack(e){let t=this._getAndScroll(e,"track");if(!t)return this._guideDom;let{width:i,left:r,top:n,height:a}=t.rect;return this._sizeTheGuide({width:i,left:r,top:n,height:a}),this._guideDom}_selectSplitAndNext(e){let t=this._getAndScroll(e);if(!t)return this._guideDom;let{width:i,left:r}=t.rect,{top:n,height:a}=t.rect,s=this._coordinate.context.registry.segment.findNext(e);if(!s)return this._sizeTheGuide({width:i,left:r,top:n,height:a}),this._guideDom;let o=this._getMonoTarget(s.id).target;if(o){let e=o.getBoundingClientRect();if(e){i+=e.width;let t=document.querySelector(".timeline-bd").getBoundingClientRect();r<t.left&&({left:r}=t),t.right<e.right&&({width:i}=t),t.right>e.right&&i>t.width&&(i=e.right-t.left)}}return this._sizeTheGuide({width:i,left:r,top:n,height:a}),this._guideDom}_toScrollSlot(e,t){var i,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e.horizontal||!e.vertical||!t)return;let a=e.horizontal.getBoundingClientRect(),s=e.vertical.getBoundingClientRect();if(!a||!s)return;let o=t.getBoundingClientRect();if(!o)return;let{width:l,height:d,top:u,left:c}=o,h=null!==(r=null===(i=document.querySelector("html"))||void 0===i?void 0:i.scrollTop)&&void 0!==r?r:0,g={width:l,height:d,top:u+h,left:c},m=!1,p=g.left,f=g.top;if((o.left<a.left+n||o.right>a.right-n)&&(p=e.horizontal.scrollLeft+o.left-a.left-n,e.horizontal.scrollLeft=p,m=!0),o.bottom<s.top||o.top>s.bottom){let t=e.vertical.scrollTop+o.top-s.top;f=t+h,e.vertical.scrollTop=t,m=!0}if(!m||(g.top=f,g.left=a.left,!!(o=t.getBoundingClientRect())))return!document.querySelector(".guide-timeline-dom")&&document.body.appendChild(this._guideDom),{$el:t,rect:g}}_selectPolySegment(e,t,i){var r,n;let a={horizontal:document.querySelector(".timeline-bd"),vertical:document.querySelector(".timeline-bd-vertical-scroll")},s=null!==(n=null===(r=a.horizontal)||void 0===r?void 0:r.getBoundingClientRect().left)&&void 0!==n?n:0;if(!this._toScrollSlot(a,{getBoundingClientRect:()=>this._coordinate.context.registry.getBoundingClientRect(e)},document.body.clientWidth/2-s))return this._guideDom;let o=()=>{var e,r;let n=document.querySelector(`.mutable-poly-modal-children .segment-child[data-mutableid="${t}"]`),a=null==n?void 0:n.getBoundingClientRect(),s=null!==(r=null===(e=document.scrollingElement)||void 0===e?void 0:e.scrollTop)&&void 0!==r?r:0;if(a){let{width:e,left:t,top:r,height:n}=a;null==i||i({width:e,left:t,top:r+s,height:n}),this._sizeTheGuide({width:e,left:t,top:r+s,height:n})}};return(0,Z._)(E.CW).then(()=>o()),o(),this._guideDom}_selectMonoSegment(e,t){let{scrollBody:i,target:r}=this._getMonoTarget(e),n=this._toScrollSlot(i,r);if(!n)return this._guideDom;let{width:a,left:s,top:o,height:l}=n.rect;return!(0,d.Z)({width:a,left:s,top:o,height:l},this._temp)&&(this._temp={width:a,left:s,top:o,height:l},null==t||t({width:a,left:s,top:o,height:l})),this._sizeTheGuide({width:a,left:s,top:o,height:l}),this._guideDom}_selectBatchReplaceSlot(e){return document.querySelector(`.mutable-batch-replace-panel .segment-item[data-mutableid="${e}"] .segment-item__cover-card`)}_selectPoly(e,t,i){return this._selectPolySegment(e,t,i)}_selectMono(e,t){return this._selectMonoSegment(e,t)}_showTextToVideoGuideIfNeed(){var e;if(this._cloudMetaManager.getMeta().draft.transferedFrom!==N.ZZ.text_to_video)return;let t=this._store[p.U_].tracks.find(j.MD);if(!!t)(null===(e=t[0].segments)||void 0===e?void 0:e.length)>0?this.showFirstToReplaceVideoGuide(t[0].segments[0].id):this.showEmptyTrackGuide(t[0].id)}_waitDomAppear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return new Promise((i,r)=>{let n=Date.now(),a=setInterval(()=>{let s=document.querySelector(e);if(s){let e=null,t=null,n=()=>{let r=s.getBoundingClientRect(),[a,o]=[r.x+r.width/2,r.y+r.height/2],l=document.elementFromPoint(a,o);s.contains(l)?(i(),t&&clearTimeout(t)):e=window.setTimeout(()=>{n()},500)};clearInterval(a),n(),t=window.setTimeout(()=>{e&&(clearTimeout(e),r(Error("Timeout waiting for DOM element")))},3e4)}else Date.now()-n>t&&(clearInterval(a),r(Error("Timeout waiting for DOM element")))},50)})}constructor(e,t,i,r,n,a,s,o,l,d,u,c){this._store=e,this._dataSdk=t,this._coordinate=i,this._panel=r,this._event=n,this._cloudMetaManager=a,this._playerManager=s,this._selection=o,this._containerService=l,this._guideService=d,this._guideConfiguration=u,this._mainDraftService=c,this._temp={},this._mutex=new V.L,this._guideDom=document.createElement("div"),this._guideDom.className=z,this._guideDom.style.position="absolute"}}Y=(0,r.gn)([(0,r.fM)(8,P.t),(0,r.fM)(9,a.W),(0,r.fM)(10,L.AS),(0,r.fM)(11,B.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof Coordinate?Object:Coordinate,"undefined"==typeof ITimelinePanel?Object:ITimelinePanel,"undefined"==typeof ITimelineEventInner?Object:ITimelineEventInner,"undefined"==typeof ICloudMetaManager?Object:ICloudMetaManager,"undefined"==typeof IPlayerManager?Object:IPlayerManager,"undefined"==typeof ISelection?Object:ISelection,void 0===P.t?Object:P.t,void 0===a.W?Object:a.W,void 0===L.AS?Object:L.AS,void 0===B.n?Object:B.n])],Y)},843480:function(e,t,i){i.d(t,{V:function(){return s}});var r=i(306909),n=i(379939),a=i(690674);class s{get _isBatchReplace(){return this._store[a.U_].isBatchReplacePanelVisible}get _container(){return this._isBatchReplace?document.querySelector(".mutable-batch-replace-panel"):document.getElementById(n.h)}error(e){e&&r.Z.error(e,{getContainer:()=>this._container})}normal(e){e&&r.Z.normal(e,{getContainer:()=>this._container})}success(e){e&&r.Z.success(e,{getContainer:()=>this._container})}warning(e){return r.Z.warning(e,{getContainer:()=>this._container})}constructor(e){this._store=e}}},749215:function(e,t,i){i.d(t,{T:function(){return o}});var r=i(789786),n=i(690674),a=i(230689),s=i(613916);class o{mount(){}unmount(){}constructor(e,t){this._containerService=t,this._lastTrigger=null,this._lastZoom=null,this._guardZoom=null,this._reportTimer=null,this.report=(e,t)=>{let{zoomStore:i}=this._store[n.U_];e===this._lastTrigger?this._lastZoom=i.value:(this._lastTrigger&&this._flush(),this._lastTrigger=e,this._lastZoom=i.value,this._guardZoom=t,this._reportTimer=setTimeout(this._flush,5e3))},this._flush=()=>{if(null!==this._lastTrigger&&null!==this._lastZoom&&null!==this._guardZoom){let e;let t=Number(Number(this._guardZoom/this._lastZoom).toFixed(2));e=t<1?"shrink":t>1?"enlarge":"same",(0,s.p)(this._containerService,{actionType:this._lastTrigger,zoomScale:t,zoomType:e})}this._reportTimer&&clearTimeout(this._reportTimer),this._lastTrigger=null,this._lastZoom=null,this._guardZoom=null,this._reportTimer=null},this._store=e}}o=(0,r.gn)([(0,r.fM)(1,a.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,void 0===a.t?Object:a.t])],o)},416762:function(e,t,i){i.d(t,{j:function(){return a}});var r=i(260963),n=i(426336);class a{get segmentId(){return 1===this.selectedSegmentIds.length?this.selectedSegmentIds[0]:null}get segment(){return this._selectionObservableData.segment}get selectedSegmentIds(){return this.segmentSelected.map(e=>e.id)}get selectedPrepareSegmentIds(){return this.prepareSegmentSelected.map(e=>e.id)}get selectedAllSegmentIds(){return[...new Set([...this.selectedSegmentIds,...this.selectedPrepareSegmentIds])]}get segmentSelectedTimeRange(){let e=BigInt(Number.MAX_VALUE),t=-1n;return this.segmentSelected.forEach(i=>{if("transition"!==i.type)e=n.pMA.min([e,i.start],"bigint"),t=n.pMA.max([t,i.start+i.duration],"bigint")}),{start:e,end:t}}get canvasUISelectedSegmentIds(){return this.expandedSegmentId?this._selectionObservableData.selectedSegmentIds:Array.from(new Set([...this.selectedPrepareSegmentIds,...this._selectionObservableData.topLevelSelectedSegmentIds]))}get selectedMutableAudioSegment(){var e;let t=null===(e=this.segmentSelected)||void 0===e?void 0:e[0];return t&&this._timelineStore.tracksMutable.filter(e=>{let[t]=e;return t.trackType===n.pNd.TrackTypeAudio}).map(e=>{let[t]=e;return t.segments}).flat().find(e=>e.id===t.id)}get selectedMutableAudioPlaceholder(){var e;let t=null===(e=this.segmentSelected)||void 0===e?void 0:e[0];return t&&this._timelineStore.tracksMutable.filter(e=>{let[t]=e;return t.trackType===n.pNd.TrackTypeAudio}).map(e=>{let[t]=e;return t.segments}).flat().find(e=>e.id===t.id)}get nestedSelectedSegmentIds(){return this._selectionObservableData.nestedSelectedSegmentIds}get topLevelSelectedSegmentIds(){return this._selectionObservableData.topLevelSelectedSegmentIds}get expandedSegmentId(){return this._selectionObservableData.expandedSegmentId}get batchReplacingSegmentId(){return this._selectionObservableData.batchReplacingSegmentId}get subDraft(){return this._selectionObservableData.subDraft}get subDraftId(){return this._selectionObservableData.subDraftId}get subDraftSegment(){return this._selectionObservableData.subDraftSegment}get subDraftSegments(){return this._selectionObservableData.subDraftSegments}get subDraftTemplateId(){return this._selectionObservableData.subDraftTemplateId}get isEditingTemplate(){return this._timelineStore.isTemplate||!!this.expandedSegmentId}get segmentMutable(){return this._selectionObservableData.segmentMutable}setSegmentSelected(e){this.segmentSelected=e}setPrepareSegmentSelected(e){this.prepareSegmentSelected=e}setTimeRangeSegmentIds(e){this.timeRangeSegmentIds=e}setPartialExportError(e){this.partialExportError=e}constructor(e,t){this._timelineStore=e,this._selectionObservableData=t,this.segmentSelected=[],this.prepareSegmentSelected=[],this.timeRangeSegmentIds=[],this.partialExportError={selectedErr:"",selectedRangeErr:""},(0,r.ky)(this)}}},426217:function(e,t,i){i.d(t,{T:function(){return n}});var r,n=((r={})[r.hover=0]="hover",r[r.click=1]="click",r)},824951:function(e,t,i){function r(e){return!!e.tierBlock}function n(e){return!!e.placeholder}function a(e){return!!e.slot}function s(e){return!!e.space}function o(e){return!!e.track}function l(e){return!!e.segment}function d(e){return!!e.segment}function u(e){return!!e.transition}function c(e){return Array.isArray(e.edgeScroll)&&e.edgeScroll.length>0}i.d(t,{AU:function(){return a},Aj:function(){return r},As:function(){return c},IA:function(){return n},ST:function(){return u},Ui:function(){return o},d4:function(){return l},jC:function(){return g},rS:function(){return d},uS:function(){return s}});var h,g=((h={}).lostTransitionWhenCrop="lostTransitionWhenCrop",h.NoAvailableSlot="noAvailableSlot",h)},724081:function(e,t,i){i.d(t,{P0:function(){return d},SO:function(){return f},XZ:function(){return S},YO:function(){return _},h3:function(){return l},hZ:function(){return h},lB:function(){return g},mQ:function(){return y},vV:function(){return w},vz:function(){return v}});var r=i(857670),n=i(632555),a=i(426336),s=i(345685),o=i(823129);let l=e=>{let{task_flow:{result:t=[]},pred:i=[]}=e,r=[];return t.reduce((e,t)=>{let n=e+t.pred_dim;return r.push({type:t.task_type,points:i.slice(e,n).map(e=>Math.round(1e3*e))}),n},0),{beat_infos:r}},d=function(e,t){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0n;if((0,r.i1)(e)===(0,r.i1)(t))return!0;return((i=e-t)<0n?-i:i)<=n},u=(e,t,i,r,n)=>{if(n){let i=null==n?void 0:n.isAutoBeat;if(void 0===i){var a,o;i=!(null===(o=t.beat)||void 0===o?void 0:null===(a=o.userBeats)||void 0===a?void 0:a.includes(e))}(0,s.u)(r,{method:n.from,is_auto:i?1:0,action:"delete"})}i.api.audio.removeBeat({segmentId:t.id,removedBeats:[e],removeAllBeats:!1,removeAiBeats:!1})},c=(e,t,i,r)=>{var n,a,s;i.api.audio.addBeat({segmentId:t.id,addedBeats:[e],gear:null===(n=t.beat)||void 0===n?void 0:n.gear,gearCount:null===(a=t.beat)||void 0===a?void 0:a.gearCount,mode:null===(s=t.beat)||void 0===s?void 0:s.mode,beatSpeedInfos:[]})},h=function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0n,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0n,o=arguments.length>5?arguments[5]:void 0;return e?(null!==(t=o.draftView.getAllAudioBeats(e))&&void 0!==t?t:[]).map(e=>{let t=(0,r.Wl)(e,i,n,a,s);return{originBeat:e,formatFrame:t}}):[]},g=(e,t,i,n)=>{var s;let{id:l,sourceTimeRange:d={start:0,duration:0},start:g,speed:m=1,duration:p}=null!==(s=null==e?void 0:e[0])&&void 0!==s?s:{},f=h(l,m,d.start,g,p,i),_=y({progress:t,sourceStart:d.start,targetStart:g,speed:m}),v=f.find(e=>e.formatFrame===Math.round(a.pMA.div(t,r.G8))),M=i.draftView.getSegmentById(l);return void 0!==v?u(v.originBeat,M,i,n,{from:"time_line"}):((0,o.e)(n,{isAuto:0,method:"time_line"}),c(_,M,i,{from:"time_line",isAutoBeat:!1}))},m=e=>{switch(e){case 0x2625a0d:return"TIME_LIMIT_LONG";case 0x2625a10:return"SIZE_LIMIT_LARGE";case 0x2625a16:case 0x2625a0c:case 0x2625a0a:return"FILE_NOT_SUPPORT";default:return"DEFAULT_FAILED"}},p={TIME_LIMIT_SHORT:{key:"web_musicbeat_toast_short_audio",backup:"Couldn\u2019t detect beats. Audio needs to be no less than 5 seconds.",reportReason:"shorter"},TIME_LIMIT_LONG:{key:"web_musicbeat_toast_long_audio",backup:"Couldn\u2019t detect beats. Audio needs to be no more than 10 minutes.",reportReason:"longer"},SIZE_LIMIT_LARGE:{key:"web_musicbeat_text_large_file",backup:"Couldn\u2019t detect beats. Audio file needs to be no larger than 100 MB.",reportReason:"size"},FILE_NOT_SUPPORT:{key:"web_musicbeat_toast_cannot_generate",backup:"Couldn\u2019t detect beats in this audio",reportReason:"no_beat"},DEFAULT_FAILED:{key:"web_musicbeat_text_fail_beat",backup:"Couldn\u2019t detect beats. Try again.",reportReason:"other"}},f=e=>p[e],_=e=>p[m(e)],v=(e,t,i)=>{let s=t+i;return e.filter(e=>(0,n.mK)(a.pMA.times(e.formatFrame,r.G8,"bigint"),[t-1n,s+1n]))},y=e=>{let{progress:t=0n,sourceStart:i=0n,targetStart:r=0n,speed:n=1}=e,{plus:s,minus:o,times:l}=a.pMA;return s(i,l(o(t,r,"bigint"),n),"bigint","round")},M=e=>e.map(e=>a.pMA.times(e.formatFrame,r.G8,"bigint")),S=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2?arguments[2]:void 0,{id:r,sourceTimeRange:n,speed:a,start:s,duration:o}=e;if(!r)return[];let l=i.beat.getAllBeats(r,a,null==n?void 0:n.start,s,o);return t&&l.length?v(l,s,o):l},w=(e,t)=>{let i=[];if("audio"===e.type){let r=S(e,!0,t);if(r.length){let e=M(r);i.push(...e)}}return i}},709488:function(e,t,i){let r,n;i.d(t,{FZ:function(){return u},HO:function(){return h},Z9:function(){return l},_U:function(){return d},eb:function(){return c}});var a=i(928261),s=i(426336);let o=i(29188).CZ;let l=(e,t,i)=>{void 0===n&&t&&(n=t,r=setTimeout(()=>{i(),n=void 0},e)),!t&&(clearTimeout(r),n=void 0,i())};function d(e,t){var i,r;return(null===(i=e[0])||void 0===i?void 0:i.segments.length)?null===(r=e[0].segments.map(e=>[e.targetTimerange.start,e.targetTimerange.start+e.targetTimerange.duration,e]).find(e=>{let[i,r]=e;return i+o<=t&&t<=r-o}))||void 0===r?void 0:r[2]:void 0}function u(e,t){if(!e)return!1;let{start:i}=e,r=e.start+e.duration;return t>=s.pMA.plus(i,o,"bigint")&&t<=s.pMA.minus(r,o,"bigint")}function c(e){let{dataSdk:t,currentSeekTime:i,segmentSelected:r,splitTarget:n}=e;if("select"!==n)return!!d(t.draftView.getAllTracks(),i);{let e=!1;for(let t of r)if((0,a.IM)(t)&&u(t,i)){e=!0;break}return e}}function h(e){return e.length?"select":"main"}},404172:function(e,t,i){i.d(t,{t:function(){return a}});var r=i(426336);let n={video:r.pNd.TrackTypeVideo,effect:r.pNd.TrackTypeVideoEffect,videoEffect:r.pNd.TrackTypeVideoEffect,audio:r.pNd.TrackTypeAudio,filter:r.pNd.TrackTypeFilter,text:r.pNd.TrackTypeText,textTemplate:r.pNd.TrackTypeText,sticker:r.pNd.TrackTypeSticker,imageSticker:r.pNd.TrackTypeSticker,pictureAdjust:r.pNd.TrackTypeAdjust,tailLeader:r.pNd.TrackTypeVideo,handwrite:r.pNd.TrackTypeSticker,adjust:r.pNd.TrackTypeAdjust,mutable:"mutable",mutablePoly:"mutable",mutableAudio:r.pNd.TrackTypeVideo,combination:"combination",dragVideoPlaceholder:"dragVideoPlaceholder",dragAudioPlaceholder:"dragAudioPlaceholder"};function a(e){if("transition"!==e)return n[e]}},969242:function(e,t,i){i.d(t,{Fl:function(){return l},Fn:function(){return u},KU:function(){return s},TF:function(){return d},cD:function(){return a},vQ:function(){return c},vY:function(){return o}});var r=i(29188),n=i(426336);function a(e,t){return e*t/r.zD}function s(e,t){return t*r.zD/e}function o(e,t){return n.pMA.div(n.pMA.times(t,r.zD,"bigint"),1e3)/e}function l(e,t){return n.pMA.div(n.pMA.times(e,r.zD),1e3*t)}function d(e,t){return n.pMA.times(e*t/r.zD,1e3,"bigint","round")}function u(e){return BigInt(1e6*e)}function c(e){return n.pMA.div(e,1e6)}},43570:function(e,t,i){i.d(t,{Z:function(){return m}});var r=i(772322),n=i(218571),a=i(670933),s=i(415826),o=i(690674),l=i(969242),d=i(140041),u=i(907031),c=i(305799),h=i(426336);i(182263);var g=i(563890);let m=(0,a.f3)("store","modules")((0,a.Pi)(e=>{let{store:t,modules:i,renderer:a}=e,{coordinate:m}=i,{enclaveDrag:{moveLocation:p},store:{targetSegment:f},situation:{dragMulti:_}}=m.context,{isReflexToMain:v,firstOtherTrack:y}=_,{zoomStore:M,edgeWidth:S,visual:w}=t[o.U_],{snapshotComputedTracksUpper:T,snapshotComputedTracksMain:b,snapshotComputedTracksUnder:k}=t[o.xI],{segmentSelected:x}=t[o.qk],I=(0,n.useMemo)(()=>[...T.map(e=>{let[t,i]=e;return[t,i,"upper"]}),...b.map(e=>{let[t,i]=e;return[t,i,"main"]}),...k.map(e=>{let[t,i]=e;return[t,i,"under"]})],[b,k,T]),R=(0,n.useMemo)(()=>x.map(e=>e.id),[x]),C=(0,n.useMemo)(()=>R.length?(0,c.NO)([...I],e=>!e[0].segments.find(e=>R.includes(e.id))).map(e=>{let t={...e[0]};return t.segments=t.segments.filter(e=>R.includes(e.id)).map(e=>({...e})).sort((e,t)=>h.pMA.minus(e.start,t.start)),[t,e[1],e[2]]}):[],[I,R]),[D,A]=(0,n.useMemo)(()=>{let e=BigInt(Number.MAX_SAFE_INTEGER),t=BigInt(Number.MIN_SAFE_INTEGER);for(let[{segments:i}]of C){if(!i.length)continue;e=h.pMA.min([i[0].start,e],"bigint");let r=i[i.length-1];t=h.pMA.max([r.start+r.duration,t],"bigint")}return[e,(0,l.vY)(M.value,t-e)]},[C,M.value]),P=(0,n.useMemo)(()=>C.map(e=>(e[0].segments.map(e=>(e.start-=D,e)),e)),[D,C]),[E,N]=(0,n.useMemo)(()=>{let e=0,t=0;if(!f)return[e,t];for(let[i,,r]of P){let n=i.segments.find(e=>e.id===f.id);if(n){e=(0,l.vY)(M.value,n.start);break}{let e="main"===r?"primary":i.type;t+=d.co[e]+u.Zn}}return[e,t]},[P,f,M.value]),j=(0,n.useMemo)(()=>P.map(e=>{let t={...e[0]};if(v&&t.id===(null==y?void 0:y.id)){let e;t.segments=t.segments.map(t=>{let{start:i}=t;if(e){i=e.start+e.duration;let t=e.slots.find(e=>"transition"===e.type);t&&(i-=h.pMA.div(t.duration,2,"bigint"))}return e={...t,start:i},{...t,start:i}})}return[t,e[1],e[2]]}),[P,v,y]),O=(0,n.useMemo)(()=>{let e=[];for(let[t]of j)for(let i of t.segments)["video","mutable","mutablePoly","combination","audio","mutableAudio"].includes(i.type)&&e.push(i.id);return e},[j]),L=(0,n.useMemo)(()=>{let e=new Map;if(!a)return e;for(let t of O){let i=(0,g.JP)(a.children,t);(null==i?void 0:i.data.thumbnailImage)&&e.set(t,{thumbnailImage:i.data.thumbnailImage,imageOffsetX:-i.data.imageOffsetX/2})}return e},[O,a]);return(0,r.jsx)("div",{className:"drag-snapshot",style:{left:p.x-E,top:p.y-N,width:A},children:(0,r.jsx)(s._,{zoom:M.value,edgeWidth:S,cTracks:j,visialMap:w,thumbnailImageMap:L})})}))},93529:function(e,t,i){i.d(t,{a:function(){return l}});var r=i(772322),n=i(218571),a=i(105789),s=i.n(a),o=i(675058);i(954882);let l=(0,n.memo)(e=>{let{track:t,index:i,zoom:n,edgeWidth:a,visialMap:l,thumbnailImageMap:d}=e;return(0,r.jsx)("div",{"data-id":t.id,"data-index":i,className:s()("track",`type-${t.type}`,0===i?"primary":void 0),children:[...t.segments.map((e,i,s)=>{var u;return(0,r.jsx)(o.Z,{segment:e,zoom:n,edgeWidth:a,track:t,prev:s[i-1],hideTitle:(null==l?void 0:null===(u=l[e.type])||void 0===u?void 0:u.title)===!1,thumbnail:d.get(e.id)},e.id)})]})})},708531:function(e,t,i){i.d(t,{LM:function(){return l}});var r=i(772322),n=i(771380),a=i(150564);i(218571);var s=i(426336);let o={effect:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.t33,{className:"iconpark-icon"})}),filter:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.AqX,{className:"iconpark-icon"})}),pictureAdjust:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.wwn,{className:"iconpark-icon"})}),text:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.lFi,{className:"iconpark-icon"})}),textTemplate:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.lvS,{className:"iconpark-icon"})})};s.cVg.MetaTypeSubtitle,s.RZH.ManualAdd,a.EPA,s.cVg.MetaTypeSubtitle,s.RZH.RecognizeAdd,a.toP,s.cVg.MetaTypeSubtitle,s.RZH.ImportAdd,a.toP,s.cVg.MetaTypeLyrics,s.RZH.ManualAdd,a.EPA,s.cVg.MetaTypeLyrics,s.RZH.RecognizeAdd,a.RoO,s.cVg.MetaTypeLyrics,s.RZH.ImportAdd,a.RoO;let l={[`${s.cVg.MetaTypeTextToAudio}`]:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.m5_,{className:"iconpark-icon"})}),[`${s.cVg.MetaTypeVideoOriginalSound}`]:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.z6Q,{className:"iconpark-icon"})}),[`${s.cVg.MetaTypeMusic}`]:(0,r.jsx)("div",{className:"segment-icon",children:(0,r.jsx)(a.kUW,{className:"iconpark-icon"})})};(0,n.renderToString)(o.effect),(0,n.renderToString)(o.filter),(0,n.renderToString)(o.pictureAdjust),(0,n.renderToString)(o.text),(0,n.renderToString)(o.textTemplate)},961471:function(e,t,i){i.d(t,{Z:function(){return m}});var r=i(772322);i(55041),i(931598);var n=i(519065),a=i(16464),s=i(218571),o=i(801497),l=i(670933),d=i(212233),u=i(969242),c=i(632555),h=i(426336),g=i(857670);let m=(0,l.f3)("store","modules")((0,l.Pi)(e=>{let{store:t,children:i,modules:l,leftOffsetRef:m,viewOffset:p=0n}=e,{timelineStore:f}=t,{isTemplate:_,axisMarkerStore:v,zoomStore:y}=f,[M,S]=(0,s.useState)(!1),w=(0,s.useRef)(null),T=(0,s.useRef)(-1n),b=e=>{var t,i,r;e.preventDefault();let{x:n,y:a}=null!==(i=null===(t=w.current)||void 0===t?void 0:t.getBoundingClientRect())&&void 0!==i?i:{x:0,y:0},s={x:e.clientX-n-(null!==(r=null==m?void 0:m.current)&&void 0!==r?r:0),y:e.clientY-a};if(s.y>=0&&s.y<=8&&s.x>=0){let e=(0,g.i1)((0,u.TF)(y.value,s.x)+p),t=(0,u.TF)(y.value,4),i=v.markers.find(i=>(0,c.mK)(e,[h.pMA.minus(i,t,"bigint"),h.pMA.plus(i,t,"bigint")]));return null!=i?i:-1n}return-1n},k=(0,r.jsxs)(n.Z,{className:d.Z.axisMarkerMenu,children:[(0,r.jsx)(n.Z.Item,{onClick:()=>{let e=T.current;e>=0&&(v.deleteOne(e),l.event.axisMarkerDelete({marker:e,deleteAll:!1}))},className:d.Z.lvDropdownMenuItem,children:o.oc.t("web_reference_btn_remove_mark",{},"Remove marker")},"remove"),(0,r.jsx)(n.Z.Item,{onClick:()=>{let e=T.current;e>-1&&(f.axisMarkerStore.deleteAll(),l.event.axisMarkerDelete({marker:e,deleteAll:!0}))},className:d.Z.lvDropdownMenuItem,children:o.oc.t("web_reference_btn_remove_all_marks",{},"Remove all markers")},"remove_all")]});return(0,r.jsx)("div",{ref:w,onContextMenu:e=>e.stopPropagation(),children:(0,r.jsx)(a.Z,{popupVisible:!_&&M,onVisibleChange:e=>{if(e){if(_)return;T.current>-1&&S(!0);return}S(e)},disabled:_,trigger:"contextMenu",droplist:k,children:(0,r.jsx)("span",{onContextMenu:e=>{e.preventDefault();let t=b(e);M&&t===-1n&&S(!1),T.current=t},onClick:e=>{let t=b(e);t!==-1n&&l.player.timelineSeek(t)},children:i})})})}))},546134:function(e,t,i){i.d(t,{i:function(){return g}});var r=i(260963),n=i(402655),a=i(257296),s=i(563890),o=i(394267),l=i(979159),d=i(928261),u=i(146114),c=i(271564),h=i(26761);class g extends n.JT{bindDataChangeListeners(e){let t=(0,r.U5)(()=>(0,o.Z)(this._modules.coordinate.context.store.message)?(0,l.JY)(this._modules.coordinate.context.store.message.type,this._modules.coordinate.context.store.message.dragSource):void 0,t=>{let{message:i}=this._modules.coordinate.context.store,r=(0,s.Mq)(e.children,[a.KX.Segment]);(0,o.Z)(i)&&(0,d.IM)(t)&&(null==t?void 0:t.metaType)!==void 0?r.forEach(e=>{let{segment:r}=e.data,n=this._modules.draftOperation.getSegmentById(r.id),a=(null==t?void 0:t.metaType)&&!(0,u._)(e.data.segment.type,t.metaType);n&&(a||(a=!(0,c.Hs)(i,n))),!(0,h.t)(e.data.disabled,a)&&e.updateData({disabled:a},!0)}):r.forEach(e=>{e.data.disabled&&e.updateData({disabled:!1},!0)})});this._register({dispose:t})}getProps(){return{}}constructor(e,t){super(),this._timelineManagerStore=e,this._modules=t}}},251894:function(e,t,i){i.d(t,{m:function(){return l}});var r=i(402655),n=i(690674),a=i(260963),s=i(563890),o=i(257296);class l extends r.JT{bindDataChangeListeners(e){let t=(0,a.U5)(()=>this._timelineManagerStore[n.U_].visual,()=>{for(let t of(0,s.Mq)(e.children,[o.KX.Segment])){if(t.destroyed)continue;let{segment:e}=t.data;t.updateData(this.getProps(e),!0)}});this._register({dispose:t})}getProps(e){var t;let{type:i}=e,{visual:r}=this._timelineManagerStore.timelineStore;return{hideTitle:(null==r?void 0:null===(t=r[i])||void 0===t?void 0:t.title)===!1}}constructor(e){super(),this._timelineManagerStore=e}}},940802:function(e,t,i){i.d(t,{t:function(){return l}});var r=i(402655),n=i(690674),a=i(260963),s=i(563890),o=i(257296);class l extends r.JT{get isDebugLoading(){return location.search.includes("loading=true")}bindDataChangeListeners(e){let t=(0,a.U5)(()=>{let{[n.U_]:e}=this._timelineManagerStore,{loadingSegments:t,loadingTextSegments:i}=e,r=[];for(let e in t){let n=t[e],a=i[e];r.push(`${e}:${n}${a?`:${a}`:""}`)}return r.join(",")},()=>{for(let t of(0,s.Mq)(e.children,[o.KX.Segment])){if(t.destroyed)continue;let e=this.getProps(t.data.segment);t.updateData(e,!0)}});this._register({dispose:t})}getProps(e){let{loadingSegments:t,loadingTextSegments:i}=this._timelineManagerStore.timelineStore,{id:r,loading:n}=e;return{isLoading:n||r&&t[r]||this.isDebugLoading,loadingText:i[r]}}constructor(e){super(),this._timelineManagerStore=e}}},15678:function(e,t,i){i.d(t,{O:function(){return l}});var r=i(690674),n=i(202426),a=i(402655),s=i(827084),o=i(722169);class l extends a.JT{bindEventListeners(e){e.events.interact.on(n.TY.onAudioShowMuteModal,this._handleShowModal),this._register({dispose:()=>{e.events.interact.off(n.TY.onAudioShowMuteModal,this._handleShowModal)}})}constructor(e,t){super(),this._timelineManagerStore=e,this._modules=t,this._showUserGuide=(0,o.debounce)((0,o.once)(e=>{let t=this._modules.timelineUI.guide.showMuteTips(e,{onClose:()=>{this._modules.timelineUI.guide.showTemplateGuide()}});null==t||t.stopShowAgain(!1)}),1e3),this._handleShowModal=e=>{var t,i;let{templateResourceKey:n}=this._modules.resource,{templateIdToInfo:a}=this._timelineManagerStore[r.jU],o=(0,s.kC)(null!=n?n:"");o&&null!==(i=null===(t=a[o])||void 0===t?void 0:t.mute)&&void 0!==i&&i&&this._showUserGuide(e)}}}},590944:function(e,t,i){i.d(t,{R:function(){return o}});var r=i(260963),n=i(402655),a=i(563890),s=i(257296);class o extends n.JT{bindDataChangeListeners(e){let t=(0,r.U5)(()=>this._modules.subjectCrop.store.processingSegIds,()=>{for(let t of(0,a.Mq)(e.children,[s.KX.Segment])){let{data:{segment:e,status:i}}=t,r=this.getProps(e);""===r.status&&"loading"!==i&&(r.status=i),t.updateData(r,!0)}});this._register({dispose:t})}getProps(e){let t;let{processingSegIds:i}=this._modules.subjectCrop.store;return t=i.includes(e.id)?"loading":"",{status:t}}constructor(e,t){super(),this._timelineManagerStore=e,this._modules=t}}},590411:function(e,t,i){i.d(t,{b:function(){return h}});var r=i(801497),n=i(432092),a=i(969242),s=i(202426),o=i(257296),l=i(721244),d=i(563890),u=i(402655),c=i(892230);class h extends u.JT{bindEventListeners(e){this._renderer=e,e.events.interact.on(s.TY.onAudioEnterTrim,this._handleEnterTrim),e.events.interact.on(s.TY.onAudioExitTrim,this._handleExitTrim),e.events.interact.on(s.TY.onAudioEnterTrim,this._handleAudioEnterTrim),e.events.interact.on(s.TY.onAudioTrim,this._handleAudioTrim),this._modules.event.uiEvents.on(n.W.MUTABLE_AUDIO_ENTER_TRIM,this._handleMutableAudioEnterTrim),document.body.addEventListener("mousedown",this._handleMousedown),this._register({dispose:()=>{e.events.interact.off(s.TY.onAudioEnterTrim,this._handleEnterTrim),e.events.interact.off(s.TY.onAudioExitTrim,this._handleExitTrim),e.events.interact.off(s.TY.onAudioEnterTrim,this._handleAudioEnterTrim),e.events.interact.off(s.TY.onAudioTrim,this._handleAudioTrim),this._modules.event.uiEvents.off(n.W.MUTABLE_AUDIO_ENTER_TRIM,this._handleMutableAudioEnterTrim),document.body.removeEventListener("mousedown",this._handleMousedown)}})}constructor(e,t){super(),this._timelineManagerStore=e,this._modules=t,this._isTrimming=!1,this._handleEnterTrim=()=>{this._isTrimming=!0},this._handleExitTrim=()=>{this._isTrimming=!1},this._handleAudioEnterTrim=()=>{this._modules.coordinate.context.store.setMutableAudioDisableInteract(!0)},this._handleMutableAudioEnterTrim=e=>{var t;null===(t=this._renderer)||void 0===t||t.events.interact.emit(s.TY.onAudioEnterTrim,e)},this._handleAudioTrim=(e,t)=>{var i,n;if(!this._renderer)return;let{id:o,title:l,duration:d,start:u}=e,{zoom:c}=this._renderer.camera,h=(0,a.TF)(c,t),g={segmentId:o,musicName:l,duration:null!==(n=null===(i=e.prolong)||void 0===i?void 0:i.total)&&void 0!==n?n:0n,targetTime:{start:u,duration:d},sourceTime:{start:h,duration:d}},{coordinate:m,draftOperation:p,timelineUI:f}=this._modules;try{p.mutable.updateMutableAudios([g]),setTimeout(()=>{var t;null===(t=this._renderer)||void 0===t||t.events.interact.emit(s.TY.onAudioStartPositionChange,e.id)}),f.toast.success(r.ZP.t("web_musicreplace_toast_realignment",{},"Sound Duration adjusted"))}finally{m.context.store.setMutableAudioDisableInteract(!1)}},this._handleMousedown=e=>{var t,i,r,n,a,u,h;let g;if(!this._isTrimming||!this._renderer)return;let{clientX:m,clientY:p}=e;for(let e of(0,d.Mq)(this._renderer.children,o.KX.Segment)){let{data:t}=e;if((null==t?void 0:null===(n=t.audio)||void 0===n?void 0:n.status)===l.o.EDIT&&(null==t?void 0:null===(a=t.segment)||void 0===a?void 0:a.type)==="mutableAudio"){g=e;break}}if(!g)return;let f=document.querySelector(".timeline-large-container");if(!f)return;let{x:_,y:v}=f.getBoundingClientRect(),{x:y,y:M,width:S,height:w}=this._renderer.camera.getViewport(),{x:T,y:b,height:k}=g.style,x=Math.abs(null!==(u=null===(i=g.data)||void 0===i?void 0:null===(t=i.audio)||void 0===t?void 0:t.trimDragLeft)&&void 0!==u?u:0),I=null!==(h=null===(r=g.data.audio)||void 0===r?void 0:r.realWidth)&&void 0!==h?h:0,R=_+T-x,C=v+b,D=R,A=C,P={x:R+I,y:C+k},E={x:_+y,y:v+M},N={x:_+y+S,y:v+M+w},j={x:Math.max(D,E.x),y:Math.max(A,E.y)},O={x:Math.min(P.x,N.x),y:Math.min(P.y,N.y)};!((0,c.mK)(m,[j.x,O.x])&&(0,c.mK)(p,[j.y,O.y]))&&this._renderer.events.interact.emit(s.TY.onAudioExitTrim,l.o.NORMAL)}}}},553921:function(e,t,i){i.d(t,{Z:function(){return M}});var r=i(772322);i(966156);var n=i(368100),a=i(801497),s=i(813072),o=i(670933),l=i(218571),d=i(960482),u=i(690674),c=i(70366),h=i(432092),g=i(804497),m=i(969242),p=i(72127),f=i(185701),_=i(586703);let v="game-play-popup-confirm-locate";function y(e,t){let{flattedSegments:i}=t[u.U_];for(let t of i)if(e.includes(t.id))return t.id;return""}let M=(0,o.f3)("store","modules")((0,o.Pi)(function(e){let{store:t,modules:i}=e,{mutableRelationsMap:o,tracksMutable:M,isBatchReplacePanelVisible:S}=t[u.U_],{segmentSelected:w,isEditingTemplate:T}=t[u.qk],{intelligent:b,event:k,timelineUI:x,coordinate:I}=i,{errorSegIds:R}=b.intelligentStore,C=(0,l.useMemo)(()=>{var e;return(0,_.gz)(R,null===(e=M[0])||void 0===e?void 0:e[0].segments)},[R,M]),[D,A]=(0,l.useState)(!1),[P,E]=(0,l.useState)(!1),[N,j]=(0,l.useState)(0),[O,L]=(0,l.useState)(w[0]),[B,F]=(0,l.useState)(!1),U=(0,l.useRef)(null),V=(0,l.useRef)(null),[Z,G]=(0,l.useState)(0),[z,Y]=(0,l.useState)(0),[H,K]=(0,l.useState)(0),[W,q,X]=(0,c.w)({setModalLeft:G,setModalTop:j,setArrowLeft:Y,setFakeModalWidth:K,segment:O,bubbleRef:{current:{getBoundingClientRect:()=>({width:300})}},segLeftSafeArea:150,segRightSafeArea:150,store:t,modules:i}),Q=(0,l.useCallback)(e=>{for(let[t]of M)for(let i of t.segments)if("mutablePoly"===i.type&&o.get(e)===i.id)return i},[M,o]),J=(0,l.useCallback)(e=>{var t,i,r,n;if(o.has(e)){let r=Q(e);return{start:null!==(t=null==r?void 0:r.start)&&void 0!==t?t:0n,duration:null!==(i=null==r?void 0:r.duration)&&void 0!==i?i:0n}}{let t=(0,g.kt)(M,{id:e});return{start:null!==(r=null==t?void 0:t.start)&&void 0!==r?r:0n,duration:null!==(n=null==t?void 0:t.duration)&&void 0!==n?n:0n}}},[o,M]),$=(0,l.useCallback)(()=>{b.mutableCancelIntelligent(C)},[C,b]),ee=(0,l.useCallback)(()=>{b.mutableCancelIntelligent(C,!1)},[C,b]),et=(0,l.useCallback)(()=>{if(1===C.length)O&&x.scroller.scrollToSegment(O.id);else{let e=(0,g.kt)(M,{id:y(C,t)});if(!e)return;let{start:i,duration:r}=J(e.id),n=i+r;for(let t of C){if(t===e.id)continue;let r=(0,g.kt)(M,{id:t});if(r){let{start:e,duration:t}=J(r.id),a=e+t;i=i<e?i:e,n=n>a?n:a}}let a=document.querySelector(".timeline-bd");if(!a)return;let{width:s}=a.getBoundingClientRect(),o=(0,m.Fl)(n-i,s);x.zoom.timelineZoomSet(1.1*o),setTimeout(()=>{e&&(0,p.Ud)(e.id,I,[!1,!0])})}},[I,O,C,M]);(0,l.useEffect)(()=>{if(0===w.length){F(!1);return}w[0]&&o.has(w[0].id)?F(!0):F(!1)},[o,w]);let ei=(0,l.useCallback)(()=>0===C.length||B||!O||!T||S,[C,B,O,T,S]);(0,l.useEffect)(()=>{ei()?A(!1):(V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{!ei()&&A(!0)},300))},[C,B,O,ei]),(0,l.useEffect)(()=>{if(C.length>0&&!D){let e=null;if(1===C.length)e=o.has(C[0])?Q(C[0]):(0,g.kt)(t[u.U_].tracksMutable,{id:y(C,t)});else if((null==w?void 0:w[0])&&!B){let i=(0,g.kt)(t[u.U_].tracksMutable,{id:w[0].id});if(!i)return;let r=M.map(e=>{let[t]=e;return t.segments}).flat(),n=r.indexOf(i),a=n-1,s=n+1,o=r.length-1;for(;!e;){if(s<=o){if(C.includes(r[s].id)){e=(0,g.kt)(t[u.U_].tracksMutable,{id:r[s].id});break}s++}if(a>=0){if(C.includes(r[a].id)){e=(0,g.kt)(t[u.U_].tracksMutable,{id:r[a].id});break}a--}}}else{let i=y(C,t);e=o.has(i)?Q(i):(0,g.kt)(t[u.U_].tracksMutable,{id:i})}e&&L(e)}},[M,C,D,B,O]);let er=(0,l.useCallback)(e=>{let t=new Set;return e.forEach(e=>{o.has(e)?t.add(o.get(e)):t.add(e)}),t.size},[o]);(0,l.useEffect)(()=>{W||er(C)>1?E(!0):E(!1)},[W,C]),(0,l.useEffect)(()=>{if(!D)return;let e=document.querySelector(".game-play-popup-confirm .lv-popconfirm-wrapper .lv-popconfirm-btn");if(e){let t=e.querySelector(`.${f.Z[v]}`);if(!P){null==t||t.remove();return}return!t&&(t=document.createElement("span")),t.className=f.Z[v],t.innerText=1===er(C)?a.ZP.t("web_editor_button_locate_clips"):a.ZP.t("web_product_button_view_all"),e.prepend(t),t.addEventListener("click",et),()=>null==t?void 0:t.removeEventListener("click",et)}},[P,D,C]);let en=(0,l.useMemo)(()=>1===C.length?a.ZP.t("web_editor_title_not_load",{},"Couldn\u2019t load effects. Remove the media?"):a.ZP.t("web_editor_title_not_replace_remove",{number0:C.length}),[C]),ea=(0,l.useMemo)(()=>a.ZP.t("web_editor_desc_not_load_effects",{},"Couldn\u2019t load effects in some clips. If you continue to export, the effects in those clips will be lost."),[]),es=(0,l.useMemo)(()=>a.ZP.t("web_editor_button_remove",{},"Remove"),[]),eo=(0,l.useMemo)(()=>a.ZP.t("web_editor_button_keep",{},"Keep"),[]),el=(0,l.useMemo)(()=>({title:en,content:(0,r.jsx)("span",{children:ea}),okText:es,cancelText:eo,onOk:$,mask:!1,maskClosable:!1,cancelButtonProps:{onClick:ee},wrapStyle:{zIndex:1e3},focusLock:!1}),[$,ee,en,ea,es,eo]),ed=(0,l.useCallback)(()=>{var e;null===(e=U.current)||void 0===e||e[0].update({visible:!0,...el})},[U.current,el]);(0,l.useEffect)(()=>(k.uiEvents.on(h.W.SEGMENT_FAILED_BUTTON_CLICK,ed),()=>{k.uiEvents.off(h.W.SEGMENT_FAILED_BUTTON_CLICK,ed)}),[k,ed]),(0,l.useEffect)(()=>{if((S||!T)&&C.length>0)U.current?!(0,s.Z)(U.current[1],C)&&(U.current[0].update({visible:!0,...el}),U.current[1]=C.slice()):U.current=[n.Z.confirm({visible:!0,...el}),C.slice()];else{var e;null===(e=U.current)||void 0===e||e[0].close(),U.current=null}},[S,C,el,T,M]);let eu=(0,l.useMemo)(()=>q?"rb":X?"lb":"top",[q,X]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(d.Z,{focusLock:!1,className:"game-play-popup-confirm",popupVisible:D,title:en,content:ea,okText:es,cancelText:eo,onOk:$,onCancel:ee,position:eu,props:{okType:"primary",okButtonProps:{status:"danger"}},triggerProps:{style:{position:"fixed",left:Z,width:"300px"}},offsetY:W?N-4:0,offsetX:z,fakeModalWidth:H})})}))},697921:function(e,t,i){i.d(t,{Z:function(){return u}});var r=i(772322);i(17435);var n=i(629913),a=i(537783),s=i(218571),o=i(670933),l=i(202426),d=i(194670);let u=(0,o.f3)("store")((0,o.Pi)(e=>{let{renderer:t,store:i}=e,{i18n:o}=(0,a.$)(),[u,c]=(0,s.useState)(!1),[h,g]=(0,s.useState)({x:0,y:0}),[m,p]=(0,s.useState)(o.t("web_uneditable",{},"Uneditable")),[f,_]=(0,s.useState)("top");return(0,s.useEffect)(()=>{let e=(e,t,i,r)=>{p(null!=i?i:o.t("web_uneditable",{},"Uneditable"));let n=document.querySelector(".menu-mutable"),a=document.querySelector(".mutable-poly-modal-children"),s=document.querySelector(".popup-segment-button"),l=n&&n.getAttribute("data-segment-id")===(null==t?void 0:t.id)||a&&a.getAttribute("data-segment-id")===(null==t?void 0:t.id)||s&&s.getAttribute("data-segment-id")===(null==t?void 0:t.id);e&&t&&!l?(c(!0),g(e)):c(!1),r?_(r):_("top")};return null==t||t.events.interact.on(l.TY.popupTooltip,e),()=>{null==t||t.events.interact.off(l.TY.popupTooltip,e)}},[t]),(0,r.jsx)(n.Z,{trigger:"hover",popupVisible:u,content:m,position:f,unmountOnExit:!0,className:d.Z.timelinePopupTooltip,children:(0,r.jsx)("div",{className:d.Z.fakeModal,style:{transform:`translate(${h.x+i.timelineStore.operationWidthInner}px, ${h.y}px)`}})})}))},75535:function(e,t,i){i.d(t,{V:function(){return r}});class r{constructor(e,t,i){this.type=e,this.key=t,this.actionInfo=i}}},718540:function(e,t,i){i.d(t,{j:function(){return r}});function r(e,t){if(!!t)return e.find(e=>e[0].id===t)}},563890:function(e,t,i){function r(e,t){let i=Array.isArray(t)?t:[t];return Array.from(e.values()).filter(e=>i.includes(e.type))}function n(e,t){return e.get(t)}function a(e,t){let i=r(e,t);return i.length>0?i[0]:void 0}function s(e){if(!e)return{type:"",subType:"",id:""};let[t,i,r]=e.split(":");return{type:i,subType:r,id:t}}function o(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return`${e}:${t}:${i}`}i.d(t,{$V:function(){return c},DM:function(){return l},JP:function(){return n},Mq:function(){return r},Vo:function(){return o},dX:function(){return d},hH:function(){return a},r8:function(){return u},tI:function(){return s}});let l=(e,t)=>e.findOne(`.${t}`),d=(e,t)=>{if(!!e)return e.getChildren().find(e=>e.id()===t)},u=e=>`${e}_keyframe_group`,c=e=>{if(!!(null==e?void 0:e.children))e.getChildren().forEach(e=>{e.index=0,e.destroy(),e.parent=null}),e.children=[]}},573581:function(e,t,i){i.d(t,{T:function(){return r}});function r(e,t){if(!e||!t||e.width<=0||e.height<=0||t.width<=0||t.height<=0)return!1;let i=e.x,r=e.x+e.width,n=t.x,a=t.x+t.width;return!(n>r)&&!(a<i)&&(i=e.y,r=e.y+e.height,n=t.y,a=t.y+t.height,!(n>r)&&!(a<i)&&!0)}},257296:function(e,t,i){i.d(t,{Bt:function(){return G},CD:function(){return eS},Dx:function(){return A},GW:function(){return Y},HG:function(){return v},HP:function(){return V},I8:function(){return eC},Ii:function(){return eI},Jl:function(){return ec},KQ:function(){return ee},KX:function(){return ey},Kp:function(){return en},LY:function(){return D},MI:function(){return m},N:function(){return U},Ne:function(){return K},O7:function(){return y},P3:function(){return J},PB:function(){return ew},PM:function(){return eR},Q3:function(){return em},R0:function(){return W},RB:function(){return E},TD:function(){return w},Tj:function(){return Z},Ue:function(){return ex},VV:function(){return _},V_:function(){return eM},WE:function(){return N},WW:function(){return I},WY:function(){return ef},Ws:function(){return x},ZT:function(){return er},Zr:function(){return q},_H:function(){return el},_n:function(){return eb},_v:function(){return k},ao:function(){return ek},b6:function(){return X},bF:function(){return C},dh:function(){return M},gG:function(){return h},iX:function(){return R},j8:function(){return eu},je:function(){return eo},jf:function(){return et},kT:function(){return ev},lA:function(){return H},lK:function(){return p},lz:function(){return z},me:function(){return P},nI:function(){return S},oo:function(){return eT},op:function(){return ep},pj:function(){return T},pq:function(){return eg},q0:function(){return j},rY:function(){return eh},sP:function(){return B},sX:function(){return O},sc:function(){return Q},t0:function(){return e_},uw:function(){return $},vX:function(){return F},vr:function(){return ei},wX:function(){return g},wc:function(){return ea},xm:function(){return f},yD:function(){return L},yi:function(){return ed},z6:function(){return es},zn:function(){return b}});var r,n,a,s,o,l=i(827322),d=i(61855),u=i(140041),c=i(907031);let h=0,g=0,m=c.wZ,p=c.eS,f=2,_=22,v=22,y=5,M=18,S=18,w=2,T=12,b=3,k=14,x=2,I=16,R=c.ro,C=0,D=8,A=8,P=16,E=16,N=24,j=4,O=6,L=2,B=16,F=6,U=2,V=12,Z=14,G=12,z=12,Y=6,H=4,K=12,W=12,q=6,X=4,Q=72,J=12,$=12,ee=1.2,et=12,ei=12,er=4,en=2,ea=5,es=6,eo={width:6,height:14},el=15,ed={...u.co,mutable:Q,mutableAudio:c.Kw,templatePost:c.ek},eu=4,ec=25,eh=14,eg=28,em=14,ep=14,ef=4,e_=1.5,ev=2;var ey=((r={}).Track="Track",r.Segment="Segment",r.MutableButton="MutableButton",r.TimeRuler="TimeRuler",r.Transition="Transition",r.KeyframeGroup="KeyframeGroup",r.Keyframe="Keyframe",r.Default="Default",r.SubSequenceMask="SubSequenceMask",r.CoverGroup="CoverGroup",r.MutableTrimMask="MutableTrimMask",r);var eM=((n={}).Background="Background",n);var eS=((a={}).Background="Background",a.Icon="Icon",a.Title="Title",a.LockIcon="LockIcon",a.Mask="Mask",a.Tip="Tip",a.EditTemplateButton="EditTemplateButton",a.AnimationArrow="AnimationArrow",a.MutableAudio="MutableAudio",a.ColorDot="ColorDot",a.MutableDuration="MutableDuration",a.MutableButton="MutableButton",a.MutableButtonBg="MutableButtonBg",a.MutableTrimMaskStripe="MutableTrimMaskStripe",a.Thumbnail="Thumbnail",a.MutableHideIcon="MutableHideIcon",a.MutableHintIcon="MutableHintIcon",a.Keyframe="Keyframe",a.Beat="Beat",a.Cover="Cover",a.CoverGroup="coverGroup",a.Text="Text",a);var ew=((s={}).TrackGroup="TrackGroup",s.SegmentGroup="SegmentGroup",s.TransitionGroup="TransitionGroup",s.SelectionGroup="SelectionGroup",s.BeatsGroup="BeatsGroup",s.CoverGroup="CoverGroup",s.MaskGroup="MaskGroup",s);var eT=((o={}).Default="Default",o.EditingSubSequence="EditingSubSequence",o);let eb={Default:["TrackGroup","SegmentGroup","TransitionGroup","SelectionGroup","BeatsGroup","CoverGroup","MaskGroup"],EditingSubSequence:["TrackGroup","SegmentGroup","TransitionGroup","BeatsGroup","CoverGroup","MaskGroup","SelectionGroup"]},ek=["TemplateTag","TemplateMusicCopyrightTag","ProTag","TagsGroup"],ex=2,eI=d.l,eR=new Image;eR.src=(0,l.C)(eI,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1});let eC="Albert Sans,Helvetica Neue,Helvetica,PingFang SC,Hiragino Sans GB,Microsoft YaHei,\u5FAE\u8F6F\u96C5\u9ED1,Arial,sans-serif,NotoColorEmoji"},813269:function(e,t,i){i.d(t,{L:function(){return g},k:function(){return c}});var r=i(721244),n=i(257296),a=i(251976),s=i(426336),o=i(628499),l=i(907031),d=i(620183),u=i(384971);function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.iX,{x:i,y:r,width:a,height:s}=e,o=r+s/2-n.je.height/2,l=a>=2*n.kT?n.kT:a/2,d=t+l/2,u=l/2;return{leftArmX:i+d+n.kT/2,leftArmY:o+u+n.kT/2,rightArmX:i+a-2*d-n.je.width/2,rightArmY:o+u+n.kT/2,armHeight:n.je.height-n.kT,armWidth:n.je.width-n.kT}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.iX;return{...function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.iX,{x:i,y:r,width:a,height:s}=e,o=a>=2*n.kT?n.kT:a/2,d=t+o/2;return{borderX:i+d,borderY:r+o/2,borderWidth:Math.max(a-2*d,l.vm),borderHeight:s-o,strokeWidth:o}}(e,t),...c(e,t)}}class g extends o.G{static checkIsShowArm(e,t,i){var a;let{isReadonlyMode:o}=e;return"template-post"!==t&&(null==e?!void 0:!e.replaceHover)&&"sub"!==e.sequenceType&&("template"!==t||"mutableAudio"===e.segment.type&&e.segment.metaType!==s.cVg.MetaTypeNone&&(null===(a=e.audio)||void 0===a?void 0:a.status)!==r.o.EDIT)&&!(i<n._H)&&!o&&!0}mount(){let{data:e}=this,t=this._relatedCanvasObjectStyle,{borderX:i,borderY:r,borderWidth:s,borderHeight:o,leftArmX:l,leftArmY:c,rightArmX:m,rightArmY:p,strokeWidth:f,armWidth:_,armHeight:v}=h(t,"transition"in e?n.bF:n.iX),y=new d.Rect({x:i,y:r,width:s,height:o,fill:"transparent",stroke:a.wL.lvvColorMainDefault,strokeWidth:f,cornerRadius:(0,u.yW)(s,n.LY-2),listening:!1,visible:this._visible}),M=new d.Rect({x:l,y:c,fill:a.wL.lvvColorBlackStationary,width:_,height:v,stroke:a.wL.lvvColorMainDefault,strokeWidth:n.kT,cornerRadius:[0,2,2,0],listening:!0,visible:this._visible}),S=new d.Rect({x:m,y:p,fill:a.wL.lvvColorBlackStationary,width:_,height:v,stroke:a.wL.lvvColorMainDefault,strokeWidth:n.kT,cornerRadius:[2,0,0,2],listening:!0,visible:this._visible}),{mode:w}=this.context;return!g.checkIsShowArm(e,w,t.width)&&(M.visible(!1),S.visible(!1)),y.setAttrs({dash:this._shouldShowBorderDash()?[4,2]:void 0}),[y,M,S]}update(){let{data:e}=this,t=this._relatedCanvasObjectStyle,{borderX:i,borderY:r,borderWidth:a,borderHeight:s,leftArmX:o,leftArmY:l,rightArmX:d,rightArmY:c,strokeWidth:m,armWidth:p,armHeight:f}=h(t,"transition"in e?n.bF:n.iX),[_,v,y]=this._konvaNodes;_.setAttrs({x:i,y:r,width:a,height:s,cornerRadius:(0,u.yW)(a,n.LY-2),strokeWidth:m}),v.setAttrs({x:o,y:l,width:p,height:f}),y.setAttrs({x:d,y:c,width:p,height:f}),_.setAttrs({dash:this._shouldShowBorderDash()?[4,2]:void 0});let M=this.getVisible(),{mode:S}=this.context;g.checkIsShowArm(e,S,t.width)?(v.visible(M),y.visible(M)):(v.visible(!1),y.visible(!1)),_.visible(M),!_.parent&&this.add()}setData(e){this.data=e}setStyle(e){this._relatedCanvasObjectStyle=e}_shouldShowBorderDash(){let{segment:e}=this.data;return"replaceHover"in this.data&&this.data.replaceHover||"mutableAudio"===e.type&&e.metaType===s.cVg.MetaTypeNone}constructor(e){let{layer:t}=e;super({...e,container:t.getChildren(e=>e.id()===n.PB.SelectionGroup)[0],type:n.KX.Default}),this.context=e.context,this._relatedCanvasObjectStyle=this.style}}},874312:function(e,t,i){i.d(t,{Z:function(){return h}});var r=i(628499),n=i(932919),a=i(288712),s=i(931774),o=i(257296),l=i(125780),d=i(426336);let u="Group",c="Text";class h extends r.G{mount(){let{data:e,style:t,context:i}=this,{height:r}=t,{segment:l,isVip:d,vipBadgeType:h}=e,{type:g,metaType:m,title:p}=l;if((null==i?void 0:i.mode)==="template"||"audio"!==g)return;let f="legacy-vip"===h?o.Jl:o.Q3,_=new n.Group({listening:!1,name:u,y:(r-this.contentHeight)/2,x:d?f+o.j8:0});this._flatNodeMap.set(u,_);let{audioIconMap:v}=this,y=new a.Image({image:this.audioIconMap[m],width:16,height:16,listening:!1,x:12,y:(this.contentHeight-16)/2});_.add(y);let M=(0,s.Ny)({x:36,height:this.contentHeight});return M.text(p),this._flatNodeMap.set(c,M),_.add(M),this.update(),_}update(){let e=this._flatNodeMap.get(u),{data:t,context:i}=this,{isHover:r,isLoading:n,isActive:a,isLost:s,segment:l,isVip:d,vipBadgeType:h}=t,{title:g}=l,m="legacy-vip"===h?o.Jl:o.Q3;if(r||n||a||s||"template-post"===i.mode){e.visible(!1);return}e.visible(!0),e.setAttrs({x:d?m+o.j8:0});let p=this._flatNodeMap.get(c);null==p||p.text(g)}constructor(...e){super(...e),this.audioIconMap={[d.cVg.MetaTypeTextToAudio]:l.J.LvIconTextToSpeech,[d.cVg.MetaTypeVideoOriginalSound]:l.J.LvIconAudioExtract,[d.cVg.MetaTypeMusic]:l.J.LvIconMusic},this.contentHeight=20}}},82271:function(e,t,i){i.d(t,{k:function(){return T}});var r=i(628499),n=i(257296),a=i(251976),s=i(932919),o=i(612350),l=i(620183),d=i(288712),u=i(559408),c=i(384971),h=i(125780),g=i(857458),m=i(563890),p=i(931774),f=i(202426),_=i(389267),v=i(804497),y=i(907031),M=i(801497),S=i(933162);let w={Group:"Group",Background:"Background",ButtonGroup:"buttonGroup",ButtonGroupBg:"buttonGroupBg",Text:"Text",Icon:"icon"};class T extends r.G{mount(){let{data:e,style:t}=this,{segment:i,isReadonlyMode:r}=e,{width:n,height:a,x:o,y:l}=t;if(!(0,v.pE)(i)||r)return;let d=new s.Group({x:o,y:l,width:n,height:a,opacity:0});return this._bindEvents(d),this._flatNodeMap.set(w.Group,d),this.update(),d}update(){let e=this._flatNodeMap.get(w.Group),{isActive:t}=this.data;if(!t){e.visible(!1);return}let{style:i,context:r}=this,{width:a,height:s,x:o,y:l}=i,d=(0,c.C5)(a),u=this._getNodes(e);this._updateButton(u),u.bg.setAttrs({width:Math.max(d-n.kT,y.vm),height:s}),null==e||e.setAttrs({x:o,y:l,width:a,height:s});let h=u.buttonGroupBg.width(),g=this._flatNodeMap.get(w.ButtonGroup);if(2===this.displayMode)g.visible(!1);else{g.visible(!0);let e=a/2-h/2+(0,p.Ko)(i,null==r?void 0:r.camera);g.setAttrs({x:e})}e.visible(this._visible)}playTweens(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=this._konvaNodes[0];if(!t)return;if("reset"===e){let e=this._tweens[0];null==e||e.reset();return}let i=this._tweens[0];if(!i)try{i=new o.Tween({node:t,easing:o.Easings.EaseIn,opacity:1,duration:.1}),this._tweens.push(i)}catch(e){}null==i||i.play()}_getNodes(e){let{style:t,data:i}=this,{id:r}=i.segment,{width:o,height:p}=t,f=(0,c.C5)(o);if(1===this._flatNodeMap.size){let t=(0,m.Vo)(r,n.KX.Segment,n.CD.EditTemplateButton),i=new l.Rect({x:n.kT,width:Math.max(f-n.kT,y.vm),height:p,name:t,fill:a.wL.lvvColorBlack04,cornerRadius:(0,c.yW)(f)});e.add(i),this._flatNodeMap.set(w.Background,i);let o=new s.Group({name:t,y:(p-this.groupHeight)/2});this._bindButtonEvents(o),e.add(o),this._flatNodeMap.set(w.ButtonGroup,o);let _=new l.Rect({name:t,height:this.groupHeight,fill:a.wL.lvvColorWhite04,cornerRadius:6,stroke:a.wL.lvvColorWhite012,strokeWidth:this.borderWidth});o.add(_),this._flatNodeMap.set(w.ButtonGroupBg,_);let v=(this.groupHeight-this.iconSize)/2,M=new d.Image({image:h.J.TemplateEditMode,width:this.iconSize,height:this.iconSize,listening:!1}),T=(0,S.X5)({id:r,type:n.KX.Segment,nodeType:n.CD.Icon,config:{x:this.padding,y:v},shape:M});o.add(T),this._flatNodeMap.set(w.Icon,T);let b=new u.Text({listening:!1,height:this.groupHeight,verticalAlign:"middle",fill:a.wL.lvvColorTextContentPrimary,fontSize:12,fontStyle:"bold",fontFamily:n.I8,text:g.F.t("web_multi_tracks_hover_edit_more_timeline",{},"Edit template")}),k=(0,S.X5)({id:r,type:n.KX.Segment,nodeType:n.CD.Text,shape:b,config:{x:this.padding+this.iconSize+4}});o.add(k),this._flatNodeMap.set(w.Text,k)}let _=this._flatNodeMap.get(w.Background),v=this._flatNodeMap.get(w.ButtonGroup),M=this._flatNodeMap.get(w.ButtonGroupBg),T=this._flatNodeMap.get(w.Icon);return{bg:_,buttonGroup:v,buttonGroupBg:M,icon:T,text:this._flatNodeMap.get(w.Text)}}_updateDisplayMode(e){var t;let i=(0,p.Fl)(this.style,null===(t=this.context)||void 0===t?void 0:t.camera);if(e+this.margin<i){this.displayMode=0;return}if(this.iconSize+this.padding+this.margin<i){this.displayMode=1;return}this.displayMode=2}_updateButton(e){var t,i;let{buttonGroup:r,buttonGroupBg:n,icon:a,text:s}=e,{style:o}=this,{width:l,height:d}=o,u=null!==(i=null===(t=s.children[0])||void 0===t?void 0:t.getTextWidth())&&void 0!==i?i:0,c=s.x()+u+this.padding;this._updateDisplayMode(c);let h=this.padding,g=!0;1===this.displayMode&&(c=this.iconSize+this.padding,g=!1,h=this.padding/2),s.setAttrs({visible:g,height:this.groupHeight}),n.setAttrs({width:c,height:this.groupHeight});let m=(this.groupHeight-this.iconSize)/2;a.setAttrs({x:h,y:m}),r.setAttrs({x:(l-n.width())/2,y:(d-this.groupHeight)/2})}_bindButtonEvents(e){e.on("click",t=>{let{evt:i}=t;if(2===i.button)return;let{data:r,context:n}=this;null==n||n.events.interact.emit(f.TY.combinationSegmentEditStatusChange,!0,r.segment.id),(0,_.Ay)(e,"inherit")}),e.on("mouseenter",()=>{(0,_.Ay)(e,"pointer");let t=this._flatNodeMap.get(w.ButtonGroupBg);t.setAttrs({strokeWidth:0}),t.fill(a.wL.lvvColorMainDefault),1===this.displayMode&&this.context&&this.context.events.interact.emit(f.TY.popupTooltip,{x:this.style.x+this.style.width/2,y:this.style.y},this.data.segment,M.ZP.t("web_multi_tracks_hover_edit_more_timeline",{},"Edit template"),"top")}),e.on("mouseleave",()=>{(0,_.Ay)(e,"inherit");let t=this._flatNodeMap.get(w.ButtonGroupBg);t.setAttrs({strokeWidth:this.borderWidth}),t.fill(a.wL.lvvColorWhite04),1===this.displayMode&&this.context&&this.context.events.interact.emit(f.TY.popupTooltip,!1)})}_bindEvents(e){e.on("click",()=>{let{data:e,context:t,style:i}=this,r=this._flatNodeMap.get(w.ButtonGroupBg).width();this._updateDisplayMode(r),2===this.displayMode&&(null==t||t.events.interact.emit(f.TY.popupButtonEditTemplate,{x:i.x+i.width/2,y:i.y},e.segment))}),e.on("mouseenter",e=>{if(!this.context||!this.data.isActive)return;let{dragState:t,events:i}=this.context;if("dragging"!==t&&"prepare"!==t)this.playTweens(),i.interact.emit(f.TY.onSegmentMouseEnter,e)}),e.on("mouseleave",e=>{if(!this.context)return;this.playTweens("reset");let{events:t}=this.context;t.interact.emit(f.TY.onSegmentMouseLeave,e)})}constructor(...e){super(...e),this.dataPropertyNames=["segment","isActive"],this.groupHeight=24,this.padding=6,this.margin=16,this.iconSize=16,this.borderWidth=1,this.displayMode=0}}},781792:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(257296),n=i(563890),a=i(932919),s=i(628499),o=i(813269),l=i(406036),d=i(804497),u=i(724081);class c extends s.G{mount(){return this._keyframeGroup=new a.Group({name:(0,n.Vo)(this.data.segment.id,r.KX.Segment,r.KX.KeyframeGroup),listening:!1}),this._initKeyframes(),this._keyframeGroup}get children(){return this._children}_initKeyframes(){if(this.data.isLost||!this.data.keyframesMap)return;let{keyframesMap:e}=this.data,t=Array.from(e.values());this._children=t.map(e=>this._createKeyframeCanvasObject(e))}_createKeyframeCanvasObject(e){let t=this._getKeyframeStyle(e),i=new l.Z({layer:this._layer,data:{keyframeVal:e,timeOffset:e.offset,frame:e.frame},style:t,context:this.context,container:this._keyframeGroup,type:r.KX.Keyframe,id:`${this.id}_${e.offset}`,visible:this._visible});return this.updateKeyframeSelectInfo({offset:e.offset,currentIndex:e.currentKeyframeIndex,selectInfo:this.data.keyframeSelectInfo,target:i}),i}_getKeyframeStyle(e){let{camera:t}=this.context,{zoom:i}=t,{frame:n}=e,{leftArmX:a,rightArmX:s,armWidth:l}=(0,o.k)(this._relatedCanvasObjectStyle),u=(0,d.pv)(n,i),c=(0,d.DX)({minFrameDis:a+l,maxFrameDis:s,targetFrameDis:u}),{y:h,height:g}=this._relatedCanvasObjectStyle;return{x:c,y:h+g/2,width:r.jf,height:r.vr}}updateStyle(e,t){var i;return null===(i=this._keyframeGroup)||void 0===i||i.clip({x:this._relatedCanvasObjectStyle.x,y:this._relatedCanvasObjectStyle.y,width:this._relatedCanvasObjectStyle.width,height:this._relatedCanvasObjectStyle.height}),this._children.forEach(e=>{if(!e.data)return;let i=this._getKeyframeStyle(e.data.keyframeVal);e.updateStyle(i,t)}),!1}updateKeyframeMap(e,t,i){var r;null===(r=t.updateData)||void 0===r||r.call(t,{keyframeVal:e,frame:e.frame},i);let n=this._getKeyframeStyle(e);t.updateStyle(n,i)}updateKeyframeSelectInfo(e){var t;let{offset:i,currentIndex:r,selectInfo:n,target:a,autoRender:s}=e,o=!!(null==n?void 0:n.keyframes_infos.find(e=>(0,u.P0)(e.offset,i)))&&(null==n?void 0:n.seg_id)===this._segId||this.data.keepActiveIndex===r;null===(t=a.active)||void 0===t||t.call(a,o),s&&a.render()}updateCropSituation(e,t,i,r){if(!e||void 0===t)return;let{start:n,duration:a}=this.data.segment,{value:s,type:o}=e,l=n,u=a;"start"===o?u+=n-(l=s):u=s-l;let c=(0,d.NT)(t,l,u);i.setVisible(c),r&&i.render()}updateMaterialIsLost(e){e&&this.destroy()}_compareKeyframesMap(e,t){var i,r;if(Object.is(e,t))return!0;if((null==e?void 0:e.size)!==(null==t?void 0:t.size))return!1;let n=Array.from(null!==(i=null==e?void 0:e.keys())&&void 0!==i?i:[]).join(",");return n===Array.from(null!==(r=null==t?void 0:t.keys())&&void 0!==r?r:[]).join(",")}updateData(e,t,i){if(!!this.data)if(Object.assign(this.data,e),i)this.clear(),this._initKeyframes();else{let{keyframesMap:i,keyframeSelectInfo:r,cropSituation:n}=this.data;if(!i)return;this.updateMaterialIsLost(e.isLost),this._children.forEach(e=>{if(!e.data)return;let a=e.data.timeOffset,s=i.get(a);s&&this.updateKeyframeMap(s,e,t),this.updateKeyframeSelectInfo({offset:a,selectInfo:r,target:e,autoRender:t,currentIndex:null==s?void 0:s.currentKeyframeIndex}),this.updateCropSituation(n,null==s?void 0:s.frame,e,t)})}}constructor(e){let{layer:t,segId:i,data:a,context:s,style:o,visible:l}=e;super({layer:t,type:r.KX.KeyframeGroup,id:(0,n.r8)(i)}),this.dataPropertyNames=["isLost","keyframeSelectInfo","keyframesMap","keepActiveIndex","segment","cropSituation"],this._segId=i,this._relatedCanvasObjectStyle=o,this.data=a,this.context=s,this._visible=l,this._container=(0,n.dX)(t,r.PB.SegmentGroup)}}},704829:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(931774),n=i(77665),a=i(257296),s=i(932919),o=i(628499),l=i(584341),d=i(426336);let u={Group:"Group",Background:"Background",Text:"DurationText"};class c extends o.G{mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)==="template"||!(0,n.I)(this.data,this.context))return;let t=new s.Group({listening:!1});return this._flatNodeMap.set(u.Group,t),this.update(),t}update(){let e=this._flatNodeMap.get(u.Group),t=this.getContainer();if(!(0,n.I)(this.data,this.context)||!t)return;let{segment:i}=this.data,{duration:s}=i;if((0,n.T)(i)){let i="template-post"===this.context.mode?16:14,n=this._flatNodeMap.get(u.Background);if(!n){n=(0,r.eN)({name:u.Background,height:i}),this._flatNodeMap.set(u.Background,n),e.add(n);let t=(0,r.Ny)({name:u.Text,x:a.ZT,height:i-2});this._flatNodeMap.set(u.Text,t),e.add(t)}let o=(0,r.cx)(t,e,a.Kp);e.x(o);let c=this._flatNodeMap.get(u.Text);c.text((0,l.ci)(d.pMA.div(s,1e3),"?mm:ss:ff",30,!0)),n.width(c.x()+c.getTextWidth()+a.ZT),e.visible(!0)}else null==e||e.visible(!1)}}},806759:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(801497),n=i(931774),a=i(77665),s=i(257296),o=i(932919),l=i(628499),d=i(426336);let u={Group:"Group",Background:"Background",Text:"NoiseReductionText"};class c extends l.G{mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)==="template"||!(0,a.I)(this.data,this.context))return;let t=new o.Group({listening:!1});return this._flatNodeMap.set(u.Group,t),this.update(),t}update(){let e=this._flatNodeMap.get(u.Group),t=this.getContainer();if(!(0,a.I)(this.data,this.context)||!t)return;let{segment:i}=this.data,o=r.ZP.t("web_noise_label_reduced",{},"Image noise reduced"),l=!1;if("video"===i.type){let{videoAlgorithm:e}=i.sourceMaterial,{algorithms:t,noiseReduction:r}=e;l=t.some(e=>e.type===d.zzh.NoiseReduction)&&void 0!==(null==r?void 0:r.level)}let c="template-post"===this.context.mode?16:14;if(l){var h;let i=this._flatNodeMap.get(u.Background);if(!i){i=(0,n.eN)({name:u.Background,height:c}),this._flatNodeMap.set(u.Background,i),e.add(i);let t=(0,n.Ny)({name:u.Text,x:s.ZT,height:c-2});this._flatNodeMap.set(u.Text,t),e.add(t)}let r=(0,n.cx)(t,e,s.Kp);e.x(r);let a=this._flatNodeMap.get(u.Text);a.text(o),a.direction(null!==(h=this.context.direction)&&void 0!==h?h:"ltr"),i.width(a.x()+a.getTextWidth()+s.ZT)}e.visible(!!l)}}},367616:function(e,t,i){i.d(t,{Z:function(){return m}});var r=i(932919),n=i(620183),a=i(288712),s=i(559408),o=i(628499),l=i(251976),d=i(257296),u=i(125780),c=i(77665),h=i(931774);let g={Group:"Group",Background:"Background",Text:"Text"};class m extends o.G{mount(){if(!(0,c.I)(this.data,this.context))return;let e=new r.Group({listening:!1});return this._flatNodeMap.set(g.Group,e),this.update(),e}update(){let e=this._flatNodeMap.get(g.Group),t=this.getContainer();if(!(0,c.I)(this.data,this.context)||!t)return;let{speed:i,curveSpeed:r}=this.data.segment;if(i&&1!==i||r){let o="template-post"===this.context.mode?16:14,c=this._flatNodeMap.get(g.Background);if(!c){c=new n.Rect({listening:!1,fill:l.wL.lvvColorBlack04,cornerRadius:4,height:o}),this._flatNodeMap.set(g.Background,c),e.add(c);let t=d.ZT,i=new a.Image({x:t,y:(o-12)/2,width:12,height:12,image:u.J.Speed,listening:!1});e.add(i);let r=new s.Text({y:1,verticalAlign:"middle",fill:l.wL.lvvColorTextContentPrimary,fontSize:d.HP,listening:!1,fontFamily:d.I8,x:t+12+2,height:o-2});this._flatNodeMap.set(g.Text,r),e.add(r)}let m=this._flatNodeMap.get(g.Text);r?null==m||m.text(r.name||""):null==m||m.text(`${null==i?void 0:i.toFixed(2)}x`),c.width(m.x()+m.getTextWidth()+d.ZT),e.visible(!0);let p=(0,h.cx)(t,e,d.Kp);e.x(p)}else null==e||e.visible(!1)}}},973061:function(e,t,i){i.d(t,{X:function(){return u}});var r=i(931774),n=i(257296),a=i(251976),s=i(932919),o=i(857458),l=i(628499),d=i(933162);class u extends l.G{mount(){let{data:e,context:t}=this,{segment:i}=e,{type:l}=i;if((null==t?void 0:t.mode)==="template"||"combination"!==l)return;let u=new s.Group({listening:!1,x:n.z6,y:this.marginY,name:"TemplateTag"}),c="template-post"===t.mode?16:14,h=(0,r.eN)({fill:a.wL.lvvColorMain08,height:c});u.add(h);let g=(0,r.Ny)({name:"TemplateText",height:c,text:o.F.t("web_templates",{},"Template")}),m=(0,d.X5)({id:i.id,type:n.KX.Segment,nodeType:n.CD.Text,shape:g,config:{x:n.ZT+2}});u.add(m),h.width(m.x()+g.getTextWidth()+n.ZT);let p=u.getClientRect.bind(u);return u.getClientRect=()=>({...p(),width:h.width()}),u}update(){let e=this._konvaNodes[0],{isHover:t,isActive:i}=this.data;if(t&&i){e.visible(!1);return}e.visible(!0),e.setAttrs({x:n.z6,y:this.marginY})}constructor(...e){super(...e),this.dataPropertyNames=["segment","isLost","isLoading","isActive","extraTags","isHover","hideTitle"],this.marginX=6,this.marginY=5}}},367427:function(e,t,i){i.d(t,{$:function(){return d}});var r=i(932919),n=i(406751),a=i(251976),s=i(563890),o=i(628499),l=i(969242);class d extends o.G{static getTrackedProps(e,t,i){let{trackedInfos:r,segment:n}=e;if(!!r)return r.map(e=>{var r,a,s;let o=Math.min(t,(0,l.vY)(i,BigInt(Math.round(Number(e.end-e.start)/(null!==(a=n.speed)&&void 0!==a?a:1)))));return{width:Math.max(0,o-10),left:Math.max(5,Math.min((0,l.vY)(i,e.start-(null!==(s=null===(r=n.sourceTimeRange)||void 0===r?void 0:r.start)&&void 0!==s?s:0n)),t-10))}})}mount(){let{data:e}=this,{trackedInfos:t}=e;if(!t||"video"!==e.segment.type)return;let i=new r.Group;return this._group=i,this._createNodes(),this._updateAttrs(i),i}update(){let{data:e}=this,{trackedInfos:t}=e;if(!t)return;let i=this._group;if(!!i)this._updateAttrs(i)}updateData(e,t,i){var r;(null===(r=e.segment)||void 0===r?void 0:r.trackedTarget)&&((0,s.$V)(this._group),this._createNodes()),super.updateData(e,t,i)}_updateAttrs(e){let{data:t,style:i,context:r}=this,{x:n,y:a,width:o,height:l}=i,u=d.getTrackedProps(t,o,r.camera.zoom);if(!u)return;if(!this.getVisible()){e.visible(!1);return}let{trackedInfos:c}=t;null==c||c.forEach((t,i)=>{let r=(0,s.DM)(e,`group-tracked-line-${i}`),n=u[i];r&&r.setAttrs({x:0,y:0,points:[n.left,2,n.left+n.width,2]})}),e.setAttrs({x:n,y:a,width:o,height:l}),e.clip({x:0,y:0,width:o,height:l})}_createNodes(){let e=[],{data:t}=this,{trackedInfos:i}=t;null==i||i.forEach((t,i)=>{let r=new n.Line({stroke:a.wL.trackingTargetColor,strokeWidth:2,name:`group-tracked-line-${i}`,listening:!1});e.push(r)}),this._group&&this._group.add(...e)}constructor(...e){super(...e),this.clearOnInit=!0}}},3660:function(e,t,i){i.d(t,{Z:function(){return a}});var r=i(202426),n=i(563890);class a{boot(){this._addListeners()}destroy(){this._removeListeners(),this._hoverSegmentCO=void 0}_addListeners(){let{events:e}=this._renderer;e.interact.on(r.TY.onMutableButtonMouseEnter,this.onMouseenter),e.interact.on(r.TY.onMutableButtonMouseLeave,this.onMouseleave)}_removeListeners(){let{events:e}=this._renderer;e.interact.off(r.TY.onMutableButtonMouseEnter,this.onMouseenter),e.interact.off(r.TY.onMutableButtonMouseLeave,this.onMouseleave)}constructor(e){this.onMouseenter=e=>{let{target:t}=e,{id:i}=(0,n.tI)(t.name()),r=(0,n.JP)(this._renderer.children,i);if(!r)return;let{data:a}=r;!a.isHoverMutableButton&&r.updateData({isHoverMutableButton:!0},!0),this._hoverSegmentCO=r},this.onMouseleave=()=>{if(!this._hoverSegmentCO)return;let{data:e}=this._hoverSegmentCO;(null==e?void 0:e.isHoverMutableButton)&&this._hoverSegmentCO.updateData({isHoverMutableButton:!1},!0),this._hoverSegmentCO=void 0},this.onMousedown=()=>{},this.onMouseover=()=>{},this.onMouseout=()=>{},this.onDragstart=()=>{},this.onDragmove=()=>{},this.onDragend=()=>{},this.onClick=()=>{},this._renderer=e}}},331037:function(e,t,i){i.d(t,{Z:function(){return u}});var r=i(257296),n=i(251976),a=i(202426),s=i(563890),o=i(620183),l=i(887860),d=i(384971);class u{boot(){this._addListeners()}destroy(){this._removeListeners(),this._hoverSegmentCO=void 0}_getHighlightRect(){return this._highlightRect?this._highlightRect:(this._highlightRect=new o.Rect({strokeWidth:r.xm,stroke:n.wL.lvvColorBlack012,listening:!1}),this._highlightRect)}_addListeners(){let{events:e}=this._renderer;e.interact.on(a.TY.onSegmentMouseEnter,this.onMouseenter),e.interact.on(a.TY.onSegmentMouseLeave,this.onMouseleave),e.view.on(a.H2.segmentsWidthChange,this._onWidthChange),e.store.on(a.ML.tracksChange,this._onTracksChange),e.store.on(a.ML.onSelectedSegmentChange,this._onSelectedSegmentChange)}_removeListeners(){let{events:e}=this._renderer;e.interact.off(a.TY.onSegmentMouseEnter,this.onMouseenter),e.interact.off(a.TY.onSegmentMouseLeave,this.onMouseleave),e.view.off(a.H2.segmentsWidthChange,this._onWidthChange),e.store.off(a.ML.tracksChange,this._onTracksChange),e.store.off(a.ML.onSelectedSegmentChange,this._onSelectedSegmentChange)}_hoverTrackCO(e){let t=(0,s.JP)(this._renderer.children,e);t&&"selected"!==t.data.bgState&&!t.context.isCursorDrag&&t.updateData({bgState:"hover"},!0)}_unHoverTrackCO(e){let t=(0,s.JP)(this._renderer.children,e);t&&"selected"!==t.data.bgState&&t.updateData({bgState:"default"},!0)}_checkHadSelected(e,t){return t.type===r.KX.Segment&&"mutablePoly"===t.data.segment.type?t.data.segment.mutable.children.some(t=>e.find(e=>e===t.id)):e.includes(t.id)}_onSelectedSegmentChangeOnTemplatePost(e,t){let{events:i,mode:n}=this._renderer.context;if("template-post"!==n)return;let s=[],o=[];if(t.forEach(t=>{this._checkHadSelected(e,t)&&t.type===r.KX.Segment&&((0,l.x)(t.style)?s.push(t):o.push(t))}),s.length>0&&0===o.length){let{style:{x:e,y:t,width:r},data:n}=s[0];i.interact.emit(a.TY.popupLock,{x:e+r/2,y:t},n)}else i.interact.emit(a.TY.popupLock,!1)}_updateActiveTracks(e){let t=new Set;e.forEach(e=>{let i=(0,s.JP)(this._renderer.children,e);if(i){let{track:e}=i.data;t.add(e.id)}}),(0,s.Mq)(this._renderer.children,r.KX.Track).forEach(e=>{e.active(t.has(e.id),!0)})}constructor(e){this.onMouseenter=e=>{var t,i;this._handleUnHoverSegmentCO();let{dragState:n}=this._renderer.context;if("dragging"===n||"prepare"===n)return;let{target:a}=e,{id:o}=(0,s.tI)(a.name()),l=(0,s.JP)(this._renderer.children,o);if(!l)return;if(this._handleHoverSegmentCO(l),null===(t=l.data)||void 0===t?void 0:t.isActive)return;let u=this._getHighlightRect(),c=(0,d.C5)(l.style.width);u.setAttrs({x:a.x()+1,y:a.y()+1,width:a.width()-r.xm,height:a.height()-r.xm,cornerRadius:(0,d.yW)(c),coId:o}),null===(i=a.parent)||void 0===i||i.add(u)},this.onMouseleave=()=>{this._handleUnHoverSegmentCO(),this._getHighlightRect().remove()},this.onMousedown=()=>{},this.onMouseover=()=>{},this.onMouseout=()=>{},this.onDragstart=()=>{},this.onDragmove=()=>{},this.onDragend=()=>{},this.onClick=()=>{},this._handleHoverSegmentCO=e=>{if(!e||e.destroyed)return;let{data:t}=e;!t.isHover&&(e.updateData({isHover:!0},!0),this._hoverTrackCO(t.track.id)),this._hoverSegmentCO=e},this._handleUnHoverSegmentCO=()=>{if(!this._highlightRect||!this._hoverSegmentCO)return;let{data:e}=this._hoverSegmentCO;(null==e?void 0:e.isHover)&&(this._hoverSegmentCO.updateData({isHover:!1},!0),this._unHoverTrackCO(e.track.id)),this._hoverSegmentCO=void 0},this._onSelectedSegmentChange=e=>{let t=(0,s.Mq)(this._renderer.children,[r.KX.Segment,r.KX.Transition]);if(0!==t.length)this.onMouseleave(),t.forEach(t=>{let i=this._checkHadSelected(e,t);t.active(i,!0)}),this._onSelectedSegmentChangeOnTemplatePost(e,t),this._updateActiveTracks(e)},this._onTracksChange=()=>{var e;if(!(null===(e=this._highlightRect)||void 0===e?void 0:e.parent))return;let t=this._highlightRect.getAttr("coId"),i=(0,s.JP)(this._renderer.children,t);if(!i){this._highlightRect.remove(),this._hoverSegmentCO=void 0;return}let{style:n}=i,a=(0,d.C5)(n.width);this._highlightRect.setAttrs({x:n.x+1,y:n.y+1,width:a,height:n.height-r.xm,cornerRadius:(0,d.yW)(a)})},this._onWidthChange=()=>{var e;if(!(null===(e=this._highlightRect)||void 0===e?void 0:e.parent)||!this._hoverSegmentCO)return;let{style:t}=this._hoverSegmentCO,i=(0,d.C5)(t.width);this._highlightRect.setAttrs({x:t.x+1,width:i,cornerRadius:(0,d.yW)(i)})},this._renderer=e}}},556249:function(e,t,i){i.d(t,{d:()=>C});var r=i("21853");class n{get(e){let t=this.cache.pop();return!t&&(t=e()),t}set(e){if(this.cache.length===this.maxCount){e.destroy();return}e.remove(),this.cache.unshift(e)}clear(){this.cache.length=0}constructor(e){this.cache=[],this.maxCount=e}}var a=i("992775"),s=i("45783"),o=i("932919"),l=i("407976"),d=i("257296"),u=i("202426"),c=i("789872"),h=i("997790"),g=i("721244"),m=i("563890"),p=i("907031"),f=i("404161");class _{get _scrollManager(){return this._renderer.scrollManager}init(){this._addListeners(),this._initViewport()}update(e){let{camera:t}=this._renderer,{width:i}=t.getWorldBounds();if(!(i<=0))this._updateTracks(e),this._updateTracksBoundingHeight(e),this._updateSegments(e),this._updateTransitions(e),this._updateCameraWorldHeight()}updateY(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{children:t,camera:i}=this._renderer,r=(0,m.Mq)(t,d.KX.Track),n=this._getSortedTrackCOs(r),a=n.map(e=>e.style),{height:s}=i.getViewport();this._updateTracksPositionYByRects(a,s,n),this._updateTracksBoundingHeight(t),n.forEach(e=>{e.render()}),this._updateSegmentsPositionY(t),e&&this._updateCameraWorldHeight()}destroy(){this._removeListeners(),this._container=void 0,this._largeContainer=void 0}_autoLayout(){let{children:e}=this._renderer;for(let t of this.needLayoutCanvasObjectTypes){let i=(0,m.hH)(e,t);null==i||i.layout()}}_scrollLayer(e,t){this._container.style.transform=`translate(${e}px, ${t}px)`,this._layer.x(-e),this._layer.y(-t)}_initViewport(){this._renderer.camera.initViewportSize(this._layer.width(),this._scrollManager.getHeight(this._layer.height()))}_updateTracksBoundingHeight(e){var t;let i=(0,m.Mq)(e,d.KX.Track),r=this._getSortedTrackCOs(i).map(e=>e.style),n=0;r.forEach(e=>{let{y:t,height:i}=e;n=Math.max(n,t+i)}),this._tracksBoundingHeight=n-((null===(t=r[0])||void 0===t?void 0:t.y)||0)}_getTracksMarginTop(){return"template"===this._renderer.context.mode?0:d.MI}_updateCameraWorldHeight(){let e=this._getTracksMarginTop(),t=this._tracksBoundingHeight+d.lK+e;this._renderer.camera.setRealHeight(t)}_updateSegments(e){let t=(0,m.Mq)(e,d.KX.Track),i=this._getRectMap(t),r=(0,m.Mq)(e,d.KX.Segment),n=r.map(e=>e.data),a=this._calcSegmentsBoundingRect(n,i);return r.forEach((e,t)=>e.updateStyle(a[t],!1)),a}_updateTransitions(e){let t=(0,m.Mq)(e,d.KX.Transition),i=(0,m.Mq)(e,d.KX.Track),r=this._getRectMap(i),n=t.map(e=>e.data),a=this._calcTransitionsBoundingRect(n,r);return t.forEach((e,t)=>e.updateStyle(a[t],!1)),a}_getRectMap(e){let t={};return e.forEach(e=>t[e.id]=e.style),t}_getSortedTrackCOs(e){e.sort((e,t)=>e.data.cTrack[1]-t.data.cTrack[1]);let t=e.filter(e=>"upper"===e.data.cTrack[2]).reverse(),i=e.filter(e=>"main"===e.data.cTrack[2]),r=e.filter(e=>"under"===e.data.cTrack[2]);return 0===t.length&&0===i.length&&0===r.length?e:[...t,...i,...r]}_updateTracks(e){let t=(0,m.Mq)(e,d.KX.Track),i=this._getSortedTrackCOs(t),r=this._getTracksBoundingRect(i);return i.forEach((e,t)=>e.updateStyle(r[t],!1)),r}_calcTransitionsBoundingRect(e,t){let{zoom:i}=this._renderer.camera,{mode:r}=this._renderer.context;return e.map(e=>{let{segment:n,transition:a,track:s}=e;return(0,f.wm)(n,a,i,r,t[s.id])})}_calcSegmentsBoundingRect(e,t){let{zoom:i}=this._renderer.camera,{mode:r}=this._renderer.context;return e.map(e=>{let{segment:n,track:a}=e;return(0,f.RD)(n,i,r,t[a.id])})}_getTrackWidth(e,t){let i=e-d.wX;return t&&(i-=8),i}_getTracksBoundingRect(e){let t=e.map(e=>e.data),{height:i}=this._renderer.camera.getViewport(),{width:r}=this._renderer.camera.getWorldBounds(),n=t.map(e=>(0,f.ZY)(e.cTrack,e.display,r,this._renderer.context.mode));return this._updateTracksPositionYByRects(n,i,e),n}_updateTracksPositionYByRects(e,t,i){let r=0,n=e.reduce((e,t)=>{let{height:i}=t;return e+i},0),a=i.length,s=i.map((e,t)=>t===a-1?0:e.data.includeRelationVideoGroup?p.I1:p.Zn),o=this._getTracksMarginTop();e.length>1?(n+=s.reduce((e,t)=>e+t,0),r=n,n+=d.lK+o):r=n;let l=(t-r)/2,u=0;u=t<n?o:Math.max(l,0),e.forEach((e,t)=>{e.y=u,u+=e.height+s[t]})}_updateSegmentsPositionY(e){let t=(0,m.Mq)(e,d.KX.Segment),i=[...t,...(0,m.Mq)(e,d.KX.Transition)],r=(0,m.Mq)(e,d.KX.Track),n=this._getRectMap(r);return i.forEach(e=>{let{track:t}=e.data;n[t.id]&&e.updateStyle({y:n[t.id].y})}),i}_addListeners(){let{events:e}=this._renderer;e.view.on(u.H2.viewportPositionChange,this._onViewportPositionChange),e.view.on(u.H2.cameraSizeChange,this._onCameraSizeChange),e.view.on(u.H2.worldSizeChange,this._onWorldSizeChange),e.view.on(u.H2.viewportZoomChange,this._onViewportZoomChange)}_removeListeners(){let{events:e}=this._renderer;e.view.off(u.H2.viewportPositionChange,this._onViewportPositionChange),e.view.off(u.H2.cameraSizeChange,this._onCameraSizeChange),e.view.off(u.H2.worldSizeChange,this._onWorldSizeChange),e.view.off(u.H2.viewportZoomChange,this._onViewportZoomChange)}constructor(e,t){this.needLayoutCanvasObjectTypes=[d.KX.SubSequenceMask],this._tracksBoundingHeight=0,this._drawCall=()=>{this._renderer.checkWillRenderChildren(),this._renderer.batchDraw()},this._onViewportPositionChange=(e,t)=>{if(e.x!==t.x){let e=this._renderer.camera.getBounds();this._scrollLayer(e.x,e.y),this._drawCall()}},this._onWorldSizeChange=(e,t)=>{let{width:i,height:r}=e;if(this._largeContainer&&(this._largeContainer.style.height=`${r}px`,this._largeContainer.style.width=`${i}px`),t.width!==e.width){let{children:e}=this._renderer;(0,m.Mq)(e,d.KX.Track).forEach(e=>{var t;e.updateStyle({width:(0,f.MU)(i,(null===(t=e.data)||void 0===t?void 0:t.display)===g.j.Empty)})})}},this._onCameraSizeChange=(e,t)=>{e.height!==t.height&&this._updateCameraWorldHeight();let i=this._layer.getStage();if(i.width(e.width),i.height(e.height),0===e.height||0===e.width)return;let{children:r,camera:n}=this._renderer,{width:a}=n.getWorldBounds(),{width:s,height:o}=n.getViewport();0===t.width&&0!==e.width?(this.update(r),this._renderer.events.view.emit(u.H2.segmentsWidthChange)):(t.width!==s&&(0,m.Mq)(r,d.KX.Track).forEach(e=>{var t;e.updateStyle({width:(0,f.MU)(a,(null===(t=e.data)||void 0===t?void 0:t.display)===g.j.Empty)})}),o!==t.height&&this.updateY()),this._drawCall()},this._onViewportZoomChange=()=>{let{children:e}=this._renderer;this._updateSegments(e),this._updateTransitions(e),this._renderer.checkWillRenderChildren(),(0,m.Mq)(e,d.KX.Segment).forEach(e=>{e.render()}),this._autoLayout(),this._renderer.events.view.emit(u.H2.segmentsWidthChange),this._renderer.batchDraw()},this._renderer=e,this._layer=t,this._container=this._layer.getStage().content,this._largeContainer=this._container.parentElement}}var v=i("401790"),y=i("298136"),M=i("398142"),S=i("200058"),w=i("804718"),T=i("795019"),b=i("522590"),k=i("425726"),x=i("756024"),I=i("357940"),R=i("5240");class C{remove(e){let t=this.children.get(e);if((null==t?void 0:t.type)===d.KX.Segment){this._thumbnailManager.resetSourceCache(e);let{thumbnailImage:i}=t.data;(0,I.V$)(i)}null==t||t.destroy(),this.children.delete(e)}batchRemove(e){for(let t of e)this.remove(t)}add(e,t,i,r){let n;this.children.has(e)&&(x.t.error(`[sequence renderer]: ${t} ${e} is already created`),this.remove(e));let a={layer:this._layer,id:e,data:i,style:r,context:this.context};switch(t){case d.KX.Track:n=new S.Z(a);break;case d.KX.Segment:n=new w.Z(a);break;case d.KX.Transition:n=new T.Z(a);break;case d.KX.SubSequenceMask:n=new b.Z(a)}return n&&this.children.set(n.id,n),n}batchAdd(e){for(let t of e)this.add(t.key,t.type,t.props)}refreshAll(e){for(let{key:t,type:i,props:r}of(this._beforeRefresh(),e)){let e=this._reconciler.getRecycleCO(t),n={...r};e?(e.setVisible(!0),e.updateData(n,!1,!0),this.children.set(e.id,e)):this.add(t,i,n)}this._afterRefresh()}updateStyleById(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=this.children.get(e);if(!r||!t)return;let{visible:n,...a}=t;"boolean"==typeof n&&r.setVisible(n);let s=!1,o=!1,l=!1;r.type===d.KX.Segment&&(s=void 0!==t.width&&void 0!==t.x,o=void 0!==t.width&&r.style.width<t.width,l=void 0!==t.height&&r.style.height!==t.height);let u={};for(let e of Object.keys(a))void 0!==a[e]&&(u[e]=a[e]);r.updateStyle(u,i),s||o?this.updateThumbnailById(e,!0):l&&this.updateThumbnailById(e,!1)}batchUpdateStyle(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!!e.length)e.forEach(e=>{let{id:i,...r}=e;this.updateStyleById(i,r,t)})}updateDataById(e,t,i){let r=this.children.get(e);if(!!r)r.updateData(t,!0,i)}updateThumbnailById(e,t){let i=this.children.get(e);if(!i)return;let{segment:r}=i.data;(0,I.M9)(null==r?void 0:r.type)?this._thumbnailManager.refreshThumbnailBySegmentCO(i,t):(0,R.rm)(null==r?void 0:r.type)&&this._thumbnailManager.refreshWaveBySegmentCO(i,t)}updateContext(e){if(!!Object.entries(e).some(e=>{let[t,i]=e;return!Object.is(i,this.context[t])}))Object.assign(this.context,e),"template"===this.context.mode?this._audioEditManager.setActive(!0):this._audioEditManager.setActive(!1)}setTheme(e){this.theme=e,this._clearAllNodes(),this.batchDraw()}getStage(){return this._stage}boot(){if(!this._isBooted)this._isBooted=!0,this._inputManager.boot(),this._mouseManager.boot(),this._resizeManager.boot(),this._thumbnailManager.boot(),this._audioEditManager.boot()}destroy(){this._clear(),this._layer.destroy(),this._inputManager.destroy(),this._mouseManager.destroy(),this._resizeManager.destroy(),this._audioEditManager.destroy(),this._isBooted=!1}initContainer(e){if(this._isBooted){e.forEach((e,t)=>{let i=(0,m.dX)(this._layer,e);i&&i.zIndex(t)});return}e.forEach(e=>{let t=new o.Group({id:e});this._layer.add(t)})}render(){for(let e of(this._preRender(),this._getVisibleChildren(this.children)))e.render();this._postRender()}batchDraw(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(e)for(let e of this._getVisibleChildren(this.children))e.render()}layout(e){"column"===e?this._layoutSystem.updateY(!0):this._layoutSystem.update(this.children)}checkWillRenderChildren(){let e=this.camera.getBounds();Array.from(this.children.values()).forEach(t=>{t.checkWillRender(e)})}_clearAllNodes(){for(let t of Array.from(this.children.keys())){var e;null===(e=this.children.get(t))||void 0===e||e.clear()}this._layer.children.forEach(e=>{"destroyChildren"in e&&e.destroyChildren()})}_clear(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.children;for(let i of Array.from(e.keys())){var t;null===(t=e.get(i))||void 0===t||t.destroy()}e.clear()}_beforeRefresh(){this._reconciler.create(new Map(this.children.entries())),this.children.clear()}_afterRefresh(){let e=this._reconciler.reset();this._clear(e)}_getVisibleChildren(e){return Array.from(e.values()).filter(e=>e.getVisible())}_postRender(){}_preRender(){this.checkWillRenderChildren()}constructor(e,t,i){this._store=t,this._modules=i,this.events=new u.ce,this.children=new Map,this.camera=new c.Z(this.events),this.context={mode:"default",events:this.events,camera:this.camera,cache:{image:new r.Y(50),activeBorder:new n(50)}},this._isBooted=!1,this._stage=e,this._layer=new l.Layer,this._stage.add(this._layer),this.scrollManager=new k.m,this._layoutSystem=new _(this,this._layer),this._inputManager=new v.Z(this),this._mouseManager=new h.Z(this,this._layer,this._inputManager),this._thumbnailManager=new M.Z(this,this._store,this._modules),this._resizeManager=new y.Z(this,this._layer,this._store),this._reconciler=new a.Z,this._audioEditManager=new s.Z(this,this._store,this._modules),this._layoutSystem.init(),this._thumbnailManager.init()}}},934065:function(e,t,i){i.d(t,{Jo:function(){return a},Wh:function(){return o},tx:function(){return l}});var r=i(426336);let n=e=>e>1000n*1000n?1*Number(e/1000n)/1e3:1*Number(e)/1e3/1e3,a=1e3;class s{constructor(e,t){this.key=e,this.value=t,this.prev=null,this.next=null}}class o{_addNode(e){if(!this.head){this.head=e;return}e.prev=this.head,e.next=this.head.next,this.head&&this.head.next&&(this.head.next.prev=e),this.head&&(this.head.next=e)}_removeNode(e){let{prev:t}=e,{next:i}=e;t&&(t.next=i),i&&(i.prev=t)}_moveToHead(e){this._removeNode(e),this._addNode(e)}_removeTail(){if(!this.tail)return null;let e=this.tail.prev;return e?(this._removeNode(e),e):null}get(e){let t=this.cache.get(e);return t?(this._moveToHead(t),t.value):null}put(e,t){let i=this.cache.get(e);if(i)i.value=t,this._moveToHead(i);else if(i=new s(e,t),this.cache.set(e,i),this._addNode(i),this.cache.size>this.capacity){let e=this._removeTail();if(e){var r;this.cache.delete(e.key),null===(r=e.value)||void 0===r||r.snapshot.close()}}}constructor(e){this.capacity=e,this.cache=new Map,this.head=new s(0,null),this.tail=new s(0,null),this.head.next=this.tail,this.tail.prev=this.head}}class l{static createInstance(e){return!l.instance&&(l.instance=new l(e)),l.instance}static getInstance(){return l.instance?l.instance:null}_getTaskId(e,t){return`${e}_${t[0].toString()}_${t[t.length-1].toString()}`}_transSnapshotResultSingleCall(e,t,i){let r=[];for(let e of i){let i=new Uint8ClampedArray(this.fs.readFileSync(e.rawPath));this.fs.rmSync(e.rawPath);let n=new ImageData(e.width,e.height);n.data.set(i);let a=new OffscreenCanvas(e.width,e.height);a.getContext("2d").putImageData(n,0,0);let s=a.transferToImageBitmap(),o={responsePts:e.response_pts,requestPts:e.resquest_pts,isKeepFrame:!0,snapshot:s,assetId:e.assetId,path:t,dstW:e.width,dstH:e.height};r.push(o)}this.onCacheSnapshotTaskOkCallback({id:e,data:r})}get fs(){return this._renderManager.fs}async _transSnapshotResultToCache(e){let{id:t}=e,{path:i}=e,{snapshots:r}=e,n=e.isInit||!1,{ptsList:a}=e;if(!t||!i||r.length<=0){console.error("density _transSnapshotResultToCache param empty",e);return}let s=[],o=[];for(let e of r){let t=new Uint8ClampedArray(this.fs.readFileSync(e.rawPath));this.fs.rmSync(e.rawPath);let r=new ImageData(e.width,e.height);r.data.set(t);let n=new OffscreenCanvas(e.width,e.height);n.getContext("2d").putImageData(r,0,0),s.push(createImageBitmap(n).then(t=>(o.push({assetId:e.assetId,image:t,width:e.width,height:e.height,path:i,response_pts:e.response_pts,resquest_pts:e.resquest_pts,spriteCanvas:n}),t)))}try{await Promise.all(s)}catch(e){}this._prepareSnapshotsToCache(t,n,o,e.splitStart,e.splitEnd)}_binarySearch(e,t){let i=0,r=e.length-1;if(t>e[r].requestPts&&e.length-1===r)return r;if(t<e[i].requestPts&&0===i)return i;for(;i<=r;){let n=Math.floor((i+r)/2);if(e[n].requestPts===t)return n;if(e[n].requestPts<t){if(e[n+1]&&e[n+1].requestPts>=t)return n+1;i=n+1}else{if(e[n-1]&&e[n-1].requestPts<=t)return n-1;r=n-1}}return -1}_prepareSnapshotsToCache(e,t,i,r,a){let s=this._snapshotRecordsCache.get(e),o=!s,l=s||[];n(r),n(a);let d=e=>{if(0===l.length)return l.push(e),1;if(l[l.length-1].requestPts<e.requestPts)return l.push(e),l.length;for(let t=0;t<l.length;t++)if(l[t].requestPts>e.requestPts)return l.splice(t,0,e),l.length;return 0},u=[];for(let e of i){e.spriteCanvas=null;let t={responsePts:e.response_pts,requestPts:e.resquest_pts,isKeepFrame:o,snapshot:e.image,path:e.path,assetId:e.assetId,dstW:e.width,dstH:e.height};d(t),u.push(t)}return this._snapshotRecordsCache.set(e,l),t?this.onCacheSnapshotEditInitCallback({id:e,data:u}):this.onCacheSnapshotTaskOkCallback({id:e,data:u}),!0}_getAssetIdAndDecryptKeyByPath(e,t,i,n){let a={dstW:60,dstH:60,ptsList:t,isInit:i};if(2===n.length&&([a.dstW,a.dstH]=n),!e||e.length<=0)return a;let s=r.k92.getInstance(),o=s.pathRecords.get(e),l=s.decryptRecords.safeGet(o);return a.assetId=o,a.decryptKey=l,a}genSnapshotFrame(e,t,i,r,n,a,s){if(!e||!t||n.length<1)return console.error("density TASK ERROR ",e,t,n,a),"";let o=this._getTaskId(e,n),l=this._snapshotTaskStatus.get(o);if(l&&new Date().getTime()-l.startTime<Math.max(1e4,40*n.length))return console.error("density TASK IS EXCUTING",o),"";let d=this._getAssetIdAndDecryptKeyByPath(t,n,a,s);if(!d.assetId||!d.decryptKey)return null;d.taskId=o;let u={id:e,path:t,assetId:d.assetId,ptsList:n,splitStart:i,splitEnd:r,isOK:!1,snapshots:[],taskId:o,isInit:a,veParam:d,startTime:new Date().getTime()};return this._snapshotTaskStatus.set(o,u),this._renderManager.getSingleVideoSnapshot(e,t,d),u.taskId}constructor(e){this.renderManager=e,this._snapshotRecordsCache=new Map,this._snapshotTaskStatus=new Map,this._renderManager=e,this._renderManager.onGetSingleVideoSnapshot(e=>{let{taskId:t}=e,i=this._snapshotTaskStatus.get(t);null!=i?(i.snapshots.push(e),i.isOK=i.snapshots.length===i.ptsList.length,i.isOK&&(this._snapshotTaskStatus.delete(t),this._transSnapshotResultSingleCall(e.id,e.path,i.snapshots))):this._transSnapshotResultSingleCall(e.id,e.path,[e])}),this.onCacheSnapshotTaskOkCallback=e=>!0,this.onCacheSnapshotEditInitCallback=e=>!0}}},690492:function(e,t,i){i.d(t,{Z:function(){return y}});var r=i(772322),n=i(105789),a=i.n(n),s=i(256357),o=i(446352),l=i(218571),d=i(690674),u=i(969242),c=i(857670),h=i(426336),g=i(371140),m=i(112825),p=i(959292),f=i(670933),_=i(432092),v=i(260963);let y=(0,f.f3)("store","modules")((0,f.Pi)(e=>{let{store:t,modules:i}=e,n=(0,l.useRef)(null),{timelineUI:f,player:y,coordinate:M,event:S}=i,{videoPreviewStatus:w,videoPreviewDuration:T}=t[d.VT],{[d.U_]:b}=t,{previewLine:k}=f,{zoomStore:x,duration:I,operationWidth:R}=b,{timelinePreviewLineStatus:C,timelinePreviewLineFrozen:D,timelinePreviewLineSeekTime:A}=b,P=(0,l.useRef)(!1),E=(0,l.useRef)(!1),N=(0,l.useRef)(),j=(0,l.useRef)(!1),O=(0,l.useRef)(!1),L=(0,l.useRef)(!1),B=(0,l.useRef)(C===g.$o.ENABLE),F=w===o.bC.Playing||w===o.bC.OnDisplay?T:I,U=e=>{let t,{relative:i,time:r,zoomValue:n,previewWrapDuration:a}=e,s=M.context.reference.adsorbX(i);return t=void 0!==s?(0,u.TF)(n,s):(0,c.i1)(h.pMA.max([h.pMA.min([r,a],"bigint"),0],"bigint"))};(0,l.useEffect)(()=>{let e=()=>{E.current||P.current||O.current||j.current?(k.setPreviewLineStatus(g.$o.DISABLE),B.current=!1):B.current=!0},i=(0,v.U5)(()=>({isCursorDrag:M.context.store.isCursorDrag,isDragging:M.context.store.isDragging,isSegWidgetDragging:b.isSegWidgetDragging}),t=>{let{isSegWidgetDragging:i,isCursorDrag:r,isDragging:n}=t;P.current=!!(n||r||i),e()},{fireImmediately:!0}),r=(0,v.U5)(()=>({isHoverCursor:M.context.store.isHoverCursor}),t=>{let{isHoverCursor:i}=t;E.current=i,e()},{fireImmediately:!0}),n=(0,v.U5)(()=>({isVideoPlaying:t[d.VT].unionPlaying}),t=>{let{isVideoPlaying:i}=t;O.current=i,e()},{fireImmediately:!0}),a=()=>{j.current=!1,e()},s=()=>{j.current=!0,e()};return M.on(m.B.timelineEnter,a),M.on(m.B.timelineLeave,s),()=>{i(),r(),n(),M.off(m.B.timelineEnter,a),M.off(m.B.timelineLeave,s)}},[b]),(0,l.useEffect)(()=>{let e=e=>{let{relative:i,time:r}=e;if(!n.current)return;N.current={relative:i,time:r};let a=U({relative:i,time:r,zoomValue:x.value,previewWrapDuration:F});if(!t[d.U_].timelinePreviewLineFrozen&&(n.current.style.transform=`translateX(${(0,u.vY)(x.value,a)}px)`),B.current&&t[d.U_].timelinePreviewLineStatus===g.$o.DISABLE){k.setPreviewLineStatus(g.$o.ENABLE);return}(t[d.U_].timelinePreviewLineStatus===g.$o.ENABLE||B.current)&&!t[d.U_].timelinePreviewLineFrozen&&(k.setPreviewLineSeekTime(a),y.seekWithSpeed(a,p.H.onGoing,0,0,!0))};return M.on(m.B.previewLineSeek,e),()=>{M.off(m.B.previewLineSeek,e)}},[F,x.value]);let V=(0,l.useRef)(A);return V.current=A,(0,l.useEffect)(()=>{if(!n.current)return;if(!V.current){n.current.style.transform="translateX(0px)";return}let e=(0,u.vY)(x.value,V.current);n.current.style.transform=`translateX(${e}px)`},[x.value]),(0,l.useEffect)(()=>{let e=(0,v.U5)(()=>{let{progress:e}=b,{unionPlaying:i}=t[d.VT];return{timelinePreviewLineStatus:t[d.U_].timelinePreviewLineStatus,timelinePreviewLineFrozen:t[d.U_].timelinePreviewLineFrozen,timelinePreviewLineSeekTime:t[d.U_].timelinePreviewLineSeekTime,progress:e,isVideoPlaying:i}},e=>{let{timelinePreviewLineStatus:t,timelinePreviewLineFrozen:i,timelinePreviewLineSeekTime:r,progress:n,isVideoPlaying:a}=e;if(L.current){L.current=!1;return}if(!i&&t===g.$o.DISABLE&&void 0!==r){if(k.setPreviewLineSeekTime(void 0),a)return;y.seekWithSpeed(n,p.H.onGoing,0,0,!1)}},{fireImmediately:!0});return()=>{e()}},[k]),(0,l.useEffect)(()=>{let e;let t=t=>{if(N.current){let i=t.draftView.getDraftMetadata().duration,r=U({...N.current,zoomValue:x.value,previewWrapDuration:i});e&&clearTimeout(e),e=setTimeout(()=>{!D&&n.current&&(n.current.style.transform=`translateX(${(0,u.vY)(x.value,r)}px)`),k.setPreviewLineSeekTime(r),k.setPreviewLineStatus(g.$o.ENABLE),y.seekWithSpeed(r,p.H.onGoing,0,0,!0)},100)}},i=()=>{L.current=!0};return S.uiEvents.on(_.W.SEGMENT_DRAG_END,t),S.uiEvents.on(_.W.CLICK_BLANK,i),()=>{e&&clearTimeout(e),S.uiEvents.off(_.W.SEGMENT_DRAG_END,t),S.uiEvents.off(_.W.CLICK_BLANK,i)}},[x.value,D]),(0,r.jsx)("div",{ref:n,className:a()(s.Z.timelinePreviewLine,C===g.$o.DISABLE&&!D&&s.Z.disabled),style:{left:`${R}px`}})}))},379939:function(e,t,i){i.d(t,{h:()=>eu,Z:()=>eh});var r=i("772322"),n=i("142377"),a=i("218571"),s=i("486504"),o=i("579799"),l=i("303533");i("966156"),i("784923"),i("55041"),i("931598");var d=i("368100"),u=i("498417"),c=i("519065"),h=i("16464"),g=i("860660"),m=i("937802"),p=i("800788"),f=i("424369"),_=i("850649"),v=i("928261"),y=i("492430"),M=i("22495"),S=i("584341"),w=i("422404"),T=i("452210"),b=i("690674"),k=i("112825"),x=i("804497"),I=i("709488"),R=i("969242"),C=i("607549"),D=i("199908"),A=i("882685"),P=i("736055"),E=i("325805"),N=i("310147"),j=i("896413"),O=i("425427"),L=i("108692"),B=i("797913"),F=i("426336"),U=i("230689"),V=i("801497"),Z=i("150564"),G=i("670933"),z=i("854862"),Y=i("141913"),H=i("764305"),K=i("956626"),W=i("432092"),q=i("634696"),X=i("566504"),Q=i("282527"),J=i("352318");let $=15n*60n*1000n*1000n,ee=(0,G.f3)("store","contribution","modules")((0,G.Pi)(e=>{var t;let i,{store:n,disabled:s,children:o,modules:l,contribution:G}=e,{draftOperation:ee,coordinate:et,timelineUI:ei,modal:er,keybinding:en,partialExportManager:ea,selection:es,player:eo,fileUpload:el,event:ed,segmentManager:eu}=l,{timelineStore:ec,timelineSelectionStore:eh,timelinePlayerStore:eg}=n,{segmentSelected:em,segmentSelectedTimeRange:ep,timeRangeSegmentIds:ef,partialExportError:e_}=eh,{selectedRangeErr:ev,selectedErr:ey}=e_,eM=(0,m.G)(j.a),eS=(0,m.G)(O.rO),{keyframeStore:ew,isTemplate:eT,zoomStore:eb,loadingSegments:ek,exportReady:ex}=ec,[eI,eR]=(0,a.useState)(!1),[eC,eD]=(0,a.useState)(!1),[,eA]=(0,a.useReducer)(e=>e+1,0),[eP,eE]=(0,a.useState)(w.D.NORMAL),eN=(0,a.useRef)(-1n),ej=(0,a.useRef)(null),eO=!!em.length,eL=(0,m.G)(U.t),eB=(0,m.G)(L.n),eF=em.some(x.lo),eU=em.some(x.j5),eV=em[0],eZ=1===em.length,eG=(null==eV?void 0:eV.type)==="video",[ez,eY]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!eV||!(0,v.uG)(eV)){eY(!1);return}let{templateId:e}=eV;e&&eB.draftTemplateManager.getTemplate(e).then(e=>{eY(null==e?void 0:e.mute)})},[eV]);let eH=(0,v.IM)(eV)&&(null==eV?void 0:null===(t=eV.sourceMaterial)||void 0===t?void 0:t.sourcePlatform)===F.cvu.MaterialPlatformBrand,eK=(0,a.useMemo)(()=>{var e;return!(null==eV?void 0:null===(e=eV.video)||void 0===e?void 0:e.hasAudio)||(0,v.uG)(eV)&&ez||eH},[eV,ez]),eW=eZ&&(null==ek?void 0:ek[null==eV?void 0:eV.id]),[eq,eX]=(0,a.useState)(!1),[eQ,eJ]=(0,a.useState)(0),[e$,e0]=(0,a.useState)("reverse"),e5=(0,a.useRef)(),e8=(0,a.useRef)(),e1=(0,a.useCallback)(()=>{eR(!1)},[eR]),e2=(0,a.useMemo)(()=>!!em.length&&!em.some(e=>(0,v.IM)(e)),[em]),e4=(0,a.useMemo)(()=>em.some(e=>(0,x.pE)(e)),[em]),e6=(0,C.X)(em),e3=(0,C.u)(em,e6),e9=(0,a.useCallback)(()=>{var e;if(1!==em.length||(null==em?void 0:null===(e=em[0])||void 0===e?void 0:e.type)!=="audio")return!1;let{id:t,speed:i,start:r,sourceTimeRange:n,duration:a}=em[0];return!!ee.beat.getAllBeats(t,i,null==n?void 0:n.start,r,a).length},[em]),{keyframeCopyCacheSegment:e7}=ew;(0,a.useMemo)(()=>1===em.length&&e7&&em[0].type===e7.type,[em,e7]);let te=(0,a.useMemo)(()=>!!eZ&&!eU&&(0,v.IM)(eV)&&!(0,x.pE)(eV)&&eV.metaType===F.cVg.MetaTypeVideo,[eZ,eV,eU]),tt=(0,a.useMemo)(()=>!te||eW,[te,eW]),ti=(0,m.G)(B.J),tr=ti.getAppConfigurationValue("hideTranscribe"),tn=ti.getAppConfigurationValue("starlingKey.transcript.multiTrackName"),ta=(0,a.useMemo)(()=>{if(tr||eT||eU)return!1;let e=em.map(e=>e.id);return 1===ec.tracks.filter(t=>{let[i]=t;return null==i?void 0:i.segments.find(t=>e.includes(t.id))}).map(e=>e[0]).length&&eh.segmentSelected.every(e=>"video"===e.type&&e.metaType===F.cVg.MetaTypeVideo||"audio"===e.type&&!e.materialDraft)},[em,eT,n,eU]),ts=(0,a.useMemo)(()=>`${(0,S.ci)(F.pMA.div(ep.start,1e3),void 0,void 0,!0)} - ${(0,S.ci)(F.pMA.div(ep.end,1e3),void 0,void 0,!0)}`,[ep]),to=ex&&(null==ep?void 0:ep.end)>0&&!eT&&!eS.isInSdkIframe,[tl,td]=(0,a.useState)(!0),[tu,tc]=(0,a.useState)();(0,a.useEffect)(()=>{var e;if(!tu){td(!0);return}let t=(0,I.HO)(em);et.context.mouse.calculate({x:tu.clientX,y:tu.clientY});let i=(0,R.TF)(eb.value,null===(e=et.context.mouse.relative)||void 0===e?void 0:e.x);td((0,I.eb)({dataSdk:eB.dataSdk,segmentSelected:em,currentSeekTime:i,splitTarget:t}))},[em,tu,eb.value]);let th=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];ea.triggerPartialExport({segmentIds:e?ef:em.map(e=>e.id),includeAll:e,timeRange:{...ep}})},tg=(0,a.useCallback)(()=>{let e=es.getSelectedSegments();ee.segment.copySelectedSegments(),(0,E.JP)(eL,{action_type:E.Gt.RIGHTCLICK,function_name:E.BS.COPY,...(0,g.KG)(e)})},[]),tm=(0,a.useCallback)(()=>{ee.segment.duplicateSelectedSegments()},[]),tp=()=>{var e;if(!e5.current||!e8.current)return;et.context.mouse.calculate({x:e5.current.clientX,y:e5.current.clientY});let t=(0,R.cD)(eb.value,null===(e=et.context.mouse.relative)||void 0===e?void 0:e.x),i=F.pMA.times(t,1e3,"bigint");(0,q.Ky)(i),eM.timelineManager.freezeManager.freezeSegment(e8.current,i)},tf=(0,a.useCallback)(()=>{let e=n[b.qk].segmentSelected.map(e=>{let{id:t}=e;return l.draftOperation.getSegmentById(t)}).filter(Boolean);if((0,N.a5)(eL,{position:"track_line"}),!(0,M.X)(e)){d.Z.info({title:V.oc.t("web_text_edit_title_remove_speed",{},"This clip applied speed. Remove speed to transcribe."),okText:V.oc.t("confirm_ok",{},"ok")});return}er.showModal({transcribe:!0})},[]);(0,a.useCallback)(()=>{eD(!1)},[]);let t_=(0,a.useCallback)(()=>{let e=es.getSelectedSegments();ee.segment.cutSelectedSegments(),(0,E.JP)(eL,{action_type:E.Gt.RIGHTCLICK,function_name:E.BS.COPYCUT,...(0,g.KG)(e)})},[]),tv=(0,a.useCallback)(()=>{let e=es.getSelectedSegments(),t=es.transitionIds.map(e=>eB.dataSdk.draftView.getSegmentByTransitionId(e));try{(0,E.JP)(eL,{action_type:E.Gt.RIGHTCLICK,function_name:E.BS.DELETE,...(0,g.u8)({segments:e,transitionSegments:t})})}catch(e){(0,p.Y2)(E.JP,"click_function report error")}ee.segment.removeSelectedSegments()},[]),ty=(0,a.useCallback)(()=>{ee.keyframe.pasteKeyframe("click")},[]),tM=(0,a.useCallback)(()=>{let{currentSeekTime:e}=n[b.U_],t=es.getSelectedSegments();ee.segment.pasteSegment(e),(0,E.JP)(eL,{action_type:E.Gt.RIGHTCLICK,function_name:E.BS.PASTE,...(0,g.KG)(t)})},[]),tS=(0,a.useCallback)(()=>{let e=es.getSelectedSegments();eo.pause(),ee.segment.detachSegmentAudio({segmentId:em[0].id,onError:e=>ei.toast.normal(e)}),(0,E.JP)(eL,{action_type:E.Gt.RIGHTCLICK,function_name:e3?E.BS.DIVIDE_AUDIO:E.BS.UNDIVIDE_AUDIO,...(0,g.KG)(e)})},[e3,em]),tw=(0,a.useMemo)(()=>{let{mutableVideos:e=[]}=eM.segmentSelection;return!eT&&!e.length&&1===em.length&&em.every(e=>{var t;let i=eB.dataSdk.draftView.getSegmentById(e.id);return i&&(0,X.ov)(i)&&!((null==i?void 0:null===(t=i.material)||void 0===t?void 0:t.extraTypeOption)&F.BKu.IsCombinationVideo)&&(null==i?void 0:i.material.type)===F.cVg.MetaTypeVideo})},[eT,em]),tT=(0,a.useRef)(s);tT.current=s;let tb=(0,a.useCallback)((e,t)=>{if(!tT.current){if(e){var i,r;let{contextmenuMode:e=w.D.NORMAL,data:n={}}=null!=t?t:{};if(eh.isEditingTemplate&&e!==w.D.MUTABLE_AUDIO)return;if(ei.previewLine.setPreviewLineFrozen(!0),e===w.D.BEAT)eN.current=null!==(i=null==n?void 0:n.beat)&&void 0!==i?i:-1n;else if(e===w.D.MUTABLE_AUDIO){let{id:e}=n,t=ec.mutableAudioSegments;ej.current=null!==(r=t.find(t=>t.id===e))&&void 0!==r?r:null}else eN.current=-1n;eE(e)}!e&&ei.previewLine.setPreviewLineFrozen(!1),eR(e)}},[]),tk=()=>{if(0===em.length)return;let{id:e}=em[0];ee.beat.removeAllBeats(e)},{startSmartSplit:tx,cancelSmartSplit:tI}=(0,A.O)({segment:eO?eB.dataSdk.draftView.getSegmentById(em[0].id):void 0,setModalVisible:eX,setModalProgress:eJ,setModalType:e0}),tR=(0,a.useCallback)(()=>{tI()},[tI]),tC=(0,a.useCallback)(()=>{tx("rightclick")},[tx]);(0,a.useEffect)(()=>(et.on(k.B.contextmenuVisible,tb),()=>{et.off(k.B.contextmenuVisible,tb)}),[]),(0,a.useEffect)(()=>(G.setForceRender(T.Y.TIMELINE_CONTEXTMENU,eA),()=>{G.setForceRender(T.Y.TIMELINE_CONTEXTMENU,null)}),[]);let tD=(0,r.jsxs)(c.Z,{className:H.Z.segmentMenu,children:[(0,r.jsx)(c.Z.Item,{onClick:()=>{if(0===em.length)return;let{id:e}=em[0];eN.current>-1&&ee.beat.removeBeat(e,[eN.current],em[0],{from:"right_click_menu"})},className:H.Z.lvDropdownMenuItem,children:V.oc.t("web_musicbeat_text_move_beat",{},"Remove beat")},"remove"),(0,r.jsx)(c.Z.Item,{onClick:tk,className:H.Z.lvDropdownMenuItem,children:V.oc.t("web_musicbeat_text_move_all_beat",{},"Remove all beats")},"remove_all")]});ej.current;let tA=(0,r.jsxs)(c.Z,{className:H.Z.segmentMenu,children:[(0,r.jsx)(c.Z.Item,{onClick:()=>ee.keyframe.deleteSelectedKeyFrame(),className:H.Z.lvDropdownMenuItem,children:V.oc.t("web_keyframe_text_delet_keyframe_menu",{},"Delete keyframe")},"remove"),(0,r.jsx)(c.Z.Item,{onClick:()=>ee.keyframe.copyKeyFrame(),className:H.Z.lvDropdownMenuItem,children:V.oc.t("web_keyframe_text_copy_keyframe_menu",{},"Copy keyframe")},"copy")]}),tP=(0,r.jsxs)(c.Z,{className:H.Z.segmentMenu,children:[(0,r.jsx)(c.Z.Item,{onClick:()=>{if(!!ej.current)ed.uiEvents.emit(W.W.MUTABLE_AUDIO_ENTER_TRIM,ej.current.id),ej.current=null},className:H.Z.lvDropdownMenuItem,children:V.oc.t("web_trim",{},"Trim")},"trim"),(0,r.jsx)(c.Z.Item,{onClick:()=>{ee.mutable.resetSegmentMutable(K.kO.CLICK)},className:H.Z.lvDropdownMenuItem,children:(0,r.jsxs)(r.Fragment,{children:[V.oc.t("delete_web",{},"\u5220\u9664"),(0,r.jsx)("span",{className:"dropdown-menu-shortcut",children:en.getShortcutVisual(_.Fu.DELETE)})]})},"remove")]}),tE=(0,D.u)(eL,"clip"),tN=e=>{var t;let i=Array.from(null!==(t=e.target.files)&&void 0!==t?t:[]),r=em[0];(0,v.IM)(r)&&(0,z.q)(i,r,eg,el,ee,eo,er,ei,eu)},tj=(0,a.useCallback)(()=>es.getSelectedSegments()[0],[es]),tO=(0,Q.o)(eL),tL=(0,a.useCallback)(e=>(!!(e.targetTimerange.duration<5000000n)||!!(e.targetTimerange.duration>$))&&(u.Z.warning(V.oc.t("web_isolate_duration_range",{},"You can only isolate the voice in clips from 5 seconds to 15 minutes long")),!0),[]),{check:tB}=(0,J.x)();switch(eP){case"mutableAudio":i=tP;break;case"beat":i=tD;break;case"keyframe":i=tA;break;default:i=(()=>{var e,t,i,n,a,s,o,l,d,u;if(!eI)return(0,r.jsx)(f.x,{config:[]});let c={type:"menu",icon:Z.F8Q,title:V.oc.t("split_web",{},"\u5206\u5272"),isShow:eZ&&!e2,disabled:eF||!tl,shortcut:(0,y.Y)("split"),onClick:()=>{var e;if(tE("split",tj()),!e5.current||!e8.current)return;et.context.mouse.calculate({x:e5.current.clientX,y:e5.current.clientY});let t=(0,R.TF)(eb.value,null===(e=et.context.mouse.relative)||void 0===e?void 0:e.x);ee.segment.splitSegment(e8.current,t);let i=ee.getSegmentById(e8.current);(0,E.JP)(eL,{action_type:E.Gt.RIGHTCLICK,function_name:E.BS.CUT,...(0,g.p8)(i)})}},h=[{type:"menu",icon:Z.jSR,title:V.oc.t("copy_web",{},"\u590D\u5236"),isShow:!e2&&eO,disabled:eF,shortcut:(0,y.Y)("copy"),onClick:()=>{tE("copy",tj()),tg()}},{type:"menu",icon:Z.jyF,title:V.oc.t("cut_web",{},"\u526A\u5207"),isShow:!e2&&eO,disabled:eF,shortcut:(0,y.Y)("cut"),onClick:()=>{tE("cut",tj()),t_()}},{type:"menu",icon:Z._XJ,title:V.oc.t("past_web_e",{},"\u7C98\u8D34"),isShow:eO&&!e2||!eO,disabled:!eM.segOperationManager.canPaste||eF,shortcut:(0,y.Y)("paste"),onClick:()=>{let e=tj();e?tE("paste",e):tE("paste",void 0,"timeline"),tM()}},{type:"menu",icon:Z.Doy,title:V.oc.t("web_overlay_button_duplicate",{},"Duplicate"),isShow:!e2&&eO&&!e4,disabled:eF,shortcut:(0,y.Y)("duplicate"),onClick:()=>{tE("duplicate",tj()),tm()}},{type:"menu",icon:Z.WKD,title:V.oc.t("web_keyframe_text_paste_keyframe_menu",{},"Paste keyframe"),isShow:!e2&&eO&&ee.keyframe.canPasteKeyframe(),onClick:()=>{tE("paste_keyframe",tj()),ty()}},{type:"menu",icon:Z.MOT,title:V.oc.t("web_musicbeat_text_move_all_beat",{},"Remove all beats"),isShow:e9(),onClick:()=>{tE("remove_all_beats",tj()),tk()}},{type:"menu",icon:Z.fjI,title:V.oc.t("web_delete",{},"\u5220\u9664"),isShow:eO,shortcut:(0,y.Y)("backspace"),onClick:()=>{tE("delete",tj()),tv()},needDivider:!0}],m=[{type:"menu",icon:Z.S31,title:V.oc.t("web_overlay_button_replace",{},"Replace"),isShow:eZ&&eG&&!eU,onClick:()=>{tE("replace_media",tj())},onFileChange:e=>{tN(e)},isFileUploader:!0,needDivider:!0}];to&&(ey?m.push({type:"menu",icon:Z.o1Y,isShow:!0,title:V.oc.t("web_export_text_download_clips",{},"Download section"),disabled:!0,tooltip:ey}):m.push({type:"subMenu",icon:Z.o1Y,isShow:!0,title:V.oc.t("web_export_text_download_clips",{},"Download section"),subMenuItems:[{type:"menu",isShow:!0,onClick:()=>{tE("partial_export",tj()),th()},title:V.oc.t("web_export_text_download_selected",{},"Download selected clips"),shortcut:(0,r.jsx)("div",{className:"segment-menu-item__extra",children:`(${ts})`}),className:"menu-subtitle"},{disabled:!!ev,type:"menu",isShow:!0,title:ev?`${V.oc.t("web_export_text_download_all_selected",{},"Download all content of selected clips")} (${ts})`:V.oc.t("web_export_text_download_all_selected",{},"Download all content of selected clips"),onClick:()=>{tE("partial_export",tj()),th(!0)},tooltip:ev,className:"menu-subtitle",shortcut:ev?void 0:(0,r.jsx)("div",{className:"segment-menu-item__extra",children:`(${ts})`})}]}));let p=[c,...h,...m,{type:"menu",icon:Z.Ib$,title:V.oc.t(null!=tn?tn:"web_text_edit_button_edit_in_line",{},"Transcript-based editing"),isShow:ta,onClick:()=>{tE("transcript_edit",tj()),tf()}},{type:"menu",icon:Z.z6Q,title:e3?V.oc.t("separate_audio",{},"\u5206\u79BB\u97F3\u9891"):V.oc.t("restore_audio",{},"\u8FD8\u539F\u97F3\u9891"),isShow:e6&&!ez,disabled:eK,shortcut:(0,y.Y)("detach-audio"),onClick:()=>{tE("separate_audio",tj()),tS()}},{type:"subMenu",icon:Z.Fq6,isShow:tO.getIsShow(null===(e=tj())||void 0===e?void 0:e.id),title:V.oc.t("web_isolate_timeline_feature_name",{},"Isolate voice"),subMenuItems:[{type:"menu",isShow:tO.getIsShow(null===(t=tj())||void 0===t?void 0:t.id),disabled:tO.getDisabled(null===(i=tj())||void 0===i?void 0:i.id),icon:Z.uiD,onClick:()=>{tO.toggleVocalSeparationType(tj(),F.ZTd.None)},isSelected:tO.getApplyingMode(null===(n=tj())||void 0===n?void 0:n.id)===F.ZTd.None,title:V.oc.t("web_isolate_timeline_none",{},"None"),className:"menu-subtitle"},{type:"menu",isShow:tO.getIsShow(null===(a=tj())||void 0===a?void 0:a.id),disabled:tO.getDisabled(null===(s=tj())||void 0===s?void 0:s.id),icon:Z.VHX,onClick:async()=>{if(!tL(tj())){if(!!await tB())tO.toggleVocalSeparationType(tj(),F.ZTd.Vocal)}},isSelected:tO.getApplyingMode(null===(o=tj())||void 0===o?void 0:o.id)===F.ZTd.Vocal,title:V.oc.t("web_isolate_timeline_keep_voice",{},"Keep voice"),className:"menu-subtitle"},{type:"menu",isShow:tO.getIsShow(null===(l=tj())||void 0===l?void 0:l.id),disabled:tO.getDisabled(null===(d=tj())||void 0===d?void 0:d.id),icon:Z.n9g,onClick:async()=>{if(!tL(tj())){if(!!await tB())tO.toggleVocalSeparationType(tj(),F.ZTd.Background)}},isSelected:tO.getApplyingMode(null===(u=tj())||void 0===u?void 0:u.id)===F.ZTd.Background,title:V.oc.t("web_isolate_timeline_remove_voice",{},"Remove voice"),className:"menu-subtitle"}]},{type:"menu",icon:Z.l0o,title:V.oc.t("web_track_button_auto_split",{},"Auto split scene"),isShow:tw&&!eU,onClick:()=>{tE("auto_split_scene",tj()),tC()}},{type:"menu",icon:Z.Pr4,title:V.oc.t("apply_all",{},"\u5E94\u7528\u5168\u90E8"),isShow:eZ&&e2,onClick:()=>{tE("transition_apply_to_all",tj());let e=eB.dataSdk.draftView.getSegmentByTransitionId(em[0].id);e&&eB.dataSdk.api.video.formatVideo({segId:e.id,transition:!0})},needDivider:!0},{type:"menu",icon:Z.Sc4,title:V.oc.t("web_edit_button_freeze",{},"Freeze"),isShow:te,disabled:tt,onClick:tp}];return(0,r.jsx)(f.x,{config:p})})()}return(0,r.jsx)("div",{id:"keydown-handler-cover",onKeyDown:e1,tabIndex:-1,children:(0,r.jsxs)(h.Z,{popupVisible:!s&&eI,onVisibleChange:tb,disabled:s,trigger:"contextMenu",droplist:i,onContextMenu:e=>{var t;e8.current=null===(t=et.context.store.hoverSeg)||void 0===t?void 0:t.id,e5.current=e,tc(e)},children:[(0,r.jsx)("span",{children:o}),eq?(0,r.jsx)(Y.Xf,{children:(0,r.jsx)(P.L,{progress:eQ,visible:eq,cancelIntelligent:tR,type:e$})}):null]})})}));var et=i("105789"),ei=i.n(et),er=i("514536"),en=i("260963"),ea=i("195291"),es=i("171495"),eo=i("577068"),el=i("75546"),ed=i("358098");let eu="timeline",ec=(0,a.forwardRef)(e=>{let{store:t,hidden:i,modules:d,elementRef:u,scrollWrapRef:c}=e,{timelineStore:h,timelineInteractStore:g}=t,{event:p,coordinate:f}=d,{isTemplate:_,loading:v,zoomStore:y}=h,{disableSequenceInteract:M,disableInteract:S,headerHidden:w,disableTimelineHeader:T}=g,b=(0,a.useRef)(),[k,x]=(0,a.useState)(h.operationWidth),I=(0,m.G)(j.a),C=(0,m.G)(L.n),D=(0,m.G)(U.t),{withCoverWidth:A}=(0,el.Oj)(h);!function(e,t,i,r,n){let s=(0,a.useCallback)(()=>{e.current&&(r((0,R.TF)(t.value,Math.max(e.current.scrollLeft-i,0))),n(e.current.scrollLeft>i?0:i-e.current.scrollLeft))},[null==e?void 0:e.current,t,r,n,i]),o=(0,a.useCallback)(()=>e.current,[null==e?void 0:e.current]),l=(0,a.useMemo)(()=>({target:o}),[o]);(0,er.default)("scroll",s,l),(0,a.useEffect)(()=>{if(!e.current)return;let a=t=>{e.current&&(r((0,R.TF)(t,Math.max(e.current.scrollLeft-i,0))),n(e.current.scrollLeft>i?0:i-e.current.scrollLeft))},s=(0,en.U5)(()=>t.value,e=>{a(e)},{fireImmediately:!0});return()=>{s()}},[r,t,i])}(c,y,h.operationWidth,e=>{h.setViewportStart(e)},x);let P=(0,a.useMemo)(()=>(0,r.jsx)(o.ZP,{hidden:i,operationWidth:k,scrollWrapRef:c}),[i,k]);(0,a.useEffect)(()=>{var e;return f.context.cursor.setContainer(null!==(e=b.current)&&void 0!==e?e:null),()=>{f.context.cursor.setContainer(null)}},[]);let{mainTrackY:E,mainTrackTop:N}=(0,es.$)(p),O=()=>{var e,t,i;(0,K.SH)(D,{action_type:K.kO.CLICK,option_type:K.Ds.INTEGRATE,action_position:K.X3.TIMELINE_BLANK,clip_type:K.U4.TRACK,position_type:K.o7.TIMELINE,clip_duration:Math.ceil(F.pMA.div(null!==(i=null===(e=C.dataSdk.draftView.getSegmentById(null!==(t=I.segmentSelection.subDraftSegmentId)&&void 0!==t?t:""))||void 0===e?void 0:e.targetTimerange.duration)&&void 0!==i?i:0,1e6))})},B=(0,a.useCallback)(e=>{let t=e.target;if(t.id===n.OR||t.id===el.PC||t.id===n.lk||t.id===o.px)I.segmentSelection.setExpandedSegmentId(null),O(),e.stopPropagation();else if(t.id===ed.gR||t.id===ed.DG){var i;let r=document.querySelector(`#${o.px}`),n=document.querySelector(`#${o.yd}`),a=r?Number(getComputedStyle(r).left.slice(0,-2))-(null!==(i=null==n?void 0:n.scrollLeft)&&void 0!==i?i:0):0;e.clientX<t.getBoundingClientRect().x+A+a&&(I.segmentSelection.setExpandedSegmentId(null),O(),e.stopPropagation())}},[]);return(0,r.jsxs)("div",{id:eu,tabIndex:-1,ref:e=>{u.current=e,b.current=e},className:ei()("timeline",eo.Z.timeline,eo.Z["message-theme__white"],{[eo.Z.template]:_,[eo.Z["timeline--hidden"]]:i,[eo.Z["timeline--uninteractive"]]:S,"timeline-header-hide":w}),style:{"--main-track-top":`${E}px`},onClick:B,children:[!_&&(0,r.jsx)(n.ZP,{operationWidth:k,mainTrackTop:N,hidden:w,disableTimelineHeader:T}),(0,r.jsx)(ee,{disabled:M,children:P}),!i&&v&&(0,r.jsx)(l.Z,{}),(0,ea.createPortal)((0,r.jsx)(s.Z,{}),document.body)]})}),eh=(0,G.f3)("store","modules")((0,G.Pi)(ec))},358098:function(e,t,i){i.d(t,{DG:function(){return v},ZP:function(){return S},gR:function(){return y}});var r=i(772322),n=i(953032),a=i(218571),s=i(105789),o=i.n(s),l=i(831998),d=i(670933),u=i(594299),c=i(441051),h=i(907031),g=i(969242),m=i(804497),p=i(690674),f=i(29188),_=i(17018);let v="zoom-axis-canvas-container",y="zoom-axis-canvas",M={5:{step:1e3/f.zD,group:2},25:{step:1e3/f.zD,group:3},31.25:{step:1e3/f.zD,group:5},40:{step:1e3/f.zD,group:10},50:{step:100,group:5}},S=(0,d.f3)("store")((0,d.Pi)(e=>{let{store:t,scrollRef:i}=e,{viewportStart:s,zoomStore:d,isTemplatePost:f,tracks:S,operationWidth:w,isTemplate:T,loading:b}=t[p.U_],{expandedSegmentId:k}=t[p.qk],x=(0,a.useRef)(null),[I]=(0,l.F)(),R="dark"===I,C=(0,a.useRef)(s),D=(0,a.useRef)(w),A=(0,a.useMemo)(()=>!T&&b,[T,b]),P=(0,a.useMemo)(()=>({axisMajor:R?h.pi:h.ay,axisMinor:R?h.mP:h.Tv,text:R?h.Mf:h.wu}),[R]),E=(0,a.useCallback)(()=>{if(!A)!function(e){let{$canvas:t,retinaMultiple:i,zoom:r,start:n,offsetLeft:a,colorMap:s}=e;if(!t)return;let o=t.getContext("2d");if(!o)return;let{width:l,height:d}=t;o.clearRect(0,0,l,d),o.font=`${h.xN*i}px ${h.cw}`,o.lineWidth=1;let c=function(e){let t=h.ku["0"];for(let i of h.ku)i<=e&&(t=i);return t}(r),m={$context:o,retinaMultiple:i,width:l,gear:c,zoom:r,start:(0,_.d)(n,1e3).toDouble(),drawOffset:a,colorMap:s};c>=1e3?!function(e){let{$context:t,retinaMultiple:i,width:r,gear:n,zoom:a,start:s,drawOffset:o,colorMap:l}=e,d=Math.ceil(s/n)*n,c=((0,g.KU)(a,d-s)+o)*i,h=Math.ceil(s%(10*n)/n);for(;c<r;)10===h||0===h?((0,u.De)(t,i,c,l.axisMajor,l.text),(0,u.ty)(t,i,c,d),h=1):((0,u.k)(t,i,c,l.axisMinor),++h),c+=(0,g.KU)(a,n*i),d+=n}(m):!function(e){var t;let{$context:i,retinaMultiple:r,width:n,gear:a,zoom:s,start:o,drawOffset:l,colorMap:d}=e,{step:c,group:h}=null!==(t=M[a])&&void 0!==t?t:{step:a,group:10},m=Math.ceil(o/c)*c,p=((0,g.KU)(s,m-o)+l)*r,f=Math.ceil(o%(c*h)/c);for(;p<n;)f===h||0===f?((0,u.De)(i,r,p,d.axisMajor,d.text),(0,u.ty)(i,r,p,m),f=1):((0,u.k)(i,r,p,d.axisMinor),++f),p+=(0,g.KU)(s,c*r),m+=c}(m),o.closePath()}({$canvas:x.current,retinaMultiple:h.Ue,zoom:d.value,start:C.current,offsetLeft:D.current,colorMap:P})},[A,d.value,P]),[N,j]=(0,a.useState)(),O=(0,a.useCallback)(()=>{if(!k){j(void 0);return}let e=(0,m.kt)(S,{id:k});if(!e){j(void 0);return}let t=C.current,i=D.current,r=(0,g.vY)(d.value,e.start-t)+i,n=(0,g.vY)(d.value,e.duration);j({left:`${r}px`,width:`${n}px`})},[k,d.value]),{run:L}=(0,n.default)(()=>{if(i.current){let{scrollLeft:e}=i.current;C.current=(0,g.TF)(d.value,Math.max(e-w,0)),D.current=e>w?0:w-e,E(),O()}},10);return(0,a.useEffect)(()=>{var e;let t=new ResizeObserver(e=>{e.length&&x.current&&(x.current.width=e[0].contentRect.width*h.Ue,x.current.height=e[0].contentRect.height*h.Ue,E(),O())});if(x.current){let{width:e,height:i}=x.current.getBoundingClientRect();x.current.width=e*h.Ue,x.current.height=i*h.Ue,t.observe(x.current)}return null===(e=i.current)||void 0===e||e.addEventListener("scroll",L,{passive:!0}),()=>{var e;t.disconnect(),null===(e=i.current)||void 0===e||e.removeEventListener("scroll",L)}},[E,L,O]),(0,a.useEffect)(()=>{L()},[x,w,d.value]),(0,r.jsxs)("div",{className:o()(c.Z.axisContainer,{[c.Z.solidBg]:f}),id:v,children:[k&&(0,r.jsx)("div",{className:c.Z.axisSubSequenceMask,style:N}),(0,r.jsx)("canvas",{id:y,className:c.Z.zoomAxis,ref:x,onContextMenu:e=>e.preventDefault()})]})}))},626910:function(e,t,i){i.d(t,{A9:function(){return T},Ee:function(){return y},Pl:function(){return M},_u:function(){return S},pB:function(){return w}});var r=i(544633),n=i(218571),a=i(797637),s=i.n(a),o=i(632555),l=i(586703),d=i(260963),u=i(690674),c=i(371140),h=i(464533),g=i(892230),m=i(804497),p=i(969242),f=i(755945),_=i(722169),v=i(314350);function y(e,t,i,a,o,d,u,c,f,y,M){let S=arguments.length>11&&void 0!==arguments[11]&&arguments[11],w=arguments.length>12&&void 0!==arguments[12]&&arguments[12],[T,b]=s()(null),k=(0,r.default)((0,_.throttle)(()=>{var t,r,n;let s=document.querySelector(".timeline-bd"),_=document.querySelector(".timeline-container"),v=document.querySelector(".timeline-bd-vertical-scroll"),S=document.querySelector(".timeline-large-container"),w=Math.min((null==a?void 0:null===(r=a.mutable)||void 0===r?void 0:null===(t=r.children)||void 0===t?void 0:t.length)*(h.sD+h.Rd)+h.ON,parseInt(String((null==y?void 0:y.maxWidth)||`${h.Kv}`),10)),T=null===(n=e.current)||void 0===n?void 0:n.getBoundingClientRect();if(!s||!_||!v||!S||!a||!w||!T)return;let{top:b,bottom:k}=v.getBoundingClientRect(),x=S.getBoundingClientRect(),{x:I,width:R}=(0,m.AH)(a,o,i,!0),C=M?(0,p.vY)(i,M.start):0,D=I+x.left+C,A=D+R,{top:P}=T,{left:E,right:N}=s.getBoundingClientRect(),{left:j,right:O}=_.getBoundingClientRect();u((0,l.dl)(D,A,E,N)||(0,l.d9)(P,b,k));let L=(Math.min(O,A)+Math.max(D,j))/2,B=(0,g.E0)(L-w/2,[j+h.kd,O-w-h.kd]),F=(0,g.E0)(L-B,[h.dt,w-h.dt]);d(B),c(F),f()},v.CZ,{trailing:!0}));return(0,n.useEffect)(()=>{let e;let t=null,i=null,r=null,n=null,a=()=>{n=new AbortController,t=document.querySelector(".timeline-bd"),i=document.querySelector(".timeline-bd-vertical-scroll"),r=document.querySelector(".timeline-large-container"),t&&i&&r?(t.addEventListener("scroll",()=>{k()},{signal:n.signal}),i.addEventListener("scroll",()=>{k()},{signal:n.signal}),(e=new ResizeObserver(()=>{k()})).observe(r)):setTimeout(a,500)};return a(),k(),()=>{null==n||n.abort(),null==e||e.disconnect()}},[T,k,f]),(0,n.useEffect)(()=>{k()},[i,a,o,S,w]),[e=>{e&&b(e),t(e)}]}function M(e){let t=(0,n.useRef)(),[i,r]=(0,n.useState)(!1),a=(0,n.useCallback)((i,n)=>{clearTimeout(t.current),i?t.current=setTimeout(()=>{r(!0),null==n||n(),t.current=void 0},null!=e?e:200):(r(!1),null==n||n())},[]);return(0,n.useEffect)(()=>()=>{clearTimeout(t.current)},[]),[i,a]}function S(e,t,i){let{coordinate:a,batchReplace:s}=i,{onScroll:l,onScrollEnd:d,edgeSize:u=50,baseScrollSpeed:c=50,direction:h="horizontal"}=t,g="vertical"===h,m=(0,n.useRef)(null),p=(0,n.useRef)(null),f=(0,n.useRef)(null),_=(0,n.useRef)(0),v=(0,n.useRef)(0),y=(0,n.useRef)(0),M=(e,t)=>-(Math.cos(Math.PI*(1-Math.abs(e-t)/(2*u)))-1)/2;return(0,r.default)(t=>{if(t){m.current=new AbortController;let e=i=>{i-y.current>16&&(t.scrollBy(_.current,v.current),y.current=i),p.current=requestAnimationFrame(e)},i=(t,i)=>{!p.current&&(p.current=requestAnimationFrame(e));let r=g?v:_;switch(t){case"forward":r.current=i;break;case"backward":r.current=-i}},r=()=>{if(!!p.current)cancelAnimationFrame(p.current),_.current=0,v.current=0,p.current=null};window.addEventListener("mousemove",e=>{if("dragging"!==a.context.store.dragState){r();return}let{clientX:n}=e,{clientY:s}=e,{top:l,bottom:d,right:h,left:m}=t.getBoundingClientRect();if(!(g?(0,o.mK)(n,[m,h]):(0,o.mK)(s,[l,d]))){r();return}let{clienPos:p,forwardEdge:f,backwardEdge:_,forwardArea:v,backwardArea:y}=g?{clienPos:s,forwardEdge:d,backwardEdge:l,forwardArea:[d-u,d+u],backwardArea:[l-u,l+u]}:{clienPos:n,forwardEdge:h,backwardEdge:m,forwardArea:[h-u,h+u],backwardArea:[m-u,m+u]};if((0,o.mK)(p,v)){if(p>f)return;i("forward",c*M(p,f+u));return}if((0,o.mK)(p,y)){if(p<_)return;i("backward",c*M(p,_-u));return}r()},{signal:m.current.signal}),t.addEventListener("scroll",()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>null==d?void 0:d(),150),null==l||l()},{signal:m.current.signal})}else{var i;null===(i=m.current)||void 0===i||i.abort()}e(t)})}function w(e,t){let i=(0,n.useRef)(null),r=e=>{if(!i.current)return null;let t=i.current.querySelector(`div[data-mutableid="${e}"]`);return t?{mutableClientRect:t.getBoundingClientRect(),containerClientRect:i.current.getBoundingClientRect()}:null};return{ref:t=>{i.current=t,e(t)},scrollToMutableIfNotVisible:e=>{var n;let a=r(e);if(!a||(0,l.mM)(a.mutableClientRect,a.containerClientRect))return;let{mutableClientRect:{left:s,width:o},containerClientRect:d}=a,{left:u,width:c}=d;if(!("dragging"===t.context.store.dragState&&(0,l.Qg)(d,t.context.mouse.fixed)))null==i||null===(n=i.current)||void 0===n||n.scrollBy({left:s-u-c/2+o/2,behavior:"smooth"})},isMutableHoverable:e=>{let i=r(e);if(!i||!t.context.mouse.fixed)return!1;let{x:n,y:a}=t.context.mouse.fixed,{left:s,right:d,bottom:u,top:c}=i.containerClientRect;return!!((0,o.mK)(n,[s,d])&&(0,o.mK)(a,[c,u]))&&(0,l.cO)(i.mutableClientRect,i.containerClientRect)}}}function T(e,t,i){let{autoReplaceDisplay:r}=e[u.U_];return(0,d.Fl)(()=>!!e[u.qk].segmentSelected.find(e=>e.id===t.id)).get()&&(i===f.j.PolyChild&&r===c.AR.child||i===f.j.FlattedChild&&r===c.AR.flat)}},235204:function(e,t,i){i.d(t,{L:function(){return n}});var r=i(218571);function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,[i,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{var i,r;let a;let s=()=>{a=setTimeout(()=>{n(!0)},t)},o=()=>{n(!1),clearTimeout(a)};return null==e||null===(i=e.current)||void 0===i||i.addEventListener("mouseenter",s),null==e||null===(r=e.current)||void 0===r||r.addEventListener("mouseleave",o),()=>{var t,i;null==e||null===(t=e.current)||void 0===t||t.removeEventListener("mouseenter",s),null==e||null===(i=e.current)||void 0===i||i.removeEventListener("mouseleave",o)}},[null==e?void 0:e.current]),i}},461834:function(e,t,i){i.d(t,{J:function(){return a}});var r=i(989719),n=i(218571);function a(){let e=(0,n.useRef)(null),[t,i]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let t=e.current;if(!t)return r.Z;let n=()=>i(t.scrollTop>0);return t.addEventListener("scroll",n),()=>t.removeEventListener("scroll",n)},[e.current]),{scrollerRef:e,isScrolled:t}}},491424:function(e,t,i){i.d(t,{X:function(){return a}});var r=i(670933),n=i(218571);let a=(e,t)=>{let{modules:i}=(0,n.useContext)(r.yX);(0,n.useEffect)(()=>{let{keybinding:r}=i;return r.register(e,t)},[e,t,i])}},502514:function(e,t,i){i.d(t,{h:function(){return u}});var r=i(953032),n=i(218571),a=i(676693),s=i(445080),o=i(260963),l=i(690674);let d=parseFloat(a.Z["size-height-min-editor-tl"]);function u(e,t){let{timelineStore:i}=t,{loading:a=!1,isTemplate:u=!1,isBatchReplacePanelVisible:c=!1}=i,h=(0,n.useRef)(null),g=(0,n.useRef)(null),m=(0,n.useRef)(),p=(0,n.useRef)(183),[f,_]=(0,n.useState)(0),[v,y]=(0,n.useState)(!1),M=(0,n.useCallback)(function(){var t,i,r,n,s,o,l,f,_,v;let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!a&&(!m.current&&(m.current=null===(i=h.current)||void 0===i?void 0:i.scrollHeight),183===p.current&&(null===(t=g.current)||void 0===t?void 0:t.scrollHeight)&&(p.current=null===(r=g.current)||void 0===r?void 0:r.scrollHeight)),!u&&!c){e.setMinHeight(d+50),e.setMaxHeight(.5*window.innerHeight),y&&e.setHeight((null!==(o=null!==(s=m.current)&&void 0!==s?s:null===(n=h.current)||void 0===n?void 0:n.scrollHeight)&&void 0!==o?o:0)+50);return}if(c){if(a){y&&e.setHeight(233);return}e.setMaxHeight(Math.min((null!==(l=p.current)&&void 0!==l?l:0)+50,.5*window.innerHeight)),e.setMinHeight(200),y&&e.setHeight((null!==(f=p.current)&&void 0!==f?f:0)+50);return}void 0!==m.current&&(e.setMaxHeight(Math.max(d+50,Math.min((null!==(_=m.current)&&void 0!==_?_:0)+50,.6*window.innerHeight))),e.setMinHeight(d+50),y&&e.setHeight((null!==(v=m.current)&&void 0!==v?v:0)+50))},[e,u,c,a]);(0,n.useEffect)(()=>{v&&M(!0)},[M,f,v]);let{run:S}=(0,r.default)(()=>M(!1),16);return(0,s.y)(g,()=>{var e,t,i;(null===(e=g.current)||void 0===e?void 0:e.scrollHeight)!==p.current&&(null===(t=g.current)||void 0===t?void 0:t.scrollHeight)&&(p.current=null===(i=g.current)||void 0===i?void 0:i.scrollHeight,S())}),(0,n.useEffect)(()=>(window.addEventListener("resize",S),!c&&(p.current=183),()=>window.removeEventListener("resize",S)),[S,c]),(0,n.useEffect)(()=>(0,o.U5)(()=>i.mutableVideos,e=>{t[l.qk].isEditingTemplate&&_(e.length)}),[]),(0,n.useEffect)(()=>{let t=e.onLayoutUpdate(()=>{y(!0)});return()=>{t.dispose()}},[]),{timelinePanelRef:h,batchReplacePanelRef:g,updateHeight:M}}},741720:function(e,t,i){i.d(t,{$M:function(){return o},W8:function(){return a},Z0:function(){return s}});var r=i(260963),n=i(218571);function a(e,t){return`max(calc((100% - ${e}px) / 2), ${t}px)`}function s(e){"0px"!==e.style.top&&e.style.setProperty("top","0px")}function o(e){let{timelineStore:t,domRef:i,additionHeight:o=0}=e,l=(0,n.useRef)(!1);(0,n.useEffect)(()=>(0,r.EH)(()=>{let{resizeInfo:{isResizing:e,worldHeight:r,contentHeight:n}}=t;if(l.current=e,i.current){if(e){let e=a(r+o,(n-r)/2);i.current.style.setProperty("top",e)}else setTimeout(()=>{s(i.current)})}}),[o]),(0,n.useLayoutEffect)(()=>{!l.current&&i.current&&s(i.current)},[])}},492662:function(e,t,i){i.d(t,{o:function(){return r}});function r(e,t){let i=document.createElement("canvas");return i.width=e,i.height=t,i}},125682:function(e,t,i){i.d(t,{V:function(){return n}});var r=i(680145);function n(e){switch(e){case"legacy-vip":return r.b.IconProLegacy;case"pro-unavailable":default:return r.b.IconProUnavailable;case"pro-available":return r.b.IconProAvailable}}},519637:function(e,t,i){i.d(t,{e:function(){return a},u:function(){return n}});var r=i(907031);function n(e){return r.JQ+Math.pow(r.YK,e/r.GB)}function a(e){return Math.floor(Math.log2(e-r.JQ)*r.GB)}},495755:function(e,t,i){i.d(t,{M:()=>l}),i("966156");var r=i("368100"),n=i("801497"),a=i("772322");i("353772");var s=i("199000");let o="never_remind_auto_un_hide";class l{autoUnHideMutableVideo(e){var t,i;let{draftIdToMutableVideos:r}=this._dataSdk.cutSame,n=null===(t=this._selection.subDraftContext)||void 0===t?void 0:t.subDraftId,a=(null!==(i=r[null!=n?n:this._dataSdk.draftView.getDraftId()])&&void 0!==i?i:[]).find(t=>t.id===e);return a?this._askAutoUnHide(a):Promise.resolve(!1)}_askAutoUnHide(e){if(null==e?void 0:e.visible)return Promise.resolve(!0);let t="true"===localStorage.getItem(o);return t?Promise.resolve(!0):new Promise(e=>{var i,l;r.Z.confirm({className:"replace-confirm-tips-modal",title:n.ZP.t("web_material_text_unhide_fill",{},"Unhide the slot and fill it with the material?"),content:(i=!!t,l=e=>t=e,(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"replace-confirm-tips",children:`${n.ZP.t("web_material_text_hide_tip",{},"After clicking OK, the Clip will replace the new material and unhide it")}`}),(0,a.jsx)(s.Z,{defaultChecked:i,onChange:l,className:"replace-confirm-checkbox",children:`${n.ZP.t("web_material_text_no_notice",{},"Don't remind me again next time")}`}),(0,a.jsx)("div",{className:"placeholder"})]})),onOk:()=>{t&&localStorage.setItem(o,"true"),e(!0)},okText:n.ZP.t("web_material_button_confirm",{},"Show"),okButtonProps:{type:"primary"},onCancel:()=>{e(!1)},cancelText:n.ZP.t("web_material_button_cancel",{},"Cancel")})})}constructor(e,t){this._selection=e,this._dataSdk=t}}},356515:function(e,t,i){i.d(t,{e:function(){return l},f:function(){return o}}),i(784923);var r=i(498417),n=i(827322),a=i(374904),s=i(801497);function o(e,t){let i=e.map(e=>(0,a.J5)({file:e,accepts:["image","video"]})),n=[],o=[];for(let t=0;t<e.length;t++){let r=e[t];i[t]?n.push(r):o.push(r)}if(!n.length){let e=o.map(e=>e.name).join(",");if(t)null==t||t(e);else{let t=`${s.ZP.t("web_slots_can_only_be_filled_with_videos_or_images",{},"Only video and picture can be added to the slot")}: ${e}`;r.Z.error(t)}return[]}return n}function l(e){return new Promise((t,i)=>{let r=document.createElement("video");r.preload="metadata",r.onloadedmetadata=function(){window.URL.revokeObjectURL(r.src),t(1e3*r.duration),r=null},r.onerror=i,r.src=(0,n.C)(URL.createObjectURL(e),null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})})}},199908:function(e,t,i){i.d(t,{u:function(){return s}});var r=i(860660),n=i(807407),a=i(426336);function s(e,t){return(i,s,o)=>{let l=(0,r.p8)(s),d={};s&&(0,a.hey)(s)&&(d={material_type:s.material.type===a.cVg.MetaTypePhoto?"photo":"video",material_category:l.material_category}),(0,n.t)(e,{action:i,...d,position:null!=o?o:t})}}}}]);