"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["5721"],{318235:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"rich-text-editor-container":"rich-text-editor-container-mG8yOl",richTextEditorContainer:"rich-text-editor-container-mG8yOl","input-proxy":"input-proxy-c5yRcj",inputProxy:"input-proxy-c5yRcj","rich-text-editor":"rich-text-editor-IIRFHW",richTextEditor:"rich-text-editor-IIRFHW",cursor:"cursor-_kci7y",blink:"blink-jDGPX8","cursor-visible":"cursor-visible-UVoOfT",cursorVisible:"cursor-visible-UVoOfT"}},362076:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"player-container":"player-container-NiyXa5",playerContainer:"player-container-NiyXa5","player-empty-placeholder":"player-empty-placeholder-mUc38t",playerEmptyPlaceholder:"player-empty-placeholder-mUc38t","player-empty-placeholder-icon":"player-empty-placeholder-icon-TNgn7k",playerEmptyPlaceholderIcon:"player-empty-placeholder-icon-TNgn7k","player-empty-placeholder-title":"player-empty-placeholder-title-olPJz2",playerEmptyPlaceholderTitle:"player-empty-placeholder-title-olPJz2"}},893958:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"player-time":"player-time-jUj9Gi",playerTime:"player-time-jUj9Gi",divider:"divider-YbE8Tp",disabled:"disabled-cIvsGt","player-time-text":"player-time-text-tEo9ku",playerTimeText:"player-time-text-tEo9ku"}},375853:function(e,t,i){i.d(t,{Z:function(){return r}});let r={player:"player-AqdLId","preview-title":"preview-title-JjoD7d",previewTitle:"preview-title-JjoD7d","is-empty-canvas":"is-empty-canvas-jC0thv",isEmptyCanvas:"is-empty-canvas-jC0thv","canvas-wrapper":"canvas-wrapper-DcJBhY",canvasWrapper:"canvas-wrapper-DcJBhY","canvas-cover":"canvas-cover-I_hUAo",canvasCover:"canvas-cover-I_hUAo","is-empty-canvas__original":"is-empty-canvas__original-rASJcv",isEmptyCanvasOriginal:"is-empty-canvas__original-rASJcv","canvas-space":"canvas-space-PZfpTy",canvasSpace:"canvas-space-PZfpTy","canvas-preview":"canvas-preview-DbEulg",canvasPreview:"canvas-preview-DbEulg","tiktok-preview-mask":"tiktok-preview-mask-Jk9d4z",tiktokPreviewMask:"tiktok-preview-mask-Jk9d4z","canvas-mask":"canvas-mask-iBLwLS",canvasMask:"canvas-mask-iBLwLS","canvas-cover-transiting":"canvas-cover-transiting-V7stQz",canvasCoverTransiting:"canvas-cover-transiting-V7stQz","segment-widget":"segment-widget-BLdJyH",segmentWidget:"segment-widget-BLdJyH","segment-sub-widget":"segment-sub-widget-eQ2Qd5",segmentSubWidget:"segment-sub-widget-eQ2Qd5",fullscreen:"fullscreen-Pqy5FV","drag-active":"drag-active-SqLxoB",dragActive:"drag-active-SqLxoB","footer-hidden":"footer-hidden-QLPelG",footerHidden:"footer-hidden-QLPelG",progress:"progress-bZIXn2",tools:"tools-YTEuDt",line:"line-JICvks",btn:"btn-VeBXRT",active:"active-gLnkVj",disabled:"disabled-KhCYqC",download:"download-EUh7eq","lv-message-content":"lv-message-content-XTd40U",lvMessageContent:"lv-message-content-XTd40U","buffer-fail-toast":"buffer-fail-toast-vcrucN",bufferFailToast:"buffer-fail-toast-vcrucN",action:"action-Qwi9PY","player-ratio-select":"player-ratio-select-LnJu1o",playerRatioSelect:"player-ratio-select-LnJu1o"}},883700:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"segment-widget-menu":"segment-widget-menu-zh43Aw",segmentWidgetMenu:"segment-widget-menu-zh43Aw","file-uploader":"file-uploader-QobnKI",fileUploader:"file-uploader-QobnKI","segment-widget-menu-loading":"segment-widget-menu-loading-kDVNi0",segmentWidgetMenuLoading:"segment-widget-menu-loading-kDVNi0",conicMask:"conicMask-wvP5fI",conic:"conic-uX9q4p","segment-widget-toolbar-button":"segment-widget-toolbar-button-_egRJ8",segmentWidgetToolbarButton:"segment-widget-toolbar-button-_egRJ8",disabled:"disabled-YHKq3v","widget-rotate-top-left":"widget-rotate-top-left-P3xZou",widgetRotateTopLeft:"widget-rotate-top-left-P3xZou","widget-rotate-top-right":"widget-rotate-top-right-Ywuo0l",widgetRotateTopRight:"widget-rotate-top-right-Ywuo0l","widget-rotate-bottom-left":"widget-rotate-bottom-left-HACuUp",widgetRotateBottomLeft:"widget-rotate-bottom-left-HACuUp","widget-rotate-bottom-right":"widget-rotate-bottom-right-DR_GKK",widgetRotateBottomRight:"widget-rotate-bottom-right-DR_GKK","widget-resize-nwse":"widget-resize-nwse-IoGv6J",widgetResizeNwse:"widget-resize-nwse-IoGv6J","widget-resize-ns":"widget-resize-ns-iqOO1q",widgetResizeNs:"widget-resize-ns-iqOO1q","widget-resize-nesw":"widget-resize-nesw-fBkNoa",widgetResizeNesw:"widget-resize-nesw-fBkNoa","widget-resize-ew":"widget-resize-ew-XfOyZ9",widgetResizeEw:"widget-resize-ew-XfOyZ9","segment-widget":"segment-widget-wSnCub",segmentWidget:"segment-widget-wSnCub","is-parent-active":"is-parent-active-souAoe",isParentActive:"is-parent-active-souAoe",active:"active-JFnFcx","is-rotating":"is-rotating-jjSofD",isRotating:"is-rotating-jjSofD",point:"point-wcPSCY","is-translating":"is-translating-rni7vG",isTranslating:"is-translating-rni7vG","is-box-selecting":"is-box-selecting-yG_msO",isBoxSelecting:"is-box-selecting-yG_msO","is-scaling":"is-scaling-l1kt97",isScaling:"is-scaling-l1kt97","point-rotate":"point-rotate-YeeNB1",pointRotate:"point-rotate-YeeNB1","is-min-size":"is-min-size-WPzVYB",isMinSize:"is-min-size-WPzVYB","point-top-left":"point-top-left-DvCbP0",pointTopLeft:"point-top-left-DvCbP0","is-text-mini-size":"is-text-mini-size-WslIc5",isTextMiniSize:"is-text-mini-size-WslIc5","point-right":"point-right-K1Jjoa",pointRight:"point-right-K1Jjoa","point-top-right":"point-top-right-beUPpZ",pointTopRight:"point-top-right-beUPpZ","point-left":"point-left-G04N_8",pointLeft:"point-left-G04N_8","point-bottom-left":"point-bottom-left-QqGUmN",pointBottomLeft:"point-bottom-left-QqGUmN","point-bottom-right":"point-bottom-right-a7HBqY",pointBottomRight:"point-bottom-right-a7HBqY","rotate-area":"rotate-area-lCo8Pf",rotateArea:"rotate-area-lCo8Pf","child-selected":"child-selected-EAyqCV",childSelected:"child-selected-EAyqCV","is-dragging-material":"is-dragging-material-naKVTN",isDraggingMaterial:"is-dragging-material-naKVTN","is-selected":"is-selected-i1hZlr",isSelected:"is-selected-i1hZlr","rotate-area-top-left":"rotate-area-top-left-Auh_kY",rotateAreaTopLeft:"rotate-area-top-left-Auh_kY","rotate-area-top-right":"rotate-area-top-right-Gqw58I",rotateAreaTopRight:"rotate-area-top-right-Gqw58I","rotate-area-bottom-left":"rotate-area-bottom-left-w3fNzh",rotateAreaBottomLeft:"rotate-area-bottom-left-w3fNzh","rotate-area-bottom-right":"rotate-area-bottom-right-a9tw__",rotateAreaBottomRight:"rotate-area-bottom-right-a9tw__","point-rotate-connector":"point-rotate-connector-A8KyFJ",pointRotateConnector:"point-rotate-connector-A8KyFJ","icon-rotate":"icon-rotate-NTgYRo",iconRotate:"icon-rotate-NTgYRo","point-rotate-normal":"point-rotate-normal-FQ91zz",pointRotateNormal:"point-rotate-normal-FQ91zz","point-rotate-symmetric":"point-rotate-symmetric-x3VuHI",pointRotateSymmetric:"point-rotate-symmetric-x3VuHI","keep-border":"keep-border-OMps8N",keepBorder:"keep-border-OMps8N","segment-sub-widget":"segment-sub-widget-LL4gPj",segmentSubWidget:"segment-sub-widget-LL4gPj",selected:"selected-Jhp3Ti","is-template":"is-template-il14y8",isTemplate:"is-template-il14y8","icon-droplist-wrapper":"icon-droplist-wrapper-rhEOTG",iconDroplistWrapper:"icon-droplist-wrapper-rhEOTG","top-toolbar-button":"top-toolbar-button-6UQbUe",topToolbarButton:"top-toolbar-button-6UQbUe",disable:"disable-Zoif2P","top-toolbar-file-uploader":"top-toolbar-file-uploader-v_2HKz",topToolbarFileUploader:"top-toolbar-file-uploader-v_2HKz","lv-btn":"lv-btn-BkwNxe",lvBtn:"lv-btn-BkwNxe","icon-dropdown-button-wrapper":"icon-dropdown-button-wrapper-XfnCkG",iconDropdownButtonWrapper:"icon-dropdown-button-wrapper-XfnCkG","with-arrow":"with-arrow-TmKPlx",withArrow:"with-arrow-TmKPlx","icon-dropdown-button-arrow":"icon-dropdown-button-arrow-cM1eab",iconDropdownButtonArrow:"icon-dropdown-button-arrow-cM1eab",divider:"divider-ZDxrSF","text-action":"text-action-aC6aNV",textAction:"text-action-aC6aNV","text-view":"text-view-vUHVu0",textView:"text-view-vUHVu0",rotate:"rotate-eil3Hp","not-allowed":"not-allowed-DO10Wi",notAllowed:"not-allowed-DO10Wi"}},740973:function(){},561098:function(){},323937:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"cut-same-tips-wrap":"cut-same-tips-wrap-l98YzR",cutSameTipsWrap:"cut-same-tips-wrap-l98YzR","cut-same-unuse-mask":"cut-same-unuse-mask-PYH0dN",cutSameUnuseMask:"cut-same-unuse-mask-PYH0dN"}},764305:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"segment-menu":"segment-menu-E_iNyk",segmentMenu:"segment-menu-E_iNyk","lv-dropdown-menu-item":"lv-dropdown-menu-item-yGRVE_",lvDropdownMenuItem:"lv-dropdown-menu-item-yGRVE_",shortcut:"shortcut-RTe802","segment-sub-menu":"segment-sub-menu-pHy1Bl",segmentSubMenu:"segment-sub-menu-pHy1Bl"}},182263:function(){},620107:function(){},217713:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"popup-confirm":"popup-confirm-PgT4x9",popupConfirm:"popup-confirm-PgT4x9","popup-confirm-fake-modal":"popup-confirm-fake-modal-Vgdxx0",popupConfirmFakeModal:"popup-confirm-fake-modal-Vgdxx0"}},450138:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"popup-confirm":"popup-confirm-zfwZLg",popupConfirm:"popup-confirm-zfwZLg","popup-confirm-fake-modal":"popup-confirm-fake-modal-NGIRq_",popupConfirmFakeModal:"popup-confirm-fake-modal-NGIRq_"}},185701:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"game-play-popup-confirm-locate":"game-play-popup-confirm-locate-yiubH5",gamePlayPopupConfirmLocate:"game-play-popup-confirm-locate-yiubH5"}},888792:function(e,t,i){i.d(t,{Z:function(){return r}});let r={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px",borderRadiusSeg:"8px","timeline-bd-container":"timeline-bd-container-QagXMe",timelineBdContainer:"timeline-bd-container-QagXMe",cutsame:"cutsame-x6AlrM","template-post":"template-post-ajaDjI",templatePost:"template-post-ajaDjI","timeline-scroll-wrap":"timeline-scroll-wrap-lOI99q",timelineScrollWrap:"timeline-scroll-wrap-lOI99q","overflow-hidden-x":"overflow-hidden-x-eDVmZP",overflowHiddenX:"overflow-hidden-x-eDVmZP","timeline-box":"timeline-box-_FpIf1",timelineBox:"timeline-box-_FpIf1","timeline-bd-vertical-scroll":"timeline-bd-vertical-scroll-RxqYbe",timelineBdVerticalScroll:"timeline-bd-vertical-scroll-RxqYbe","timeline-large-container":"timeline-large-container-Iouak8",timelineLargeContainer:"timeline-large-container-Iouak8","timeline-drop":"timeline-drop-SAb1m8",timelineDrop:"timeline-drop-SAb1m8","konvajs-content":"konvajs-content-wvWWlN",konvajsContent:"konvajs-content-wvWWlN","timeline-scroll-label":"timeline-scroll-label-tM676s",timelineScrollLabel:"timeline-scroll-label-tM676s"}},714615:function(){},577068:function(e,t,i){i.d(t,{Z:function(){return r}});let r={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px",borderRadiusSeg:"8px",timeline:"timeline-oLi8yh","timeline--hidden":"timeline--hidden-b_Uwlz",timelineHidden:"timeline--hidden-b_Uwlz","timeline-container":"timeline-container-dOmyF4",timelineContainer:"timeline-container-dOmyF4","timeline-rc-emitter":"timeline-rc-emitter-LslW3a",timelineRcEmitter:"timeline-rc-emitter-LslW3a","timeline-hd":"timeline-hd-mFkq8z",timelineHd:"timeline-hd-mFkq8z",scrolled:"scrolled-tYtxJi","track-operation":"track-operation-cZJyR7",trackOperation:"track-operation-cZJyR7","lv-btn":"lv-btn-IoRSFN",lvBtn:"lv-btn-IoRSFN",active:"active-ZbXHc9","iconpark-icon":"iconpark-icon-rylQUm",iconparkIcon:"iconpark-icon-rylQUm","track-operation-item":"track-operation-item-wGH0Ci",trackOperationItem:"track-operation-item-wGH0Ci",primary:"primary-ujkWFg","timeline-bd-container":"timeline-bd-container-Ozl3ha",timelineBdContainer:"timeline-bd-container-Ozl3ha","timeline-bd":"timeline-bd-ikrlF9",timelineBd:"timeline-bd-ikrlF9",vScroll:"vScroll-EbiWWj","timeline-bd-vertical-scroll":"timeline-bd-vertical-scroll-BsptfE",timelineBdVerticalScroll:"timeline-bd-vertical-scroll-BsptfE","seletion-box":"seletion-box-QXAm0i",seletionBox:"seletion-box-QXAm0i","timeline--uninteractive":"timeline--uninteractive-WZkfqB",timelineUninteractive:"timeline--uninteractive-WZkfqB","track-wrapper":"track-wrapper-mMNcR9",trackWrapper:"track-wrapper-mMNcR9","track-list":"track-list-Jhe9rG",trackList:"track-list-Jhe9rG","track-loading":"track-loading-HAKZo_",trackLoading:"track-loading-HAKZo_","image-wrapper":"image-wrapper-Ezat98",imageWrapper:"image-wrapper-Ezat98","track-loading-text":"track-loading-text-M3N2BA",trackLoadingText:"track-loading-text-M3N2BA",template:"template-flXCKP","scroll-smooth":"scroll-smooth-VpU7Hi",scrollSmooth:"scroll-smooth-VpU7Hi"}},954882:function(){},578350:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"transition-add-icon":"transition-add-icon-NmshtC",transitionAddIcon:"transition-add-icon-NmshtC","show-icon":"show-icon-xHvP0W",showIcon:"show-icon-xHvP0W","hidden-icon":"hidden-icon-Vmz5cX",hiddenIcon:"hidden-icon-Vmz5cX","disable-icon":"disable-icon-QfvsCk",disableIcon:"disable-icon-QfvsCk"}},437467:function(e,t,i){i.d(t,{Z:function(){return r}});let r={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px",borderRadiusSeg:"8px","timeline-container":"timeline-container-jbJypW",timelineContainer:"timeline-container-jbJypW",isDragActive:"isDragActive-lZMA3i",timeline:"timeline-mg8CFA","timeline-panel-container":"timeline-panel-container-pD_qnu",timelinePanelContainer:"timeline-panel-container-pD_qnu",container:"container-S9dyoP",template:"template-gPTu4n","scroll-smooth":"scroll-smooth-AoHjWF",scrollSmooth:"scroll-smooth-AoHjWF","track-operation":"track-operation-e6drWc",trackOperation:"track-operation-e6drWc","track-wrapper":"track-wrapper-ZvWDJR",trackWrapper:"track-wrapper-ZvWDJR","track-list":"track-list-trzxow",trackList:"track-list-trzxow"}},984321:function(e,t,i){e.exports=i.p+"static/assets/algorithmConfig.4c4ea710.json"},500492:function(e,t,i){e.exports=i.p+"static/ko.ttf.be841ba9.zip"},980329:function(e,t,i){e.exports=i.p+"static/matting_blend.f49a04a2.zip"},140059:function(e,t,i){e.exports=i.p+"static/minority_languages.fc612d34.zip"},172053:function(e,t,i){e.exports=i.p+"static/th.ttf.cf51557b.zip"},542132:function(e,t,i){e.exports=i.p+"static/image/default-preview.a087525f.png"},307926:function(e,t,i){e.exports=i.p+"static/font/NotoColorEmoji-git.97d1a7bc.ttf"},14634:function(e,t,i){i.d(t,{Z:function(){return r}}),i(772322),i(218571);let r="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIi8+CjxyZWN0IHg9IjE0Ljc1IiB5PSIzMS41MTE0IiB3aWR0aD0iMTYuNzEwMSIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cmVjdCB4PSIzMy44MTAxIiB5PSIzMS41MTE0IiB3aWR0aD0iMTYuNzEwMSIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuNiIvPgo8cmVjdCB4PSI1Mi44NzAxIiB5PSIzMS41MTE0IiB3aWR0aD0iNTEuODg5MyIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8ZWxsaXBzZSBjeD0iNDIuMDM1MyIgY3k9IjQxLjY5MDYiIHJ4PSI0LjY5MDU1IiByeT0iNC42OTA1NiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxlbGxpcHNlIGN4PSI0Mi4wMzUyIiBjeT0iNDEuNjkwNSIgcng9IjIuMzQ1MjgiIHJ5PSIyLjM0NTI4IiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHBhdGggZD0iTTE0Ljc1IDY1LjUyMjZDMTQuNzUgNjQuMjI3MyAxNS44IDYzLjE3NzMgMTcuMDk1MyA2My4xNzczSDI5LjExNDhDMzAuNDEwMSA2My4xNzczIDMxLjQ2MDEgNjQuMjI3MyAzMS40NjAxIDY1LjUyMjZWOTAuMTQ4QzMxLjQ2MDEgOTEuNDQzMyAzMC40MTAxIDkyLjQ5MzMgMjkuMTE0OCA5Mi40OTMzSDE3LjA5NTNDMTUuOCA5Mi40OTMzIDE0Ljc1IDkxLjQ0MzMgMTQuNzUgOTAuMTQ4VjY1LjUyMjZaIiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cmVjdCB4PSIzMy44MTAxIiB5PSI2My4xNzczIiB3aWR0aD0iNTEuODg5MyIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cmVjdCB4PSI4OC4wNDkzIiB5PSI2My4xNzczIiB3aWR0aD0iMTYuNzEwMSIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8ZyBmaWx0ZXI9InVybCgjZmlsdGVyMF9kXzMyN185OTAyMCkiPgo8cGF0aCBkPSJNNDEuNzU2MyA2Mi44NzM5QzQwLjI0NjIgNjAuOTMyNCAzNS42NzM0IDU1Ljc4NDEgMzYuMzAzIDUzLjQ1NDdDMzYuNjAyMyA1Mi4yMjM0IDM3Ljc3MDQgNTEuNDA2NiAzOS4wMjk2IDUxLjU0OEM0MS43MTgxIDUxLjc5NTkgNDQuMzkwMiA1Ni43OTExIDQ0LjA4MjUgNTUuNjI4NEM0My43OTU0IDUzLjU3NzkgNDMuMTkyIDUyLjExMzUgNDIuNjQ3NCA0OS45ODQ0QzQxLjI5NzcgNDYuNTAwNyA0MC40MjMyIDQyLjU0NjMgNDIuODYyMiA0MS42Mzg4QzQ0LjgwNDcgNDAuOTE2IDQ2LjYyMDYgNDMuMjcyNSA0Ny40NzY0IDQ2LjY4NTlDNDcuOTQ2IDQ4LjU1ODkgNDguMTUzMSA1MS4xMzggNDguMzkxNiA1MS45NDg0QzQ4LjM5MTYgNDkuMTIzOCA0OS41OTUgNDcuODc0MSA1MS4xMzkzIDQ3Ljg3NDFDNTIuNjgzNSA0Ny44NzQxIDUzLjY3NzkgNDkuMDk5NCA1My45NTkzIDUxLjk0ODRDNTQuMTQyMiA0OS40MzM0IDU1LjU2MDEgNDguMzY5IDU2Ljg1MjQgNDguNTE1N0M1Ny45ODUgNDguNjQ0MyA1OS4wMjMxIDQ5LjY2NjkgNTkuMDIzMSA1MS45NDg0QzU5Ljg3ODEgNTEuMjM1NCA1OS45MzEgNDkuODI3MyA2MS4zODI5IDQ5Ljk4NDRDNjEuOTg1IDUwLjA0OTUgNjIuNDY2NyA1MC40MDAyIDYyLjY3MyA1MS41NDhDNjMuMzE3NyA1NS4xMzQgNjEuMDQ1OSA2Mi4xNzEgNTkuNDY5NyA2NS42MDA1QzU5LjE5MzcgNjYuODAyOSA1OS4xODc1IDY4LjA3MDIgNTkuNTA3OCA2OS4yNjE1QzU3LjQ0NDcgNjkuNDc5NSA1Ni4yOTI5IDY5LjExNjcgNTUuMjU1OCA2Ny4yMDIyQzU0Ljk5NDIgNjYuNjc4IDU0LjIyMDkgNjYuNjc4IDUzLjk1OTMgNjcuMjAyMkM1My41Mzk4IDY3LjkyNjcgNTIuNjA1NSA2OS4yNDI0IDUxLjk1NzIgNjkuMzE4N0M1MC42Nzk3IDY5LjQ3MTIgNDguMDQ4NCA2OS4zMTg3IDQ1Ljk3MDEgNjkuMzE4N0M0NS45NzAxIDY5LjMxODcgNDYuMzEzMyA2Ny40MTE5IDQ1LjUzMTYgNjYuNzI1NUM0NC4xNjY1IDY1LjUyNyA0Mi45NDk4IDY0LjIzOCA0MS43NTYzIDYyLjg3MzlaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2RfMzI3Xzk5MDIwIiB4PSIzMS4yNDM5IiB5PSIzOC41MDgxIiB3aWR0aD0iMzQuNTQxNSIgaGVpZ2h0PSIzNS44Nzg0IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIiByZXN1bHQ9ImhhcmRBbHBoYSIvPgo8ZmVPZmZzZXQgZHg9Ii0xIiBkeT0iMSIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIyIi8+CjxmZUNvbXBvc2l0ZSBpbjI9ImhhcmRBbHBoYSIgb3BlcmF0b3I9Im91dCIvPgo8ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMC4zNjA3MTQgMCAwIDAgMCAwLjQgMCAwIDAgMC4xMiAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93XzMyN185OTAyMCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvd18zMjdfOTkwMjAiIHJlc3VsdD0ic2hhcGUiLz4KPC9maWx0ZXI+CjwvZGVmcz4KPC9zdmc+Cg=="},282607:function(e,t,i){i.d(t,{r:function(){return n}});var r=i(772322);i(218571);let n=e=>(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 18 18",...e,children:[(0,r.jsx)("path",{fill:"#00CAE0",fillRule:"evenodd",d:"M5 4.5a.5.5 0 0 0-.5.5v10a1.5 1.5 0 0 1-3 0V5A3.5 3.5 0 0 1 5 1.5h10a1.5 1.5 0 0 1 0 3z",clipRule:"evenodd"}),(0,r.jsx)("path",{stroke:"#000",strokeLinecap:"round",strokeOpacity:.5,d:"M5 15V5h10a2 2 0 1 0 0-4H5a4 4 0 0 0-4 4v10a2 2 0 1 0 4 0Z"})]})},47945:function(e,t,i){i.d(t,{r:function(){return n}});var r=i(772322);i(218571);let n=e=>(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 18 18",...e,children:[(0,r.jsx)("path",{fill:"#fff",fillOpacity:.4,fillRule:"evenodd",d:"M5 4.5a.5.5 0 0 0-.5.5v10a1.5 1.5 0 0 1-3 0V5A3.5 3.5 0 0 1 5 1.5h10a1.5 1.5 0 0 1 0 3z",clipRule:"evenodd"}),(0,r.jsx)("path",{stroke:"#000",strokeLinecap:"round",strokeOpacity:.4,d:"M5 15V5h10a2 2 0 1 0 0-4H5a4 4 0 0 0-4 4v10a2 2 0 1 0 4 0Z"})]})},739111:function(e,t,i){i.d(t,{S:()=>eU});var r=i("789786"),n=i("41770"),a=i("387381"),o=i("108692"),s=i("823077"),l=i("587892"),d=i("402655"),c=i("729596"),u=i("160391"),h=i("230689"),g=i("966697"),p=i("596112"),m=i("513498"),f=i("583522"),_=i("860147"),v=i("566504"),S=i("789193"),y=i("322401"),b=i("591010"),A=i("199908"),M=i("177975"),T=i("896413"),w=i("426336"),C=i("456012"),I=i("446835"),x=i("692474"),k=i("558595"),D=i("492430"),P=i("801497"),R=i("150564"),E=i("893525");class U extends d.JT{executeReplaceSegmentFromUserMaterial(e,t,i){var r,n,a;return this._replaceSegmentManager.replaceVideo({segmentIds:[i.id],type:(0,C.Q)(e),value:t,sourceStartTime:0n,sourceDuration:null!==(a=null===(r=i.sourceTimerange)||void 0===r?void 0:r.duration)&&void 0!==a?a:0n,targetStartTime:i.targetTimerange.start,targetDuration:null===(n=i.targetTimerange)||void 0===n?void 0:n.duration})}get didModified(){return this._didModified}constructor(e,t,i,r,n,a,o,s,d,c,u,h,g){super(),this._canvasManager=e,this._canvasStore=t,this._addSegmentManager=i,this._replaceSegmentManager=r,this._modalManager=n,this._selection=a,this._timelineToast=o,this._autoReplace=s,this._segmentOperationManager=d,this._isTemplate=c,this._mainEditorWidgetService=u,this._containerService=h,this._mainDraftService=g,this._afterReplaceMutableEvent=this._register(new l.Q),this.afterReplaceMutableEvent=this._afterReplaceMutableEvent.event,this._didModified=!1,this._onChangeDidModified=this._register(new l.Q),this.onChangeDidModified=this._onChangeDidModified.event,this.beforeAddSegment=()=>{this._canvasStore.actionLoadingSet(!0)},this.afterAddSegment=e=>{this._canvasStore.actionLoadingSet(!1),this.setDidModified(!0);let{dataSDK:t}=this._canvasManager,{richTextEditorManager:i,selectionManager:r}=this._canvasManager.modules;if(e){let n=t.draftView.getSegmentById(e),a=n&&!(0,_.Cq)(n)&&!(0,_.K9)(n);n&&(0,w.Ftn)(n)&&a?i.actionTextEditingEnterEdit(!1,e):n&&(0,w.Q2R)(n)&&r.selectSegments([e],void 0,b.U.DoubleClick)}},this.onAddError=e=>{this._canvasStore.actionLoadingSet(!1)},this.beforeReplaceMutable=()=>{this._canvasStore.actionLoadingSet(!0);let{templateManager:e}=this._canvasManager.modules;if(e){e.templateStore.actionDisableInteractAddSegmentSet(!0);let{disableInteractFromTemplate:t}=e.templateStore;this._canvasStore.actionDisableInteractFromOutsideSet(t)}},this.afterReplaceMutable=()=>{let{templateManager:e}=this._canvasManager.modules;if(e){e.templateStore.actionDisableInteractAddSegmentSet(!1);let{disableInteractFromTemplate:t}=e.templateStore;this._canvasStore.actionDisableInteractFromOutsideSet(t)}this._afterReplaceMutableEvent.fire(!0),this._canvasStore.actionLoadingSet(!1),this.setDidModified(!0)},this.onReplaceError=e=>{let{templateManager:t}=this._canvasManager.modules;if(t){t.templateStore.actionDisableInteractAddSegmentSet(!1);let{disableInteractFromTemplate:e}=t.templateStore;this._canvasStore.actionDisableInteractFromOutsideSet(e)}this._afterReplaceMutableEvent.fire(!1),this._canvasStore.actionLoadingSet(!1)},this.executeAddSegmentOnDrop=(e,t)=>(0,x._Y)(this._addSegmentManager,e,t),this.executeAddSegmentUserMaterial=(e,t)=>(0,x.YJ)(this._addSegmentManager,e,t),this.executeReplaceMutableVideoOnDrop=async(e,t,i)=>{if(t.id&&!this._mainEditorWidgetService.checkAvailability([{mutableId:t.id,type:e.type,value:e.dragSource}]))return{result:(0,y.$)(S.F.ReplaceSegment),performanceDuration:0};let r=await this._mainEditorWidgetService.unHideMutableVideoManager.autoUnHideMutableVideo(t.id),n=await this._autoReplace.expand(t.id,"mutable",{type:e.type,data:e.dragSource}),a=(0,k.i)(this._replaceSegmentManager,n.map((t,i)=>({dragData:e,mutableVideo:t,autoUnhide:0===i&&r?r:void 0})),i),o=this._mainEditorWidgetService.subjectCropManager.getSubjectCropResult(e.dragSource,n);return await Promise.allSettled([o,a]).then(t=>{let[i]=t;return Promise.allSettled(n.map(t=>new Promise((r,n)=>{requestIdleCallback(()=>{try{r(this._mainEditorWidgetService.subjectCropManager.applySubjectCropSync(e.dragSource,[t],i))}catch(e){n(e)}})})))}),a},this.executeReplaceMutableVideoFromUserMaterial=async(e,t,i,r)=>{let n=await this._autoReplace.expand(i.id,"mutable",{type:e,data:t});return(0,k.f)(this._replaceSegmentManager,n.map(i=>({resourceType:e,resource:t,mutableVideo:i})),r)},this._getContextMenuConfig=e=>{let t=e=>e.length>0&&e.every(e=>[I.cf,I.b3,v.JA].some(t=>t(e))),i=(0,A.u)(this._containerService,null!=e?e:"material");return function(e){let{canCopyCut:t,canDuplicate:i,canCrop:r,canDelete:n,canFlip:a,canPaste:o,disablePaste:s,canReplace:l,onCopy:d,onCrop:c,onCut:u,onDelete:h,onFlip:g,onPaste:p,onReplace:m,onDuplicate:f,getSelectedSegments:_,reporter:v}=e;return[{order:0,type:"menu",icon:R.jSR,shouldShow:t,title:P.ZP.t("copy_web",{},"\u590D\u5236"),shortcut:(0,D.Y)("copy"),onClick:()=>{v("copy",_()[0]),d()}},{order:1,type:"menu",icon:R.jyF,shouldShow:t,title:P.ZP.t("cut_web",{},"\u526A\u5207"),shortcut:(0,D.Y)("cut"),onClick:()=>{v("cut",_()[0]),u()}},{order:2,type:"menu",icon:R._XJ,shouldShow:o,disabled:s,title:P.ZP.t("past_web_e",{},"\u7C98\u8D34"),shortcut:(0,D.Y)("paste"),onClick:()=>{let e=_()[0];e?v("paste",e):v("paste",void 0,"canvas"),p()},needDivider:()=>0===_().length},{order:2,type:"menu",icon:R.Doy,shouldShow:i,title:P.ZP.t("web_overlay_button_duplicate",{},"Duplicate"),shortcut:(0,D.Y)("duplicate"),onClick:()=>{v("duplicate",_()[0]),f()}},{order:3,type:"menu",icon:R.fjI,shouldShow:n,title:P.ZP.t("web_delete",{},"\u5220\u9664"),shortcut:(0,D.Y)("backspace"),onClick:()=>{v("delete",_()[0]),h()},needDivider:!0},{order:4,type:"menu",icon:R.S31,shouldShow:l,title:P.ZP.t("web_overlay_button_replace",{},"Replace"),onClick:()=>{v("replace_media",_()[0])},isFileUploader:!0,onFileChange:e=>{m(e)},needDivider:!0},{order:5,type:"menu",icon:R.VJ1,shouldShow:r,title:P.ZP.t("web_crop",{},"Crop"),onClick:()=>{let e=_()[0];v("crop",e),e&&c(e.id)}},{order:6,type:"subMenu",icon:R.Lyt,shouldShow:a,title:P.ZP.t("web_video_btn_flip",{},"Flip"),subMenuItems:[{type:"menu",icon:R.Lyt,shouldShow:a,title:P.ZP.t("web_overlay_button_flip_horizon",{},"Flip horizontally"),shortcut:(0,D.Y)("flip-horizontal"),onClick:()=>{let e=_()[0];v("flip_horizontal",e),e&&g(e,!1)}},{type:"menu",icon:R.yhl,shouldShow:a,title:P.ZP.t("web_overlay_button_flip_vertical",{},"Flip vertically"),shortcut:(0,D.Y)("flip-vertical"),onClick:()=>{let e=_()[0];v("flip_vertical",e),e&&g(e,!0)}}]}]}({canCopyCut:t,canDuplicate:e=>t(e)&&e.every(e=>!(0,w.duj)(e)),canPaste:e=>0===e.length||e.every(e=>[I.cf,I.b3,v.JA].some(t=>t(e))),disablePaste:()=>!this._segmentOperationManager.canPaste,canDelete:e=>!(0,I.pO)(e),canReplace:I.n5,canCrop:I.n5,canFlip:I.NY,onCopy:this._segmentOperationManager.copySelectedSegments,onCrop:this.onCrop,onCut:this._segmentOperationManager.cutSelectedSegments,onDelete:()=>{this._segmentOperationManager.removeSelectedSegments("click_delete")},onFlip:(e,t)=>{(function(e,t,i){var r;let{flip:n}=null!==(r=e.clip)&&void 0!==r?r:{};if(n){let{horizontal:r,vertical:a}=n;t.api.segment.mirror({segmentId:e.id,vertical:i?!a:a,horizontal:i?r:!r})}})(e,this._canvasManager.dataSDK,t)},onPaste:()=>{let{ok:e,msg:t}=this._segmentOperationManager.pasteSegmentsAtCurrentSeek();!e&&t&&this._timelineToast(t)},onDuplicate:()=>{let{ok:e,msg:t}=this._segmentOperationManager.duplicateSelectedSegments();!e&&t&&this._timelineToast(t)},onReplace:e=>(0,C.K)({canvasManager:this._canvasManager,event:e,mainEditorWidgetService:this._mainEditorWidgetService,isReplaceMutable:!!this._mainEditorWidgetService.segmentSelection.segmentMutable,containerService:this._containerService,onError:this._timelineToast}),getSelectedSegments:this._selection.getSelectedSegments.bind(this._selection),reporter:i})},this.onFileUploadClick=e=>{e.stopPropagation(),(0,M.gM)(this._containerService,{optionType:M.P6.Replace})},this.onCrop=e=>{this._modalManager.showMultiTrackCropModal(e,{openSource:"canvas"})},this._getWidgetMenuConfig=()=>{let e=(0,A.u)(this._containerService,"toolbar");return(0,E.y)({canvasManager:this._canvasManager,mainEditorWidgetService:this._mainEditorWidgetService,segmentOperationManager:this._segmentOperationManager,selection:this._selection,containerService:this._containerService,isTemplate:this._isTemplate,isEditingTemplate:!!this._mainEditorWidgetService.segmentSelection.observeData.subDraftId,onError:this._mainEditorWidgetService.timelineManager.timelineUI.toast.error,reporter:e,onFileUploadClick:this.onFileUploadClick,onCrop:this.onCrop})},this.setDidModified=e=>{this._didModified=!!e,this._onChangeDidModified.fire(this._didModified)},e.registerContribution({id:"segment",getContextMenuConfig:this._getContextMenuConfig,getWidgetMenuConfig:this._getWidgetMenuConfig})}}U=(0,r.gn)([(0,r.fM)(10,T.a),(0,r.fM)(11,h.t),(0,r.fM)(12,o.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ICanvasManager?Object:ICanvasManager,"undefined"==typeof CanvasStore?Object:CanvasStore,"undefined"==typeof AddSegmentManager?Object:AddSegmentManager,"undefined"==typeof ReplaceSegmentManager?Object:ReplaceSegmentManager,"undefined"==typeof IModalManager?Object:IModalManager,"undefined"==typeof ISelection?Object:ISelection,Function,"undefined"==typeof IAutoReplace?Object:IAutoReplace,"undefined"==typeof ISegOperationManager?Object:ISegOperationManager,Boolean,void 0===T.a?Object:T.a,void 0===h.t?Object:h.t,void 0===o.n?Object:o.n])],U);var B=i("215693"),L=i("823081"),N=i("58236"),j=i("917350"),F=i("968621"),V=i("472602"),O=i("115784"),W=i("260963"),Z=i("572013");class z extends d.JT{get trackingRect(){var e;return null!==(e=this._canvasStore.trackingRect)&&void 0!==e?e:this.getDefaultTrackingRect()}get trackingRectSegmentId(){return this._canvasStore.trackingRectSegmentId}getDefaultTrackingRect(){var e,t,i,r;let n={...O.pd},a=null!==(i=null===(e=this._canvasStore.canvasConfig)||void 0===e?void 0:e.width)&&void 0!==i?i:1,o=null!==(r=null===(t=this._canvasStore.canvasConfig)||void 0===t?void 0:t.height)&&void 0!==r?r:1;return a>=o?n.width=n.height*(o/a):n.height=n.width*(a/o),n}formatTrackingRectWhenCanvasSizeChange(){var e,t;let{width:i,height:r}=null!==(e=this._cacheCanvasConfig)&&void 0!==e?e:{width:2,height:2},{width:n,height:a}=this.trackingRect,{width:o,height:s}=null!==(t=this._canvasStore.canvasConfig)&&void 0!==t?t:{width:2,height:2};this._cacheCanvasConfig=this._canvasStore.canvasConfig,this.setTrackingRect({...this.trackingRect,height:o*n/2/(i*n/2/(r*a/2))*2/s})}setTrackingRect(e){this._canvasStore.actionTrackingRectSet(e)}setTrackingRectSegmentId(e){this._canvasStore.actionTrackingRectSegmentIdSet(e)}setTrackingRectCallback(e){this._canvasStore.actionTrackingRectCallbackSet(e)}transformCanvasRectToTargetSegmentRect(e){var t,i;let{canvasConfig:r,canvasRectangles:n}=this._canvasStore,a=n.find(t=>t.id===e);if(!r||!a)return console.error("[tracking error]: can not find canvas config or targetRectangle!"),this.trackingRect;let o=this._dataSdk.draftView.getSegmentById(e),s=null!==(i=null==o?void 0:null===(t=o.clip)||void 0===t?void 0:t.flip.horizontal)&&void 0!==i&&i,[l,d]=(0,Z.Ce)([r.width,r.height]),c=this.trackingRect,{width:u,height:h,x:g,y:p,rotate:m}=a,f=c.width/(u/l),_=c.height/(h/d),v=l/2+l/2*c.centerX,S=d/2+d/2*c.centerY,y=v-(g+u/2),b=S-(p+h/2),A=-(m*Math.PI)/180,M=(Math.cos(A)*y-Math.sin(A)*b)/(u/2),T={centerX:s?-M:M,centerY:(Math.sin(A)*y+Math.cos(A)*b)/(h/2),width:f,height:_,angle:s?180-(c.angle-m):c.angle-m},w=null==o?void 0:o.material.crop;if(w){let e=1/(w.lowerRightX-w.lowerLeftX),t=1/(w.lowerRightY-w.upperRightY),i=T.width/e;T.width=i;let r=T.height/t;T.height=r;let n=w.upperLeftX+(w.lowerRightX-w.lowerLeftX)/2,a=w.upperLeftY+(w.lowerRightY-w.upperRightY)/2;T.centerX=T.centerX/e-(.5-n)*2,T.centerY=T.centerY/t-(.5-a)*2}return T}transformTargetSegmentRectToCanvasRect(e,t){let{canvasConfig:i,canvasRectangles:r}=this._canvasStore,n=r.find(e=>e.id===t);if(!i||!n)return console.error("[tracking error]: can not find canvas config or targetRectangle!"),e;let[a,o]=(0,Z.Ce)([i.width,i.height]),{width:s,height:l,x:d,y:c,rotate:u}=n,h=e.width/(a/s),g=e.height/(o/l),p=d+s/2+s/2*e.centerX,m=c+l/2+l/2*e.centerY,f=p-a/2,_=m-o/2,v=u*Math.PI/180;return{centerX:(Math.cos(v)*f-Math.sin(v)*_)/(a/2),centerY:(Math.sin(v)*f+Math.cos(v)*_)/(o/2),width:h,height:g,angle:e.angle+u}}getTrackedTargetVideoSegment(e){let{tracks:t,progress:i}=this._canvasStore,r=[];for(let n=t.length-1;n>=0;n--)if("video"===t[n].type){let{targetTimerange:a}=e,o=t[n].segments.find(e=>{let{start:t,duration:r}=e.targetTimerange;return e.material.sourcePlatform!==w.cvu.MaterialPlatformGiphy&&!(0,w.duj)(e)&&i>=t&&i<t+r&&!(t+r<a.start||t>a.start+a.duration)});o&&r.push(o)}for(let e=0;e<=r.length-1;e++){let t=r[e],i=this.transformCanvasRectToTargetSegmentRect(t.id);if((0,V.P)(i))return t}return null}getCurrentTrackingVideoSegmentId(e){let{tracks:t,progress:i}=this._canvasStore,{videoTracking:r}=e;if(!(null==r?void 0:r.enableVideoTracking))return null;let{trackers:n}=r,a=n.map(e=>e.targetSegmentId),o=[];for(let r=t.length-1;r>=0;r--)if(r<e.trackRenderIndex&&"video"===t[r].type){let{targetTimerange:n}=e,a=t[r].segments.find(e=>{let{start:t,duration:r}=e.targetTimerange;return i>=t&&i<t+r&&!(t+r<n.start||t>n.start+n.duration)});a&&o.push(a)}for(let e=0;e<=o.length-1;e++){let t=o[e];if(a.includes(t.id))return t.id}return null}setTrackingRectActive(e){this._canvasStore.actionTrackingRectActiveSet(e)}constructor(e,t){super(),this._canvasStore=e,this._dataSdk=t,this._cacheCanvasConfig=null,(0,W.U5)(()=>this._canvasStore.canvasConfig,e=>{!this._cacheCanvasConfig&&(this._cacheCanvasConfig=e)})}}var G=i("517847"),K=i("450029"),Q=i("371002"),H=i("529910"),Y=i("707721"),J=i("446352"),X=i("772322");i("784923");var q=i("498417"),$=i("58377"),ee=i("556418"),et=i("208066"),ei=i("744268"),er=i("650248");class en{actionSetShowPrompt(e){this.showPrompt=e}actionSetProgress(e){this.generateProgress=e}actionSetPromptLoading(e){this.isPromptLoading=e}actionSetIsRewriting(e){this.isRewriting=e}actionSetIsResult(e){this.isInResult=e}constructor(){this.showResult=!1,this.showPrompt=!1,this.isPromptLoading=!1,this.generateProgress=0,this.defaultPromptValue="",this.isRewriting=!1,this.isInResult=!1,(0,W.ky)(this)}}var ea=i("128665"),eo=i("625421"),es=i("544633"),el=i("218571"),ed=i("922732"),ec=i("670933"),eu=i("641917"),eh=i("937802"),eg=i("831998"),ep=i("343828"),em=i("668771");let ef=(0,ec.Pi)(e=>{let{aiWriterManager:t,onAiWriteSubMenuChange:i,position:r}=e,{isRewriting:n,isPromptLoading:a,showPrompt:o}=t.getAiWriterStore(),s=(0,eh.G)(h.t),[l]=(0,eg.F)(),d=t.getCurrentTextSelectionId(),c=(0,es.default)(e=>{i(e,r)}),u=(0,es.default)(()=>{(0,eu.L)(s,{position:r,action:"click",...t.getCurrentSegmentReportInfo()})});return(0,el.useEffect)(()=>{(0,eu.L)(s,{position:r,action:"show",...t.getCurrentSegmentReportInfo()})},[]),(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(ed.C,{forceLight:!1,position:"bottom",isDarkTheme:ep.h.Dark===l,onClick:u,isLoading:n||o&&a,onAiWriteSubMenuChange:c,triggerProps:{popupAlign:{bottom:12}}}),d&&(0,X.jsx)(em.G,{aiWriterManager:t,widgetId:d})]})});var e_=i("752075"),ev=i("467098"),eS=i("998828"),ey=i("553748");let eb={entranceWrapper:"entranceWrapper-mx600M"};var eA=i("655820"),eM=i("811750"),eT=i("959593");let ew={[$.U.Rewrite]:ee.Yq.Rewrite,[$.U.Shorter]:ee.Yq.Shorter,[$.U.Longer]:ee.Yq.Longer,[$.U.GenerateText]:null,[$.U.GenerateTitle]:null},eC={[$.U.Rewrite]:null,[$.U.Shorter]:null,[$.U.Longer]:null,[$.U.GenerateText]:ee.CB.Text,[$.U.GenerateTitle]:ee.CB.Title};class eI extends d.JT{async _getAbAsyncEnable(){this._asyncAbEnableAiWriter=await this._teaAdapterService.getABTestVar("enable_ai_writer",!1)}_handleUndoRedoAbort(){Object.keys(this._segmentsRewriteProcessMap).forEach(e=>{"loading"===this._segmentsRewriteProcessMap[e].currentStep&&(this._clearRewrite(e),this._aiWriterStore.actionSetIsRewriting(!1))}),Object.keys(this._segmentsTextGenerateProcessMap).forEach(e=>{"loading"===this._segmentsTextGenerateProcessMap[e].currentStep&&(this._clearAiWriterPrompt(e),this._aiWriterStore.actionSetPromptLoading(!1),this._aiWriterStore.actionSetShowPrompt(!1))})}_handleDiffChange(){this._waitForAcceptSegmentId&&(this._handleTextGenerateAccept(this._waitForAcceptSegmentId),this._handleRewriteAccept(this._waitForAcceptSegmentId),this._waitForAcceptSegmentId=void 0)}_initCanvasChange(){let e=(0,W.U5)(()=>this._canvasStore.canvasRectangles,e=>{Object.keys(this._segmentsRewriteProcessMap).forEach(e=>{let t=this._segmentsRewriteProcessMap[e];if("loading"===t.currentStep){let i=this._canvasStore.canvasRectangles.find(t=>t.id===e);i&&(t.rectangle=i)}}),Object.keys(this._segmentsTextGenerateProcessMap).forEach(e=>{let t=this._segmentsTextGenerateProcessMap[e];if("loading"===t.currentStep){let i=this._canvasStore.canvasRectangles.find(t=>t.id===e);i&&(t.rectangle=i)}})});this._register({dispose:e})}handleAiWriteSubMenuChange(e,t){if(this._clickEntrancePanel=t,(0,e_.Lw)(this._containerService,{ai_writer_option:(0,e_.U2)(e),position:t,...this.getCurrentSegmentReportInfo()}),[$.U.GenerateText,$.U.GenerateTitle].includes(e)){this._aiWriterStore.actionSetShowPrompt(!0),this._generateTextType=e;let t=this._getCurrentSingleSelectionSegId();if(!t)return;let i=this._segmentsTextGenerateProcessMap[t];i?(this._generateTextType=i.generateType,this._aiWriterStore.actionSetPromptLoading(i.isTextGenerating),this._aiWriterStore.actionSetProgress(i.progress)):this._aiWriterStore.actionSetPromptLoading(!1)}else this._aiWriterStore.actionSetShowPrompt(!1),this._handleRewrite(e)}_clearRewrite(e){let t=null!=e?e:this._getCurrentSingleSelectionSegId();if(!!t)this._segmentsRewriteProcessMap[t]&&delete this._segmentsRewriteProcessMap[t],this._canvasStore.updateWidgetMenu()}async _handleRewriteResult(e,t){let i=this._segmentsRewriteProcessMap[e];if(!(null==i?void 0:i.isRewriting))return;let r=this._getCurrentSingleSelectionSegId(),n=t.texts[0];r===e?(i.currentStep="result",i.reWriteResult=n,this._canvasStore.updateWidgetMenu(),await this._updateTextContent({aiWriterType:i.reWriteType,content:n.text,beforeSegmentInfo:i.beforeSegmentInfo,segId:e}),this._waitForAcceptSegmentId=e):(await this._updateTextContent({aiWriterType:i.reWriteType,content:n.text,segId:e,beforeSegmentInfo:i.beforeSegmentInfo}),this._clearRewrite(e))}_handleRewriteError(e,t){q.Z.error({content:t.msg}),this._clearRewrite(e)}_handleRewrite(e){let t=ew[e],i=this._getCurrentSingleSelectionSegId();if(!i)return;let r=this._mainDraftService.dataSdk.draftView.getSegmentById(i);if(!r||!(0,w.Ftn)(r))return;let n=r.material.text;if(t){this._aiWriterStore.actionSetIsRewriting(!0),this._canvasStore.updateWidgetMenu();let r=performance.now();this._aiWriterDataService.textRewrite({type:t,content:n}).then(t=>{let a=Math.floor(performance.now()-r);t.ok?(this._segmentsRewriteProcessMap[i]&&(this._segmentsRewriteProcessMap[i].beforeSegmentInfo=this._getBeforeSegmentIno(i)),this._handleRewriteResult(i,t.value),(0,ev.m)(this._containerService,{ai_writer_option:(0,e_.U2)(e),duration:a,status:"success",prompt_text_cnt:n.length,prompt_text_detail:n,script_id:t.value.texts[0].scriptId,script:t.value.texts[0].text})):(this._handleRewriteError(i,t),(0,ev.m)(this._containerService,{ai_writer_option:(0,e_.U2)(e),duration:a,status:"fail",prompt_text_cnt:n.length,prompt_text_detail:n,error_code:`${t.code}`}))}).finally(()=>{this._aiWriterStore.actionSetIsRewriting(!1),this._canvasStore.updateWidgetMenu()}),this._segmentsRewriteProcessMap[i]={currentStep:"loading",isRewriting:!0,reWriteResult:{text:"",scriptId:""},reWriteType:e,promptText:n,rectangle:this._canvasStore.canvasRectangles.find(e=>e.id===i),start:r,beforeSegmentInfo:this._getBeforeSegmentIno(i)}}}async _handleTextGenerateIdxChange(e){let t=this._getCurrentSingleSelectionSegId();if(!t||!this._segmentsTextGenerateProcessMap[t])return;let i=this._segmentsTextGenerateProcessMap[t];i.currentIdx=e,this._waitForAcceptSegmentId=void 0,await this._updateTextContent({aiWriterType:i.generateType,content:i.result[i.currentIdx].text,segId:t,beforeSegmentInfo:i.beforeSegmentInfo}),this._waitForAcceptSegmentId=t}_handlePromptEditor(){let e=this._getCurrentSingleSelectionSegId();if(!!e&&!!this._segmentsTextGenerateProcessMap[e])this._aiWriterStore.actionSetShowPrompt(!0)}_clearAiWriterPrompt(e){let t=null!=e?e:this._getCurrentSingleSelectionSegId();if(!!t)this._promptInputValue="",this._segmentsTextGenerateProcessMap[t]&&delete this._segmentsTextGenerateProcessMap[t],this._canvasStore.updateWidgetMenu()}async _handleResultAbort(e,t){let{beforeContent:i,beforeText:r,beforeY:n,beforeX:a,beforeFixWidth:o,draftId:s}=t,l=this._mainDraftService.dataSdk.draftView.getSegmentById(e);if(!l||!(0,w.Ftn)(l))return;let d=this._mainDraftService.dataSdk.api.batch.batchStart(!0),c=this._richTextEditorManager.getEditorUtil();await c.textUpdateMaterial({segId:e,textMaterial:{content:r,replaceStyleRichText:i},modifyFlags:[w.XHM.ModifyContent]},{throttle:!1}),this._mainDraftService.dataSdk.api.text.setFixedSize({segmentId:e,fixedWidth:o,x:a,y:n,isKeyframe:!0,draftId:s}),this._mainDraftService.dataSdk.api.batch.batchEnd(d)}_handleTextGenerateAbort(){let e=this._getCurrentSingleSelectionSegId();if(!e)return;let t=this._segmentsTextGenerateProcessMap[e];if((null==t?void 0:t.currentStep)!=="result")return;this._clearAiWriterPrompt(),this._handleResultAbort(e,t.beforeSegmentInfo);let{promptText:i,result:r,currentIdx:n,generateType:a}=t,o=r[n];(0,ey.u)(this._containerService,{action:"discard",prompt_text_cnt:i.length,prompt_text_detail:i,ai_writer_option:(0,e_.U2)(a),script:o.text,script_id:o.scriptId,smart_script_id:o.smartScriptId,script_request_id:o.scriptRequestId,rank:n+1}),this._aiWriterStore.actionSetShowPrompt(!1)}_getAbEnableAiWriter(){return this._configService.abTestManager.getBooleanAbTestValue("enable_ai_writer",!1)||this._asyncAbEnableAiWriter}async _updateTextContent(e){var t,i,r;let{segId:n,content:a,aiWriterType:o,ignoreContentFlag:s=!1,beforeSegmentInfo:{beforeContent:l,beforeText:d,aiTextType:c,draftId:u}}=e,h=this._mainDraftService.dataSdk.draftView.getSegmentById(n);if(!h||!(0,w.Ftn)(h))return;let g=null!==(r=this._getFirstChildrenStyle(l))&&void 0!==r?r:this._getFirstChildrenXml(l),p=this._richTextEditorManager.getEditorUtil(),m=this._mainDraftService.dataSdk.api.batch.batchStart(!0);if(s?await p.textUpdateEditingContent(n,!0):await p.textUpdateMaterial({segId:n,textMaterial:{content:a,replaceStyleRichText:s?void 0:g||l},modifyFlags:[w.XHM.ModifyContent]},{throttle:!1}),-1===h.material.fixedWidth){let e=this._getSegmentFixedParams(n,u);if(e){let{id:t,fixedWidth:i,translateX:r,translateY:n}=e;this._mainDraftService.dataSdk.api.text.setFixedSize({segmentId:t,fixedWidth:i,x:r,y:n,isKeyframe:!0,draftId:u})}}null===(t=this._getAiWriterAttachmentControl())||void 0===t||t.setDraftSegment(new w.C8D({segmentId:n,aiWriterType:function(e){switch(e){case $.U.Longer:return w.TUZ.Longer;case $.U.Shorter:return w.TUZ.Shorter;case $.U.Rewrite:return w.TUZ.Rewrite;case $.U.GenerateText:return w.TUZ.GenerateText;case $.U.GenerateTitle:return w.TUZ.GenerateTitle;default:return w.TUZ.GenerateText}}(o)}),this._mainDraftService.dataSdk),this._mainDraftService.dataSdk.api.batch.batchEnd(m),(0,eS.p)({instantiationService:this._containerService,segment:h,richTextEditorManager:this._richTextEditorManager,textParams:{text_type:(null===(i=h.material.content)||void 0===i?void 0:i.includes("effectStyle"))?"text_effect":"text",panel:"canvas"===this._clickEntrancePanel?"player":"function",ai_writer_option:(0,e_.U2)(o),ai_text_type:c,text_content:a}})}_handleTextGenerateAccept(e){let t=this._segmentsTextGenerateProcessMap[e];if(!t||"result"!==t.currentStep)return;this._waitForAcceptSegmentId=void 0,this._clearAiWriterPrompt(e),this._aiWriterStore.actionSetShowPrompt(!1);let{promptText:i,result:r,currentIdx:n,generateType:a}=t,o=r[n];(0,ey.u)(this._containerService,{action:"confirm",prompt_text_cnt:i.length,prompt_text_detail:i,ai_writer_option:(0,e_.U2)(a),script:o.text,script_id:o.scriptId,smart_script_id:o.smartScriptId,script_request_id:o.scriptRequestId,rank:n+1})}_getCurrentSingleSelectionSegId(){var e;return null===(e=this._selection.getSelectedSingleSegment())||void 0===e?void 0:e.id}getCurrentTextSelectionId(){return this._getCurrentSingleSelectionSegId()}_handleGenerateTaskProgress(e,t){let i=this._segmentsTextGenerateProcessMap[e];if(!(null==i?void 0:i.isTextGenerating))return;if(i.progress=t,this._getCurrentSingleSelectionSegId()===e)this._aiWriterStore.actionSetProgress(t)}async _handleGenerateTaskSuccess(e,t){let i=this._segmentsTextGenerateProcessMap[e];if(!!(null==i?void 0:i.isTextGenerating))this._getCurrentSingleSelectionSegId()===e?(i.progress=100,i.isTextGenerating=!1,i.result=t.texts,i.currentStep="result",i.currentIdx=0,this._aiWriterStore.actionSetPromptLoading(!1),this._aiWriterStore.actionSetProgress(100),this._aiWriterStore.actionSetShowPrompt(!1),this._canvasStore.updateWidgetMenu(),await this._updateTextContent({aiWriterType:i.generateType,content:t.texts[0].text,beforeSegmentInfo:i.beforeSegmentInfo,segId:e}),this._waitForAcceptSegmentId=e):(await this._updateTextContent({aiWriterType:i.generateType,content:t.texts[0].text,beforeSegmentInfo:i.beforeSegmentInfo,segId:e}),this._clearAiWriterPrompt(e))}_handleGenerateTaskError(e,t){let i=this._segmentsTextGenerateProcessMap[e];if(!(null==i?void 0:i.isTextGenerating))return;q.Z.error({content:t.msg});let r=this._getCurrentSingleSelectionSegId();this._clearAiWriterPrompt(e),r===e&&(this._promptInputValue=i.defaultPromptValue,this._aiWriterStore.actionSetPromptLoading(!1))}_getFirstChildrenXml(e){let t=e.match(/<([^>\s]+)([^>]*)>([\s\S]*?)<\/\1>/);return t&&t.length>=3?t[0]:null}_getFirstChildrenStyle(e){try{var t;let i=JSON.parse(e);return null!==(t=JSON.stringify({styles:[i.styles[0]],text:"a"}))&&void 0!==t?t:null}catch{return null}}_getSegmentFixedParams(e,t){var i,r,n;let a=null!==(n=null===(i=this._segmentsRewriteProcessMap[e])||void 0===i?void 0:i.rectangle)&&void 0!==n?n:null===(r=this._segmentsTextGenerateProcessMap[e])||void 0===r?void 0:r.rectangle;if(!a||!this._canvasStore.canvasConfig)return;let o=(0,Z.Ce)([this._canvasStore.canvasConfig.width,this._canvasStore.canvasConfig.height]),s=t&&this._mainDraftService.dataSdk.cutSame.getSegmentByDraftId(t),l=[];if(s){let e=this._canvasStore.canvasRectangles.find(e=>{let{id:t}=e;return t===s.id});e&&l.push(e)}return(0,eA.bC)(a,o,l)}_handleRewriteAccept(e){let t=this._segmentsRewriteProcessMap[e];if(!!t&&"result"===t.currentStep)this._waitForAcceptSegmentId=void 0,this._clearRewrite(e),(0,ey.u)(this._containerService,{action:"confirm",prompt_text_cnt:t.promptText.length,prompt_text_detail:t.promptText,ai_writer_option:(0,e_.U2)(t.reWriteType),script:t.reWriteResult.text,script_id:t.reWriteResult.scriptId})}_handleRewriteAbort(){let e=this._getCurrentSingleSelectionSegId();if(!e)return;let t=this._segmentsRewriteProcessMap[e];if((null==t?void 0:t.currentStep)==="result")this._clearRewrite(),this._handleResultAbort(e,t.beforeSegmentInfo),(0,ey.u)(this._containerService,{action:"discard",prompt_text_cnt:t.promptText.length,prompt_text_detail:t.promptText,ai_writer_option:(0,e_.U2)(t.reWriteType),script:t.reWriteResult.text,script_id:t.reWriteResult.scriptId})}isEnableAiWriter(){let e=this._selection.getSelectedSegments();return this._getAbEnableAiWriter()&&"en"===P.ZP.language&&(null==e?void 0:e.length)===1&&(0,_.b4)(e[0])}_getAiWriterAttachmentControl(){return w.lLh.getInstance().get(eM.fQ)}_getBeforeSegmentIno(e){var t,i,r,n,a;let o,s,l,d="",c="",{draftId:u,segment:h}=null!==(t=this._mainDraftService.dataSdk.draftView.getDraftIdAndSegById(e))&&void 0!==t?t:{};return h&&(0,w.Ftn)(h)&&(d=h.material.content,c=h.material.text,o=h.material.fixedWidth,s=null===(r=h.clip)||void 0===r?void 0:null===(i=r.transform)||void 0===i?void 0:i.x,l=null===(a=h.clip)||void 0===a?void 0:null===(n=a.transform)||void 0===n?void 0:n.y),{beforeContent:d,beforeText:c,beforeFixWidth:o,beforeX:s,beforeY:l,aiTextType:this.getCurrentSegmentReportInfo(e).ai_text_type,draftId:u}}handlePromptValueChange(e){this._promptInputValue=e}getCurrentSegmentDefaultPromptValue(){let e=this._getCurrentSingleSelectionSegId();return e&&this._segmentsTextGenerateProcessMap[e]?this._segmentsTextGenerateProcessMap[e].defaultPromptValue:this._promptInputValue}getAiWriterStore(){return this._aiWriterStore}getLastPosition(){return this._lastPosition}setLastPosition(e){this._lastPosition=e}handleGenerate(e){var t;let i=this._getCurrentSingleSelectionSegId();if(!i)return;let r=this._generateTextType,n=performance.now(),a=r===$.U.GenerateText?P.ZP.t("web_ai_writer_placeholder_title_body_limit",{},"Write a body text in design in 30 words."):P.ZP.t("web_ai_writer_placeholder_title_words_limit",{},"Write a title in design in 7 words."),o=this._aiWriterDataService.createPromptToTextTask({prompt:e,workSpaceId:null!==(t=this._mainDraftService.draftWorkspaceManager.workspaceId)&&void 0!==t?t:"",type:eC[r],promptPrefix:a});if(o.ok){this._handleTextGenerateAccept(i),this._aiWriterStore.actionSetShowPrompt(!0);let t=o.value;t.onProgress(e=>{let{process:t}=e;return this._handleGenerateTaskProgress(i,t)}),t.onSuccess(a=>{var o;this._segmentsTextGenerateProcessMap[i]&&(this._segmentsTextGenerateProcessMap[i].beforeSegmentInfo=this._getBeforeSegmentIno(i)),this._handleGenerateTaskSuccess(i,a),t.dispose();let s=Math.floor(Math.floor(performance.now()-n));null===(o=a.texts)||void 0===o||o.map((t,i)=>{(0,ev.m)(this._containerService,{ai_writer_option:(0,e_.U2)(r),duration:s,status:"success",prompt_text_cnt:e.length,prompt_text_detail:e,smart_script_id:t.smartScriptId,script_request_id:t.scriptRequestId,script_id:t.scriptId,rank:i+1,script:t.text})})}),t.onError(a=>{this._handleGenerateTaskError(i,a),t.dispose(),(0,ev.m)(this._containerService,{ai_writer_option:(0,e_.U2)(r),duration:Math.floor(performance.now()-n),status:"fail",prompt_text_cnt:e.length,prompt_text_detail:e,error_code:`${a.code}`})}),this._segmentsTextGenerateProcessMap[i]={currentStep:"loading",defaultPromptValue:e,isTextGenerating:!0,progress:1,result:[],currentIdx:0,onAbort:()=>t.dispose(),promptText:e,rectangle:this._canvasStore.canvasRectangles.find(e=>e.id===i),start:n,generateType:r,beforeSegmentInfo:this._getBeforeSegmentIno(i)},this._aiWriterStore.actionSetProgress(0),this._aiWriterStore.actionSetPromptLoading(!0),this._canvasStore.updateWidgetMenu()}else(0,ev.m)(this._containerService,{ai_writer_option:(0,e_.U2)(r),duration:Math.floor(performance.now()-n),status:"fail",prompt_text_cnt:e.length,prompt_text_detail:e,error_code:`${o.code}`}),q.Z.error({content:o.msg})}handlePromptCLose(){this._lastPosition=void 0,this._aiWriterStore.actionSetShowPrompt(!1),this._canvasStore.updateWidgetMenu(),this._promptInputValue=""}handlePromptCancel(){let e=this._getCurrentSingleSelectionSegId();if(!e)return;let t=this._segmentsTextGenerateProcessMap[e];t&&(t.onAbort(),t.currentStep="init",t.isTextGenerating=!1,(0,ev.m)(this._containerService,{ai_writer_option:(0,e_.U2)(t.generateType),duration:Math.floor(performance.now()-t.start),status:"cancel",prompt_text_cnt:t.promptText.length,prompt_text_detail:t.promptText})),this._aiWriterStore.actionSetPromptLoading(!1),this._canvasStore.updateWidgetMenu()}getCurrentSegmentReportInfo(e){var t,i,r;let n=null!=e?e:this._getCurrentSingleSelectionSegId(),a="generate_text";if(!n)return{text_type:"text",ai_text_type:a};a=null!==(i=null===(t=this._getAiWriterAttachmentControl())||void 0===t?void 0:t.getSegmentAiTextType(n,this._mainDraftService.dataSdk))&&void 0!==i?i:"unprocessed";let o=this._mainDraftService.dataSdk.draftView.getSegmentById(n);return o&&(0,w.Ftn)(o)?{text_type:(null===(r=o.material.content)||void 0===r?void 0:r.includes("effectStyle"))?"text_effect":"text",ai_text_type:a}:{text_type:"text",ai_text_type:a}}constructor(e,t,i,r,n,a,o,s,l){super(),this._canvasManager=e,this._selection=t,this._richTextEditorManager=i,this._canvasStore=r,this._aiWriterDataService=n,this._mainDraftService=a,this._containerService=o,this._configService=s,this._teaAdapterService=l,this._segmentsTextGenerateProcessMap={},this._segmentsRewriteProcessMap={},this._aiWriterStore=new en,this._promptInputValue="",this._lastSelectSegmentId="",this._clickEntrancePanel="canvas",this._generateTextType=$.U.GenerateText,this._asyncAbEnableAiWriter=!1,this._handleSelectionChange=(0,er.Z)(()=>{this._aiWriterStore.actionSetShowPrompt(!1),this._lastPosition=void 0,this._promptInputValue="";let e=this._getCurrentSingleSelectionSegId();if(e!==this._lastSelectSegmentId&&(this._handleTextGenerateAccept(this._lastSelectSegmentId),this._handleRewriteAccept(this._lastSelectSegmentId),this._lastSelectSegmentId=""),e){var t;let i=this._segmentsRewriteProcessMap[e];this._aiWriterStore.actionSetIsRewriting(!!(null==i?void 0:i.isRewriting));let r=this._segmentsTextGenerateProcessMap[e];this._aiWriterStore.actionSetPromptLoading(!!(null==r?void 0:r.isTextGenerating)),this._aiWriterStore.actionSetProgress(null!==(t=null==r?void 0:r.progress)&&void 0!==t?t:0),this._aiWriterStore.actionSetShowPrompt(!!(null==r?void 0:r.isTextGenerating))}},300,{trailing:!1}),this._getWidgetMenuConfig=()=>{var e,t,i;let r;let n=[],a=this._selection.getSelectedSegments(),o=!1,s=this._getAbEnableAiWriter()&&"en"===P.ZP.language&&(null==a?void 0:a.length)===1&&(0,_.b4)(a[0])&&!(0,w.duj)(a[0]);s&&((0,eT.C)(),this._lastSelectSegmentId=a[0].id,n.push({type:"icon",order:12,className:eb.entranceWrapper,icon:(0,X.jsx)(ef,{position:"canvas",aiWriterManager:this,onAiWriteSubMenuChange:this.handleAiWriteSubMenuChange.bind(this)})}));let l=this._getCurrentSingleSelectionSegId();if(s&&l&&((null===(e=this._segmentsRewriteProcessMap[l])||void 0===e?void 0:e.currentStep)==="loading"||this._aiWriterStore.isPromptLoading&&this._aiWriterStore.showPrompt)&&(o=!0),s&&l&&(null===(t=this._segmentsTextGenerateProcessMap[l])||void 0===t?void 0:t.currentStep)==="result"){let{currentIdx:e,result:t,promptText:i,generateType:n}=this._segmentsTextGenerateProcessMap[l];r=(0,X.jsx)(ea.b,{onAgree:()=>this._handleTextGenerateAccept(l),onAbort:this._handleTextGenerateAbort.bind(this),onIdxChange:this._handleTextGenerateIdxChange.bind(this),onPromptEditor:this._handlePromptEditor.bind(this),currentSelectIdx:e,texts:t,promptText:i,generateType:n,aiWriterManager:this})}if(s&&l&&(null===(i=this._segmentsRewriteProcessMap[l])||void 0===i?void 0:i.currentStep)==="result"){let e=this._segmentsRewriteProcessMap[l];r=(0,X.jsx)(eo.C,{onAgree:()=>this._handleRewriteAccept(l),onAbort:this._handleRewriteAbort.bind(this),promptText:e.promptText,rewriteText:e.reWriteResult,reWriteType:e.reWriteType})}return this._aiWriterStore.actionSetIsResult(!!r),{customMenu:r,items:n,isConicLoading:o}},this._canvasManager.registerContribution({id:"ai-writer",getWidgetMenuConfig:this._getWidgetMenuConfig}),t.onChange(this._handleSelectionChange),this._mainDraftService.dataSdk.onChangeDiff(this._handleDiffChange.bind(this)),this._initCanvasChange(),this._mainDraftService.dataSdk.onDidUndo(this._handleUndoRedoAbort.bind(this)),this._mainDraftService.dataSdk.onDidRedo(this._handleUndoRedoAbort.bind(this)),this._getAbAsyncEnable()}}eI=(0,r.gn)([(0,r.fM)(4,et.J),(0,r.fM)(5,o.n),(0,r.fM)(6,h.t),(0,r.fM)(7,ei.Ui),(0,r.fM)(8,p.w),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ICanvasManager?Object:ICanvasManager,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof IRichTextEditorManager?Object:IRichTextEditorManager,"undefined"==typeof CanvasStore?Object:CanvasStore,void 0===et.J?Object:et.J,void 0===o.n?Object:o.n,void 0===h.t?Object:h.t,void 0===ei.Ui?Object:ei.Ui,void 0===p.w?Object:p.w])],eI);var ex=i("797913"),ek=i("483221"),eD=i("789146");class eP{_disposer(){this._eventDisposers.forEach(e=>null==e?void 0:e()),this._eventDisposers=[]}async _initConfig(){try{var e,t;let i;if(!i){let e=new ek.g,t=await e.getAiWatermarkConfig();if(!t.ok)throw t.errorInfo;i=t.value}let{preview:r,resource:{url:n,width:a,height:o},position:s,region_list:l=[]}=i,{Country:d={Code:""}}=null!==(t=window.ip_location_info)&&void 0!==t?t:{};if(this._enable=(null===(e=l.includes)||void 0===e?void 0:e.call(l,d.Code))&&r,!this._enable)throw Error("ai watermark config is disable");this._canvasStore.actionAiWatermarkConfigSet({url:n,width:a,height:o,position:s}),this._ensureWatermarkShow()}catch(e){this._disposer()}}_initOnProgress(){var e;let t=this._mainEditorWidgetService.renderManager.onProgressChange(()=>{this._ensureWatermarkShow()});this._eventDisposers.push(null==t?void 0:null===(e=t.dispose)||void 0===e?void 0:e.bind(t))}_initOnDiff(){var e;let t=this._mainDraftService.dataSdk.onChangeDiff(e=>{this._renderTimeRange=this._getAigcSegmentTimeRange(),this._ensureWatermarkShow()});this._eventDisposers.push(null==t?void 0:null===(e=t.dispose)||void 0===e?void 0:e.bind(t))}_ensureWatermarkShow(){if(!this._enable)return;let e=this._mainEditorWidgetService.renderManager.progress,t=this._mainDraftService.dataSdk.draftView.getDuration();this._renderTimeRange.some(i=>{let r=e>=i.start&&e<i.start+i.duration||e===i.start+i.duration&&e===t;return r!==this._canvasStore.aiWatermarkConfig.enable&&this._canvasStore.actionAiWatermarkConfigSet({enable:r}),r}),!this._renderTimeRange.length&&this._canvasStore.actionAiWatermarkConfigSet({enable:!1})}_getAigcSegmentTimeRange(){let e=this._mainDraftService.dataSdk.draftView.getAllSegments(),t=[];return e.forEach(e=>{if(!(0,eD.p)(e))return;let{start:i,duration:r}=e.targetTimerange,n=t.filter(e=>(0,eD.d)({start:i,duration:r},e));if(n.length){let a=w.pMA.min(n.map(e=>e.start).concat([i]),"bigint"),o=w.pMA.max(n.map(e=>e.start+e.duration).concat([i+r]),"bigint")-a,s=n.reduce((e,t)=>e.concat(t.relatedSegId),[]).concat([e.id]);t=t.filter(e=>!n.includes(e)).concat([{start:a,duration:o,relatedSegId:s}])}else t.push({start:i,duration:r,relatedSegId:[e.id]})}),t.sort((e,t)=>w.pMA.minus(e.start,t.start))}constructor(e,t,i,r,n,a){this._canvasStore=e,this._containerService=t,this._mainEditorWidgetService=i,this._mainDraftService=r,this._accountService=n,this._videoConfigurationService=a,this._enable=!1,this._renderTimeRange=[],this._eventDisposers=[],!this._videoConfigurationService.getAppConfigurationValue("aiWatermark.disable")&&(this._initConfig(),this._initOnDiff(),this._initOnProgress())}}eP=(0,r.gn)([(0,r.fM)(1,h.t),(0,r.fM)(2,T.a),(0,r.fM)(3,o.n),(0,r.fM)(4,g.Gw),(0,r.fM)(5,ex.J),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof CanvasStore?Object:CanvasStore,void 0===h.t?Object:h.t,void 0===T.a?Object:T.a,void 0===o.n?Object:o.n,void 0===g.Gw?Object:g.Gw,void 0===ex.J?Object:ex.J])],eP);let eR={isNewEditPage:!1};function eE(e,t){return Object.values(e).forEach(e=>e&&t(e))}class eU extends d.JT{setLoading(e){this._canvasStore.actionLoadingSet(e)}disabledSelectWidget(e){this._canvasStore.actionIsDisabledSelectWidgetSet(e)}registerContribution(e){this._contributions.push(e)}getWidgetMenuConfig(e){let t=[];this._contributions.forEach(i=>{let{getWidgetMenuConfig:r}=i,n=null==r?void 0:r(e);n&&t.push(n)});let i=(0,H.W)({canvasManager:this,selection:this._selection,isTemplate:this._isTemplate});return i&&t.push(i),t}getContextMenuConfig(){let e=[];return this._contributions.forEach(t=>{let{getContextMenuConfig:i}=t,r=null==i?void 0:i();r&&e.push(...r)}),e}getIsVideoPreview(){return this._canvasStore.videoPreviewStatus!==J.bC.None}get dataSDK(){return this._dataSdk}get ensureManager(){return this._ensureManager}get modules(){return this._modules}get saveManager(){return this._saveManager}get draftTemplateManager(){return this._mainDraftService.draftTemplateManager}get readonly(){return this._canvasStore.readonly}get widgetSelectedOnly(){return this._canvasStore.widgetSelectedOnly}initLevel2(e,t,i,r,n,a,o,s){let{isTemplate:l,isNewEditPage:d}=s;this.renderManager=e,this._addSegmentManager=i,this._replaceSegmentManager=r,this._modules.playerController=new f.C(this._playerManager,this.renderManager,this._canvasStore),this._modules.richTextEditorManager=t,this._modules.segmentManager=this._containerService.createInstance(U,this,this._canvasStore,this._addSegmentManager,this._replaceSegmentManager,a,this._selection,this._timelineManager.timelineUI.toast.normal.bind(this._timelineManager.timelineUI.toast),this._timelineManager.autoReplace,o,this._isTemplate),this._modules.segmentManager.setDidModified(!d),this._modules.templateManager=this._containerService.createInstance(B.z,{canvasStore:this._canvasStore,dataSdk:this._dataSdk,selection:this._selection,modalManager:a,isNewEditPage:!!d,isTemplate:!!l,canvasManager:this,segmentSelection:this._segmentSelection,replaceSegmentManager:this._replaceSegmentManager}),this._modules.smartToolManager=this._containerService.createInstance(L.v,this,this._canvasStore.updateWidgetMenu,n,this._dataSdk),!s.isTemplate&&(this._modules.overlay=this._containerService.createInstance(N.s,this,this._selection,this._addSegmentManager,this._uploadManager)),!s.isTemplate&&(this._modules.aiWriterManager=this._containerService.createInstance(eI,this,this._selection,this._modules.richTextEditorManager,this._canvasStore)),this._modules.aiWatermarkManager=this._containerService.createInstance(eP,this._canvasStore)}initModules(){this._modules={selectionManager:new j.B(this._selection,this._prepareSelection,this._segmentSelection,this._dataSdk,this._canvasStore),uploadManager:this._uploadManager,workbenchController:this._containerService.createInstance(F.T,this._selection),trackingManager:new z(this._canvasStore,this._dataSdk),subjectCrop:this._subjectCropManager,resourceErrorManager:this._resourceErrorManager}}initCanvasStore(e,t,i){let r=this._canvasStore,{draftView:n}=this._dataSdk;this._register(i.onDraftLoaded(()=>r.actionDraftLoadedSet())),r.actionTracksSet(n.getAllTracks()),this._register(this._dataSdk.onChangeDiff(e=>{let{track:t,segment:i}=e;(t.length>0||i.length>0)&&(r.actionTracksSet(n.getAllTracks()),r.updateWidgetMenu())})),r.actionCanvasConfigSet({...n.getCanvasConfig()}),this._register(this._dataSdk.onChangeDiff(e=>{let{config:t}=e;t.length&&t.find(e=>{var t,i;return null==e?void 0:null===(i=e.item)||void 0===i?void 0:null===(t=i.property)||void 0===t?void 0:t.canvasConfig})&&r.actionCanvasConfigSet({...n.getCanvasConfig()})})),r.actionDurationSet(n.getDuration()),this._register(this._dataSdk.onChangeDiff(e=>{let{videoDocument:t}=e;t.getDraftMetadata().duration&&r.actionDurationSet(n.getDuration())})),r.actionEditModeSet(this._editMode),r.actionCursorModeSet(this._cursorMode),r.actionVideoPreviewDurationSet(BigInt(Math.floor(c.h.usToMs(n.getDuration())))),r.actionHasLoginSet(e.hasLogin),this._register(e.onDidLogin(()=>r.actionHasLoginSet(!0))),this._register(e.onDidLogout(()=>r.actionHasLoginSet(!1))),r.actionSetIsProgressivelyLoading(t.progressiveLoadingStore.isLoading),this._register(t.progressiveLoadingStore.onLoadingStatusChange(e=>{r.actionSetIsProgressivelyLoading(e)}));let a=(0,W.U5)(()=>r.userScale,e=>{this._zoom=e,this._onZoomChange.fire(Number((100*e).toFixed()))});this._register({dispose:a})}initCanvasView(e,t){this._view=new Y.t({canvasManager:this,canvasStore:this._canvasStore,containerService:this._containerService},e),t.setTopPartView(this._view)}_getCursorMode(){return this._cursorMode}_setCursorMode(e){this._cursorMode=e,this._canvasStore.actionCursorModeSet(e),this._onCursorModeChange.fire(e)}_getZoom(){return this._zoom}_setZoom(e){let{isFit:t,zoom:i}=e,r=Number(i)/100;r=Math.min(r=Math.max(r,m.ii["0"]),m.ii["1"]),t?this._canvasStore.actionNeedZoomToFitSet(!0):this._canvasStore.actionUserScaleSet(r,!0)}bindCanvas(e){this.canvas=e;let t=this._canvasStore.canvasSpaceRef;if(t){var i;let r=Array.from(null!==(i=t.children)&&void 0!==i?i:[]);e&&!r.some(t=>t.id===e.id)&&t.insertBefore(e,t.firstChild)}}bindCanvasSpaceRef(e){let t=(0,W.U5)(()=>this._canvasStore.canvasSpaceRef,t=>{if(t){var i;let r=Array.from(null!==(i=t.children)&&void 0!==i?i:[]);e&&!r.some(t=>t.id===e.id)&&t.insertBefore(e,t.firstChild),eE(this._modules,e=>{var i;return null===(i=e.onCanvasBoxDomReady)||void 0===i?void 0:i.call(e,t)})}});this._register({dispose:t})}enableFaceQuery(e){this._canvasStore.actionEnableFaceQuerySet(e)}setFaceInfoList(e){this._canvasStore.actionFaceInfoListSet(e)}setFixedRectangle(e){this._canvasStore.actionFixedRectangleSet(e)}setPreview(e){this._canvasStore.actionDisableInteractFromOutsideSet(!0),this.modules.selectionManager.reset(),this._canvasStore.actionPreviewInfoSet(e)}resetPreview(){this._canvasStore.actionDisableInteractFromOutsideSet(!1),this._canvasStore.actionPreviewInfoSet(null)}showAspectRatioSelectModal(){this._canvasStore.actionVisibleAspectRatioSelectModalSet(!0)}updateSegmentAddResult(e,t){t===s.D5?this._canvasStore.actionUpdateFailedSegment(e,!1):this._canvasStore.actionUpdateFailedSegment(e,!0)}doNotRenderRectangles(e){this._canvasStore.setDoNotRenderRectangles(e)}readonlyFromOutsideSet(e){this._canvasStore.actionReadonlyFromOutsideSet(e),this.onReadonlyChange.fire(e)}widgetSelectedOnlySet(e){this._canvasStore.actionWidgetSelectedOnlyFromOutsideSet(e)}get loading(){return this._canvasStore.loading}setCanvasRatio(){this.onCanvasRatioChange.fire()}dispose(){eE(this._modules,e=>e.dispose()),super.dispose()}constructor(e,t,i,r,n,a,o,s,d,c,u,h,g,p=eR,m,f,_,v,S){super(),this._dataSdk=t,this._selection=i,this._prepareSelection=r,this._segmentSelection=n,this._layoutManager=a,this._playerManager=o,this._uploadManager=s,this._ensureManager=d,this._saveManager=c,this._timelineManager=u,this._subjectCropManager=h,this._resourceErrorManager=g,this._containerService=m,this._mainDraftService=f,this._accountService=_,this._teaAdapterService=v,this._onCursorModeChange=new l.Q,this._onZoomChange=new l.Q,this.onCanvasRatioChange=new l.Q,this._canvasStore=new Q.S,this._cursorMode=G.W.Mouse,this._zoom=100,this._editMode=K.G.Video,this._contributions=[],this.cursor={getCursorMode:this._getCursorMode.bind(this),setCursorMode:this._setCursorMode.bind(this),onCursorModeChange:this._onCursorModeChange.event},this.zoom={getZoom:this._getZoom.bind(this),setZoom:this._setZoom.bind(this),onZoomChange:this._onZoomChange.event},this._getEditMode=()=>this._editMode,this._setEditMode=e=>{this._editMode=e,this._canvasStore.actionEditModeSet(e)},this.editMode={setEditMode:this._setEditMode,getEditMode:this._getEditMode},this.setFirstFrameInfo=e=>{this._canvasStore.actionFirstFrameInfoSet(e)},this.setCoverUrl=e=>{this._canvasStore.actionCoverUrlSet(e)},this.onReadonlyChange=new l.Q,this.canvas=e,this._isTemplate=!!p.isTemplate,this.initModules(),this.initCanvasStore(this._accountService,this._ensureManager,S),this.initCanvasView(p,this._layoutManager),this.bindCanvasSpaceRef(this.canvas)}}eU=(0,r.gn)([(0,r.fM)(14,h.t),(0,r.fM)(15,o.n),(0,r.fM)(16,g.Gw),(0,r.fM)(17,p.w),(0,r.fM)(18,u.g),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof HTMLCanvasElement?Object:HTMLCanvasElement,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===a.n?Object:a.n,"undefined"==typeof IPlayerManager?Object:IPlayerManager,"undefined"==typeof IEditorWidgetFileUploadManager?Object:IEditorWidgetFileUploadManager,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof IDraftSaveManager?Object:IDraftSaveManager,"undefined"==typeof ITimelineManager?Object:ITimelineManager,"undefined"==typeof ISubjectCropManager?Object:ISubjectCropManager,void 0===n.X?Object:n.X,"undefined"==typeof ICanvasManagerOptions?Object:ICanvasManagerOptions,void 0===h.t?Object:h.t,void 0===o.n?Object:o.n,void 0===g.Gw?Object:g.Gw,void 0===p.w?Object:p.w,void 0===u.g?Object:u.g])],eU)},378521:function(e,t,i){i.d(t,{C2:()=>k,Hp:()=>D,FL:()=>x,Nc:()=>P});var r=i("953032"),n=i("544633"),a=i("514536"),o=i("29188"),s=i("800793"),l=i("161247"),d=i("572013"),c=i("632555"),u=i("258592"),h=i("348061"),g=i("946765"),p=i("937802"),m=i("362853"),f=i("426336"),_=i("995370"),v=i("348752"),S=i("271368"),y=i("230689"),b=i("517847"),A=i("686439"),M=i("513498");function T(e,t){let{stepRange:i,zoomRange:r,exponent:n}=t,a=Math.max(Math.min((e-r[0])/(r[1]-r[0]),1),0);return i[0]+(i[1]-i[0])*Math.pow(a,n)}let w=e=>{let t=null;return i=>(null!==t&&clearTimeout(t),t=setTimeout(()=>{i(),t=null},e))},C=()=>{let e={x:0,y:0};return{set:(t,i)=>{e.x+=t,e.y+=i},source:()=>0===Math.abs(e.x)||0===Math.abs(e.y)?"mouse":"touchpad",clear:()=>{e.x=0,e.y=0}}};var I=i("218571");function x(e){let{canvasManager:t,store:i,isDragMode:s,canvasBoxRef:u,playerContentRef:h,displaySize:_,useFirstFrame:v,firstFrameSize:S,orientation:b,fixPosition:T}=e,{baseScale:C,baseTranslate:x,canvasAdjusted:k,isCanvasEmpty:D,isFullscreen:P,isPlaying:R,isOperatingCanvas:E,isWaitingEditorReadyToSwitch:U,userScale:B,userTranslate:L,videoPreviewStatus:N}=i,j=(0,p.G)(y.t),F=(0,A.$)(t),[V,O]=(0,I.useState)((0,c.kL)(C,B)),[W,Z]=(0,I.useState)({x:(0,f.yt6)(x.x,L.x),y:(0,f.yt6)(x.y,L.y)}),[z,G]=(0,I.useState)(!1),[K,Q]=(0,I.useState)({x:0,y:0}),[H,Y]=(0,I.useState)([1,1]),J=(0,I.useRef)({x:0,y:0,width:0,height:0}),[X,q]=(0,I.useState)(!1),[$,ee]=(0,I.useState)(!1),et=(0,l.U)(),ei=(0,I.useMemo)(()=>v?S:_,[v,_.join("x"),null==S?void 0:S.join("x")]),er=(0,n.default)((e,t)=>{let i={x:(0,f.yt6)(e.x,t.x),y:(0,f.yt6)(e.y,t.y)};Z(e=>e.x!==i.x||e.y!==i.y?i:e)}),en=(0,I.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.current,{x:t,y:r,width:n,height:a}=e.getBoundingClientRect();J.current={x:t,y:r,width:n,height:a};let o=b===M.i5.Portrait?M.Q$:M.h_,s=n-2*o[1],l=a-2*o[0];if(s<0||l<0)return;let c=(0,d.Ce)([ei[0],ei[1]],[s,l])[0]/ei[0];!$&&setTimeout(()=>ee(!0),0);let u={x:t+(n-M.uJ)/2,y:r+(a-M.V)/2};i.actionBaseScaleSet(c),i.actionBaseTranslateSet(u),er(u,L)},[ei,k,P,b,$,ee,L,er]);(0,I.useEffect)(()=>{let e=h.current,t=new ResizeObserver(()=>{if(!k&&!P&&!T)en(e)});return t.observe(e),()=>t.unobserve(e)},[B,N,en,T]),(0,I.useEffect)(()=>{et&&en()},[et]),(0,I.useEffect)(()=>{if(!!h.current)!U&&setTimeout(()=>{h.current&&en(h.current)})},[N,U]),(0,I.useEffect)(()=>{E&&R&&(t.modules.playerController.pause(),q(!0)),!E&&X&&(t.modules.playerController.play(),q(!1))},[q,R,E,X]);let ea=(0,I.useCallback)(e=>{if(D)return;let t=e/100;t=Math.min(t=Math.max(t,M.ii["0"]),M.ii["1"]),i.actionUserScaleSet(t,!0)},[D]),eo=(0,I.useCallback)(e=>({x:L.x+(e.clientX-K.x),y:L.y+(e.clientY-K.y)}),[K,L]),es=(0,I.useCallback)(()=>D||P,[D,P]),el=(0,I.useCallback)(e=>{if(D)return;let t=_[0]*V,r=_[1]*V,n=t/2-M.N6,a=r/2-M.N6,o=e.x+x.x+M.uJ/2,s=e.y+x.y+M.V/2;o=Math.max(J.current.x-n,Math.min(o,J.current.x+J.current.width+n)),s=Math.max(J.current.y-a,Math.min(s,J.current.y+J.current.height+a)),i.actionUserTranslateSet({x:o-x.x-M.uJ/2,y:s-x.y-M.V/2}),i.actionCanvasAdjustedSet(!0)},[D,x,V,_]),{run:ed}=(0,r.default)(e=>{if(!(!s||!z||es()))el(eo(e)),Q({x:e.clientX,y:e.clientY})},30);(0,a.default)("mousedown",e=>{if(!(e.button===m.JK||!s||es()))Q({x:e.clientX,y:e.clientY}),G(!0)},{target:h.current}),(0,a.default)("mousemove",ed),(0,a.default)("mouseup",e=>{if(!(e.button===m.JK||!s||!z||es()))Q({x:0,y:0}),G(!1),(0,g.h)(j,{action_type:g.R.CanvasDrag})}),(0,I.useEffect)(()=>{O((0,c.kL)(C,B))},[C,B]),(0,I.useEffect)(()=>{if(F){let e=[o.fQ.width*V,o.fQ.height*V];F.style.width=`${e[0]}px`,F.style.height=`${e[1]}px`,Y(e)}},[F,V,Y]),(0,I.useEffect)(()=>{$&&er(x,L)},[x,L,$,er]),(0,I.useEffect)(()=>{u.current&&F&&(u.current.style.transform=`translate(${W.x}px, ${W.y}px`)},[F,W]);let ec=(0,I.useRef)(),eu=(0,I.useRef)(null);return(0,I.useEffect)(()=>{let e=new ResizeObserver(()=>{!ec.current&&(ec.current=w(100)),eu.current=ec.current(()=>{let{width:e,height:t}=document.body.getBoundingClientRect();O((0,d.Ce)([o.fQ.width,o.fQ.height],[e,t])[0]/o.fQ.width)})});return P?e.observe(document.body):(e.unobserve(document.body),null!==eu.current&&(clearTimeout(eu.current),eu.current=null),O((0,c.kL)(C,B))),()=>e.unobserve(document.body)},[C,B,P,ec.current,eu.current]),(0,I.useEffect)(()=>{D&&k&&(i.actionCanvasAdjustedSet(!1),i.actionUserScaleSet(1,!1),i.actionUserTranslateSet({x:0,y:0}))},[k,D]),{canvasResizeReady:$,resizeScale:V,userScale:B,userTranslate:L,canvasSize:H,resizeTranslate:W,onUserScaleChange:ea,updateUserTranslate:el}}function k(e){let{store:t,playerContentRef:i,userScale:r,userTranslate:n,updateUserTranslate:o,isTemplate:s}=e,l=(0,p.G)(y.t),{isCanvasEmpty:d,isFullscreen:c,disableInteract:u,cursorMode:h}=t,m=(0,I.useRef)(),f=(0,I.useRef)(),S=(0,I.useCallback)(e=>{let t=M.R4;_.ED&&(t/=.6);let i=T(r,{stepRange:M.zr,exponent:M.X4,zoomRange:M.ii}),{deltaX:a}=e,{deltaY:o}=e;return e.shiftKey&&!e.deltaX&&e.deltaY&&(a=o,o=0),{x:n.x-a/t*i,y:n.y-o/t*i}},[n]);(0,a.default)("wheel",e=>{if(e.preventDefault(),e.stopPropagation(),!((0,v.G3)(e)||(0,v.To)(e))&&!d&&!c&&(!s||h!==b.W.Mouse)&&!u)o(S(e)),!m.current&&(m.current=w(2e3)),!f.current&&(f.current=C()),f.current.set(e.deltaX,e.deltaY),m.current(()=>{var t,i;let r;let n=null===(t=f.current)||void 0===t?void 0:t.source();null===(i=f.current)||void 0===i||i.clear(),r="mouse"===n?e.shiftKey?g.R.ShortkeyAndWheel:g.R.MouseWheel:g.R.Touchpad,(0,g.h)(l,{action_type:r})})},{target:i.current,passive:!1})}function D(e){let{store:t,refEl:i,userScale:r,onUserScaleChange:n}=e,a=(0,p.G)(y.t),{isCanvasEmpty:o,isFullscreen:s}=t,l=(0,I.useRef)(),{isKeyDown:d}=function(e){let[t,i]=(0,I.useState)(!1);return(0,I.useEffect)(()=>{let t=t=>{t.key===e&&i(!0)},r=t=>{t.key===e&&i(!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r)}},[]),{isKeyDown:t}}("Control"),c=(0,I.useCallback)((e,t)=>{if(o||s)return;let i=T(r,{stepRange:M.h7,exponent:M.X4,zoomRange:M.ii}),c=Math.round(100*r-e/M.Zu*i);n(c),!l.current&&(l.current=w(2e3)),l.current(()=>{(0,h.w)(a,{action_type:"touchpad"!==t||d?h.O.MouseWheel:h.O.Touchpad,scale:Math.min(Math.max(Number((c/100).toFixed(2)),M.ii["0"]),M.ii["1"])})})},[o,s,r,n,d]);(0,u.f)(i,c,10)}function P(e){let{store:t,userScale:i,onUserScaleChange:r,playerContentRef:n,updateUserTranslate:a,disableInteract:o}=e,l=(0,p.G)(y.t),{isCanvasEmpty:d,isFullscreen:c}=t,u=(0,I.useCallback)(()=>{n.current&&!d&&!c&&!o&&(r(100),a({x:0,y:0}),t.actionCanvasAdjustedSet(!1))},[d,c,r,a,o,n]),g=(0,I.useCallback)((e,t)=>{if(!d&&!c&&!o)r(e),(0,h.w)(l,{action_type:t,scale:Number((e/100).toFixed(2))})},[d,c,o,r]);return!function(e,t,i){(0,s.bx)({keyBindings:{win:[S.N9.SHIFT+S.VD.F],mac:[S.N9.SHIFT+S.VD.F]},handler:t,when:s.Vw},document.body);let r=(0,I.useCallback)(()=>e(50,h.O.Shortkey50),[e]);(0,s.bx)({keyBindings:{win:[S.N9.SHIFT+S.VD.NUM_0],mac:[S.N9.SHIFT+S.VD.NUM_0]},handler:r,when:s.Vw},document.body);let n=(0,I.useCallback)(()=>e(100,h.O.Shortkey100),[e]);(0,s.bx)({keyBindings:{win:[S.N9.SHIFT+S.VD.NUM_1],mac:[S.N9.SHIFT+S.VD.NUM_1]},handler:n,when:s.Vw},document.body);let a=(0,I.useCallback)(()=>e(200,h.O.Shortkey200),[e]);(0,s.bx)({keyBindings:{win:[S.N9.SHIFT+S.VD.NUM_2],mac:[S.N9.SHIFT+S.VD.NUM_2]},handler:a,when:s.Vw},document.body);let o=(0,I.useCallback)(()=>e(100*i+M.ZU,h.O.ShortkeyZoomin),[e,i]);(0,s.bx)({keyBindings:{win:[S.N9.SHIFT+S.VD.EQUAL],mac:[S.N9.SHIFT+S.VD.EQUAL]},handler:o,when:s.Vw},document.body);let l=(0,I.useCallback)(()=>e(100*i-M.ZU,h.O.ShortkeyZoomout),[e,i]);(0,s.bx)({keyBindings:{win:[S.N9.SHIFT+S.VD.MINUS],mac:[S.N9.SHIFT+S.VD.MINUS]},handler:l,when:s.Vw},document.body)}(g,(0,I.useCallback)(()=>{u(),(0,h.w)(l,{action_type:h.O.ShortkeyFit,scale:Math.min(Math.max(Number("1.00"),M.ii["0"]),M.ii["1"])})},[u]),i),u}},334769:function(e,t,i){i.d(t,{F:function(){return n}});var r=i(218571);let n=e=>(0,r.useMemo)(()=>e.dataSDK,[e.dataSDK])},959593:function(e,t,i){i.d(t,{C:function(){return s},d:function(){return o}});var r=i(772322),n=i(218571);let a=(0,i(141913).fi)(async()=>{let{AiWriterReport:e}=await i.e("9691").then(i.bind(i,371964));return{default:e}}),o=e=>(0,r.jsx)(n.Suspense,{children:(0,r.jsx)(a,{...e})}),s=a.preload},726413:function(e,t,i){i.d(t,{B:function(){return n}});var r,n=((r={}).TextToImage="text_to_image",r.ImageToImage="image_to_image",r.TextToDesign="text_to_draft",r.ImageStyleAvatar="portrait_generator",r.ImageNightEnhance="low_light_image_enhancement",r.ImageStyleConversion="image_style_transfer",r.ImageUpscaler="image_upscaler",r.ImageAiToning="ai_color_correction",r.ImageRestoration="old_photo_restoration",r.AiModel="ai_model_tryon",r.AiBackground="ai_background",r.AutoLayout="auto_layout",r.Batch="batch",r.AiWrite="ai_writer",r.default="",r)},298042:function(e,t,i){i.d(t,{B:function(){return a}});var r=i(218571);class n{executeInteraction(e){this._interactions.push({name:e,timestamp:performance.now()})}destroy(){this._observer.disconnect(),this._interactions=[]}constructor(e){this._interactions=[],this._mutationCallback=()=>{let e=performance.now(),t=`${this._tag}-interaction`;console.table(this._interactions.map(i=>({[t]:i.name,start:i.timestamp,end:e,duration:e-i.timestamp}))),this._interactions=[]},this._tag=e.tag,this._observer=new MutationObserver(this._mutationCallback),this._observer.observe(e.elementToObserve,{attributes:!0,...e.observeOptions})}}function a(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useEffect)(()=>(i.current&&t&&(a.current=new n({tag:e,elementToObserve:i.current})),()=>{var e;null===(e=a.current)||void 0===e||e.destroy(),a.current=null}),[t,e]),{domRef:i,mark:e=>{var i;if(!!t)null===(i=a.current)||void 0===i||i.executeInteraction(e)}}}},98702:function(e,t,i){i.d(t,{p:function(){return r}});let r=(0,i(218571).createContext)(void 0)},646186:function(e,t,i){i.d(t,{F:function(){return a}});var r=i(789786),n=i(260963);class a{actionTextEditingSavedTextSet(e){this.savedText=e}actionEditingTextNameSet(e){this.editingTextName=e}constructor(){this.savedText="",(0,n.ky)(this)}}(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionTextEditingSavedTextSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionEditingTextNameSet",null)},413409:function(e,t,i){i.d(t,{F:function(){return o}});var r=i(995370);let n={ArrowLeft:[{modifiers:[],operation:"MoveCursorLeft"},{modifiers:["shiftKey"],operation:"MoveCursorLeftAndSelect"},{modifiers:{windows:["ctrlKey"],macos:["altKey"]},operation:"MoveCursorToPreviousWordBeginning"},{modifiers:{windows:["ctrlKey","shiftKey"],macos:["altKey","shiftKey"]},operation:"SelectPreviousWord"},{modifiers:{macos:["metaKey"]},operation:"MoveCursorToLineBeginning"},{modifiers:{macos:["metaKey","shiftKey"]},operation:"SelectToLineBeginning"}],ArrowRight:[{modifiers:[],operation:"MoveCursorRight"},{modifiers:["shiftKey"],operation:"MoveCursorRightAndSelect"},{modifiers:{windows:["ctrlKey"],macos:["altKey"]},operation:"MoveCursorToNextWordEnd"},{modifiers:{windows:["ctrlKey","shiftKey"],macos:["altKey","shiftKey"]},operation:"SelectNextWord"},{modifiers:{macos:["metaKey"]},operation:"MoveCursorToLineEnd"},{modifiers:{macos:["metaKey","shiftKey"]},operation:"SelectToLineEnd"}],ArrowUp:[{modifiers:[],operation:"MoveCursorUp"},{modifiers:["shiftKey"],operation:"MoveCursorUpAndSelect"},{modifiers:{macos:["metaKey"]},operation:"MoveCursorToBeginning"},{modifiers:{macos:["metaKey","shiftKey"]},operation:"SelectToBeginning"}],ArrowDown:[{modifiers:[],operation:"MoveCursorDown"},{modifiers:["shiftKey"],operation:"MoveCursorDownAndSelect"},{modifiers:{macos:["metaKey"]},operation:"MoveCursorToEnd"},{modifiers:{macos:["metaKey","shiftKey"]},operation:"SelectToEnd"}],Home:[{modifiers:[],operation:"MoveCursorToLineBeginning"},{modifiers:["ctrlKey"],operation:"MoveCursorToBeginning"},{modifiers:["shiftKey"],operation:"SelectToLineBeginning"},{modifiers:["shiftKey","ctrlKey"],operation:"SelectToBeginning"}],End:[{modifiers:[],operation:"MoveCursorToLineEnd"},{modifiers:["ctrlKey"],operation:"MoveCursorToEnd"},{modifiers:["shiftKey"],operation:"SelectToLineEnd"},{modifiers:["shiftKey","ctrlKey"],operation:"SelectToEnd"}],Backspace:[{modifiers:[],operation:"BackDelete"},{modifiers:{windows:["ctrlKey"],macos:["altKey"]},operation:"DeletePreviousWord"},{modifiers:{macos:["metaKey"]},operation:"DeleteToLineBeginning"}],Delete:[{modifiers:[],operation:"ForwardDelete"},{modifiers:{windows:["ctrlKey"],macos:["altKey"]},operation:"DeleteNextWord"},{modifiers:{macos:["metaKey"]},operation:"DeleteToLineEnd"}],KeyA:[{modifiers:{windows:["ctrlKey"],macos:["metaKey"]},operation:"SelectAll"}],KeyC:[{modifiers:{windows:["ctrlKey"],macos:["metaKey"]},operation:"Copy"}],KeyX:[{modifiers:{windows:["ctrlKey"],macos:["metaKey"]},operation:"Cut"}],KeyZ:[{modifiers:{windows:["ctrlKey"],macos:["metaKey"]},operation:"Undo"},{modifiers:{windows:["ctrlKey","shiftKey"],macos:["metaKey","shiftKey"]},operation:"Redo"}],KeyY:[{modifiers:{windows:["ctrlKey"]},operation:"Redo"}]},a=(e,t)=>{if(!t)return!1;if(!Array.isArray(t))return a(e,r.V5?t.macos:t.windows);let i=["metaKey","ctrlKey","altKey","shiftKey"].filter(t=>e[t]).length;return 0===t.length?0===i:t.length===i&&t.every(t=>e[t])},o=e=>{let t=n[e.code];if(!t)return;let i=t.find(t=>a(e,t.modifiers));return null==i?void 0:i.operation}},840461:function(e,t,i){i.d(t,{K:function(){return r},j:function(){return n}});class r{_removeStyleInternal(){let e=this._latestStyle;if(this._latestStyle="",this._target&&e)try{this._target.classList.remove(e)}catch(e){}}_setStyleInternal(e){if(this._latestStyle!==e){if(this._latestStyle=e,this._target&&e)try{this._target.classList.add(e)}catch(e){}}}setStyle(e){this._latestStyle!==e&&(this._removeStyleInternal(),this._setStyleInternal(e))}removeStyle(){this._removeStyleInternal()}setTarget(e){if(e===this._target)return;let t=this._latestStyle;this._removeStyleInternal(),this._target=e,this._setStyleInternal(t)}dispose(){this._removeStyleInternal(),this._target=null}constructor(){this._latestStyle="",this._target=null}}function n(e){let t=e.filter(Boolean);if(!t.length)return"";let{length:i}=t[0],r=t.length;for(let e=0;e<i;e++){let i=t[0].charAt(e);for(let n=1;n<r;n++)if(e===t[n].length||t[n].charAt(e)!==i)return t[0].slice(0,e)}return t[0]}},456012:function(e,t,i){i.d(t,{K:function(){return S},Q:function(){return p}});var r=i(955171),n=i(330699),a=i(609962),o=i(356515),s=i(574132),l=i(426336),d=i(254336),c=i(460254),u=i(127830),h=i(801497);let g={[u._g.UserPhoto]:c.r.UserPhoto,[u._g.UserVideo]:c.r.UserVideo};function p(e){return g[e]}async function m(e,t,i){try{let r=await t.modules.uploadManager.localFilesUpload([e],{uploadReportParams:{action_type:d.jm.CLICK_ADD,material_source:d.O9.LOCAL,position:d.cg.REPLACE_MEDIA}}),n=await r[0];n.success&&(n.resourceType===u._g.UserVideo||n.resourceType===u._g.UserPhoto)&&(null==i||i(n))}catch(e){console.error("upload fail")}}async function f(e,t,i,r,n){var a;let o=await i.modules.uploadManager.mutableFileUpload({mutableId:t,templateId:r.subDraftTemplateId,draftId:null!==(a=r.subDraftId)&&void 0!==a?a:void 0},e,{uploadReportParams:{action_type:d.jm.CLICK_ADD,material_source:d.O9.LOCAL,position:d.cg.CANVAS}});n&&await n(o)}async function _(e){var t,i,r,d;let{canvasManager:c,event:h,mainEditorWidgetService:p,containerService:m}=e,{segmentSelection:_,mutableReplaceTaskManager:v}=p,{segmentMutable:S}=_;if(!S||!((0,l.OvQ)(S)&&(!(null===(t=v.get(S.id))||void 0===t?void 0:t.token)||v.get(S.id).token.idle)))return;let{target:y}=h;if(!S.id||!(null==y?void 0:null===(i=y.files)||void 0===i?void 0:i.length))return;let b=(0,o.f)(Array.from(y.files));if(0===b.length)return;let[A,...M]=b;h.preventDefault();let T=null;h.stopPropagation();try{c.setLoading(!0),c.modules.workbenchController.openMediaTab(),await f(A,S.id,c,_,async e=>{var t,i,r;T=M.length>0?c.modules.uploadManager.createUploadTask(M,{autoUpload:!1}):null;let a=c.modules.uploadManager.getResourceTypeByFileType(e.getModel().fileType);if(a!==u._g.UserPhoto&&a!==u._g.UserVideo)return;let o=(0,n.D)(e);await o.done();let l=e.getModel();if(!p.checkAvailability([{mutableId:S.id,type:g[a],value:l}]))return;let d=await c.modules.segmentManager.executeReplaceMutableVideoFromUserMaterial(a,l,S,null!==(i=_.subDraftId)&&void 0!==i?i:void 0);(0,s.QU)(m,{optionType:"replace",actionType:"click",materialName:null!==(r=l.filename)&&void 0!==r?r:A.name,storage:l.size,materialId:l.id,isFastImport:null==l?void 0:null===(t=l.uploading)||void 0===t?void 0:t.isSupportFastImport,fileType:l.subType,waitTime:d.performanceDuration,batchCnt:1,status:d.result.ok?"success":"fail"}),await new Promise(t=>e.onDidDone(()=>t(null)))})}catch(e){console.error("replace fail")}finally{T&&(await T).forEach(e=>e.upload()),(null===(d=v.get(S.id))||void 0===d?void 0:null===(r=d.token)||void 0===r?void 0:r.status)===a.a.UPLOADING&&v.get(S.id).token.cancel(),c.setLoading(!1)}}async function v(e){var t;let{canvasManager:i,mainEditorWidgetService:n,event:a,onError:d,containerService:c}=e,p=n.selection.getSelectedSingleSegment(),f=Array.from(null!==(t=a.target.files)&&void 0!==t?t:[]);if(0===(0,o.f)(f,()=>{}).length||!p)return;let _=p.targetTimerange.duration;try{if(await (0,o.e)(f[0])<l.pMA.div(_,1e3,"number")){null==d||d(h.ZP.t("web_textvideo_toast_cant_replace",{},"Can\u2019t replace. Media needs to be no shorter than the original material."));return}}catch{}let v=new Date().getTime();n.timelineManager.segmentManager.setTimelineSegmentLoading(p.id,!0,v),await m(f[0],i,async e=>{if(e.resourceType===u._g.UserVideo){var t,a;if((0,r.Z)(g[e.resourceType],e.resource.value)>(null!==(a=null===(t=p.sourceTimerange)||void 0===t?void 0:t.duration)&&void 0!==a?a:0n)){await n.modalManager.showMultiTrackTrimModal(p.id,e.resourceKey,e.resourceType);return}}let o=await i.modules.segmentManager.executeReplaceSegmentFromUserMaterial(e.resourceType,e.resource.value,p),{filename:l,size:d,id:h,subType:m,uploading:f}=e.model;(0,s.QU)(c,{optionType:"replace",actionType:"click",materialName:null!=l?l:e.file.name,storage:d,materialId:h,isFastImport:null==f?void 0:f.isSupportFastImport,fileType:m,waitTime:o.performanceDuration,batchCnt:1,status:o.result.ok?"success":"fail"})}),n.timelineManager.segmentManager.setTimelineSegmentLoading(p.id,!1,v)}function S(e){let{isReplaceMutable:t}=e;return t?_(e):v(e)}},188817:function(e,t,i){i.d(t,{Z:()=>l});var r=i("772322"),n=i("827322"),a=i("670933");let o="ai-watermark-z0QTOn";var s=i("218571");let l=(0,a.f3)("store","canvasManager")((0,a.Pi)(e=>{var t;let{store:i}=e,{enable:a=!1,url:l,width:d=0,height:c=0,position:{x:u,y:h}={x:0,y:0}}=null!==(t=null==i?void 0:i.aiWatermarkConfig)&&void 0!==t?t:{},{userScale:g=1}=null!=i?i:{},p=(0,s.useMemo)(()=>`translate(${u*g}px, ${h*g}px) scale(${g}, ${g})`,[g,u,h]);return(0,r.jsx)("img",{crossOrigin:"anonymous",className:o,src:(0,n.C)(l,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),style:{opacity:a?1:0,width:d,height:c,transform:p,transformOrigin:"top left"}})}))},396858:function(e,t,i){i.d(t,{Z:function(){return x}});var r=i(772322);i(837510);var n=i(948747),a=i(156160),o=i(374904),s=i(230689),l=i(426020),d=i(127830),c=i(150564),u=i(105789),h=i.n(u),g=i(650248),p=i(670933),m=i(218571),f=i(284749),_=i(755922),v=i(150818),S=i(447938),y=i(890392),b=i(937802),A=i(254336),M=i(574132),T=i(695324),w=i(801497),C=i(215915);let I=(0,m.forwardRef)((e,t)=>{let{store:u,canvasManager:p,isDragging:I,playerContentRef:x,display:k,isNew:D,ratio:P}=e,{loading:R,hasLogin:E,readonly:U}=u,B=(0,b.G)(s.t),{isUploading:L,uploadFromLocal:N,uploadFromThirdParty:j,thirdpartyUploadSuccessEvent:F}=(0,f.V)(p),V=(0,_.r)(p);(0,m.useEffect)(()=>{D&&setTimeout(()=>{var e;null===(e=document.getElementById("ssr-root"))||void 0===e||e.remove()},0)},[D]);let[O,W]=(0,m.useState)({width:0,height:0}),Z=(0,m.useCallback)(e=>{var t;let{model:i,status:r,waitTime:n}=e,a={actionType:"click",addFrom:"canvas",batchCnt:1,optionType:"add",status:r,materialName:i.filename,storage:i.size,materialId:i.id,isFastImport:null==i?void 0:null===(t=i.uploading)||void 0===t?void 0:t.isSupportFastImport,fileType:i.subType,waitTime:n};i.fileType===l.YB.Video||i.fileType===l.YB.Image?(0,M.QU)(B,{resolution:i.height&&i.width?`${i.height} * ${i.width}`:void 0,...a}):(0,M.QU)(B,{...a})},[B]),z=(0,m.useCallback)(async e=>{if(!!await (0,C.F)(e)){p.modules.workbenchController.openMediaTab(),u.actionLoadingSet(!0);try{let t=await N(e,{uploadReportParams:{action_type:A.jm.CLICK_ADD,material_source:A.O9.LOCAL,position:A.cg.CANVAS}}),i=(await Promise.all(t.map(e=>e.catch(()=>null)))).filter(e=>null!==e);if(i.length>1)return;let r=i[0];if(r.resourceType===d._g.UserVideo||r.resourceType===d._g.UserPhoto||r.resourceType===d._g.UserAudio){(0,T.b)(B,{relatedEvent:T.Z.AddMaterialToTrack,actionType:"click",optionType:"add"});let e=await p.modules.segmentManager.executeAddSegmentUserMaterial(r.resourceType,r.resource.value);e&&Z({model:r.resource.value,status:(null==e?void 0:e.result.ok)?"success":"fail",waitTime:null==e?void 0:e.performanceDuration})}}catch(e){console.error("upload fail")}finally{u.actionLoadingSet(!1)}}},[p.modules.segmentManager,p.modules.workbenchController,Z,u,N]);(0,m.useEffect)(()=>{let e=F(async e=>{if(e.resourceType===d._g.UserVideo||e.resourceType===d._g.UserPhoto||e.resourceType===d._g.UserAudio){(0,T.b)(B,{relatedEvent:T.Z.AddMaterialToTrack,actionType:"click",optionType:"add"});let t=await p.modules.segmentManager.executeAddSegmentUserMaterial(e.resourceType,e.resource.value);Z({model:e.resource.value,status:(null==t?void 0:t.result.ok)?"success":"fail",waitTime:null==t?void 0:t.performanceDuration})}});return()=>{e.dispose()}},[p.modules.segmentManager,Z,F]);let G=(0,m.useCallback)(e=>{j(e)},[j]);return(0,m.useEffect)(()=>{let e=x.current,t=new ResizeObserver((0,g.Z)(()=>{let{width:t,height:i}=e.getBoundingClientRect();W({width:t,height:i})},100));return t.observe(e),()=>t.unobserve(e)},[]),(0,r.jsxs)("div",{className:v.Z.canvasEmpty,style:{width:O.width,height:O.height},children:[L&&!U&&(0,r.jsx)("div",{className:h()(v.Z.dropzone,{[v.Z.dashed]:"original"!==P.event},v.Z.fileCover),style:{width:`${k.width}px`,height:`${k.height}px`},children:(0,r.jsx)("div",{className:h()(v.Z.fileCoverImage),style:{backgroundImage:`url(${i(958835)})`},children:(0,r.jsx)(n.Z,{webp:!0,size:20,className:h()(v.Z.fileCoverSpin),spinColor:"white"})})}),!L&&!U&&(0,r.jsx)("div",{ref:t,className:h()(v.Z.dropzone,{[v.Z.active]:I},{[v.Z.dashed]:"original"!==P.event}),style:{width:`${k.width}px`,height:`${k.height}px`},children:(0,r.jsx)(a.ZP,{multiple:!1,isLoading:R,onImport:z,reportClickImport:()=>{(0,T.b)(B,{relatedEvent:T.Z.ClickImport}),(0,y.rf)(B,{click_type:y.ps.LOCAL,position:y.Af.CANVAS})},accept:o.NF.allAccept,isDragging:I,isDropboxEnable:!0,icon:(0,r.jsx)(c.KW$,{}),styleType:"canvas",uploadTriggerArea:"uploadIcon",children:(0,r.jsx)(S.Z,{onImportThirdFile:G,hasLogin:E,thirdpartyLogin:V,accept:o.NF.allAccept,disabled:R})})}),U&&(0,r.jsxs)("div",{className:v.Z.readonlyEmpty,children:[(0,r.jsx)(c.bxq,{width:120,height:120}),(0,r.jsx)("div",{className:v.Z.readonlyEmptyText,children:w.ZP.t("web_collaborate_share_empty",{},"No media in this project")})]})]})}),x=(0,p.f3)("store","canvasManager")((0,p.Pi)(I))},35389:function(e,t,i){i.d(t,{Z:()=>x});var r=i("772322"),n=i("150564"),a=i("105789"),o=i.n(a),s=i("670933"),l=i("218571"),d=i("110565"),c=i("695324"),u=i("769273"),h=i("937802"),g=i("230689"),p=i("425427");let m=(0,s.f3)("store","canvasManager")((0,s.Pi)(e=>{let{store:t,canvasManager:i,disabled:a,size:s,isStopPropagation:m}=e,{isPlaying:f}=t,_=(0,h.G)(g.t),v=(0,h.G)(p.rO),S=(0,p.JY)(v),y=(0,l.useCallback)(e=>{if(!a)m&&e.stopPropagation(),f?(i.modules.playerController.pause(),(0,c.b)(_,{relatedEvent:c.Z.EditPlayerPause,actionType:"click",module:"player"}),(0,u.s)(_,{action_type:"click",current_page:S?"template_editor":"editor"})):i.modules.playerController.play()},[a,m,f,S]),b=(0,l.useCallback)(e=>e.stopPropagation(),[]),A=(0,l.useCallback)(e=>e.stopPropagation(),[]);return(0,r.jsx)("div",{tabIndex:-1,className:o()(d.Z.playerPlayBtn,{[d.Z.disabled]:a}),onClick:y,onMouseDownCapture:b,onMouseUpCapture:A,children:f?(0,r.jsx)(n.Sby,{size:null!=s?s:16}):(0,r.jsx)(n.eSO,{size:null!=s?s:16})})}));var f=i("953032"),_=i("544633"),v=i("857670"),S=i("446352"),y=i("17018"),b=i("168370"),A=i("426336"),M=i("974954");let T=(e,t,i)=>{let{playerController:r}=e.modules,{videoPreviewStatus:n}=t;if(n===S.bC.None||n===S.bC.INIT)return;r.pause();let a=Math.ceil((0,v.KL)(Number(i)));r.seek(A.pMA.times(a,1000n,"bigint"))},w=(0,s.f3)("store","canvasManager")((0,s.Pi)(e=>{let{store:t,videoPreviewProgress:i,videoPreviewDuration:n,videoPreviewStatus:a,canvasManager:o}=e,{percent:s,duration:d}=t,{playerController:c}=o.modules,[u,h]=(0,l.useState)(),g=(0,l.useRef)(null),p=(0,l.useRef)(),m=(0,_.default)(()=>[S.bC.INIT,S.bC.OnDisplay,S.bC.Playing].includes(a)),v=(0,_.default)((e,t)=>{c.seek((0,y.e)(d,e).integer,t)}),w=(0,_.default)((e,i)=>{T(o,t,(0,y.e)(n,e).integer)}),C=(0,l.useMemo)(()=>m()?w:v,[v,w,m]),I=(0,_.default)(e=>{if(e.preventDefault(),!g.current)return;let t=e.offsetX/g.current.clientWidth;C(t),p.current=e.offsetX,h(100*t)}),{run:x}=(0,f.default)(e=>{let{x:t}=e;if(!g.current||void 0===p.current)return;let i=(p.current+t)/g.current.clientWidth;C(i=Math.min(Math.max(i,0),1),A.Hqf.onGoing),h(100*i)},16),k=(0,_.default)(()=>{p.current=void 0,h(e=>{void 0!==e&&C(e/100)})});(0,b.c)({refs:[g],onStart:I,onDrag:x,onEnd:k});let D=(0,l.useMemo)(()=>m()?u?`${u}%`:n?`${100*A.pMA.div(i,n,"number")}%`:0:`${null!=u?u:s}%`,[s,u,m,n,i]);return(0,r.jsx)("div",{ref:g,className:M.Z.playerProgressSlider,children:(0,r.jsx)("span",{className:M.Z.playerProgressSliderBar,style:{width:D}})})}));var C=i("629243"),I=i("499951");let x=(0,s.f3)("store","canvasManager")((0,s.Pi)(e=>{let{store:t,disabled:i,cancelFullscreen:a}=e,{videoPreviewStatus:o,videoPreviewProgress:s,videoPreviewDuration:l}=t;return(0,r.jsxs)("div",{className:I.Z.fullscreenControls,children:[(0,r.jsx)("div",{className:I.Z.progress,children:(0,r.jsx)(w,{videoPreviewStatus:o,videoPreviewProgress:s,videoPreviewDuration:l})}),(0,r.jsxs)("div",{className:I.Z.controlArea,children:[(0,r.jsxs)("span",{className:I.Z.leftPart,children:[(0,r.jsx)("span",{className:I.Z.btnPlay,children:(0,r.jsx)(m,{disabled:i,size:20})}),(0,r.jsx)(C.Z,{})]}),(0,r.jsx)("span",{className:I.Z.rightPart,onClick:a,children:(0,r.jsx)(n.i9T,{size:20})})]})]})}))},346794:function(e,t,i){i.d(t,{X:function(){return g}});var r=i(218571),n=i(850649),a=i(800793),o=i(695324),s=i(769273),l=i(325805),d=i(425427),c=i(937802),u=i(271368),h=i(230689);function g(e,t){let i=(0,c.G)(h.t),g=(0,c.G)(d.rO),p=(0,d.JY)(g),m=(0,r.useCallback)(()=>{t?(e.modules.playerController.pause(),(0,o.b)(i,{relatedEvent:o.Z.EditPlayerPause,module:"player"}),(0,s.s)(i,{action_type:"shortkey",current_page:p?"template_editor":"editor"})):e.modules.playerController.play()},[t,p]);(0,a.bx)({keyBindings:{win:[u.VD.SPACE],mac:[u.VD.SPACE]},handler:m,when:a.Vw},document.body);let f=(0,r.useCallback)(()=>{e.modules.playerController.requestFullscreen("shortkey"),(0,l.JP)(i,{action_type:l.Gt.SHORTKEY,function_name:l.BS.FULL_SCREEN_EDIT})},[i,e.modules.playerController]);(0,a.bx)({keyBindings:n.Yq[n.Fu.FULLSCREEN].keyBindings,handler:f,when:a.Vw},document.body)}},549603:function(e,t,i){i.d(t,{Z:function(){return u}});var r=i(772322);i(837510);var n=i(948747),a=i(41603),o=i(105789),s=i.n(o),l=i(670933),d=i(218571),c=i(278915);let u=(0,l.f3)("store")((0,l.Pi)(e=>{let{store:t,shouldShowVideoPreviewLoading:i,shouldShowPlayerLoading:o}=e,{hasRendered:l,loading:u,isCanvasEmpty:h,isFullscreen:g,isProgressivelyLoading:p,isStreamLoading:m,previewInfo:f}=t,_=(u||i||o&&(!l||m||p))&&!h,[v,S]=(0,d.useState)(_),y=(0,d.useRef)(null);return(0,d.useEffect)(()=>(y.current&&clearTimeout(y.current),_!==v&&(y.current=setTimeout(()=>S(_),200)),()=>{y.current&&clearTimeout(y.current)}),[_,v]),_||v?(0,r.jsx)("div",{className:s()(c.Z.previewLoading,c.Z.previewLoadingMark),style:{opacity:_?1:0},children:(0,r.jsx)(n.Z,{spinColor:(0,a.G)()?"gray":"white",webp:!0,className:c.Z.loadingSpinner,style:{opacity:g?0:1}})}):null}))},601507:function(e,t,i){i.d(t,{L:function(){return o},R:function(){return a}});var r=i(460254),n=i(820193);let a=e=>{var t;return e.type===r.r.Video||e.type===r.r.Photo?e.dragSource.coverUrl:null===(t=e.dragSource.cover)||void 0===t?void 0:t.url},o=async(e,t,i)=>{let r=(0,n.nQ)(t,i.type,i.dragSource),a=e.ensureCoverUrl(r);return await a.waitForResourceValueReady()}},375216:function(e,t,i){i.d(t,{Z:()=>o});var r=i("772322"),n=i("218571");let a=(e,t)=>{if(void 0===e.x||void 0===e.y||void 0===t.x||void 0===t.y)return 0;let i=t.x-e.x;return 180*Math.atan2(t.y-e.y,i)/Math.PI},o=e=>{let{startPoint:t,endPoint:i}=e,o=(0,n.useMemo)(()=>void 0===t.x||void 0===t.y||void 0===i.x||void 0===i.y?0:Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),[t,i]);return(0,r.jsx)("div",{className:"tracking-pure-line",style:{left:t.x,top:t.y,width:o,transform:`rotate(${a(t,i)}deg)`}})}},355077:function(e,t,i){i.d(t,{Z:()=>c});var r=i("772322"),n=i("105789"),a=i.n(n),o=i("218571");let s="segment-sub-widget-BGnFRl",l="active-c6AtY8",d="selected-aDUB9D",c=(0,o.memo)((0,o.forwardRef)((e,t)=>{let{subWidgetStyle:i,active:n,selected:o,subRect:c,scale:u}=e;return n?(0,r.jsx)("div",{className:a()(s,{[l]:n,[d]:o}),ref:t,style:{width:`${c.width*u}px`,height:`${c.height*u}px`,transform:`translate(${c.x*u}px, ${c.y*u}px) rotate(${c.rotate}deg)`,...c.styles,...i}}):null}))},690863:function(e,t,i){i.d(t,{Z:function(){return s}});var r=i(772322),n=i(218571),a=i(696847),o=i(670933);let s=(0,o.f3)("store","canvasManager")((0,o.Pi)(e=>{let{rect:t,dataSet:i,scale:o,canvasManager:s,store:l}=e,{fixedRectangle:d,selectedSingleSegmentId:c}=l,u=(0,n.useMemo)(()=>{if(c){var e;return null!==(e=s.dataSDK.draftView.getSegmentById(c))&&void 0!==e?e:null}return null},[c]);return u&&(null==d?void 0:d.length)&&t.id===c?(0,r.jsx)(a.Z,{segment:u,rect:t,scale:o,dataSet:i,fixedRectangle:d}):null}))},40069:function(e,t,i){i.d(t,{X:function(){return o}});var r=i(697667),n=i(836946),a=i(218571);function o(e){let{canvasCoverRef:t,widgetRef:i,displaySize:o,widgetMenuContainerRef:s,getRectangle:l,onRotateButtonPositionChange:d}=e,[c,u]=(0,a.useState)("normal");return{rotateButtonPosition:c,updateRotateButtonPosition:(0,a.useCallback)(()=>{var e,a,c;let h=null==t?void 0:null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect(),g=null===(a=i.current)||void 0===a?void 0:a.getBoundingClientRect();if(!h||!g||!s.current)return;let p=l(),m=h.width/o[0],f=h.height/o[1],_={x:p.x*m+h.x,y:p.y*f+h.y,width:p.width*m,height:p.height*f,rotate:p.rotate},v={x:_.x+_.width/2,y:_.y+_.height/2},S={x:_.x+_.width/2,y:_.y+_.height+26},y=_.rotate*Math.PI/180,b=Math.sin(y),A=Math.cos(y),M={x:(S.x-v.x)*A-(S.y-v.y)*b+v.x,y:(S.x-v.x)*b+(S.y-v.y)*A+v.y},T={x:M.x-12,y:M.y-12,width:24,height:24},w=(0,n.uu)(T,null===(c=s.current)||void 0===c?void 0:c.getBoundingClientRect()),C=w.width&&w.height?r.Ow.symmetric:r.Ow.normal;u(C),null==d||d(C)},[s.current])}}},522600:function(e,t,i){i.d(t,{Z:function(){return h}});var r=i(772322),n=i(768261),a=i(111061),o=i(426336),s=i(105789),l=i.n(s),d=i(218571),c=i(670933),u=i(850375);let h=(0,c.Pi)(e=>{var t;let{displaySize:i,resizeScale:s,isScaling:c,enable:h,store:g}=e,{currentWidgetRectangle:p}=g,m=h&&(null!==(t=null==p?void 0:p.rotate)&&void 0!==t?t:0)%90==0,{left2Left:f,left2Right:_,right2Left:v,right2Right:S,top2Top:y,top2Bottom:b,bottom2Top:A,bottom2Bottom:M,center2Vertical:T,center2Horizontal:w}=(0,d.useMemo)(()=>{var e,t,r,n;return(0,a.ub)(i,{x:null!==(e=null==p?void 0:p.x)&&void 0!==e?e:0,y:null!==(t=null==p?void 0:p.y)&&void 0!==t?t:0,width:null!==(r=null==p?void 0:p.width)&&void 0!==r?r:0,height:null!==(n=null==p?void 0:p.height)&&void 0!==n?n:0})},[i.join("x"),null==p?void 0:p.x,null==p?void 0:p.y,null==p?void 0:p.width,null==p?void 0:p.height]),C=(0,d.useMemo)(()=>o.pMA.div(n.bx,s),[s]);return p&&m?(0,r.jsxs)(r.Fragment,{children:[(f<=C||v<=C)&&(0,r.jsx)("span",{className:l()([u.Z.referenceLine,u.Z.referenceLineLeft])}),(_<=C||S<=C)&&(0,r.jsx)("span",{className:l()([u.Z.referenceLine,u.Z.referenceLineRight])}),(y<=C||A<=C)&&(0,r.jsx)("span",{className:l()([u.Z.referenceLine,u.Z.referenceLineTop])}),(b<=C||M<=C)&&(0,r.jsx)("span",{className:l()([u.Z.referenceLine,u.Z.referenceLineBottom])}),T<=C&&!c&&(0,r.jsx)("span",{className:l()([u.Z.referenceLine,u.Z.referenceLineVerticalCenter])}),w<=C&&!c&&(0,r.jsx)("span",{className:l()([u.Z.referenceLine,u.Z.referenceLineHorizontalCenter])})]}):null})},983418:function(e,t,i){i.d(t,{Z:function(){return h}});var r=i(772322),n=i(218571),a=i(727703),o=i(111061),s=i(426336),l=i(768261),d=i(105789),c=i.n(d),u=i(670933);let h=(0,u.Pi)(e=>{var t;let{rectangles:i,resizeScale:d,displaySize:u,enable:h,store:g}=e,{currentWidgetRectangle:p}=g,m=h&&(null!==(t=null==p?void 0:p.rotate)&&void 0!==t?t:0)%90==0,f=(0,n.useMemo)(()=>{let e={};if(!p)return e;let t=s.pMA.div(l.aR,d),{minDistanceX:r,matchingCoordX:n,minDistanceY:a,matchingCoordY:c}=(0,o.$2)(p,i,u,t,t);if((null==n?void 0:n.adsorbedLinePosition)&&r<=t){let{left:t,top:i,width:r,height:a}=n.adsorbedLinePosition;e.adsorbedLinePositionX={left:(n.draggingMatchingType,s.pMA.times(t,d)),top:s.pMA.times(i,d),width:s.pMA.times(r,d),height:s.pMA.times(a,d),borderStyle:n.lineType}}if((null==c?void 0:c.adsorbedLinePosition)&&a<=t){let{left:t,top:i,width:r,height:n}=c.adsorbedLinePosition;e.adsorbedLinePositionY={top:(c.draggingMatchingType,s.pMA.times(i,d)),left:s.pMA.times(t,d),width:s.pMA.times(r,d),height:s.pMA.times(n,d),borderStyle:c.lineType}}return e},[i,p,d]);return p&&m?(0,r.jsxs)(r.Fragment,{children:[f.adsorbedLinePositionX&&(0,r.jsx)("div",{className:c()([a.Z.referenceSegmentLine,a.Z.referenceSegmentLineHorizontal]),style:f.adsorbedLinePositionX}),f.adsorbedLinePositionY&&(0,r.jsx)("div",{className:c()([a.Z.referenceSegmentLine,a.Z.referenceSegmentLineVertical]),style:f.adsorbedLinePositionY})]}):null})},217221:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(772322);i(966156),i(784923);var n=i(368100),a=i(498417),o=i(801497),s=i(670933),l=i(218571),d=i(645162);let c=(0,s.f3)("store","canvasManager")((0,s.Pi)(e=>{let{canvasManager:t}=e,{playerController:i,resourceErrorManager:s}=t.modules,c=(0,l.useRef)({NEED_REFRESH:!1,ADD:new Set,PLAY:new Set});return(0,l.useEffect)(()=>{let e=i.onStreamFail(e=>{let{assetId:t,httpStatus:l,isBlock:u,isGetMediaInfo:h}=e;if(403===l){if(c.current.NEED_REFRESH)return;c.current.NEED_REFRESH=!0,n.Z.info({title:o.ZP.t("web_network_request_failed_refresh",{},"\u7F51\u7EDC\u8BF7\u6C42\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u9875\u9762"),content:o.ZP.t("web_operations_saved_cloud",{},"\u4E0D\u7528\u62C5\u5FC3\uFF0C\u4F60\u7684\u7F16\u8F91\u64CD\u4F5C\u5DF2\u4FDD\u5B58\u81F3\u4E91\u7AEF"),icon:null,mask:!0,closable:!1,maskClosable:!1,okText:o.ZP.t("re_fresh",{},"\u5237\u65B0"),onOk:()=>location.reload()})}else if(h){if(c.current.ADD.has(t))return;c.current.ADD.add(t),a.Z.warning({content:o.ZP.t("web_video_load_failed",{},"\u89C6\u9891\u52A0\u8F7D\u5931\u8D25"),onClose:()=>c.current.ADD.delete(t)})}else if(u){if(c.current.PLAY.has(t))return;c.current.PLAY.add(t);let e=a.Z.warning({duration:0,content:(0,r.jsxs)("span",{className:d.Z.bufferFailToast,children:[(0,r.jsx)("span",{className:"content",children:o.ZP.t("web_video_load_failed",{},"\u89C6\u9891\u52A0\u8F7D\u5931\u8D25")}),(0,r.jsx)("span",{className:d.Z.action,onClick:()=>e(),children:o.ZP.t("retry_web",{},"\u91CD\u8BD5")})]}),onClose:()=>{c.current.PLAY.delete(t),i.retryStreamAsset(t)}})}else!s.isInvalidAsset(t)&&(a.Z.warning(o.ZP.t("network_unavailable__please_try_again_later",{},"Network error. Try again later.")),s.addErrorAssetId(t))});return()=>{e.dispose()}},[i]),null}))},862340:function(e,t,i){i.d(t,{c:function(){return o}});var r=i(218571),n=i(937802),a=i(610142);let o=(e,t)=>{let i=(0,n.G)(a.L),{playerController:o}=t.modules;(0,r.useEffect)(()=>{if(!(null==e?void 0:e.current))return;let t=i.createDropTarget({dropTarget:e.current,dropArea:"canvas",callbacks:{onDragStart:e=>{o.setEditModeAfterDragged(!0)},onDrop:(e,t)=>{e.preventDefault(),e.stopPropagation(),o.setEditModeAfterDragged(!0)}}});return()=>t.dispose()},[e,o,i])}},779944:function(e,t,i){i.d(t,{k:function(){return n}});var r=i(218571);let n=e=>({subWidgetStyle:(0,r.useMemo)(()=>e?{border:"2px dotted var(--lvv-color-main-default)"}:void 0,[e])})},663811:function(e,t,i){i.d(t,{x:function(){return c}});var r=i(218571),n=i(426336),a=i(697667),o=i(563431),s=i(591010),l=i(97181);let d=e=>{let[t,i]=(0,r.useState)(e.getIsEditing());return(0,r.useEffect)(()=>{let t=e.onDidChangeIsEditing(i);return()=>{t.dispose()}},[e,i]),t},c=e=>{let t=(0,l.H)(e),i=d(t),r=t.getEditingSegmentId(),c=t.getInitialCursorPos();return{isTextEditing:i,editingTextSegmentId:r,initialCursorPos:c,actionSetIsShowAttributeByCanvasClick:t=>{t?e.modules.selectionManager.selectSegments([r],void 0,s.U.DoubleClick):e.modules.selectionManager.reset()},handleWidgetClick:e=>{let{event:i,rect:r,repeat:s,resizeScale:l,isPlaying:d,getWrapperSize:c,reportTextEdit:u}=e;if(r.type!==n.Ocy.SegmentText){t.actionMutableTextSelectionRangeSet(r.id,0,0);return}i.detail>1?(t.actionTextEditingEnterEdit(d,r.id),null==u||u(a.ZK.Select)):s?(t.actionTextEditingEnterEdit(d,r.id,(0,o.$D)({rect:r,point:{x:i.clientX,y:i.clientY},scale:l,getWrapSize:c})),null==u||u(a.ZK.Select)):(t.actionMutableTextSelectionRangeSet(r.id,0,0),t.actionTextEditingExitEdit())}}}},821004:function(e,t,i){i.d(t,{Z:()=>g,n:()=>h});var r=i("772322"),n=i("218571"),a=i("195291"),o=i("722169"),s=i("105789"),l=i.n(s);let d={"rotate-panel":"rotate-panel-byC7i_",rotatePanel:"rotate-panel-byC7i_",preview:"preview-JiRxqG","rotate-cursor_0":"rotate-cursor_0-R_V5sq",rotateCursor0:"rotate-cursor_0-R_V5sq","rotate-cursor_15":"rotate-cursor_15-NJnJCO",rotateCursor15:"rotate-cursor_15-NJnJCO","rotate-cursor_30":"rotate-cursor_30-za6Ekk",rotateCursor30:"rotate-cursor_30-za6Ekk","rotate-cursor_45":"rotate-cursor_45-kfZ0Rt",rotateCursor45:"rotate-cursor_45-kfZ0Rt","rotate-cursor_60":"rotate-cursor_60-OdOtjW",rotateCursor60:"rotate-cursor_60-OdOtjW","rotate-cursor_75":"rotate-cursor_75-JgBazl",rotateCursor75:"rotate-cursor_75-JgBazl","rotate-cursor_90":"rotate-cursor_90-N4iuck",rotateCursor90:"rotate-cursor_90-N4iuck","rotate-cursor_105":"rotate-cursor_105-ejtE5O",rotateCursor105:"rotate-cursor_105-ejtE5O","rotate-cursor_120":"rotate-cursor_120-epUIBb",rotateCursor120:"rotate-cursor_120-epUIBb","rotate-cursor_135":"rotate-cursor_135-UutRJu",rotateCursor135:"rotate-cursor_135-UutRJu","rotate-cursor_150":"rotate-cursor_150-_p57XK",rotateCursor150:"rotate-cursor_150-_p57XK","rotate-cursor_165":"rotate-cursor_165-JUsJxe",rotateCursor165:"rotate-cursor_165-JUsJxe","rotate-cursor_180":"rotate-cursor_180-sNBceW",rotateCursor180:"rotate-cursor_180-sNBceW","rotate-cursor_195":"rotate-cursor_195-_QPT0X",rotateCursor195:"rotate-cursor_195-_QPT0X","rotate-cursor_210":"rotate-cursor_210-HJKXyh",rotateCursor210:"rotate-cursor_210-HJKXyh","rotate-cursor_225":"rotate-cursor_225-KIPNv1",rotateCursor225:"rotate-cursor_225-KIPNv1","rotate-cursor_240":"rotate-cursor_240-ibh5j3",rotateCursor240:"rotate-cursor_240-ibh5j3","rotate-cursor_255":"rotate-cursor_255-UZ8oXz",rotateCursor255:"rotate-cursor_255-UZ8oXz","rotate-cursor_270":"rotate-cursor_270-VjrTav",rotateCursor270:"rotate-cursor_270-VjrTav","rotate-cursor_285":"rotate-cursor_285-NA3fwm",rotateCursor285:"rotate-cursor_285-NA3fwm","rotate-cursor_300":"rotate-cursor_300-aGByDJ",rotateCursor300:"rotate-cursor_300-aGByDJ","rotate-cursor_315":"rotate-cursor_315-E1Yxl8",rotateCursor315:"rotate-cursor_315-E1Yxl8","rotate-cursor_330":"rotate-cursor_330-uSWZJ_",rotateCursor330:"rotate-cursor_330-uSWZJ_","rotate-cursor_345":"rotate-cursor_345-ouKDeX",rotateCursor345:"rotate-cursor_345-ouKDeX"};var c=i("670933"),u=i("840461");function h(e){var t;let i=Math.floor((e+180)/360),r=15*Math.floor((e+180-360*i)/15);return null!==(t=d[`rotate-cursor_${r}`])&&void 0!==t?t:""}let g=(0,c.f3)("store","canvasManager")((0,c.Pi)(e=>{let{store:t,isRotating:i,rotateButtonPositionRef:s}=e,{isRotateWidgetHovered:c,currentWidgetRectangle:g,isDraggingMaterial:p,disableInteract:m,canvasSpaceRef:f}=t,_=null==g?void 0:g.rotate,v=(0,n.useRef)(null),S=(0,n.useRef)(new u.K),y=(0,n.useCallback)(function(e){let{clientX:t,clientY:i}=e;v.current&&(v.current.style.left=`${t+12}px`,v.current.style.top=`${i+12}px`)},[i,v.current]);(0,n.useEffect)(()=>(document.addEventListener("mousemove",y),()=>{document.removeEventListener("mousemove",y)}),[y]);let b=(0,n.useMemo)(()=>c,[i]);(0,n.useLayoutEffect)(()=>{let e=b&&i;if((e||c)&&g){let e=h((g.rotate+("symmetric"===s.current?180:0))%360);S.current.setStyle(e)}else S.current.removeStyle()},[i,c,g,s]);let A=(0,o.isNumber)(_)&&(i||c);return((0,n.useEffect)(()=>{let{current:e}=S;return e.setTarget(f),()=>e.dispose()},[f]),p||m||!A)?null:(0,a.createPortal)((0,r.jsxs)("span",{className:l()("lv-tooltip-content",d.rotatePanel),ref:v,role:"tooltip",children:[`${Math.floor(_)}`,"\xb0"]}),document.body)}))},655868:function(e,t,i){i.d(t,{y:function(){return r}});let r={height:i(217131).ts}},138128:function(e,t,i){i.d(t,{y:()=>o});var r=i("892045"),n=i("996162"),a=i("110645");class o extends r.m{getRecordable(){return this._recordable}_defferCurrentTaskWhenFrameRender(){this._renderManager.onFrameRender(()=>this.defferCurrentTask({timeout:1e3}))}_combineTasks(e){let t=this._queue.findIndex(e=>this._currentTask===e),i=this._queue[t+1];if(!i)return e;let r=this._queue.splice(t+1,this._queue.length-1);return i.timestamps=r.flatMap(e=>e.timestamps).concat(e.timestamps).filter(n.j).sort((e,t)=>Number(e-t)),i}cancel(){this.dispose()}constructor(e,t){super({concurrent:a.SR}),this._recordable=e,this._renderManager=t,this._screenshots=[],this._recordable=e,this._renderManager=t}}},174130:function(e,t,i){i.d(t,{g:function(){return u}});var r=i(722169),n=i(587892),a=i(402655),o=i(426336),s=i(305707),l=i(795375),d=i(979627),c=i(110645);class u extends a.JT{_shouldTriggerScreenshotUpdate(e){return!e.isInBatchMode}_shouldHandleScreenshotChange(e){return!e.isRecovery&&e.actionOperateType!==o.aWQ.History}async _triggerScreenshot(){await this._reduceChangesToScreenshotUpdates(),this._triggerServerScreenshotsUpdate(),await this._triggerSegmentScreenshotUpdate()}async _triggerServerScreenshotsUpdate(){let e=await this._reduceUpdatesToScreenshotTasks();this.onSegmentUpdate.fire((0,r.pickBy)(e,(0,r.negate)(r.isEmpty)))}listen(){this._register(this._dataSdk.onChangeDiff(this._handleDraftChange))}_resetUpdates(e){this._updates.delete(e)}shouldUpdateGenerator(e){if(this._generators.has(e.resourceKey)){var t;let i=this._generators.get(e.resourceKey),r=e.timeRange,{width:n,height:a}=e,{width:o,height:s,timeRange:l}=null!==(t=null==i?void 0:i.getRecordable())&&void 0!==t?t:{};if((null==l?void 0:l.start)===r.start&&(null==l?void 0:l.duration)===r.duration&&o===n&&s===a)return!1}return!0}async makeScreenshots(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!s.gi.is(e)&&!this.capable(e))return this._listenerMutex.unLock();let r=s.gi.from(e);if(!r)return this._listenerMutex.unLock();r.timeRange=new l.tn(o.pMA.plus(r.timeRange.start,100000n,"bigint"),r.timeRange.duration,r.timeRange.unit);let n=t;i&&(n=t.map(e=>new l.tn(o.pMA.plus(e.start,100000n,"bigint"),e.duration,e.unit)));let a=this.onScreenshotChange.fire.bind(this.onScreenshotChange),c=await this._getOrCreateGeneratorInstance(r),u=0n===r.timeRange.start?"floor":void 0;null==c||c.makeScreenshots({timeRanges:n,onProgress:a,mode:u}),console.log(d.U,"[listener] await make screenshots lock"),await this._listenerMutex.lock(),console.log(d.U,"[listener] make screenshots lock released"),await c.execute(),console.log(d.U,"[listener] make screenshots completed"),this._listenerMutex.unLock()}constructor(e,t,i){var a;super(),a=this,this._dataSdk=e,this._renderManager=t,this._listenerMutex=i,this._changes=[],this._updates=new Map,this._generators=new Map,this.onScreenshotChange=new n.Q,this.onSegmentUpdate=new n.Q,this.onSegmentFullUpdate=new n.Q,this._triggerSegmentScreenshotUpdate=(0,r.debounce)(async()=>{if(!this._updates.size){console.log(d.U,"[listener] no updates found");return}for(let[e,t]of this._updates){let{recordable:{resourceKey:i},timeRanges:r}=t;console.log(d.U,`[listener] trigger key: ${i} timeRanges: ${r.map(e=>[e.start,e.end])})}`),await this.makeScreenshots(t.recordable,r,!0),this._resetUpdates(e)}},c.gF,{trailing:!0,leading:!0}),this._handleDraftChange=async function(){for(var e,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];if(!(null===(e=a._renderManager.current)||void 0===e?void 0:e.isAbleRender))return;console.log(d.U,"[listener] draft updated");let n=i.filter(a._shouldHandleScreenshotChange);a._changes.push(...n),i.some(a._shouldTriggerScreenshotUpdate)&&await a._triggerScreenshot()}}}},443763:function(e,t,i){i.d(t,{j:()=>M});var r=i("426336"),n=i("425427"),a=i("174130"),o=i("434316"),s=i("800788"),l=i("382094"),d=i("138128"),c=i("655868"),u=i("979627"),h=i("117206");class g extends d.y{makeScreenshots(e){var t,i;let r=Object.assign(new o._y,{editor:this._renderManager,onProgress:e.onProgress,onComplete:this._next}),n=this._strategy.getTimestamps({unit:l.j.Microsecond,timeRanges:e.timeRanges});(0,s.Y2)(n.length,`[screenshot] empty timestamps of seg: ${this._recordable.resourceKey}`);let[a,d]=this._strategy.getScreenshotSize(c.y),g=null!==(t=e.singleFrameHeight)&&void 0!==t?t:d,p=null!==(i=e.singleFrameWidth)&&void 0!==i?i:a,m=new h.O({recordable:this._recordable,context:r,timestamps:n,singleFrameHeight:g,singleFrameWidth:p}),f=this._combineTasks(m);if(console.log(u.U,`[mutable-poly-generator] combined task timestamps: ${f.timestamps}`),!f)return null;this.enqueue(f,!1)}constructor(e,t,i){super(e,t),this._recordable=e,this._renderManager=t,this._strategy=i}}var p=i("481558"),m=i("440489"),f=i("305707");function _(e,t){return i=>r.pMA.max([i.start,e],"bigint")<r.pMA.min([i.end,t],"bigint")}function v(e,t){return i=>r.pMA.max([i.start,e],"bigint")<r.pMA.min([i.end,t],"bigint")}var S=i("431650"),y=i("795375"),b=i("110645"),A=i("159277");class M extends a.g{get cachedMutablePolyInfo(){return!this._cachedMutablePolyInfo.length&&(this._cachedMutablePolyInfo=this._timelineManager.current.segmentManager.getAllMutablePolyInfo()),this._cachedMutablePolyInfo}get cachedMutableLockedInfo(){return!this._cachedMutableLockedInfo.length&&(this._cachedMutableLockedInfo=this._timelineManager.current.segmentManager.getAllMutableLockedInfo()),this._cachedMutableLockedInfo}get cachedMutableVideos(){if(!this._cachedMutableVideos.length){let e=this._dataSdk.draftView.getDraftId();this._cachedMutableVideos=this._dataSdk.cutSame.getMutableVideos(e)}return this._cachedMutableVideos}get cachedMutableTexts(){if(!this._cachedMutableTexts.length){let e=this._dataSdk.draftView.getDraftId();this._cachedMutableTexts=this._dataSdk.cutSame.getMutableTexts(e)}return this._cachedMutableTexts}get _waitRenderManagerReady(){return(0,p.h)(()=>this._renderManager.current)}get _waitTimelineManagerReady(){return(0,p.h)(()=>this._timelineManager.current)}get _isTemplateEditor(){return(0,n.JY)(this._videoEnvironmentService)}async _getOrCreateGeneratorInstance(e){if(!this.shouldUpdateGenerator(e))return this._generators.get(e.resourceKey);this.onSegmentFullUpdate.fire(e.resourceKey);let t=new m.r({timeRange:e.timeRange,singleFrameHeight:e.height,singleFrameWidth:e.width}),i=new g(e,await this._waitRenderManagerReady,t);return this._register(i),this._generators.set(e.resourceKey,i),i}async _reduceChangesToScreenshotUpdates(){await this._waitTimelineManagerReady;let e=this._changes.map(this._transformOperationToMutablePolySegmentUpdate).map(this._reduceScreenshotUpdates);await Promise.all(e),this._cachedMutablePolyInfo=[],this._cachedMutableLockedInfo=[],this._cachedMutableVideos=[],this._cachedMutableTexts=[],this._changes.length=0}async _reduceUpdatesToScreenshotTasks(){if(!(0,n.JY)(this._videoEnvironmentService))return{renderMutableList:[]};let e=await (0,p.h)(()=>this._timelineManager.current),t=e.segmentManager.getAllMutablePolyInfo(),i=e.segmentManager.getAllMutableLockedInfo();return{renderMutableList:[...t.map(this._formatRenderMutablePolySegmentParams),...i.map(this._formatRenderMutableLockedSegmentParams)].filter(Boolean).map(e=>({...e,timeRange:{...e.timeRange,startTime:e.timeRange.startTime+100,endTime:e.timeRange.endTime+100},_isPoly:!0}))}}capable(e){var t;return(null===(t=f.gi.from(e))||void 0===t?void 0:t.trigger)===A.a.MutablePoly}constructor(e,t,i,a,o){super(a,e,o),this._timelineManager=t,this._videoEnvironmentService=i,this._cachedMutablePolyInfo=[],this._cachedMutableLockedInfo=[],this._cachedMutableVideos=[],this._cachedMutableTexts=[],this._transformOperationToMutablePolySegmentUpdate=async e=>{if(await this._waitTimelineManagerReady,!(0,n.JY)(this._videoEnvironmentService))return[];let t=e[r.u4I.SEGMENT].filter(e=>{let{type:t,item:i}=e;return t===r.C8.UPDATE&&"id"in i||(t===r.C8.DELETE||t===r.C8.ADD)&&(0,r.Ftn)(i.segment)});if(!t.length)return[];let i=[...this.cachedMutableVideos,...this.cachedMutableTexts];return t.flatMap(e=>{if((e.type===r.C8.DELETE||e.type===r.C8.ADD)&&(0,r.Ftn)(e.item.segment)){let{targetTimerange:{start:t,duration:i}}=e.item.segment,n=[...this.cachedMutablePolyInfo.filter(_(t,r.pMA.plus(t,i,"bigint"))),...this.cachedMutableLockedInfo.filter(v(t,r.pMA.plus(t,i,"bigint")))];return n.length?n.map(e=>{let t=f.gi.from(e);return S.$.from(t)}):null}for(let t of i){if("id"in e.item&&t.segmentId!==e.item.id)continue;let{targetStart:i,targetDuration:n}=t,a=[...this.cachedMutablePolyInfo.filter(_(i,r.pMA.plus(i,n,"bigint"))),...this.cachedMutableLockedInfo.filter(v(i,r.pMA.plus(i,n,"bigint")))];if(!!a.length)return a.map(e=>{let t=f.gi.from(e);return S.$.from(t)})}return null}).filter(Boolean)},this._reduceScreenshotUpdates=async e=>{let t=await e;if(!t)return null;t.forEach(e=>{var t,i;let{recordable:r,timeRanges:n}=e,a=null!==(i=null===(t=this._updates.get(r.resourceKey))||void 0===t?void 0:t.timeRanges)&&void 0!==i?i:[];n.push(...a),this._updates.set(r.resourceKey,e),console.log(u.U,"[listener] mutable-poly got updates",e)})},this._formatRenderMutablePolySegmentParams=e=>{var t;let{id:i,start:r,end:n}=e,a=this._updates.get(i);return(null==a?void 0:null===(t=a.timeRanges)||void 0===t?void 0:t.length)?{id:i,interval:b.TZ[l.j.Millisecond],timeRange:{startTime:(0,y.BC)(r),endTime:(0,y.BC)(n)}}:null},this._formatRenderMutableLockedSegmentParams=e=>{var t;let{id:i,start:r,end:n}=e,a=this._updates.get(i);return(null==a?void 0:null===(t=a.timeRanges)||void 0===t?void 0:t.length)?{id:i,interval:b.TZ[l.j.Millisecond],timeRange:{startTime:(0,y.BC)(r),endTime:(0,y.BC)(n)}}:null}}}},994483:function(e,t,i){i.d(t,{h:function(){return s}});var r=i(789786),n=i(402655),a=i(718494),o=i(260963);class s extends n.JT{_setStatus(e){(0,o.z)(()=>this._status=e)}get status(){return this._status}constructor(...e){super(...e),this._status=a.h.Pending}}(0,r.gn)([o.LO,(0,r.w6)("design:type",void 0===a.h?Object:a.h)],s.prototype,"_status",void 0)},305707:function(e,t,i){i.d(t,{gi:function(){return m}});var r=i(722169),n=i(566504),a=i(426336),o=i(795375),s=i(382094),l=i(200462),d=i(159277),c=i(800788);let u=e=>(0,r.isObject)(e)&&"type"in e&&"mutablePoly"===e.type,h=e=>(0,r.isObject)(e)&&"type"in e&&"mutableLocked"===e.type,g=e=>"width"in e&&"height"in e?[e.width,e.height]:[e.material.width,e.material.height],p=e=>u(e)||h(e)?[e.start,e.duration,e.start+e.duration]:"sourceTimerange"in e?[e.sourceTimerange.start,e.sourceTimerange.duration,e.sourceTimerange.start+e.sourceTimerange.duration]:"targetStart"in e?[e.targetStart,e.targetDuration,e.targetStart+e.targetDuration]:void(0,c.bP)(e);class m{static from(e){if(e instanceof m)return e;if(u(e)||h(e)){let[t,i]=g(e),[r,n]=p(e),a=e.duration,l=new o.tn(r,n,s.j.Microsecond);return new m({resourceKey:e.id,mutableId:e.id,segmentId:e.id,width:t,height:i,timeRange:l,sourceDuration:a,sourceDurationUnit:s.j.Millisecond,trigger:d.a.MutablePoly})}if((0,a.OvQ)(e)){let[t,i]=g(e),[r,n]=p(e),a=e.duration,l=new o.tn(r,n,s.j.Microsecond);return new m({resourceKey:e.id,mutableId:e.id,segmentId:e.segmentId,width:t,height:i,timeRange:l,sourceDuration:a,sourceDurationUnit:s.j.Millisecond,trigger:d.a.Mutable})}if((0,n.A8)(e)&&(0,a.hey)(e)){let[t,i]=g(e),[r,n]=p(e),a=e.sourceTimerange.duration,l=new o.tn(r,n,s.j.Microsecond);return new m({resourceKey:e.id,segmentId:e.id,width:t,height:i,timeRange:l,sourceDuration:a,sourceDurationUnit:s.j.Microsecond,trigger:d.a.Combination,subDraft:!0})}return e instanceof l.N&&l.N.isInCompletedBucketThumbnail(e)?new m({resourceKey:e.resourceKey,width:e.width,height:e.height,timeRange:e.timeRange,sourceDuration:e.sourceDuration,sourceDurationUnit:e.sourceDurationUnit,trigger:e.trigger}):null}static is(e){return e instanceof m}markAsSubDraft(e){this.segmentId=e,this.subDraft=!0}constructor(e){this.resourceKey=e.resourceKey,this.segmentId=e.segmentId,this.mutableId=e.mutableId,this.width=e.width,this.height=e.height,this.timeRange=e.timeRange,this.templateId=e.templateId,this.sourceDuration=e.sourceDuration,this.sourceDurationUnit=e.sourceDurationUnit,this.subDraft=e.subDraft,this.trigger=e.trigger}}},440489:function(e,t,i){i.d(t,{r:()=>s}),i("426336");var r,n=i("110645");class a{getTimestamps(e){let{unit:t,timeRanges:i,mode:r}=e;return this.timeRange.getTimeStamps({step:e=>this.step(e,t),unit:t,mode:r,timeRanges:i})}getScreenshotSize(e){let t,i;return"width"in e?({width:t}=e,i=t*this.singleFrameHeight/this.singleFrameWidth):({height:i}=e,t=i*this.singleFrameWidth/this.singleFrameHeight),[t,i]}constructor(e){this.timeRange=e.timeRange,this.singleFrameHeight=e.singleFrameHeight,this.singleFrameWidth=e.singleFrameWidth}}var o=((r={})[r.interval=0]="interval",r[r.totalCount=1]="totalCount",r);class s extends a{constructor(...e){super(...e),this.type=o.interval,this.step=(e,t)=>e+n.Hw[t]}}},382094:function(e,t,i){i.d(t,{j:function(){return n}});var r,n=((r={})[r.Second=0]="Second",r[r.Millisecond=1]="Millisecond",r[r.Microsecond=2]="Microsecond",r)},446352:function(e,t,i){i.d(t,{_3:function(){return o},bC:function(){return a},zT:function(){return s}});var r,n=i(426336);var a=((r={}).INIT="Init",r.None="None",r.OnDisplay="OnDisplay",r.Playing="Playing",r);let o=new Set([n.pNd.TrackTypeText,n.pNd.TrackTypeSticker,n.pNd.TrackTypeVideoEffect,n.pNd.TrackTypeAdjust,n.pNd.TrackTypeFilter,n.pNd.TrackTypeTextToVideoText,n.pNd.TrackTypeVideo,"dragVideoPlaceholder","combination"]),s=new Set([n.pNd.TrackTypeAudio,n.pNd.TrackTypeTextToVideoTextAudio,"dragAudioPlaceholder"])},276711:function(e,t,i){i.d(t,{H:function(){return r}});let r="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNEBCAgICAkICQoKCQ0ODA4NExEQEBETHBQWFBYUHCsbHxsbHxsrJi4lIyUuJkQ1Ly81RE5CPkJOX1VVX3dxd5yc0f/CABEIA7gCFQMBIgACEQEDEQH/xAAvAAEBAQEBAQEAAAAAAAAAAAAAAQQFAwIGAQEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAADhF6yUoAAoFiUACgKAAFIoUAABSVQWJQAAAKBalAAAAUFJQoMQACgWJQAFJSgAAChQAAAKFIFAAABSUCqAAAFJVJQAAqjCUlUlIAAUoAAAoKAAACgqFAAAAUigqgAAAC0igAAAooMSoAAKoAAAUFJQAAKChZYAAAAKCqAAAAKCgAAAolUlAoxFiKAoAAUFJQAAFJVColAAAAoFqUAAABQUAAAFJVJQAFAMYAAAFUlAAAUlUlIKAAACiValAAAAUFJQAAFJQUABQAADGABQKAABSKFIKAAABSUFKAAAAUCgAAUlAoAFJQAFJQAxKCgAAAoKgoAAAFItIqpQAAAUCgAAAoFABSUABSUAAAMdAAAoloKiUAAACgqpQAAAFCgAAAoFJQAKABSUAAABSKMYBSVQWIoAAAKBaAAAAKJVAAABSVSUACiUBSKAAABQUlAowqFIKAAABSValAAAABVJQAAFJQKABSUACgAAABVJQFJQAxqgAAAUlUiqAAAAUCgAAAoKABSKABSUAAAFAoAKAAKDGIAAKCqAAAAWUKAAACgUAAKABSUAAACgolAoAAUAAMYgUKqUAAACgUAAAFBSUACgABQAAAKBSUBSUBSKABSKIoxgUAAAAKUAAAFJVIoAFAABQAAAUFIoFJQAFAAFAAADIAAAClJQAAFJQKABQAAoAAAFJVIoFIoAFAAFAAAAUgMgAChQAAAKCgABQAFJQAAFJQKACgAUlAAoAAAAVSUD6GBQUAAAChRKACgAKSgAAAUFAAoAKSgAKAAACkoFAAH0DEAAAUFJQAKAAFAAAAoFJQFJQAKJQFJQAAAFCgAAAoqjCAUlBQAFAACgAAAoFJQFJQAFAACgAAAUFAAABSVSUKDCtIoAFJQAFJQAAFJQUAFAAU+7o+zAoig9R5AAFBSUAABSVSUAAKDGAUlAAUlAAAAoKACgAUlADT75Nhj89GcffxsPT49MZ5AVSUAABSKFAAAAoKMVAAUlAAAAoFABQAAoAFJQuzEPbxD73c/3PTJ9QigAAAoKAAABQUAAxgKAAACiVQAUAAKABSUAC9Y5nT7X3Jwub+v8D8m+/m0AAAoloAAAFJVJQAKIoxgAAFJVJQFJQAKABSUABoM+/rb0z6CRMPDX9VeX1E5HE/Y/lbfAKUSqSgAAKSqSgAAqgEBjAKSgoAKAApKABQAA++l2k5vWqQ+PsfnP0fFXjn3bf1f5fvSbcG8n5X03Zms/h0MleQABSUCgAUlUlAACAxqCgAoAFJQAKAAD27hyu7qSDEmzl8/yt8+7y/de982zP5/R1ftfH2EPD3PHi/oOauHx9/lcApQKAAFUlAAAAo+X2MNAUAAKAAFAAdI5/Y6ntJ8/Qjy9OAujJVosAdDo/n+4nofCfPNzxXX5Pqva+bWeF89LmtYfn38aAAKCgAAAoloAKMKgAoAFJQAAffx2TdtJkz8xehr/ADvVNvP6ET89fTzaAAa8o/QM+hnl5O5yF8tGzWfH2I4vazrw8u/BaKS0SgAAKSqAAAfQMKiUAFAAAAUne4Ww/T/H2mfz06GBqenxrOp9fH2zk5P6HjrmUooB7dngdNNgQ+cJszc5b3nj7Scrlfpvz1uevtV1DLNgwKJVJQAAKAKDEAUAAAAVSKAP0PR/J/qpHJ7BM+gDwynR8fYcBtxNAAPv4Hd+ud0WcvK7/IXwPu306+TXI4/Y5Zx1lvtfCns8QoAACkoAAUGMAAACqRQAAKTs8f6P17y9Zn4523jqC9bTxe0nxxe7hOcFChR2eNpTq+XqkwbqCYTVyEusvx7+Jo8tQwtec+ACkoAAAFBRiAAUFAAABQUAdbtflv0Unvy+p8Jw/XbtXPoESji+XW5V1KB97zH0fdIPFPbLj8Lfv4pQPnHuxF0ZRu8/CHyoAAAKBSUAMSiWiUAABQUAAA++pyN5+hY9kyMZp5+WW7OlwezHryur5pxtmz1X5+kS/GTEunJVsoAAM2nyMygAAAUFJQAKIoxUAABQUlAAAAoas3qbe1wt8nQy6icF7+V186/bZJQh5c82c/zt0AAAAPg9PCeIAAUSqRQAUACkBjAKCkoAAAFCgA+vmm98fZ2vTldWZ8/r6AxGvBlloKAIV5eZp+csPf48wAAKSgUAFEoCkqkpXyIxqCgAAAUFAAChQ0e2XUNeSnV+eYT18qU8/g95l+DV5+I+vlSUAABSKBQAAoFIoWWgAIIyAAAKBQAAoFAAGzHTcyQ1efgPTzAAAoAAAWUFJQAKACgWpQAAKIIxgAVSUABSWgAAAUFJQAAKAAACiVSKACgAolWpQAAFJSCigwVSUABSVSUAAAChQAAFAAABSUCgAUlAUlUiqAAFJSBQUlKCMQAFAoAAAVSKAABSUAABSUCgAUlABQUoAAUioFBalAAAqMJQoAAAKBQAAAoAAAKBQAUlAAoUoAAAqJQUCqAAAAojFQAAFJaAAACgAAAoFJQAKACgqpQAAFAgoFoAAABQCAMYBSVSUAABSUAACgAoAKJQAValAAAUlIFBalAAAAUFiUAAMShQAAFJQAAFJQKABSUBSVSKoAABSBSValAAAAUlWJQAAAAyAAAUAAACgoAFJQAKCqAAAKgBQKoAAAUAFgAAAoFIqsRYigAABQFAACgUigqgAACgIUBaAAAAUAhQAAFBSUoCgxCAACgUlAAoAKBaAAAKAgoFoAAAAoCFAAAUlBSgABQDEIKBSUABSUBQWpQAAKJSCgWpQAAAKBYlAAAUlAqgABSUgoCsNIKABSUBSVSKoAABSBSValAAAAUlIUAAAFAUlKAFAgoAACsYgUigAoKoAABSAFAqgAABSUColAAAoAUoABSBQAAAoiqxKgAoFoAAAqAFAqgAABSKBYlAAAoAUoAAqBSUAABSUACjEoFoAAAUCCgWgAABSKBYAAAFJQUoAAUCFAAAUlAAoAKMVKAAAUgUFqUAAABQIKAABSUBQKAFAgoAAFIoAFAABQDGKAUgUlUlKAAAFJSCgAABQFJSgAFIFAAAFAAUlAAUlAoijFQFJQKoAAAUlAqJQAAKBSUoABSBSUAABQABQAAKCgAAqsVIKoAAABQKiUAABQUlKAAKAhQAAFJQAKAACgUAAAUArIAAAAoKiKAABSUCqAAKJSFAAABQAFAACiVSUAAFAAUCsYABQWIoAAAUBQKAFJSBQAABQAFJQAAUFAAAUAAUAArGBQCFAAACgUoAAIoFAABQAAUAAFACgAAUAAKABQgr/8QANhAAAgECBAMHAwMDBAMAAAAAAQIDABEEECExEkFRBRMgIjJAYDBQcWGRoVKAgUJikLFwgqD/2gAIAQEAAT8A+BD4GPgY+Bj4GPgY/vlt/Z+fgdvgw/43j/4GsT8DHwNfga/A1+Bj4GPgY+xpGzU0TKL+/H2OP0CiLgjwpEWFybU8RQX3HuR9jgOhGUos5zReJgMpCAh9yPscJs/5ynGxziThX9TlK/E1uQ++A2INCRCN6lcNoMowC63ylfhX9T8B2oTm2q0zFjc/fYopJW4UUk0nZLkeeUD9AL0/ZDgeSUH9CLVLDJE3C6kH78AWIAFyaw3ZbNZpjwj+kb1HFHEoVFAGeIgSeMow/B6GnRo3ZGGoNj7w/YMN2fNNYnyJ1NQYWGAeRdebHfNmVQSxAA5mgQQCMu08PcCZRto3vD76DDTTmyLpzJ2rDdnww2ZvO/U7DwYjtCGK4Xzt+mwqfEzTm7tpyA2rszEcad0x1Xb8ZMoZSpFwRY1iITBKyHbkeo92feRxvIwVFJNYbstRZpjc/wBI2oKFACgADkPBisbPIzIfIAbFRnFK0Uiuu4NRyLIiuuxF8sfhu+i4l9a0IOpruU6U0PNfcH3QBJsKw3Zkj2aXyL051FDHCvDGoAzeRI14nYAZ9p4fUTqP0bII52Wlw7GsDDJDGVbYm4GeJi7uTT0nUZzLZr9fbn3OHwM09jbhT+o1h8HDAPKLt/Ud8yQASTYViO00S6wjiPXlUkskrcTsSa7OxBki4G9SfyMnRXRkYXBFjTwiJyttqiw0kmuy9TUUEcXpGvU+CeISxlee4oixscpxdQentz7eHDyztaNb9TyFYbs2KKzSedv4HgxGOihuo879BU0uJxB85svTlQgHM0I0GwqJzG6sKVgyhhscmiRmDFQSPA2IiVwt9b54yKzd4Njvk4upHt7A+1RGdgqqSTyFYfsvZpz/AOopUVFCqoAHIZyTRxC7H/FTYuSS4Xyr4sFLvGfyPBJNHEPMdelS4p5NB5VywsveR2PqXJ0DqVOxp0KMVO4ycWdh7a1/aYbs2WSzSeRf5NQwRQraNbdTzPgYEqQDY23pwwdg/qvr41JUgjcVFIJEDDKUOUbgNmtpRuTck3zhkMcgb96BBAIyxkV1Eg3G+U41B9sPZRo0jqii5JrC4GKAA24n/q8D4yJWCjza6kZ42HaUfg/QwkvA/CfS3/eeLi4X4xs3/ecWHkk12XqajQRoFBJtkQCCDU0ZjkK8uVSi6fj2w9l2TECZJTy0Gc2Jji0Ju3QVLiJJdzYdBlg5uJeA7rt+MiAwIOxqWMxuVP0MPL3kYv6hocpEEiFTzpYJGcqF1B1qLCImreY+HExd5HceoaiiLgj2w9l2Sw7qReYa+UilkZQSCRuKIIJB3GcbmN1ccqRg6hhscsXDxpxD1L9CCXu5AeWx8UkqRjzH/FRYrjl4SLA7Z4qLge42apBZzmI3PKu6fpXdP0oxuBcj649lgp+4mBPpbQ542HUSD8HOLCO+reVajjWNQq7Z4mLu5NPSdR9DCS8S8B3G34zZlUXYgCpcYTpH+9Ekm5NzlBJ3kYPPY5SxiRCv7VOpBH7HKMAuPC3qP5+sPZ9nYjvYu7Y+ZP5GTKGUqdjQwkpkK20B3qLDRx67t1PhniEsZHPcVa2hHjRyjhhypGDqGGxyxUXGlxuvgw8vdya7HQ549POSOYvkDahMeYrv/wDbXf8A+2jMSLAW+uPZwTNDKrjluOopGV1VlNwRceGXERxbm56Co8WzSjisFOmeMi4W4xsd/wA/QwctiYzz2zxEXdyaek6jJI3kNlFRYRF1bzH+M8YQZbdBaiLEj2g9p2ZiN4WP6rm8iRi7G1S4t20Tyj+c8NL3kdjuuToHQqedOpRip3HjBIIIqGQSIG588po+8jI58qiwfOT9hSqFFgLDOWZYl135CiSxJO5qUWelBYgChClqaIjbUfZUZkYMpsQbioZRLGrjmMsRF3sZA9Q1HghkMcgblzzxkVwJBy3+hhpeB7HZvCzBRcmwqXF8o/3NEkm5NzlMNAaQ8LA0CDk0atTIV+ydnTcPkOxOeLi4X4xs2UcMknpGnU1Fho49d26nMgEEGpozG5Xly8UUEkmw061Fh449d26nwS4pF0XzH+KeR5Ddj4HF1IyVmXY0soO+hyltwH7JAfMRWHl7yPXcaHKRBIhU1Fg1Grm56cqAAFh4cTF3iXHqXwIjObKL1FhFXV9T05eCWdI9zc9BUs7ybmw6eNhZiM1kYc6Zi2/2RDZ1NQS93IDyOh8LyIguxtUuLZtE0HXnWElsxQnQ7fnPExcD3HpagCTYCosGTrJp+lKqoLKLDN5EQXY2qXFO2iaD+fozDzX+0qbqDWEl4l4Duu34znxJjPAq69TTMzG7Ek5ba1DJ3kYPPY5SxiROE1HCkY8o165kgC5NhUuL5R/vTMzG5Nz9KYeUfn7TCfKRUblHDDlSsGUMNjliouNOIbr4MJ3gfQeU7+GXEomg8xqSV5Ddj/j6kzbL7M+2hPmt1GWDlsTGfyM8RF3cmnpOopUZzZRc1FhANZNT0oAAWGckyR7nXpUuIeTTYdB9QyIOdNMeQ9ofbKbMDkCQQRuKikEiBspIlkWzUiKgsotmzqguxsKlxbNogsOvOtSfol0HOjMOQoyuaJJ9sfbxm6DLDS8D2J8p8BIFS4sDRNT1pmZzdiSfGWUbmjMvIE0ZWO2lEk7n3R9vCdCM4cUyAKwuKGJhP+qnxcYHluxqSZ5DqdOnhJA3NGVBRmPIUXY7n3x9vEbP9AyIOdGboKMjnn9iPtxoaRgwuMy6jnRmHIUZXNEk7n76CRsa71+tFmO5+0kHl8DHwMf81VvgY+Bj4GP/AIth/cn/AP/EABQRAQAAAAAAAAAAAAAAAAAAAKD/2gAIAQIBAT8Afx//xAAcEQADAQACAwAAAAAAAAAAAAABEBFAAFAgMJD/2gAIAQMBAT8A+j95d9UQ2VhHdHWNF8j0t2DwLmc+oMZwjwbir6JrnCqprLvRzoJ9I//Z"},565508:function(e,t,i){i.d(t,{_r:function(){return o},do:function(){return l}});var r=i(426336),n=i(915208),a=i(127830);let o=e=>a.is.has(e.type)&&e.md5?r.P4R.ensureRootPath(`${(0,n.gM)()}${e.md5}`):r.P4R.ensureRootPath((0,n.uL)(e)),s=new Set([a._g.TextTemplate,a._g.Font,a._g.TextPreset,a._g.TextMotion,a._g.SubtitleTemplate,a._g.TextGlow]),l=e=>s.has(e.type)?o(e):(0,n.uL)(e)},780910:function(e,t,i){i.d(t,{FH:function(){return c},ln:function(){return g},mj:function(){return u},v:function(){return h}});var r=i(787347),n=i(426020),a=i(127830),o=i(800788);function s(e,t,i,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},{preloadBlockCount:o,useMaskVideo:s}=a;if("getDigitalResourceToken"in n){(0,r.M9)(e,{uniquePath:t,url:n.value.previewVideo.originUrl,fsPath:i},{preloadBlockCount:o});let{maskVideo:a}=n.value;a&&(0,r.M9)(e,{uniquePath:`/${a.key}`,url:a.originUrl,fsPath:i},{preloadBlockCount:o})}else if("getVideoResourceToken"in n){let{decryptKey:a}=s?n.getMaskVideoResolutionInfo():n.getVideoResolutionInfo(),l=s?n.getMaskVideoResourceToken():n.getVideoResourceToken();(0,r.M9)(e,{uniquePath:t,url:l.value.url,fsPath:i,decryptKey:a},{withCredentials:!!a,preloadBlockCount:o})}else if("getAudioResourceToken"in n){let a=n.getAudioResourceDecryptKey();(0,r.M9)(e,{type:"audio",uniquePath:t,url:n.value.originUrl,fsPath:i,decryptKey:a},{withCredentials:!!a,preloadBlockCount:o})}else{let a=!1;"getIfNeedCredential"in n&&(a=n.getIfNeedCredential()),(0,r.M9)(e,{uniquePath:t,url:n.getCoverResourceToken().value.url,type:"image",fsPath:i},{withCredentials:a,preloadBlockCount:o})}}async function l(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{preloadBlockCount:a}=n,o=await i.getVideoStreamInfo();return o.ok&&(0,r.M9)(e,{uniquePath:t,url:o.value.url,decryptKey:o.value.decryptKey},{withCredentials:o.value.withCredentials,preloadBlockCount:a}),o}function d(e,t,i,n,a){var s,l,d;let c,u,h,g;let{preloadBlockCount:p,everCloudToken:m="",shouldDownloadOriginalMaterial:f}=a;if(f&&"getOriginResourceToken"in n){let e=n.getOriginResourceToken().value;({url:c}=e)}else if("getUserVideoResourceToken"in n){let e=n.getUserVideoResourceToken().value;({url:c,decryptKey:u}=e)}else if("getUserPhotoResourceToken"in n){let e=n.getUserPhotoResourceToken().value;({url:c,decryptKey:u}=e),g=(null===(s=n.value.filename)||void 0===s?void 0:s.endsWith(".gif"))?"image_video":"image",h="cbc"}else if("getUserAudioResourceToken"in n){let e=n.getUserAudioResourceToken().value;({url:c,decryptKey:u}=e),g="audio"}else if("getUserFileResourceToken"in n){let e=n.getUserFileResourceToken().value;({url:c,decryptKey:u}=e),(null!==(l=n.value.mime)&&void 0!==l?l:"").indexOf("image")>-1&&(g="image",h="cbc"),(null!==(d=n.value.mime)&&void 0!==d?d:"").indexOf("gif")>-1&&(g="image_video",h="cbc")}else(0,o.ss)("Cannot handle this resource type");(0,r.M9)(e,{url:c,uniquePath:t,decryptKey:u,decryptType:h,type:g,fsPath:i},m?{headers:{"x-everphoto-global-session-token":m},preloadBlockCount:p}:{preloadBlockCount:p})}function c(e,t){if(!1===t)return null;let{type:i}=e.value;if(i===a._g.Video)return{needToken:!1,streamWarmer:void 0,orderedStreamWarmer:l};return null}function u(e,t,i){if(new URL(location.href).searchParams.get("disable_stream")||!1===i)return null;let{type:r}=e.value,o=!0!==t.getAppConfigurationValue("streamEdit.disableImageStream"),l=!0!==t.getAppConfigurationValue("streamEdit.disableAudioStream"),c=!0!==t.getAppConfigurationValue("streamEdit.disableVideoStream");if(!o&&[a._g.UserPhoto,a._g.Photo].includes(r)||!l&&[a._g.UserAudio,a._g.Audio].includes(r)||!c&&[a._g.UserVideo,a._g.Video].includes(r))return null;switch(r){case a._g.Video:case a._g.Photo:case a._g.Audio:case a._g.DigitalHuman:return{needToken:!1,streamWarmer:s,orderedStreamWarmer:void 0};case a._g.UserVideo:case a._g.UserPhoto:case a._g.UserAudio:let{sourceType:u}=e.value;return{needToken:u===n.ov.EverCloud,streamWarmer:d,orderedStreamWarmer:void 0};case a._g.UserFile:let{sourceType:h}=e.value;if(!0===i)return{needToken:h===n.ov.EverCloud,streamWarmer:d,orderedStreamWarmer:void 0};return null;default:return null}}function h(e,t,i,n,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},{preloadBlockCount:s}=o;"image"===e||"image_video"===e||"audio"===e?(0,r.M9)(t,{uniquePath:i,url:a.url,decryptKey:a.key,decryptType:a.aes?"gcm":void 0,type:e,fsPath:n},{preloadBlockCount:s}):(0,r.M9)(t,{uniquePath:i,url:a.url,decryptKey:a.key,fsPath:n},{preloadBlockCount:s})}function g(e,t){var i,r,n;if(new URL(location.href).searchParams.get("disable_stream"))return null;if("preloadMaterial"in e){if((null===(n=e.preloadMaterial)||void 0===n?void 0:n.support_stream)===!1)return null;if(["video","audio"].includes(e.builtIn.type)&&e.preloadMaterial.support_stream)return{type:e.builtIn.type}}if("image/gif"===e.builtIn.mime_type||e.builtIn.name.endsWith(".gif"))return{type:"image_video"};if(null===(i=e.builtIn.mime_type)||void 0===i?void 0:i.startsWith("image/"))return{type:"image"};if(null===(r=e.builtIn.mime_type)||void 0===r?void 0:r.startsWith("audio/"))return{type:"audio"};return null}},890069:function(e,t,i){i.d(t,{O:function(){return P}});var r=i(789786);i(784923);var n=i(498417),a=i(764276),o=i(196769),s=i(995234),l=i(260660),d=i(108692),c=i(475590),u=i(587892),h=i(402655),g=i(690613),p=i(800788),m=i(948328),f=i(254336),_=i(820193),v=i(431357),S=i(783122),y=i(166226),b=i(426020),A=i(230689),M=i(433140),T=i(966697),w=i(200247),C=i(127830),I=i(330699),x=i(829144),k=i(801497),D=i(427683);class P extends h.JT{getUploadMaterialFromLocalMixinManager(){return this._uploadMaterialFromLocalMixinManager}cancelAllUploadTasks(){let e=this._uploadTasks;return e.forEach(e=>{e.canCancelUpload()&&e.cancelUpload()}),e.length}getUploadResult(e){return this._uploadResultCache.get(e)}async mutableFileUpload(e,t,i){var r,a,o,l,d;let{templateId:u,mutableId:h,draftId:p}=e,{uploadReportParams:m}=i;null===(a=this._callbackOptions)||void 0===a||null===(r=a.beforeLocalFileUpload)||void 0===r||r.call(a);let{userGeneratedMaterials:f}=this._draftMaterialsService.getMaterials(),_=new Set(f.map(e=>e.md5)),{draftTemplateManager:v,cloudMetaManager:S}=this._mainDraftService,b=await v.getTemplate(null!=u?u:S.getMeta().draft.templateId);try{let e=await this._getUploadFileTask(t,{...m,video_type_id:(0,y.N)(b.templateType,b.producerAppId)});if(!e.ok)return null===(l=this._callbackOptions)||void 0===l||null===(o=l.afterLocalFileUpload)||void 0===o||o.call(l),await Promise.reject((0,g.wf)(-1,e.msg));if(!h)return e.value;let i=new s.L({mutableId:h,draftId:p,originPath:"",cancelable:!0});i.start(),this._mutableReplaceTaskManager.set(h,i),i.onRetry(()=>{e.value.canRetryUpload()&&(e.value.upload(),i.start())});let r=e=>{i.triggerErrorStatus(e)};e.value.onDidDone(()=>{_.has(e.value.md5)&&n.Z.success(k.ZP.t("you_have_uploaded_this_material_and_it_has_been_transmitted_for_you_in_smart_se",{},"This material was uploaded before"))});let a=(0,c.PQ)(),d=()=>a.resolve(void 0),u=(0,I.D)(e.value,{onSuccess:()=>{var e,t;null===(t=this._callbackOptions)||void 0===t||null===(e=t.afterLocalFileUpload)||void 0===e||e.call(t)},onError:e=>{var t,i;r(e),null===(i=this._callbackOptions)||void 0===i||null===(t=i.afterLocalFileUpload)||void 0===t||t.call(i)},onCancel:()=>{i.cancel(),d()},onDelete:()=>{i.cancel()},onMd5Set:()=>{var t;i.setCancelable(!(null===(t=e.value.getModel().uploading)||void 0===t?void 0:t.isSupportFastImport)),d()}});return u.done().then(()=>d()),i.onCancel(()=>{var e,t;null===(e=(t=this._callbackOptions).afterLocalFileUpload)||void 0===e||e.call(t),u.dispose()}),await a.promise,this._recordResource(e.value),e.value}catch(e){return Promise.reject((0,g.wf)(-1,null!==(d=null==e?void 0:e.msg)&&void 0!==d?d:"mutable file upload failed"))}}async createUploadTask(e,t){var i,r;null===(r=this._callbackOptions)||void 0===r||null===(i=r.beforeLocalFileUpload)||void 0===i||i.call(r);let n=await this._uploadMaterialFromLocalMixinManager.upload({files:e,fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,uploadReportParams:t.uploadReportParams,autoUpload:t.autoUpload}),a=[];return n.forEach(e=>{e.ok&&(a.push(e.value),this._draftMaterialsService.addToUserGenerated(e.value,{addFrom:m.a.Upload}))}),a}async localFilesUpload(e,t){var i,r;null===(r=this._callbackOptions)||void 0===r||null===(i=r.beforeLocalFileUpload)||void 0===i||i.call(r);let{userGeneratedMaterials:a}=this._draftMaterialsService.getMaterials(),o=new Set(a.map(e=>e.md5)),s=await this._uploadMaterialFromLocalMixinManager.upload({files:e,fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,uploadReportParams:t.uploadReportParams,uploadParams:t.uploadParams}),l=s.length;return s.map((i,r)=>{if(!i.ok){if(0==--l){var a,s;null===(a=(s=this._callbackOptions).afterLocalFileUpload)||void 0===a||a.call(s)}return Promise.reject(i.msg)}let d=i.value;return this._uploadTasks.push(d),new Promise((i,a)=>{this._draftMaterialsService.addToUserGenerated(d,{addFrom:m.a.Upload});let s=(0,D.Z)(()=>{if(l--,this._uploadTasks=this._uploadTasks.filter(e=>e!==d),l<=0){var t,n;null===(t=(n=this._callbackOptions).afterLocalFileUpload)||void 0===t||t.call(n)}let a=d.getModel(),o=(0,x.S9)(this._resourceService,a,e[r]);i({success:!0,model:a,...o})}),c=e=>{var t,i,r;l--,this._uploadTasks=this._uploadTasks.filter(e=>e!==d),l<=0&&(null===(t=(i=this._callbackOptions).afterLocalFileUpload)||void 0===t||t.call(i)),a(null!==(r=null==e?void 0:e.msg)&&void 0!==r?r:"upload local file failed")};(0,I.D)(d,{onSuccess:s,onError:c,onCancel:c,onDelete:c,onMd5Set:()=>{var e;(null===(e=d.getModel().uploading)||void 0===e?void 0:e.isSupportFastImport)&&s()}},t.waitForUploadDidDone),d.onDidDone(()=>{o.has(d.md5)&&n.Z.success(k.ZP.t("you_have_uploaded_this_material_and_it_has_been_transmitted_for_you_in_smart_se",{},"This material was uploaded before"))})})})}cancelMutableFileUpload(e){let t=this._mutableIdToTask.get(e);(null==t?void 0:t.ok)&&t.value.cancelUpload()}retryMutableFileUpload(e){let t=this._mutableIdToTask.get(e);(null==t?void 0:t.ok)&&t.value.upload()}get hasThirdpartyLogin(){return this._hasThirdpartyLogin}thirdpartyLogin(e,t){let i=(0,x.SE)(e);if(!i.ok)return;let r={...t,reportParams:{...null==t?void 0:t.reportParams,pageEnterFrom:i.value}};this._accountService.login(r)}async thirdpartyFileUpload(e){var t;(0,p.Y2)(this.hasThirdpartyLogin,"thirdpartyFileUpload should not be called when not logged in");let i=null!==(t=this._mainDraftService.draftWorkspaceManager.workspaceId)&&void 0!==t?t:"",r=await this._uploadFromThirdpartyManager.getOrCreateThirdpartyHelper(i,{pageEnterFrom:e===S.b.GOOGLE_DRIVE?T.d.GoogleDrive:T.d.DropBox},{action_type:f.jm.CLICK_ADD,position:f.cg.CANVAS});(null==r?void 0:r.ok)&&r.value.show(e)}getResourceTypeByFileType(e){switch(e){case b.YB.Image:return C._g.UserPhoto;case b.YB.Video:return C._g.UserVideo;default:throw Error()}}async _getUploadFileTask(e,t){let[i]=await this._uploadMaterialFromLocalMixinManager.upload({files:[e],fromWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,toWorkspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,uploadReportParams:t});if(!i.ok)throw Error(i.msg);let r=i.value;return this._draftMaterialsService.addToUserGenerated(r,{addFrom:m.a.Upload}),i}_recordResource(e){let t=e.getModel(),i=this.getResourceTypeByFileType(t.fileType),{resource:r,key:n}=(0,_.GL)(e.getModel(),i);i===C._g.UserVideo?this._resourceService.add(n,r):i===C._g.UserPhoto&&this._resourceService.add(n,r)}dispose(){this._uploadResultCache.clear(),super.dispose()}constructor(e,t,i,r,n,s,d,c,h,g){super(),this._fastImportAnalyzeManager=e,this._captureImageFrameManager=t,this._mutableReplaceTaskManager=i,this._callbackOptions=r,this._segmentSelection=n,this._containerService=s,this._accountService=d,this._mainDraftService=c,this._resourceService=h,this._draftMaterialsService=g,this._hasThirdpartyLogin=!1,this._onDidChangeThirdpartyLogin=this._register(new u.Q),this.onDidChangeThirdpartyLogin=this._onDidChangeThirdpartyLogin.event,this._mutableIdToTask=new Map,this._linkUploadStartEvent=this._register(new u.Q),this._uploadTasks=[],this.linkUploadStartEvent=this._linkUploadStartEvent.event,this._linkUploadSuccessEvent=this._register(new u.Q),this.linkUploadSuccessEvent=this._linkUploadSuccessEvent.event,this._thirdpartyUploadSuccessEvent=this._register(new u.Q),this.thirdpartyUploadSuccessEvent=this._thirdpartyUploadSuccessEvent.event,this._thirdpartyUploadStartEvent=this._register(new u.Q),this.thirdpartyUploadStartEvent=this._thirdpartyUploadStartEvent.event,this._uploadResultCache=new Map;let p=this._containerService.createInstance(o.o);this._uploadMaterialFromLocalMixinManager=this._containerService.createInstance(a.x,{onCreated:e=>{let t=this._segmentSelection.subDraftId?this._segmentSelection.subDraftTemplateId:void 0,{material:i,fromWorkspaceId:r,uploadReportParams:n}=e;(0,l.J)(s,i,{...n,fromWorkspaceId:r,template_id:t})},fastImportAnalyzeManager:this._fastImportAnalyzeManager,captureImageFrameManager:this._captureImageFrameManager}),this._uploadFromThirdpartyManager=this._containerService.createInstance(v.R,{multiple:!1,currentPage:"",onCreated:e=>{var t,i;null===(t=(i=this._callbackOptions).beforeThirdpartyFileUpload)||void 0===t||t.call(i);let{material:r,fromWorkspaceId:n,uploadReportParams:a}=e;(0,l.J)(s,r,{...a,fromWorkspaceId:n}),this._thirdpartyUploadStartEvent.fire({material:r}),this._draftMaterialsService.addToUserGenerated(e.material,{addFrom:m.a.Upload});let o=(0,I.D)(r,{onSuccess:()=>{let t=e.material.getModel(),i=(0,x.lt)(this._resourceService,t);this._thirdpartyUploadSuccessEvent.fire({success:!0,...i})}});o.done().finally(()=>{var e,t;o.dispose(),null===(e=(t=this._callbackOptions).afterThirdpartyFileUpload)||void 0===e||e.call(t)})},payinPayoutHelper:p}),this._hasThirdpartyLogin=d.hasLogin,this._register(d.onDidLogout(()=>{this._hasThirdpartyLogin=!1,this._onDidChangeThirdpartyLogin.fire(!1)})),this._register(d.onDidLogin(()=>{this._hasThirdpartyLogin=!0,this._onDidChangeThirdpartyLogin.fire(!0)}))}}P=(0,r.gn)([(0,r.fM)(5,A.t),(0,r.fM)(6,w.D),(0,r.fM)(7,d.n),(0,r.fM)(8,M.c),(0,r.fM)(9,m.D),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IMaterialFastImportHelper?Object:IMaterialFastImportHelper,"undefined"==typeof ICaptureImageFrameHelper?Object:ICaptureImageFrameHelper,"undefined"==typeof IMutableReplaceTaskManager?Object:IMutableReplaceTaskManager,"undefined"==typeof IEditorWidgetFileUploadCallbackOptions?Object:IEditorWidgetFileUploadCallbackOptions,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===A.t?Object:A.t,void 0===w.D?Object:w.D,void 0===d.n?Object:d.n,void 0===M.c?Object:M.c,void 0===m.D?Object:m.D])],P)},387381:function(e,t,i){i.d(t,{n:()=>m});var r=i("789786"),n=i("772322"),a=i("218571");let o=e=>{let{topPart:t,bottomPart:i,topRef:r,bottomRef:a}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{ref:r,children:t.render()}),(0,n.jsx)("div",{ref:a,children:i.render()})]})};var s=i("693936"),l=i("587892"),d=i("487421");class c{get topPartDragConfig(){return this._fileDragContributionConfig.get(d.v.topPart)}get bottomPartDragConfig(){return this._fileDragContributionConfig.get(d.v.bottomPart)}registerDragContributionConfig(e,t){this._fileDragContributionConfig.set(e,t)}unRegisterDragContributionConfig(e){this._fileDragContributionConfig.delete(e)}constructor(){this._fileDragContributionConfig=new Map}}var u=i("592040"),h=i("230689"),g=i("389123"),p=i("141913");class m{get onDidLayoutScaleChange(){return this._onDidLayoutScaleChange.event}get onDidLayoutUpdate(){return this._onDidLayoutUpdate.event}get onDidLayoutUnMount(){return this._onDidLayoutUnMount.event}get onResizeStateChange(){return this._onResizeStateChange.event}get resizeBox(){return this._resizeBoxRef.current}get layoutContainer(){return this._layoutContainer}getTopHeight(){var e,t;return null!==(t=null===(e=this._topRef.current)||void 0===e?void 0:e.offsetHeight)&&void 0!==t?t:0}getTopWidth(){var e,t;return null!==(t=null===(e=this._topRef.current)||void 0===e?void 0:e.offsetWidth)&&void 0!==t?t:0}getBottomHeight(){var e,t;return null!==(t=null===(e=this._bottomRef.current)||void 0===e?void 0:e.offsetHeight)&&void 0!==t?t:0}getBottomWidth(){var e,t;return null!==(t=null===(e=this._bottomRef.current)||void 0===e?void 0:e.offsetWidth)&&void 0!==t?t:0}setBottomHeight(e){this._resizeLayoutRef.current&&this._resizeLayoutRef.current.setBottomHeight(e)}setTopPartView(e){var t;this._topPart=e,null===(t=this._forceRerender)||void 0===t||t.call(this)}setBottomPartView(e){var t;this._bottomPart=e,null===(t=this._forceRerender)||void 0===t||t.call(this)}registerDragContribution(e,t){this._contribution.registerDragContributionConfig(e,t)}unRegisterDragContribution(e){this._contribution.unRegisterDragContributionConfig(e)}constructor(e){this.containerService=e,this._onDidLayoutUpdate=new l.Q,this._onDidLayoutUnMount=new l.Q,this._onDidLayoutScaleChange=new l.Q,this._onTopMaskVisibleChange=new l.Q,this._onBottomMaskVisibleChange=new l.Q,this._onResizeStateChange=new l.Q,this._contribution=new c,this._topRef=a.createRef(),this._topMaskRef=a.createRef(),this._bottomRef=a.createRef(),this._bottomMaskRef=a.createRef(),this._resizeBoxRef=a.createRef(),this._layoutContainer=null,this._resizeLayoutRef=a.createRef(),this._topMaskVisible=!1,this._bottomMaskVisible=!1,this._bottomPreHeight=0,this.render=()=>{let[e,t]=(0,a.useState)(0),i=(0,a.useRef)(null);return(this._forceRerender=()=>{t(e=>e+1)},(0,a.useEffect)(()=>(this._layoutContainer=i.current,i.current&&this._onDidLayoutUpdate.fire(i.current),()=>{this._layoutContainer=null,this._onDidLayoutUnMount.fire()}),[this._topPart,this._bottomPart]),this._topPart||this._bottomPart)?this._topPart&&this._bottomPart?this._bottomPart.freeze?(0,n.jsx)("div",{tabIndex:-1,ref:i,className:g.Z.layoutContainer,children:(0,n.jsx)(p.SV,{fallback:(0,n.jsx)("div",{}),children:(0,n.jsx)(s.k,{ref:this._resizeLayoutRef,topMaskRef:this._topMaskRef,bottomMaskRef:this._bottomMaskRef,topRef:this._topRef,bottomRef:this._bottomRef,topPart:this._topPart,bottomPart:this._bottomPart,resizeBoxRef:this._resizeBoxRef,onResizeStart:this._onResizeStart,onResize:this._onResize,onResizeEnd:this._onResizeEnd,contribution:this._contribution})})}):(0,n.jsx)("div",{tabIndex:-1,ref:i,className:g.Z.layoutContainer,children:(0,n.jsx)(p.SV,{fallback:(0,n.jsx)("div",{}),children:(0,n.jsx)(o,{topMaskRef:this._topMaskRef,bottomMaskRef:this._bottomMaskRef,topRef:this._topRef,bottomRef:this._bottomRef,topPart:this._topPart,bottomPart:this._bottomPart,topMaskVisible:this._topMaskVisible,bottomMaskVisible:this._bottomMaskVisible})})}):(0,n.jsx)("div",{tabIndex:-1,ref:i,className:g.Z.layoutContainer,children:(0,n.jsx)(p.SV,{fallback:(0,n.jsx)("div",{}),children:this._topPart?this._topPart.render():this._bottomPart.render()})}):null},this._onResizeStart=()=>{this._onResizeStateChange.fire(!0),this._bottomPreHeight=this.getBottomHeight()},this._onResize=e=>{this._onDidLayoutScaleChange.fire(e)},this._onResizeEnd=()=>{this._onResizeStateChange.fire(!1),(0,u.Wn)(this.containerService,{action_line:u.DK.TIMELINE_PANEL,direction:this.getBottomHeight()>this._bottomPreHeight?u.d.UP:u.d.DOWN})}}}m=(0,r.gn)([(0,r.fM)(0,h.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===h.t?Object:h.t])],m)},557038:function(e,t,i){i.d(t,{b:function(){return a}});var r=i(218571),n=i(515928);let a=e=>{let{onDropAccepted:t,onDropRejected:i}=e,a=(0,r.useRef)(!0);a.current=!0;let{getRootProps:o,getInputProps:s,isDragActive:l}=(0,n.uI)({noClick:!0,noKeyboard:!0,multiple:void 0===e.multiple||e.multiple,accept:e.accept,onDropAccepted:e=>{a.current&&t(e)},onDropRejected:e=>{a.current&&i(e)},onDragEnter:t=>{var i;null===(i=e.onDragEnter)||void 0===i||i.call(e,t.nativeEvent)},onDragOver:t=>{var i;null===(i=e.onDragOver)||void 0===i||i.call(e,t.nativeEvent)},onDragLeave:t=>{var i;null===(i=e.onDragLeave)||void 0===i||i.call(e,t.nativeEvent)}});return{getRootProps:o,getInputProps:s,isDragActive:l&&a.current}}},497134:function(e,t,i){i.d(t,{g:function(){return a}});var r=i(789786),n=i(260963);class a{get isModalVisible(){return this.isLoginMaskVisible||this.isThirdPartyMaskVisible}actionIsLoginMaskVisibleSet(e){this.isLoginMaskVisible=e}actionIsThirdPartyMaskVisibleSet(e){this.isThirdPartyMaskVisible=e}constructor(){this.isLoginMaskVisible=!1,this.isThirdPartyMaskVisible=!1,(0,n.ky)(this)}}(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsLoginMaskVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsThirdPartyMaskVisibleSet",null)},261447:function(e,t,i){i.d(t,{W:function(){return A}});var r=i(789786),n=i(772322);i(966156);var a=i(368100),o=i(260963),s=i(444802),l=i(677855),d=i(896413),c=i(199644),u=i(435359),h=i(804163),g=i(426336),p=i(583697),m=i(237322),f=i(234457),_=i(126729),v=i(230689),S=i(801497),y=i(827664);let b=()=>(0,o.LO)({mode:s.J.Normal,playerId:"",isPlayerLoaded:!1,isPlaying:!1,isRatioSelectOpen:!1,videoDuration:0,materialFormat:"",materialType:"",materialResolution:"",cropResolution:"",shellSize:{width:0,height:0,ratio:0},duration:0,ratio:u.zl.FREE,box:{left:0,top:0,width:0,height:0},isBuffering:!1,sizeRange:{minWidth:40,maxWidth:40,minHeight:40,maxHeight:40},manualState:{currentTime:0,scale:1,angle:0,applyToAllSameRatio:!1},smartState:{currentTime:0,stabilization:l.yi.Normal,trackSpeed:l.sj.Normal,selectedTime:0,isPreview:!1,isDragging:!1,mainSubject:[],selectedSubjects:[],isLoadingSubject:!1,recognizeNotice:{status:"none",message:""},isSmartCropApplying:!1}});class A{init(){let e="false"!==localStorage.getItem("CUTSAME_CROP_APPLY_TO_ALL_SELECTED");this.setApplyToAllSameRatio(e)}setMode(e){var t;if(e===this.observableData.mode)return;if(e===s.J.Smart&&(null===(t=this._pipelineManager.getIntelligentState(this._segment,_.F2.VideoStabilization))||void 0===t?void 0:t.enable)){let e={target_tool:"smart_crop",current_tool:_.FL[_.F2.VideoStabilization]};(0,c.l)(this._containerService,{action:"show",...e}),a.Z.confirm({title:S.ZP.t("web_edit_text_apply_confirm",{string0:S.ZP.t("web_edit_title_smart_crop",{},"Auto reframe"),string1:S.ZP.t("web_video_stable_text_stablize",{},"Stabilize")},"Apply {string0}? Doing so will remove {string1}."),okText:S.ZP.t("web_edit_button_confirm_apply",{},"Apply"),cancelText:S.ZP.t("web_edit_button_cancel",{},"Cancel"),onOk:()=>{(0,c.l)(this._containerService,{action:"confirm",...e});let t={toolType:_.F2.VideoStabilization,param:{},enable:!1};this._pipelineManager.handleSwitchIntelligent({segment:this._segment,params:t})},onCancel:()=>{(0,c.l)(this._containerService,{action:"cancel",...e})},maskClosable:!1});return}this.observableData.mode=e;let{manualState:i,smartState:r}=this.observableData;i.currentTime!==r.currentTime&&(this.observableData.isBuffering=!0),this.observableData.isPlaying=!1,this.observableData.smartState.isLoadingSubject=!1}get isCropModalVisible(){return this._modalStore.isMultiTrackCropModalVisible}get needHideSmartCrop(){return this._smartCropManager.observableData.disableSmartCrop}get needDisableSmartCrop(){var e;return(null===(e=this._segment)||void 0===e?void 0:e.material.type)!==g.cVg.MetaTypeVideo?{disabled:!0,message:S.ZP.t("web_edit_text_only_video",{},"Only available for videos")}:this._isPipelineLoading?{disabled:!0,message:S.ZP.t("web_edit_text_smart_ratio_failure_same",{},"Can\u2019t apply auto reframe. Video is being processed.")}:{disabled:!1,message:""}}setIsBuffering(e){this.observableData.isBuffering=e}get currentTime(){return this.observableData.mode===s.J.Normal?this.observableData.manualState.currentTime:this.observableData.smartState.currentTime}setSmartCropperPreview(e){this.observableData.smartState.isPreview=e}setSmartCropperDragCursor(e){this.observableData.smartState.isDragging=e}setSmartCropperSelectedTime(e){this.observableData.smartState.selectedTime=Math.floor(e)}setCropVideoDuration(e){this.observableData.videoDuration=e}setCropIsPlaying(e){this.observableData.isPlaying=e}setCropCurrentTime(e){if(!this.observableData.smartState.isLoadingSubject)this.observableData.mode===s.J.Normal?this.observableData.manualState.currentTime=e:this.observableData.mode===s.J.Smart&&(this.observableData.smartState.currentTime=e)}setAngle(e){this.observableData.manualState.angle=e}setRatio(e){this.observableData.ratio=e}setScale(e){this.observableData.manualState.scale=e}setApplyToAllSameRatio(e){this.observableData.manualState.applyToAllSameRatio=e}setBox(e){this.observableData.box=e,this.observableData.cropResolution=(0,p.n3)(e.width,e.height)}setStabilization(e){this.observableData.smartState.stabilization=e}setTrackSpeed(e){this.observableData.smartState.trackSpeed=e}setSelectedSubject(e){this.observableData.smartState.selectedSubjects=e}setMainSubject(e){this.observableData.smartState.mainSubject=e}setIsLoadingSubject(e){this.observableData.smartState.isLoadingSubject=e}setRecognizeNotice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.observableData.smartState.recognizeNotice={status:e,message:t}}setSmartCropApplyState(e){(0,o.z)(()=>{this.observableData.smartState.isSmartCropApplying=e})}setPlayerLoaded(e){this.observableData.isPlayerLoaded=e}reset(){let e=b();Object.assign(this.observableData,e)}checkSmartCropApplying(e){this.observableData.smartState.isSmartCropApplying=this._smartCropManager.getLoadingState(e).loading}setRatioSelectOpen(e){this.observableData.isRatioSelectOpen=e}initSettings(e,t,i){var r;this.observableData.playerId=e;let{segment:n,videoInfo:a}=t;a.isImage&&(this.observableData.isPlayerLoaded=!0),this.observableData.mode===s.J.Smart?this.initSmartCrop(n,a,i):this.initManualCrop(n,a,i),this.observableData.duration=null==a?void 0:a.duration,this.observableData.materialFormat=null!==(r=null==a?void 0:a.format)&&void 0!==r?r:"",this.observableData.materialType=(null==a?void 0:a.isImage)?"image":"video";let{shellSize:o,sizeRange:l}=this.getShellSize(a);this.observableData.shellSize=o,this.observableData.sizeRange=l,this.observableData.materialResolution=(0,p.n3)(o.width,o.height)}initSmartCrop(e,t,i){let{smartCrop:r}=e;if(r&&!i){let{cropRatio:e,stability:t,trackSpeed:i}=r,n="original"===e||"custom"===e?g.j8m.CropRatioFree:e;this.observableData.smartState.stabilization=t,this.observableData.smartState.trackSpeed=i,this.observableData.ratio=f.hB[n]}else this.observableData.smartState.stabilization=l.yi.Normal,this.observableData.smartState.trackSpeed=l.sj.Normal,this.observableData.ratio=u.zl.FREE;let{sizeRange:n}=this.getShellSize(t),a=this.calculateInitialCropBox(n,h.XF[this.observableData.ratio]);this.observableData.box=a,this.observableData.cropResolution=(0,p.n3)(a.width,a.height)}initManualCrop(e,t,i){let{shellSize:r,sizeRange:n}=this.getShellSize(t),a={ratio:e.material.cropRatio,box:e.material.crop},o={scale:1,ratio:u.zl.FREE,rotate:0,box:{width:0,height:0,left:0,top:0}};if(!(0,p.zg)(a.box)||i)o={scale:1,ratio:u.zl.FREE,rotate:0,box:this.calculateInitialCropBox(n,0,!0)};else{let e=(0,m.M)({...a.box,shellHeight:r.height,shellWidth:r.width,shellRatio:r.ratio});o={ratio:f.hB[a.ratio],...e}}this.observableData.manualState.scale=o.scale,this.observableData.ratio=o.ratio,this.observableData.manualState.angle=o.rotate,this.observableData.box=o.box,this.observableData.cropResolution=(0,p.n3)(o.box.width,o.box.height)}applySmartCrop(){var e,t;let{smartState:r,ratio:o,duration:l,materialFormat:d,materialType:c,materialResolution:h,cropResolution:p,box:m}=this.observableData,{trackSpeed:f,stabilization:_,selectedTime:v,selectedSubjects:b}=r,A=g.pMA.plus(v,(null===(t=this._modalStore.cropInfo)||void 0===t?void 0:null===(e=t.videoInfo)||void 0===e?void 0:e.start)||0),M=this.getNormalBox(),T=b.map(e=>e.mask);this._smartCropManager.startSmartCrop({segment:this._segment,params:{keyFrameFps:f,stableWeight:_,userBox:M,currentFrameTime:A,maskList:T,extra:{crop_ratio:o===u.zl.ORIGINAL&&(1!==M.height||1!==M.width)?u.zl.FREE:o,duration:l,material_format:d,material_type:c,material_resolution:h,crop_resolution:p,crop_ratio_number:m.width/m.height}}},()=>{var e,t;(null===(e=this._segment)||void 0===e?void 0:e.id)&&this._mainEditorWidgetService.modalManager.showMultiTrackCropModal(null===(t=this._segment)||void 0===t?void 0:t.id,{cropMode:s.J.Smart})},e=>{a.Z.confirm({title:(0,n.jsxs)("div",{className:y.Z.smartCropErrorModalHeader,children:[(0,n.jsx)("img",{className:y.Z.smartCropErrorModalIcon,src:i(400989)}),(0,n.jsx)("div",{className:y.Z.smartCropErrorModalTitle,children:S.ZP.t("web_edit_text_fail_ratio_change",{},"Couldn\u2019t apply auto reframe")})]}),wrapClassName:y.Z.smartCropErrorModal,content:(0,n.jsx)("div",{className:y.Z.smartCropErrorModalContent,children:S.ZP.t("web_edit_text_fail_web_retry",{},"Connect to the internet and try again.")}),okText:S.ZP.t("web_edit_button_retry_auto_reframe",{},"Retry"),cancelText:S.ZP.t("web_edit_button_cancel",{},"Cancel"),okButtonProps:{status:void 0},onOk:()=>{e&&this._mainEditorWidgetService.modalManager.showMultiTrackCropModal(e,{cropMode:s.J.Smart})},maskClosable:!1,closable:!1,icon:null})})}getShellSize(e){let t=444,i=284,r=i,n=t,a=r/e.height,o=a*e.width,s={width:0,height:0,ratio:0},l={minWidth:40,maxWidth:(s=o<=n?{width:o,height:r,ratio:a}:{width:n,height:e.height*n/e.width,ratio:n/e.width}).width,minHeight:40,maxHeight:s.height};return{shellSize:s,sizeRange:l}}calculateInitialCropBox(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{maxWidth:r,maxHeight:n}=e;if(0===t)return{left:0,top:0,width:r,height:n};let a=i?r:t*n,o=i?r/t:n;return(i?o>n:a>r)?this.calculateInitialCropBox(e,t,!i):{left:i?0:(r-a)/2,top:i?(n-o)/2:0,width:a,height:o}}getNormalBox(){let{box:e,shellSize:t}=this.observableData,{width:i,height:r}=t;return{left:e.left/i,top:e.top/r,width:e.width/i,height:e.height/r}}moveToMainSubject(e){let{mainSubject:t=this.observableData.smartState.mainSubject,box:i}=e||{};if(0===t.length){i&&(this.setBox(i),this.moveBoxToCenter());return}let{width:r,height:n}=i||this.observableData.box,{width:a,height:o}=this.observableData.shellSize;if(r===this.observableData.shellSize.width&&n===this.observableData.shellSize.height){i&&this.setBox(i);return}let s=1e4,l=1e4,d=0,c=0;for(let e of t)s=Math.min(s,e.left*a),l=Math.min(l,e.top*o),d=Math.max(d,(e.left+e.width)*a),c=Math.max(c,(e.top+e.height)*o);let u=s+(d-s)/2-r/2,h=l+(c-l)/2-n/2;u<0&&(u=0),h<0&&(h=0),u+r>this.observableData.shellSize.width&&(u=this.observableData.shellSize.width-r),h+n>this.observableData.shellSize.height&&(h=this.observableData.shellSize.height-n),this.setBox({left:u,top:h,width:r,height:n})}moveBoxToCenter(){let{box:e,shellSize:t}=this.observableData,{width:i,height:r}=t,n=i/2-e.width/2,a=r/2-e.height/2;this.observableData.box={left:n,top:a,width:e.width,height:e.height}}async fetchSubject(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r>=3)return Promise.reject();this.observableData.smartState.isLoadingSubject=!0;let n=i;!n&&(n=this.getCurrentFrameBase64()),this._frameStatusRef=n;let a=(null===(t=this._modalStore.cropInfo)||void 0===t?void 0:null===(e=t.videoInfo)||void 0===e?void 0:e.start)||0,o=g.pMA.plus(this.observableData.smartState.currentTime,a);try{let e=await this._smartCropManager.getSubject({currentFrameBase64:n,currentFrameTime:o,maskColor:[224,202,0,100]});if(this.observableData.smartState.isLoadingSubject=!1,!e)return await Promise.reject();if(e.ok){if(g.pMA.minus(e.value.currentFrameTime,a)!==this.observableData.smartState.selectedTime)return await this.fetchSubject("",++r);let t=this.getCurrentFrameBase64();if(t!==this._frameStatusRef)return await this.fetchSubject(t,++r);return e.value.subjectList}return await Promise.reject(e.cause)}catch(e){return this.observableData.smartState.isLoadingSubject=!1,Promise.reject(e)}}getCurrentFrameBase64(){let e=document.querySelector(`#${this.observableData.playerId}`),t=null==e?void 0:e.firstChild;if(t){let e=document.createElement("canvas");return e.width=t.clientWidth,e.height=t.clientHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height),e.toDataURL("image/png").replace("data:image/png;base64,","")}return""}get smartCropManager(){return this._smartCropManager}get _segment(){var e;return null===(e=this._modalStore.cropInfo)||void 0===e?void 0:e.segment}get _smartCropManager(){return this._mainEditorWidgetService.smartToolsManager.smartCropManager}get _pipelineManager(){return this._mainEditorWidgetService.smartToolsManager.pipelineManager}get _isPipelineLoading(){var e,t;return!!((null===(e=this._segment)||void 0===e?void 0:e.id)&&this._pipelineManager.getLoadingState(null===(t=this._segment)||void 0===t?void 0:t.id).loading)}constructor(e,t,i,r){this._modalManager=e,this._modalStore=t,this._mainEditorWidgetService=i,this._containerService=r,this.observableData=b(),this._frameStatusRef="",this.init()}}(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===s.J?Object:s.J]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setMode",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setIsBuffering",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",void 0),(0,r.w6)("design:paramtypes",[])],A.prototype,"currentTime",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setSmartCropperPreview",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setSmartCropperDragCursor",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setSmartCropperSelectedTime",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setCropVideoDuration",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setCropIsPlaying",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setCropCurrentTime",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setAngle",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===u.zl?Object:u.zl]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setRatio",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setScale",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setApplyToAllSameRatio",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IBoxData?Object:IBoxData]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setBox",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===l.yi?Object:l.yi]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setStabilization",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===l.sj?Object:l.sj]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setTrackSpeed",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Array]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setSelectedSubject",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Array]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setMainSubject",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setIsLoadingSubject",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,String]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setRecognizeNotice",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setSmartCropApplyState",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setPlayerLoaded",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",void 0)],A.prototype,"reset",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",void 0)],A.prototype,"checkSmartCropApplying",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"setRatioSelectOpen",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,Object,Boolean]),(0,r.w6)("design:returntype",void 0)],A.prototype,"initSettings",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",void 0)],A.prototype,"applySmartCrop",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype","undefined"==typeof IBoxData?Object:IBoxData)],A.prototype,"getNormalBox",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object]),(0,r.w6)("design:returntype",void 0)],A.prototype,"moveToMainSubject",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",void 0)],A.prototype,"moveBoxToCenter",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,void 0]),(0,r.w6)("design:returntype",Promise)],A.prototype,"fetchSubject",null),(0,r.gn)([o.aD.bound,(0,r.w6)("design:type",void 0),(0,r.w6)("design:paramtypes",[])],A.prototype,"smartCropManager",null),A=(0,r.gn)([(0,r.fM)(2,d.a),(0,r.fM)(3,v.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ModalManager?Object:ModalManager,"undefined"==typeof ModalStore?Object:ModalStore,void 0===d.a?Object:d.a,void 0===v.t?Object:v.t])],A)},257367:function(e,t,i){i.d(t,{h:function(){return a}});var r=i(800788);let n=Object.freeze(function(e){return{dispose(){}}});class a{active(){(0,r.ss)()}unactive(){(0,r.ss)()}seek(e){this._showWarning()}seekAndPause(e){this._showWarning()}seekWithSpeed(e,t,i){this._showWarning()}flushSeekCmd(){this._showWarning()}play(){this._showWarning()}pause(){this._showWarning()}rangePlay(e,t){this._showWarning()}setFullscreenContainer(e){this._showWarning()}requestFullscreen(){this._showWarning()}exitFullscreen(){this._showWarning()}retryStreamAsset(e){return Promise.resolve(-1)}reset(){return Promise.resolve()}get onPlay(){return n}get onRangePlay(){return n}get onPause(){return n}get onProgress(){return n}get onSeeked(){return n}get onEnd(){return n}get onError(){return n}get onFullscreenChange(){return n}_showWarning(){console.warn("should not call dummy player !!!\nplease check occasion.")}constructor(){this.hasLoaded=!1}}},951603:function(e,t,i){i.d(t,{kg:function(){return a},um:function(){return s}});var r,n=((r=n||{})[r.debug=0]="debug",r[r.info=1]="info",r[r.warn=2]="warn",r[r.error=3]="error",r[r.fatal=4]="fatal",r[r.none=6]="none",r);let a=new class e{debug(e){this._log(0,e)}info(e){this._log(1,e)}warn(e){this._log(2,e)}error(e){this._log(3,e)}fatal(e){this._log(4,e)}_log(e,t){if(e<this.minLogLevel)return;let i=`[${new Date().toISOString()}] [${n[e]}] [PlayerManager] - ${t}`;switch(e){case 4:case 3:console.error(i);break;case 2:console.warn(i);break;case 0:console.trace(i);default:console.log(i)}}constructor(){var e;if(this.minLogLevel=6,"undefined"==typeof window)return;let{searchParams:t}=new URL(window.location.href),i=null!==(e=t.get("player_log_level"))&&void 0!==e?e:"";this.minLogLevel=i&&Number.isFinite(parseInt(i,10))?parseInt(i,10):6}};function o(e){return function(t,i,r){let n=r.value;return r.value=function(){let t;for(var r=arguments.length,o=Array(r),s=0;s<r;s++)o[s]=arguments[s];return t=o[0]?`${i}(${o.join(", ")})`:`${i}()`,a[e](t),n.apply(this,o)},r}}o("debug");let s=o("info");o("warn"),o("error"),o("fatal")},354708:function(e,t,i){i.d(t,{t:function(){return d}});var r=i(587892),n=i(641276),a=i(402655),o=i(690613),s=i(800788);class l extends a.JT{get hasLoaded(){return this._hasLoaded}active(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0n;if(!this._activing)this._bindEvents(),this._hasLoaded&&this._source.seek(e),this._activing=!0}unactive(){this._unbindEvents(),this._activing=!1}seek(e,t,i){this._source.seek(e,t,i)}seekAndPause(e){this._source.seekAndPause(e)}seekWithSpeed(e,t,i){this._source.seekWithSpeed(e,t,i)}flushSeekCmd(){this._source.flushSeekCmd()}play(){if(!!this._hasLoaded)this._source.play()}pause(){this._pause()}rangePlay(e,t){this._source.rangePlay(e,t)}reset(e){return(0,s.ZB)(e),this._source.reset(e)}setFullscreenContainer(e){this._source.setFullscreenContainer(e)}requestFullscreen(e){this._source.requestFullscreen(e)}exitFullscreen(e){this._source.exitFullscreen(e)}retryStreamAsset(e){return this._source.retryStreamAsset(e)}_pause(){this._source.pause()}_bindEvents(){this._register(this._source.onProgressChange(e=>{let{progress:t,isSeek:i}=e;this._progress=t,this._onProgress.fire(t,i)})),this._register(this._source.onError(e=>{this._onError.fire((0,o.wf)(-1,JSON.stringify(e)))})),this._register(this._source.onPlay(()=>this._onPlay.fire())),this._register(this._source.onRangePlay(()=>this._onRangePlay.fire())),this._register(this._source.onPause(()=>this._onPause.fire())),this._register(this._source.onEnd(()=>this._onEnd.fire())),this._register(this._source.onSeeked(()=>this._onSeeked.fire())),this._register(this._source.onStreamStart(e=>this._onStreamStart.fire(e))),this._register(this._source.onStreamStop(e=>this._onStreamStop.fire(e))),this._register(this._source.onStreamFail(e=>{let{assetId:t,httpStatus:i,isBlock:r,isGetMediaInfo:n}=e;return this._onStreamFail.fire({assetId:t,httpStatus:i,isBlock:r,isGetMediaInfo:n})})),this._register(this._source.onFullscreenChange((e,t)=>this._onFullscreenChange.fire(e,t)))}_unbindEvents(){this._store.clear()}constructor(e,t){super(),this._source=e,this._onPlay=new r.Q,this._onRangePlay=new r.Q,this._onPause=new r.Q,this._onProgress=new r.Q,this._onSeeked=new r.Q,this._onStreamStart=new r.Q,this._onStreamStop=new r.Q,this._onStreamFail=new r.Q,this._onEnd=new r.Q,this._onError=new r.Q,this._onFullscreenChange=new r.Q,this._progress=0n,this._activing=!1,this._hasLoaded=!1,this.onPlay=this._onPlay.event,this.onRangePlay=this._onRangePlay.event,this.onPause=this._onPause.event,this.onProgress=this._onProgress.event,this.onSeeked=this._onSeeked.event,this.onStreamStart=this._onStreamStart.event,this.onStreamStop=this._onStreamStop.event,this.onStreamFail=this._onStreamFail.event,this.onEnd=this._onEnd.event,this.onError=this._onError.event,this.onFullscreenChange=this._onFullscreenChange.event,(0,n.V)(()=>{let e=t.onFirstFrameRender(()=>{this._hasLoaded=!0});return{dispose:()=>{null==e||e.dispose()}}})(()=>{})}}function d(e,t){return new l(e,t)}},872155:function(e,t,i){i.d(t,{i:function(){return l}});var r=i(772322),n=i(801497),a=i(150564),o=i(603647);let s=(e,t)=>{var i,a;let s=null===(i=Object.keys(t))||void 0===i?void 0:i.length,l=null===(a=Object.values(t))||void 0===a?void 0:a.reduce((e,t)=>((null==t?void 0:t.status)==="success"&&(null==t?void 0:t.saved)&&(e+=1),e),0),d="";switch(e){case o.N.success:if(l===s)d=n.oc.t("web_draft_trans_title_restore",{placeholder0:l,num:l},`${l} media restored`);else{let e=s-l,t=l>1?"plu":"sin",i=e>1?"plu":"sin",r=`web_draft_trans_text_restore_${t}_${i}`;d=n.oc.t(r,{placeholder0:l,placeholder1:e},`${l} media restored. Couldn\u{2019}t restore ${e} media.`)}break;case"fail":d=n.oc.t("web_draft_trans_text_restored_medi",{placeholder0:s,num:s},`Couldn\u{2019}t restore ${s} media`);break;default:d=n.oc.t("web_draft_trans_button_restore_place",{placeholder0:`(${l}/${s})`},`Restoring media (${l}/${s}) ...`)}return(0,r.jsx)("div",{className:`repair-${e}-title`,children:d})},l=(e,t)=>{switch(e){case o.N.doing:return{title:s(o.N.doing,t),description:n.oc.t("web_draft_trans_text_leave_page",{},"If your leave this page, your media won\u2019t be restored."),hiddenOkBtn:!0,cancelText:n.oc.t("web_cancel")};case o.N.success:return{Icon:a.oi7,title:s(o.N.success,t),description:n.oc.t("web_draft_trans_text_refresh",{},"Refresh the page to open your project."),hiddenCancelBtn:!0,okText:n.oc.t("web_draft_trans_button_refreshing",{},"Refresh")};case o.N.fail:return{Icon:a.T4B,title:s(o.N.fail,t),description:n.oc.t("web_draft_trans_text_refresh",{},"Refresh the page to open your project."),hiddenCancelBtn:!0,okText:n.oc.t("web_draft_trans_button_open",{},"Open project")};default:return{}}}},236735:function(e,t,i){i.d(t,{S:function(){return d},q:function(){return l}});var r=i(789786),n=i(260963),a=i(569471),o=i(800788),s=i(531474);let l=Symbol.for("__current_text_material_store__");class d{_recursiveMergeTextMaterial(e){(0,o.ZB)(this._observableData.currentTextMaterial),(0,s.T)(this._observableData.currentTextMaterial,e)}updateCurrentTextMaterial(e){if(!this.currentTextMaterial){this.changeCurrentTextMaterial(e);return}this._recursiveMergeTextMaterial(e)}changeCurrentTextMaterial(e){(0,n.t8)(this._observableData,{currentTextMaterial:e?(0,a.I)(e):e})}get currentTextMaterialId(){var e;return null===(e=this._observableData.currentTextMaterial)||void 0===e?void 0:e.id}get currentTextMaterial(){return this._observableData.currentTextMaterial}constructor(){this._observableData=(0,n.LO)({currentTextMaterial:null})}}(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof MaterialTextWithMixedStyles?Object:MaterialTextWithMixedStyles]),(0,r.w6)("design:returntype",void 0)],d.prototype,"_recursiveMergeTextMaterial",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof MaterialTextWithMixedStyles?Object:MaterialTextWithMixedStyles]),(0,r.w6)("design:returntype",void 0)],d.prototype,"updateCurrentTextMaterial",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object]),(0,r.w6)("design:returntype",void 0)],d.prototype,"changeCurrentTextMaterial",null)},894907:function(e,t,i){i.d(t,{Y:function(){return n}});var r=i(260963);function n(e){return e.map(e=>(0,r.ZN)(e))}},41770:function(e,t,i){i.d(t,{X:function(){return l}});var r=i(789786),n=i(948328),a=i(587892),o=i(402655),s=i(426336);class l extends o.JT{get onResourceErrorChange(){return this._onResourceErrorChange.event}hasInvalidUserMaterial(e){let t=this._draftPathStore.getResourceKeyFromDraftPath(e);return!t||!this._draftMaterialService.isMaterialExistByKey(t)}hasInvalidOnlineResources(e){return e.some(e=>this._errorResourceIdSet.has(e))}addErrorSegmentIds(e){for(let t of e)this._errorSegmentIdSet.add(t);this.triggerResourceErrorChange()}addErrorResourceIds(e){for(let t of e)this._errorResourceIdSet.add(t);this.triggerResourceErrorChange()}addErrorAssetId(e){if(!this._errorAssetIdSet.has(e))this._errorAssetIdSet.add(e),this.triggerResourceErrorChange()}isInvalidAsset(e){return this._errorAssetIdSet.has(e)}isInvalidStreamSegmentPath(e){let t=s.k92.getInstance().pathRecords.get(e);return!!s.k92.getInstance().streamRecords.get(t)&&this.isInvalidAsset(t)}removeErrorSegmentIds(e){for(let t of e)this._errorSegmentIdSet.delete(t);this.triggerResourceErrorChange()}triggerResourceErrorChange(){this._onResourceErrorChange.fire()}constructor(e,t){super(),this._draftPathStore=e,this._draftMaterialService=t,this._errorSegmentIdSet=new Set,this._errorResourceIdSet=new Set,this._errorAssetIdSet=new Set,this._onResourceErrorChange=this._store.add(new a.Q),this._store.add(t.onDidMaterialRemove(()=>{this.triggerResourceErrorChange()})),this._store.add(t.onDidMaterialReplace(()=>{this.triggerResourceErrorChange()}))}}l=(0,r.gn)([(0,r.fM)(1,n.D),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof DraftPathStore?Object:DraftPathStore,void 0===n.D?Object:n.D])],l)},389995:function(e,t,i){i.d(t,{u:()=>b});var r=i("789786"),n=i("126429"),a=i("426336"),o=i("402655"),s=i("632858"),l=i("945903"),d=i("928261"),c=i("970787"),u=i("593642");let h=(e,t,i)=>{let r=[],{segmentIds:n,draftPath:o="",isCopyAction:h=!1}=i;for(let t of n){let i;let{segmentIndex:n,trackIndex:c,trackId:g}=e.draftView.getSegmentAtPositionById(t),p=e.draftView.getAllTracks()[c],m=p.type,f=0,_=d.ki;m===a.pNd.TrackTypeAudio?(f=2,_=d.QB):!e.draftView.getDraftProperty().renderIndexTrackModeOn&&(m===a.pNd.TrackTypeVideo?(f=0,_=d.yV):(f=1,_=d.LG));let v=p.segments[n];h?(i=v.clone(!0),m===a.pNd.TrackTypeVideo&&((0,l.F)(e,v,i),(0,l.a)(v,i)),((0,a.hey)(v)||(0,a.Y9Q)(v))&&((0,a.hey)(i)||(0,a.Y9Q)(i))&&v.voiceChange&&i.voiceChange&&(i.voiceChange=v.voiceChange.map(e=>{let t=(0,u.Rl)();for(let r of i.commonKeyframes)r.materialId===e.id&&(r.materialId=t);let r=e.clone(!0);return r.id=t,r}))):i=v;let S={segId:t,segment:i,trackId:g,draftPath:o,trackType:m,trackIndex:c,trackTypeVect:_,isCopiedData:h,handleType:f};s.v.instance.saveData(e.draftView.getDraftId(),t,S),r.push(S)}!h&&(0,c.I)(e,t,{segIds:n,selectedSegIds:n})};var g=i("496287"),p=i("478091"),m=i("298730"),f=i("217974"),_=i("591010"),v=i("230689"),S=i("801497"),y=i("108692");class b extends o.JT{updateRenderManager(e){this._renderManager=e}get canPaste(){return this._pasteInfo.length>0}_setPasteInfo(e){let t=e.map(e=>({id:e.id,start:e.targetTimerange.start}));this._pasteInfo=t}_setCacheTracks(){let e=this._dataSdk.draftView.getAllTracks();this._cacheTracks=e.map(e=>e.clone(!1))}copy(e){if(!e.length)return{ok:!1,msg:""};let t=e.map(e=>this._dataSdk.draftView.getSegmentById(e));return this._setPasteInfo(t),this._setCacheTracks(),h(this._dataSdk,this._renderManager,{segmentIds:e,isCopyAction:!0}),{ok:!0,msg:""}}cut(e){if(!e.length)return{ok:!1,msg:""};let t=e.map(e=>this._dataSdk.draftView.getSegmentById(e));return this._setPasteInfo(t),this._setCacheTracks(),h(this._dataSdk,this._renderManager,{segmentIds:e,isCopyAction:!1}),{ok:!0,msg:""}}paste(e){let t=(0,g.M)(this._dataSdk,e);return Array.isArray(t)?(this._segmentSelection.setSelectedData({segmentIds:t}),{ok:!0,msg:""}):{ok:t.ok,msg:t.msg}}remove(e,t){}constructor(e,t,i,r,n,o,s){super(),this._dataSdk=e,this._renderManager=t,this._selection=i,this._segmentSelection=r,this._playerManager=n,this._containerService=o,this._mainDraftService=s,this._pasteInfo=[],this._cacheTracks=[],this._currentSeekTime=0n,this.copySelectedSegments=()=>{let e=this._selection.getSelectedSegments();return e.length?this._segmentSelection.subDraftSegmentId&&!this._selection.segmentIds.includes(this._segmentSelection.subDraftSegmentId)?{ok:!1,msg:S.oc.t("web_multi_track_toast_copy_paste",{},"Can\u2019t copy clips in the template")}:(this._setPasteInfo(e),this._setCacheTracks(),h(this._dataSdk,this._renderManager,{segmentIds:e.map(e=>e.id),isCopyAction:!0}),{ok:!0,msg:""}):{ok:!1,msg:""}},this.pasteSegments=e=>{if(!this.canPaste)return{ok:!1,msg:""};let t=this._dataSdk.draftView.getAllTracks(),i=BigInt(Number.MAX_SAFE_INTEGER);for(let e of this._pasteInfo)i=a.pMA.min([i,e.start],"bigint");let r=e-i;this._pasteInfo.forEach(e=>{e.start+=r});let n=(0,p.c)(t,this._cacheTracks,this._pasteInfo,e),o=(0,m.ty)(this._dataSdk,n.map(e=>({targetStart:e.targetStartTime,duration:e.duration,trackIndex:e.targetTrackIndex,newTrack:e.needInsertTargetTrack,type:e.type})));if(o.ok){this._pasteInfo.length;let e=(0,g.M)(this._dataSdk,n);e.ok&&this._segmentSelection.setSelectedData({segmentIds:e.value})}return o},this.pasteSegmentsAtCurrentSeek=()=>this.pasteSegments(this._currentSeekTime),this.cutSelectedSegments=()=>{let e=this._selection.getSelectedSegments();return e.length?(this._setPasteInfo(e),this._setCacheTracks(),h(this._dataSdk,this._renderManager,{segmentIds:e.map(e=>e.id),isCopyAction:!1}),{ok:!0,msg:""}):{ok:!1,msg:""}},this.duplicateSelectedSegments=()=>(this.copySelectedSegments(),this.pasteSegmentsAtCurrentSeek()),this.removeSelectedSegments=async e=>{var t;let i=this._selection.getSelectedTransitionIds(),r=this._selection.getSelectedSegmentsIds(),n=r.length>0?i:i.filter(e=>{let t=this._dataSdk.draftView.getSegmentByTransitionId(e).id;return!r.includes(t)});return await (0,f.Q)({dataSdk:this._dataSdk,segmentIds:r,transitionIds:n,fromWhere:e,containerService:this._containerService,draftId:null===(t=this._selection.subDraftContext)||void 0===t?void 0:t.subDraftId,draftTemplateManager:this._mainDraftService.draftTemplateManager}),this._segmentSelection.setSelectedData({},_.k.Timeline),{ok:!0,msg:""}},this._playerManager.onProgress(e=>{this._currentSeekTime=e})}}b=(0,r.gn)([(0,r.fM)(5,v.t),(0,r.fM)(6,y.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof RenderManager?Object:RenderManager,void 0===n.Y?Object:n.Y,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof IPlayerManager?Object:IPlayerManager,void 0===v.t?Object:v.t,void 0===y.n?Object:y.n])],b)},353678:function(e,t,i){i.d(t,{K:function(){return a}});var r=i(426336),n=i(305799);function a(e,t){if(!t.length)return[];let i=e.map((e,t)=>({...e,index:t}));return(0,n.NO)(i,e=>!e.segments.find(e=>t.includes(e.id))).map(e=>(e.segments=e.segments.filter(e=>t.includes(e.id)).sort((e,t)=>r.pMA.minus(e.targetTimerange.start,t.targetTimerange.start)),e))}},126429:function(e,t,i){i.d(t,{Y:function(){return g},d:function(){return h}});var r=i(789786),n=i(131805),a=i(587892),o=i(402655),s=i(800788),l=i(426336),d=i(591010),c=i(31463);let u=(e,t)=>{let{transitionIds:i,placeholderIds:r,segmentIds:n,subDraftContext:a,selectedSegmentChildIndex:o,actionType:s,emitterSource:l}=e,{transitionIds:d,placeholderIds:c,segmentIds:u,selectedSegmentChildIndex:h,subDraftContext:g,emitterSource:p,actionType:m}=t;if(i.length!==d.length||r.length!==c.length||n.length!==u.length||(null==a?void 0:a.segmentId)!==(null==g?void 0:g.segmentId)||(null==a?void 0:a.subDraftId)!==(null==g?void 0:g.subDraftId)||(null==a?void 0:a.expandMode)!==(null==g?void 0:g.expandMode)||o!==h||l!==p||s!==m)return!0;let f=new Set(i),_=new Set(n),v=new Set(r);for(let e=0;e<d.length;e++)if(!f.has(d[e]))return!0;for(let e=0;e<u.length;e++)if(!_.has(u[e]))return!0;for(let e=0;e<c.length;e++)if(v.has(c[e]))return!0;return!1};class h extends o.JT{get segmentIds(){return this._segmentIds}get placeholderIds(){return this._placeholderIds}get transitionIds(){return this._transitionIds}get faceId(){return this._faceId}get selectedSegmentChildIndex(){return this._selectedSegmentChildIndex}get subDraftContext(){return this._subDraftContext}setSelectedData(e){var t,i,r,n,a,o;let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.k.Unknown,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.U.Default,g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{subDraftContext:p,selectedSegmentChildIndex:m=-1,segmentIds:f=[],placeholderIds:_=[],transitionIds:v=[]}=e;if(!g&&!u({placeholderIds:this._placeholderIds,transitionIds:this._transitionIds,segmentIds:this._segmentIds,subDraftContext:this._subDraftContext,selectedSegmentChildIndex:this._selectedSegmentChildIndex,emitterSource:this._prevSource,actionType:this._prevActionType},{subDraftContext:p,selectedSegmentChildIndex:m,segmentIds:f,placeholderIds:_,transitionIds:v,emitterSource:c,actionType:h}))return;this._subDraftContext=p;let S=(null===(t=this._subDraftContext)||void 0===t?void 0:t.subDraftId)?this._dataSDK.draftView.getDraftById(null===(i=this._subDraftContext)||void 0===i?void 0:i.subDraftId):this._dataSDK.draftView;(0,s.Y2)(S);let y=S.getAllSegments(),b=new Set,A=new Set;y.forEach(e=>{var t;(0,l.hey)(e)&&(null===(t=e.transition)||void 0===t?void 0:t.id)&&A.add(e.transition.id),b.add(e.id)});let M=[],T=[],w=[],C=[];f.forEach(e=>{b.has(e)?M.push(e):T.push(e)}),v.forEach(e=>{A.has(e)?w.push(e):C.push(e)}),T.length&&this._reportService.reportDevError("PrepareSelection",Error("selected segment not found in dataSdk"),{notFoundSegmentIds:T.toString(),segmentIds:f.toString(),currentDraftId:null!==(n=null===(r=this._subDraftContext)||void 0===r?void 0:r.subDraftId)&&void 0!==n?n:this._dataSDK.draftView.getDraftId(),mainDraftId:this._dataSDK.draftView.getDraftId()}),C.length&&this._reportService.reportDevError("PrepareSelection",Error("selected transition not found in dataSdk"),{notFoundTransitionIds:C.toString(),transitionIds:v.toString(),currentDraftId:null!==(o=null===(a=this._subDraftContext)||void 0===a?void 0:a.subDraftId)&&void 0!==o?o:this._dataSDK.draftView.getDraftId(),mainDraftId:this._dataSDK.draftView.getDraftId()}),this._segmentIds=M,this.setSelectedSegmentChildIndex(m),this._transitionIds=w,this._placeholderIds=_,this._prevActionType=h,this._prevSource=c,this._fireChange(c,h)}getSelectedData(){return this._makeSelectedData()}getSelectedSegmentsIds(){return this._segmentIds}getSelectedSegments(){return this._segmentIds.map(e=>this._getSegmentById(e))}getSelectedSingleSegment(){return 1!==this._segmentIds.length?null:this._getSegmentById(this._segmentIds[0])}getSelectedTransitionIds(){return this._transitionIds}getSelectedSegmentChildIndex(){return this._selectedSegmentChildIndex}setSelectedSegmentChildIndex(e){if(this._selectedSegmentChildIndex!==e)this._selectedSegmentChildIndex=e,this._onSelectedSegmentChildIndexChange.fire(e)}getSelectedFaceId(){return this._faceId}setSelectedFaceId(e){this._faceId=e,this._onSelectedFaceIdChange.fire(e)}isInSubDraftContext(){return!!this._subDraftContext}setBeforeDeleteHook(e){this._beforeDeleteHooks.push(e)}getBeforeDeleteHook(){return this._beforeDeleteHooks}dispose(){this._beforeDeleteHooks.length=0,super.dispose()}_makeSelectedData(){return{segmentIds:this._segmentIds,transitionIds:this._transitionIds,placeholderIds:this._placeholderIds,selectedSegmentChildIndex:this._selectedSegmentChildIndex,subDraftContext:this._subDraftContext}}_fireChange(e,t){this._onChange.fire({selectedData:this._makeSelectedData(),source:e,actionType:t})}_getSegmentById(e){let t=this._cache.get(e);return!t&&(t=this._dataSDK.draftView.getSegmentById(e),(0,s.ZB)(t),this._cache.put(e,t)),t}constructor(e,t){super(),this._dataSDK=e,this._reportService=t,this._cache=new n.z(20),this._segmentIds=[],this._transitionIds=[],this._placeholderIds=[],this._selectedSegmentChildIndex=-1,this._faceId=null,this._prevActionType=d.U.Default,this._prevSource=d.k.Unknown,this._onSelectedSegmentChildIndexChange=new a.Q,this._onChange=new a.Q,this._onSelectedFaceIdChange=new a.Q,this._beforeDeleteHooks=[],this.onChange=this._onChange.event,this.onSelectedSegmentChildIndexChange=this._onSelectedSegmentChildIndexChange.event,this.onSelectedFaceIdChange=this._onSelectedFaceIdChange.event,this._register(this._dataSDK.onChangeDiff(e=>{e[l.u4I.SEGMENT].length>0&&this._cache.clear()}))}}h=(0,r.gn)([(0,r.fM)(1,c.m),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===c.m?Object:c.m])],h);class g extends o.JT{get segmentIds(){return this._segmentIds}get placeholderIds(){return this._placeholderIds}get transitionIds(){return this._transitionIds}get faceId(){return this._faceId}get selectedSegmentChildIndex(){return this._selectedSegmentChildIndex}get subDraftContext(){return this._subDraftContext}get actionType(){return this._prevActionType}get selectSource(){return this._prevSource}getSelectedData(){return this._makeSelectedData()}getSelectedSegmentsIds(){return this._segmentIds}getSelectedSegments(){return this._segmentIds.map(e=>this._getSegmentById(e))}getSelectedSingleSegment(){return 1!==this._segmentIds.length?null:this._getSegmentById(this._segmentIds[0])}getSelectedTransitionIds(){return this._transitionIds}getSelectedSegmentChildIndex(){return this._selectedSegmentChildIndex}getSelectedFaceId(){return this._faceId}isInSubDraftContext(){return!!this._subDraftContext}getBeforeDeleteHook(){return this._beforeDeleteHooks}_makeSelectedData(){return{segmentIds:this._segmentIds,transitionIds:this._transitionIds,placeholderIds:this._placeholderIds,selectedSegmentChildIndex:this._selectedSegmentChildIndex,subDraftContext:this._subDraftContext}}setSelectedData(e){var t,i,r,n,a,o;let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.k.Unknown,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.U.Default,g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{subDraftContext:p,selectedSegmentChildIndex:m=-1,segmentIds:f=[],placeholderIds:_=[],transitionIds:v=[]}=e;if(!g&&!u({placeholderIds:this._placeholderIds,transitionIds:this._transitionIds,segmentIds:this._segmentIds,subDraftContext:this._subDraftContext,selectedSegmentChildIndex:this._selectedSegmentChildIndex,emitterSource:this._prevSource,actionType:this._prevActionType},{subDraftContext:p,selectedSegmentChildIndex:m,segmentIds:f,placeholderIds:_,transitionIds:v,emitterSource:c,actionType:h}))return;this._subDraftContext=p;let S=(null===(t=this._subDraftContext)||void 0===t?void 0:t.subDraftId)?this._dataSDK.draftView.getDraftById(null===(i=this._subDraftContext)||void 0===i?void 0:i.subDraftId):this._dataSDK.draftView;(0,s.Y2)(S);let y=S.getAllSegments(),b=new Set,A=new Set;y.forEach(e=>{var t;(0,l.hey)(e)&&(null===(t=e.transition)||void 0===t?void 0:t.id)&&A.add(e.transition.id),b.add(e.id)});let M=[],T=[],w=[],C=[];f.forEach(e=>{b.has(e)?M.push(e):T.push(e)}),v.forEach(e=>{A.has(e)?w.push(e):C.push(e)}),T.length&&this._reportService.reportDevError("Selection",Error("selected segment not found in dataSdk"),{notFoundSegmentIds:T.toString(),segmentIds:f.toString(),currentDraftId:null!==(n=null===(r=this._subDraftContext)||void 0===r?void 0:r.subDraftId)&&void 0!==n?n:this._dataSDK.draftView.getDraftId(),mainDraftId:this._dataSDK.draftView.getDraftId()}),C.length&&this._reportService.reportDevError("Selection",Error("selected transition not found in dataSdk"),{notFoundTransitionIds:C.toString(),transitionIds:v.toString(),currentDraftId:null!==(o=null===(a=this._subDraftContext)||void 0===a?void 0:a.subDraftId)&&void 0!==o?o:this._dataSDK.draftView.getDraftId(),mainDraftId:this._dataSDK.draftView.getDraftId()}),this._segmentIds=M,this.setSelectedSegmentChildIndex(m),this._transitionIds=w,this._placeholderIds=_,this._prevActionType=h,this._prevSource=c,this._fireChange(c,h)}setSelectedSegmentChildIndex(e){if(this._selectedSegmentChildIndex!==e)this._selectedSegmentChildIndex=e,this._onSelectedSegmentChildIndexChange.fire(e)}setSelectedFaceId(e){this._faceId=e,this._onSelectedFaceIdChange.fire(e)}setBeforeDeleteHook(e){this._beforeDeleteHooks.push(e)}dispose(){this._beforeDeleteHooks.length=0,super.dispose()}_fireChange(e,t){this._onChange.fire({selectedData:this._makeSelectedData(),source:e,actionType:t})}_getSegmentById(e){let t=this._cache.get(e);return!t&&(t=this._dataSDK.draftView.getSegmentById(e),(0,s.ZB)(t),this._cache.put(e,t)),t}constructor(e,t){super(),this._dataSDK=e,this._reportService=t,this._cache=new n.z(20),this._segmentIds=[],this._transitionIds=[],this._placeholderIds=[],this._selectedSegmentChildIndex=-1,this._faceId=null,this._prevActionType=d.U.Default,this._prevSource=d.k.Unknown,this._onSelectedSegmentChildIndexChange=new a.Q,this._onChange=new a.Q,this._onSelectedFaceIdChange=new a.Q,this._beforeDeleteHooks=[],this.onChange=this._onChange.event,this.onSelectedSegmentChildIndexChange=this._onSelectedSegmentChildIndexChange.event,this.onSelectedFaceIdChange=this._onSelectedFaceIdChange.event,this._register(this._dataSDK.onChangeDiff(e=>{e[l.u4I.SEGMENT].length>0&&this._cache.clear()}))}}g=(0,r.gn)([(0,r.fM)(1,c.m),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===c.m?Object:c.m])],g)},957634:function(e,t,i){i.d(t,{B:function(){return n}});var r=i(260963);class n{setProcessingSegIds(e){this.processingSegIds=e}setSuccessResourceIds(e){this.successResourceIds=e}removeProcessingSegId(e){this.processingSegIds=this.processingSegIds.filter(t=>t!==e)}removeProcessingSegIds(e){e?this.processingSegIds=this.processingSegIds.filter(t=>!e.includes(t)):this.processingSegIds=[]}addSuccessResourceId(e){this.successResourceIds.push(e)}removeSuccessResourceId(e){this.successResourceIds=this.successResourceIds.filter(t=>t!==e)}constructor(){this.processingSegIds=[],this.successResourceIds=[],(0,r.ky)(this)}}},881687:function(e,t,i){let r;i.d(t,{BT:function(){return _},Vs:function(){return M},Y2:function(){return h},bw:function(){return g},cC:function(){return m},gX:function(){return u},j:function(){return T},nT:function(){return A},ri:function(){return f},sW:function(){return p},sl:function(){return S},sy:function(){return v}});var n=i(426020),a=i(273340),o=i(621071),s=i(426336),l=i(813072);let d=()=>(!r&&(r=new s.oIP),r),c=["jpeg","jpg","png","tiff","webp","bmp"];function u(e){return"sourceType"in e&&e.sourceType===n.ov.EverCloud&&e.fileType===n.YB.Image&&"md5"in e}function h(e){return"sourceType"in e&&e.sourceType===n.ov.PublicSpace&&e.fileType===n.YB.Image}function g(e){return!!("resourceId"in e&&"effectType"in e&&e.effectType===a.g.Image)}function p(e){return!!("width"in e&&"height"in e)}function m(e){return"mime"in e}function f(e){return"format"in e}function _(e){let t="";return m(e)?t=e.mime:f(e)&&(t=e.format),t=t.includes("/")?t.split("/")[1]:t,c.includes(t.toLowerCase())}function v(e){if(u(e))return{sourceType:o.C.EverCloud,source:e.md5};if(h(e)&&e.imgTranscodeInfo)return{sourceType:o.C.URI,source:e.imgTranscodeInfo[n.F0["360p"]].url};if(g(e))return{sourceType:o.C.HEYCAN,source:e.resourceId}}function S(e,t){let i=function e(t,i){return 0===i?t:e(i,t%i)}(e,t);return[e/i,t/i]}let y=function(e,t,i,r,n,a){return Math.sqrt(Math.pow(Math.abs(e-i)*n,2)+Math.pow(Math.abs(t-r)*a,2))},b=function(e,t,i){let r=y(e.upperLeftX,e.upperLeftY,e.upperRightX,e.upperRightY,t,i);return r/y(e.upperLeftX,e.upperLeftY,e.lowerLeftX,e.lowerLeftY,t,i)};function A(e,t,i,r){if(r&&(0,s.hey)(r)){let t=(0,l.Z)(d(),r.material.crop),{width:i,height:n}=r.material;if(!e.filled&&t)return S(Math.round(i),Math.round(n));if(e.filled||!t){let e=r.material.crop,t=(e.upperRightX-e.upperLeftX)*i;return S(Math.round(t),Math.round((e.lowerLeftY-e.upperLeftY)*n))}}let n=function(e,t,i){var r,n;let{width:a,height:o}=e;let s=(r=e,{upperLeftX:r.crop[0],upperLeftY:r.crop[1],upperRightX:r.crop[2],upperRightY:r.crop[3],lowerLeftX:r.crop[4],lowerLeftY:r.crop[5],lowerRightX:r.crop[6],lowerRightY:r.crop[7]});if(Object.values(s).every(e=>void 0===e)&&(s=d()),JSON.stringify(s)!==JSON.stringify(d())&&e.filled)return s;let l=b(s,a,o),c={...s};if(t/i>l){c.upperLeftY=0,c.upperRightY=0,c.lowerLeftY=1,c.lowerRightY=1;let e=(t-i*l)/2,r=e/t;c.upperLeftX=r,c.lowerLeftX=r;let n=(t-e)/t;c.upperRightX=n,c.lowerRightX=n}else{c.upperLeftX=0,c.lowerLeftX=0,c.upperRightX=1,c.lowerRightX=1;let e=(i-t/l)/2,r=e/i;c.upperLeftY=r,c.upperRightY=r;let n=(i-e)/i;c.lowerLeftY=n,c.lowerRightY=n}return c}(e,t,i),a=(n.upperRightX-n.upperLeftX)*t;return S(Math.round(a),Math.round((n.lowerLeftY-n.upperLeftY)*i))}function M(e,t){return new Promise((i,r)=>{let n=setTimeout(()=>{r(Error("timeout"))},e);t.then(e=>{clearTimeout(n),i(e)}).catch(e=>{clearTimeout(n),r(e)})})}function T(e){var t;let{mutableConfig:i}=e.getDraftProperty();return null!==(t=null==i?void 0:i.alignMode)&&void 0!==t?t:s._T0.AlignModeCanvas}},564831:function(e,t,i){i.d(t,{I:function(){return c}});var r=i(772322);i(225572),i(966156);var n=i(97257),a=i(368100),o=i(801497),s=i(195291);let l=e=>{let{onConfirm:t}=e;return(0,r.jsxs)(a.Z,{closable:!1,visible:!0,title:o.ZP.t("web_chatgpt_text_info",{},"Permission request"),footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z,{onClick:t,children:o.ZP.t("web_chatgpt_text_getinfo_not_agree",{},"Allow")}),(0,r.jsx)(n.Z,{type:"primary",onClick:t,children:o.ZP.t("web_chatgpt_text_get_info",{},"Not now")})]}),children:[o.ZP.t("web_chatgpt_text_info_text",{},"To help us improve, allow CapCut to store your inputs and generated videos to our server for our internal service assessment and model improvement?"),o.ZP.t("web_chatgpt_text_info_text_two",{},"You can still use this feature if you don\u2019t allow.")]})},d=e=>{let{onConfirm:t}=e;return(0,r.jsxs)(a.Z,{closable:!1,visible:!0,title:o.ZP.t("web_chatgpt_text_responsibility_title",{},"Disclaimer"),footer:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(n.Z,{type:"primary",onClick:t,children:o.ZP.t("web_chatgpt_text_responsibility_agree",{},"Confirm")})}),children:[(0,r.jsx)("div",{style:{marginBottom:"16px"},children:o.ZP.t("web_chatgpt_text_responsibility_title_one",{},"This video has been generated based on your inputs. ")}),(0,r.jsxs)("div",{children:[o.ZP.t("web_chatgpt_text_responsibility_text",{},"This draft video content has been generated based on your inputs. "),o.ZP.t("web_chatgpt_text_responsibility_title_two",{},"You can view and edit this video now. "),o.ZP.t("web_chatgpt_text_responsibility_title_three",{},"You bear the ultimate responsibility for the final version of this video.")]})]})};class c{constructor(){this.showExportPolicyModal=e=>{let t=this._getRootElement("_exportRootElement");document.body.appendChild(t),s.render((0,r.jsx)(l,{onConfirm:()=>{this.destroyModal("_exportRootElement"),null==e||e()}}),t)},this.showLoginPolicyModal=()=>{let e=this._getRootElement("_loginRootElement");document.body.appendChild(e),s.render((0,r.jsx)(d,{onConfirm:()=>{this.destroyModal("_loginRootElement")}}),e)},this.destroyModal=e=>{let t=this._getRootElement(e);t&&document.body&&(s.unmountComponentAtNode(t),document.body.removeChild(t),this[e]=void 0)},this._getRootElement=e=>(!this[e]&&(this[e]=document.createElement("div")),this[e])}}},464533:function(e,t,i){i.d(t,{B4:function(){return d},CW:function(){return a},HE:function(){return f},Kv:function(){return _},ON:function(){return g},Rd:function(){return h},dt:function(){return m},kd:function(){return p},sD:function(){return u},yJ:function(){return c}});var r=i(182517);function n(e){return parseFloat(e.replace(/px$/,""))}let a=n(r.Z.jumpModeDuration),o=n(r.Z.mutableInnerPadding),s=n(r.Z.mutableBtnIconSize),l=n(r.Z.mutableBtnPaddingHorizontal),d=2*o+s+2*l+2+2*n(r.Z.responsivePaddingHorizontal)+10,c="12px",u=72,h=6,g=12,p=10,m=30,f=448,_=16},560941:function(e,t,i){i.d(t,{Z:function(){return s},_:function(){return a}});var r=i(260963),n=i(158612);let a="timelineToolbarContribution";function o(e,t){return e.filter(e=>!!t[e.name]).map(e=>{var i,r;let{name:n,divider:a}=e,o=t[n];return{name:n,divider:a,controller:{getIsVisible:null===(i=o.getIsVisible)||void 0===i?void 0:i.bind(o),render:null===(r=o.render)||void 0===r?void 0:r.bind(o)}}})}class s{get leftControllers(){return o(this.controllerSlot.left,this.nameToController)}get centerControllers(){return o(this.controllerSlot.center,this.nameToController)}get rightControllers(){return o(this.controllerSlot.right,this.nameToController)}get audioRecorderToolControllers(){return o(this.controllerSlot.audioRecorderTool,this.nameToController)}registerController(e,t){(0,r.z)(()=>{this.nameToController[e]=t})}unregisterController(e){delete this.nameToController[e]}constructor(e){this._isTemplate=e,this.nameToController={},(0,r.ky)(this),this.controllerSlot=(0,n.F)(this._isTemplate)}}},298170:function(e,t,i){i.d(t,{Z:()=>A});var r=i("789786"),n=i("230689"),a=i("979159"),o=i("398016"),s=i("713910"),l=i("996442");i("86042");class d{establish(e){this.hlEffect(()=>(e&&this.context.store.establish(e),this.context.boxSelection.mount(this.context.store.vertivalContainer),()=>this.context.store.relinquish())),this.hlEffect(()=>(this.context.flyover.establish(),()=>this.context.flyover.relinquish())),this.hlEffect(()=>(this.context.reference.establish(),()=>this.context.reference.relinquish())),this.hlEffect(()=>(this.context.valid.$domSpace.appendTo(this.context.store.vertivalContainer),()=>{this.context.valid.$domSpace.removeFrom(this.context.store.vertivalContainer)})),this.hlEffect(()=>(this.context.unit.establish(),()=>this.context.unit.relinquish())),this.hlEffect(()=>(this.context.registry.establish(),()=>this.context.registry.relinquish())),this.hlEffectEmit()}relinquish(){this.hlEffectDisposerEmit()}constructor(e){this.context=new l.Z(e)}}let c=d=(0,r.gn)([s.s,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof CoordinateOptions?Object:CoordinateOptions])],d);var u=i("690674"),h=i("804497"),g=i("263224"),p=i("649962"),m=i("452026"),f=i("695324"),_=i("112825"),v=i("969242"),S=i("99891"),y=i("53927"),b=i("604351");class A{get context(){return this._core.context}get registry(){return this._core.context.registry}get renderManager(){return this._renderManager}get controllerManager(){return this._controllerManager}establish(e){return this._core.establish(e)}relinquish(){return this._core.relinquish()}on(e,t,i){return this.context.event.on(e,t,i)}off(e,t,i,r){return this.context.event.off(e,t,i,r)}setRenderManager(e){this._renderManager=e}makeController(e){return this._controllerManager=this._containerService.createInstance(b.d,this._store,e),this._controllerManager}_makeCoordinate(){var e,t;let{_store:i,_layoutManager:r}=this,{environment:n,timelineKeybinding:s,draftOperation:l,timelineToast:d,player:b,timelineSelection:A,sider:M,segmentManager:T,timelineEvent:w,draftDataSyncer:C,selection:I}=this._modules,{isTemplate:x}=n;return new c({store:i,switch:{move:!x,crop:!0,videoCrop:!0,boxSelection:!x,inspectPlaceholder:!x,unselectOnInnovate:!x},modules:{environment:n,timelineKeybinding:s,draftOperation:l,timelineToast:d,layoutManager:r},trigger:{...(e=this._store,{refreshSegment:()=>{let{tracks:t,tracksMutable:i}=e[u.U_],{selectedSegmentIds:r}=e[u.qk];e[u.qk].setSegmentSelected(e[u.qk].isEditingTemplate?(0,h.ed)(i,r):(0,h.kQ)(t,r))}}),...(0,g.L)({player:b,draftOperation:l,segmentManager:T,draftDataSyncer:C}),...(t=this._containerService,{handleAbsorb:e=>{(0,p.E)(t,{type:"move"===e?p.K.MOVE_MATERIAL:p.K.CROP})}}),...(0,m.Q)(this._store,{sider:M,player:b,timelineSelection:A,selection:I,event:w,draftOperation:l,coordinate:this},this._containerService),...function(e,t,i){let r=new Set,n=new Set,a=new Map,o=(e,t)=>{if(!a.has(e))a.set(e,t)},{draftOperation:s,player:l,coordinate:d}=t;return{escapeSegment:()=>{let t=e[u.qk].segmentSelected.filter(e=>"transition"!==e.type);if(!t.length)return[];let i=[];null==t||t.forEach(e=>{var t;r.add(e.id),i.push({id:e.id,visible:!1});let n=null===(t=e.slots)||void 0===t?void 0:t.find(e=>"transition"===e.type);n&&(r.add(n.id),i.push({id:n.id,visible:!1}))});let[a]=d.context.registry.track.findByIndex(0);if(a){let t=e[u.U_].zoomStore.value,n={},s=[...d.context.registry.segment.findByTrack(a.id),...d.context.registry.transition.findByTrack(a.id)];d.context.registry.segment.findByTrack(a.id).filter(e=>{let{id:t}=e;return r.has(t)}).forEach(e=>{for(let r of s){if(e.id!==r.id){if(r.start>e.start){let a=r.start-e.duration;if((0,_.OV)(r))o(r.id,{start:r.start}),d.context.registry.segment.update({id:r.id,start:a});else{var i;o(r.id,{start:r.start,segmentStart:r.segmentStart}),d.context.registry.transition.update({id:r.id,start:a,segmentStart:null===(i=d.context.registry.segment.findById(r.segmentId)[0])||void 0===i?void 0:i.start})}n[r.id]={x:(0,v.vY)(t,r.start)}}}}}),i.push(...Object.entries(n).map(e=>{let[t,{x:i}]=e;return{id:t,x:i}}))}d.context.registry.unregisterSegments(Array.from(r)).forEach(e=>n.add(e)),d.context.event.emit(_.B.batchUpdateStyle,i)},unescapeSegment:()=>{let t=e[u.U_].zoomStore.value,i=[];for(let[e,r]of(n.forEach(e=>{(0,_.OV)(e)?d.context.registry.segment.replace(e):d.context.registry.transition.replace(e)}),n.clear(),a.entries()))Object.prototype.hasOwnProperty.call(null!=r?r:{},"segmentStart")?d.context.registry.transition.update({id:e,...r}):d.context.registry.segment.update({id:e,...r}),i.push({id:e,x:(0,v.vY)(t,r.start)});a.clear(),r.forEach(e=>i.push({id:e,visible:!0})),r.clear(),d.context.event.emit(_.B.batchUpdateStyle,i)},handleDrop:e=>{if(!e.length){s.refreshTimelineTracks();return}(0,f.b)(i,{relatedEvent:f.Z.MoveMaterialSegment});let t=[];e.forEach(e=>{0===e.sourceTrackIndex&&0!==e.targetTrackIndex&&t.push(e.segmentId)});let r=s.batchStart();try{s.segment.multiSegmentMove(e)}catch{t.length&&s.undo()}s.batchEnd(r)},dragBefore:()=>{e[u.VT].unionPlaying&&l.pause(),e[u.U_].setIsDragging(!0)},dragEnd:()=>{e[u.U_].setIsDragging(!1)}}}(this._store,{player:b,draftOperation:l,event:w,coordinate:this},this._containerService),...(0,S.c)(this._store,{player:b,draftOperation:l,segmentManager:T},this._containerService),...(0,y.s)(i,{player:b,draftOperation:l,coordinate:this},this._containerService)},transfer:{segment:a.JY},generator:{segment:o.R}})}constructor(e,t,i,r){this._store=e,this._layoutManager=t,this._modules=i,this._containerService=r,this._core=this._makeCoordinate()}}A=(0,r.gn)([(0,r.fM)(3,n.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof LayoutManager?Object:LayoutManager,Object,void 0===n.t?Object:n.t])],A)},849435:function(e,t,i){i.d(t,{V:function(){return r}});let r=new Set(["combination","mutable","mutablePoly"])},843168:function(e,t,i){i.d(t,{J:function(){return r}});class r{constructor(e){this.context=e}}},283826:function(e,t,i){i.d(t,{Z:()=>d});var r=i("682205"),n=i("603577"),a=i("490446"),o=i("140041"),s=i("824951");let l=class e{reset(){this._dragScrollInfo=void 0}situation(){let e,t;let i={location:this._context.mouse.absolute},r=o.DE,n=this._context.unit.containerWidth*(1-o.j6),a=this._context.unit.containerHeight*o.A5,s=this._context.unit.containerHeight*(1-o.A5);return this._context.mouse.absolute&&(this._context.mouse.absolute.x<r?e={edge:"left"}:this._context.mouse.absolute.x>n&&(e={edge:"right"}),this._context.mouse.absolute.y<a?t={edge:"top"}:this._context.mouse.absolute.y>s&&(t={edge:"bottom"})),(e||t)&&(i.edgeScroll=[],e&&i.edgeScroll.push(e),t&&i.edgeScroll.push(t)),i}reflexInspect(e){(0,s.As)(e)?(this._dragScrollInfo=e.edgeScroll,this._startIntervalIfNotRunning()):this._dragScrollInfo=void 0}scrollTo(e){if(!!this._context.store.container)void 0!==e.top&&(this._context.store.vertivalContainer.scrollTop=e.top),void 0!==e.left&&(this._context.store.container.scrollLeft=e.left)}_startIntervalIfNotRunning(){if(!this._dragScrollInterval)this._dragScrollInterval=window.setInterval(this._intervalDragScroll,o.Y0)}_scrollContainer(e){if(!this._context.store.container)return;let{propName:t,step:i}=o.A4[e.edge];"scrollLeft"===t?this._context.store.container.scrollLeft+=i:"scrollTop"===t&&(this._context.store.vertivalContainer.scrollTop+=i)}constructor(e){this._context=e,this._intervalDragScroll=()=>{if(!this._dragScrollInfo){this._dragScrollInterval&&(window.clearInterval(this._dragScrollInterval),this._dragScrollInterval=void 0);return}for(let e of this._dragScrollInfo)this._scrollContainer(e)}}},d=class e{constructor(e){this._context=e,this.crop=new r.Z(e),this.drag=new n.Z(e),this.dragMulti=new a.Z(e),this.timeline=new l(e)}}},510093:function(e,t,i){i.d(t,{Z:function(){return m}});var r=i(827322),n=i(928725),a=i(72127),o=i(112825),s=i(928261),l=i(824951),d=i(804497),c=i(801497),u=i(767373),h=i(810233),g=i(65967),p=i(426336);let m=class e{get isMultiPlaceholder(){return this._multiPlaceholder.length>1}findSpace(e,t){let i=this._spaces.findIndex(i=>i.id===e&&i.position===t);return[this._spaces[i],i]}reset(){this._tracks=[],this._spaces=[],this._attach=[]}resetDrag(){this.reset(),this.$domSpace.hide(),this.hidePlaceholder(),this.$domPlaceholder.classList.remove("type-transition"),this.restoreTransitionSlotIcon(!0)}calculate(){if(!this.context.store.targetSegment)return;let{entities:e}=this.context.registry.track;(0,u.BQ)(e);let t=[],i=[],r=[],n=[];(0,s.Xe)(this.context.store.targetSegment)?(t=this.context.registry.segment.findCanBeAddTransition(),this.$domPlaceholder.classList.add("type-transition")):(i=e.filter(e=>(0,h.c)(e.availSegment,this.context.store.targetSegment)),r=e.filter(e=>(0,h.c)(e.availSegmentBefore,this.context.store.targetSegment)),n=e.filter(e=>(0,h.c)(e.availSegmentAfter,this.context.store.targetSegment))),t.sort(d.y_),this._attach=(0,u.Pc)("transition",this.context.store.zoom,this.context.registry.track.entities,t),this._tracks=i,this._spaces=[...r.map(u.VB.bind(null,"before")),...n.map(u.VB.bind(null,"after"))],(0,u.BQ)(this._tracks),(0,u._m)(this._spaces)}isShowSpaceImmediately(e){let{location:t,mouseTime:i}=e;return(0,g.NH)(this._spaces,t)||!this.canSegmentBePlacedNearby(i)}canSegmentBePlacedNearby(e){let{targetSegment:t}=this.context.store;if(!t)return!0;let i=this.context.unit.fixed2relative({x:0,y:this.context.mouse.fElement.y}),[r,n]=(0,g.e4)(this.context.registry.track.entities,i,this.context.registry.segment.draggedSegment);if(r){let i=this.context.registry.segment.findByTrack(r.id);if((0,h.c)(r.availSegment,t)&&(0,g.o)(t,i,e))return!0}if(n){let i=this.context.registry.segment.findByTrack(n.id);if((0,h.c)(n.availSegment,t)&&(0,g.o)(t,i,e))return!0}return!1}landTrack(e){return(0,g.NU)(this._tracks,e)}nearestSpace(e){return(0,g.i)(this._spaces,e)}nearestSlot(e){return(0,g._Y)(this._attach,e)}nearestSlotTransition(e){return(0,g.pr)(this._attach,e)}clearTransitionSlotIcon(e){this.context.event.emit(o.B.updateData,{id:e,isHideBg:!0,replaceHover:!0}),this._removeTransitionSegmentIdsMatched.add(e)}restoreTransitionSlotIcon(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._multiPlaceholder.map(e=>e.getAttribute("data-id"));for(let i of Array.from(this._removeTransitionSegmentIdsMatched))(e||t.every(e=>e!==i))&&(this.context.event.emit(o.B.updateData,{id:i,isHideBg:!1,replaceHover:!1}),this._removeTransitionSegmentIdsMatched.delete(i))}isInsideTransitionArea(e){let t=document.querySelector(".type-transition");if(!t)return!1;let{offsetWidth:i,offsetHeight:r}=t,n=this.context.unit.fixed2relative({x:0,y:this.context.mouse.fElement.y}),a=this.context.unit.us2px(this.context.reference.trElement),o=n.y+10,s=this.context.unit.us2px(e.places[0].start),l=this.context.unit.us2px(e.places[0].duration),d=e.track.startY,c=e.track.refEl.height;return(0,g.L9)([a,o,i,r],[s,d,l,c])}showTransitionWillLostPlaceholder(e,t,i){let r=[];if(t.prevTransition){let e=p.pMA.div(i.duration,2,"bigint");r.push({start:i.start-p.pMA.div(e,2,"bigint"),duration:e})}if(t.transition){let e=p.pMA.div(i.duration,2,"bigint");r.push({start:i.start+i.duration-p.pMA.div(e,2,"bigint"),duration:e})}this.showMultiPlaceholder([{track:e,places:r}],["style-placeholder-warn"])}showMultiPlaceholder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,n=-1;for(let{track:o,places:s}of e){if(!(null==o?void 0:o.refEl))return;s.forEach(e=>{var s,l,d,c;let{start:u,duration:h,segment:g}=e;n+=1;let p=this._multiPlaceholder[n],m=(null===(l=this._multiPlaceholder[n])||void 0===l?void 0:null===(s=l.style)||void 0===s?void 0:s.display)==="none";!p&&(this._multiPlaceholder[n]=(0,a.V5)("div",["coordinate-segment","style-placeholder",`multi-${n}`,...null!=t?t:[]]));let f=this._multiPlaceholder[n];if(p&&!m&&i)return;let _=Math.max(this.context.unit.us2px(h),1),v=this.context.unit.us2px(u);if(f.style.width=`${_}px`,f.style.left=`${v}px`,f.style.top=`${o.refEl.y}px`,f.style.height=`${o.refEl.height}px`,f.style.display="block",!(null===(d=this.context.store.container)||void 0===d?void 0:d.contains(f))){let e=null===(c=this.context.store.container)||void 0===c?void 0:c.querySelector(".timeline-large-container");null==e||e.appendChild(f)}null==r||r(f,h,g)})}}removeMultiPlaceholder(){this._multiPlaceholder.length&&(this._multiPlaceholder.forEach(e=>{(0,a.LW)(e,"remove multi placeholder failed")}),this._multiPlaceholder=[]),this.restoreTransitionSlotIcon()}showPlaceholder(e,t,i){var r,n;if(void 0===i||!(null==e?void 0:e.refEl))return;let a=Math.max(this.context.unit.us2px(i),1),o=this.context.unit.us2px(t);if(this.$domPlaceholder.style.width=`${a}px`,this.$domPlaceholder.style.left=`${o}px`,this.$domPlaceholder.style.top=`${e.refEl.y}px`,this.$domPlaceholder.style.height=`${e.refEl.height}px`,this.$domPlaceholder.style.display="block",!(null===(r=this.context.store.container)||void 0===r?void 0:r.contains(this.$domPlaceholder))){let e=null===(n=this.context.store.container)||void 0===n?void 0:n.querySelector(".timeline-large-container");null==e||e.appendChild(this.$domPlaceholder)}}hidePlaceholder(){this.$domPlaceholder&&(this.$domPlaceholder.style.display="none"),this._multiPlaceholder.length&&this._multiPlaceholder.forEach(e=>{e.style.display="none"})}showSpace(e,t){let i;if("string"==typeof e&&t){if([i]=this.findSpace(e,t),!i)return}else i=e;let r=this.context.unit.scrollLeft;this.context.unit.scrollLeft<=this.context.store.operationWidthInner&&(r=this.context.unit.scrollLeft+Math.min(this.context.store.operationWidthInner-this.context.unit.scrollLeft,this.context.store.operationWidthInner)),this.$domSpace.show({x:r,y:(i.startY+i.endY)/2})}hideSpace(){this.$domSpace.hide()}showTips(e,t,i){let n=document.querySelector(".timeline-bd-container");if(!n)return;let a="";switch(i){case l.jC.lostTransitionWhenCrop:a=c.ZP.t("web_transition_toast_transition_be_lost",{},"Clip too short. Transition will be removed.");break;case l.jC.NoAvailableSlot:a=c.ZP.t("web_transition_toast_between_two_clips",{},"Transitions can only be added between 2 consecutive clips"),this.context.userConfig.modules.timelineToast.normal(a);return}let o=this.context.unit.us2px(null!=t?t:0n)-this.context.unit.scrollLeft,s=e;if(!e){var d;let e=this.context.unit.fixed2relative({x:0,y:this.context.mouse.fElement.y}),[t]=(0,g.e4)(this.context.registry.track.entities,e,this.context.registry.segment.draggedSegment);s=null!==(d=null==t?void 0:t.startY)&&void 0!==d?d:0}this.$domTip.innerHTML=(0,r.J)(a,null,{logType:"js.innerHTML",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),this.$domTip.style.top=`${s}px`,this.$domTip.style.left=`${o}px`,n.appendChild(this.$domTip)}hideTips(){this.$domTip&&(0,a.LW)(this.$domTip,"remove placeholder failed")}constructor(e){this.$domTip=(0,a.V5)("div",["timeline-tip"]),this.$domPlaceholder=(0,a.V5)("div",["coordinate-segment","style-placeholder"]),this._multiPlaceholder=[],this._tracks=[],this._spaces=[],this._attach=[],this._removeTransitionSegmentIdsMatched=new Set,this.context=e,this.$domSpace=new n.Z(this.context)}}},574063:function(e,t,i){i.d(t,{D:function(){return u}}),i(966156);var r=i(368100),n=i(823404),a=i(68659),o=i(858151),s=i(690674),l=i(813072),d=i(373722),c=i(402655);class u extends c.JT{_checkDataSdkAndStore(){let e=this._dataSdk.draftView.getAllTracks(),t=(0,a.Xf)(e,this._dataSdk),{tracks:i}=this._timelineManagerStore[s.U_],c=[],u=[];for(let e=0;e<t.length;e++){let[r]=t[e],a=null,s=-1;for(let e=0;e<i.length;e++){let[t]=i[e];if(!(0,o.sH)(t.id)){if(s++,t.id===r.id){a=t;break}}}if(!a){c.push({benchmark:r,target:null,isIndexError:!1});continue}s!==e&&c.push({benchmark:r,target:a,isIndexError:!0}),!(0,l.Z)((0,d.Z)(r,"segments"),(0,d.Z)(a,["segments"]))&&c.push({benchmark:r,target:a,isIndexError:!1});let h=r.segments,g=a.segments;u.push(...function(e,t){let i=[];for(let r=0;r<e.length;r++){let a=e[r],o=null,s=-1;for(let e=0;e<t.length;e++){let i=t[e];if(!(0,n.Mo)(i.id)){if(s++,i.id===a.id){o=i;break}}}if(!o){i.push({benchmark:a,target:null,isIndexError:!1});continue}if(s!==r){i.push({benchmark:a,target:o,isIndexError:!0});continue}!(0,l.Z)(a,(0,d.Z)(o,"mutable"))&&i.push({benchmark:a,target:o,isIndexError:!1})}return i}(h,g))}(c.length||u.length)&&(r.Z.error({title:"data check error",content:"timeline"}),console.error("\u300Ctimeline incremental rendering\u300D: check error",c,u))}constructor(e,t,i){super(),this._dataSdk=e,this._draftDataSynchronizer=t,this._timelineManagerStore=i}}},173828:function(e,t,i){i.d(t,{Q5:function(){return s},cP:function(){return l},pq:function(){return o}});var r=i(620266),n=i(426336),a=i(136498);let o="mutable-track",s="mutable-audio-track",l={name:"cut-same-mutable-default",runner:(e,t,i)=>{let{mode:o,dataSdk:s,store:l}=i,{sourceFrom:d}=t;if(o!==r.s.TRACKS_MUTABLE||d!==r.G.DATA_SDK)return;let{segment:c,track:u}=e,{value:h}=t,{[n.u4I.SEGMENT]:g}=h,p=new Map;g.forEach(e=>{let t;let{item:i,type:r}=e;t=r===n.C8.ADD?i.segment.id:i.id;let a=p.get(t);!a&&p.set(t,a=[]),a.push(e)}),[...p.entries()].forEach(t=>{let[r,n]=t,o=(0,a.t_)({segmentId:r,notifySegmentOperation:n,collectionMap:e},i);o&&c.push(o)})}}},867508:function(e,t,i){i.d(t,{v:function(){return c}});var r=i(620266),n=i(690674),a=i(823404),o=i(248222),s=i(345299),l=i(173828),d=i(426336);let c={name:"lockMutable",runner:(e,t,i)=>{let{sourceFrom:c}=t;if(c!==r.G.DATA_SDK)return;let{store:u,dataSdk:h}=i,{tracksMutable:g}=u[n.U_],p=g[0],{segment:m}=e;if(p){var f;let e=null!==(f=h.draftView.getDraftById(u[n.qk].subDraftId))&&void 0!==f?f:h.draftView,[t]=p,{segments:i}=t,r=e.getDuration();for(let t=0;t<i.length;t++){let c=i[t],{start:h,duration:g}=c;if((0,a.C0)(c.id)){let a;let p=i[t+1],f=i[t-1];if(f&&p){let i=f.start+f.duration,r=p.start-i;if(h!==i||g!==r){let h=(0,o.ES)(i,r,{draftView:e,parentSegment:u[n.qk].subDraftSegment});h.id=c.id,a={type:s.P.UPDATE,prevValue:c,nextValue:h,nextIndex:t,prevIndex:t,prevTrackId:l.pq,nextTrackId:l.pq,notifyOperationList:[{type:d.C8.UPDATE,order:0,item:{id:c.id,segment:{targetTimerange:{start:h.start,duration:h.duration}},segmentType:d.Ocy.SegmentVideo,trackIndex:0}}]}}}else if(f){let i=f.start+f.duration,p=r-h;if(p<100000n)a={type:s.P.DELETE,prevValue:c,nextIndex:-1,prevIndex:t,nextValue:null,notifyOperationList:[],nextTrackId:null,prevTrackId:l.pq};else if(h!==i||p!==g){let r=(0,o.ES)(i,p,{draftView:e,parentSegment:u[n.qk].subDraftSegment});r.id=c.id,a={type:s.P.UPDATE,prevValue:c,nextValue:r,nextIndex:t,prevIndex:t,prevTrackId:l.pq,nextTrackId:l.pq,notifyOperationList:[{type:d.C8.UPDATE,order:0,item:{id:c.id,segment:{targetTimerange:{start:r.start,duration:r.duration}},segmentType:d.Ocy.SegmentVideo,trackIndex:0}}]}}}else if(p){let i=p.start;if(i!==g){let r=(0,o.ES)(0n,i,{draftView:e,parentSegment:u[n.qk].subDraftSegment});r.id=c.id,a={type:s.P.UPDATE,prevValue:c,nextValue:r,nextIndex:t,prevIndex:t,prevTrackId:l.pq,nextTrackId:l.pq,notifyOperationList:[{type:d.C8.UPDATE,order:0,item:{id:c.id,segment:{targetTimerange:{start:r.start,duration:r.duration}},segmentType:d.Ocy.SegmentVideo,trackIndex:0}}]}}}a&&m.push(a)}}}}}},439143:function(e,t,i){i.d(t,{y:function(){return l}});var r=i(620266),n=i(345299),a=i(690674),o=i(800788),s=i(426336);let l={name:"trackIndex",runner:(e,t,i)=>{let{mode:l,store:d}=i;if(l!==r.s.TRACKS)return;let{tracks:c}=d[a.U_],{track:u}=e,h=Number.MAX_SAFE_INTEGER,g=new Map;u.forEach(e=>{let{type:t,nextValue:i,prevValue:r}=e;switch(t){case n.P.ADD:(0,o.Y2)(i),h=Math.min(h,e.nextIndex),g.set(i.id,e);break;case n.P.UPDATE:(0,o.Y2)(i),g.set(i.id,e);break;case n.P.DELETE:(0,o.Y2)(r),h=Math.min(h,e.prevIndex),g.set(r.id,e);break;default:(0,o.bP)(t)}});for(let e=h;e<c.length;e++){let[t]=c[e],{id:i}=t;!g.has(i)&&u.push({type:n.P.UPDATE,prevValue:t,nextValue:t,prevIndex:e,nextIndex:e,notifyOperationList:[{order:0,type:s.C8.UPDATE,item:{trackId:t.id,trackIndex:e,track:{}}}]})}}}},345299:function(e,t,i){i.d(t,{A:function(){return o},P:function(){return a}});var r,n,a=((r={}).ADD="add",r.UPDATE="update",r.DELETE="delete",r);var o=((n={}).SEGMENT="segment",n.TRACK="track",n)},635186:function(e,t,i){i.d(t,{d:function(){return M}}),i(966156);var r=i(368100),n=i(722169),a=i(426336),o=i(248222),s=i(690674),l=i(804497),d=i(928261),c=i(587892),u=i(800788),h=i(801497),g=i(425427),p=i(426020),m=i(574132),f=i(956626),_=i(322401),v=i(789193),S=i(199811),y=i(693511),b=i(953211),A=i(755945);class M{get onTracksMutableChange(){return this._onTracksMutableChange.event}_getDraftViewAndDraftId(){var e;let t=null!==(e=this._segmentSelection.subDraftId)&&void 0!==e?e:this._dataSdk.draftView.getDraftId(),i=t===this._dataSdk.draftView.getDraftId()?this._dataSdk.draftView:this._dataSdk.draftView.getDraftById(t);return(0,u.Y2)(i,`draftView ${t} should be exist`),{draftId:t,draftView:i}}_deleteMutableAudioFromTemplate(e){if(!(0,g.JY)(this._environmentService))return;let t=this._mainDraftService.draftTemplateManager.getTemplateId(),i=this._templateInfoManager.templateIdToInfo[t];if(!!(null==i?void 0:i.mute))(e=>{let{mutableAudios:t}=i.preload,r=e.filter(e=>t.some(t=>e.material.id===t.id)).map(e=>e.id);r.length&&this._mainDraftService.dataSdk.api.segment.delete({segIds:r})})(this._mainDraftService.dataSdk.draftView.getAllSegments().filter(a.Y9Q).filter(t=>e.some(e=>e.segmentId!==t.id)))}setMutableVideos(e){var t;let{mutableVideoList:i,dragData:r}=e;if(!this._checkAvailability(i.map(e=>({mutableId:e.id,type:r.type,value:r.dragSource}))))return Promise.resolve({result:(0,_.$)(v.F.ReplaceCheck),performanceDuration:0});let n=null!==(t=this._store[s.qk].subDraftId)&&void 0!==t?t:this._dataSdk.draftView.getDraftId(),a=i.map(e=>{var t;return{type:r.type,value:r.dragSource,volume:e.volume,sourceStartTime:0n,mutableVideoId:e.id,initialSpeed:null!==(t=this._dataSdk.cutSame.segmentId2initialSpeed[e.segmentId])&&void 0!==t?t:1,visible:e.visible}});return this._replaceSegmentManager.replaceMutableVideo(a,n)}addMaterialToTrackReport(e){var t;let{model:i,waitTime:r,status:n,mountType:a}=e,o={actionType:"click",addFrom:this._store[s.U_].isBatchReplacePanelVisible||a===A.j.ElementChild?"slots":"track",batchCnt:1,optionType:"replace",status:n,materialName:i.filename,storage:String(i.size),isFastImport:null==i?void 0:null===(t=i.uploading)||void 0===t?void 0:t.isSupportFastImport,materialId:i.id,clipType:"bubble",waitTime:r};i.fileType===p.YB.Audio?(0,m.QU)(this._containerService,{...o}):(i.fileType===p.YB.Video||i.fileType===p.YB.Image)&&(0,m.QU)(this._containerService,{resolution:i.height&&i.width?`${i.height} * ${i.width}`:void 0,...o})}setMutableAudios(e){var t;let{mutableAudioList:i,dragData:r}=e,n=null!==(t=this._store[s.qk].subDraftId)&&void 0!==t?t:this._dataSdk.draftView.getDraftId();return this._deleteMutableAudioFromTemplate(i),this._replaceSegmentManager.replaceMutableAudio(i.map(e=>{let t=a.pMA.times(r.dragSource.duration,1000000n,"bigint");return{sourceStart:0n,sourceDuration:a.pMA.min([e.sourceDuration,t],"bigint"),segmentId:e.segmentId,targetStart:e.targetStart,targetDuration:a.pMA.min([e.targetDuration,t],"bigint"),type:r.type,value:r.dragSource}}),n)}updateMutableAudios(e){var t;let i=null!==(t=this._store[s.qk].subDraftId)&&void 0!==t?t:this._dataSdk.draftView.getDraftId();this._dataSdk.api.template.setMutableAudios({audios:e,draftId:i})}resetSegmentMutable(e){let{segmentMutable:t,segment:i,subDraftId:n}=this._store[s.qk];if(this._resetSegmentMutableLock||(0,a.OvQ)(t)&&!t.filled||!i)return Promise.resolve(!1);let o=(0,a.Y9Q)(i),l=h.ZP.t("web_remove_the_material_from_this_slot",{},"\u786E\u8BA4\u8981\u5C06\u8FD9\u4E2A\u5185\u5BB9\u4ECE\u69FD\u4F4D\u4E2D\u5220\u9664\u5417\uFF1F"),d="";return o&&(l=h.ZP.t("web_musicreplace_text_delete_music",{},"Delete sound?"),d=h.ZP.t("web_musicreplace_toast_delete_music",{},"The template may not have a good performace if you delete the sound.")),this._resetSegmentMutableLock=!0,new Promise((c,g)=>{r.Z.confirm({title:l,content:d,okButtonProps:{status:"danger"},okText:h.ZP.t("web_delete",{},"\u5220\u9664"),cancelText:h.ZP.t("web_cancel",{},"\u5173\u95ED"),icon:null,onCancel:()=>{c(!1)},onOk:()=>{var r;if(o){this._dataSdk.api.segment.delete({segIds:[i.id]});return}(0,f.SH)(this._containerService,{action_type:e,option_type:f.Ds.DELETE,action_position:f.X3.VIDEO,position_type:this._store.timelineStore.isBatchReplacePanelVisible?f.o7.BATCH_REPLACE:f.o7.TIMELINE,...(0,S.N)(i.id,!1,this._store[s.U_].tracksMutable)}),(0,u.Y2)((0,a.OvQ)(t));let l=null!=n?n:this._dataSdk.draftView.getDraftId();this._replaceSegmentManager.resetMutableVideo([t.id],l);let d=this._mutableReplaceTaskManager.get(t.id);null==d||null===(r=d.token)||void 0===r||r.reset(),c(!0)},afterClose:()=>{this._resetSegmentMutableLock=!1,c(!0)}})})}resetSegmentMutableStatus(e){let{mutableIds:t}=e;for(let e of t){var i;let t=this._mutableReplaceTaskManager.get(e);null==t||null===(i=t.token)||void 0===i||i.reset()}}async refreshMutableTracks(e,t){var i,r,n,c,u,h,g;let{mutableVideos:p,mutableAudios:m}=t;if(y.$)return;let{subDraft:f,subDraftSegment:_}=this._store[s.qk],{duration:v}=(null!=f?f:e).getDraftMetadata(),[S,b]=null!==(c=null===(i=this._store[s.U_])||void 0===i?void 0:i.tracksMutable)&&void 0!==c?c:[];if(p){let e=p.filter(e=>{let{targetStart:t,targetDuration:i}=e,{sourceTimerange:{start:r=t,duration:n=i}={}}=null!=_?_:{};return(0,a.edG)([t,t+i],[r,r+n])});S=[(0,o.Z)(e,v,this._mainDraftService.subDraftApplySpeedViewManager,_),0]}if(this._store[s.U_].isTemplate&&m){if(this._recoveryTemplateInfoLoaded){let e=await this._templateInfoManager.getTemplateInfo(this._mainDraftService.draftTemplateManager.getTemplateId());if(e.mute){let t=await this._excludeMutableAudiosFromTemplate(this._dataSdk.cutSame.getMutableAudios()),i=(0,o.qu)(t,this._mainDraftService.subDraftApplySpeedViewManager,{parentSegment:this._store[s.qk].subDraftSegment,shouldHideAudioName:!0,videoTemplate:e});b=(0,l.hW)([i,1],v)}else b=e.canUpdateMusic?(0,l.hW)([(0,o.qu)(this._dataSdk.cutSame.getMutableAudios(),this._mainDraftService.subDraftApplySpeedViewManager,{shouldHideAudioName:!0,videoTemplate:e,parentSegment:this._store[s.qk].subDraftSegment}),1],v):null}else b=null}let A=[S,b].filter(Boolean),[M]=null!=S?S:[];if(M){let t=M.segments.filter((0,d.be)("mutablePoly")),i={...M};i.segments=t,this._store[s.U_].setTracksMutablePoly(e.getDraftId(),i);let r=M.segments.filter((0,d.be)("mutable")).filter(e=>{var t;return null===(t=e.mutable)||void 0===t?void 0:t.locked});this._store[s.U_].setTracksMutableLocked(e.getDraftId(),{...M,segments:r})}this._store[s.U_].setTracksMutable(A);let T=null!==(u=null==_?void 0:null===(r=_.targetTimerange)||void 0===r?void 0:r.start)&&void 0!==u?u:0n;this._store[s.U_].setTrackStartTime(T),this._store[s.U_].setTrackEndTime(a.pMA.plus(T,null!==(g=null!==(h=null==_?void 0:null===(n=_.targetTimerange)||void 0===n?void 0:n.duration)&&void 0!==h?h:v)&&void 0!==g?g:0n,"bigint")),this._onTracksMutableChange.fire(A)}setMutableVisible(e){var t;let{segmentId:i,visible:r}=e;this._dataSdk.api.segment.visible({segmentId:i,visible:r,draftId:null!==(t=this._segmentSelection.subDraftId)&&void 0!==t?t:""})}constructor(e,t,i,r,o,l,d,u,h,g,p){this._dataSdk=e,this._store=t,this._replaceSegmentManager=i,this._segmentSelection=r,this._mainDraftService=o,this._resource=l,this._containerService=d,this._environmentService=u,this._mutableReplaceTaskManager=h,this._checkAvailability=g,this._templateInfoManager=p,this._resetSegmentMutableLock=!1,this._recoveryTemplateInfoLoaded=!1,this._onTracksMutableChange=new c.Q,this._getMutableAudioIdsFromTemplate=(0,n.memoize)(async()=>{let e=this._mainDraftService.draftTemplateManager.getTemplateId(),{preload:t}=await this._templateInfoManager.getTemplateInfo(e);return t.mutableAudios.map(e=>e.id)}),this._excludeMutableAudiosFromTemplate=async e=>{let t=await this._getMutableAudioIdsFromTemplate();return e.filter(e=>!t.includes(e.id))},this.onMutableAudioChanged=e=>{let{draftView:t}=this._getDraftViewAndDraftId();this.refreshMutableTracks(t,{mutableAudios:e})},this.onMutableTextChanged=e=>{},this.onMutableVideoChanged=e=>{let{draftView:t}=this._getDraftViewAndDraftId();this.refreshMutableTracks(t,{mutableVideos:e})},this._refreshRelationGroupColorMap=e=>{let t=(0,b.r)(e);this._store[s.U_].setRelationGroupColorMap(t)},this._refreshMutableTracksWhenTargetTimeRangeChanged=e=>{let{[a.u4I.SEGMENT]:t}=e,i=t.find(e=>{var t,i;return e.type===a.C8.ADD?e.item.segment.id===(null===(t=this._segmentSelection.subDraftSegment)||void 0===t?void 0:t.id):e.item.id===(null===(i=this._segmentSelection.subDraftSegment)||void 0===i?void 0:i.id)});if(i&&i.item.segment.targetTimerange){let{draftView:e,draftId:t}=this._getDraftViewAndDraftId();this.refreshMutableTracks(e,{mutableVideos:this._dataSdk.cutSame.draftIdToMutableVideos[t],mutableAudios:this._dataSdk.cutSame.draftIdToMutableAudios[t]})}},this._segmentSelection.onMutableVideosChange(this.onMutableVideoChanged),this._segmentSelection.onMutableAudiosChange(this.onMutableAudioChanged),this._segmentSelection.onMutableTextsChange(this.onMutableTextChanged),this._segmentSelection.onRelationVideoGroupChange(this._refreshRelationGroupColorMap),this._dataSdk.onChangeDiff(this._refreshMutableTracksWhenTargetTimeRangeChanged),this._templateInfoManager.onTemplateInfoLoaded(()=>{this._recoveryTemplateInfoLoaded=!0;let{draftId:e,draftView:t}=this._getDraftViewAndDraftId(),i=this._dataSdk.cutSame.draftIdToMutableAudios[e];i&&this.refreshMutableTracks(t,{mutableAudios:i})})}}},402725:function(e,t,i){i.d(t,{J:function(){return a}});var r=i(789786),n=i(425427);class a{get isDev(){return this._videoEnvironmentService.isDev}get isProd(){return this._videoEnvironmentService.isProd}get isTemplate(){return(0,n.JY)(this._videoEnvironmentService)}constructor(e){this._videoEnvironmentService=e}}a=(0,r.gn)([(0,r.fM)(0,n.rO),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===n.rO?Object:n.rO])],a)},584715:function(e,t,i){i.d(t,{H:function(){return a}});var r=i(690674),n=i(460254);class a{_classifyMimeType(e){return e.startsWith("video/")?"video":e.startsWith("image/")?"photo":""}onDragEnter(e){var t;let i;if(this._coordinate.context.store.disable)return;let r=(null===(t=e.dataTransfer)||void 0===t?void 0:t.items)||[];if(1!==r.length)return;let a=r[0],o=this._classifyMimeType(a.type);if(!!o){switch(o){case"video":i=n.r.UserVideo;break;case"photo":i=n.r.UserPhoto;break;default:throw Error("not support file type")}this._dataTransfer={type:i,sourceFrom:"browser-outside",dragSource:{duration:0,duration_ms:0}},this._dataTransfer&&this._coordinate.context.flyover.innovateStart(e,this._dataTransfer)}}onDragOver(e){this._dataTransfer&&this._coordinate.context.flyover.handleDraggingLocalFileOver(e,this._dataTransfer)}onDragLeave(){this._store[r.U_].isBatchReplacePanelVisible&&(this._dataTransfer=void 0),this._coordinate.context.flyover.handleDraggingLocalFileLeave()}constructor(e,t){this._store=e,this._coordinate=t}}},252205:function(e,t,i){i.d(t,{k:function(){return m}});var r=i(959292),n=i(690674),a=i(29188),o=i(632555),s=i(544009),l=i(426336),d=i(587892),c=i(857670),u=i(371140),h=i(72127),g=i(886858),p=i(446352);class m{get onPlayProgressChange(){return this._onPlayProgressChange.event}get status(){return this._playerManager.status}get isRangePlay(){return this._playerManager.status.isRangePlaying}get isDisabledSeek(){return this._isDisabledSeek}get onEnd(){return this._playerManager.onEnd}get onPlay(){return this._playerManager.onPlay}get onPause(){return this._playerManager.onPause}setRenderManager(e){this._renderManager=e}pause(){this._playerManager.pause()}play(){this._playerManager.play()}rangePlay(e,t,i){this._playerManager.rangePlay(e,t,i)}seekToTime(e){return this._playerManager.seek(e),e}seekPrevFrame(){this._playerManager.seekPrevFrame()}seekNextFrame(){this._playerManager.seekNextFrame()}timelineSeekAfterAdd(e){let t=this._dataSdk.draftView.getSegmentById(e);if(!!t)(0,l.Q2R)(t)?this.timelineSeekToTextTemplateCompletelyPresented(t,!0):(this.timelineSeekToSegmentEnterAnimationEnd(t,0n,!0),(0,l.Ftn)(t)&&l.pMA.minus(t.targetTimerange.start,this._store[n.U_].progress))}timelineScrollToTimestamp(e){let{value:t}=this._store[n.U_].zoomStore;!(0,h.uD)(e,t)&&(0,h.xC)(e,t)}async timelineSeekAndScrollToMutable(e){let t=await (0,s.HA)(e,this._store[n.qk].subDraftSegment,this._renderManager,this._dataSdk,this._selection);if(null!==t)this._playerManager.pause(),this.timelineSeek(t),this.timelineScrollToTimestamp(t)}timelineSeekToTextTemplateCompletelyPresented(e){var t,i;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(null!==(t=e.material.textInfoResources)&&void 0!==t?t:[]).map(g._),a=l.pMA.max(n,"bigint"),o=(null!==(i=e.targetTimerange.start)&&void 0!==i?i:0n)+a;r?this._playerManager.seekAndPause(o):this.timelineSeek(o,!1),this.timelineScrollToTimestamp(o)}timelineSeekToSegmentEnterAnimationEnd(e){var t,i,r,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0n,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{progress:d}=this._store[n.U_],c=null===(t=e.animations)||void 0===t?void 0:t.animations.find(e=>"in"===e.type),u=null===(i=e.animations)||void 0===i?void 0:i.animations.find(e=>"out"===e.type),h=null!==(r=null==c?void 0:c.duration)&&void 0!==r?r:0n,g=null!==(a=null==u?void 0:u.duration)&&void 0!==a?a:0n,p=d===e.targetTimerange.start?0n:o,m=e.targetTimerange.start+l.pMA.max([h,p],"bigint"),f=e.targetTimerange.start+e.targetTimerange.duration-l.pMA.max([g,p],"bigint"),_=l.pMA.min([m,f],"bigint");s?this._playerManager.seekAndPause(_):this.timelineSeek(_,!1,void 0,"ceil"),this.timelineScrollToTimestamp(_)}timelineSeekBySegmentId(e){}videoPreviewSeek(e){if(e<=0?e=0:e>=this._store[n.VT].videoPreviewDuration&&(e=this._store[n.VT].videoPreviewDuration),!(0,o.mK)(e,[0,this._store[n.VT].videoPreviewDuration]))return}flushSeekCmd(){this._playerManager.flushSeekCmd()}getCurrentPosition(){return this._playerManager.status.progress}on(e,t){}off(e,t){}seekWithSpeed(e,t,i,r,n){this._playerManager.seekWithSpeed(e,i,r)}setIsDisabledSeek(e){this._isDisabledSeek=e}refreshTimelineProgress(){this._store[n.U_].setTimelineProgress(this._playerManager.status.progress)}constructor(e,t,i,o,s){var h=this;this._dataSdk=e,this._playerManager=t,this._store=i,this._renderManager=o,this._selection=s,this._isDisabledSeek=!1,this.timelineSeek=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.H.seekDone,i=arguments.length>3?arguments[3]:void 0;if(h._isDisabledSeek)return;let a=e,o=h._dataSdk.draftView.getDuration();a<0n?a=0n:a>o&&(a=o);let s=a===o?o:(0,c.i1)(a,i);!h._store[n.U_].decoupling.progress&&h._store[n.U_].setTimelineProgress(s),h._playerManager.seek(s,t)},this.timelineSeekWithSpeed=e=>{if(this._isDisabledSeek)return;this._playerManager.status.isPlaying&&this.pause();let{leftLimit:t,rightLimit:i}=null!=e?e:{},{timestamp:r,durationSpeed:o,pxSpeed:s}=null!=e?e:{};if(void 0===t&&(t=0n),void 0===i){var d;i=null!==(d=this._dataSdk.draftView.getDraftDuration())&&void 0!==d?d:0n}let c=r;c<=t?c=t+a.CZ:c>=i&&(c=i-a.CZ);let{videoPreviewStatus:u}=this._store[n.VT];u===p.bC.Playing||u===p.bC.OnDisplay?this.videoPreviewSeek(l.pMA.div(c,1e3)):this._playerManager.seekWithSpeed(c,o,s)},this._onPlayProgressChange=new d.Q,this._playerManager.onProgress((e,t)=>{let{[n.U_]:i}=this._store,{timelinePreviewLineStatus:r,timelinePreviewMutableSlotStatus:a,decoupling:{progress:o}}=i;!o&&r===u.$o.DISABLE&&a===u.$o.DISABLE&&i.setTimelineProgress(e),this._onPlayProgressChange.fire(e,!!t)}),this._playerManager.onPause(()=>{this._store[n.VT].setUnionPlaying(!1)}),this._playerManager.onPlay(()=>{this._store[n.VT].setUnionPlaying(!0)}),this._playerManager.onEnd(()=>{this._store[n.VT].setUnionPlaying(!1)})}}},5138:function(e,t,i){i.d(t,{w:()=>D});var r=i("789786"),n=i("650248"),a=i("587892"),o=i("402655"),s=i("690674"),l=i("230689"),d=i("426336"),c=i("895955"),u=i("153107"),h=i("936800"),g=i("58781"),p=i("375197"),m=i("849002"),f=i("596112"),_=i("127830"),v=i("810883"),S=i("684685"),y=i("242785"),b=i("906136");let A={id:Symbol.for("__parse_get_resource_sprites__"),CONCURRENCY_INIT:10,CONCURRENCY_AFTER_FIRST_FRAME:100},M={id:Symbol.for("__parse_split__"),CONCURRENCY_INIT:0,CONCURRENCY_AFTER_FIRST_FRAME:100};class T{get onReady(){return this._onReady.event}addTask(e,t){var i,r;let n=t.value.key;!this._resourceStatusMap[n]&&(this._resourceStatusMap[n]={});let a=[],o=()=>this._onReady.fire({resourceKey:n});return(e===g.U.Photo?this._resourceStatusMap[n].sprites=h.o.Empty:e===g.U.Video&&!this._resourceStatusMap[n].sprites&&(t.value.type===_._g.UserVideo&&(null===(i=t.value.thumb)||void 0===i?void 0:i.isFromFallback)?this._resourceStatusMap[n].sprites=h.o.Error:a.push(this._parseSprites(t,n).then(o))),!this._resourceStatusMap[n].cover&&(t.value.type!==_._g.UserVideo||!(null===(r=t.value.cover)||void 0===r?void 0:r.isFromFallback))&&a.push(this._parseCover(t,n).then(o)),a.length)?a[0]:Promise.resolve()}async _parseCover(e,t){let i=setTimeout(()=>{this._resourceStatusMap[t].cover=h.o.Timeout},0);try{this._resourceStatusMap[t].cover=h.o.Pending;let i=await (0,v.S)(e);this._store[s.jU].setCover(t,i),this._resourceStatusMap[t].cover=h.o.Ready}catch{this._resourceStatusMap[t].cover=h.o.Error}finally{clearTimeout(i)}}async _parseSprites(e,t){let i=setTimeout(()=>{this._resourceStatusMap[t].sprites=h.o.Timeout},0);return this._resourceStatusMap[t].sprites=h.o.Pending,new Promise(async r=>{await this._graphicToolkitServiceBarrier.wait();let{getResourceSpritesTask:n,splitSpritesTask:a}=(0,S.wX)(e,this._graphicToolkitService),o=await new Promise(e=>{this._schedulerService.postTask(()=>{e(n())},{groupId:A.id,priorityLevel:p.q.IdlePriority})});this._schedulerService.postTask(async()=>{try{let e=await a(o);this._store[s.jU].setSprites(t,e),this._resourceStatusMap[t].sprites=h.o.Ready}catch{this._resourceStatusMap[t].sprites=h.o.Error}finally{clearTimeout(i)}r()},{groupId:M.id,priorityLevel:p.q.IdlePriority})})}afterFirstFrame(){this._schedulerService.updateGroup(A.id,{groupId:A.id,concurrency:A.CONCURRENCY_AFTER_FIRST_FRAME}),this._schedulerService.updateGroup(M.id,{groupId:M.id,concurrency:M.CONCURRENCY_AFTER_FIRST_FRAME})}constructor(e,t,i,r,n){this._store=e,this._resourceStatusMap=t,this._schedulerService=i,this._teaAdapterService=n,this._onReady=new a.Q,this._graphicToolkitServiceBarrier=new m.U,this._schedulerService.registerGroup({groupId:A.id,concurrency:A.CONCURRENCY_INIT}),this._schedulerService.registerGroup({groupId:M.id,concurrency:M.CONCURRENCY_INIT}),r.getInstance().then(e=>{this._graphicToolkitService=e,this._graphicToolkitServiceBarrier.open()}),this._teaAdapterService.getABTestVar("ccweb_new_snapshot_thumb",{enable:!1}).then(e=>{let{enable:t=!1}=e;d.k92.getInstance().setIncrThumbDensity(t)})}}T=(0,r.gn)([(0,r.fM)(2,b.B),(0,r.fM)(3,y.r),(0,r.fM)(4,f.w),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof ResourceStatusMap?Object:ResourceStatusMap,void 0===b.B?Object:b.B,void 0===y.r?Object:y.r,void 0===f.w?Object:f.w])],T);var w=i("108692");class C{get onReady(){return this._onReady.event}addTask(e){let{resourceKey:t,sprites:i}=e;!this._resourceStatusMap[t]&&(this._resourceStatusMap[t]={}),this._setSpritesByTimestamp({resourceKey:t,sprites:i}),this._onReady.fire({resourceKey:t})}_calculateSpritesBySpeed(e,t){var i;return e.speed.mode===d.yY$.SpeedModeNormal?t.map(t=>({...t,timestamp:BigInt(Math.floor(d.pMA.div(t.sourceTimestamp,e.speed.speed)))})):(null===(i=e.speed.curveSpeed)||void 0===i?void 0:i.speedPoints.length)?t.map(t=>({...t,timestamp:BigInt(new d.Cd0().mapTrimDeltaToSeqDelta(t.sourceTimestamp,e.targetTimerange.duration,e.speed.curveSpeed.speedPoints))})):t}_updateSpritesBySpeed(e,t){let i=this._mainDraftService.dataSdk.draftView.getSegmentById(e);return i&&(0,d.duj)(i)&&(i.speed.mode!==d.yY$.SpeedModeNormal||1!==i.speed.speed)?(i.materialDraft.draft.getAllSegments().filter(d.hey).forEach(e=>{var t;this._store[s.jU].setSprites(e.material.id,this._calculateSpritesBySpeed(e,[...null!==(t=this._store[s.jU].sprites[e.material.id])&&void 0!==t?t:[]]))}),this._calculateSpritesBySpeed(i,t)):t}_setSpritesByTimestamp(e){var t;let{resourceKey:i,sprites:r}=e;this._resourceStatusMap[i].sprites=h.o.Pending;let n=[...null!==(t=this._store[s.jU].sprites[i])&&void 0!==t?t:[]];for(let e of r){let t=n.findIndex(t=>t.timestamp===e.timestamp);t>-1?n[t]=e:(n.push(e),r.sort((e,t)=>d.pMA.minus(e.timestamp,t.timestamp)))}this._store[s.jU].setSprites(i,this._updateSpritesBySpeed(i,n)),this._resourceStatusMap[i].sprites=h.o.Ready}constructor(e,t,i){this._store=e,this._resourceStatusMap=t,this._mainDraftService=i,this._onReady=new a.Q}}C=(0,r.gn)([(0,r.fM)(2,w.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof ResourceStatusMap?Object:ResourceStatusMap,void 0===w.n?Object:w.n])],C);var I=i("253059"),x=i("557428"),k=i("265409");class D extends o.JT{get onResourceReady(){return this._onResourceReady.event}get _immediately(){return this._mode===h.F.IMMEDIATELY}stopBatchMode(){this._mode=h.F.IMMEDIATELY,this._broadcastIfNeed()}isResourcePending(e){let t=this._resourceStatusMap[e];return!!t&&(t.sprites!==h.o.Ready&&t.sprites!==h.o.Complete&&t.cover===h.o.Pending||t.cover!==h.o.Ready&&t.cover!==h.o.Complete&&t.sprites===h.o.Pending)}parsePhoto(e){return this._parseTask.addTask(g.U.Photo,e)}parseVideo(e){return this._parseTask.addTask(g.U.Video,e)}parseSlotSprites(e,t){return this._templateSlotTask.addTask(e,t)}setSprites(e){return this._captureTask.addTask(e)}genWaves(e,t){return this._genWaveTask.addTask(e,t)}_calcBatchUpdateCount(){let{isTemplate:e}=this._timelineManagerStore[s.U_],t=(e?this._timelineManagerStore[s.U_].tracksMutable:this._timelineManagerStore[s.U_].tracks).flatMap(e=>{let[t]=e;return t.segments.filter(u._k)}).length;t>200?this._batchUpdateCount=Math.floor(.2*t):t>150?this._batchUpdateCount=40:t>70?this._batchUpdateCount=30:this._batchUpdateCount=Math.min(t,c.I)}_broadcastIfNeed(){this._rafId&&window.cancelAnimationFrame(this._rafId),this._rafId=window.requestAnimationFrame(()=>{this._rafId=void 0;let e=this._collect();this._immediately||e.length>=this._batchUpdateCount?this._broadcast(e):this._throttleBroadcast()})}_collect(){return Array.from(Array.from(Object.keys(this._resourceStatusMap)).filter(e=>{let t=this._resourceStatusMap[e];return t.waves===h.o.Ready||t.sprites===h.o.Ready||t.cover===h.o.Ready&&(t.sprites===h.o.Empty||t.sprites===h.o.Error||t.sprites===h.o.Timeout)}).reduce((e,t)=>{var i;return null===(i=this._relation.getSegmentIdByResourceKey(t))||void 0===i||i.forEach(t=>e.add(t)),e},new Set))}_broadcast(e){(0,k.DM)(k.Fh.RESOURCE_UPDATE),this._throttleBroadcast.cancel();let t=null!=e?e:this._collect();t.length>0&&((0,k.hC)(k.Fh.RESOURCE_UPDATE),this._onResourceReady.fire({segmentIds:t}),Object.values(this._resourceStatusMap).forEach(e=>{e.waves===h.o.Ready&&(e.waves=h.o.Complete),e.cover===h.o.Ready&&(e.cover=h.o.Complete),e.sprites===h.o.Ready&&(e.sprites=h.o.Complete)}),(0,k.wf)(k.Fh.RESOURCE_UPDATE))}afterFirstFrame(){this._parseTask.afterFirstFrame()}constructor(e,t,i,r,o,l){super(),this._timelineManagerStore=e,this._relation=t,this._dataSdk=i,this._segmentSelection=r,this._draftDataSynchronizer=o,this._containerService=l,this._onResourceReady=new a.Q,this._resourceStatusMap={},this._mode=h.F.BATCH,this._batchUpdateCount=c.I,this._throttleBroadcast=(0,n.Z)(this._broadcast.bind(this),c.s,{leading:!1}),this._parseTask=this._containerService.createInstance(T,this._timelineManagerStore,this._resourceStatusMap),this._captureTask=this._containerService.createInstance(C,this._timelineManagerStore,this._resourceStatusMap),this._genWaveTask=this._containerService.createInstance(I.e,this._timelineManagerStore,this._resourceStatusMap),this._templateSlotTask=this._containerService.createInstance(x.F,this._timelineManagerStore,this._resourceStatusMap),this._register(this._parseTask.onReady(this._broadcastIfNeed.bind(this))),this._register(this._captureTask.onReady(this._broadcastIfNeed.bind(this))),this._register(this._genWaveTask.onReady(this._broadcastIfNeed.bind(this))),this._register(this._templateSlotTask.onReady(this._broadcastIfNeed.bind(this))),this._timelineManagerStore[s.U_].isTemplate?this._register(this._draftDataSynchronizer.onFullTracksMutableChange(this._calcBatchUpdateCount.bind(this))):this._register(this._draftDataSynchronizer.onFullTracksChange(this._calcBatchUpdateCount.bind(this))),this._register(this._dataSdk.onChangeDiff(e=>{if(e.actionOperateType!==d.aWQ.History&&!e.isRecovery)(e[d.u4I.SEGMENT].length||e[d.u4I.TRACK].length)&&this.stopBatchMode()})),this._register(this._segmentSelection.onExpandedSegmentIdChange(e=>{e&&this._mode===h.F.BATCH&&this.stopBatchMode()}))}}D=(0,r.gn)([(0,r.fM)(5,l.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof IResourceRelation?Object:IResourceRelation,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof IDraftDataSynchronizer?Object:IDraftDataSynchronizer,void 0===l.t?Object:l.t])],D)},153107:function(e,t,i){i.d(t,{$8:function(){return p},$Q:function(){return g},Aw:function(){return c},Q5:function(){return h},_k:function(){return m},yN:function(){return u}});var r=i(928261),n=i(729596),a=i(426336),o=i(420072),s=i(127830),l=i(927788),d=i(823404);function c(e){let t=new Blob([e]);return URL.createObjectURL(t)}function u(e){return(0,a.hey)(e)?e.material.sourcePlatform===a.cvu.MaterialPlatformDefault:!!(0,a.Y9Q)(e)&&!e.material.musicId&&!e.material.effectId}function h(e,t){let i=s._g.Video,r=t.draftView.getSegmentById(e);if(!r)return i;let n=u(r);return(0,a.hey)(r)?i=(0,a.oP0)(r)?s._g.DigitalHuman:(0,a.ot2)(r)?s._g.UserPhoto:(0,a.duj)(r)&&r.materialDraft?s._g.VideoTemplate:r.material.type===a.cVg.MetaTypeGif?n?s._g.UserPhoto:s._g.Gif:r.material.type===a.cVg.MetaTypePhoto||r.material.type===a.cVg.MetaTypeImage?n?s._g.UserPhoto:s._g.Photo:n?s._g.UserVideo:s._g.Video:(0,a.Y9Q)(r)&&(i=n?s._g.UserAudio:s._g.Audio),i}function g(e,t){var i,n,o,s,d,c;if("combination"===e.type||"mutablePoly"===e.type)return e.id;if((null===(i=e.materialDraft)||void 0===i?void 0:i.draft)&&"audio"===e.type)return function(e){let{draft:t}=e;if(!(null==t?void 0:t.tracks))return"";let i="",r=t.tracks.filter(e=>e.type===a.pNd.TrackTypeAudio);return(0,l.Z)(r,e=>!e.segments||e.segments.every(e=>!(i.length>1e3)&&((0,a.Y9Q)(e)&&(i+=e.material.path),!0))),i}(e.materialDraft);if("audio"===e.type||"mutableAudio"===e.type)return null!==(s=e.path)&&void 0!==s?s:"";let u=e.path;(0,r.gG)(e.mutable)?u=e.mutable.filled&&e.path?e.path:e.mutable.coverPath:(null===(o=e.digitalHuman)||void 0===o?void 0:null===(n=o.videoMeta)||void 0===n?void 0:n.path)&&e.materialDraft&&(u=null===(c=e.digitalHuman)||void 0===c?void 0:null===(d=c.videoMeta)||void 0===d?void 0:d.path);let h=t.getResourceKeyFromDraftPath(null!=u?u:"");return null!=h?h:""}async function p(e){if(!e)return 0n;let t=await (0,o.Z)(e);return t.ok?n.h.secondToUs(t.value.duration):0n}function m(e){return["video","audio","mutable","mutablePoly","mutableAudio","combination"].includes(e.type)&&!(0,d.Vo)(e.id)&&"end-limit"!==e.id}},490620:function(e,t,i){i.d(t,{$g:function(){return l},Jl:function(){return o},QT:function(){return d},Vd:function(){return s}});var r=i(539525),n=i(455879),a=i(928261);function o(e){return t=>e.id===t.id}function s(e,t){return(0,r.Z)((0,a.be)("audio","text","textTemplate"),(0,n.Z)(e=>t.some(t=>t.id===e.id),(0,a.be)("video")))(e)}function l(e,t){return Object.assign(e,{mutable:t})}let d=(0,a.be)("audio","sticker","text","textTemplate","video")},545291:function(e,t,i){i.d(t,{k:function(){return d}});var r=i(676693),n=i(690674),a=i(27564),o=i(587892);let s=parseFloat(r.Z["size-height-editor-collapsed-tl"]),l=parseFloat(r.Z["size-height-min-timeline"]);class d{get isCollapsed(){return this._store[n.U_].isCollapseTimeline}get onLayoutUpdate(){return this._layoutManager.onDidLayoutUpdate}setMaxHeight(e){this.maxHeight=e,this.setHeight(this.height)}setCollapsed(e){this._store[n.U_].setTimelineIsCollapse(e),this._layoutManager.setBottomHeight(this.isCollapsed?s:this.height),this._onCollapsedStatusChange.fire(e)}setTimelinePanelMode(e){this._store[n.U_].setTimelinePanelMode(e),this._onTimelinePanelModeChange.fire(e)}switchNormalTimelinePanel(){this._store[n.U_].setTimelinePanelMode(a.v.NORMAL)}setHeight(e){if(!this.isCollapsed)this.height=Math.min(Math.max(e,this.minHeight),this.maxHeight),this._layoutManager.setBottomHeight(this.height)}setMinHeight(e){this.minHeight=e,this.setHeight(this.height)}toggleCollapsed(){this.setCollapsed(!this.isCollapsed)}setAudioTimelinePanelVisible(e){this._store[n.U_].setAudioTimelinePanelVisible(e)}constructor(e,t,i){this._layoutManager=e,this._store=t,this._segmentSelection=i,this.height=234,this._onCollapsedStatusChange=new o.Q,this.onCollapsedStatusChange=this._onCollapsedStatusChange.event,this._onTimelinePanelModeChange=new o.Q,this.onTimelinePanelModeChange=this._onTimelinePanelModeChange.event,this.minHeight=l,this.maxHeight=441,this._layoutManager.onDidLayoutScaleChange(e=>{this.setHeight(e)}),this._segmentSelection.onBatchReplacingSegmentIdChange(e=>{!e&&this.setTimelinePanelMode(a.v.NORMAL)})}}},649943:function(e,t,i){i.d(t,{T:function(){return s}});var r=i(371140),n=i(690674),a=i(587892);let o="PREVIEW_LINE_SWITCH_STORAGE_KEY";class s{get switch(){return this._store[n.U_].switches.previewLine}get onSwitchChange(){return this._onSwitchChange.event}setPreviewLineStatus(e){this._store[n.U_].setPreviewLineStatus(e)}setPreviewMutableSlotStatus(e){this._store[n.U_].setPreviewMutableSlotStatus(e)}setPreviewLineFrozen(e){this._store[n.U_].setPreviewLineFrozen(e)}setPreviewLineSeekTime(e){this._store[n.U_].setPreviewLineSeekTime(e)}toggleSwitch(){this._store[n.U_].setSwitches({previewLine:!this._store[n.U_].switches.previewLine});let e=this._store[n.U_].switches.previewLine;!e&&this._store[n.U_].setPreviewLineStatus(r.$o.DISABLE),localStorage.setItem(o,String(!!e)),this._onSwitchChange.fire(e)}constructor(e){this._store=e,this._onSwitchChange=new a.Q;let t="true"===localStorage.getItem(o);this._store[n.U_].setSwitches({previewLine:t})}}},271846:function(e,t,i){i.d(t,{L:function(){return y}});var r=i(789786),n=i(690674),a=i(656002),o=i.n(a),s=i(907031),l=i(749215),d=i(67801),c=i(785048),u=i(576977),h=i(632555),g=i(426336),p=i(230689),m=i(966697),f=i(587892),_=i(402655),v=i(260963);let S="timeline_zoom";class y extends _.JT{get onCanZoomChange(){return this._onCanZoomChange.event}get onValueChange(){return this._onValueChange.event}get onZoomMaxChange(){return this._onZoomMaxChange.event}get onGearedChange(){return this._onGearedChange.event}get onGearedMaxChange(){return this._onGearedMaxChange.event}get value(){return this._timelineManagerStore[n.U_].zoomStore.value}get canZoom(){return this._timelineManagerStore[n.U_].canZoom}get geared(){return this._timelineManagerStore[n.U_].zoomStore.geared}get gearedMax(){return this._timelineManagerStore[n.U_].zoomStore.gearedMax}get max(){return this._timelineManagerStore[n.U_].zoomStore.max}setEnableZoom(e){this._timelineManagerStore[n.U_].zoomStore.setEnableZoom(e)}setZoomContainer(e){this._zoomContainer=e,this._onZoomContainerChange.fire(e)}refreshZoomMax(){let{duration:e}=this._dataSdk.draftView.getDraftMetadata();this.computeZoomMax(e)}computeZoomMax(e){let t;this._zoomContainer?{width:t}=this._zoomContainer.getBoundingClientRect():({offsetWidth:t}=document.body,t*=2/3);let i=(0,d.B)(e,s.Ge,t-s.w0);this._timelineManagerStore[n.U_].zoomStore.setZoomMax(i)}adjustAppropriate(e){var t,i;let{tracks:r}=this._timelineManagerStore[n.U_];if(!!(r.length<=1&&(null===(i=r[0])||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.segments.length)<1)&&!this._timelineManagerStore[n.U_].isTemplate)this.adjustFirstIn(e)}adjustFirstIn(e){if(!this._zoomContainer)return;let{zoomStore:t}=this._timelineManagerStore[n.U_],{width:i}=this._zoomContainer.getBoundingClientRect();i-=this._timelineManagerStore[n.U_].operationWidth;let r=(0,d.B)(e,s.Ge,i),a=(0,d.B)(e,s.xL,i);t.setZoomMax(r),t.setZoom(a),this._updateLocalNote()}adjustResize(e){}adjustRecovery(){this._timelineAdjustZoomRecovery()}_timelineAdjustZoomRecovery(){let e;if(!this._zoomContainer)return;let{isTemplate:t}=this._timelineManagerStore[n.U_],i=this._localNote.get("timeline_zoom",!t);i?!isFinite(i=parseFloat(i))&&(i=1/0):i=1/0;let{duration:r}=this._dataSdk.draftView.getDraftMetadata(),a=r>0n?r:48n*60n*1000n*1000n,{width:o}=this._zoomContainer.getBoundingClientRect();o-=this._timelineManagerStore[n.U_].operationWidth;let l=(0,d.B)(a,s.Ge,o);if(isFinite(i)&&(0,h.mK)(i,[s.tm,l]))e=i;else{var c,u;let i=(0,d.B)(a,s.S7,o);e=Math.min(i,t?(0,d.D)(null===(u=this._timelineManagerStore[n.U_].tracksMutable[0])||void 0===u?void 0:null===(c=u[0])||void 0===c?void 0:c.segments):1/0)}this._timelineManagerStore[n.U_].zoomStore.setZoomMax(l),this._timelineManagerStore[n.U_].zoomStore.setZoom(e)}_recoverZoomValue(){!this._isInit&&(this._timelineAdjustZoomRecovery(),this._updateLocalNote(),this._isInit=!0)}_updateLocalNote(){if(this._localNote.draftId&&this._localNote.userId){let{zoomStore:e}=this._timelineManagerStore[n.U_];try{this._localNote.update(S,e.value)}catch(e){}}}_addListener(){let{zoomStore:e}=this._timelineManagerStore[n.U_],t=(0,v.U5)(()=>e.value,e=>{this._onValueChange.fire(e)}),i=(0,v.U5)(()=>e.max,e=>{this._onZoomMaxChange.fire(e)}),r=(0,v.U5)(()=>e.geared,e=>{this._onGearedChange.fire(e)}),a=(0,v.U5)(()=>e.gearedMax,e=>{this._onGearedMaxChange.fire(e)}),o=(0,v.U5)(()=>this._timelineManagerStore[n.U_].canZoom,e=>{this._onCanZoomChange.fire(e)});this._register({dispose:()=>{t(),i(),r(),a(),o()}}),this._register(this._capcutAccountService.onDidChangeProfile(e=>{let{uid:t}=e;t&&(this._localNote.userId=t,this._updateLocalNote())})),this._register(this._onZoomContainerChange.event(()=>{this._draftRecovered&&this._zoomContainer&&this._recoverZoomValue()})),this._register(this._dataSdk.onChangeDiff(e=>{let{actionOperateType:t}=e;e[g.u4I.CONFIG].length>0&&(this._localNote.draftId=this._dataSdk.draftView.getDraftId()),t===g.aWQ.History&&(this._draftRecovered=!0,this._zoomContainer&&this._recoverZoomValue()),this.refreshZoomMax()}))}constructor(e,t,i,r,a,d){var h;super(),h=this,this._timelineManagerStore=e,this._dataSdk=t,this._cloudMetaManager=i,this._playerManager=r,this._containerService=a,this._capcutAccountService=d,this._isInit=!1,this._draftRecovered=!1,this._zoomContainer=null,this._onZoomContainerChange=new f.Q,this._onValueChange=new f.Q,this._onZoomMaxChange=new f.Q,this._onGearedChange=new f.Q,this._onGearedMaxChange=new f.Q,this._onCanZoomChange=new f.Q,this.timelineZoomIn=o()(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!h._timelineManagerStore[n.U_].canZoom)return;h._timelineManagerStore[n.VT].unionPlaying&&h._playerManager.pause();let{zoomStore:r}=h._timelineManagerStore[n.U_],a=r.gearedMax/s.jy;h._viewportAmend.record(),r.setGeared(r.geared-a*t),h._viewportAmend.amend(e,i,h._report.report),h._updateLocalNote()},20),this.timelineZoomOut=o()(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{[n.U_]:r}=h._timelineManagerStore;if(!r.canZoom)return;let{zoomStore:a}=r;h._timelineManagerStore[n.VT].unionPlaying&&h._playerManager.pause();let o=a.gearedMax/s.jy;h._viewportAmend.record(),a.setGeared(a.geared+o*t),h._viewportAmend.amend(e,i,h._report.report),h._updateLocalNote()},20),this.timelineZoomSet=o()(e=>{if(!!this._timelineManagerStore[n.U_].canZoom)this._timelineManagerStore[n.U_].zoomStore.setZoom(e)},20),this.setTimelineZoomGear=o()((e,t)=>{let{[n.U_]:i}=this._timelineManagerStore;if(!i.canZoom)return;let{zoomStore:r}=i;this._timelineManagerStore[n.VT].unionPlaying&&this._playerManager.pause(),this._viewportAmend.record(),r.setGeared(t),this._viewportAmend.amend(e,!0,this._report.report),this._updateLocalNote()},20),this._localNote=new u.K,this._localNote.draftId=this._dataSdk.draftView.getDraftId(),this._localNote.userId=this._capcutAccountService.userProfile.uid,this._viewportAmend=new c.Y(this._timelineManagerStore),this._report=this._containerService.createInstance(l.T,this._timelineManagerStore),this.refreshZoomMax(),this._localNote.register({key:S,associate:{userId:!0,draftId:!0}}),this._addListener()}}y=(0,r.gn)([(0,r.fM)(4,p.t),(0,r.fM)(5,m.Gw),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof ICloudMetaManager?Object:ICloudMetaManager,"undefined"==typeof IPlayerManager?Object:IPlayerManager,void 0===p.t?Object:p.t,void 0===m.Gw?Object:m.Gw])],y)},143333:function(e,t,i){i.d(t,{E0:function(){return u},G0:function(){return c},tP:function(){return h}});var r=i(640218),n=i(858151),a=i(979159),o=i(690674),s=i(136498),l=i(426336);class d{getDataChange(){return this._dataChange}resetDataChange(){this._dataChange={segments:[],tracks:[]}}pushSegmentChange(e){this._dataChange.segments.push(e)}pushTrackChange(e){this._dataChange.tracks.push(e)}constructor(){this._dataChange={segments:[],tracks:[]}}}class c extends d{addTracks(e){let t=[];return e.forEach(e=>{let{trackType:i,trackIndex:a}=e,o=(0,n.ww)(i);this.pushTrackChange({type:r.p.ADD,item:{track:o,trackId:o.id,trackIndex:a}});let s={index:a,value:o};this._trackIdToInfo.set(o.id,s),t.push(s)}),t}removeTracks(e){e.forEach(e=>{let t=this._trackIdToInfo.get(e);if(t){let{value:e,index:i}=t;this.pushTrackChange({type:r.p.DELETE,item:{track:e,trackId:e.id,trackIndex:i}}),this._trackIdToInfo.delete(e.id)}})}addSegments(e){let t=[];return e.forEach(e=>{let{segment:i,trackId:n}=e;this.pushSegmentChange({type:r.p.ADD,item:{segment:i,trackId:n,segmentId:i.id}});let a={value:i,trackId:n};this._segmentIdToInfo.set(i.id,a),t.push(a)}),t}removeSegment(e){e.forEach(e=>{let t=this._segmentIdToInfo.get(e);if(t){let{value:i,trackId:n}=t;this.pushSegmentChange({type:r.p.DELETE,item:{segment:i,trackId:n,segmentId:i.id}}),this._segmentIdToInfo.delete(e)}})}addTransitions(e){let t=[];return e.forEach(e=>{let{material:i,trackId:n,segment:o,resourceType:s}=e,d=(0,a.n3)(i,s,o.id);this.pushSegmentChange({type:r.p.UPDATE,item:{segment:{...o,slots:[d]},segmentId:o.id,trackId:n,notifyOperation:{type:l.C8.UPDATE,order:0,item:{id:o.id,trackIndex:0,segmentType:l.Ocy.SegmentVideo,segment:{transition:{id:d.id,name:d.title,duration:d.duration}}}}}}),this._transitionIdToInfo.set(d.id,{value:d,trackId:n,segmentId:o.id}),t.push(d.id)}),t}removeTransitions(e){for(let i of e){let e=this._transitionIdToInfo.get(i);if(e){var t;let{trackId:n,segmentId:a,value:d}=e,{segment:c}=(0,s.pP)(this._timelineManagerStore[o.U_].tracks,a);c&&(null===(t=c.slots[0])||void 0===t?void 0:t.id)===d.id&&(this.pushSegmentChange({type:r.p.UPDATE,item:{segment:{...c,slots:[]},segmentId:a,trackId:n,notifyOperation:{type:l.C8.UPDATE,order:0,item:{id:c.id,trackIndex:0,segmentType:l.Ocy.SegmentVideo,segment:{transition:null}}}}}),this._transitionIdToInfo.delete(i))}}}getSegmentInfo(e){return this._segmentIdToInfo.get(e)}getTrackInfo(e){return this._trackIdToInfo.get(e)}clear(){this._segmentIdToInfo=new Map,this._trackIdToInfo=new Map,this._transitionIdToInfo=new Map,this.resetDataChange()}constructor(e){super(),this._timelineManagerStore=e,this._segmentIdToInfo=new Map,this._trackIdToInfo=new Map,this._transitionIdToInfo=new Map}}class u extends d{takeoutSegments(e){let t=this._timelineManagerStore[o.U_].tracks,i=new Set(e);for(let e of t){let[t]=e,{segments:n}=t;for(let e=0;e<n.length;e++){let a=n[e];i.has(a.id)&&(this._segmentCache.set(a.id,{value:a,trackId:t.id}),this.pushSegmentChange({type:r.p.DELETE,item:{segmentId:a.id,segment:a,trackId:t.id}}))}}}resumeSegments(e){for(let t of e){let e=this._segmentCache.get(t);if(e){let{value:i,trackId:n}=e;this.pushSegmentChange({type:r.p.ADD,item:{segment:i,segmentId:i.id,trackId:n}}),this._segmentCache.delete(t)}}}resumeAllSegmentOperationChange(){this.resumeSegments([...this._segmentCache.keys()])}takeoutTracks(e){let t=this._timelineManagerStore[o.U_].tracks,i=new Set(e);for(let e=0;e<t.length;e++){let[n]=t[e];if(i.has(n.id)){let{segments:t}=n;this._trackCache.set(n.id,{trackIndex:e,value:n,segments:t}),this.pushTrackChange({type:r.p.DELETE,item:{track:n,trackId:n.id,trackIndex:e}}),t.forEach(e=>{this.pushSegmentChange({type:r.p.DELETE,item:{trackId:n.id,segment:e,segmentId:e.id}})})}}}resumeTracks(e){for(let t of e){let e=this._trackCache.get(t);if(e){let{value:i,trackIndex:n,segments:a}=e;this.pushTrackChange({type:r.p.ADD,item:{trackId:i.id,trackIndex:n,track:i}}),a.forEach(e=>{this.pushSegmentChange({type:r.p.ADD,item:{trackId:i.id,segment:e,segmentId:e.id}})}),this._segmentCache.delete(t)}}}resumeAllTrackOperationChange(){this.resumeTracks([...this._trackCache.keys()])}clear(){super.resetDataChange(),this._segmentCache=new Map}constructor(e){super(),this._timelineManagerStore=e,this._segmentCache=new Map,this._trackCache=new Map}}class h extends d{setSegmentTimeRange(e){let{segment:t,timeRange:i,trackId:n}=e,{start:a,duration:o}=i,{id:s}=t,d={...t,start:a,duration:o};this._segmentIdToTimeRangeChange.set(s,{original:{start:t.start},current:{start:a},trackId:n,segment:t}),this.pushSegmentChange({type:r.p.UPDATE,item:{segment:d,segmentId:s,trackId:n,notifyOperation:{type:l.C8.UPDATE,order:0,item:{id:t.id,trackIndex:0,segmentType:l.Ocy.SegmentVideo,segment:{targetTimerange:{start:d.start}}}}}})}resumeSegmentTimeRange(e){let t=this._segmentIdToTimeRangeChange.get(e);if(t){let{original:i,trackId:n,segment:a}=t,o={...a,start:i.start};this.pushSegmentChange({type:r.p.UPDATE,item:{segment:o,segmentId:o.id,trackId:n,notifyOperation:{type:l.C8.UPDATE,order:0,item:{id:a.id,trackIndex:0,segmentType:l.Ocy.SegmentAudio,segment:{targetTimerange:{start:o.start}}}}}}),this._segmentIdToTimeRangeChange.delete(e)}}resumeAllSegmentTimeRange(){for(let e of this._segmentIdToTimeRangeChange.keys())this.resumeSegmentTimeRange(e)}clear(){super.resetDataChange(),this._segmentIdToTimeRangeChange.clear()}constructor(...e){super(...e),this._segmentIdToTimeRangeChange=new Map}}},640218:function(e,t,i){i.d(t,{p:function(){return n}});var r,n=((r={}).ADD="add",r.UPDATE="update",r.DELETE="delete",r)},105304:function(e,t,i){i.d(t,{Vf:function(){return o},fV:function(){return s},z$:function(){return l}});var r,n,a=i(260963);var o=((r={}).ALL="all",r.TOOLBAR="toolbar",r.CURSOR="cursor",r.PREVIEW_LINE="previewLine",r.SEQUENCE="sequence",r.SHORT_CUT_KEY="shortCutKey",r.TIMELINE_HEADER="timelineHeader",r.SELECTION="selection",r.READONLY_MODE="readonlyMode",r);var s=((n={}).TIMELINE_HEADER="timelineHeader",n.TIMELINE_TOOLBAR="timelineToolbar",n);class l{get disableInteract(){return this.disableInteractList.includes("all")}get disableShortCutKey(){return this.disableInteractList.includes("shortCutKey")||this.disableInteract}get disableCursorInteract(){return this.disableInteractList.includes("cursor")||this.disableInteract}get disableSequenceInteract(){return this.disableInteractList.includes("sequence")||this.disableInteract}get disablePreviewLineInteract(){return this.disableInteractList.includes("previewLine")||this.disableInteract}get disableToolbarInteract(){return this.disableInteractList.includes("toolbar")||this.disableInteract}get disableReadonlyMode(){return this.disableInteractList.includes("readonlyMode")}get disableSelection(){return this.disableInteractList.includes("selection")||this.disableInteract}get disableTimelineHeader(){return this.disableInteractList.includes("timelineHeader")||this.disableInteract}get headerHidden(){return this.hideViewList.includes("timelineHeader")}get toolbarHidden(){return this.hideViewList.includes("timelineToolbar")}setDisableInteractList(e){this.disableInteractList=e}setHideView(e){this.hideViewList=e}constructor(){this.disableInteractList=[],this.hideViewList=[],(0,a.ky)(this)}}},59388:function(e,t,i){i.d(t,{o:function(){return a}});var r=i(260963),n=i(490620);class a{get templatePostMutableSegments(){return this.templatePostSegments.filter(e=>e.mutable)}get templatePostChangeableSegment(){return this.templatePostSegments.filter(e=>["audio","sticker","text","textTemplate","video"].includes(e.type))}setTemplatePostSegmentMutableStatus(e,t){let i=this.templatePostSegments.find(t=>t.id===e);i&&(i.mutable=t)}setTemplatePostSegments(e){this.templatePostSegments=e.map(e=>({...e}))}updateOrInsertTemplatePostSegment(e){let t=this.templatePostSegments.find((0,n.Jl)(e));t?t.mutable=e.mutable:this.templatePostSegments.push(e)}constructor(){this.templatePostSegments=[],(0,r.ky)(this)}}},35761:function(e,t,i){i.d(t,{$:function(){return o}});var r=i(907031),n=i(519637),a=i(260963);class o{get geared(){return(0,n.e)(this.value)}get gearedMax(){return(0,n.e)(this.max)}setGeared(e){let t=Math.max(0,Math.min(this.gearedMax,e));this.setZoom((0,n.u)(t))}setZoom(e){this.value=Math.min(Math.max(e,r.tm),this.max)}setZoomMax(e){this.max=Math.min(Math.max(e,r.S5),r.Q_)}setEnableZoom(e){this.enableZoom=e}constructor(){this.value=r.y5,this.max=r.Q_,this.enableZoom=!0,(0,a.ky)(this)}}},394267:function(e,t,i){function r(e){return!!(null==e?void 0:e.registeredType)}function n(e){return!!(null==e?void 0:e.dragSource)}i.d(t,{Z:function(){return n},h:function(){return r}})},27564:function(e,t,i){i.d(t,{v:function(){return n}});var r,n=((r={}).NORMAL="normal",r.QUICK_REPLACE="batchReplace",r)},72127:function(e,t,i){i.d(t,{An:function(){return p},GK:function(){return _},JS:function(){return A},LW:function(){return h},O1:function(){return l},P5:function(){return C},QQ:function(){return u},R0:function(){return v},S$:function(){return f},SC:function(){return c},Ud:function(){return M},V5:function(){return d},XA:function(){return b},YK:function(){return w},jL:function(){return g},nq:function(){return T},uD:function(){return S},w7:function(){return m},xC:function(){return y}});var r=i(969242),n=i(907031),a=i(140041),o=i(464533),s=i(426336);function l(e,t){let i=e;for(;null==i?void 0:i.classList;){if(t.some(e=>i.classList.contains(e)))return!0;i=i.parentElement}return!1}function d(e,t){let i=document.createElement(e);return i.classList.add(...t),i}function c(e,t,i){let n=[];for(let a of e)a.start<t&&n.push({id:a.id,x:(0,r.vY)(i,a.start),start:a.start});return n}function u(e,t,i,n){let a=[];for(let o of e)o.start<t?a.push({id:o.id,x:(0,r.vY)(n,o.start)-i,start:o.start}):a.push({id:o.id,x:(0,r.vY)(n,o.start),start:o.start});return a}function h(e,t){if(!!e)try{var i;null===(i=e.parentElement)||void 0===i||i.removeChild(e)}catch(e){console.warn(t,e)}}function g(e,t,i){let n=[];for(let a of e)a.start+a.duration>t&&n.push({id:a.id,x:(0,r.vY)(i,a.start),start:a.start});return n}function p(e,t,i,n){let a=[];for(let o of e)o.start+o.duration>t?a.push({id:o.id,x:(0,r.vY)(n,o.start)+i,start:o.start}):a.push({id:o.id,x:(0,r.vY)(n,o.start),start:o.start});return a}function m(e,t,i,n){let a=[];for(let o of e)o.start>t?a.push({id:o.id,x:(0,r.vY)(n,o.start)+i,start:o.start}):a.push({id:o.id,x:(0,r.vY)(n,o.start),start:o.start});return a}function f(e,t,i){let[n,a]=e,o=s.pMA.div(i.duration,2,"bigint"),l=[];if(n){let e=s.pMA.min([n.duration,o],"bigint");l.push({id:n.id,width:(0,r.vY)(t,e),start:n.start,x:(0,r.vY)(t,i.start-s.pMA.div(e,2,"bigint"))})}if(a){let e=s.pMA.min([a.duration,o],"bigint");l.push({id:a.id,width:(0,r.vY)(t,e),x:(0,r.vY)(t,i.start+i.duration-s.pMA.div(e,2,"bigint")),start:a.start})}return l}function _(e,t){return t+=Number(e=e.replace(/px$/,"")),`${t}px`}function v(e,t,i){let r=document.createElement("div");return r.id="card-drag-effect",r.classList.add("track-drag-container"),t&&r.classList.add("track-drag-material"),i&&r.classList.add(...i),r.appendChild(e),r}function S(e,t){let i=document.getElementsByClassName("timeline-bd")[0];if(!i)return!1;let{width:a}=i.getBoundingClientRect()||{},o=(0,r.vY)(t,e),s=i.scrollLeft,l=a>2*n.hn?n.hn:0;return!(o<=s+l)&&o-s<a-l}function y(e,t){let i=document.getElementsByClassName("timeline-bd")[0];if(!i)return;let{width:a}=i.getBoundingClientRect()||{},o=a>2*n.hn?n.hn:0,s=(0,r.vY)(t,e)-o;i.scroll({left:s,behavior:"smooth"})}function b(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.getElementsByClassName("timeline-bd")[0];if(!r)return[!1,!1];let a=t.context.registry.getBoundingClientRect(e);if(!a)return[!1,!1];let{left:o,right:s,top:l,bottom:d,width:c}=r.getBoundingClientRect(),{left:u,right:h,top:g,bottom:p}=a;if(i||c<2*n.AZ){let e=g<d-n.St&&p>l+n.St;return[u<s&&h>o,e]}let m=g<d-n.St-n.kH&&p>l+n.St+n.kH;return[u<s-n.AZ&&h>o+n.AZ,m]}function A(e){let t=document.querySelector(".mutable-poly-modal-children");if(!t)return!1;let{left:i,width:r}=e.getBoundingClientRect(),{left:n,width:a}=t.getBoundingClientRect();return!(i+r/2<n)&&!(i+r/2>n+a)&&!0}function M(e,t,i){let r,a,[o,s]=i;if(o&&s)return;let[l]=t.context.registry.segment.findById(e),d=document.querySelector(".timeline-scroll-wrap"),c=document.querySelector(".timeline-bd-vertical-scroll");if(!l||!d||!c)return;let u=c.getBoundingClientRect(),h=t.context.registry.getBoundingClientRect(e);if(!h)return;let{height:g,top:p}=u,{width:m,left:f}=u,{left:_,top:v}=h;if(p+=n.St,g-=n.St,r=o?d.scrollLeft:Math.max(0,_-f-(m>2*n.hn?n.hn:0)),s)a=c.scrollTop;else{let e=v-p,t=g>2*n.yL?n.yL:0;a=Math.max(0,c.scrollTop+e-t)}d.scrollTo({left:r}),c.scrollTo({top:a})}function T(e,t){let{x:i,y:r}=t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Hj,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.xL,s=Date.now()-e.timestamp>=n,l=!1;return"number"==typeof e.x&&"number"==typeof e.y&&(l=(e.x-i)**2+(e.y-r)**2>=o**2),s||l}function w(e){let t=document.createElement("span");t.style.opacity="0",t.style.fontSize=o.yJ,t.innerText=e,document.body.appendChild(t);let i=t.getBoundingClientRect();return document.body.removeChild(t),i.width}function C(e,t,i){let r=e;for(;!r.classList.contains(t);){if(r.classList.contains(i)||!r.parentElement||"BODY"===r.tagName)return;r=r.parentElement}return r}},578635:function(e,t,i){i.d(t,{N:function(){return d},QO:function(){return o},Z3:function(){return c},dc:function(){return u},ez:function(){return p},f2:function(){return a},mT:function(){return n},mZ:function(){return l},o9:function(){return s},s6:function(){return h},tp:function(){return g}});var r=i(426336);function n(e){return e.__segment_struct_type===r.Ocy.SegmentVideoEffect}let a=e=>e.__segment_struct_type===r.Ocy.SegmentVideo;function o(e){return e.__segment_struct_type===r.Ocy.SegmentAudio}function s(e){return e.__segment_struct_type===r.Ocy.SegmentFilter}function l(e){return e.__segment_struct_type===r.Ocy.SegmentPictureAdjust}function d(e){return e.__segment_struct_type===r.Ocy.SegmentTextTemplate}function c(e){return e.__segment_struct_type===r.Ocy.SegmentText}function u(e){return e.__segment_struct_type===r.Ocy.SegmentSticker}function h(e){return!!(null==e?void 0:e.__segment_struct_type)}function g(e){return o(e)&&!!e.materialDraft}function p(e){return a(e)&&!!(e.material.extraTypeOption&r.Yzk.IsCombinationVideo)}},979159:function(e,t,i){i.d(t,{JY:function(){return h},n3:function(){return p},pw:function(){return g}});var r=i(426336),n=i(460254),a=i(127830),o=i(800788),s=i(955171);let l=0,d=()=>`placeholder-segment-${l++}`,c={[a._g.Photo]:"video",[a._g.UserPhoto]:"video",[a._g.UserVideo]:"video",[a._g.Video]:"video",[a._g.Gif]:"video",[a._g.DigitalHuman]:"video",[n.r.UserDigitalHuman]:"video",[a._g.Audio]:"audio",[a._g.UserAudio]:"audio",[a._g.Filter]:"filter",[a._g.Effects]:"effect",[a._g.FaceProp]:"effect",[a._g.Sticker]:"sticker",[n.r.BasicText]:"text",[n.r.BrandText]:"text",[a._g.TextPreset]:"text",[a._g.TextTemplate]:"textTemplate",[a._g.Transition]:"transition",[a._g.VideoTemplate]:"combination",[a._g.AdjustmentPreset]:"pictureAdjust",[a._g.DreaminaUserAiVideo]:"video",[a._g.PhotoDreamina]:"video",[a._g.VideoDreamina]:"video"},u={[a._g.Photo]:r.cVg.MetaTypePhoto,[a._g.UserPhoto]:r.cVg.MetaTypePhoto,[a._g.UserVideo]:r.cVg.MetaTypeVideo,[a._g.DigitalHuman]:r.cVg.MetaTypeDigitalHuman,[n.r.UserDigitalHuman]:r.cVg.MetaTypeDigitalHuman,[a._g.Video]:r.cVg.MetaTypeVideo,[a._g.Gif]:r.cVg.MetaTypeGif,[a._g.Audio]:r.cVg.MetaTypeMusic,[a._g.UserAudio]:r.cVg.MetaTypeMusic,[a._g.Filter]:r.cVg.MetaTypeFilter,[a._g.Effects]:r.cVg.MetaTypeVideoEffect,[a._g.FaceProp]:r.cVg.MetaTypeFaceEffect,[a._g.Sticker]:r.cVg.MetaTypeSticker,[n.r.BasicText]:r.cVg.MetaTypeText,[n.r.BrandText]:r.cVg.MetaTypeText,[a._g.TextPreset]:r.cVg.MetaTypeText,[a._g.TextTemplate]:r.cVg.MetaTypeTextTemplate,[a._g.Transition]:r.cVg.MetaTypeTransition,[a._g.VideoTemplate]:r.cVg.MetaTypeCombination,[a._g.AdjustmentPreset]:r.cVg.MetaTypeAdjust,[a._g.VideoDreamina]:r.cVg.MetaTypeVideo,[a._g.DreaminaUserAiVideo]:r.cVg.MetaTypeVideo,[a._g.PhotoDreamina]:r.cVg.MetaTypePhoto};function h(e,t){var i,r,o,l;let h=c[e],g=u[e];switch(e){case n.r.UserPhoto:case n.r.UserVideo:case n.r.DigitalHuman:case n.r.Photo:case n.r.Video:case n.r.VideoTemplate:case n.r.Gif:{let n=(0,s.Z)(e,t),a=null!==(r=null!==(i=t.title)&&void 0!==i?i:t.filename)&&void 0!==r?r:"video clip";return{commonKeyframes:[],duration:n,id:d(),keyframesMap:new Map,metaType:g,start:0n,slots:[],title:a,type:h,prolong:{duration:n,start:0n,total:n},sourceTimeRange:{start:0n,duration:n},originalTargetStart:0n,originalTargetDuration:n}}case n.r.UserAudio:case n.r.Audio:{let i=null!==(l=null!==(o=t.filename)&&void 0!==o?o:t.title)&&void 0!==l?l:"",r=(0,s.Z)(e,t);return{commonKeyframes:[],duration:r,id:d(),keyframesMap:new Map,metaType:g,slots:[],start:0n,title:i,type:h,prolong:{duration:r,start:0n,total:r},sourceTimeRange:{start:0n,duration:r},originalTargetStart:0n,originalTargetDuration:r}}case n.r.BasicText:case n.r.BrandText:case n.r.TextPreset:case n.r.TextTemplate:{let i=t.name,r=(0,s.Z)(e,t);return{commonKeyframes:[],duration:r,id:d(),keyframesMap:new Map,metaType:g,slots:[],start:0n,title:i,type:h,prolong:{duration:0n,start:0n,total:BigInt(Number.MAX_SAFE_INTEGER)},sourceTimeRange:{start:0n,duration:0n},originalTargetStart:0n,originalTargetDuration:r}}case n.r.Filter:{let i=t.name,r=(0,s.Z)(e,t);return{commonKeyframes:[],duration:r,id:d(),keyframesMap:new Map,metaType:g,slots:[],start:0n,title:i,type:h,prolong:{duration:0n,start:0n,total:BigInt(Number.MAX_SAFE_INTEGER)},sourceTimeRange:{start:0n,duration:0n},originalTargetStart:0n,originalTargetDuration:r}}case n.r.AdjustmentPreset:{let{title:i}=t;return{commonKeyframes:[],duration:(0,s.Z)(e,t),id:d(),keyframesMap:new Map,metaType:g,slots:[],start:0n,title:i,type:h,prolong:{duration:0n,start:0n,total:BigInt(Number.MAX_SAFE_INTEGER)},sourceTimeRange:{start:0n,duration:0n},originalTargetStart:0n,originalTargetDuration:(0,s.Z)(e,t)}}case n.r.Sticker:{let i=t.name,r=(0,s.Z)(e,t);return{commonKeyframes:[],duration:r,id:d(),keyframesMap:new Map,metaType:g,slots:[],start:0n,title:i,type:h,prolong:{duration:0n,start:0n,total:BigInt(Number.MAX_SAFE_INTEGER)},sourceTimeRange:{start:0n,duration:0n},originalTargetStart:0n,originalTargetDuration:r}}case n.r.Effects:{let{name:i}=t,r=(0,s.Z)(e,t);return{commonKeyframes:[],duration:r,id:d(),keyframesMap:new Map,metaType:g,slots:[],start:0n,title:i,type:h,prolong:{duration:0n,start:0n,total:BigInt(Number.MAX_SAFE_INTEGER)},sourceTimeRange:{start:0n,duration:0n},originalTargetStart:0n,originalTargetDuration:r}}case n.r.Transition:{let{name:i}=t;return{id:d(),type:c[a._g.Transition],duration:(0,s.Z)(e,t),title:i,isOverlap:!1,segmentId:""}}default:throw Error(`${e} transfer to UITimelineSegment is not implement`)}}function g(e,t,i){(0,o.Y2)(i!==n.r.Transition);let r=h(i,e);return r.start=t,r}function p(e,t,i){(0,o.Y2)(t===n.r.Transition);let r=h(t,e);return r.segmentId=i,r}},248222:function(e,t,i){i.d(t,{ES:function(){return c},Z:function(){return g},k7:function(){return u},kl:function(){return d},qu:function(){return p}});var r=i(426336),n=i(857670),a=i(854585),o=i(354267),s=i(804163),l=i(800788);let d=e=>{let{speed:t}=e,{mode:i,speed:n}=t;return!(i===r.yY$.SpeedModeNormal&&1===n)};function c(e,t,i){let n=e,a=t;if(i.draftView&&i.parentSegment){let e=i.parentSegment.targetTimerange.start,t=i.draftView.getTargetTimeRangeByOriginTargetTimeRange({start:n,duration:a},i.parentSegment);n=t.start-e,a=t.duration}return{id:`${o.Jy}-${e}-${t}`,type:"mutable",mutable:{locked:!0},title:"",metaType:r.cVg.MetaTypeNone,start:n,duration:a,originalTargetStart:e,originalTargetDuration:t,loading:!1,slots:[],animations:[],keyframesMap:{},commonKeyframes:[],visible:!0}}function u(e,t){let{targetStart:i,targetDuration:n}=e,{needComputeSpeed:o,draftView:d}=t;if(o){let t=d.getSegmentById(e.segmentId);(0,l.Y2)(t);let{start:r,duration:a}=t.targetTimerange;i=r,n=a}let c={keyframesMap:{},commonKeyframes:[],id:e.segmentId,title:"",metaType:void 0!==e.metaType?e.metaType:r.cVg.MetaTypeNone,start:i,duration:n,originalTargetStart:e.targetStart,originalTargetDuration:e.targetDuration,prolong:{start:e.sourceStart,duration:e.sourceDuration,total:e.duration},path:e.path,speed:1,loading:!1,slots:[],visible:!(0,r.OvQ)(e)||e.visible};return a.i$.includes(null==e?void 0:e.metaType)?Object.assign(c,{title:e.materialName,type:"mutableAudio",mutable:{locked:!1,mutableId:e.id,filled:!0},prolong:{start:e.sourceStart,duration:e.sourceDuration,total:e.duration}}):Object.assign(c,{type:"mutable",mutable:{locked:!1,mutableId:e.id,filled:e.filled,coverPath:e.coverPath},crop:e.crop?{ratio:s.Bt.CropRatioFree,box:{upperLeftX:e.crop[0],upperLeftY:e.crop[1],upperRightX:e.crop[2],upperRightY:e.crop[3],lowerLeftX:e.crop[4],lowerLeftY:e.crop[5],lowerRightX:e.crop[6],lowerRightY:e.crop[7]}}:void 0,material:{width:e.width,height:e.height},animations:e.animations,relation_video_group:e.relationVideoGroup}),c}function h(e,t){return e.length>1?function(e){let t=BigInt(Number.MAX_SAFE_INTEGER),i=0n,n=BigInt(Number.MAX_SAFE_INTEGER),a=0n,o=[];for(let s of e){if("mutable"===s.type)n=r.pMA.min([s.originalTargetStart,n],"bigint"),a=r.pMA.max([s.originalTargetStart+s.originalTargetDuration,a],"bigint"),t=r.pMA.min([s.start,t],"bigint"),i=r.pMA.max([s.start+s.duration,i],"bigint"),o.push(s)}let s=`mutable-poly-${o.map(e=>{let{id:t}=e;return t}).join("_")}`;for(let t of e)t.mutable&&"locked"in t.mutable&&!t.mutable.locked&&(t.mutable.parentMutableId=s);return{keyframesMap:{},commonKeyframes:[],id:s,type:"mutablePoly",mutable:{children:o},title:"",metaType:r.cVg.MetaTypeNone,start:t,duration:i-t,originalTargetStart:n,originalTargetDuration:a-n,loading:!1,slots:[],animations:e[0].animations,visible:!0}}(e.map(e=>u(e,t))):1===e.length?u(e[0],t):null}function g(e,t,i,a){let o,s=0n,d=[],u=0n,g=[],p=!1;a&&(e[0]&&e[0].targetStart<a.sourceTimerange.start&&(s=e[0].targetStart),p=!0,o=i.getCombinationApplySpeedDraftViewById(a.id),(0,l.Y2)(o));for(let t=0;t<e.length;++t){let i=e[t],{targetStart:n,targetDuration:m}=i;if(d.length){if(i.targetStart<u){d.push(i),u=r.pMA.max([u,n+m],"bigint");continue}let e=h(d,{needComputeSpeed:p,draftView:o});(0,l.Y2)(e,"[mutableTrackParser] empty poly but emit transfer"),g.push(e),s=u,d=[],u=0n}n>s+1n&&(g.push(c(s,n-s,{draftView:o,parentSegment:a})),s=i.targetStart),d.push(i),u=n+m}if(d.length){let e=h(d,{needComputeSpeed:p,draftView:o});if(!e)throw Error("[mutableTrackParser] empty poly but emit transfer");g.push(e),s=u}return(0,n.i1)(a?a.sourceTimerange.duration+a.sourceTimerange.start:t)>s+100000n&&g.push(c(s,t-s,{draftView:o,parentSegment:a})),{id:"mutable-track",type:"mutable",trackType:r.pNd.TrackTypeVideo,segments:g}}function p(e,t,i){let{shouldHideAudioName:n,videoTemplate:a,parentSegment:o}=i,s=!1,c=null;if(o&&d(o)){var h;s=!0,c=null!==(h=t.getCombinationApplySpeedDraftViewById(o.id))&&void 0!==h?h:null,(0,l.Y2)(c)}let g=e.map(e=>u(e,{needComputeSpeed:s,draftView:c,parentSegment:o}));return n&&!function(e,t){let i=e=>{var i;return null===(i=t.preload.mutableAudios)||void 0===i?void 0:i.some(t=>{var i;return t.id===(null==e?void 0:null===(i=e.mutable)||void 0===i?void 0:i.mutableId)&&t.material_name===e.title})};e.forEach(e=>{i(e)&&(e.title="")})}(g,a),{id:"mutable-audio-track",type:"mutableAudio",trackType:r.pNd.TrackTypeAudio,segments:g}}},836904:function(e,t,i){i.d(t,{c:function(){return a}});let r=RegExp("(?<h>\\??h+)?((?<dm>.)(?<m>\\??m+))?((?<ds>.)(?<s>\\??s+))?((?<dms>.)(?<ms>(ms)+))?((?<df>.)(?<f>(f)+))?");function n(e,t){return String(e).padStart(t,"0")}function a(e){var t,i;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?hh:mm:ss",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{h:l,m:d,dm:c="",s:u,ds:h="",ms:g,dms:p="",f:m,df:f=""}=null!==(i=null===(t=r.exec(a))||void 0===t?void 0:t.groups)&&void 0!==i?i:{},_=e,v="";if(m){let e=Math.round(_%1e3/1e3*o);v=`${n(e,m.replace(/^\?/,"").length)}`}if(g&&(v=`${n(_%1e3,g.replace(/^\?/,"").length/2)}${f}${v}`),_=Math.floor(_/1e3),u){let e=_%60;(e||!u.startsWith("?"))&&(v=`${n(e,u.replace(/^\?/,"").length)}${p||f}${v}`)}if(_=Math.floor(_/60),d){let e=_%60;if(s&&(e=_>9999?"9999+":_),(e||!d.startsWith("?"))&&(v=`${n(e,d.replace(/^\?/,"").length)}${h}${v}`),s)return v}if(_=Math.floor(_/60),l){let e=_;(e||!l.startsWith("?"))&&(v=`${n(e,l.replace(/^\?/,"").length)}${c}${v}`)}return v}},149795:function(e,t,i){i.d(t,{Z:function(){return o}});var r=i(772322),n=i(105789),a=i.n(n);i(69287);let o=e=>{let{type:t,width:i,left:n,right:o,isOnlyOne:s=!1}=e;return(0,r.jsx)("div",{className:"segment-arrow",children:(0,r.jsx)("div",{className:a()("animation-arrow",t,s?"one":""),style:n||o?{left:n-2,right:o-2,width:i,padding:"0 5px"}:{width:i-4},children:(0,r.jsx)("div",{})})})}},633282:function(e,t,i){i.d(t,{d:function(){return n}});var r=i(125780);function n(e,t,i,n){let a=n?r.J.LvIconMarkerActive:r.J.LvIconMarkerDefault;e.drawImage(a,i+-4.5*t,0*t,18,18)}},207754:function(e,t,i){i.d(t,{F:function(){return p}});var r=i(260963),n=i(402655),a=i(690674),o=i(857670),s=i(724081),l=i(426336),d=i(202426),c=i(257296),u=i(563890),h=i(969242),g=i(804497);class p extends n.JT{bindEventListeners(e){let t=this._onBeatMouseDown.bind(this),i=this._handleMouseMove.bind(this,e),r=this._handleMouseUp.bind(this);e.events.interact.on(d.TY.onBeatMouseDown,t),window.addEventListener("mousemove",i),window.addEventListener("mouseup",r),this._register({dispose:()=>{e.events.interact.off(d.TY.onBeatMouseDown,t),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",r)}}),this._register(this._modules.resource.onRestored(this._handleRestored.bind(this,e)))}bindDataChangeListeners(e){this._onTracksChange(),this._onProgressChange(e)}getProps(e){if("audio"!==e.type)return{beatsMap:void 0,beatActiveFrame:0};let t=new Map,{draftOperation:i}=this._modules;return(0,s.XZ)(e,!1,i).forEach(e=>{t.set(e.originBeat,e)}),{beatsMap:t,beatActiveFrame:l.pMA.div(this._timelineManagerStore[a.U_].progress,o.G8,"number","round")}}_onTracksChange(){let e=e=>{var t;return"audio"===e.type&&(null===(t=e.audio)||void 0===t?void 0:t.enableAiBeats)},t=(0,r.U5)(()=>this._timelineManagerStore[a.U_].tracks,t=>{if(!this._restored)t.forEach(t=>{let[i]=t;if("audio"===i.type)i.segments.forEach(t=>{let{id:i}=t;if(!!e(t)&&!!i)this._pendingSegmentIds.add(i)})})},{fireImmediately:!0});this._register({dispose:t})}_onProgressChange(e){let t=t=>{e.events.store.emit(d.ML.progressChange,t),(0,u.Mq)(e.children,[c.KX.Segment]).filter(e=>"audio"===e.data.segment.type).forEach(e=>{if(!e.destroyed){let{beatsMap:i}=e.data;if(!!(null==i?void 0:i.size))e.updateData({beatActiveFrame:l.pMA.div(t,o.G8,"number","round")},!0)}})},i=(0,r.U5)(()=>this._timelineManagerStore[a.U_].currentSeekTime,e=>{t(e)},{fireImmediately:!0});this._register({dispose:i})}_onBeatDragEnd(){if(!(this._draggingBeatAttr&&this._draggingBeatSegment))return;let{speed:e,start:t,sourceTimeRange:i}=this._draggingBeatSegment;this._newFormatFrame!==this._draggingBeatAttr.formatFrame&&this._modules.draftOperation.beat.updateBeat(this._draggingBeatSegment,{formatFrame:this._draggingBeatAttr.formatFrame,originBeat:this._draggingBeatAttr.originBeat},{formatFrame:this._newFormatFrame,originBeat:(0,o.qf)(this._newFormatFrame,e,null==i?void 0:i.start,t)})}_onBeatMouseDown(e,t,i){this._modules.selection.updateSelectData({segmentIds:[i.id]}),this._draggingBeatSegment=i,this._draggingBeatAttr=t,this._startDragPosX=e,this._newFormatFrame=t.formatFrame}_handleMouseMove(e,t){var i;let{zoomStore:r}=this._timelineManagerStore[a.U_];if(!(this._draggingBeatAttr&&this._draggingBeatSegment))return;this._timelineManagerStore[a.U_].setIsSegWidgetDragging(!0);let{clientX:n}=t,s=null!==(i=this._startDragPosX)&&void 0!==i?i:n,d=(0,o.i1)((0,h.TF)(r.value,n-s)),{id:c,start:p,duration:m}=this._draggingBeatSegment,f=this._draggingBeatAttr.formatFrame+Math.round(l.pMA.div(d,o.G8)),_=(0,g.Af)(f,p,m);this._newFormatFrame=_;let v=(0,u.JP)(e.children,c);if(v){let e=v.data.beatsMap;e instanceof Map&&(e.set(this._draggingBeatAttr.originBeat,{originBeat:this._draggingBeatAttr.originBeat,formatFrame:_}),v.updateData({beatsMap:e,refreshData:{}},!0,!0))}}_handleMouseUp(){this._onBeatDragEnd(),this._draggingBeatSegment=void 0,this._draggingBeatAttr=void 0,this._startDragPosX=void 0,this._timelineManagerStore[a.U_].setIsSegWidgetDragging(!1),document.body.style.cursor="default"}_updateAudioSegmentBeats(e,t){let{id:i}=t,r=this._modules.draftOperation.beat.getAudioBeatsMap(t);e.updateDataById(i,{beatsMap:r},!0)}_handleRestored(e){this._restored=!0,this._timelineManagerStore[a.U_].tracks.forEach(t=>{let[i]=t;if("audio"===i.type)i.segments.forEach(t=>{this._pendingSegmentIds.has(t.id)&&(this._updateAudioSegmentBeats(e,t),this._pendingSegmentIds.delete(t.id))})})}constructor(e,t){super(),this._timelineManagerStore=e,this._modules=t,this._newFormatFrame=0,this._restored=!1,this._pendingSegmentIds=new Set}}},896095:function(e,t,i){i.d(t,{e:function(){return u}});var r=i(789786),n=i(402655),a=i(202426),o=i(956626),s=i(230689),l=i(108692),d=i(426336),c=i(722169);class u extends n.JT{bindEventListeners(e){null==e||e.events.interact.on(a.TY.combinationSegmentEditStatusChange,this._handleCombinationSegmentEditStatusChange),null==e||e.events.interact.on(a.TY.exitEditSubSequence,this._onExitEditSubSequence),this._register({dispose:()=>{null==e||e.events.interact.off(a.TY.combinationSegmentEditStatusChange,this._handleCombinationSegmentEditStatusChange),null==e||e.events.interact.off(a.TY.exitEditSubSequence,this._onExitEditSubSequence)}})}constructor(e,t,i,r){super(),this._timelineManagerStore=e,this._modules=t,this._containerService=i,this._mainDraftService=r,this._handleCombinationSegmentEditStatusChange=(0,c.throttle)((e,t)=>{let{selection:i}=this._modules;if(e){var r,n;i.expandCombinationSegment(t),(0,o.SH)(this._containerService,{action_type:o.kO.CLICK,option_type:o.Ds.EDIT_TEMPLATE,action_position:o.X3.VIDEO,clip_type:o.U4.TRACK,position_type:o.o7.TIMELINE,clip_duration:Math.ceil(d.pMA.div(null!==(n=null===(r=this._mainDraftService.dataSdk.draftView.getSegmentById(null!=t?t:""))||void 0===r?void 0:r.targetTimerange.duration)&&void 0!==n?n:0,1e6))})}else i.mergeClips()},1e3),this._onExitEditSubSequence=()=>{var e,t;let{selection:i}=this._modules;i.mergeClips();let{selectedSegmentIds:r}=this._timelineManagerStore.timelineSelectionStore;(0,o.SH)(this._containerService,{action_type:o.kO.CLICK,option_type:o.Ds.INTEGRATE,action_position:o.X3.TIMELINE_BLANK,clip_type:o.U4.TRACK,position_type:o.o7.TIMELINE,clip_duration:Math.ceil(d.pMA.div(null!==(t=null===(e=this._mainDraftService.dataSdk.draftView.getSegmentById(r[0]))||void 0===e?void 0:e.targetTimerange.duration)&&void 0!==t?t:0,1e6))})}}}u=(0,r.gn)([(0,r.fM)(2,s.t),(0,r.fM)(3,l.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineManagerModules?Object:TimelineManagerModules,void 0===s.t?Object:s.t,void 0===l.n?Object:l.n])],u)},414482:function(e,t,i){i.d(t,{S:function(){return f},m:function(){return _}});var r=i(789786),n=i(801497),a=i(260963),o=i(402655),s=i(690674),l=i(563890),d=i(257296),c=i(26761),u=i(202426),h=i(426217),g=i(324230),p=i(230689),m=i(64447);class f extends o.JT{bindEventListeners(e){this._renderer=e,e.events.interact.on(u.TY.onColorDotMouseAction,this._handleColorDotMouseAction),e.events.view.on(u.H2.viewportPositionChange,this._reset),e.events.view.on(u.H2.viewportZoomChange,this._reset),this._register({dispose:()=>{e.events.interact.off(u.TY.onColorDotMouseAction,this._handleColorDotMouseAction),e.events.view.off(u.H2.viewportPositionChange,this._reset),e.events.view.off(u.H2.viewportZoomChange,this._reset)}})}bindDataChangeListeners(e){let t=(0,a.U5)(()=>({relationGroupColorMap:this._timelineManagerStore[s.U_].relationGroupColorMap,relationGroupAutoReplace:this._timelineManagerStore[s.U_].switches.autoReplace}),t=>{let{relationGroupColorMap:i}=t;if(0!==Object.keys(i).length)for(let t of(0,l.Mq)(e.children,[d.KX.Segment])){if(t.destroyed)continue;let{segment:e}=t.data,i=this.getProps(e);(!(0,c.t)(t.data.color,i.color)||!(0,c.t)(t.data.isColorActive,i.isColorActive))&&t.updateData(i,!0)}});this._register({dispose:t})}getProps(e){let{relationGroupColorMap:t,activeRelationGroup:i,switches:{autoReplace:r}}=this._timelineManagerStore.timelineStore;return{color:r&&e.relation_video_group?t[e.relation_video_group]:void 0,isColorActive:!!e.relation_video_group&&i===e.relation_video_group}}constructor(e,t,i){super(),this._timelineManagerStore=e,this._modules=t,this._containerService=i,this._delayTask=new m.i,this._reset=()=>{if(!!this._renderer)this._modules.autoReplace.setActiveRelationGroup(void 0,void 0),this._delayTask.reset(),this._renderer.events.interact.emit(u.TY.popupTooltip,!1)},this._handleColorDotMouseAction=(e,t,i)=>{switch(i){case"enter":this._delayTask.run(()=>{if(!!this._renderer)this._renderer.events.interact.emit(u.TY.popupTooltip,e,t,n.ZP.t("web_guide_tooltip_clip_color_dots",{},"The clips marked with the same color dots will be replaced with the same media."),"top")},500),this._modules.autoReplace.setActiveRelationGroup(t.relation_video_group,h.T.hover),(0,g.Q)(this._containerService,{clickType:"hover_clip"});break;case"leave":this._reset()}}}}f=(0,r.gn)([(0,r.fM)(2,p.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineManagerModules?Object:TimelineManagerModules,void 0===p.t?Object:p.t])],f);class _ extends o.JT{bindDataChangeListeners(e){let t=(0,a.U5)(()=>{let{relationGroupColorMap:e,switches:{autoReplace:t}}=this._timelineManagerStore[s.U_];return{relationGroupColorMap:e,relationGroupAutoReplace:t}},t=>{let{relationGroupColorMap:i}=t;if(0===Object.keys(i).length)return;let r=!1;for(let t of(0,l.Mq)(e.children,[d.KX.Track])){if(t.destroyed)continue;let{cTrack:e,includeRelationVideoGroup:i}=t.data,[n]=e,a=this.getProps(n);!(0,c.t)(a.includeRelationVideoGroup,i)&&t.updateData(a,!0),a.includeRelationVideoGroup&&(r=!0)}r&&(e.layout(),e.render())});this._register({dispose:t})}constructor(e){super(),this._timelineManagerStore=e,this.getProps=e=>{let{relationGroupColorMap:t,switches:{autoReplace:i}}=this._timelineManagerStore.timelineStore;return i?{includeRelationVideoGroup:e.segments.some(e=>e.relation_video_group&&t[e.relation_video_group])}:{includeRelationVideoGroup:!1}}}}},316699:function(e,t,i){i.d(t,{V:function(){return S}});var r=i(789786),n=i(260963),a=i(138527),o=i(520486),s=i(940802),l=i(397542),d=i(251894),c=i(207754),u=i(414482),h=i(589259),g=i(451694),p=i(590944),m=i(546134),f=i(230689),_=i(410463);let v=[c.F,s.t,a.r,o.I,l.k,d.m,u.S,p.R,h.M,g.P,m.i,_.B];class S{_initControllers(){for(let e of v)this._controllers.push(this._containerService.createInstance(e,this._timelineManagerStore,this._modules))}getProps(e,t,i,r){let a=(0,n.ZN)(e.keyframesMap),o={track:i,trackIndex:r,segment:e,segmentIndex:t,keyframesMap:a,isReadonlyMode:this._timelineManagerStore.timelineInteractStore.disableReadonlyMode,isActive:this._timelineManagerStore.timelineSelectionStore.canvasUISelectedSegmentIds.includes(e.id)};for(let t of this._controllers)Object.assign(o,t.getProps(e,i));return o}constructor(e,t,i){this._timelineManagerStore=e,this._modules=t,this._containerService=i,this._controllers=[],this._initControllers()}}S=(0,r.gn)([(0,r.fM)(2,f.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineManagerModules?Object:TimelineManagerModules,void 0===f.t?Object:f.t])],S)},616477:function(e,t,i){i.d(t,{G:function(){return a}});var r=i(414482),n=i(721244);class a{_initControllers(){}getProps(e,t,i,n){let[a]=t;return{cTrack:t,bgState:this._checkIsTrackSelected(a,this._timelineManagerStore.timelineSelectionStore.canvasUISelectedSegmentIds,i)?"selected":"default",replaceHover:!1,display:this.getTrackDisplay(t,e),isReadonlyMode:this._timelineManagerStore.timelineInteractStore.disableReadonlyMode,...new r.m(this._timelineManagerStore).getProps(n)}}getTrackDisplay(e,t){if(["dragVideoPlaceholder","dragAudioPlaceholder"].includes(e[0].type))return n.j.Loading;let[i]=e,r=n.j.None;return("none"===i.type||"video"===i.type&&i.segments.length<=0)&&(r=t.length<=1?n.j.Empty:n.j.Placeholder),r}_checkIsTrackSelected(e,t,i){let r=!1;return!(r=e.segments.some(e=>t.includes(e.id)))&&(r=i.some(e=>{let[i]=e;return t.includes(i.id)})),r}constructor(e){this._timelineManagerStore=e,this._initControllers()}}},216331:function(e,t,i){i.d(t,{b:function(){return g}});var r=i(345299),n=i(183797),a=i(396493),o=i(853418),s=i(718540),l=i(257296),d=i(616477),c=i(879098),u=i(800788),h=i(426336);class g{getRenderActions(e,t,i){let n=e[r.A.TRACK],s=[];for(let e of n)switch(e.type){case r.P.ADD:{let r=this._getTrackProps(e.nextValue.id,t,i);r&&s.push(new a.eX(l.KX.Track,e.nextValue.id,{params:r}));break}case r.P.DELETE:s.push(new o.x(l.KX.Track,e.prevValue.id,void 0));break;case r.P.UPDATE:{let r=this._getTrackProps(e.nextValue.id,t,i);r&&s.push(new c.Pj(l.KX.Track,e.nextValue.id,{params:r}));break}default:(0,u.bP)(e)}for(let n of e[r.A.SEGMENT])if(this._isNeedUpdateTrack(n)){if(n.nextTrackId&&!s.find(e=>e.key===n.nextTrackId)){let e=this._getTrackProps(n.nextTrackId,t,i);e&&s.push(new c.Pj(l.KX.Track,n.nextTrackId,{params:e}))}if(n.prevTrackId&&!s.find(e=>e.key===n.prevTrackId)){let e=this._getTrackProps(n.prevTrackId,t,i);e&&s.push(new c.Pj(l.KX.Track,n.prevTrackId,{params:e}))}}return s}_getTrackProps(e,t,i){let r=(0,s.j)(t,e);if(!r)return;let[a]=r,o=null==i?void 0:i.find(e=>e[0].id===a.id),l=(0,n.mk)(a.segments);return this._canvasObjectPropsManager.getProps(t,r,l,o?o[0]:r[0])}_isNeedUpdateTrack(e){return!![r.P.ADD,r.P.DELETE].includes(e.type)||!!e.notifyOperationList.find(e=>e.type===h.C8.MOVE)}constructor(e){this._store=e,this._canvasObjectPropsManager=new d.G(this._store)}}},473920:function(e,t,i){i.d(t,{h:function(){return n}});var r=i(716913);function n(e,t){return e.some(e=>{let{item:i}=e;return void 0!==(0,r.Z)(i.segment,t)})}},77665:function(e,t,i){i.d(t,{I:function(){return a},T:function(){return n}});let r=new Set(["video","audio","combination"]),n=e=>{let{type:t}=e;return r.has(t)},a=(e,t)=>{let{segment:i,isActive:r,isLoading:n,isHover:a}=e;return(!!a||!!r)&&("combination"!==i.type||!a||!r)&&(!!r||!n||"template-post"===t.mode)&&!0}},857458:function(e,t,i){i.d(t,{F:function(){return n}});var r=i(801497);let n=new class e{t(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[n,a,o]=t,s=Object.values(null!=a?a:{}).concat(n).join("-");if(this.cacheMap.has(s))return this.cacheMap.get(s);let l=r.ZP.t(n,a,o);return this.cacheMap.set(s,l),l}constructor(){this.cacheMap=new Map}}},789872:function(e,t,i){i.d(t,{Z:function(){return n}});var r=i(202426);class n{setContainerPaddingLeft(e){this._containerPaddingLeft=e}initViewportSize(e,t){this._containerWidth=e,this._containerHeight=t}resize(e,t){let i=this.getViewport();this._containerWidth=e,this._containerHeight=t,this._viewportWidth>this._realWidth&&this._setWorldSize({width:this._viewportWidth}),this._containerHeight>this._realHeight?this._setWorldSize({height:this._containerHeight}):this._setWorldSize({height:this._realHeight}),this.updateCameraBounds(),(this._viewportWidth!==i.width||this._containerHeight!==i.height)&&this._events.view.emit(r.H2.viewportSizeChange,this.getViewport(),i)}setPosition(e,t){let i=this.getViewport();this._x=e,this._y=t,this.updateCameraBounds(),(this._viewportX!==i.x||this._y!==i.y)&&this._events.view.emit(r.H2.viewportPositionChange,this.getViewport(),i)}updateCameraBounds(){let e=this.getBounds();this._cameraBounds.x=Math.max(0,this._viewportX-this._containerWidth*(n.horizontalBufferRatio/2)),this._cameraBounds.width=Math.max(Math.min(this._containerWidth+this._containerWidth*n.horizontalBufferRatio,this._worldBounds.width),this._containerWidth),this._cameraBounds.y=0,this._cameraBounds.height=this._worldBounds.height,(this._cameraBounds.width!==e.width||this._cameraBounds.height!==e.height)&&this._events.view.emit(r.H2.cameraSizeChange,this.getBounds(),e)}setZoom(e){let t=this.zoom;this.zoom=e,this._events.view.emit(r.H2.viewportZoomChange,e,t)}setRealWidth(e){this._realWidth=e,this._setWorldSize({width:Math.max(this._realWidth,this._viewportWidth)})}setRealHeight(e){this._realHeight=e,this._setWorldSize({height:Math.max(this._realHeight,this._containerHeight)})}getViewport(){return{width:this._viewportWidth,height:this._containerHeight,x:this._viewportX,y:this._y}}getBounds(){return{...this._cameraBounds}}getWorldBounds(){return{...this._worldBounds}}getRealBounds(){return{height:this._realHeight,width:this._realWidth}}get _viewportX(){return Math.max(0,this._x-this._containerPaddingLeft)}get _viewportOffsetX(){return Math.max(0,this._containerPaddingLeft-this._x)}get _viewportWidth(){return this._containerWidth-this._viewportOffsetX}_setWorldSize(e){let t=this.getWorldBounds();void 0!==e.width&&(this._worldBounds.width=e.width),void 0!==e.height&&(this._worldBounds.height=e.height),this.updateCameraBounds(),(this._worldBounds.width!==t.width||this._worldBounds.height!==t.height)&&this._events.view.emit(r.H2.worldSizeChange,this.getWorldBounds(),t)}constructor(e){this._x=0,this._y=0,this._containerWidth=0,this._containerHeight=0,this._containerPaddingLeft=0,this._realWidth=0,this._realHeight=0,this.zoom=1,this._worldBounds={x:0,y:0,width:0,height:0},this._cameraBounds={x:0,y:0,width:0,height:0},this._events=e}}n.horizontalBufferRatio=2},831858:function(e,t,i){i.d(t,{Z:function(){return l}});var r=i(257296),n=i(932919),a=i(563890),o=i(628499),s=i(921911);class l extends o.G{_createCoverNodes(){let{textEditCovers:e=[]}=this.data;this._children=e.map(e=>new s.Y({layer:this._layer,data:this.data,textEditCover:e,group:this._coverGroup,context:this.context,style:this._relatedCanvasObjectStyle}))}_clearCoverNodes(){this._children.forEach(e=>{e.destroy()}),this._children=[]}mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)!=="template")return this._coverGroup=new n.Group({name:(0,a.Vo)(this._trackId,r.KX.Track,r.KX.CoverGroup)}),this._coverGroup}updateData(e,t,i){if(!!this.data)Object.assign(this.data,e),this._clearCoverNodes(),this._createCoverNodes(),super.updateData(e,t,i)}constructor(e){let{layer:t,data:i,context:n,style:o,trackId:s}=e;super({layer:t,type:r.KX.CoverGroup}),this.dataPropertyNames=["textEditCovers"],this.data=i,this.context=n,this._relatedCanvasObjectStyle=o,this._trackId=s,this._container=(0,a.dX)(t,r.PB.CoverGroup)}}},384971:function(e,t,i){i.d(t,{C5:function(){return s},TF:function(){return u},q7:function(){return c},yW:function(){return l}}),i(827322);var r=i(257296),n=i(857458),a=i(125780),o=i(426336);function s(e){return Math.max(1,e-2*r.iX)}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.LY;return e<0?0:Math.floor(Math.min(e/2,t))}let d=e=>{let t=`${null==e?void 0:e.materialType}-${null==e?void 0:e.addType}`;return({[`${o.cVg.MetaTypeSubtitle}-${o.RZH.ManualAdd}`]:a.J.LvIconCaptions,[`${o.cVg.MetaTypeSubtitle}-${o.RZH.RecognizeAdd}`]:a.J.LvIconSubtitleAutoCaptions,[`${o.cVg.MetaTypeSubtitle}-${o.RZH.ImportAdd}`]:a.J.LvIconSubtitleAutoCaptions,[`${o.cVg.MetaTypeLyrics}-${o.RZH.ManualAdd}`]:a.J.LvIconCaptions,[`${o.cVg.MetaTypeLyrics}-${o.RZH.RecognizeAdd}`]:a.J.LvIconSubtitle,[`${o.cVg.MetaTypeLyrics}-${o.RZH.ImportAdd}`]:a.J.LvIconSubtitle})[t]||a.J.LvIconText};function c(e,t,i){return i?a.J.Warning:"text"===e?d(t):({videoEffect:a.J.LvIconEffects,filter:a.J.LvIconFilters,pictureAdjust:a.J.LvIconBrandAdjust,text:a.J.LvIconText,textTemplate:a.J.LvIconComponent,effect:a.J.LvIconEffects})[e]}let u=e=>{switch(e){case"video":return n.F.t("web_materialSearch_text_lost_video",{},"Lost video");case"audio":return n.F.t("web_materialSearch_text_lost_audio",{},"Lost audio");case"text":case"textTemplate":return n.F.t("web_materialSearch_text_lost_text",{},"Lost text");case"sticker":return n.F.t("web_materialSearch_text_lost_sticker",{},"Lost sticker");case"videoEffect":return n.F.t("web_materialSearch_text_lost_effect",{},"Lost Effect");case"filter":return n.F.t("web_materialSearch_text_lost_filter",{},"Lost filter");case"pictureAdjust":return n.F.t("adjustment_loss",{},"\u8C03\u8282\u4E22\u5931");default:return n.F.t("media_lost",{},"Lost media")}}},804718:function(e,t,i){i.d(t,{Z:()=>q});var r=i("257296"),n=i("51173"),a=i("684432"),o=i("887860"),s=i("439781"),l=i("82271"),d=i("917954"),c=i("563890"),u=i("628499"),h=i("629818"),g=i("813269"),p=i("72411"),m=i("251976"),f=i("620183"),_=i("202426"),v=i("384971");let S=["video","audio","mutable","mutablePoly","mutableAudio","combination"];class y extends u.G{static updateImageScale(e,t,i){let{thumbnailImage:r}=i;if(r&&r.width>0&&r.height>0){let i=e.height/r.height;t.fillPatternScale({x:i,y:i})}}updateImageAttrs(e,t,i){let{thumbnailImage:r,imageOffsetX:n=0}=i;r&&r.width>0&&r.height>0&&(t.fillPriority("pattern"),t.fillPatternImage(r),t.fillPatternOffsetX(n),y.updateImageScale(e,t,i),this._prevImage=r)}mount(){let{data:e,style:t}=this,{events:i}=this.context,{x:n,y:a,width:o,height:s}=t,{segment:l,thumbnailImage:d,isLost:u}=e,{type:h,id:g}=l,p=(0,v.C5)(o),y=new f.Rect({x:n+r.iX,y:a,width:p,height:s,fill:m.SU[h],cornerRadius:(0,v.yW)(p),name:(0,c.Vo)(g,r.KX.Segment,r.CD.Background)});if(u){var b;y.fillPriority("color"),y.fill(null!==(b=m.ey[h])&&void 0!==b?b:"#444")}else S.includes(e.segment.type)&&d&&this.updateImageAttrs(t,y,e);return y.on("mouseenter",e=>{i.interact.emit(_.TY.onSegmentMouseEnter,e)}),y.on("mouseleave",e=>i.interact.emit(_.TY.onSegmentMouseLeave,e)),y}update(){let{data:e,style:t}=this,[i]=this._konvaNodes,{x:n,y:a,width:o,height:s}=t,{isLost:l,segment:d}=e,c=(0,v.C5)(o),u=i.height();i.setAttrs({x:n+r.iX,y:a,width:c,height:s,cornerRadius:(0,v.yW)(c),fill:m.SU[d.type]});let{thumbnailImage:h}=e;if(l){var g;i.fillPriority("color"),i.fill(null!==(g=m.ey[d.type])&&void 0!==g?g:"#444")}else S.includes(e.segment.type)&&h&&(this._prevImage!==h||this._prevLost!==l)?this.updateImageAttrs(t,i,e):h&&u!==s&&y.updateImageScale(t,i,e);this._prevLost=l}constructor(...e){super(...e),this.dataPropertyNames=["thumbnailImage","imageOffsetX","segment","isLost","status"],this._prevLost=!1}}var b=i("876813"),A=i("529206");function M(e){return e.isLocked?"rgba(0, 0, 0, 0.7)":e.disabled?"rgba(0, 0, 0, 0.5)":m.wL.lvvColorBlack02}class T extends u.G{mount(){var e;let{data:t,style:i}=this,{x:n,y:a,width:o,height:s}=i,{id:l}=t.segment,d=(0,v.C5)(o);return new f.Rect({visible:(null===(e=this.context)||void 0===e?void 0:e.mode)==="template-post"||!!this.data.disabled,x:n+r.iX,y:a,width:d,height:s,name:(0,c.Vo)(l,r.KX.Segment,r.CD.Mask),fill:M(t),cornerRadius:(0,v.yW)(d)})}update(){var e;let{data:t,style:i}=this,n=this._konvaNodes[0],{x:a,y:o,height:s,width:l}=i,d=(0,v.C5)(l);n.setAttrs({visible:(null===(e=this.context)||void 0===e?void 0:e.mode)==="template-post"||!!this.data.disabled,x:a+r.iX,y:o,width:d,height:s,fill:M(t),cornerRadius:(0,v.yW)(d)})}constructor(...e){super(...e),this.dataPropertyNames=["segment","disabled","isLocked"]}}var w=i("802501"),C=i("772962"),I=i("932919"),x=i("931774");function k(e){let{x:t,y:i,width:r,height:n}=e;return{x:t+r/2-6,y:i+n,width:12,height:12,visible:r>=8}}function D(){return{x:0,y:0,width:12,height:12,visible:!0}}function P(e,t){let i=t?8:6;return{x:6-i/2,y:6-i/2,width:i,height:i,cornerRadius:i/2,fill:e,visible:!!e}}class R extends u.G{mount(){let{data:e,style:t,context:i}=this,{events:n}=i,{color:a,isColorActive:o,segment:s}=e;if(!a)return;let l=new I.Group({...k(t),name:(0,c.Vo)(s.id,r.KX.Segment,r.CD.ColorDot),listening:!0}),d=new f.Rect(D()),u=new f.Rect(P(a,o));l.add(d,u);let h=()=>({x:t.x+t.width/2+(0,x.Ko)(t,i.camera),y:t.y});return l.on("mouseenter",()=>{n.interact.emit(_.TY.onColorDotMouseAction,h(),s,"enter")}),l.on("mouseleave",()=>{n.interact.emit(_.TY.onColorDotMouseAction,h(),s,"leave")}),l.on("mouseup",()=>{n.interact.emit(_.TY.onColorDotMouseAction,h(),s,"up")}),l.on("mousedown",()=>{n.interact.emit(_.TY.onColorDotMouseAction,h(),s,"down")}),l}update(){var e;let{data:t,_konvaNodes:i}=this,r=i[0],[n,a]=null!==(e=r.children)&&void 0!==e?e:[],{color:o,isColorActive:s}=t;if(!o){r.visible(!1);return}r.setAttrs(k(this.style)),n.setAttrs(D()),a.setAttrs(P(o,s))}constructor(...e){super(...e),this.dataPropertyNames=["color","segment"]}}var E=i("846591"),U=i("125780"),B=i("288712"),L=i("559408"),N=i("644314"),j=i("928261"),F=i("389267"),V=i("933162"),O=i("804497"),W=i("801497");class Z extends u.G{mount(){let{segment:e}=this.data,{id:t,visible:i}=e;if(!(0,N.lG)(e)||!i)return;let{x:n,y:a}=this.style,o=new I.Group({x:n,y:a,name:(0,c.Vo)(t,r.KX.Segment,r.CD.MutableHideIcon)}),s=U.J.LvIconHide,l=new B.Image({image:s,height:r.Bt,width:r.lz,shadowForStrokeEnabled:!1,shadowOffsetX:0,shadowOffsetY:1,shadowBlur:4});return this._flatNodeMap.set("hideIcon",l),o.add(l),this._flatNodeMap.set("IconGroup",o),this._addHideIconEvent(o),this._checkVisible()?o.visible(!0):o.visible(!1),this._updateIconPosition(o),o}update(){let{data:e}=this,t=this._flatNodeMap.get("IconGroup"),{segment:i,status:r}=e;if(!(0,N.lG)(i)||"loading"===r||!this._checkVisible()){null==t||t.visible(!1);return}null==t||t.visible(!0),this._updateIconPosition(t)}_updateIconPosition(e){let t=(0,x.x8)(this.style,this.context.camera),{x:i,y:n,width:a,height:o}=this.style,s=i+a-r.Bt-r.GW-(t?t+r.GW:0);e.x(s),e.y(n+o-r.lz-r.lA)}_addHideIconEvent(e){if(!!e)e.on("mouseenter",()=>{this._hoverIconGroup=!0;let t=this._flatNodeMap.get("hideIcon"),i=this._flatNodeMap.get("IconGroup");t&&(t.setAttrs({image:U.J.LvIconHideActive}),null==i||i.visible(!0));let{segment:n}=this.data,{x:a,width:o,y:s,height:l}=this.style;i&&this.context&&this.context.events.interact.emit(_.TY.popupTooltip,{x:a+o-r.Bt/2-r.GW,y:s+l},n,W.ZP.t("web_material_button_hide",{},"Hide"),"bottom"),(0,F.Ay)(e,"pointer")}),e.on("mouseleave",()=>{var t;this._hoverIconGroup=!1;let i=this._flatNodeMap.get("hideIcon");i&&i.setAttrs({image:U.J.LvIconHide}),null===(t=this.context)||void 0===t||t.events.interact.emit(_.TY.popupTooltip,!1),(0,F.Ay)(e,"cursor")}),e.on("click",()=>{let{data:e,context:t}=this,{segment:i}=e,{mutable:r}=i,{events:n}=t;if(!(!(0,N.Dt)(i)||(0,j._n)(i.mutable)||(0,j.rE)(i.mutable))&&(null==r?!void 0:!r.filled))n.interact.emit(_.TY.clickHideMutableSegment,i.id,!i.visible)})}_checkVisible(){let e=this._flatNodeMap.get("IconGroup"),{context:t,style:i,data:n}=this,{segment:a,isActive:o,isHoverMutableButton:s}=n;if(!e||!t||!o&&!s&&!this._hoverIconGroup)return!1;let{width:l,height:d}=i,c=r.Bt+2*r.GW,u=(0,v.C5)(l),h=(0,x.Fl)(i,t.camera),g=new L.Text({height:r.sP,text:(0,O.Mc)(a.duration),fontSize:12,fontStyle:"500",fontFamily:r.I8,verticalAlign:"middle",wrap:"none",ellipsis:!0,listening:!1}).width()+2*r.vX;return(!(h>=0)||!(h<c+g))&&((0,V.U4)(d)?c+g<u:c+V.lD+g<u)}constructor(...e){super(...e),this.dataPropertyNames=["segment","status","isHoverMutableButton"],this._hoverSegment=!1,this._hoverIconGroup=!1}}var z=i("781792"),G=i("367427"),K=i("680145"),Q=i("426336");let H="group",Y="trimMask";class J extends u.G{_getSplitPosition(){let{parentSegment:e,segment:{originalTargetDuration:t,originalTargetStart:i}}=this.data,{sourceTimeRange:{start:r=i,duration:n=t}={}}=null!=e?e:{};return(0,Q.VwQ)([i,i+t],[r,r+n])}_updateTrimMask(){let e=this._flatNodeMap.get(Y),t=this._flatNodeMap.get(H);if(!e||!t)return;if(!this.data.segment.visible){e.visible(!1);return}t.setAttrs({x:this.style.x,y:this.style.y});let{displayWidth:i}=this._displayAttrs,r=i/2;e.setAttrs({width:r,height:this.style.height});let n=e.getAttr("fillPatternImage"),a=this._getSplitPosition();n?e.setAttrs({x:"right"===a?r:0}):(0,x.oS)(this,K.b.Weave,K.N[K.b.Weave],e,{fillPatternRepeat:"repeat-x",x:"right"===a?r:0}),e.visible(!0)}_updateNodes(){if(!this._shouldRenderMask())return;let{style:{width:e}}=this,t=(0,v.C5)(e);this._displayAttrs={...this._displayAttrs,displayWidth:t},this._updateTrimMask()}_shouldRenderMask(){let{data:e}=this,{segment:t}=e;return(0,N.Dt)(t)&&"mutablePoly"!==t.type&&(0,V.PM)(e)&&!t.mutable.locked}mount(){if(!this._shouldRenderMask())return;let{data:e,style:t}=this,{segment:i}=e,{mutable:n}=i;if(!n)throw Error("segment mutable missing");let{x:a,y:o,width:s,height:l}=t,{id:d}=i,u=(0,v.C5)(s),h=new I.Group({x:a+r.iX,y:o,width:u,height:l,name:(0,c.Vo)(d,r.KX.MutableTrimMask,r.CD.MutableButton)});this._flatNodeMap.set(H,h);let g=new f.Rect({x:0,y:0,width:u/2,height:l,name:(0,c.Vo)(d,r.KX.MutableTrimMask,r.CD.MutableButton),listening:!1});return g.visible(!1),this._flatNodeMap.set(Y,g),h.add(g),this._updateNodes(),h}update(){if(!!this._shouldRenderMask())this._updateNodes()}destroy(){super.destroy()}constructor(...e){super(...e),this.dataPropertyNames=["segment"],this._displayAttrs={displayWidth:0}}}var X=i("359595");class q extends u.G{get keyframeGroup(){return this._keyframeGroup}_initChildren(){switch(this.data.segment.type){case"mutable":case"mutablePoly":this._children=[y,b.L,T,A.u,R,Z,J,X.E].map(e=>new e({layer:this._layer,data:this.data,style:this.style,context:this.context,container:this._container,type:r.KX.Default}));break;case"mutableAudio":{let e=[y];"template"===this.context.mode&&e.push(d.YF),e.push(b.L,T),this._children=e.map(e=>new e({layer:this._layer,data:this.data,style:this.style,context:this.context,container:this._container,type:r.KX.Default}));break}default:{let e=[y,n.J,a.D,p.A,G.$,E.L];"template-post"===this.context.mode&&e.push(T),e.push(w.W,s.C,o.H,C.x,l.k,h.Z),this._children=e.map(e=>new e({layer:this._layer,data:this.data,style:this.style,context:this.context,container:this._container,type:r.KX.Default}));let t=new z.Z({layer:this._layer,data:this.data,style:this.style,context:this.context,segId:this.id,visible:!!this.data.isActive});this._children.push(t),this._keyframeGroup=t}}}render(){if(!this._inViewport){var e;null===(e=this._activeBorder)||void 0===e||e.setVisible(!1);return}this._children.forEach(e=>{e.render()}),this._isMounted=!0,this._applyActive()}active(e,t){var i;let r=this.data.isActive;this.updateData({isActive:e});let n=r!==e;null===(i=this._keyframeGroup)||void 0===i||i.setVisible(e&&"template-post"!==this.context.mode&&this._visible,!0),t&&n&&this.render()}_applyActive(){if(!!this._isMounted)this.data.isActive||this.data.replaceHover?this._renderActiveBorder():this._clearActiveBorder()}_clearActiveBorder(){if(!!this._activeBorder)this.context.cache.activeBorder.set(this._activeBorder),this._activeBorder=void 0}_renderActiveBorder(){!this._activeBorder&&(this._activeBorder=this.context.cache.activeBorder.get(()=>new g.L({layer:this._layer,data:this.data,style:this.style,context:this.context})),this._activeBorder.setData(this.data),this._activeBorder.setStyle(this.style)),this._activeBorder.setVisible(this._visible),this._activeBorder.render()}updateKeyframeGroupData(e,t,i){var r;null===(r=this._keyframeGroup)||void 0===r||r.updateData(e,t,i)}clear(){this._clearActiveBorder(),this._children.forEach(e=>e.clear()),super.clear()}updateData(e,t,i){i&&(this._children.forEach(e=>{e.clearOnInit&&e.clear()}),this._clearActiveBorder()),super.updateData(e,t,i),"replaceHover"in e&&this._applyActive()}_applyVisible(){var e;null===(e=this._activeBorder)||void 0===e||e.setVisible(this._visible),super._applyVisible()}constructor(e){let{layer:t,id:i,data:n,context:a,style:o}=e;super({layer:t,type:r.KX.Segment,id:i,style:o,context:a}),this.data=n,this.context=a;let s=r.PB.SegmentGroup;"sub"===this.data.sequenceType&&(s=r.PB.MaskGroup),this._container=(0,c.dX)(t,s),this._initChildren(),this._inViewport=!1}}},985485:function(e,t,i){i.d(t,{Z:function(){return g}});var r=i(931774),n=i(77665),a=i(251976),o=i(257296),s=i(932919),l=i(288712),d=i(628499),c=i(384971),u=i(125780);let h={Group:"Group",Background:"Background",Text:"Text"};class g extends d.G{mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)==="template"||!(0,n.I)(this.data,this.context))return;let t=new s.Group({listening:!1});return this._flatNodeMap.set(h.Group,t),this.update(),t}update(){let e=this._flatNodeMap.get(h.Group),t=this.getContainer();if(!(0,n.I)(this.data,this.context)||!t||!this.data.isLost){e.visible(!1);return}let{segment:i}=this.data,s="template-post"===this.context.mode?16:14,d=this._flatNodeMap.get(h.Background);if(!d){d=(0,r.eN)({name:h.Background,height:s,fill:a.wL.segmentLostTipsBackgroundColor}),this._flatNodeMap.set(h.Background,d),e.add(d);let t=o.ZT,i=new l.Image({x:t,y:(s-12)/2,width:12,height:12,image:u.J.Warning,listening:!1});e.add(i);let n=(0,r.Ny)({y:1,name:h.Text,x:t+12+2,height:s-2});this._flatNodeMap.set(h.Text,n),e.add(n)}let g=this._flatNodeMap.get(h.Text);g.text((0,c.TF)(i.type)),d.width(g.x()+g.getTextWidth()+o.ZT),e.visible(!0);let p=(0,r.cx)(t,e,o.Kp);e.x(p)}}},821044:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(801497),n=i(931774),a=i(77665),o=i(257296),s=i(932919),l=i(628499);let d={Group:"Group",Background:"Background",Text:"StabilizeText"};class c extends l.G{mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)==="template"||!(0,a.I)(this.data,this.context))return;let t=new s.Group({listening:!1});return this._flatNodeMap.set(d.Group,t),this.update(),t}update(){let e=this._flatNodeMap.get(d.Group),t=this.getContainer();if(!(0,a.I)(this.data,this.context)||!t)return;let{segment:i}=this.data,s=r.ZP.t("web_video_stable_text_stablize",{},"Stabilize"),l=(0,a.T)(i)&&i.stabilize,c="template-post"===this.context.mode?16:14;if(l){var u;let i=this._flatNodeMap.get(d.Background);if(!i){i=(0,n.eN)({name:d.Background,height:c}),this._flatNodeMap.set(d.Background,i),e.add(i);let t=(0,n.Ny)({name:d.Text,x:o.ZT,height:c-2});this._flatNodeMap.set(d.Text,t),e.add(t)}let r=(0,n.cx)(t,e,o.Kp);e.x(r);let a=this._flatNodeMap.get(d.Text);a.text(s),a.direction(null!==(u=this.context.direction)&&void 0!==u?u:"ltr"),i.width(a.x()+a.getTextWidth()+o.ZT)}e.visible(!!l)}}},961569:function(e,t,i){i.d(t,{Z:function(){return h}});var r=i(426336),n=i(801497),a=i(931774),o=i(77665),s=i(257296),l=i(932919),d=i(628499);let c={Group:"Group",Background:"Background",Text:"TitleText"},u=(e,t,i)=>{if("text"===e){if(!t||"\b"===t||""===t.trim())return(null==i?void 0:i.materialType)===r.cVg.MetaTypeSubtitle||(null==i?void 0:i.materialType)===r.cVg.MetaTypeLyrics?n.ZP.t("subtitle_content",{},"Captions"):n.ZP.t("web_text",{},"\u6587\u672C")}else if("textTemplate"===e)return n.ZP.t("text_overlay",{},"\u6587\u5B57\u6A21\u677F");else if("sticker"===e)return n.ZP.t("sticker_web_s",{},"\u8D34\u7EB8");return t};class h extends d.G{mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)==="template"||!(0,o.I)(this.data,this.context))return;let t=new l.Group({listening:!1});return this._flatNodeMap.set(c.Group,t),this.update(),t}update(){let e=this._flatNodeMap.get(c.Group),t=this.getContainer();if(!(0,o.I)(this.data,this.context)||!t)return;let{segment:i,hideTitle:r}=this.data,n=u(i.type,i.title,i.text),l=this.style.width>s.Kp+2*s.ZT+2*s.kT,d=n&&!r,h="template-post"===this.context.mode?16:14;if(d&&l){var g;let i=this._flatNodeMap.get(c.Background);if(!i){i=(0,a.eN)({name:c.Background,height:h}),this._flatNodeMap.set(c.Background,i),e.add(i);let t=(0,a.Ny)({name:c.Text,x:s.ZT,height:h-2});this._flatNodeMap.set(c.Text,t),e.add(t)}let r=(0,a.cx)(t,e,s.Kp);e.x(r);let o=this._flatNodeMap.get(c.Text);o.text(n),o.direction(null!==(g=this.context.direction)&&void 0!==g?g:"ltr"),i.width(o.x()+o.getTextWidth()+s.ZT)}e.visible(!!d)}}},933162:function(e,t,i){i.d(t,{$e:function(){return T},Aw:function(){return w},G7:function(){return S},IG:function(){return P},Mx:function(){return y},PD:function(){return D},PM:function(){return I},RJ:function(){return M},Ss:function(){return v},U4:function(){return A},X5:function(){return R},Zf:function(){return x},gw:function(){return f},hQ:function(){return C},lD:function(){return _},pZ:function(){return k},rK:function(){return b}});var r=i(202426),n=i(257296),a=i(251976),o=i(857458),s=i(559408),l=i(932919),d=i(931774),c=i(384971),u=i(125780),h=i(680145),g=i(426336),p=i(563890),m=i(739801);let f={status:void 0,locked:!1,filled:!1,multiple:!1,countTotal:1,countFilled:0,visible:!0},_=n.me+2*n.q0;function v(e){var t;let{segment:i,status:r,gamePlayProcessing:n,loadingCancelable:a,replaceHover:o,isActive:s}=e,{mutable:l}=i,{locked:d=!1}=l||{},{filled:c=!1}=l||{},u=(null==l?void 0:l.children)||[],h=u.filter(e=>e.visible),g=u.length>0;g&&(c=null==h?void 0:h.every(e=>{var t;return null===(t=e.mutable)||void 0===t?void 0:t.filled}));let p=null!==(t=h.length)&&void 0!==t?t:0,m=g?h.reduce((e,t)=>{let{mutable:i}=t;return i.filled?e+1:e},0):c?1:0,f=g&&0===h.length;return{status:r,replaceHover:o,locked:d,filled:c,multiple:g,countTotal:p,countFilled:m,loadingCancelable:a,gamePlayFailed:"failed"===r&&n,gamePlayProcessing:n,isActive:s,visible:g?!f:void 0===i.visible||i.visible}}function S(e){let{groupHover:t=!1,renderStatus:i,style:r}=e,{filled:a,multiple:o,status:s}=i,{x:l,y:d}=r;return{groupX:l+n.iX,groupY:d,groupOpacity:t||!a||o||s?1:0,groupHeight:r.height}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{filled:i,multiple:r,status:n,isActive:a,visible:o,locked:s}=e;return(o||a||t)&&(!s||t||a)?t||!i||r||n||a?1:0:0}function b(e){let t;let{renderStatus:i,buttonHover:r=!1,existText:l}=e,{multiple:d,status:c,countFilled:u,countTotal:h,locked:g,filled:p,visible:m}=i,f="";if(g)f=o.F.t("web_uneditable",{},"Uneditable");else if(d&&!c)f=u?o.F.t("web_videos_added",{placeholder0:u,placeholder1:h},"{placeholder0}/{placeholder1} videos added"):m?o.F.t("web_add_3_videos",{placeholder0:h},"Add {placeholder0} videos"):"";else if(m)switch(c){case"loading":f=o.F.t("web_the_material_is_loading",{},"Loading");break;case"failed":f=o.F.t("web_failed",{},"Failed");break;default:f=p?o.F.t("web_edit",{},"Edit"):o.F.t("web_replace",{},"Replace")}else f="";let _="failed"===c&&!r&&m?a.wL.lvvColorNegativePrimary:a.wL.lvvColorTextContentPrimary;return t=l&&l.text()===f?l.width():new s.Text({text:f,height:20,padding:n.yD,fontSize:12,fontStyle:"bold",align:"center",listening:!1}).width(),!f&&(t=0),{textContent:f,textFill:_,textWidth:t,textPadding:n.yD}}function A(e){let t=n.WE+(e-n.WE)/2;return e>t+n.sP+n.N}function M(e){let{renderStatus:t,buttonHover:i=!1,textAttrs:r,context:o,style:s}=e,{textWidth:l}=r,{locked:d,status:c,multiple:u,gamePlayFailed:h,visible:g}=t,p=l?l+n.me+2*n.sX+n.yD:l+n.me+2*n.q0,{x:m,width:f}=o.camera.getViewport(),{x:v,width:S,height:y}=s,b=Math.max(v,m),M=Math.min(v+S,m+f)-b,T=M>p+(A(y)?10:50)&&l>0,w=M>0&&M<_+10,C=!T&&!w,I="transparent";return I=u||d?"transparent":g?w?"loading"===c||"failed"===c||h?a.wL.lvvColorWhite04:"transparent":"failed"===c?i?a.wL.lvvColorNegativePrimary:a.wL.lvvColorTextContentPrimary:i?a.wL.lvvColorMainDefault:a.wL.lvvColorWhite04:i?a.wL.lvvColorMainDefault:a.wL.lvvColorWhite04,{buttonWidth:T?p:C?_:0,buttonHeight:n.WE,buttonFill:I,showOnlyIcon:C,empty:w,full:T,padding:T?n.sX:C?n.q0:0,strokeWidth:i||u&&!c||d?0:1}}function T(e){let{groupHover:t=!1,buttonHover:i=!1,style:r}=e,{width:a,height:o}=r,s=(0,c.C5)(a),l=(0,c.yW)(s,t||i?n.kT:n.t0),d=s-l;return{borderX:l/2,borderStrokeWidth:l,borderWidth:d,borderHeight:o-l}}function w(e){let{renderStatus:t,groupHover:i=!1,buttonHover:r=!1}=e,{status:a,gamePlayProcessing:o,multiple:s,locked:l,filled:d,visible:c}=t,h=u.J.LvIconReplace;if(l)h=u.J.LvIconUneditableUnfilled;else if(s)h=u.J.LvIconMultipleSlot;else if(c)switch(a){case"loading":h=u.J.IconClipSameLoadingWhite;break;case"failed":h=r||o?u.J.Warning:u.J.WarningRed;break;default:h=d?u.J.IconClipSameEdit:u.J.LvIconReplace}else h=u.J.LvIconUnhide;return{iconHeight:n.me,iconUrl:h}}function C(e){let{renderStatus:t,groupHover:i=!1,buttonHover:r=!1}=e,{replaceHover:n,status:o,filled:s,isActive:l,visible:d}=t,c=i||r,u=a.wL.lvvColorBlack04;return{maskFillColor:u=n?"rgba(0, 202, 224, 0.24)":d?"failed"===o?c?a.wL.failedSegmentBgHoverColor:a.wL.failedSegmentBgColor:s?c||l?a.wL.lvvColorBlack04:"transparent":c?a.wL.lvvColorBlack06:a.wL.lvvColorBlack04:c||l?c||l?a.wL.lvvColorBlack04:a.wL.lvvColorBlack06:a.pr.invisibleMaskBackground}}function I(e){if(!e)return!1;let{segment:{originalTargetStart:t,originalTargetDuration:i},parentSegment:r}=e,{sourceTimeRange:{start:n=t,duration:a=i}={}}=null!=r?r:{};return(0,g.lA9)([t,t+i],[n,n+a])}function x(e,t){let{renderStatus:i,groupHover:r,buttonHover:n}=e,{locked:a,visible:o,replaceHover:s,isActive:l}=i;return a?{showMask:!1}:{showMask:!o&&!s&&!l&&!(r||s),maskImage:h.b.CheckerBoard}}function k(e){let{locked:t,status:i,multiple:r,countFilled:n,countTotal:a,filled:s,gamePlayProcessing:l,visible:d}=e;return d?t?o.F.t("web_uneditable",{},"Uneditable"):"loading"===i?l?o.F.t("web_editor_loading_loading",{},"Loading effects..."):o.F.t("web_the_material_is_loading",{},"Loading..."):r?n>0?o.F.t("web_videos_added",{placeholder0:n,placeholder1:a},"{placeholder0}/{placeholder1} videos added"):o.F.t("web_add_3_videos",{placeholder0:a},"Add {placeholder0} videos"):"failed"===i?o.F.t("web_failed",{},"Failed"):s?o.F.t("web_edit",{},"Edit"):o.F.t("web_replace",{},"Replace"):o.F.t("web_material_button_unhide",{},"Unhide")}function D(e,t,i,n){let{events:a}=e,{x:o,y:s,width:l}=t;a.interact.emit(r.TY.popupTooltip,{x:o+l/2+(0,d.Ko)(t,e.camera),y:s},i,n)}function P(e){e.interact.emit(r.TY.popupTooltip,!1)}let R=e=>{let{id:t,type:i,nodeType:r,shape:n,shadows:a,config:o}=e,s=new l.Group({name:(0,p.Vo)(t,i,r),listening:!1,...null!=o?o:{}});s.add(n);let d=null!=a?a:m.Y;return d.length?(n.setAttrs({...d[0]}),d.slice(1).forEach(e=>{s.add(n.clone(e))}),s):s}},997790:function(e,t,i){i.d(t,{Z:function(){return o}});var r=i(257296),n=i(331037),a=i(3660);class o{boot(){for(let e of Object.keys(this.strategyConfig))this.strategyConfig[e].boot()}destroy(){for(let e of Object.keys(this.strategyConfig))this.strategyConfig[e].destroy()}constructor(e,t,i){this._renderer=e,this._layer=t,this._manager=i,this.strategyConfig={[r.KX.Segment]:new n.Z(e),[r.KX.MutableButton]:new a.Z(e)}}}},425726:function(e,t,i){i.d(t,{m:function(){return a}});var r=i(907031),n=i(389267);class a{get scrollLeft(){return this.horizontalContainer.scrollLeft}get scrollTop(){return this.verticalContainer.scrollTop}getHeight(e){return e-r.St-r.qh}scrollTo(e){void 0!==e.left&&this.horizontalContainer.scrollTo({left:e.left}),void 0!==e.top&&this.verticalContainer.scrollTo({top:e.top})}addEventListener(e,t){this.horizontalContainer.addEventListener(e,t),this.verticalContainer.addEventListener(e,t)}removeEventListener(e,t){this.horizontalContainer.removeEventListener(e,t),this.verticalContainer.removeEventListener(e,t)}constructor(){this.horizontalContainer=(0,n.iP)(),this.verticalContainer=(0,n.DP)()}}},398142:function(e,t,i){i.d(t,{Z:()=>g});var r=i("650248"),n=i("563890"),a=i("202426"),o=i("257296"),s=i("944356"),l=i("357940"),d=i("153302"),c=i("934065"),u=i("426336");class h{batchRefreshThumbnail(e){let t=this._pendingRefreshCOs.findIndex(t=>t.id===e.id);-1===t?this._pendingRefreshCOs.push(e):this._pendingRefreshCOs[t]=e,this._runPendingRefreshTasks()}_lruCacheKey(e,t){return t?`${e}_${t}`:e}_checkSingleVideoSnapshotGeneratorAndSetCallback(){!this._singleVideoSnapshotGenObject&&(this._singleVideoSnapshotGenObject=c.tx.getInstance(),this._singleVideoSnapshotGenObject&&(this._singleVideoSnapshotGenObject.onCacheSnapshotTaskOkCallback=e=>{if(!e.data||e.data.length<=0)return;let t=this._lruCacheKey(e.id,e.data[0].path),i=this.snapshotCache.get(t);for(let t of(!i&&(i=new c.Wh(c.Jo)),e.data))null==i||i.put(t.requestPts,t);this.snapshotCache.set(t,i),this.reGenerateImages()}))}refreshSourceCacheByThumbPreObjs(e,t){let i=new Map;i.set(e,t.thumbs);let r=[];for(let[e,t]of i){let i=(0,n.JP)(this._renderer.children,e);if(i){let n=this._saveSourceThumbnails(t,i);this._saveRenderCommands(n,i),r.push(e)}}this.reGenerateImages(!0,r)}refreshThumbnailBySegmentCO(e){if(e.destroyed)return;let t=this._sourceCache.get(e.id);if(!t){var i;let r=null!==(i=this._modules.resource.getScreenshots(e.data.segment))&&void 0!==i?i:[];t=this._saveSourceThumbnails(r,e)}let{segment:r,cropSituation:n}=e.data;if(t&&r&&n){let e=(0,d.X)(r,n),i={...r,prolong:e};t.range=(0,l.uQ)(t.thumbnails,i)}let a=this._saveRenderCommands(t,e);if(a.length){let t=this._renderer.camera.getBounds();this._runRenderTask(a,e,t)}}onThumbnailsChange(e){let{segmentIds:t}=e,i=new Map;for(let e of t){let t=(0,n.JP)(this._renderer.children,e);if(!(null==t?void 0:t.data))continue;let r=this._modules.resource.getScreenshots(t.data.segment);if(!!(null==r?void 0:r.length))!this._sourceCache.has(e)&&this._renderer.events.view.emit(a.H2.segmentThumbnailInitialized,t.data.segment),i.set(e,r),this._sourceCache.delete(e),this._renderCommandsCache.delete(e)}this.refreshSourceCache(i)}destroy(){this._renderCommandsCache.clear(),this._sourceCache.clear()}removeCache(e){let t=[];for(let i of(e.forEach(e=>{let{path:i,id:r}=e.data.segment;i&&t.push(r)}),Array.from(this._sourceCache.keys())))!t.includes(i)&&(this._sourceCache.delete(i),this._renderCommandsCache.delete(i))}clearAllCOImage(){for(let e of Array.from(this._renderCommandsCache.keys())){let t=(0,n.JP)(this._renderer.children,e);if(t){let e=t.data.thumbnailImage;t.updateData({thumbnailImage:void 0}),(0,l.V$)(e)}}}refreshAllRenderCommand(){this._renderCommandsCache.clear();let e=Array.from(this._sourceCache.entries());for(let[t,i]of(this._checkSingleVideoSnapshotGeneratorAndSetCallback(),e)){let e=(0,n.JP)(this._renderer.children,t);e&&this._saveRenderCommands(i,e)}}refreshSourceCache(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=[];for(let[t,r]of e){let e=(0,n.JP)(this._renderer.children,t);if(e){let n=this._saveSourceThumbnails(r,e);this._saveRenderCommands(n,e),i.push(t)}}if(!!t)this.reGenerateImages(!0,i)}refreshRenderCommandsCache(){for(let[t,i]of Array.from(this._renderCommandsCache.entries())){var e;let r=(0,n.JP)(this._renderer.children,t);if(r&&i.length>0&&!(null===(e=i[0].source)||void 0===e?void 0:e.imageData)&&r.style.height*o.Ue!==i[0].dHeight){let e=this._sourceCache.get(t);if(!e||!this._saveRenderCommands(e,r))continue}}}reGenerateImages(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1?arguments[1]:void 0,i=null!=t?t:Array.from(this._renderCommandsCache.keys()),r=this._renderer.camera.getBounds(),a=[];for(let t of i){let i=this._renderCommandsCache.get(t),o=(0,n.JP)(this._renderer.children,t),s=!1;(e||!(null==o?void 0:o.data.thumbnailImage))&&(s=!0);let l=null==o?void 0:o.getVisible();s&&o&&i&&l&&a.push(this._runRenderTask(i,o,r))}return a}checkSourceCache(e){return this._sourceCache.has(e)}getNewScreenshotsMap(e){let t=new Map;for(let i of e){let{id:e,materialDraft:r,type:n}=i;if(((0,l.M9)(n)||(null==r?void 0:r.draft))&&!this.checkSourceCache(e)){let r=this._modules.resource.getScreenshots(i);(null==r?void 0:r.length)&&t.set(e,r)}}return t}_saveSourceThumbnails(e,t){let{segment:i}=t.data,r=(0,l.yX)(e,i);return this._sourceCache.set(i.id,r),r}_saveRenderCommands(e,t){let i;let r=e.thumbnails[0];if(!r)return[];"imageData"in r&&(i=r.imageData.height);let{width:n,height:a}=this._getThumbSize(t,i),{segment:s}=t.data,d=(0,l.j9)(e,n,a,o.Ue,this._renderer.camera.zoom,t.style.height);return this._renderCommandsCache.set(s.id,d),d}_runRenderTask(e,t,i){var r;let{width:n}=this._getThumbSize(t,null===(r=e[0])||void 0===r?void 0:r.dHeight),a=Math.max(i.x-t.style.x+this.offsetXBuffer,0)/t.style.width*n,o=this._generateImage(e,t,a);if(!!this._checkNeedUpdateCO(t))this._updateSegmentCOImage(t.id,o,-a)}_generateImage(e,t,i){let{width:r,height:n}=this._getImageSize(t,e[0]);if(0===r||0===e.length)return;let{width:a,height:s}=t.style,d=n/o.Ue/s*a,c=Math.max(0,Math.floor((0,l.Gk)(e,d,i)-1)),h=Math.min(e.length-1,Math.ceil((0,l.Gk)(e,d,i+r/o.Ue))),g=i*o.Ue;this._checkSingleVideoSnapshotGeneratorAndSetCallback();let p=this.snapshotCache.get(this._lruCacheKey(t.id,t.data.segment.path));return(0,l.OX)(e,r,n,g,c,h,null,this._singleVideoSnapshotGenObject,p||null,t.data.segment.path,t.id,u.k92.getInstance().incrThumbDensity)}_checkNeedUpdateCO(e){return!!e.data||!1}_updateSegmentCOImage(e,t,i){let r=(0,n.JP)(this._renderer.children,e);if(!r)return;let a=r.data.thumbnailImage;r.updateData({thumbnailImage:t,imageOffsetX:i*o.Ue},!0),(0,l.V$)(a)}_getImageSize(e,t){let i=e.style,r=this._renderer.camera.getBounds(),n=e.getVisible(),{width:a,height:s}=this._getThumbSize(e,null==t?void 0:t.dHeight),l=a/i.width,d=0;return n&&(d=r.x<=i.x?Math.max(0,Math.min(a,(r.width+r.x-i.x)*l)):Math.max(0,Math.min(r.width*l,a,a+(i.x-r.x)*l))),{width:d*o.Ue,height:s*o.Ue}}_getThumbSize(e,t){let{width:i,height:r}=e.style;return t&&(i=i/r*t/2,r=t/2),{width:i,height:r}}constructor(e,t){this._renderer=e,this._modules=t,this.refreshAllThumbWait=300,this.refreshSingleThumbWait=100,this.offsetXBuffer=-1,this._pendingRefreshCOs=[],this.snapshotCache=new Map,this._runPendingRefreshTasks=(0,r.Z)(()=>{for(let e of this._pendingRefreshCOs)this.refreshThumbnailBySegmentCO(e);this._pendingRefreshCOs=[]},this.refreshSingleThumbWait),this.resetSourceCache=e=>{let t;if(!e){this._sourceCache.clear();return}for(let i of t="string"==typeof e?[e]:e)this._sourceCache.has(i)&&this._sourceCache.delete(i)},this._renderCommandsCache=new Map,this._sourceCache=new Map,this._singleVideoSnapshotGenObject=null}}class g{init(){this._addListeners()}boot(){}destroy(){this._removeListeners(),this._audioWaveformsManager.destroy(),this._videoThumbnailsManager.destroy()}_removeCache(e){this._videoThumbnailsManager.removeCache(e),this._audioWaveformsManager.removeCache(e)}_addListeners(){let{events:e}=this._renderer;e.view.on(a.H2.segmentsWidthChange,this._onAllSegmentsWidthChange),e.view.on(a.H2.segmentsHeightChange,this._refreshAllRenderCommand),e.view.on(a.H2.viewportPositionChange,this._onViewportPositionChange),e.view.on(a.H2.viewportSizeChange,this._onViewportSizeChange),e.store.on(a.ML.tracksChange,this._onTracksChange),e.interact.on(a.TY.onAudioStartPositionChange,this._audioWaveformsManager.refreshAudioSegmentWaves),e.store.on(a.ML.onResetSegmentThumbnail,this.resetSourceCache),this._disposers.push(this._modules.resource.onThumbnailsChange(this._videoThumbnailsManager.onThumbnailsChange.bind(this._videoThumbnailsManager)),this._modules.resource.onWavesChange(this._audioWaveformsManager.onWavesChange.bind(this._audioWaveformsManager)))}_removeListeners(){let{events:e}=this._renderer;e.view.off(a.H2.segmentsWidthChange,this._onAllSegmentsWidthChange),e.view.off(a.H2.segmentsHeightChange,this._refreshAllRenderCommand),e.view.off(a.H2.viewportPositionChange,this._onViewportPositionChange),e.view.off(a.H2.viewportSizeChange,this._onViewportSizeChange),e.store.off(a.ML.tracksChange,this._onTracksChange),e.interact.off(a.TY.onAudioStartPositionChange,this._audioWaveformsManager.refreshAudioSegmentWaves),e.store.off(a.ML.onResetSegmentThumbnail,this.resetSourceCache),this._disposers.forEach(e=>e.dispose())}constructor(e,t,i){var a=this;this._renderer=e,this._store=t,this._modules=i,this.refreshAllThumbWait=300,this.refreshSingleThumbWait=100,this._disposers=[],this._onAllSegmentsWidthChange=(0,r.Z)(()=>{this._audioWaveformsManager.refreshAllRenderCommand(),this._videoThumbnailsManager.refreshAllRenderCommand(),this._audioWaveformsManager.clearAllCOImage(),this._videoThumbnailsManager.clearAllCOImage(),this._audioWaveformsManager.reGenerateImages(),this._videoThumbnailsManager.reGenerateImages()},this.refreshSingleThumbWait),this._onViewportPositionChange=(0,r.Z)((e,t)=>{let i=!0;e.x===t.x&&(i=!1),this._videoThumbnailsManager.reGenerateImages(i),this._audioWaveformsManager.reGenerateImages(i)},this.refreshAllThumbWait),this._onViewportSizeChange=(0,r.Z)((e,t)=>{(e.height>t.height||e.width>t.width)&&(this._videoThumbnailsManager.reGenerateImages(!1),this._audioWaveformsManager.reGenerateImages(!1))},this.refreshAllThumbWait),this.refreshWaveBySegmentCO=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];t?a._audioWaveformsManager.batchRefreshWave(e):a._audioWaveformsManager.refreshWaveBySegmentCO(e)},this.refreshThumbnailBySegmentCO=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];t?a._videoThumbnailsManager.batchRefreshThumbnail(e):a._videoThumbnailsManager.refreshThumbnailBySegmentCO(e)},this.resetSourceCache=e=>{this._videoThumbnailsManager.resetSourceCache(e),this._audioWaveformsManager.resetSourceCache(e)},this._refreshAllRenderCommand=()=>{this._audioWaveformsManager.refreshAllRenderCommand(),this._videoThumbnailsManager.refreshAllRenderCommand()},this._onTracksChange=()=>{let e=(0,n.Mq)(this._renderer.children,o.KX.Segment);this._removeCache(e);let t=e.map(e=>e.data.segment);if(0===t.length)return;let i=this._videoThumbnailsManager.getNewScreenshotsMap(t);this._videoThumbnailsManager.refreshSourceCache(i,!1);let r=this._audioWaveformsManager.getNewWavesMap(t);this._audioWaveformsManager.refreshSourceCache(r),this._videoThumbnailsManager.refreshRenderCommandsCache(),this._videoThumbnailsManager.reGenerateImages(!0),this._audioWaveformsManager.reGenerateImages(!0)},this._audioWaveformsManager=new s.Z(e,i,t),this._videoThumbnailsManager=new h(e,i)}}},258579:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(772322),n=i(195291),a=i(670933),o=i(105789),s=i.n(o),l=i(680637);let d="timeline-confirm-mask",c=(0,a.f3)("store")((0,a.Pi)(e=>{let{visible:t,onClick:i}=e;return(0,n.createPortal)(t?(0,r.jsx)("div",{className:s()(l.Z[d],d),onClick:i}):null,document.body)}))},579799:function(e,t,i){i.d(t,{px:()=>eX,yd:()=>eJ,ZP:()=>e$});var r=i("772322"),n=i("670933"),a=i("358098"),o=i("218571"),s=i("105789"),l=i.n(s),d=i("597443"),c=i("43570"),u=i("690674"),h=i("97508"),g=i("953032"),p=i("195265"),m=i("298648"),f=i("959292"),_=i("969242"),v=i("857670"),S=i("907031"),y=i("502237"),b=i("140041"),A=i("297222"),M=i("426336"),T=i("446352"),w=i("671132"),C=i("112825"),I=i("695324"),x=i("309227"),k=i("632172"),D=i("937802"),P=i("230689");let R=(0,n.f3)("store","modules")((0,n.Pi)(e=>{let{style:t,store:i,modules:n}=e,{coordinate:a,player:s,selection:d,event:c,timelineUI:h}=n,{[u.VT]:R}=i,[E,U]=(0,o.useState)(!1),[B,L]=(0,o.useState)(!1),{videoPreviewDuration:N,videoPreviewLoaded:j,videoPreviewStatus:F}=R,{duration:V,operationWidthInner:O,zoomStore:W,operationWidth:Z}=i[u.U_],{value:z}=W,G=F===T.bC.Playing||F===T.bC.OnDisplay,K=G?M.pMA.times(N,1e3,"bigint"):V,Q=(0,m.V)(i,s,c,h),{isTemplate:H}=i[u.U_],Y=(0,o.useRef)(BigInt(Number.MAX_SAFE_INTEGER)),J=!G||j,X=(0,o.useRef)(0),q=(0,o.useRef)(),$=(0,o.useMemo)(()=>({left:0,right:(0,_.vY)(z,K),top:0,bottom:0}),[z,K]),ee=(0,D.G)(P.t),et=(0,o.useCallback)(e=>{if(!a.context.store.isHoverSeg&&!s.isDisabledSeek)a.context.resetDrag(),H&&i[u.qk].segmentId&&d.updateSelectData({segmentIds:[],transitionIds:[]}),U(!0),a.context.store.setIsCursorDrag(!0),a.context.store.setIsHoverCursor(!0),i[u.U_].setTimelineDecoupling({progress:!0}),Y.current=i[u.U_].progress,X.current=Date.now(),s.status.isPlaying&&s.pause(),c.fireTimelineDragStart()},[a,H,d,U,s]),{run:ei}=(0,p.default)(s.timelineSeek,b.Ad),{run:er}=(0,g.default)(s.timelineSeekWithSpeed,b.Ad/2),en=(0,o.useCallback)((e,t)=>{var r;let{x:n}=t;if(a.context.store.isHoverSeg||!a.context.store.isHoverCursor||"dragging"===a.context.store.dragState)return;U(!0),a.context.store.setIsCursorDrag(!0),a.context.cursor.stage("drag-cursor"),i[u.U_].setTimelineDecoupling({progress:!0});let o=i[u.U_].switches.adsorb?a.context.reference.adsorbX(n):void 0,s=(0,_.TF)(i[u.U_].zoomStore.value,null!=o?o:n);i[u.U_].setTimelineProgress(s);let{lastTime:l,lastUs:d,lastPx:c}=null!==(r=q.current)&&void 0!==r?r:{};if(void 0!==l&&void 0!==d&&void 0!==c){let t=s-d,i=e.clientX-c,r=e.timeStamp-l,n=M.pMA.div(t,r),a=i/r;!o&&(s=(0,v.i1)(s,a<0?"floor":"ceil")),er({timestamp:s,durationSpeed:n,pxSpeed:a}),ei(s,!1,f.H.seekDone)}q.current={lastTime:e.timeStamp,lastUs:s,lastPx:e.clientX},e.stopPropagation()},[i[u.U_].zoomStore.value,a,i[u.U_].switches.adsorb]),ea=(0,o.useCallback)((e,t)=>{let r,{x:n}=t;if((0,I.b)(ee,{relatedEvent:I.Z.MoveTimeline}),a.context.store.setIsCursorDrag(!1),a.context.store.isHoverSeg||"dragging"===a.context.store.dragState)return;U(!1);let o=a.context.reference.adsorbX(n);r=void 0!==o&&i[u.U_].switches.adsorb?(0,_.TF)(i[u.U_].zoomStore.value,o):(0,v.i1)((0,_.TF)(i[u.U_].zoomStore.value,n)),(0,x.o)(ee,{action_type:"drag"}),q.current=void 0,Y.current=BigInt(Number.MAX_SAFE_INTEGER),H?s.timelineSeek(r,!1,f.H.seekDone):(s.timelineSeek(r,!1,f.H.seekDone),s.flushSeekCmd()),(0,k.s)(ee,{seek_type:"slide",duration:Date.now()-X.current}),i[u.U_].setTimelineDecoupling({progress:!1}),c.fireTimelineDragEnd()},[i[u.U_].zoomStore.value,i[u.U_].switches.adsorb,U,s]),eo=(0,o.useCallback)(()=>{a.context.store.setIsCursorDrag(!1),U(!1),setTimeout(()=>{i[u.U_].setTimelineDecoupling({progress:!1})},300)},[]);return(0,o.useEffect)(()=>{H&&!G&&setTimeout(()=>{s.timelineSeekAndScrollToMutable(i[u.qk].segmentId)},500)},[H,!0,G]),(0,o.useEffect)(()=>{let e=e=>{L(e)};return a.on(C.B.adsorbCursor,e),()=>{a.off(C.B.adsorbCursor,e)}},[]),J?(0,r.jsx)(A.Z,{bounds:$,onMouseDown:et,onDrag:en,onStop:ea,onReset:eo,setRef:Q,operationWidth:Z,children:(0,r.jsxs)("div",{id:S.Zv,className:l()(w.Z.timelinePlayCursor,{active:E,[w.Z.arrowCursor]:"middle"===a.context.store.hoverSegPart,[w.Z.resizeCursor]:"keyframe"===a.context.store.hoverSegPart,[w.Z.adsorbCursor]:B}),style:{...t,left:`${O}px`},onContextMenu:e=>e.preventDefault(),children:[(0,r.jsx)("div",{className:w.Z.timelinePlayCursorBd}),(0,r.jsx)("div",{className:w.Z.timelinePlayCursorHd,children:(0,r.jsx)(y.J,{dragging:E,adsorb:B})})]})}):null}));var E=i("690492"),U=i("800609"),B=i("938262"),L=i("356429"),N=i("909239"),j=i("697921"),F=i("763709"),V=i("553921");i("818938");var O=i("737159"),W=i("255276"),Z=i("260963"),z=i("797637"),G=i.n(z),K=i("197557"),Q=i("332128"),H=i("28263"),Y=i("626910"),J=i("632555"),X=i("72127"),q=i("276513"),$=i("804497"),ee=i("956626"),et=i("259525"),ei=i("464533"),er=i("323937"),en=i("217713"),ea=i("680637"),eo=i("888792"),es=i("441051"),el=i("375853"),ed=i("755945"),ec=i("227522"),eu=i("141913");let eh=()=>Promise.all([i.e("9869"),i.e("9446"),i.e("365")]).then(i.bind(i,627371)),eg=(0,eu.PS)(eh),ep=(0,n.f3)("store","modules")((0,n.Pi)(e=>{let{store:t,modules:i,scrollWrapRef:n}=e,{coordinate:a,selection:s,dndDrop:d,batchReplace:c}=i,{zoomStore:h,loading:g,switches:m,relationGroupColorMap:f,isBatchReplacePanelVisible:_,isTimelineVScrolling:v}=t[u.U_],{disableSequenceInteract:S}=t[u.d5],{expandedSegmentId:y,isEditingTemplate:b,subDraftSegment:A}=t[u.qk],[T,w,C]=G()(null),[I,x]=G()(null),[k,D]=(0,o.useState)(0),[P,R]=G()(0),[E,U]=G()(0),[B,L]=(0,o.useState)(ei.HE),[N,j]=(0,o.useState)(!1),F=(0,et.y)(n),[V,z]=(0,o.useState)(!1),[ep,em]=(0,o.useState)(!1),ef=(0,o.useRef)(),e_=S||g,{progress:ev}=(0,ec.R)(),{targetTimerange:eS={start:BigInt(0)}}=null!=A?A:{},ey=(0,o.useCallback)(e=>{let{start:t,duration:i}=e;return ev<=eS.start+t+i&&ev>=t+eS.start},[ev,eS]);(0,o.useEffect)(()=>(0,Z.U5)(()=>{if(!t[u.qk].segmentSelected.length)return null;for(let[e]of t[u.U_].tracksMutable)for(let i of e.segments)if(i.mutable.children&&i.mutable.children.some(e=>t[u.qk].segmentSelected.some(t=>t.id===e.id)))return i;return null},(e,t)=>{if(e){var i;let[r]=a.context.registry.segment.findById(e.id);if(r){let{y:e}=r.refEl;D(e)}e.id!==(null===(i=C.current)||void 0===i?void 0:i.id)&&z(!1),w(e),x(t)}else w(null),x(null)}),[]);let eb=(0,o.useRef)(null);eb.current={getBoundingClientRect:()=>T?a.context.registry.getBoundingClientRect(T.id):null};let{refEl:eA}=(0,H.k)(T,a),[eM,eT]=(0,o.useState)(!1),{run:ew}=(0,p.default)(()=>{null==a||a.context.registry.tier.refreshBlockPosition(),eT(!0)},100),{ref:eC,scrollToMutableIfNotVisible:eI,isMutableHoverable:ex}=(0,Y.pB)((0,Y._u)(eA,{onScroll:ew,onScrollEnd:()=>eT(!1)},{coordinate:a,batchReplace:c}),a),ek=(0,o.useMemo)(()=>{if(!!y)return(0,$.kt)(t[u.U_].tracks,{id:y})},[y,t[u.U_].tracks]),eD=(0,o.useCallback)(()=>{if(T){let[e]=a.context.registry.segment.findById(T.id);if(e){let{y:t}=e.refEl;D(t)}}},[T,t,a.context.registry.segment]),[eP]=(0,Y.Ee)(eb,eC,h.value,T,I,R,j,U,eD,{maxWidth:`${B}px`},ek,v,F),eR=e=>{let{id:t,mutableId:i}=e;return!!ex(i)&&!eM&&(s.updateSelectData({segmentIds:[t]}),!0)},eE=(0,O.default)(t[u.U_].isCollapseTimeline,300);(0,o.useEffect)(()=>{let e=new ResizeObserver((0,q.Z)(e=>{let{width:t}=(null==e?void 0:e[0].contentRect)||{width:ei.HE};L(t)},500));return n.current&&e.observe(n.current),()=>{n.current&&e.unobserve(n.current)}},[]),(0,o.useEffect)(()=>{z(!t[u.U_].isCollapseTimeline&&!eE&&!!T&&!N&&!_&&!F&&!v&&b)},[T,eE,_,N,F,v,t,b]),(0,o.useEffect)(()=>{let e=window.requestAnimationFrame(()=>{em(!t[u.U_].isTimelineScrolling&&!eM&&V)});return()=>window.cancelAnimationFrame(e)},[V,t[u.U_].isTimelineScrolling,eM]),(0,o.useEffect)(()=>{let e=document.querySelector(".mutable-poly-modal-children");if(!e)return;let t=d.createDropTarget(e);return ef.current=t,()=>{t.dispose()}},[V]),(0,o.useEffect)(()=>{a.context.store.setTimelineScrollOnEdge(!V)},[V]),(0,o.useEffect)(()=>{var e;null===(e=ef.current)||void 0===e||e.setDropAreaManually(b?"cutsame":"timeline")},[b]);let eU=(0,o.useCallback)(e=>{if(!V||!((0,J.vX)(e.clientX,[0,window.innerWidth])&&(0,J.vX)(e.clientY,[0,window.innerHeight]))||!(0,M.OvQ)(t[u.qk].segmentMutable))return;if((0,X.O1)(e.target,["timeline-hd",eo.Z.timelineScrollLabel,"timeline-tools-wrapper",es.Z.axisContainer])){s.updateSelectData({segmentIds:[]});return}if(!(0,X.O1)(e.target,["timeline-container",K.Z.mutablePolyModal,"lv-layout-sider","menu-mutable","lv-modal-wrapper","trigger-responsive-hot-area","player",er.Z["cut-same-tips-wrap"],"card-popup-preview-modal",en.Z["popup-confirm"],ea.Z["timeline-confirm-mask"],el.Z["canvas-wrapper"],"attribute-panel-wrapper","workbench-tool-bars-container"]))s.updateSelectData({segmentIds:[]})},[V]);return(0,o.useEffect)(()=>{requestIdleCallback(()=>{eh()})},[]),(0,o.useEffect)(()=>(document.addEventListener("mousedown",eU,{capture:!0,passive:!0}),()=>document.removeEventListener("mousedown",eU)),[]),(0,r.jsx)(W.Z,{autoFitPosition:!1,showArrow:!0,position:"top",popupAlign:{top:10},style:{position:"fixed",left:P},popupVisible:V,arrowProps:{style:{left:`${E}px`}},className:l()(K.Z.mutablePolyModal,Q.Z.mutablePolyModal),duration:{enter:0,appear:0},unmountOnExit:!1,popup:T?()=>{var e,n;return(0,r.jsxs)("div",{ref:eP,className:l()(Q.Z.mutablePolyModalChildren,"mutable-poly-modal-children",{[Q.Z["with-color-dot"]]:m.autoReplace&&(null===(e=(null==T?void 0:T.mutable).children)||void 0===e?void 0:e.some(e=>e.relation_video_group))}),style:{maxWidth:`${B-2*ei.Kv}px`},"data-segment-id":T.id,children:[null==T?void 0:null===(n=T.mutable)||void 0===n?void 0:n.children.map(e=>(0,r.jsx)(eu.Xf,{fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(eg,{store:t,modules:i,segment:e,shouldPopupVisible:ep,onReplaceHover:eR,onActive:e=>eI(e),onFailed:e=>setTimeout(()=>{eI(e)},100),styleConfig:{color:m.autoReplace&&e.relation_video_group?f[e.relation_video_group]:void 0,relationGroupAutoReplace:m.autoReplace},clipType:ee.U4.BUBBLE,interactionPosition:ee.o7.TIMELINE,isInCurrentCanvas:ey(e),mountType:ed.j.PolyChild})},e.id)),e_&&(0,r.jsx)("div",{className:Q.Z.polyDisabled})]})}:void 0,children:(0,r.jsx)("div",{className:K.Z.fakeModal,style:{transform:`translateY(${k}px)`}})})}));var em=i("541998"),ef=i("951180"),e_=i("867571");let ev=(0,n.f3)("store")((0,n.Pi)(e=>{let{store:t}=e,{timelineSelectionStore:i,timelineStore:n}=t,{expandedSegmentId:a}=i,{operationWidth:s,zoomStore:l,tracks:d}=n,{value:c}=l,[u,h]=(0,o.useState)();return((0,o.useEffect)(()=>{(()=>{if(!a){h(void 0);return}let e=(0,$.kt)(d,{id:a});if(!e){h(void 0);return}let t=(0,_.vY)(c,e.start)+s,i=(0,_.vY)(c,e.duration);h({left:`${t}px`,width:`${i}px`})})()},[s,a,c]),a)?(0,r.jsx)("div",{className:e_.Z.timelineExpandedSegmentBoundary,style:u}):null}));var eS=i("96124"),ey=i("75546"),eb=i("655158"),eA=i("257296"),eM=i("202426"),eT=i("146220"),ew=i("563890"),eC=i("183797"),eI=i("903045"),ex=i("616477"),ek=i("810866"),eD=i("316699"),eP=i("414482"),eR=i("892652"),eE=i("402655"),eU=i("650248"),eB=i("813072");function eL(e,t){let{start:i,sourceTimeRange:r}=e,[n,a]=function(e){let{sourceTimeRange:t}=e;if(t)return[t.start,t.start+t.duration]}(e),o=t;return o>a?o=a:o<n&&(o=n),i+(o-r.start)}class eN extends eE.JT{bindDataChangeListeners(e){this._renderer=e,this._onTrackCoverChange();let t=(0,Z.U5)(()=>{let{tracks:e}=this._timelineManagerStore[u.U_];return{pureTrackIds:e.map(e=>e[0]).map(e=>e.id).filter(e=>e!==S.pP)}},e=>{let{pureTrackIds:t}=e;JSON.stringify(t)!==JSON.stringify(this._pureTrackIds)&&(this._pureTrackIds=t,this._refreshCanvasObject())});this._register({dispose:t})}_onTrackCoverChange(){let e=(0,Z.U5)(()=>({willDeleteLineAndWord:this._timelineManagerStore[u.U_].trackCoverStore.willDeleteLineAndWord,selectedLineAndWord:this._timelineManagerStore[u.U_].trackCoverStore.selectedLineAndWord}),()=>{requestAnimationFrame(this._getTrackCoverMap)});this._register({dispose:e})}_getWholeWordsGroup(){let{trackCoverStore:e}=this._timelineManagerStore[u.U_],{selectedLineAndWord:t,willDeleteLineAndWord:i}=e,r=i.length>0?eR.X.Delete:eR.X.Select,n=[],a=(r===eR.X.Delete?i:t).map(e=>[...e.words]).flat();return a.forEach((e,t)=>{if(0===t){n.push([e]);return}let i=a[t-1];e.start===i.end&&e.resourceUuid===i.resourceUuid?n[n.length-1].push(e):n.push([e])}),{coverType:r,wholeWordsGroup:n=n.map(e=>e.filter(e=>!e.deleted))}}_getTimelineTimingAndRelativeSegment(e){let{word:t,start:i,end:r}=e,{trackCoverStore:n,tracks:a}=this._timelineManagerStore[u.U_],{resourceUuidMap:o,trackId:s}=n,{resourceUuid:l}=t,d=a.map(e=>e[0]),c=function(e){let t,{segmentIds:i,tracks:r,start:n,end:a}=e;return i.some(e=>{let i=function(e,t){if(!!t)for(let i of e){let e=i.segments.find(e=>e.id===t);if(e)return e}}(r,e);if(null==i?void 0:i.sourceTimeRange){let{sourceTimeRange:e}=i,r=e.start+e.duration;if(!(n<e.start&&a<e.start||n>r&&a>r))return t=i,!0}return!1}),t}({segmentIds:o[l],tracks:d.filter(e=>e.id===s),start:i,end:r});if(!!c)return{timelineStart:eL(c,i),timelineEnd:eL(c,r),relativeSegment:c}}_refreshCanvasObject(){if(!this._renderer||!this._trackCoverMap||!this._pureTrackIds.length)return;let e=Object.keys(this._trackCoverMap);e.length>0?e.forEach(e=>{var t,i;let r=(0,ew.JP)(this._renderer.children,e);null==r||null===(i=r.updateData)||void 0===i||i.call(r,{textEditCovers:null===(t=this._trackCoverMap)||void 0===t?void 0:t[e]},!0)}):this._pureTrackIds.forEach(e=>{var t,i,r,n;let a=(0,ew.JP)(this._renderer.children,e);if(!!(null==a?void 0:null===(t=a.data)||void 0===t?void 0:t.textEditCovers)&&(null==a?void 0:null===(r=a.data)||void 0===r?void 0:null===(i=r.textEditCovers)||void 0===i?void 0:i.length)!==0)null==a||null===(n=a.updateData)||void 0===n||n.call(a,{textEditCovers:[]},!0)})}constructor(e,t){super(),this._timelineManagerStore=e,this._modules=t,this._pureTrackIds=[],this._getTrackCoverMap=(0,eU.Z)(()=>{let e={},{wholeWordsGroup:t,coverType:i}=this._getWholeWordsGroup();if(!t||!i)return;let r=this._timelineManagerStore[u.U_].tracks.map(e=>e[0]);t.forEach(t=>{if(!t[0])return;let n=t[0],a=t[t.length-1],o=this._getTimelineTimingAndRelativeSegment({word:n,start:n.start+1000n,end:n.end}),s=this._getTimelineTimingAndRelativeSegment({word:a,start:a.start+1000n,end:a.end});if(!o||!s)return;let{timelineStart:l,relativeSegment:d}=o,{timelineEnd:c}=s,u=function(e,t){for(let i of e)if(i.segments.some(e=>e.id===t))return i}(r,null==d?void 0:d.id);u&&e[u.id]?e[u.id].push({start:Number(l),end:Number(c),type:i}):u&&(e[u.id]=[{start:Number(l),end:Number(c),type:i}])}),!(0,eB.Z)(e,this._trackCoverMap)&&(this._trackCoverMap=e,this._refreshCanvasObject())},100)}}var ej=i("589224"),eF=i("937567"),eV=i("267435"),eO=i("756024"),eW=i("368794"),eZ=i("195202"),ez=i("200750"),eG=i("615697"),eK=i("123634"),eQ=i("743262");let eH=(0,n.f3)("store","modules")((0,n.Pi)(function(e){let{style:t,store:i,modules:n,scrollWrapRef:a,sequencesRendererRef:s,containerRef:d}=e,{timelineUI:c,event:h}=n;return(0,eb.q)(s,i),(0,eZ.d)(a,s,i,n),!function(e,t,i){let{timelineStore:r,timelineSelectionStore:n}=t,{reporter:a}=i,s=(0,o.useRef)(!1),l=(0,o.useRef)([]);l.current=n.canvasUISelectedSegmentIds;let[d,c]=(0,o.useState)([]),h=(0,o.useRef)(d);(0,o.useEffect)(()=>(0,Z.U5)(()=>{let{isTemplate:e,computedTracksUpper:i,computedTracksMain:r,computedTracksUnder:n,isNewEmpty:a,tracksMutable:o}=t[u.U_];return{isTemplate:e,computedTracksUpper:i,computedTracksMain:r,computedTracksUnder:n,isNewEmpty:a,tracksMutable:o}},()=>{let e=(0,eC.ug)(t[u.U_]);c(e),h.current=e},{fireImmediately:!0}),[t]),(0,eI.C)({store:t,modules:i,sequencesRendererRef:e});let g=(0,D.G)(P.t),[p]=(0,o.useState)(g.createInstance(eD.V,t,i)),[m]=(0,o.useState)(new ex.G(t));(0,o.useEffect)(()=>{if(!e.current)return;let r=new eP.m(t);r.bindDataChangeListeners(e.current);let n=new eN(t,i);return n.bindDataChangeListeners(e.current),()=>{r.dispose(),n.dispose()}},[e.current]);let{getSubSequenceAddCommands:f,refreshExpandedSegmentCOs:_,subCTracksRef:v}=function(e,t,i,r){let{timelineSelectionStore:n,timelineStore:a}=t,{isTemplate:s,tracksMutable:l,isBatchReplacePanelVisible:d}=a,{expandedSegmentId:c,subDraftSegment:u}=n,[h,g]=(0,o.useState)(),p=(0,o.useRef)(h);(0,o.useEffect)(()=>{let e=(0,eC.Y_)(t,i);g(e),p.current=e},[i,l,c,u,d]);let m=(0,o.useRef)(),f=(0,o.useCallback)(()=>{let t=e.current;if(!t)return;if(m.current){let e=(0,ew.JP)(t.children,m.current);e&&e.setVisible(!0)}if(m.current=c,!c)return;let i=(0,ew.JP)(t.children,c);if(!!i)i.setVisible(!1)},[c]);return{getSubSequenceAddCommands:(0,o.useCallback)(()=>{if(s||!e.current||!c||!p.current)return[];let t=[],n=(0,$.kt)(i,{id:c});return t.push({key:"SubSequenceMask",type:eA.KX.SubSequenceMask,props:{expandedSegment:n}}),p.current.forEach(e=>{let[i,a]=e;i.segments.forEach((e,o)=>{if(e.id){let s={sequenceType:"sub",parentSegmentId:c,parentSegment:n,...r.getProps(e,o,i,a)};t.push({key:e.id,type:eA.KX.Segment,props:s})}})}),t},[c,h]),refreshExpandedSegmentCOs:f,subCTracksRef:p}}(e,t,d,p),S=(0,o.useMemo)(()=>!r.isTemplate&&r.loading,[r.isTemplate,r.loading]),y=(0,o.useCallback)(()=>{var e,t;return(null===(e=v.current)||void 0===e?void 0:e.length)&&(null===(t=v.current)||void 0===t?void 0:t.length)>0?eA.oo.EditingSubSequence:eA.oo.Default},[]),b=(0,o.useCallback)(()=>{var t;let i=e.current;if(!i||S)return;eO.t.debug("=== onTracksUpdate"),!s.current&&(0,ej.I)(eF.RENDER_INITIAL_TIMELINE),i.initContainer(eA._n[y()]);let r=[];h.current.forEach(e=>{var t;let[i,n]=e,a=(0,eC.mk)(i.segments),o=null===(t=v.current)||void 0===t?void 0:t.find(e=>e[0].id===i.id);r.push({key:e[0].id,type:eA.KX.Track,props:m.getProps(h.current,e,a,o?o[0]:e[0])}),i.segments.forEach((e,t)=>{e.id&&r.push({key:e.id,type:eA.KX.Segment,props:p.getProps(e,t,i,n)})}),a.forEach(e=>{let[t,n,a]=e,o={track:i,transition:t,segment:n,nextSegment:i.segments[a+1],isActive:l.current.includes(t.id)};r.push({key:t.id,type:eA.KX.Transition,props:o})})});let n=f();r.push(...n),i.refreshAll(r),i.layout(),i.render(),_(),!s.current&&(i.boot(),setTimeout(()=>{i.events.view.emit(eM.H2.scrollPrimaryTrackToViewBox)}),s.current=!0,(0,ej.o)(eF.RENDER_INITIAL_TIMELINE),performance.mark(`${eT.m}_END`),a.firstReport());let o=null!==(t=v.current)&&void 0!==t?t:h.current;i.events.store.emit(eM.ML.tracksChange,o)},[f,_,S]);(0,o.useEffect)(()=>{b()},[S]);let{isBatchReplacePanelVisible:A}=r,{expandedSegmentId:M}=n;(0,o.useEffect)(()=>{b()},[M,A]),(0,o.useEffect)(()=>{let e=i.draftDataSyncer.onFullTracksChange(b),t=i.draftDataSyncer.onFullTracksMutableChange(b);return()=>{e.dispose(),t.dispose()}},[b,i.draftDataSyncer]);let T=(0,o.useRef)();(0,o.useEffect)(()=>{if(!e.current)return;let r=(0,ek.R)(i.draftDataSyncer,e.current,t,i,g);return T.current=r,()=>{r.dispose()}},[]),(0,o.useEffect)(()=>{let t=e=>{var t;a.handleFirstFrameEnd(null!==(t=e.path)&&void 0!==t?t:"")},i=e.current;return null==i||i.events.view.on(eM.H2.segmentThumbnailInitialized,t),()=>{null==i||i.events.view.off(eM.H2.segmentThumbnailInitialized,t)}},[]),(0,o.useEffect)(()=>{if(!e.current||!T.current)return;let r=new eV.U(t,i,e.current,T.current);return()=>{r.dispose()}},[e,t,i])}(s,i,n),(0,ez.H)(a,c.zoom,!1),(0,eG.o)(s,n),(0,eW.L)({store:i,scrollWrapRef:a,sequencesRendererRef:s}),(0,eK.G)(s,i,n),(0,eQ.V)({sequencesRendererRef:s,store:i,scrollWrapRef:a,modules:n}),(0,o.useEffect)(()=>{var e;let t=()=>{h.clickEmptyTrack()};return null===(e=s.current)||void 0===e||e.events.interact.on(eM.TY.clickEmptyTrack,t),()=>{var e;null===(e=s.current)||void 0===e||e.events.interact.off(eM.TY.clickEmptyTrack,t)}},[]),(0,o.useEffect)(()=>{n.renderer=s.current},[n,s]),(0,r.jsx)("div",{className:l()(eo.Z.timelineLargeContainer,"timeline-large-container"),style:t,ref:d})})),eY=o.lazy(()=>i.e("8385").then(i.bind(i,530468))),eJ="timeline-scroll-wrap",eX="timeline-bd-vertical-scroll",eq=o.forwardRef((e,t)=>{let{store:i,modules:n,hidden:s,operationWidth:g,scrollWrapRef:p}=e,{timelineUI:m,coordinate:f,selection:_,player:v,environment:S}=n,{timelineSelectionStore:y,timelineInteractStore:b}=i,{disableSequenceInteract:A}=b,{isEditingTemplate:M}=y,T=(0,o.useRef)(null),w=(0,o.useRef)(null),C=(0,o.useRef)(null),I=(0,o.useRef)(),x=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(C.current)return I.current=n.dndDrop.createDropTarget(C.current),()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.dispose()}},[C.current]),(0,o.useEffect)(()=>{var e;null===(e=I.current)||void 0===e||e.setDropAreaManually(M?"cutsame":"timeline")},[M]);let{sequencesRendererRef:k}=(0,U.B)(T,p,i,n,S.isTemplate);(0,B.k)(p,w,i,e=>{n.timelineUI.scroller.updateIsTimelineScrolling(e)});let{isTemplate:D,switches:{previewLine:P},isTemplatePost:O,isEmptyTracks:W}=i[u.U_];return((0,o.useEffect)(()=>(p.current&&m.zoom.setZoomContainer(p.current),()=>{m.zoom.setZoomContainer(null)}),[]),"undefined"!=typeof window&&window.location.search.includes("__ssr_pending__"))?null:(0,r.jsxs)("div",{className:l()(eo.Z.timelineBdContainer,"timeline-bd-container",{[eo.Z.cutsame]:D,[eo.Z.templatePost]:O}),ref:x,children:[(0,r.jsx)("div",{className:l()(eo.Z.timelineDrop),style:{left:g},ref:C}),(0,r.jsxs)("div",{className:l()(eo.Z.timelineScrollWrap,eo.Z.timelineBd,eJ,"timeline-bd"),id:eJ,ref:p,children:[(0,r.jsx)(a.ZP,{scrollRef:p}),!W&&!D&&P&&(0,r.jsx)(E.Z,{}),!W&&!D&&(0,r.jsx)(ev,{}),!W&&(0,r.jsx)(R,{}),(0,r.jsxs)("div",{className:l()(eo.Z.timelineBdVerticalScroll,eX),ref:w,id:eX,children:[!D&&!v.status.isPlaying&&!s&&!A&&(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)("div",{}),children:(0,r.jsx)(eY,{})}),(0,r.jsx)(eu.SV,{fallback:(0,r.jsx)("div",{}),children:(0,r.jsx)(ey.ZP,{sequencesRendererRef:k,scrollWrapRef:p})}),(0,r.jsx)(eH,{scrollWrapRef:p,sequencesRendererRef:k,containerRef:T}),(0,r.jsx)(L.Z,{renderer:k.current,disabled:s,scrollWrapRef:p}),(0,r.jsx)(N.Z,{renderer:k.current,store:i}),(0,r.jsx)(ef.Z,{renderer:k.current,store:i}),(0,r.jsx)(j.Z,{renderer:k.current}),(0,r.jsx)(F.Z,{renderer:k.current}),(0,r.jsx)(V.Z,{renderer:k.current}),(0,r.jsx)(ep,{renderer:k.current,scrollWrapRef:p}),(0,r.jsx)(em.Z,{scrollWrapRef:p,timelineUI:m,selection:_,playerManager:v}),!D&&!O&&!A&&(0,r.jsx)(eS.Z,{renderer:k.current})]})]}),f.context.enclaveDrag.showSnapshot&&(0,r.jsx)(c.Z,{renderer:k.current}),(0,r.jsx)(h.J,{renderer:k.current}),(0,r.jsx)(d.A,{timeBdVertical:w})]})}),e$=(0,n.f3)("store","modules","contribution")((0,n.Pi)(eq))},303533:function(e,t,i){i.d(t,{Z:function(){return l}});var r=i(772322);i(837510);var n=i(948747);i(218571);var a=i(801497),o=i(918702),s=i(41603);let l=()=>(0,r.jsxs)("div",{className:o.Z.timelineLoading,children:[(0,r.jsx)(n.Z,{spinColor:(0,s.G)()?"gray":"white",webp:!0,size:16}),(0,r.jsx)("div",{className:o.Z.timelineLoadingText,children:a.ZP.t("loading_web_capcut",{},"loading..")})]})},75546:function(e,t,i){i.d(t,{Oj:function(){return g},PC:function(){return h},ZP:function(){return p}});var r=i(772322),n=i(888792),a=i(218571),o=i(281438),s=i(670933),l=i(690674),d=i(907031),c=i(741720),u=i(202426);let h="timeline-train-header",g=e=>{let{isTemplate:t,isTemplatePost:i}=e;return(0,a.useMemo)(()=>{let e=!i;return{withCoverWidth:e?t?80:56:0,withCover:e}},[t,i])},p=(0,s.f3)("store","modules","contribution")((0,s.Pi)(function(e){let{sequencesRendererRef:t,scrollWrapRef:i,contribution:s,modules:p,store:m}=e,{headerHidden:f}=m[l.d5],{withCoverWidth:_,withCover:v}=g(m[l.U_]),{trainHeader:S}=(0,o.q)(s,m,p,e=>{if(!!i.current)e?i.current.classList.add("overflow-hidden-x"):i.current.classList.remove("overflow-hidden-x")}),y=(0,a.useRef)(null);return(0,c.$M)({timelineStore:m[l.U_],domRef:y}),(0,a.useEffect)(()=>{var e,i,r;let n=v?d.pz:d.w0;null===(e=(i=m[l.U_]).setOperationWidthInner)||void 0===e||e.call(i,_),m[l.U_].setOperationWidth(_+n),null===(r=t.current)||void 0===r||r.events.store.emit(u.ML.onOperationWidthInnerChange,_)},[v,_]),(0,r.jsx)("div",{id:h,ref:y,className:n.Z.timelineScrollLabel,style:{width:`${_}px`},children:!f&&S})}))},361731:function(e,t,i){i.d(t,{I:function(){return m},gP:function(){return s},x8:function(){return u}});var r=i(928261),n=i(426336);function a(e){return Array.from(new Set(e))}let o={mutable:["video","audio"],mutableAudio:["audio","video"],[n.pNd.TrackTypeNone]:["video","combination"],[n.pNd.TrackTypeVideo]:["video","combination"],combination:["video"],[n.pNd.TrackTypeAudio]:["audio"],[n.pNd.TrackTypeTextToVideoTextAudio]:["audio"],[n.pNd.TrackTypeText]:["text","textTemplate"],[n.pNd.TrackTypeTextToVideoText]:["text"],[n.pNd.TrackTypeVideoEffect]:["effect"],[n.pNd.TrackTypeSticker]:["sticker","imageSticker"],[n.pNd.TrackTypeFilter]:["filter"],[n.pNd.TrackTypeAdjust]:["pictureAdjust"],[n.pNd.TrackTypeComposition]:[],[n.pNd.TrackTypePluginEffect]:[],[n.pNd.TrackTypeAdCube]:[],dragVideoPlaceholder:["video"],dragAudioPlaceholder:["audio"]};function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return a(o[e].reduce((e,r)=>"string"==typeof r?[...e,r]:[...e,...r(i,t)],[]))}let l=(e,t)=>e.length?0===t?["audio"]:r.t4.filter(e=>"audio"!==e):[],d=(e,t)=>r.t4.filter(e=>"audio"!==e),c={mutable:[],mutableAudio:[],[n.pNd.TrackTypeNone]:["audio"],[n.pNd.TrackTypeVideo]:[l],combination:[l],[n.pNd.TrackTypeAudio]:["audio"],[n.pNd.TrackTypeTextToVideoTextAudio]:["audio"],[n.pNd.TrackTypeText]:[d],[n.pNd.TrackTypeTextToVideoText]:[d],[n.pNd.TrackTypeVideoEffect]:[d],[n.pNd.TrackTypeSticker]:[d],[n.pNd.TrackTypeFilter]:[d],[n.pNd.TrackTypeAdjust]:[d],[n.pNd.TrackTypeComposition]:[],[n.pNd.TrackTypePluginEffect]:[],[n.pNd.TrackTypeAdCube]:[],dragVideoPlaceholder:["audio"],dragAudioPlaceholder:["audio"]};function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return a(c[e].reduce((e,r)=>"string"==typeof r?[...e,r]:[...e,...r(i,t)],[]))}let h=(e,t)=>r.t4.filter(e=>"audio"!==e&&"video"!==e),g=(e,t)=>r.t4.filter(e=>"audio"!==e),p={mutable:[],mutableAudio:[],combination:["combination"],[n.pNd.TrackTypeNone]:[h],[n.pNd.TrackTypeVideo]:[g],[n.pNd.TrackTypeAudio]:[],[n.pNd.TrackTypeTextToVideoTextAudio]:["audio"],[n.pNd.TrackTypeText]:[g],[n.pNd.TrackTypeTextToVideoText]:[g],[n.pNd.TrackTypeVideoEffect]:[g],[n.pNd.TrackTypeSticker]:[g],[n.pNd.TrackTypeFilter]:[g],[n.pNd.TrackTypeAdjust]:[g],[n.pNd.TrackTypeComposition]:[],[n.pNd.TrackTypePluginEffect]:[],[n.pNd.TrackTypeAdCube]:[],dragVideoPlaceholder:[h],dragAudioPlaceholder:[]};function m(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return a(p[e].reduce((e,r)=>"string"==typeof r?[...e,r]:[...e,...r(i,t)],[]))}},907500:function(e,t,i){i.d(t,{t:function(){return c}});var r=i(218571),n=i(202426),a=i(112825),o=i(426336),s=i(690674),l=i(563890),d=i(139367);function c(e,t,i,c,u){let h=(0,r.useRef)(new Set),g=(0,r.useCallback)(e=>{let i=[],r=[],n=h.current,a=new Set;e.forEach(e=>{n.has(e.id)?(r.push(e),n.delete(e.id)):i.push(e),a.add(e.id)}),Array.from(n).forEach(e=>{null==t||t.registry.placeholder.unregister(e)}),i.forEach(e=>{t.registry.placeholder.register(e)}),r.forEach(e=>{t.registry.placeholder.update(e)}),h.current=a},[]),p=(0,r.useCallback)(t=>{let i=e.current.children,r=[],n=[],a=[],s=[];return t.segments.forEach((e,t)=>{let n=e.slots.find(e=>"transition"===e.type);n&&s.push([n,e,t]);let c=(0,l.JP)(i,e.id);c&&(e.metaType===o.cVg.MetaTypeNone&&"mutableAudio"===e.type?a.push(d.y.audioPlaceholderInfo({segmentCO:c,controllerManager:u})):r.push(d.y.segmentInfo({segmentCO:c,controllerManager:u})))}),s.forEach(e=>{let[t]=e,r=(0,l.JP)(i,t.id);r&&n.push(d.y.transitionInfo({transitionCO:r,controllerManager:u}))}),{segmentRegisterInfos:r,transitionRegisterInfos:n,audioSegmentPlaceholderInfos:a}},[e,u,c]),m=(0,r.useCallback)(t=>{let i=e.current.children,[r]=t,n=(0,l.JP)(i,r.id),a=n&&d.y.trackInfo({trackCO:n,controllerManager:u}),{segmentRegisterInfos:o,transitionRegisterInfos:s,audioSegmentPlaceholderInfos:c}=p(r);return{trackRegisterInfo:a,segmentRegisterInfos:o,transitionRegisterInfos:s,audioSegmentPlaceholderInfos:c}},[u,p,e]);(0,r.useEffect)(()=>{var r;let o=i=>{if(!e.current)return;let r=[],n=[],a=[],o=[];i.forEach(e=>{let{trackRegisterInfo:t,transitionRegisterInfos:i,segmentRegisterInfos:s,audioSegmentPlaceholderInfos:l}=m(e);t&&r.push(t),n.push(...s),a.push(...i),o.push(...l)}),t.registry.registerAll(r,n,a),g(o)};null===(r=e.current)||void 0===r||r.events.store.on(n.ML.tracksChange,o);let l=()=>{let{segmentRegisterInfos:e,transitionRegisterInfos:r}=p(i[s.U_].computedTracksMain[0][0]);t.registry.replaceSegmentsAndTransitions(e,r)};return t.on(a.B.timelineMainTrackUpdate,l),()=>{var i;null===(i=e.current)||void 0===i||i.events.store.off(n.ML.tracksChange,o),t.off(a.B.timelineMainTrackUpdate,l)}},[e.current,m,p])}},905040:function(e,t,i){i.d(t,{r:function(){return n}});var r=i(690674);function n(e){let t;let{[r.VT]:{hasFirstFrame:i,veSdkRendered:n,isPreviewingMaterial:a},[r.U_]:{isTemplate:o,tracks:s}}=e,l=!s.reduce((e,t)=>{let[i]=t;return e+i.segments.length},0);return t=!a&&(o?l:(!i||!!n)&&l)}},259525:function(e,t,i){i.d(t,{y:function(){return n}});var r=i(218571);function n(e){let[t,i]=(0,r.useState)(!1),n=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let t=new ResizeObserver(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{i(!1)},100),i(!0)});return e.current&&t.observe(e.current),()=>{n.current&&clearTimeout(n.current),t.disconnect()}},[]),t}},5240:function(e,t,i){i.d(t,{Gv:function(){return p},Kw:function(){return v},Yu:function(){return S},hk:function(){return l},kv:function(){return y},rm:function(){return c}});var r=i(907031),n=i(68659),a=i(492662),o=i(251976),s=i(426336);function l(e){return"primary"}let d=["audio","mutableAudio"];function c(e){return e&&d.includes(e)}let u="#FFFFFF33",h="#C6884E",g="#BD4D3C";function p(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"primary",a=arguments.length>5?arguments[5]:void 0,{waveforms:o,range:s}=e;if(s[1]-s[0]<=0)return[];let l=i*r,d=Math.max(0,(null!=a?a:t)/4);if(0===d)return[];let c=Math.min(d,o.length),p=o.length/c,m=Math.max(d/o.length,1),f=Math.min(Math.max(0,t/4),s[1]-s[0]),_=[],v=Math.ceil(s[0]/p)*p;for(let e=0;e<f;e++){var S,y;let t=null!==(y=null===(S=o[Math.floor(v)])||void 0===S?void 0:S.strength)&&void 0!==y?y:0;v=Math.min(v+p,s[1]-1);let i=4*Math.floor(e*m+1)*r,a=Math.floor((e+1)*m)-Math.floor(e*m),d=[i,(1-t)*l],c={low:{strokeStyle:u,start:d,height:t*l,repeatCount:a}};("primary"===n||"disabled"===n)&&(t>.7&&(c.middle={strokeStyle:"disabled"===n?u:h,start:d,height:(t-.7)*l,repeatCount:a}),t>.85&&(c.high={strokeStyle:"disabled"===n?u:g,start:d,height:(t-.85)*l,repeatCount:a})),_.push(c)}return _}function m(e,t){let i=0,n=e.length;for(;i<n;){let a=i+Math.floor((n-i)/2);e[a].low.start[0]+(e[a].low.repeatCount-1)*(4*r.Ue)<t?i=a+1:n=a}return i}function f(e,t){let{low:i}=e;return Math.min(Math.max(0,Math.floor((t+4*r.Ue-i.start[0])/(4*r.Ue))-1),i.repeatCount-1)}let _=[u,h,g];function v(e,t,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"primary",l=(0,a.o)(t,i),d=l.getContext("2d");if(!d)return l;"transparent"!==s&&(d.fillStyle="disabled"===s?o.wL.segmentAudioWavesBackgroundColor:o.wL.lvvColorTrackGreen,d.fillRect(0,0,t,i));let c=Math.max(0,m(e,n)),u=Math.min(e.length-1,m(e,n+t));if(c>=0&&u>=0){let i=new Map,a=e=>{if(!e)return;let{strokeStyle:t}=e;!i.has(t)&&i.set(t,[]),i.get(t).push(e)};for(let i=c;i<=u;i++){let{low:r,middle:o,high:s}=e[i];if(i===c){let t=f(e[c],n);r={...r,startIndex:t},o=o?{...o,startIndex:t}:o,s=s?{...s,startIndex:t}:s}else if(i===u){let i=f(e[u],n+t);r={...r,endIndex:i},o=o?{...o,endIndex:i}:o,s=s?{...s,endIndex:i}:s}a(r),a(o),a(s)}let o=[];for(let[e,t]of(_.forEach(e=>{var t;o.push([e,null!==(t=i.get(e))&&void 0!==t?t:[]])}),o))for(let i of(d.fillStyle=e,t))!function(e,t,i){let{start:n,height:a,repeatCount:o,startIndex:s=0,endIndex:l=o-1}=e;for(let e=s;e<=l;e++)i.fillRect(n[0]+e*(4*r.Ue)-t,n[1],2*r.Ue,a)}(i,n,d)}return l}function S(e,t){let i=0,r=e.length,{duration:a}=t;if(t.prolong){let{start:o}=t.prolong,{total:l}=t.prolong;if(l<a&&(l=a),l!==n.E2&&0n!==l){let t=s.pMA.div(o,l),n=s.pMA.div(a,l);(i=Math.floor(t*e.length))>=e.length-1&&(i=e.length-1),i=Math.max(0,i);let d=Math.ceil(n*e.length);d<1&&(d=1),r=Math.min(i+d,e.length)}}return[i,r]}let y=e=>{var t;if(!e)return 0n;let i=e.duration;return(null===(t=e.prolong)||void 0===t?void 0:t.total)&&e.prolong.total!==n.E2&&(i=e.prolong.total),e.duration>i&&(i=e.duration),i}},607549:function(e,t,i){i.d(t,{X:function(){return o},u:function(){return s}});var r=i(928261),n=i(49299),a=i(804497);function o(e){if(1!==e.length)return!1;let t=e[0];return!(0,a.j5)(t)&&((0,a.pE)(t)||"video"===t.type&&!(0,n.iI)(t.path)&&!function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],!1}(t.id,t.path))}function s(e,t){return!!t&&e.some(e=>{var t;return(0,r.IM)(e)&&!(null===(t=e.video)||void 0===t?void 0:t.detached)})}}}]);