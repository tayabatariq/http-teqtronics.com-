"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["9609"],{912056:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"segment-widget-menu-progress":"segment-widget-menu-progress-bu7hLX",segmentWidgetMenuProgress:"segment-widget-menu-progress-bu7hLX","segment-widget-menu-progress-text":"segment-widget-menu-progress-text-etDSML",segmentWidgetMenuProgressText:"segment-widget-menu-progress-text-etDSML"}},734328:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"placeholder-third-file-footer":"placeholder-third-file-footer-RYXFjZ",placeholderThirdFileFooter:"placeholder-third-file-footer-RYXFjZ","third-site-container":"third-site-container-_NCo9h",thirdSiteContainer:"third-site-container-_NCo9h","third-site-icon":"third-site-icon-pMaV5H",thirdSiteIcon:"third-site-icon-pMaV5H",disabled:"disabled-cTLVCu"}},499951:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"fullscreen-controls":"fullscreen-controls-dDqAex",fullscreenControls:"fullscreen-controls-dDqAex",progress:"progress-bKsv9m","control-area":"control-area-PDpnEF",controlArea:"control-area-PDpnEF","left-part":"left-part-C8dFUp",leftPart:"left-part-C8dFUp","right-part":"right-part-sZvv1m",rightPart:"right-part-sZvv1m","btn-play":"btn-play-X41PHL",btnPlay:"btn-play-X41PHL","player-time":"player-time-oCAYrm",playerTime:"player-time-oCAYrm",divider:"divider-mVbPMS"}},110565:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"player-play-btn":"player-play-btn-vfzi4g",playerPlayBtn:"player-play-btn-vfzi4g",disabled:"disabled-ObkE31"}},727703:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"reference-segment-line":"reference-segment-line-Drc0aX",referenceSegmentLine:"reference-segment-line-Drc0aX","reference-segment-line-horizontal":"reference-segment-line-horizontal-nMCQvJ",referenceSegmentLineHorizontal:"reference-segment-line-horizontal-nMCQvJ","reference-segment-line-vertical":"reference-segment-line-vertical-IMRKwP",referenceSegmentLineVertical:"reference-segment-line-vertical-IMRKwP"}},855157:function(){},389123:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"layout-container":"layout-container-_tGHFx",layoutContainer:"layout-container-_tGHFx","top-part-container":"top-part-container-ZOqBxt",topPartContainer:"top-part-container-ZOqBxt","layout-mask-container":"layout-mask-container-eYJUHZ",layoutMaskContainer:"layout-mask-container-eYJUHZ","resize-container":"resize-container-IQVdEs",resizeContainer:"resize-container-IQVdEs","container-resizing":"container-resizing-gfu5bb",containerResizing:"container-resizing-gfu5bb","bottom-part-container":"bottom-part-container-DNM6NU",bottomPartContainer:"bottom-part-container-DNM6NU","resize-trigger":"resize-trigger-WkkDho",resizeTrigger:"resize-trigger-WkkDho"}},381773:function(){},69287:function(){},772422:function(){},27193:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"fake-modal":"fake-modal-eazckj",fakeModal:"fake-modal-eazckj","mutable-poly-modal":"mutable-poly-modal-utz5_b",mutablePolyModal:"mutable-poly-modal-utz5_b","button-content":"button-content-iwxKSn",buttonContent:"button-content-iwxKSn","warning-button-hover":"warning-button-hover-y9fuxL",warningButtonHover:"warning-button-hover-y9fuxL","loading-button-icon__normal":"loading-button-icon__normal-Ln_7I6",loadingButtonIconNormal:"loading-button-icon__normal-Ln_7I6","loading-button-icon__hover":"loading-button-icon__hover-ze_Sos",loadingButtonIconHover:"loading-button-icon__hover-ze_Sos","loading-button":"loading-button-SYLtFX",loadingButton:"loading-button-SYLtFX"}},680637:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"timeline-confirm-mask":"timeline-confirm-mask-w68mFn",timelineConfirmMask:"timeline-confirm-mask-w68mFn"}},256357:function(e,t,i){i.d(t,{Z:function(){return n}});let n={"timeline-preview-line":"timeline-preview-line-f_iky0",timelinePreviewLine:"timeline-preview-line-f_iky0",disabled:"disabled-wTbjqM"}},441051:function(e,t,i){i.d(t,{Z:function(){return n}});let n={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px",borderRadiusSeg:"8px","axis-container":"axis-container-c0NSFB",axisContainer:"axis-container-c0NSFB","solid-bg":"solid-bg-IjIBvD",solidBg:"solid-bg-IjIBvD","axis-background":"axis-background-xoaV5I",axisBackground:"axis-background-xoaV5I","zoom-axis":"zoom-axis-cPtPAp",zoomAxis:"zoom-axis-cPtPAp","axis-sub-sequence-mask":"axis-sub-sequence-mask-BK2RIM",axisSubSequenceMask:"axis-sub-sequence-mask-BK2RIM"}},984337:function(e,t,i){e.exports=i.p+"static/default_font.9bf9d50f.zip"},816762:function(e,t,i){e.exports=i.p+"static/ja.ttf.ee325061.zip"},491466:function(e,t,i){e.exports=i.p+"static/rnnoise_v2.0.1692026a.model"},882398:function(e,t,i){e.exports=i.p+"static/zh-hans.ttf.b8ae4031.zip"},517295:function(e,t,i){e.exports=i.p+"static/zh-hant.ttf.864dd2c7.zip"},288725:function(e,t,i){i.d(t,{Z:function(){return n}}),i(772322),i(218571);let n="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPG1hc2sgaWQ9InBhdGgtMS1vdXRzaWRlLTFfNDE1OV82MTgyNDQiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjEiIHk9IjAuNzA2MDU1IiB3aWR0aD0iMjMiIGhlaWdodD0iMjMiIGZpbGw9ImJsYWNrIj4KPHJlY3QgZmlsbD0id2hpdGUiIHg9IjEiIHk9IjAuNzA2MDU1IiB3aWR0aD0iMjMiIGhlaWdodD0iMjMiLz4KPHBhdGggZD0iTTMuMzA3NTMgMTYuOTQ5OEMyLjg2MjA4IDE2Ljk0OTggMi42MzkgMTcuNDg4NCAyLjk1Mzk4IDE3LjgwMzRMNy4wNTAxNyAyMS44OTk2TDExLjE0NjQgMTcuODAzNEMxMS40NjEzIDE3LjQ4ODQgMTEuMjM4MyAxNi45NDk4IDEwLjc5MjggMTYuOTQ5OEg3Ljk5OTkyQzcuOTk5OTIgMTIuMTg4NCAxMi4yODg4IDcuOTk5OTkgMTcuMDUwMyA3Ljk5OTk5VjEwLjY5MjNDMTcuMDUwMyAxMS4xMzc4IDE3LjU4ODggMTEuMzYwOSAxNy45MDM4IDExLjA0NTlMMjIgNi45NDk3TDE3LjkwMzggMi44NTM1QzE3LjU4ODggMi41Mzg1MiAxNy4wNTAzIDIuNzYxNjEgMTcuMDUwMyAzLjIwNzA2VjUuOTk5OTlDMTEuMTg0MyA1Ljk5OTk5IDUuOTk5OTIgMTEuMDgzOCA1Ljk5OTkyIDE2Ljk0OThIMy4zMDc1M1oiLz4KPC9tYXNrPgo8cGF0aCBkPSJNMy4zMDc1MyAxNi45NDk4QzIuODYyMDggMTYuOTQ5OCAyLjYzOSAxNy40ODg0IDIuOTUzOTggMTcuODAzNEw3LjA1MDE3IDIxLjg5OTZMMTEuMTQ2NCAxNy44MDM0QzExLjQ2MTMgMTcuNDg4NCAxMS4yMzgzIDE2Ljk0OTggMTAuNzkyOCAxNi45NDk4SDcuOTk5OTJDNy45OTk5MiAxMi4xODg0IDEyLjI4ODggNy45OTk5OSAxNy4wNTAzIDcuOTk5OTlWMTAuNjkyM0MxNy4wNTAzIDExLjEzNzggMTcuNTg4OCAxMS4zNjA5IDE3LjkwMzggMTEuMDQ1OUwyMiA2Ljk0OTdMMTcuOTAzOCAyLjg1MzVDMTcuNTg4OCAyLjUzODUyIDE3LjA1MDMgMi43NjE2MSAxNy4wNTAzIDMuMjA3MDZWNS45OTk5OUMxMS4xODQzIDUuOTk5OTkgNS45OTk5MiAxMS4wODM4IDUuOTk5OTIgMTYuOTQ5OEgzLjMwNzUzWiIgZmlsbD0iIzE2MTYxRCIvPgo8cGF0aCBkPSJNNy4wNTAxNyAyMS44OTk2TDguMDQwMTIgMjIuODg5NUM3LjQ5MzM5IDIzLjQzNjIgNi42MDY5NiAyMy40MzYyIDYuMDYwMjIgMjIuODg5NUw3LjA1MDE3IDIxLjg5OTZaTTcuOTk5OTIgMTYuOTQ5OFYxOC4zNDk4QzcuMjI2NzIgMTguMzQ5OCA2LjU5OTkyIDE3LjcyMyA2LjU5OTkyIDE2Ljk0OThINy45OTk5MlpNMTcuMDUwMyA3Ljk5OTk5VjYuNTk5OTlDMTcuODIzNSA2LjU5OTk5IDE4LjQ1MDMgNy4yMjY3OSAxOC40NTAzIDcuOTk5OTlIMTcuMDUwM1pNMjIgNi45NDk3TDIyLjk4OTkgNS45NTk3NUMyMy41MzY3IDYuNTA2NDggMjMuNTM2NyA3LjM5MjkxIDIyLjk4OTkgNy45Mzk2NUwyMiA2Ljk0OTdaTTE3LjA1MDMgNS45OTk5OUwxOC40NTAzIDUuOTk5OTlDMTguNDUwMyA2Ljc3MzE5IDE3LjgyMzUgNy4zOTk5OSAxNy4wNTAzIDcuMzk5OTlWNS45OTk5OVpNNS45OTk5MiAxNi45NDk4SDcuMzk5OTJDNy4zOTk5MiAxNy43MjMgNi43NzMxMiAxOC4zNDk4IDUuOTk5OTIgMTguMzQ5OFYxNi45NDk4Wk0xNy45MDM4IDExLjA0NTlMMTguODkzOCAxMi4wMzU4TDE3LjkwMzggMTEuMDQ1OVpNMTEuMTQ2NCAxNy44MDM0TDEwLjE1NjQgMTYuODEzNEwxMS4xNDY0IDE3LjgwMzRaTTIuOTUzOTggMTcuODAzNEwzLjk0MzkzIDE2LjgxMzRMMi45NTM5OCAxNy44MDM0Wk02LjA2MDIyIDIyLjg4OTVMMS45NjQwMyAxOC43OTMzTDMuOTQzOTMgMTYuODEzNEw4LjA0MDEyIDIwLjkwOTZMNi4wNjAyMiAyMi44ODk1Wk0xMi4xMzYzIDE4Ljc5MzNMOC4wNDAxMiAyMi44ODk1TDYuMDYwMjIgMjAuOTA5NkwxMC4xNTY0IDE2LjgxMzRMMTIuMTM2MyAxOC43OTMzWk03Ljk5OTkyIDE1LjU0OThIMTAuNzkyOFYxOC4zNDk4SDcuOTk5OTJWMTUuNTQ5OFpNNi41OTk5MiAxNi45NDk4QzYuNTk5OTIgMTEuMzk1MiAxMS41MzU3IDYuNTk5OTkgMTcuMDUwMyA2LjU5OTk5VjkuMzk5OTlDMTMuMDQxOSA5LjM5OTk5IDkuMzk5OTIgMTIuOTgxNiA5LjM5OTkyIDE2Ljk0OThINi41OTk5MlpNMTUuNjUwMyAxMC42OTIzVjcuOTk5OTlIMTguNDUwM1YxMC42OTIzSDE1LjY1MDNaTTIyLjk4OTkgNy45Mzk2NUwxOC44OTM4IDEyLjAzNThMMTYuOTEzOSAxMC4wNTU5TDIxLjAxMDEgNS45NTk3NUwyMi45ODk5IDcuOTM5NjVaTTE4Ljg5MzggMS44NjM1NUwyMi45ODk5IDUuOTU5NzVMMjEuMDEwMSA3LjkzOTY1TDE2LjkxMzkgMy44NDM0NUwxOC44OTM4IDEuODYzNTVaTTE1LjY1MDMgNS45OTk5OVYzLjIwNzA2SDE4LjQ1MDNWNS45OTk5OUwxNS42NTAzIDUuOTk5OTlaTTE3LjA1MDMgNy4zOTk5OUMxMS45NDEgNy4zOTk5OSA3LjM5OTkyIDExLjg3MzQgNy4zOTk5MiAxNi45NDk4SDQuNTk5OTJDNC41OTk5MiAxMC4yOTQyIDEwLjQyNzYgNC41OTk5OSAxNy4wNTAzIDQuNTk5OTlWNy4zOTk5OVpNMy4zMDc1MyAxNS41NDk4SDUuOTk5OTJWMTguMzQ5OEgzLjMwNzUzVjE1LjU0OThaTTE4LjQ1MDMgMTAuNjkyM0MxOC40NTAzIDkuODkwNTIgMTcuNDgwOCA5LjQ4ODk3IDE2LjkxMzkgMTAuMDU1OUwxOC44OTM4IDEyLjAzNThDMTcuNjk2OCAxMy4yMzI4IDE1LjY1MDMgMTIuMzg1MSAxNS42NTAzIDEwLjY5MjNIMTguNDUwM1pNMTYuOTEzOSAzLjg0MzQ1QzE3LjQ4MDggNC40MTA0MiAxOC40NTAzIDQuMDA4ODcgMTguNDUwMyAzLjIwNzA2SDE1LjY1MDNDMTUuNjUwMyAxLjUxNDM0IDE3LjY5NjggMC42NjY2MTggMTguODkzOCAxLjg2MzU1TDE2LjkxMzkgMy44NDM0NVpNMTAuMTU2NCAxNi44MTM0QzkuNTg5NDUgMTcuMzgwNCA5Ljk5MSAxOC4zNDk4IDEwLjc5MjggMTguMzQ5OFYxNS41NDk4QzEyLjQ4NTUgMTUuNTQ5OCAxMy4zMzMzIDE3LjU5NjQgMTIuMTM2MyAxOC43OTMzTDEwLjE1NjQgMTYuODEzNFpNMS45NjQwMyAxOC43OTMzQzAuNzY3MDk3IDE3LjU5NjQgMS42MTQ4MSAxNS41NDk4IDMuMzA3NTMgMTUuNTQ5OFYxOC4zNDk4QzQuMTA5MzUgMTguMzQ5OCA0LjUxMDkgMTcuMzgwNCAzLjk0MzkzIDE2LjgxMzRMMS45NjQwMyAxOC43OTMzWiIgZmlsbD0id2hpdGUiIG1hc2s9InVybCgjcGF0aC0xLW91dHNpZGUtMV80MTU5XzYxODI0NCkiLz4KPC9zdmc+Cg=="},294507:function(e,t,i){i.d(t,{Z:function(){return n}}),i(772322),i(218571);let n="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPG1hc2sgaWQ9InBhdGgtMS1vdXRzaWRlLTFfNDE1OV82MTgyMzYiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjAiIHk9IjAuNzA2MDU1IiB3aWR0aD0iMjMiIGhlaWdodD0iMjMiIGZpbGw9ImJsYWNrIj4KPHJlY3QgZmlsbD0id2hpdGUiIHk9IjAuNzA2MDU1IiB3aWR0aD0iMjMiIGhlaWdodD0iMjMiLz4KPHBhdGggZD0iTTIwLjY5MjUgMTYuOTQ5OEMyMS4xMzc5IDE2Ljk0OTggMjEuMzYxIDE3LjQ4ODQgMjEuMDQ2IDE3LjgwMzRMMTYuOTQ5OCAyMS44OTk2TDEyLjg1MzYgMTcuODAzNEMxMi41Mzg3IDE3LjQ4ODQgMTIuNzYxNyAxNi45NDk4IDEzLjIwNzIgMTYuOTQ5OEgxNi4wMDAxQzE2LjAwMDEgMTIuMTg4NCAxMS43MTEyIDcuOTk5OTkgNi45NDk3NSA3Ljk5OTk5VjEwLjY5MjNDNi45NDk3NSAxMS4xMzc4IDYuNDExMTggMTEuMzYwOSA2LjA5NjE5IDExLjA0NTlMMiA2Ljk0OTdMNi4wOTYxOSAyLjg1MzVDNi40MTExOCAyLjUzODUyIDYuOTQ5NzUgMi43NjE2MSA2Ljk0OTc1IDMuMjA3MDZWNS45OTk5OUMxMi44MTU3IDUuOTk5OTkgMTguMDAwMSAxMS4wODM4IDE4LjAwMDEgMTYuOTQ5OEgyMC42OTI1WiIvPgo8L21hc2s+CjxwYXRoIGQ9Ik0yMC42OTI1IDE2Ljk0OThDMjEuMTM3OSAxNi45NDk4IDIxLjM2MSAxNy40ODg0IDIxLjA0NiAxNy44MDM0TDE2Ljk0OTggMjEuODk5NkwxMi44NTM2IDE3LjgwMzRDMTIuNTM4NyAxNy40ODg0IDEyLjc2MTcgMTYuOTQ5OCAxMy4yMDcyIDE2Ljk0OThIMTYuMDAwMUMxNi4wMDAxIDEyLjE4ODQgMTEuNzExMiA3Ljk5OTk5IDYuOTQ5NzUgNy45OTk5OVYxMC42OTIzQzYuOTQ5NzUgMTEuMTM3OCA2LjQxMTE4IDExLjM2MDkgNi4wOTYxOSAxMS4wNDU5TDIgNi45NDk3TDYuMDk2MTkgMi44NTM1QzYuNDExMTggMi41Mzg1MiA2Ljk0OTc1IDIuNzYxNjEgNi45NDk3NSAzLjIwNzA2VjUuOTk5OTlDMTIuODE1NyA1Ljk5OTk5IDE4LjAwMDEgMTEuMDgzOCAxOC4wMDAxIDE2Ljk0OThIMjAuNjkyNVoiIGZpbGw9IiMxNjE2MUQiLz4KPHBhdGggZD0iTTE2Ljk0OTggMjEuODk5NkwxNS45NTk5IDIyLjg4OTVDMTYuNTA2NiAyMy40MzYyIDE3LjM5MyAyMy40MzYyIDE3LjkzOTggMjIuODg5NUwxNi45NDk4IDIxLjg5OTZaTTE2LjAwMDEgMTYuOTQ5OFYxOC4zNDk4QzE2Ljc3MzMgMTguMzQ5OCAxNy40MDAxIDE3LjcyMyAxNy40MDAxIDE2Ljk0OThIMTYuMDAwMVpNNi45NDk3NSA3Ljk5OTk5VjYuNTk5OTlDNi4xNzY1NSA2LjU5OTk5IDUuNTQ5NzUgNy4yMjY3OSA1LjU0OTc1IDcuOTk5OTlINi45NDk3NVpNMiA2Ljk0OTdMMS4wMTAwNSA1Ljk1OTc1QzAuNDYzMzE3IDYuNTA2NDggMC40NjMzMTcgNy4zOTI5MSAxLjAxMDA1IDcuOTM5NjVMMiA2Ljk0OTdaTTYuOTQ5NzUgNS45OTk5OUw1LjU0OTc1IDUuOTk5OTlDNS41NDk3NSA2Ljc3MzE5IDYuMTc2NTUgNy4zOTk5OSA2Ljk0OTc1IDcuMzk5OTlWNS45OTk5OVpNMTguMDAwMSAxNi45NDk4SDE2LjYwMDFDMTYuNjAwMSAxNy43MjMgMTcuMjI2OSAxOC4zNDk4IDE4LjAwMDEgMTguMzQ5OFYxNi45NDk4Wk02LjA5NjE5IDExLjA0NTlMNS4xMDYyNCAxMi4wMzU4TDYuMDk2MTkgMTEuMDQ1OVpNMTIuODUzNiAxNy44MDM0TDEzLjg0MzYgMTYuODEzNEwxMi44NTM2IDE3LjgwMzRaTTIxLjA0NiAxNy44MDM0TDIwLjA1NjEgMTYuODEzNEwyMS4wNDYgMTcuODAzNFpNMTcuOTM5OCAyMi44ODk1TDIyLjAzNiAxOC43OTMzTDIwLjA1NjEgMTYuODEzNEwxNS45NTk5IDIwLjkwOTZMMTcuOTM5OCAyMi44ODk1Wk0xMS44NjM3IDE4Ljc5MzNMMTUuOTU5OSAyMi44ODk1TDE3LjkzOTggMjAuOTA5NkwxMy44NDM2IDE2LjgxMzRMMTEuODYzNyAxOC43OTMzWk0xNi4wMDAxIDE1LjU0OThIMTMuMjA3MlYxOC4zNDk4SDE2LjAwMDFWMTUuNTQ5OFpNMTcuNDAwMSAxNi45NDk4QzE3LjQwMDEgMTEuMzk1MiAxMi40NjQzIDYuNTk5OTkgNi45NDk3NSA2LjU5OTk5VjkuMzk5OTlDMTAuOTU4MSA5LjM5OTk5IDE0LjYwMDEgMTIuOTgxNiAxNC42MDAxIDE2Ljk0OThIMTcuNDAwMVpNOC4zNDk3NSAxMC42OTIzVjcuOTk5OTlINS41NDk3NVYxMC42OTIzSDguMzQ5NzVaTTEuMDEwMDUgNy45Mzk2NUw1LjEwNjI0IDEyLjAzNThMNy4wODYxNCAxMC4wNTU5TDIuOTg5OTUgNS45NTk3NUwxLjAxMDA1IDcuOTM5NjVaTTUuMTA2MjQgMS44NjM1NUwxLjAxMDA1IDUuOTU5NzVMMi45ODk5NSA3LjkzOTY1TDcuMDg2MTQgMy44NDM0NUw1LjEwNjI0IDEuODYzNTVaTTguMzQ5NzUgNS45OTk5OVYzLjIwNzA2SDUuNTQ5NzVWNS45OTk5OUw4LjM0OTc1IDUuOTk5OTlaTTYuOTQ5NzUgNy4zOTk5OUMxMi4wNTkgNy4zOTk5OSAxNi42MDAxIDExLjg3MzQgMTYuNjAwMSAxNi45NDk4SDE5LjQwMDFDMTkuNDAwMSAxMC4yOTQyIDEzLjU3MjQgNC41OTk5OSA2Ljk0OTc1IDQuNTk5OTlWNy4zOTk5OVpNMjAuNjkyNSAxNS41NDk4SDE4LjAwMDFWMTguMzQ5OEgyMC42OTI1VjE1LjU0OThaTTUuNTQ5NzUgMTAuNjkyM0M1LjU0OTc1IDkuODkwNTIgNi41MTkxOCA5LjQ4ODk3IDcuMDg2MTQgMTAuMDU1OUw1LjEwNjI0IDEyLjAzNThDNi4zMDMxOCAxMy4yMzI4IDguMzQ5NzUgMTIuMzg1MSA4LjM0OTc1IDEwLjY5MjNINS41NDk3NVpNNy4wODYxNCAzLjg0MzQ1QzYuNTE5MTcgNC40MTA0MiA1LjU0OTc1IDQuMDA4ODcgNS41NDk3NSAzLjIwNzA2SDguMzQ5NzVDOC4zNDk3NSAxLjUxNDM0IDYuMzAzMTggMC42NjY2MTggNS4xMDYyNCAxLjg2MzU1TDcuMDg2MTQgMy44NDM0NVpNMTMuODQzNiAxNi44MTM0QzE0LjQxMDYgMTcuMzgwNCAxNC4wMDkgMTguMzQ5OCAxMy4yMDcyIDE4LjM0OThWMTUuNTQ5OEMxMS41MTQ1IDE1LjU0OTggMTAuNjY2NyAxNy41OTY0IDExLjg2MzcgMTguNzkzM0wxMy44NDM2IDE2LjgxMzRaTTIyLjAzNiAxOC43OTMzQzIzLjIzMjkgMTcuNTk2NCAyMi4zODUyIDE1LjU0OTggMjAuNjkyNSAxNS41NDk4VjE4LjM0OThDMTkuODkwNyAxOC4zNDk4IDE5LjQ4OTEgMTcuMzgwNCAyMC4wNTYxIDE2LjgxMzRMMjIuMDM2IDE4Ljc5MzNaIiBmaWxsPSJ3aGl0ZSIgbWFzaz0idXJsKCNwYXRoLTEtb3V0c2lkZS0xXzQxNTlfNjE4MjM2KSIvPgo8L3N2Zz4K"},514869:function(e,t,i){i.d(t,{Py:()=>o}),i("772322"),i("801497");var n,r=i("150564"),a=i("426336");var s=((n={}).custom="custom",n.tiktok="tiktok",n.tiktok_ads="tiktok_ads",n.youtube_ads="youtube_ads",n.instagram_story="instagram_story",n.instagram_post="instagram_post",n.linkedin_ads="linkedin_ads",n.facebook_video="facebook_video",n);r.DjO,s.youtube_ads,r.YtH,s.tiktok_ads,r.MDd,s.instagram_post;let o={custom:a.rxY.CanvasRatioOriginal,tiktok:a.rxY.CanvasRatio9To16,tiktok_ads:a.rxY.CanvasRatio9To16,youtube_ads:a.rxY.CanvasRatio16To9,instagram_story:a.rxY.CanvasRatio9To16,instagram_post:a.rxY.CanvasRatio1To1,linkedin_ads:a.rxY.CanvasRatio1To1,facebook_video:a.rxY.CanvasRatio16To9};a.rxY.CanvasRatioOriginal,a.rxY.CanvasRatio9To16,a.rxY.CanvasRatio16To9,a.rxY.CanvasRatio1To1},513498:function(e,t,i){i.d(t,{N6:function(){return d},Q$:function(){return r},R4:function(){return a},V:function(){return l},X4:function(){return h},ZU:function(){return s},Zu:function(){return c},h7:function(){return u},h_:function(){return n},i5:function(){return p},ii:function(){return m},uJ:function(){return o},zr:function(){return g}});let n=[24,20],r=[24,20],a=2,s=10,o=1e3,l=1e3,d=20,c=16,u=[.8,20],h=1.8,g=[1,5],m=[.1,5];var f,p=((f={}).Landscape="landscape",f.Portrait="portrait",f)},817368:function(e,t,i){i.d(t,{O:function(){return s}});var n=i(937802),r=i(230689),a=i(218571);let s=e=>{let{canvasManager:t,store:i,isTemplate:s}=e,{playerController:o}=t.modules,{isFullscreen:l}=i,d=(0,a.useRef)(!1),c=(0,a.useRef)(!0);(0,n.G)(r.t),(0,a.useEffect)(()=>{if(!l&&c){c.current=!1;return}d.current=!1},[l]);let u=(0,a.useCallback)(()=>{if(!l)o.requestFullscreen("click")},[l,o]);return{enterFullscreen:u,exitFullscreen:(0,a.useCallback)(()=>{d.current=!0,o.exitFullscreen("click")},[o])}}},102030:function(e,t,i){i.d(t,{_:function(){return r}});var n=i(218571);let r=e=>(0,n.useMemo)(()=>e.ensureManager,[e.ensureManager])},97181:function(e,t,i){i.d(t,{H:function(){return r}});var n=i(218571);let r=e=>(0,n.useMemo)(()=>e.modules.richTextEditorManager,[e.modules.richTextEditorManager])},789146:function(e,t,i){i.d(t,{d:function(){return a},p:function(){return r}});var n=i(426336);function r(e){var t;return e&&((0,n.NHR)(e)||(0,n.Y9Q)(e)&&(null===(t=e.material)||void 0===t?void 0:t.isAiCloneTone))}function a(e,t){return e.start<t.start&&0>=n.pMA.minus(t.start-e.start+t.duration,t.duration+e.duration)||e.start>=t.start&&0>=n.pMA.minus(e.start-t.start+e.duration,t.duration+e.duration)}},625421:function(e,t,i){i.d(t,{C:function(){return T}});var n=i(772322);i(17435),i(701840);var r=i(544633),a=i(629913),s=i(794571),o=i(218571),l=i(670933),d=i(883700),c=i(801497),u=i(105789),h=i.n(u),g=i(150564),m=i(726413),f=i(230689),p=i(752075),_=i(553748),v=i(937802),S=i(959593);let T=(0,l.Pi)(e=>{let{onAbort:t,onAgree:i,rewriteText:l,promptText:u,reWriteType:T}=e,M=(0,v.G)(f.t),y={prompt_text_cnt:u.length,prompt_text_detail:u,ai_writer_option:(0,p.U2)(T),script:l.text,script_id:l.scriptId},k=(0,r.default)(()=>{null==i||i()}),x=(0,r.default)(e=>{(0,_.u)(M,{action:e,...y})}),I=(0,r.default)(()=>{null==t||t()});return(0,o.useEffect)(()=>{(0,_.u)(M,{action:"show",...y})},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.d,{onReportAction:x,text:l.text,promptText:u,toolType:m.B.AiWrite,className:h()(d.Z.segmentWidgetToolbarButton),reportParams:y}),(0,n.jsx)(s.Z,{type:"vertical",className:d.Z.divider}),(0,n.jsx)(a.Z,{content:c.ZP.t("web_ai_writer_btn_discard",{},"Discard"),position:"bottom",children:(0,n.jsx)("div",{className:h()(d.Z.segmentWidgetToolbarButton),onClick:I,children:(0,n.jsx)(g.x8P,{})})}),(0,n.jsx)(a.Z,{content:c.ZP.t("web_ai_writer_btn",{},"Accept"),position:"bottom",children:(0,n.jsx)("div",{className:h()(d.Z.segmentWidgetToolbarButton),onClick:k,children:(0,n.jsx)(g.JrY,{})})})]})})},823081:function(e,t,i){i.d(t,{v:()=>h});var n=i("789786"),r=i("129219"),a=i("257838"),s=i("402655"),o=i("800788"),l=i("772322"),d=i("670933"),c=i("423124"),u=i("425427");class h extends s.JT{_bindSmartJob(e,t){this._intelligenceStore.actionSegmentIntelligentSet(e,t),t.onDidStartToken(()=>{this._updateWidgetMenu()})}_cancel(e,t){switch(t){case r.Sc.Algorithm:this._smartToolsManager.cancelVideoAlgorithm(e,!0);break;case r.Sc.Gameplay:this._smartToolsManager.cancelGamePlay(e,!0);break;case r.Sc.Matting:this._smartToolsManager.cancelMutableMatting(e,!0);break;case r.Sc.Reverse:this._smartToolsManager.cancelMutableReverse(e,!0);break;case r.Sc.Stable:this._smartToolsManager.cancelVideoStable(e,!0);break;case r.Sc.Pipeline:this._smartToolsManager.cancelPipelineModify(e);break;default:(0,o.ss)(`not support smart tool type: [${t}]`)}this._updateWidgetMenu()}constructor(e,t,i,n,a){super(),this._updateWidgetMenu=t,this._smartToolsManager=i,this._dataSdk=n,this._environmentService=a,this._supportedJobType=[r.Sc.Algorithm,r.Sc.Gameplay,r.Sc.Matting,r.Sc.Reverse,r.Sc.Stable,r.Sc.Pipeline],this._getWidgetMenuConfig=e=>{var t,i,n,a,s;let o=this._smartToolsManager.smartTokenMapping.get(e);if(!this._intelligenceStore.segmentIntelligentMap[e]&&this._bindSmartJob(e,o),!o.token)return{items:[]};let h=this._dataSdk.draftView.getDraftId(),g=this._dataSdk.draftView.getDraftIdAndSegById(e);if(!((0,u.JY)(this._environmentService)||h!==(null==g?void 0:g.draftId))&&o.token.source===r.Sc.Pipeline||o.token.status!==r.xR.Running||!this._supportedJobType.includes(o.token.source))return{items:[]};return t=e,i=this._intelligenceStore,n=o.token.source,a=this._cancel.bind(this,e,o.token.source),s=this._updateWidgetMenu,{items:[],customMenu:(0,l.jsx)(d.zt,{store:i,children:(0,l.jsx)(c.Z,{segId:t,source:n,onCancel:a,onFinish:s})})}},this._intelligenceStore=this._smartToolsManager.intelligenceStore,e.registerContribution({id:"intelligence",getWidgetMenuConfig:this._getWidgetMenuConfig})}}h=(0,n.gn)([(0,n.fM)(4,u.rO),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof ICanvasManager?Object:ICanvasManager,Function,void 0===a.f?Object:a.f,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===u.rO?Object:u.rO])],h)},583522:function(e,t,i){i.d(t,{C:function(){return s}});var n=i(587892),r=i(402655),a=i(729596);class s extends r.JT{_observePlayerManager(e){var t;e.actionIsPlayingSet(this._playerManager.status.isPlaying||this._playerManager.status.isRangePlaying),this._register(this._playerManager.onPlay(()=>e.actionIsPlayingSet(!0))),this._register(this._playerManager.onPause(()=>e.actionIsPlayingSet(!1))),this._register(this._playerManager.onEnd(()=>e.actionIsPlayingSet(!1))),this._register(this._playerManager.onError(()=>e.actionIsPlayingSet(!1))),this._register(this._playerManager.onFullscreenChange(t=>e.actionIsFullscreenSet(t))),this._register(this._playerManager.onStreamStart(()=>{this._isStreamLoading=!0,this._onChangeIsStreamLoading.fire(this._isStreamLoading)})),this._register(this._playerManager.onStreamStop(()=>{this._isStreamLoading=!1,this._onChangeIsStreamLoading.fire(this._isStreamLoading)})),this._register(this._playerManager.onStreamFail(e=>{let{assetId:t,httpStatus:i,isBlock:n,isGetMediaInfo:r}=e;this._isStreamLoading=!1,this._onChangeIsStreamLoading.fire(this._isStreamLoading),this._onStreamFail.fire({assetId:t,httpStatus:i,isBlock:n,isGetMediaInfo:r})})),e.actionProgressSet(this._playerManager.status.progress),e.actionVideoPreviewProgressSet(BigInt(Math.floor(a.h.usToMs(this._playerManager.status.progress)))),this._register(this._playerManager.onProgress(t=>{e.actionVideoPreviewProgressSet(BigInt(Math.floor(a.h.usToMs(t)))),e.actionProgressSet(t)})),this._register(null!==(t=this._renderManager.onFirstFrameRender(()=>{this._isVEPlayerLoaded=!0,this._onVEPlayerLoadedChange.fire(!0)}))&&void 0!==t?t:{dispose(){}})}get isVEPlayerLoaded(){return this._isVEPlayerLoaded}get isStreamLoading(){return this._isStreamLoading}play(){this._playerManager.play()}pause(){this._playerManager.pause()}setVideoPlayer(e){this._playerManager.setPreviewPlayer(e,this._renderManager),this._playerManager.activePreviewPlayer()}seek(e,t){this._playerManager.seek(e,t)}seekPrevFrame(){this._playerManager.seekPrevFrame()}seekNextFrame(){this._playerManager.seekNextFrame()}activeDefaultPlayer(){this._playerManager.activeDefaultPlayer(),this._isDefaultPlayerActive=!0}activePreviewPlayer(){this._playerManager.activePreviewPlayer(),this._isDefaultPlayerActive=!1}get isDefaultPlayerActive(){return this._isDefaultPlayerActive}setFullscreenContainer(e){this._playerManager.setFullscreenContainer(e)}requestFullscreen(e){this._playerManager.requestFullscreen(e)}exitFullscreen(e){this._playerManager.exitFullscreen(e)}retryStreamAsset(e){return this._playerManager.retryStreamAsset(e)}setEditModeAfterDragged(e){this._isEditModeAfterDragged=e,this._onChangeIsEditModeAfterDragged.fire(this._isEditModeAfterDragged)}get isEditModeAfterDragged(){return this._isEditModeAfterDragged}constructor(e,t,i){super(),this._playerManager=e,this._renderManager=t,this._isDefaultPlayerActive=!1,this._isVEPlayerLoaded=!1,this._isEditModeAfterDragged=!1,this._isStreamLoading=!1,this._onChangeIsStreamLoading=this._register(new n.Q),this.onChangeIsStreamLoading=this._onChangeIsStreamLoading.event,this._onStreamFail=this._register(new n.Q),this.onStreamFail=this._onStreamFail.event,this._onChangeIsEditModeAfterDragged=this._register(new n.Q),this.onChangeIsEditModeAfterDragged=this._onChangeIsEditModeAfterDragged.event,this._onVEPlayerLoadedChange=this._register(new n.Q),this.onVEPlayerLoadedChange=this._onVEPlayerLoadedChange.event,i.actionSetIsStreamLoading(this.isStreamLoading),this._register(this.onChangeIsStreamLoading(e=>{i.actionSetIsStreamLoading(e)})),this._observePlayerManager(i)}}},489910:function(e,t,i){i.d(t,{D:function(){return c}});var n=i(953032),r=i(218571),a=i(168370),s=i(563431),o=i(295045),l=i(95565);let d=["TEXTAREA","INPUT","SELECT"];function c(e){let{ref:t,editorUtil:i,rect:c,getWrapSize:u,scale:h,performanceMark:g,focus:m,onSelectionStart:f,onSelectionUpdate:p,onSelectionEnd:_,onSelectAll:v,onSelectWord:S,onFocusOut:T,segment:M,actionSetIsShowAttributeByCanvasClick:y}=e,k=(0,r.useContext)(l.e),x=(0,r.useRef)(!1),I=(0,r.useRef)(!1),D=(0,r.useCallback)(e=>{e.stopPropagation();let{clientX:t,clientY:i}=e,n=(0,s.$D)({rect:c,point:{x:t,y:i},getWrapSize:u,scale:h});g("text_edit_mouse_down"),f(n)},[c,u,h,f,g]),{run:b}=(0,n.default)(e=>{let{clientX:t,clientY:i}=e;p((0,s.$D)({rect:c,point:{x:t,y:i},getWrapSize:u,scale:h})),I.current=!0},100,[],{leading:!1}),E=(0,r.useCallback)(e=>{var t,i;e.detail>2?null==v||v():e.detail>1&&(null==y||y(!0),null===(t=x.current?S:v)||void 0===t||t()),I.current||k.actionMutableTextSelectionRangeSet(null!==(i=null==M?void 0:M.id)&&void 0!==i?i:null,0,0),I.current=!1,x.current=!0},[v,S,y,null==M?void 0:M.id]),C=(0,r.useCallback)(async e=>{var n;let r=e.target;if(r===t.current||(null===(n=t.current)||void 0===n?void 0:n.contains(r)))return;if((0,o.S)(r)){!d.includes(r.tagName)&&m();return}let a=await i.textGetPlainStr();null==T||T(a)},[t,i,m,T]),w=(0,r.useCallback)(async()=>{let e=await i.textGetPlainStr();null==T||T(e)},[i,T]);(0,r.useEffect)(()=>{let e=t.current;return null==e||e.addEventListener("click",E),document.addEventListener("mousedown",C,{capture:!0}),window.addEventListener("blur",w),()=>{null==e||e.removeEventListener("click",E),document.removeEventListener("mousedown",C,{capture:!0}),window.removeEventListener("blur",w)}},[E,w,C,t]),(0,a.c)({refs:[t],enable:!0,stopPropagation:!0,onDrag:b,onStart:D,onEnd:_})}},98392:function(e,t,i){i.d(t,{l:function(){return y}});var n=i(789786),r=i(252842),a=i(587892),s=i(402655),o=i(800788),l=i(426336),d=i(271368),c=i(134392),u=i(646186),h=i(788086),g=i(732564),m=i(755358),f=i(230689),p=i(14716),_=i(210823),v=i(66829),S=i(563431),T=i(998828),M=i(797913);class y extends s.JT{getEditorUtil(){return this._editorUtil}renderRichTextEditor(e){return new h.U(this,this._richTextEditorStore).render({...e})}getSubDraftId(){return this._subDraftId}getSegmentPath(e){return this._dataSdk.draftView.getSegmentPath(e)}getIsEditing(){return this._isEditing}getIsPreviewing(){return this._isPreviewText}getEditingSegmentId(){return this._editingSegmentId}getInitialCursorPos(){return this._initialCursorPos}getSelectionStart(){return this._selectionStart}getSelectionEnd(){return this._selectionEnd}getSegmentsStartMap(){return this._segmentsStartMap}getSegmentsEndMap(){return this._segmentsEndMap}getText(){return this._text}getHasSelection(){return this._selectionStart!==this._selectionEnd}getIsPartialSelected(){let e=this._selectionEnd-this._selectionStart;return e>0&&e!==this._text.length}getSelectedText(){return this._text.slice(this._selectionStart,this._selectionEnd)}getModsEmojiLoaded(){return this._modsEmojiLoaded}getSelectedSegmentChildIndex(){return this._selectedSegmentChildIndex}actionTextEditingEnterEdit(e,t,i,n){if(!e)!this._isEditing&&(this._isEditing=!0,this._onDidChangeIsEditing.fire(this._isEditing)),this._editingSegmentId!==t&&(this._editingSegmentId=t,this._onDidChangeEditingSegmentId.fire(this._editingSegmentId)),(!this._initialCursorPos||!i||!(0,S.tS)(this._initialCursorPos,i))&&(this._initialCursorPos=i,this._onDidChangeInitialCursorPos.fire(this._initialCursorPos)),this._richTextEditorStore.actionEditingTextNameSet(n)}actionTextEditingExitEdit(){this._isEditing=!1,this._selectionStart=0,this._selectionEnd=0,this._editingSegmentId="",this._initialCursorPos=void 0,this._onDidChangeIsEditing.fire(this._isEditing),this._onDidChangeEditingSegmentId.fire(this._editingSegmentId),this._onDidChangeInitialCursorPos.fire(this._initialCursorPos),this._onDidChangeSelection.fire(this._selectionStart,this._selectionEnd),this._richTextEditorStore.actionEditingTextNameSet(void 0)}actionTextEditingTextSet(e){this._text=e,this._onDidChangeText.fire(this._text)}actionUpdatePreview(e){this._isPreviewText!==e&&(this._isPreviewText=e,this._onDidChangePreview.fire(this._isPreviewText))}actionTextEditingTextInit(e){this._text=e,this._onDidChangeText.fire(this._text),this._richTextEditorStore.actionTextEditingSavedTextSet(e)}actionTextEditingSelectionRangeSet(e,t){this._selectionStart=e,this._selectionEnd=t,this._onDidChangeSelection.fire(e,t)}actionMutableTextSelectionRangeSet(e,t,i){e&&(this._segmentsStartMap.set(e,t),this._segmentsEndMap.set(e,i),this._onDidChangeSegmentsStartMap.fire(this._segmentsStartMap),this._onDidChangeSegmentsEndMap.fire(this._segmentsEndMap))}actionModsEmojiLoadedSet(e){this._modsEmojiLoaded=e,this._onDidChangeModsEmojiLoaded.fire(this._modsEmojiLoaded)}onCanvasBoxDomReady(e){this._bindShortcut(e)}actionSelectedSegmentChildIndexSet(e){this._selectedSegmentChildIndex=e,this._onDidChangeSelectedSegmentChildIndex.fire(e)}reportTextContentEdit(e,t){(0,T.p)({segment:e,textParams:{text_content:t,panel:"player"},richTextEditorManager:this,instantiationService:this._containerService})}_bindShortcut(e){let t;this._keybindingService.getOrCreateContext(e).register({keyBindings:{win:[d.VD.ENTER],mac:[d.VD.ENTER]},shouldPreventDefault:!0,handler:()=>{this.actionTextEditingEnterEdit(this._playerManager.status.isPlaying||this._playerManager.status.isRangePlaying,t,{x:1,y:-1})},when:()=>{if(this.getIsEditing())return!1;let e=this._selection.getSelectedSegmentsIds();if(1!==e.length)return!1;let i=this._dataSdk.draftView.getSegmentById(e[0]);return!!(i&&(0,l.Ftn)(i))&&(t=i.id,!0)}})}constructor(e,t,i,n,s,d,c,h,g,m){super(),this._dataSdk=e,this._renderManager=t,this._selection=i,this._playerManager=n,this._keybindingService=s,this._ttsDataService=d,this._containerService=c,this._workbenchService=h,this._videoConfigurationService=g,this._generateTtsDataService=m,this._richTextEditorStore=new u.F,this._onDidChangePageFrame=this._register(new a.Q),this.onDidChangePageFrame=this._onDidChangePageFrame.event,this._onDidChangeEditingTextToCommit=this._register(new a.Q),this.onDidChangeEditingTextToCommit=this._onDidChangeEditingTextToCommit.event,this._onDidChangeEditingText=this._register(new a.Q),this.onDidChangeEditingText=this._onDidChangeEditingText.event,this._isEditing=!1,this._onDidChangeIsEditing=this._register(new a.Q),this.onDidChangeIsEditing=this._onDidChangeIsEditing.event,this._editingSegmentId="",this._onDidChangeEditingSegmentId=this._register(new a.Q),this.onDidChangeEditingSegmentId=this._onDidChangeEditingSegmentId.event,this._onDidChangeInitialCursorPos=this._register(new a.Q),this.onDidChangeInitialCursorPos=this._onDidChangeInitialCursorPos.event,this._selectionStart=0,this._selectionEnd=0,this._onDidChangeSelection=this._register(new a.Q),this.onDidChangeSelection=this._onDidChangeSelection.event,this._segmentsStartMap=new Map,this._onDidChangeSegmentsStartMap=this._register(new a.Q),this.onDidChangeSegmentsStartMap=this._onDidChangeSegmentsStartMap.event,this._segmentsEndMap=new Map,this._onDidChangeSegmentsEndMap=this._register(new a.Q),this.onDidChangeSegmentsEndMap=this._onDidChangeSegmentsEndMap.event,this._text="",this._onDidChangeText=this._register(new a.Q),this.onDidChangeText=this._onDidChangeText.event,this._onDidChangePreview=this._register(new a.Q),this.onDidChangePreview=this._onDidChangePreview.event,this._modsEmojiLoaded=!1,this._onDidChangeModsEmojiLoaded=this._register(new a.Q),this.onDidChangeModsEmojiLoaded=this._onDidChangeModsEmojiLoaded.event,this._selectedSegmentChildIndex=-1,this._onDidChangeSelectedSegmentChildIndex=this._register(new a.Q),this.onDidChangeSelectedSegmentChildIndex=this._onDidChangeSelectedSegmentChildIndex.event,this._onTextTemplateSubItemDoubleClick=this._register(new a.Q),this.onTextTemplateSubItemDoubleClick=this._onTextTemplateSubItemDoubleClick.event,this._isPreviewText=!1,this._originalEditorUtil=new r.X(this._dataSdk,this._renderManager),(0,o.Y2)(!this._renderManager.isResetting,"rich-text-editor-manager renderManager is resetting");let f=this._renderManager.onFrameRender(()=>{this._onDidChangePageFrame.fire()});f&&this._register(f),this._editorUtil={onSelectionRangeChange:this._originalEditorUtil.onSelectionRangeChange.bind(this._originalEditorUtil),getFontPath:this._originalEditorUtil.getFontPath.bind(this._originalEditorUtil),setDefaultFontPath:this._originalEditorUtil.setDefaultFontPath.bind(this._originalEditorUtil),checkAfterLifecycle:this._originalEditorUtil.checkAfterLifecycle.bind(this._originalEditorUtil),templateUpdateMutableText:this._originalEditorUtil.templateUpdateMutableText.bind(this._originalEditorUtil),textUpdateMaterial:this._originalEditorUtil.textUpdateMaterial.bind(this._originalEditorUtil),textUpdateMaterialPreview:this._originalEditorUtil.textUpdateMaterialPreview.bind(this._originalEditorUtil),textUpdateTextTemplateMaterialPreview:this._originalEditorUtil.textUpdateTextTemplateMaterialPreview.bind(this._originalEditorUtil),textUpdateMaterialResetPreview:this._originalEditorUtil.textUpdateMaterialResetPreview.bind(this._originalEditorUtil),textTemplateUpdateMaterialResetPreview:this._originalEditorUtil.textTemplateUpdateMaterialResetPreview.bind(this._originalEditorUtil),textTemplateUpdateText:this._originalEditorUtil.textTemplateUpdateText.bind(this._originalEditorUtil),textTemplateUpdateMaterial:this._originalEditorUtil.textTemplateUpdateMaterial.bind(this._originalEditorUtil),textChangeConvertCase:this._originalEditorUtil.textChangeConvertCase.bind(this._originalEditorUtil),textUpdateEffect:this._originalEditorUtil.textUpdateEffect.bind(this._originalEditorUtil),textReset:this._originalEditorUtil.textReset.bind(this._originalEditorUtil),adjustFixedSize:this._originalEditorUtil.adjustFixedSize.bind(this._originalEditorUtil),textEnterSubDraft:this._originalEditorUtil.textEnterSubDraft.bind(this._originalEditorUtil),textExitSubDraft:this._originalEditorUtil.textExitSubDraft.bind(this._originalEditorUtil),textBeginEdit:this._originalEditorUtil.textBeginEdit.bind(this._originalEditorUtil),textEndEdit:this._originalEditorUtil.textEndEdit.bind(this._originalEditorUtil),textSelectAll:this._originalEditorUtil.textSelectAll.bind(this._originalEditorUtil),textEditUpdateSnapshot:this._originalEditorUtil.textEditUpdateSnapshot.bind(this._originalEditorUtil),textMoveCursorByDirection:this._originalEditorUtil.textMoveCursorByDirection.bind(this._originalEditorUtil),textMoveCursorByPos:this._originalEditorUtil.textMoveCursorByPos.bind(this._originalEditorUtil),textMoveCursorToLineHead:this._originalEditorUtil.textMoveCursorToLineHead.bind(this._originalEditorUtil),textMoveCursorToLineEnd:this._originalEditorUtil.textMoveCursorToLineEnd.bind(this._originalEditorUtil),textMoveCursorToHead:this._originalEditorUtil.textMoveCursorToHead.bind(this._originalEditorUtil),textMoveCursorToEnd:this._originalEditorUtil.textMoveCursorToEnd.bind(this._originalEditorUtil),textMoveCursorAndSelect:this._originalEditorUtil.textMoveCursorAndSelect.bind(this._originalEditorUtil),textMoveCursorByWordBoundary:this._originalEditorUtil.textMoveCursorByWordBoundary.bind(this._originalEditorUtil),textGetCursorRect:this._originalEditorUtil.textGetCursorRect.bind(this._originalEditorUtil),textSelectToPos:this._originalEditorUtil.textSelectToPos.bind(this._originalEditorUtil),textSelectToLineHead:this._originalEditorUtil.textSelectToLineHead.bind(this._originalEditorUtil),textSelectToLineEnd:this._originalEditorUtil.textSelectToLineEnd.bind(this._originalEditorUtil),textSelectToHead:this._originalEditorUtil.textSelectToHead.bind(this._originalEditorUtil),textSelectToEnd:this._originalEditorUtil.textSelectToEnd.bind(this._originalEditorUtil),textSelectWordByDirection:this._originalEditorUtil.textSelectWordByDirection.bind(this._originalEditorUtil),textInputStr:async e=>{await this._originalEditorUtil.textInputStr(e),this._onDidChangeEditingTextToCommit.fire()},textBackDelete:async()=>{await this._originalEditorUtil.textBackDelete(),this._onDidChangeEditingTextToCommit.fire()},textForwardDelete:async()=>{await this._originalEditorUtil.textForwardDelete(),this._onDidChangeEditingTextToCommit.fire()},textDeleteToLineHead:async()=>{await this._originalEditorUtil.textDeleteToLineHead(),this._onDidChangeEditingTextToCommit.fire()},textDeleteToLineEnd:async()=>{await this._originalEditorUtil.textDeleteToLineEnd(),this._onDidChangeEditingTextToCommit.fire()},textDeleteWordByDirection:async e=>{await this._originalEditorUtil.textDeleteWordByDirection(e),this._onDidChangeEditingTextToCommit.fire()},textStartCompose:this._originalEditorUtil.textStartCompose.bind(this._originalEditorUtil),textUpdateEditingContent:this._originalEditorUtil.textUpdateEditingContent.bind(this._originalEditorUtil),textPreEditCompose:this._originalEditorUtil.textPreEditCompose.bind(this._originalEditorUtil),textEndCompose:async e=>{await this._originalEditorUtil.textEndCompose(e),this._onDidChangeEditingTextToCommit.fire()},textGetPlainStr:this._originalEditorUtil.textGetPlainStr.bind(this._originalEditorUtil),textSelectContent:this._originalEditorUtil.textSelectContent.bind(this._originalEditorUtil),textSyncSelection:this._originalEditorUtil.textSyncSelection.bind(this._originalEditorUtil),textSelectWord:this._originalEditorUtil.textSelectWord.bind(this._originalEditorUtil),textGetSelectRange:this._originalEditorUtil.textGetSelectRange.bind(this._originalEditorUtil),textEditUndo:async()=>{let e=await this._originalEditorUtil.textEditUndo();return this._onDidChangeEditingText.fire(),e},textEditRedo:async()=>{let e=await this._originalEditorUtil.textEditRedo();return this._onDidChangeEditingText.fire(),e},textUpdateAnimation:this._originalEditorUtil.textUpdateAnimation.bind(this._originalEditorUtil),textUpdateAnimationValue:this._originalEditorUtil.textUpdateAnimationValue.bind(this._originalEditorUtil),textRemoveAnimation:this._originalEditorUtil.textRemoveAnimation.bind(this._originalEditorUtil),getTextMaterialWithMixedStyles:this._originalEditorUtil.getTextMaterialWithMixedStyles.bind(this._originalEditorUtil),textBeginSubDraftPreview:this._originalEditorUtil.textBeginSubDraftPreview.bind(this._originalEditorUtil),textEndSubDraftPreview:this._originalEditorUtil.textEndSubDraftPreview.bind(this._originalEditorUtil)},this._register(this._originalEditorUtil.onSelectionRangeChange((e,t)=>{this.actionTextEditingSelectionRangeSet(e,t)})),this._register(this._selection.onSelectedSegmentChildIndexChange(e=>{this.actionSelectedSegmentChildIndexSet(e)})),this._register(this._selection.onChange(e=>{var t;this._subDraftId=null===(t=e.selectedData.subDraftContext)||void 0===t?void 0:t.subDraftId})),this._dataSdk.onChangeDiff(e=>{(e.actionOperateType===l.aWQ.Undo||e.actionOperateType===l.aWQ.Redo)&&(0,v.t)(e,this._renderManager)})}}y=(0,n.gn)([(0,n.fM)(4,c.d),(0,n.fM)(5,m.z),(0,n.fM)(6,f.t),(0,n.fM)(7,_.e),(0,n.fM)(8,M.J),(0,n.fM)(9,p.e),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===g.zo?Object:g.zo,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof IPlayerManager?Object:IPlayerManager,void 0===c.d?Object:c.d,void 0===m.z?Object:m.z,void 0===f.t?Object:f.t,void 0===_.e?Object:_.e,void 0===M.J?Object:M.J,void 0===p.e?Object:p.e])],y)},215693:function(e,t,i){i.d(t,{z:function(){return D}});var n=i(789786),r=i(772322);i(966156),i(225572);var a=i(368100),s=i(97257),o=i(177975),l=i(956626),d=i(108692),c=i(896413),u=i(402655),h=i(426336),g=i(46991),m=i(827084),f=i(420072),p=i(315201),_=i(798184),v=i(433140),S=i(230689),T=i(127830),M=i(801497),y=i(150564),k=i(813072),x=i(260963),I=i(498638);class D extends u.JT{get templateStore(){return this._templateStore}get draftIdToMutableVideos(){return this._segmentSelection.observeData.draftIdToMutableVideos}get draftIdToMutableTexts(){return this._segmentSelection.observeData.draftIdToMutableTexts}get mutableVideos(){return this._segmentSelection.observeData.mutableVideos}get mutableTexts(){return this._segmentSelection.observeData.mutableTexts}get mutableAudios(){return this._segmentSelection.observeData.mutableAudios}get subDraftSegments(){return this._segmentSelection.observeData.subDraftSegments}get mutableVideosMap(){return this._templateStore.mutableVideosMap}get mutableTextsMap(){return this._templateStore.mutableTextsMap}async _updateTemplate(e){let t=this._mainDraftService.draftTemplateManager.getTemplateId(),i=""!==this._templateStore.templateId;if(t!==this._templateStore.templateId){this._templateStore.actionTemplateIdSet(t);let e=this._resourceService.get((0,m.Bc)(t),T._g.VideoTemplate);if(e){let n=e.getCoverResourceToken();if(await (0,f.Z)(e),(0,p.R)(e.value)&&(this._templateStore.actionTemplateInfoSet(t,e.value),i)){let e=await (0,_.x)(n);if(e.ok){let t=new Blob([e.value.buffer],{type:"image/jpg"}),i=URL.createObjectURL(t);this._canvasStore.actionCoverUrlSet(i)}}}}}_initTemplate(e){this._updateTemplate(e),this._register(this._mainDraftService.cloudMetaManager.onDidChangeMeta(()=>{this._updateTemplate(!0)}))}_initStore(e,t){let i=(0,x.U5)(()=>this.mutableVideos,e=>{let t={};e.forEach(e=>{t[e.segmentId]=e}),this._templateStore.actionMutableVideosMapSet(t),this._canvasStore.actionPlayerWidgetUpdateTriggerSet()},{fireImmediately:!0});this._register({dispose:i});let n=(0,x.U5)(()=>this.mutableTexts,e=>{let t={};e.forEach(e=>{t[e.segmentId]=e}),this._templateStore.actionMutableTextsMapSet(t),this._canvasStore.actionPlayerWidgetUpdateTriggerSet()},{fireImmediately:!0});if(this._register({dispose:n}),this._isTemplate){let e=(0,x.U5)(()=>this.mutableAudios,e=>{let t={};e.forEach(e=>{t[e.segmentId]=e}),this._templateStore.actionMutableAudiosMapSet(t)},{fireImmediately:!0});this._register({dispose:e})}this._templateStore.actionSelectedSegmentIdsSet(t.getSelectedSegmentsIds()),this._register(t.onChange(e=>{let{selectedData:t}=e,{segmentIds:i}=t;this._templateStore.actionSelectedSegmentIdsSet(i)}))}_proxyCanvasStore(){let e=(0,x.U5)(()=>this._canvasStore.canvasRectangles,e=>{if(this._isTemplate){let t=e.filter(e=>this.mutableVideosMap[e.id]||this.mutableTextsMap[e.id]);!(0,k.Z)(e,t)&&this._canvasStore.actionCanvasRectanglesSet(t)}},{fireImmediately:!0});this._register({dispose:()=>e()})}_setDeleteShortcutHook(){this._selection.setBeforeDeleteHook(this._checkAndResetMutable)}_updateWidgetInteractivityStatus(){(0,x.U5)(()=>this._templateStore.segmentMutable,e=>{if(e){let{type:t,mutable:i}=e;if((0,h.VIL)(i))return;let n=i.commonKeyframes.reduce((e,t)=>{if(!t.keyframeList.length)return e;switch(t.propertyType){case h.Eu.KFTypeScaleX:case h.Eu.KFTypeScaleY:return e.disableScale=!0,e;case h.Eu.KFTypePositionX:case h.Eu.KFTypePositionY:return e.disableDrag=!0,e;case h.Eu.KFTypeRotation:return e.disableRotate=!0,e;default:return e}},{disableScale:!1,disableDrag:!1,disableRotate:!1});this._canvasStore.actionAtomicDisableInteractivitySet(n)}else this._canvasStore.actionAtomicDisableInteractivitySet({disableScale:!1,disableDrag:!1,disableRotate:!1})},{fireImmediately:!0})}setTemplateInfo(e,t){this._templateStore.actionTemplateIdSet(e),this._templateStore.actionTemplateTypeSet(t.templateType),this._templateStore.actionTemplateInfoSet(e,t),setTimeout(()=>{try{var e,i;let n=JSON.parse(t.preload.json);console.log(`[\u{4E2D}\u{95F4}\u{5C42}\u{5347}\u{7EA7}] \u{540C}\u{6B3E}\u{6A21}\u{677F}\u{8349}\u{7A3F}\u{7248}\u{672C}:${n.new_version}; \u{751F}\u{4EA7}\u{5E73}\u{53F0}:${null===(e=n.platform)||void 0===e?void 0:e.os}; \u{6700}\u{8FD1}\u{7F16}\u{8F91}\u{5E73}\u{53F0}:${null===(i=n.last_modified_platform)||void 0===i?void 0:i.os}`)}catch{}},3500)}appendTemplateInfoToInfoMap(e,t){this._templateStore.actionTemplateInfoSet(e,t)}constructor({canvasStore:e,canvasManager:t,dataSdk:i,selection:n,modalManager:d,isNewEditPage:c,isTemplate:u,segmentSelection:m,replaceSegmentManager:f},p,_,v,S){super(),this._mainDraftService=p,this._resourceService=_,this._containerService=v,this._mainEditorWidgetService=S,this._templateStore=new I.j,this._enableDeleteModal=!0,this._getWidgetMenuConfig=e=>{var t;let{segmentMutable:i}=this._templateStore;if(!i||e!==this._templateStore.selectedSingleSegmentId)return null;let{mutableReplaceTaskManager:n,selection:a}=this._mainEditorWidgetService,{type:s,mutable:l}=i,d="video"===s,c=d&&(!(null===(t=n.get(l.id))||void 0===t?void 0:t.token)||n.get(l.id).token.idle)&&l.filled,u=d&&l.metaType===h.cVg.MetaTypeVideo&&c,g=!d||i.mutable.visible,m=[];return u&&m.push({type:"icon",icon:(0,r.jsx)(y.qhl,{size:20}),onClick:()=>{var t;this._canvasManager.modules.playerController.pause(),this._modalManager.showMutableTrimModal(e,null!==(t=this._segmentSelection.subDraftId)&&void 0!==t?t:void 0),(0,o.gM)(this._containerService,{optionType:o.P6.Trim})},order:2,disabled:!g,tooltip:g?M.oc.t("web_trim",{},"Trim"):void 0}),c&&m.push({type:"icon",icon:(0,r.jsx)(y.kcA,{size:20}),onClick:()=>{var t;this._canvasManager.modules.playerController.pause(),this._modalManager.showMutableCropModal(e,null!==(t=this._segmentSelection.subDraftId)&&void 0!==t?t:void 0,"canvas"),(0,o.gM)(this._containerService,{optionType:o.P6.Crop})},order:1,disabled:!g,tooltip:g?M.oc.t("web_crop",{},"Crop"):void 0}),d&&m.push({type:"icon",icon:i.mutable.visible?(0,r.jsx)(y.P_4,{size:20}):(0,r.jsx)(y.Sto,{size:20}),onClick:()=>{if(!!i&&!!d)this._mainEditorWidgetService.timelineManager.draftOperation.mutable.setMutableVisible({segmentId:e,visible:!i.mutable.visible}),(0,o.gM)(this._containerService,{optionType:i.mutable.visible?o.P6.HIDE_MATERIAL:o.P6.UNHIDE_MATERIAL})},disabled:!1,tooltip:i.mutable.visible?M.oc.t("web_material_button_hide",{},"hide"):M.oc.t("web_material_button_unhide",{},"unhide")}),m.length>0?{items:m,deps:[l]}:null},this._showDeleteModal=()=>{let{type:e,mutable:t}=this._templateStore.segmentMutable;if("text"===e)return!!this._enableDeleteModal&&new Promise(e=>{let t=a.Z.confirm({backspaceToExit:!1,visible:!0,closable:!1,wrapClassName:"delete-text-modal",maskClosable:!1,title:null,simple:!0,icon:null,footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.Z,{type:"secondary",style:{boxShadow:"none"},onClick:()=>{e(!1),t.close()},children:M.oc.t("web_cancel",{},"\u53D6\u6D88")}),(0,r.jsx)(s.Z,{type:"primary",status:"danger",onClick:()=>{e(!0),t.close()},children:M.oc.t("web_delete",{},"\u5220\u9664")})]}),content:(0,r.jsx)(g.Z,{className:"title",heading:6,children:M.oc.t("web_template_confirm_delete",{},"\u786E\u8BA4\u5220\u9664\u6587\u672C\u5417\uFF1F")}),afterClose:()=>{this._enableDeleteModal=!0}})});if("audio"===e)return this._mainEditorWidgetService.timelineManager.draftOperation.mutable.resetSegmentMutable("shortkey"),!1;return!!t.filled&&!!this._enableDeleteModal&&(this._enableDeleteModal=!1,a.Z.confirm({backspaceToExit:!1,title:M.oc.t("web_remove_the_material_from_this_slot",{},"\u786E\u8BA4\u8981\u5C06\u8FD9\u4E2A\u5185\u5BB9\u4ECE\u69FD\u4F4D\u4E2D\u5220\u9664\u5417\uFF1F"),content:null,okButtonProps:{status:"danger"},okText:M.oc.t("web_delete",{},"\u5220\u9664"),cancelText:M.oc.t("web_cancel",{},"\u5173\u95ED"),icon:null,onOk:()=>{var e;this._replaceSegmentManager.resetMutableVideo([t.id],null!==(e=this._segmentSelection.subDraftId)&&void 0!==e?e:void 0);let{timelineManager:i}=this._mainEditorWidgetService;(0,l.SH)(this._containerService,{action_type:l.kO.SHORTKEY,option_type:l.Ds.DELETE,action_position:l.X3.VIDEO,position_type:i.getIsBatchReplace()?l.o7.BATCH_REPLACE:l.o7.TIMELINE,...i.tracksManager.getClipTypeAndDuration(t.segmentId,!1)})},afterClose:()=>{this._enableDeleteModal=!0}}),!1)},this._checkAndResetMutable=()=>!this._templateStore.segmentMutable||this._showDeleteModal(),this._canvasStore=e,this._canvasManager=t,this._modalManager=d,this._selection=n,this._isTemplate=u,this._segmentSelection=m,this._replaceSegmentManager=f,this._initTemplate(c),this._initStore(i,n),this._proxyCanvasStore(),this._setDeleteShortcutHook(),this._updateWidgetInteractivityStatus(),this._canvasManager.registerContribution({id:"canvas-template",getWidgetMenuConfig:this._getWidgetMenuConfig})}}D=(0,n.gn)([(0,n.fM)(1,d.n),(0,n.fM)(2,v.c),(0,n.fM)(3,S.t),(0,n.fM)(4,c.a),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,void 0===d.n?Object:d.n,void 0===v.c?Object:v.c,void 0===S.t?Object:S.t,void 0===c.a?Object:c.a])],D)},446835:function(e,t,i){i.d(t,{NY:function(){return o},b3:function(){return d},cf:function(){return s},n5:function(){return l},pO:function(){return a}});var n=i(566504),r=i(426336);function a(e){return 0===e.length}function s(e){var t;return!(Array.isArray(t=e)&&t.length>1)&&(0,n.ov)(Array.isArray(e)?e[0]:e)}function o(e){return s(e)&&!(0,r.duj)(Array.isArray(e)?e[0]:e)}function l(e){var t;return o(e)&&!(Array.isArray(t=e)?t.some(r.NHR):(0,r.NHR)(t))}function d(e){return(0,n.hr)(e)||(0,n.po)(e)}},529910:function(e,t,i){i.d(t,{W:function(){return d}});var n=i(772322),r=i(424369),a=i(426336),s=i(588336),o=i(801497),l=i(150564);function d(e){let{canvasManager:t,selection:i,isTemplate:d}=e,c=i.getSelectedSingleSegment();return!c||d||(0,a.duj)(c)||i.isInSubDraftContext()?null:{items:[{type:"dropdown",order:0,icon:(0,n.jsx)(l.kqw,{}),tooltip:o.ZP.t("web_overlay_hover_more_options",{},"More options"),customDropList:(0,n.jsx)(r.x,{config:(()=>{let e=t.getContextMenuConfig("toolbar"),n=i.getSelectedSegments();return(0,s.Q)(e,n)})()})}]}}},503791:function(e,t,i){i.d(t,{Z:function(){return d}});var n=i(772322),r=i(827322),a=i(105789),s=i.n(a),o=i(218571),l=i(307998);let d=(0,o.memo)(e=>{let{src:t,width:i,height:a,visible:o}=e,d=(e,t)=>{var i;null===(i=document.getElementById("ssr-root"))||void 0===i||i.remove()};if(!o||!t)return null;let c=!!t.match(/base64/gi);return(0,n.jsx)("div",{className:s()(l.Z.firstFrameWrapper,{[l.Z.hidden]:!o}),style:{width:i,height:a},children:(0,n.jsx)("img",{className:l.Z.image,src:(0,r.C)(t,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),crossOrigin:"anonymous",onLoad:()=>d(!0,c),onError:()=>d(!1),style:{width:"100%",height:"100%"}})})})},732275:function(e,t,i){i.d(t,{k:function(){return r}});var n=i(218571);function r(e){let[t,i]=(0,n.useState)(e.draftTemplateManager.isNewEmpty),r=e=>i(e);return(0,n.useEffect)(()=>{let t=e.draftTemplateManager.onIsNewEmptyChange(r);return()=>{t.dispose()}},[]),{isNewEmpty:t}}},79006:function(e,t,i){i.d(t,{a:function(){return l}});var n=i(446352),r=i(641276),a=i(463220),s=i(105166),o=i(218571);function l(e){let{canvasManager:t,canvasStore:i,templateIdFromUrl:l,isTemplate:d,isNew:c}=e,u=(0,a.R)(t),h=(0,s.K)(t),{playerController:g,segmentManager:m,selectionManager:f}=t.modules,{actionIsWaitingEditorReadyToSwitchSet:p,progress:_,videoPreviewStatus:v}=i,{templateId:S,infos:T}=u,[M,y]=(0,o.useState)(!1),[k,x,I]=(0,o.useMemo)(()=>{var e;if(!c)return[];let t=T[S];return t&&y(!0),[null==t?void 0:null===(e=t.cover)||void 0===e?void 0:e.url,null==t?void 0:t.videoUrl,null==t?void 0:t.mute]},[c,S,T[S]]),D=(0,o.useRef)(null),[b,E]=(0,o.useState)(!1),[C,w]=(0,o.useState)(!1),[N,A]=(0,o.useState)(!1),[j,O]=(0,o.useState)(!1),L=(0,o.useCallback)(()=>A(!0),[A]);(0,o.useEffect)(()=>{N&&A(!1)},[S,N]);let[P,R]=(0,o.useState)(f.didSelected);(0,r.V)(f.onChangeDidSelected)(e=>{R(e)});let[U,z]=(0,o.useState)(m.didModified);(0,r.V)(m.onChangeDidModified)(e=>{z(e)});let[B,V]=(0,o.useState)(g.isEditModeAfterDragged);(0,r.V)(g.onChangeIsEditModeAfterDragged)(e=>{V(e)});let F=!!(!U&&!B&&!P&&!N&&!g.isDefaultPlayerActive&&(!M||x)&&l),Y=!!((!C||!j)&&c&&d);(0,o.useEffect)(()=>{p(Y)},[Y]),(0,o.useEffect)(()=>{if(t.modules.playerController.pause(),i.actionVideoPreviewStatusSet(F?n.bC.OnDisplay:n.bC.None),F){var e;null===(e=D.current)||void 0===e||e.dispose()}else t.modules.playerController.isDefaultPlayerActive?O(!0):D.current=(0,r.V)(h.onFrameRender)(()=>{O(!0)});return E(!0),()=>{var e;null===(e=D.current)||void 0===e||e.dispose()}},[F,t]);let Z=(0,o.useCallback)(()=>{w(!0)},[w]);return{ready:b,showTemplateVideo:v!==n.bC.None,shouldWaitEditorReady:Y,coverUrl:k,videoUrl:x,mute:I,handlePlayerResizeReady:Z,handlePreviewPlayerError:L}}},479177:function(e,t,i){i.d(t,{r:()=>d});var n=i("772322"),r=i("827322"),a=i("641077");i("218571");var s=i("14634"),o=i("942501"),l=i("801497");let d=e=>{let{isDark:t}=e;return(0,n.jsxs)("div",{className:o.Z["player-empty-placeholder"],children:[t?(0,n.jsx)(a.Z,{className:o.Z["player-empty-placeholder-icon"],src:(0,r.C)(s.Z,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})}):(0,n.jsx)(a.Z,{className:o.Z["player-empty-placeholder-icon"],src:(0,r.C)("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIi8+CjxyZWN0IHg9IjE0Ljc1IiB5PSIzMS41MTE0IiB3aWR0aD0iMTYuNzEwMSIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cmVjdCB4PSIzMy44MTAxIiB5PSIzMS41MTE0IiB3aWR0aD0iMTYuNzEwMSIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuNiIvPgo8cmVjdCB4PSI1Mi44NzAxIiB5PSIzMS41MTE0IiB3aWR0aD0iNTEuODg5MyIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8ZWxsaXBzZSBjeD0iNDIuMDM1MyIgY3k9IjQxLjY5MDYiIHJ4PSI0LjY5MDU1IiByeT0iNC42OTA1NiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxlbGxpcHNlIGN4PSI0Mi4wMzUyIiBjeT0iNDEuNjkwNSIgcng9IjIuMzQ1MjgiIHJ5PSIyLjM0NTI4IiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHBhdGggZD0iTTE0Ljc1IDY1LjUyMjZDMTQuNzUgNjQuMjI3MyAxNS44IDYzLjE3NzMgMTcuMDk1MyA2My4xNzczSDI5LjExNDhDMzAuNDEwMSA2My4xNzczIDMxLjQ2MDEgNjQuMjI3MyAzMS40NjAxIDY1LjUyMjZWOTAuMTQ4QzMxLjQ2MDEgOTEuNDQzMyAzMC40MTAxIDkyLjQ5MzMgMjkuMTE0OCA5Mi40OTMzSDE3LjA5NTNDMTUuOCA5Mi40OTMzIDE0Ljc1IDkxLjQ0MzMgMTQuNzUgOTAuMTQ4VjY1LjUyMjZaIiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cmVjdCB4PSIzMy44MTAxIiB5PSI2My4xNzczIiB3aWR0aD0iNTEuODg5MyIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cmVjdCB4PSI4OC4wNDkzIiB5PSI2My4xNzczIiB3aWR0aD0iMTYuNzEwMSIgaGVpZ2h0PSIyOS4zMTYiIHJ4PSIyLjM0NTI4IiBmaWxsPSIjMDBDQUUwIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8ZyBmaWx0ZXI9InVybCgjZmlsdGVyMF9kXzMyN185OTAwMikiPgo8cGF0aCBkPSJNNDEuNzU2MyA2Mi44NzM5QzQwLjI0NjIgNjAuOTMyNCAzNS42NzM0IDU1Ljc4NDEgMzYuMzAzIDUzLjQ1NDdDMzYuNjAyMyA1Mi4yMjM0IDM3Ljc3MDQgNTEuNDA2NiAzOS4wMjk2IDUxLjU0OEM0MS43MTgxIDUxLjc5NTkgNDQuMzkwMiA1Ni43OTExIDQ0LjA4MjUgNTUuNjI4NEM0My43OTU0IDUzLjU3NzkgNDMuMTkyIDUyLjExMzUgNDIuNjQ3NCA0OS45ODQ0QzQxLjI5NzcgNDYuNTAwNyA0MC40MjMyIDQyLjU0NjMgNDIuODYyMiA0MS42Mzg4QzQ0LjgwNDcgNDAuOTE2IDQ2LjYyMDYgNDMuMjcyNSA0Ny40NzY0IDQ2LjY4NTlDNDcuOTQ2IDQ4LjU1ODkgNDguMTUzMSA1MS4xMzggNDguMzkxNiA1MS45NDg0QzQ4LjM5MTYgNDkuMTIzOCA0OS41OTUgNDcuODc0MSA1MS4xMzkzIDQ3Ljg3NDFDNTIuNjgzNSA0Ny44NzQxIDUzLjY3NzkgNDkuMDk5NCA1My45NTkzIDUxLjk0ODRDNTQuMTQyMiA0OS40MzM0IDU1LjU2MDEgNDguMzY5IDU2Ljg1MjQgNDguNTE1N0M1Ny45ODUgNDguNjQ0MyA1OS4wMjMxIDQ5LjY2NjkgNTkuMDIzMSA1MS45NDg0QzU5Ljg3ODEgNTEuMjM1NCA1OS45MzEgNDkuODI3MyA2MS4zODI5IDQ5Ljk4NDRDNjEuOTg1IDUwLjA0OTUgNjIuNDY2NyA1MC40MDAyIDYyLjY3MyA1MS41NDhDNjMuMzE3NyA1NS4xMzQgNjEuMDQ1OSA2Mi4xNzEgNTkuNDY5NyA2NS42MDA1QzU5LjE5MzcgNjYuODAyOSA1OS4xODc1IDY4LjA3MDIgNTkuNTA3OCA2OS4yNjE1QzU3LjQ0NDcgNjkuNDc5NSA1Ni4yOTI5IDY5LjExNjcgNTUuMjU1OCA2Ny4yMDIyQzU0Ljk5NDIgNjYuNjc4IDU0LjIyMDkgNjYuNjc4IDUzLjk1OTMgNjcuMjAyMkM1My41Mzk4IDY3LjkyNjcgNTIuNjA1NSA2OS4yNDI0IDUxLjk1NzIgNjkuMzE4N0M1MC42Nzk3IDY5LjQ3MTIgNDguMDQ4NCA2OS4zMTg3IDQ1Ljk3MDEgNjkuMzE4N0M0NS45NzAxIDY5LjMxODcgNDYuMzEzMyA2Ny40MTE5IDQ1LjUzMTYgNjYuNzI1NUM0NC4xNjY1IDY1LjUyNyA0Mi45NDk4IDY0LjIzOCA0MS43NTYzIDYyLjg3MzlaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2RfMzI3Xzk5MDAyIiB4PSIzMS4yNDM5IiB5PSIzOC41MDgxIiB3aWR0aD0iMzQuNTQxNSIgaGVpZ2h0PSIzNS44Nzg0IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIiByZXN1bHQ9ImhhcmRBbHBoYSIvPgo8ZmVPZmZzZXQgZHg9Ii0xIiBkeT0iMSIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIyIi8+CjxmZUNvbXBvc2l0ZSBpbjI9ImhhcmRBbHBoYSIgb3BlcmF0b3I9Im91dCIvPgo8ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMC4zNjA3MTQgMCAwIDAgMCAwLjQgMCAwIDAgMC4xMiAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93XzMyN185OTAwMiIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvd18zMjdfOTkwMDIiIHJlc3VsdD0ic2hhcGUiLz4KPC9maWx0ZXI+CjwvZGVmcz4KPC9zdmc+Cg==",null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})}),(0,n.jsx)("p",{className:o.Z["player-empty-placeholder-title"],"data-ssr-i18n-key":"web_editor_text_click_template","data-ssr-i18n-value":l.ZP.t("web_editor_text_click_template"),children:l.ZP.t("web_editor_text_click_template",{},"Click a template from the left to start")})]})}},604453:function(e,t,i){i.d(t,{s:function(){return l}});var n=i(426336),r=i(218571),a=i(770311),s=i(937802),o=i(230689);let l=e=>{let{isCanvasEmpty:t,isTemplate:i,ratio:l}=e,d=(0,s.G)(o.t),[c,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!1),m=(0,r.useCallback)(()=>{u(!0)},[]),f=(0,r.useCallback)(()=>{u(!1)},[]);return(0,r.useEffect)(()=>{t&&u(!1)},[t]),(0,r.useEffect)(()=>{i?g(!1):g(l.value===n.rxY.CanvasRatio9To16)},[i,l.value]),(0,r.useEffect)(()=>{h&&(0,a.d)(d,{action:a.G.Show})},[d,h]),{isShowTiktok:c,showTiktok:m,hideTiktok:f,canShowTiktok:h}}},764357:function(e,t,i){i.d(t,{x:function(){return g}});var n=i(953032),r=i(514536),a=i(269620),s=i(638361),o=i(710763),l=i(937802),d=i(362853),c=i(230689),u=i(334769),h=i(218571);function g(e){let{store:t,canvasManager:i,canvasResizeScale:g,playerDom:m,canvasDom:f,enable:p}=e,{canvasRectangles:_}=t,v=(0,l.G)(c.t),S=(0,u.F)(i),[T,M]=(0,h.useState)(!1),y=(0,h.useMemo)(()=>new s.C({boxStyle:{display:"none",position:"fixed",zIndex:1e4,backgroundColor:"rgba(var(--primary-6),0.1)",border:"1px solid var(--lvv-color-main-default)",pointerEvents:"none"}}),[]),k=(0,h.useRef)(y),x=(0,h.useRef)([]),I=(0,h.useRef)(),D=k.current,b=(0,h.useRef)(null),E=(0,h.useRef)(null),C=(0,h.useRef)(!1),w=(0,h.useMemo)(()=>_.map(e=>{let{x:t,y:i,width:n,height:r,rotate:s}=e,o=new a.F({center:{x:(t+n/2)*g,y:(i+r/2)*g},height:r*g,width:n*g,angle:s});return{...e,rectOBB:o}}),[_,g]),N=(0,h.useCallback)((e,t)=>{let i=[],{x:n,y:r}=e,s=t.x-n,o=t.y-r,l=new a.F({center:{x:n+s/2,y:r+o/2},height:o,width:s,angle:0});return w.filter(e=>e.id!==I.current).forEach(e=>{l.isCollision(e.rectOBB)&&i.push(e)}),i},[I.current,w]),A=(0,h.useCallback)(e=>{if(!E.current)return e;let{x:t,y:i}=e,{x:n,y:r}=E.current;return{x:t-n,y:i-r}},[E.current]),{run:j}=(0,n.default)((e,t)=>{"move"===t?i.modules.selectionManager.selectPrepareSegments(e,void 0):i.modules.selectionManager.selectSegments(e,void 0),e.length>1&&(0,o.r)(v,(0,o.T)({ids:e,action:"player",draftView:S.draftView})),x.current=e},16),O=(0,h.useCallback)(e=>{let{clientX:t,clientY:i}=e;if("none"!==D.selectState&&b.current){let{x:e,y:n,width:r,height:a}=b.current;t<=e?t=e:t>=e+r&&(t=e+r),i<=n?i=n:i>=n+a&&(i=n+a)}return{moveX:t,moveY:i}},[D]),L=(0,h.useCallback)(e=>{let{moveX:t,moveY:i,trigger:n}=e,r={x:Math.min(D.startLocation.x,t),y:Math.min(D.startLocation.y,i)},a={x:Math.max(D.startLocation.x,t),y:Math.max(D.startLocation.y,i)},s=A(r),o=N(s,A(a)).map(e=>e.id),{current:l}=x,d=l.length!==o.length||o.some(e=>!l.includes(e));("mouseup"===n||d)&&j(o,n)},[D.startLocation.x,D.startLocation.y,N,A,j]),P=(0,h.useCallback)(e=>{if("none"!==D.selectState&&b.current){let{moveX:t,moveY:i}=O(e);D.move({x:t,y:i}),L({moveX:t,moveY:i,trigger:"move"}),C.current=!0}},[D,O,L]);(0,h.useEffect)(()=>{m&&D.mount(m)},[m,D]);let R=(0,h.useCallback)(e=>{var t,i;if(e.button===d.JK||!p)return;let{ifRectCanDrag:n,widgetId:r}=e.target.dataset||{},a={x:e.clientX,y:e.clientY};if(I.current=r,"true"!==n)b.current=null!==(t=null==m?void 0:m.getBoundingClientRect())&&void 0!==t?t:null,E.current=null!==(i=null==f?void 0:f.getBoundingClientRect())&&void 0!==i?i:null,M(!0),D.start(a)},[D,p,m,f]),U=(0,h.useCallback)(e=>{if(C.current){let{moveX:t,moveY:i}=O(e);L({moveX:t,moveY:i,trigger:"mouseup"})}b.current=null,E.current=null,M(!1),D.end(),C.current=!1},[D,O,L]);return(0,r.default)("mousedown",R,{target:m}),(0,r.default)("mouseup",U),(0,r.default)("mousemove",P),{isBoxSelecting:T}}},334789:function(e,t,i){i.d(t,{K:function(){return p}});var n=i(789193),r=i(574132),a=i(695324),s=i(937802),o=i(641276),l=i(426336),d=i(460254),c=i(610142),u=i(230689),h=i(218571),g=i(454778);let m=e=>e.type===d.r.Video||e.type===d.r.Photo||e.type===d.r.UserVideo||e.type===d.r.UserPhoto,f=e=>e.type!==d.r.Audio&&e.type!==d.r.UserAudio&&e.type!==d.r.Transition,p=(e,t,i,d)=>{let p=(0,s.G)(c.L),_=(0,s.G)(u.t),{segmentManager:v,selectionManager:S,subjectCrop:T}=t.modules,{startDraggingVideoOnCanvas:M,handleVideoDragging:y,stopDraggingVideoOnCanvas:k}=(0,g.v)(t,i,e,{conflictModalSelectors:[".mutable-poly-modal",".attribute-panel-draggable",".attribute-view-menus"]}),x=(0,h.useCallback)((e,t)=>{e.preventDefault(),i.actionIsDraggingMaterialSet(!0),m(t)&&M(e,t)},[M]),I=(0,h.useCallback)((e,t)=>{e.preventDefault(),m(t)&&y(e)},[y]),D=(0,h.useCallback)((e,t)=>{e.preventDefault(),i.actionIsDraggingMaterialSet(!1),m(t)&&k(e,"leave")},[k]),b=(0,h.useCallback)(()=>{i.actionIsDraggingMaterialSet(!1)},[i]),E=(0,h.useCallback)(async(e,t)=>{if(e.preventDefault(),!f(t))return;let{segmentMutable:i,subDraftId:s,expandedSegmentId:c,batchReplacingSegmentId:u}=S,h={actionType:"drag_to_canvas",optionType:"add",batchCnt:1};if(m(t)){if((0,l.OvQ)(i)){(0,o.V)(v.afterReplaceMutableEvent)(()=>k(e,"mutate"));let a=await v.executeReplaceMutableVideoOnDrop(t,i,null!=s?s:void 0);a&&(0,r.NR)(_,{...t.delta,...h,status:(null==a?void 0:a.result.ok)?"success":"fail",waitTime:null==a?void 0:a.performanceDuration,isTemplateSubjectCrop:T.getIfUseSmartCropWhenReplacing(t.dragSource.key)}),a.result.code===n.F.ReplaceSegment&&k(e,"leave");return}k(e,"leave")}if(d)return;(0,a.b)(_,{relatedEvent:a.Z.AddMaterialToTrack,actionType:"drag_to_canvas",optionType:"add"});let g=await v.executeAddSegmentOnDrop(e,t);g&&(0,r.NR)(_,{...t.delta,...h,status:(null==g?void 0:g.result.ok)?"success":"fail",waitTime:null==g?void 0:g.performanceDuration})},[S,d,v,_,k]),C=(0,h.useRef)(),w=(0,h.useCallback)(()=>{var e;null===(e=C.current)||void 0===e||e.dispose()},[]);return(0,h.useEffect)(()=>(null==e?void 0:e.current)?(C.current=p.createDropTarget({dropTarget:e.current,dropArea:"canvas",callbacks:{onDragEnter:x,onDragOver:I,onDragLeave:D,onDragEnd:b,onDrop:E},setDropEffect:e=>f(e)?"grab":"not-allowed"}),w):w,[w,e,b,x,D,I,E,p]),w}},200231:function(e,t,i){i.d(t,{H:function(){return s}});var n=i(426336),r=i(329076),a=i(218571);function s(e,t,s){let o=(0,a.useRef)(!1),l=(0,r.m)(e),d=(0,a.useMemo)(()=>{if(t){let e=l(t);if(e&&(0,n.hey)(e))return e}return null},[t]);return(0,a.useEffect)(()=>{if(!!d)!o.current&&(o.current=!0,new Promise(e=>setTimeout(e,0)).then(()=>Promise.all([i.e("987"),i.e("6457"),i.e("7492")]).then(i.bind(i,594820))))},[d]),{currentSegmentVideo:d,maskWidgetContainerVisible:(0,a.useMemo)(()=>s,[s])}}},40760:function(e,t,i){i.d(t,{Z:function(){return h}});var n=i(772322),r=i(566504),a=i(105789),s=i.n(a),o=i(218571),l=i(282607),d=i(47945),c=i(846012);let u=(e,t,i)=>{let[n,r,a,s]=e,o=t.width*i,l=t.height*i,d=o/2*Math.abs(a-n),c=l/2*Math.abs(s-r);return{originWidth:d,originHeight:c,originX:o/2*(n+1),originY:l/2*(1-r)}},h=e=>{let{currentFaceId:t,dataSet:i,faceInfo:a,rect:h,refreshCurrentFrame:g,scale:m,segment:f,setFaceId:p,setFigureFaceId:_}=e,{bbox:v}=a,[S,T]=(0,o.useState)(u(v,h,m));(0,o.useEffect)(()=>{a&&T(u(v,h,m))},[m,h.width,h.height,a]);let M=(0,o.useCallback)(e=>{if(e.stopPropagation(),p(a.id),(0,r.ov)(f)){let{figures:e}=f;(null==e?void 0:e.length)&&(_({faceId:a.id,segmentId:f.id}),requestAnimationFrame(()=>{g()}))}},[g,p,a,f,_]);if(!a||!f)return null;let y=s()(c.Z.figureFaceBox,{"figure-face-box-selected":Number(a.id)===Number(t)}),{originHeight:k,originWidth:x,originX:I,originY:D}=S,b=Number(a.id)===Number(t)?l.r:d.r;return(0,n.jsxs)("div",{className:y,onMouseDown:e=>{e.stopPropagation()},onClick:M,style:{position:"absolute",width:`${x}px`,height:`${k}px`,left:`${I}px`,top:`${D}px`,zIndex:10},...i,children:[(0,n.jsx)(b,{className:s()(c.Z.figureFaceBoxCorner,c.Z.topLeft)}),(0,n.jsx)(b,{className:s()(c.Z.figureFaceBoxCorner,c.Z.topRight)}),(0,n.jsx)(b,{className:s()(c.Z.figureFaceBoxCorner,c.Z.bottomRight)}),(0,n.jsx)(b,{className:s()(c.Z.figureFaceBoxCorner,c.Z.bottomLeft)})]})}},655820:function(e,t,i){i.d(t,{L9:function(){return d},QF:function(){return h},_X:function(){return u},bC:function(){return g},fp:function(){return l},uH:function(){return c}});var n=i(953032),r=i(836946),a=i(111061),s=i(426336),o=i(218571);function l(e){let{run:t}=(0,n.default)((t,i,n)=>{if(!e)return;let r=t();e(n?[...n.map(e=>e.id),r.id]:[r.id]).then(e=>{let n=(0,a.OO)(e,r.id);if(!n)return;let s=t();s.y-=(n.height-s.height)/2,s.height=n.height,i(s)})},50);return{syncWidgetHeightAndY:t}}let d=e=>{let{rect:t,scale:i,widgetRef:n,onSubRectClick:s,onClickOutsideSubRects:l}=e;return{onWidgetClick:(0,o.useCallback)(e=>{var o,d;if(!!(null===(o=n.current)||void 0===o?void 0:o.parentElement)){if(s){let o=n.current.parentElement.getBoundingClientRect(),c=e.clientX-o.left,u=e.clientY-o.top,h=t.subRects.findIndex(e=>{let t=(0,a.Rz)(e,i);return(0,r.A2)(t,[c,u])});if(h<0){null==l||l();return}s(null===(d=t.subRects[h])||void 0===d?void 0:d.id,h,e)}}},[t,i,s])}},c=(e,t,i)=>{let n=e.subRects.map(e=>{let[n,r]=(0,a.Zd)(e,t,i);return{id:e.id,scale:s.pMA.div(e.width,e.initialWidth||e.originalWidth),translateX:n,translateY:r}}),[r,o]=(0,a.oH)(e,t,i);return{id:e.id,scaleX:s.pMA.div(e.width,e.originalWidth),scaleY:s.pMA.div(e.height,e.originalHeight),type:e.type,translateX:r,translateY:o,subRects:n}};function u(e,t,i){let[n,r]=(0,a.Zd)(e,t,i),s=e.subRects.map(e=>{let[n,r]=(0,a.Zd)(e,t,i);return{id:e.id,translateX:n,translateY:r}});return{id:e.id,translateX:n,translateY:r,subRects:s}}function h(e,t,i){var n,r;let s=e.subRects.map(e=>{let[n,r]=(0,a.Zd)(e,t,i);return{id:e.id,rotate:e.rotate,translateX:n,translateY:r}});return{id:e.id,rotate:e.rotate-(null!==(r=null===(n=i.at(-1))||void 0===n?void 0:n.rotate)&&void 0!==r?r:0),subRects:s}}function g(e,t,i){var n,r;let[s,o]=(0,a.oH)(e,t,i),l=720*e.originalWidth/(null!==(r=null==i?void 0:null===(n=i.at(-1))||void 0===n?void 0:n.originalWidth)&&void 0!==r?r:t[0]);return{id:e.id,fixedWidth:l,translateX:s,translateY:o,type:e.type,subRects:[]}}},115784:function(e,t,i){i.d(t,{Wd:function(){return n},pd:function(){return r}});let n={width:.1,height:.1},r={centerX:0,centerY:0,width:.5,height:.5,angle:0}},997151:function(e,t,i){i.d(t,{r:function(){return s}});var n=i(937802),r=i(685795),a=i(218571);function s(){let e=(0,n.G)(r.L);return(0,a.useCallback)(t=>e.sendEvent("illegal_update_params",t),[e])}},949222:function(e,t,i){i.d(t,{O:function(){return l}});var n=i(599639),r=i(937802),a=i(426336),s=i(218571);function o(e){let{dataSDK:t,subRects:i,needApplyToAll:n,subTitleIds:r,lyricIds:s}=e,o=[],l=[],d=!1,c=!1;function u(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o.push({segmentId:e.id,layout:{translateX:e.translateX,translateY:e.translateY,scaleX:e.scale,scaleY:e.scale,rotation:e.rotate},isKeyframe:t})}i.forEach(e=>{let{id:i}=e;l.push(i);let o=t.draftView.getSegmentById(i);if(null==o?void 0:o.material){var h,g;if(o.material.type===a.cVg.MetaTypeSubtitle&&!c&&n(i)){;h=e,c||(r.forEach(e=>{u({...h,id:e})}),c=!0);return}if(o.material.type===a.cVg.MetaTypeLyrics&&!d&&n(i)){;g=e,d||(s.forEach(e=>{u({...g,id:e})}),d=!0);return}}u(e,o&&o.commonKeyframes.length>0)}),o.filter(e=>{let i=t.draftView.getSegmentById(e.segmentId);return i&&(0,a.hey)(i)}).forEach(e=>{e.layout.translateX&&(e.layout.translateX*=2),e.layout.translateY&&(e.layout.translateY*=-2)}),t.api.segment.updateLayout(o,l)}function l(e){let{needApplyToAll:t,subTitleIds:i,lyricIds:l}=function(e){let t=(0,r.G)(n.m),i=(0,s.useRef)(e.draftView.getAllSubtitles().map(e=>e.id)),o=(0,s.useRef)(e.draftView.getAllLyrics().map(e=>e.id)),l=(0,s.useCallback)(i=>{let n=e.draftView.getSegmentById(i);if(null==n?void 0:n.material){if(n.material.type===a.cVg.MetaTypeSubtitle)return t.syncToAllConfig.shouldSyncToAllSubtitle();if(n.material.type===a.cVg.MetaTypeLyrics)return t.syncToAllConfig.shouldSyncToAllLyric()}return!1},[e,t.syncToAllConfig]);return(0,s.useEffect)(()=>{e.onChangeDiff(t=>{let{track:n,segment:r}=t;(n.length>0||r.length>0)&&(i.current=e.draftView.getAllSubtitles().map(e=>e.id),o.current=e.draftView.getAllLyrics().map(e=>e.id))})},[e]),{needApplyToAll:l,subTitleIds:i.current,lyricIds:o.current}}(e),d=(0,s.useCallback)(n=>{let{subRects:r}=n;o({dataSDK:e,subRects:r,needApplyToAll:t,subTitleIds:i,lyricIds:l})},[e,i,l,t]),c=(0,s.useCallback)(n=>{let{subRects:r}=n;o({dataSDK:e,subRects:r,needApplyToAll:t,subTitleIds:i,lyricIds:l})},[e,i,l,t]);return{onDragPoint:d,onTranslate:c,onRotate:(0,s.useCallback)(n=>{let{subRects:r}=n;o({dataSDK:e,subRects:r,needApplyToAll:t,subTitleIds:i,lyricIds:l})},[e,i,l,t])}}},889074:function(e,t,i){i.d(t,{Z:function(){return d}});var n=i(434316),r=i(655868),a=i(979627),s=i(138128),o=i(101172),l=i(382094);class d extends s.y{makeScreenshots(e){var t,i;let s=Object.assign(new n._y,{editor:this._renderManager,onProgress:e.onProgress,onComplete:this._next}),d=this._strategy.getTimestamps({unit:l.j.Microsecond,timeRanges:e.timeRanges,mode:e.mode}),[c,u]=this._strategy.getScreenshotSize(r.y),h=null!==(t=e.singleFrameHeight)&&void 0!==t?t:u,g=null!==(i=e.singleFrameWidth)&&void 0!==i?i:c,m=new o.W({recordable:this._recordable,context:s,timestamps:d,singleFrameHeight:h,singleFrameWidth:g}),f=this._combineTasks(m);if(console.log(a.U,`[combination-generator] combined task timestamps: ${f.timestamps}`),!f)return null;this.enqueue(f,!1)}constructor(e,t,i){super(e,t),this._recordable=e,this._renderManager=t,this._strategy=i}}},608877:function(e,t,i){i.d(t,{O:()=>S});var n=i("434316"),r=i("800788"),a=i("382094"),s=i("138128"),o=i("655868"),l=i("979627"),d=i("789786"),c=i("989719"),u=i("621249"),h=i("436731"),g=i("994483"),m=i("718494"),f=i("820359"),p=i("200462"),_=i("159277");class v extends g.h{run(e){return new Promise(t=>{(0,r.ZB)(e,"can not find screenshot context"),this._resolve=t;let i=this.timestamps.map(e=>({time:e,callbackData:Number(e)}));!this.timestamps.length&&this._complete(e),this._register(e.editor.onGetFrames(t=>t.taskId===this._taskId&&this._onProgress(t,e))),this.recordable.subDraft&&this.recordable.segmentId?this._taskId=e.editor.getCombinationVideoFrames(this.recordable.segmentId,i,this.singleFrameWidth,this.singleFrameHeight):this._taskId=e.editor.getVideoFrames(i,this.singleFrameWidth,this.singleFrameHeight),this._register({dispose:()=>{this._taskId&&e.editor.cancelGetVideoFrames(this._taskId)}}),console.log(l.U,`[task] running mutable-poly task id:${this.recordable.resourceKey} timestamp: ${this.timestamps}`)})}constructor(e){super(),this._resolve=c.Z,this._complete=e=>{console.log(l.U,`[task] mutable-poly task id:${this.recordable.resourceKey} finished`),this._setStatus(m.h.Completed),this.dispose(),this._resolve(),e.onComplete()},this._onProgress=(e,t)=>{let i=this.default;if(e.imageData){let t=new ImageData(e.imageData,e.width,e.height);i=new f.Sd({imageData:t,width:e.width,height:e.height,timestamp:BigInt(e.callbackData)})}let n=new p.N({completed:!0,sprites:i?[i]:[],resourceKey:this.recordable.resourceKey,trigger:_.a.Mutable});null==t||t.onProgress(n);let r=this.timestamps.shift();console.log(l.U,`[task] mutable-poly task id:${this.recordable.resourceKey} did timestamp: ${r} ${e.callbackData}`),e.finished&&this._complete(t)},this.run=this.run.bind(this),this.timestamps=e.timestamps,this.singleFrameHeight=e.singleFrameHeight,this.singleFrameWidth=e.singleFrameWidth,this.default=e.default,this.context=e.context,this.recordable=e.recordable}}(0,d.gn)([(0,h.h)(),(0,u.K)(),(0,d.w6)("design:type",Function),(0,d.w6)("design:paramtypes",["undefined"==typeof IMutableSegmentScreenshotContext?Object:IMutableSegmentScreenshotContext]),(0,d.w6)("design:returntype",void 0)],v.prototype,"run",null);class S extends s.y{makeScreenshots(e){var t,i;let s=Object.assign(new n._y,{editor:this._renderManager,onProgress:e.onProgress,onComplete:this._next}),d=this._strategy.getTimestamps({unit:a.j.Microsecond,timeRanges:e.timeRanges});(0,r.Y2)(d.length,`[screenshot] empty timestamps of seg: ${this._recordable.resourceKey}`);let[c,u]=this._strategy.getScreenshotSize(o.y),h=null!==(t=e.singleFrameHeight)&&void 0!==t?t:u,g=null!==(i=e.singleFrameWidth)&&void 0!==i?i:c,m=new v({recordable:this._recordable,context:s,timestamps:d,singleFrameHeight:h,singleFrameWidth:g}),f=this._combineTasks(m);if(console.log(l.U,`[mutable-poly-generator] combined task timestamps: ${f.timestamps}`),!f)return null;this.enqueue(f,!1)}constructor(e,t,i){super(e,t),this._recordable=e,this._renderManager=t,this._strategy=i}}},159277:function(e,t,i){i.d(t,{a:function(){return a},d:function(){return s}});var n,r,a=((n={})[n.Video=0]="Video",n[n.Combination=1]="Combination",n[n.MutablePoly=2]="MutablePoly",n[n.Mutable=3]="Mutable",n);var s=((r={})[r.Init=0]="Init",r[r.Ready=1]="Ready",r[r.Restoring=2]="Restoring",r[r.Working=3]="Working",r)},200462:function(e,t,i){i.d(t,{N:function(){return n}});class n{static isInCompletedBucketThumbnail(e){var t;return!!(!e.completed&&e.width&&e.height&&(null===(t=e.inCompletedTimeRanges)||void 0===t?void 0:t.length)&&e.sourceDuration&&e.timeRange)}get needMakeupScreenshots(){var e;return!!((null===(e=this.inCompletedTimeRanges)||void 0===e?void 0:e.length)&&!this.completed)}setCompleted(e){this.completed=e}setSprites(e){this.sprites.length=0,this.sprites.push(...e)}setInCompletedTimeRanges(e){this.inCompletedTimeRanges?(this.inCompletedTimeRanges.length=0,this.inCompletedTimeRanges.push(...e)):this.inCompletedTimeRanges=e}constructor(e){this.resourceKey=e.resourceKey,this.segmentId=e.segmentId,this.completed=e.completed,this.width=e.width,this.height=e.height,this.inCompletedTimeRanges=e.inCompletedTimeRanges,this.sourceDuration=e.sourceDuration,this.sourceDurationUnit=e.sourceDurationUnit,this.sprites=e.sprites,this.timeRange=e.timeRange,this.trigger=e.trigger}}},795375:function(e,t,i){i.d(t,{BC:function(){return o},Jj:function(){return l},iE:function(){return s},jo:function(){return d},tn:function(){return a}});var n=i(426336),r=i(382094);class a{static fromTimeRangeBigint(e,t){return new a(e[0],e[1],t)}static fromTimeRangeChange(e){return new a(e.startTime,e.endTime,r.j.Millisecond)}getNumeration(e){return BigInt(parseFloat(`1${Array(3*e).fill(0).join("")}`))}combineTimeRangeBigInt(e){return e.sort((e,t)=>n.pMA.minus(e[0],t[0])).reduce((e,t)=>{if(0===e.length)return[t];let i=e.pop();return t[1]<=i[1]?[...e,i]:t[0]<=i[1]?[...e,[i[0],t[1]]]:[...e,i,t]},[])}convert(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"floor",r=this.getNumeration(Math.abs(this.unit-e)),a=[],s=this.unit<e?n.pMA.times:n.pMA.div;return(a[0]=s(this.start,r,t,i),a[1]=s(this.end,r,t,i),"bigint"===t)?a.map(BigInt):a.map(e=>parseInt(String(e),10))}getTimeStamps(e){let{step:t,unit:i,timeRanges:n,mode:r}=e,[a,s]=this.convert(i,"bigint",r),o=[];for(let e=a;e<s;e=t(e,i))n.some(t=>t.contains(e,i))&&o.push(e);if(!r)return o;if("floor"===r)return o.map(e=>this.floorByStep(e,t));return o}combine(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];let r=i.concat(this).map(t=>t.convert(e,"bigint"));return this.combineTimeRangeBigInt(r).map(t=>a.fromTimeRangeBigint(t,e))}intersection(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let[s,o]=this.convert(e,"bigint"),l=i.map(t=>t.convert(e,"bigint")).reduce((e,t)=>{let[i,r]=t;return i>o||r<s?e:(e.push([n.pMA.max([s,i],"bigint"),n.pMA.min([o,r],"bigint")]),e)},[]),d=this.combineTimeRangeBigInt(l)[0];return d?a.fromTimeRangeBigint(d,e):null}contains(e,t){let[i,n]=this.convert(t,"bigint");return e>=i&&e<=n}floorByStep(e,t){let i=t(e)-e;return e-e%i}constructor(e,t,i){this.start=BigInt(e),this.duration=BigInt(t),this.end=this.start+this.duration,this.unit=i}}function s(e){if(0===e.length)return e;e.sort(function(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]});let t=[e[0]];for(let i=0,n=e.length;i<n;i++){let n=t.length-1;t[n][1]>=e[i][0]?t[n][1]=Math.max(t[n][1],e[i][1]):t.push(e[i])}return t}function o(e){return Number(e/1000n)}function l(e){return e.map(e=>e.convert(r.j.Millisecond,"number"))}function d(e){return e.map(e=>({startTime:e[0],endTime:e[1]}))}},481558:function(e,t,i){i.d(t,{h:function(){return r}});var n=i(260963);function r(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return new Promise(i=>(0,n.gx)(()=>!!e(),()=>t?i(e()):i()))}},697549:function(e,t,i){i.d(t,{W:function(){return a}});var n=i(690613),r=i(475590);class a{_init(e){let{onSuccess:t,onError:i,onCancel:r,onDelete:a,onMd5Set:s}=e,{_lifecycle:o,_onUploadedDefer:l,_waitForUploadDidDone:d}=this,c=()=>{this._notifyListeners&&(null==t||t()),l.resolve(o)},u=e=>{var t;this._notifyListeners&&(null==i||i()),l.reject((0,n.wf)(-1,null!==(t=null==e?void 0:e.msg)&&void 0!==t?t:"upload fail"))},h=[o.onDidMd5Set(()=>{var e;null==s||s(),!this._waitForUploadDidDone&&(null===(e=o.getModel().uploading)||void 0===e?void 0:e.isSupportFastImport)&&c()}),o.onResourceReady(c),o.onUploadFailure(u.bind(null,{msg:"upload fail"})),o.onTranscodeFailure(u.bind(null,{msg:"transcode fail"})),o.onDidCancelUpload(()=>{this._notifyListeners&&(null==r||r()),l.reject((0,n.wf)(-1,"upload canceled")),h.forEach(e=>e.dispose())}),o.onDidDelete(()=>{null==a||a(),h.forEach(e=>e.dispose()),u.bind(null,{msg:"material has been deleted"})}),o.onPrepareFailure(u.bind(null,{msg:"prepare fail"})),o.onSync2UserMaterialFailure(u.bind(null,{msg:"sync2UserMaterial fail"}))]}done(){return this._onUploadedDefer.promise}dispose(){this._notifyListeners=!1}constructor(e,t,i){this._waitForUploadDidDone=i,this._onUploadedDefer=(0,r.PQ)(),this._notifyListeners=!0,this._lifecycle=e,this._init(t)}}},444802:function(e,t,i){i.d(t,{J:function(){return r}});var n,r=((n={})[n.Normal=1]="Normal",n[n.Smart=2]="Smart",n)},461405:function(e,t,i){i.d(t,{GO:function(){return l},ZP:function(){return _},pd:function(){return d}});var n=i(772322),r=i(141913),a=i(670933),s=i(218571),o=i(831228);let l=()=>Promise.all([i.e("1428"),i.e("149"),i.e("2133"),i.e("9653"),i.e("4129")]).then(i.bind(i,393532)),d=()=>Promise.all([i.e("1428"),i.e("7920"),i.e("149"),i.e("2133"),i.e("6457"),i.e("2277"),i.e("7073")]).then(i.bind(i,321972)),c=(0,r.PS)(l),u=(0,r.PS)(d),h=(0,r.PS)(()=>Promise.all([i.e("5654"),i.e("9269")]).then(i.bind(i,905379))),g=(0,r.PS)(()=>i.e("3926").then(i.bind(i,61060))),m=(0,r.PS)(()=>i.e("5598").then(i.bind(i,819301))),f=(0,r.PS)(()=>i.e("3210").then(i.bind(i,544855))),p=(0,r.PS)(()=>i.e("5502").then(i.bind(i,262426))),_=(0,a.f3)("store")((0,a.Pi)(e=>{let{store:t,dataSdk:i,selection:a}=e,l=(0,s.useCallback)(()=>t.actionIsMultiTrackTrimModalVisibleSet(!1),[t]),d=(0,s.useCallback)(()=>t.setMultiTrackCropModalVisible(!1),[t]),_=(0,s.useCallback)(()=>t.actionIsMultiTrackTranscribeModalVisibleSet(!1),[t]),v=(0,s.useCallback)(()=>t.actionIsMultiTrackFreezingModalVisibleSet(!1),[t]),{isMultiTrackTrimModalVisible:S,isMultiTrackCropModalVisible:T,isMultiTrackTranscribeModalVisible:M,isMultiTrackFreezingModalVisible:y,isTransferPermissionModalVisible:k,isPasswordFlowVisible:x,isDraftViolationVisible:I}=t;return(0,n.jsxs)(r.Xf,{fallback:(0,n.jsx)(o.i,{}),children:[T?(0,n.jsx)(u,{visible:T,onClose:d}):null,S?(0,n.jsx)(c,{store:t,visible:S,onClose:l}):null,(0,n.jsx)(h,{visible:M,onClose:_,dataSdk:i,selection:a}),(0,n.jsx)(g,{visible:y,onClose:v}),(0,n.jsx)(m,{visible:k,store:t}),(0,n.jsx)(f,{visible:x,store:t}),(0,n.jsx)(p,{visible:I,store:t})]})}))},995234:function(e,t,i){i.d(t,{L:function(){return a},y:function(){return s}});var n=i(609962),r=i(587892);class a{get onProgress(){return this._onProgress.event}get onError(){return this._onError.event}get onSuccess(){return this._onSuccess.event}get onCancel(){return this._onCancel.event}get onStatusChange(){return this._onStatusChange.event}get onCancelableChange(){return this._onCancelableChange.event}get onRetry(){return this._onRetry.event}get error(){return this._error}get meta(){return this._meta}get status(){return this._status}get idle(){return[n.a.IDLE,n.a.CANCELED,n.a.FAILED,n.a.SUCCESS].includes(this.status)}_setStatus(e){this._status=e,this._onStatusChange.fire(e)}setCancelable(e){this._meta.cancelable=e,this._onCancelableChange.fire(e)}triggerErrorStatus(e){this._setStatus(n.a.FAILED),this._onError.fire(e)}triggerSuccessStatus(){this._setStatus(n.a.SUCCESS),this._onSuccess.fire()}triggerReplaceStatus(){this._setStatus(n.a.REPLACING)}start(){this._setStatus(n.a.UPLOADING)}cancel(){this._onCancel.fire(),this._setStatus(n.a.CANCELED)}retry(){this._onRetry.fire()}reset(){this._setStatus(n.a.IDLE)}constructor(e){this._onProgress=new r.Q,this._onError=new r.Q,this._onCancel=new r.Q,this._onSuccess=new r.Q,this._onRetry=new r.Q,this._onStatusChange=new r.Q,this._onCancelableChange=new r.Q,this._error=void 0,this._status=n.a.IDLE,this._meta=e}}class s{get onDidStartToken(){return this._onDidStartToken.event}get token(){return this._token}setToken(e){this._token=e,this._onDidStartToken.fire(e)}constructor(){this._onDidStartToken=new r.Q}}},767961:function(e,t,i){i.d(t,{G:function(){return c}});var n=i(641276),r=i(587892),a=i(402655),s=i(690613),o=i(729596),l=i(609591);class d extends a.JT{get hasLoaded(){return this._hasLoaded}active(){if(!this._activing)this._bindEvents(),this._activing=!0}unactive(){this._unbindEvents(),this._activing=!1}seek(e){this._source.seek(o.h.usToSecond(e),l.j.Auto),Promise.resolve().then(()=>this._updateProgress(!0))}seekAndPause(e){this._source.seek(o.h.usToSecond(e),l.j.Pause)}seekWithSpeed(e,t,i){this._source.seek(o.h.usToSecond(e),l.j.Auto)}flushSeekCmd(){}play(){this._endTime=0n,this._source.play()}pause(){this._pause()}rangePlay(e,t){this._endTime=t,this._source.seek(o.h.usToSecond(e),l.j.Pause),this._source.play()}reset(){this._source.seek(0,l.j.Pause),this._source.reset()}setFullscreenContainer(e){}requestFullscreen(){this._source.getFullscreen()}exitFullscreen(){this._source.exitFullscreen()}retryStreamAsset(e){return Promise.resolve(-1)}_pause(){this._endTime=0n,this._source.pause()}_updateProgress(e){let t=o.h.secondToUs(this._source.currentTime);this._progress=t,this._onProgress.fire(t,e)}_startProgressListener(){let e=()=>{this._updateProgress(!1),this._raf=requestAnimationFrame(e)};this._raf=requestAnimationFrame(e)}_stopProgressListener(){this._raf&&(cancelAnimationFrame(this._raf),this._raf=null)}_bindEvents(){this._register(this._onProgress.event(e=>{if(0n!==this._endTime&&e>=this._endTime){let e=this._endTime;(0,n.V)(this._source.onPause)(()=>{this.seek(e)}),this.pause()}})),this._register(this._source.onPlay(()=>{0n!==this._endTime?this._onRangePlay.fire():this._onPlay.fire(),this._startProgressListener()})),this._register(this._source.onPause(()=>{this._onPause.fire(),this._stopProgressListener()})),this._register(this._source.onEnded(()=>{this._onEnd.fire(),this._stopProgressListener()})),this._register(this._source.onSeeked(()=>{this._onSeeked.fire(),this._updateProgress(!0)})),this._register(this._source.onError(e=>this._onError.fire((0,s.wf)(-1,JSON.stringify(e))))),this._register(this._source.onFullscreenChange(e=>this._onFullscreenChange.fire(e,void 0))),this._register(this._source.onLoaded(()=>{this._hasLoaded=!0}))}_unbindEvents(){this._store.clear(),this._stopProgressListener()}constructor(e){super(),this._source=e,this._onPlay=new r.Q,this._onRangePlay=new r.Q,this._onPause=new r.Q,this._onProgress=new r.Q,this._onSeeked=new r.Q,this._onEnd=new r.Q,this._onError=new r.Q,this._onFullscreenChange=new r.Q,this._endTime=0n,this._progress=0n,this._activing=!1,this._hasLoaded=!1,this._raf=null,this.onPlay=this._onPlay.event,this.onRangePlay=this._onRangePlay.event,this.onPause=this._onPause.event,this.onProgress=this._onProgress.event,this.onSeeked=this._onSeeked.event,this.onEnd=this._onEnd.event,this.onError=this._onError.event,this.onFullscreenChange=this._onFullscreenChange.event}}function c(e){return new d(e)}},589252:function(e,t,i){i.d(t,{u:function(){return l}});var n=i(595493),r=i(753809),a=i(127830),s=i(759037);let o=new Set([a._g.Mask,a._g.StickerMotion,a._g.Effects,a._g.FaceProp,a._g.ManualFigure,a._g.SkeletonBody,a._g.AISkeletonBody,a._g.AutoBeautyBody,a._g.Beauty,a._g.AutoBeautyShape,a._g.AutoBeautyFace,a._g.AutoBeautyMakeup,a._g.TextTemplate,a._g.SubtitleTemplate,a._g.TextMotion,a._g.TextPreset,a._g.Sticker,a._g.Tone,a._g.Filter,a._g.VideoBackground,a._g.Transition,a._g.Mix,a._g.CurveSpeed,a._g.Integration,a._g.CurveHSL,a._g.VoiceChange]),l=function(e,t,i){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=!l&&(0,n.i)(i),u=[],h=[],g=[];t.forEach(t=>{var n,l,m;let f=null===(l=t.resource)||void 0===l?void 0:null===(n=l.resourceId)||void 0===n?void 0:n.toString();if(!f||f===r.Rw.resourceId)return;let p=!!(null==i?void 0:null===(m=i.invalidMaterialResources)||void 0===m?void 0:m[f]),_=t.resource.type===a._g.Font,v=t.resource.type===a._g.VideoBackground,S=o.has(t.resource.type),T=1===t.materialIds.length&&""===t.materialIds[0],M=c&&S&&!(p||_)&&!(d&&v&&T),{waitForResourceValueReady:y,waitForResourceMetaReady:k}=e.ensureEffect(t,void 0,{needUnzip:!0,disableAutoEnsureResourceValue:M,shouldPreload:_});h.push((0,s.b)(k())),M?(console.log("[progressive] adding a resource to progressive loading",t.key),g.push(t)):(console.log("[progressive] download a resource without progressive loading",t.key),u.push((0,s.b)(y())))});let m=()=>Promise.all(h);return g.length&&u.push(m().then(()=>e.progressivelyEnsureEffects(i,g,e.getEffectPathMap()))),{waitForEffectsEnsured:()=>Promise.all(u),waitForEffectMetasReady:m,shouldProgressivelyLoadResources:c}}},759037:function(e,t,i){i.d(t,{b:function(){return n}});let n=e=>e.catch(t=>(console.log("failed to load resource",e),!1))},255605:function(e,t,i){i.d(t,{bA:function(){return m},ol:function(){return g},xz:function(){return f}});var n=i(425427),r=i(108692),a=i(768362),s=i(729596),o=i(426336),l=i(293698),d=i(123869),c=i(993971),u=i(782350);let h=()=>{let e=l.m4.create(i.g.location.href).getAllQueryParameterValues(),t="Product"===e.utm_medium,n="draftshare"===e.utm_source,r="email"===e.utm_campaign;return t&&n&&r},g=(0,a.Tx)("preload-package-data",(e,t,i,a)=>t.invokeFunction(async t=>{var s,o;let l=t.get(c.j),g=t.get(n.rO),m=t.get(d.S),f=t.get(u.W),p=t.get(r.n),_=null!==(s=g.workspaceIdFromUrl)&&void 0!==s?s:p.draftWorkspaceManager.workspaceId,v=h(),S=await l.getPackageInfo(e,{packageKey:i,spaceId:null!==(o=g.spaceIdFromUrl)&&void 0!==o?o:f.getWorkspace(_).space_id,workspaceId:_,lang:m.currentLocale||"en",fromEmail:v,...a});return console.log("[startup] package data",S),S}),"fetchPackageInfo"),m=e=>e.invokeFunction(async e=>{let t=e.get(c.j);return await t.getPackageInfoFromJsonp()}),f=e=>{var t,i;let n={},r=[],a=[],l=[],d=null,c={},u="",h={};try{let t=o.HHr.parse(e.package_meta);n=o.HHr.parse(t.meta),l=t.assets||[],u=String(null==t?void 0:t.id)}catch(e){}try{r=o.HHr.parse(e.filer_asset_list)}catch(e){}for(let e of r){let t=l.find(t=>{let{md5:i}=t;return i===e.md5});if(null==t?void 0:t.meta)try{e.package_meta=JSON.parse(t.meta)}catch(e){}(!e.package_meta||"object"!=typeof e.package_meta)&&(e.package_meta={})}try{a=o.HHr.parse(e.material_list)}catch(e){}try{if(null==e?void 0:e.frame_info){let i=JSON.parse(null!==(t=e.draft)&&void 0!==t?t:null);d={...null==e?void 0:e.frame_info,draft_info:{canvas_config:null==i?void 0:i.canvas_config,duration:Math.floor(s.h.usToMs(null==i?void 0:i.duration))}}}}catch(e){}try{c=o.HHr.parse(e.package_preload_config)}catch(e){}try{h=null!==(i=e.attachment_info)&&void 0!==i?i:{}}catch(e){}let g=o.HHr.parse(e.preload);return{meta:n,syncId:u,packageAssets:l,template:e.draft,preloadResources:{materials:g.avs,effects:g.effects},resourceInfos:{onlineResourceList:a,everCloudResourceList:r,errorList:e.error_list},firstFrameInfo:d,preloadConfig:c,attachments:h}}},617508:function(e,t,i){i.d(t,{P:()=>f});var n=i("940282"),r=i("127830"),a=i("868028"),s=i("426336");let o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},i={},n=(e,i)=>{!t[e]&&(t[e]=new Set),t[e]&&t[e].add(i)};return e.forEach(e=>{let{md5:t,path:i}=e;n(t,i)}),Object.keys(t).forEach(e=>{let n=t[e];if(n.size>1){let e=Array.from(n),t=e[0];e.forEach(e=>{i[e]=t})}}),i};var l=i("234075"),d=i.n(l),c=i("854585"),u=i("722169");let h=e=>{var t,i;let n=[];return(null!==(i=null===(t=e.tracks)||void 0===t?void 0:t.map(e=>{var t;return null==e?void 0:null===(t=e.segments)||void 0===t?void 0:t[0]}))&&void 0!==i?i:[]).filter(e=>{var t;return e&&(null==e?void 0:null===(t=e.target_timerange)||void 0===t?void 0:t.start)===0}).forEach(e=>{(null==e?void 0:e.material_id)&&n.push(null==e?void 0:e.material_id)}),n},g=e=>{var t,i,n,r;let a=(null!==(r=null===(t=e.tracks)||void 0===t?void 0:t.filter(e=>(null==e?void 0:e.type)===s.pNd.TrackTypeSticker&&Array.isArray(e.segments)).map(e=>null==e?void 0:e.segments).flat())&&void 0!==r?r:[]).reduce((e,t)=>{if((null==t?void 0:t.extra_material_refs)&&Array.isArray(null==t?void 0:t.extra_material_refs))for(let i of t.extra_material_refs)"string"==typeof i&&e.push(i);return(null==t?void 0:t.material_id)&&e.push(t.material_id),e},[]);return(null===(n=e.materials)||void 0===n?void 0:null===(i=n.drafts)||void 0===i?void 0:i.length)&&e.materials.drafts.forEach(e=>{e.draft&&a.push(...g(e.draft))}),a},m=e=>e.startsWith("/")?e:`/${e}`,f=(e,t,i,l,f)=>{var p,_,v;let{preloadResources:S,resourceInfos:T}=t,{materials:M}=S,{builtInResourceList:y=[]}=T,{everCloudResourceList:k=[]}=T,x=(k=(0,u.isFunction)(f)?f(k):k).map(t=>(0,a.s)(e,t)),I=Object.values(null!=M?M:{}),D=h(l),b=g(l),E=[],C=[],w=[],N=[],A=[],j=[],O=[],L=[],P=[],R=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return;let n=[];if(i){let t=s.hPV.toLocalPath(e,{transform:"absolute"});x.forEach(e=>{s.hPV.toLocalPath(e.path,{transform:"absolute"}).startsWith(t)&&n.push(e)})}else{let t=x.find(t=>s.hPV.isPathEqual(t.path,e));t&&n.push(t)}if(!!n.length)n.forEach(n=>{L.push({asset:n,pathInDraft:i?n.path:e,fsPath:s.hPV.toAbsolutePath(e),algorithmType:t})}),i&&P.push(e)},U=(e,t,i)=>{if(!e)return;let n={pathInDraft:i?d().join("/",e):e,fsPath:s.hPV.toAbsolutePath(e),preloadMaterial:t},r=x.find(t=>s.hPV.isPathEqual(m(t.path),m(e)));if(r){let e={...n,asset:r,isVideoAlgorithmProduct:i};A.push(e)}else j.push(n)},z=[...x.map(e=>e.path),...null!==(p=null==y?void 0:y.map(e=>e.path))&&void 0!==p?p:[]],B=e=>z.find(t=>s.hPV.isPathEqual(t,e));for(let e of I){let{path:t,reverse_path:n,ai_matting_path:a,beats_path:o,melody_path:l,production_path:d,video_algorithm_path:u,trackers:h,schema:g,canvas_image_path:m,vocal_beautify_production_path:f,vocal_separation_production_path:p}=e;if(D.includes(e.id)&&c.DZ.includes(e.meta_type)&&(e.is_first_frame_stream_material=!0),b.includes(e.id)&&c.DZ.includes(e.meta_type)&&(e.support_stream=!1),U(o,e),U(l,e),U(d,e),null==a||null===(_=a.split(";"))||void 0===_||_.forEach(t=>{U(t,e,!0)}),u?U(u,e,!0):U(n,e),h)for(let t of h)U(t.data_path,e,!0);U(m,e),U(f,e),U(p,e),s.hPV.isPathIncompleteQuickImport(t)&&O.push({fsPath:s.hPV.toAbsolutePath(t),pathInDraft:t,preloadMaterial:e});let S=y.find(e=>s.hPV.isPathEqual(e.path,t));if(S)E.push({builtIn:S,fsPath:s.hPV.toAbsolutePath(t),pathInDraft:t,preloadMaterial:e});else if(g){let n={pathInDraft:t,fsPath:s.hPV.toAbsolutePath(t),preloadMaterial:e,online:i[g]};(null===(v=n.online)||void 0===v?void 0:v.resource)&&n.online.resource.type===r._g.Video&&"maskVideo"in n.online.resource&&n.online.resource.maskVideo&&a&&w.push({pathInDraft:a,fsPath:s.hPV.toAbsolutePath(a),preloadMaterial:e,online:i[g],useMaskVideo:!0}),i[g]?w.push(n):B(e.path)?U(t,e):N.push(n)}else U(t,e)}for(let e of y)!E.find(t=>s.hPV.isPathEqual(t.builtIn.path,e.path))&&C.push({builtIn:e});let V=0,F=function(e){var t,i,r,a,o,d,c;let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(V=Math.max(V,u),u>=100)return;(null==e?void 0:null===(t=e.materials)||void 0===t?void 0:t.effects)&&Array.isArray(null==e?void 0:null===(i=e.materials)||void 0===i?void 0:i.effects)&&e.materials.effects.forEach(e=>{(null==e?void 0:e.type)==="figure"&&e.algorithm_artifact_path&&R(e.algorithm_artifact_path,n.Y.FigureBeauty,!0)}),(null==e?void 0:null===(r=e.materials)||void 0===r?void 0:r.smart_crops)&&Array.isArray(null==e?void 0:null===(a=e.materials)||void 0===a?void 0:a.smart_crops)&&e.materials.smart_crops.forEach(e=>{(null==e?void 0:e.cache_path)&&R(e.cache_path,n.Y.SmartCrop,!0)});let h=null==l?void 0:null===(o=l.mutable_config)||void 0===o?void 0:o.mutable_materials;h&&Array.isArray(h)&&h.forEach(e=>{(null==e?void 0:e.cover_path)&&U(e.cover_path,{id:"",schema:"",path:e.cover_path,meta_type:s.C3w.MetaTypePhoto,support_stream:!0,source_platform:0,app_id:0,material_id:"",source:0,intensifies_audio_path:"",video_algorithm_path:"",matrix_path:"",reverse_intensifies_path:"",reverse_path:"",ai_matting_path:""})}),(null==e?void 0:null===(d=e.materials)||void 0===d?void 0:d.drafts)&&Array.isArray(null==e?void 0:null===(c=e.materials)||void 0===c?void 0:c.drafts)&&e.materials.drafts.forEach(e=>{(null==e?void 0:e.draft)&&F(e.draft,u+1)})};return F(l),{builtInMaterials:E,remainingBuiltInResources:C,onlineMaterials:w,unresolvedOnlineMaterials:N,everCloudMaterials:A,unresolvedEverCloudMaterials:j,quickImportMaterials:O,packageAssets:x,duplicatedBuiltinResourceMap:o(y),algorithmProductMaterials:L,folders:P,maxSubDraftDepth:V}}},603647:function(e,t,i){i.d(t,{N:function(){return r}});var n,r=((n={}).doing="doing",n.success="success",n.fail="fail",n.default="default",n)},386213:function(e,t,i){i.d(t,{M:()=>p});var n=i("789786"),r=i("230689"),a=i("711536"),s=i("426336"),o=i("722169"),l=i("402655"),d=i("800788");Symbol.for("__current_segment_dispatcher_name__");class c extends l.JT{get _currentSegmentId(){return this._currentSegmentStore.currentSegmentId}get _currentSegment(){return this._currentSegmentStore.currentSegment}_getSegmentDelta(e,t){let{type:i,item:n}=e;if(i===s.C8.UPDATE&&n.id){let{targetTimerange:i}=e.item.segment;if(null==i?void 0:i.start){let e=t.getSegmentById(n.id);e&&(i.start=e.targetTimerange.start)}}return e.item.segment}_handleChangeDiff(e){if(0===e[s.u4I.SEGMENT].length||!this._currentSegmentId||!this._currentSegment)return;let t=e[s.u4I.SEGMENT].filter(e=>(0,o.get)(e.item,"id")===this._currentSegmentId||(0,o.get)(e.item.segment,"id")===this._currentSegmentId);if(!t[0])return;let i=this._dataSdk.draftView.getSegmentById(this._currentSegmentId);(0,d.ZB)(i),t.forEach(t=>{this._currentSegmentStore.updateCurrentSegment(this._getSegmentDelta(t,e.videoDocument))})}_handleSelectionChange(){let e;if(this._selection.transitionIds.length>0)e=this._findSegmentByTransitionId(this._selection.transitionIds[0]);else{let t=this._selection.segmentIds;if(t.length>1||0===t.length){this._currentSegmentStore.changeCurrentSegment(null);return}if(!(0,o.isNil)(this._currentSegmentId)&&this._currentSegmentId===t[0])return;e=this._dataSdk.draftView.getSegmentById(t[0])}(0,d.ZB)(e),this._currentSegmentStore.changeCurrentSegment(e)}_findSegmentByTransitionId(e){for(let i of this._dataSdk.draftView.getTracksByType(s.pNd.TrackTypeVideo))for(let n of i.segments){var t;if((0,s.hey)(n)&&(null===(t=n.transition)||void 0===t?void 0:t.id)===e)return n}}constructor(e,t,i){super(),this._currentSegmentStore=i,this._selection=e,this._dataSdk=t,this._register(this._selection.onChange(this._handleSelectionChange,this)),this._register(this._dataSdk.onChangeDiff(this._handleChangeDiff,this))}}var u=i("566504");Symbol.for("__current_text_material_dispatcher_name__");let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((0,s.Q2R)(e)){if(t>=0){let i=e.material.textInfoResources[t];if(i)return i.textMaterial}return e.material.textInfoResources[0].textMaterial}return e.material};class g{setRichTextEditorManager(e){this._richTextEditorManager=e}setSegmentAndChildIndex(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;((null===(t=this._currentSegment)||void 0===t?void 0:t.id)!==e.id||this._selectedSegmentChildIndex!==i)&&this.reset(),this._currentSegment=e,this._selectedSegmentChildIndex=i,!this._textMaterial&&this._updateMaterial()}initTextMaterialIfNeeded(){this._updateMaterial()}addListeners(){this.removeListeners(),this._disposeChangeDiff=this._dataSdk.onChangeDiff(this._handleChangeDiff,this),this._disposeTextSelection=this._richTextEditorManager.onDidChangeSelection(this._handleTextSelectionChange,this)}removeListeners(){var e,t;null===(e=this._disposeChangeDiff)||void 0===e||e.dispose(),null===(t=this._disposeTextSelection)||void 0===t||t.dispose()}reset(){this._currentTextMaterialStore.changeCurrentTextMaterial(null)}get _currentSegmentId(){var e;return null===(e=this._currentSegment)||void 0===e?void 0:e.id}get _textMaterial(){return this._currentTextMaterialStore.currentTextMaterial}_updateMaterial(){(0,d.ZB)(this._currentSegment,"current segment is nil"),(0,d.ZB)(this._richTextEditorManager,"_richTextEditorUtil is nil");let e=h(this._currentSegment,this._selectedSegmentChildIndex);if((0,u.DU)(this._currentSegment))this._currentTextMaterialStore.updateCurrentTextMaterial(e);else{!this._textMaterial&&this._currentTextMaterialStore.updateCurrentTextMaterial(e);let t=this._richTextEditorManager.getEditorUtil().getTextMaterialWithMixedStyles(e,{begin:this._richTextEditorManager.getSelectionStart(),end:this._richTextEditorManager.getSelectionEnd()});this._currentTextMaterialStore.updateCurrentTextMaterial({...e,...t})}}_handleChangeDiff(e){if(!!this._currentSegmentId){if(e.isInBatchMode){this._latestDiffDataInBatchMode=e;return}(this._latestDiffDataInBatchMode&&0===e[s.u4I.SEGMENT].length?this._latestDiffDataInBatchMode:e)[s.u4I.SEGMENT].some(e=>{let t=e.type===s.C8.UPDATE&&e.item.id===this._currentSegmentId&&e.item.segment.material,i=e.type===s.C8.ADD&&e.item.segment.id===this._currentSegmentId&&e.item.segment.material;return t||i})&&this._updateMaterial(),this._latestDiffDataInBatchMode=void 0}}_handleTextSelectionChange(e,t){var i,n;if((null===(i=this._lastTextSelection)||void 0===i?void 0:i.start)!==e||(null===(n=this._lastTextSelection)||void 0===n?void 0:n.end)!==t)this._lastTextSelection={start:e,end:t},this._updateMaterial()}constructor(e,t){this._dataSdk=e,this._currentTextMaterialStore=t,this._selectedSegmentChildIndex=0}}var m=i("313952"),f=i("236735");class p extends l.JT{getReadonlyStore(e){return this._storeMap.get(e)}getDispatcher(e){return this._dispatchers.get(e)}constructor(e,t,i,n){super(),this._selection=e,this._dataSdk=t,this._containerService=n,this._storeMap=new Map,this._dispatchers=new Map,this._missingDependenciesTracker=this._containerService.createInstance(m.s,i),this._currentSegmentStore=this._containerService.createInstance(a.D,t,this._missingDependenciesTracker),this._dispatchers.set(a.t,this._register(this._containerService.createInstance(c,this._selection,t,this._currentSegmentStore))),this._storeMap.set(a.t,this._currentSegmentStore);let r=this._containerService.createInstance(f.S);this._storeMap.set(f.q,r);let s=this._containerService.createInstance(g,this._dataSdk,r);this._dispatchers.set(f.q,s)}}p=(0,n.gn)([(0,n.fM)(3,r.t),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof Selection?Object:Selection,"undefined"==typeof IDataSdk?Object:IDataSdk,Boolean,void 0===r.t?Object:r.t])],p)},531474:function(e,t,i){i.d(t,{M:function(){return o},T:function(){return c}});var n=i(569471),r=i(722169),a=i(260963),s=i(426336);let o=e=>{let t=Object.prototype.toString.call(e);return"[object String]"===t||"[object Boolean]"===t||"[object Number]"===t||"[object Symbol]"===t||"[object BigInt]"===t||!1},l=["__segment_struct_type",s._nF,s.I90],d=e=>!!(null==e?void 0:e[s._nF]),c=(0,a.aD)((e,t)=>{let i=Object.keys(t);for(let h of i){let i=null==t?void 0:t[h];if(l.includes(h))continue;if(o(t[h])){(0,a.t8)(e,{[h]:t[h]});continue}if(Array.isArray(t[h])){!(Array.isArray(e[h])&&0===e[h].length&&0===t[h].length)&&(0,a.t8)(e,{[h]:t[h]});continue}if((null===e[h]||void 0===e[h])&&(d(i)||!(0,r.isNil)(i)&&!(0,r.isPlainObject)(i)&&!Array.isArray(i))){var u;let t=new(null!==(u=null==i?void 0:i[s._nF])&&void 0!==u?u:i.constructor);(0,a.t8)(e,{[h]:c((0,a.LO)((0,n.I)(t)),i)});continue}if(void 0!==t[h]){if(null===t[h]){(0,a.t8)(e,{[h]:null});continue}if(null===e[h]||void 0===e[h]){(0,a.t8)(e,{[h]:t[h]});continue}"object"==typeof t[h]&&"object"==typeof e[h]&&(0,a.t8)(e,{[h]:c(e[h],t[h])}),"object"!=typeof e[h]&&(0,a.t8)(e,{[h]:t[h]})}}return e})},313952:function(e,t,i){i.d(t,{s:function(){return c}});var n=i(722169),r=i(569471),a=i(800788),s=i(805794),o=i(531474),l=i(260963);let d=Symbol.for("__TRACKED_RAW_OBJECT__");class c{static getRaw(e){let t=e;return(null==t?void 0:t[d])&&(t=null==t?void 0:t[d]),(0,l.bi)(t)&&(t=(0,r.I)(t)),!(0,n.isPlainObject)(t)&&(t=(0,r.I)(t)),t}_crashOnDevEnv(e){this._isDev,s.B.warn(e),window.alert(e)}_getHandler(e){return{get:(t,i,r)=>{if(i===d)return t;let a=Reflect.get(t,i,r);if((0,n.isNil)(e))return a;if("object"==typeof a&&null!==a)return this._createTrackedObject(t[i],e[i]);let l=null==e?void 0:e[i];if("function"==typeof l&&(l=l.bind(e)),(0,n.isNil)(a)){if(a===l)return a;let e=`value of ${String(i)} is not consistent with fallback: ${String(l)}, which is now: ${String(a)}`;return this._crashOnDevEnv(e),l}if(typeof a!=typeof l){let e=`type of ${String(i)} is not consistent with fallback: ${String(l)}, why?`;return this._crashOnDevEnv(e),l}if((0,o.M)(a)&&l!==a){let e=`the value of ${String(i)} might be outdated, newest is: ${String(l)}`;return s.B.warn(e),l}return a}}}_createTrackedObject(e,t){return new Proxy(e,this._getHandler(t))}track(e,t){return this._createTrackedObject(e,t)}constructor(e){this._isDev=e}}},120973:function(e,t,i){i.d(t,{s:function(){return y}});var n=i(789786),r=i(621071),a=i(315201),s=i(928566),o=i(230689),l=i(433140),d=i(31463),c=i(127830),u=i(426336),h=i(732564),g=i(881687),m=i(108692),f=i(533147),p=i(873482),_=i(667014),v=i(566504),S=i(957634),T=i(948328),M=i(722169);class y{get store(){return this._store}updateRenderManager(e){this._renderManager=e}checkAvailable(e){return((0,g.gX)(e)||(0,g.Y2)(e)||(0,g.bw)(e))&&(0,g.BT)(e)}getIfCanSubjectCrop(){var e;let t=window.ip_location_info;return((null==t?!void 0:null===(e=t.Subdivisions)||void 0===e?!void 0:!e.length)||4896861!==t.Subdivisions[0].GeoNameID)&&!0}getIfUseSubjectCrop(e){return this._getIfNeedAdjustToVideo()&&this.getIfCanSubjectCrop()&&this.checkAvailable(e)}_sendRequest(e){let{requestKey:t,computedParams:i,force:n=!1}=e,a=[],s=[],o=[];for(let{computedRequestParams:e,mutableVideos:t}of i){if(!n){let i=this._findExistedResult(e.source,t,e.targetRatios);if(Object.keys(i).length===t.length){for(let n of(a.push({requestParams:e,results:i,status:p.m.SomeSuccess}),t))this._markPerformance(n.id,0,Date.now()),this._markPerformance(n.id,1,Date.now());continue}}s.push(e),o.push({mutableVideos:t,requestParams:e})}if(!s.length)return Promise.resolve(a);let l=Date.now();this._markPerformance(t,0,l);let d=new Promise(async(e,i)=>{(0,f.r)(this._containerService,{});let n=this._subjectCropDataService.getSubjectCropResult(s.slice(0,30)),d=await n;if(!d.ok)return i(Error(d.code===r.x.DataError?_.SC.ServiceError:_.SC.NetworkError));let c=Date.now();this._markPerformance(t,1,c);let u=d.value;for(let e=0;e<u.length;e++){let t=u[e],i={},n=t.list,s=e<o.length?o[e]:void 0;if(!s){a.push({results:i,requestParams:{sourceType:r.C.NONE,source:""},status:p.m.AllFailed});continue}let{requestParams:d,mutableVideos:h}=s;if(!n||0===n.length){a.push({results:i,requestParams:d,status:p.m.AllFailed});continue}for(let e=0;e<n.length&&e<h.length;e++){let{cropBox:r,ratio:a}=n[e];if(r&&4===r.length&&a&&2===a.length){let n=`${t.source}-${a[0]}-${a[1]}`;this.subjectCropResults[n]=[r[0],r[1],r[2],r[3]],i[h[e].id]={cropBox:this.subjectCropResults[n],ratio:a}}this._markPerformance(h[e].id,0,l),this._markPerformance(h[e].id,1,c)}a.push({results:i,requestParams:d,status:p.m.SomeSuccess})}let h=Object.values(a.reduce((e,t)=>{let{results:i}=t;return Object.entries(i).forEach(t=>{let[i,n]=t;e[i]?Object.assign(e[i],n):e[i]=n}),e},{})),g=h.some(e=>{let{cropBox:t}=e;return t.some(e=>0!==e)}),m=h.every(e=>{let{cropBox:t}=e;return t.every(e=>0===e)}),v=0,S=this._performanceStatics.get(t);return S&&(v=S.endTime-S.startTime),(0,p.n)(this._containerService,{time:v,status:g?p.m.SomeSuccess:m?p.m.NoSubject:p.m.AllFailed}),e(a)});d.catch(e=>{throw(0,p.n)(this._containerService,{time:0,status:p.m.AllFailed}),e});let c=(0,g.Vs)(5e3,d);return c.catch(e=>{this._reportService.reportDevEvent(this._reportEventName,{name:"getSubjectCropResult error",value:"timeout"})}),c}async getSubjectCropResult(e,t){var i,n;let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!this.getIfUseSubjectCrop(e)||!("width"in e&&"height"in e)||!t)return Promise.resolve({results:{}});let a=(0,g.sy)(e);if(!a)return Promise.resolve({results:{}});if(r){let e=t.map(e=>e.segmentId);this._store.setProcessingSegIds([...this._store.processingSegIds,...e])}let s=t.map(t=>{var i,n;return(0,g.nT)(t,null!==(i=e.width)&&void 0!==i?i:0,null!==(n=e.height)&&void 0!==n?n:0,this._getSegmentById(t.segmentId))}),o={targetRatios:s,workspaceId:null!==(i=this._mainDraftService.draftWorkspaceManager.workspaceId)&&void 0!==i?i:void 0,...a},l=`${o.source}-${s.flat().join("-")}`,{results:d}=null!==(n=(await this._sendRequest({computedParams:[{computedRequestParams:o,mutableVideos:t}],requestKey:l})).find(e=>e.requestParams.source===o.source))&&void 0!==n?n:{results:{}};return{results:d}}applySubjectCropSync(e,t,i){var n,r,a,s;if(!this.getIfUseSubjectCrop(e)||!("width"in e&&"height"in e))return!1;if("rejected"===i.status){for(let a of(this.store.removeProcessingSegIds(t.map(e=>e.segmentId)),t))this._reportApplyResult({material:e,status:_.rK.Failed,failedReason:null!==(r=null===(n=i.reason)||void 0===n?void 0:n.message)&&void 0!==r?r:_.SC.NetworkError,mutableId:a.id});return!1}let o=i.value.results,l=0;for(let i of t){if(!o[i.id]){this._reportApplyResult({material:e,status:_.rK.Failed,failedReason:_.SC.ServiceError,mutableId:i.id}),this._store.removeProcessingSegId(i.segmentId);continue}let{cropBox:t,ratio:n}=o[i.id];if(!t||t.every(e=>0===e)){this._reportApplyResult({material:e,status:_.rK.Failed,failedReason:_.SC.NoSubject,mutableId:i.id,ratio:n}),this._store.removeProcessingSegId(i.segmentId);continue}if(!this._store.processingSegIds.includes(i.segmentId))continue;let r=this._transformBBoxToCropActionParams({bbox:t,materialInfo:{width:null!==(a=e.width)&&void 0!==a?a:0,height:null!==(s=e.height)&&void 0!==s?s:0},mutableId:i.id});if(!!r)this._innerReplaceCrop(r,this._getSegmentById(i.segmentId)),this._store.removeProcessingSegId(i.segmentId),this._store.addSuccessResourceId(e.key),this._reportApplyResult({material:e,ratio:n,status:_.rK.Success,mutableId:i.id}),l+=1}return l>0}async getNewTemplateSubjectCropResult(e,t,i){let n=[],a=[];for(let i=0;i<e.length;i++){var s,o;let l=e[i];if(i>=t.length)break;let d=t[i];if(!d.filled)continue;let u=null!==(s=this._mainDraftService.draftPathStore.getResourceKeyFromDraftPath(d.path))&&void 0!==s?s:"",{materialId:h}=d;if(h){let e=this._resourceService.get(u,c._g.Photo);e&&(0,g.sW)(e.value)&&(n.push({computedRequestParams:{sourceType:r.C.HEYCAN,source:e.value.resourceId,targetRatios:[(0,g.nT)(l,e.value.width,e.value.height)]},mutableVideos:[l]}),a.push(l.id))}else{let e=this._resourceService.get(u,c._g.UserPhoto);e&&(0,g.sW)(e.value)&&(0,g.gX)(e.value)&&(n.push({mutableVideos:[l],computedRequestParams:{sourceType:r.C.EverCloud,source:e.value.md5,workspaceId:null!==(o=this._mainDraftService.draftWorkspaceManager.workspaceId)&&void 0!==o?o:void 0,targetRatios:[(0,g.nT)(l,e.value.width,e.value.height)]}}),a.push(l.id))}}return{results:(await this._sendRequest({computedParams:n,force:!0,requestKey:i})).reduce((e,t)=>{let{results:i}=t;return Object.entries(i).forEach(t=>{let[i,n]=t;e[i]?Object.assign(e[i],n):e[i]=n}),e},{})}}applySubjectCropToNewTemplate(e){if("rejected"===e.status){var t,i;return this._reportApplyResult({status:_.rK.Failed,failedReason:null!==(i=null===(t=e.reason)||void 0===t?void 0:t.message)&&void 0!==i?i:_.SC.NetworkError}),!1}let n=e.value.results,r=Object.keys(n),a=0;for(let e of r){let{cropBox:t,ratio:i}=n[e],r=this._getMutableVideoById(e);if(!r)continue;let s=this._transformBBoxToCropActionParams({bbox:t,materialInfo:{width:r.width,height:r.height},mutableId:e});if(!!s)this._innerReplaceCrop(s,this._getSegmentById(r.segmentId)),this._reportApplyResult({ratio:i,status:_.rK.Success}),a+=1}return a>0}subjectCropMutableVideoAsync(e){let{mutableId:t,segmentId:i}=e,n=this._getSegmentById(i),r=this._getMutableVideoById(t);if(!r||!n||!r.filled)return;let a=this._getResourceBySegment(n);Promise.allSettled([a&&r?this.getSubjectCropResult(a.data,[r]):Promise.resolve({results:{}})]).then(e=>{let[t]=e;a&&this.applySubjectCropSync(a.data,[r],t)})}cancelSubjectCrop(e){let t=this._getDraftId(),{draftIdToRelationVideoGroup:i,draftIdToMutableVideos:n}=this._dataSdk.cutSame,r=n[t],a=r.find(t=>t.segmentId===e);if(e){if(a){let e=i[t].get(a.relationVideoGroup),n=(e?r.filter(t=>e.has(t.id)):[a]).map(e=>e.segmentId);this.store.removeProcessingSegIds(n)}}else this.store.removeProcessingSegIds();(null==a?void 0:a.filled)&&this._dataSdk.api.undoRedo.undo(),this._reportApplyResult({status:_.rK.Cancel,failedReason:_.SC.Cancel,mutableId:null==a?void 0:a.id})}getIfUseSmartCropWhenReplacing(e){return!!this._store.successResourceIds.includes(e)&&(this._store.removeSuccessResourceId(e),!0)}_innerReplaceCrop(e,t){var i;if(!t||!(0,v.ov)(t)||Object.values(e).every(e=>0===e))return;let n=null===(i=t.material)||void 0===i?void 0:i.crop.clone();this._dataSdk.api.segment.innerReplace({draftId:this._getDraftId(),identifier:{id:t.id,material:{crop:n}},substitute:{id:t.id,material:{crop:e}}})}_getIfNeedAdjustToVideo(){let e=this._dataSdk.draftView,t=(0,g.j)(e);if(this._segmentSelection.subDraftId){let i=this._dataSdk.draftView.getDraftById(this._segmentSelection.subDraftId);t=(0,g.j)(null!=i?i:e)}return t===u._T0.AlignModeVideo}_findExistedResult(e,t,i){let n={};for(let r=0;r<t.length;r++){let a=t[r],s=i[r];if(2!==s.length)continue;let o=`${e}-${s[0]}-${s[1]}`;this.subjectCropResults[o]&&(n[a.id]={cropBox:this.subjectCropResults[o],ratio:s})}return n}_getDraftId(){var e;return null!==(e=this._segmentSelection.subDraftId)&&void 0!==e?e:this._dataSdk.draftView.getDraftId()}_getSegmentById(e){var t;let i=this._segmentSelection.subDraftId?this._dataSdk.draftView.getDraftById(this._segmentSelection.subDraftId):this._dataSdk.draftView;return null==i?void 0:null===(t=i.getAllSegments())||void 0===t?void 0:t.find(t=>t.id===e)}_transformBBoxToCropActionParams(e){var t;let{bbox:i,materialInfo:n,mutableId:r}=e,a=this._getMutableVideoById(r),s=this._getSegmentById(null!==(t=null==a?void 0:a.segmentId)&&void 0!==t?t:"");if(!a||!s||!(0,u.hey)(s))return;let[o,l,d,c]=[i[0],i[1],i[2],i[3]];return(o=(0,M.isString)(o)?parseFloat(o):o,l=(0,M.isString)(l)?parseFloat(l):l,d=(0,M.isString)(d)?parseFloat(d):d,c=(0,M.isString)(c)?parseFloat(c):c,d>1||c>1||o<0||l<0||o>1||l>1)?s.material.crop:{upperLeftX:o,upperLeftY:l,upperRightX:o+d,upperRightY:l,lowerLeftX:o,lowerLeftY:l+c,lowerRightX:o+d,lowerRightY:l+c}}_getMutableVideoById(e,t){return this._dataSdk.cutSame.draftIdToMutableVideos[null!=t?t:this._getDraftId()].find(t=>t.id===e)}_getResourceBySegment(e){if(!(0,u.hey)(e))return;let{type:t,path:i,sourcePlatform:n}=e.material,r=this._mainDraftService.draftPathStore.getResourceKeyFromDraftPath(i),s=n===u.cvu.MaterialPlatformDefault;if(!r)return;let o={};if(t===u.cVg.MetaTypePhoto){o.type=s?c._g.UserPhoto:c._g.Photo;let t=s?this._resourceService.get(r,c._g.UserPhoto):this._resourceService.get(r,c._g.Photo);t&&(0,a.R)(t.value)&&(o.data={width:e.material.width,height:e.material.height,...t.value})}return o.type&&o.data?o:void 0}_markPerformance(e,t,i){if(0===t)this._performanceStatics.get(e)&&this._performanceStatics.delete(e),this._performanceStatics.set(e,{startTime:i,endTime:i});else{let t=this._performanceStatics.get(e);t&&this._performanceStatics.set(e,{startTime:t.startTime,endTime:i})}}_reportApplyResult(e){let{material:t,mutableId:i,ratio:n,status:r,failedReason:a}=e;r===_.rK.Success&&this._mainDraftService.draftTemplateManager.updateDraftChangedSummary(this._getDraftId(),{is_smart_crop:!0});let s={status:r};if(a&&(s.failReason=a),t){var o,l;(0,g.cC)(t)?s.materialFormat=null!==(o=t.mime)&&void 0!==o?o:"":(0,g.ri)(t)&&(s.materialFormat=null!==(l=t.format)&&void 0!==l?l:""),(0,g.sW)(t)&&(s.materialResolution=(0,g.sl)(t.width,t.height).join(":"))}if(i){let e=this._performanceStatics.get(i);s.time=e?e.endTime-e.startTime:0}else s.time=0;n&&(s.cropResolution=n.join(":")),(0,_.vV)(this._containerService,s)}constructor(e,t,i,n,r,a,s,o,l){this._dataSdk=e,this._segmentSelection=t,this._renderManager=i,this._mainDraftService=n,this._subjectCropDataService=r,this._containerService=a,this._resourceService=s,this._draftMaterialsService=o,this._reportService=l,this.subjectCropResults={},this._performanceStatics=new Map,this._reportEventName="subject-crop",this._store=new S.B}}y=(0,n.gn)([(0,n.fM)(3,m.n),(0,n.fM)(4,s.Z),(0,n.fM)(5,o.t),(0,n.fM)(6,l.c),(0,n.fM)(7,T.D),(0,n.fM)(8,d.m),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===h.zo?Object:h.zo,void 0===m.n?Object:m.n,void 0===s.Z?Object:s.Z,void 0===o.t?Object:o.t,void 0===l.c?Object:l.c,void 0===T.D?Object:T.D,void 0===d.m?Object:d.m])],y)},450013:function(e,t,i){i.d(t,{P:function(){return r}});var n=i(953211);class r{_refreshRelationGroupColorMap(e){let t=(0,n.r)(e);this._store.setRelationGroupColorMap(t)}_syncSelection(e){let{segmentIds:t}=e.selectedData;this._store.setSelectedSegmentIds(t)}constructor(e,t,i){this._store=e,this._selection=t,this._segmentSelection=i,this._selection.onChange(this._syncSelection.bind(this)),this._segmentSelection.onRelationVideoGroupChange(this._refreshRelationGroupColorMap.bind(this))}}},886407:function(e,t,i){i.d(t,{q:function(){return o}});var n=i(402655),r=i(609962),a=i(224986),s=i(254336);class o extends n.JT{_observeSlotTokenStart(e){e.forEach(e=>{let{token:t}=e;if(t){var i,n;let{mutableId:a,cancelable:s}=t.meta;this._mutableStatusStore.setMutableStatusInfo(a,{status:null!==(n=null===(i=e.token)||void 0===i?void 0:i.status)&&void 0!==n?n:r.a.IDLE,cancelable:!!s})}e.onDidStartToken(t=>{let{meta:i}=t,{mutableId:n,cancelable:a}=i;if(n){var s,o;this._mutableStatusStore.setMutableStatusInfo(n,{status:null!==(o=null===(s=e.token)||void 0===s?void 0:s.status)&&void 0!==o?o:r.a.IDLE,cancelable:!!a}),null==t||t.onStatusChange(e=>{this._mutableStatusStore.updateMutableStatus(n,e)}),null==t||t.onCancelableChange(e=>{this._mutableStatusStore.updateMutableCancelable(n,e)})}})})}uploadFile(e,t){return(0,a.F)({mutableId:e,file:t,dataSdk:this._dataSdk,fileUploaderManager:this._fileUploadManager,position:s.cg.SLOTS,subDraftId:this._segmentSelection.subDraftId,subTemplateId:this._segmentSelection.subDraftTemplateId})}cancelUploadTask(e){let t=this._mutableReplaceTaskManager.get(e);if(null==t?void 0:t.token){var i,n;null===(i=(n=t.token).cancel)||void 0===i||i.call(n)}}retryUploadTask(e){let t=this._mutableReplaceTaskManager.get(e);if(null==t?void 0:t.token){var i,n;null===(i=(n=t.token).retry)||void 0===i||i.call(n)}}constructor(e,t,i,n,r){super(),this._dataSdk=e,this._mutableStatusStore=t,this._mutableReplaceTaskManager=i,this._fileUploadManager=n,this._segmentSelection=r,this._observeSlotTokenStart(this._mutableReplaceTaskManager.allSlots),this._mutableReplaceTaskManager.onMutableReplaceTaskAdd(e=>{this._observeSlotTokenStart([e])})}}},999943:function(e,t,i){i.d(t,{A:function(){return a}});var n=i(953211),r=i(260963);class a{get tracksMutable(){return this._timelineUITracksObservableData.tracksMutable}get flattedSegments(){return(0,n.b)(this.tracksMutable)}get MutableVideos(){return this._segmentSelectionObservableData.mutableVideos}get relationGroupColorMap(){return this._relationGroupColorMap}get selectedSegmentIds(){return this._selectedSegmentIds}get activeRelationGroup(){return this._activeRelationGroup}get relationGroupActiveType(){return this._relationGroupActiveType}get autoReplaceDisplay(){return this._autoReplaceDisplay}setRelationGroupColorMap(e){this._relationGroupColorMap=e}setSelectedSegmentIds(e){this._selectedSegmentIds=e}setActiveRelationGroup(e){this._activeRelationGroup=e}setRelationGroupActiveType(e){this._relationGroupActiveType=e}setAutoReplaceDisplay(e){this._autoReplaceDisplay=e}constructor(e,t){this._timelineUITracksObservableData=e,this._segmentSelectionObservableData=t,this._relationGroupColorMap={},this._activeRelationGroup=void 0,this._relationGroupActiveType=void 0,this._selectedSegmentIds=[],this._autoReplaceDisplay=void 0,(0,r.ky)(this)}}},166070:function(e,t,i){i.d(t,{Z:function(){return u}});var n=i(772322),r=i(246685),a=i(670933),s=i(141913),o=i(218571),l=i(584952);let d=(0,s.PS)(()=>i.e("2422").then(i.bind(i,13538)).then(e=>{let{LoadingMask:t}=e;return{default:t}})),c=e=>{let{shouldShowMask:t,store:i}=e;return t?(0,n.jsx)(d,{shouldShowMask:t,store:i}):null},u=(0,a.Pi)(e=>{let{store:t,isFromThirdPartyPlatform:i,setMaskVisibility:a}=e,{hasLoadedVideo:d,allLoaded:u}=t,h=!d;return(0,o.useEffect)(()=>{a(i&&(h||!u))},[h,i,u]),i?(0,n.jsxs)(n.Fragment,{children:[h?(0,n.jsx)("div",{className:r.Z.thirdPlatformPureMaskWrapper,children:(0,n.jsx)(s.Xf,{fallback:null,children:(0,n.jsx)(c,{store:t,shouldShowMask:h})})}):null,u?null:(0,n.jsx)(l.h,{store:t})]}):null})},652148:function(e,t,i){i.d(t,{S:function(){return o}});var n=i(801497),r=i(818398),a=i.n(r),s=i(251266);class o{_getCurrentProgress(){return this.progress<this.total&&(this.progress+=.1*Math.random()),this.progress>=1?.999:this.progress}async fetchPackageInfo(e){let{onProgress:t}=e,{content_md5:i}=await this.createTask(e.thirdPartyDraftId)||{},n=this._getCurrentProgress();return null==t||t(n),this.pollPackage({onProgress:e.onProgress,content_md5:i})}formatResultData(e){var t,i;let n,r;let{material_list:s,preload:o}=null!=e?e:{};try{n=a().parse(s||"[]")}catch(e){}try{r=a().parse(o||"{}")}catch(e){}return{...e,sourcePathMap:e.source_path_map,template:e.draft,resourceInfos:{onlineResourceList:n},preloadResources:{materials:null!==(t=r.avs)&&void 0!==t?t:null,effects:null!==(i=r.effects)&&void 0!==i?i:null}}}pollPackage(e){let{onProgress:t,content_md5:i}=e;return new Promise((e,n)=>{let r=async()=>{try{let a=await this.fetchPackageAPI(i);if(a.data.status===s.Xp.success){null==t||t(this.total),clearInterval(this.intervalId),this.progress=0,e(this.formatResultData(a.data));return}if(a.data.status===s.Xp.fail){clearInterval(this.intervalId),this.progress=0,n(Error("fetch package error"));return}this.intervalId=setTimeout(()=>{r()},2e3);let o=this._getCurrentProgress();null==t||t(o)}catch(e){n(e)}};r()})}async fetchPackageAPI(e){let t=await this._textToVideoDataService.getTextToVideoPackageInfo({lang:n.ZP.language,content_md5:e});if(t.ok)return t.value;throw Error(t.msg)}async createTask(e){let t=await this._textToVideoDataService.createTextToVideoTask({content_md5:e});if(t.ok)return t.value.data;throw Error(t.msg)}constructor(e,t){this._textToVideoDataService=e,this._videoConfigurationService=t,this.total=1,this.progress=0}}},660228:function(e,t,i){i.d(t,{$i:function(){return s},Ik:function(){return o},Kq:function(){return l},SD:function(){return d}});var n=i(40142),r=i(451536);let a=e=>{try{var t;let i=decodeURI(e);if(e===i)return e;return t=i,unescape(t.replace(/\\(u[0-9a-fA-F]{4})/gm,"%$1"))}catch(t){return e}},s=()=>{let{searchParams:e}=new URL(a(window.location.href));return e.get(n.D.thirdPartDraftId)},o=()=>{let{searchParams:e}=new URL(a(window.location.href));return e.get(n.D.thirdPartPlatform)},l=()=>{(0,r.K9)(["noSSR",n.D.thirdPartDraftId,n.D.thirdPartPlatform])},d=()=>{var e,t,i,n;let{searchParams:r}=new URL(a(window.location.href));return{medium:(null===(e=r.get("utm_medium"))||void 0===e?void 0:e.toLowerCase())||null,campaign:(null===(t=r.get("utm_campaign"))||void 0===t?void 0:t.toLowerCase())||null,source:(null===(i=r.get("utm_source"))||void 0===i?void 0:i.toLowerCase())||null,content:(null===(n=r.get("utm_content"))||void 0===n?void 0:n.toLowerCase())||null}}},422404:function(e,t,i){i.d(t,{D:function(){return r}});var n,r=((n={}).NORMAL="normal",n.BEAT="beat",n.MUTABLE_AUDIO="mutableAudio",n.KEYFRAME="keyframe",n)},996442:function(e,t,i){i.d(t,{Z:()=>B});var n=i("733730"),r=i("638361"),a=i("690674"),s=i("798780"),o=i("441181");let l=class e{reset(){this._dirtyData=[]}markDirty(e){this._dirtyData=[...e]}executeClean(){this._dirtyData.length&&(this.context.uiUpdater.batchUpdateStyle(this._dirtyData.map(e=>{let{id:t,start:i}=e;return{id:t,x:this.context.unit.us2px(i)}})),this._dirtyData=[])}constructor(e){this._dirtyData=[],this.context=e}};var d=i("509955"),c=i("789786"),u=i("892230"),h=i("72127"),g=i("260963");class m{get forceOuter(){var e,t,i,n;return(null===(i=this._context)||void 0===i?void 0:null===(t=i.store)||void 0===t?void 0:null===(e=t.uiSegments[0])||void 0===e?void 0:e.type)==="video"&&this._context.store.isTemplate||!!(null===(n=this._context)||void 0===n?void 0:n.store.expandedSegmentId)}get $current(){return this.forceOuter?this.$outer:"inner"===this.side||"update"===this._context.store.dragType?this.$inner:this.$outer}stuff(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inner",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{left:0,top:0},r=arguments.length>4?arguments[4]:void 0;this.$inner=(0,h.R0)(e,!1,r),this.$outer=t?(0,h.R0)(t,!0,r):void 0,this._side=i,this._outerOffset=n}join(e){e&&(this._side=e),this._state="init"}free(){this.showSnapshot=!1,this._state="none",this.$outer&&(0,h.LW)(this.$outer,"[EnclaveDrag#free] remove $outer"),this.$inner&&(0,h.LW)(this.$inner,"[EnclaveDrag#free] remove $inner")}reset(){for(let e of(this.showSnapshot=!1,this._side="outer",this.$outer=void 0,this.$inner=void 0,this._outerOffset={left:0,top:0},Array.from(document.getElementsByClassName("track-drag-container"))))(0,h.LW)(e,"remove unrelated drag container failed!")}stage(e){this._side=e}pass(){this.style({opacity:"0.8"})}unpass(){this.style({opacity:"1"})}style(e){let t=this.$current;if(!!t)Object.keys(e).forEach(i=>{let n=e[i];t.style[i]=n})}move(){if("update"===this._context.store.dragType){this._updateMoveLocation();return}if(!!this.$current&&"none"!==this._context.store.dragState){if("inner"===this.side){if(void 0===this._context.reference.trElement||void 0===this._context.mouse.fElement)return;this.forceOuter?this._context.mouse.fixed&&this._move(this._context.mouse.fixed):this._move({x:this._context.unit.relative2fixed({x:this._context.unit.us2px(this._context.reference.trElement),y:-1}).x,y:this._context.mouse.fElement.y})}else{if(!this._context.mouse.fixed)return;"insert"===this._context.store.dragType&&this._move(this._context.mouse.fixed)}this._state="posed"}}_migratePosition(e){if(e&&this.$current&&!this.forceOuter){let t,i;"inner"===this.side?(t=e.style.top,i=e.style.left):(t=(0,h.GK)(e.style.top,this._outerOffset.top),i=(0,h.GK)(e.style.left,this._outerOffset.left)),this.$current.style.top=t,this.$current.style.left=i}}_getSnapshotLocation(){var e,t;let{mouse:i,reference:n,unit:r,store:a}=this._context;if(void 0===n.trElement||void 0===i.fElement)return;let{x:s}=this._context.unit.relative2fixed({x:r.us2px(n.trElement),y:-1}),{y:o}=i.fElement,l=null!==(e=window.scrollX)&&void 0!==e?e:0,d=null!==(t=window.scrollY)&&void 0!==t?t:0,{left:c,top:u}=a.container.parentElement.getBoundingClientRect();return{x:s-l-c,y:o-d-u}}_updateMoveLocation(){let e=this._getSnapshotLocation();e&&"inner"===this.side&&(this.moveLocation=e,this.showSnapshot=!0)}_move(e){var t,i;let n,r,{x:a,y:s}=e;if(!this.$current)return;let o=null!==(t=window.scrollX)&&void 0!==t?t:0,l=null!==(i=window.scrollY)&&void 0!==i?i:0;"inner"!==this.side||this.forceOuter?(n=s-this._outerOffset.top-l,r=a-this._outerOffset.left-o):(n=s-l,r=a-o),this.style({top:`${n}px`,left:`${r}px`})}constructor(e){this._context=e,this.$outer=void 0,this.$inner=void 0,this.moveLocation={x:0,y:0},this.showSnapshot=!1,this._side="outer",this.side="outer",this._state="none",this._outerOffset={left:0,top:0},this.judgeSide=e=>{let t="outer";if(this._context.store.container){var i,n,r,a;let s=this._context.store.container.getBoundingClientRect(),o=e.x+(null!==(i=window.scrollX)&&void 0!==i?i:0),l=e.y+(null!==(n=window.scrollY)&&void 0!==n?n:0),d=s.x+this._context.store.operationWidth+(null!==(r=window.scrollX)&&void 0!==r?r:0),c=d+s.width,h=s.y+(null!==(a=window.scrollY)&&void 0!==a?a:0),g=h+s.height;s&&(t=(0,u.mK)(o,[d,c])&&(0,u.mK)(l,[h,g])?"inner":"outer",this._side=t)}return t},this._switchElement=()=>{let e="outer"===this.side?this.$inner:this.$outer;e&&(0,h.LW)(e,`[EnclaveDrag#_switchElement] remove when change to ${this.side}`),this.$current&&(this._migratePosition(e),"posed"===this._state&&document.body.appendChild(this.$current))},this._insertIfNeed=e=>{"posed"===e&&this.$current&&document.body.appendChild(this.$current)},(0,g.ky)(this),(0,g.U5)(()=>this.side,this._switchElement),(0,g.U5)(()=>this._state,this._insertIfNeed),(0,g.U5)(()=>`${this._side}_${this._context.registry.territory.side}`,()=>{this.side="outer"===this._side&&"outer"===this._context.registry.territory.side?"outer":"inner"})}}(0,c.gn)([g.LO,(0,c.w6)("design:type","undefined"==typeof HTMLElement?Object:HTMLElement)],m.prototype,"$outer",void 0),(0,c.gn)([g.LO,(0,c.w6)("design:type","undefined"==typeof HTMLElement?Object:HTMLElement)],m.prototype,"$inner",void 0),(0,c.gn)([g.LO,(0,c.w6)("design:type","undefined"==typeof Location?Object:Location)],m.prototype,"moveLocation",void 0),(0,c.gn)([g.LO,(0,c.w6)("design:type","undefined"==typeof EnclaveDragSide?Object:EnclaveDragSide)],m.prototype,"_side",void 0),(0,c.gn)([g.LO,(0,c.w6)("design:type","undefined"==typeof EnclaveDragState?Object:EnclaveDragState)],m.prototype,"_state",void 0),(0,c.gn)([g.LO,(0,c.w6)("design:type",Object)],m.prototype,"_outerOffset",void 0);var f=i("362220"),p=i("276513"),_=i("426336"),v=i("10753"),S=i("998588"),T=i("821768"),M=i("843168"),y=i("763832");class k extends M.J{static CmpTierBlock(e,t){let i=e.fixedTL.y-t.fixedTL.y;if(0!==i)return i;let n=e.fixedTL.x-t.fixedTL.x;if(0!==n)return n;let r=e.fixedBR.y-t.fixedBR.y;if(0!==r)return r;let a=e.fixedBR.x-t.fixedBR.x;return 0!==a?a:0}establish(){var e,t;if(this.context.store.container){let{x:e,y:t}=this.context.store.container.getBoundingClientRect();this._containerTL={x:e,y:t}}this._$$containerResizeDisposer=new ResizeObserver(this._refreshContainerSize),window.addEventListener("scroll",this._refreshContainerSize),null===(e=document.querySelector("body"))||void 0===e||e.addEventListener("scroll",this._refreshContainerSize),window.addEventListener("resize",this._refreshContainerSize),this.context.store.container&&this._$$containerResizeDisposer.observe(this.context.store.container),null===(t=this.context.store.container)||void 0===t||t.addEventListener("scroll",this._refreshContainerSize),this._$reactionDisposerZoom=(0,g.U5)(()=>this.context.store.zoom,this._refreshContainerSize),this._refreshContainerSize()}relinquish(){var e,t,i;null===(e=this._$reactionDisposerZoom)||void 0===e||e.call(this),null===(t=this.context.store.container)||void 0===t||t.removeEventListener("scroll",this._refreshContainerSize),window.removeEventListener("resize",this._refreshContainerSize),window.removeEventListener("scroll",this._refreshContainerSize),null===(i=this._$$containerResizeDisposer)||void 0===i||i.disconnect(),this._$$containerResizeDisposer=void 0}register(e){this._tiers.push({...e,...this._calcFixedBlockPosition(e)}),this._tiers.sort(k.CmpTierBlock),setTimeout(()=>{let t=this._calcFixedBlockPosition(e);this.update({id:e.id,...t})},300)}unregister(e){let t=[],i=this._tiers.findIndex(t=>t.id===e);return i>-1&&t.push(...this._tiers.splice(i,1)),t}update(e){let t=this._tiers.find(t=>t.id===e.id),i=!1;if(t)for(let[n,r]of Object.entries(e))r&&(t[n]=r,i=!0);i&&this._tiers.sort(k.CmpTierBlock)}lbs(e){return this._tiers.find((t,i)=>{let{refEl:n}=t;if(!n.current)return!1;let{x:r,y:a,width:s,height:o}=n.current.getBoundingClientRect();return(0,u.mK)(e.x,[r,r+s])&&(0,u.mK)(e.y,[a,a+o])})}findById(e){let t=this._tiers.findIndex(t=>t.id===e);return[this._tiers[t],t]}_calcFixedBlockPosition(e){if(!e.refEl.current)return{fixedTL:{x:-1,y:-1},fixedBR:{x:-1,y:-1}};{let{x:t,y:i,width:n,height:r}=e.refEl.current.getBoundingClientRect(),a=t+this._screenLeft,s=i+this._screenTop;return{fixedTL:{x:a,y:s},fixedBR:{x:a+n,y:s+r}}}}constructor(...e){super(...e),this._screenLeft=0,this._screenTop=0,this._tiers=[],this._containerTL={x:-1,y:-1},this.refreshBlockPosition=async()=>{for(let e of(await (0,y._)(300),this._tiers)){let t=this._calcFixedBlockPosition(e);Object.assign(e,t)}},this._refreshContainerSize=(0,p.Z)(()=>{this._screenTop=window.scrollY,this._screenLeft=window.scrollX,this.refreshBlockPosition()},100)}}class x extends M.J{static CmpPlaceholder(e,t){let i=e.fixedTL.y-t.fixedTL.y;if(0!==i)return i;let n=e.fixedTL.x-t.fixedTL.x;if(0!==n)return n;let r=e.fixedBR.y-t.fixedBR.y;if(0!==r)return r;let a=e.fixedBR.x-t.fixedBR.x;return 0!==a?a:0}get entities(){return[...this._placeholders]}establish(){var e,t;this._$$containerResizeDisposer=new ResizeObserver(this._refreshContainerSize),window.addEventListener("scroll",this._refreshContainerSize),null===(e=document.querySelector("body"))||void 0===e||e.addEventListener("scroll",this._refreshContainerSize),window.addEventListener("resize",this._refreshContainerSize),this.context.store.container&&this._$$containerResizeDisposer.observe(this.context.store.container),null===(t=this.context.store.container)||void 0===t||t.addEventListener("scroll",this._refreshContainerSize),this._$reactionDisposerZoom=(0,g.U5)(()=>this.context.store.zoom,this._refreshContainerSize),this._refreshContainerSize()}relinquish(){var e,t,i;null===(e=this._$reactionDisposerZoom)||void 0===e||e.call(this),null===(t=this.context.store.container)||void 0===t||t.removeEventListener("scroll",this._refreshContainerSize),window.removeEventListener("resize",this._refreshContainerSize),window.removeEventListener("scroll",this._refreshContainerSize),null===(i=this._$$containerResizeDisposer)||void 0===i||i.disconnect(),this._$$containerResizeDisposer=void 0}register(e){this._placeholders.push({...e,...this._calcFixedBlockPosition(e)}),this._placeholders.sort(x.CmpPlaceholder),setTimeout(()=>{let t=this._calcFixedBlockPosition(e);this.update({id:e.id,...t})},300)}unregister(e){let t=[],i=this._placeholders.findIndex(t=>t.id===e);return i>-1&&t.push(...this._placeholders.splice(i,1)),t}update(e){let t=this._placeholders.find(t=>t.id===e.id),i=!1;if(t)for(let[n,r]of Object.entries(e))r&&(t[n]=r,i=!0);i&&this._placeholders.sort(x.CmpPlaceholder)}lbs(e){return this._placeholders.find((t,i)=>{let{fixedTL:n,fixedBR:r}=t;return(0,u.mK)(e.x,[n.x,r.x])&&(0,u.mK)(e.y,[n.y,r.y])})}findById(e){let t=this._placeholders.findIndex(t=>t.id===e);return[this._placeholders[t],t]}_calcFixedBlockPosition(e){let{refEl:t}=e,i=t.current;if(i){let{x:e,y:t,width:n,height:r}=i.getBoundingClientRect(),a=e+this._screenLeft,s=t+this._screenTop;return{fixedTL:{x:a,y:s},fixedBR:{x:a+n,y:s+r}}}if("object"!=typeof t)return{fixedTL:{x:-1,y:-1},fixedBR:{x:-1,y:-1}};{let e=document.querySelector(".timeline-large-container");if(!e)return{fixedTL:{x:-1,y:-1},fixedBR:{x:-1,y:-1}};let i=e.getBoundingClientRect(),{x:n,y:r,width:a,height:s}=t,o=n+this._screenLeft+i.x,l=r+this._screenTop+i.y;return{fixedTL:{x:o,y:l},fixedBR:{x:o+a,y:l+s}}}}constructor(...e){super(...e),this._screenLeft=0,this._screenTop=0,this._placeholders=[],this.refreshBlockPosition=async()=>{for(let e of(await (0,y._)(300),this._placeholders)){let t=this._calcFixedBlockPosition(e);Object.assign(e,t)}},this._refreshContainerSize=(0,p.Z)(()=>{this._screenTop=window.scrollY,this._screenLeft=window.scrollX,this.refreshBlockPosition()},100)}}class I extends M.J{get side(){return this._territories.some(e=>"inner"===e.side)?"inner":"outer"}register(e){let t=()=>{let t=this._territories.find(t=>t.id===e.id);t&&(0,g.z)(()=>t.side="inner")},i=()=>{let t=this._territories.find(t=>t.id===e.id);t&&(0,g.z)(()=>t.side="outer")},n=(0,p.Z)(()=>{let t=this._territories.find(t=>t.id===e.id);t&&"inner"!==t.side&&(0,g.z)(()=>t.side="inner")},20,{leading:!0});e.refEl.current&&(e.refEl.current.addEventListener("mouseenter",t),e.refEl.current.addEventListener("mouseleave",i),e.refEl.current.addEventListener("mousemove",n)),this._territories.push({...e,onMouseEnter:t,onMouseLeave:i,onMouseMove:n,side:"outer"})}unregister(e){let t=[],i=this._territories.findIndex(t=>t.id===e);if(i>-1){var n,r;null===(n=this._territories[i].refEl.current)||void 0===n||n.removeEventListener("mouseenter",this._territories[i].onMouseEnter),null===(r=this._territories[i].refEl.current)||void 0===r||r.removeEventListener("mouseleave",this._territories[i].onMouseLeave),t.push(...this._territories.splice(i,1))}return t}update(e){let t=this._territories.find(t=>t.id===e.id);if(!!t){for(let[l,d]of Object.entries(e))if(d){var i,n,r,a,s,o;"refEl"===l&&(null===(i=t.refEl.current)||void 0===i||i.removeEventListener("mouseenter",t.onMouseEnter),null===(n=t.refEl.current)||void 0===n||n.removeEventListener("mouseleave",t.onMouseLeave),null===(r=t.refEl.current)||void 0===r||r.removeEventListener("mousemove",t.onMouseMove)),t[l]=d,"refEl"===l&&(null===(a=t.refEl.current)||void 0===a||a.addEventListener("mouseenter",t.onMouseEnter),null===(s=t.refEl.current)||void 0===s||s.addEventListener("mouseleave",t.onMouseLeave),null===(o=t.refEl.current)||void 0===o||o.addEventListener("mousemove",t.onMouseMove),t.side="outer")}}}constructor(...e){super(...e),this._territories=[]}}var D=i("112825"),b=i("257296"),E=i("799985");function C(e,t,i){var n;let{keyframeInfos:r,isVideoTrack:a}=null!=i?i:{},{x:s,y:o}=e,l=t.y+t.height/2,d=b.je.height/2,c=t.x,h=t.x+b.je.width+b.iX,g=t.x+t.width,m=g-b.iX-b.je.width;if(!(0,u.mK)(e.y,[l-d,l+d])){let e=(0,E.dn)({transitionStartX:c+4,transitionEndX:g-4,posX:s,areaWidth:4});return{positionType:"middle",extra:{transitionAddArea:a?e:void 0}}}let f=b.iX;if((0,u.mK)(e.x,[a?c+f:c,h]))return{positionType:"edge-front"};if((0,u.mK)(e.x,[m,a?g-f:g]))return{positionType:"edge-rear"};let p=null==r?void 0:null===(n=r.reverse())||void 0===n?void 0:n.find(e=>{let{x:t,y:i,height:n,width:r}=e.refEl;return(0,u.mK)(o,[i-n/2,i+n/2])&&(0,u.mK)(s,[t-r/2,t+r/2])});if(p)return{positionType:"keyframe",extra:{keyframeValue:null==p?void 0:p.value}};let _=(0,E.dn)({transitionStartX:c+f,transitionEndX:g-f,posX:s,areaWidth:f});return{positionType:"middle",extra:{transitionAddArea:a?_:void 0,isHoverTransitionBtn:a&&!!_}}}let w=class e{establish(){this.tier.establish(),this.placeholder.establish()}relinquish(){this.placeholder.establish(),this.tier.establish(),this.deferRefreshReference.cancel()}registerAll(e,t,i){this.track.register(e),this.segment.register(t),this.transition.register(i),this.updateToReference()}unregisterSegments(e){let t=[...this.transition.unregister(e),...this.segment.unregister(e)];return this.updateToReference(),t}replaceSegmentsAndTransitions(e,t){this.segment.replace(e),this.transition.replace(t),this.updateToReference()}updateToReference(){let e=[0n];this.segment.entities.forEach(t=>{var i;e.push(t.start,t.start+t.duration,...null!==(i=t.refTimes)&&void 0!==i?i:[])}),this.transition.entities.forEach(t=>{e.push(t.start,t.start+t.duration)}),this._context.reference.addAllTimes(e)}showAddTransitionBtn(e,t){let i,{transition:n}=e;if(void 0===t||"video"!==(i=e).type&&"combination"!==i.type)return!1;let{id:r}=e,[a]=this.segment.findById(r),s=this.segment.findPrev(r),o=this.segment.findNext(r);if("pre"===t){let t;if(!a||!s||"video"!==(t=s).type&&"combination"!==t.type||s.transition)return!1;if(s.start+s.duration===a.start)return this.showTransitionAddBtn({preSegId:s.id,nextSegId:a.id,segmentRegisterInfo:e}),!0}else if("next"===t){let t;if(!a||!o||"video"!==(t=o).type&&"combination"!==t.type||n)return!1;if(a.start+a.duration===o.start)return this.showTransitionAddBtn({preSegId:a.id,nextSegId:o.id,segmentRegisterInfo:e}),!0}return!1}showTransitionAddBtn(e){this._context.event.emit(D.B.showTransitionAddBtn,e)}hiddenTransitionAddBtn(){this._context.event.emit(D.B.showTransitionAddBtn,!1)}triggerTransitionAddBtn(e,t){if(this._context.situation.crop.cropSide)return;let{transitionAddArea:i,isHoverTransitionBtn:n}=null!=t?t:{},r=this.showAddTransitionBtn(e,i);n&&r?document.body.style.cursor="pointer":document.body.style.cursor="default",!r&&this.hiddenTransitionAddBtn()}lbs(e){let{x:t,y:i}=e,n=this.track.find(e=>(0,u.mK)(i,[e.startY,e.endY]));if(!n)return this.hiddenTransitionAddBtn(),{};let r=n.type===_.pNd.TrackTypeVideo;for(let e of this._context.store.uiSegments){let[a]=this.segment.findById(e.id);if(a){let{keyframeInfos:e,refEl:s}=a,{positionType:o,extra:l}=C({x:t,y:i},s,{keyframeInfos:e,isVideoTrack:r});if("middle"!==o)return this.hiddenTransitionAddBtn(),{track:n,segment:a,positionType:o,extra:l}}}let a=this.transition.findByTrack(n.id).find(e=>{let i=this._context.unit.us2px(e.start),n=this._context.unit.us2px(e.start+e.duration);return(0,u.mK)(t,[i,n])});if(a)return{track:n,transition:a,positionType:C({x:t,y:i},a.refEl).positionType};let s=this.segment.findByTrack(n.id).find(e=>(0,u.mK)(t,[this._context.unit.us2px(e.start),this._context.unit.us2px(e.start+e.duration)]));if(!s)return this.hiddenTransitionAddBtn(),{};let{positionType:o,extra:l}=C({x:t,y:i},s.refEl,{isVideoTrack:r});return this.triggerTransitionAddBtn(s,l),{track:n,segment:s,positionType:o}}findSegmentsAndTransitionsByRange(e,t){let i=this.transition.findByTrack(e).filter(e=>{let i=this._context.unit.us2px(e.start),n=this._context.unit.us2px(e.start+e.duration);return(0,u.mK)(i,t)||(0,u.mK)(n,t)||(0,u.mK)(t[0],[i,n])||(0,u.mK)(t[1],[i,n])});return{transitions:i,segments:this.segment.findByTrack(e).filter(e=>{let i=this._context.unit.us2px(e.start),n=this._context.unit.us2px(e.start+e.duration);return(0,u.mK)(i,t)||(0,u.mK)(n,t)||(0,u.mK)(t[0],[i,n])||(0,u.mK)(t[1],[i,n])})}}findAllSegmentsAndTransitionsByRect(e){let{start:t,end:i}=e;return this.track.findByRange([t.y,i.y]).reduce((e,n)=>{let r=this.findSegmentsAndTransitionsByRange(n.id,[t.x,i.x]);return e.segements.push(...r.segments),e.transitions.push(...r.transitions),e},{transitions:[],segements:[]})}getBoundingClientRect(e,t){let i;let n=document.querySelector(".timeline-large-container");if(!n)return null;let r=n.getBoundingClientRect();if("track"===t?[i]=this.track.findById(e):[i]=this.segment.findById(e),!i){var a;let[t]=this.placeholder.findById(e);if(void 0!==(null==t?void 0:null===(a=t.refEl)||void 0===a?void 0:a.current))return null;i=t}if(!i)return null;let s=r.left+i.refEl.x,o=r.top+i.refEl.y;return{width:i.refEl.width,height:i.refEl.height,left:s,x:s,right:r.left+i.refEl.x+i.refEl.width,top:o,y:o,bottom:r.top+i.refEl.y+i.refEl.height}}constructor(e){this._context=e,this.deferRefreshReference=(0,p.Z)(this.updateToReference.bind(this),200),this.track=new v.P(e),this.segment=new S.E(e),this.transition=new T.c(e),this.tier=new k(e),this.placeholder=new x(e),this.territory=new I(e)}};var N=i("3752"),A=i("928261"),j=i("140041");let O=class e{get _disable(){return this.context.situation.dragMulti.isReflexToMain||!this.context.mouse.rElement||!this.context.store.switches.adsorb||(0,A.Xe)(this.context.store.targetSegment)}get rElement(){var e;return null!==(e=this._rElement)&&void 0!==e?e:this.context.mouse.rElement}get trElement(){var e;return null!==(e=this._trElement)&&void 0!==e?e:this.context.situation.dragMulti.limitTrElement}get timeRound(){var e;return null!==(e=this._timeRound)&&void 0!==e?e:this.context.mouse.timeRound}establish(){var e;let t=null===(e=this.context.store.container)||void 0===e?void 0:e.parentElement;this.$dom.appendTo(t),this.$domOptional.appendTo(t)}relinquish(){this.$dom.removeFrom(this.context.store.container),this.$domOptional.removeFrom(this.context.store.container)}addAllTimes(e){this._times=e,this._times.sort((e,t)=>_.pMA.minus(e,t)),this.calculate()}reset(){this._rElement=void 0,this._trElement=void 0,this._timeRound=void 0,this._skips=[],this.$dom.hide(),this.$domOptional.hide(),this._darkenCursor()}calculate(){this._lines=this._times.map(e=>this.context.unit.us2px(e))}skipForCrop(){if((0,A.IM)(this.context.store.targetSegment)){let e=this.context.unit.us2px(this.context.store.targetSegment.start),t=this.context.unit.us2px(this.context.store.targetSegment.start+this.context.store.targetSegment.duration);this.skip([e,t])}else this.skip([])}skip(e){this._skips=[...e]}adsorb(){if(this._disable)return this._rElement=void 0,this._trElement=void 0,this._timeRound=void 0,this._showOrHide(),!1;{let{x:e}=this.context.mouse.rElement,{begin:t}=this._adsorb(e);this._rElement={x:t,y:this.context.mouse.rElement.y};let i=!1,n=this.context.situation.dragMulti.limitTrElement,r=this.context.unit.us2px(n),{begin:a,beginUs:s,line:o,lineOptional:l}=this._adsorb(r,!0);this._trElement=null!=s?s:this.context.unit.px2us(a),i=String(r)!==String(a);let d=this.context.mouse.timeRound,{begin:c}=this._adsorb(this.context.unit.us2px(d));return this._timeRound=this.context.unit.px2us(c),this.context.situation.crop.isCropToEnd||this.context.situation.crop.iscropToBegin?this._showOrHide():this._showOrHide(o,l),i}}adsorbX(e){return this.findWithSkip(e)}findWithSkip(e){var t;let i=[...this._skips],n=null!==(t=this._lines[this._lines.length-1])&&void 0!==t?t:0;return this._lines[e>n/2?"findLast":"find"](t=>{if(!(Math.abs(t-e)<j.rx))return!1;{let e=i.indexOf(t);return -1===e||(i.splice(e,1),!1)}})}isAdsorbToCursor(e){let t=this.context.unit.us2px(this.context.store.progress);return Math.abs(t-e)<j.rx?t:void 0}_adsorb(e){let t,i,n,r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===(t=this.isAdsorbToCursor(e))&&(t=this.findWithSkip(e)),void 0!==t)i=null!=t?t:e,r=this._judgeOptionalTail(t);else{let r=this._adsorbTail(e);r?{begin:i,beginUs:n,line:t}=r:i=null!=t?t:e}if(a&&void 0===t){let n=this._absorbSide(!0);!n&&(n=this._absorbSide(!1)),n?{begin:i,line:t}=n:i=null!=t?t:e}return{begin:i,beginUs:n,line:t,lineOptional:r}}_getDragTail(e){if(!(["insert","update"].includes(this.context.store.dragType)&&(0,A.IM)(this.context.store.targetSegment)))return;let{duration:t}=this.context.store.targetSegment,{slots:i}=this.context.store.targetSegment,n=i.find(e=>"transition"===e.type);n&&(t+=_.pMA.div(n.duration,2,"bigint"));let r=this.context.unit.us2px(t);return{distance:r,distanceUs:t,end:e+r}}_adsorbTail(e){let t;let i=this._getDragTail(e);if(void 0===i)return;let{end:n,distance:r,distanceUs:a}=i;return(void 0===(t=this.isAdsorbToCursor(n))&&(t=this.findWithSkip(n)),void 0!==t)?{line:t,begin:t-r,beginUs:this.context.unit.px2us(t)-a}:void 0}_absorbSide(e){let{realTimeSideInfo:t,sideInfo:i}=this.context.situation.dragMulti;if(!t||!this.context.store.isMultiSelection||!i)return;let n=this.context.store.targetSegment.start,r=e?t.left:t.right,a=e?i.left-n:i.right-n,s=this.context.unit.us2px(a),o=this.context.unit.us2px(r),l=this.isAdsorbToCursor(o);if(!l&&(l=this.findWithSkip(o)),void 0!==l)return{line:l,begin:l-s}}_judgeOptionalTail(e){let t=this._getDragTail(e);if(void 0!==t)return this._lines.find(e=>1>Math.abs(e-t.end))}_showOrHide(e,t){if(void 0!==e){let i=this.context.unit.us2px(this.context.store.progress);e===i||t===i?(this.$dom.hide(),this.$domOptional.hide(),this._highlightCursor()):this._darkenCursor(),e!==i&&this.$dom.show({x:e+this.context.store.operationWidth-this.context.unit.scrollLeft,y:this.context.unit.scrollTop}),void 0!==t&&t!==i?this.$domOptional.show({x:t+this.context.store.operationWidth-this.context.unit.scrollLeft,y:this.context.unit.scrollTop}):this.$domOptional.hide()}else this.$dom.hide(),this.$domOptional.hide(),this._darkenCursor()}_highlightCursor(){this.context.event.emit(D.B.adsorbCursor,!0)}_darkenCursor(){this.context.event.emit(D.B.adsorbCursor,!1)}constructor(e){this._times=[],this._lines=[],this._skips=[],this.context=e,this.$dom=new N.Z(this.context),this.$domOptional=new N.Z(this.context)}};var L=i("510093"),P=i("281008"),R=i("283826"),U=i("818755"),z=i("431093");class B{resetDrag(){let e="insert"===this.store.dragType;this.enclaveDrag.reset(),this.store.resetDrag(),this.reference.reset(),this.valid.resetDrag(),this.mouse.reset(),this.dirty.reset(),this.cursor.reset(),this.flyover.reset(),this.situation.crop.reset(),this.situation.drag.reset(),this.situation.dragMulti.reset(),this.situation.timeline.reset(),this.userConfig.trigger.dragEnd(),e&&this.store.setUISegments(this.userConfig.store[a.qk].segmentSelected)}constructor(e){this.event=new n.Z,this.unit=new f.Z(this),this.registry=new w(this),this.reference=new O(this),this.valid=new L.Z(this),this.mouse=new P.Z(this),this.dirty=new l(this),this.cursor=new d.Z(this),this.situation=new R.Z(this),this.keyframeDrag=new U.Z(this),this.boxSelection=new r.C,this.enclaveDrag=new m(this),this.flyover=new z.Z(this),this.uiUpdater=new o.b(this),this.userConfig=e,this.store=new s.Z(this,e.store),this.store.setTemplateMode(e.store[a.U_].isTemplate)}}},682205:function(e,t,i){i.d(t,{Z:()=>m});var n=i("29188"),r=i("140041"),a=i("928261"),s=i("112825"),o=i("824951"),l=i("804497"),d=i("72127");function c(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let n={};Error.captureStackTrace(n),console.log(n,...t)}var u=i("65967"),h=i("426336"),g=i("632555");let m=class e{get cropStartTime(){return this._cropStartTime}get cropSide(){return this._cropSide}get cropSegment(){return this._cropSegment}cacheDragFrom(e){this._dragFrom=e}setCropSeg(e){this._cropSegment=e}reset(){this._cropSide=void 0,this._cropEdge=void 0,this._cacheCropStyle=void 0,this._dragFrom=void 0,this._cacheTransitionDuration=void 0,this._cropSegment=void 0,this._cropingInfo=void 0,this._lastCroping=void 0,this._cropStartTime=0}calculate(e){var t;if(this._cropSide=e,!this._context.store.isSingleSelection){c("[Coordinate#_calculateCropEdge] called when has no _uiSegment!");return}let i=this._findRegistered();if(!i){c("[Coordinate#_calculateCropEdge] cant find segment by ID!");return}this._cropEdge={left:i.start,right:i.start+i.duration,lastEnd:0n,nextStart:0n},i.prolongTotal&&i.prolongTotal>=BigInt(Number.MAX_SAFE_INTEGER)?this._cropEdge.left=-BigInt(Number.MAX_SAFE_INTEGER):i.prolongStart&&(this._cropEdge.left-=i.prolongStart),void 0!==i.prolongTotal&&void 0!==i.prolongDuration&&void 0!==i.prolongStart&&(this._cropEdge.right+=i.prolongTotal-i.prolongDuration-i.prolongStart);let[n]=this._context.registry.track.findById(i.trackId);if((0,l.zy)([n,null!==(t=null==n?void 0:n.index)&&void 0!==t?t:-1])){let e=this._context.registry.segment.findByTrack(n.id);e.sort((e,t)=>h.pMA.minus(e.start,t.start));let t=e.findIndex(e=>e.id===i.id);if(-1===t){c("[Coordinate#_calculateCropEdge] target not in sibSegments!");return}let r=0n;if(t>0&&(r=e[t-1].start+e[t-1].duration-e[0].start),this._cropEdge.left=h.pMA.max([this._cropEdge.left,r],"bigint"),this._cropEdge.lastEnd=t>0?e[t-1].start+e[t-1].duration:0n,this._cropEdge.nextStart=t+1<e.length?e[t+1].start:BigInt(Number.MAX_SAFE_INTEGER),"mutableAudio"===i.registeredType){let i=BigInt(Number.MIN_SAFE_INTEGER);t+1<e.length&&(i=e[t+1].start),this._cropEdge.right=h.pMA.min([this._cropEdge.right,i],"bigint")}}this._recordCropStyle()}calcCropingExpandInfo(e){var t,i,n;if(this._cropStartTime=Date.now(),"none"===this._context.store.dragState||!this._context.store.isSingleSelection||!this._cropEdge)return;let r=this._findRegistered();if(!r)return;let a="edge-front"===e?r.start:r.start+r.duration,s=void 0!==r.prolongTotal&&void 0!==r.prolongDuration&&void 0!==r.prolongStart&&r.prolongTotal!==BigInt(Number.MAX_SAFE_INTEGER),[o]=this._context.registry.track.findById(r.trackId);if((null==o?void 0:o.index)===0){if("edge-front"===e){let e=this._context.registry.segment.findPrev(r.id),i=0n;e&&(i=e.start+e.duration);let n=i,s=n+(null!==(t=r.prolongStart)&&void 0!==t?t:0n),o=s+r.duration;this._cropingInfo={edgeFirstTime:a,leftLimit:n,rightLimit:o,cropingCursor:s}}else{let e=r.start,t=r.start+r.duration,i=BigInt(Number.MAX_SAFE_INTEGER);s&&(i=r.start+(r.prolongTotal-r.prolongStart)),this._cropingInfo={edgeFirstTime:a,leftLimit:e,rightLimit:i,cropingCursor:t}}}else if("edge-front"===e){let e;let t=this._context.registry.segment.findPrev(r.id),o=t?t.start+t.duration:0n,l=this._context.registry.segment.findFirst(r.id),d=l?l.start:0n,c=r.start-(null!==(i=r.prolongStart)&&void 0!==i?i:0n),u=o-d;e=s?u>c?u:c:u;let h=c+(null!==(n=r.prolongStart)&&void 0!==n?n:0n),g=h+r.duration;this._cropingInfo={edgeFirstTime:a,leftLimit:e,rightLimit:g,cropingCursor:h}}else{let e=r.start,t=r.start+r.duration,i=s?r.start+(r.prolongTotal-r.prolongStart):BigInt(Number.MAX_SAFE_INTEGER);this._cropingInfo={edgeFirstTime:a,leftLimit:e,rightLimit:i,cropingCursor:t}}}getCropingSpeedInfo(){var e,t;let{lastUs:i,lastPx:n,lastTime:r}=null!==(t=this._lastCroping)&&void 0!==t?t:{},a=this._context.mouse.time,s=null===(e=this._context.mouse.fixed)||void 0===e?void 0:e.x,o=Date.now();if(void 0===a||void 0===s)return;if(void 0===i||void 0===n||void 0===r){this._lastCroping={lastUs:a,lastPx:s,lastTime:o};return}let l=o-r;if(0===l)return;let d=h.pMA.div(a-i,l),c=(s-n)/l;return this._lastCroping={lastUs:a,lastPx:s,lastTime:o},{durationSpeed:d,pxSpeed:c}}getCropingSeekInfo(){let e=this._context.mouse.time;if(!this._cropingInfo||void 0===e)return;let t=e-this._cropingInfo.edgeFirstTime,i=this._cropingInfo.cropingCursor+t;return i=h.pMA.max([i,this._cropingInfo.leftLimit],"bigint"),{seekTime:i=h.pMA.min([i,this._cropingInfo.rightLimit],"bigint"),leftLimit:this._cropingInfo.leftLimit,rightLimit:this._cropingInfo.rightLimit}}situation(){if("none"===this._context.store.dragState||!this._context.store.isSingleSelection||!this._cropEdge)return;let e=this._findRegistered();return(null==e?void 0:e.refEl)?(0,s.YP)(e)?this._situationBothSide(e):this._situationSingleSide(e):void 0}reflexInspect(e){if(!e)return;let t=this._findRegistered(e);if(!(null==t?void 0:t.refEl))return;if((0,o.rS)(e)&&(0,s.OV)(t)){let{value:n}=e;this._dragFrom&&(n-=this._dragFrom.duration);let{cropLimit:r=[0,1/0]}=e;if(n>=r[0]&&n<=r[1]){var i;null===(i=t.handleCroping)||void 0===i||i.call(t,{...e,value:n})}}let n=this._lateralNeeded(t);switch(e.type){case"start":{let i=this._context.registry.transition.findBySegmentSequenced(t.id);this._inspectStart(e,t,n,i);break}case"duration":{let i=this._context.registry.transition.findBySegmentSequenced(t.id);this._inspectDuration(e,t,n,i);break}case"spread":this._inspectSpread(e,t)}}reflexExecute(e){if(e){console.debug("situation-crop execute",e.value);let t=this._findRegistered(e);this._context.dirty.executeClean(),this._context.valid.hideTips(),(0,o.rS)(e)&&(0,s.OV)(t)?(this._dragFrom&&(e.value-=this._dragFrom.duration),t.handleCrop(e)):(0,o.ST)(e)&&(0,s.YP)(t)&&t.handleCrop(e)}}recordTransitionDuration(){let e=this._findRegistered();if((0,s.OV)(e)){let t=this._context.registry.transition.findBySegment(e.id),[i,n]=(0,u.bS)(e,t);(i||n)&&(this._cacheTransitionDuration={},i&&(this._cacheTransitionDuration.front={id:i.id,duration:i.duration}),n&&(this._cacheTransitionDuration.rear={id:n.id,duration:n.duration}))}}resetTransitionDuration(){if(this._cacheTransitionDuration){if(this._cacheTransitionDuration.front){let[e]=this._context.registry.transition.findById(this._cacheTransitionDuration.front.id);(null==e?void 0:e.refEl)&&this._context.uiUpdater.updateRefElStyle(e,{width:this._context.unit.us2px(e.duration)})}if(this._cacheTransitionDuration.rear){let[e]=this._context.registry.transition.findById(this._cacheTransitionDuration.rear.id);(null==e?void 0:e.refEl)&&this._context.uiUpdater.updateRefElStyle(e,{width:this._context.unit.us2px(e.duration)})}}}resetCropElement(){if(!this._context.store.isSingleSelection||!this._cacheCropStyle)return;let e=this._findRegistered();if(!!(null==e?void 0:e.refEl))this._context.uiUpdater.updateRefElStyle(e,{x:this._cacheCropStyle.left,width:this._cacheCropStyle.width})}_situationSingleSide(e){if("none"===this._context.store.dragState||!this._context.store.isSingleSelection||!this._cropEdge)return;let t=this._context.reference.timeRound;this._dragFrom&&(t+=this._dragFrom.duration);let i={segment:{id:e.id,trackId:e.trackId},lastEnd:this._cropEdge.lastEnd,nextStart:this._cropEdge.nextStart,cropLimit:[this._cropEdge.left,this._cropEdge.right]},a=this._context.unit.px2us(r.GU);if("edge-front"===this._cropSide){let r=this._cropEdge.left,s=h.pMA.max([0n,e.start+e.duration-(void 0!==e.cropMin?e.cropMin:0n)-a],"bigint");if(s=h.pMA.min([e.start+e.duration-n.CZ,s],"bigint"),this.iscropToBegin=t<r,this.isCropToEnd=!1,(0,g.mK)(t,[r,s]))return{...i,type:"start",value:t};if(t>=s)return{...i,type:"start",value:s};else if(t<=r)return{...i,type:"start",value:r}}else if("edge-rear"===this._cropSide){let r=e.start+(void 0!==e.cropMin?e.cropMin:0n)+a;r=h.pMA.max([r,e.start+n.CZ],"bigint");let s=this._cropEdge.right;if(this.isCropToEnd=t>s,this.iscropToBegin=!1,(0,g.mK)(t,[r,s]))return{...i,type:"duration",value:t};if(t>=s)return{...i,type:"duration",value:s};else if(t<=r)return{...i,type:"duration",value:r}}}_situationBothSide(e){if("none"===this._context.store.dragState||!this._context.store.isSingleSelection||!this._cropEdge)return;let t=this._context.mouse.timeRound,i=0n;"edge-front"===this._cropSide?i=e.start-t:"edge-rear"===this._cropSide&&(i=t-(e.start+e.duration));let r=h.pMA.times(i,2,"bigint")+e.duration,a=e.prolongTotal;return{transition:{id:e.id,segmentId:e.segmentId,trackId:e.trackId},type:"spread",value:h.pMA.min([h.pMA.max([r,n.Rr],"bigint"),a],"bigint")}}_inspectStart(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[void 0,void 0];if(!t.refEl)return;let[s,l]=a,c=e.value,u=t.duration-(c-t.start),g=[];g.push({id:t.id,x:this._context.unit.us2px(c),width:this._context.unit.us2px(u),start:t.start});let[m]=this._context.registry.track.findById(t.trackId),f=null!==(i=t.transition)&&void 0!==i?i:t.prevTransition,p=t.start+t.duration-c<r.rm;if(f&&p?(this._context.valid.showTips(null,t.prevTransition?c+h.pMA.div(t.prevTransition.duration,2,"bigint")+4000n:c+u+h.pMA.div(t.transition.duration,2,"bigint")+4000n,o.jC.lostTransitionWhenCrop),this._context.valid.showTransitionWillLostPlaceholder(m,t,{start:c,duration:u})):(this._context.valid.hideTips(),this._context.valid.removeMultiPlaceholder()),m){let i=n.filter(e=>e.id!==t.id);if(i.length){if(0===m.index)g.push(...(0,d.QQ)(i,t.start,-this._context.unit.us2px(c-t.start),this._context.unit.zoom));else{let{lastEnd:n=0n}=e,r=c-n;r<=0?g.push(...(0,d.QQ)(i,t.start,-this._context.unit.us2px(r),this._context.unit.zoom)):g.push(...(0,d.SC)(i,t.start,this._context.unit.zoom))}}(s||l)&&g.push(...(0,d.S$)([s,l],this._context.store.zoom,{start:c,duration:u})),0===m.index&&this._context.dirty.markDirty(g)}this._context.uiUpdater.batchUpdateStyle(g)}_inspectDuration(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[void 0,void 0];if(!t.refEl)return;let[s,l]=a,c=e.value,u=c-t.start,g=[];g.push({id:t.id,width:this._context.unit.us2px(u),start:t.start});let[m]=this._context.registry.track.findById(t.trackId),f=null!==(i=t.transition)&&void 0!==i?i:t.prevTransition,p=e.value-t.start<r.rm;if(f&&p?(this._context.valid.showTips(null,t.prevTransition?t.start+h.pMA.div(t.prevTransition.duration,2,"bigint")+4000n:c+h.pMA.div(t.transition.duration,2,"bigint")+4000n,o.jC.lostTransitionWhenCrop),this._context.valid.showTransitionWillLostPlaceholder(m,t,{start:t.start,duration:u})):(this._context.valid.hideTips(),this._context.valid.removeMultiPlaceholder()),m){let i=n.filter(e=>e.id!==t.id);if(i.length){if(0===m.index)g.push(...(0,d.An)(i,t.start+t.duration,this._context.unit.us2px(u-t.duration),this._context.unit.zoom));else{let{nextStart:n=BigInt(Number.MAX_SAFE_INTEGER)}=e,r=e.value-n;r>=0?g.push(...(0,d.An)(i,t.start+t.duration,this._context.unit.us2px(r),this._context.unit.zoom)):g.push(...(0,d.jL)(i,t.start+t.duration,this._context.unit.zoom))}}(s||l)&&g.push(...(0,d.S$)([s,l],this._context.store.zoom,{duration:u,start:t.start})),0===m.index&&this._context.dirty.markDirty(g)}this._context.uiUpdater.batchUpdateStyle(g)}_inspectSpread(e,t){if(!t.refEl)return;let i=h.pMA.div(e.value-t.duration,2,"bigint");this._context.uiUpdater.updateRefElStyle(t,{x:this._context.unit.us2px(t.start-i),width:this._context.unit.us2px(t.duration+h.pMA.times(i,2,"bigint"))})}_lateralNeeded(e){if((0,s.YP)(e))return[];let[t]=this._context.registry.track.findById(e.trackId);return(null==t?void 0:t.id)?[...this._context.registry.segment.findByTrack(t.id),...this._context.registry.transition.findByTrack(t.id)]:[]}_recordCropStyle(){if(!this._context.store.isSingleSelection)return;let e=this._findRegistered();if(!(null==e?void 0:e.refEl))return;let t=this._context.uiUpdater.getRefElStyle(e);this._cacheCropStyle={left:t.left,width:t.width}}_findRegistered(e){let t;if(e)(0,o.ST)(e)?[t]=this._context.registry.transition.findById(e.transition.id):(0,o.rS)(e)&&([t]=this._context.registry.segment.findById(e.segment.id));else if(this._context.store.isSingleSelection)(0,a.hi)(this._context.store.uiSegments[0])?[t]=this._context.registry.transition.findById(this._context.store.uiSegments[0].id):[t]=this._context.registry.segment.findById(this._context.store.uiSegments[0].id);return t}constructor(e){this._context=e,this.isCropToEnd=!1,this.iscropToBegin=!1,this._cropStartTime=0}}},490446:function(e,t,i){i.d(t,{Z:function(){return g}});var n=i(824951),r=i(700933),a=i(305799),s=i(72127),o=i(65967),l=i(426336),d=i(65251),c=i(857670);let u=e=>e.map(e=>{let{segments:t}=e;return e.segments=t.map(e=>({...e})),{...e}});function h(e,t){e.forEach(e=>{e.start+=t})}let g=class e{get limitTrElement(){return l.pMA.max([this._context.mouse.trElement,this.minTargetSegStart],"bigint")}get firstOtherTrack(){return this.otherTracks[0]}get isReflexToMain(){var e,t;return(null===(t=this._dropSituation)||void 0===t?void 0:null===(e=t.track)||void 0===e?void 0:e.index)===0}get realTimeSideInfo(){var e;if(!this.sideInfo||!this.targetSegment)return;let t=this.limitTrElement-(null===(e=this.targetSegment)||void 0===e?void 0:e.start);return{left:this.sideInfo.left+t,right:this.sideInfo.right+t}}get targetSegment(){return this._context.store.targetSegment}setDragingStart(){if(!this._context.store.isMultiSelection||!this.targetSegment)return;let e=this._context.store.tracks.map(e=>{let[t]=e;return t});this.originalTracks=e,this.originalAudioTracks=this.originalTracks.filter(e=>e.type===l.pNd.TrackTypeAudio),this.originalOtherTracks=this.originalTracks.filter(e=>e.type!==l.pNd.TrackTypeAudio),this.selectedSegTracks=u((0,r.Ku)(e,this._context.store.uiSegments.map(e=>e.id)));let t=this.selectedSegTracks.findIndex(e=>"audio"===e.type);-1!==t?(this.audioTracks=(0,a.NO)(this.selectedSegTracks.slice(t),e=>!e.segments.length),this.otherTracks=(0,a.NO)(this.selectedSegTracks.slice(0,t),e=>!e.segments.length)):(this.audioTracks=[],this.otherTracks=this.selectedSegTracks);let i=BigInt(Number.MAX_SAFE_INTEGER),n=BigInt(Number.MIN_SAFE_INTEGER);for(let{segments:e}of this.selectedSegTracks)if(e.length){i=l.pMA.min([e[0].start,i],"bigint");let t=e[e.length-1];n=l.pMA.max([t.start+t.duration,n],"bigint")}this.sideInfo={left:i,right:n},this.minTargetSegStart=(0,c.i1)(this.targetSegment.start-i)}reset(){this.originalTracks=[],this.originalAudioTracks=[],this.originalOtherTracks=[],this.selectedSegTracks=[],this.audioTracks=[],this.otherTracks=[],this.sideInfo=void 0,this._dropSituation=void 0,this.minTargetSegStart=0n}reflexMultiInspect(e,t,i){if(!this.targetSegment||!this._context.store.dragType)return;let{track:n,space:r}=t,{location:a,mouseTime:s}=e;if(this._clearStayTimer(),!i){var o;if(this._context.uiUpdater.replaceHoverPlaceholderTrack(this._context.registry.track.entities,!1),this._context.dirty.executeClean(),this._context.valid.hideSpace(),this._context.valid.hidePlaceholder(),(null==n?void 0:n.index)===0&&this._checkPlaceOnMainTrack(e,t)){this._dropSituation={location:a,mouseTime:s,track:n,segment:e.segment};return}if((null==n?void 0:n.index)!==0&&this._checkPlaceOnOtherTrack(e,t)){this._dropSituation={location:a,mouseTime:s,track:n};return}let{isShowSpaceImmediately:i}=null!==(o=e.space)&&void 0!==o?o:{};if(!i){this._stayTimer=setTimeout(()=>{this.reflexMultiInspect(e,t,!0)},200);return}}r&&this._checkShowInserLine(t)&&(this._dropSituation={location:a,mouseTime:s,space:e.space})}reflexMultiExecute(){let e=this._dropSituation;if(!this._context.store.dragType||!e)return;this._context.uiUpdater.replaceHoverPlaceholderTrack(this._context.registry.track.entities,!1),this._context.dirty.executeClean(),this._context.valid.hideSpace();let[t]=e.track?this._context.registry.track.findById(e.track.id):[];e.track&&t&&0===t.index?this._moveToMainTrack(e):(e.track||e.space)&&this._moveToOtherTrack(e)}_checkPlaceOnMainTrack(e,t){var i,r;let a;let{segment:o,track:d}=t;if(!["video","combination"].includes(null===(i=this.targetSegment)||void 0===i?void 0:i.type)||(null===(r=this.otherTracks[0])||void 0===r?void 0:r.type)!=="video"||!d)return!1;let c=this.otherTracks[0].segments,u=c[0],h=0n;if((0,n.d4)(e)&&o)h=o.start,"rear"===e.segment.nZone&&(h+=o.duration);else{let t=this._context.registry.segment.findByTrack(e.track.id);if(t.length){let e=t[t.length-1];h=e.start+e.duration}}let g=h-u.start;if(this.sideInfo.left+g<0)return!1;let m=this._context.registry.segment.findByTrack(e.track.id),f=this._context.registry.transition.findByTrack(e.track.id),p=0n;c.forEach(e=>{var t;p+=e.duration;let i=null==a?void 0:null===(t=a.slots)||void 0===t?void 0:t.find(e=>"transition"===e.type);i&&(p-=l.pMA.div(i.duration,2,"bigint")),a=e});let _=this._context.unit.us2px(p),v=[];return v.push(...(0,s.An)(m,h,_,this._context.unit.zoom)),v.push(...(0,s.w7)(f,h,_,this._context.unit.zoom)),this._context.uiUpdater.batchUpdateStyle(v),this._context.uiUpdater.replaceHoverPlaceholderTrack(d,!0),this._context.valid.showPlaceholder(d,h,p),this._context.dirty.markDirty(v),!0}_checkPlaceOnOtherTrack(e,t){let i=t.track;if(!i)return!1;let n=this._context.store.targetSegment,r=e.mouseTime-n.start,a=this.selectedSegTracks.find(e=>e.id===this.targetSegment.trackId),s={...a,segments:a.segments.map(e=>({id:e.id,duration:e.duration,start:e.start+r}))};if(!this._couldMerge(i.index,s))return!1;let o=a.segments.map(e=>({start:e.start+r,duration:e.duration}));return this._context.valid.showMultiPlaceholder([{track:i,places:o}]),this._context.uiUpdater.replaceHoverPlaceholderTrack(i,!0),!0}_checkShowInserLine(e){return this._context.valid.showSpace(e.space),!0}_getDragRemovedOffset(e){if(0!==this.selectedSegTracks[0].index)return 0n;let t=0n;for(let i of this.selectedSegTracks[0].segments)e.start>=i.start&&(t+=i.duration);return t}_moveToMainTrack(e){let{selectedSegTracks:t,audioTracks:i,otherTracks:n}=this,[r]=this._context.registry.track.findByIndex(0),a=this._context.registry.segment.findByTrack(null==r?void 0:r.id),s=t[0].segments[0].start,o=a.length,l=a[o-1],d=l?l.start+l.duration-this._getDragRemovedOffset(l):0n;e.segment&&(o=a.findIndex(t=>t.id===e.segment.id),d=(l=a[o]).start-this._getDragRemovedOffset(l),"rear"===e.segment.nZone&&(o++,d+=l.duration));let c=d-s;t.forEach(e=>{!function(e){let t;e.forEach(e=>{let{start:i}=e;t&&(i=t.start+t.duration),e.start=i,t={...e,start:i}})}(e.segments),h(e.segments,c)});let u=this._genMainTrackMoveParams(n,o),g=this._getInsertTrackCount(u),m=[...u,...this._genAudioMoveParams(e,i,g)];this._context.userConfig.trigger.handleDrop(m)}_moveToOtherTrack(e){let{selectedSegTracks:t,audioTracks:i,otherTracks:n}=this,r=this._context.store.targetSegment,a=e.mouseTime-r.start;t.forEach(e=>{h(e.segments,a)});let s=this._genOtherTrackMoveParams(e,n),o=this._getInsertTrackCount(s),l=[...s,...this._genAudioMoveParams(e,i,o)];if(!e.track){this._stayTimer?this._clearStayTimer():this._context.userConfig.trigger.handleDrop(l);return}this._context.userConfig.trigger.handleDrop(l)}_genMainTrackMoveParams(e,t){let i=[],n=1,r=t-this.selectedSegTracks[0].segments.filter(e=>{let i=this.originalTracks[0].segments.findIndex(t=>e.id===t.id);return i>=0&&i<t}).length;for(let[t,a]of e.entries()){let s=!0;0!==t&&this._couldMerge(n,a)&&(s=!1,n++);let o=this._trackToMoveParams({track:a,toInsertIndex:t,insertNewTrack:0!==t&&s,targetSegId:e[0].segments[0].id,mainTrackIndex:r});i.push(...o)}return i}_getInsertTrackCount(e){let t=0;return e.forEach(e=>{e.needInsertTargetTrack&&t++}),t}_couldMerge(e,t){if(!t.segments.length)return t.trackType===l.pNd.TrackTypeAudio?e<this.originalTracks.length:e<this.originalOtherTracks.length;let i=this.selectedSegTracks.flatMap(e=>{let{segments:t}=e;return t.map(e=>{let{id:t}=e;return t})}),[n]=this._context.registry.track.findByIndex(e),r=n?this._context.registry.segment.findByTrack(n.id).filter(e=>!i.includes(e.id)):[];return(null==n?void 0:n.type)===t.trackType&&(0,o.fH)(r,t.segments)}_trackToMoveParams(e){let{track:t,toInsertIndex:i,targetSegId:n,insertNewTrack:r,mainTrackIndex:a}=e,s=r&&t.segments.find(e=>e.id===n);return 0===t.segments.length?[{duration:0n,segmentId:"",trackType:t.trackType,targetTrackIndex:i,sourceTrackIndex:t.index,targetStartTime:0n,isEmptyTrack:!0,needInsertTargetTrack:r,inMousePosition:!1}]:t.segments.map((e,o)=>({type:e.type,duration:e.duration,segmentId:e.id,trackType:t.trackType,targetTrackIndex:i,sourceTrackIndex:t.index,targetStartTime:l.pMA.max([e.start,0],"bigint"),isEmptyTrack:!1,needInsertTargetTrack:s?n===e.id:0===o&&r,inMousePosition:n===e.id,mainVideoTargetIndex:void 0!==a?a+o:0}))}_genUpperMoveParams(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=[],a=this._context.store.targetSegment,s=t;for(let o=i,l=t;o<e.length;o++,l++){let t=e[o],d=o===i&&n||!this._couldMerge(s,t),c=this._trackToMoveParams({track:t,toInsertIndex:l,targetSegId:a.id,insertNewTrack:d});!d&&s++,r.push(...c)}return r}_genLowerMoveParams(e,t,i){let n=this._context.store.targetSegment,r=[],a=t-1,s=t;for(let t=i-1;t>=0;t--){let i=e[t],o=!this._couldMerge(a,i);!o&&s--,s<=0&&(s=1,o=!0);let l=this._trackToMoveParams({track:i,toInsertIndex:s,insertNewTrack:o,targetSegId:n.id});if(o)for(let e of r)for(let t of e)t.targetTrackIndex++;else a--;r.push(l)}return(0,d.Z)(r.reverse())}_genTargetTracksMoveParams(e,t){if(!t.length)return[];let i=this._getDropStartInfo(e,t);if(!i)return[];let{toInsertReferenceTrackIndex:n,referenceTrackIndex:r,referInsertNewTrack:a}=i,s=this._genUpperMoveParams(t,n,r,a),o=this._genLowerMoveParams(t,n,r),l=0;return o.forEach((e,t)=>{l+=e.needInsertTargetTrack?1:0}),[...o,...s.map(e=>({...e,targetTrackIndex:e.targetTrackIndex+l}))]}_genOtherTrackMoveParams(e,t){if(!t.length)return[];if("audio"!==this._context.store.targetSegment.type)return this._genTargetTracksMoveParams(e,t);{let{originalTracks:e}=this,i=e.findIndex(e=>t[t.length-1].id===e.id);return this._genLowerMoveParams(t,i+1,t.length)}}_getDropStartInfo(e,t){let i,n,r;let{originalTracks:a}=this,s=this._context.store.targetSegment,o="audio"===s.type;if(e.track)r=!1,i=a.findIndex(t=>e.track.id===t.id),n=t.findIndex(e=>s.trackId===e.id);else{if(!e.space)return;r=!0,i=a.findIndex(t=>e.space.id===t.id),o&&(0===i?i=a.findIndex(e=>"audio"===e.type):i++),"after"===e.space.position&&i++,n=t.findIndex(e=>s.trackId===e.id)}return{toInsertReferenceTrackIndex:i,referenceTrackIndex:n,referInsertNewTrack:r}}_genAudioMoveParams(e,t,i){if(!t.length)return[];let{originalTracks:n}=this,r="audio"===this._context.store.targetSegment.type,a=[];if(r)a=this._genTargetTracksMoveParams(e,t);else{let e=n.findIndex(e=>e.id===t[t.length-1].id);a=this._genLowerMoveParams(t,e+1,t.length)}return a.map(e=>({...e,targetTrackIndex:e.targetTrackIndex+i}))}_clearStayTimer(){this._stayTimer&&(clearTimeout(this._stayTimer),this._stayTimer=null)}constructor(e){this._context=e,this.originalTracks=[],this.originalAudioTracks=[],this.originalOtherTracks=[],this.selectedSegTracks=[],this.audioTracks=[],this.otherTracks=[],this.minTargetSegStart=0n,this._stayTimer=null}}},928725:function(e,t,i){i.d(t,{Z:function(){return a}});var n=i(650248),r=i(72127);let a=class e{appendTo(e){null==e||e.appendChild(this.$dom)}removeFrom(e){(0,r.LW)(this.$dom,"[LineTrackSpace#removeFrom] remove $dom")}move(e){let{y:t}=e;this.$dom.style.top=`${t-1}px`}constructor(e){var t=this;this.context=e,this.$dom=(0,r.V5)("div",["coordinate-line","style-horizontal","style-track-space"]),this.show=function(){let{x:e,y:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0===e?t.$dom.style.left="":t.$dom.style.left=`${e}px`,void 0!==i&&(t.$dom.style.top=`${i-1}px`),t.$dom.classList.add("active")},this.hide=()=>{this.$dom.classList.remove("active"),this.$dom.style.top="0px"},this.tShow=(0,n.Z)(this.show,50),this.tHide=(0,n.Z)(this.hide,50)}}},244141:function(e,t,i){i.d(t,{P:function(){return a}});var n=i(690674),r=i(361731);class a{getAvailSegment(e,t,i){return(0,r.gP)(e.type,t,this._getBelongs(i))}getAvailSegmentBefore(e,t,i){return(0,r.x8)(e.type,t,this._getBelongs(i))}getAvailSegmentAfter(e,t,i){return(0,r.I)(e.type,t,this._getBelongs(i))}_getBelongs(e){if(!!e)return({upper:this._store[n.U_].computedTracksUpper,main:this._store[n.U_].computedTracksMain,under:this._store[n.U_].computedTracksUnder})[e]}constructor(e){this._store=e}}},333051:function(e,t,i){i.d(t,{k:function(){return k}});var n=i(789786),r=i(989719),a=i(928261),s=i(112825),o=i(146114),l=i(690674),d=i(426336),c=i(801497),u=i(955171),h=i(979159),g=i(394267),m=i(800788),f=i(956626),p=i(230689),_=i(108692),v=i(896413),S=i(271564),T=i(574132),M=i(695324),y=i(460254);class k{get _isEditingTemplate(){return this._store[l.qk].isEditingTemplate}getHandleReplace(e){return this._isEditingTemplate?this._handleMutableReplace.bind(this,e):this._handleReplace.bind(this,e)}getHandleReplaceHover(e){return this._isEditingTemplate?this._handleMutableReplaceHover.bind(this,e):this._handleReplaceHover.bind(this,e)}getHandleReplaceBlur(e){return this._handleReplaceBlur.bind(this,e)}getAvailReplace(e){var t;if(null==e?void 0:null===(t=e.digitalHuman)||void 0===t?void 0:t.digitalHumanId)return[];switch(e.type){case"mutable":case"mutablePoly":case"video":return["video"];case"mutableAudio":return["audio"];default:return[]}}getHandleReplacePlaceholder(e){return this._isEditingTemplate?this._handleReplacePlaceholder.bind(this,e):r.Z}_reportAddMaterialToTrack(e){let{dataTransferDelta:t,waitTime:i,status:n}=e;return(0,T.NR)(this._containerService,{...t,status:n,actionType:"drag",optionType:"replace",batchCnt:1,waitTime:i})}_handleReplace(e,t){let{selection:i,player:n,modal:r,draftOperation:s,timelineUI:o}=this._modules;(0,m.Y2)((0,g.Z)(t));let f=(0,h.JY)(t.type,t.dragSource);if(i.updateSelectData({segmentIds:[e.id]}),(0,m.Y2)((0,a.IM)(f),"invalid material to replace"),f.metaType===d.cVg.MetaTypeVideo){let i=(0,u.Z)(t.type,t.dragSource);switch(!0){case i<e.duration:o.toast.error(c.ZP.t("web_textvideo_toast_cant_replace",{},"Can\u2019t replace. Media needs to be no shorter than the original material."));break;case i-e.duration>0:this._store[l.VT].unionPlaying&&n.pause(),r.openMultiTrackSegmentTrimModal(e.id,t.dragSource,t.type);break;default:s.segment.segmentReplace(t,{segmentId:e.id,targetStartTime:e.start,targetDuration:e.duration})}}else s.segment.segmentReplace(t,{segmentId:e.id,targetStartTime:e.start,targetDuration:e.duration})}_handleMutableReplace(e,t){var i,n;let{draftOperation:r,autoReplace:s}=this._modules;if((0,m.Y2)((0,g.Z)(t)),"mutablePoly"===e.type||(0,a._n)(e.mutable))return;let l=(0,h.JY)(t.type,t.dragSource);if((0,m.Y2)((0,a.IM)(l),"invalid material to replace"),!(0,o._)(e.type,l.metaType))return;let c=r.getSegmentById(e.id);if(!!c&&!!(0,S.Hs)(t,c)){if("mutableAudio"===e.type)s.expand(e.mutable.mutableId,"mutableAudio",{type:t.type,data:t.dragSource}).then(async e=>{(0,M.b)(this._containerService,{relatedEvent:M.Z.AddMaterialToTrack,actionType:"drag",optionType:"replace"});let i=await r.mutable.setMutableAudios({dragData:t,mutableAudioList:e});this._reportAddMaterialToTrack({dataTransferDelta:t.delta,waitTime:i.performanceDuration,status:i.result.ok?"success":"fail"})});else if("mutable"===e.type){if(e.mutable.mutableId&&!this._mainEditorWidgetService.checkAvailability([{mutableId:e.mutable.mutableId,type:t.type,value:t.dragSource}]))return;this._mainEditorWidgetService.unHideMutableVideoManager.autoUnHideMutableVideo(e.mutable.mutableId).then(i=>{s.expand(e.mutable.mutableId,"mutable",{type:t.type,data:t.dragSource}).then(async e=>{let n=this._mainEditorWidgetService.subjectCropManager.getSubjectCropResult(t.dragSource,e,!0);(0,M.b)(this._containerService,{relatedEvent:M.Z.AddMaterialToTrack,actionType:"drag",optionType:"replace"}),i&&e.length>0&&(e[0]={...e[0]},e[0].visible=!0);let a=await r.mutable.setMutableVideos({dragData:t,mutableVideoList:e});Promise.allSettled([n]).then(i=>{let[n]=i;e.forEach(e=>{requestIdleCallback(()=>{this._mainEditorWidgetService.subjectCropManager.applySubjectCropSync(t.dragSource,[e],n)})})}),this._reportAddMaterialToTrack({dataTransferDelta:t.delta,waitTime:a.performanceDuration,status:a.result.ok?"success":"fail"})})})}(0,f.SH)(this._containerService,{action_type:f.kO.DRAG,option_type:f.Ds.REPLACE,action_position:f.X3.VIDEO,clip_type:f.U4.TRACK,position_type:this._store.timelineStore.isBatchReplacePanelVisible?f.o7.BATCH_REPLACE:f.o7.TIMELINE,clip_duration:Math.ceil(d.pMA.div(null!==(n=null===(i=this._mainDraftService.dataSdk.draftView.getSegmentById(e.id))||void 0===i?void 0:i.targetTimerange.duration)&&void 0!==n?n:0,1e6))})}}_handleReplaceHover(e,t){let{coordinate:i}=this._modules;if(t.type===y.r.DigitalHuman){i.context.event.emit(s.B.updateData,{id:e.id,replaceHover:!1});return}i.context.event.emit(s.B.updateData,{id:e.id,replaceHover:!0})}_handleMutableReplaceHover(e,t,i){let n;let{selection:r,coordinate:d,draftOperation:c}=this._modules;if((0,m.Y2)((0,g.Z)(t)),"mutablePoly"===e.type){let{children:t}=e.mutable;(null==t?void 0:t.length)&&!t.some(e=>{let{id:t}=e;return t===this._store[l.qk].selectedSegmentIds[0]})&&r.updateSelectData({segmentIds:[t[0].id]}),!(0,o._)(e.type,i.metaType)&&d.context.cursor.stage("disable");return}if("mutableAudio"===e.type)n=!(0,o._)(e.type,i.metaType);else{let r=c.getSegmentById(e.id);n=!r||!(0,S.Hs)(t,r)||!(0,o._)(e.type,i.metaType)}n?d.context.cursor.stage("disable"):(d.context.cursor.stage("insert"),!(0,a._n)(e.mutable)&&(d.context.event.emit(s.B.updateData,{id:e.id,replaceHover:!0}),this._store[l.qk].selectedSegmentIds[0]!==e.id&&r.updateSelectData({segmentIds:[e.id]})))}_handleReplaceBlur(e){this._modules.coordinate.context.event.emit(s.B.updateData,{id:e.id,replaceHover:!1})}_handleReplacePlaceholder(e,t,i){let{timelineUI:n,draftOperation:r}=this._modules;if("audio"!==i.type){n.toast.error(c.ZP.t("web_musicreplace_cannot_add_video",{},"Couldn\u2019t add video or image to music track"));return}let{duration:a}=e;if((0,g.Z)(t)&&"audio"===t.type){let{dragSource:e}=t,i=(0,d.k3U)(e.duration,1000000n,"bigint");a=d.pMA.min([a,i],"bigint")}let{needToInsert:s,trackIndex:o}=r.segment.findTrackIndexToInsert(d.pNd.TrackTypeAudio,e.start,a);r.segment.segmentAdd(t,{start:e.start,duration:a,type:"audio",trackIndex:o,needInsertTargetTrack:s})}constructor(e,t,i,n,r){this._store=e,this._modules=t,this._containerService=i,this._mainDraftService=n,this._mainEditorWidgetService=r}}k=(0,n.gn)([(0,n.fM)(2,p.t),(0,n.fM)(3,_.n),(0,n.fM)(4,v.a),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineManagerModules?Object:TimelineManagerModules,void 0===p.t?Object:p.t,void 0===_.n?Object:_.n,void 0===v.a?Object:v.a])],k)},263224:function(e,t,i){i.d(t,{L:function(){return r}});var n=i(796281);function r(e){let{draftOperation:t,segmentManager:i,draftDataSyncer:r}=e;return{catchError:e=>{t.setEnableTimelineRefresh(!0),i.emitCropEvent(n.x.ERROR),r.fullRefreshTracksData(),console.error(e)}}}},402548:function(e,t,i){i.d(t,{P:function(){return r}});var n=i(690674);class r{registerTrackCoverDataUpdateEvent(e){this._timelineManagerStore[n.U_].trackCoverStore.registerDataUpdateEvent(e)}constructor(e){this._timelineManagerStore=e}}},996708:function(e,t,i){i.d(t,{j:function(){return c}});var n=i(789786),r=i(460254),a=i(610142),s=i(690674),o=i(396032),l=i(955171),d=i(298170);class c{createDropTarget(e){let t=this._store[s.qk].isEditingTemplate?"cutsame":"timeline";return this._sidebarDnDService.createDropTarget({dropTarget:e,dropArea:t,callbacks:{onDrop:this._onDrop.bind(this),onDragStart:this._onDragStart.bind(this)},disabledScale:!0,setHoverSnapshotOffset:e=>{var t;let{type:i}=e;if(this._store[s.U_].isBatchReplacePanelVisible||this._store[s.qk].isEditingTemplate&&![r.r.UserAudio,r.r.Audio].includes(i))return;let{left:n,top:a}=null!==(t=(0,o.o)(i))&&void 0!==t?t:{left:0,top:0};return{x:-n,y:-a}},setHoverSnapshotRect:e=>{if(this._store[s.U_].isBatchReplacePanelVisible||this._store[s.qk].isEditingTemplate&&![r.r.UserAudio,r.r.Audio].includes(e.type))return;let{type:t,dragSource:i}=e,n=(0,l.Z)(t,i);return{width:this._coordinate.context.unit.us2px(n),height:(0,o.i)(t)}},setHoverSnapshotStyles:()=>this._store[s.qk].isEditingTemplate?{opacity:.8}:{}})}_onDrop(e,t){}_onDragStart(e,t){if(!this._coordinate.context.store.disable)this._coordinate.context.flyover.innovateStart(e,t),this._timelineZoom.adjustAppropriate((0,l.Z)(t.type,t.dragSource))}constructor(e,t,i,n){this._store=e,this._coordinate=t,this._timelineZoom=i,this._sidebarDnDService=n}}c=(0,n.gn)([(0,n.fM)(3,a.L),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,void 0===d.Z?Object:d.Z,"undefined"==typeof ITimelineZoom?Object:ITimelineZoom,void 0===a.L?Object:a.L])],c)},241014:function(e,t,i){i.d(t,{A:()=>R});var n=i("789786"),r=i("587892"),a=i("402655"),s=i("849002"),o=i("800788"),l=i("426336"),d=i("230689"),c=i("57407"),u=i("690674"),h=i("248222"),g=i("68659"),m=i("700933"),f=i("804497"),p=i("928261"),_=i("108692"),v=i("140599");class S extends a.JT{get onTracksChange(){return this._onTracksChange.event}get onTracksMutableChange(){return this._onTracksMutableChange.event}syncTracksData(){let e=(0,g.Xf)(this._dataSdk.draftView.getAllTracks(),this._dataSdk);!e.length&&e.push((0,m.BM)()),this._timelineManagerStore[u.U_].setTracks(e)}syncMutableAudiosData(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._dataSdk.draftView.getDraftId();if(!this._dataSdk.draftView.getDraftById(i))return;let n=this._dataSdk.draftView,r=this._dataSdk.cutSame.draftIdToMutableAudios[i];if(this._timelineManagerStore[u.U_].isTemplate&&r){let i=n.getDuration();if(e.mute){let n=r.filter(t=>!(0,v.M)(t.id,t.materialName,e)),a=(0,h.qu)(n,this._mainDraftService.subDraftApplySpeedViewManager,{shouldHideAudioName:!0,videoTemplate:e,parentSegment:this._segmentSelection.subDraftSegment});t=(0,f.hW)([a,1],i)}else t=e.canUpdateMusic?(0,f.hW)([(0,h.qu)(this._dataSdk.cutSame.getMutableAudios(),this._mainDraftService.subDraftApplySpeedViewManager,{shouldHideAudioName:!0,videoTemplate:e,parentSegment:this._segmentSelection.subDraftSegment}),1],i):null}let{tracksMutable:a}=this._timelineManagerStore[u.U_];t&&(2===a.length?a[1]=t:1===a.length&&a.push(t)),this._timelineManagerStore[u.U_].setTracksMutable([...a])}syncMutableVideosData(){var e,t,i;let n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._dataSdk.draftView.getDraftId(),a=this._dataSdk.draftView.getDraftById(r);if(!a)return;let s=this._dataSdk.draftView;a!==s&&(n=s.getAllSegments().find(e=>!!(0,l.duj)(e)&&e.materialDraft.draft.getDraftId()===r));let o=null!==(t=this._dataSdk.cutSame.draftIdToMutableVideos[r])&&void 0!==t?t:[],d=a.getDuration(),c=[(0,h.Z)(o,d,this._mainDraftService.subDraftApplySpeedViewManager,this._segmentSelection.subDraftSegment),0],[g]=null!=c?c:[];if(g){let e=g.segments.filter((0,p.be)("mutablePoly")),t={...g};t.segments=e,this._timelineManagerStore[u.U_].setTracksMutablePoly(s.getDraftId(),t);let i=g.segments.filter((0,p.be)("mutable")).filter(e=>{var t;return null===(t=e.mutable)||void 0===t?void 0:t.locked});this._timelineManagerStore[u.U_].setTracksMutableLocked(s.getDraftId(),{...g,segments:i})}this._timelineManagerStore[u.U_].setTracksMutable([c]),this._timelineManagerStore[u.U_].setTrackStartTime(null!==(i=null==n?void 0:null===(e=n.targetTimerange)||void 0===e?void 0:e.start)&&void 0!==i?i:0n)}constructor(e,t,i,n){var a;super(),a=this,this._dataSdk=e,this._timelineManagerStore=t,this._segmentSelection=i,this._mainDraftService=n,this._onTracksChange=this._register(new r.Q),this._onTracksMutableChange=this._register(new r.Q),this.syncMutableVideoRelationGroupData=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a._dataSdk.draftView.getDraftId(),i=a._dataSdk.cutSame.draftIdToRelationVideoGroup[t],n=Array.from(null!==(e=null==i?void 0:i.keys())&&void 0!==e?e:[]).slice(0,c.T.length).reduce((e,t,i)=>(e[t]=c.T[i],e),{});a._timelineManagerStore[u.U_].setRelationGroupColorMap(n)}}}S=(0,n.gn)([(0,n.fM)(3,_.n),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===_.n?Object:_.n])],S);var T=i("825875"),M=i("620266"),y=i("345299"),k=i("265409");class x extends a.JT{registerChangeGeneration(e){this._changeGenerationMap.set(e.name,e)}unregisterChangeGeneration(e){this._changeGenerationMap.delete(e)}generateCollectionMap(e,t){(0,k.DM)(k.Fh.GENERATE_COLLECTION_MAP);let i=this._generateChange(e,t);return(0,k.wf)(k.Fh.GENERATE_COLLECTION_MAP),i}_generateChange(e,t){let i={[y.A.TRACK]:[],[y.A.SEGMENT]:[]};return[...this._changeGenerationMap.values()].map(n=>this._invokeUnitWork(i,e,n,t)),i}_invokeUnitWork(e,t,i,n){let{name:r,runner:a}=i;try{return console.log("begin run effect",r),a(e,t,{dataSdk:this._dataSdk,store:this._timelineManagerStore,mode:n,subDraftSegment:this._segmentSelection.subDraftSegment,subDraftApplySpeedViewManager:this._mainDraftService.subDraftApplySpeedViewManager})}catch(e){throw console.error(`runner: ${r} throw error`,e),e}}constructor(e,t,i,n){super(),this._dataSdk=e,this._timelineManagerStore=t,this._segmentSelection=i,this._mainDraftService=n,this._changeGenerationMap=new Map}}x=(0,n.gn)([(0,n.fM)(3,_.n),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===_.n?Object:_.n])],x);var I=i("571657"),D=i("521183"),b=i("173828"),E=i("186463"),C=i("693511"),w=i("640218"),N=i("136498");let A={name:"multi-track-transient-data-default",runner:(e,t,i)=>{let{mode:n,store:r}=i,{sourceFrom:a,value:s}=t;if(a===M.G.TRANSIENT_DATA&&n===M.s.TRACKS)!function(e,t,i){let{segment:n,track:r}=e,{tracks:a,segments:s}=t;a.forEach(e=>{let{type:t,item:i}=e;switch(t){case w.p.ADD:{let{track:e,trackId:t,trackIndex:n}=i;r.push({nextIndex:n,nextValue:e,notifyOperationList:[],prevIndex:-1,prevValue:null,type:y.P.ADD});break}case w.p.UPDATE:break;case w.p.DELETE:{let{track:e,trackId:t,trackIndex:n}=i;r.push({nextIndex:-1,nextValue:null,notifyOperationList:[],prevIndex:n,prevValue:e,type:y.P.DELETE});break}default:(0,o.ss)()}}),s.forEach(e=>{let{type:t,item:r}=e;switch(t){case w.p.ADD:{let{trackId:e,segment:t}=r;n.push({nextIndex:0,nextTrackId:e,nextValue:t,notifyOperationList:[],prevIndex:-1,prevTrackId:null,prevValue:null,type:y.P.ADD});break}case w.p.UPDATE:{let{trackId:e,segment:t,segmentId:a,notifyOperation:s}=r,{segment:l,trackId:d,index:c}=(0,N.pP)(i,a);(0,o.Y2)(d),(0,o.Y2)(l),n.push({nextIndex:0,nextTrackId:e,nextValue:t,notifyOperationList:[s],prevIndex:c,prevTrackId:d,prevValue:l,type:y.P.UPDATE});break}case w.p.DELETE:{let{trackId:e,segment:t,segmentId:i}=r;n.push({nextIndex:0,prevTrackId:e,prevValue:t,notifyOperationList:[],prevIndex:-1,nextTrackId:null,nextValue:null,type:y.P.DELETE});break}default:(0,o.ss)()}})}(e,s,r[u.U_].tracks)}};var j=i("780206"),O=i("439143"),L=i("705286"),P=i("867508");class R extends a.JT{get onDataDiff(){return this._onDataDiff.event}get onFullTracksChange(){return this._onFullTracksChange.event}get onFullTracksMutableChange(){return this._onFullTracksMutableChange.event}get isInSubDraft(){return!!this._timelineManagerStore[u.qk].subDraftId}fullRefreshTracksData(){this._cacheTracks(),this._draftFullSyncer.syncTracksData();let e=this._timelineManagerStore[u.U_].tracks;this._onFullTracksChange.fire(e,this._cachedTracks)}fullRefreshTracksMutableData(){let{draftId:e}=this._getDraftViewAndDraftId();if(this._cacheTracksMutable(),this._draftFullSyncer.syncMutableVideosData(e),this._draftFullSyncer.syncMutableVideoRelationGroupData(e),this._timelineManagerStore[u.U_].isTemplate){if(this._recoveryTemplateInfoLoadedBarrier.isOpen()){(0,o.Y2)(this._videoTemplateInfo),this._draftFullSyncer.syncMutableAudiosData(this._videoTemplateInfo,e);let t=this._timelineManagerStore[u.U_].tracksMutable;this._onFullTracksMutableChange.fire(t,this._cachedTracksMutable,e)}else{let t=this._timelineManagerStore[u.U_].tracksMutable;this._onFullTracksMutableChange.fire(t,this._cachedTracksMutable,e),this._recoveryTemplateInfoLoadedBarrier.wait().then(()=>{(0,o.Y2)(this._videoTemplateInfo),this._cacheTracksMutable(),this._draftFullSyncer.syncMutableAudiosData(this._videoTemplateInfo,e),this._onFullTracksMutableChange.fire(t,this._cachedTracksMutable,e)})}}else{let t=this._timelineManagerStore[u.U_].tracksMutable;this._onFullTracksMutableChange.fire(t,this._cachedTracksMutable,e)}}_cutSameIncrementalSyncDataFromDataSdk(e){(0,k.DM)(k.Fh.TOTAL_SPEND);let t=[],i=[],n={segment:[],track:[]};e[l.u4I.SEGMENT].forEach(e=>{e.item.segmentType===l.Ocy.SegmentAudio?t.push(e):i.push(e)}),this._recoveryTemplateInfoLoadedBarrier.isOpen()?n=this._generateMutableAudioCollectionMap(t,e):this._recoveryTemplateInfoLoadedBarrier.wait().then(()=>{let i=this._generateMutableAudioCollectionMap(t,e);(0,k.DM)(k.Fh.SYNC_FROM_DATA_SDK),this._draftIncrementSyncer.syncTracksMutableData(i),(0,k.wf)(k.Fh.SYNC_FROM_DATA_SDK),console.log("[timeline incremental rendering]: collectionMap from dataSdk",i),this._onDataDiff.fire(i,M.G.DATA_SDK)});let r=this._dataDiffCollection.generateCollectionMap({sourceFrom:M.G.DATA_SDK,value:{...e,[l.u4I.SEGMENT]:i}},M.s.TRACKS_MUTABLE),a={track:[...r[y.A.TRACK],...n[y.A.TRACK]],segment:[...r[y.A.SEGMENT],...n[y.A.SEGMENT]]};(0,k.DM)(k.Fh.SYNC_FROM_DATA_SDK),this._draftIncrementSyncer.syncTracksMutableData(a),(0,k.wf)(k.Fh.SYNC_FROM_DATA_SDK),console.log("[timeline incremental rendering]: collectionMap from dataSdk",a),this._onDataDiff.fire(a,M.G.DATA_SDK),(0,k.wf)(k.Fh.TOTAL_SPEND)}_multiTrackIncrementalSyncDataFromDataSdk(e){(0,k.DM)(k.Fh.TOTAL_SPEND);let{segment:t}=e,i=!1,n=!1;t.forEach(e=>{if(e.type===l.C8.ADD){let t=e.item.segment.id,i=this._transientDataManager.getRelationId(t);i&&this._transientDataManager.removePlaceholderSegment(i)}else if(e.type===l.C8.UPDATE){var t,r,a;let{item:s}=e,o=s.segment;if(null===(t=o.transition)||void 0===t?void 0:t.id){let e=this._transientDataManager.getRelationId(o.transition.id);e&&this._transientDataManager.removePlaceholderTransition(e)}let d=this._mainDraftService.dataSdk.draftView.getSegmentById(s.id);if(!d||!(0,l.duj)(d))return;d.materialDraft.draft.getDraftId()===this._timelineManagerStore[u.qk].subDraftId&&((null===(r=s.segment.sourceTimerange)||void 0===r?void 0:r.start)||(null===(a=s.segment.targetTimerange)||void 0===a?void 0:a.duration))&&(i=!0,n=!0)}});let r=(0,l.MQy)(e),a=new Set,s=new Set(this._dataSdk.draftView.getAllSegments().map(e=>e.id));if([...e[l.u4I.SEGMENT],...r].forEach(e=>{let t;let{item:i,type:r}=e;t=r===l.C8.ADD?i.segment.id:i.id,a.add(t),!s.has(t)&&(n=!0)}),a.size>=50&&(i=!0),i){this.fullRefreshTracksData(),n&&this.isInSubDraft&&this.fullRefreshTracksMutableData();return}let o={...e,[l.u4I.SEGMENT]:[...e[l.u4I.SEGMENT],...r],[l.u4I.TRACK]:[...e[l.u4I.TRACK].filter(e=>!!e.item.trackId)]},d=this._dataDiffCollection.generateCollectionMap({sourceFrom:M.G.DATA_SDK,value:o},M.s.TRACKS),c={[y.A.SEGMENT]:d[y.A.SEGMENT].filter(e=>{var t;let{notifyOperationList:i}=e,{item:n}=null!==(t=i[0])&&void 0!==t?t:{};return!(null==n?void 0:n.path)||n.path.length<=1}),[y.A.TRACK]:d[y.A.TRACK]};if((0,k.DM)(k.Fh.SYNC_FROM_DATA_SDK),this._draftIncrementSyncer.syncTracksData(c),(0,k.wf)(k.Fh.SYNC_FROM_DATA_SDK),this.isInSubDraft){let e={[y.A.SEGMENT]:d[y.A.SEGMENT].filter(e=>{var t;let{notifyOperationList:i}=e,{item:n}=null!==(t=i[0])&&void 0!==t?t:{};return(null==n?void 0:n.path)&&n.path.length>=2}),[y.A.TRACK]:[]};(0,k.DM)(k.Fh.SYNC_FROM_DATA_SDK),this._draftIncrementSyncer.syncTracksMutableData(e),(0,k.wf)(k.Fh.SYNC_FROM_DATA_SDK)}console.log("[timeline incremental rendering]: collectionMap from dataSdk",d),this._onDataDiff.fire(d,M.G.DATA_SDK),(0,k.wf)(k.Fh.TOTAL_SPEND)}_multiTrackIncrementalSyncDataFromTransientData(e){(0,k.DM)(k.Fh.TOTAL_SPEND);let t=this._dataDiffCollection.generateCollectionMap({sourceFrom:M.G.TRANSIENT_DATA,value:e},M.s.TRACKS);(0,k.DM)(k.Fh.SYNC_FROM_TRANSIENT_DATA),this._draftIncrementSyncer.syncTracksData(t),(0,k.wf)(k.Fh.SYNC_FROM_TRANSIENT_DATA),console.log("[timeline incremental rendering]: collectionMap from transientDataManager",t),this._onDataDiff.fire(t,M.G.TRANSIENT_DATA),(0,k.wf)(k.Fh.TOTAL_SPEND)}_generateMutableAudioCollectionMap(e,t){var i,n,r;let a=e;(null===(i=this._videoTemplateInfo)||void 0===i?void 0:i.mute)&&(a=a.filter(e=>{let t;return t=e.type===l.C8.ADD?e.item.segment.id:e.item.id,!this._isSegmentAudioInTemplate(t)}));let s=this._dataDiffCollection.generateCollectionMap({value:{...t,[l.u4I.SEGMENT]:a},sourceFrom:M.G.DATA_SDK},M.s.TRACKS_MUTABLE);return!(null===(n=this._videoTemplateInfo)||void 0===n?void 0:n.mute)&&(null===(r=this._videoTemplateInfo)||void 0===r?void 0:r.canUpdateMusic)&&s[y.A.SEGMENT].forEach(e=>{if(e.type===y.P.ADD||e.type===y.P.UPDATE){let{id:t,title:i}=e.nextValue;this._isSegmentAudioMaterialInTemplate(t,i)&&(e.nextValue.title="")}}),s}refreshTimelineConfig(){let{duration:e}=this._dataSdk.draftView.getDraftMetadata();this._timelineManagerStore[u.U_].setTimelineDuration(e)}_cacheTracksMutable(){this._cachedTracksMutable=this._timelineManagerStore[u.U_].tracksMutable}_cacheTracks(){this._cachedTracks=this._timelineManagerStore[u.U_].tracks}_isSegmentAudioInTemplate(e){var t;return(0,o.Y2)(this._recoveryTemplateInfoLoadedBarrier.isOpen()),!!(null===(t=this._videoTemplateInfo)||void 0===t?void 0:t.preload.mutableAudios.find(t=>t.id===e))}_isSegmentAudioMaterialInTemplate(e,t){return(0,o.Y2)(this._recoveryTemplateInfoLoadedBarrier.isOpen()),(0,o.Y2)(this._videoTemplateInfo),(0,v.M)(e,t,this._videoTemplateInfo)}_getDraftViewAndDraftId(){var e;let t=null!==(e=this._segmentSelection.subDraftId)&&void 0!==e?e:this._dataSdk.draftView.getDraftId(),i=t===this._dataSdk.draftView.getDraftId()?this._dataSdk.draftView:this._dataSdk.draftView.getDraftById(t);return(0,o.Y2)(i,`draftView ${t} should be exist`),{draftId:t,draftView:i}}constructor(e,t,i,n,a,o,d){super(),this._dataSdk=e,this._timelineManagerStore=t,this._segmentSelection=i,this._transientDataManager=n,this._templateInfoManager=a,this._containerService=o,this._mainDraftService=d,this._onDataDiff=new r.Q,this._onFullTracksChange=new r.Q,this._onFullTracksMutableChange=new r.Q,this._recoveryTemplateInfoLoadedBarrier=new s.U,this._videoTemplateInfo=null,this._cachedTracksMutable=[],this._cachedTracks=[],this._isRecovery=!1,this._draftFullSyncer=this._containerService.createInstance(S,this._dataSdk,this._timelineManagerStore,this._segmentSelection),this._draftIncrementSyncer=this._containerService.createInstance(T.z,this._timelineManagerStore,this._dataSdk),this._dataDiffCollection=this._containerService.createInstance(x,this._dataSdk,this._timelineManagerStore,this._segmentSelection),this._dataDiffCollection.registerChangeGeneration(I.k),this._dataDiffCollection.registerChangeGeneration(A),this._dataDiffCollection.registerChangeGeneration(D.T),this._dataDiffCollection.registerChangeGeneration(b.cP),this._dataDiffCollection.registerChangeGeneration(E.T),this._dataDiffCollection.registerChangeGeneration(L.A),this._dataDiffCollection.registerChangeGeneration(P.v),this._dataDiffCollection.registerChangeGeneration(O.y),this._register(this._templateInfoManager.onTemplateInfoLoaded(()=>{this._timelineManagerStore[u.U_].isTemplate&&this._templateInfoManager.getTemplateInfo(this._mainDraftService.draftTemplateManager.getTemplateId()).then(e=>{this._videoTemplateInfo=e,this._recoveryTemplateInfoLoadedBarrier.open()})})),this._register(this._segmentSelection.onSubDraftSegmentChange(()=>{this.fullRefreshTracksMutableData()})),this._register(this._transientDataManager.onDataChange(e=>{if(!!C.$)this._timelineManagerStore[u.U_].isMultiTrack&&this._multiTrackIncrementalSyncDataFromTransientData(e)})),this._register(this._dataSdk.onChangeDiff(e=>{if(!C.$)return;let{actionOperateType:t}=e;if(this.refreshTimelineConfig(),e.needRefresh&&this._timelineManagerStore[u.U_].isTemplate){this.fullRefreshTracksMutableData(),this._isRecovery=!0;return}if(t===l.aWQ.History)this._timelineManagerStore[u.U_].isTemplate?this.fullRefreshTracksMutableData():this.fullRefreshTracksData(),this._isRecovery=!0;else if(this._isRecovery){if(this._timelineManagerStore[u.U_].isTemplate)this._cutSameIncrementalSyncDataFromDataSdk(e);else if(this._timelineManagerStore[u.U_].isMultiTrack){if(!(0,j.j1)(e)){console.log("no need refresh timeline",e);return}this._multiTrackIncrementalSyncDataFromDataSdk(e)}}})),this._register(this._mainDraftService.draftTemplateManager.onTemplateIdChange(e=>{this._timelineManagerStore[u.U_].isTemplate&&this._mainDraftService.draftTemplateManager.getTemplate(e).then(e=>{this._videoTemplateInfo=e})})),(!this._timelineManagerStore[u.U_].isTemplate||this._mainDraftService.draftTemplateManager.isNewEmpty)&&this._recoveryTemplateInfoLoadedBarrier.open()}}R=(0,n.gn)([(0,n.fM)(5,d.t),(0,n.fM)(6,_.n),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof ITransientDataManager?Object:ITransientDataManager,"undefined"==typeof ITemplateInfoManager?Object:ITemplateInfoManager,void 0===d.t?Object:d.t,void 0===_.n?Object:_.n])],R)},477790:function(e,t,i){i.d(t,{D:()=>F});var n=i("789786"),r=i("426336"),a=i("828890"),s=i("635186"),o=i("593642"),l=i("690674"),d=i("145748"),c=i("460254");function u(e,t,i){switch(t.type){case c.r.Video:return e.addVideo(t.dragSource,i,t.delta);case c.r.Gif:return e.addGif(t.dragSource,i);case c.r.Photo:return e.addPhoto(t.dragSource,i);case c.r.UserPhoto:return e.addUserPhoto(t.dragSource,i);case c.r.DigitalHuman:return e.addDigitalHuman(t.dragSource,i);case c.r.UserVideo:return e.addUserVideo(t.dragSource,i);case c.r.UserAudio:return e.addUserAudio(t.dragSource,i);case c.r.Audio:return e.addAudio(t.dragSource,i,t.delta);case c.r.Sticker:return e.addSticker(t.dragSource,i,t.delta);case c.r.Filter:return e.addFilter(t.dragSource,i,t.delta);case c.r.Effects:return e.addEffect(t.dragSource,i,t.delta);case c.r.BasicText:return e.addText(t.dragSource,i,t.delta);case c.r.TextPreset:if(t.dragSource.isFromBrand)return e.addBrandTextPreset(t.dragSource,i,t.delta);return e.addTextPreset(t.dragSource,i,t.delta);case c.r.VideoTemplate:return e.addVideoTemplate(t.dragSource,i,t.delta);case c.r.TextTemplate:return e.addTextTemplate(t.dragSource,i,t.delta);case c.r.AdjustmentPreset:return e.addAdjustemtPreset(t.dragSource,i,t.delta)}}var h=i("183609"),g=i("298730"),m=i("108692"),f=i("230689"),p=i("433140"),_=i("402144"),v=i("948328"),S=i("709488"),T=i("936154"),M=i("127656"),y=i("695324"),k=i("574132"),x=i("221242"),I=i("756024");class D{copySelectedSegments(){let e=this._store[l.U_];e.keyframeStore.setKeyframeCopyCacheSegment(void 0),e.keyframeStore.setCacheKeyframeSelectInfo(void 0);let{ok:t,msg:i}=this._segOperationManager.copySelectedSegments();!t&&this._timelineToast.normal(i)}cutSelectedSegments(){this._segOperationManager.cutSelectedSegments()}pasteSegment(e){if(!this._segOperationManager.canPaste)return!1;let{ok:t,msg:i}=this._segOperationManager.pasteSegments(e);return!t&&(i&&this._timelineToast.normal(i),this._refreshTimelineTracks()),t}duplicateSelectedSegments(){let{currentSeekTime:e}=this._store[l.U_];this.copySelectedSegments(),this.pasteSegment(e)}flipSegment(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getSegmentById(e);if(!n)return;let{flip:r}=null!==(t=n.clip)&&void 0!==t?t:{};if(r){let{horizontal:t,vertical:n}=r;this._dataSdk.api.segment.mirror({segmentId:e,vertical:i?!n:n,horizontal:i?t:!t})}}detachSegmentAudio(e){let{segmentId:t,onError:i}=e;return(0,M.g$)({mainDraftService:this._mainDraftService,resourceService:this._resourceService,payinPayoutHelper:this._payinPayoutHelper,containerService:this._containerService,draftMaterialsService:this._draftMaterialsService,renderManager:this._renderManager,segmentId:t,onError:i})}isMainTrackSegment(e){return!1}removeSegmentByIds(e,t){}removeSelectedSegments(){this._segOperationManager.removeSelectedSegments("menu")}async segmentAdd(e,t){(0,y.b)(this._containerService,{relatedEvent:y.Z.AddMaterialToTrack,actionType:"drag",optionType:"add"});let i=await u(this._addSegmentManager,e,t);return i&&(0,k.NR)(this._containerService,{...e.delta,status:(null==i?void 0:i.result.ok)?"success":"fail",actionType:"drag",optionType:"add",batchCnt:1,waitTime:null==i?void 0:i.performanceDuration}),i}async segmentReplace(e,t){let{type:i,dragSource:n}=e,{segmentId:a,targetStartTime:s,targetDuration:o,sourceStartTime:l,sourceDuration:d}=t,u=this.getSegmentById(a);if(!u||!(0,r.hey)(u))return;let h=this._dataSdk.api.batch.batchStart(),g=await this._replaceSegmentManager.replaceVideo({type:i,value:n,segmentIds:[a],sourceStartTime:null!=l?l:u.sourceTimerange.start,sourceDuration:null!=d?d:u.sourceTimerange.duration,targetStartTime:null!=s?s:u.targetTimerange.start,targetDuration:null!=o?o:u.targetTimerange.duration});if(this._pipelineManager.deleteAllIntelligent(u),this._vocalSeparationManager.removeVocalSeparation(u),this._vocalBeautifyManager.removeVocalBeautify(u),g&&(i===c.r.UserVideo||i===c.r.UserPhoto)){var m,f,p,_;(0,k.QU)(this._containerService,{status:(null==g?void 0:g.result.ok)?"success":"fail",actionType:"click",optionType:"replace",batchCnt:1,isFastImport:null===(m=n.uploading)||void 0===m?void 0:m.isSupportFastImport,waitTime:null==g?void 0:g.performanceDuration,materialName:null!==(_=n.filename)&&void 0!==_?_:"",storage:n.size,materialId:n.id,fileType:n.subType,resolution:`${null===(f=window.screen)||void 0===f?void 0:f.width}x${null===(p=window.screen)||void 0===p?void 0:p.height}`})}this._dataSdk.api.batch.batchEnd(h)}segmentMove(e){let t=(0,g.ty)(this._dataSdk,[{id:e.segmentId,targetStart:e.targetStartTime,duration:e.duration,trackIndex:e.targetTrackIndex,newTrack:e.needInsertTargetTrack,type:e.type}]);if(!t.ok){this._refreshTimelineTracks(),this._timelineToast.normal(t.msg);return}let i=this._dataSdk.api.batch.batchStart();try{if(e.needInsertTargetTrack){let t=this._dataSdk.draftView.getAllTracks()[e.sourceTrackIndex],i=new r.fQ8;i.id=(0,o.Rl)(),i.type=t.type,i.flag=this._dataSdk.draftView.isMainTrack(t)?r.w9k.FlagSubVideo:t.flag,this._dataSdk.api.track.add({trackIndex:e.targetTrackIndex,track:i})}this._dataSdk.api.segment.move({segmentId:e.segmentId,targetTrackIndex:e.targetTrackIndex,sourceTrackIndex:this._dataSdk.draftView.getTrackIndexBySegmentId(e.segmentId),targetStartTime:e.targetStartTime})}catch(e){I.t.error(e)}finally{this._dataSdk.api.batch.batchEnd(i)}}segmentTimeRangeUpdate(e){e.record=!0,this._dataSdk.api.segment.setTimeRange({segmentId:e.segId,trackId:e.trackId,clipType:e.clipType,clipTime:e.clipTime,record:e.record})}timelineStartExpandSegment(e){let{segment:t,selectedSegmentIds:i}=this._store[l.qk];if(!t||(0,r.Y9Q)(t)||i.length>1)return;let n=r.gQP.start(this._dataSdk.draftView,t.id,e);n&&this._renderManager.preview({item:{id:t.id,segment:n,segmentType:t.__segment_struct_type,trackIndex:this._dataSdk.draftView.getTrackIndexBySegmentId(t.id)},order:0,type:r.C8.UPDATE})}splitSegment(e,t){this._dataSdk.api.segment.split([{segmentId:e,splitTime:t}])}splitSelectedSegment(e){let{currentSeekTime:t}=this._store[l.U_],{segmentSelected:i}=this._store[l.qk],n=(0,S.HO)(i),r=(0,S.eb)({dataSdk:this._dataSdk,segmentSelected:i,currentSeekTime:t,splitTarget:n});return(0,d.i)(this._dataSdk,e,{canSplit:r,currentSeekTime:t,segmentSelected:i})}multiSegmentMove(e){let t=(0,g.ty)(this._dataSdk,e.filter(e=>e.type).map(e=>({id:e.segmentId,targetStart:e.targetStartTime,duration:e.duration,trackIndex:e.targetTrackIndex,newTrack:e.needInsertTargetTrack,type:e.type})));if(!t.ok){this._refreshTimelineTracks(),this._timelineToast.normal(t.msg);return}(0,y.b)(this._containerService,{relatedEvent:y.Z.MoveMaterialSegment});let i=new Map,n=this._dataSdk.api.batch.batchStart();try{for(let t of e)if(t.needInsertTargetTrack&&!i.has(t.targetTrackIndex)){let e=this._dataSdk.draftView.getAllTracks()[t.sourceTrackIndex],n=new r.fQ8;n.id=(0,o.Rl)(),n.type=e.type,n.flag=this._dataSdk.draftView.isMainTrack(e)?r.w9k.FlagSubVideo:e.flag,i.set(t.targetTrackIndex,n)}for(let[t,n]of i)for(let i of(this._dataSdk.api.track.add({trackIndex:t,track:n}),e))i.sourceTrackIndex>=t&&i.sourceTrackIndex++;let t=e.map(e=>this._dataSdk.draftView.getSegmentById(e.segmentId)).filter(e=>e),n=(0,T.C)(t);(0,x.H)(this._containerService,{...n,absorb_status:this._store[l.U_].absorbStatus}),e=e.filter(e=>!e.isEmptyTrack),this._dataSdk.api.segment.move(e)}catch(e){I.t.error(e)}finally{this._dataSdk.api.batch.batchEnd(n)}}async batchAddSegments(e){let t=this._dataSdk.api.batch.batchStart();await Promise.all(e.map(e=>{var t;let{dragData:i,position:n}=e,r={...i.delta,actionType:"drag",optionType:"add",batchCnt:1};null===(t=u(this._addSegmentManager,i,n))||void 0===t||t.then(e=>(0,k.NR)(this._containerService,{...r,status:(null==e?void 0:e.result.ok)?"success":"fail",waitTime:e.performanceDuration})).catch(()=>(0,k.NR)(this._containerService,{...r,status:"fail"}))})),this._dataSdk.api.batch.batchEnd(t)}onSegmentUpdate(e){let{onUpdate:t}=null!=e?e:{};this._dataSdk.onChangeDiff(e=>{null==t||t(e)})}getSegmentById(e){return this._dataSdk.draftView.getSegmentById(e)}findTrackIndexToInsert(e,t,i){return this._dataSdk.draftView.findTrackIndexToInsert(e,t,i)}setRenderManager(e){this._renderManager=e}constructor(e,t,i,n,r,a,s,o,l,d,c,u,h,g){this._dataSdk=e,this._store=t,this._addSegmentManager=i,this._replaceSegmentManager=n,this._segOperationManager=r,this._pipelineManager=a,this._vocalSeparationManager=s,this._vocalBeautifyManager=o,this._refreshTimelineTracks=l,this._timelineToast=d,this._containerService=c,this._mainDraftService=u,this._resourceService=h,this._draftMaterialsService=g,this._payinPayoutHelper=this._containerService.createInstance(_.W)}}D=(0,n.gn)([(0,n.fM)(10,f.t),(0,n.fM)(11,m.n),(0,n.fM)(12,p.c),(0,n.fM)(13,v.D),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,void 0===h.O?Object:h.O,"undefined"==typeof ReplaceSegmentManager?Object:ReplaceSegmentManager,"undefined"==typeof SegOperationManager?Object:SegOperationManager,"undefined"==typeof PipelineManager?Object:PipelineManager,"undefined"==typeof VocalSeparationManager?Object:VocalSeparationManager,"undefined"==typeof VocalBeautifyManager?Object:VocalBeautifyManager,Function,"undefined"==typeof ITimelineToast?Object:ITimelineToast,void 0===f.t?Object:f.t,void 0===m.n?Object:m.n,void 0===p.c?Object:p.c,void 0===v.D?Object:v.D])],D);var b=i("671314"),E=i("821915"),C=i("68659"),w=i("700933");class N{setVideoMuteALl(e){e?(this._dataSdk.api.video.muteOn(),this._store[l.U_].setMainTrackMuted(!0)):(this._dataSdk.api.video.muteOff(),this._store[l.U_].setMainTrackMuted(!1))}toggleVideoMuteAll(){var e;let t=null!==(e=this._dataSdk.draftView.getDraftProperty().videoMute)&&void 0!==e&&e;this.setVideoMuteALl(!t)}constructor(e,t){this._store=e,this._dataSdk=t}}var A=i("432092"),j=i("32666");class O{getCanvasSize(){let{width:e,height:t}=this._dataSdk.draftView.getCanvasConfig();return[e,t]}constructor(e){this._dataSdk=e}}var L=i("425427"),P=i("722169"),R=i("91474"),U=i("780206"),z=i("693511"),B=i("587892");let V={trailing:!0,leading:!1};class F{get draftId(){return this._dataSdk.draftView.getDraftId()}get tracks(){return this._dataSdk.draftView.getAllTracks()}get dataSdk(){return this._dataSdk}get onTracksChange(){return this._onTracksChange.event}refreshTimelineTracks(){if(z.$)return;let e=(0,C.Xf)(this.tracks,this.dataSdk);!e.length&&e.push((0,w.BM)()),this._store[l.U_].setTracks(e),this._onTracksChange.fire(e)}refreshTimelineSegments(e){if(z.$)return;let t=e.item,i=(null==t?void 0:t.path)&&t.path.length>1?t.path[0]:null==t?void 0:t.id,n=this.getSegmentById(i),r=(0,C.tr)(n,this);this._store[l.U_].setSegments(r,e),this._emitTracksChangeThrottle()}refreshTimelineConfig(){if(z.$)return;let{duration:e}=this._dataSdk.draftView.getDraftMetadata();this._store[l.U_].setTimelineDuration(e)}undo(){return this._dataSdk.api.undoRedo.undo()}redo(){return this._dataSdk.api.undoRedo.redo()}batchStart(e){return this._dataSdk.api.batch.batchStart(e)}batchEnd(e,t){return this._dataSdk.api.batch.batchEnd(e,{canUndoRedo:t})}getSegmentById(e){return this._dataSdk.draftView.getSegmentById(e)}getTrackIndexBySegmentId(e,t){return this._dataSdk.draftView.getTrackIndexBySegmentId(e,t)}setEnableTimelineRefresh(e){this._enableTimelineRefresh=e}_emitTracksChange(){this._timelineEvent.uiEvents.emit(A.W.TRACKS_CHANGE)}_addEventListener(){this._dataSdk.onChangeDiff(e=>{if(!this._enableTimelineRefresh)return;let t=e[r.u4I.SEGMENT],i=e[r.u4I.TRACK];if(e[r.u4I.CONFIG],this._refreshTimelineConfigThrottle(),!(0,U.j1)(e)){console.log("no need refresh timeline",e);return}e.actionOperateType===r.aWQ.Local&&1===t.length&&t[0].type===r.C8.UPDATE&&0!==t[0].item.trackIndex?this.refreshTimelineSegments(t[0]):(i.length>0||t.length>0)&&this.refreshTimelineTracks()})}setRenderManager(e){this._renderManager=e,this.segment.setRenderManager(e)}getRenderManager(){return this._renderManager}constructor(e,t,i,n,r,o,l,d,c,u,h,g,m,f,p,_,v,S){this._store=e,this._dataSdk=t,this._addSegmentManager=i,this._replaceSegmentManager=n,this._segOperationManager=r,this._timelineEvent=o,this._segmentSelection=l,this._resource=d,this._fileUploadManager=c,this._timelineToast=u,this._mutableReplaceTaskManager=h,this._smartToolManager=g,this._checkAvailability=m,this._templateInfoManager=f,this._draftDataSyncer=p,this._mainDraftService=_,this.containerService=v,this._environmentService=S,this._onTracksChange=new B.Q,this._enableTimelineRefresh=!0,this.keyframe=new a.o(this._dataSdk,this._store,this.containerService),this._refreshTimelineTracksThrottle=(0,P.throttle)(this.refreshTimelineTracks,33,V),this._refreshTimelineConfigThrottle=(0,P.throttle)(this.refreshTimelineConfig,33,V),this._emitTracksChangeThrottle=(0,P.throttle)(this._emitTracksChange,33,V),this.mutable=new s.d(this._dataSdk,this._store,this._replaceSegmentManager,this._segmentSelection,this._mainDraftService,this._resource,this.containerService,this._environmentService,this._mutableReplaceTaskManager,this._checkAvailability,this._templateInfoManager),this.transition=new b.C(this._addSegmentManager,this._dataSdk),this.beat=new E.Y(this._dataSdk,this.containerService),this.segment=this.containerService.createInstance(D,this._dataSdk,this._store,this._addSegmentManager,this._replaceSegmentManager,this._segOperationManager,this._smartToolManager.pipelineManager,this._smartToolManager.vocalSeparationManager,this._smartToolManager.vocalBeautifyManager,()=>{this._draftDataSyncer.fullRefreshTracksData()},this._timelineToast),this.video=new N(this._store,this._dataSdk),this.track=new j.F(this._store,this._dataSdk),this.config=new O(this._dataSdk),this.refreshTimelineTracks(),this.refreshTimelineConfig(),this._addEventListener()}}F=(0,n.gn)([(0,n.fM)(15,m.n),(0,n.fM)(16,f.t),(0,n.fM)(17,L.rO),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof IDataSdk?Object:IDataSdk,void 0===h.O?Object:h.O,void 0===R.m?Object:R.m,"undefined"==typeof SegOperationManager?Object:SegOperationManager,"undefined"==typeof ITimelineEventInner?Object:ITimelineEventInner,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof ITimelineResource?Object:ITimelineResource,"undefined"==typeof IEditorWidgetFileUploadManager?Object:IEditorWidgetFileUploadManager,"undefined"==typeof ITimelineToast?Object:ITimelineToast,"undefined"==typeof IMutableReplaceTaskManager?Object:IMutableReplaceTaskManager,"undefined"==typeof SmartToolsManager?Object:SmartToolsManager,Function,"undefined"==typeof ITemplateInfoManager?Object:ITemplateInfoManager,"undefined"==typeof IDraftDataSynchronizer?Object:IDraftDataSynchronizer,void 0===m.n?Object:m.n,void 0===f.t?Object:f.t,void 0===L.rO?Object:L.rO])],F)},80140:function(e,t,i){i.d(t,{m:function(){return s}});var n=i(426336),r=i(632858),a=i(928261);let s=(e,t)=>{let{segId:i,keyframesInfo:s}=t,{draftView:o}=e,{renderIndexTrackModeOn:l}=o.getDraftProperty(),d=o.getAllTracks(),{segmentIndex:c,trackIndex:u,trackId:h}=o.getSegmentAtPositionById(i),g=d[u].type,m=0,f=a.ki;g===n.pNd.TrackTypeAudio?(m=2,f=a.QB):!l&&(g===n.pNd.TrackTypeVideo?(m=0,f=a.yV):(m=1,f=a.LG));let p=d[u].segments[c],_=[];for(let e of s){let{keyframeType:t,selectedIndexs:i}=e,r=n.OLp.findKeyframes(p.clone(),t);if(r){let e=i.map(e=>r.keyframeList[Number(e)].clone(!0)),a=new n.koq({propertyType:t,keyframeList:e});_.push(a)}}let v={segId:i,trackId:h,trackType:g,trackIndex:u,trackTypeVect:f,isCopiedData:!0,keyframes:_,handleType:m,segment:p.clone()};r.v.instance.clearData(o.getDraftId()),r.v.instance.saveData(o.getDraftId(),i,v)}},34051:function(e,t,i){i.d(t,{B:function(){return s}});var n=i(587892),r=i(733730),a=i(432092);class s{get onClickEmptyTrack(){return this._onClickEmptyTrack.event}get uiEvents(){return this._timelineUIEventBus}get onTimelineDbClick(){return this._onTimelineDbClick.event}get onTimelineSegmentSeekAfterAdd(){return this._onTimelineSegmentSeekAfterAdd.event}get onTimelineAxisMarkerDelete(){return this._onTimelineAxisMarkerDelete.event}get onTimelineAxisMarkerAdd(){return this._onTimelineAxisMarkerAdd.event}get onTimelineUpdateCursorPosition(){return this._onTimelineUpdateCursorPosition.event}get onTimelineDragStart(){return this._onTimelineDragStart.event}get onTimelineDragEnd(){return this._onTimelineDragEnd.event}get onTimelineBeforeEnsureResource(){return this._onTimelineBeforeEnsureResource.event}get onTimelineAfterEnsureResource(){return this._onTimelineAfterEnsureResource.event}timelineAfterEnsureResource(e){this._onTimelineAfterEnsureResource.fire(e)}timelineBeforeEnsureResource(e){this._onTimelineBeforeEnsureResource.fire(e)}dbClick(e){this._onTimelineDbClick.fire(e)}segmentSeekAfterAdd(e){this._onTimelineSegmentSeekAfterAdd.fire(e)}fireAxisMarkerAddEvent(e){this._onTimelineAxisMarkerAdd.fire(e)}axisMarkerDelete(e){this._onTimelineAxisMarkerDelete.fire(e)}updateCursorPosition(e){this._onTimelineUpdateCursorPosition.fire(e)}fireTimelineDragStart(){this._onTimelineDragStart.fire()}fireTimelineDragEnd(){this._onTimelineDragEnd.fire()}clickEmptyTrack(){this._onClickEmptyTrack.fire()}fireClickFailedButton(){this.uiEvents.emit(a.W.SEGMENT_FAILED_BUTTON_CLICK)}constructor(){this._onTimelineDbClick=new n.Q,this._onTimelineSegmentSeekAfterAdd=new n.Q,this._onTimelineUpdateCursorPosition=new n.Q,this._onTimelineDragStart=new n.Q,this._onTimelineDragEnd=new n.Q,this._timelineUIEventBus=new r.Z,this._onTimelineAxisMarkerAdd=new n.Q,this._onTimelineAxisMarkerDelete=new n.Q,this._onTimelineBeforeAdd=new n.Q,this._onTimelineBeforeEnsureResource=new n.Q,this._onTimelineAfterEnsureResource=new n.Q,this._onClickEmptyTrack=new n.Q,this._clickFailedButton=new n.Q}}},362283:function(e,t,i){i.d(t,{N:function(){return T}});var n=i(789786);i(784923);var r=i(498417),a=i(634696),s=i(645778),o=i(805355),l=i(431356),d=i(108692),c=i(800788),u=i(948328),h=i(173888),g=i(31463),m=i(433140),f=i(313164),p=i(230689),_=i(966697),v=i(801497),S=i(257838);class T{setRenderManager(e){this._renderManager=e}_ensureResoureReady(e,t){var i;let{material:n}=e,r=(0,a.LP)(n,this._mainDraftService,this._resourceService);if(!this._draftMaterialsService.isMaterialExistInUserGeneratedByMd5(r))return!0;let s=null===(i=this._draftMaterialsService.getMaterialsByMd5(r))||void 0===i?void 0:i[0];return(0,c.Y2)(s,"material model not found"),console.log("[test]MaterialModelStatus",s.status),s.status===h.a.Success||(s.onDidDone(()=>{if(console.log("[test]MaterialReadyForFreeze"),!this._freezeCancelRef)t()}),!1)}async _freezeVideo(e,t){var i,n,d;let{dataSdk:u}=this._mainDraftService,{workspaceId:h}=this._mainDraftService.draftWorkspaceManager;if(this._freezeCancelRef=!1,this._playerManager.pause(),this._modalManager.showModal({freezing:!0}),!h)return;let g=null==u?void 0:null===(n=u.draftView)||void 0===n?void 0:null===(i=n.getSegmentById)||void 0===i?void 0:i.call(n,e),m=this._ensureResoureReady(g,()=>{this._freezeVideo(e,t)});if(console.log("[test]isResourceReady",m),!m)return;let f=(0,a.rs)(t),p=(0,a.Ji)(g);try{let e=await (0,s.FW)(this._draftMaterialsService,this._frameDataService,this._mainDraftService,this._resourceService,{segment:g,progress:f,workspaceId:h}),t=await (0,s.c7)(this._frameDataService,e);if(t&&!this._freezeCancelRef){let e=await (0,o.u)(this._mainDraftService,this._ensureManager,this._renderManager,this._resourceService,this._draftMaterialsService,this._containerService,{md5:t,workspaceId:h}),i=await this._renderManager.getMediaFileInfo(e.resPath,null!==(d=e.decryptKey)&&void 0!==d?d:"");if((0,c.Y2)(i,"can not get mediainfo from ensure material."),this._freezeCancelRef)return;(0,o.z)(this._draftMaterialsService,this._segmentSelection,u,{md5:t,mediaInfo:i,segment:g,progress:f,duration:l.NA,path:e.segmentPath},(e,t)=>{if(p){(0,a.u)(g,this._smartToolsManager,e,()=>{this.unfreezeSegment(),t()});return}t()}),!p&&this.unfreezeSegment(),(0,a.p9)(g,this._reporterService)}}catch(e){throw this.unfreezeSegment(),r.Z.error(v.ZP.t("web_edit_text_freeze_failure",{},"\u5B9A\u683C\u5931\u8D25")),e}}freezeSegment(e,t){if(!this._accountService.hasLogin){this._accountService.login({moduleLoginFrom:l.Uy});return}this._freezeVideo(e,t)}unfreezeSegment(){this._freezeCancelRef=!0,(0,a.Ky)(),(0,s.j6)(),this._modalManager.hideMultiTrackFreezingModal()}constructor(e,t,i,n,r,a,s,o,l,d,c,u){this._modalManager=e,this._playerManager=t,this._smartToolsManager=i,this._ensureManager=n,this._segmentSelection=r,this._mainDraftService=a,this._reporterService=s,this._resourceService=o,this._accountService=l,this._draftMaterialsService=d,this._frameDataService=c,this._containerService=u,this._freezeCancelRef=!1}}T=(0,n.gn)([(0,n.fM)(5,d.n),(0,n.fM)(6,g.m),(0,n.fM)(7,m.c),(0,n.fM)(8,_.Gw),(0,n.fM)(9,u.D),(0,n.fM)(10,f.D),(0,n.fM)(11,p.t),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof ModalManager?Object:ModalManager,"undefined"==typeof IPlayerManager?Object:IPlayerManager,void 0===S.f?Object:S.f,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===d.n?Object:d.n,void 0===g.m?Object:g.m,void 0===m.c?Object:m.c,void 0===_.Gw?Object:_.Gw,void 0===u.D?Object:u.D,void 0===f.D?Object:f.D,void 0===p.t?Object:p.t])],T)},276374:function(e,t,i){i.d(t,{i:function(){return l}});var n=i(690674),r=i(402655),a=i(609962),s=i(254336),o=i(224986);class l extends r.JT{_observeSlotTokenStart(e){e.forEach(e=>{let{token:t}=e;if(t){var i,r;let{mutableId:s,cancelable:o}=t.meta;this._timelineManagerStore[n.gC].setMutableStatusInfo(s,{status:null!==(r=null===(i=e.token)||void 0===i?void 0:i.status)&&void 0!==r?r:a.a.IDLE,cancelable:!!o})}e.onDidStartToken(t=>{let{meta:i}=t,{mutableId:r,cancelable:s}=i;if(r){var o,l;this._timelineManagerStore[n.gC].setMutableStatusInfo(r,{status:null!==(l=null===(o=e.token)||void 0===o?void 0:o.status)&&void 0!==l?l:a.a.IDLE,cancelable:!!s}),null==t||t.onStatusChange(e=>{this._timelineManagerStore[n.gC].updateMutableStatus(r,e)}),null==t||t.onCancelableChange(e=>{this._timelineManagerStore[n.gC].updateMutableCancelable(r,e)})}})})}cancelUploadTask(e){let t=this._mutableReplaceTaskManager.get(e);if(null==t?void 0:t.token){var i,n;null===(i=(n=t.token).cancel)||void 0===i||i.call(n)}}retryUploadTask(e){let t=this._mutableReplaceTaskManager.get(e);if(null==t?void 0:t.token){var i,n;null===(i=(n=t.token).retry)||void 0===i||i.call(n)}}uploadFile(e,t){let{isBatchReplacePanelVisible:i}=this._timelineManagerStore[n.U_];return(0,o.F)({file:t,mutableId:e,dataSdk:this._dataSdk,fileUploaderManager:this._fileUploadManager,subDraftId:this._timelineManagerStore[n.qk].subDraftId,subTemplateId:this._segmentSelection.subDraftTemplateId,position:i?s.cg.SLOTS:s.cg.TRACK})}constructor(e,t,i,n,r){super(),this._dataSdk=e,this._timelineManagerStore=t,this._mutableReplaceTaskManager=i,this._fileUploadManager=n,this._segmentSelection=r,this._observeSlotTokenStart(this._mutableReplaceTaskManager.allSlots),this._mutableReplaceTaskManager.onMutableReplaceTaskAdd(e=>{this._observeSlotTokenStart([e])})}}},253059:function(e,t,i){i.d(t,{e:function(){return o}});var n=i(587892),r=i(690674),a=i(936800),s=i(129883);class o{get onReady(){return this._onReady.event}addTask(e,t){!this._resourceStatusMap[t]&&(this._resourceStatusMap[t]={}),!this._resourceStatusMap[t].waves&&(this._genWaves(e,t),this._onReady.fire({resourceKey:t}))}_genWaves(e,t){this._resourceStatusMap[t].waves=a.o.Pending;let i=(0,s.V)(e).map(e=>({timestamp:0n,strength:e}));this._store[r.jU].setWaves(t,i),this._resourceStatusMap[t].waves=a.o.Ready}constructor(e,t){this._store=e,this._resourceStatusMap=t,this._onReady=new n.Q}}},557428:function(e,t,i){i.d(t,{F:function(){return l}});var n=i(426336),r=i(587892),a=i(936800),s=i(690674),o=i(153107);class l{get onReady(){return this._onReady.event}addTask(e,t){let{resourceKey:i}=t;return(!this._resourceStatusMap[i]&&(this._resourceStatusMap[i]={}),this._resourceStatusMap[i].sprites)?Promise.resolve():this._parseSlotSprites(e,t).then(()=>{this._onReady.fire({resourceKey:i})})}async _parseSlotSprites(e,t){let{resourceKey:i,templateSprites:r}=t;this._resourceStatusMap[i].sprites=a.o.Pending;try{let{start:l,duration:d}=t,c=await (0,o.$8)(e);if(this._store[s.jU].sprites[i])throw this._resourceStatusMap[i].sprites=a.o.Ready,Error("template slot sprites already exists");let u=r.length,h=Math.round(n.pMA.div(l,c)*u),g=Math.round(n.pMA.div(l+d,c)*u),m=r.slice(h,g>h?g:h+1);this._store[s.jU].setSprites(i,m),this._resourceStatusMap[i].sprites=a.o.Ready}catch{this._resourceStatusMap[i].sprites=a.o.Error}}constructor(e,t){this._store=e,this._resourceStatusMap=t,this._onReady=new r.Q}}},629750:function(e,t,i){i.d(t,{N:function(){return c}});var n=i(591010),r=i(690674),a=i(823404),s=i(804497),o=i(587892),l=i(260963),d=i(432092);class c{get onSelection(){return this._onSelection.event}get onTimelineBoxSelection(){return this._onTimelineSelection.event}get transitionIds(){return this._segmentSelection.selectionData.getSelectedTransitionIds()}get segmentIds(){return this._segmentSelection.selectionData.getSelectedSegmentsIds()}updateSelectData(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.U.Default,{transitionIds:r=[]}=e,a=this._splitSelectedSegmentIds(null!==(t=e.segmentIds)&&void 0!==t?t:[]),{placeholderIds:s}=a,{segmentIds:o}=a;(this._segmentSelection.batchReplacingSegmentId||this._segmentSelection.expandedSegmentId)&&(o=o.filter(e=>e!==this._segmentSelection.batchReplacingSegmentId&&e!==this._segmentSelection.expandedSegmentId)),this._segmentSelection.setSelectedData({segmentIds:o,placeholderIds:s,transitionIds:r},n.k.Timeline,i)}updatePreviewSelectData(e){this._segmentSelection.setPreviewSelectedData({segmentIds:e.segmentIds})}updatePrepareSelectData(e){var t;let{transitionIds:i=[]}=e,{segmentIds:r,placeholderIds:a}=this._splitSelectedSegmentIds(null!==(t=e.segmentIds)&&void 0!==t?t:[]);this._segmentSelection.setPrepareSelectedData({segmentIds:r,placeholderIds:a,transitionIds:i},n.k.Timeline)}getPrepareSelectedSegmentsData(){return this._segmentSelection.getPrepareSelectedData()}getSelectedSegments(){return this._selection.getSelectedSegments()}_splitSelectedSegmentIds(e){return e.reduce((e,t)=>{var i,n;return(0,a.AU)(t)?null===(i=e.placeholderIds)||void 0===i||i.push(t):null===(n=e.segmentIds)||void 0===n||n.push(t),e},{segmentIds:[],placeholderIds:[]})}expandCombinationSegment(e){this._segmentSelection.setExpandedSegmentId(e)}mergeClips(){let{timelineSelectionStore:e}=this._store,{expandedSegmentId:t}=e;if(!!t)this._segmentSelection.setExpandedSegmentId(null)}batchReplaceCombinationSegment(e){this._segmentSelection.setBatchingReplaceSegmentId(e)}timelineBoxSelection(e,t){this._onTimelineSelection.fire({segmentIds:e,transitionIds:t})}_getSyncSelectionSeg(e){let t;let{segmentIds:i,transitionIds:n,placeholderIds:a}=e,o=[...i,...n,...a],{tracks:l,tracksMutable:d,isBatchReplacePanelVisible:c}=this._store[r.U_],{selectedSegmentIds:u}=this._segmentSelection.observeData;return c&&u&&(t=(0,s.ed)(d,u)),!t&&(t=this._store[r.qk].isEditingTemplate?(0,s.ed)(d,o):(0,s.kQ)(l,o)),t}_syncSelection(e){let{segmentIds:t,transitionIds:i}=e,{tracks:n}=this._store[r.U_],a=this._getSyncSelectionSeg(e);this._store[r.qk].setSegmentSelected(a),this._store[r.qk].setTimeRangeSegmentIds((0,s.$b)(n.map(e=>e[0]),this._store[r.qk].segmentSelectedTimeRange)),this._onSelection.fire({segmentIds:t,transitionIds:i})}setIsDisabledSelectSegment(e){this.isDisabledSelectSegment=e}constructor(e,t,i,n,a,s){this._selection=e,this._prepareSelection=t,this._store=i,this._segmentSelection=n,this._timelineEvent=a,this._draftDataSynchronizer=s,this._onSelection=new o.Q,this._onTimelineSelection=new o.Q,this.isDisabledSelectSegment=!1,this._selection.onChange(e=>{this._syncSelection(e.selectedData)}),this._prepareSelection.onChange(e=>{let{selectedData:t}=e,i=this._getSyncSelectionSeg(t);this._store[r.qk].setPrepareSegmentSelected(i)}),this._timelineEvent.uiEvents.on(d.W.TRACKS_CHANGE,()=>{let e=this._selection.getSelectedData();this._syncSelection(e)}),this._draftDataSynchronizer.onFullTracksMutableChange(()=>{let{isEditingTemplate:e}=this._store[r.qk];if(e){let e=this._selection.getSelectedData();this._syncSelection(e)}}),this._draftDataSynchronizer.onFullTracksChange(()=>{let{isEditingTemplate:e}=this._store[r.qk];if(!e){let e=this._selection.getSelectedData();this._syncSelection(e)}}),(0,l.U5)(()=>({isEditingTemplate:this._store[r.qk].isEditingTemplate}),e=>{let{isEditingTemplate:t}=e,i=this._selection.getSelectedData();this._syncSelection(i)}),this._draftDataSynchronizer.onDataDiff(()=>{let e=this._selection.getSelectedData();this._syncSelection(e)})}}},678310:function(e,t,i){i.d(t,{m:function(){return m}});var n=i(789786),r=i(426336),a=i(690674),s=i(490620),o=i(928261),l=i(907031),d=i(165092),c=i(332557),u=i(400290),h=i(108692),g=i(105304);class m{get store(){return this._store[a.Y4]}getTemplatePostSegments(){return this.store.templatePostSegments}getTemplatePostMutableSegments(){return this.store.templatePostMutableSegments}async toggleTemplatePostMode(e){if(e){await this._recoveryFromDataStorage(),this._timelineInteractManager.setDisableInteract([g.Vf.SEQUENCE]),this._timelineInteractManager.setHideView([g.fV.TIMELINE_HEADER]);let t=this._calculateTemplateSegments(e);this.store.setTemplatePostSegments(t),this._store[a.U_].setTimelineMode(l.KN.TEMPLATE_POST)}else{let t=this._calculateTemplateSegments(e);this.store.setTemplatePostSegments(t),this._store[a.U_].setTimelineMode(l.KN.MULTI_TRACK),this._timelineInteractManager.clearDisableInteract(),this._timelineInteractManager.clearHideView()}this._setPostSegmentsToDataStorage()}isTemplatePostMutableSegment(e){var t;let{templatePostSegments:i}=this.store;return(null!==(t=i.find((0,s.Jl)(e)))&&void 0!==t?t:{mutable:!1}).mutable}setTemplatePostSegmentMutableStatus(e,t){let{allSegments:i}=this._store[a.U_],{segmentSelected:n}=this._store[a.qk],r=n.length>1?n:[e],l=!1,d=(0,o.be)("audio");r.forEach(e=>{if(!(0,o.Xe)(e)&&!!(0,s.QT)(e))d(e)&&(l=!0),this.store.updateOrInsertTemplatePostSegment((0,s.$g)(e,t))}),l&&i.forEach(e=>{d(e)&&this.store.updateOrInsertTemplatePostSegment((0,s.$g)(e,t))}),this._setPostSegmentsToDataStorage()}resetTemplatePostSegments(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._store[a.U_].allSegments;e.map(this._setDefaultMutableSegment.bind(this)).map(this._store[d.gq].updateOrInsertTemplatePostSegment.bind(this._store[d.gq])),this._setPostSegmentsToDataStorage()}async _recoveryFromDataStorage(){try{let e=await u.R.getStoreInstance(this._storageService),[t,i]=(await e.query(this._mainDraftService.dataSdk.draftView.getDraftId())).pair();if(!t&&i){let e=r.HHr.parse(i.segmentsInfo);this._store[a.Y4].setTemplatePostSegments(e)}}catch{}}_setPostSegmentsToDataStorage(){try{let e=this._mainDraftService.dataSdk.draftView.getDraftId(),t=this._store[d.gq].templatePostSegments;u.R.getStoreInstance(this._storageService).then(async i=>{let[n,a]=(await i.query(e)).pair();i.set(e,{id:e,form:!n&&a?a.form:"",segmentsInfo:r.HHr.stringify(t)})})}catch{}}_calculateTemplateSegments(e){let{allSegments:t}=this._store[a.U_],{templatePostSegments:i}=this.store,n=i.filter(e=>t.some((0,s.Jl)(e)));return e?t.filter(e=>!n.some((0,s.Jl)(e))).map(this._setDefaultMutableSegment.bind(this)).concat(n):n}_setDefaultMutableSegment(e){var t,i;let n=null!==(i=null===(t=this._dataSdk.draftView.getMainTrack())||void 0===t?void 0:t.segments)&&void 0!==i?i:[],r=(0,s.Vd)(e,n);return(0,s.$g)(e,r)}constructor(e,t,i,n,r){this._dataSdk=e,this._store=t,this._timelineInteractManager=i,this._storageService=n,this._mainDraftService=r}}m=(0,n.gn)([(0,n.fM)(3,c.U),(0,n.fM)(4,h.n),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineInteractManager?Object:TimelineInteractManager,void 0===c.U?Object:c.U,void 0===h.n?Object:h.n])],m)},461566:function(e,t,i){i.d(t,{S:function(){return r}});var n=i(690674);class r{setDisableInteract(e){this._store[n.d5].setDisableInteractList(e)}clearDisableInteract(){if(!this._store[n.d5].disableReadonlyMode)this._store[n.d5].disableInteractList=[]}setHideView(e){this._store[n.d5].hideViewList=e}clearHideView(){this._store[n.d5].hideViewList=[]}setDisableSeek(e){this._player.setIsDisabledSeek(e)}setEnableTimelineRefresh(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._draftOperation.setEnableTimelineRefresh(e),t&&this._draftDataSyncer.fullRefreshTracksData()}constructor(e,t,i,n,r){this._store=e,this._coordinate=t,this._player=i,this._draftOperation=n,this._draftDataSyncer=r}}},691269:function(e,t,i){i.d(t,{c:function(){return l}});var n=i(260963),r=i(690674),a=i(587892),s=i(402655),o=i(432092);class l extends s.JT{get observableData(){return this._observableData}get onTracksMutableChange(){return this._onTracksMutableChange.event}get onTracksChange(){return this._onTracksChange.event}constructor(e,t,i){super(),this._draftOperation=e,this._event=t,this._timelineManagerStore=i,this._onTracksMutableChange=new a.Q,this._onTracksChange=new a.Q,this._observableData=(0,n.LO)({get tracks(){return i[r.U_].tracks},get tracksMutable(){return i[r.U_].tracksMutable}}),this._draftOperation.onTracksChange(e=>{this._onTracksChange.fire(e)}),this._draftOperation.mutable.onTracksMutableChange(e=>{this._onTracksMutableChange.fire(e)}),this._event.uiEvents.on(o.W.TRACKS_CHANGE,()=>{this._onTracksChange.fire(this._timelineManagerStore[r.U_].tracks)})}}},785048:function(e,t,i){i.d(t,{Y:function(){return o}});var n=i(892230),r=i(969242),a=i(907031),s=i(690674);class o{constructor(e){var t=this;this._store=e,this._cache=null,this._zoom=1/0,this._cacheFix=1/0,this._intervalClear=()=>{let e=Date.now();this._cache&&e-this._cache.update>600&&(clearInterval(this._cache.intClear),this._cache=null,this._cacheFix=1/0,this._zoom=1/0)},this.record=()=>{if(this._cache)this._cache.update=Date.now(),this._zoom=this._store[s.U_].zoomStore.value;else{let e=document.querySelector(".timeline-bd");if(!e){console.error("[Zoom ViewportAmend] cant find `.timeline-bd`.");return}let{width:t}=e.getBoundingClientRect(),{scrollLeft:i}=e,{zoomStore:o,operationWidth:l}=this._store[s.U_],{duration:d,currentSeekTime:c}=this._store[s.U_],u=(0,r.vY)(o.value,c);if((0,r.vY)(o.value,d)*a.Kr<t){this._cacheFix=u,this._zoom=o.value;return}let h=isFinite(this._cacheFix)&&!(0,n.vX)(l+u-i,[0,t])?this._cacheFix:l+u-i;this._cache={update:Date.now(),intClear:setInterval(this._intervalClear,300),$bd:e,bdWidth:t,fixLeft:h},this._zoom=o.value}},this.amend=function(e){var i,n;let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=arguments.length>2?arguments[2]:void 0;if(!(null===(i=t._cache)||void 0===i?void 0:i.$bd)||!isFinite(null===(n=t._cache)||void 0===n?void 0:n.fixLeft))return;let{operationWidth:l,zoomStore:d,currentSeekTime:c}=t._store[s.U_];a&&(t._cache.$bd.scrollLeft=l+(0,r.vY)(d.value,c)-t._cache.fixLeft),null==o||o(e,t._zoom)}}}},169845:function(e,t,i){i.d(t,{m:function(){return u}});var n=i(587892),r=i(143333),a=i(690674),s=i(404172),o=i(979159),l=i(858151),d=i(136498),c=i(426336);class u{get onDataChange(){return this._onDataChange.event}bindIdRelation(e,t){this._relationIdMap.set(e,t)}getRelationId(e){return this._relationIdMap.get(e)}deleteRelationId(e){return this._relationIdMap.delete(e)}addPlaceholderSegment(e,t,i){let n=(0,o.pw)(e,t.start,i);return n.loading=!0,this.addSegment(n,{start:t.start,needInsertTargetTrack:!!t.needInsertTargetTrack,duration:n.duration,trackIndex:t.trackIndex})}removePlaceholderSegment(e,t){return this.removeSegment(e,t)}addPlaceholderTracks(e){let t=this._tracksOperationChangeStorage.addTracks(e);return!this._isBatchMode&&this._submitChange(),t.map(e=>e.value.id)}removePlaceholderTracks(e){this._tracksOperationChangeStorage.removeTracks(e),!this._isBatchMode&&this._submitChange()}addPlaceholderTransition(e,t,i){let{segment:n,trackId:r}=(0,d.pP)(this._timelineManagerStore[a.U_].tracks,i);if(n){var s;let i=this._tracksOperationChangeStorage.addTransitions([{segment:n,material:e,resourceType:t,trackId:r}]);return!this._isBatchMode&&this._submitChange(),null!==(s=i[0])&&void 0!==s?s:""}return""}removePlaceholderTransition(e){this._tracksOperationChangeStorage.removeTransitions([e]),!this._isBatchMode&&this._submitChange()}takeoutSegmentsFromTracks(e){this._sequenceDataOperationStorage.takeoutSegments(e);let{tracks:t}=this._timelineManagerStore[a.U_],i=new Set(e);if(t.length>=1){let[e]=t[0],n=e.segments,r=0n;for(let t of n){if(i.has(t.id)){r+=t.duration;continue}this._segmentTimeRangeChangeStorage.setSegmentTimeRange({trackId:e.id,segment:t,timeRange:{start:t.start-r,duration:t.duration}})}}!this._isBatchMode&&this._submitChange()}resumeSegmentsToTracks(){this._sequenceDataOperationStorage.resumeAllSegmentOperationChange(),this._segmentTimeRangeChangeStorage.resumeAllSegmentTimeRange(),!this._isBatchMode&&this._submitChange()}resumeTracksToTracks(){this._sequenceDataOperationStorage.resumeAllTrackOperationChange(),!this._isBatchMode&&this._submitChange()}takeoutTracksFromTracks(e){this._sequenceDataOperationStorage.takeoutTracks(e),!this._isBatchMode&&this._submitChange()}addSegment(e,t){if(t.needInsertTargetTrack){let{value:i}=this._tracksOperationChangeStorage.addTracks([{trackType:e.type?(0,s.t)(e.type):c.pNd.TrackTypeNone,trackIndex:t.trackIndex}])[0],n=this._tracksOperationChangeStorage.addSegments([{segment:e,trackId:i.id}]);return!this._isBatchMode&&this._submitChange(),n[0].value.id}{let[i]=this._timelineManagerStore[a.U_].tracks[t.trackIndex],n=this._tracksOperationChangeStorage.addSegments([{segment:e,trackId:i.id}]),{value:r}=n[0],{start:s,duration:o}=r,{segments:l}=i,d=l.findIndex(e=>e.start>=s);if(-1!==d){if(0===t.trackIndex)for(let e=d;e<l.length;e++){let t=l[e];this._segmentTimeRangeChangeStorage.setSegmentTimeRange({segment:t,timeRange:{start:t.start+o,duration:t.duration},trackId:i.id})}else{let e=l.findIndex(e=>e.start>=s&&e.start<s+o);if(e>=0){let t=s+o-l[e].start;for(let n=e;n<l.length;n++)this._segmentTimeRangeChangeStorage.setSegmentTimeRange({segment:l[n],timeRange:{start:l[n].start+t,duration:l[n].duration},trackId:i.id})}}}return!this._isBatchMode&&this._submitChange(),n[0].value.id}}removeSegment(e,t){let i=this._tracksOperationChangeStorage.getSegmentInfo(e);if(!i)return;let{trackId:n,value:r}=i;if(this._tracksOperationChangeStorage.removeSegment([e]),(0,l.sH)(n))this._tracksOperationChangeStorage.removeTracks([n]);else if(t){let e=this._timelineManagerStore[a.U_].tracks.find(e=>{let[t]=e;return t.id===n});if(e){let[t]=e,{segments:i}=t;i.filter(e=>e.start>=r.start+r.duration).map(e=>e.id).forEach(e=>{this._segmentTimeRangeChangeStorage.resumeSegmentTimeRange(e)})}}!this._isBatchMode&&this._submitChange()}batchStart(){this._isBatchMode=!0}batchEnd(){this._isBatchMode=!1,this._submitChange()}clear(){this._tracksOperationChangeStorage.clear(),this._segmentTimeRangeChangeStorage.clear(),this._segmentTimeRangeChangeStorage.clear()}_submitChange(){let e=this._tracksOperationChangeStorage.getDataChange(),t=this._sequenceDataOperationStorage.getDataChange(),i=this._segmentTimeRangeChangeStorage.getDataChange();this._onDataChange.fire({segments:[...e.segments,...t.segments,...i.segments],tracks:[...e.tracks,...t.tracks,...i.tracks]}),this._tracksOperationChangeStorage.resetDataChange(),this._sequenceDataOperationStorage.resetDataChange(),this._segmentTimeRangeChangeStorage.resetDataChange()}constructor(e){this._timelineManagerStore=e,this._tracksOperationChangeStorage=new r.G0(this._timelineManagerStore),this._sequenceDataOperationStorage=new r.E0(this._timelineManagerStore),this._segmentTimeRangeChangeStorage=new r.tP,this._onDataChange=new n.Q,this._relationIdMap=new Map,this._isBatchMode=!1}}},602115:function(e,t,i){i.d(t,{F:function(){return a}});var n=i(260963),r=i(446352);class a{setVideoPreviewLoaded(e){this.videoPreviewLoaded=e}setVideoPreviewStatus(e){this.videoPreviewStatus=e}setVideoPreviewDuration(e){this.videoPreviewDuration=e}setVideoPreviewProgress(e){this.videoPreviewProgress=e}setVeSdkRendered(e){this.veSdkRendered=e}setIsPreviewMaterial(e){this.isPreviewingMaterial=e}setHasFirstFrame(e){this.hasFirstFrame=e}setUnionPlaying(e){this.unionPlaying=e}constructor(){this.unionPlaying=!1,this.hasFirstFrame=!1,this.veSdkRendered=!1,this.videoPreviewStatus=r.bC.None,this.videoPreviewLoaded=!1,this.videoPreviewPlaying=!1,this.videoPreviewProgress=0,this.videoPreviewDuration=0,this.isPreviewingMaterial=!1,(0,n.ky)(this)}}},854146:function(e,t,i){i.d(t,{k:function(){return r}});var n=i(260963);class r{registerDataUpdateEvent(e){e(e=>{Object.keys(e).forEach(t=>{switch(t){case"selectedLineAndWord":e[t]&&this.setSelectedLineAndWord(e[t]);break;case"willDeleteLineAndWord":e[t]&&this.setWillDeleteLineAndWord(e[t]);break;case"trackId":e[t]&&this.setTrackId(e[t]);break;case"resourceUuidMap":e[t]&&this.setResourceUuidMap(e[t])}})})}setSelectedLineAndWord(e){this.selectedLineAndWord=e}setWillDeleteLineAndWord(e){this.willDeleteLineAndWord=e}setTrackId(e){this.trackId=e}setResourceUuidMap(e){this.resourceUuidMap=e}constructor(){this.selectedLineAndWord=[],this.willDeleteLineAndWord=[],this.trackId="",this.resourceUuidMap={},(0,n.ky)(this)}}},810233:function(e,t,i){i.d(t,{c:function(){return r}});var n=i(928261);function r(e,t){return!!t&&e.some(e=>{var i,r;return i=e,r=t,"function"!=typeof i?i===r.type:(0,n.IM)(r)?i(r):i(r)})}},767373:function(e,t,i){i.d(t,{BQ:function(){return a},Pc:function(){return o},VB:function(){return s},_m:function(){return l}});var n=i(969242),r=i(907031);function a(e){e.sort((e,t)=>e.startY-t.startY)}function s(e,t){let i;if("before"===e)i={startY:t.endY,endY:t.endY+r.Zn};else if("after"===e)i={startY:t.startY-r.Zn,endY:t.startY};else throw Error("invalid code position");return{position:e,...t,...i}}function o(e,t,i,r){let a=new Map;for(let e of i)a.set(e.id,{startY:e.startY,endY:e.endY});return r.map(i=>(function(e,t,i,r){let a=i.get(r.trackId);if(!a)return;if("transition"===e){let{startY:e,endY:i}=a,s=(0,n.vY)(t,r.start),o=(0,n.vY)(t,r.start+r.duration);return{id:r.id,trackId:r.trackId,startY:e,endY:i,startX:s,endX:o,centerX:(s+o)/2,centerY:(e+i)/2}}})(e,t,a,i)).filter(Boolean)}function l(e){e.sort((e,t)=>{let i=e.startY-t.startY;return 0!==i?i:"before"===e.position?-1:"before"===t.position?1:0})}},891344:function(e,t,i){i.d(t,{n:function(){return m}});var n=i(690674),r=i(112825),a=i(586703),s=i(804497),o=i(426336),l=i(544009),d=i(728631),c=i(710763),u=i(956626),h=i(199811);function g(e,t){return(1!==e.length||1!==t[n.qk].topLevelSelectedSegmentIds.length||t[n.qk].topLevelSelectedSegmentIds[0]!==e[0])&&!0}async function m(e){let{segmentIds:t,transitionIds:i,action:m,store:f,modules:p,containerService:_,mouseAction:v}=e,S=t,T=i,M=[...t,...i];!M.length&&p.coordinate.context.event.emit(r.B.contextmenuVisible,!1),f[n.U_];let{isBatchReplacePanelVisible:y,isTemplate:k}=f[n.U_],{isEditingTemplate:x,subDraftSegment:I}=f[n.qk],{timelineSelection:D,player:b,sider:E,draftOperation:C}=p,w=!1,N=!1;if((x||y)&&M.length){var A,j,O;let e,t;let{tracksMutable:i}=f[n.U_],{segmentId:r}=f[n.qk];for(let[n]of i){for(let i of n.segments){if(i.id===M[0]){e=i;break}if(null===(O=i.mutable)||void 0===O?void 0:O.children)for(let e of i.mutable.children)e.id===M[0]&&(t=e)}if(e)break}if((null==e?void 0:e.type)==="mutablePoly"&&(null===(j=e.mutable)||void 0===j?void 0:null===(A=j.children)||void 0===A?void 0:A.length)){if(w=!0,e.mutable.children.some(e=>{let{id:t}=e;return r===t}))S=[],T=[];else{let t;for(let i of e.mutable.children)if(!i.mutable.filled){t=i;break}!t&&(t=e.mutable.children[0]),e=t,S=[t.id]}}if(N=!(M.length===f[n.qk].canvasUISelectedSegmentIds.length&&M.every(e=>f[n.qk].canvasUISelectedSegmentIds.includes(e))),(null==e?void 0:e.type)==="mutable"){if(M[0]){if(b.pause(),!e)return{transitionIds:[],segmentIds:[]};let{mutable:t}=e,{locked:i=!1}=t||{},n=i?(0,a.H_)(e,I):await (0,l.HA)(e.id,I,p.coordinate.renderManager,p.dataSdk,p.selection);if(null===n)return{transitionIds:[],segmentIds:[]};p.player.timelineSeek(n,!1)}}else if((null==t?void 0:t.type)==="mutable"){if(M[0]){if(b.pause(),!t)return{transitionIds:[],segmentIds:[]};let{mutable:e}=t,{locked:i=!1}=e||{},n=i?(0,a.H_)(t,I):await (0,l.HA)(t.id,I,p.coordinate.renderManager,p.dataSdk,p.selection);if(null===n)return{transitionIds:[],segmentIds:[]};p.player.timelineSeek(n,!1)}}else(null==e?void 0:e.type)==="mutableAudio"&&E.siderActiveTabSet(d.j.SiderMenuAudio)}x&&!M.length&&f[n.qk].canvasUISelectedSegmentIds.length&&(N=!0);let L=!1;if((!k||N)&&("box_select"===m?M.length<=1||f[n.qk].canvasUISelectedSegmentIds.length<=1?(g(M,f)&&D.updatePrepareSelectData({segmentIds:S,transitionIds:T}),L=!1):(L=!0,D.updatePrepareSelectData({segmentIds:S,transitionIds:T})):g(M,f)&&(x&&M.length,D.updateSelectData({segmentIds:S,transitionIds:T}))),!x&&1===M.length){let{[n.U_]:{tracks:e}}=f,[t]=(0,s.kQ)(e,M);t&&("text"===t.type&&t.metaType===o.cVg.MetaTypeSubtitle||"text"===t.type&&t.metaType===o.cVg.MetaTypeLyrics)&&E.siderActiveTabSet(d.j.SiderMenuCaption)}let P=()=>{(0,u.SH)(_,{action_type:u.kO.CLICK,option_type:u.Ds.SELECT,action_position:u.X3.VIDEO,position_type:y?u.o7.BATCH_REPLACE:u.o7.TIMELINE,...(0,h.N)(M[0],w,f[n.U_].tracksMutable)})};if(M.length){let{draftView:e}=p.dataSdk,t=e.getSegmentById(M[0]);if(t&&(0,o.duj)(t)&&!x&&"mouse_up"===v&&P(),x&&N)"mouse_up"!==v&&P();else{let{segment:t}=f[n.qk],i=f[n.qk].selectedSegmentIds,r=f[n.qk].segmentSelected.filter(e=>"transition"===e.type).map(e=>e.id);1===M.length&&"click"===m&&t||M.length>0&&("cmd_click"===m?(0,c.r)(_,(0,c.T)({ids:i,action:"select",draftView:e,transitionIds:r})):"cmd_click_cancel"===m&&(0,c.r)(_,(0,c.T)({ids:i,action:"unselect",draftView:e,transitionIds:r})))}}return L?{segmentIds:S,transitionIds:T}:{segmentIds:[],transitionIds:[]}}},199811:function(e,t,i){i.d(t,{N:function(){return a}});var n=i(956626),r=i(426336);function a(e,t,i){let a=n.U4.TRACK,s=0;for(let o of((i[0]||[])[0]||{segments:[]}).segments){if(o.id===e){a=n.U4.TRACK,s=Math.ceil(r.pMA.div(o.duration,1e6));break}if(o.mutable.children)for(let i of o.mutable.children)i.id===e&&(t?(a=n.U4.TRACK,s=Math.ceil(r.pMA.div(o.duration,1e6))):(a=n.U4.BUBBLE,s=Math.ceil(r.pMA.div(i.duration,1e6))))}return{clip_type:a,clip_duration:s}}},586703:function(e,t,i){i.d(t,{H_:function(){return u},Hf:function(){return h},Qg:function(){return s},cO:function(){return l},d9:function(){return d},dl:function(){return c},gz:function(){return g},mM:function(){return o}});var n=i(632555),r=i(857670),a=i(464533);function s(e,t){if(!t)return!1;let{x:i,y:r}=t,{left:a,right:s,bottom:o,top:l}=e;return(0,n.mK)(i,[a,s])&&(0,n.mK)(r,[l,o])}function o(e,t){let{left:i,right:r}=e,{left:a,right:s}=t;return(0,n.mK)(i,[a,s])&&(0,n.mK)(r,[a,s])}function l(e,t){let{left:i,right:r}=e,{left:a,right:s}=t;return(0,n.mK)(i,[a,s])||(0,n.mK)(r,[a,s])}function d(e,t,i){return e<t||e>i}function c(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t-e;return r<=a.sD+a.Rd?t<i||e>n:t-a.sD-a.Rd<i||e+a.sD+a.Rd>n}let u=(e,t)=>{var i,n;let{mutable:a}=e,{locked:s=!1}=a||{};if(!s)return null;let o=null!==(n=null==t?void 0:null===(i=t.targetTimerange)||void 0===i?void 0:i.start)&&void 0!==n?n:0n,{start:l,duration:d}=e,c=l+o,u=(0,r.i1)(c,"ceil");return u>c+d?(0,r.i1)(c+d,"floor"):u},h=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=e.findIndex(e=>e.id===t);if(-1===n)return null;for(let t=n+1;t<e.length;++t)if(!e[t].filled&&e[t].visible&&!i.includes(e[t].id))return e[t];for(let t=0;t<n;++t)if(!e[t].filled&&e[t].visible&&!i.includes(e[t].id))return e[t];return null};function g(e,t){return t?e.filter(e=>t.find(t=>t.id===e)):[]}},969167:function(e,t,i){i.d(t,{Jj:function(){return o},w1:function(){return d}});var n=i(119946),r=i(49299),a=i(426336),s=i(801497);function o(e,t,i){var o,l;let d="crop"===i||"update"===i?e.filter(e=>e.id!==t.id):e;return!("video"===t.type&&(0,r.iI)(t.path))||(o=d,l=t,!!(0>=function(e){if(!e.length)return 0;let t=e.length,i=[];for(let s=0;s<t;s++)for(let o=s+1;o<t;o++){var n,r;let t=(n=e[s],r=e[o],[a.pMA.max([n[0],r[0]],"bigint"),a.pMA.min([n[1],r[1]],"bigint")]);t[1]>t[0]&&i.push(t)}return function(e){if(!e.length)return 0;e.sort((e,t)=>a.pMA.minus(e[1],t[1]));let t=e.length,i=e[0][1],n=1;for(let r=1;r<t;++r)e[r][0]>=i&&(++n,i=e[r][1]);return t-n}(i)}(o.concat(l).map(e=>[e.start,e.start+e.duration]))))||(n.FN.normal(s.oc.t("in_the_fast_import_state__only_2_picture_in_picture_tracks_are_supported_at_the_",{},"\u5FEB\u901F\u5BFC\u5165\u72B6\u6001\u4E0B\uFF0C\u540C\u4E00\u65F6\u95F4\u70B9\u4F4D\u7F6E\u4EC5\u652F\u63012\u6761\u753B\u4E2D\u753B\u8F68\u9053")),!1)}function l(e){return(e.type===a.pNd.TrackTypeVideo||e.type===a.pNd.TrackTypeAudio)&&(0,r.iI)(e.path)}function d(e){return e.reduce((e,t)=>{let[i,n]=t;return i.type===a.pNd.TrackTypeAudio||i.type===a.pNd.TrackTypeVideo?e.concat(i.segments.filter(l)):e},[])}},799985:function(e,t,i){i.d(t,{Kz:function(){return a},PG:function(){return s},dn:function(){return l},s2:function(){return o},uJ:function(){return d}});var n=i(426336),r=i(932099);function a(e,t){let[i]=t;return i&&(e-=n.pMA.div(i.duration,2,"bigint")),e}function s(e,t){let[i]=t;return i&&(e+=n.pMA.div(i.duration,2,"bigint")),e}function o(e,t){"bigint"!=typeof e&&(e=e.targetTimerange.duration),"bigint"!=typeof t&&(t=t.targetTimerange.duration);let i=n.pMA.div(e,2,"bigint"),r=n.pMA.div(t,2,"bigint");return n.pMA.max([0,n.pMA.min([5e6,r,i],"bigint")],"bigint")}function l(e){let{transitionStartX:t,transitionEndX:i,posX:n,areaWidth:r}=e;return n<t&&t-n<=r?"pre":n>i&&n-i<=r?"next":void 0}function d(e,t){"bigint"!=typeof e&&(e=e.targetTimerange.duration),"bigint"!=typeof t&&(t=t.targetTimerange.duration);let i=n.pMA.min([e,t],"bigint");if(i>=10000000n)return r.u$;if(i>=1000000n)return r.u$;if(i>=200000n)return 100000n;else return-1n}},675058:function(e,t,i){i.d(t,{Z:function(){return m}});var n=i(772322),r=i(218571),a=i(268978),s=i(799985),o=i(969242),l=i(426336),d=i(670933),c=i(690674),u=i(337081),h=i(937802),g=i(108692);let m=(0,d.f3)("store")((0,d.Pi)(e=>{var t,i;let{track:d,segment:m,prev:f,zoom:p,hideTitle:_,store:v,thumbnail:S}=e,{start:T,duration:M,slots:y,id:k}=m,x=(0,h.G)(g.n),I=null==f?void 0:f.slots.find(e=>"transition"===e.type),D=y.find(e=>"transition"===e.type),b=!!(null===(t=v[c.U_].checkListManagerObserveData.vipSegmentsMap)||void 0===t?void 0:t[k]),{vipBadgeType:E}=v[c.U_].checkListManagerObserveData,C=m.templateId?v[c.jU].templateIdToInfo[m.templateId]:void 0,w=!!(null==C?void 0:C.mute),N=null==m?void 0:null===(i=m.materialDraft)||void 0===i?void 0:i.draft.getDraftId(),[A,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{j(!!(N&&C&&(0,u.cS)(N,x.dataSdk.cutSame,C)))},[N,C]);let O=(0,r.useMemo)(()=>(0,o.vY)(p,T),[p,T]),L=(0,r.useMemo)(()=>(0,o.vY)(p,l.pMA.max([1,M],"bigint")),[p,M]),P=(0,r.useMemo)(()=>{let e=(0,s.Kz)(0n,[I]);return(0,o.vY)(p,e)},[p,null==I?void 0:I.duration]),R=(0,r.useMemo)(()=>{let e=(0,s.PG)(0n,[D]);return(0,o.vY)(p,-e)},[p,null==D?void 0:D.duration]),U="combination"===m.type;return(0,n.jsx)(a.Z,{segment:m,zoom:p,active:!0,display:{bodyLeft:O,bodyWidth:L,borderLeft:P,borderRight:R},trackId:d.id,hideTitle:_,disableInteract:U,isVip:b,vipBadgeType:E,thumbnail:S,isTemplateMusicNoCopyRight:w&&!A})}))},398016:function(e,t,i){i.d(t,{R:function(){return u}});var n=i(772322),r=i(928261),a=i(578186),s=i(969242),o=i(771380),l=i(268978),d=i(426336),c=i(277346);function u(e,t,i){if((0,r.Xe)(e))return(0,a.G)((0,o.renderToString)((0,n.jsx)(c.Z,{className:"segment-fix-stroke",transition:e,zoom:t,edgeWidth:1})));{var u;let r=(0,a.G)((0,o.renderToString)((0,n.jsx)(l.Z,{className:"segment-fix-stroke",segment:{...e,start:0n,fades:void 0},zoom:t,display:{bodyLeft:0,bodyWidth:(0,s.vY)(t,e.duration),borderLeft:0,borderRight:0},trackId:`${Math.floor(1e6*Math.random())}`,hideTitle:(null==i?void 0:null===(u=i[e.type])||void 0===u?void 0:u.title)===!1,mediaAlawaysShowTitle:!0}))),h=e.slots.find(e=>"transition"===e.type);if(h){let i=(0,a.G)((0,o.renderToString)((0,n.jsx)(c.Z,{className:"segment-fix-stroke segment-fix-position",transition:h,zoom:t,edgeWidth:1,start:e.duration-d.pMA.div(h.duration,2,"bigint")})));r.appendChild(i)}return r}}},268978:function(e,t,i){i.d(t,{Z:()=>k});var n=i("772322");i("837510");var r=i("948747"),a=i("218571"),s=i("670933"),o=i("105789"),l=i.n(o),d=i("150564"),c=i("235204"),u=i("969242"),h=i("257296"),g=i("907031"),m=i("783750"),f=i("149795"),p=i("708531"),_=i("801497"),v=i("584341"),S=i("426336"),T=i("76350"),M=i("456193");function y(e){let{type:t}=e;switch(t){case"video":return(0,n.jsx)(n.Fragment,{children:_.ZP.t("web_materialSearch_text_lost_video",{},"Lost video")});case"audio":return(0,n.jsx)(n.Fragment,{children:_.ZP.t("web_materialSearch_text_lost_audio",{},"Lost audio")});case"text":case"textTemplate":return(0,n.jsx)(n.Fragment,{children:_.ZP.t("web_materialSearch_text_lost_text",{},"Lost text")});case"sticker":return(0,n.jsx)(n.Fragment,{children:_.ZP.t("web_materialSearch_text_lost_sticker",{},"Lost sticker")});case"effect":return(0,n.jsx)(n.Fragment,{children:_.ZP.t("web_materialSearch_text_lost_effect",{},"Lost Effect")});case"filter":return(0,n.jsx)(n.Fragment,{children:_.ZP.t("web_materialSearch_text_lost_filter",{},"Lost filter")});case"pictureAdjust":return(0,n.jsx)(n.Fragment,{children:_.ZP.t("adjustment_loss",{},"\u8C03\u8282\u4E22\u5931")});default:return(0,n.jsx)(n.Fragment,{children:_.ZP.t("media_lost",{},"Lost media")})}}let k=(0,s.Pi)(a.forwardRef((e,t)=>{let{segment:i,zoom:a,trackId:s,lost:o,active:k,display:x,className:I,extraTags:D,loading:b,hideTitle:E,mediaAlawaysShowTitle:C,hidden:w=!1,beats:N=[],disableHover:A=!1,disableInteract:j,showSlotConfigBtn:O,isMutable:L,isVip:P,vipBadgeType:R,thumbnail:U,isTemplateMusicNoCopyRight:z}=e,{bodyWidth:B,bodyLeft:V,segmentHeight:F}=x,{id:Y,title:Z,type:Q,duration:W,animations:G=[],fades:H,speed:$,text:K,videoTracking:X}=i,q=(0,c.L)(t,0);q=q||!!C,q=!A&&q;let J=null;(null==H?void 0:H.length)&&(J=H.map(e=>(0,n.jsx)(m.Z,{width:(0,u.vY)(a,e.duration),type:e.type},`${e.type}-${e.duration}`)));let ee=null;if("video"===Q||"combination"===Q){let e=null;b?e=(0,n.jsxs)("div",{style:{position:"relative",alignSelf:"stretch",flexGrow:1,flexShrink:0},children:[U&&(0,n.jsx)(M.Z,{thumbnail:U}),(0,n.jsxs)("div",{className:"segment-screenshot-placeholder",style:{background:"video"===i.type?"var(--lvv-color-black-04)":"var(--lvv-color-fill-transparency-hover)",backdropFilter:"video"===i.type?"unset":"blur(10px)"},children:[(0,n.jsx)(r.Z,{size:16,spinColor:"white"}),(0,n.jsx)("span",{children:_.ZP.t("load_web_ing",{},"\u52A0\u8F7D\u4E2D")})]})]}):U&&(e=(0,n.jsx)(M.Z,{thumbnail:U})),ee=(0,n.jsxs)("div",{className:"segment-bd",style:{height:F},children:[e,J]})}else if("audio"===Q){let e;b?e=(0,n.jsxs)("div",{className:"segment-screenshot-placeholder",children:[(0,n.jsx)(r.Z,{size:16,spinColor:"white"}),"\xa0",(0,n.jsx)("span",{children:_.ZP.t("load_web_ing",{},"\u52A0\u8F7D\u4E2D")})]}):U&&(e=(0,n.jsx)(M.Z,{thumbnail:U})),ee=(0,n.jsxs)("div",{className:"segment-bd",style:{height:F},children:[e,J]})}let et=["video","audio","combination"].includes(Q);return(0,n.jsx)("div",{ref:t,"data-id":Y,"data-track-index":s,className:l()("segment","segment-base",I,`type-${Q}`,o?"lost":void 0,k&&"active",q&&"hover",{"segment-hidden":w,lockable:O}),style:{left:V,width:B,height:F},children:(0,n.jsxs)("div",{className:l()("segment-inner",{lockable:O,locked:O&&!L}),children:[o&&(0,n.jsx)("div",{className:"segment-mask"}),!j&&("audio"===Q&&N.length,null),(0,n.jsx)("div",{className:l()({"segment-active-box":!0,active:k}),style:{left:0,right:0},children:!j&&B>h._H&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:g.i,className:"segment-active-box-edge front cursor-segment-front"}),(0,n.jsx)("div",{id:g.SA,className:"segment-active-box-edge rear cursor-segment-rear"})]})}),(0,n.jsx)("div",{className:l()("segment-hd",{active:k,hover:q,normal:!o&&!b}),style:{height:F},children:!et&&b?(0,n.jsxs)("div",{className:"segment-screenshot-placeholder",children:[(0,n.jsx)(r.Z,{size:16,spinColor:"white"}),(0,n.jsx)("span",{children:_.ZP.t("load_web_ing",{},"\u52A0\u8F7D\u4E2D")})]}):(0,n.jsxs)(n.Fragment,{children:["combination"===Q&&(0,n.jsxs)("div",{className:"segment-hd-group template-tag",children:[(0,n.jsx)("div",{className:"segment-icon",children:(0,n.jsx)(d.BdQ,{className:"iconpark-icon",size:12})}),(0,n.jsx)("div",{className:"segment-title template-tag-title",children:_.ZP.t("web_templates",{},"Template")})]}),z&&(0,n.jsxs)("div",{className:"segment-hd-group template-tag template-tag-red",children:[(0,n.jsx)("div",{className:"segment-icon",children:(0,n.jsx)(d.v3j,{className:"iconpark-icon",size:12})}),(0,n.jsx)("div",{className:"segment-title template-tag-title",children:_.ZP.t("cc4b_editor_template_muted_tag",{},"Music muted due to copyright restrictions")})]}),$&&1!==$&&(0,n.jsxs)("div",{className:"segment-hd-group group-speed",children:[(0,n.jsx)("div",{className:"segment-icon",children:(0,n.jsx)(d.fDY,{className:"iconpark-icon"})}),(0,n.jsx)("div",{className:"segment-title speed",children:`${null==$?void 0:$.toFixed(2)}x`})]}),null==D?void 0:D.map(e=>(0,n.jsx)("div",{className:"segment-hd-group",children:(0,n.jsx)("div",{className:"segment-title",children:e},e)},e)),o?(0,n.jsxs)("div",{className:"segment-hd-group group-lost",children:[(0,n.jsx)(d.v3j,{className:"iconpark-icon"}),(0,n.jsx)("div",{className:"segment-title",children:(0,n.jsx)(y,{type:Q})})]}):null,P&&(0,n.jsx)(T.sx,{className:l()({"segment-icon-pro":"legacy-vip"===R,"segment-icon-pro-svip":"legacy-vip"!==R}),forceBadgeType:R,diamondColor:"white"}),(0,n.jsx)("div",{className:"segment-hd-group",children:E?null:(0,n.jsx)("div",{className:"segment-title",children:function(e,t,i){if("text"===e){if(!t||"\b"===t||""===t.trim())return(null==i?void 0:i.materialType)===S.cVg.MetaTypeSubtitle||(null==i?void 0:i.materialType)===S.cVg.MetaTypeLyrics?_.ZP.t("subtitle_content",{},"Captions"):_.ZP.t("web_text",{},"\u6587\u672C")}else if("textTemplate"===e)return _.ZP.t("text_overlay",{},"\u6587\u5B57\u6A21\u677F");else if("sticker"===e)return _.ZP.t("sticker_web_s",{},"\u8D34\u7EB8");return t}(Q,Z,K)})}),(null==X?void 0:X.enableVideoTracking)&&(0,n.jsxs)("div",{className:"segment-hd-group segment-tracking",children:[(0,n.jsx)("div",{className:"segment-icon",children:(0,n.jsx)(d.nHE,{className:"iconpark-icon",size:12})}),(0,n.jsx)("div",{className:"segment-title",children:_.ZP.t("web_elements_label_text_tracking",{},"Tracking")})]}),et&&(0,n.jsx)("div",{className:"segment-hd-group",children:(0,n.jsx)("div",{className:"segment-title",children:(0,v.ci)(S.pMA.div(W,1e3),"?mm:ss:ff",30,!0)})}),!b&&["audio"].includes(Q)&&(0,n.jsxs)("div",{className:"segment-audio-info",children:[p.LM[i.metaType],(0,n.jsx)("div",{className:"segment-title",children:i.title})]})]})}),ee,G.map(e=>{var t,r,s,o,l,d;let{duration:c}=e,h=0n,g=0n;if("loop"===e.type){let e=null!==(s=null===(t=G.find(e=>"in"===e.type))||void 0===t?void 0:t.duration)&&void 0!==s?s:0n,n=null!==(o=null===(r=G.find(e=>"out"===e.type))||void 0===r?void 0:r.duration)&&void 0!==o?o:0n;c=i.duration-e-n,h=e,g=n}if("group"===e.type){let e=G.find(e=>"group"===e.type);g=(h=null!==(l=null==e?void 0:e.start)&&void 0!==l?l:0n)+(null!==(d=null==e?void 0:e.duration)&&void 0!==d?d:0n)}return(0,n.jsx)(f.Z,{type:e.type,width:Math.min(B-18,(0,u.vY)(a,c)),left:(0,u.vY)(a,h),right:(0,u.vY)(a,g),isOnlyOne:1===G.length},`${e.type}-${e.duration}`)}),(0,n.jsx)("div",{className:"segment-lost",children:(0,n.jsxs)("div",{className:"segment-lost-inner",children:[(0,n.jsx)(d.v3j,{className:"iconpark-icon"}),(0,n.jsx)("div",{className:"segment-lost-content",children:(0,n.jsx)(y,{type:Q})})]})}),(0,n.jsx)("div",{className:l()({"segment-hover-border":q})})]})})}))},370924:function(e,t,i){i.d(t,{Z:function(){return p}});var n=i(772322),r=i(953032),a=i(218571),s=i(670933),o=i(633282),l=i(212233),d=i(907031),c=i(969242),u=i(690674),h=i(961471),g=i(426336),m=i(632555),f=i(641276);let p=(0,s.f3)("store","modules")((0,s.Pi)(e=>{let{store:t,modules:i,scrollWrapRef:s}=e,{viewportStart:p,zoomStore:_,operationWidth:v,isTemplate:S,loading:T,axisMarkerStore:M,progress:y}=t[u.U_],k=(0,a.useRef)(null),x=(0,a.useRef)(p),I=(0,a.useRef)(v),D=(0,a.useRef)(!1),b=(0,a.useMemo)(()=>!S&&T,[S,T]),E=(0,a.useCallback)(()=>{if(!b)!function(e){let{$canvas:t,retinaMultiple:i,zoom:n,start:r,offsetLeft:a,markers:s=[],progress:l}=e;if(!t)return;let d=t.getContext("2d");if(!d)return;let{width:u,height:h}=t;d.clearRect(0,0,u,h),d.lineWidth=1;let f=function(e,t,i,n){let r=t+(0,c.TF)(n,i);return e.filter(e=>(0,m.mK)(e,[t,r]))}(s,r,u,n);f.length&&f.forEach(e=>{let t=((0,c.vY)(n,g.pMA.minus(e,r,"bigint"))+a)*i;(0,o.d)(d,i,t,l===e)}),d.closePath()}({$canvas:k.current,retinaMultiple:d.Ue,zoom:_.value,start:p,offsetLeft:I.current,markers:M.markers,progress:y})},[b,_.value,p,M.markers,y]),{run:C}=(0,r.default)(()=>{var e,t;let i=null!==(t=null===(e=s.current)||void 0===e?void 0:e.scrollLeft)&&void 0!==t?t:0;x.current=(0,c.TF)(_.value,Math.max(i-v,0)),I.current=i>v?0:v-i,E()},16);return(0,a.useEffect)(()=>{C()},[k,v,_.value]),(0,a.useEffect)(()=>{let e=new ResizeObserver(e=>{e.length&&k.current&&(k.current.width=e[0].contentRect.width*d.Ue,k.current.height=e[0].contentRect.height*d.Ue,E())});if(k.current){let{width:t,height:i}=k.current.getBoundingClientRect();k.current.width=t*d.Ue,k.current.height=i*d.Ue,e.observe(k.current)}return()=>{e.disconnect()}},[E,C]),(0,a.useEffect)(()=>{var e;return null===(e=s.current)||void 0===e||e.addEventListener("scroll",C,{passive:!0}),()=>{var e;null===(e=s.current)||void 0===e||e.removeEventListener("scroll",C)}},[C,s.current]),(0,a.useEffect)(()=>{let e=(0,f.V)(i.event.onTimelineAxisMarkerAdd)(e=>{if(D.current)return;D.current=!0;let t=(0,c.vY)(_.value,e.marker)+v-4;i.timelineUI.guide.showRefPlayerMarkerGuide(t)});return()=>{e.dispose()}},[_.value,v]),(0,n.jsx)("div",{className:l.Z.timelineAxisMarkerContainer,style:{left:"48px"},children:(0,n.jsx)(h.Z,{viewOffset:p,leftOffsetRef:I,children:(0,n.jsx)("canvas",{id:"timeline-axis-marker-canvas",className:l.Z.markersCanvas,ref:k})})})}))},520486:function(e,t,i){i.d(t,{I:function(){return c}});var n=i(402655),r=i(690674),a=i(260963),s=i(563890),o=i(257296),l=i(801497),d=i(426336);class c extends n.JT{bindDataChangeListeners(e){let t=(0,a.U5)(()=>{let{mainTrackMuted:e,subTrackIdToMuted:t}=this._timelineManagerStore[r.U_];return{mainTrackMuted:e,subTrackIdToMuted:t}},()=>{(0,s.Mq)(e.children,[o.KX.Segment]).forEach(e=>{let{data:t}=e;if(!e.destroyed)e.updateData(this.getProps(t.segment,t.track),!0)})});this._register({dispose:t})}getProps(e,t){var i,n;let{mainTrackMuted:r,subTrackIdToMuted:a,computedTracksMain:s}=this._timelineManagerStore.timelineStore,o=[],d=l.ZP.t("silenced",{},"\u5DF2\u9759\u97F3"),c=null===(i=s[0])||void 0===i?void 0:i[0].id,u=!1;t.id!==c&&(u=null!==(n=a.get(t.id))&&void 0!==n&&n),(c===t.id&&r||u)&&o.push(d);let h=this._getVocalSeparationTag(e);h&&o.push(h);let g=this._getVocalBeautifyTag(e);return g&&o.push(g),{extraTags:o}}_getVocalSeparationTag(e){var t;let i=null===(t=e.vocalSeparation)||void 0===t?void 0:t.choice;if(i)switch(i){case d.ZTd.Vocal:return l.ZP.t("web_isolate_timeline_keep_voice",{},"Keep voice");case d.ZTd.Background:return l.ZP.t("web_isolate_timeline_remove_voice",{},"Remove voice");default:return}}_getVocalBeautifyTag(e){var t;if(null===(t=e.vocalBeautify)||void 0===t?void 0:t.enable)return l.ZP.t("web_enhance_voice_label_enhanced",{},"Voice enhanced")}constructor(e){super(),this._timelineManagerStore=e}}},410463:function(e,t,i){i.d(t,{B:function(){return d}});var n=i(402655),r=i(690674),a=i(260963),s=i(563890),o=i(257296),l=i(337081);class d extends n.JT{bindDataChangeListeners(e){let t=(0,a.U5)(()=>Object.keys(this._timelineManagerStore[r.jU].templateIdToInfo),()=>{for(let t of(0,s.Mq)(e.children,[o.KX.Segment])){if(t.destroyed)continue;let{data:{segment:e,isTemplateMusicNoCopyright:i}}=t,n=this.getProps(e);n.isTemplateMusicNoCopyright!==i&&t.updateData(n,!0)}});this._register({dispose:t})}getProps(e){var t,i;let{templateId:n}=e;if(!n)return{isTemplateMusicNoCopyright:!1};let r=null===(i=e.materialDraft)||void 0===i?void 0:null===(t=i.draft)||void 0===t?void 0:t.getDraftId(),a=this._timelineManagerStore.resourceStore.templateIdToInfo[n],s=this._modules.dataSdk&&r&&a&&(0,l.cS)(r,this._modules.dataSdk.cutSame,a);return{isTemplateMusicNoCopyright:!!((null==a?void 0:a.mute)&&!s)}}constructor(e,t){super(),this._timelineManagerStore=e,this._modules=t}}},70366:function(e,t,i){i.d(t,{w:function(){return o}});var n=i(218571),r=i(257296),a=i(690674),s=i(586703);function o(e){let{setModalLeft:t,setModalTop:i,setArrowLeft:o,setFakeModalWidth:l,segment:d,bubbleRef:c,useMarginEdge:u=!0,segLeftSafeArea:h=0,segRightSafeArea:g=0,store:m,modules:f,isScrollWrapResizing:p=!1,isTimelineVScrolling:_=!1}=e,{[a.U_]:v}=m,{zoomStore:S}=v,{coordinate:T}=f,M=(0,n.useRef)(null);M.current={getBoundingClientRect:()=>d?T.context.registry.getBoundingClientRect(d.id):null};let[y,k]=(0,n.useState)(!1),[x,I]=(0,n.useState)(!1),[D,b]=(0,n.useState)(!1),[E,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{D||E||x?k(!0):k(!1)},[D,x,E]);let w=(e,n)=>{if(!e||!n)return;let a=document.querySelector(".timeline-bd"),d=document.querySelector(".timeline-container"),c=document.querySelector(".timeline-bd-vertical-scroll");if(!a||!d||!M.current)return;let m=M.current.getBoundingClientRect();if(!m)return;let f=e.current.getBoundingClientRect();if(!f)return;let p=null==c?void 0:c.getBoundingClientRect();if(!p)return;let{left:_,top:v,bottom:S}=p,{width:T}=f,{left:y,right:k,top:x}=m,{left:D,right:E,top:w}=a.getBoundingClientRect(),{left:N,right:A}=d.getBoundingClientRect();null==i||i(x-w-r.sc/2),c&&(null==o||o(Math.max(y,D)-_)),I((0,s.d9)(x,v,S)),b(k-D<h),C(E-y<g);let j=Math.max(y,D),O=Math.min(E,k);null==l||l(O-j);let L=Math.max(y,D)+(O-j)/2-T/2+(u?10:0);if(L<N+10){t(N+10);return}if(L>A-T-10){t(A-T-10);return}t(L)},N=(0,n.useCallback)(()=>{w(c,d)},[c.current,d]);return(0,n.useEffect)(()=>{let e;let t=null,i=()=>{(t=document.querySelector(".timeline-bd"))?(t.addEventListener("scroll",N),(e=new ResizeObserver(()=>N())).observe(t)):setTimeout(i,500)};return i(),()=>{null==t||t.removeEventListener("scroll",N),null==e||e.disconnect()}},[c.current]),(0,n.useEffect)(()=>{N()},[S.value,p,_]),(0,n.useEffect)(()=>{d&&N()},[d]),[y,D,E,w]}},368794:function(e,t,i){i.d(t,{L:function(){return l}});var n=i(218571),r=i(969242),a=i(763832),s=i(690674),o=i(260963);let l=e=>{let{store:t,scrollWrapRef:i}=e,{zoomStore:l,isCollapseTimeline:d}=t[s.U_],c=(0,n.useRef)(!1),u=(0,n.useRef)(!1),h=(0,n.useRef)(!1);(0,n.useEffect)(()=>{var e;let n=()=>{!c.current&&u.current&&!d&&(h.current=!0)},g=async(e,t,n)=>{if(i.current&&n&&!h.current){let n=(0,r.vY)(t,e),{scrollLeft:s,offsetWidth:o}=i.current;(o+s<n||s>n)&&(c.current=!0,i.current.scroll({left:n}),await (0,a._)(16),u.current=!0,c.current=!1)}},m=(0,o.U5)(()=>({currentSeekTime:t[s.U_].currentSeekTime,zoomValue:l.value,unionPlaying:t[s.VT].unionPlaying}),e=>{let{currentSeekTime:t,zoomValue:i,unionPlaying:n}=e;g(t,i,n)},{fireImmediately:!0});return null===(e=i.current)||void 0===e||e.addEventListener("scroll",n),()=>{var e;null===(e=i.current)||void 0===e||e.removeEventListener("scroll",n),m()}},[d]),(0,n.useEffect)(()=>{let e=(0,o.U5)(()=>t[s.VT].unionPlaying,e=>{e&&(h.current=!1,u.current=!1)},{fireImmediately:!0});return()=>{e()}},[])}},903045:function(e,t,i){i.d(t,{C:()=>I});var n=i("218571"),r=i("202426"),a=i("690674"),s=i("260963"),o=i("138527"),l=i("520486"),d=i("940802"),c=i("397542"),u=i("251894"),h=i("451694"),g=i("589259"),m=i("590944"),f=i("546134"),p=i("414482"),_=i("896095"),v=i("230689"),S=i("937802"),T=i("952959"),M=i("590411"),y=i("207754"),k=i("15678"),x=i("410463");let I=e=>{let{store:t,sequencesRendererRef:i,modules:I}=e,{selection:D}=I,b=(0,S.G)(v.t);(0,n.useEffect)(()=>{if(!i.current||!b)return;let e=new l.I(t),n=new o.r(t),r=new d.t(t),a=new c.k(t,I),s=new u.m(t),_=new h.P(t),v=new g.M(t,I),S=new m.R(t,I),T=new f.i(t,I),M=b.createInstance(p.S,t,I),y=new x.B(t,I);return e.bindDataChangeListeners(i.current),n.bindDataChangeListeners(i.current),r.bindDataChangeListeners(i.current),a.bindDataChangeListeners(i.current),s.bindDataChangeListeners(i.current),_.bindDataChangeListeners(i.current),v.bindDataChangeListeners(i.current),S.bindDataChangeListeners(i.current),T.bindDataChangeListeners(i.current),M.bindDataChangeListeners(i.current),M.bindEventListeners(i.current),y.bindDataChangeListeners(i.current),()=>{e.dispose(),n.dispose(),r.dispose(),a.dispose(),s.dispose(),_.dispose(),v.dispose(),S.dispose(),T.dispose(),M.dispose(),y.dispose()}},[b,i.current]),(0,n.useEffect)(()=>{if(!b||!i.current)return;let e=b.createInstance(_.e,t,I);e.bindEventListeners(i.current);let n=new T.J(t,I);n.bindDataChangeListeners(i.current);let r=new M.b(t,I);r.bindEventListeners(i.current);let a=new y.F(t,I);a.bindEventListeners(i.current),a.bindDataChangeListeners(i.current);let s=new k.O(t,I);return s.bindEventListeners(i.current),()=>{e.dispose(),n.dispose(),r.dispose(),a.dispose(),s.dispose()}},[b,i.current]),!function(e,t,i){let o=e=>{let t=i.current;null==t||t.events.store.emit(r.ML.onSelectedSegmentChange,e)};(0,n.useEffect)(()=>{let t=(0,s.U5)(()=>e[a.qk].canvasUISelectedSegmentIds,o,{fireImmediately:!0,equals:s.p6.shallow});return()=>{t()}},[]),(0,n.useEffect)(()=>{let e=t.onTimelineBoxSelection(e=>{let{segmentIds:t=[],transitionIds:i=[]}=e;o([...t,...i])});return()=>{e.dispose()}},[])}(t,D,i)}},743262:function(e,t,i){i.d(t,{V:()=>g});var n=i("218571"),r=i("937802"),a=i("763832"),s=i("690674"),o=i("896413"),l=i("108692"),d=i("563890"),c=i("139367");class u{getTrackedSegmentInfo(e){return this._trackedSegmentsMap.get(e)}setTrackedSegmentInfo(e,t,i){let n=this.getTrackedSegmentInfo(e);this._trackedSegmentsMap.set(e,{...null!=n?n:{},[t]:i})}clearTrackedSegmentInfo(e,t){let i=this.getTrackedSegmentInfo(e);if(i){let n={};Object.keys(i).forEach(e=>{let r=i[e];e!==t&&(n[e]=r)}),this._trackedSegmentsMap.set(e,n)}}resetVideoSegmentTrackedRender(){this._trackedVideoUpdateOrders=[],this._trackedSegmentsMap=new Map}addToTrackedVideoUpdateOrders(e){this._trackedVideoUpdateOrders.push(e)}renderVideoSegmentTracked(){let e={};this._trackedVideoUpdateOrders.forEach(t=>{if("show"===t.type){if(e[t.id]){var i;let{clipIds:n=[]}=e[t.id];e[t.id]={...t,clipIds:[...n,...null!==(i=t.clipIds)&&void 0!==i?i:[]]}}else e[t.id]=t}else e[t.id]=t}),Object.values(e).forEach(e=>{if("show"===e.type){let{clipIds:t}=e,i=[],n=this._trackedSegmentsMap.get(e.id);n&&Object.keys(n).forEach(e=>{let r=n[e],a=!t||t.includes(null!=e?e:"");(null==r?void 0:r.trackedInfo)&&a&&i.push(r.trackedInfo)}),this.updateVideosTrackedInfos(e.id,i)}else this.updateVideosTrackedInfos(e.id,[])})}updateVideosTrackedInfos(e,t){if(!this._sequencesRendererRef.current)return;let i=(0,d.JP)(this._sequencesRendererRef.current.children,e);if(i){i.updateData({trackedInfos:t},!0,!0);let{controllerManager:e}=this._coordinate;e&&this._coordinate.registry.segment.replace(c.y.segmentInfo({segmentCO:i,controllerManager:e}))}}constructor(e,t){this._sequencesRendererRef=e,this._coordinate=t,this._trackedSegmentsMap=new Map,this._trackedVideoUpdateOrders=[]}}var h=i("426336");let g=e=>{let{store:t,sequencesRendererRef:i,modules:d}=e,{coordinate:c}=d,{[s.qk]:{segmentSelected:g},[s.U_]:{allSegments:m,isDragging:f}}=t,p=(0,r.G)(o.a),_=(0,r.G)(l.n),{current:v}=(0,n.useRef)(new u(i,c));(0,n.useEffect)(()=>{if(!i.current||f)return;let e=g.map(e=>e.id);async function t(t,i){var n,r,s,o;let l;let{targetSegmentId:d,dataPath:c}=i,u=3,g=null===(n=p.renderManager.infoSticker)||void 0===n?void 0:n.getTrackerId(t,c);for(;!g&&u>0;)u--,await (0,a._)(50),g=null===(s=p.renderManager.infoSticker)||void 0===s?void 0:s.getTrackerId(t,c);let m=v.getTrackedSegmentInfo(d),f=null==m?void 0:m[i.dataPath],{trackId:S}=null!=f?f:{};if(!g||S===g)return;let T=_.dataSdk.draftView.getSegmentById(d);if((null==T?void 0:null===(r=T.material)||void 0===r?void 0:r.type)===h.cVg.MetaTypePhoto){let{start:e,duration:t}=T.targetTimerange;l={start:e,end:e+t}}else{let e=p.renderManager.resourceRecords.pathRecords.get(i.dataPath),t=e||h.hPV.toAbsolutePath(i.dataPath),n=p.renderManager.fs.readFileSync(t);if(n){let e=await (null===(o=p.renderManager.infoSticker)||void 0===o?void 0:o.getTrackerValidRegion(n));l=null==e?void 0:e[0]}}v.setTrackedSegmentInfo(d,t,{trackId:g,trackedInfo:l}),(e.includes(t)||e.includes(d))&&v.addToTrackedVideoUpdateOrders({id:d,type:"show",clipIds:[t]})}async function n(i){var n,r;if(["text","textTemplate","sticker"].includes(i.type)&&(null==i?void 0:null===(n=i.videoTracking)||void 0===n?void 0:n.enableVideoTracking)&&await Promise.all(i.videoTracking.trackers.map(e=>t(i.id,e))),"video"===i.type){let t=v.getTrackedSegmentInfo(i.id);if(e.includes(i.id)&&t)v.addToTrackedVideoUpdateOrders({id:i.id,type:"show"});else if(null===(r=i.objectLocked)||void 0===r?void 0:r.lockedTimeRanges.length){v.addToTrackedVideoUpdateOrders({id:i.id,type:"show"});let{lockedTimeRanges:e}=i.objectLocked;e.forEach((e,t)=>{let{start:n,duration:r}=e;v.setTrackedSegmentInfo(i.id,`${i.id}-${t}`,{trackId:i.id,trackedInfo:{start:n,end:h.pMA.plus(n,r,"bigint")}})})}else v.addToTrackedVideoUpdateOrders({id:i.id,type:"hidden"})}}v.resetVideoSegmentTrackedRender(),async function e(){await Promise.all(m.map(e=>n(e))),v.renderVideoSegmentTracked()}()},[m,g])}},763709:function(e,t,i){i.d(t,{Z:function(){return h}});var n=i(772322),r=i(218571),a=i(670933),s=i(801497),o=i(960482),l=i(690674),d=i(70366),c=i(371140),u=i(258579);let h=(0,a.f3)("store","modules")((0,a.Pi)(function(e){let{renderer:t,store:i,modules:a}=e,{autoReplaceDisplay:h}=i[l.U_],{segmentSelected:g}=i[l.qk],m=(0,r.useCallback)(()=>a.autoReplace.reply(!0),[]),f=(0,r.useCallback)(()=>a.autoReplace.reply(!1),[]),[p,_]=(0,r.useState)(0),v=(0,r.useMemo)(()=>null==g?void 0:g[0],[g]),[S,T]=(0,r.useState)(0),[M,y]=(0,r.useState)(0),[k]=(0,d.w)({setModalLeft:T,setModalTop:_,setArrowLeft:y,segment:v,bubbleRef:{current:{getBoundingClientRect:()=>({width:280})}},segLeftSafeArea:140,segRightSafeArea:140,modules:a,store:i});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.Z,{visible:void 0!==h,onClick:f}),(0,n.jsx)(o.Z,{popupVisible:h===c.AR.poly&&!k,title:s.ZP.t("web_autofill_title_replace_material",{},"Replace material"),content:s.ZP.t("web_autofill_text_choose_replace",{},"Replace the materials in the other clips too?"),okText:s.ZP.t("web_autofill_button_all_clip",{},"All clips"),cancelText:s.ZP.t("web_autofill_button_one_clip",{},"One clip"),onOk:m,onCancel:f,triggerProps:{style:{position:"fixed",left:S},onClickOutside:f},offsetY:p,offsetX:M})]})}))},541998:function(e,t,i){i.d(t,{Z:function(){return S}});var n=i(772322);i(957230);var r=i(46101),a=i(218571),s=i(969242),o=i(438211),l=i(690674),d=i(670933),c=i(450138),u=i(801497),h=i(839573),g=i(937802),m=i(230689),f=i(797637),p=i.n(f),_=i(426336),v=i(260963);let S=(0,d.f3)("store")((0,d.Pi)(e=>{let{store:t,scrollWrapRef:i,timelineUI:d,selection:f,playerManager:S}=e,{[l.U_]:{zoomStore:T,flattedSegments:M,tracksMutable:y,isTemplate:k,isBatchReplacePanelVisible:x}}=t,I=(0,g.G)(m.t),[D,b,E]=p()(!1),[C,w]=(0,a.useState)(0),N=(0,a.useRef)(!1),{isDraft:A}=(0,a.useMemo)(()=>{let{searchParams:e}=new URL(window.location.href);return{isDraft:e.get("draftIdc")}},[window.location.href]),j=(0,a.useMemo)(()=>{if(!(null==M?void 0:M.length))return;let e=M[0];return{id:e.id,start:e.start}},[M,null==M?void 0:M.length]),O=(0,a.useMemo)(()=>{var e,t,i,n,r,a,s;let o=null===(i=y.find(e=>e[0].trackType!==_.pNd.TrackTypeAudio))||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:null===(e=t.segments)||void 0===e?void 0:e[0];return null===(a=(null!==(s=null==o?void 0:null===(n=o.mutable)||void 0===n?void 0:n.children)&&void 0!==s?s:[o])[0])||void 0===a?void 0:null===(r=a.mutable)||void 0===r?void 0:r.locked},[y]),L=(0,a.useCallback)(()=>{if(!i.current||!j)return!0;let{scrollLeft:e,offsetWidth:t}=i.current;return e+t>(0,s.vY)(T.value,j.start)},[T.value]),P=()=>{L()&&R()},R=()=>{if(!!E.current)b(!1),i.current.removeEventListener("scroll",P),(0,h.U)(I,"close")},U=()=>{var e;let t=document.querySelector(".timeline-container");w((null!==(e=null==t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:20)-20),b(O),N.current=!0,i.current.addEventListener("scroll",P),(0,h.U)(I,"show")};return(0,a.useEffect)(()=>{if(!!k&&!A&&!x)if(L())b(!1);else{let e=d.guide.onFirstEnterCutSameGuideEnd(()=>{U()});return()=>{var t;null==e||null===(t=e.dispose)||void 0===t||t.call(e)}}},[j,x]),(0,a.useEffect)(()=>{if(!k||A||x)return;let e=L();e&&N.current?P():!e&&!N.current&&U()},[T.value,x]),(0,a.useEffect)(()=>{let e=(0,v.U5)(()=>t[l.VT].unionPlaying,e=>{e&&D&&R(),x&&D&&R()},{fireImmediately:!0});return()=>{e()}},[x,D]),(0,n.jsx)(r.Z,{focusLock:!0,position:"left",title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"title",children:u.ZP.t("web_locate_clip_title_locate_clip",{},"Locate the first clip you can edit")}),(0,n.jsx)(o.Z,{className:"iconpark-icon",onClick:()=>{R()}})]}),content:"",okText:u.ZP.t("web_locate_clip_btn_locate_clip",{},"Locate"),cancelButtonProps:{style:{display:"none"}},icon:!1,onOk:()=>{(0,h.U)(I,"locate"),j&&(S.seekToTime(j.start),d.scroller.scrollToSegment(j.id),f.updateSelectData({segmentIds:[j.id]}),b(!1))},popupVisible:D,getPopupContainer:()=>document.body,triggerProps:{style:{position:"fixed",left:void 0,top:void 0,right:"20px",bottom:"160px",width:"350px"}},className:c.Z["popup-to-first-mutable"],children:(0,n.jsx)("div",{className:c.Z["popup-confirm-fake-modal"],style:{transform:`translate(${C}px, 0px)`,width:"350px"}})})}))},909239:function(e,t,i){i.d(t,{Z:()=>p});var n=i("772322");i("818938");var r=i("255276"),a=i("218571");let s="lock-trigger-KHIyMC",o="popup-lock-btn-jWMwX5",l="popup-lock-btn--locked-SlNm2Q",d="popup-lock-btn--disabled-oDm3tm";var c=i("690674"),u=i("202426"),h=i("105789"),g=i.n(h),m=i("150564"),f=i("670933");let p=(0,f.f3)("store")((0,f.Pi)(e=>{let{renderer:t,store:i}=e,[h,f]=(0,a.useState)({x:0,y:0}),[p,_]=(0,a.useState)(!1),[v,S]=(0,a.useState)(),{[c.U_]:{allSegments:T},[c.qk]:{segmentSelected:M}}=i,y=e=>!1,k=T.find(e=>e.id===(null==v?void 0:v.segment.id)),x=k&&!y(k),I=k&&!y(k);(0,a.useEffect)(()=>{let e=(e,t)=>{if(e){let{x:i,y:n}=e;_(!0),f({x:i,y:n}),S(t)}else _(!1)};return null==t||t.events.interact.on(u.TY.popupLock,e),()=>{null==t||t.events.interact.off(u.TY.popupLock,e)}},[t]);let D=(0,a.useCallback)(()=>{if(!!k)null==t||t.events.interact.emit(u.TY.clickSegmentLock,k,!y(k))},[t,k]);return(0,n.jsx)(r.Z,{popupVisible:p&&M.some(e=>{var t;return(null==e?void 0:e.id)===(null==v?void 0:null===(t=v.segment)||void 0===t?void 0:t.id)}),position:"top",popupAlign:{top:8},popup:()=>(0,n.jsx)("div",{className:g()(o,{[l]:x,[d]:I}),onClick:D,children:x?(0,n.jsx)(m.OeQ,{className:"lv-lock-icon"}):(0,n.jsx)(m.PML,{className:"lv-lock-icon"})}),children:(0,n.jsx)("div",{className:s,style:{transform:`translate(${h.x}px, ${h.y}px)`}})})}))},396493:function(e,t,i){i.d(t,{eX:function(){return d},hn:function(){return o},tO:function(){return l}});var n=i(75535),r=i(563890),a=i(404161);class s extends n.V{run(e){let t=this._calcStyle(e,this.actionInfo);e.add(this.key,this.type,this.actionInfo.params,t)}_calcStyle(e,t){}constructor(...e){super(...e),this.actionType="add"}}class o extends s{_calcStyle(e,t){let{params:i}=t,n=(0,r.JP)(e.children,i.track.id);return(0,a.RD)(i.segment,e.camera.zoom,e.context.mode,null==n?void 0:n.style)}}class l extends s{_calcStyle(e,t){let{params:i}=t,n=(0,r.JP)(e.children,i.track.id);return(0,a.wm)(i.segment,i.transition,e.camera.zoom,e.context.mode,null==n?void 0:n.style)}}class d extends s{_calcStyle(e,t){let{params:i}=t,{width:n}=e.camera.getWorldBounds();return(0,a.ZY)(i.cTrack,i.display,n,e.context.mode)}}},50305:function(e,t,i){i.d(t,{H:function(){return n}});function n(){return{x:0,y:0,width:0,height:0}}},389267:function(e,t,i){function n(){return document.querySelector(".timeline-scroll-wrap")}function r(){return document.querySelector(".timeline-bd-vertical-scroll")}function a(e,t){let i=e.getStage();if(!!i)i.content.style.cursor=t}i.d(t,{Ay:function(){return a},DP:function(){return r},iP:function(){return n}})},404161:function(e,t,i){i.d(t,{MU:function(){return u},RD:function(){return d},ZY:function(){return h},wm:function(){return c}});var n=i(426336),r=i(907031),a=i(969242),s=i(721244),o=i(257296),l=i(140041);function d(e,t){var i,s;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",l=arguments.length>3?arguments[3]:void 0,{start:d,duration:c}=e,u=(0,a.vY)(t,d);return{x:u,width:Math.max("template"===o?r.Zg:r.vm,(0,a.vY)(t,n.pMA.max([1,c],"bigint"))),y:null!==(i=null==l?void 0:l.y)&&void 0!==i?i:0,height:null!==(s=null==l?void 0:l.height)&&void 0!==s?s:0}}function c(e,t,i){var r,s;let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",d=arguments.length>4?arguments[4]:void 0,c=e.start+e.duration-n.pMA.div(t.duration,2,"bigint","round"),u=(0,a.vY)(i,t.duration),h=(0,a.vY)(i,c),g="template-post"===l,m=g?o.pj:u;return{x:g?h+(u-o.pj)/2:h,width:m,y:null!==(r=null==d?void 0:d.y)&&void 0!==r?r:0,height:null!==(s=null==d?void 0:d.height)&&void 0!==s?s:0}}function u(e,t){let i=e-o.wX;return t&&(i-=8),i}function h(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",[r,a]=e,d=t===s.j.Empty,c=o.yi[r.type];return d?c=l.co.primary+2*o.xm:(a===o.gG&&"mutable"!==r.type||void 0===c)&&(c=l.co.primary),"template-post"===n&&(c=o.yi.templatePost),{x:o.wX,y:0,width:u(i,d),height:c}}},644314:function(e,t,i){i.d(t,{Dt:function(){return r},lG:function(){return a}});var n=i(928261);function r(e){return"mutable"===e.type||"mutablePoly"===e.type}function a(e){var t;return r(e)&&!(0,n._n)(e.mutable)&&!(0,n.rE)(e.mutable)&&!(null===(t=e.mutable)||void 0===t?void 0:t.filled)&&!1!==e.visible}},931774:function(e,t,i){i.d(t,{Fl:function(){return v},Hk:function(){return g},Ko:function(){return p},Ny:function(){return T},Re:function(){return h},cx:function(){return u},eN:function(){return S},gw:function(){return M},oS:function(){return m},ts:function(){return f},x8:function(){return _}});var n=i(827322),r=i(288712),a=i(620183),s=i(559408),o=i(563890),l=i(384971),d=i(257296),c=i(251976);let u=(e,t,i)=>{let n=i;for(let r of e.children){if(r===t)break;r.visible()&&(n+=r.getClientRect().width+i)}return n},h=(e,t,i,n)=>{let r=0;for(let a of n){let n=(0,o.DM)(e,a);if(!!n){if(n===t)break;n.visible()&&(0===r&&(r+=n.x()),r+=n.getClientRect().width+i)}}return r},g=(e,t,i,a,s)=>{let o=new r.Image(a);return e.context.cache.image.get(t,()=>new Promise(e=>{let t=new Image;t.onload=function(){e(t)},t.crossOrigin="Anonymous",t.src=(0,n.C)(i||d.Ii,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})})).then(e=>{o.setAttrs({image:e}),null==s||s(e)}),o},m=(e,t,i,r,a)=>{e.context.cache.image.get(t,()=>new Promise(e=>{let t=new Image;t.onload=function(){e(t)},t.crossOrigin="Anonymous",t.src=(0,n.C)(i,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1})})).then(e=>{r.setAttrs({fillPatternImage:e}),a&&r.setAttrs(a)})},f=function(e,t,i,n,r,a){e.beginPath(),e.moveTo(t+a,i),e.lineTo(t+n-a,i),e.quadraticCurveTo(t+n,i,t+n,i+a),e.lineTo(t+n,i+r-a),e.quadraticCurveTo(t+n,i+r,t+n-a,i+r),e.lineTo(t+a,i+r),e.quadraticCurveTo(t,i+r,t,i+r-a),e.lineTo(t,i+a),e.quadraticCurveTo(t,i,t+a,i),e.closePath()};function p(e,t){let{x:i,width:n}=e;if(!t)return i;let r=(0,l.C5)(n),{x:a,width:s}=t.getViewport(),o=a-i,d=i+r-(a+s);return(o>0?o/2:0)-(d>0?d/2:0)}function _(e,t){let{x:i,width:n}=e;if(!t)return i;let{x:r,width:a}=t.getViewport();return i+n>r+a&&!(i+n<r||i>r+a)?i+n-(r+a):0}function v(e,t){let{x:i,width:n}=e;if(!t)return n;let{x:r,width:a}=t.getViewport(),s=Math.max(i,r);return Math.min(i+n,r+a)-s}let S=e=>new a.Rect({listening:!1,fill:c.wL.lvvColorBlack04,cornerRadius:4,...e}),T=e=>new s.Text({listening:!1,y:1,verticalAlign:"middle",fill:c.wL.lvvColorTextContentPrimary,fontSize:d.HP,fontFamily:d.I8,...e}),M=e=>e.replace(/[\r\n\b]/g," ")},202426:function(e,t,i){i.d(t,{H2:function(){return o},ML:function(){return l},TY:function(){return d},ce:function(){return c}});var n,r,a,s=i(733730);var o=((n={}).scrollPrimaryTrackToViewBox="scrollPrimaryTrackToViewBox",n.viewportPositionChange="viewportPositionChange",n.viewportSizeChange="viewportSizeChange",n.cameraSizeChange="cameraSizeChange",n.viewportZoomChange="viewportZoomChange",n.worldSizeChange="worldSizeChange",n.totalWidthChange="totalWidthChange",n.segmentsWidthChange="segmentsWidthChange",n.segmentsHeightChange="segmentsHeightChange",n.scrollLeftChange="scrollLeftChange",n.segmentStyleChange="segmentStyleChange",n.segmentThumbnailInitialized="segmentThumbnailInitialized",n.colorLoaded="colorLoaded",n);var l=((r={}).viewportVisibleChange="viewportVisibleChange",r.zoomChange="zoomChange",r.tracksChange="tracksChange",r.progressChange="progressChange",r.screenshotsChange="screenshotsChange",r.combinationScreenshotsChange="combinationScreenshotsChange",r.thumbnailsChange="thumbnailsChange",r.wavesChange="wavesChange",r.onSelectedSegmentChange="onSelectedSegmentChange",r.onOperationWidthInnerChange="onOperationWidthInnerChange",r.onResetSegmentThumbnail="onResetSegmentThumbnail",r);var d=((a={}).popupMenu="popupMenu",a.popupButton="popupButton",a.popupButtonEditTemplate="popupButtonEditTemplate",a.popupTooltip="popupTooltip",a.popupMutablePolyChild="popupMutablePolyChild",a.onMutableButtonMouseEnter="onMutableButtonMouseEnter",a.onMutableButtonMouseLeave="onMutableButtonMouseLeave",a.onColorDotMouseAction="onColorDotMouseAction",a.uploadMaterialToMutable="uploadMaterialToMutable",a.cancelUploadMaterialToMutable="cancelUploadMaterialToMutable",a.cancelGamePlay="cancelGamePlay",a.clickSegmentLock="clickSegmentLock",a.popupLock="popupLock",a.onSegmentMouseEnter="onSegmentMouseEnter",a.onSegmentMouseLeave="onSegmentMouseLeave",a.onSelectedSegmentChange="onSelectedSegmentChange",a.onBeatMouseDown="onBeatMouseDown",a.onAudioExitTrim="onAudioExitTrim",a.onAudioEnterTrim="onAudioEnterTrim",a.onAudioTrim="onAudioTrim",a.onAudioTrimming="onAudioTrimming",a.onAudioStartPositionChange="onAudioStartPositionChange",a.onAudioPlaceholderClick="onAudioPlaceholderClick",a.onAudioShowMuteModal="onAudioShowMuteModal",a.onSegmentCropping="onSegmentCropping",a.onKeyframeMousedown="onKeyframeMousedown",a.onSwitchSideTab="onSwitchSideTab",a.clickEmptyTrack="external:clickEmptyTrack",a.combinationSegmentEditStatusChange="combinationSegmentEditStatusChange",a.exitEditSubSequence="exitEditSubSequence",a.clickHideMutableSegment="clickHideMutableSegment",a);class c{constructor(){this.view=new s.Z,this.store=new s.Z,this.interact=new s.Z}}},15371:function(e,t,i){i.d(t,{O2:function(){return r}});var n=i(979732);function r(){if("undefined"==typeof window)return;let e="Konva";void 0!==window[e]&&(window[e].stages=n.stages)}i(932919),i(474157),i(407976),i(620183),i(979588),i(406751),i(276158),i(469714),i(781332),i(559408),i(288712),i(612350),i(785317),i(597210)},21853:function(e,t,i){i.d(t,{Y:function(){return n}});class n{async get(e,t){let i=this.cacheMap.get(e);return!i&&(i=await t(),this.set(e,i)),i}set(e,t){if(this.cacheMap.size===this.maxCount){let e=this.cacheMap.keys();this.cacheMap.delete(e.next().value)}this.cacheMap.set(e,t)}clear(){this.cacheMap.clear()}constructor(e){this.cacheMap=new Map,this.maxCount=e}}},921911:function(e,t,i){i.d(t,{Y:function(){return u}});var n=i(628499),r=i(620183),a=i(257296),s=i(969242),o=i(892652),l=i(426336);let d={opacity:.8,cornerRadius:6},c={[o.X.Select]:"#00CAE0",[o.X.Delete]:"#ff303d"};class u extends n.G{mount(){let{context:e}=this,{start:t,end:i,type:n}=this._textEditCover,a=new r.Rect,o=i-t,u=(0,s.vY)(e.camera.zoom,l.pMA.max([1n,t],"bigint")),h=(0,s.vY)(e.camera.zoom,l.pMA.max([1,o],"bigint"));return a.setAttrs({x:u,y:this.style.y,width:h,height:this.style.height,duration:o,fill:c[n],...d}),a}update(){let{style:e,context:t}=this,i=this._textEditCover;this._konvaNodes.forEach(n=>{if(i){let{y:r}=e,{start:a,end:o}=i,d=(0,s.vY)(t.camera.zoom,l.pMA.max([1n,a],"bigint")),c=(0,s.vY)(t.camera.zoom,l.pMA.max([1n,o-a],"bigint"));n.setAttrs({x:d,y:r,width:c})}else n.setAttrs({width:0})})}constructor(e){super({...e,container:e.group,type:a.KX.Default}),this._textEditCover=e.textEditCover}}},72411:function(e,t,i){i.d(t,{A:function(){return c}});var n=i(932919),r=i(406751),a=i(257296),s=i(251976),o=i(563890),l=i(628499),d=i(969242);class c extends l.G{static getAnimationsProps(e,t,i,n){return e.filter(e=>"caption"!==e.type).map(r=>{var s,o,l,c,u;let{duration:h}=r,g=0n;if("loop"===r.type){let i=null!==(l=null===(s=e.find(e=>"in"===e.type))||void 0===s?void 0:s.duration)&&void 0!==l?l:0n,n=null!==(c=null===(o=e.find(e=>"out"===e.type))||void 0===o?void 0:o.duration)&&void 0!==c?c:0n;h=t.duration-i-n,g=i}if("group"===r.type){let t=e.find(e=>"group"===e.type);g=null!==(u=null==t?void 0:t.start)&&void 0!==u?u:0n}let m=Math.min(i-2,(0,d.vY)(n,h)),f=Math.max(0,(0,d.vY)(n,g));return"out"===r.type?(f=i-m+2+1,m=Math.min(m-6,i-(3+a.iX)*2)):"in"===r.type?(f=3,m=Math.min(m-4,i-(3+a.iX)*2)):(m-=10,f+=6),{width:Math.max(0,m),left:Math.max(0,Math.min(f,i-5))}})}mount(){let{data:e}=this,{animations:t}=e.segment;if(!(null==t?void 0:t.length))return;let i=new n.Group({listening:!1});return this._group=i,this._createNodes(t),this._updateAttrs(i),i}update(){let{data:e}=this,{animations:t}=e.segment;if(!(null==t?void 0:t.length))return;let i=this._group;if(!!i)this._updateAttrs(i)}updateData(e,t,i){var n,r;(null===(n=e.segment)||void 0===n?void 0:n.animations)&&((0,o.$V)(this._group),this._createNodes(null===(r=e.segment)||void 0===r?void 0:r.animations)),super.updateData(e,t,i)}_updateAttrs(e){let{data:t,style:i,context:n}=this,{x:r,y:a,width:s,height:l}=i,{animations:d}=t.segment,u=c.getAnimationsProps(d,t.segment,s,n.camera.zoom),h=0;for(let{width:t,left:i}of u){let n=(0,o.DM)(e,`group-${h}-line`);n&&n.setAttrs({x:0,y:0,points:[i,l-4,i+t,l-4]});let r=(0,o.DM)(e,`group-${h}-outPoly`);r&&r.setAttrs({x:-2,y:l-4+1,points:[i+5,0,i+5,-5,i,0]});let a=(0,o.DM)(e,`group-${h}-inPoly`);a&&a.setAttrs({x:t+2,y:l-4+1,points:[i,0,i-5,-5,i-5,0]}),h+=1}e.setAttrs({x:r,y:a,width:s,height:l}),e.clip({x:0,y:0,width:s,height:l})}_createNodes(e){let t=[],i=0;for(let n of e){let{type:e}=n,a=new r.Line({stroke:s.wL.lvvColorWhiteStationary,strokeWidth:2,name:`group-${i}-line`,listening:!1});if(t.push(a),"in"!==e){let e=new r.Line({fill:s.wL.lvvColorWhiteStationary,closed:!0,name:`group-${i}-outPoly`,listening:!1});t.push(e)}if("out"!==e){let e=new r.Line({fill:s.wL.lvvColorWhiteStationary,closed:!0,name:`group-${i}-inPoly`,listening:!1});t.push(e)}i+=1}this._group&&this._group.add(...t)}constructor(...e){super(...e),this.dataPropertyNames=["segment"],this.clearOnInit=!0}}},846591:function(e,t,i){i.d(t,{L:function(){return u}});var n=i(563890),r=i(931774),a=i(251976),s=i(932919),o=i(276158),l=i(628499),d=i(384971),c=i(969242);class u extends l.G{mount(){let{fades:e,type:t}=this.data.segment;if("audio"!==t)return;let i=new s.Group({listening:!1,clipFunc:e=>{(0,r.ts)(e,0,0,i.width()+1,i.height(),(0,d.yW)(i.width()))}});return this._group=i,e&&e.length>0?(this._updateGroupStyle(i),this._createNodes(e)):this._group.visible(!1),i}update(){let e=this._group;if(!e)return;let{fades:t}=this.data.segment;if(!!(null==t?void 0:t.length))for(let i of(e.visible(this._visible),this._updateGroupStyle(e),t))this._updateNode(i,e)}updateData(e,t,i){var r,a;(null===(r=e.segment)||void 0===r?void 0:r.fades)&&((0,n.$V)(this._group),this._createNodes(null===(a=e.segment)||void 0===a?void 0:a.fades)),super.updateData(e,t,i)}_getNodeX(e){return"out"===e.type?this.style.width:0}_getNodeScaleX(e){let t=(0,c.vY)(this.context.camera.zoom,e.duration);return("out"===e.type?-1:1)*t/84}_updateGroupStyle(e){let{x:t,y:i,width:n,height:r}=this.style,a=(0,d.C5)(n);e.setAttrs({x:t,y:i,width:a,height:r})}_updateNode(e,t){let i=(0,n.DM)(t,e.type);if(!!i)i.setAttrs({scaleX:this._getNodeScaleX(e),x:this._getNodeX(e)})}_createNodes(e){let t=[];for(let i of e){let e=new o.Path({width:84,height:28,fill:a.wL.editorTlSegFade,data:"M 0,0 H 84 C 84,0 22.5,1.03704 0,28 V 0 Z",scaleX:this._getNodeScaleX(i),x:this._getNodeX(i),name:i.type,listening:!1});t.push(e)}this._group&&this._group.add(...t)}constructor(...e){super(...e),this.dataPropertyNames=["segment"]}}},887860:function(e,t,i){i.d(t,{H:function(){return S},x:function(){return v}});var n=i(288712),r=i(932919),a=i(620183),s=i(785317),o=i(563890),l=i(257296),d=i(251976),c=i(202426),u=i(628499),h=i(857458),g=i(125780);let m=()=>{let e={x:l.TD,y:l.TD,width:l.dh,height:l.nI};return{unlockIcon:new n.Image({...e,image:g.J.LvIconUnlockFiled}),lockIcon:new n.Image({...e,image:g.J.LockFiled}),unchangeableIcon:new n.Image({...e,image:g.J.DisabledLockIcon})}},f=(e,t)=>{let{lockIcon:i,unlockIcon:n,unchangeableIcon:r}=t;n.visible(!e.isLocked),i.visible(!!(e.isLocked&&e.changeable)),r.visible(!!(e.isLocked&&!e.changeable))},p=e=>e.isLocked||!e.changeable?d.wL.lvvColorWhite02:d.wL.lvvColorWhiteStationary,_=e=>e.isLocked?h.F.t("web_posttemplate_button_turn_off_replacement",{},"Don\u2019t allow replacing"):h.F.t("web_posttemplate_button_turn_on_replacement",{},"Allow replacing"),v=e=>{let{width:t}=e;return t<l.VV+2*l.O7};class S extends u.G{mount(){let e=this.context;if("template-post"!==e.mode)return;let{data:t,style:i}=this,{x:n,y:d,height:u}=i,{id:h}=t.segment,g=new r.Group({x:n+l.O7,y:d+(u-l.HG)/2,name:(0,o.Vo)(h,l.KX.Segment,l.CD.LockIcon),visible:"template-post"===e.mode}),S=new a.Rect({x:0,y:0,width:l.VV,height:l.HG,fill:p(t),cornerRadius:4});S.filters([s.Blur]),S.blurRadius(t.isLocked||!t.changeable?10:0),g.add(S);let{lockIcon:T,unlockIcon:M,unchangeableIcon:y}=m();return f(t,{lockIcon:T,unlockIcon:M,unchangeableIcon:y}),g.add(T,M,y),!function(e,t,i,n){let r=function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!t){n.events.interact.emit(c.TY.popupTooltip,!1);return}let{x:r,y:a}=e;n.events.interact.emit(c.TY.popupTooltip,{x:r+l.O7+l.VV/2,y:a},i.segment,_(i))};t.on("mousedown",()=>{let{events:t}=n;!v(e)&&(t.interact.emit(c.TY.clickSegmentLock,i.segment,!!i.isLocked),r())}),t.on("mouseenter",()=>{if(!v(e))i.changeable?document.body.style.cursor="pointer":document.body.style.cursor="not-allowed",r()}),t.on("mouseleave",()=>{if(!v(e))document.body.style.cursor="default",r(!1)})}(i,g,t,e),g}update(){let e=this._konvaNodes[0];if(!this._layer)return;let t=this.context;if("template-post"!==t.mode){e.visible(!1);return}let{data:i,style:n}=this,{x:r,y:a,width:s,height:o}=n,d=e.findOne("Rect");if(v(n))e.visible(!1);else{e.visible(!0);let n=r+4,c=a+(o-l.HG)/2,{x:u}=t.camera.getViewport(),h=r+s-l.VV-l.O7;u>n&&(n=(n=u+l.O7)<h?n:h),e.setAttrs({x:n,y:c}),d.setAttrs({fill:p(i)}),d.blurRadius(i.isLocked||!i.changeable?10:0);let[g,m,_]=e.find("Image");f(i,{lockIcon:g,unlockIcon:m,unchangeableIcon:_})}}constructor(...e){super(...e),this.dataPropertyNames=["segment","isLocked","isLocked","changeable"]}}},359595:function(e,t,i){i.d(t,{E:function(){return m}});var n=i(257296),r=i(288712),a=i(426336),s=i(389267),o=i(202426),l=i(933162),d=i(928261),c=i(801497),u=i(628499),h=i(125780),g=i(931774);class m extends u.G{mount(){if(!this._getDisplayPosition())return;let e=new r.Image({image:h.J.Warning,height:n.Ne,width:n.R0,shadowForStrokeEnabled:!1,shadowOffsetX:0,shadowOffsetY:1,shadowBlur:4});return!this._checkVisible()&&(e.visible(!1),this._updatePosition(e)),this._addEventHandler(e),e}update(){let e=this._konvaNodes.length>0?this._konvaNodes[0]:void 0;if(!!e)return this._checkVisible()&&e?(this._updatePosition(e),e.visible(!0)):e.visible(!1),e}_updatePosition(e){var t;let{x:i,y:r,width:a}=this.style;if(!(null===(t=this.context)||void 0===t?void 0:t.camera))return;let s=(0,g.x8)(this.style,this.context.camera),o=i+a-n.Ne-n.Zr-(s?s+n.Zr:0);e.x(o),e.y(r+n.b6)}_getDisplayPosition(){let{parentSegment:e,segment:{originalTargetDuration:t,originalTargetStart:i,id:n}}=this.data,{sourceTimeRange:{start:r=i,duration:s=t}={}}=null!=e?e:{},o=(0,a.VwQ)([i,i+t],[r,r+s]);return this._position=o,o}_checkVisible(){let{isHoverMutableButton:e,segment:t}=this.data;if((0,d.rE)(t.mutable)||!this._position||!e||!this.context)return!1;let{height:i}=this.style,r=(0,g.Fl)(this.style,this.context.camera);return(0,l.U4)(i)?n.Ne+36<r:n.Ne+l.lD+36+2*n.Zr<r}_addEventHandler(e){e.on("mouseenter",t=>{if(e.visible(!0),(0,s.Ay)(e,"pointer"),!!this.context)this.context.events.interact.emit(o.TY.popupTooltip,{x:this.style.x+this.style.width,y:this.style.y},this.data.segment,c.ZP.t("web_multi_tracks_hover_clip_will_be_split",{},"The clip to be replaced will be split."),"top")}),e.on("mouseleave",t=>{if((0,s.Ay)(e,"default"),!this.context)return;let{events:i}=this.context;i.interact.emit(o.TY.popupTooltip,!1)})}constructor(...e){super(...e),this.dataPropertyNames=["segment","isHoverMutableButton"]}}},428583:function(e,t,i){i.d(t,{Z:function(){return u}});var n=i(801497),r=i(931774),a=i(77665),s=i(257296),o=i(932919),l=i(628499),d=i(426336);let c={Group:"Group",Background:"Background",Text:"Text"};class u extends l.G{mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)==="template"||!(0,a.I)(this.data,this.context))return;let t=new o.Group({listening:!1});return this._flatNodeMap.set(c.Group,t),this.update(),t}update(){let e=this._flatNodeMap.get(c.Group),t=this.getContainer();if(!(0,a.I)(this.data,this.context)||!t)return;let{segment:i}=this.data,o=n.ZP.t("web_flicker_label_removed",{},"Flicker removed"),l=!1;if("video"===i.type){let{videoAlgorithm:e}=i.sourceMaterial,{algorithms:t}=e;l=t.some(e=>e.type===d.zzh.Deflicker)}let u="template-post"===this.context.mode?16:14;if(l){var h;let i=this._flatNodeMap.get(c.Background);if(!i){i=(0,r.eN)({name:c.Background,height:u}),this._flatNodeMap.set(c.Background,i),e.add(i);let t=(0,r.Ny)({name:c.Text,x:s.ZT,height:u-2});this._flatNodeMap.set(c.Text,t),e.add(t)}let n=(0,r.cx)(t,e,s.Kp);e.x(n);let a=this._flatNodeMap.get(c.Text);a.text(o),a.direction(null!==(h=this.context.direction)&&void 0!==h?h:"ltr"),i.width(a.x()+a.getTextWidth()+s.ZT)}e.visible(!!l)}}},305962:function(e,t,i){i.d(t,{Z:function(){return f}});var n=i(932919),r=i(620183),a=i(288712),s=i(559408),o=i(628499),l=i(251976),d=i(257296),c=i(77665),u=i(931774),h=i(801497),g=i(125780);let m={Group:"TrackingGroup",Background:"Background",Text:"Text"};class f extends o.G{mount(){if(!(0,c.I)(this.data,this.context))return;let e=new n.Group({listening:!1});return this._flatNodeMap.set(m.Group,e),this.update(),e}update(){let e=this._flatNodeMap.get(m.Group),t=this.getContainer();if(!(0,c.I)(this.data,this.context)||!t)return;let{videoTracking:i}=this.data.segment;if(null==i?void 0:i.enableVideoTracking){let i="template-post"===this.context.mode?16:14,n=this._flatNodeMap.get(m.Background);if(!n){n=new r.Rect({listening:!1,fill:l.wL.lvvColorBlack04,cornerRadius:4,height:i}),this._flatNodeMap.set(m.Background,n),e.add(n);let t=d.ZT,o=new a.Image({x:t,y:(i-12)/2,width:12,height:12,image:g.J.Tracking,listening:!1});e.add(o);let c=new s.Text({y:1,verticalAlign:"middle",fill:l.wL.lvvColorTextContentPrimary,fontSize:d.HP,listening:!1,fontFamily:d.I8,x:t+12+4,height:i-2});this._flatNodeMap.set(m.Text,c),e.add(c)}let o=this._flatNodeMap.get(m.Text);null==o||o.text(h.oc.t("web_elements_label_text_tracking",{},"Tracking")),n.width(o.x()+o.getTextWidth()+d.ZT),e.visible(!0);let c=(0,u.cx)(t,e,d.Kp);e.x(c)}else null==e||e.visible(!1)}}},439781:function(e,t,i){i.d(t,{C:function(){return m}});var n=i(257296),r=i(932919),a=i(563890),s=i(628499),o=i(973061),l=i(874312),d=i(294249),c=i(154708),u=i(384971),h=i(5996);let g="Group";class m extends s.G{_initChildren(){let e=[o.X,h.S,c.Z,d.Y,l.Z];this._children=e.map(e=>new e({layer:this._layer,data:this.data,style:this.style,context:this.context,container:()=>this._flatNodeMap.get(g),type:n.KX.Default}))}mount(){let{data:e}=this,{segment:t}=e,{id:i}=t,s=new r.Group({name:(0,a.Vo)(i,n.KX.Segment,n.CD.Tip),listening:!1});return this._flatNodeMap.set(g,s),this.update(),s}update(){let{style:e}=this,t=this.context,i=this._flatNodeMap.get(g),{x:r,y:a,width:s,height:o}=e,l="template-post"===t.mode?n.VV+n.O7:0;i.setAttrs({x:r+l,y:a,width:s,height:o});let d=(0,u.C5)(s);i.clip({x:0,y:0,width:d-2-l,height:o})}constructor(e){super(e),this.dataPropertyNames=["segment","isLost","isVip","isLoading","loadingText","isActive","extraTags","isHover","hideTitle","isTemplateMusicNoCopyright"],this._initChildren()}}},142377:function(e,t,i){i.d(t,{OR:function(){return S},ZP:function(){return M},lk:function(){return v}});var n=i(772322);i(225572);var r=i(97257),a=i(218571),s=i(670933),o=i(105789),l=i.n(o),d=i(150564),c=i(354267),u=i(426336),h=i(937802),g=i(230689),m=i(741720),f=i(907031),p=i(969177);i(893426);var _=i(260963);let v="timeline-hd",S="track-operation",T=(0,a.forwardRef)(e=>{let{store:t,mainTrackTop:i,modules:s,operationWidth:o,hidden:T,disableTimelineHeader:M}=e,{timelineStore:y}=t,{draftOperation:k}=s,x=(0,h.G)(g.t),I=(0,a.useCallback)(e=>{k.video.toggleVideoMuteAll(),(0,p.o)(x,{current_page:s.environment.isTemplate?"template_editor":"editor",is_soundtrack:e?"off":"on",track_category:"video"})},[]),{isEmptyTracks:D,mainTrackMuted:b,subTrackIdToMuted:E}=y,C=o<y.operationWidth,w=(0,a.useRef)(null),N=(0,a.useRef)(null),A=(0,a.useRef)(null),[j,O]=(0,a.useState)([]),L=(0,a.useCallback)((e,t)=>{if(e===u.pNd.TrackTypeVideo)return t?c.pl.VIDEO_TRACE:c.pl.MAIN_TRACK;return c.pl.OTHERS_TRACE},[]);(0,m.$M)({timelineStore:y,domRef:N,additionHeight:f.St+f.Gy}),(0,a.useEffect)(()=>(0,_.EH)(()=>{var e,t;let i=[],n=0,r=L(u.pNd.TrackTypeVideo,0)+c._9;y.tracks.forEach(e=>{let[t,a]=e,{trackType:s}=t;a?s!==u.pNd.TrackTypeAudio?(n-=L(s,a)+c._9,i.unshift({track:t,offset:n,idx:a})):(i.push({track:t,offset:r,idx:a}),r+=L(s,a)+c._9):i.unshift({track:t,offset:0,idx:a})});let a=null!==(t=null===(e=i.find(e=>!e.idx))||void 0===e?void 0:e.offset)&&void 0!==t?t:0;O(i=(i=null==i?void 0:i.map(e=>{let{track:t,offset:i,idx:n}=e;return{track:t,offset:i-a,idx:n}})).filter(e=>{let{track:t,idx:i}=e;return(t.trackType===u.pNd.TrackTypeAudio||t.trackType===u.pNd.TrackTypeVideo&&t.segments.some(e=>e.metaType===u.cVg.MetaTypeVideo))&&i}))}),[L]);let P=(0,a.useCallback)((e,t)=>{(0,p.o)(x,{current_page:s.environment.isTemplate?"template_editor":"editor",is_soundtrack:t?"off":"on",track_category:e.trackType===u.pNd.TrackTypeVideo?"vice_video":"audio"}),k.track.muteTrack(e.id,t)},[]);return(0,n.jsx)("div",{ref:N,id:v,className:l()(v,C?"scrolled":null),style:{display:T?"none":void 0},children:(0,n.jsxs)("div",{className:S,ref:w,id:S,children:[null==j?void 0:j.map(e=>{let{track:t,offset:a,idx:s}=e,o=E.get(t.id);return(0,n.jsx)("div",{className:l()({"track-operation-item":!0,"type-primary":!0,primary:!0,active:o}),style:{top:a+i,height:L(t.trackType,s)},children:(0,n.jsx)(r.Z,{size:"mini",type:"text",className:l()({active:o}),onClick:()=>P(t,!o),disabled:M,children:o?(0,n.jsx)(d.yyq,{className:"iconpark-icon"}):(0,n.jsx)(d.PjL,{className:"iconpark-icon"})})},t.id)}),(0,n.jsx)("div",{className:l()("track-operation-item","track-volume","type-primary","primary"),style:{top:i,visibility:0===i?"hidden":"inherit"},ref:A,children:!D&&(0,n.jsx)(r.Z,{size:"mini",type:"text",className:l()({active:b}),onClick:()=>I(!b),disabled:M,children:b?(0,n.jsx)(d.yyq,{className:"iconpark-icon"}):(0,n.jsx)(d.PjL,{className:"iconpark-icon"})})})]})})}),M=(0,s.f3)("store","modules")((0,s.Pi)(T))},59335:function(e,t,i){i.d(t,{Z:function(){return m}});var n=i(772322);i(701840);var r=i(794571),a=i(218571),s=i(670933),o=i(452210),l=i(27564),d=i(105789),c=i.n(d),u=i(905040),h=i(907031),g=i(831998);i(714615);let m=(0,s.f3)("store","contribution","modules")(a.memo((0,s.Pi)(e=>{var t,i,s,d;let{store:m,modules:f,contribution:p,styleConfig:_}=e,{showBoxShadow:v,showBorderBottom:S}=_,{timelineToolbarContribution:T}=p,{timelineStore:M,timelineSelectionStore:y,timelineInteractStore:k}=m,{timelineUI:x}=f,{leftControllers:I,centerControllers:D,rightControllers:b,audioRecorderToolControllers:E}=T,[,C]=(0,a.useReducer)(e=>e+1,0),{audioTimelinePanelVisible:w}=M,[N]=(0,g.F)(),{disableToolbarInteract:A,disableReadonlyMode:j}=k,O=(0,u.r)(m),L=(0,a.useCallback)(M.setSwitches.bind(M),[]),P=(0,a.useCallback)((e,t)=>{let{controller:i,divider:s}=e,{render:o,getIsVisible:d}=i,{mode:c,isBatchReplacePanelVisible:u,isCollapseTimeline:g,relationGroupColorMap:m,loadingSegments:f,isTemplate:p}=M,{disableInteract:_}=k,{segmentSelected:v,isEditingTemplate:S}=y,T={state:{disableToolbarInteract:A,disableReadonlyMode:j,disableInteract:_,segmentSelected:v,loadingSegments:f,mode:c,relationGroupColorMap:m,timelinePanel:{mode:u?l.v.QUICK_REPLACE:l.v.NORMAL,isCollapsed:g},switches:M.switches,isEditingTemplate:S,audioTimelinePanelVisible:w,isDisabledPlay:O},methods:{refresh:C,setSwitches:L},modules:{timelineUI:x}};return"undefined"!=typeof window&&window.location.search.includes("__ssr_pending__")||d&&!d(T)?null:s&&c!==h.KN.TEMPLATE_POST?(0,n.jsxs)(a.Fragment,{children:[o(T),(0,n.jsx)(r.Z,{type:"vertical",className:"timeline-tools-right-divider"})]},`${t+1}`):(0,n.jsx)(a.Fragment,{children:o(T)},`${t+1}`)},[M,w,O,A]);(0,a.useEffect)(()=>(p.setForceRender(o.Y.TIMELINE_TOOL,C),()=>{p.setForceRender(o.Y.TIMELINE_TOOL,null)}),[]);let R=null!==(t=I.map(P))&&void 0!==t?t:[],U=null!==(i=D.map(P))&&void 0!==i?i:[],z=null!==(s=b.map(P))&&void 0!==s?s:[],B=null!==(d=E.map(P))&&void 0!==d?d:[],V=A||M.loading;return(0,n.jsxs)("div",{className:"timeline-tools-wrapper",children:[(0,n.jsx)("div",{className:c()("audio-recorder-tools",{show:w,hide:!1===w}),children:B}),(0,n.jsxs)("div",{className:c()("timeline-tools",{"timeline-tools-shadowed":"dark"!==N&&v,"timeline-tools-bordered":S,show:!1===w,hide:w}),children:[(0,n.jsxs)("div",{className:"timeline-tools-left",tabIndex:0,children:[R,V?(0,n.jsx)("div",{className:"timeline-tools-disable"}):null]}),(0,n.jsx)("div",{className:"timeline-tools-center",tabIndex:0,children:U}),(0,n.jsxs)("div",{className:"timeline-tools-right",tabIndex:0,children:[z,V?(0,n.jsx)("div",{className:"timeline-tools-disable"}):null]})]})]})})))},281438:function(e,t,i){i.d(t,{q:function(){return l}});var n=i(218571),r=i(27564),a=i(156145),s=i(905040),o=i(452210);function l(e,t,i,l){let{timelineContentContribution:d}=e,{timelineStore:c,timelineSelectionStore:u,timelineInteractStore:h}=t,{timelineUI:g,coordinate:m}=i,[,f]=(0,n.useReducer)(e=>e+1,0),p=(0,s.r)(t),_=(0,n.useCallback)(e=>{if(!e)return null;let{mode:t,isBatchReplacePanelVisible:i,isCollapseTimeline:n,relationGroupColorMap:a,loadingSegments:s}=c,{disableInteract:o,disableToolbarInteract:d,disableReadonlyMode:m}=h,{segmentSelected:_,isEditingTemplate:v}=u,S={state:{disableInteract:o,disableToolbarInteract:d,segmentSelected:_,loadingSegments:s,mode:t,relationGroupColorMap:a,timelinePanel:{mode:i?r.v.QUICK_REPLACE:r.v.NORMAL,isCollapsed:n},switches:c.switches,isEditingTemplate:v,isDisabledPlay:p,disableReadonlyMode:m},methods:{refresh:()=>{f()},setSwitches:c.setSwitches.bind(c),onEmptyDraft:l},modules:{timelineUI:g}};return e.getIsVisible&&!e.getIsVisible(S)?null:e.render(S)},[c,u,p,l,g]);return(0,n.useEffect)(()=>(e.setForceRender(o.Y.TIMELINE_CONTENT,f),()=>{e.setForceRender(o.Y.TIMELINE_CONTENT,null)}),[]),{[a.te.TRAIN_HEADER]:_(d.trainHeaderController)}}},597443:function(e,t,i){i.d(t,{A:()=>l});var n=i("772322"),r=i("168370"),a=i("218571");let s={timelineBdVerticalScrollbar:"timeline-bd-vertical-scrollbar-eYKOWJ",timelineBdVerticalScrollbarThumb:"timeline-bd-vertical-scrollbar-thumb-_h_RnY"};var o=i("722169");let l=e=>{let{timeBdVertical:t}=e,[i,l]=(0,a.useState)(!1),[d,c]=(0,a.useState)(0),[u,h]=(0,a.useState)(0),g=(0,a.useRef)(null),m=(0,a.useRef)(null),f=(0,a.useRef)(t.current),p=(0,a.useRef)(0);(0,a.useEffect)(()=>{var e;let i=t.current,n=()=>{h(i.clientHeight*(i.scrollTop/i.scrollHeight)),c(i.clientHeight*(i.clientHeight/i.scrollHeight)),p.current=i.scrollTop};null===(e=t.current)||void 0===e||e.addEventListener("scroll",n);let r=new ResizeObserver((0,o.debounce)(e=>{e.length&&(i.clientHeight<i.scrollHeight?(l(!0),c(i.clientHeight*(i.clientHeight/i.scrollHeight))):l(!1))}));if(t.current){r.observe(t.current);let e=t.current.querySelector(".timeline-large-container");r.observe(e)}return()=>{var e;if(null===(e=t.current)||void 0===e||e.removeEventListener("scroll",n),t.current){r.unobserve(t.current);let e=t.current.querySelector(".timeline-large-container");r.unobserve(e)}}},[t.current]),(0,a.useEffect)(()=>{let{current:e}=f,{current:i}=t;e&&i&&e!==i&&(i.scrollTop=p.current),f.current=t.current},[t.current]);let _=(0,a.useCallback)(e=>{let t=g.current.clientHeight-m.current.clientHeight;h(i=>Math.max(0,Math.min(t,i+e.deltaY)))},[]);(0,r.c)({refs:[m],onDrag:_}),(0,a.useEffect)(()=>{let e=t.current;e.scrollTo({top:u*e.scrollHeight/e.clientHeight})},[u]);let v=(0,a.useCallback)(e=>{if(e.target!==g.current)return;let{top:t}=g.current.getBoundingClientRect();h(e.clientY-t)},[]);return t.current?(0,n.jsx)("div",{className:s.timelineBdVerticalScrollbar,style:{visibility:i?"visible":"hidden"},ref:g,onClick:v,children:(0,n.jsx)("div",{className:s.timelineBdVerticalScrollbarThumb,style:{height:d,top:u},ref:m})}):null}},594299:function(e,t,i){i.d(t,{De:function(){return s},k:function(){return o},ty:function(){return l}});var n=i(632555),r=i(836904);function a(e,t,i,n,r,a){e.strokeStyle=r,e.fillStyle=a,e.lineWidth=i,e.beginPath(),e.moveTo(t-.5,0),e.lineTo(t-.5,n),e.stroke()}function s(e,t,i,n,r){a(e,i,t,18*t,n,r)}function o(e,t,i,n){a(e,i,t,4*t,n,n)}function l(e,t,i,a){e.fillText(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return(0,n.mK)(e%1e3,[1e3/t,1e3-1e3/t])?`${(0,r.c)(e,".f",t)}f`:(0,r.c)(1e3*Math.round(e/1e3),"?hh:mm:ss")}(a),i+5*t,16*t)}},6409:function(e,t,i){i.d(t,{$:function(){return s}});var n=i(218571),r=i(112825),a=i(260963);function s(e,t){(0,n.useEffect)(()=>{let i=e.current;if(!i)return;let{dragState:n}=t.context.store;i.updateContext({dragState:n})},[t.context.store.dragState]),(0,n.useEffect)(()=>{let i=e.current;if(!i)return;let n=(0,a.U5)(()=>t.context.store.isCursorDrag,e=>{i.updateContext({isCursorDrag:e})},{fireImmediately:!0});return()=>{n()}},[e.current]),(0,n.useEffect)(()=>{let i=t=>{var i;let{id:n,...r}=t;null===(i=e.current)||void 0===i||i.updateDataById(n,r)},n=t=>{var i,n;let r=null===(i=e.current)||void 0===i?void 0:i.children.get(t.id);if(!r)return;let a=r.data.segment||{};null===(n=e.current)||void 0===n||n.updateDataById(t.id,{segment:{...a,...t.newData}})},a=t=>{var i;let{id:n,...r}=t;null===(i=e.current)||void 0===i||i.updateStyleById(t.id,r)},s=t=>{var i;null===(i=e.current)||void 0===i||i.batchUpdateStyle(t)},o=t=>{var i;let n=null===(i=e.current)||void 0===i?void 0:i.children.get(t.segId);n&&n.updateKeyframeGroupData(t.data,!0)};return t.on(r.B.updateData,i),t.on(r.B.updatePartialSegmentData,n),t.on(r.B.updateStyle,a),t.on(r.B.batchUpdateStyle,s),t.on(r.B.keyframeKeepActive,o),()=>{t.off(r.B.updateStyle,a),t.off(r.B.updatePartialSegmentData,n),t.off(r.B.batchUpdateStyle,s),t.off(r.B.updateData,i),t.off(r.B.keyframeKeepActive,o)}},[])}},680145:function(e,t,i){i.d(t,{N:function(){return c},b:function(){return d}});var n,r=i(680717),a=i(102597),s=i(10879),o=i(959264),l=i(242692);var d=((n={}).Weave="Weave",n.IconProLegacy="IconPro",n.IconProAvailable="IconProAvailable",n.IconProUnavailable="IconProNonAvailable",n.CheckerBoard="CheckerBoard",n);let c={Weave:r.Z,IconPro:a,IconProAvailable:o.Z,IconProNonAvailable:s.Z,CheckerBoard:l.Z}},125780:function(e,t,i){i.d(t,{J:function(){return l},N:function(){return s}});var n=i(772322),r=i(150564),a=i(251976);let s={LvIconReplace:r.S31,LvIconReplaceGrey:()=>(0,n.jsx)(r.S31,{style:{fill:a.wL.segmentAudioEmptyTextColor}}),LvIconUnlockFiled:()=>(0,n.jsx)(r.PML,{style:{fill:a.wL.lvvColorMainDefault}}),LockFiled:()=>(0,n.jsx)(r.OeQ,{style:{fill:a.wL.lvvColorWhiteStationary}}),DisabledLockIcon:()=>(0,n.jsx)(r.OeQ,{style:{fill:a.wL.lvvColorWhite04}}),IconClipSameEdit:r.TvC,LvIconUneditable:r.ORM,LvIconMultipleSlot:r.CAN,LvIconNavSaveError:r.gG1,LvIconBeatMarker:r.Z0I,LvIconBeatMarkerActive:()=>(0,n.jsx)(r.Z0I,{style:{color:a.wL.lvvColorMainDefault,fill:a.wL.lvvColorMainDefault}}),LvIconKeyframe:r.p8G,LvIconKeyframeActive:()=>(0,n.jsx)(r.p8G,{style:{color:a.wL.lvvColorMainDefault}}),LvIconNavSaveErrorNormal:r.gG1,LvIconNavSaveErrorRed:()=>(0,n.jsx)(r.gG1,{style:{fill:a.wL.lvvColorNegativePrimary,color:a.wL.lvvColorNegativePrimary}}),Loading:()=>(0,n.jsx)(r.gbz,{style:{color:a.wL.lvvColorTextContentPrimary}}),Uploading:()=>(0,n.jsx)(r.gbz,{size:20,style:{color:a.wL.lvvColorTextSecondary}}),IconClipSameLoading:()=>(0,n.jsx)(r.kt0,{style:{color:a.wL.lvvColorMainDefault}}),IconClipSameLoadingWhite:()=>(0,n.jsx)(r.kt0,{style:{color:a.wL.lvvColorTextContentPrimary}}),Warning:r.v3j,WarningRed:()=>(0,n.jsx)(r.v3j,{style:{fill:a.wL.lvvColorNegativePrimary,color:a.wL.lvvColorNegativePrimary}}),Speed:r.fDY,Tracking:r.nHE,LvIconTextToSpeech:r.m5_,LvIconAudioExtract:r.z6Q,LvIconMusic:r.kUW,LvIconCaptions:r.EPA,LvIconSubtitleAutoCaptions:r.toP,LvIconSubtitle:r.RoO,LvIconText:r.lFi,LvIconEffects:r.t33,LvIconFilters:r.AqX,LvIconAdjust:r.wwn,LvIconComponent:r.lvS,LvIconTransition:r.$cv,LvIconMusicEmpty:()=>(0,n.jsx)(r.kUW,{style:{fill:a.wL.segmentAudioEmptyTextColor}}),LvIconMusicReplaceHover:()=>(0,n.jsx)(r.kUW,{style:{fill:a.wL.lvvColorMainDefault}}),LvIconStocks:()=>(0,n.jsx)(r.eIr,{style:{fill:a.wL.lvvColorTextSecondary}}),LvIconTemplate:r.BdQ,LvIconUneditableUnfilled:r.$o$,LvIconEdittemplate:r.Kfl,TemplateEditMode:r.THt,LvIconHide:r.P_4,LvIconUnhide:r.Sto,LvIconMarkerDefault:()=>(0,n.jsx)(r.Yom,{}),LvIconMarkerActive:()=>(0,n.jsx)(r.yU1,{style:{fill:"#00CAE0"}}),LvIconHideActive:()=>(0,n.jsx)(r.P_4,{style:{fill:a.wL.lvvColorMainDefault,color:a.wL.lvvColorMainDefault}}),LvIconBrandAdjust:()=>(0,n.jsx)(r.FLA,{style:{fill:a.wL.lvvColorWhiteStationary,color:a.wL.lvvColorWhiteStationary}})},o=new Image,l=Object.keys(s).reduce((e,t)=>(e[t]=o,e),{})}}]);