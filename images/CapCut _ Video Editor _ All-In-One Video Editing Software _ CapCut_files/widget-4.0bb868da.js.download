"use strict";(globalThis.__LOADABLE_LOADED_CHUNKS__=globalThis.__LOADABLE_LOADED_CHUNKS__||[]).push([["9726"],{850375:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"reference-line":"reference-line-tGpf3R",referenceLine:"reference-line-tGpf3R","reference-line-left":"reference-line-left-ZSmy9F",referenceLineLeft:"reference-line-left-ZSmy9F","reference-line-right":"reference-line-right-g_1Bpw",referenceLineRight:"reference-line-right-g_1Bpw","reference-line-vertical-center":"reference-line-vertical-center-SYsVxg",referenceLineVerticalCenter:"reference-line-vertical-center-SYsVxg","reference-line-top":"reference-line-top-TKavTk",referenceLineTop:"reference-line-top-TKavTk","reference-line-bottom":"reference-line-bottom-UvOzva",referenceLineBottom:"reference-line-bottom-UvOzva","reference-line-horizontal-center":"reference-line-horizontal-center-Z4tmaZ",referenceLineHorizontalCenter:"reference-line-horizontal-center-Z4tmaZ"}},827664:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"smart-crop-error-modal":"smart-crop-error-modal-Tt_RyN",smartCropErrorModal:"smart-crop-error-modal-Tt_RyN","smart-crop-error-modal-header":"smart-crop-error-modal-header-TrLroA",smartCropErrorModalHeader:"smart-crop-error-modal-header-TrLroA","smart-crop-error-modal-icon":"smart-crop-error-modal-icon-d0iPZp",smartCropErrorModalIcon:"smart-crop-error-modal-icon-d0iPZp","smart-crop-error-modal-title":"smart-crop-error-modal-title-TC_0e5",smartCropErrorModalTitle:"smart-crop-error-modal-title-TC_0e5","smart-crop-error-modal-content":"smart-crop-error-modal-content-KpsmPR",smartCropErrorModalContent:"smart-crop-error-modal-content-KpsmPR"}},867571:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"timeline-expanded-segment-boundary":"timeline-expanded-segment-boundary-aO0Y1W",timelineExpandedSegmentBoundary:"timeline-expanded-segment-boundary-aO0Y1W"}},197557:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"fake-modal":"fake-modal-M6A3YP",fakeModal:"fake-modal-M6A3YP","mutable-poly-modal":"mutable-poly-modal-RCAli9",mutablePolyModal:"mutable-poly-modal-RCAli9"}},194670:function(e,t,i){i.d(t,{Z:function(){return r}});let r={"fake-modal":"fake-modal-fpFaNF",fakeModal:"fake-modal-fpFaNF"}},671132:function(e,t,i){i.d(t,{Z:function(){return r}});let r={widthEdge:"6px",heightAxis:"26px",heightTrackSpace:"7px",heightTemplateTrackSpace:"15px",trackLeftPadding:"6px",widthTimelineHdMuteTemplate:"6px",segInnerMargin:"1px","height-seg-hd":"28px",heightSegHd:"28px","height-seg-bd-low":"36px",heightSegBdLow:"36px","height-seg-bd-audio":"28px",heightSegBdAudio:"28px","height-seg-bd":"50px",heightSegBd:"50px","height-seg-template-post":"32px",heightSegTemplatePost:"32px",trakListPadding:"16px",trackListPaddingTop:"44px",trackListPaddingBottom:"44px",trackBeautyScrollWidth:"10px",segMinWidth:"6px",borderRadiusSeg:"8px","timeline-play-cursor":"timeline-play-cursor-bVEjyy",timelinePlayCursor:"timeline-play-cursor-bVEjyy","arrow-cursor":"arrow-cursor-UdwyxE",arrowCursor:"arrow-cursor-UdwyxE","resize-cursor":"resize-cursor-vKxKMu",resizeCursor:"resize-cursor-vKxKMu","adsorb-cursor":"adsorb-cursor-_FFGpT",adsorbCursor:"adsorb-cursor-_FFGpT","timeline-play-cursor-bd":"timeline-play-cursor-bd-bk3hr1",timelinePlayCursorBd:"timeline-play-cursor-bd-bk3hr1","timeline-play-cursor-hd":"timeline-play-cursor-hd-rgOYW4",timelinePlayCursorHd:"timeline-play-cursor-hd-rgOYW4"}},683731:function(e,t,i){i.d(t,{Z:function(){return r}}),i(772322),i(218571);let r="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPG1hc2sgaWQ9InBhdGgtMS1vdXRzaWRlLTFfNDE1OV82MTgyNTEiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjAuNzA2MDU1IiB5PSItMi41MDQyMmUtMDciIHdpZHRoPSIyMyIgaGVpZ2h0PSIyMyIgZmlsbD0iYmxhY2siPgo8cmVjdCBmaWxsPSJ3aGl0ZSIgeD0iMC43MDYwNTUiIHk9Ii0yLjUwNDIyZS0wNyIgd2lkdGg9IjIzIiBoZWlnaHQ9IjIzIi8+CjxwYXRoIGQ9Ik0xNi45NDk4IDIwLjY5MjVDMTYuOTQ5OCAyMS4xMzc5IDE3LjQ4ODQgMjEuMzYxIDE3LjgwMzQgMjEuMDQ2TDIxLjg5OTYgMTYuOTQ5OEwxNy44MDM0IDEyLjg1MzZDMTcuNDg4NCAxMi41Mzg3IDE2Ljk0OTggMTIuNzYxNyAxNi45NDk4IDEzLjIwNzJMMTYuOTQ5OCAxNi4wMDAxQzEyLjE4ODQgMTYuMDAwMSA3Ljk5OTk5IDExLjcxMTIgNy45OTk5OSA2Ljk0OTc1TDEwLjY5MjMgNi45NDk3NUMxMS4xMzc4IDYuOTQ5NzUgMTEuMzYwOSA2LjQxMTE4IDExLjA0NTkgNi4wOTYxOUw2Ljk0OTcgMkwyLjg1MzUgNi4wOTYxOUMyLjUzODUyIDYuNDExMTggMi43NjE2MSA2Ljk0OTc1IDMuMjA3MDYgNi45NDk3NUw1Ljk5OTk5IDYuOTQ5NzVDNS45OTk5OSAxMi44MTU3IDExLjA4MzggMTguMDAwMSAxNi45NDk4IDE4LjAwMDFMMTYuOTQ5OCAyMC42OTI1WiIvPgo8L21hc2s+CjxwYXRoIGQ9Ik0xNi45NDk4IDIwLjY5MjVDMTYuOTQ5OCAyMS4xMzc5IDE3LjQ4ODQgMjEuMzYxIDE3LjgwMzQgMjEuMDQ2TDIxLjg5OTYgMTYuOTQ5OEwxNy44MDM0IDEyLjg1MzZDMTcuNDg4NCAxMi41Mzg3IDE2Ljk0OTggMTIuNzYxNyAxNi45NDk4IDEzLjIwNzJMMTYuOTQ5OCAxNi4wMDAxQzEyLjE4ODQgMTYuMDAwMSA3Ljk5OTk5IDExLjcxMTIgNy45OTk5OSA2Ljk0OTc1TDEwLjY5MjMgNi45NDk3NUMxMS4xMzc4IDYuOTQ5NzUgMTEuMzYwOSA2LjQxMTE4IDExLjA0NTkgNi4wOTYxOUw2Ljk0OTcgMkwyLjg1MzUgNi4wOTYxOUMyLjUzODUyIDYuNDExMTggMi43NjE2MSA2Ljk0OTc1IDMuMjA3MDYgNi45NDk3NUw1Ljk5OTk5IDYuOTQ5NzVDNS45OTk5OSAxMi44MTU3IDExLjA4MzggMTguMDAwMSAxNi45NDk4IDE4LjAwMDFMMTYuOTQ5OCAyMC42OTI1WiIgZmlsbD0iIzE2MTYxRCIvPgo8cGF0aCBkPSJNMjEuODk5NiAxNi45NDk4TDIyLjg4OTUgMTUuOTU5OUMyMy40MzYyIDE2LjUwNjYgMjMuNDM2MiAxNy4zOTMgMjIuODg5NSAxNy45Mzk4TDIxLjg5OTYgMTYuOTQ5OFpNMTYuOTQ5OCAxNi4wMDAxTDE4LjM0OTggMTYuMDAwMUMxOC4zNDk4IDE2Ljc3MzMgMTcuNzIzIDE3LjQwMDEgMTYuOTQ5OCAxNy40MDAxTDE2Ljk0OTggMTYuMDAwMVpNNy45OTk5OSA2Ljk0OTc1TDYuNTk5OTkgNi45NDk3NUM2LjU5OTk5IDYuNTc4NDQgNi43NDc0OSA2LjIyMjM1IDcuMDEwMDQgNS45NTk4QzcuMjcyNTkgNS42OTcyNSA3LjYyODY5IDUuNTQ5NzUgNy45OTk5OSA1LjU0OTc1TDcuOTk5OTkgNi45NDk3NVpNNi45NDk3IDJMNS45NTk3NSAxLjAxMDA1QzYuNTA2NDggMC40NjMzMTYgNy4zOTI5MSAwLjQ2MzMxNiA3LjkzOTY1IDEuMDEwMDVMNi45NDk3IDJaTTUuOTk5OTkgNi45NDk3NUw1Ljk5OTk5IDUuNTQ5NzVDNi43NzMxOSA1LjU0OTc1IDcuMzk5OTkgNi4xNzY1NSA3LjM5OTk5IDYuOTQ5NzVMNS45OTk5OSA2Ljk0OTc1Wk0xNi45NDk4IDE4LjAwMDFMMTYuOTQ5OCAxNi42MDAxQzE3LjMyMTEgMTYuNjAwMSAxNy42NzcyIDE2Ljc0NzYgMTcuOTM5OCAxNy4wMTAxQzE4LjIwMjMgMTcuMjcyNyAxOC4zNDk4IDE3LjYyODggMTguMzQ5OCAxOC4wMDAxTDE2Ljk0OTggMTguMDAwMVpNMTAuNjkyMyA2Ljk0OTc1TDEwLjY5MjMgOC4zNDk3NUwxMC42OTIzIDYuOTQ5NzVaTTExLjA0NTkgNi4wOTYxOUwxMC4wNTU5IDcuMDg2MTRMMTEuMDQ1OSA2LjA5NjE5Wk0yLjg1MzUgNi4wOTYxOUwxLjg2MzU1IDUuMTA2MjRMMi44NTM1IDYuMDk2MTlaTTE3LjgwMzQgMTIuODUzNkwxOC43OTMzIDExLjg2MzdMMTcuODAzNCAxMi44NTM2Wk0xNi45NDk4IDIwLjY5MjVMMTUuNTQ5OCAyMC42OTI1TDE2Ljk0OTggMjAuNjkyNVpNMjIuODg5NSAxNy45Mzk4TDE4Ljc5MzMgMjIuMDM2TDE2LjgxMzQgMjAuMDU2MUwyMC45MDk2IDE1Ljk1OTlMMjIuODg5NSAxNy45Mzk4Wk0xOC43OTMzIDExLjg2MzdMMjIuODg5NSAxNS45NTk5TDIwLjkwOTYgMTcuOTM5OEwxNi44MTM0IDEzLjg0MzZMMTguNzkzMyAxMS44NjM3Wk0xNS41NDk4IDE2LjAwMDFMMTUuNTQ5OCAxMy4yMDcyTDE4LjM0OTggMTMuMjA3MkwxOC4zNDk4IDE2LjAwMDFMMTUuNTQ5OCAxNi4wMDAxWk0xNi45NDk4IDE3LjQwMDFDMTEuMzk1MiAxNy40MDAxIDYuNTk5OTkgMTIuNDY0MyA2LjU5OTk5IDYuOTQ5NzVMOS4zOTk5OSA2Ljk0OTc1QzkuMzk5OTkgMTAuOTU4MSAxMi45ODE2IDE0LjYwMDEgMTYuOTQ5OCAxNC42MDAxTDE2Ljk0OTggMTcuNDAwMVpNMTAuNjkyMyA4LjM0OTc1TDcuOTk5OTkgOC4zNDk3NUw3Ljk5OTk5IDUuNTQ5NzVMMTAuNjkyMyA1LjU0OTc1TDEwLjY5MjMgOC4zNDk3NVpNNy45Mzk2NSAxLjAxMDA1TDEyLjAzNTggNS4xMDYyNEwxMC4wNTU5IDcuMDg2MTRMNS45NTk3NSAyLjk4OTk1TDcuOTM5NjUgMS4wMTAwNVpNMS44NjM1NSA1LjEwNjI0TDUuOTU5NzUgMS4wMTAwNUw3LjkzOTY1IDIuOTg5OTVMMy44NDM0NSA3LjA4NjE0TDEuODYzNTUgNS4xMDYyNFpNNS45OTk5OSA4LjM0OTc1TDMuMjA3MDYgOC4zNDk3NUwzLjIwNzA2IDUuNTQ5NzVMNS45OTk5OSA1LjU0OTc1TDUuOTk5OTkgOC4zNDk3NVpNNy4zOTk5OSA2Ljk0OTc1QzcuMzk5OTkgMTIuMDU5IDExLjg3MzQgMTYuNjAwMSAxNi45NDk4IDE2LjYwMDFMMTYuOTQ5OCAxOS40MDAxQzEwLjI5NDIgMTkuNDAwMSA0LjU5OTk5IDEzLjU3MjQgNC41OTk5OSA2Ljk0OTc1TDcuMzk5OTkgNi45NDk3NVpNMTUuNTQ5OCAyMC42OTI1TDE1LjU0OTggMTguMDAwMUwxOC4zNDk4IDE4LjAwMDFMMTguMzQ5OCAyMC42OTI1TDE1LjU0OTggMjAuNjkyNVpNMTAuNjkyMyA1LjU0OTc1QzkuODkwNTIgNS41NDk3NSA5LjQ4ODk3IDYuNTE5MTcgMTAuMDU1OSA3LjA4NjE0TDEyLjAzNTggNS4xMDYyNEMxMy4yMzI4IDYuMzAzMTggMTIuMzg1MSA4LjM0OTc1IDEwLjY5MjMgOC4zNDk3NUwxMC42OTIzIDUuNTQ5NzVaTTMuODQzNDUgNy4wODYxNEM0LjQxMDQyIDYuNTE5MTcgNC4wMDg4NyA1LjU0OTc1IDMuMjA3MDYgNS41NDk3NUwzLjIwNzA2IDguMzQ5NzVDMS41MTQzNCA4LjM0OTc1IDAuNjY2NjE4IDYuMzAzMTggMS44NjM1NSA1LjEwNjI0TDMuODQzNDUgNy4wODYxNFpNMTYuODEzNCAxMy44NDM2QzE3LjM4MDQgMTQuNDEwNiAxOC4zNDk4IDE0LjAwOSAxOC4zNDk4IDEzLjIwNzJMMTUuNTQ5OCAxMy4yMDcyQzE1LjU0OTggMTEuNTE0NSAxNy41OTY0IDEwLjY2NjcgMTguNzkzMyAxMS44NjM3TDE2LjgxMzQgMTMuODQzNlpNMTguNzkzMyAyMi4wMzZDMTcuNTk2NCAyMy4yMzI5IDE1LjU0OTggMjIuMzg1MiAxNS41NDk4IDIwLjY5MjVMMTguMzQ5OCAyMC42OTI1QzE4LjM0OTggMTkuODkwNyAxNy4zODA0IDE5LjQ4OTEgMTYuODEzNCAyMC4wNTYxTDE4Ljc5MzMgMjIuMDM2WiIgZmlsbD0id2hpdGUiIG1hc2s9InVybCgjcGF0aC0xLW91dHNpZGUtMV80MTU5XzYxODI1MSkiLz4KPC9zdmc+Cg=="},680717:function(e,t,i){i.d(t,{Z:function(){return r}}),i(772322),i(218571);let r="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzIiIGhlaWdodD0iNzIiIHZpZXdCb3g9IjAgMCA3MiA3MiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzI2NTZfMjM0MzkzKSIgZmlsbD0icmdiYSgwLCAwLCAwLCAwLjQpIj4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAyOC4xMTEzIDEzOC4yODgpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAyNS45OTAyIDEzNi4xNjcpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAyMy44NjkxIDEzNC4wNDUpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAyMS43NDggMTMxLjkyNCkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IDE5LjYyNyAxMjkuODAzKSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgMTcuNTAzOSAxMjcuNjgxKSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgMTUuMzgyOCAxMjUuNTYpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAxMy4yNjE3IDEyMy40MzkpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAxMS4xNDA2IDEyMS4zMTcpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyA5LjAxOTUzIDExOS4xOTYpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyA2Ljg5ODQ0IDExNy4wNzUpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyA0Ljc3NzM0IDExNC45NTMpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAyLjY1NjI1IDExMi44MzIpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAwLjUzMzIwMyAxMTAuNzExKSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTEuNTg3ODkgMTA4LjU4OSkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0zLjcwODk4IDEwNi40NjgpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtNS44MzAwOCAxMDQuMzQ3KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTcuOTUxMTcgMTAyLjIyNSkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0xMC4wNzIzIDEwMC4xMDQpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMTIuMTkzNCA5Ny45ODI3KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTE0LjMxNDUgOTUuODYxNCkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0xNi40MzU1IDkzLjc0MDEpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMTguNTU4NiA5MS42MTg4KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTIwLjY3OTcgODkuNDk3NSkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0yMi44MDA4IDg3LjM3NjIpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMjQuOTIxOSA4NS4yNTQ4KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTI3LjA0MyA4My4xMzM1KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTI5LjE2NDEgODEuMDEyMikiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0zMS4yODUyIDc4Ljg5MDkpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMzMuNDA2MiA3Ni43Njk1KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTM1LjUyNzMgNzQuNjQ4MikiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0zNy42NTA0IDcyLjUyNjkpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMzkuNzcxNSA3MC40MDU2KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTQxLjg5MjYgNjguMjg0MykiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC00NC4wMTM3IDY2LjE2MjkpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtNDYuMTM0OCA2NC4wNDE2KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTQ4LjI1NTkgNjEuOTIwMykiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC01MC4zNzcgNTkuNzk5KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTUyLjQ5OCA1Ny42Nzc3KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTU0LjYyMTEgNTUuNTU2MykiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC01Ni43NDIyIDUzLjQzNSkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC01OC44NjMzIDUxLjMxMzcpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtNjAuOTg0NCA0OS4xOTI0KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTYzLjEwNTUgNDcuMDcxMSkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0ibWF0cml4KDAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC02NS4yMjY2IDQ0Ljk0OTcpIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHJlY3Qgd2lkdGg9IjE1MCIgaGVpZ2h0PSIxIiB0cmFuc2Zvcm09Im1hdHJpeCgwLjcwNzEwNyAtMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtNjcuMzQ3NyA0Mi44Mjg0KSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC40Ii8+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC43MDcxMDcgLTAuNzA3MTA3IC0wLjcwNzEwNyAtMC43MDcxMDcgLTY5LjQ2ODggNDAuNzA3MSkiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNCIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzI2NTZfMjM0MzkzIj4KPHJlY3Qgd2lkdGg9IjcyIiBoZWlnaHQ9IjcyIiBmaWxsPSJ3aGl0ZSIgdHJhbnNmb3JtPSJtYXRyaXgoLTEgMCAwIDEgNzIgMCkiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"},38476:function(e,t,i){i.d(t,{Hu:function(){return M},Lg:function(){return S}});var r=i(691400),n=i(29188),a=i(687730),s=i(572013),o=i(601193),l=i(861631),d=i(426336),u=i(53600),c=i(686439),h=i(334769),g=i(514869),m=i(513498),p=i(105166),f=i(218571);let _=a.j9["0"],v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.i5.Landscape;return e.value===d.rxY.CanvasRatioOriginal?t:e.width>e.height?m.i5.Landscape:m.i5.Portrait};function M(e){var t,i,r;let s=null!==(t=e.width)&&void 0!==t?t:n.fQ.width,o=null!==(i=e.height)&&void 0!==i?i:n.fQ.height;return{materialWidth:s,materialHeight:o,initRatio:null!==(r=a.j9.find(t=>t.value===e.ratio))&&void 0!==r?r:a.j9["0"]}}function S(e){let{store:t,canvasManager:i,canvasConfig:S,canvasRatio:y,draftFirstFrameChangePlace:T,defaultRatio:b,isEmpty:I,presetCache:w,presetUrlScenario:k,selectedScenario:A,setIsFirstRendering:C,widgetContainerRef:D}=e,x=(0,p.K)(i),P=(0,h.F)(i),E=(0,c.$)(i),{isPlaying:N}=t,[R,L]=(0,r.default)("canvas-ratio",_),j=b?a.j9.find(e=>e.value===b.value):void 0,[O,B]=(0,f.useState)(null!=j?j:R);(0,f.useEffect)(()=>{if(y){let e=a.j9.find(e=>e.value===y.value);e&&B(e)}},[y]);let[z,U]=(0,f.useState)((0,s.Ce)(S?[S.width,S.height]:[O.width,O.height]));(0,f.useEffect)(()=>{S&&U((0,s.Ce)([S.width,S.height]))},[S]);let[V,Z]=function(e){let[t,i]=(0,f.useState)(v(e));return(0,f.useEffect)(()=>{i(t=>v(e,t))},[e]),[t,(0,f.useCallback)(e=>{let{materialWidth:t,materialHeight:r,ratio:n}=e,a=!0;if(n.value!==d.rxY.CanvasRatioOriginal){let{width:e,height:t}=n;a=e>t}else{if(!(t>0)||!(t>0))return;a=t>r}i(a?m.i5.Landscape:m.i5.Portrait)},[])]}(O),F=(0,f.useCallback)(async e=>{let{materialWidth:t,materialHeight:r,initRatio:n,updateDraft:a=!0,updatePreview:o=!0,useMaterialSize:u=!1,canUndoRedo:c=!0}=e;Z({materialHeight:r,materialWidth:t,ratio:n});let h=(0,s.Ce)([t,r]);if(o&&await x.setCanvasSize(...h),a){let e,a;u?(e=t,a=r):[e,a]=h;let o=(0,l.xn)({width:e,height:a});[e,a]=(0,s.uG)([o.width,o.height]),P.api.draft.setCanvasSize({containerWidth:e,containerHeight:a,ratio:n.value,domWidth:n.value===d.rxY.CanvasRatioOriginal?0:h[0],domHeight:n.value===d.rxY.CanvasRatioOriginal?0:h[1]},c,!i.saveManager.isEmptyPackage)}B(n),U(h)},[]);(0,f.useEffect)(()=>{if(!b)return;let{width:e,height:t}=b;e>0&&t>0&&Z({ratio:O,materialHeight:t,materialWidth:e})},[null==b?void 0:b.width]);let G=(0,f.useCallback)(async e=>{let t=a.j9.find(t=>t.value===e);if(!!t){if(await F({initRatio:t,materialHeight:t.height,materialWidth:t.width,canUndoRedo:!1}),k){let t=Object.keys(g.Py).find(t=>g.Py[t]===e);t&&(0,u.rH)({scenario:t})}}},[F]);(0,f.useEffect)(()=>{k&&A&&g.Py[A]?G(g.Py[A]):w&&G(R.value)},[A,G]),(0,f.useEffect)(()=>()=>{},[]),(0,f.useEffect)(()=>{if(!!S)F({...M(S),updateDraft:!1})},[O,S,I]),(0,f.useEffect)(()=>{let[e,t]=(0,s.mt)(O.value);P.setEnsureDraftCanvasSizeParam(e,t,O.value)},[O.value]);let W=(0,f.useCallback)(async e=>{let{materialWidth:t,materialHeight:i}=e,r=(0,s.Ce)([t,i]);await x.setCanvasSize(...r)},[x]),Y=(0,f.useCallback)(e=>{let t=a.j9.find(t=>t.value===e);t&&L(t)},[L]),H=(0,f.useCallback)(async e=>{var r,l,u,c;let h=a.j9.find(t=>t.value===e);if(!h)return;Y(e),null==C||C(!0),i.modules.playerController.pause();let g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=e;for(let r of(t.length>0&&(i=e.filter(e=>t.includes(e.type))),i))if(r.segments.length>0)return r.segments[0];return null}(P.draftView.getAllTracks(),[d.pNd.TrackTypeVideo]),m=-1===h.width?null!==(u=null==g?void 0:null===(r=g.material)||void 0===r?void 0:r.width)&&void 0!==u?u:n.fQ.width:h.width,p=-1===h.height?null!==(c=null==g?void 0:null===(l=g.material)||void 0===l?void 0:l.height)&&void 0!==c?c:n.fQ.height:h.height,f=async()=>{await F({materialWidth:m,materialHeight:p,initRatio:h,useMaterialSize:-1===h.width})},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(null==D?void 0:D.current)&&(D.current.style.transition=e),E.style.transition=e,E.style.backgroundColor=t};if(N||I)await f();else{try{t.actionCanvasResizingSet(!0);let e=[...z];_("width 300ms cubic-bezier(0, .01, .35, 1),height 300ms cubic-bezier(0, .01, .35, 1)","var(--lv-color-black)");let i=(0,s.Ce)([m,p]);U([...i]),await (0,o.j)({animationName:"ration-change",targets:[...i],currents:e,cubicParams:[0,.01,.35,1],duration:300,func(e){let[t,i]=e;return W({materialWidth:t,materialHeight:i})}})}catch(e){}_(""),t.actionCanvasResizingSet(!1),await f()}null==T||T()},[i,z,E,F,N,I]);return{ratio:O,displaySize:z,onRatioChange:H,chooseRatio:G,orientation:V}}},463220:function(e,t,i){i.d(t,{R:function(){return n}});var r=i(218571);let n=e=>{let{infos:t,templateId:i}=e.modules.templateManager.templateStore;return(0,r.useMemo)(()=>({infos:t,templateId:i}),[t,i])}},686439:function(e,t,i){i.d(t,{$:function(){return n}});var r=i(218571);let n=e=>(0,r.useMemo)(()=>e.canvas,[e.canvas])},668771:function(e,t,i){i.d(t,{G:function(){return g}});var r=i(772322),n=i(544633),a=i(218571),s=i(57464),o=i(883967),l=i(202054),d=i(670933),u=i(937802),c=i(230689),h=i(800165);let g=(0,d.Pi)(e=>{var t,i,d,g;let{widgetId:m,aiWriterManager:p}=e,f=(0,u.G)(c.t),{showPrompt:_,isPromptLoading:v,generateProgress:M}=p.getAiWriterStore(),[S,y]=(0,a.useState)(p.getLastPosition()),[T,b]=(0,a.useState)(),I=(0,n.default)(e=>{var t,i,r;if(T)return;let n=document.querySelector(`div[data-widget-id="${m}"]`),a=null!==(r=null===(i=document.querySelector("#player-content"))||void 0===i?void 0:null===(t=i.getBoundingClientRect())||void 0===t?void 0:t.bottom)&&void 0!==r?r:window.innerHeight;if(!e||!n)return;let s=n.getBoundingClientRect(),o=e.getBoundingClientRect(),l=s.left+s.width/2-o.width/2,d=s.bottom+8;d+o.height+8>a&&(d=a-8-o.height),y({top:d,left:l})}),w=(0,n.default)(e=>{b(e),p.setLastPosition(e)}),k=(0,n.default)(()=>{(0,h.P)(f,{action:"close"}),p.handlePromptCLose(),b(void 0)}),A=(0,n.default)(e=>{(0,h.P)(f,{action:"generate"}),p.handleGenerate(e)}),C=(0,n.default)(()=>{(0,h.P)(f,{action:"cancel"}),p.handlePromptCancel()}),D=(0,n.default)(e=>{p.handlePromptValueChange(e)});return((0,a.useEffect)(()=>{_&&(0,h.P)(f,{action:"show"})},[_]),(0,a.useEffect)(()=>()=>{p.setLastPosition(void 0)},[]),_)?(0,r.jsx)(l.Z,{visible:!0,children:(0,r.jsx)(s.q,{autoFocus:!0,defaultInputValue:p.getCurrentSegmentDefaultPromptValue(),onChange:D,onResize:I,left:null!==(i=null!==(t=null==T?void 0:T.left)&&void 0!==t?t:null==S?void 0:S.left)&&void 0!==i?i:-9999,top:null!==(g=null!==(d=null==T?void 0:T.top)&&void 0!==d?d:null==S?void 0:S.top)&&void 0!==g?g:-9999,status:v?o.$.Loading:o.$.Init,loadingProcess:M,onSubmit:A,onClose:k,onCancel:C,onPositionChange:w})}):(0,r.jsx)(r.Fragment,{})})},423124:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(772322);i(916058),i(225572);var n=i(566782),a=i(97257),s=i(129219),o=i(801497),l=i(670933),d=i(218571),u=i(912056);let c=(0,l.f3)("store")((0,l.Pi)(e=>{let{onCancel:t,onFinish:i,segId:l,source:c,store:h}=e,{segmentIntelligentMap:g}=h,m=(0,d.useMemo)(()=>{var e,t;return null!==(t=null===(e=g[l])||void 0===e?void 0:e.get(c))&&void 0!==t?t:null},[g,l,c]),p=(null==m?void 0:m.status)===s.xR.Running;if((0,d.useEffect)(()=>{!p&&i()},[p,i]),!m||!p)return null;let{cancel:f,progress:_}=m;return(0,r.jsxs)("div",{className:u.Z.segmentWidgetMenuProgress,children:[(0,r.jsx)(n.Z,{style:{margin:"4px"},size:"mini",trailColor:"var(--lvv-color-main-0.2)",percent:_}),(0,r.jsx)("span",{className:u.Z.segmentWidgetMenuProgressText,children:o.oc.t("web_editor_loading_loading_percentage",{number0:_||0},`Loading effects... ${_||0}%`)}),(0,r.jsx)(a.Z,{type:"text",size:"mini",style:{height:"22px",padding:"0px 8px"},onClick:()=>{f(),t(),i()},children:o.oc.t("web_editor_button_cancel",{},"Cancel")})]})}))},356843:function(e,t,i){i.d(t,{x:function(){return m}});var r=i(845163),n=i(218571),a=i(298522),s=i(295045),o=i(786030),l=i(413409),d=i(95565),u=i(98702);let c=["TEXTAREA","INPUT","SELECT"],h=async e=>{let t=e.getSelectedText();if(!!t)await navigator.clipboard.writeText(t)},g={MoveCursorLeft:e=>e.textMoveCursorByDirection(o.Nm.Left),MoveCursorRight:e=>e.textMoveCursorByDirection(o.Nm.Right),MoveCursorUp:e=>e.textMoveCursorByDirection(o.Nm.Up),MoveCursorDown:e=>e.textMoveCursorByDirection(o.Nm.Down),MoveCursorLeftAndSelect:e=>e.textMoveCursorAndSelect(o.Nm.Left),MoveCursorRightAndSelect:e=>e.textMoveCursorAndSelect(o.Nm.Right),MoveCursorUpAndSelect:e=>e.textMoveCursorAndSelect(o.Nm.Up),MoveCursorDownAndSelect:e=>e.textMoveCursorAndSelect(o.Nm.Down),MoveCursorToLineBeginning:e=>e.textMoveCursorToLineHead(),MoveCursorToLineEnd:e=>e.textMoveCursorToLineEnd(),MoveCursorToBeginning:e=>e.textMoveCursorToHead(),MoveCursorToEnd:e=>e.textMoveCursorToEnd(),MoveCursorToPreviousWordBeginning:e=>e.textMoveCursorByWordBoundary(o.Nm.Left),MoveCursorToNextWordEnd:e=>e.textMoveCursorByWordBoundary(o.Nm.Right),SelectAll:e=>e.textSelectAll(),SelectToLineBeginning:e=>e.textSelectToLineHead(),SelectToLineEnd:e=>e.textSelectToLineEnd(),SelectToBeginning:e=>e.textSelectToHead(),SelectToEnd:e=>e.textSelectToEnd(),SelectPreviousWord:e=>e.textSelectWordByDirection(o.Nm.Left),SelectNextWord:e=>e.textSelectWordByDirection(o.Nm.Right),BackDelete:e=>e.textBackDelete(),ForwardDelete:e=>e.textForwardDelete(),DeleteToLineBeginning:e=>e.textDeleteToLineHead(),DeleteToLineEnd:e=>e.textDeleteToLineEnd(),DeletePreviousWord:e=>e.textDeleteWordByDirection(o.Nm.Left),DeleteNextWord:e=>e.textDeleteWordByDirection(o.Nm.Right),Undo:e=>e.textEditUndo(),Redo:e=>e.textEditRedo(),Copy:(e,t)=>h(t),Cut:(e,t)=>t.getHasSelection()?(h(t),e.textBackDelete()):Promise.resolve()};function m(e){let{ref:t,maxLength:i,editorUtil:o,isTemplate:h,performanceMark:m,postInput:p,onEscapePress:f}=e,_=(0,n.useContext)(d.e),v=(0,n.useContext)(u.p),M=(0,n.useRef)(!1),S=(0,n.useRef)(""),y=(0,n.useCallback)(e=>{if(!i)return e;let t=_.getText();return t.length>=i?"":e.slice(0,i-t.length)},[_,i]),T=(0,n.useCallback)(async e=>{if(M.current)return;m("text_edit_input_str");let t=e.target,i=y(t.value);t.value="",await o.textInputStr(i),null==p||p(i)},[p,o,y,m]),b=(0,n.useCallback)(async()=>{M.current=!0,await o.textStartCompose("")},[o,_]),I=(0,n.useCallback)(async e=>{if(!e.data)return;m("text_edit_composition_update"),await o.textPreEditCompose(e.data);let t=await o.textGetPlainStr();_.actionTextEditingTextSet(t),S.current=e.data},[o,m,_]),w=(0,n.useCallback)(async e=>{if(m("text_edit_composition_end"),!M.current)return;let t=e.target,i=y(t.value);t.value="",M.current=!1,await o.textEndCompose(i),null==p||p(i),S.current=""},[p,o,y,m]),k=(0,n.useCallback)(async e=>{if(M.current)return;if("Tab"===e.code){e.preventDefault(),e.stopPropagation();return}if("Escape"===e.code){let e=await o.textGetPlainStr();null==f||f(e);return}let t=(0,l.F)(e);if(!!t)e.preventDefault(),e.stopPropagation(),m(t),(0,g[t])(o,_)},[o,_,f,m]),A=(0,n.useCallback)(()=>{var e;null===(e=t.current)||void 0===e||e.focus({preventScroll:!0})},[t]),{run:C,cancel:D}=(0,r.default)(()=>{if(!(document.activeElement&&c.includes(document.activeElement.tagName)))A()},500,!1,{deps:[A]}),x=(0,n.useCallback)(e=>{M.current&&S.current&&(o.textEndCompose(S.current),M.current=!1,S.current="");let t=e.relatedTarget;if(!t||(0,s.S)(t)&&!c.includes(t.tagName)){A();return}C()},[o,A,C]),{run:P}=(0,a.Z)(async(e,t)=>{if(!M.current)await o.textUpdateEditingContent(e,!0),v.actionTextEditingSavedTextSet(t)},{leading:!1,trailing:!0,wait:800,maxWait:1600}),E=(0,n.useCallback)(async()=>{let e=await o.textGetPlainStr();_.actionTextEditingTextSet(e),P(_.getEditingSegmentId(),e)},[P,o,_,h]),N=(0,n.useCallback)(async()=>{let e=await o.textGetPlainStr();_.actionTextEditingTextInit(e)},[o,_,h]);return(0,n.useEffect)(()=>{let e=_.onDidChangeEditingTextToCommit(E),t=_.onDidChangeEditingText(N);return()=>{e.dispose(),t.dispose()}},[_,E,N]),(0,n.useEffect)(()=>{let e=t.current;return e&&(e.addEventListener("input",T),e.addEventListener("compositionstart",b),e.addEventListener("compositionupdate",I),e.addEventListener("compositionend",w),e.addEventListener("keydown",k),e.addEventListener("focus",D),e.addEventListener("blur",x)),()=>{e&&(e.removeEventListener("input",T),e.removeEventListener("compositionstart",b),e.removeEventListener("compositionupdate",I),e.removeEventListener("compositionend",w),e.removeEventListener("keydown",k),e.removeEventListener("focus",D),e.removeEventListener("blur",x))}},[D,x,t,w,b,I,T,k]),{focus:A}}},66829:function(e,t,i){i.d(t,{t:function(){return a}});var r=i(426336);let n=(e,t,i)=>{let n=t.getSegmentById(e);if(n&&(0,r.Ftn)(n)){let a=i.getRenderConfig(),s=new r.BzH;s.iOpCode=r.wIK.CT_EDIT_TEXT_PARAM,s.iParam1=1,s.iParam5=JSON.stringify((0,r.FA)(n.material,n.shape,n.bloom,!1,a,t.getDraftProperty().subtitleKeywordsConfig)),(0,r.o8O)(e,n.material.clone(),s)}},a=(e,t)=>{let i=e[r.u4I.SEGMENT];if(!i.length)return;let a=i.filter(e=>e.type===r.C8.UPDATE).map(e=>e.item.id);a.length>0&&a.forEach(i=>{n(i,e.videoDocument,t)})}},788086:function(e,t,i){i.d(t,{U:function(){return l}});var r=i(772322),n=i(95565),a=i(98702),s=i(183765),o=i(216030);class l{constructor(e,t){this._richTextEditorManager=e,this._store=t,this.render=e=>{let t=this._richTextEditorManager.getEditorUtil();return(0,r.jsx)(n.e.Provider,{value:this._richTextEditorManager,children:(0,r.jsx)(s.f.Provider,{value:t,children:(0,r.jsx)(a.p.Provider,{value:this._store,children:(0,r.jsx)(o.Q,{segment:e.segment,selectedSegmentChildIndex:e.selectedSegmentChildIndex,rect:e.rect,resizeScale:e.resizeScale,getWrapSize:e.getWrapSize,displayCursor:e.displayCursor,initialCursorPos:e.initialCursorPos,isTemplate:e.isTemplate,actionSetIsShowAttributeByCanvasClick:e.actionSetIsShowAttributeByCanvasClick,canvasManager:e.canvasManager})})})})}}}},883019:function(e,t,i){i.d(t,{L:function(){return s}});var r=i(29188),n=i(572013),a=i(218571);function s(e){let{firstFrameInfo:t}=e,i=e=>{if(e){var t,i;return(0,n.Ce)([null==e?void 0:null===(t=e.draft_info)||void 0===t?void 0:t.canvas_config.width,null==e?void 0:null===(i=e.draft_info)||void 0===i?void 0:i.canvas_config.height])}return null},[s,o]=(0,a.useState)(i(t));return(0,a.useEffect)(()=>{t?o(i(t)):o([r.fQ.width,r.fQ.height])},[t]),{firstFrameSize:s}}},454778:function(e,t,i){i.d(t,{v:function(){return v}});var r=i(953032),n=i(544633),a=i(218571),s=i(937802),o=i(763832),l=i(426336),d=i(610142),u=i(433140),c=i(334769),h=i(563431),g=i(102030),m=i(105166),p=i(601507),f=i(285322),_=i(271564);let v=(e,t,i,v)=>{let M=(0,s.G)(d.L),S=(0,s.G)(u.c),y=(0,c.F)(e),T=(0,g._)(e),b=(0,m.K)(e),{selectionManager:I}=e.modules,{conflictModalSelectors:w}=v,k=(0,a.useRef)(null),A=(0,a.useRef)(null),C=(0,a.useRef)({}),D=(0,a.useRef)({}),x=(0,a.useRef)([]),P=(0,a.useRef)(!1),E=(0,a.useRef)(),N=(0,a.useRef)(),R=(0,a.useRef)(!1),L=(0,a.useRef)(null),j=(0,a.useRef)(new Set),O=(0,a.useRef)([]),B=(0,n.default)(()=>{let{mutableVideos:e,subDraftSegments:i}=I,{canvasRectangles:r}=t,n=new Set(e.map(e=>e.segmentId)),a=new Set(i.map(e=>e.id)),s=r.filter(e=>{let{id:t}=e;return n.has(t)||a.has(t)}).map(e=>a.has(e.id)?{...e,subRects:e.subRects.filter(e=>n.has(e.id))}:e);j.current=a,O.current=s});(0,a.useEffect)(()=>{B()},[t.canvasRectangles]);let z=(0,n.default)(()=>{E.current&&!j.current.has(E.current)?M.hideSnapshot():M.showSnapshot();let e=(()=>{if("leave"!==L.current||!k.current)return!1;let{clientX:e,clientY:t}=k.current;return Array.from(document.querySelectorAll(w.join(","))).some(i=>(0,h.nS)(i.getBoundingClientRect(),{x:e,y:t},1))})();("string"!=typeof L.current||"leave"===L.current&&!e)&&E.current&&I.selectSegments([E.current]),b.refreshCurrentFrame(0,!0)}),U=(0,n.default)(async()=>{if(P.current)return;P.current=!0,await (0,o._)(0);let e=performance.now()+33;for(;;){if(performance.now()>=e){await (0,o._)(0),e=performance.now()+33;continue}let t=x.current.shift();if(!t){z(),P.current=!1;return}let{type:i,segmentId:r,options:n}=t;if("clear"===i){C.current[r]&&!D.current[r]&&(await b.clearVideoSubstitute(r,n),C.current[r]=void 0);continue}let{imagePath:a}=t;if(a!==C.current[r]&&a===D.current[r]){let e=await (0,p.L)(T,S,A.current),t=e.ok?e.value:"";if(!t)continue;await b.setVideoSubstitute(r,t,n),C.current[r]=a}}}),V=(0,n.default)(()=>{let e=E.current,t=N.current;e&&!j.current.has(e)&&(D.current[e]=void 0,x.current.push({type:"clear",segmentId:e,options:{subDraftSegmentId:t}})),E.current=void 0,N.current=void 0,U()}),Z=(0,n.default)((e,t)=>{if(!A.current)return;let i=(0,p.R)(A.current);i&&!j.current.has(e)&&(D.current[e]=i,x.current.push({type:"set",segmentId:e,imagePath:i,options:{subDraftSegmentId:t}})),E.current=e,N.current=t,U()}),F=(0,n.default)(e=>{var r;if(!R.current)return;k.current=e;let{canvasSize:n}=t,a=(0,h.sc)(i,n,e),[s,o]=null!==(r=(0,f.i)(O.current,a))&&void 0!==r?r:[];if(e.isTrusted&&s===E.current&&s===I.segmentId)return;let d=s?y.draftView.getSegmentById(s):null;if(A.current&&d&&(0,l.hey)(d)&&!(0,l.duj)(d)){if((0,_.Hs)(A.current,d))t.actionDisabledRectangleIdsRemove(d.id);else{M.setDropEffectManually("not-allowed"),t.actionDisabledRectangleIdsSet(d.id);return}M.setDropEffectManually("grab")}V(),s&&s!==I.expandedSegmentId&&Z(s,o)}),{run:G}=(0,r.default)(F,33),W=(0,n.default)((e,t)=>{R.current=!0,k.current=e,A.current=t,L.current=null,B()});return{startDraggingVideoOnCanvas:W,stopDraggingVideoOnCanvas:(0,n.default)((e,i)=>{R.current=!1,k.current=e,L.current=i,t.actionDisabledRectangleIdsClear(),V()}),handleVideoDragging:G}}},48312:function(e,t,i){i.d(t,{u:function(){return o}});var r=i(772322),n=i(827322),a=i(218571);let s={width:"100%",height:"100%",objectFit:"contain",position:"absolute",left:0,top:0,backgroundColor:"#000000"},o=e=>(0,a.useMemo)(()=>{if(!e||!e.imageUrl&&!e.color)return null;let{color:t,imageUrl:i}=e;return(0,r.jsx)(r.Fragment,{children:i?(0,r.jsx)("img",{style:s,src:(0,n.C)(i,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),alt:"",crossOrigin:"anonymous"}):(0,r.jsx)("div",{style:{backgroundColor:t,...s}})})},[e])},538676:function(e,t,i){i.d(t,{l:function(){return n}});var r=i(218571);function n(e){let[t,i]=(0,r.useState)(e.modules.playerController.isVEPlayerLoaded);return(0,r.useEffect)(()=>{let t=e.modules.playerController.onVEPlayerLoadedChange(e=>i(e));return()=>t.dispose()},[]),t}},696847:function(e,t,i){i.d(t,{Z:function(){return o}});var r=i(772322),n=i(218571),a=i(387217);let s=(e,t,i)=>{let[r,n,a,s]=e,o=t.width*i,l=t.height*i,d=o/2*Math.abs(a-r),u=l/2*Math.abs(s-n);return{originWidth:d,originHeight:u,originX:o/2*(r+1),originY:l/2*(1+n)}},o=e=>{let{fixedRectangle:t,dataSet:i,rect:o,scale:l,segment:d}=e,[u,c]=(0,n.useState)(s(t,o,l));if((0,n.useEffect)(()=>{t.length&&c(s(t,o,l))},[l,o.width,o.height,t]),!t||!d)return null;let{originHeight:h,originWidth:g,originX:m,originY:p}=u;return(0,r.jsx)("div",{className:a.Z.fixedRectangle,style:{width:g,height:h,left:m,top:p},...i})}},675279:function(e,t,i){i.d(t,{$:function(){return a}});var r=i(260963),n=i(218571);function a(e){let{canvasStore:t,playerRef:i,canvasCoverRef:a,widgetRef:s,widgetMenuContainerRef:o,deps:l=[],active:d}=e,[u,c]=(0,n.useState)(null),[h,g]=(0,n.useState)(!1),m=()=>g(e=>!e);return(0,n.useEffect)(()=>(0,r.EH)(()=>{let{widgetMenuUpdateTrigger:e}=t;e&&d&&m()}),[d]),(0,n.useLayoutEffect)(()=>{if(!(null==i?void 0:i.current)||!(null==a?void 0:a.current)||!s.current||!o.current){c(null);return}let e=i.current.getBoundingClientRect(),t=a.current.getBoundingClientRect(),r=s.current.getBoundingClientRect(),n=o.current.getBoundingClientRect(),l=r.left-t.left+r.width/2-n.width/2,d=r.top-t.top-n.height-8,{left:u,top:h}=((i,r)=>{let a=i,s=r,o=l+t.left-e.left,u=d+t.top-e.top,c=e.width-o-n.width,h=e.height-u-n.height;return o<10&&(a=e.left-t.left+10),c<10&&(a=t.width-(t.right-e.right+10+n.width)),u<10&&(s=e.top-t.top+10),h<10&&(s=t.height-(t.bottom-e.bottom+n.height+10)),{left:a,top:s}})(l,d);c({left:`${u}px`,top:`${h}px`})},[null==i?void 0:i.current,null==a?void 0:a.current,s.current,o.current,...l,h]),{position:u,forceUpdateOffset:m}}},159726:function(e,t,i){i.d(t,{Z:()=>X});var r=i("772322");i("17435");var n=i("544633"),a=i("629913"),s=i("435013"),o=i("697667"),l=i("111061"),d=i("563431"),u=i("683731"),c=i("954980"),h=i("288725"),g=i("294507"),m=i("168370"),p=i("893354"),f=i("751284"),_=i("298991"),v=i("426336"),M=i("355077"),S=i("655820"),y=i("218571"),T=i("243201"),b=i("296856"),I=i("150564"),w=i("105789"),k=i.n(w),A=i("670933"),C=i("52533"),D=i("663570"),x=i("690863"),P=i("40069");i("315688");var E=i("375216");let N=(0,y.forwardRef)((e,t)=>{let{rectangle:i,scale:n,displaySize:a,store:s}=e,{trackingRect:o}=null!=s?s:{},[l,d]=(0,y.useState)({x:i.x,y:i.y,width:i.width,height:i.height});(0,y.useEffect)(()=>{d({x:i.x,y:i.y,width:i.width,height:i.height})},[i]);let u=(0,y.useMemo)(()=>l?{x:l.x*n+l.width*n/2,y:l.y*n+l.height*n/2}:{},[i,n,l]),c=(0,y.useMemo)(()=>{var e,t;let i=a[0]*n,r=a[1]*n;return{x:i/2*((null!==(e=null==o?void 0:o.centerX)&&void 0!==e?e:0)+1),y:r/2*((null!==(t=null==o?void 0:o.centerY)&&void 0!==t?t:0)+1)}},[a,n,o]);return(0,y.useImperativeHandle)(t,()=>({setRectangle:e=>{d(e)}})),(0,r.jsx)(E.Z,{startPoint:c,endPoint:u})}),R=(0,A.f3)("store","canvasManager")((0,A.Pi)(N));var L=i("169180"),j=i("883700"),O=i("840461"),B=i("801497"),z=i("195265");let U=y.forwardRef((e,t)=>{let{children:i,playerRef:n,deps:s=[],...o}=e,[l,d]=(0,y.useState)("top"),{run:u,cancel:c}=(0,z.default)(()=>{if(!function(e){if(!(e&&"current"in e))throw Error("never")}(t),null==n?void 0:n.current){let e=t.current.getBoundingClientRect(),i=n.current.getBoundingClientRect();e.top<=i.height/2?d("top"):d("bottom")}},400);return(0,y.useLayoutEffect)(()=>(u(),c),[...s]),(0,r.jsx)(a.Z,{...o,position:l,getPopupContainer:()=>{var e;return null!==(e=null==n?void 0:n.current)&&void 0!==e?e:document.body},triggerProps:{autoFitPosition:!0},keepInsidePopupContainer:!0,children:y.Children.map(y.Children.toArray(i),e=>(0,y.cloneElement)(e,{ref:t}))[0]})}),V={[o.Wk.topLeft]:j.Z.pointTopLeft,[o.Wk.topRight]:j.Z.pointTopRight,[o.Wk.bottomLeft]:j.Z.pointBottomLeft,[o.Wk.bottomRight]:j.Z.pointBottomRight,[o.Wk.left]:j.Z.pointLeft,[o.Wk.right]:j.Z.pointRight},Z=`url(${h.Z}) 12 12, grab`,F=`url(${g.Z}) 12 12, grab`,G=`url(${u.Z}) 12 12, grab`,W=`url(${c.Z}) 12 12, grab`,Y=[j.Z.widgetResizeNwse,j.Z.widgetResizeNs,j.Z.widgetResizeNesw,j.Z.widgetResizeEw],H=[Z,F,W,G],Q=[j.Z.widgetRotateTopLeft,j.Z.widgetRotateTopRight,j.Z.widgetRotateBottomRight,j.Z.widgetRotateBottomLeft],K=(0,O.j)(Q),J=(0,y.forwardRef)((e,t)=>{var i,u,c;let{canvasManager:h,store:g,rectangle:w,displaySize:A,scale:E,widgetActive:N,selectedSubRectIndex:O=-1,subWidgetStyle:z,isDraggingMaterial:Z,isScaling:F,isRotating:G,isTranslating:W,isBoxSelecting:X,disabled:$,disableInteract:q,atomicDisableInteract:ee,onDidAtomicDisableInteract:et,shouldScaleAroundCenter:ei,parentWidgetRef:er,style:en,className:ea,pointActiveId:es,onSetPointActiveId:eo,rectangles:el,onClick:ed,onDoubleClick:eu,onMouseDown:ec,onDragPointStart:eh,onDragPoint:eg,onDragPointEnd:em,onDragStart:ep,onDrag:ef,onDragEnd:e_,onRotateStart:ev,onRotate:eM,onRotateEnd:eS,onSubRectClick:ey,onClickOutsideSubRects:eT,onRotateHoverChange:eb,onActive:eI,isInMultiWidget:ew=!1,isMultiWidget:ek=!1,keepBorder:eA=!1,playerRef:eC,canvasCoverRef:eD,onRotateButtonPositionChange:ex,getSegmentRectangles:eP,isParentActive:eE=!1,isNested:eN=!1,selectedSegmentIds:eR=[],ancestorRects:eL=[],isChildSelected:ej=!1,isSiblingSelected:eO=!1,onIllegalUpdateParams:eB}=e,{disableScale:ez,disableDrag:eU,disableRotate:eV}=ee||{},eZ=B.ZP.t("web_template_preview_toast_zoom_failed",{},"Can\u2019t zoom due to the template creator's settings"),eF=B.ZP.t("web_template_preview_toast_rotate_failed",{},"Can\u2019t rotate due to the template creator's settings"),eG=B.ZP.t("web_template_preview_toast_move_failed",{},"Can\u2019t move due to the template creator's settings"),{loading:eW,isProgressivelyLoading:eY,isTrackingEditMode:eH,readonly:eQ,trackingRectActive:eK,widgetSelectedOnly:eJ,canvasConfig:eX}=g,e$=eL.length?eL.at(-1):null,eq=N&&!eK,{state:e0,setState:e1,getState:e2,setStateSilently:e3,snapshot:e4,getSnapshot:e6}=function(e){let[t,i]=(0,y.useState)(e),r=(0,y.useRef)(e),n=(0,y.useRef)(e),a=(0,y.useRef)(e);e!==n.current&&(n.current=e,r.current=e);let s=(0,y.useCallback)(e=>{r.current=e,i(e)},[]),o=(0,y.useCallback)(e=>{r.current=e},[]),l=(0,y.useCallback)(()=>{r.current!==t&&i(r.current)},[]),d=(0,y.useCallback)(()=>{a.current=r.current},[]),u=(0,y.useCallback)(()=>r.current,[]),c=(0,y.useCallback)(()=>a.current,[]),h=(0,y.useCallback)(()=>n.current,[]);return{state:r.current,setState:s,getState:u,setStateSilently:o,flush:l,snapshot:d,getSnapshot:c,getStateFromProps:h}}(w),{transformVideoTrackingRect:e5,lastedApplyRect:e9}=(0,T.m)({displaySize:A,widgetRectangle:e0,isMultiWidget:ek,parentRect:e$}),e8=(0,y.useRef)(),e7=(0,y.useRef)([]),te=(0,y.useRef)(null),tt=(0,y.useRef)(null),ti=(0,y.useRef)(null),tr=(0,y.useRef)(null),tn=(0,y.useRef)(null),ta=(0,y.useRef)(null),ts=(0,y.useRef)(null),to=(0,y.useRef)(null),tl=(0,y.useRef)(null),td=(0,y.useRef)(!1),tu=(0,y.useRef)([]),tc=(0,y.useRef)(null),th=(0,y.useRef)(null),tg=(0,y.useRef)(null),tm=(0,y.useRef)(null),[tp,tf]=(0,y.useState)(null!=es?es:"");(0,y.useEffect)(()=>{null==eo||eo(tp)},[tp,eo]);let t_=(0,y.useCallback)(e=>{var t;e8.current&&(e8.current.style.width=`${e.width*E}px`,e8.current.style.height=`${e.height*E}px`,e8.current.style.transform=`translate(${e.x*E}px, ${e.y*E}px) rotate(${e.rotate}deg)`),null===(t=tg.current)||void 0===t||t.setRectangle({x:e.x,y:e.y,width:e.width,height:e.height}),e7.current.length>0&&e7.current.forEach((t,i)=>{if(!!t&&!!e.subRects[i])t.style.width=`${e.subRects[i].width*E}px`,t.style.height=`${e.subRects[i].height*E}px`,t.style.transform=`translate(${e.subRects[i].x*E}px, ${e.subRects[i].y*E}px) rotate(${e.subRects[i].rotate}deg)`})},[E]);(0,y.useEffect)(()=>{ek&&t_(w)},[w.timestamp||0,ek]);let{width:tv,height:tM,type:tS,rotate:ty,id:tT,x:tb,y:tI}=e2(),[tw,tk]=A,tA=(0,y.useMemo)(()=>h.dataSDK.draftView.getSegmentById(e0.id),[e0.id]),tC=tA&&(0,v.duj)(tA),tD="SegmentVideo"===tS&&0===ty&&0===tb&&0===tI&&(0,l.ip)(tv,tw,1)&&(0,l.ip)(tM,tk,1)&&!eq,tx=!tD&&!eN,tP=!tD&&(tC||!q),tE=tP&&!ew&&(!eN||eq),tN="SegmentText"===tS,tR=!!eq&&!eW&&!eY&&!ek&&!Z&&!G&&!F&&!W&&!eQ&&!eJ,tL=(0,L.c)(g,h,w,eR,tR),{menu:tj,menuPosition:tO}=(0,L.u)({canvasStore:g,canvasCoverRef:eD,playerRef:eC,widgetRef:e8,widgetMenuContainerRef:tm,deps:[e0,E],active:tR,...tL}),{rotateButtonPosition:tB,updateRotateButtonPosition:tz}=(0,P.X)({canvasCoverRef:eD,widgetRef:e8,displaySize:A,widgetMenuContainerRef:tm,getRectangle:e2,onRotateButtonPositionChange:ex});(0,y.useEffect)(tz,[tz,eq,tO]);let tU=(0,n.default)(async e=>{let{trigger:t,x:i,y:r}=e;if(!(null==t?void 0:t.id))return;let n=e6(),a=e2(),s={...a},o=[i/E,r/E],d=(0,l.Ew)(s,t.id,o)[0]-(s.width-n.width)/2,u=s.height/s.width*d;(0,l.Qf)(s,d,u);let c=v.pMA.times(s.originalWidth,.01),h=v.pMA.times(s.originalWidth,5),g=v.pMA.times(s.originalHeight,.01),m=v.pMA.times(s.originalHeight,5),p=Math.max(Math.min(s.width,h),c),f=Math.max(Math.min(s.height,m),g),_=-v.pMA.minus(s.width,p),M=-v.pMA.minus(s.height,f);if((0,l.Qf)(s,_,M),s.width===a.width&&s.height===a.height)return;s.subRects=s.subRects.map((e,i)=>{let r={...e},a=v.pMA.div(s.width,n.width),o=n.subRects[i];if(!o)return e;r.width=a*o.width,r.height=a*o.height;let[d,u]=(0,l.wJ)(n,s,[o.x,o.y],null==t?void 0:t.id);return r.x=d,r.originalX=r.x,r.y=u,r.originalY=r.y,r});let y=(0,S.uH)(s,A,eL);e3(s),await e5(y,s),null==eg||eg(y,s,()=>{t_(s)})}),tV=(0,y.useCallback)(async e=>{let{trigger:t,x:i,y:r}=e;if(ez)return;if(ei){await tU(e);return}let n=e6(),a=e2(),s={...a},o=[i/E,r/E];if(!(null==t?void 0:t.id))return;let d=(0,l.Ew)(s,t.id,o)[0]-(s.width-n.width),u=s.height/s.width*d,{oppositeIndex:c}=(0,l.dL)(null==t?void 0:t.id);(0,l.dK)(s,d,u,c),s.rotate%360==0&&(s=(0,l._l)({displaySize:A,resizeScale:E,rect:s,oldRect:a,absorbCenter:!1,trigger:t.id}));let h=v.pMA.times(s.originalWidth,.01),g=v.pMA.times(s.originalWidth,5),m=v.pMA.times(s.originalHeight,.01),p=v.pMA.times(s.originalHeight,5),f=Math.max(Math.min(s.width,g),h),_=Math.max(Math.min(s.height,p),m),M=-v.pMA.minus(s.width,f),y=-v.pMA.minus(s.height,_);if((0,l.dK)(s,M,y,c),s.width===a.width&&s.height===a.height)return;s.subRects=s.subRects.map((e,i)=>{let r={...e},a=v.pMA.div(s.width,n.width),o=n.subRects[i];if(!o)return e;r.width=a*o.width,r.height=a*o.height,r.originalX=o.originalX-(r.width-o.width)/2,r.originalY=o.originalY-(r.height-o.height)/2;let[d,u]=(0,l.wJ)(n,s,[o.x,o.y],null==t?void 0:t.id);return r.x=d,r.y=u,r});let T=(0,S.uH)(s,A,eL);(Object.hasOwnProperty.call(T,"scaleX")&&((0,C.Z)(T.scaleX)||isNaN(T.scaleX))||Object.hasOwnProperty.call(T,"scaleY")&&((0,C.Z)(T.scaleY)||isNaN(T.scaleY)))&&(null==eB||eB({width:s.width,height:s.height,originalWidth:s.originalWidth,originalHeight:s.originalHeight})),await e5(T,s),null==eg||eg(T,s,()=>{t_(s)}),e3(s)},[A,E,eg,eL,t_,ez,ei]),{syncWidgetHeightAndY:tZ}=(0,S.fp)(eP),tF=(0,n.default)(e=>{let{trigger:t,x:i,y:r}=e;if(ez||!(null==t?void 0:t.id))return;let n=e2(),a=e6(),s={...n},o=[i/E,r/E],{oppositeIndex:d}=(0,l.dL)(null==t?void 0:t.id),u=(0,l.Ew)(s,t.id,o)[0]-(s.width-a.width)/2;if(!(s.width+u<16))(0,l.Bp)(s,u,d),null==eg||eg((0,S.bC)(s,A,eL),s,()=>{tZ(e2,e1,eL)}),e3(s)}),tG=(0,n.default)(e=>{let{trigger:t,x:i,y:r}=e;if(ez)return;if(ei){tF(e);return}let n=e2(),a=e6(),s={...n},o=[i/E,r/E];if(!(null==t?void 0:t.id))return;let{oppositeIndex:d}=(0,l.dL)(null==t?void 0:t.id),u=(0,l.Ew)(s,t.id,o)[0]-(s.width-a.width);if(s.width+u<16)return;(0,l.$n)(s,u,d);let c=(0,S.bC)(s,A,eL);null==eg||eg(c,s,()=>{tZ(e2,e1,eL)}),e3(s)}),tW=(0,y.useRef)(!1),tY=(0,y.useRef)(Promise.resolve()),tH=(0,y.useCallback)(async e=>{var t,i;let{x:r,y:n,actionType:a}=e,s="Drag"===a;if(eU){tW.current=!0,document.body.classList.add(j.Z.notAllowed);return}if(!eq)return;let o=e2(),d=e6(),u={...o},c=s?v.pMA.div(r,E):r,h=s?v.pMA.div(n,E):n;if(u.x=Math.max(Math.min(d.x+c,e$?e$.x+e$.width:tw),(null!==(t=null==e$?void 0:e$.x)&&void 0!==t?t:0)-u.width),u.y=Math.max(Math.min(d.y+h,e$?e$.y+e$.height:tk),(null!==(i=null==e$?void 0:e$.y)&&void 0!==i?i:0)-u.height),u.x===o.x&&u.y===o.y)return;u.rotate%90==0&&s&&(u=(0,l._l)({displaySize:A,resizeScale:E,oldRect:o,rect:u,rectangles:el}));let g=v.pMA.minus(u.x,o.x),m=v.pMA.minus(u.y,o.y);u.subRects=u.subRects.map(e=>{let t={...e};return t.x=v.pMA.plus(t.x,g),t.y=v.pMA.plus(t.y,m),t});let p=(0,S._X)(u,A,eL);await e5(p,u),e3(u),null==ef||ef(p,u,()=>{t_(u)},s)},[eq,A,tw,tk,E,ef,eL,el,t_,eU]),tQ=(0,y.useRef)(0),tK=(0,y.useCallback)(e=>{let{deltaDegree:t,event:i}=e;if(eV||0===t)return;let r=e2(),n={...r};if(n.rotate=r.rotate-t,!i.altKey){let{adsorbedAngle:e,targetAngle:t}=(0,l.Fx)(n.rotate+tQ.current,3);n.rotate=t,tQ.current=e}if(n.rotate=Math.floor(10*n.rotate)/10,n.rotate>s.b||n.rotate<-s.b||n.rotate===r.rotate)return;let a=v.pMA.minus(n.rotate,r.rotate),o=n.x+n.width/2,d=n.y+n.height/2;n.subRects=n.subRects.map(e=>{let t={...e},i=e.x+e.width/2,r=e.y+e.height/2,[n,s]=(0,l.Sq)([o,d],[i,r],a);return t.rotate=v.pMA.plus(t.rotate,a),t.x=n-e.width/2,t.y=s-e.height/2,t});let u=(0,S.QF)(n,A,eL);null==eM||eM(u,n,()=>{t_(n)}),e3(n)},[eM,eL,A,E,eV]),tJ=(0,y.useCallback)(()=>{let e=["nwse-resize","ns-resize","nesw-resize","ew-resize"],t=e2().rotate,i=(0,l.Yr)(t);[te,void 0,tt,th,tr,void 0,ti,tc].forEach((t,r)=>{let n=Math.round(i/45)+r;if(null==t?void 0:t.current){let i=n%e.length;t.current.style.cursor=e[i],t.current.dataset.cursorClass=Y[i]}}),[tn,ta,to,ts].forEach((e,t)=>{let r=Math.round(i/90);if(e.current){let i=(r+t)%H.length;e.current.style.cursor=H[i],e.current.dataset.cursorClass=Q[i]}})},[ek]);function tX(e,t,i){if(eU&&tW.current){document.body.classList.remove(j.Z.notAllowed),tW.current=!1,null==et||et("disableDrag"),p.Z.info(eG,{getContainer(){var e;return null!==(e=null==eC?void 0:eC.current)&&void 0!==e?e:document.body}});return}if("Drag"===e&&!t)return;let r=e2(),n=(0,S._X)(r,A,eL),a=e9.current;a&&(n.translateX=a.translateX,n.translateY=a.translateY,n.subRects=a.subRects),null==e_||e_(n,r,"Drag"===e,i),tz()}(0,m.c)({enable:!!eq&&!q,refs:[te,tt,ti,tr],onStart:(0,y.useCallback)(e=>{if(!ez)e4(),tf(e.target.id),null==eh||eh(e)},[ez,e0,eh]),onDrag:tV,onEnd:()=>{if(ez)return;let e=e2(),t=(0,S.uH)(e,A,eL);if(e9.current){let e=e9.current;t.translateX=e.translateX,t.translateY=e.translateY,t.scaleX=e.scaleX,t.scaleY=e.scaleY,t.subRects=e.subRects}null==em||em(t,e),tz()},keepCursorStyle:!0}),(0,m.c)({enable:!!eq&&!q,refs:[tc,th],onStart:(0,y.useCallback)(e=>{if(!ez)e4(),null==eh||eh(e),tf(e.target.id)},[ez,e0,eh]),onDrag:tG,onEnd:()=>{if(ez)return;let e=e2();null==em||em((0,S.bC)(e,A,eL),e)},keepCursorStyle:!0}),(0,m.c)({enable:tE,refs:[e8],stopPropagation:!1,onStart:(0,y.useCallback)(e=>{if(!eU)e4(),null==ep||ep(e)},[eU,e0,ep]),onDrag:e=>{tY.current=tH({x:e.x,y:e.y,actionType:"Drag"})},onEnd:e=>{tY.current.then(()=>{tX("Drag",e)})},triggerStartThresholdDis:2}),(0,b.h)({isVideoSegment:!!(tA&&(0,v.hey)(tA)),isMultiWidget:ek,displaySize:A,canvasConfig:eX,ifWidgetShortcutCanMove:null!=tE&&tE&&!W&&!F&&!G&&!eU,widgetActive:null!==(i=N&&(ek||eR.includes(w.id)))&&void 0!==i&&i,handleWidgetTranslateStart:()=>{e4()},handleWidgetTranslate:e=>{let{x:t,y:i}=e;tY.current=tH({x:t,y:i,actionType:"Shortcut"})},handleWidgetTranslateEnd:e=>{tY.current.then(()=>{tX("Shortcut",!1,e)})}}),(0,f.C)({enable:!!eq&&!q,refs:[tl,tn,ta,ts,to],centerRef:e8,onStart:()=>{if(!eV)null==ev||ev()},onRotate:tK,onEnd:()=>{if(eV)return;let e=e2();tz(),null==eS||eS((0,S.QF)(e,A,eL),e),tJ()},keepCursorStyle:!0,cursorClassPrefix:K});let{onWidgetClick:t$}=(0,S.L9)({rect:e0,scale:E,widgetRef:e8,onSubRectClick:ey,onClickOutsideSubRects:eT});(0,y.useEffect)(()=>{eq&&tJ()},[eq,w.rotate,e0.rotate,tJ]),(0,y.useEffect)(()=>{!eq&&tf("")},[eq]),(0,y.useEffect)(()=>{eq&&!ej?null==eI||eI(e0.id):null==eI||eI(null)},[eq,ej,eI,e0.id]);return(0,r.jsxs)(r.Fragment,{children:[eH&&N&&(0,r.jsx)(R,{ref:tg,rectangle:e0,scale:E,displaySize:A}),tR&&tj,(0,r.jsxs)("div",{ref:e=>{"function"==typeof t?t(e):t&&(t.current=e),e8.current=null!=e?e:void 0},"data-if-rect-can-drag":tP,"data-widget-id":tT,tabIndex:-1,className:k()(j.Z.segmentWidget,ea,V[tp],{[j.Z.active]:eq,[j.Z.disabled]:$,[j.Z.childSelected]:eq&&(O>=0||ej),[j.Z.isScaling]:F,[j.Z.isRotating]:G,[j.Z.isTranslating]:W,[j.Z.isBoxSelecting]:X,[j.Z.isMinSize]:e0.width*E<6||e0.height*E<6,[j.Z.isTextMiniSize]:tN&&e0.height*E<32,[j.Z.isDraggingMaterial]:Z,[j.Z.keepBorder]:eA,[j.Z.isParentActive]:eE,[j.Z.isNested]:eN,[j.Z.isSelected]:eR.includes(w.id)}),style:{width:`${e0.width*E}px`,height:`${e0.height*E}px`,transform:`translate(${e0.x*E}px, ${e0.y*E}px) rotate(${e0.rotate}deg)`,...en},onDoubleClick:e=>{e.stopPropagation(),!tD&&(null==eu||eu(e,e0.id))},onMouseDown:e=>{var t;if(e.stopPropagation(),(0,_.HM)(),td.current=!1,tu.current=[e.pageX,e.pageY],tx&&e.isTrusted){null==ec||ec(e,e0.id,eL);return}if(eq||eO||!eE)return;let i=(0,d.sc)(eD,A,e.nativeEvent);if(!!e$&&!!i&&!!(0,d.S5)(e$,i))null==er||null===(t=er.current)||void 0===t||t.dispatchEvent(new window.MouseEvent(e.type,e.nativeEvent))},onMouseMove:e=>{if(tu.current.length){let{pageX:t,pageY:i}=e,[r,n]=tu.current;Math.sqrt((t-r)**2+(i-n)**2)>(eN||ek?2:20)&&(td.current=!0)}else td.current=!0},onClick:e=>{if(e.stopPropagation(),td.current){td.current=!1,tu.current=[];return}!tx&&(null==ec||ec(e,e0.id,eL)),t$(e),null==ed||ed(e,e0,eL)},children:[!eq||ej||q?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U,{content:eZ,disabled:!ez,onVisibleChange:e=>{e&&(null==et||et("disableScale"))},ref:te,playerRef:eC,deps:[e0,E],children:(0,r.jsx)("span",{id:o.Wk.topLeft,className:`${j.Z.point} ${j.Z.pointTopLeft} widget-control-point ${ez?j.Z.disabled:""}`})}),(0,r.jsx)(U,{content:eZ,disabled:!ez,onVisibleChange:e=>{e&&(null==et||et("disableScale"))},ref:tt,playerRef:eC,deps:[e0,E],children:(0,r.jsx)("span",{id:o.Wk.topRight,className:`${j.Z.point} ${j.Z.pointTopRight} widget-control-point ${ez?j.Z.disabled:""}`})}),(0,r.jsx)(U,{content:eZ,disabled:!ez,onVisibleChange:e=>{e&&(null==et||et("disableScale"))},ref:ti,playerRef:eC,deps:[e0,E],children:(0,r.jsx)("span",{id:o.Wk.bottomLeft,className:`${j.Z.point} ${j.Z.pointBottomLeft} widget-control-point ${ez?j.Z.disabled:""}`})}),(0,r.jsx)(U,{content:eZ,disabled:!ez,onVisibleChange:e=>{e&&(null==et||et("disableScale"))},ref:tr,playerRef:eC,deps:[e0,E],children:(0,r.jsx)("span",{id:o.Wk.bottomRight,className:`${j.Z.point} ${j.Z.pointBottomRight} widget-control-point ${ez?j.Z.disabled:""}`})}),(0,r.jsx)(U,{content:eF,disabled:!eV,onVisibleChange:e=>{e&&(null==et||et("disableRotate"))},ref:tl,playerRef:eC,deps:[e0,E],children:(0,r.jsxs)("span",{className:k()(j.Z.pointRotate,{[j.Z.pointRotateNormal]:"normal"===tB,[j.Z.pointRotateSymmetric]:"symmetric"===tB,"widget-control-point":!0,[j.Z.disabled]:eV}),onMouseOver:()=>{!Z&&(null==eb||eb({val:!0,newRect:e0}))},onMouseLeave:()=>{!Z&&(null==eb||eb({val:!1,newRect:e0}))},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:j.Z.pointRotateConnector}),(0,r.jsx)(I.pZM,{className:j.Z.iconRotate,size:16})]})})]}),eq&&tN&&!q?(0,r.jsxs)("div",{children:[(0,r.jsx)(a.Z,{content:eZ,disabled:!ez,position:"left",onVisibleChange:e=>{e&&(null==et||et("disableScale"))},children:(0,r.jsx)("span",{ref:tc,id:o.Wk.left,className:k()(j.Z.point,j.Z.pointLeft,ez&&j.Z.disabled)})}),(0,r.jsx)(a.Z,{content:eZ,disabled:!ez,position:"right",onVisibleChange:e=>{e&&(null==et||et("disableScale"))},children:(0,r.jsx)("span",{ref:th,id:o.Wk.right,className:k()(j.Z.point,j.Z.pointRight,ez&&j.Z.disabled)})})]}):null,!eq||q||eV?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{ref:tn,className:`${j.Z.rotateArea} ${j.Z.rotateAreaTopLeft} widget-control-point`}),(0,r.jsx)("span",{ref:ta,className:`${j.Z.rotateArea} ${j.Z.rotateAreaTopRight} widget-control-point`}),(0,r.jsx)("span",{ref:ts,className:`${j.Z.rotateArea} ${j.Z.rotateAreaBottomLeft} widget-control-point`}),(0,r.jsx)("span",{ref:to,className:`${j.Z.rotateArea} ${j.Z.rotateAreaBottomRight} widget-control-point`})]}),eq?(0,r.jsx)(D.Z,{rect:e0,scale:E,dataSet:{"data-if-rect-can-drag":tP}}):null,eq?(0,r.jsx)(x.Z,{rect:e0,scale:E,dataSet:{"data-if-rect-can-drag":tP}}):null]}),tC?eq&&(null==e0?void 0:null===(u=e0.subRects)||void 0===u?void 0:u.map((e,t)=>(0,r.jsx)(J,{ref:e=>e7.current[t]=e,store:g,canvasManager:h,rectangle:e,rectangles:e0.subRects,displaySize:A,scale:E,isBoxSelecting:X,widgetActive:eR.includes(e.id),selectedSegmentIds:eR,selectedSubRectIndex:O,disableInteract:q,onMouseDown:ec,isDraggingMaterial:Z,isScaling:F,isTranslating:W,isRotating:G,pointActiveId:tp,isInMultiWidget:ew,playerRef:eC,canvasCoverRef:eD,parentWidgetRef:e8,onClick:ed,onDoubleClick:eu,onDragPointStart:eh,onDragPoint:eg,onDragPointEnd:em,onDragStart:ep,onDrag:ef,onDragEnd:e_,onRotateStart:ev,onRotate:eM,onRotateEnd:eS,onSubRectClick:ey,onClickOutsideSubRects:eT,onRotateHoverChange:eb,onRotateButtonPositionChange:ex,isParentActive:eq,isNested:!0,ancestorRects:[...eL,w],getSegmentRectangles:eP,isSiblingSelected:!!(null==e0?void 0:e0.subRects.find(e=>eR.includes(e.id))),atomicDisableInteract:ee,onDidAtomicDisableInteract:et,shouldScaleAroundCenter:ei},`${e.id}-${String(t)}`))):null==e0?void 0:null===(c=e0.subRects)||void 0===c?void 0:c.map((e,t)=>(0,r.jsx)(M.Z,{ref:e=>e&&(e7.current[t]=e),subWidgetStyle:z,active:eq,selected:O===t,subRect:e,scale:E},`${e0.id}-${String(t)}`))]})}),X=(0,A.Pi)(J)},590241:function(e,t,i){i.d(t,{Z:function(){return y}});var r=i(772322),n=i(544633),a=i(446352),s=i(15754),o=i(35389),l=i(772664),d=i(463220),u=i(378521),c=i(817368),h=i(38476),g=i(801497),m=i(105789),p=i.n(m),f=i(670933),_=i(218571),v=i(265471),M=i(862340);i(740973);var S=i(48312);let y=(0,f.f3)("store","canvasManager")((0,f.Pi)(e=>{var t;let{canvasManager:i,store:m,shouldDisplayError:f,isNewEditPage:y,isTemplate:T=!1,videoUrl:b,mute:I,fixPosition:w}=e,{coverUrl:k,videoPreviewLoaded:A,isCanvasEmpty:C,canvasRatio:D,isDragMode:x,userScale:P,isFullscreen:E,isPlaying:N,needZoomToFit:R,videoPreviewStatus:L,previewInfo:j}=m,O=(0,_.useRef)(null),B=(0,_.useRef)(null),z=(0,_.useRef)(null),U=(0,_.useRef)(null),V=(0,_.useRef)(null),Z=(0,_.useRef)(null),[F,G]=(0,_.useState)(!1),{infos:W,templateId:Y}=(0,d.R)(i),H=null===(t=W[Y])||void 0===t?void 0:t.cover,{exitFullscreen:Q}=(0,c.O)({isTemplate:T,store:m,canvasManager:i}),{displaySize:K,orientation:J}=(0,h.Lg)({store:m,canvasManager:i,isEmpty:!T&&C,canvasConfig:null!=H?H:null,canvasRatio:D}),{canvasResizeReady:X,resizeScale:$,userTranslate:q,canvasSize:ee,resizeTranslate:et,onUserScaleChange:ei,updateUserTranslate:er}=(0,u.FL)({canvasManager:i,store:m,isDragMode:x,canvasBoxRef:V,playerContentRef:U,displaySize:K,orientation:J,fixPosition:w});(0,u.Hp)({store:m,refEl:U,userScale:P,onUserScaleChange:ei});let en=(0,u.Nc)({store:m,userScale:P,onUserScaleChange:ei,playerContentRef:U,updateUserTranslate:er});(0,_.useEffect)(()=>{R&&(en(),m.actionNeedZoomToFitSet(!1))},[R,en]),(0,u.C2)({store:m,playerContentRef:U,userScale:P,userTranslate:q,updateUserTranslate:er,isTemplate:T}),(0,M.c)(Z,i);let ea=async t=>{O.current=await e.createPresetVideoPlayer(z.current,{url:t,width:"100%",height:"100%",forceMp4EncryptPlugin:!0,ignoresControl:[s.R.Start,s.R.Replay,"i18n",s.R.Poster],lang:g.oc.language,volume:I?0:.6,disableInactiveWaitingCheck:T}),i.modules.playerController.setVideoPlayer(O.current),L===a.bC.OnDisplay&&i.modules.playerController.activePreviewPlayer();let r=[O.current.onLoaded(()=>{var e,t;m.actionVideoPreviewLoadedSet(!0);let i=(null!==(t=null===(e=O.current)||void 0===e?void 0:e.duration)&&void 0!==t?t:0)*1e3;m.actionVideoPreviewDurationSet(BigInt(Math.floor(i)))}),O.current.onError(()=>{var t;G(!0),null===(t=e.onError)||void 0===t||t.call(e)})];return()=>{r.forEach(e=>e.dispose()),m.actionVideoPreviewInfoReset()}};(0,_.useEffect)(()=>{if(b){let e=ea(b);return()=>{e.then(e=>null==e?void 0:e())}}},[b]),(0,_.useEffect)(()=>{B.current.style.width=`${ee[0]}px`,B.current.style.height=`${ee[1]}px`},[ee]);let es=(0,n.default)(()=>{var e;return null===(e=Z.current)||void 0===e?void 0:e.getBoundingClientRect()}),eo=(0,_.useMemo)(()=>k&&!A?(0,r.jsx)("div",{style:{width:`${K[0]*$}px`,height:`${K[1]*$}px`,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundImage:`url(${k})`,backgroundRepeat:"no-repeat",backgroundSize:"cover"}}):null,[k,K,$,A]),el=(0,S.u)(j);return(0,r.jsx)("div",{className:"video-preview-player",ref:U,style:{position:w?"absolute":"relative"},children:(0,r.jsx)("div",{className:"canvas-space",children:(0,r.jsxs)("div",{ref:V,className:"canvas-wrapper",style:{visibility:X?"visible":"hidden"},children:[(0,r.jsx)("div",{className:p()("player-wrapper",{fullscreen:E}),ref:B,children:F&&f?(0,r.jsx)(v.Z,{}):(0,r.jsxs)("div",{className:"player-container",ref:z,children:[E?(0,r.jsx)(o.Z,{disabled:!1,cancelFullscreen:Q}):null,eo]})}),(0,r.jsxs)("div",{className:"canvas-cover",style:{width:`${K[0]*$}px`,height:`${K[1]*$}px`,display:A&&!E?"block":"none"},ref:Z,children:[el,(0,r.jsx)(l.Z,{playerRef:U,canvasCoverRef:Z,disabled:E||N,displaySize:K,resizeScale:$,isTemplate:T,getWrapperSize:es})]},"canvas-cover")]})})})}))},768303:function(e,t,i){i.d(t,{l:function(){return n}});var r,n=((r={})[r.Idle=0]="Idle",r[r.Running=1]="Running",r[r.Paused=2]="Paused",r[r.Destroyed=3]="Destroyed",r)},743109:function(e,t,i){i.d(t,{p:()=>ee});var r=i("789786"),n=i("260963"),a=i("999268"),s=i("846313"),o=i("587892"),l=i("402655"),d=i("230689"),u=i("425427"),c=i("159277"),h=i("539525"),g=i("54827"),m=i("426336"),p=i("174130"),f=i("305707"),_=i("795375"),v=i("382094"),M=i("431650"),S=i("481558"),y=i("440489"),T=i("889074");let b=e=>t=>t.actionOperateType===e,I=b(m.aWQ.Local),w=b(m.aWQ.Redo),k=b(m.aWQ.Undo),A=(0,h.Z)(m.hey,m.Ftn,m.Q2R),C=e=>{var t,i;let[r]=e[m.u4I.SEGMENT],n=null==r?void 0:null===(t=r.item)||void 0===t?void 0:t.segment;if((null==r?void 0:r.type)!==m.C8.UPDATE||!r.item.path)return!1;let a=e.videoDocument.getSegmentByIdRecursive(null===(i=r.item.path)||void 0===i?void 0:i[1]);return!!a&&n&&A(a)},D=e=>{var t;let i=e[m.u4I.SEGMENT].find(e=>e.type===m.C8.UPDATE),r=null==i?void 0:null===(t=i.item)||void 0===t?void 0:t.segment;if((null==i?void 0:i.type)!==m.C8.UPDATE||!i.item.id)return!1;let n=i.item.id,a=e.videoDocument.getSegmentByIdRecursive(n);return!!a&&!!(r&&A(a))},x=e=>{let t=[];for(let i of e[m.u4I.SEGMENT]){if(!i.item.path)continue;let[r,n]=i.item.path,a=e.videoDocument.getSegmentByIdRecursive(r);if(!a||!(0,m.duj)(a))break;if(!n)continue;let s=e.videoDocument.getSegmentByIdRecursive(n);if(!s||!A(s))continue;let o=f.gi.from(a),l=new _.tn(s.targetTimerange.start,s.targetTimerange.duration+s.targetTimerange.start,v.j.Microsecond),d=M.$.from(o,l);t.push(d)}return t},P=(e,t)=>{let{segment:i}=t.item;if(t.type!==m.C8.ADD||!i.id)return null;let r=i.id,n=e.videoDocument.getSegmentByIdRecursive(r);if(!n||!(0,m.duj)(n))return null;let a=f.gi.from(n);return a?M.$.from(a):null},E=e=>{let t=e[m.u4I.SEGMENT],i=[];for(let r of t){if(!r.item.path)continue;if(r.type===m.C8.ADD){let t=P(e,r);t&&i.push(t);continue}let[t]=r.item.path,n=e.videoDocument.getSegmentByIdRecursive(t);if(!n||!(0,m.duj)(n))continue;let a=f.gi.from(n);if(!a)continue;let s=M.$.from(a);i.push(s)}return i},N={transform:x,predicates:[I,C]},R={transform:x,predicates:[k,C]},L={transform:x,predicates:[w,C]},j={transform:E,predicates:[I,e=>{var t;let i=e[m.u4I.SEGMENT].find(e=>e.type===m.C8.ADD),r=null==i?void 0:null===(t=i.item)||void 0===t?void 0:t.segment;if((null==i?void 0:i.type)!==m.C8.ADD||!(null==r?void 0:r.id))return!1;let n=e.videoDocument.getSegmentById(r.id);return!!n&&(0,m.duj)(n)}]},O={transform:E,predicates:[I]},B={transform:E,predicates:[k,D]},z={transform:x,predicates:[w,D]},U={transform:E,predicates:[k,e=>!!e[m.u4I.SEGMENT].find(e=>e.type===m.C8.UPDATE&&e.item.segment.templateId)]};class V extends p.g{get _waitRenderManagerReady(){return(0,S.h)(()=>this._renderManager.current)}async _getOrCreateGeneratorInstance(e){if(!this.shouldUpdateGenerator(e))return this._generators.get(e.resourceKey);this.onSegmentFullUpdate.fire(e.resourceKey);let t=new y.r({timeRange:e.timeRange,singleFrameHeight:e.height,singleFrameWidth:e.width}),i=await this._waitRenderManagerReady,r=new T.Z(e,i,t);return this._register(r),this._generators.set(e.resourceKey,r),r}_reduceChangesToScreenshotUpdates(){for(let i of this._changes)for(let r of this._reducers){if(!!r.predicates.every(e=>e(i))){for(let n of r.transform(i)){var e,t;let{resourceKey:i}=n.recordable,r=null!==(t=null===(e=this._updates.get(i))||void 0===e?void 0:e.timeRanges)&&void 0!==t?t:[];n.timeRanges.push(...r),this._updates.set(n.recordable.resourceKey,n)}break}}return this._changes.length=0,Promise.resolve()}_reduceUpdatesToScreenshotTasks(){return Promise.resolve({renderSegmentList:this._dataSdk.draftView.getAllSegments().filter(m.duj).map(this._formatRenderCombinationSegmentParams)})}capable(e){var t;return(null===(t=f.gi.from(e))||void 0===t?void 0:t.trigger)===c.a.Combination}constructor(e,t,i){super(t,e,i),this._reducers=[N,R,L,j,O,B,z,U],this._formatRenderCombinationSegmentParams=e=>{let{id:t}=e,i=this._updates.get(t),r=(0,_.BC)(e.sourceTimerange.duration),n=(0,g.Z)(_.Jj,_.iE,_.jo);return{segmentId:t,sourceDuration:r,changeList:i?n(i.timeRanges):[]}}}}var Z=i("443763"),F=i("996162"),G=i("732564"),W=i("593853"),Y=i("242785"),H=i("108692"),Q=i("110645"),K=i("820359"),J=i("200462");class X{get _waitGraphicToolkitService(){return(0,S.h)(()=>this._graphicToolkitService.current)}get _waitTimelineManager(){return(0,S.h)(()=>this._timelineManager.current)}async _splitSprites(e){let{common:t,details:i}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0n,n=await this._waitGraphicToolkitService,{singleFrameHeight:a,singleFrameWidth:s}=t,o=[];for(let e of i){let{url:t,imageWidth:i,imageHeight:l}=e,d=Number((i/s).toFixed()),u=Number((l/a).toFixed()),c=await n.sprite.splitByUrl(t,{xCount:d,yCount:u,totalCount:e.total-1},Y.O.Canvas);o.push(...c.map((e,t)=>new K.sh({height:a,width:s,x:e.x,y:e.y,image:e.graphic,timestamp:r+(0,Q.Nb)(BigInt(t),v.j.Microsecond)})))}return o}_handleResponse(e,t){return e.map(async e=>{if(!t.ok)return e;let{latestSegmentSprites:i,lastSegmentSprites:r}=t.value,{resourceKey:n}=e;if(n in i){var a;let{thumb:t}=i[n];return e.setCompleted(!0),e.setSprites(await this._splitSprites(t,null===(a=e.timeRange)||void 0===a?void 0:a.start)),e}if(n in r){let{thumb:t,changes:i=[]}=r[n];e.setSprites(await this._splitSprites(t)),e.setInCompletedTimeRanges(i.map(e=>{let{start_time:t,end_time:i}=e;return{startTime:t,endTime:i-t}}).map(_.tn.fromTimeRangeChange))}return e})}async restoreCombinationSegmentScreenshots(){let e=this._dataSdk.draftView.getAllTracks().flatMap(e=>e.segments.filter(m.duj));if(e.length<=0)return Promise.resolve([]);let t=e.map(e=>{let t=new _.tn(e.sourceTimerange.start,e.sourceTimerange.duration,v.j.Microsecond);return new J.N({completed:!1,sprites:[],segmentId:e.id,trigger:c.a.Combination,resourceKey:e.id,width:e.material.width,height:e.material.height,sourceDuration:e.sourceTimerange.duration,timeRange:t,inCompletedTimeRanges:[t]})});try{let i=await this._spriteDataService.getCombinationSegmentSprite({draftId:this._dataSdk.draftView.getDraftId(),packageId:this._mainDraftService.saveManager.packageId,workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,segmentIds:e.map(e=>e.id)});return this._handleResponse(t,i)}catch(e){return t.map(e=>Promise.resolve(e))}}async restoreMutablePolySegmentScreenshots(){let e=await this._waitTimelineManager,t=e.segmentManager.getAllMutablePolyInfo(),i=e.segmentManager.getAllMutableLockedInfo(),r=this._dataSdk.cutSame.getMutableVideos().filter(e=>{let{filled:t}=e;return t}).filter(e=>!t.some(t=>{var i;return null===(i=t.children)||void 0===i?void 0:i.some(t=>t.id===e.segmentId)}));if(!(null==t?void 0:t.length)&&!(null==i?void 0:i.length)&&!(null==r?void 0:r.length))return[];let n=this._dataSdk.draftView.getAllSegments().filter(m.duj).reduce((e,t)=>(e[t.materialDraft.draft.metadata.id]=t.id,e),{}),a=[...t,...i].map(e=>{let t=new _.tn(e.start,e.duration,v.j.Microsecond);return new J.N({completed:!1,segmentId:n[e.draftId],sprites:[],resourceKey:e.id,trigger:c.a.MutablePoly,width:e.width,height:e.height,sourceDuration:e.duration,timeRange:t,inCompletedTimeRanges:[t]})}),s=this._dataSdk.draftView.getDraftId(),o=this._dataSdk.draftView.getCanvasConfig(),l=r.map(e=>{let t=new _.tn(e.targetStart,e.targetDuration,v.j.Microsecond);return new J.N({completed:!1,segmentId:n[s],sprites:[],resourceKey:e.id,trigger:c.a.Mutable,width:o.width,height:o.height,sourceDuration:e.targetDuration,timeRange:t,inCompletedTimeRanges:[t]})});try{let e=await this._spriteDataService.getMutableSegmentSprite({draftId:this._dataSdk.draftView.getDraftId(),packageId:this._mainDraftService.saveManager.packageId,workspaceId:this._mainDraftService.draftWorkspaceManager.workspaceId,mutableIds:[...[...t,...i].map(e=>e.id),...r.map(e=>e.id)]});return this._handleResponse([...a,...l],e)}catch(e){return[...a,...l].map(e=>Promise.resolve(e))}}constructor(e,t,i,r,a,s){this._dataSdk=e,this._timelineManager=t,this._spriteDataService=i,this.idleGraphicToolkitService=r,this._mainDraftService=a,this._videoEnvironmentService=s,this._graphicToolkitService={current:null},r.getInstance().then(e=>{this._graphicToolkitService.current=e}),(0,n.rC)(this)}}(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof IRef?Object:IRef)],X.prototype,"_graphicToolkitService",void 0),X=(0,r.gn)([(0,r.fM)(2,W.D),(0,r.fM)(3,Y.r),(0,r.fM)(4,H.n),(0,r.fM)(5,u.rO),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof IRef?Object:IRef,void 0===W.D?Object:W.D,void 0===Y.r?Object:Y.r,void 0===H.n?Object:H.n,void 0===u.rO?Object:u.rO])],X);var $=i("693511"),q=i("890629");class ee extends l.JT{get onScreenshotCompleted(){return this._onScreenshotCompleted.event}get onScreenshotUpdate(){return this._onScreenshotUpdate.event}get onScreenshotFullUpdate(){return this._onScreenshotFullUpdate.event}get status(){return this._status}_onListenerInit(e){e.onScreenshotChange.event(this._setTimelineScreenshots),e.onSegmentUpdate.event(e=>{"renderSegmentList"in e?this._onScreenshotUpdate.fire(e):"renderMutableList"in e&&(e.renderMutableList.some(e=>{let{_isPoly:t}=e;return t})?this.memoMutablePolyUpdates=e.renderMutableList:this.memoMutableUpdates=e.renderMutableList,this._onScreenshotUpdate.fire({renderMutableList:[...this.memoMutableUpdates,...this.memoMutablePolyUpdates]}))}),e.onSegmentFullUpdate.event(e=>{this._onScreenshotFullUpdate.fire(e)}),e.listen(),this._listeners.push(e),this._register(e)}bind(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t)switch(!0){case e instanceof G.zo:this._renderManager.current=e;case e instanceof $.j:this._timelineManager.current=e;default:continue}}listen(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let e of t.filter(F.j))switch(e){case c.a.Combination:{let e=new V(this._renderManager,this._dataSdk,this._listenerMutex);this._onListenerInit(e);continue}case c.a.Video:continue;case c.a.MutablePoly:{let e=new Z.j(this._renderManager,this._timelineManager,this._videoEnvironmentService,this._dataSdk,this._listenerMutex);this._onListenerInit(e);continue}case c.a.Mutable:{let e=new q.M(this._renderManager,this._timelineManager,this._videoEnvironmentService,this._dataSdk,this._listenerMutex);this._onListenerInit(e);continue}default:continue}}capable(e){return this._listeners.some(t=>t.capable(e))}restore(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=e=>e.map(async e=>{let t=await e;return this._onScreenshotFullUpdate.fire(t.resourceKey),this._setTimelineScreenshots(t)}).map(async e=>this._makeupInCompletedScreenshots(await e));return t.flatMap(async e=>{switch(e){case c.a.Combination:return r(await this._repository.restoreCombinationSegmentScreenshots());case c.a.MutablePoly:return r(await this._repository.restoreMutablePolySegmentScreenshots());default:return Promise.resolve([])}})}async onReady(){let e=await (0,S.h)(()=>this._renderManager.current);return this._status.setPhase(c.d.Ready),new Promise(e.onFirstFrameRender.bind(e))}async makeScreenshots(e,t){this._status.setPhase(c.d.Working);let i=f.gi.from(e),r=this._listeners.find(e=>e.capable(i));await (null==r?void 0:r.makeScreenshots(e,t)),this._status.setPhase(c.d.Ready)}constructor(e,t,i){super(),this._dataSdk=e,this._videoEnvironmentService=t,this._containerService=i,this._renderManager={current:null},this._timelineManager={current:null},this._status=new s.K(c.d.Init),this._listenerMutex=new a.L,this._listeners=[],this._onScreenshotCompleted=new o.Q,this._onScreenshotUpdate=new o.Q,this._onScreenshotFullUpdate=new o.Q,this.memoMutablePolyUpdates=[],this.memoMutableUpdates=[],this._setTimelineScreenshots=e=>((null==e?void 0:e.completed)&&this._onScreenshotCompleted.fire(e),e),this._makeupInCompletedScreenshots=e=>{if(!(null==e?void 0:e.needMakeupScreenshots))return;let t=f.gi.from(e);!(0,u.JY)(this._videoEnvironmentService)&&t.markAsSubDraft(e.segmentId),this.makeScreenshots(t,e.inCompletedTimeRanges)},(0,n.rC)(this),this._repository=this._containerService.createInstance(X,this._dataSdk,this._timelineManager)}}ee.Triggers=c.a,(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof IRef?Object:IRef)],ee.prototype,"_renderManager",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof IRef?Object:IRef)],ee.prototype,"_timelineManager",void 0),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Array]),(0,r.w6)("design:returntype",void 0)],ee.prototype,"bind",null),ee=(0,r.gn)([(0,r.fM)(1,u.rO),(0,r.fM)(2,d.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===u.rO?Object:u.rO,void 0===d.t?Object:d.t])],ee)},820359:function(e,t,i){i.d(t,{Sd:function(){return s},sh:function(){return a}});var r=i(992798),n=i(339142);class a{toCanvasSync(){return this}toBlob(){return(0,r.Z)(this.image,null,{mimeType:"image/jpeg"})}async toBlobUrl(){return URL.createObjectURL(await this.toBlob())}constructor(e){this.timestamp=e.timestamp,this.width=e.width,this.height=e.height,this.x=e.x,this.y=e.y,this.image=e.image}}class s{toCanvasSync(){let e=(0,n.U)(this.imageData);return new a({...this._options,image:e})}toBlob(){return(0,r.Z)(this.toCanvasSync().image,null,{mimeType:"image/jpeg"})}async toBlobUrl(){return URL.createObjectURL(await this.toBlob())}constructor(e){var t,i;this.timestamp=e.timestamp,this.sourceTimestamp=e.timestamp,this.width=e.width,this.height=e.height,this.x=null!==(t=e.x)&&void 0!==t?t:0,this.y=null!==(i=e.y)&&void 0!==i?i:0,this.imageData=e.imageData,this._options=e}}},996162:function(e,t,i){i.d(t,{j:function(){return r}});function r(e,t,i){return i.indexOf(e)===t}},289732:function(e,t,i){i.d(t,{S:function(){return s},s:function(){return a}});var r,n,a=((r={}).EFFECT="effect",r.MODEL="model",r.MATERIAL="material",r);var s=((n={})[n.ForceGenerateNew=0]="ForceGenerateNew",n[n.Default=1]="Default",n[n.ForceKeepOrigin=2]="ForceKeepOrigin",n)},4731:function(e,t,i){i.d(t,{bf:function(){return o},fc:function(){return s},mE:function(){return a}});var r=i(800788),n=i(127830);let a=(e,t)=>{switch(e){case n._g.Video:return t.getVideoOrderedResourceToken();case n._g.Photo:return t.getContentOrderedResourceToken();default:(0,r.ss)(`[ensure] invalid material type ${e}`)}},s=(e,t)=>{let i;switch(e){case n._g.Video:i=t.getVideoResourceToken();break;case n._g.Audio:i=t.getAudioResourceToken();break;case n._g.Photo:i=t.getContentResourceToken();break;case n._g.UserVideo:i=t.getUserVideoResourceToken();break;case n._g.UserPhoto:i=t.getUserPhotoResourceToken();break;case n._g.UserAudio:i=t.getUserAudioResourceToken();break;case n._g.UserFile:case n._g.Font:i=t.getContentResourceToken();break;case n._g.ArithmeticModel:i=t.getContentResourceToken();case n._g.Mask:case n._g.CurveSpeed:case n._g.CurvePreset:case n._g.TextMotion:case n._g.VideoMotion:case n._g.StickerMotion:case n._g.Transition:case n._g.Sticker:case n._g.Effects:case n._g.FaceProp:case n._g.Tone:case n._g.Filter:case n._g.ImageFilter:case n._g.ImageFigureFaceEffect:case n._g.ImageFigureMakeupEffect:case n._g.ImageFigureBodyEffect:case n._g.ImageFigureReshapeEffect:case n._g.TextPreset:case n._g.TextGlow:case n._g.VoiceChange:case n._g.Mix:case n._g.TextTemplate:case n._g.SubtitleTemplate:case n._g.Bubble:case n._g.AutoBeautyBody:case n._g.AutoBeautyFace:case n._g.AutoBeautyMakeup:case n._g.AutoBeautyShape:case n._g.Integration:case n._g.CurveHSL:case n._g.ShapeAnimation:case n._g.Graffiti:case n._g.PathAnimation:case n._g.Emoji:case n._g.SmartColorAdjust:case n._g.AiAvatarMask:case n._g.ObjectLock:case n._g.MattingStroke:i=t.getContentResourceToken();break;case n._g.VideoBackground:i=t.getVideoBackgroundResourceToken();break;case n._g.Gif:i=t.getGifResourceToken();break;case n._g.AdjustmentPreset:case n._g.DigitalHuman:i=t.getContentResourceToken();break;case n._g.Shape:case n._g.ImageFrame:case n._g.ImageEffect:case n._g.AiBackground:case n._g.UserMaterial:case n._g.EffectModel:case n._g.ShootProject:case n._g.LiveshortenPanEntertainment:case n._g.ShootProp:case n._g.Shoot:case n._g.Play:case n._g.SystemFonts:case n._g.ManualFigure:case n._g.SkeletonBody:case n._g.AISkeletonBody:case n._g.Beauty:case n._g.CoverFlower:case n._g.ShootFilter:case n._g.CoverBubble:case n._g.Insert:case n._g.Iosemojinew:case n._g.Emojiandroid:case n._g.Emojiios:case n._g.VideoTemplate:case n._g.BrandFont:case n._g.UserCloneVoice:case n._g.BrandColor:case n._g.DreaminaUserAiVideo:case n._g.DreaminaShowCaseVideo:case n._g.DreaminaAiVideo:case n._g.VideoDreamina:case n._g.PhotoDreamina:case n._g.TemplatePhotoDreamina:case n._g.DreaminaLipSyncAudio:case n._g.DreaminaFont:case n._g.TextArt:case n._g.TextArtIcon:case n._g.ImageSource:case n._g.VodVideoSource:(0,r.ss)(`[ensure] invalid material type ${e}`);default:(0,r.bP)(e,"[ensure] invalid material type")}return i},o=(e,t)=>{let i;switch(e){case n._g.UserVideo:case n._g.UserPhoto:case n._g.UserAudio:i=t.getOriginResourceToken();break;default:(0,r.ss)(`[ensure] invalid material type ${e}`)}return i}},258592:function(e,t,i){i.d(t,{f:function(){return a}});var r=i(348752),n=i(218571);function a(e,t,i){let a=(0,n.useRef)(0),s=(0,n.useRef)([0,0]),o=(0,n.useCallback)(e=>{if((0,r.G3)(e))return a.current+=e.deltaY,Math.abs(a.current)>=i&&(t(a.current,"roller"),a.current=0),e.preventDefault(),e.stopPropagation(),!1;if((0,r.To)(e)){s.current[0]+=e.deltaX,s.current[1]+=e.deltaY;let r=1;s.current[0]*s.current[1]>0?r=1:s.current[0]*s.current[1]<0?r=-1:0===s.current[0]?r=s.current[1]<0?-1:1:0===s.current[1]&&(r=s.current[0]<0?-1:1);let n=r*Math.sqrt(Math.pow(s.current[0],2)+Math.pow(s.current[1],2))*5;return Math.abs(n)>=i&&(t(n,"touchpad"),s.current=[0,0]),e.preventDefault(),e.stopPropagation(),!1}},[t,i]);(0,n.useEffect)(()=>{var t;return null===(t=e.current)||void 0===t||t.addEventListener("wheel",o),()=>{var t;null===(t=e.current)||void 0===t||t.removeEventListener("wheel",o)}},[e.current,o])}},595493:function(e,t,i){i.d(t,{i:function(){return n}});let r=()=>{let e=!0;return new URL(location.href).searchParams.get("disable_layer_render")&&(e=!1),e},n=e=>{let t=r();return(!e||e.hasSubDraft)&&(t=!1),t}},838771:function(e,t,i){i.d(t,{D:function(){return M}});var r=i(249656),n=i(127830),a=i(160391),s=i(234075),o=i.n(s),l=i(426336),d=i(722169),u=i(144144),c=i(753809),h=i(490513),g=i(236926),m=i(565508),p=i(977201);let f=["text","sticker"],_=["text","sticker"],v="LAYER_RENDER";class M{handleSegmentPatchSuccess(e){let t=this.orderedSegmentIdQueue.indexOf(e);t>=0&&this.orderedSegmentIdQueue.splice(t,1),this.patchingSegmentIdSet.delete(e),delete this.segmentDependenciesMap[e]}handleSegmentPatchFailure(e){var t;let i=this.orderedSegmentIdQueue.indexOf(e);i>=0&&(this.orderedSegmentIdQueue.splice(i,1),this.orderedSegmentIdQueue.push(e)),this.patchingSegmentIdSet.delete(e),this.segmentPatchFailureCount[e]=(null!==(t=this.segmentPatchFailureCount[e])&&void 0!==t?t:0)+1}buildSegmentDependenciesMap(e,t){let{effects:i}=t,r={};for(let t of i){var n;if(t.resource.resourceId!==c.Rw.resourceId)for(let i of null!==(n=t.materialIds)&&void 0!==n?n:[]){let n=e[i];if(!!n)!r[n]&&(r[n]=new Set),r[n].add(t)}}return r}isSegmentAllBroken(e){var t;let{trackType:i="unknown"}=null!==(t=this.savedSegmentsMeta[e])&&void 0!==t?t:{};return(this.isTemplate?_:f).includes(i)}shouldWaitEffectRefresh(e){return(0,h.u)(e.panel)!==r.C3.MetaTypeAudioEffect}shouldWaitSegmentRefresh(e,t){let i=this.savedSegmentsMeta[e];if(!i)return!0;let{start:r,duration:n}=i;return t>=r&&t<r+n}async patchBrokenResource(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(this.patchedResourcePaths.length<=0&&this.patchedSegmentIds.length<=0)return;let i=this.patchedResourcePaths;this.patchedResourcePaths=[];let r=this.patchedSegmentIds;this.patchedSegmentIds=[],console.log("[progressive] patching resources",i,r),await new Promise(e=>setTimeout(e,0));let n=this.patchingPromise,a=()=>{};this.patchingPromise=new Promise(e=>{a=e}),await n;let s=(null!==(e=this._renderManager.state)&&void 0!==e?e:l.jey.STOPPED)!==l.jey.PLAYING;await this._renderManager.brokenRemovePaths(i,s,t),await this._renderManager.brokenRemoveSegmentIds(r,s,t),a()}generateBrokenSegmentIds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new Set;for(let r of e)(this.isTemplate?_:f).includes(r.trackType)&&t[r.id]&&i.add(r.id);return Array.from(i)}getEffectPath(e){var t,i;let r=null===(i=e.resource)||void 0===i?void 0:null===(t=i.resourceId)||void 0===t?void 0:t.toString();return this.effectPathMap[r]}generateBrokenPaths(e){let{effects:t}=e,i=new Set;for(let e of t)i.add(this.getEffectPath(e));return Array.from(i)}scheduleDownload(){for(let t of this.orderedSegmentIdQueue){var e;if(this.patchingSegmentIdSet.size>=2)break;if((null!==(e=this.segmentPatchFailureCount[t])&&void 0!==e?e:0)>3)continue;let i=this.segmentDependenciesMap[t];if(this.patchingSegmentIdSet.has(t)||!i)continue;this.patchingSegmentIdSet.add(t);let r=[],a=[];for(let e of i){let i=this.getEffectPath(e);e.resource.type===n._g.Font&&(i=o().dirname(i));let s=this.ensureManager.ensureEffect(e,i,{needUnzip:!0,dependentResourcePathMap:this.effectPathMap}).waitForResourceValueReady().then(async i=>{if(this.patchedResourcePaths.push(this._renderManager.resourceRecords.getRecordBySegmentPath(this.getEffectPath(e)).resPath),!this.isSegmentAllBroken(t)){let i=this.shouldWaitEffectRefresh(e.resource)&&this.shouldWaitSegmentRefresh(t,this._renderManager.progress);await this.patchBrokenResource(i)}return!0}).catch(()=>!1);a.push(e.resource.type),r.push(s)}Promise.all(r).then(async e=>{let i=0,r=[];for(let t=0;t<e.length;t++)!e[t]&&(i++,r.push(a[t]));if(0===i)this.handleSegmentPatchSuccess(t),this._progressiveLoadingStatusStore.updateSegmentLoadingStatus([t],!1),this.scheduleDownload(),this.isSegmentAllBroken(t)&&(this.patchedSegmentIds.push(t),await this.patchBrokenResource());else{var n,s,o,l;console.error("[startup] failed to patch segment",t),(0,g.T)(this._containerService,{stage:"patching",brokenSegmentIdCount:null!==(o=null===(n=this.brokenSegmentIds)||void 0===n?void 0:n.length)&&void 0!==o?o:-1,brokenSegmentPathCount:null!==(l=null===(s=this.brokenSegmentPaths)||void 0===s?void 0:s.length)&&void 0!==l?l:-1,failedEffectTypeList:r.join(","),failedResourceCount:i}),this.handleSegmentPatchFailure(t),this.scheduleDownload()}})}0===this.patchingSegmentIdSet.size&&((0,u.oe)(v,{remainCount:this.orderedSegmentIdQueue.length}),this._progressiveLoadingStatusStore.updateIsLoading(!1),this.reportLayerRender())}sortSegments(e){return(0,d.sortBy)(e,[e=>e.start,e=>e.renderIndex]).map(e=>e.id)}async beginProgressivelyLoadResources(e,t,i){if(!this.hasBegun)try{this.hasBegun=!0;let{materialId2SegmentId:r,segmentsMeta:n}=e;(0,u.Ie)(v),this.effectPathMap=null!=i?i:{},this.segmentDependenciesMap=this.buildSegmentDependenciesMap(r,t);let s=t.effects.map(async e=>{let t=await this.ensureManager.getFullResource(e.key,e.resource),i=(0,m._r)(t.value);return this._renderManager.recordResource({segmentPath:this.getEffectPath(e),resPath:i}),i}),o=await Promise.all(s);this._renderManager.brokenAddPaths(o),this.brokenSegmentPaths=o;let l=this.generateBrokenSegmentIds(Object.values(n),this.segmentDependenciesMap);this._renderManager.brokenAddSegmentIds(l),this.brokenSegmentIds=l,this.savedSegmentsMeta=n,this.orderedSegmentIdQueue=this.sortSegments(Object.keys(this.segmentDependenciesMap).map(e=>n[e]).filter(Boolean)),this.patchingSegmentIdSet=new Set,this.segmentPatchFailureCount={},this._progressiveLoadingStatusStore.updateSegmentLoadingStatus(Object.keys(this.segmentDependenciesMap),!0),this._progressiveLoadingStatusStore.updateIsLoading(!0),this._containerService.invokeFunction(e=>e.get(a.g)).onRestored(()=>{this.scheduleDownload()})}catch(e){var r,n,s,o;console.error("[startup] failed to begin resource loading",e),(0,g.T)(this._containerService,{stage:"starting",error:(0,d.isError)(e)?e:void 0,brokenSegmentIdCount:null!==(s=null===(r=this.brokenSegmentIds)||void 0===r?void 0:r.length)&&void 0!==s?s:-1,brokenSegmentPathCount:null!==(o=null===(n=this.brokenSegmentPaths)||void 0===n?void 0:n.length)&&void 0!==o?o:-1})}}reportLayerRender(){var e,t;if(this.hasReported)return;let i=null===(e=performance.getEntriesByName(`${v}_START`))||void 0===e?void 0:e[0],r=null===(t=performance.getEntriesByName(`${v}_END`))||void 0===t?void 0:t[0];if(!i&&!r)return;this.hasReported=!0;let n={start:i.startTime,end:r.startTime,duration:r.startTime-i.startTime,...i.detail,...r.detail};(0,g.O)(this._containerService,(0,p.W)(v,n))}constructor(e,t,i,r,n){this.isTemplate=e,this.ensureManager=t,this._renderManager=i,this._progressiveLoadingStatusStore=r,this._containerService=n,this.savedSegmentsMeta={},this.segmentDependenciesMap={},this.orderedSegmentIdQueue=[],this.patchedResourcePaths=[],this.patchedSegmentIds=[],this.patchingPromise=Promise.resolve(),this.patchingSegmentIdSet=new Set,this.segmentPatchFailureCount={},this.hasBegun=!1,this.hasReported=!1,this.effectPathMap={},this.brokenSegmentIds=null,this.brokenSegmentPaths=null}}},836560:function(e,t,i){i.d(t,{l:()=>_});var r=i("789786"),n=i("772322"),a=i("937802"),s=i("55449"),o=i("402655"),l=i("260963"),d=i("670933");i("218571");var u=i("570126");let c="editor-mask-container-zJXfvA";var h=i("217471"),g=i("497134"),m=i("166070"),p=i("425427"),f=i("705325");class _ extends o.JT{constructor(e,t,i){super(),this._videoEnvrionmentService=t,this._instantiationService=i,this.showLoginMask=()=>{this._maskStore.actionIsLoginMaskVisibleSet(!0)},this.closeLoginMask=()=>{this._maskStore.actionIsLoginMaskVisibleSet(!1)},this.destory=()=>{var e;null===(e=this._maskContainer)||void 0===e||e.remove(),this._maskReactRoot.unmount(),this._disposeReaction()};let r=document.createElement("div");r.classList.add(c),document.body.append(r),this._maskContainer=r,this._maskStore=new g.g,this._disposeReaction=(0,l.U5)(()=>this._maskStore.isModalVisible,e=>{this._maskContainer.style.display=e?"flex":"none"},{fireImmediately:!0}),this._maskReactRoot=(0,u.createRoot)(this._maskContainer),this._maskReactRoot.render((0,n.jsx)(d.zt,{store:this._maskStore,children:(0,n.jsxs)(a.$,{instantiationService:this._instantiationService,children:[(0,n.jsx)(h.Z,{}),(0,n.jsx)(m.Z,{store:e.store,isFromThirdPartyPlatform:this._videoEnvrionmentService.isFromThirdPartPlatform,setMaskVisibility:e=>{this._maskStore.actionIsThirdPartyMaskVisibleSet(e)}})]})}))}}_=(0,r.gn)([(0,r.fM)(1,p.rO),(0,r.fM)(2,s.T),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===f.X?Object:f.X,void 0===p.rO?Object:p.rO,void 0===s.T?Object:s.T])],_)},234457:function(e,t,i){i.d(t,{aK:function(){return d},cO:function(){return o},hB:function(){return l},tg:function(){return u}});var r=i(426336),n=i(801497),a=i(435359),s=i(687730);let o=[{get name(){return n.oc.t("web_photo_cut_text_free_ratio",{},"Custom")},value:r.rxY.CanvasRatioCustom,width:-1,height:-1,event:"free"},...s.j9],l={[r.j8m.CropRatioFree]:a.zl.FREE,[r.j8m.CropRatio1To1]:a.zl.RATIO_1_1,[r.j8m.CropRatio2To1]:a.zl.RATIO_2_1,[r.j8m.CropRatio9To16]:a.zl.RATIO_9_16,[r.j8m.CropRatio16To9]:a.zl.RATIO_16_9,[r.j8m.CropRatio3To4]:a.zl.RATIO_3_4,[r.j8m.CropRatio4To3]:a.zl.RATIO_4_3},d={[a.zl.FREE]:r.rxY.CanvasRatioCustom,[a.zl.ORIGINAL]:r.rxY.CanvasRatioOriginal,[a.zl.RATIO_1_1]:r.rxY.CanvasRatio1To1,[a.zl.RATIO_2_1]:r.rxY.CanvasRatio2To1,[a.zl.RATIO_3_4]:r.rxY.CanvasRatio3To4,[a.zl.RATIO_4_3]:r.rxY.CanvasRatio4To3,[a.zl.RATIO_16_9]:r.rxY.CanvasRatio16To9,[a.zl.RATIO_9_16]:r.rxY.CanvasRatio9To16},u={[r.rxY.CanvasRatioCustom]:a.zl.FREE,[r.rxY.CanvasRatioOriginal]:a.zl.ORIGINAL,[r.rxY.CanvasRatio1To1]:a.zl.RATIO_1_1,[r.rxY.CanvasRatio2To1]:a.zl.RATIO_2_1,[r.rxY.CanvasRatio3To4]:a.zl.RATIO_3_4,[r.rxY.CanvasRatio4To3]:a.zl.RATIO_4_3,[r.rxY.CanvasRatio16To9]:a.zl.RATIO_16_9,[r.rxY.CanvasRatio9To16]:a.zl.RATIO_9_16}},721734:function(e,t,i){i.d(t,{v:function(){return a}});var r=i(789786),n=i(260963);class a{get isModalVisible(){return this.isMutableCropModalVisible||this.isMutableTrimModalVisible||this.isMultiTrackTrimModalVisible||this.isMultiTrackCropModalVisible||this.isMultiTrackTranscribeModalVisible||this.isMultiTrackFreezingModalVisible||this.isTransferPermissionModalVisible||this.isPasswordFlowVisible||this.isDraftViolationVisible||this.isGlobalSlotModalVisible}setOpenSource(e){this.openSource=e}actionIsTemplateSet(e){this.isTemplate=e}actionIsUseVideoCropperSet(e){this.isUseVideoCropper=e}setTrimInfo(e){this.trimInfo=e}setCropInfo(e){this.cropInfo=e}setTransferPermissionInfo(e){this.transferPermissionInfo=e}setPasswordFlowOptions(e){this.passwordFlowOptions=e}setMultiTrackCropModalVisible(e){this.isMultiTrackCropModalVisible=e,!e&&this.setOpenSource()}setGlobalSlotModalVisible(e){this.isGlobalSlotModalVisible=e}actionIsMutableTrimModalVisibleSet(e){this.isMutableTrimModalVisible=e}actionIsMutableCropModalVisibleSet(e){this.isMutableCropModalVisible=e}actionIsMultiTrackTrimModalVisibleSet(e){this.isMultiTrackTrimModalVisible=e}actionIsMultiTrackTranscribeModalVisibleSet(e){this.isMultiTrackTranscribeModalVisible=e}actionIsMultiTrackFreezingModalVisibleSet(e){this.isMultiTrackFreezingModalVisible=e}actionIsSmartToolUndertakeModalVisibleSet(e){this.isSmartToolUndertakeModalVisible=e}actionIsTransferPermissionModalVisibleSet(e){this.isTransferPermissionModalVisible=e}actionIsPasswordFlowVisibleSet(e){this.isPasswordFlowVisible=e}actionIsDraftViolationSet(e){this.isDraftViolationVisible=e}setCover(e,t){this.covers={...this.covers,[e]:t}}setSprites(e,t){this.sprites={...this.sprites,[e]:t}}actionSegmentId2initialSpeedSet(e){this.segmentId2initialSpeed=e}actionMutableId2CropMinus180Set(e,t){this.mutableId2CropMinus180={...this.mutableId2CropMinus180,[e]:t}}actionSegmentMutableSet(e){this.segmentMutable=e}setAutoReplace(e){this.autoReplace=e}constructor(){this.isTemplate=!1,this.isUseVideoCropper=!1,this.isMutableTrimModalVisible=!1,this.isMutableCropModalVisible=!1,this.isMultiTrackTrimModalVisible=!1,this.isMultiTrackCropModalVisible=!1,this.isGlobalSlotModalVisible=!1,this.isMultiTrackTranscribeModalVisible=!1,this.isMultiTrackFreezingModalVisible=!1,this.isSmartToolUndertakeModalVisible=!1,this.isTransferPermissionModalVisible=!1,this.isPasswordFlowVisible=!1,this.isDraftViolationVisible=!1,this.trimInfo=null,this.cropInfo=null,this.transferPermissionInfo=null,this.passwordFlowOptions=null,this.covers={},this.sprites={},this.segmentId2initialSpeed={},this.mutableId2CropMinus180={},this.segmentMutable=null,this.autoReplace=!1,(0,n.ky)(this)}}(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IOpenModalSource?Object:IOpenModalSource]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setOpenSource",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsTemplateSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsUseVideoCropperSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setTrimInfo",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setCropInfo",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setTransferPermissionInfo",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setPasswordFlowOptions",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setMultiTrackCropModalVisible",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setGlobalSlotModalVisible",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsMutableTrimModalVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsMutableCropModalVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsMultiTrackTrimModalVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsMultiTrackTranscribeModalVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsMultiTrackFreezingModalVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsSmartToolUndertakeModalVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsTransferPermissionModalVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsPasswordFlowVisibleSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionIsDraftViolationSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,"undefined"==typeof BucketThumbnail?Object:BucketThumbnail]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setCover",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,Array]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setSprites",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof Record?Object:Record]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionSegmentId2initialSpeedSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionMutableId2CropMinus180Set",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object]),(0,r.w6)("design:returntype",void 0)],a.prototype,"actionSegmentMutableSet",null),(0,r.gn)([n.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Boolean]),(0,r.w6)("design:returntype",void 0)],a.prototype,"setAutoReplace",null)},609962:function(e,t,i){i.d(t,{a:function(){return n}});var r,n=((r={})[r.IDLE=0]="IDLE",r[r.PREPARING=1]="PREPARING",r[r.UPLOADING=2]="UPLOADING",r[r.REPLACING=3]="REPLACING",r[r.SUCCESS=4]="SUCCESS",r[r.CANCELED=5]="CANCELED",r[r.FAILED=6]="FAILED",r)},776884:function(e,t,i){i.d(t,{Y:function(){return l}});var r=i(789786),n=i(966697),a=i(782153),s=i(461571),o=i(402655);class l extends o.JT{_init(){this._initDraftPermissionHandler()}_isCurrentUserPermissionChanged(e,t){return e===this._dataSdk.draftView.getDraftId()&&t===this._accountService.userProfile.uid}_initDraftPermissionHandler(){this._permissionService.onWsEditPermissionAcquire(e=>{if(!e.ok)return;let{file_id:t,uid:i,operator:r}=e.value;this._isCurrentUserPermissionChanged(t,i)&&this.showTransferPermissionModal(s.O.editable,r)}),this._permissionService.onWsEditPermissionRemove(e=>{if(!e.ok)return;let{file_id:t,uid:i,operator:r}=e.value;this._isCurrentUserPermissionChanged(t,i)&&this.showTransferPermissionModal(s.O.readonly,r)})}showTransferPermissionModal(e,t){this._modalManager.showTransferPermissionModal({draftPermission:e,operator:t})}constructor(e,t,i,r){super(),this._dataSdk=e,this._modalManager=t,this._permissionService=i,this._accountService=r,this._init()}}l=(0,r.gn)([(0,r.fM)(2,a.u),(0,r.fM)(3,n.Gw),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof ModalManager?Object:ModalManager,void 0===a.u?Object:a.u,void 0===n.Gw?Object:n.Gw])],l)},779085:function(e,t,i){i.d(t,{X:()=>m});var r=i("29188"),n=i("857670"),a=i("587892"),s=i("402655"),o=i("32332"),l=i("800788"),d=i("257367"),u=i("426336");class c{get isPlaying(){return 1===this._status}get isRangePlaying(){return 2===this._status}get progress(){return this._progress}get speed(){return this._speed}get isFullscreen(){return this._isFullscreen}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._status=1,this._speed=e}rangePlay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._status=2,this._speed=e}pause(){this._status=0}seek(e,t){t===u.Hqf.seekDone&&(this._status=0)}setSpeed(e){this._speed=e}setProgress(e){this._progress=e}setIsFullscreen(e){this._isFullscreen=e}constructor(){this._status=0,this._speed=1,this._progress=0n,this._isFullscreen=!1}}var h=i("354708"),g=i("767961");class m extends s.JT{get status(){return this._playerStatus}get hasLoaded(){return this._playerAdapter.hasLoaded}seek(e,t,i){this._playerStatus.seek(e,t),this._playerAdapter.seek(e,t,i)}seekToStartIfNotInRange(e,t,i){let{progress:r}=this._playerStatus,[n,a]=e;return(!(r>=n)||!(r<a))&&(this.seek(n,t,i),!0)}seekPrevFrame(){let e;(e=this._playerStatus.progress<r.CZ?0n:(0,n.i1)(this._playerStatus.progress-r.CZ))>=0&&this._playerAdapter.seek(e)}seekNextFrame(){let e=(0,n.i1)(this._playerStatus.progress+r.CZ),t=this._getDuration();e>t&&(e=t),this._playerAdapter.seek(e)}seekAndPause(e){this._playerAdapter.seekAndPause(e)}seekWithSpeed(e,t,i){this._playerAdapter.seekWithSpeed(e,t,i)}flushSeekCmd(){this._playerAdapter.flushSeekCmd()}play(){this._playerAdapter.play()}pause(){this._playerAdapter.pause()}rangePlay(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=i?t:(0,n.i1)(t);if(!(e>=r))this._playerAdapter.rangePlay(e,r)}setFullscreenContainer(e){this._playerAdapter.setFullscreenContainer(e)}requestFullscreen(e){this._playerAdapter.requestFullscreen(e)}exitFullscreen(e){this._playerAdapter.exitFullscreen(e)}reset(){(0,l.ZB)(this._renderManager);let e=this._renderManager.reset();return this._playerAdapter.reset(e),e}setDefaultPlayer(e,t){this._defaultPlayerSource=e,this._renderManager=t,this._defaultPlayerAdapter=this._register((0,h.t)(e,t))}activeDefaultPlayer(){if((0,l.ZB)(this._defaultPlayerAdapter),this._playerAdapter!==this._defaultPlayerAdapter)this._defaultPlayerAdapter.active(this._playerStatus.progress),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onPlay(()=>{this._playerStatus.play(),this._onPlay.fire()})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onRangePlay(()=>{this._playerStatus.rangePlay(),this._onPlay.fire(),this._onRangePlay.fire()})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onPause(()=>{this._playerStatus.pause(),this._onPause.fire()})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onProgress((e,t)=>{this._playerStatus.setProgress(e),this._onProgress.fire(e,t)})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onSeeked(()=>{this._onSeeked.fire()})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onStreamStart(e=>{this._onStreamStart.fire(e)})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onStreamStop(e=>{this._onStreamStop.fire(e)})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onStreamFail(e=>{let{assetId:t,httpStatus:i,isBlock:r,isGetMediaInfo:n}=e;this._onStreamFail.fire({assetId:t,httpStatus:i,isBlock:r,isGetMediaInfo:n})})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onEnd(()=>{this._playerStatus.pause(),this._onEnd.fire()})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onError(e=>{this._onError.fire(e)})),this._defaultPlayerEvents.add(this._defaultPlayerAdapter.onFullscreenChange((e,t)=>{this._playerStatus.setIsFullscreen(e),this._onFullscreenChange.fire(e,t)})),this._previewPlayerAdapter&&(this._previewPlayerAdapter.unactive(),this._previewPlayerEvents.clear()),this._playerAdapter=this._defaultPlayerAdapter}setPreviewPlayer(e,t){this._previewPlayerSource=e,this._renderManager=t,this._previewPlayerAdapter=(0,g.G)(e)}activePreviewPlayer(){if((0,l.ZB)(this._previewPlayerAdapter),this._playerAdapter!==this._previewPlayerAdapter)this._previewPlayerAdapter.active(),this._previewPlayerEvents.add(this._previewPlayerAdapter.onPlay(()=>{this._playerStatus.play(),this._onPlay.fire()})),this._previewPlayerEvents.add(this._previewPlayerAdapter.onRangePlay(()=>{this._playerStatus.rangePlay(),this._onPlay.fire(),this._onRangePlay.fire()})),this._previewPlayerEvents.add(this._previewPlayerAdapter.onPause(()=>{this._playerStatus.pause(),this._onPause.fire()})),this._previewPlayerEvents.add(this._previewPlayerAdapter.onProgress((e,t)=>{this._playerStatus.setProgress(e),this._onProgress.fire(e,t)})),this._previewPlayerEvents.add(this._previewPlayerAdapter.onSeeked(()=>{this._onSeeked.fire()})),this._previewPlayerEvents.add(this._previewPlayerAdapter.onEnd(()=>{this._playerStatus.pause(),this._onEnd.fire()})),this._previewPlayerEvents.add(this._previewPlayerAdapter.onError(e=>{this._onError.fire(e)})),this._previewPlayerEvents.add(this._previewPlayerAdapter.onFullscreenChange((e,t)=>{this._playerStatus.setIsFullscreen(e),this._onFullscreenChange.fire(e,t)})),this._defaultPlayerAdapter&&(this._defaultPlayerAdapter.unactive(),this._defaultPlayerEvents.clear()),this._playerAdapter=this._previewPlayerAdapter}retryStreamAsset(e){return this._playerAdapter.retryStreamAsset(e)}constructor(e){super(),this._getDuration=e,this._onPlay=this._register(new a.Q),this._onRangePlay=this._register(new a.Q),this._onPause=this._register(new a.Q),this._onProgress=this._register(new a.Q),this._onSeeked=this._register(new a.Q),this._onStreamStart=new a.Q,this._onStreamStop=new a.Q,this._onStreamFail=new a.Q,this._onEnd=this._register(new a.Q),this._onError=this._register(new a.Q),this._onFullscreenChange=this._register(new a.Q),this._defaultPlayerEvents=this._register(new o.S),this._previewPlayerEvents=this._register(new o.S),this._dummyPlayerAdapter=new d.h,this._playerAdapter=this._dummyPlayerAdapter,this._playerStatus=new c,this.onPlay=this._onPlay.event,this.onRangePlay=this._onRangePlay.event,this.onPause=this._onPause.event,this.onProgress=this._onProgress.event,this.onSeeked=this._onSeeked.event,this.onStreamStart=this._onStreamStart.event,this.onStreamStop=this._onStreamStop.event,this.onStreamFail=this._onStreamFail.event,this.onEnd=this._onEnd.event,this.onError=this._onError.event,this.onFullscreenChange=this._onFullscreenChange.event}}},689050:function(e,t,i){i.d(t,{kL:function(){return d}});var r=i(764749),n=i(753809),a=i(426336),s=i(320271),o=i(517614);let l=(e,t)=>!!(e===s.U_.SystemFonts||[...Array.from(a.NG_),n.Bd,"-1"].includes(t)||[s.U_.Bubble2,s.U_.Flower2].includes(e))||!1,d=(e,t,i,n)=>{let s=Object.values(null!=e?e:{}),d=[],u=[],c={},h=(e,t)=>{let r="canvas"===e&&t,n=!e&&t;return r||n?i.includes(t):l(e,t)};for(let e of s){let{schema:i,material_ids:s=[]}=e,{id:l,panel:p}=(0,r.f)(i),f=t[i];if(f){var g,m;let e=function(e,t){if(e.resource.resourceId===a.$UK.resourceId||e.resource.resourceId===a.zLw.resourceId||e.resource.resourceId===a.Rcq.resourceId){let i=e.resource.resourceId===a.Rcq.resourceId?"v2":"",{resourceId:r,package:n}=(0,a.CrL)(t,i);e.resource.resourceId=r,e.resource.package=n}return e}(f,null!==(m=null==n?void 0:null===(g=n.platform)||void 0===g?void 0:g.os)&&void 0!==m?m:"");c[l]=e.resource.resourceId,d.push({...e,materialIds:s})}else{if(e.resource_id===o.El){let e=`${o.JN.type}_${o.JN.resourceId}_${o.JN.effectId}`;d.push({key:e,resource:{...o.JN,key:e,previewUrl:""},materialIds:s});continue}if(h(p,l))continue;u.push(i)}}return{effects:d,unresolvedEffects:u,oldResourceIdToNewResourceIdMap:c}}},478091:function(e,t,i){i.d(t,{c:function(){return u}});var r=i(65251),n=i(426336),a=i(305799),s=i(534302),o=i(338151),l=i(353678);class d{get currentAudioTrackLength(){return this.tracks.filter(e=>"audio"===e.type).length}get firstOtherTrack(){return this.otherTracks[0]}get targetSegment(){var e;return null===(e=this.targetTrack)||void 0===e?void 0:e.segments[0]}get audioTragetSegment(){var e;return null===(e=this.audioTargetTrack)||void 0===e?void 0:e.segments[0]}updateStart(e){let{selectedSegTracks:t}=this,i=BigInt(Number.MAX_SAFE_INTEGER);t.forEach(e=>{e.segments.length&&e.segments[0].targetTimerange.start<i&&(i=e.segments[0].targetTimerange.start)});let r=e-i;t.forEach(e=>{e.segments.forEach(e=>{e.targetTimerange.start+=r})})}getTargetTrack(e){for(let t of e)if(t.index&&t.segments.length&&this.couldMergeById(t.id,t))return{...t,toInsertTrackId:t.id};for(let t of e){let e=this.findUpperTrack(t.id);if(e&&this.couldMergeById(e.id,t))return{...t,toInsertTrackId:e.id}}}findTrackById(e){return this.tracks.find(t=>t.id===e)}findUpperTrack(e){let t=this.tracks.findIndex(t=>t.id===e);if(-1!==t)return this.tracks[t+1]}reset(){this.pasteInfo=[],this.tracks=[],this.selectedSegTracks=[],this.audioTracks=[],this.otherTracks=[],this.targetTrack=void 0,this.audioTargetTrack=void 0}getPasteParams(){let e=this.genOtherTracksPasteParams();return[...e,...this.genAudioTracksPasteParams()]}genOtherTracksPasteParams(){return this.targetTrack&&this.targetSegment?this.genTargetTracksParams(this.otherTracks,this.targetTrack,this.targetSegment.id):this.genAddToLastParams(!1)}genAudioTracksPasteParams(){return this.audioTargetTrack&&this.audioTragetSegment?this.genTargetTracksParams(this.audioTracks,this.audioTargetTrack,this.audioTragetSegment.id,[n.pNd.TrackTypeAudio]):this.genAddToLastParams(!0)}couldMerge(e,t){if(!t.segments.length)return!0;let i=this.tracks[e];return(null==i?void 0:i.type)===t.type&&(0,s.f)(i.segments,t.segments,!1)}couldMergeById(e,t){let i=this.findTrackById(e);return(null==i?void 0:i.type)===t.type&&(0,s.f)(i.segments,t.segments,!1)}trackToMoveParams(e){let{track:t,toInsertIndex:i,targetSegId:r,insertNewTrack:a,mainTrackIndex:s,inTrackTypes:l=[]}=e,d=a&&t.segments.find(e=>e.id===r);return t.segments.map((e,u)=>({segmentId:e.id,trackType:t.type,targetTrackIndex:i,sourceTrackIndex:t.index,targetStartTime:n.pMA.max([e.targetTimerange.start,0],"bigint"),inTrackTypes:l,needInsertTargetTrack:d?r===e.id:0===u&&a,inMousePosition:r===e.id,mainVideoTargetIndex:void 0!==s?s+u:0,type:(0,o.G)(e),duration:e.targetTimerange.duration}))}genUpperParams(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=[],o=t;for(let l=i,d=t;l<e.length;l++,d++){let t=e[l],u=l===i&&a||!this.couldMerge(o,t),c=this.trackToMoveParams({track:t,toInsertIndex:d,targetSegId:r,insertNewTrack:u,inTrackTypes:n});!u&&o++,s.push(...c)}return s}genLowerParams(e,t,i,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=[],o=t-1,l=t;for(let t=i-1;t>=0;t--){let i=e[t],r=!this.couldMerge(o,i);!r&&l--,l<=0&&(l=1,r=!0);let d=this.trackToMoveParams({track:i,toInsertIndex:l,insertNewTrack:r,targetSegId:n,inTrackTypes:a});if(r)for(let e of s)for(let t of e)t.targetTrackIndex++;else o--;s.push(d)}return(0,r.Z)(s.reverse())}genTargetTracksParams(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!e.length)return[];let n=this.getStartInfo(e,t);if(!n)return[];let{toInsertReferenceTrackIndex:a,referenceTrackIndex:s}=n,o=this.genUpperParams(e,a,s,i,r),l=this.genLowerParams(e,a,s,i,r),d=l.filter(e=>e.needInsertTargetTrack);return d.length&&o.forEach(e=>{e.targetTrackIndex=e.targetTrackIndex+d.length}),[...l,...o]}getStartInfo(e,t){let{tracks:i}=this,r=i.findIndex(e=>e.id===t.toInsertTrackId);return{toInsertReferenceTrackIndex:r,referenceTrackIndex:e.findIndex(e=>e.id===t.id)}}genAddToLastParams(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e?this.audioTracks:this.otherTracks;if(!i.length)return[];let a=0;a=(e?Math.max(this.tracks.length,1):Math.max(this.tracks.findLastIndex(e=>e.type!==n.pNd.TrackTypeAudio)+1,1))+t;let s=[];for(let t of i){let i=this.trackToMoveParams({track:t,insertNewTrack:!0,toInsertIndex:a,targetSegId:"",inTrackTypes:e?[n.pNd.TrackTypeAudio]:[]});s.push(i),i.length>0&&a++}return(0,r.Z)(s)}constructor(e,t,i,r){this.tracks=[],this.selectedSegTracks=[],this.audioTracks=[],this.otherTracks=[],this.pasteInfo=[],this.tracks=e.map((e,t)=>({...e,index:t})),this.pasteInfo=i,this.selectedSegTracks=(0,l.K)(t,i.map(e=>e.id)),this.updateStart(r);let n=this.selectedSegTracks.findIndex(e=>"audio"===e.type);-1!==n?(this.audioTracks=(0,a.NO)(this.selectedSegTracks.slice(n),e=>!e.segments.length),this.otherTracks=(0,a.NO)(this.selectedSegTracks.slice(0,n),e=>!e.segments.length)):(this.audioTracks=[],this.otherTracks=this.selectedSegTracks),this.targetTrack=this.getTargetTrack(this.otherTracks),this.audioTargetTrack=this.getTargetTrack(this.audioTracks)}}function u(e,t,i,r){return new d(e,t,i,r).getPasteParams()}},638361:function(e,t,i){i.d(t,{C:()=>a});let r="seletion-box-WRTzWI",n={boxStyle:{display:"none",position:"absolute"}};class a{get startLocation(){return this._startLocation}get selectState(){return this._selectState}setVisibility(e){this.$selectionBox.style.display=e?"block":"none"}mount(e){!e.contains(this.$selectionBox)&&e.appendChild(this.$selectionBox)}start(e){this._startLocation=e,this._selectState="prepare"}move(e){"none"!==this.selectState&&(this._selectState="boxSelecting",this.updateSelectionBox(e))}end(){"none"!==this._selectState&&(this._selectState="none",this.setVisibility(!1))}updateSelectionBox(e){let{startLocation:t,$selectionBox:i}=this,r=Math.min(t.x,e.x),n=Math.min(t.y,e.y),a=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y);i.style.left=`${r}px`,i.style.top=`${n}px`,i.style.width=`${a}px`,i.style.height=`${s}px`,this.setVisibility(!0)}constructor(e=n){for(let[t,i]of(this.$selectionBox=document.createElement("div"),this._startLocation={x:0,y:0},this._selectState="none",this.$selectionBox.classList.add(r),Object.entries(e.boxStyle)))this.$selectionBox.style[t]=i}}},494591:function(e,t,i){i.d(t,{O:function(){return M}});var r=i(789786),n=i(271368),a=i(134392),s=i(325805),o=i(860660),l=i(217974),d=i(800793),u=i(591010),c=i(693511),h=i(126429),g=i(387381),m=i(108692),p=i(425427),f=i(230689),_=i(710763),v=i(800788);class M{_bindShortcuts(){this._eventBindDom&&(this._keybindingService.getOrCreateContext(this._eventBindDom,!0).register(this._selectAllShortcutConfig),this._keybindingService.getOrCreateContext(document.body).register(this._deleteShortcutConfig))}_unbindShortcuts(){this._eventBindDom&&(this._keybindingService.getOrCreateContext(this._eventBindDom,!0).unregister(this._selectAllShortcutConfig),this._keybindingService.getOrCreateContext(document.body).unregister(this._deleteShortcutConfig))}_registerShortCuts(){this._layoutManager.onDidLayoutUpdate(e=>{this._eventBindDom&&this._unbindShortcuts(),this._eventBindDom=e,this._bindShortcuts()}),this._layoutManager.onDidLayoutUnMount(()=>{this._eventBindDom=null,this._unbindShortcuts()})}constructor(e,t,i,r,a,c,h,g){this._timelineManager=e,this._selection=t,this._layoutManager=i,this._segmentSelection=r,this._mainDraftService=a,this._containerService=c,this._keybindingService=h,this._environmentService=g,this._deleteShortcutConfig={keyBindings:{win:[n.VD.BACKSPACE,n.VD.DELETE],mac:[n.VD.BACKSPACE,n.VD.DELETE]},handler:async()=>{var e;let t=this._selection.getBeforeDeleteHook();for(let e=0;e<t.length;e++)if(!await t[e]())return;let{dataSdk:i}=this._mainDraftService,r=this._selection.getSelectedSegmentsIds(),n=this._selection.getSelectedTransitionIds(),a=this._selection.getSelectedSegments(),d=n.map(e=>i.draftView.getSegmentByTransitionId(e));try{(0,s.JP)(this._containerService,{action_type:s.Gt.SHORTKEY,function_name:s.BS.DELETE,...(0,o.u8)({segments:a,transitionSegments:d})})}catch(e){(0,v.Y2)(s.JP,"click_function report error")}await (0,l.Q)({dataSdk:i,segmentIds:r,transitionIds:n,fromWhere:"shortkey",containerService:this._containerService,draftId:null===(e=this._selection.subDraftContext)||void 0===e?void 0:e.subDraftId,draftTemplateManager:this._mainDraftService.draftTemplateManager}),this._segmentSelection.setSelectedData({},u.k.Shortcut)},when:e=>!!(0,d.Vw)(e)&&!this._timelineManager.timelineUI.panel.isCollapsed&&(this._selection.getSelectedSegmentsIds().length>0||this._selection.getSelectedTransitionIds().length>0)},this._selectAllShortcutConfig={keyBindings:{win:[n.N9.CTRL_WIN+n.VD.A],mac:[n.N9.COMMAND+n.VD.A]},handler:e=>{null==e||e.preventDefault(),null==e||e.stopPropagation();let t=this._mainDraftService.dataSdk.draftView.getAllSegments().map(e=>e.id);this._segmentSelection.setSelectedData({segmentIds:t},u.k.Shortcut),(0,_.r)(this._containerService,(0,_.T)({ids:t,action:"all",draftView:this._mainDraftService.dataSdk.draftView}))},when:e=>{let{expandedSegmentId:t,batchReplacingSegmentId:i}=this._segmentSelection;return!t&&!i&&this._environmentService.appSubType!==p.cP.Template&&(0,d.Vw)(e)}},this._eventBindDom=null,this._registerShortCuts()}}M=(0,r.gn)([(0,r.fM)(4,m.n),(0,r.fM)(5,f.t),(0,r.fM)(6,a.d),(0,r.fM)(7,p.rO),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===c.j?Object:c.j,void 0===h.Y?Object:h.Y,void 0===g.n?Object:g.n,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===m.n?Object:m.n,void 0===f.t?Object:f.t,void 0===a.d?Object:a.d,void 0===p.rO?Object:p.rO])],M)},903980:function(e,t,i){i.d(t,{_:function(){return c}});var r=i(789786),n=i(230689),a=i(22929),s=i(840441),o=i(52442),l=i(886407),d=i(450013),u=i(108692);class c{get mutableSlotModules(){return this._mutableSlotModules}get mutableManagerStore(){return this._store}updateRenderManager(e){this._renderManager=e}constructor(e,t,i,r,n,u,c,h,g,m,p){this._modalManager=e,this._timelineManager=t,this._selection=i,this._segmentSelection=r,this._fileUploadManager=n,this._mutableReplaceTaskManager=u,this._playerManager=c,this._subjectCrop=h,this._mutableIntelligentManager=g,this._containerService=m,this._mainDraftService=p,this._store=(0,o.M)(this._timelineManager.uiTracksData.observableData,this._segmentSelection.observeData),this._modal=this._containerService.createInstance(a.z,this._modalManager),this._sider=this._containerService.createInstance(s.o),this._mutableUpload=this._containerService.createInstance(l.q,this._mainDraftService.dataSdk,this._store[o.C$],this._mutableReplaceTaskManager,this._fileUploadManager,this._segmentSelection),this._mutableSelection=this._containerService.createInstance(d.P,this._store[o.m7],this._selection,this._segmentSelection),this._mutableSlotModules={modal:this._modal,resource:this._timelineManager.resource,draftOperation:this._timelineManager.draftOperation,batchReplace:this._timelineManager.batchReplaceManager,autoReplace:this._timelineManager.autoReplace,event:this._timelineManager.event,timelineUI:this._timelineManager.timelineUI,intelligent:this._mutableIntelligentManager,mutableUpload:this._mutableUpload,mutableReplaceTaskManager:this._mutableReplaceTaskManager,sider:this._sider,fileUpload:this._fileUploadManager,subjectCrop:this._subjectCrop},this._timelineManager.autoReplace.onAsk(e=>{this._store[o.m7].setAutoReplaceDisplay(e)}),this._timelineManager.autoReplace.onReply(e=>{this._store[o.m7].setAutoReplaceDisplay(void 0)})}}c=(0,r.gn)([(0,r.fM)(9,n.t),(0,r.fM)(10,u.n),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ModalManager?Object:ModalManager,"undefined"==typeof TimelineManager?Object:TimelineManager,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof IEditorWidgetFileUploadManager?Object:IEditorWidgetFileUploadManager,"undefined"==typeof IMutableReplaceTaskManager?Object:IMutableReplaceTaskManager,"undefined"==typeof IPlayerManager?Object:IPlayerManager,"undefined"==typeof SubjectCropManager?Object:SubjectCropManager,"undefined"==typeof MutableIntelligentManager?Object:MutableIntelligentManager,void 0===n.t?Object:n.t,void 0===u.n?Object:u.n])],c)},584952:function(e,t,i){i.d(t,{h:function(){return s}});var r=i(772322),n=i(537783);i(570175);var a=i(488935);let s=(0,i(670933).Pi)(e=>{let{store:t}=e,{i18n:i}=(0,n.$)(),s=t.finishedResourceCount/t.totalResourceCount;return(0,r.jsx)("div",{className:"third-platform-editor-loading",children:(0,r.jsx)(a.l,{title:i.t("load_web_edit_web_wati",{placeholder1:(100*s).toFixed(2)},"Loading editor. Wait a minute\u2026 {placeholder1}%"),suffixDot:!1})})})},486441:function(e,t,i){i.d(t,{B:function(){return a}});var r=i(260963),n=i(251266);class a{get hasLoadedVideo(){return this.loadStatus===n.Xp.success}setFetchProgress(e){this.fetchPackageProgress=e}setFetchStatus(e){this.loadStatus=e}setIsAllLoaded(e){this.allLoaded=e}setTotalResourceCount(e){this.totalResourceCount=e}setFinishedResourceCount(e){this.finishedResourceCount=e}constructor(){this.fetchPackageProgress=0,this.allLoaded=!1,this.loadStatus=n.Xp.doing,this.totalResourceCount=-1,this.finishedResourceCount=-1,(0,r.ky)(this)}}},969094:function(e,t,i){i.d(t,{i:function(){return m}});var r=i(215179),n=i(251266),a=i(234075),s=i.n(a),o=i(426336),l=i(966614);let d={[n.Tv.audio]:"audio",[n.Tv.image]:"image",[n.Tv.video]:"video"},u=e=>{let t=e.match(/\.([^.]+)$/);return t?t[1]:""},c=(e,t)=>{if(!t)return{visitorAssetList:[]};let i=[...Object.values(t)];return{visitorAssetList:e.map(e=>{let{path:t,resource:r}=e,n=o.hPV.toAbsolutePath(`${t}`),a=i.find(e=>o.hPV.isPathEqual(e.path,t));return{asset:e,fsPath:n,resource:r,pathInDraft:t,preloadMaterial:a}})}},h=e=>{let t,i,n;let a=l.X.Online,{groupType:s,video:o,audio:d,image:u,mime:c,source:h,file_name:g,duration:m,definition:p,size:f,format:_}=e;switch(s){case"video":{if(!o)break;let{video_infos:e,thumb:r}=o;if(null==e?void 0:e.length){let{url:i,key:r}=(null==e?void 0:e.find(e=>"480p"===e.definition||"360p"===e.definition||(e.definition,!0)))||{};n={url:i,key:r},t={url:i,key:r}}if(r.common_info&&r.detail_infos){let{single_frame_height:e,single_frame_width:t}=r.common_info;i=r.detail_infos.map(i=>({url:i.url,key:i.encrypted_key,count:i.frame_count,width:i.width,height:i.height,x:i.width/t,y:i.height/e,ratio:t/e}))}break}case"image":if(u){let{image_1080p_url:e,image_360p_url:i,image_720p_url:r}=u;t={url:i||r||e,key:""}}break;case"audio":if(d){let{audio_infos:e}=d;if(null==e?void 0:e.length){let t=e.find(e=>!!e.url);n={url:null==t?void 0:t.url,key:null==t?void 0:t.key}}}}return{fileId:h,vid:h,groupType:s,size:f,fileStatus:a,progressDownload:0,progressTranscode:1,progressMigrate:0,meta:{},playInfo:n,encryptedCover:t,encryptedSprites:i,type:c,metaType:(0,r.Me)(c),name:g,duration:m,definition:p,downloadUrl:"",updatedAt:Date.now(),format:_}};function g(e){let{source_path:t,source:i,file_name:r,resource:n}=e,a=h(e);return{resource:n,fileId:i,path:t,meta:{visible:!0},material:{ext:s().extname(r),...a}}}function m(e){let{sourcePathMap:t,preloadResources:i}=e,{materials:r}=i;return{materialItems:c(Object.keys(t).map(e=>{let i=t[e],{image:r={},video:n={},audio:a={}}=i,{format:s,source:l,definition:c,duration:h,size:g,file_name:m}={...r,...n,...a},p=d[i.file_type],f=s||u(e),_=`${p}/${f}`,v=l||(0,o.pB0)(),M=`/${e}`;return{...t[e],source_path:e,groupType:p,mime:_,source:v,definition:c,duration:"number"==typeof h?1e3*h:h,size:g,file_name:m,format:f,path:M,resource:{status:1,...i}}}).map(g),r||void 0)}}},57407:function(e,t,i){i.d(t,{T:function(){return r}});let r=["#FA0001","#FFC502","#0098FF","#FF3AB0","#18C900","#FF6600","#00BFBF","#FCA3A9","#721919","#0111A4","#9FCF87","#CE7426","#0E48BC","#AA4B2E","#AC57FF","#CE7426","#107054","#96CAED","#C17E25","#0111A4","#50009F","#938900","#B62A80","#F9BB80","#7481FB","#D4A1C6","#B1EB00","#A093CA","#ECE368"]},9645:function(e,t,i){i.d(t,{l:function(){return M}});var r=i(789786);i(784923);var n=i(498417),a=i(230689),s=i(639605),o=i(967750),l=i(948328),d=i(607509),u=i(801497),c=i(612183),h=i(587892),g=i(402655),m=i(800788),p=i(668497),f=i(650248),_=i(425427),v=i(108692);class M extends g.JT{handleCurrentBatchReplaceTaskFinish(){this._currentBatchReplaceTaskQueue=[],this._waitBatchReplaceTaskQueue.length&&(this._currentBatchReplaceTaskQueue=this._waitBatchReplaceTaskQueue,this._currentBatchReplaceFileTaskQueue=this._waitBatchReplaceFileTaskQueue,this._waitBatchReplaceFileTaskQueue=[],this._handleStartBatchReplace((0,p.Z)(this._waitBatchReplaceTaskQueue.map(e=>{let{total:t}=e;return t}))),this._waitBatchReplaceTaskQueue=[])}get _currentTotal(){return(0,p.Z)(this._currentBatchReplaceTaskQueue.map(e=>{let{total:t}=e;return t}))}get _currentSuccessTotal(){return(0,p.Z)(this._currentBatchReplaceTaskQueue.map(e=>{let{successTotal:t}=e;return t}))}get _currentFailed(){return(0,p.Z)(this._currentBatchReplaceTaskQueue.map(e=>{let{total:t,successTotal:i}=e;return t-i}))}get _currentAllFinish(){return this._currentBatchReplaceTaskQueue.every(e=>{let{finish:t}=e;return t})}get _isTemplate(){return(0,_.JY)(this._videoEnvironmentService)}_block(e){return e.id!==this._uploadMaterialFromLink.messageId||!this._isTemplate&&e.upload_from!==s.d0.BATCH_REPLACE}_handleStartBatchReplace(e){this._onBeforeStartBatchReplace.fire(new Promise(t=>{this._confirmBatchReplaceHelper.showQrCodeUploadModal(e).then(i=>{i.ok?(this._onStartBatchReplace.fire(this._currentTotal),this._confirmBatchReplaceHelper.uploadingMaterialsLifecycles.length===e?(t(this._confirmBatchReplaceHelper.uploadingMaterialsLifecycles),this._confirmBatchReplaceHelper.removeMaterialTasks(),this._observableData.batchReplaceCount.failed=this._currentFailed):t([]),this._flushBatchReplaceFileTask(),this._currentAllFinish&&(this._currentSuccessTotal?this._observableData.batchReplaceCount.uploading=this._currentSuccessTotal:this._observableData.batchReplaceCount.failed=this._currentTotal-this._currentSuccessTotal,this._observableData.batchReplaceCount.uploaded=0)):(this._currentBatchReplaceTaskQueue=[],this._currentBatchReplaceFileTaskQueue=[],t([]))})}))}constructor(e,t,i,r,a,c,g,p){super(),this._observableData=e,this._confirmBatchReplaceHelper=t,this._segmentSelection=i,this._websocketService=r,this._containerService=a,this._draftMaterialsService=c,this._mainDraftService=g,this._videoEnvironmentService=p,this._currentBatchReplaceTaskQueue=[],this._waitBatchReplaceTaskQueue=[],this._currentBatchReplaceFileTaskQueue=[],this._waitBatchReplaceFileTaskQueue=[],this._onBeforeStartBatchReplace=this._register(new h.Q),this._onStartBatchReplace=this._register(new h.Q),this._onFileSuccessUpload=this._register(new h.Q),this._flushBatchReplaceFileTask=(0,f.Z)(async()=>{let{workspaceId:e}=this._mainDraftService.draftWorkspaceManager;(0,m.ZB)(e,"unexpect undefined for workspaceId when _flushBatchReplaceFileTask");let t=this._currentBatchReplaceFileTaskQueue.map(e=>{let{assetId:t}=e;return t});if(!t.length)return;this._currentBatchReplaceFileTaskQueue=[];let i=await (0,o.x)({assetIds:t,fromWorkspaceId:e,toWorkspaceId:e,containerService:this._containerService});if(!i.ok||!i.value.length){n.Z.error(u.ZP.t("web_text_edit_title_disconnected",{},"Something went wrong."));return}i.value.forEach(e=>{!this._isTemplate&&this._draftMaterialsService.addToUserGenerated(e,{addFrom:l.a.Upload}),this._confirmBatchReplaceHelper.addLinkMaterial({from:"timeline_link",materialLifecycle:e})})},1e3).bind(this),this.startQrUpload=async()=>{let{workspaceId:e}=this._mainDraftService.draftWorkspaceManager;(0,m.ZB)(e,"unexpect undefined for workspaceId when startQrUpload"),await this._uploadMaterialFromLink.registerUploadLink({workspaceId:e,uploadFrom:s.d0.BATCH_REPLACE});let t=this._uploadMaterialFromLink.getUploadLink(e).link,i=this._websocketService.getDeviceId();return`${t}?device_id=${i}&message_id=${this._uploadMaterialFromLink.messageId}&upload_from=${s.d0.BATCH_REPLACE}&position=track`},this._onStartUploadFromQrCode=e=>{var t;if(!e.ok||this._block(e.value)||this._segmentSelection.isTemplateFillAll||(null===(t=e.value.include_file_types)||void 0===t?void 0:t.every(e=>e===s.AW.AUDIO)))return;let i=e.value.total_count;if(this._confirmBatchReplaceHelper.qrCodeReplaceConfirm){this._waitBatchReplaceTaskQueue.push({id:e.value.batch_id,total:e.value.total_count,finish:!1,successTotal:0});return}!this._currentBatchReplaceTaskQueue.length&&this._handleStartBatchReplace(i),this._currentBatchReplaceTaskQueue.push({id:e.value.batch_id,total:e.value.total_count,finish:!1,successTotal:0})},this._onSuccessUploadFromQrCode=e=>{if(!(!e.ok||this._block(e.value))){for(let t=0;t<this._currentBatchReplaceTaskQueue.length;t++)if(e.value.batch_id===this._currentBatchReplaceTaskQueue[t].id){this._currentBatchReplaceTaskQueue[t].successTotal=e.value.upload_count,this._currentBatchReplaceTaskQueue[t].finish=!0;break}this._currentAllFinish&&this._confirmBatchReplaceHelper.qrCodeReplaceConfirm&&(!this._currentSuccessTotal&&(this._observableData.batchReplaceCount.failed=this._currentTotal-this._currentSuccessTotal),this._observableData.batchReplaceCount.uploading-=this._currentFailed);for(let t=0;t<this._waitBatchReplaceTaskQueue.length;t++)if(e.value.batch_id===this._waitBatchReplaceTaskQueue[t].id){this._waitBatchReplaceTaskQueue[t].successTotal=e.value.upload_count,this._waitBatchReplaceTaskQueue[t].finish=!0;break}}},this._onSuccessUploadFileFromQrCode=e=>{if(!(!e.ok||this._block(e.value))&&e.value.status===s.Pk.DONE&&!!this._currentBatchReplaceTaskQueue.concat(this._waitBatchReplaceTaskQueue).map(e=>{let{id:t}=e;return t}).includes(e.value.batch_id))this._currentBatchReplaceTaskQueue.find(t=>{let{id:i}=t;return i===e.value.batch_id})?this._currentBatchReplaceFileTaskQueue.push({assetId:e.value.asset_id,batchId:e.value.batch_id}):this._waitBatchReplaceFileTaskQueue.push({assetId:e.value.asset_id,batchId:e.value.batch_id}),this._confirmBatchReplaceHelper.qrCodeReplaceConfirm&&this._flushBatchReplaceFileTask()},this.onBeforeStartBatchReplace=this._onBeforeStartBatchReplace.event,this.onStartBatchReplace=this._onStartBatchReplace.event,this.onFileSuccessUpload=this._onFileSuccessUpload.event,this._uploadMaterialFromLink=this._containerService.createInstance(d.N,{onCreated:e=>{this._draftMaterialsService.addToUserGenerated(e.material,{addFrom:l.a.Upload})}}),this._websocketService.registerCallback(s.h1.WorkspaceUploadLinkStart,this._onStartUploadFromQrCode),this._websocketService.registerCallback(s.h1.WorkspaceUploadLinkSuccess,this._onSuccessUploadFromQrCode),this._websocketService.registerCallback(s.h1.WorkspaceUploadLinkFileSuccess,this._onSuccessUploadFileFromQrCode)}}M=(0,r.gn)([(0,r.fM)(3,s.J0),(0,r.fM)(4,a.t),(0,r.fM)(5,l.D),(0,r.fM)(6,v.n),(0,r.fM)(7,_.rO),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IBatchReplaceObservableData?Object:IBatchReplaceObservableData,void 0===c.s?Object:c.s,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===s.J0?Object:s.J0,void 0===a.t?Object:a.t,void 0===l.D?Object:l.D,void 0===v.n?Object:v.n,void 0===_.rO?Object:_.rO])],M)},513053:function(e,t,i){i.d(t,{D:function(){return d}});var r=i(772322),n=i(893354),a=i(801497),s=i(17886),o=i(823077);let l="move-template-slot-toast",d={RelatedVideoReplace(e,t){if(document.getElementById(l))return;let i=n.Z.info({content:(0,r.jsxs)("div",{children:[a.ZP.t("web_material_drag_text_success_different",{},"Clips marked with this color dot are replaced with a different material"),(0,r.jsx)("span",{className:s.Z["more-handle"],onClick:()=>{e(),i()},children:a.ZP.t("web_material_drag_btn_undo",{},"Undo")})]}),position:"top",className:s.Z["move-template-slot-toast"],id:l},{getContainer:()=>t?document.getElementById(o.aK):document.getElementById("_timeline-container")})},LimitFail(e){n.Z.error({content:a.ZP.t("web_material_drag_text_limit_fail",{},"Can\u2019t reorder due to template settings"),position:"top",className:s.Z["move-template-slot-toast"]},{getContainer:()=>e?document.getElementById(o.aK):document.getElementById("_timeline-container")})}}},281008:function(e,t,i){i.d(t,{Z:function(){return r}});let r=class e{get fixed(){return this._fixed}get absolute(){return this._absolute}get relative(){return this._relative}get time(){return this._time}get timeRound(){return this._timeRound}get fElement(){return this._fElement}get aElement(){return this._aElement}get rElement(){return this._rElement}get tElement(){return this._tElement}get trElement(){return this._trElement}reset(){this._fixed=void 0,this._relative=void 0,this._time=void 0,this._fElement=void 0,this._rElement=void 0,this._tElement=void 0,this._timeRound=void 0,this._trElement=void 0,this._elementOffset={}}calculate(e){var t,i;if(!e){this.reset();return}this._fixed={x:e.x+(null!==(t=window.scrollX)&&void 0!==t?t:0),y:e.y+(null!==(i=window.scrollY)&&void 0!==i?i:0)},this._calc(),this._calcElement()}calculateScroll(){this._calc(),this._calcElement()}referElementOffset(e){let{x:t,y:i}=e;if(!!this._relative)this._elementOffset={left:this._relative.x-t,top:this._relative.y-i},this._calcElement()}recordElementOffset(e){let{left:t,top:i}=e;this._elementOffset={left:t,top:i},this._fixed&&this._calcElement()}mixOffset(e){let{x:t,y:i}=e;if(!!this._fixed)this._fixed.x+=t,this._fixed.y+=i,this._calc()}_toElement(e){let{x:t,y:i}=e;return this._elementOffset&&(this._elementOffset.top&&(i-=this._elementOffset.top),this._elementOffset.left&&(t-=this._elementOffset.left)),{x:t,y:i}}_calc(){if(!!this._fixed)this._absolute=this.context.unit.fixed2absolute(this._fixed),this._relative=this.context.unit.fixed2relative(this._fixed),this._time=this.context.unit.px2us(this._relative.x),this._timeRound=this.context.unit.roundMouseTime(this._time)}_calcElement(){if(!!this._fixed)this._fElement=this._toElement(this._fixed),this._aElement=this.context.unit.fixed2absolute(this._fElement),this._rElement=this.context.unit.fixed2relative(this._fElement),this._tElement=this.context.unit.px2us(this._rElement.x),this._trElement=this.context.unit.roundMouseTime(this._tElement)}constructor(e){this._elementOffset={},this.context=e}}},798780:function(e,t,i){i.d(t,{Z:function(){return o}});var r=i(789786),n=i(260963),a=i(690674);class s{get disableInteract(){return this._store[a.d5].disableSequenceInteract}get disableReadonlyMode(){return this._store[a.d5].disableReadonlyMode}get operationWidthInner(){return this._store[a.U_].operationWidthInner}get isTemplate(){return this._context.userConfig.modules.environment.isTemplate}get cmdKeyHadDown(){return this._context.userConfig.modules.timelineKeybinding.cmdKeyHadDown}get switches(){let{adsorb:e}=this._store[a.U_].switches;this._store[a.qk].expandedSegmentId&&(e=!1);let t=!this._store[a.U_].isTemplate;return this._store[a.qk].expandedSegmentId&&(t=!1),{adsorb:e,inspectPlaceholder:t}}get zoom(){return this._store[a.U_].zoomStore.value}get disable(){return this._store[a.d5].disableInteract||this._store[a.U_].loading}get disableSelection(){return this.disable||this._store[a.d5].disableSelection}get isSingleSelection(){return 1===this.uiSegments.length}get isMultiSelection(){return this.uiSegments.length>1}get tracks(){return this._store[a.U_].tracks}get progress(){return this._store[a.U_].progress}get keyframeSelectInfo(){return this._store[a.U_].keyframeStore.keyframeSelectInfo}get isBatchReplace(){return this._store[a.U_].isBatchReplacePanelVisible}get visual(){return this._store[a.U_].visual}get operationWidth(){return this._store[a.U_].operationWidth}get targetSegment(){var e;return this.isSingleSelection?{...this.uiSegments[0],trackId:null===(e=this._context.registry.track.findBySegment(this.uiSegments[0].id)[0])||void 0===e?void 0:e.id}:this._targetSegment}get mainTrack(){var e;return null===(e=this.tracks.find(e=>{let[t,i]=e;return"video"===t.type&&0===i}))||void 0===e?void 0:e[0]}get isDragging(){return"dragging"===this.dragState}get expandedSegmentId(){return this._store[a.qk].expandedSegmentId}get segmentSelected(){return this._store[a.qk].segmentSelected}establish(e){var t;this.setContainer(e),this.setVerticalContainer(null!==(t=e.querySelector(".timeline-bd-vertical-scroll"))&&void 0!==t?t:void 0),this._$$syncDisposerUISegments=(0,n.U5)(()=>this._store[a.qk].segmentSelected,()=>{"insert"!==this.dragType&&this.setUISegments(this._store[a.qk].segmentSelected)}),this._$$syncDisposerZoom=(0,n.U5)(()=>this._store[a.U_].zoomStore.value,()=>{this._context.reference.calculate()}),!this.isTemplate&&(this._$$syncTemplateMode=(0,n.U5)(()=>this._store[a.U_].isBatchReplacePanelVisible,e=>{this.setTemplateMode(e)}))}relinquish(){var e,t,i;this.setContainer(void 0),null===(e=this._$$syncDisposerUISegments)||void 0===e||e.call(this),this._$$syncDisposerUISegments=void 0,null===(t=this._$$syncDisposerZoom)||void 0===t||t.call(this),this._$$syncDisposerZoom=void 0,null===(i=this._$$syncTemplateMode)||void 0===i||i.call(this),this._$$syncTemplateMode=void 0}resetDrag(){this.setMessage(void 0),this.setDragType(void 0),this.setDragState("none"),this.setDragStart({timestamp:Date.now(),x:void 0,y:void 0}),this.setSnapshotTracks([])}setContainer(e){this.container=e}setVerticalContainer(e){this.vertivalContainer=e}setDragState(e){this.dragState=e}setIsCursorDrag(e){this.isCursorDrag=e}setIsHoverCursor(e){this.isHoverCursor=e}setMessage(e){this.message=e}setMutableAudioDisableInteract(e){this.mutableAudioDisableInteract=e}setDragStart(e){this.dragStart=e}setDragType(e){this.dragType=e}setHoverSeg(e){this.hoverSeg=e}setHoverSegPart(e){this.hoverSegPart=e}setHoverSegLocation(e){this.hoverSegLocation=e}setIsHoverSeg(e){this.isHoverSeg=e}setIsHoverCursorSeg(e){this.isHoverCursorSeg=e}setPrevSituation(e){this.prevSituation=e}setHasMutableVideoClicked(e){this.hasMutableVideoClicked=e}setIsInTimelineBd(e){this.isInTimelineBd=e}setTargetSegment(e){let t=this.uiSegments.find(t=>t.id===(null==e?void 0:e.segId));e&&t?this._targetSegment={...t,trackId:e.trackId}:this._targetSegment=null}setUISegments(e){this.uiSegments=e}setTemplateMode(e){this.allowNegtiveMouseTime=!e,this.enableHoverOutsideTimeline=e}setTimelineScrollOnEdge(e){this.enableTimelineScrollOnEdge=e}setSnapshotTracks(e){this._store[a.xI].setSnapshotTrack(e)}constructor(e,t){this._context=e,this._store=t,this.allowNegtiveMouseTime=!0,this.enableHoverOutsideTimeline=!1,this.enableTimelineScrollOnEdge=!0,this.mutableAudioDisableInteract=!1,this.edgeWidth=0,this.isHoverSeg=!1,this.isHoverCursor=!1,this.isCursorDrag=!1,this.isHoverCursorSeg=!1,this.hasMutableVideoClicked=!1,this.hoverSeg=void 0,this.hoverSegPart=void 0,this.hoverSegLocation=void 0,this.isInTimelineBd=!1,this.draggingItemInfo=null,this.uiSegments=[],this.prevSituation=void 0,this.message=void 0,this.dragType=void 0,this.dragState="none",this.dragStart={timestamp:-1,x:void 0,y:void 0},this.container=void 0,this.vertivalContainer=void 0,this.isInTemplate=!1,this._targetSegment=null,(0,n.ky)(this)}}(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"allowNegtiveMouseTime",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"enableHoverOutsideTimeline",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"enableTimelineScrollOnEdge",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"mutableAudioDisableInteract",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Number)],s.prototype,"edgeWidth",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"isHoverSeg",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"isHoverCursor",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"isCursorDrag",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"isHoverCursorSeg",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"hasMutableVideoClicked",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof Array?Object:Array)],s.prototype,"uiSegments",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Object)],s.prototype,"prevSituation",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof MessageSegment?Object:MessageSegment)],s.prototype,"message",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof DragType?Object:DragType)],s.prototype,"dragType",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof DragState?Object:DragState)],s.prototype,"dragState",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof DragStartInfo?Object:DragStartInfo)],s.prototype,"dragStart",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof HTMLDivElement?Object:HTMLDivElement)],s.prototype,"container",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type","undefined"==typeof HTMLDivElement?Object:HTMLDivElement)],s.prototype,"vertivalContainer",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Boolean)],s.prototype,"isInTemplate",void 0),(0,r.gn)([n.LO,(0,r.w6)("design:type",Object)],s.prototype,"_targetSegment",void 0);let o=s},28263:function(e,t,i){i.d(t,{k:function(){return o},zA:function(){return s}});var r=i(218571),n=i(690674);let a=0;function s(e,t,i){let{modules:{coordinate:s},store:o}=i,{mutableCropVisible:l,mutableTrimVisible:d,isBatchReplacePanelVisible:u}=o[n.U_],c=(0,r.useMemo)(()=>{var t;return null!==(t=e.id)&&void 0!==t?t:`segment_${++a}`},[e.id]),h=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!l&&!d)return null==s||s.registry.tier.register({refEl:h,registeredType:"tier-block",...e,id:c}),()=>{null==s||s.registry.tier.unregister(c)}},[s,c,l,d,u]),(0,r.useEffect)(()=>{null==s||s.registry.tier.update({...e,id:c})},[e.zIndex,e.availReplace,e.handleReplace]),{refEl:h}}function o(e,t){let i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(e){var r;let n=null!==(r=e.id)&&void 0!==r?r:`segment_${++a}`;return null==t||t.registry.territory.register({refEl:i,registeredType:"territory",id:n}),()=>{null==t||t.registry.territory.unregister(n)}}},[t,e]),{refEl:(0,r.useCallback)(r=>{e&&(i.current=r,null==t||t.registry.territory.update({id:e.id,refEl:i}))},[e])}}},452026:function(e,t,i){i.d(t,{Q:function(){return p}});var r=i(426336),n=i(690674),a=i(695324),s=i(309227),o=i(632172),l=i(710763),d=i(442692),u=i(432092),c=i(371140),h=i(591010),g=i(860660),m=i(891344);function p(e,t,i,p){let{draftOperation:f,player:_,timelineSelection:v,selection:M,sider:S,event:y,coordinate:T}=t,{dataSdk:b}=f;return{clickBlank:t=>{(0,a.b)(i,{relatedEvent:a.Z.MoveTimeline});let l=b.draftView.getDraftDuration();y.uiEvents.emit(u.W.CLICK_BLANK);let d=r.pMA.min([l,t],"bigint");e[n.U_].setPreviewLineStatus(c.$o.DISABLE),e[n.U_].setPreviewMutableSlotStatus(c.$o.DISABLE),e[n.U_].setTimelineProgress(d),_.timelineSeek(d),(0,s.o)(i,{action_type:"click"}),(0,o.s)(i,{seek_type:"accurate",duration:0})},selectSegmentOrTransition:async function(t,r){let{segmentIds:a=[],transitionIds:s=[]}=t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";if(!e[n.d5].disableSelection)await (0,m.n)({segmentIds:a,transitionIds:s,action:r,store:e,modules:{timelineSelection:v,selection:M,coordinate:T,player:_,sider:S,draftOperation:f,dataSdk:b},containerService:i,mouseAction:o})},endBoxSelect:()=>{var t;let{segmentIds:r=[],transitionIds:a=[]}=v.getPrepareSelectedSegmentsData();t=[...r,...a],t.length&&v.updateSelectData({segmentIds:r,transitionIds:a},h.U.Click),(0,l.r)(i,(0,l.T)({ids:e[n.qk].selectedSegmentIds,action:"track",draftView:b.draftView,transitionIds:e[n.qk].segmentSelected.filter(e=>"transition"===e.type).map(e=>e.id)}))},dbClick:e=>{if(!e)return;let{segmentId:t,transitionId:n}=e;if(t){let e=b.draftView.getSegmentById(t,void 0,!1);if(!e)return;(0,r.Q2R)(e)?_.timelineSeekToTextTemplateCompletelyPresented(e):_.timelineSeekToSegmentEnterAnimationEnd(e);let n=(0,g.p8)(e);(0,d.E)(i,{material_id:e.id,material_name:n.material_name,track_category:n.track_category,material_category:n.material_category})}y.dbClick(e)}}}},620266:function(e,t,i){i.d(t,{G:function(){return a},s:function(){return s}});var r,n,a=((r={}).DATA_SDK="dataSdk",r.TRANSIENT_DATA="transientData",r);var s=((n={}).TRACKS="tracks",n.TRACKS_MUTABLE="tracksMutable",n)},521183:function(e,t,i){i.d(t,{T:function(){return u}});var r=i(620266),n=i(690674),a=i(345299),s=i(700933),o=i(907031),l=i(426336);function d(e){if(1!==e.length)return!1;let[t]=e[0];return t.id===o.pP}let u={name:"multi-track-main-track-placeholder",runner:(e,t,i)=>{let{store:o,dataSdk:u,mode:c}=i,{track:h}=e,g=o[n.U_].tracks;if(c!==r.s.TRACKS)return;let{sourceFrom:m}=t;if(m===r.G.TRANSIENT_DATA){if(d(g)){let{value:e}=t,{tracks:i}=e;if(i.length>0&&[l.pNd.TrackTypeVideo,"dragVideoPlaceholder","combination"].includes(i[0].item.track.type)){let e={notifyOperationList:[],type:a.P.DELETE,nextValue:null,prevIndex:0,nextIndex:-1,prevValue:(0,s.BM)()[0]};h.unshift(e)}}}else if(m===r.G.DATA_SDK){let e=u.draftView.getAllTracks();if(0!==e.length&&d(g)){let e={notifyOperationList:[],type:a.P.DELETE,nextValue:null,prevIndex:0,nextIndex:-1,prevValue:(0,s.BM)()[0]};h.push(e)}else if(0===e.length&&0===g.length){let e={notifyOperationList:[],type:a.P.ADD,prevValue:null,prevIndex:-1,nextIndex:0,nextValue:(0,s.BM)()[0]};h.push(e)}else if(0===e.length&&!d(g)){let e={notifyOperationList:[],type:a.P.ADD,prevValue:null,prevIndex:-1,nextIndex:0,nextValue:(0,s.BM)()[0]};h.push(e)}}return{tracks:[],segments:[]}}}},186463:function(e,t,i){i.d(t,{T:function(){return u}});var r=i(620266),n=i(690674),a=i(426336),s=i(823404),o=i(804497),l=i(345299);let d="mutable-audio-track",u={name:"mutable-audio-placeholder",runner:(e,t,i)=>{let{mode:u,store:c,dataSdk:h}=i,{sourceFrom:g}=t;if(u!==r.s.TRACKS_MUTABLE||g!==r.G.DATA_SDK)return;let{segment:m}=e,{value:p}=t,{[a.u4I.SEGMENT]:f}=p,_=c[n.U_].tracksMutable,v=!1;if(f.forEach(e=>{e.item.segmentType===a.Ocy.SegmentAudio&&(v=!0)}),v&&2===_.length){let e=h.cutSame.draftIdToMutableAudios[h.draftView.getDraftId()];_[1][0].segments.map((e,t)=>(0,s.Vo)(e.id)?{value:e,index:t}:null).filter(Boolean).forEach(e=>{let{value:t,index:i}=e;m.push({type:l.P.DELETE,prevTrackId:d,prevValue:t,prevIndex:i,notifyOperationList:[],nextTrackId:null,nextValue:null,nextIndex:-1})});let t=0n;for(let i=0;i<e.length;i++){let r=t,{targetStart:n,targetDuration:a}=e[i],s=e[i].targetStart-r;s>0&&m.push({type:l.P.ADD,prevTrackId:null,prevIndex:-1,nextTrackId:d,nextIndex:i,nextValue:(0,o.IK)(r,s),prevValue:null,notifyOperationList:[]}),t=n+a}let i=h.draftView.getDuration();i>t&&m.push({type:l.P.ADD,prevTrackId:null,prevIndex:-1,nextTrackId:d,nextIndex:-1,nextValue:(0,o.IK)(t,i-t),prevValue:null,notifyOperationList:[]})}}}},705286:function(e,t,i){i.d(t,{A:function(){return d}});var r=i(620266),n=i(426336),a=i(690674),s=i(136498),o=i(248222),l=i(800788);let d={name:"subDraft",runner:(e,t,i)=>{let{mode:d,store:u,dataSdk:c,subDraftApplySpeedViewManager:h}=i,{sourceFrom:g,value:m}=t;if(d!==r.s.TRACKS||g!==r.G.DATA_SDK||!u[a.qk].subDraftId||!c.draftView.getDraftById(u[a.qk].subDraftId))return;let{segment:p}=e,{[n.u4I.SEGMENT]:f}=m,_=new Map;f.forEach(e=>{let{item:t,type:i}=e,{path:r}=t;if(r&&r.length>=2){let r;r=i===n.C8.ADD?t.segment.id:t.id;let a=_.get(r);!a&&_.set(r,a=[]),a.push(e)}}),[..._.entries()].forEach(t=>{var r,n;let[d,c]=t,g=null,{subDraftSegment:m}=u[a.qk];m&&(0,o.kl)(m)&&(g=null!==(r=h.getCombinationApplySpeedDraftViewById(m.id))&&void 0!==r?r:null,(0,l.Y2)(g));let f=(0,s.t_)({segmentId:d,notifySegmentOperation:c,subDraftId:null!==(n=u[a.qk].subDraftId)&&void 0!==n?n:void 0,collectionMap:e,draftView:null!=g?g:void 0},i);f&&p.push(f)})}}},825875:function(e,t,i){i.d(t,{z:function(){return l}});var r=i(402655),n=i(800788),a=i(690674),s=i(345299),o=i(858151);class l extends r.JT{_syncTracks(e,t){let i=[],r=[],n=[];e.forEach(e=>{e.type===s.P.ADD?r.push(e):e.type===s.P.UPDATE?i.push(e):e.type===s.P.DELETE&&n.push(e)}),n.forEach(e=>this._applyTrackChange(e,t)),r.forEach(e=>this._applyTrackChange(e,t)),i.forEach(e=>this._applyTrackChange(e,t))}_syncSegment(e,t){let i=[],r=[],n=[];e.forEach(e=>{e.type===s.P.ADD?r.push(e):e.type===s.P.UPDATE?i.push(e):e.type===s.P.DELETE&&n.push(e)}),i.forEach(e=>this._applySegmentChange(e,t)),n.forEach(e=>this._applySegmentChange(e,t)),r.forEach(e=>this._applySegmentChange(e,t))}syncTracksData(e){let{[s.A.SEGMENT]:t,[s.A.TRACK]:i}=e;this._syncTracks(i,this._timelineManagerStore[a.U_].tracks),this._syncSegment(t,this._timelineManagerStore[a.U_].tracks)}syncTracksMutableData(e){let{[s.A.SEGMENT]:t,[s.A.TRACK]:i}=e;this._syncTracks(i,this._timelineManagerStore[a.U_].tracksMutable),this._syncSegment(t,this._timelineManagerStore[a.U_].tracksMutable)}constructor(e,t){super(),this._timelineManagerStore=e,this._dataSdk=t,this._applyTrackChange=(e,t)=>{let{type:i,prevValue:r,nextValue:a,nextIndex:l}=e,d=null==r?void 0:r.id;switch(i){case s.P.ADD:{let e={...a,segments:[]},i=-1,r=l+1;for(let e=0;e<t.length;e++){let[n]=t[e];if(!(0,o.sH)(n.id)&&r--,0===r){i=e;break}}-1===i?t.push([e,t.length]):t.splice(i,0,[e,i]);break}case s.P.UPDATE:{let e=t.findIndex(e=>{let[t]=e;return t.id===d}),i=t[e];if(i){let[t]=i;Object.assign(t,a),i[1]=e}break}case s.P.DELETE:{let e=t.findIndex(e=>{let[t]=e;return t.id===d});t.splice(e,1);break}default:(0,n.bP)(i)}},this._applySegmentChange=(e,t)=>{let{nextValue:i,prevValue:r,prevTrackId:a,nextTrackId:o,type:l}=e;switch(l){case s.P.ADD:{let e=t.find(e=>{let[t]=e;return t.id===o});if(e){(0,n.Y2)(i);let[t]=e,r=t.segments.findIndex(e=>e.start>i.start);-1===r?t.segments.push(i):t.segments.splice(r,0,i)}break}case s.P.UPDATE:{let e=t.find(e=>{let[t]=e;return t.id===o}),r=t.find(e=>{let[t]=e;return t.id===a});if(r){let[e]=r,t=e.segments.findIndex(e=>e.id===(null==i?void 0:i.id));t>=0&&e.segments.splice(t,1)}if(e){let[t]=e,r=t.segments.findIndex(e=>e.start>i.start);-1===r?t.segments.push(i):t.segments.splice(r,0,i)}break}case s.P.DELETE:{let e=t.find(e=>{let[t]=e;return t.id===a});if(e){let[t]=e,i=t.segments.findIndex(e=>e.id===(null==r?void 0:r.id));i>=0&&t.segments.splice(i,1)}break}default:(0,n.bP)(l)}}}}},458321:function(e,t,i){i.d(t,{O:function(){return s}});var r=i(632858),n=i(426336),a=i(521641);let s=(e,t)=>{let{dstSegId:i,srcSegId:s,currentTime:o}=t,{draftView:l}=e,d=l.getAllTracks(),{segmentIndex:u,trackIndex:c}=l.getSegmentAtPositionById(i),h=d[c].segments[u].clone(),g=r.v.instance.getData(l.getDraftId(),s);if(!(null==g?void 0:g.keyframes)||!(null==g?void 0:g.segment))return;let m=h.commonKeyframes,p=[],f=h.targetTimerange;if(0n===f.start&&0n===f.duration)return;let _=o-f.start;if(_<0||_>f.duration)return;let v=new Set,M=0x7fffffffffffffffn;for(let e of g.keyframes){let t=e.keyframeList[0].timeOffset;M>t&&(M=t)}let S=new n.b8q().getTimelineByKeyframeTimeOffset(l,g.segment,M);for(let e of g.keyframes){let t=e.propertyType;if(!(0,n.pyj)(t)&&!n.SQk.isEnable(h,t)||!n.SQk.prePasteKeyframe(g.segment,h,t))continue;let i=e.clone(!0),r=-1;for(let e=0;e<m.length;e++)if(m[e].propertyType===i.propertyType){r=e;break}let s=[];-1!==r&&(v.add(r),s=m[r].keyframeList);let d=[],u=i.keyframeList;if(0===u.length){d=s,i.keyframeList=d;continue}let c=0,_=0,y=s.length,T=u.length,b=!1;for(;c<y&&_<T;){if(!b){if(u[_].timeOffset===M)u[_].timeOffset=o,b=!0;else{let e=new n.b8q().getTimelineByKeyframeTimeOffset(l,g.segment,u[_].timeOffset)-S+o;if(e<0||e>f.start+f.duration){_=T;break}u[_].timeOffset=e,b=!0}}2>new a.Z(s[c].timeOffset.toString()).minus(new a.Z(u[_].timeOffset.toString())).abs().toNumber()?(d.push(s[c]),c++,_++,b=!1):s[c].timeOffset<u[_].timeOffset?(d.push(s[c]),c++):(d.push(u[_]),_++,b=!1)}for(;c<y;)d.push(s[c]),c++;for(;_<T;){if(!b){if(u[_].timeOffset===M)u[_].timeOffset=o,b=!0;else{let e=new n.b8q().getTimelineByKeyframeTimeOffset(l,g.segment,u[_].timeOffset)-S+o;if(e<0||e>f.start+f.duration){_=T;break}u[_].timeOffset=e,b=!0}}d.push(u[_]),_++,b=!1}n.OLp.repairControlPoints(d),i.keyframeList=d,p.push(i)}for(let e=0;e<m.length;++e)!v.has(e)&&p.push(m[e].clone());p=n.OLp.filterTextDisableKeyframe(p,h);let y=e.draftView.getAllSegments().reduce((e,t)=>{for(let i of t.commonKeyframes)for(let t of i.keyframeList)e.add(t.id);return e},new Set),T=e.api.batch.batchStart();p.forEach(t=>{t.keyframeList.forEach(i=>{if(!y.has(i.id))e.api.keyframe.add({segmentId:h.id,keyframeType:t.propertyType,dataParam:{playHead:i.timeOffset,datas:i.values}})})}),e.api.batch.batchEnd(T)}},432092:function(e,t,i){i.d(t,{W:function(){return n}});var r,n=((r={}).TRACKS_CHANGE="timelineTracksChange",r.MAIN_TRACK_POSITION_CHANGE="mainTrackPositionChange",r.SEGMENT_FAILED_BUTTON_CLICK="segment:failed_button_clicked",r.MUTABLE_AUDIO_ENTER_TRIM="mutableAudioEnterTrim",r.SEGMENT_DRAG_END="segmentDragEnd",r.CLICK_BLANK="clickBlank",r)},146220:function(e,t,i){i.d(t,{h:function(){return d},m:function(){return l}});var r=i(789786),n=i(489753),a=i(108692),s=i(426336),o=i(230689);let l="TIMELINE_FIRST_RENDER";class d{_initDraftStartTime(e){e.onChangeDiff(e=>{e.actionOperateType===s.aWQ.History&&(this._draftStartTime=Date.now())})}_initEnsureResourceListener(){this._timelineEvent.onTimelineBeforeEnsureResource(e=>{let{data:t}=e;"key"in t.value&&(this._materialKeyStartTimeMap[t.value.key]=Date.now())}),this._timelineEvent.onTimelineAfterEnsureResource(e=>{let{data:t,resourceRecord:i}=e,r=null==i?void 0:i.segmentPath;if(!!r)"key"in t.value&&this._materialKeyStartTimeMap[t.value.key]&&this.handleFirstFrameStart(r,this._materialKeyStartTimeMap[t.value.key])})}handleFirstFrameStart(e,t){this._materialPathStartTimeMap[e]=null!=t?t:Date.now()}firstReport(){if(!this._isFirstRenderReported)this._isFirstRenderReported=!0}trackerReport(e,t,i){}reportEventINP(e){}constructor(e,t,i){this._timelineEvent=e,this._mainDraftService=t,this._containerService=i,this._isFirstRenderReported=!1,this._draftStartTime=0,this._materialPathStartTimeMap={},this._materialKeyStartTimeMap={},this._materialPathEndTimeMap={},this.handleFirstFrameEnd=e=>{if(!e||this._materialPathEndTimeMap[e])return;let t=Date.now();this._materialPathEndTimeMap[e]=t,this._materialPathStartTimeMap[e]?(0,n.r)(this._containerService,{time:t-this._materialPathStartTimeMap[e]}):this._draftStartTime&&(0,n.r)(this._containerService,{time:t-this._draftStartTime})},this._initDraftStartTime(this._mainDraftService.dataSdk),this._initEnsureResourceListener()}}d=(0,r.gn)([(0,r.fM)(1,a.n),(0,r.fM)(2,o.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof ITimelineEventOuter?Object:ITimelineEventOuter,void 0===a.n?Object:a.n,void 0===o.t?Object:o.t])],d)},213099:function(e,t,i){i.d(t,{c:()=>P,j:()=>E});var r=i("789786"),n=i("690674"),a=i("729596"),s=i("587892"),o=i("849002"),l=i("800788"),d=i("425427"),u=i("108692"),c=i("827084"),h=i("315201"),g=i("433140"),m=i("230689"),p=i("127830"),f=i("928261"),_=i("884058"),v=i("153107"),M=i("979159"),S=i("426336");let y=(e,t,i,r)=>{if(!r.length)return[];let n=r.length,a=Math.round(S.pMA.div(e,i)*n),s=Math.round(S.pMA.div(e+t,i)*n);return r.slice(a,s>a?s:a+1)};var T=i("460254"),b=i("242785"),I=i("909034"),w=i("823077"),k=i("159277"),A=i("820193"),C=i("160391"),D=i("37197"),x=i("5138");let P=102;class E{get templateResourceKey(){var e;let t=(0,d.JY)(this._environmentService)?this._environmentService.currentTemplateId:null,i=null!==(e=this._store.timelineSelectionStore.subDraftTemplateId)&&void 0!==e?e:t;return i&&(0,c.Bc)(i)}get templateIdToInfo(){return this._store[n.jU].templateIdToInfo}get onRestored(){return this._lifeCycleService.onRestored}get resourceErrorManager(){return this._resourceErrorManager}get _templateDuration(){if(!this.templateResourceKey)return 0n;let e=this._resourceService.get(this.templateResourceKey,p._g.VideoTemplate);return e&&(0,h.R)(e.value)?a.h.secondToUs(e.value.duration):0n}setRenderManager(e){this._renderManager=e,e.onFirstFrameRender(()=>{this._screenshotManager.restore(k.a.MutablePoly,k.a.Mutable,k.a.Combination),this._resourceScheduler.afterFirstFrame()})}preload(e){let t={[T.r.Video]:p._g.Video,[T.r.UserVideo]:p._g.UserVideo,[T.r.Photo]:p._g.Photo,[T.r.UserPhoto]:p._g.UserPhoto,[T.r.Gif]:p._g.Gif},{type:i,value:r}=e,n=t[i],a=(0,M.JY)(e.type,e.value);if(!n||!(0,f.IM)(a))return;let s=(0,A.nQ)(this._resourceService,n,r);this._observeResource(a,s.value.key,n)}observe(e){let{segment:t,templateResourceKey:i}=e;this._relation.build({action:"add",segment:t,templateResourceKey:i}),(0,f.rE)(t.mutable)?t.mutable.children.forEach(e=>{this._parseSlotResource({segment:e,templateResourceKey:i}),this._observeResource(e)}):(0,f.gG)(t.mutable)&&this._parseSlotResource(e),this._observeResource(t)}disconnect(e){let{segment:t,templateResourceKey:i}=e;this._relation.build({action:"remove",segment:t,templateResourceKey:i})}getMutableDefaultCover(e){var t,i;let r="",{covers:a,defaultCover:s}=this._store[n.jU];if((0,f.gG)(e.mutable)){let i=e.mutable.coverPath;!a[r=null!==(t=this._draftPathStore.getResourceKeyFromDraftPath(null!=i?i:""))&&void 0!==t?t:""]&&i&&(r=i)}let{templateResourceKey:o}=this,l=o?a[o]:s;return r?null!==(i=a[r])&&void 0!==i?i:l:s}getCover(e){var t,i,r,a,s,o;let{covers:l,defaultCover:d}=this._store[n.jU];switch(e.type){case"video":{let t=(0,v.$Q)(e,this._draftPathStore);return t?l[t]:void 0}case"mutable":{let{templateResourceKey:n}=this;if(!n)return d;let{locked:a}=null==e?void 0:e.mutable;if(a)return null!==(t=l[n])&&void 0!==t?t:d;return null!==(r=null!==(i=l[(0,v.$Q)(e,this._draftPathStore)])&&void 0!==i?i:l[n])&&void 0!==r?r:d}case"mutablePoly":{let{templateResourceKey:t}=this;if(!t)return d;let{children:i=[]}=e.mutable,r=i.find(e=>{var t;return null===(t=e.mutable)||void 0===t?void 0:t.filled});if(!r)return null!==(a=l[t])&&void 0!==a?a:d;return null!==(o=null!==(s=l[(0,v.$Q)(r,this._draftPathStore)])&&void 0!==s?s:l[t])&&void 0!==o?o:d}default:return}}getSpritesByKey(e){return this._store[n.jU].sprites[e]}getSprites(e){var t,i,r;let{sprites:a}=this._store[n.jU];switch(e.type){case"video":{let t=(0,v.$Q)(e,this._draftPathStore);return t?a[t]:void 0}case"mutable":{let{templateResourceKey:i}=this;if(!i)return;let{start:r,duration:n}=e,{locked:s}=null==e?void 0:e.mutable;if(s){let s=this._templateDuration;if(a[e.id])return a[e.id];return(null===(t=a[i])||void 0===t?void 0:t.length)?y(r,n,s,a[i]):void 0}(0,v.$Q)(e,this._draftPathStore);let{mutableId:o,filled:l}=null==e?void 0:e.mutable;return a[o]}case"mutablePoly":{let{children:t=[]}=e.mutable,r=t.find(e=>{var t;return null===(t=e.mutable)||void 0===t?void 0:t.filled});if(r){let t=(0,v.$Q)(r,this._draftPathStore);return null!==(i=a[e.id])&&void 0!==i?i:a[t]}if(a[e.id])return a[e.id];return t.map(e=>{var t;return a[null===(t=e.mutable)||void 0===t?void 0:t.mutableId]}).reduce((e,t)=>[...e,...t||[]],[])}case"combination":{let t=(0,v.$Q)(e,this._draftPathStore);if(a[t])return a[t];let i=(0,c.Bc)(null!==(r=e.templateId)&&void 0!==r?r:"");if(i&&a[i])return a[i];let{defaultSprite:s}=this._store[n.jU];if(s)return[s];return}default:return}}clearSprites(e){if(!!e)delete this._store[n.jU].sprites[e]}resetSpritesByKey(e){var t;(null===(t=this._store[n.jU].sprites[e])||void 0===t?void 0:t.length)&&this._store[n.jU].setSprites(e,[])}setSpritesByTimestamp(e){this._resourceScheduler.setSprites(e)}getScreenshots(e){let t=this.getSprites(e);if(null==t?void 0:t.length)return t;let i=this.getCover(e);if(i){if("mutable"===e.type){var r;let t=null===(r=e.mutable)||void 0===r?void 0:r.filled,i=(0,v.$Q)(e,this._draftPathStore);if(t&&this._resourceScheduler.isResourcePending(i))return}return[{...i,timestamp:0n}]}}getSourceWaves(e){let{type:t}=e,i=(0,v.$Q)(e,this._draftPathStore);if(!!i&&("audio"===t||"mutableAudio"===t))return this._store[n.jU].waves[i]}async getTemplateInfo(e){(0,l.Y2)(this._bootstrapBarrier.isOpen(),"get template should called after bootstrap");let t=await this._mainDraftService.draftTemplateManager.getTemplate(e);return this._store[n.jU].setTemplateInfo(e,t),t}setTemplateInfo(e,t){this._store[n.jU].setTemplateInfo(e,t)}async bootstrap(){await this._initDefaultResource(),this._bootstrapBarrier.open()}reset(){this._relation.reset(),this._bootstrapBarrier=new o.U,this._templateSpritesBarrier=new o.U}async checkTransitionResource(e){return!!await (0,I._s)(e,this._ensureManager,this._renderManager,this._resourceService)}getResourceKeyByPath(e){return this._mainDraftService.draftPathStore.getResourceKeyFromDraftPath(e)}updateFailSegments(e){let t=Object.entries(e).reduce((e,t)=>{let[i,r]=t;return r===w._3&&e.add(i),e},new Set);this._store[n.jU].setFailSegments(t)}_barrierExecute(e,t){e.isOpen()?t():e.wait().then(()=>t())}setDefaultSprite(e){this._store[n.jU].setDefaultSprite({image:e,x:0,y:0,width:e.width,height:e.height,timestamp:0n,sourceTimestamp:0n}),this._store[n.jU].setDefaultCover({image:e,width:e.width,height:e.height,timestamp:0n,sourceTimestamp:0n})}getDefaultCover(){return this._store[n.jU].defaultCover}async _initDefaultResource(){let{subDraftSegments:e}=this._store[n.qk],t=(0,d.JY)(this._environmentService)?[this.templateResourceKey]:e.map(e=>(0,c.Bc)(e.templateId));await Promise.all(t.map(e=>this._parseTemplateCoverAndSprites(e))),this._templateSpritesBarrier.open()}async _parseTemplateCoverAndSprites(e){let t=this._resourceService.get(e,p._g.VideoTemplate);if(!t)return;let{resourceStore:i}=this._store;(!i.covers[e]||!i.sprites[e])&&await this._resourceScheduler.parseVideo(t)}_parseSlotSprites(e){let{segment:t,templateResourceKey:i}=e,{resourceStore:r}=this._store;if("mutable"!==t.type||!(0,f.gG)(t.mutable)||r.sprites[t.mutable.mutableId]||!i)return;let n=r.sprites[i],a=this._resourceService.get(i,p._g.VideoTemplate);if(!!n&&!!a)this._resourceScheduler.parseSlotSprites(a,{resourceKey:t.mutable.mutableId,start:t.start,duration:t.duration,templateSprites:n})}_parseSlotCover(e){if("mutable"!==e.type||!(0,f.gG)(e.mutable)||!e.mutable.coverPath)return;let{coverPath:t}=e.mutable,i=this._draftPathStore.getResourceKeyFromDraftPath(t);if(!i||this._store[n.jU].covers[i])return;let r=this._resourceService.get(i,p._g.UserPhoto);r&&this._observePhotoResource(r)}_parseSlotResource(e){this._barrierExecute(this._bootstrapBarrier,()=>this._parseSlotCover(e.segment)),this._barrierExecute(this._templateSpritesBarrier,()=>this._parseSlotSprites(e))}_observeVideoTemplateResource(e){let{resource:t,resourceKey:i,templateResourceKey:r}=e,{resourceStore:n}=this._store;if(!t)return;let a=n.sprites[r],s=n.covers[r],o=n.sprites[i];(!a||!o||!s)&&this._resourceScheduler.parseVideo(t)}_observeVideoResource(e){let t=e.value.key,i=this._store[n.jU].sprites[t],r=this._store[n.jU].covers[t];(!i||!r)&&this._resourceScheduler.parseVideo(e)}_observePhotoResource(e){let t=e.value.key;!this._store[n.jU].covers[t]&&this._resourceScheduler.parsePhoto(e)}_observeAudioResource(e,t){var i;if(null===(i=this._store[n.jU].waves[t])||void 0===i?!void 0:!i.length)this._resourceScheduler.genWaves(e.duration,t)}_parsePreviewDigitalHuman(e,t){if(t===p._g.DigitalHuman)return(0,_.c)(this._dataSdk,this._resourceService,this._draftPathStore.getResourceKeyFromDraftPath.bind(this._draftPathStore),e)}async _observeResource(e,t,i){let r=null!=t?t:(0,v.$Q)(e,this._draftPathStore),n=null!=i?i:(0,v.Q5)(e.id,this._dataSdk);switch(n){case p._g.DigitalHuman:case p._g.Video:case p._g.UserVideo:{let t=r?this._resourceService.get(r,n):void 0;!t&&(t=this._parsePreviewDigitalHuman(e.id,n)),t&&this._observeVideoResource(t);break}case p._g.Gif:{let e=r?this._resourceService.get(r,n):void 0;e&&this._observePhotoResource(e);break}case p._g.Photo:case p._g.UserPhoto:{let e=r?this._resourceService.get(r,n):void 0;e&&this._observePhotoResource(e);break}case p._g.Audio:case p._g.UserAudio:this._observeAudioResource(e,r);break;case p._g.VideoTemplate:{await this._bootstrapBarrier.wait();let{templateId:t}=e;if(t){let i=(0,c.Bc)(t),a=this._resourceService.get(i,n);this._observeVideoTemplateResource({segment:e,resource:a,resourceKey:r,templateResourceKey:i})}}}}constructor(e,t,i,r,n,a,l,d,u,c,h,g,m,p,f){this._dataSdk=e,this._renderManager=t,this._draftPathStore=i,this._store=r,this._screenshotManager=n,this._ensureManager=a,this._resourceErrorManager=l,this._segmentSelection=d,this._draftDataSynchronizer=u,this._resourceService=c,this._environmentService=h,this._mainDraftService=m,this._lifeCycleService=p,this._containerService=f,this._onThumbnailsChange=new s.Q,this._onWavesChange=new s.Q,this._bootstrapBarrier=new o.U,this._templateSpritesBarrier=new o.U,this.getResourceByKey=this._resourceService.get.bind(this),this.onThumbnailsChange=this._onThumbnailsChange.event,this.onWavesChange=this._onWavesChange.event,this._relation=this._containerService.createInstance(D.n,this._draftPathStore),this._resourceScheduler=this._containerService.createInstance(x.w,this._store,this._relation,this._dataSdk,this._segmentSelection,this._draftDataSynchronizer),this._resourceScheduler.onResourceReady(e=>{let{segmentIds:t}=e,i=this._relation.groupMap.get("thumbnails"),r=this._relation.groupMap.get("waves"),n=[],a=[];t.forEach(e=>{(null==i?void 0:i.has(e))&&n.push(e),(null==r?void 0:r.has(e))&&a.push(e)}),n.length>0&&this._onThumbnailsChange.fire({segmentIds:n}),a.length>0&&this._onWavesChange.fire({segmentIds:a})})}}E=(0,r.gn)([(0,r.fM)(9,g.c),(0,r.fM)(10,d.rO),(0,r.fM)(11,b.r),(0,r.fM)(12,u.n),(0,r.fM)(13,C.g),(0,r.fM)(14,m.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof RenderManager?Object:RenderManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof IScreenshotManager?Object:IScreenshotManager,"undefined"==typeof IEnsureManager?Object:IEnsureManager,"undefined"==typeof ResourceErrorManager?Object:ResourceErrorManager,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof IDraftDataSynchronizer?Object:IDraftDataSynchronizer,void 0===g.c?Object:g.c,void 0===d.rO?Object:d.rO,void 0===b.r?Object:b.r,void 0===u.n?Object:u.n,void 0===C.g?Object:C.g,void 0===m.t?Object:m.t])],E)},936800:function(e,t,i){i.d(t,{F:function(){return a},o:function(){return s}});var r,n,a=((r={}).BATCH="BATCH",r.IMMEDIATELY="IMMEDIATELY",r);var s=((n={}).Pending="Pending",n.Ready="Ready",n.Empty="Empty",n.Error="Error",n.Timeout="Timeout",n.Complete="Complete",n)},796281:function(e,t,i){i.d(t,{x:function(){return h},z:function(){return g}});var r,n=i(789786),a=i(722169),s=i(928261),o=i(587892),l=i(690674),d=i(248222),u=i(425427),c=i(108692);var h=((r={}).START="start",r.BEFORE_HANDLE="beforeHandle",r.AFTER_HANDLE="afterHandle",r.END="end",r.ERROR="error",r);class g{get onSegmentCropStart(){return this._onSegmentCropStart.event}get onSegmentBeforeHandleCrop(){return this._onSegmentBeforeHandleCrop.event}get onSegmentCropError(){return this._onSegmentCropError.event}get onSegmentCropEnd(){return this._onSegmentCropEnd.event}get onSegmentAfterHandleCrop(){return this._onSegmentAfterHandleCrop.event}emitCropEvent(e){switch(e){case"start":this._onSegmentCropStart.fire();break;case"beforeHandle":this._onSegmentBeforeHandleCrop.fire();break;case"afterHandle":this._onSegmentAfterHandleCrop.fire();break;case"end":this._onSegmentCropEnd.fire();break;case"error":this._onSegmentCropError.fire()}}setTimelineSegmentLoading(e,t,i,r){this._store[l.U_].setTimelineSegmentLoading(e,t,i,r)}getAllMutablePolyInfo(){if((0,u.JY)(this._videoEnvironmentService)){let e=this._dataSdk.draftView.getDraftId();return this.getMutablePolySegmentInfo(e).flatMap(this._convertToMutableSegmentPolyInfo(e)).filter(Boolean)}return[]}getAllMutableLockedInfo(){if((0,u.JY)(this._videoEnvironmentService)){let e=this._dataSdk.draftView.getDraftId();return this.getMutableLockedSegmentInfo(e).flatMap(this._convertToMutableSegmentLockedInfo(e)).filter(Boolean)}return[]}constructor(e,t,i,r,n){this._store=e,this._dataSdk=t,this._segmentSelection=i,this._mainDraftService=r,this._videoEnvironmentService=n,this._onSegmentCropStart=new o.Q,this._onSegmentBeforeHandleCrop=new o.Q,this._onSegmentAfterHandleCrop=new o.Q,this._onSegmentCropEnd=new o.Q,this._onSegmentCropError=new o.Q,this.getMemoizedMutablePolySegmentInfo=(0,a.memoize)(e=>{let{draftId:t,parentId:i}=e;return this.getMutablePolySegmentInfo(t).flatMap(this._convertToMutableSegmentPolyInfo(t,i)).filter(Boolean)}),this.getMemoizedMutableLockedSegmentInfo=(0,a.memoize)(e=>{let{draftId:t,parentId:i}=e;return this.getMutableLockedSegmentInfo(t).flatMap(this._convertToMutableSegmentLockedInfo(t,i)).filter(Boolean)}),this._getMutablePolySegment=e=>e?e.segments.filter(e=>(0,s.rE)(e.mutable)):[],this._getMutableLockedSegment=e=>e?e.segments.filter(e=>(0,s._n)(e.mutable)):[],this._convertToMutableSegmentPolyInfo=(e,t)=>i=>{var r,n,a,o,l;if(!i||!(0,s.rE)(null==i?void 0:i.mutable))return null;let d=null===(r=this._dataSdk.draftView.getDraftById(e))||void 0===r?void 0:r.getDraftProperty().canvasConfig,u=i.mutable.children.length,{material:c}=i.mutable.children[u-1];return{id:i.id,mutableId:i.mutable.mutableId,type:"mutablePoly",width:null!==(a=null!==(n=null==d?void 0:d.width)&&void 0!==n?n:null==c?void 0:c.width)&&void 0!==a?a:0,height:null!==(l=null!==(o=null==d?void 0:d.height)&&void 0!==o?o:null==c?void 0:c.height)&&void 0!==l?l:0,start:i.start,duration:i.duration,end:i.start+i.duration,draftId:e,parentId:t,children:i.mutable.children}},this._convertToMutableSegmentLockedInfo=(e,t)=>i=>{var r,n,a,o,l;if(!i||!(0,s._n)(null==i?void 0:i.mutable))return null;let d=null===(r=this._dataSdk.draftView.getDraftById(e))||void 0===r?void 0:r.getDraftProperty().canvasConfig,{material:u}=i;return{id:i.id,mutableId:i.id,type:"mutableLocked",width:null!==(a=null!==(n=null==d?void 0:d.width)&&void 0!==n?n:null==u?void 0:u.width)&&void 0!==a?a:0,height:null!==(l=null!==(o=null==d?void 0:d.height)&&void 0!==o?o:null==u?void 0:u.height)&&void 0!==l?l:0,start:i.start,duration:i.duration,end:i.start+i.duration,draftId:e,parentId:t}},this.getMutablePolyTrack=e=>{let t=this._store[l.U_].tracksMutablePoly[e];if(!t){var i,r;let n=this._dataSdk.cutSame.draftIdToMutableVideos[e],a=this._dataSdk.draftView.getDraftById(e);if(!a)return null;let o=a.getDraftDuration(),u=a.getAllTracks();if(!(null==n?void 0:n.length)||!(null==u?void 0:u.length))return null;let c=this._dataSdk.cutSame.getSegmentByDraftId(e),h=(0,d.Z)(n,null!==(r=null==c?void 0:null===(i=c.sourceTimerange)||void 0===i?void 0:i.duration)&&void 0!==r?r:o,this._mainDraftService.subDraftApplySpeedViewManager,c),g=null==h?void 0:h.segments.filter((0,s.be)("mutablePoly"));t={...h,segments:null!=g?g:[]},this._store[l.U_].setTracksMutablePoly(e,t)}return t},this.getMutableLockedTrack=e=>{let t=this._store[l.U_].tracksMutableLocked[e];if(!t){var i,r;let n=this._dataSdk.cutSame.draftIdToMutableVideos[e],a=this._dataSdk.draftView.getDraftById(e);if(!a)return null;let o=a.getDraftDuration(),u=a.getAllTracks();if(!(null==n?void 0:n.length)||!(null==u?void 0:u.length))return null;let c=this._dataSdk.cutSame.getSegmentByDraftId(e),h=(0,d.Z)(n,null!==(r=null==c?void 0:null===(i=c.sourceTimerange)||void 0===i?void 0:i.duration)&&void 0!==r?r:o,this._mainDraftService.subDraftApplySpeedViewManager,c),g=null==h?void 0:h.segments.filter((0,s.be)("mutable")).filter(e=>{var t;return null===(t=e.mutable)||void 0===t?void 0:t.locked});t={...h,segments:null!=g?g:[]},this._store[l.U_].setTracksMutableLocked(e,t)}return t},this.getMutablePolySegmentInfo=(0,a.flow)(this.getMutablePolyTrack,this._getMutablePolySegment),this.getMutableLockedSegmentInfo=(0,a.flow)(this.getMutableLockedTrack,this._getMutableLockedSegment)}}g=(0,n.gn)([(0,n.fM)(3,c.n),(0,n.fM)(4,u.rO),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof SegmentSelection?Object:SegmentSelection,void 0===c.n?Object:c.n,void 0===u.rO?Object:u.rO])],g)},690674:function(e,t,i){i.d(t,{VT:()=>D,qk:()=>E,xI:()=>R,U_:()=>C,jU:()=>x,d5:()=>L,gC:()=>N,Y4:()=>P,Lv:()=>O});var r=i("907031"),n=i("140041"),a=i("260963"),s=i("371140"),o=i("27564"),l=i("426336"),d=i("804497"),u=i("969167"),c=i("858151"),h=i("700933"),g=i("35761"),m=i("28460"),p=i("854146");class f{get markers(){return this._markers}updateData(e){this._markers=e}deleteOne(e){this._markers=this._markers.filter(t=>t!==e)}deleteAll(){this._markers=[]}constructor(e=[]){this._markers=[],(0,a.ky)(this),this._markers=e}}var _=i("700056"),v=i("446352"),M=i("953211");class S{get maxMaterialsCountsForMutableVideo(){let e=0,t=new Set,i=i=>{var r,n,a;if((null===(r=i.mutable)||void 0===r?!void 0:!r.filled)&&(null===(n=i.mutable)||void 0===n?!void 0:!n.locked)&&!!i.visible){if(this.switches.autoReplace&&i.relation_video_group){if(t.has(null!==(a=i.relation_video_group)&&void 0!==a?a:""))return;t.add(i.relation_video_group)}e++}};return this.tracksMutable.forEach(e=>{let[t]=e;if(t.trackType===l.pNd.TrackTypeVideo)t.segments.forEach(e=>{var t,r;(null===(t=e.mutable)||void 0===t?void 0:t.children)?null===(r=e.mutable)||void 0===r||r.children.forEach(e=>i(e)):i(e)})}),e}get relationGroupMap(){return this.mutableVideos.reduce((e,t)=>{var i;let{relationVideoGroup:r,id:n}=t;if(!r)return e;let a=null!==(i=e[r])&&void 0!==i?i:[];return a.push(n),{...e,[r]:a}},{})}get firstUnFilledSegment(){for(let[e]of this.tracksMutable){let t=(0,d.TK)(e.segments);if(t)return t}return null}get currentTimeLineSegment(){var e,t;let i=null!==(t=null===(e=this._segmentSelectionObserveData.subDraftSegment)||void 0===e?void 0:e.targetTimerange.start)&&void 0!==t?t:0n;for(let[e]of this.tracksMutable)if(e.trackType===l.pNd.TrackTypeVideo){let t=(0,d.F6)(e.segments,this.progress,i);if(t)return t}return null}get mutableChildSegments(){return this.tracksMutable.filter(e=>{let[t]=e;return t.trackType===l.pNd.TrackTypeVideo}).map(e=>{let[t]=e;return t.segments}).flat().map(e=>{var t,i;return null!==(i=null===(t=e.mutable)||void 0===t?void 0:t.children)&&void 0!==i?i:[]}).flat().reduce((e,t)=>(e.set(t.id,t),e),new Map)}get mutableRelationsMap(){return this.tracksMutable.filter(e=>{let[t]=e;return t.trackType===l.pNd.TrackTypeVideo}).map(e=>{let[t]=e;return t.segments}).flat().filter(e=>"mutablePoly"===e.type).map(e=>{var t,i;return{children:null!==(i=null===(t=e.mutable)||void 0===t?void 0:t.children)&&void 0!==i?i:[],polyId:e.id}}).reduce((e,t)=>{let{polyId:i,children:r}=t;return r.forEach(t=>e.set(t.id,i)),e},new Map)}get firstUnFilledMusicSegment(){return this.tracksMutable.filter(e=>{let[t]=e;return t.trackType===l.pNd.TrackTypeAudio}).map(e=>{let[t]=e;return t.segments}).flat().find(e=>!e.path&&!e.title)}get mutableAudioSegments(){return this.tracksMutable.filter(e=>{let[t]=e;return t.trackType===l.pNd.TrackTypeAudio}).map(e=>{let[t]=e;return t.segments}).flat().filter(e=>e.metaType!==l.cVg.MetaTypeNone)}get mutableVideos(){return this._segmentSelectionObserveData.mutableVideos}get mutableAudios(){return this._segmentSelectionObserveData.mutableAudios}get mutableTexts(){return this._segmentSelectionObserveData.mutableTexts}get isAllSlotFilled(){let e=this.mutableVideos.length,t=!1;return e&&(t=this.mutableVideos.every(e=>e.filled)),t}get flattedSegments(){return(0,M.b)(this.tracksMutable)}get isEmptyTracks(){var e,t,i,r;return(null===(e=this.tracks)||void 0===e?void 0:e.length)===1&&(null===(r=this.tracks)||void 0===r?void 0:null===(i=r[0])||void 0===i?void 0:null===(t=i[0].segments)||void 0===t?void 0:t.length)===0}get canPaste(){return!!this.pasteInfo.length}get computedTracksUpper(){return this.tracks.slice(1).filter(e=>{let[t]=e;return v._3.has(t.type)}).reverse()}get computedTracksMain(){return this.tracks.slice(0,1)}get computedTracksUnder(){return this.tracks.slice(1).filter(e=>{let[t]=e;return v.zT.has(t.type)})}get ifTracksEmpty(){return 0===this.tracks.length||1===this.tracks.length&&"none"===this.tracks[0][0].type}get allSegments(){return this.tracks.map(e=>{let[t]=e;return t.segments}).flat()}get hasVideoSegment(){return this.allSegments.find(e=>"video"===e.type||"combination"===e.type)}get canZoom(){return this.isMultiTrack||this.isTemplatePost?(this.tracks.length>1||1===this.tracks.length&&0!==this.tracks[0][0].segments.length)&&this.zoomStore.enableZoom:this.tracksMutable.length>=1&&this.zoomStore.enableZoom}get isTemplate(){return this.mode===r.KN.CUT_SAME}get isMultiTrack(){return this.mode===r.KN.MULTI_TRACK}get isTemplatePost(){return this.mode===r.KN.TEMPLATE_POST}get isTimelineScrolling(){return this.isTimelineHScrolling||this.isTimelineVScrolling}get absorbStatus(){return this.switches.adsorb?"on":"off"}get quickImportSegments(){return(0,u.w1)(this.tracks)}get quickImportSegmentsSub(){let e=this.tracks.slice(1).filter(Boolean);return(0,u.w1)(e)}get currentSeekTime(){return this.timelinePreviewLineStatus===s.$o.ENABLE&&void 0!==this.timelinePreviewLineSeekTime?this.timelinePreviewLineSeekTime:this.progress}setIsNewEmpty(e){this.isNewEmpty=e}setTracksMutable(e){this.tracksMutable=e}setTracksMutablePoly(e,t){this.tracksMutablePoly[e]=t}setTracksMutableLocked(e,t){this.tracksMutableLocked[e]=t}setTrackStartTime(e){this.trackStartTime=e}setTrackEndTime(e){this.trackEndTime=e}setPreviewLineStatus(e){this.timelinePreviewLineStatus=e}setPreviewMutableSlotStatus(e){this.timelinePreviewMutableSlotStatus=e}setPreviewLineFrozen(e){this.timelinePreviewLineFrozen=e}setCursorFrozen(e){this.timelineCursorFrozen=e}setPreviewLineSeekTime(e){this.timelinePreviewLineSeekTime=e}setTimelineDecoupling(e){for(let[t,i]of Object.entries(e))this.decoupling[t]!==i&&(this.decoupling[t]=i)}setIsBatchReplacing(e){this.isBatchReplacing=e}setTimelineProgress(e){e&&!this.progressChanged&&(this.progressChanged=!0),this.progress=e}setTimelineMode(e){this.mode=e}setTimelineDuration(e){this.duration=e}setViewportStart(e){this.viewportStart!==e&&(this.viewportStart=e)}setTimelinePanelMode(e){e===o.v.NORMAL?this.isBatchReplacePanelVisible=!1:this.isBatchReplacePanelVisible=!0}setIsTimelineScrolling(e){void 0!==e.horizontal&&(this.isTimelineHScrolling=e.horizontal),void 0!==e.vertical&&(this.isTimelineVScrolling=e.vertical)}setDidCursorPause(e){this.didCursorPause=e}setTracks(e){this.tracks=e}setSegments(e,t){for(let[t,i]of this.tracks)for(let i=0;i<t.segments.length;i++)if(t.segments[i].id===e.id){t.segments[i]=e;return}}setFirstSegmentRender(e){this.firstSegmentRenderEnd=e}setRelationGroupColorMap(e){this.relationGroupColorMap=e}setActiveRelationGroup(e,t){this.activeRelationGroup=e,this.relationGroupActiveType=t}setIsDragging(e){this.isDragging=e}setIsManualResizing(e){this.isManualResizing=e}setIsCroping(e){this.isCroping=e}setStashBeforeCrop(e){this.stashBeforeCrop={...this.stashBeforeCrop,...e}}setDecoupling(e){for(let[t,i]of Object.entries(e))this.decoupling[t]!==i&&(this.decoupling[t]=i)}segmentCrop(e,t){let i=(0,c.Lo)(this.tracks,e);if(-1!==i)0===i?(0,c.MZ)(this.tracks[i][0].segments,e,t):(0,c.hZ)(this.tracks[i][0].segments,e,t)}segmentTransitionCrop(e,t){let i=(0,d.kt)(this.tracks,e);if(!i)return;let r=i.slots.find(e=>"transition"===e.type);if(!!r)r.duration=t.value,(0,c.WB)(this.tracks[0][0].segments)}addSegmentTransition(e,t){let i=(0,d.kt)(this.tracks,{id:e});if(!(!i||i.slots.some(e=>"transition"===e.type)))i.slots.push(t),(0,c.WB)(this.tracks[0][0].segments)}removeSegmentTransition(e){for(let[t]of this.tracks)for(let i of t.segments)for(let t of i.slots)if(t.id===e)return(0,c.EK)(this.tracks,[],[t]),t;return null}timelineSegmentAdd(e,t){let{start:i}=t,r={...e,start:i};(0,c.pu)(this.tracks,r,t)}timelineTrackAdd(e){(0,c.gG)(this.tracks,l.pNd.TrackTypeNone,{trackIndex:e,start:0n})}removeTrackAppropriate(){(0,c.Oh)(this.tracks),!this.tracks.length&&this.tracks.push((0,h.BM)())}timelineSegmentRemove(e){for(let[t]of this.tracks)for(let i of t.segments)if(i.id===e)return(0,c.EK)(this.tracks,[i],[]),this.removeTrackAppropriate(),i;return null}setAutoReplaceDisplay(e){this.autoReplaceDisplay=e}setPasteInfo(e){this.pasteInfo=e}setResizeInfo(e){this.resizeInfo=e}cacheTracks(){this.pasteCacheTracks=(0,_.Z)(this.tracks.map(e=>{let[t]=e;return t}))}setIsSegWidgetDragging(e){this.isSegWidgetDragging=e}setTimelineIsCollapse(e){this.isCollapseTimeline=e}setMainTrackMuted(e){this.mainTrackMuted=e}setSubTrackMutedMap(e){this.subTrackIdToMuted=e}setMainEditorWidgetContainerDom(e){this.mainEditorWidgetContainerDom=e}setOperationWidth(e){this.operationWidth=e}setOperationWidthInner(e){this.operationWidthInner=e}setSwitches(e){this.switches={...this.switches,...e}}setAudioTimelinePanelVisible(e){this.audioTimelinePanelVisible=e}setTimelineSegmentLoading(e,t,i,r){if(this.loadingSegments={...this.loadingSegments,[e]:t},t&&r){var n,a,s;this.loadingTimestampSegments.set(i,{segmentId:e,loadingText:r});let t=-1/0;for(let i of this.loadingTimestampSegments.keys())(null===(n=this.loadingTimestampSegments.get(i))||void 0===n?void 0:n.segmentId)===e&&i>t&&(t=i);t===-1/0?this.loadingTextSegments[e]=r:this.loadingTextSegments[e]=null!==(s=null===(a=this.loadingTimestampSegments.get(t))||void 0===a?void 0:a.loadingText)&&void 0!==s?s:r}else!t&&(i&&this.loadingTimestampSegments.delete(i),this.loadingTextSegments[e]=void 0)}setExportReady(){this.exportReady=!0}constructor(e){var t;this.visual={},this.timelinePreviewLineFrozen=!1,this.timelineCursorFrozen=!1,this.timelinePreviewLineSeekTime=0n,this.timelinePreviewLineStatus=s.$o.DISABLE,this.timelinePreviewMutableSlotStatus=s.$o.DISABLE,this.isTimelineHScrolling=!1,this.isTimelineVScrolling=!1,this.isCollapseTimeline=!1,this.autoReplaceDisplay=void 0,this.mainTrackMuted=!1,this.subTrackIdToMuted=new Map,this.progress=0n,this.progressChanged=!1,this.duration=0n,this.loading=!0,this.edgeWidth=n.lJ,this.viewportStart=BigInt(0),this.exportReady=!1,this.decoupling={progress:!1},this.switches={adsorb:!1,previewLine:!0,autoReplace:!1},this.switch=void 0,this.relationGroupColorMap={},this.activeRelationGroup=void 0,this.relationGroupActiveType=void 0,this.isBatchReplacePanelVisible=!1,this.isBatchReplacing=!1,this.resizeInfo={isResizing:!1,worldHeight:0,contentHeight:0,containerHeight:0},this.didCursorPause=!0,this.operationWidth=0,this.operationWidthInner=0,this.mutableTrimVisible=!1,this.mutableCropVisible=!1,this.loadingSegments={},this.loadingTextSegments={},this.loadingTimestampSegments=new Map,this.isCroping=!1,this.isSegmentCropping=!1,this.isDragging=!1,this.isManualResizing=!1,this.isSegWidgetDragging=!1,this.stashBeforeCrop={},this.tracks=[],this.waitEditorAvailable=!1,this.ttsSegmentCropMoveMultiSegment=!window.location.href.includes("ttsSegmentCropMoveMultiSegment=0"),this.canSplit=!1,this.splitTarget=void 0,this.pasteInfo=[],this.pasteCacheTracks=[],this.isResetMutableConfirm=!1,this.firstSegmentRenderEnd=!1,this.isBeatDetecting=!1,this.aiBeatDropdownVisible=!1,this.aiBeatGuideVisible=!1,this.tracksMutable=[],this.tracksMutablePoly={},this.tracksMutableLocked={},this.trackStartTime=0n,this.trackEndTime=0n,this.shortCutDisabledKey="",this.mainEditorWidgetContainerDom=null,this.audioTimelinePanelVisible=void 0,this.setTimelineVisual=e=>{this.visual=e},this.setTimelineLoading=e=>{if("undefined"!=typeof window&&window.location.search.includes("__ssr_pending__")){this.loading=!0;return}e?this.loading=e:setTimeout(()=>{this.loading=!!e},0)};let{mode:i,intelligentStore:o,switch:l,visual:d,segmentSelectionObserveData:u,checkListManagerObserveData:c,isNewEmpty:h,defaultMode:_}=e;this.intelligentStore=o,this._segmentSelectionObserveData=u,this.checkListManagerObserveData=c,this.switch=l,this.visual=d,this.mode=i,this.operationWidth=i===r.KN.CUT_SAME?r.pz:r.w0,this.zoomStore=new g.$,this.keyframeStore=new m.q,this.trackCoverStore=new p.k,this.axisMarkerStore=new f,this.isNewEmpty=h,this.isBatchReplacePanelVisible=null!==(t=_.showBatchPanel)&&void 0!==t&&t,(0,a.ky)(this)}}var y=i("332097"),T=i("602115"),b=i("59388"),I=i("416762"),w=i("539896");class k{get snapshotComputedTracksUpper(){return this.snapshotTracks.slice(1).filter(e=>{let[t]=e;return v._3.has(t.type)}).reverse()}get snapshotComputedTracksMain(){return this.snapshotTracks.slice(0,1)}get snapshotComputedTracksUnder(){return this.snapshotTracks.slice(1).filter(e=>{let[t]=e;return v.zT.has(t.type)})}setSnapshotTrack(e){this.snapshotTracks=e}constructor(){this.snapshotTracks=[],(0,a.ky)(this)}}var A=i("105304");let C="timelineStore",D="timelinePlayerStore",x="resourceStore",P="templatePostStore",E="timelineSelectionStore",N="timelineMutableStatusStore",R="timelineSnapshotStore",L="timelineInteractStore",j=e=>({visual:{},switch:{videoCrop:!0,boxSelection:e!==r.KN.CUT_SAME,inspectPlaceholder:e!==r.KN.CUT_SAME,unselectOnInnovate:e!==r.KN.CUT_SAME,move:e!==r.KN.CUT_SAME},defaultMode:{showBatchPanel:e===r.KN.CUT_SAME}});function O(e,t,i,r,n){let a=new S({mode:e,intelligentStore:t,...j(e),segmentSelectionObserveData:i,checkListManagerObserveData:r,isNewEmpty:n}),s=new A.z$,o=new T.F,l=new y.L,d=new b.o,u=new I.j(a,i),c=new w.r;return{[C]:a,[D]:o,[x]:l,[P]:d,[E]:u,[N]:c,[R]:new k,[L]:s}}},539896:function(e,t,i){i.d(t,{r:function(){return n}});var r=i(260963);class n{setMutableStatusInfo(e,t){this.mutableIdToStatusInfo[e]=t}updateMutableStatus(e,t){this.mutableIdToStatusInfo[e]={...this.mutableIdToStatusInfo[e],status:t}}updateMutableCancelable(e,t){this.mutableIdToStatusInfo[e]&&(this.mutableIdToStatusInfo[e].cancelable=t)}constructor(){this.mutableIdToStatusInfo={},(0,r.ky)(this)}}},693511:function(e,t,i){i.d(t,{j:()=>eV,$:()=>eU});var r=i("789786"),n=i("772322");i("218571");var a=i("670933"),s=i("377125"),o=i("937802"),l=i("141913");class d{get freeze(){return this._freeze}setFreeze(e){this._freeze=e}render(){return(0,n.jsx)(a.zt,{store:this._store,contribution:this._contribution,modules:this._modules,children:(0,n.jsx)(o.$,{instantiationService:this._containerService,children:(0,n.jsx)(l.SV,{fallback:(0,n.jsx)("div",{}),children:(0,n.jsx)(s.ZP,{})})})})}constructor(e,t,i,r){this._store=e,this._contribution=t,this._modules=i,this._containerService=r,this._freeze=!0,this.height=234}}var u=i("469859"),c=i("907031"),h=i("425427"),g=i("314181"),m=i("782153"),p=i("896413"),f=i("560941"),_=i("690674"),v=i("452210"),M=i("34051"),S=i("840441"),y=i("402725"),T=i("252205"),b=i("629750"),I=i("402548"),w=i("625852"),k=i("22929"),A=i("213099"),C=i("521369"),D=i("371140"),x=i("319657"),P=i("929105"),E=i("587892");let N="TIMELINE_AUTO_REPLACE";class R{ask(e){var t,i;let{isBatchReplacePanelVisible:r}=this._store[_.U_],{isEditingTemplate:n}=this._store[_.qk],a=(0,x.O)().ask(N),s=(null===(i=this._store[_.U_].mutableChildSegments)||void 0===i?void 0:null===(t=i.has)||void 0===t?void 0:t.call(i,e))?D.AR.child:D.AR.poly;return r?s=D.AR.flat:!n&&(s=D.AR.element),this._store[_.U_].setAutoReplaceDisplay(s),this._onAsk.fire(s),a}reply(e){this._store[_.U_].setAutoReplaceDisplay(void 0),(0,x.O)().reply(N,e),this._onReply.fire(e)}expand(e,t,i){return"mutable"===t?this._expandVideo(e,i):Promise.resolve(this._expandAudio(e))}checkReplace(e,t){let i=this._dataSdk.cutSame.segmentId2initialSpeed[e.segmentId],r=this._dataSdk.draftView.getSegmentById(e.segmentId),{tracksMutable:n,firstUnFilledMusicSegment:a}=this._store[_.U_],{segmentSelected:s,selectedMutableAudioSegment:o,expandedSegmentId:l}=this._store[_.qk];return(0,P.T)({slot:e,resource:t,initialSpeed:i,segment:r,selectedMutableAudioSegment:o,firstUnFilledMusicSegment:a,segmentSelected:s,tracksMutable:n,expandedSegmentId:l})}check(e,t){return!this.checkReplace(e,t).errmsg}setActiveRelationGroup(e,t){this._store[_.U_].setActiveRelationGroup(e,t)}get onAsk(){return this._onAsk.event}get onReply(){return this._onReply.event}_expandAudio(e){var t;let{draftIdToMutableAudios:i}=this._dataSdk.cutSame,r=(null!==(t=i[this._dataSdk.draftView.getDraftId()])&&void 0!==t?t:[]).find(t=>t.id===e);return r?[r]:[]}async _expandVideo(e,t){var i,r;let{autoReplace:n}=this._store[_.U_].switches,{draftIdToRelationVideoGroup:a,draftIdToMutableVideos:s}=this._dataSdk.cutSame,{subDraftId:o}=this._store[_.qk],l=null!=o?o:this._dataSdk.draftView.getDraftId(),d=a[l],u=null!==(i=s[l])&&void 0!==i?i:[],c=u.find(t=>t.id===e);if(!c)return[];let h=n,g=null!==(r=d.get(null==c?void 0:c.relationVideoGroup))&&void 0!==r?r:new Set,m=u.filter(e=>g.has(e.id)&&e.id!==c.id),p=[c,...m];return h&&!(p.every(e=>e.filled)||p.every(e=>!e.filled))?p.some(e=>!this.check(e,t))?h=!1:(this._selection.updateSelectData({segmentIds:[c.segmentId]}),h=await this.ask(c.segmentId)):p.some(e=>!this.check(e,t))&&(h=!1),h?p:[c]}constructor(e,t,i){this._store=e,this._dataSdk=t,this._selection=i,this._onAsk=new E.Q,this._onReply=new E.Q}}var L=i("843480"),j=i("271846"),O=i("545291"),B=i("649943"),z=i("477790"),U=i("298170"),V=i("791727"),Z=i("804497"),F=i("72127");class G{get isTimelineScrolling(){return this._isTimelineScrolling}scrollToSegment(e){var t;let{tracksMutable:i}=this._store[_.U_],r=(0,Z.l4)(i,e),{segment:n={id:e},isChild:a=!1}=null!=r?r:{},[s,o]=(0,F.XA)(n.id,this._coordinate,a);if(!s||!o)(0,F.Ud)(null!==(t=n.id)&&void 0!==t?t:e,this._coordinate,[s,o])}scrollToTimestamp(e){let{value:t}=this._store[_.U_].zoomStore;!(0,F.uD)(e,t)&&(0,F.xC)(e,t)}updateIsTimelineScrolling(e){this._isTimelineScrolling=e,this._onIsTimelineScrollingChange.fire(e)}constructor(e,t){this._store=e,this._coordinate=t,this._onIsTimelineScrollingChange=new E.Q,this._isTimelineScrolling=!1,this.onIsTimelineScrollingChange=this._onIsTimelineScrollingChange.event}}var W=i("460254"),Y=i("586703"),H=i("928261"),Q=i("426336"),K=i("771255"),J=i("609962"),X=i("955171"),$=i("29188"),q=i("199811"),ee=i("801497"),et=i("591010"),ei=i("989719"),er=i("105304");let en={video:Q.Ocy.SegmentVideo,mutable:Q.Ocy.SegmentVideo,effect:Q.Ocy.SegmentVideoEffect,audio:Q.Ocy.SegmentAudio,mutableAudio:Q.Ocy.SegmentAudio,filter:Q.Ocy.SegmentFilter,text:Q.Ocy.SegmentText,textTemplate:Q.Ocy.SegmentTextTemplate,sticker:Q.Ocy.SegmentSticker,imageSticker:Q.Ocy.SegmentImageSticker,pictureAdjust:Q.Ocy.SegmentPictureAdjust,tailLeader:Q.Ocy.SegmentTailLeader,videoEffect:Q.Ocy.SegmentVideoEffect,mutablePoly:Q.Ocy.SegmentVideo,combination:Q.Ocy.SegmentVideo,transition:Q.Ocy.SegmentVideo,dragVideoPlaceholder:Q.Ocy.SegmentVideo,dragAudioPlaceholder:Q.Ocy.SegmentAudio,handwrite:Q.Ocy.SegmentHandwrite,adjust:Q.Ocy.SegmentPictureAdjust};function ea(e){let t=0;return e.forEach(e=>{let[i]=e;"video"===i.type&&++t}),t>=$.m}class es{getSegmentInfo(e){let{tracks:t,tracksMutable:i}=this._store[_.U_],{isEditingTemplate:r}=this._store[_.qk],n=(r?(0,Z.ed)(i,[e]):(0,Z.kQ)(t,[e]))[0];return this._isUITimelineSegment(n)?{type:en[n.type],start:n.start,duration:n.duration}:void 0}beforeAddSegment(e,t,i){this._interactManager.setDisableInteract([er.Vf.ALL]);let r=(0,X.Z)(e.type,e.value);if(this._timelineUI.zoom.adjustAppropriate(r),this._store[_.U_].isTemplate)return"";let n=this._transientDataManager.addPlaceholderSegment(e.value,t,e.type);return this._transientDataManager.bindIdRelation(i,n),n}beforeAddTransition(e,t,i,r){this._interactManager.setDisableInteract([er.Vf.ALL]);let n=this._dataSdk.draftView.getSegmentById(i),a="";return n&&(0,Q.hey)(n)&&!n.transition&&(a=this._transientDataManager.addPlaceholderTransition(e,t,i),this._transientDataManager.bindIdRelation(r,a)),a}afterAddSegment(e,t){t&&this._transientDataManager.removePlaceholderSegment(t,!e),this._interactManager.clearDisableInteract(),e&&(this._player.timelineSeekAfterAdd(e),this._selection.updateSelectData({segmentIds:[e]},et.U.AddSegment),this._timelineEvent.segmentSeekAfterAdd({segmentId:e}))}afterAddTransition(e,t){if(e&&this._transientDataManager.removePlaceholderTransition(e),this._interactManager.clearDisableInteract(),t){var i;let[e]=(0,Z.kQ)(this._store[_.U_].tracks,[t]);if((0,H.IM)(e)&&(0,H.Xe)(e.slots[0])){let{duration:t}=e.slots[0],i=e.start+e.duration-Q.pMA.div(t,2,"bigint");this._player.rangePlay(i,i+t,!0)}let r=this._dataSdk.draftView.getSegmentById(t);r&&(0,Q.hey)(r)&&(null===(i=r.transition)||void 0===i?void 0:i.id)&&this._selection.updateSelectData({transitionIds:[r.transition.id]})}}beforeReplaceMutable(e,t){Object.keys(e).forEach(e=>{this._store[_.jU].setMutableUploadMaterial(e,{status:K.g.UPLOADING})});let{expandedSegmentId:i}=this._store[_.qk],[r,n]=Object.entries(e)[0],a=!!(!t||i),{autoSeek:s,showGuide:o}=this._getShouldSeekToNextAfterShowTip(r,n);a&&(a=s),this._canAutoSeekOnMutableReplaced=a,this._showGuideAfterReplace=o}trySeekAndScrollToNextMutableVideo(e){if(!this._canAutoSeekOnMutableReplaced)return;let{mutableVideos:t}=this._store[_.U_],i=(0,Y.Hf)(t,e[0],e);i&&(this._selection.updateSelectData({segmentIds:[i.segmentId]}),this._player.timelineSeekAndScrollToMutable(i.segmentId))}afterReplaceMutable(e){this._interactManager.clearDisableInteract(),e.forEach(e=>{!e.error&&this._store[_.jU].setMutableUploadMaterial(e.mutableId,{status:K.g.SUCCESS})});let t=e.some(e=>{let{type:t}=e;return t===W.r.Audio||t===W.r.UserAudio}),i=e.every(e=>{let{error:t}=e;return!t});t&&i&&this._store[_.U_].mutableAudioSegments.length>0&&this._timelineUI.toast.success(ee.ZP.t("web_musicreplace_text_replace_successfully",{},"Music replaced")),this._showGuideAfterReplace(),this._showGuideAfterReplace=ei.Z}replaceSegmentError(e){var t;let{mutableId:i}=e,r=this._store[_.gC].mutableIdToStatusInfo[i];this._store[_.gC].setMutableStatusInfo(i,{status:J.a.IDLE,cancelable:null!==(t=null==r?void 0:r.cancelable)&&void 0!==t&&t})}addPlaceholderTrackToTop(e,t){let{tracks:i,computedTracksUpper:r}=this._store[_.U_],n=ea(r),a=[];if(this._transientDataManager.batchStart(),n)this._transientDataManager.takeoutTracksFromTracks([i[0][0].id]),a.push({trackIndex:0,trackType:"dragVideoPlaceholder"});else{if(e>0){let e;let t=i.findIndex(e=>{let[t]=e;return t.type===Q.pNd.TrackTypeAudio});e=-1===t?i.length:t,a.push({trackIndex:e,trackType:"dragVideoPlaceholder"})}if(t>0){let t;let r=i.findLastIndex(e=>{let[t]=e;return t.type===Q.pNd.TrackTypeAudio});t=-1===r?e>0?i.length+1:i.length:e>0?r+1:r,a.push({trackIndex:t,trackType:"dragAudioPlaceholder"})}}let s=this._transientDataManager.addPlaceholderTracks(a);return this._transientDataManager.batchEnd(),s}addVideoPlaceholderTrackWithIndex(e){let{tracks:t,computedTracksUpper:i}=this._store[_.U_];if(!ea(i))return this._transientDataManager.addPlaceholderTracks([{trackIndex:e,trackType:"dragVideoPlaceholder"}]);{this._transientDataManager.batchStart(),this._transientDataManager.takeoutTracksFromTracks([t[0][0].id]);let e=this._transientDataManager.addPlaceholderTracks([{trackIndex:0,trackType:"dragVideoPlaceholder"}]);return this._transientDataManager.batchEnd(),e}}removePlaceholderTrack(e){this._transientDataManager.resumeTracksToTracks(!1),this._transientDataManager.removePlaceholderTracks(e)}removeEmptyTrack(){this._store[_.U_].removeTrackAppropriate()}getClipTypeAndDuration(e,t){let{tracksMutable:i}=this._store[_.U_];return(0,q.N)(e,t,i)}_isUITimelineSegment(e){return(0,H.IM)(e)||e&&"mutableAudio"===e.type}_isSegmentPloyLastChild(e){var t;let i=this._findMainSlotByMutableId(e);if(!(null==i?void 0:null===(t=i.mutable)||void 0===t?void 0:t.children))return!1;let{children:r}=i.mutable;return r[r.length-1].mutable.mutableId===e}_findMainSlotByMutableId(e){if(!e)return;let{tracksMutable:t}=this._store[_.U_];for(let a=0;a<t.length;a++){let[s]=t[a],{segments:o=[]}=s;for(let t=0;t<o.length;t++){var i,r,n;let a=o[t];if(null===(i=a.mutable)||void 0===i?void 0:i.children){let{children:t}=a.mutable;for(let i=0;i<t.length;i++){let r=t[i];if((null==r?void 0:null===(n=r.mutable)||void 0===n?void 0:n.mutableId)===e)return a}}else if((null===(r=a.mutable)||void 0===r?void 0:r.mutableId)===e)return a}}}_getShouldSeekToNextAfterShowTip(e,t){var i;let{isTemplate:r}=this._store[_.U_];if(!e||!r)return{autoSeek:!0,showGuide:ei.Z};let n=this._findMainSlotByMutableId(e);if(!n)return{autoSeek:!0,showGuide:ei.Z};let{ifShowTips:a,showGuide:s}=this._timelineUI.guide.showAddMaterialToTemplateTips({segmentId:n.id,mutableId:e,info:t},!!(null==n?void 0:null===(i=n.mutable)||void 0===i?void 0:i.children)),o=this._isSegmentPloyLastChild(e);return{autoSeek:!(a&&o),showGuide:s}}constructor(e,t,i,r,n,a,s,o){this._store=e,this._timelineEvent=t,this._player=i,this._selection=r,this._timelineUI=n,this._interactManager=a,this._transientDataManager=s,this._dataSdk=o,this._canAutoSeekOnMutableReplaced=!1,this._showGuideAfterReplace=ei.Z}}var eo=i("362283"),el=i("678310"),ed=i("41770"),eu=i("146220"),ec=i("260963"),eh=i("230689"),eg=i("850649"),em=i("134392");i("561098");var ep=i("800788");class ef{get cmdKeyHadDown(){return this._shortcutService.cmdKeyHadDown}setShortcutKeyBindContainer(e){if(void 0!==e)this._timelineContainerDom=e}getShortcutVisual(e){return this._shortcurVisualMap.get(e)}setEnable(e){this._enableShortcut=e}constructor(e,t,i){this._shortcutService=i,this._enableShortcut=!0,this._timelineContainerDom=null,this._shortcurVisualMap=new Map,this.register=(e,t)=>{(0,ep.Y2)(this._timelineContainerDom);let i=t;!i&&(i=this._timelineContainerDom);let r=eg.Yq[e.key],n=this._shortcutService.getOrCreateContext(i),{when:a}=e,s={...e,keyBindings:r.keyBindings,when:e=>!!this._enableShortcut&&(e.preventDefault(),!a||a(e))};n.register(s);let{visual:o}=r;return o&&this._shortcurVisualMap.set(e.key,o),()=>{n.unregister(s)}},e.onDidLayoutUpdate(e=>{t[_.U_].setMainEditorWidgetContainerDom(e)})}}ef=(0,r.gn)([(0,r.fM)(2,em.d),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof LayoutManager?Object:LayoutManager,"undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,void 0===em.d?Object:em.d])],ef);var e_=i("376117"),ev=i("156145"),eM=i("183609"),eS=i("77042"),ey=i("641276"),eT=i("49299"),eb=i("153197");function eI(e,t){let{segmentResultMap:i={},draftMaterials:r=[]}=t;return!!e.some(e=>{if((0,Q.E6P)(e)){if(!Object.keys(i).find(t=>t.startsWith(e.id)&&0===i[t]))return!0}else if(0!==i[e.id])return!0;let t=(null==e?void 0:e.material)&&"path"in(null==e?void 0:e.material)&&(0,eT.LL)(e.material.path),n=r.find(t=>{var i;return(null==e?void 0:e.material)&&"path"in(null==e?void 0:e.material)&&(null==e?void 0:null===(i=e.material)||void 0===i?void 0:i.path.includes(t.key))});return!!(n&&(0,eb.iK)(n.status))||!!t&&!n||!1})||!1}class ew{_updatePartialExportError(){let e=this._getPartialExportError();this._store[_.qk].setPartialExportError(e)}_getPartialExportError(){let e="",t="";if(!this._store[_.qk].selectedSegmentIds||0===this._store[_.qk].selectedSegmentIds.length)return{selectedErr:e,selectedRangeErr:t};let{userGeneratedMaterials:i,autoGeneratedMaterials:r}=this._draftMaterialsService.getMaterials(),n=[...i,...r],a=this._segmentSelection.observeData.tracks.map(e=>e.segments.filter(e=>this._store[_.qk].selectedSegmentIds.includes(e.id))).flat(),s=a.some(Q.ot2),o=this._segmentSelection.observeData.tracks.map(e=>e.segments.filter(e=>this._store[_.qk].timeRangeSegmentIds.includes(e.id))).flat();return eI(a,{segmentResultMap:this._segmentResultMap,draftMaterials:n})?(e=ee.oc.t("web_export_text_missing",{},"The selected data is lost"),{selectedErr:e,selectedRangeErr:t=ee.oc.t("web_export_text_missing_part",{},"Material within the time interval is lost")}):(eI(o,{segmentResultMap:this._segmentResultMap,draftMaterials:n})&&(t=ee.oc.t("web_export_text_missing_part",{},"Material within the time interval is lost")),s&&(e=ee.oc.t("web_edit_text_use_after_rendering",void 0,"Available once AI character applied")),{selectedErr:e,selectedRangeErr:t})}getObservablePartialExportInfo(){let{segmentSelectedTimeRange:e,timeRangeSegmentIds:t,partialExportError:i}=this._store[_.qk],{exportReady:r}=this._store[_.U_];return{partialExportError:i,segmentSelectedTimeRange:e,timeRangeSegmentIds:t,exportReady:r}}triggerPartialExport(e){this._exportService.setPartialExportInfo(e),this._exportService.setPartialExportModalVisible(!0)}constructor(e,t,i,r,n,a){this._mainEditorWidgetService=e,this._draftMaterialsService=t,this._exportService=i,this._store=r,this._segmentSelection=n,this._selection=a,this._segmentResultMap={},(0,ey.V)(this._mainEditorWidgetService.onEventually)(()=>{this._mainEditorWidgetService.renderManager.onAddClip(e=>{let{clipId:t,result:i}=e;this._segmentResultMap[t]=i,this._updatePartialExportError()})}),this._draftMaterialsService.onDidReady(()=>{this._updatePartialExportError()}),this._draftMaterialsService.onDidMaterialAdd(()=>{this._updatePartialExportError()}),this._draftMaterialsService.onDidMaterialRemove(()=>{this._updatePartialExportError()}),this._draftMaterialsService.onDidMaterialReplace(()=>{this._updatePartialExportError()}),this._draftMaterialsService.onMaterialAllDoneChange(()=>{this._updatePartialExportError()}),this._selection.onSelection(()=>{this._updatePartialExportError()}),this._exportService.getExportReady()?this._store[_.U_].setExportReady():(0,ey.V)(this._exportService.onExportReady)(()=>{this._store[_.U_].setExportReady()})}}var ek=i("948328"),eA=i("160391"),eC=i("91474"),eD=i("996708"),ex=i("461566"),eP=i("584715"),eE=i("796281"),eN=i("276374");class eR{get freeze(){return this._freeze}setFreeze(e){this._store.setCursorFrozen(e),this._freeze=e}get progress(){return this._store.progress}constructor(e){this._store=e,this._freeze=!1}}var eL=i("241014"),ej=i("36982"),eO=i("169845"),eB=i("574063"),ez=i("691269");window.__mobx_toJS__=ec.ZN;let eU=!0;class eV{get event(){return this._timelineEvent}get resource(){return(0,ep.Y2)(this._resource,"you should not call resource in current moment."),this._resource}get coverManager(){return this._coverManager}get axisMarkerManager(){return this._axisMarkerManager}get tracksManager(){return this._trackManager}get batchReplaceManager(){return(0,ep.Y2)(this._batchReplaceManager,"you should not call batchReplaceManager in current moment."),this._batchReplaceManager}get segmentManager(){return this._segmentManager}get freezeManager(){return this._freezeManager}get partialExportManager(){return this._partialExportManager}get timelineUI(){return(0,ep.Y2)(this._timelineToast&&this._timelineZoom&&this._timelinePanel&&this._timelineGuide&&this._timelineScroller&&this._timelinePreviewLine&&this._cursor,"you should not call timelineUI in current moment."),{toast:this._timelineToast,zoom:this._timelineZoom,panel:this._timelinePanel,guide:this._timelineGuide,scroller:this._timelineScroller,previewLine:this._timelinePreviewLine,cursor:this._cursor,setTimelineLoading:e=>{this._store[_.U_].setTimelineLoading(e)},isDragging:this._coordinate.context.store.isDragging}}get autoReplace(){return(0,ep.Y2)(this._autoReplace,"you should not call autoReplace in current moment."),this._autoReplace}get freeze(){return this._freeze}get audioRecorderManager(){return this._audioRecorderManager}get timelineInteract(){return this._timelineInteract}get fileDrop(){return this._fileDrop}get draftOperation(){return this._draftOperation}get templatePost(){return this._templatePost}get templateInfoManager(){return this._templateInfoManager}get hasCombinationSegment(){return!!this._dataSdk.draftView.getAllTracks().find(e=>e.segments.find(e=>(0,Q.duj)(e)))}get tracks(){return this._dataSdk.draftView.getAllTracks()}get allSegments(){return this._dataSdk.draftView.getAllSegments()}get duration(){return this._dataSdk.draftView.getDuration()/1000n}get uiTracksData(){return this._timelineUITracksData}registerTimelineToolbarController(e,t){this._contribution[f._].registerController(e,t)}registerContextMenuController(e,t){this._contribution[u.O].registerController(e,t)}registerTimelineContentController(e,t){this._contribution[ev.OP].registerController(e,t)}refreshContributionUI(e){this._contribution.forceRender(e)}setFreeze(e){this._freeze=e,e?this._timelineInteract.setDisableInteract([er.Vf.ALL]):this._timelineInteract.clearDisableInteract()}setRenderManager(e){this._renderManager=e,this._resource.setRenderManager(e),this._player.setRenderManager(e),this._batchReplaceManager.setRenderManager(e),this._freezeManager.setRenderManager(e),this._coordinate.setRenderManager(e),this._draftOperation.setRenderManager(e)}getTimelineSwitches(){return this._store[_.U_].switches}getCurrentTimeLineSegment(){return this._store[_.U_].currentTimeLineSegment}getIsBatchReplace(){return this._store[_.U_].isBatchReplacePanelVisible}getMaxMaterialsCountsForMutableVideo(){return this._store[_.U_].maxMaterialsCountsForMutableVideo}getFailSegments(){return this._store[_.jU].failSegments}async bootstrap(){await Promise.all([this._resource.bootstrap(),this._templateInfoManager.bootstrap()])}constructor(e,t,i,r,n,a,s,o,l,u,g,m,p,f,D,x,P,E,N,Z,F,W,Y,H,Q,K,J,X,$){this._mainEditorWidgetService=e,this._dataSdk=t,this._cloudMetaManager=i,this._draftPathStore=r,this._draftTemplateManager=n,this._fileUploadManager=a,this._layoutManager=s,this._playerManager=o,this._segOperationManager=l,this._selection=u,this._prepareSelection=g,this._segmentSelection=m,this._checklistManager=p,this._mutableReplaceTaskManager=f,this._screenshotManager=D,this._addSegmentManager=x,this._modalManager=P,this._ensureManager=E,this._resourceErrorManager=N,this._smartToolsManager=Z,this._replaceSegmentManager=F,this._checkAvailability=W,this._subjectCropManager=Y,this._containerService=H,this._environmentService=Q,this._draftMaterialsService=K,this._exportService=J,this._lifeCycleService=X,this._videoPermissionService=$,this._freeze=!1,this._timelineEvent=this._containerService.createInstance(M.B),this._store=(0,_.Lv)(Q.appSubType===h.cP.Template?c.KN.CUT_SAME:c.KN.MULTI_TRACK,this._smartToolsManager.intelligentStoreManager.intelligentStore,this._segmentSelection.observeData,this._checklistManager.observeCheckListManagerData,(0,h.xA)(this._environmentService)),this._transientDataManager=this._containerService.createInstance(eO.m,this._store),this._templateInfoManager=this._containerService.createInstance(ej.m,this._dataSdk,this._store),this._draftDataSynchronizer=this._containerService.createInstance(eL.A,this._dataSdk,this._store,this._segmentSelection,this._transientDataManager,this._templateInfoManager),this._sider=this._containerService.createInstance(S.o),this._contribution=new v.G(this._store[_.U_].isTemplate),this._timelineEnvironment=this._containerService.createInstance(y.J),this._mutableUpload=this._containerService.createInstance(eN.i,this._dataSdk,this._store,this._mutableReplaceTaskManager,this._fileUploadManager,this._segmentSelection),this._player=this._containerService.createInstance(T.k,this._dataSdk,this._playerManager,this._store,this._renderManager,this._mainEditorWidgetService.selection),this._cursor=this._containerService.createInstance(eR,this._store[_.U_]),this._reporter=this._containerService.createInstance(eu.h,this._timelineEvent),this._timelineSelection=this._containerService.createInstance(b.N,this._selection,this._prepareSelection,this._store,this._segmentSelection,this._timelineEvent,this._draftDataSynchronizer),this._keybinding=this._containerService.createInstance(ef,s,this._store),this._coverManager=new I.P(this._store),this._axisMarkerManager=new w.g(this._store),this._modal=this._containerService.createInstance(k.z,this._modalManager),this._segmentManager=this._containerService.createInstance(eE.z,this._store,this._dataSdk,this._segmentSelection),this._resource=this._containerService.createInstance(A.j,this._dataSdk,this._renderManager,this._draftPathStore,this._store,this._screenshotManager,this._ensureManager,this._resourceErrorManager,this._segmentSelection,this._draftDataSynchronizer),(0,C.L)(this._resource,this._draftDataSynchronizer,this._environmentService),this._autoReplace=this._containerService.createInstance(R,this._store,this._dataSdk,this._timelineSelection),this._timelineToast=this._containerService.createInstance(L.V,this._store),this._timelineZoom=this._containerService.createInstance(j.L,this._store,this._dataSdk,this._cloudMetaManager,this._playerManager),this._timelinePanel=this._containerService.createInstance(O.k,this._layoutManager,this._store,this._segmentSelection),this._timelinePreviewLine=this._containerService.createInstance(B.T,this._store),this._draftOperation=this._containerService.createInstance(z.D,this._store,this._dataSdk,this._addSegmentManager,this._replaceSegmentManager,this._segOperationManager,this._timelineEvent,this._segmentSelection,this._resource,this._fileUploadManager,this._timelineToast,this._mutableReplaceTaskManager,this._smartToolsManager,this._checkAvailability,this._templateInfoManager,this._draftDataSynchronizer),this._coordinate=this._containerService.createInstance(U.Z,this._store,this._layoutManager,{player:this._player,draftOperation:this._draftOperation,timelineSelection:this._timelineSelection,selection:this._selection,environment:this._timelineEnvironment,timelineEvent:this._timelineEvent,timelineKeybinding:this._keybinding,sider:this._sider,timelineToast:this._timelineToast,segmentManager:this._segmentManager,layoutManager:this._layoutManager,transientDataManager:this._transientDataManager,draftDataSyncer:this._draftDataSynchronizer}),this._batchReplaceManager=this._containerService.createInstance(eS.P,this._dataSdk,this._fileUploadManager,this._draftOperation,this._store,this._renderManager,this._timelineSelection,this._autoReplace,this._draftPathStore,this._smartToolsManager,this._coordinate,this._timelineToast,this._subjectCropManager,this._segmentSelection,this._draftTemplateManager,this._player,this._mainEditorWidgetService.selection),this._timelineGuide=this._containerService.createInstance(V.W,this._store,this._dataSdk,this._coordinate,this._timelinePanel,this._timelineEvent,this._cloudMetaManager,this._playerManager,this._selection),this._timelineScroller=this._containerService.createInstance(G,this._store,this._coordinate),this._dndDrop=this._containerService.createInstance(eD.j,this._store,this._coordinate,this._timelineZoom),this._fileDrop=this._containerService.createInstance(eP.H,this._store,this._coordinate),this._timelineInteract=new ex.S(this._store,this._coordinate,this._player,this._draftOperation,this._draftDataSynchronizer),this._trackManager=new es(this._store,this._timelineEvent,this._player,this._timelineSelection,this.timelineUI,this._timelineInteract,this._transientDataManager,this._dataSdk),this._freezeManager=this._containerService.createInstance(eo.N,this._modalManager,this._playerManager,this._smartToolsManager,this._ensureManager,this._segmentSelection),this._partialExportManager=this._containerService.createInstance(ew,this._mainEditorWidgetService,this._draftMaterialsService,this._exportService,this._store,this._segmentSelection,this._timelineSelection),this._audioRecorderManager=new e_.u(this._store,this._coordinate,this._timelineEvent,this._transientDataManager),this._templatePost=this._containerService.createInstance(el.m,this._dataSdk,this._store,this._timelineInteract),this._view=new d(this._store,this._contribution,{coordinate:this._coordinate,player:this._player,draftOperation:this._draftOperation,timelineUI:this.timelineUI,reporter:this._reporter,selection:this._timelineSelection,environment:this._timelineEnvironment,resource:this._resource,sider:this._sider,fileUpload:this._fileUploadManager,keybinding:this._keybinding,event:this._timelineEvent,modal:this._modal,autoReplace:this._autoReplace,intelligent:this._smartToolsManager.intelligentStoreManager,batchReplace:this._batchReplaceManager,partialExportManager:this._partialExportManager,dndDrop:this._dndDrop,mutableUpload:this._mutableUpload,mutableReplaceTaskManager:this._mutableReplaceTaskManager,segmentManager:this._segmentManager,subjectCrop:this._subjectCropManager,templatePost:this._templatePost,draftDataSyncer:this._draftDataSynchronizer,dataSdk:this._dataSdk},this._containerService),this._layoutManager.setBottomPartView(this._view),this._layoutManager.onResizeStateChange(e=>{this._store[_.U_].setIsManualResizing(e)}),this._lifeCycleService.onDraftLoaded(()=>{this._store[_.U_].setTimelineLoading(!1)}),this._draftTemplateManager.onIsNewEmptyChange(e=>{this._store[_.U_].setIsNewEmpty(e)}),this._dataCheck=this._containerService.createInstance(eB.D,this._dataSdk,this._draftDataSynchronizer,this._store),this._timelineUITracksData=this._containerService.createInstance(ez.c,this._draftOperation,this._timelineEvent,this._store),window.__timelineManager=this}}eV=(0,r.gn)([(0,r.fM)(23,eh.t),(0,r.fM)(24,h.rO),(0,r.fM)(25,ek.D),(0,r.fM)(26,g.AA),(0,r.fM)(27,eA.g),(0,r.fM)(28,m.u),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===p.a?Object:p.a,"undefined"==typeof IDataSdk?Object:IDataSdk,"undefined"==typeof ICloudMetaManager?Object:ICloudMetaManager,"undefined"==typeof DraftPathStore?Object:DraftPathStore,"undefined"==typeof IDraftTemplateManager?Object:IDraftTemplateManager,"undefined"==typeof IEditorWidgetFileUploadManager?Object:IEditorWidgetFileUploadManager,"undefined"==typeof LayoutManager?Object:LayoutManager,"undefined"==typeof IPlayerManager?Object:IPlayerManager,"undefined"==typeof SegOperationManager?Object:SegOperationManager,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof ISelection?Object:ISelection,"undefined"==typeof SegmentSelection?Object:SegmentSelection,"undefined"==typeof CheckListManager?Object:CheckListManager,"undefined"==typeof IMutableReplaceTaskManager?Object:IMutableReplaceTaskManager,"undefined"==typeof IScreenshotManager?Object:IScreenshotManager,void 0===eM.O?Object:eM.O,"undefined"==typeof ModalManager?Object:ModalManager,"undefined"==typeof IEnsureManager?Object:IEnsureManager,void 0===ed.X?Object:ed.X,"undefined"==typeof SmartToolsManager?Object:SmartToolsManager,void 0===eC.m?Object:eC.m,Function,"undefined"==typeof ISubjectCropManager?Object:ISubjectCropManager,void 0===eh.t?Object:eh.t,void 0===h.rO?Object:h.rO,void 0===ek.D?Object:ek.D,void 0===g.AA?Object:g.AA,void 0===eA.g?Object:eA.g,void 0===m.u?Object:m.u])],eV)},112825:function(e,t,i){function r(e){return!Object.prototype.hasOwnProperty.call(null!=e?e:{},"segmentId")}function n(e){return Object.prototype.hasOwnProperty.call(null!=e?e:{},"segmentId")}function a(e){return(null==e?void 0:e.registeredType)==="tier-block"}function s(e){return(null==e?void 0:e.registeredType)==="placeholder"}i.d(t,{B:function(){return d},C3:function(){return u},OV:function(){return r},Q:function(){return a},RO:function(){return s},YP:function(){return n}});var o,l,d=((o={}).updateStyle="updateStyle",o.batchUpdateStyle="batchUpdateStyle",o.updateData="updateData",o.updatePartialSegmentData="updatePartialSegmentData",o.keyframeKeepActive="keyframeKeepActive",o.previewLineSeek="previewLineSeek",o.timelineEnter="timelineEnter",o.timelineLeave="timelineLeave",o.timelineMainTrackUpdate="timeline.mainTrack.update",o.contextmenuVisible="contextmenu_visible",o.adsorbCursor="adsorbCursor",o.showTransitionAddBtn="showTransitionAddBtn",o);var u=((l={}).SEGMENT="segment",l.TRANSITION="transition",l)},68659:function(e,t,i){i.d(t,{E2:function(){return u},Xf:function(){return g},tr:function(){return c},zz:function(){return h}});var r=i(426336),n=i(794273),a=i(649086),s=i(800788),o=i(338151),l=i(578635),d=i(828890);let u=BigInt(Number.MAX_SAFE_INTEGER);function c(e,t){var i,c,h,g,m,p,f,_,v,M,S,y,T,b,I,w,k,A,C,D,x,P,E,N,R,L,j,O,B,z,U,V,Z,F;if((0,n.Ff)(e))return{id:null!==(i=e.id)&&void 0!==i?i:"",type:"transition",segmentId:"",title:null!==(c=e.name)&&void 0!==c?c:"",duration:null!==(h=e.duration)&&void 0!==h?h:0,isOverlap:!1};if((0,l.s6)(e)){;let i,n,c,h,G,W,Y,H,Q,K,J,X,$,q,ee,et,ei,er;let en=null==e?void 0:null===(g=e.material)||void 0===g?void 0:g.type;let ea=(!(F=e).__segment_struct_type&&(0,s.ss)(),"video"===(er=o.h[F.__segment_struct_type])&&(0,l.ez)(F)&&(er="combination"),er);(0,s.Y2)(ea,"segment should have type");let es=[],eo=["video","text","sticker","combination"].includes(ea)?[]:void 0,el="audio"===ea?[]:void 0,ed="",eu=!1,ec="",eh=!1,eg=!1,em="",ep=!0;if((0,l.f2)(e)){if(ed=e.material.materialName,G=e.material.path,i={start:BigInt(0),duration:BigInt(0),total:BigInt(0)},ee=e.vocalSeparation,et=e.vocalBeautify,{objectLocked:ei}=e.material,W={duration:e.material.duration,hasAudio:!0,detached:!1,fromUser:!0},{reverse:eu,digitalHuman:Q}=e,{reversePath:ec}=e.material,K={width:e.material.width,height:e.material.height},J={ratio:e.material.cropRatio,box:e.material.crop},Q&&({materialDraft:$}=e),e.material.type===r.cVg.MetaTypePhoto||e.material.type===r.cVg.MetaTypeGif)i.total=u;else{let t=1;(null===(S=e.speed)||void 0===S?void 0:S.speed)&&(n=t=null===(b=e.speed)||void 0===b?void 0:b.speed),(null===(y=e.speed)||void 0===y?void 0:y.speed)&&(null===(T=e.speed)||void 0===T?void 0:T.mode)===r.yY$.SpeedModeCurve&&(c=null===(I=e.speed)||void 0===I?void 0:I.curveSpeed);let a=e.sourceTimerange.start;a&&(i.start=r.pMA.div(a,t,"bigint"));let s=e.sourceTimerange.duration;s&&(i.duration=r.pMA.div(s,t,"bigint"));let o=e.material.duration;o&&(i.total=r.pMA.div(o,t,"bigint"))}e.transition&&es.push({id:null==e?void 0:e.transition.id,type:"transition",segmentId:e.id,title:null==e?void 0:e.transition.name,duration:e.transition.duration,isOverlap:!1}),eo&&(null===(p=e.animations)||void 0===p?void 0:null===(m=p.animations)||void 0===m?void 0:m.length)&&(null===(k=e.animations)||void 0===k||null===(w=k.animations)||void 0===w||w.forEach(e=>{var t,i;eo.push({type:e.type,duration:null!==(t=e.duration)&&void 0!==t?t:0,start:null!==(i=e.start)&&void 0!==i?i:0n})})),void 0!==e.material.hasAudio&&(W.hasAudio=e.material.hasAudio),e.material.extraTypeOption&r.Yzk.HasSeparatedAudio&&(W.detached=!0),(0,l.ez)(e)&&($=e.materialDraft,em=e.templateId),e.material.extraTypeOption===r.Yzk.HasSeparatedAudio&&(W.detached=!0),e.material.materialId&&e.material.sourcePlatform===r.cvu.MaterialPlatformArtist&&(W.fromUser=!1),W.isFlipped=null!==(A=null==e?void 0:null===(_=e.clip)||void 0===_?void 0:null===(f=_.flip)||void 0===f?void 0:f.horizontal)&&void 0!==A&&A,eh=!!(null==e?void 0:null===(v=e.adjust)||void 0===v?void 0:v.enableSmartColorAdjust),eg=!!("number"==typeof(null==e?void 0:null===(M=e.material.stable)||void 0===M?void 0:M.stableLevel)&&0!==e.material.stable.stableLevel),X=e.material}else if((0,l.QO)(e)){ed=e.material.name,G=e.material.path,i={start:BigInt(0),duration:BigInt(0),total:BigInt(0)},ee=e.vocalSeparation,et=e.vocalBeautify;let t=1;(null===(C=e.speed)||void 0===C?void 0:C.speed)&&(n=t=null===(D=e.speed)||void 0===D?void 0:D.speed),e.sourceTimerange.start&&(i.start=r.pMA.div(e.sourceTimerange.start,t,"bigint")),e.sourceTimerange.duration&&(i.duration=r.pMA.div(e.sourceTimerange.duration,t,"bigint")),e.material.duration&&(i.total=r.pMA.div(e.material.duration,t,"bigint")),e.fade&&(e.fade.fadeInDuration||e.fade.fadeOutDuration)&&(e.fade.fadeInDuration&&el.push({type:"in",duration:e.fade.fadeInDuration}),e.fade.fadeOutDuration&&el.push({type:"out",duration:e.fade.fadeOutDuration}));let{enableAiBeats:a=!1,userBeats:s=[],userDeleteAiBeats:o,gear:d}=null!==(x=null==e?void 0:e.beat)&&void 0!==x?x:{};(0,l.tp)(e)&&($=e.materialDraft),H={gear:d,enableAiBeats:a,deleteAiBeats:o,userAddBeats:s,beats:[]},X=e.material}else if((0,l.Z3)(e)){if(ed=null!==(j=null===(P=e.material)||void 0===P?void 0:P.text)&&void 0!==j?j:"",i={start:BigInt(0),duration:BigInt(0),total:u},Y={materialType:null===(E=e.material)||void 0===E?void 0:E.type,addType:null===(N=e.material)||void 0===N?void 0:N.addType},null===(L=e.animations)||void 0===L?void 0:null===(R=L.animations)||void 0===R?void 0:R.length)for(let{type:t,duration:i}of e.animations.animations)eo.push({type:t,start:0n,duration:i});q=e.videoTracking}else if((0,l.N)(e))i={start:BigInt(0),duration:BigInt(0),total:u},q=e.videoTracking;else if((0,l.dc)(e)){if(ed=e.material.name,i={start:BigInt(0),duration:BigInt(0),total:u},h=null!==(V=null===(O=e.material)||void 0===O?void 0:O.iconUrl)&&void 0!==V?V:null===(B=e.material)||void 0===B?void 0:B.previewCoverUrl,null===(U=e.animations)||void 0===U?void 0:null===(z=U.animations)||void 0===z?void 0:z.length)for(let{type:t,duration:i}of e.animations.animations)eo.push({type:t,start:0n,duration:i});q=e.videoTracking}else(0,l.mT)(e)?(ed=e.material.name,i={start:BigInt(0),duration:BigInt(0),total:u}):(0,l.o9)(e)?(ed=e.material.name,i={start:BigInt(0),duration:BigInt(0),total:u}):(0,l.mZ)(e)&&(ed=e.name,i={start:BigInt(0),duration:BigInt(0),total:u});let{start:ef,duration:e_}=null!==(Z=null==e?void 0:e.sourceTimerange)&&void 0!==Z?Z:{},ev={start:null!=ef?ef:BigInt(0),duration:null!=e_?e_:BigInt(0)},{start:eM,duration:eS}=e.targetTimerange,ey=e.commonKeyframes||[];return ep=e.visible,{id:e.id||`segment-${(0,a.z)()}`,type:ea,metaType:en,start:eM,duration:eS,originalTargetStart:eM,originalTargetDuration:eS,vocalSeparation:ee,vocalBeautify:et,title:ed,prolong:i,materialDraft:$,templateId:em,slots:es,animations:eo,fades:el,speed:n,curveSpeed:c,iconUrl:h,path:G,video:W,reverse:eu,reverse_path:ec,text:Y,crop:J,material:K,audio:H,sourceTimeRange:ev,sourceMaterial:X,commonKeyframes:ey,keyframesMap:(0,d.q)({segmentId:e.id,commonKeyframes:ey},t),digitalHuman:Q,enableSmartColorAdjust:eh,stabilize:eg,visible:ep,videoTracking:q,objectLocked:ei}}throw Error("unexpected transfer target")}function h(e){return{id:e.id,type:e.type,trackType:e.type,attribute:e.attribute}}function g(e,t){return e.map((e,i)=>{var r,n;return[(r=e,n=t,{...h(r),segments:r.segments.map(e=>c(e,n))}),i]})}},26761:function(e,t,i){i.d(t,{t:function(){return r}});function r(e,t){return!!e==!!t}},784878:function(e,t,i){i.d(t,{n:function(){return o}});var r=i(772322),n=i(771380),a=i(150564),s=i(578186);function o(e,t){let i=e>=10?(0,r.jsx)("div",{className:"thin-icon"}):null,o=e<=32?i:(0,r.jsx)("div",{className:"broad-icon",children:(0,r.jsx)(a.S31,{className:"iconpark-icon",color:"var(--lvv-color-white-stationary)"})}),l=(0,n.renderToString)((0,r.jsx)("div",{className:"segment-transition segment-transition-tip",children:t?o:i}));return(0,s.G)(l)}},936154:function(e,t,i){i.d(t,{C:function(){return a},q:function(){return n}});var r=i(860660);let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i={track_category:"",material_id:"",material_name:"",material_category:"none",material_subcategory:"none",material_subcategory_id:"none",material_thirdcategory:"none",material_thirdcategory_id:"none"};return Object.assign(i,(0,r.p8)(e,t)),i},a=e=>{let t=e.map(e=>(0,r.p8)(e)),i=["track_category","material_id","material_name","material_category","material_subcategory","material_subcategory_id","material_thirdcategory","material_thirdcategory_id"],n={is_batch:t.length>1?1:0};return t.forEach(e=>{i.forEach(t=>{!n[t]&&(n[t]=[]),n[t].push(e[t]||"none")})}),i.forEach(e=>{var t;n[e]=(null===(t=n[e])||void 0===t?void 0:t.join(","))||"none"}),n}},804497:function(e,t,i){i.d(t,{$b:function(){return p},AH:function(){return M},Af:function(){return P},DX:function(){return x},F6:function(){return y},IK:function(){return b},JS:function(){return v},Mc:function(){return N},NT:function(){return C},TK:function(){return function e(t){let i=null;for(let n of t){let{mutable:t}=n;if((0,r.gG)(t)&&!t.filled?i=n:(0,r.rE)(t)&&(i=e(t.children)),i)return Object.assign(i,{scrollId:n.id})}return i}},Ur:function(){return w},ed:function(){return f},hW:function(){return I},j5:function(){return A},kQ:function(){return m},kf:function(){return g},kt:function(){return function e(t,i){for(let[s]of t)for(let t of s.segments){var r,n,a;if(t.id===i.id)return t;let s=null===(a=t.materialDraft)||void 0===a?void 0:null===(n=a.draft)||void 0===n?void 0:null===(r=n.tracks)||void 0===r?void 0:r.map(e=>[e,0,"main"]);if(s){let t=e(s,i);if(t)return t}}}},l4:function(){return _},lo:function(){return k},pE:function(){return E},pN:function(){return h},pv:function(){return D},qU:function(){return u},y_:function(){return S},zy:function(){return c}});var r=i(928261),n=i(857670),a=i(632555),s=i(426336),o=i(969242),l=i(354267),d=i(907031);function u(e){let[t,i]=e;return t&&0===i}function c(e){let[t,i]=e;return t&&i>0}function h(e,t){if(!!t)for(let i of e){let e=i.segments.find(e=>e.id===t);if(e)return e}}function g(e,t){let i=e.findIndex(e=>e.id===t.id);return i>-1?[e[i],i+1<e.length?e[i+1]:null]:[null,null]}function m(e,t){let i=[];for(let[r]of e)for(let e of r.segments){t.includes(e.id)&&i.push(e);let r=e.slots.find(e=>"transition"===e.type);r&&t.includes(r.id)&&i.push({...r,segmentId:e.id})}return i}function p(e,t){let{start:i,end:r}=t;return e.map(e=>e.segments.filter(e=>{let t=e.start,n=e.start+e.duration;if("video"===e.type){var a;let t=e.slots.find(e=>"transition"===e.type);n+=(null!==(a=null==t?void 0:t.duration)&&void 0!==a?a:0n)/2n}return!(t>=r||i>=n)})).flat().map(e=>e.id)}function f(e,t){let i=[];for(let[n]of e)for(let e of n.segments)if((0,r.gG)(e.mutable)||(0,r._n)(e.mutable))t.includes(e.id)&&i.push(e);else if((0,r.rE)(e.mutable))for(let r of e.mutable.children)t.includes(r.id)&&i.push(r);return i}function _(e,t){for(let[r]of e)for(let e of r.segments){var i;if(e.id===t)return{segment:e,isChild:!1};if(null===(i=e.mutable)||void 0===i?void 0:i.children){for(let i of e.mutable.children)if(t===i.id)return{segment:e,isChild:!0}}}}function v(e,t){for(let i of e)if(i[0].segments.some(e=>e.id===t.id))return i;return[void 0,-1]}function M(e,t,i,r){let{start:n,duration:a}=e,l=(0,o.vY)(i,n);return{x:l,width:Math.max(r?d.Zg:d.vm,(0,o.vY)(i,s.pMA.max([1,a],"bigint")))}}function S(e,t){return s.pMA.minus(e.start,t.start)}function y(e,t,i){let s=null;for(let o of e){let{start:e,duration:l,mutable:d}=o,u=(0,n.i1)(e+i),c=(0,n.i1)(e+i+l),h=(0,a.mK)(t,[u,c]);if(((0,r.gG)(d)||(0,r._n)(d))&&h?s=o:(0,r.rE)(d)&&h&&(s=d.children[0]),s)break}return s}function T(){return`${l.k}-${Math.round(1e8*Math.random())}`}function b(e,t){return{id:T(),start:e,keyframesMap:new Map,duration:t,type:"mutableAudio",metaType:s.cVg.MetaTypeNone,slots:[],speed:1,path:"",title:"",mutable:{locked:!1,mutableId:"",filled:!1},originalTargetDuration:t,originalTargetStart:e,commonKeyframes:[]}}function I(e,t){let[i]=e,r=function(e,t){let[i]=e,{segments:r}=i,n=r.filter(e=>e.metaType!==s.cVg.MetaTypeNone),a=[],o={start:0n,duration:0n};for(let e of n){var l,d;let t=o.start+o.duration,i=null!==(d=null==e?void 0:null===(l=e.cropping)||void 0===l?void 0:l.start)&&void 0!==d?d:e.start;i>t&&a.push({id:T(),start:t,originalTargetStart:t,keyframesMap:new Map,duration:i-t,originalTargetDuration:i-t,type:"mutableAudio",metaType:s.cVg.MetaTypeNone,slots:[],speed:1,path:"",title:"",mutable:{locked:!1,mutableId:"",filled:!1},commonKeyframes:[]}),o=e.cropping?e.cropping:{start:e.start,duration:e.duration}}let u=o.start+o.duration;u<t&&a.push({id:T(),start:u,originalTargetStart:u,duration:t-u,originalTargetDuration:t-u,type:"mutableAudio",metaType:s.cVg.MetaTypeNone,slots:[],speed:1,path:"",title:"",mutable:{locked:!1,mutableId:"",filled:!1},commonKeyframes:[],keyframesMap:new Map});let c=[...n,...a].sort((e,t)=>s.pMA.minus(e.start,t.start));return c.push({id:"end-limit",start:t,originalTargetStart:t,duration:0n,originalTargetDuration:0n,type:"mutableAudio",metaType:s.cVg.MetaTypeMusic,slots:[],speed:1,path:"",title:"",mutable:{locked:!1,mutableId:"",filled:!1},keyframesMap:new Map,commonKeyframes:[]}),c}(e,t);return i.segments.length=0,i.segments.push(...r),e}let w=(e,t)=>{let{start:i,duration:r}=e;if(void 0===i||void 0===r)return!1;let s=(0,n.i1)(i),o=(0,n.i1)(i+r);return(0,a.mK)(t,[s,o])};function k(e){return"transition"!==e.type&&!!e.digitalHuman&&!!e.materialDraft}function A(e){return"transition"!==e.type&&!!e.digitalHuman}let C=(e,t,i)=>(0,a.mK)(s.pMA.times(e,n.G8,"bigint"),[t-1n,t+i+1n]),D=(e,t)=>{let i=s.pMA.times(e,n.G8,"bigint");return(0,o.vY)(t,i)},x=e=>{let{minFrameDis:t,maxFrameDis:i,targetFrameDis:r}=e;return r<=t?t:r>=i?i:r},P=(e,t,i)=>s.pMA.max([s.pMA.div(t,n.G8,"bigint","round"),s.pMA.min([e,s.pMA.div(i+t,n.G8,"bigint","round")])]);function E(e){return(null==e?void 0:e.type)==="combination"}function N(e){let t=s.pMA.div(e,1e3);return`${(t/1e3).toFixed(1)}s`}},700933:function(e,t,i){i.d(t,{BM:function(){return s},Ku:function(){return o},MD:function(){return d},Oe:function(){return l},c6:function(){return u}});var r=i(426336),n=i(907031),a=i(305799);let s=()=>[{id:n.pP,type:r.pNd.TrackTypeNone,segments:[],trackType:r.pNd.TrackTypeNone},0];function o(e,t){if(!t.length)return[];let i=e.map((e,t)=>({...e,index:t}));return(0,a.NO)(i,e=>!e.segments.find(e=>t.includes(e.id))).map(e=>(e.segments=[...e.segments].filter(e=>t.includes(e.id)).sort((e,t)=>r.pMA.minus(e.start,t.start)),e))}function l(e,t){return e.id===n.pP||e.id===(null==t?void 0:t.id)&&t.segments.length<=0}function d(e){return["none","video"].includes(e[0].type)&&0===e[1]}function u(e,t){for(let i of e)for(let e=0;e<i.segments.length;++e)if(i.segments[e].id===t)return[e>0?i.segments[e-1]:null,i.segments[e],e+1<i.segments.length?i.segments[e+1]:null];return[null,null,null]}},486504:function(e,t,i){i.d(t,{Z:function(){return y}});var r=i(772322);i(658338),i(837510),i(225572);var n=i(23571),a=i(948747),s=i(97257),o=i(218571),l=i(670933),d=i(801497),u=i(105789),c=i.n(u),h=i(690674),g=i(771255),m=i(150564),p=i(825686),f=i(937802);i(949235);let _="timeline-batch-replace-invoker",v=`${_}-uploaded-count`,M=`${_}-filled-count`,S=e=>{let{duration:t,onFinish:i}=e,[n,a]=(0,o.useState)(t),l=(0,o.useRef)(n);return(0,o.useEffect)(()=>{let e=setInterval(()=>{if(l.current<=0){clearInterval(e),null==i||i();return}l.current--,a(l.current)},1e3);return()=>{clearInterval(e)}},[]),(0,r.jsx)(s.Z,{onClick:i,size:"mini",type:"default",children:`${d.ZP.t("ok_web",{},"OK")}(${n}s)`})},y=(0,l.f3)("store","modules")((0,l.Pi)(e=>{let{store:t,modules:i}=e,{isBatchReplacing:l,mode:u}=t[h.U_],{batchReplaceCount:y,batchReplaceStatus:T}=i.batchReplace,b=(0,f.G)(p.sX),I=(0,o.useMemo)(()=>{let e;let{uploaded:t=0,filledMutable:i}=y,s={count1:()=>(0,r.jsx)(n.Z,{className:c()(`${_}-count`,v),value:t,countUp:!0},"count1"),count2:()=>(0,r.jsx)(n.Z,{className:c()(`${_}-count`,M),value:i,countUp:!0},"count2")};switch(e=t<2&&i<2?d.ZP.t("web_same_editor_text_both_one",s,"<count1>0</count1> media is uploaded. <count2>0</count2> clip is replaced."):t>=2&&i<2?d.ZP.t("web_same_editor_text_one_a_no",s,"<count1>0</count1> media are uploaded. <count2>0</count2> clip is replaced."):t<2&&i>=2?d.ZP.t("web_same_editor_text_one_a_replace",s,"<count1>0</count1> media is uploaded. <count2>0</count2> clips are replaced."):d.ZP.t("web_same_editor_text_both_more_than",s,"<count1>0</count1> media are uploaded. <count2>0</count2> clips are replaced."),T){case g.g.UPLOADING:return{icon:(0,r.jsx)(a.Z,{presetIcon:"logo"}),title:d.ZP.t("web_same_editor_text_replace_",{},"Replacing clips..."),content:e,button:T===g.g.UPLOADING?d.ZP.t("web_cancel",{},"Cancel"):void 0};case g.g.SUCCESS:return{icon:(0,r.jsx)(m.m_I,{}),title:d.ZP.t("web_same_editor_clip_replace",{},"Clips replaced"),content:d.ZP.t(y.filledMutable>1?"web_same_editor_text_clips_replaced":"web_same_editor_title_clip_replaced",{count1:()=>(0,r.jsx)(n.Z,{className:c()(`${_}-count`,M),value:y.filledMutable},"count1")},y.filledMutable>1?"<count1>0</count1> clips replaced":"<count1>0</count1> clip replaced")};default:return{}}},[T,y]),w=(0,o.useCallback)(e=>{let t=i.timelineUI.toast.warning({content:(0,r.jsx)("div",{className:`${_}-tips-wrapper`,children:(0,r.jsxs)("div",{className:`${_}-tips-content`,children:[(0,r.jsx)("span",{className:`${_}-tips-text`,children:d.ZP.t("web_same_editor_text_clip_replaced",{placeholder0:e,num:e},"{placeholder0} clips replaced")}),(0,r.jsx)(S,{duration:3,onFinish:()=>t()})]})}),duration:0,className:`${_}-tips`})},[]);(0,o.useEffect)(()=>{if(T===g.g.CANCELED&&w(y.filledMutable),T===g.g.SUCCESS||T===g.g.CANCELED){var e;setTimeout(()=>{i.batchReplace.setBatchReplaceCount({uploading:0,uploaded:0,canceled:0,failed:0}),t[h.U_].setIsBatchReplacing(!1)},1e3),null===(e=i.batchReplace)||void 0===e||e.selectNextAvailableSegment()}},[T]),(0,o.useEffect)(()=>{b.onDidOpen(()=>{var e;null===(e=i.batchReplace)||void 0===e||e.cancelBatchReplace(!0)})},[]);let k=e=>{e.stopPropagation(),e.preventDefault()};return(0,o.useEffect)(()=>(T!==g.g.IDLE&&l?document.addEventListener("keydown",k,!0):document.removeEventListener("keydown",k,!0),()=>{document.removeEventListener("keydown",k,!0)}),[T,l]),T!==g.g.IDLE&&l?(0,r.jsx)("div",{className:_,children:(0,r.jsxs)("div",{className:`${_}-modal`,children:[(null==I?void 0:I.icon)&&(0,r.jsx)("div",{className:`${_}-icon`,children:I.icon}),I.title&&(0,r.jsx)("div",{className:`${_}-title`,children:I.title}),I.content&&(0,r.jsx)("div",{className:`${_}-content`,children:I.content}),I.button?(0,r.jsx)("div",{className:`${_}-bottom`,children:(0,r.jsx)(s.Z,{size:"large",onClick:()=>{i.batchReplace.cancelBatchReplace()},children:I.button})}):(0,r.jsx)("div",{className:`${_}-placeholder`})]})}):null}))},854862:function(e,t,i){i.d(t,{q:function(){return d}});var r=i(955171),n=i(356515),a=i(426336),s=i(254336),o=i(460254),l=i(801497);async function d(e,t,i,d,u,c,h,g,m){if(0===(0,n.f)(e).length||!t)return!1;let p=t.duration;try{if(await (0,n.e)(e[0])<a.pMA.div(p,1e3,"number"))return g.toast.error(l.ZP.t("web_textvideo_toast_cant_replace",{},"Can\u2019t replace. Media needs to be no shorter than the original material.")),!1}catch{}let f=new Date().getTime();try{m.setTimelineSegmentLoading(t.id,!0,f);let n=await d.localFilesUpload(e,{uploadReportParams:{action_type:s.jm.CLICK_COMPONENT,material_source:s.O9.LOCAL,position:s.cg.REPLACE_MEDIA}}),a=await n[0],{success:l}=a;if(l){let e=a.model,n=a.resourceType;n===o.r.UserVideo?(0,r.Z)(n,e)>p&&(i.unionPlaying&&c.pause(),h.openMultiTrackSegmentTrimModal(t.id,e,n)):u.segment.segmentReplace({dragSource:e,type:n,sourceFrom:"quick-upload"},{segmentId:t.id})}}catch{}m.setTimelineSegmentLoading(t.id,!1,f)}},456193:function(e,t,i){i.d(t,{Z:function(){return s}});var r=i(772322),n=i(596762),a=i(218571);let s=(0,a.memo)(function(e){let{thumbnail:t}=e,i=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{if(!t||!i.current)return;let{thumbnailImage:e,imageOffsetX:r}=t;i.current.width=e.width,i.current.height=e.height,i.current.style.marginLeft=`${r}px`,(0,n.Lp)(e,i.current)},[t]),(0,r.jsx)("canvas",{ref:i})})},415826:function(e,t,i){i.d(t,{_:function(){return s}});var r=i(772322),n=i(218571),a=i(93529);let s=(0,n.memo)(e=>{let{cTracks:t,...i}=e;return(0,r.jsx)("div",{className:"track-list",children:t.map(e=>{let[t,n]=e;return(0,r.jsx)(a.a,{track:t,index:n,...i},t.id)})})})},786013:function(e,t,i){i.d(t,{O:function(){return r}});function r(e,t,i){var r,n;let a=[];if(!(null===(r=e.mutable)||void 0===r?void 0:r.locked)&&(null===(n=e.mutable)||void 0===n?void 0:n.mutableId));else if(0!==i);else if(e.slots.find(e=>"transition"===e.type));else{let i=t.findIndex(t=>t.id===e.id);-1===i||i===t.length-1||a.push("transition")}return a}},267435:function(e,t,i){i.d(t,{U:function(){return l}});var r=i(432092),n=i(690674),a=i(563890),s=i(202426),o=i(402655);class l extends o.JT{_bindEventListeners(){this._renderer.events.store.on(s.ML.tracksChange,this._handleMainTrackPositionChange),this._renderer.events.view.on(s.H2.cameraSizeChange,this._handleMainTrackPositionChange);let e=this._renderActionRunner.onAfterRun(this._handleMainTrackPositionChange);this._register({dispose:()=>{this._renderer.events.store.off(s.ML.tracksChange,this._handleMainTrackPositionChange),this._renderer.events.view.off(s.H2.cameraSizeChange,this._handleMainTrackPositionChange),e.dispose()}})}constructor(e,t,i,s){super(),this._timelineManagerStore=e,this._modules=t,this._renderer=i,this._renderActionRunner=s,this._handleMainTrackPositionChange=()=>{let e=this._timelineManagerStore[n.U_],t=e.isTemplate?e.tracksMutable[0]:e.computedTracksMain[0];if(t){let{event:e}=this._modules,i=(0,a.JP)(this._renderer.children,t[0].id);(null==i?void 0:i.style)&&e.uiEvents.emit(r.W.MAIN_TRACK_POSITION_CHANGE,i.style)}},this._bindEventListeners()}}},138527:function(e,t,i){i.d(t,{r:function(){return d}});var r=i(402655),n=i(690674),a=i(260963),s=i(563890),o=i(257296),l=i(26761);class d extends r.JT{bindDataChangeListeners(e){let t=(0,a.U5)(()=>this._timelineManagerStore[n.U_].checkListManagerObserveData.vipSegmentsMap,()=>{for(let t of(0,s.Mq)(e.children,[o.KX.Segment])){if(t.destroyed)continue;let{data:{segment:e,isVip:i}}=t,r=this.getProps(e);!(0,l.t)(r.isVip,i)&&t.updateData(r,!0)}});this._register({dispose:t})}getProps(e){let{checkListManagerObserveData:t}=this._timelineManagerStore.timelineStore,{vipSegmentsMap:i,vipBadgeType:r}=t;return{isVip:!!(null==i?void 0:i[e.id]),vipBadgeType:r}}constructor(e){super(),this._timelineManagerStore=e}}},951180:function(e,t,i){i.d(t,{Z:function(){return g}});var r=i(772322);i(225572),i(818938);var n=i(97257),a=i(255276),s=i(218571),o=i(150564),l=i(670933),d=i(537783);i(698452);var u=i(202426),c=i(690674),h=i(70366);let g=(0,l.f3)("store","modules")((0,l.Pi)(e=>{let{renderer:t,store:i,modules:l}=e,[g,m]=(0,s.useState)(0),[p,f]=(0,s.useState)(0),[_,v]=(0,s.useState)(!1),[M,S]=(0,s.useState)(),y=(0,s.useRef)(null),{i18n:T}=(0,d.$)(),{segmentSelected:b}=i[c.qk];(0,h.w)({setModalLeft:m,setModalTop:f,segment:M,bubbleRef:{current:{getBoundingClientRect:()=>y.current?y.current.getBoundingClientRect():null}},store:i,modules:l}),(0,s.useEffect)(()=>{let e=(e,t)=>{if(e){let{x:i,y:r}=e;v(!0),f(r),m(i),S(t)}else v(!1)};return null==t||t.events.interact.on(u.TY.popupButtonEditTemplate,e),()=>{null==t||t.events.interact.off(u.TY.popupButtonEditTemplate,e)}},[t]),(0,s.useEffect)(()=>{0===b.length&&v(!1)},[b]);let I=(0,s.useCallback)(()=>{if(!M)return},[t,M]);return(0,r.jsx)(a.Z,{popupVisible:_&&b.some(e=>(null==e?void 0:e.id)===(null==M?void 0:M.id)),style:{position:"fixed",left:g},className:"trigger-responsive-hot-area popup-button-edit-template",position:"top",popup:()=>(0,r.jsx)("div",{ref:y,children:(0,r.jsxs)(n.Z,{type:"secondary",size:"large",onClick:e=>{e.stopPropagation(),v(!1),I()},children:[(0,r.jsx)(o.Kfl,{className:"iconpark-icon"}),(0,r.jsx)("div",{className:"content",children:T.t("web_multi_track_button_edit_template",{},"Edit template")})]})}),children:(0,r.jsx)("div",{className:"fake-modal",style:{transform:`translate(0, ${p}px)`}})})}))},960482:function(e,t,i){i.d(t,{Z:function(){return d}});var r=i(772322);i(957230);var n=i(46101),a=i(105789),s=i.n(a),o=i(670933),l=i(217713);let d=(0,o.Pi)(e=>{let{popupVisible:t,title:i,content:a,okText:o,cancelText:d,onOk:u,onCancel:c,className:h,triggerProps:g,offsetY:m,offsetX:p=0,fakeModalWidth:f,props:_,position:v,focusLock:M=!0}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(n.Z,{focusLock:M,position:null!=v?v:"top",title:i,content:a,okText:o,cancelText:d,icon:!1,onOk:u,onCancel:c,popupVisible:t,getPopupContainer:()=>document.body,className:s()(l.Z["popup-confirm"],"popup-confirm",h),triggerProps:g,..._,children:(0,r.jsx)("div",{className:l.Z["popup-confirm-fake-modal"],style:{transform:`translate(${p}px, ${m}px)`,width:`${f||0}px`}})})})})},639773:function(e,t,i){i.d(t,{l:()=>S});var r=i("789786"),n=i("345299"),a=i("257296"),s=i("316699"),o=i("396493"),l=i("853418"),d=i("879098"),u=i("718540"),c=i("473920"),h=i("800788"),g=i("230689");let m=["material","speed","trackRenderIndex"],p=["sourceTimerange","targetTimerange","reverse","speed","trackRenderIndex"];class f{getRenderActions(e,t,i){let r=[];if(0===t.length&&i)return r;for(let s of e){let e=(0,u.j)(t,s.nextTrackId);switch(i&&(e=t.find(e=>{let[t]=e;return t.segments.find(e=>{var t;return e.id===(null===(t=s.nextValue)||void 0===t?void 0:t.id)})})),s.type){case n.P.ADD:if(e){let t=this._canvasObjectPropsManager.getProps(s.nextValue,s.nextIndex,e[0],e[1]);r.push(new o.hn(a.KX.Segment,s.nextValue.id,{params:t}))}break;case n.P.DELETE:r.push(new l.x(a.KX.Segment,s.prevValue.id,void 0));break;case n.P.UPDATE:{let t=this._generateUpdateRenderAction(s,e,i);t&&r.push(t);break}default:(0,h.bP)(s)}}return r}_generateUpdateRenderAction(e,t,i){var r;if(!t)return;let n=null!==(r=t[0].segments.find(t=>t.id===e.nextValue.id))&&void 0!==r?r:e.nextValue,s={...this._canvasObjectPropsManager.getProps(n,e.nextIndex,t[0],t[1]),isActive:this._store.timelineSelectionStore.canvasUISelectedSegmentIds.includes(n.id)};return i&&Object.assign(s,{sequenceType:"sub",parentSegmentId:i.id,expandedSegment:i}),new d.TL(a.KX.Segment,n.id,{params:s,needUpdateStyle:this._shouldUpdateStyle(e),needResetThumbnail:this._shouldResetThumbnail(e)})}_shouldRender(e){return!0}_shouldUpdateStyle(e){for(let t of p)if((0,c.h)(e.notifyOperationList,t))return!0;return!1}_shouldResetThumbnail(e){for(let t of m)if((0,c.h)(e.notifyOperationList,t))return!0;return!1}constructor(e,t,i){this._store=e,this._modules=t,this._containerService=i,this._canvasObjectPropsManager=this._containerService.createInstance(s.V,this._store,this._modules)}}f=(0,r.gn)([(0,r.fM)(2,g.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineManagerModules?Object:TimelineManagerModules,void 0===g.t?Object:g.t])],f);var _=i("216331"),v=i("238605"),M=i("804497");class S{getRenderActionMap(e,t,i){let r=new Map,{expandedSegmentId:s}=this._store.timelineSelectionStore,o=s?(0,M.kt)(t,{id:s}):void 0,l=this._segmentCollection.getRenderActions(e[n.A.SEGMENT],null!=i?i:t,o);r.set(a.KX.Segment,l);let d=this._transitionCollection.getRenderActions(e[n.A.SEGMENT],null!=i?i:t);r.set(a.KX.Transition,d);let u=this._trackCollection.getRenderActions(e,t,i);return r.set(a.KX.Track,u),r}constructor(e,t,i){this._store=e,this._modules=t,this._containerService=i,this._segmentCollection=this._containerService.createInstance(f,this._store,this._modules),this._trackCollection=new _.b(this._store),this._transitionCollection=new v.e(this._store)}}S=(0,r.gn)([(0,r.fM)(2,g.t),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof TimelineManagerStore?Object:TimelineManagerStore,"undefined"==typeof TimelineManagerModules?Object:TimelineManagerModules,void 0===g.t?Object:g.t])],S)},853418:function(e,t,i){i.d(t,{x:function(){return n}});var r=i(75535);class n extends r.V{run(e){e.remove(this.key)}constructor(...e){super(...e),this.actionType="delete"}}},965033:function(e,t,i){i.d(t,{Q:function(){return r}});class r{run(e){e.layout("column")}constructor(){this.actionType="heightChange"}}},992775:function(e,t,i){i.d(t,{Z:function(){return r}});class r{create(e){this._prevCOs=e}getRecycleCO(e){var t;if(!(null===(t=this._prevCOs)||void 0===t?void 0:t.has(e)))return;let i=this._prevCOs.get(e);return this._prevCOs.delete(e),i}reset(){var e,t;let i=new Map(null===(e=this._prevCOs)||void 0===e?void 0:e.entries());return null===(t=this._prevCOs)||void 0===t||t.clear(),i}}},628499:function(e,t,i){i.d(t,{G:function(){return a}});var r=i(50305),n=i(573581);class a{get destroyed(){return this._destroyed}_createData(e){let t={};if(this.dataPropertyNames)for(let i of this.dataPropertyNames)t[i]=e[i];else Object.assign(t,e);return t}getVisible(){return this._visible&&this._inViewport}setVisible(e,t){let i=this._visible!==e;this._visible=e,i&&(this._children.forEach(t=>t.setVisible(e)),this._applyVisible()),t&&i&&this.render()}getContainer(){return"function"==typeof this._container?this._container():this._container}updateStyle(e,t){let i=Object.entries(e).some(e=>{let[t,i]=e;return!Object.is(i,this.style[t])});return i&&this._children.forEach(t=>{var i;return null===(i=t.updateStyle)||void 0===i?void 0:i.call(t,e,!1)}),Object.assign(this.style,e),t&&i&&this.render(),i}updateData(e,t,i){if(!this.data)return;i&&this._resetChildren();let r=this._areDataChanged(e);r&&this._children.forEach(r=>r.updateData(e,t,i)),Object.assign(this.data,e),t&&r&&(i||!this._isMounted||this._konvaNodes.length>0)&&this.render()}checkWillRender(e){let t=(0,n.T)(this.style,e);return this.getVisible()&&!t?this.remove():!this.getVisible()&&t&&this.add(),this._inViewport=t,this.setInViewport(t),this.getVisible()}setInViewport(e){this._inViewport=e,this._children.forEach(t=>t.setInViewport(e))}render(){if(!!this._inViewport)this.renderKonvaNodes(),this._children.forEach(e=>e.render())}renderKonvaNodes(){if(this._isMounted||this._destroyed)this.update();else{if(this._isMounting)return;let e=this.getContainer();if(!e)return;this._isMounting=!0;let t=this.mount();t instanceof Promise?t.then(t=>{void 0!==t&&this._isMounting&&(this._konvaNodes=[].concat(t),e.add(...this._konvaNodes),this._isMounted=!0,this.playTweens())}).finally(()=>{this._isMounting=!1}):t?(this._konvaNodes=[].concat(t),e.add(...this._konvaNodes),this._isMounted=!0,this._isMounting=!1,this.playTweens()):this._isMounting=!1}}mount(){}playTweens(){}update(){}layout(){}destroy(){this._destroyed=!0,this.clear(),this.data=null,this._children.forEach(e=>e.destroy()),this._children.length=0}clear(){this._isMounted=!1,this._isMounting=!1,this._children.forEach(e=>e.clear()),this._konvaNodes.forEach(e=>{e.off(),e.destroy(),e.parent=null}),this._konvaNodes.length=0,this._flatNodeMap.clear(),this._tweens.forEach(e=>{e.destroy()}),this._tweens.length=0,this._anims.forEach(e=>{e.stop()}),this._anims.length=0}remove(){this._children.forEach(e=>e.remove()),this._konvaNodes.forEach(e=>{e.remove()})}add(){this._children.forEach(e=>e.add());let e=this.getContainer();if(!!e)this._konvaNodes.forEach(t=>{!t.parent&&e.add(t)})}_applyVisible(){this._konvaNodes.forEach(e=>e.visible(this._visible))}resetData(){for(let e in this._children.forEach(e=>e.resetData()),this.data)delete this.data[e]}_resetChildren(){let e=[];for(let t of this._children){if(!t.destroyed)e.push(t),t.clearOnInit&&t.clear()}this._children=e}_areDataChanged(e){let t=0;if(this.dataPropertyNames){for(let i of Object.keys(e))this.dataPropertyNames.includes(i)&&(t+=1);if(0===t)return!1}return Object.entries(e).some(e=>{var t;let[i,r]=e;return!Object.is(r,null===(t=this.data)||void 0===t?void 0:t[i])})}constructor(e){this.clearOnInit=!1,this._children=[],this._konvaNodes=[],this._flatNodeMap=new Map,this._tweens=[],this._anims=[],this._isMounting=!1,this._inViewport=!0,this._visible=!0;let{layer:t,type:i,id:n,data:a,context:s,style:o,container:l}=e;this._layer=t,this.type=i,this.id=null!=n?n:`co-${i}-${Date.now()}`,this._isMounted=!1,this._destroyed=!1,this.data=this._createData(a),this.context=s,this._container=l,o?this.style=o:this.style=(0,r.H)()}}},772962:function(e,t,i){i.d(t,{x:function(){return h}});var r=i(932919),n=i(288712),a=i(563890),s=i(257296),o=i(202426),l=i(628499),d=i(804497),u=i(969242),c=i(125780);class h extends l.G{mount(){let{data:e}=this,{segment:t,beatsMap:i}=e,n=[];if("audio"===t.type&&(null==i?void 0:i.size)){let e=new r.Group;return Array.from(i.values()).forEach(e=>{n.push(this._createBeatIcon(e))}),e.add(...n),e}}update(){let{data:e,style:t}=this,[i]=this._konvaNodes;if(!!i)i.children.forEach(i=>{var r;let{x:n,y:a}=t,{originBeat:o}=i.attrs,{camera:l}=this.context,{segment:{duration:h,start:g,id:m,type:p},beatActiveFrame:f=0,beatsMap:_,cropSituation:v}=e;if("audio"!==p||!(null==_?void 0:_.size))return;let M=null===(r=_.get(o))||void 0===r?void 0:r.formatFrame;if(void 0===M)return;let S=!0;if(v&&m===v.segment.id){let{value:e,type:t}=v,r=g,n=h;"start"===t?n+=g-(r=e):n=e-r,S=(0,d.NT)(M,r,n),i.visible(S);return}let y=(0,d.pv)(M,l.zoom),T=1>=Math.abs(f-M);S=(0,d.NT)(M,g,h),!this.getVisible()&&(S=!1);let b=T?s.KQ*s.P3:s.P3,I=T?s.KQ*s.uw:s.uw,w=(0,u.vY)(l.zoom,g);i.setAttrs({x:y+(n-w),y:a,visible:S,width:b,height:I,offset:{x:b/2,y:I/2},image:T?c.J.LvIconBeatMarkerActive:c.J.LvIconBeatMarker})})}_createBeatIcon(e){var t,i,r;let{data:l,style:u,context:h}=this,{segment:g,beatActiveFrame:m=0}=l,{y:p}=u,{id:f,start:_,duration:v}=g,{events:M,camera:S}=h,{originBeat:y,formatFrame:T}=e,b=new n.Image({image:c.J.LvIconBeatMarker}),I=(0,d.pv)(T,S.zoom),w=1>=Math.abs(m-T),k=(0,d.NT)(T,_,v),A=w?s.KQ*s.P3:s.P3,C=w?s.KQ*s.uw:s.uw;return b.setAttrs({x:I,y:p,width:A,height:C,offset:{x:A/2,y:C/2},id:y.toString(),name:(0,a.Vo)(f,s.KX.Segment,s.CD.Beat),image:w?c.J.LvIconBeatMarkerActive:c.J.LvIconBeatMarker,originBeat:y,formatFrame:T,visible:k}),t=b,i=M,r=g,t.on("mousedown",e=>{e.cancelBubble=!0,e.evt.stopPropagation(),i.interact.emit(o.TY.onBeatMouseDown,e.evt.clientX,e.target.attrs,r)}),t.on("mouseenter",()=>{document.body.style.cursor="ew-resize"}),t.on("mouseleave",()=>{document.body.style.cursor="default"}),b}constructor(e){super({...e,container:e.layer.getChildren(e=>e.id()===s.PB.BeatsGroup)[0],type:s.KX.Default}),this.dataPropertyNames=["segment","beatsMap","beatActiveFrame","cropSituation"],this.clearOnInit=!0}}},51173:function(e,t,i){i.d(t,{J:function(){return h}});var r=i(932919),n=i(563890),a=i(257296),s=i(628499),o=i(931774),l=i(680145),d=i(125682),u=i(928261);let c={listening:!1,image:a.PM};class h extends s.G{updateNodes(e,t,i){var r,n,s,o,l;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;arguments.length>4&&arguments[4];let{width:u,height:c,x:h,y:g}=t,m=a.me+2*a.Dx+d,{data:{vipBadgeType:p}}=this,f="legacy-vip"===p?a.Jl:a.Q3,_=a.me+a.me+3*a.Dx+d,v={x:f+a.j8,y:0,visible:!(u<_)};null===(n=this.stikcerIcon)||void 0===n||null===(r=n.setAttrs)||void 0===r||r.call(n,i?v:{x:0,visible:!(u<m)}),null===(o=this.vipIcon)||void 0===o||null===(s=o.setAttrs)||void 0===s||s.call(o,{visible:!!i&&!(u<a.me+2*a.Dx+d)});let M=h+a.Dx+d,S=g+(c-((null===(l=this.stikcerIcon)||void 0===l?void 0:l.height())||a.RB))/2;e.x(M),e.y(S)}addProIcon(e){let{data:{vipBadgeType:t}}=this,i="legacy-vip"===t?a.Jl:a.Q3,r="legacy-vip"===t?a.rY:a.op,n=(0,d.V)(t),s=(0,o.Hk)(this,n,l.N[n],{...c,x:0,y:(a.RB-r)/2,height:r,width:i});this.vipIcon=s,e.add(s)}mount(){let{data:e,style:t}=this,{segment:i,isVip:s,vipBadgeType:l}=e;if(!u.oP.includes(i.type))return;let{x:d,y:h,width:g,height:m}=t,{id:p}=i,f=new r.Group({listening:!1,name:(0,n.Vo)(p,a.KX.Segment,a.CD.Icon),x:d,y:h,height:m,width:g});if("sticker"===i.type&&i.iconUrl){let e=i.iconUrl,t=(0,o.Hk)(this,e,e,{...c,height:a.RB},e=>{if(!t)return;let r=a.me,n=a.RB;e.width>e.height?n=e.height/e.width*a.me:r=e.width/e.height*a.RB,t.setAttrs({image:e,width:r,height:n});let s="video"===i.type?h+a.WY:h+(m-(t.height()||a.RB))/2;f.y(s)});this.stikcerIcon=t,f.add(t)}let _="video"===i.type;return s&&!_&&this.addProIcon(f),this.updateNodes(f,t,s,void 0),f}update(){let e=this._konvaNodes[0],{style:t,data:i}=this,{width:r}=t,{segment:n,isLoading:s,isLost:o,isActive:l,isHover:d,isVip:u}=i,c="template-post"===this.context.mode?a.VV:0,h="video"===n.type;u&&!h&&!this.vipIcon&&this.addProIcon(e),this.updateNodes(e,t,u,c),s||o||l||d?e.visible(!1):e.visible(!(r<a.me+2*a.Dx+c))}constructor(...e){super(...e),this.dataPropertyNames=["segment","isLoading","isLost","isActive","isHover","isVip"]}}},406036:function(e,t,i){i.d(t,{Z:function(){return u}});var r=i(257296),n=i(288712),a=i(563890),s=i(628499),o=i(125780);let l=r.jf/2,d=r.vr/2;class u extends s.G{active(e){this.isActive=e}mount(){let{x:e,y:t,width:i,height:s}=this.style,u=new n.Image({image:o.J.LvIconKeyframe,listening:!1});return u.setAttrs({x:e,y:t,width:i,height:s,offset:{x:l,y:d},image:this.isActive?o.J.LvIconKeyframeActive:o.J.LvIconKeyframe,name:(0,a.Vo)(this.id,r.KX.Segment,r.CD.Keyframe)}),u.visible(this.getVisible()),u}update(){let e=this._konvaNodes[0];if(!e)return;if(!this.getVisible()){e.visible(!1);return}let{x:t,y:i,width:r,height:n}=this.style;e.setAttrs({x:t,y:i,width:r,height:n,image:this.isActive?o.J.LvIconKeyframeActive:o.J.LvIconKeyframe})}constructor(e){let{visible:t}=e;super(e),this.isActive=!1,this._visible=!1,this._visible=null!=t&&t}}},917954:function(e,t,i){i.d(t,{YF:function(){return Z}});var r=i(257296),n=i(251976),a=i(202426),s=i(721244),o=i(288712),l=i(620183),d=i(559408),u=i(932919),c=i(597210),h=i(563890),g=i(384971),m=i(426336),p=i(931774),f=i(628499),_=i(857458),v=i(969242),M=i(125780),S=i(960913),y=i(584341);let T=r.Dx+r.me+8,b=e=>{let{height:t}=e;return new o.Image({name:"icon",image:M.J.LvIconMusic,verticalAlign:"middle",width:r.me,height:r.RB,listening:!1,offsetX:r.me/2,offsetY:r.RB/2,x:12+r.me/2,y:t/2})};function I(){return _.F.t("web_musicreplace_text_drag_add_music",{},"Drag and drop music here")}function w(){return _.F.t("web_musicreplace_text_music_in_template",{},"Sound in template")}function k(e){return 0===e.button}let A=e=>new l.Rect({name:"background",listening:!1,cornerRadius:4,...e}),C=e=>new d.Text({name:"text",y:0,verticalAlign:"middle",fill:n.wL.lvvColorTextContentPrimary,fontSize:r.HP,fontWeight:500,listening:!1,...e}),D=e=>{let{parentGroup:t,style:i,replaceHover:r}=e,a=(0,h.DM)(t,"replace_hover_group"),{height:s}=i,o=(0,g.C5)(i.width);if(a)r?(a.setAttrs({visible:!0}),(0,h.DM)(a,"background").setAttrs({width:o,height:s}),(0,h.DM)(a,"icon").setAttrs({y:s/2})):a.setAttrs({visible:!1});else{a=new u.Group({visible:!1,listening:!1,name:"replace_hover_group",width:o,height:s});let e=b({height:s}),t=A({width:o,height:s,fill:n.wL.segmentAudioReplaceHoverColor,cornerRadius:(0,g.yW)(o)});e.setAttrs({image:M.J.LvIconReplace});let i=C({text:_.F.t("web_replace",{},"Replace"),x:T,height:s});a.add(t,e,i)}return a},x=e=>{let t;let{anims:i,loading:r,layer:n,parentGroup:a,style:s}=e,o=(0,h.DM)(a,"loading"),{height:l}=s;if(o)t=(0,h.DM)(o,"icon");else{o=new u.Group({name:"loading",listening:!1}),(t=b({height:l})).setAttrs({image:M.J.IconClipSameLoading});let e=C({text:_.F.t("load_web_ing",{},"\u52A0\u8F7D\u4E2D"),x:T,height:l});o.add(t,e)}let d=null==i?void 0:i[0];if(r){if(o.setAttrs({visible:!0}),!d){let e=new c.Animation(function(e){if(e&&r){let i=180*e.timeDiff/1e3;t.rotate(i)}else t.rotation(0)},n);e.start(),null==i||i.push(e)}}else d&&(d.stop(),t.rotation(0),i.shift()),o.setAttrs({visible:!1});return o},P=e=>{let{parentGroup:t,style:i,visible:r}=e,a=(0,h.DM)(t,"lost"),{height:s}=i,o=(0,g.C5)(i.width);if(a)r?(a.setAttrs({visible:!0}),(0,h.DM)(a,"background").setAttrs({width:o,height:s,cornerRadius:(0,g.yW)(o)}),(0,h.DM)(a,"icon").setAttrs({y:s/2})):a.setAttrs({visible:!1});else{a=new u.Group({visible:!1,listening:!1,name:"lost",width:o,height:s});let e=b({height:s});e.setAttrs({image:M.J.Warning});let t=A({width:o,height:s,fill:n.wL.segmentAudioLostColor,cornerRadius:(0,g.yW)(o)}),i=C({text:_.F.t("web_materialSearch_text_lost_audio",{},"Lost audio"),x:T,height:s});a.add(t,e,i)}return a},E=e=>{let{style:t,segment:i,context:n,canvasObject:s,anims:o,layer:d,data:c}=e,{status:p,isLost:f}=c,{title:_}=i,{width:v,height:M}=t,S=(0,g.C5)(v),y=new u.Group({name:"normal",width:t.width,height:t.height,visible:i.metaType!==m.cVg.MetaTypeNone}),A=P({style:t,parentGroup:y,visible:!!f}),D=x({loading:"loading"===p,anims:o,layer:d,parentGroup:y,style:t}),E=new u.Group({name:"title"}),N=b({height:M}),R=C({y:0,text:_,x:T,height:M}),L=new l.Rect({name:(0,h.Vo)(i.id,r.KX.Segment,r.CD.MutableAudio),width:S,height:M});return E.add(N,R,L),y.add(E,A,D),L.on("mouseenter",()=>{var e;if(null===(e=s.data)||void 0===e?!void 0:!e.isLost)R.text(I())}),L.on("mouseleave",()=>{var e;if(null===(e=s.data)||void 0===e?void 0:e.isLost)return;let{segment:t}=null==s?void 0:s.data;R.text((null==t?void 0:t.title)||w())}),L.on("dblclick",e=>{var t;let{evt:r}=e;if(!!k(r)&&(null==s?!void 0:null===(t=s.data)||void 0===t?!void 0:!t.isLost))n.events.interact.emit(a.TY.onAudioEnterTrim,i.id),setTimeout(()=>{document.body.style.cursor="grab"},0)}),y},N=e=>{var t;let{status:i,isLost:r,isHover:a}=e,s=r?_.F.t("web_materialSearch_text_lost_audio",{},"Lost audio"):"loading"===i?_.F.t("load_web_ing",{},"\u52A0\u8F7D\u4E2D"):a?I():(null==e?void 0:null===(t=e.segment)||void 0===t?void 0:t.title)||w(),o=r?M.J.Warning:"loading"===i?M.J.IconClipSameLoading:M.J.LvIconMusic;return{textContent:s,iconUrl:o,bgColor:r?n.wL.segmentAudioLostColor:void 0}},R=e=>{let{data:t,style:i,group:n,anims:a,layer:s}=e,o=(0,h.DM)(n,"title"),{replaceHover:l,status:d}=t,{textContent:u,iconUrl:c}=N(t),{width:m,height:p}=i,f="loading"===d,_=(0,g.C5)(m);if(x({anims:a,loading:!!f&&!l,layer:s,style:i,parentGroup:n}),P({parentGroup:n,style:i,visible:!!t.isLost&&!l}),f)o.setAttrs({visible:!1});else{if(l)o.setAttrs({visible:!1});else{var v;o.setAttrs({visible:!0});let e=(0,h.DM)(o,"text"),t=(0,h.DM)(o,"icon"),i=null===(v=o.children)||void 0===v?void 0:v[3];e.text(u),t.setAttrs({image:c,x:12+t.offsetX(),y:p/2-r.RB/2+t.offsetY()}),null==i||i.setAttrs({width:_,height:p})}n.setAttrs({width:m,height:p}),n.clip({x:0,y:0,width:_,height:p})}},L=e=>{let{context:t,style:i,segment:s,data:o,group:d,canvasObject:c,anims:p,layer:f}=e,{status:_}=o,v=(0,g.C5)(i.width),M=new u.Group({name:"focus",width:v,height:i.height,visible:s.metaType!==m.cVg.MetaTypeNone}),{title:S,duration:T}=s,b=P({style:i,parentGroup:d,visible:!!o.isLost}),I=new u.Group({y:r.wc,listening:!1,name:"audio_duration"}),w=C({x:r.Kp,height:14}),E=A({fill:n.wL.lvvColorBlack04,height:14});w.text((0,y.ci)(m.pMA.div(T,1e3),"?mm:ss:ff",30,!0)),E.width(w.x()+w.getTextWidth()+r.Kp),I.add(E,w);let N=new u.Group({y:r.wc,listening:!1,name:"audio_title",x:r.z6}),R=C({x:r.Kp,height:14});R.text(S);let L=A({fill:n.wL.lvvColorBlack04,height:14});L.width(R.x()+R.getTextWidth()+r.Kp),N.add(L,R),M.add(N,I,b);let j=D({style:i,parentGroup:M,replaceHover:!1});M.add(j);let O=new l.Rect({name:(0,h.Vo)(s.id,r.KX.Segment,r.CD.MutableAudio),width:i.width,height:i.height});M.add(O);let B=x({loading:"loading"===_,anims:p,layer:f,parentGroup:d,style:i});return M.add(B),O.on("dblclick",e=>{var i;let{evt:r}=e;if(!!k(r)&&(null==c?!void 0:null===(i=c.data)||void 0===i?!void 0:!i.isLost))t.events.interact.emit(a.TY.onAudioEnterTrim,s.id),document.body.style.cursor="grab"}),M},j=e=>{var t;let{group:i,segment:n,data:a,style:s,anims:o,layer:l}=e,{replaceHover:d,isLost:u,status:c}=a,f="loading"===c,{width:_,height:v}=s,M=(0,g.C5)(_),S=(0,h.DM)(i,"audio_title"),T=(0,h.DM)(i,"audio_duration"),b=null!==(t=i.children)&&void 0!==t?t:[],I=b.length?b[b.length-1]:null;I&&I.setAttrs({width:M,height:v});let{duration:w}=n,{textContent:k}=N(a);if(D({style:s,replaceHover:!!d,parentGroup:i}),x({loading:!!f&&!d,anims:o,layer:l,parentGroup:i,style:s}),P({style:s,visible:!!u&&!d,parentGroup:i}),f)S.setAttrs({visible:!1}),T.setAttrs({visible:!1});else if(S.setAttrs({visible:!0}),T.setAttrs({visible:!0}),d)T.setAttrs({visible:!1}),S.setAttrs({visible:!1});else{T.setAttrs({visible:!0}),S.setAttrs({visible:!0});let e=(0,h.DM)(S,"background"),t=(0,h.DM)(S,"text");t.text(k),e.width(t.x()+t.getTextWidth()+r.ZT);let n=(0,h.DM)(T,"background"),a=(0,h.DM)(T,"text");a.text((0,y.ci)(m.pMA.div(w,1e3),"?mm:ss:ff",30,!0)),n.width(a.x()+a.getTextWidth()+r.ZT);let s=(0,p.cx)(i,T,r.Kp);T.x(s+r.z6-r.Kp)}i.clip({x:0,y:0,width:M,height:v})},O=e=>{let{context:t,style:i,data:r}=e,{segment:o}=r,{width:d,height:c}=i,h=(0,g.C5)(d),p=new u.Group({name:"edit",width:d,height:c,visible:o.metaType!==m.cVg.MetaTypeNone}),f=new l.Rect({name:"background",width:h,height:c,fill:n.SU.audio}),_=new u.Group({name:"drag",width:d,height:c,draggable:!0,dragBoundFunc(e){let{parent:i}=this,{width:r}=this.attrs,n=null==i?void 0:i.attrs.width,s=(null==i?void 0:i.absolutePosition().x)||0,l=e.x-s,d=s+(n-l>r?n-r:l>=0?0:l);return t.events.interact.emit(a.TY.onAudioTrimming,o.id,d-s),{x:d,y:this.absolutePosition().y}}}),v=A({name:"background",width:h,height:c,fill:n.SU.audio,cornerRadius:(0,g.yW)(d)}),M=new l.Rect({name:"image",height:c,width:h,cornerRadius:(0,g.yW)(d)});return _.add(v,M),p.add(f,_),p.on("dblclick",e=>{let{evt:i}=e;if(!!k(i))p.setAttrs({visible:!1}),t.events.interact.emit(a.TY.onAudioExitTrim,s.o.NORMAL),document.body.style.cursor="default"}),p.on("mouseenter",()=>{document.body.style.cursor="grab"}),p.on("mouseleave",()=>{document.body.style.cursor="default"}),p.on("mousemove",()=>{document.body.style.cursor="grab"}),p},B=e=>{var t;let{segment:i,context:r,data:a,style:s,group:o}=e,{audio:l}=a,{width:d,height:u}=s,{wavesImage:c,realWidth:m}=null!=l?l:{},p=(0,h.DM)(o,"drag");if(!c)return;let{prolong:f}=i,{start:_=0n}=null!=f?f:{},M=u/c.height,{zoom:S}=r.camera,y=(0,h.DM)(p,"image");(0,h.DM)(p,"background").setAttrs({width:m,height:u,fill:n.SU.audio,opacity:.3,cornerRadius:(0,g.yW)(d)}),p.setAttrs({width:m,height:u,x:-(0,v.vY)(S,_)}),y.setAttrs({width:m,cornerRadius:(0,g.yW)(d)}),y.fillPriority("pattern"),y.fillPatternImage(c),y.fillPatternScale({x:M,y:M}),y.fillPatternRepeat("repeat-x");let T=(0,g.C5)(d),b=null===(t=o.children)||void 0===t?void 0:t[0];b&&b.setAttrs({width:T,height:u,cornerRadius:(0,g.yW)(T)}),o.setAttrs({width:T,height:u})};function z(e){let{width:t,height:i}=e,n=(0,g.C5)(t),a=(0,g.yW)(n,r.kT);return{x:a/2,y:a/2,width:n-a,height:i-a,strokeWidth:a,cornerRadius:(0,g.yW)(n)}}let U=e=>{let{style:t,context:i,canvasObject:s,data:o}=e,l=new u.Group({name:"empty",width:t.width,height:t.height}),{track:d}=o,{x:c,y:h,width:g,height:m,strokeWidth:p,cornerRadius:f}=z(t),v=d.segments.length<=2,S=A({name:"background",width:g,height:m,x:c,y:h,fill:n.wL.lvvColorFillTransparencyBlock,cornerRadius:f,dash:[4,2],stroke:n.wL.lvvColorLine1,strokeWidth:p,listening:!0}),y=C({visible:v,text:_.F.t("web_musicreplace_text_drag_add_music",{},"To add music, drag and drop music here, or select music track and click music to add"),x:r.Dx+8,height:t.height,fill:n.wL.segmentAudioEmptyTextColor}),T=b({height:t.height});return T.setAttrs({visible:v,image:M.J.LvIconReplaceGrey}),l.add(S,T,y),l.on("click",()=>{var e;i.events.interact.emit(a.TY.onAudioPlaceholderClick,null===(e=s.data)||void 0===e?void 0:e.segment)}),S.on("mouseenter",()=>{!s.data.isActive&&(document.body.style.cursor="pointer")}),S.on("mouseleave",()=>{document.body.style.cursor="default"}),l},V=e=>{let{group:t,style:i,data:r}=e,{isActive:a,replaceHover:s,track:o}=r,l=(0,h.DM)(t,"background"),{x:d,y:u,width:c,height:g,strokeWidth:m,cornerRadius:p}=z(i),f=(0,h.DM)(t,"text"),_=(0,h.DM)(t,"icon"),v=o.segments.length<=2,S={},y={},b={};v?(Object.assign(y,{visible:!0}),Object.assign(b,{visible:!0})):(Object.assign(y,{visible:!1}),Object.assign(b,{visible:!1})),s||a?Object.assign(S,{stroke:void 0}):Object.assign(S,{stroke:n.wL.lvvColorLine1}),s?(Object.assign(S,{fill:n.wL.lvvColorMain02}),Object.assign(y,{fill:n.wL.lvvColorMainDefault}),Object.assign(b,{image:M.J.LvIconMusicReplaceHover})):(Object.assign(S,{fill:n.wL.lvvColorFillTransparencyBlock}),Object.assign(y,{fill:n.wL.segmentAudioEmptyTextColor}),Object.assign(b,{image:M.J.LvIconMusicEmpty})),l.setAttrs({x:d,y:u,width:c,height:g,cornerRadius:p,strokeWidth:m,...S}),f.setAttrs({x:T,height:i.height,...y}),_.setAttrs({y:i.height/2,...b}),t.setAttrs({width:c,height:g}),t.clip({x:0,y:0,width:c+m,height:g+m})};class Z extends f.G{mount(){let{data:e,style:t}=this,{segment:i}=e,{id:n}=i,s=this.context;if("end-limit"===n)return new u.Group;i.metaType===m.cVg.MetaTypeNone&&s.events.interact.emit(a.TY.onAudioShowMuteModal,n);let{x:o,y:l,width:d,height:c}=t,p=(0,g.C5)(d),f=new u.Group({x:o,y:l,width:p,height:c,name:(0,h.Vo)(n,r.KX.Segment,r.CD.MutableAudio)});f.on("mousedown",()=>{s.events.interact.emit(a.TY.onSwitchSideTab,S.kh)});let _=E({style:t,segment:i,context:s,canvasObject:this,data:e,anims:this._anims,layer:this._layer}),v=L({style:t,segment:i,data:e,canvasObject:this,group:f,context:s,anims:this._anims,layer:this._layer}),M=O({style:t,data:e,canvasObject:this,context:s}),y=U({style:t,context:s,canvasObject:this,data:e});return f.add(y,_,v,M),this._flatNodeMap.set("Group",f),this.update(),f}update(){let{data:e,style:t}=this,i=this.context,r=this._flatNodeMap.get("Group"),{audio:n,segment:o,isActive:l}=e,{id:d,metaType:u}=o;if("end-limit"===d)return;let{status:c=s.o.NORMAL}=null!=n?n:{},{x:p,y:f,width:_,height:v}=t,M=(0,g.C5)(_),S=(0,h.DM)(r,"normal"),y=(0,h.DM)(r,"focus"),T=(0,h.DM)(r,"edit"),b=(0,h.DM)(r,"empty");if(S.setAttrs({visible:!1}),y.setAttrs({visible:!1}),T.setAttrs({visible:!1}),b.setAttrs({visible:!1}),u===m.cVg.MetaTypeNone)b.setAttrs({visible:!0}),V({data:e,group:b,style:t});else{if(!l&&c!==s.o.NORMAL){c===s.o.EDIT&&i.events.interact.emit(a.TY.onAudioExitTrim,s.o.NORMAL);return}switch(l&&c!==s.o.EDIT&&(c=s.o.FOCUS),c){case s.o.EDIT:B({data:e,style:t,segment:o,context:i,group:T}),T.setAttrs({visible:!0});break;case s.o.FOCUS:y.setAttrs({visible:!0}),j({data:e,group:y,segment:o,style:t,anims:this._anims,layer:this._layer});break;case s.o.NORMAL:S.setAttrs({visible:!0}),R({data:e,group:S,segment:o,style:t,layer:this._layer,anims:this._anims})}}r.setAttrs({x:p,y:f,width:M,height:v})}constructor(...e){super(...e),this.dataPropertyNames=["audio","isActive","segment","status","isLost","replaceHover","track"]}}},876813:function(e,t,i){i.d(t,{L:function(){return A}});var r=i(644314),n=i(202426),a=i(628499),s=i(612350),o=i(597210),l=i(932919),d=i(620183),u=i(559408),c=i(288712),h=i(563890),g=i(257296),m=i(251976),p=i(931774),f=i(389267),_=i(384971),v=i(933162),M=i(680145);let S="group",y="mask",T="border",b="button",I="icon",w="text",k="lockedMask";class A extends a.G{_updateX(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=e.x();if(!!t&&r!==t)if(void 0!==r&&i){var n;null===(n=e.tween)||void 0===n||n.finish();try{let i=new s.Tween({node:e,easing:s.Easings.Linear,x:t,duration:.1});i.play(),this._tweens.push(i),e.tween=i}catch(e){}}else e.x(t)}_updateGroup(){let e=this._flatNodeMap.get(S),{displayWidth:t,groupHover:i}=this._displayAttrs,{groupX:r,groupY:n,groupHeight:a}=(0,v.G7)({renderStatus:this._slotRenderStatus,style:this.style,groupHover:i});e.setAttrs({x:r,y:n,width:t,height:a}),e.clip({x:0,y:0,width:t,height:a})}_updateMask(){let e=this._flatNodeMap.get(y),{displayWidth:t,groupHover:i,buttonHover:r}=this._displayAttrs,{maskFillColor:n}=(0,v.hQ)({renderStatus:this._slotRenderStatus,groupHover:i,buttonHover:r});e.setAttrs({width:t,height:this.style.height,cornerRadius:(0,_.yW)(t,g.LY-2),fill:n})}_updateLockedMask(){let e=this._flatNodeMap.get(k),{showMask:t,maskImage:i}=(0,v.Zf)({renderStatus:this._slotRenderStatus,groupHover:this._displayAttrs.groupHover,buttonHover:this._displayAttrs.buttonHover});if(t&&i){let{displayWidth:t}=this._displayAttrs;e.setAttrs({width:t,height:this.style.height}),!e.getAttr("fillPatternImage")&&(0,p.oS)(this,i,M.N[i],e,{fillPatternRepeat:"repeat-x",cornerRadius:(0,_.yW)(t,g.LY-2)}),e.visible(!0)}else e.setAttrs({fillPatternImage:void 0}),e.visible(!1)}_updateBorder(){let e=this._flatNodeMap.get(T),{displayWidth:t,groupHover:i,buttonHover:r}=this._displayAttrs,{borderX:n,borderHeight:a,borderWidth:s,borderStrokeWidth:o}=(0,v.$e)({style:this.style,groupHover:i,buttonHover:r});e.setAttrs({x:n,y:n,width:s,height:a,cornerRadius:(0,_.yW)(t,g.LY-2),strokeWidth:o,stroke:!this.data.replaceHover&&(r||i)?m.wL.lvvColorWhite02:m.wL.lvvColorLine2})}_updateButtonGroup(){let e=this._flatNodeMap.get(w),t=this._flatNodeMap.get(I),i=this._flatNodeMap.get(b),r=this._flatNodeMap.get(y),n=this._flatNodeMap.get(k),a=this._flatNodeMap.get(T),{displayWidth:s,groupHover:o,buttonHover:l}=this._displayAttrs,{height:d}=this.style,u=(0,p.Ko)(this.style,this.context.camera),c=(0,v.rK)({renderStatus:this._slotRenderStatus,groupHover:o,buttonHover:l,existText:e.children[0]}),{multiple:h,locked:f,visible:_}=this._slotRenderStatus,{textContent:M,textFill:S,textPadding:A}=c,{empty:C,buttonFill:D,full:x,padding:P,buttonHeight:E,buttonWidth:N,showOnlyIcon:R,strokeWidth:L}=(0,v.RJ)({renderStatus:this._slotRenderStatus,buttonHover:l,context:this.context,style:this.style,textAttrs:c}),{iconUrl:j,iconHeight:O}=(0,v.Aw)({renderStatus:this._slotRenderStatus,groupHover:o,buttonHover:l}),B=(0,v.Mx)(this._slotRenderStatus,o);if(C)t.visible(!1),e.visible(!1),r.visible(!0),n.visible(!1),i.setAttrs({visible:!0,x:0,y:0,width:N,height:E,fill:D,strokeWidth:L});else if(0===B)r.visible(!_),i.visible(!1),e.visible(!1),t.visible(!1),a.visible(!0);else{if(x&&!h&&!f)for(let e of Array.from(this._flatNodeMap.values()))e.visible(!0);r.visible(!0),n.visible(!0),t.visible(!0),R?e.visible(!1):e.visible(!0);let a=s/2-N/2+u,o=a+P+t.offsetX(),l=o+g.me-t.offsetX()+A;if(i.setAttrs({visible:!0,y:(d-E)/2,width:N,height:E,fill:D}),t.setAttrs({y:d/2-g.RB/2+t.offsetY()}),t.children.forEach(e=>{t.setAttrs({width:g.me,height:O})}),h||f){var z,U;null===(z=t.children[0])||void 0===z||z.setAttrs({shadowForStrokeEnabled:!1,shadowColor:m.wL.lvvColorBlack04,shadowOffsetX:0,shadowOffsetY:1,shadowBlur:4}),null===(U=e.children[0])||void 0===U||U.setAttrs({shadowForStrokeEnabled:!1,shadowColor:m.wL.lvvColorBlack04,shadowOffsetX:0,shadowOffsetY:1,shadowBlur:4})}e.setAttrs({y:d/2-g.RB/2+A/2}),e.children.forEach(e=>{e.setAttrs({text:M,fill:S})}),this._updateX(i,a,!1),this._updateX(t,o,!1),this._updateX(e,l,!1)}t.children.forEach(e=>{e.image(j)})}_updateAnimations(){let{data:e,_anims:t,_layer:i}=this,{groupHover:r}=this._displayAttrs,n=this._flatNodeMap.get(I),a=null==t?void 0:t[0];if(("loading"!==e.status||!e.segment.visible)&&a&&(a.stop(),n.rotation(0),t.shift()),"loading"===e.status&&!a&&e.segment.visible){let a=new o.Animation(function(t){if(!t||"loading"!==e.status||e.loadingCancelable&&r)n.rotation(0);else{let e=180*t.timeDiff/1e3;n.rotate(e)}},i);a.start(),null==t||t.push(a)}}updateNodes(){let{data:e,style:t}=this,{width:i}=t,r=(0,_.C5)(i),n=(0,v.Ss)(e);this._displayAttrs={...this._displayAttrs,displayWidth:r},this._slotRenderStatus=n,this._updateGroup(),this._updateMask(),this._updateLockedMask(),this._updateBorder(),this._updateButtonGroup(),this._updateAnimations()}mount(){let{data:e,style:t,context:i}=this,{events:a}=i,{segment:s}=e;if(!(0,r.Dt)(s))return;let{mutable:o}=s;if(!o)throw Error("segment mutable missing");let M=(0,v.Ss)(e),{x:A,y:C,width:D,height:x}=t,{id:P}=s,E=(0,_.C5)(D),N=new l.Group({x:A+g.iX,y:C,width:E,height:x,name:(0,h.Vo)(P,g.KX.MutableButton,g.CD.MutableButton)});this._flatNodeMap.set(S,N);let R=new d.Rect({cornerRadius:6,name:(0,h.Vo)(P,g.KX.MutableButton,g.CD.MutableButtonBg),stroke:m.wL.lvvColorWhite012,strokeWidth:M.multiple&&!M.status||M.locked?0:1});this._flatNodeMap.set(b,R);let{buttonHover:L,groupHover:j}=this._displayAttrs,O=new d.Rect({width:E,height:x,fill:(0,v.hQ)({renderStatus:M,buttonHover:L,groupHover:j}).maskFillColor,cornerRadius:(0,_.yW)(E,g.LY-2),name:(0,h.Vo)(P,g.KX.MutableButton,g.CD.MutableButton)});this._flatNodeMap.set(y,O);let B=new d.Rect({cornerRadius:(0,_.yW)(E,g.LY-2),name:(0,h.Vo)(P,g.KX.MutableButton,g.CD.MutableButton)});this._flatNodeMap.set(T,B);let{textContent:z,textFill:U,textPadding:V}=(0,v.rK)({renderStatus:M,groupHover:j,buttonHover:L,existText:void 0}),Z=new u.Text({text:z,fontSize:12,height:20,padding:V,fill:U,fontStyle:"bold",align:"center",name:(0,h.Vo)(P,g.KX.MutableButton,g.CD.MutableButton),listening:!1}),F=(0,v.X5)({id:P,type:g.KX.MutableButton,nodeType:g.CD.MutableButton,shape:Z});this._flatNodeMap.set(w,F);let{iconUrl:G}=(0,v.Aw)({renderStatus:M,groupHover:j,buttonHover:L}),W=new c.Image({image:G,height:g.RB,width:g.me}),Y=(0,v.X5)({id:P,type:g.KX.MutableButton,nodeType:g.CD.MutableButton,shape:W});this._flatNodeMap.set(I,Y),Y.setAttrs({verticalAlign:"middle",name:(0,h.Vo)(P,g.KX.MutableButton,g.CD.MutableButton),listening:!1,offsetX:g.me/2,offsetY:g.RB/2});let H=new d.Rect({x:0,y:0,width:E,height:x,name:(0,h.Vo)(P,g.KX.MutableButton,g.CD.MutableButton),listening:!1});return H.visible(!1),this._flatNodeMap.set(k,H),N.add(O,H,B,R,Y,F),this.updateNodes(),R.on("mouseenter",()=>{this._displayAttrs={...this._displayAttrs,buttonHover:!0};let r=(0,v.Ss)(this.data),n=(0,v.rK)({renderStatus:r,existText:F.children[0]}),{full:a}=(0,v.RJ)({renderStatus:r,style:t,context:i,textAttrs:n}),o=(0,v.pZ)(r),{gamePlayFailed:l,gamePlayProcessing:d,visible:u}=r;if(!l)!u&&(0,v.PD)(i,t,s,o),(d||!a&&!("loading"===e.status&&!e.loadingCancelable))&&(0,v.PD)(i,t,s,o),this.updateNodes()}),R.on("mouseleave",()=>{if(this._displayAttrs={...this._displayAttrs,buttonHover:!1},"failed"!==e.status||!e.gamePlayProcessing)(0,v.IG)(a),this.updateNodes()}),R.on("click",()=>{let{segment:r,status:o}=e,{x:l,y:d,width:u}=t,c=(0,v.Ss)(this.data),h=(0,v.rK)({renderStatus:c,existText:F.children[0]}),{empty:g}=(0,v.RJ)({renderStatus:c,style:t,context:i,textAttrs:h}),{locked:m,filled:f,multiple:_,gamePlayProcessing:M,visible:S}=c;if(!m&&!_){if((0,v.IG)(a),!S){a.interact.emit(n.TY.clickHideMutableSegment,s.id,!0);return}if(g)a.interact.emit(n.TY.popupButton,{x:l+u/2,y:d},r,o);else{if(f||"loading"===o||"failed"===o){a.interact.emit(n.TY.popupMenu,{x:l+u/2+(0,p.Ko)(t,i.camera),y:d},r,M,o);return}a.interact.emit(n.TY.uploadMaterialToMutable,r)}}}),N.on("mouseenter",e=>{this._displayAttrs={...this._displayAttrs,groupHover:!0},(0,f.Ay)(N,"pointer");let r=(0,v.Ss)(this.data),o=(0,v.rK)({renderStatus:r,existText:F.children[0]}),{empty:l}=(0,v.RJ)({renderStatus:r,style:t,context:i,textAttrs:o});if(l){let e=(0,v.pZ)(r);(0,v.PD)(i,t,s,e)}null==a||a.interact.emit(n.TY.onMutableButtonMouseEnter,e),this.updateNodes()}),N.on("mouseleave",e=>{(0,f.Ay)(N,"inherit"),this._displayAttrs={...this._displayAttrs,groupHover:!1},(0,v.IG)(a),null==a||a.interact.emit(n.TY.onMutableButtonMouseLeave,e),this.updateNodes()}),N.on("mousedown",()=>{let{segment:r}=e,{x:s,y:o,width:l}=t,d=(0,v.Ss)(this.data),u=(0,v.rK)({renderStatus:d,existText:F.children[0]}),{empty:c}=(0,v.RJ)({renderStatus:d,style:t,context:i,textAttrs:u});d.multiple?a.interact.emit(n.TY.popupMutablePolyChild,{x:s+l/2,y:o},r):c&&setTimeout(()=>{a.interact.emit(n.TY.popupButton,{x:s+l/2,y:o},r,e.status)},100),(0,v.IG)(a)}),N}update(){let{data:e,style:t}=this,{segment:i}=e;if(!(0,r.Dt)(i))return;let a=this._flatNodeMap.get(w);this.updateNodes();let s=(0,v.Ss)(this.data),o=(0,v.rK)({renderStatus:s,existText:a.children[0]}),{empty:l}=(0,v.RJ)({renderStatus:s,style:t,context:this.context,textAttrs:o});if(l){let{width:r,x:a,y:s}=t;if(l&&e.status&&e.status!==this._status){var d;null===(d=this.context)||void 0===d||d.events.interact.emit(n.TY.popupButton,{x:a+r/2,y:s},i,e.status)}}this._status=e.status}destroy(){(0,v.IG)(this.context.events),super.destroy()}constructor(...e){super(...e),this.dataPropertyNames=["status","replaceHover","loadingCancelable","segment","gamePlayProcessing","isActive"],this._status="",this._displayAttrs={displayWidth:0,groupHover:!1,buttonHover:!1},this._slotRenderStatus=v.gw}}},529206:function(e,t,i){i.d(t,{u:function(){return h}});var r=i(804497),n=i(563890),a=i(644314),s=i(257296),o=i(251976),l=i(932919),d=i(559408),u=i(628499),c=i(933162);class h extends u.G{mount(){let{segment:e}=this.data;if(!(0,a.Dt)(e))return;let{id:t,originalTargetDuration:i}=e;if(!i)return;let{x:u,y:c,height:h}=this.style,g=(0,r.Mc)(i),m=new l.Group({x:u,y:c,name:(0,n.Vo)(t,s.KX.Segment,s.CD.MutableDuration),listening:!1}),p=new d.Text({height:s.sP,text:g,fontSize:12,fontStyle:"500",fontFamily:s.I8,fill:o.wL.lvvColorTextContentPrimary,verticalAlign:"middle",wrap:"none",ellipsis:!0,listening:!1,shadowForStrokeEnabled:!1,shadowColor:o.wL.lvvColorBlack04,shadowOffsetX:0,shadowOffsetY:1,shadowBlur:4}),f=p.clone({shadowOffsetX:0,shadowOffsetY:0,shadowBlur:6,shadowColor:o.wL.lvvColorBlack02});m.add(f,p);let _=p.width(),v=this._checkTextVisible(_);return m.visible(v),m.x(u+s.vX),m.y(c+h-s.sP-s.N),m}update(){var e;let{data:t,style:i}=this,r=this._konvaNodes[0],n=null===(e=r.children)||void 0===e?void 0:e[1],{segment:o}=t;if(!(0,a.Dt)(o)||!n)return;let{x:l,y:d,height:u}=i,c=n.width(),h=this._checkTextVisible(c);r.visible(h),r.x(l+s.vX),r.y(d+u-n.height()-s.N)}_checkTextVisible(e){let{width:t,height:i}=this.style;return(0,c.U4)(i)?e+2*s.vX<t:(e+s.vX)*2+c.lD<t}constructor(...e){super(...e),this.dataPropertyNames=["segment"]}}},802501:function(e,t,i){i.d(t,{W:function(){return m}});var r=i(932919),n=i(620183),a=i(288712),s=i(559408),o=i(612350),l=i(257296),d=i(251976),u=i(384971),c=i(628499),h=i(857458),g=i(125780);class m extends c.G{mount(){let{style:e,data:t}=this,{x:i,y:o,width:c,height:m}=e,p=t.replaceHover;if(!p)return;let f=(0,u.C5)(c),_=new r.Group({x:i+l.iX,y:o,width:f,height:m,opacity:0,visible:p,listening:!1}),v=new n.Rect({width:f,height:m,fill:d.wL.lvvColorMain06,cornerRadius:(0,u.yW)(f),listening:!1}),M=new a.Image({image:g.J.LvIconReplace,width:l.me,height:l.RB,listening:!1});M.setAttrs({verticalAlign:"middle",x:l.me/2+8,y:m/2,offsetX:l.me/2,offsetY:l.RB/2,listening:!1});let S=h.F.t("web_textvideo_button_replace",{},"Replace"),y=new s.Text({x:l.me+12,text:S,fontSize:12,fill:"#eee",fontStyle:"bold",verticalAlign:"middle",listening:!1});return y.setAttrs({y:m/2-y.height()/2}),l.me+4+y.width()+16>f&&(M.setAttr("x",f/2),y.setAttr("visible",!1)),_.add(v,M,y),_}update(){let{data:e,style:t}=this,{x:i,y:r,height:n,width:a}=t,s=e.replaceHover,o=this._konvaNodes[0],[d,c,h]=o.children;if(s){o.visible(!0),o.x(i+l.iX),o.y(r);let e=(0,u.C5)(a);o.width(e),o.height(n),d.width(e),d.height(n),c.setAttrs({x:l.me/2+8,y:n/2}),h.setAttrs({y:n/2-h.height()/2,visible:!0}),l.me+4+h.width()+16>e&&(c.setAttr("x",e/2),h.setAttr("visible",!1))}else o.visible(!1),this.clear();this.playTweens()}playTweens(){let e=this._konvaNodes[0];if(!e)return;let t=this.data.replaceHover,i=this._tweens[0];if(t){if(!i)try{i=new o.Tween({node:e,easing:o.Easings.EaseOut,opacity:1,duration:.2}),this._tweens.push(i)}catch(e){}null==i||i.play()}else null==i||i.reset()}constructor(e){let{layer:t}=e;super({...e,container:t.getChildren(e=>e.id()===l.PB.MaskGroup)[0],type:l.KX.Default}),this.dataPropertyNames=["replaceHover"]}}},294249:function(e,t,i){i.d(t,{Y:()=>T});var r=i("628499"),n=i("257315"),a=i("367616"),s=i("305962"),o=i("961569"),l=i("704829"),d=i("985485"),u=i("257296"),c=i("932919"),h=i("612350"),g=i("77665"),m=i("931774"),p=i("801497");let f={Group:"Group",Background:"Background",Text:"AdjustText"};class _ extends r.G{mount(){var e;if((null===(e=this.context)||void 0===e?void 0:e.mode)==="template"||!(0,g.I)(this.data,this.context))return;let t=new c.Group({listening:!1});return this._flatNodeMap.set(f.Group,t),this.update(),t}update(){let e=this._flatNodeMap.get(f.Group),t=this.getContainer();if(!(0,g.I)(this.data,this.context)||!t)return;let{segment:i}=this.data,r=p.ZP.t("web_color_correction_label_adjust",{},"Adjust"),n=(0,g.T)(i)&&i.enableSmartColorAdjust,a="template-post"===this.context.mode?16:14;if(n){var s;let i=this._flatNodeMap.get(f.Background);if(!i){i=(0,m.eN)({name:f.Background,height:a}),this._flatNodeMap.set(f.Background,i),e.add(i);let t=(0,m.Ny)({name:f.Text,x:u.ZT,height:a-2});this._flatNodeMap.set(f.Text,t),e.add(t)}let n=(0,m.cx)(t,e,u.Kp);e.x(n);let o=this._flatNodeMap.get(f.Text);o.text(r),o.direction(null!==(s=this.context.direction)&&void 0!==s?s:"ltr"),i.width(o.x()+o.getTextWidth()+u.ZT)}e.visible(!!n)}}var v=i("821044"),M=i("806759"),S=i("428583");let y="TagsGroup";class T extends r.G{_initChildren(){let e=[d.Z,_,v.Z,S.Z,M.Z,a.Z,n.Z,o.Z,l.Z,s.Z];this._children=e.map(e=>new e({layer:this._layer,data:this.data,style:this.style,context:this.context,container:()=>this._flatNodeMap.get(y),type:u.KX.Default}))}mount(){let e=new c.Group({name:y,opacity:0,listening:!1,x:u.z6,y:5});return this._flatNodeMap.set(y,e),this.update(),e}update(){var e;let t=this._flatNodeMap.get(y),{data:i,style:r,context:n}=this,a=(0,g.I)(i,n),s=this._tweens[0];if(!a){t.visible(!1),null==s||s.reset();return}t.visible(!0);let{isActive:o,isHover:l}=i;if(l&&!o){if(!s)try{s=new h.Tween({node:t,easing:h.Easings.EaseIn,opacity:1,duration:.2}),this._tweens.push(s)}catch(e){}null==s||s.play()}o&&t.opacity(1),"template-post"===n.mode?t.setAttrs({y:(r.height-16)/2}):t.setAttrs({y:5});let d=null!==(e=t.getParent())&&void 0!==e?e:this.getContainer(),c=(0,m.Re)(d,t,u.Kp,u.ao)||4;t.x(c)}constructor(e){super(e),this.dataPropertyNames=["segment","isLost","isLoading","isActive","extraTags","isHover","hideTitle","isVip"],this._initChildren()}}},684432:function(e,t,i){i.d(t,{D:function(){return p}});var r=i(563890),n=i(257296),a=i(251976),s=i(932919),o=i(288712),l=i(559408),d=i(628499),u=i(931774),c=i(384971);let h=new Set(["video","audio","sticker","combination"]);function g(e,t,i,r){let{group:a,icon:s,text:o}=e,{isLost:l,isLoading:d,segment:g,isActive:m,isHover:p,isVip:f,vipBadgeType:_}=i,{x:v,y:M,width:S,height:y}=t,T="template-post"===r.mode?n.VV:0,b=S-T-n.Dx;if(d||b<=n.Dx||m||p){a.visible(!1);return}a.visible(!0);let{type:I,title:w,text:k}=g,A="legacy-vip"===_?n.Jl:n.Q3,C=f?n.Dx+A+n.j8:n.Dx;null==s||s.setAttrs({x:C,y:(y-n.me)/2});let D=(0,c.q7)(I,k,l);if(D!==(null==s?void 0:s.image())&&(null==s||s.image(D)),o){var x;o.setAttrs({x:C+n.me+n.j8,height:y,text:l?(0,c.TF)(I):(0,u.gw)(w),fontSize:l?n.Tj:n.HP}),o.direction(null!==(x=r.direction)&&void 0!==x?x:"ltr")}a.setAttrs({x:v+T,y:M,width:S,height:y,visible:!(!l&&h.has(I))}),a.clip({x:0,y:0,width:b,height:y})}let m={group:"group",icon:"icon",text:"text"};class p extends d.G{mount(){let{data:e,style:t}=this,{segment:i,isLost:a}=e,{id:o,type:l}=i,{x:d,y:u,width:c,height:h}=t,p=new s.Group({listening:!1,name:(0,r.Vo)(o,n.KX.Segment,n.CD.Title),x:d,y:u,height:h,width:c});if(this._flatNodeMap.set(m.group,p),["video","audio"].includes(l)&&!a)return p;let f=this._mountIcon();return g({group:p,icon:f,text:this._mountText()},t,e,this.context),p}update(){let{data:e,style:t}=this,i=this._flatNodeMap.get(m.group),r=this._flatNodeMap.get(m.icon),n=this._flatNodeMap.get(m.text);e.isLost&&!n&&(n=this._mountText()),g({group:i,icon:r,text:n},t,e,this.context)}_mountIcon(){let e=this._flatNodeMap.get(m.group),{data:t,style:i}=this,{segment:r,isLost:a}=t,{type:s,text:l}=r,d=new o.Image({image:(0,c.q7)(s,l,a),width:n.me,height:n.me,listening:!1,x:n.Dx,y:(i.height-n.me)/2});return this._flatNodeMap.set(m.icon,d),e.add(d),d}_mountText(){let{data:e,style:t}=this,{segment:i,isLost:r}=e;if(i.title||r){let e=new l.Text({x:n.Dx+n.me+4,y:0,height:t.height,text:(0,u.gw)(i.title),fontSize:r?n.Tj:n.HP,fontStyle:"500",fontFamily:n.I8,fill:a.wL.lvvColorTextContentPrimary,verticalAlign:"middle",listening:!1});return this._flatNodeMap.set(m.text,e),this._flatNodeMap.get(m.group).add(e),e}}constructor(...e){super(...e),this.dataPropertyNames=["segment","isLost","isVip","isLoading","isActive","isHover"]}}},795019:function(e,t,i){i.d(t,{Z:function(){return f}});var r=i(628499),n=i(125780),a=i(257296),s=i(251976),o=i(932919),l=i(620183),d=i(288712),u=i(384971),c=i(563890),h=i(813269);let g="Background",m="ThinIcon",p="BroadIcon";class f extends r.G{render(){if(!this._inViewport){var e;null===(e=this._activeBorder)||void 0===e||e.setVisible(!1);return}super.render(),this._applyActive()}mount(){let{style:e}=this;this._isMounted=!0;let{width:t}=e,i=new o.Group({listening:!1}),r=new l.Rect({x:0,y:0,fill:s.wL.colorFill7,cornerRadius:(0,u.yW)(t),listening:!1,name:g}),c=new l.Rect({fill:s.wL.lvvColorBlockStationary,stroke:s.wL.lvvColorWhiteStationary,strokeWidth:1,cornerRadius:a.Ws,listening:!1,name:m}),h=new d.Image({image:n.J.LvIconTransition,listening:!1,name:p});return i.add(r),i.add(c),i.add(h),this.update([i]),i}update(e){let{style:t,data:i}=this,r=this._konvaNodes[0]||(null==e?void 0:e[0]),[n,o,l]=r.children,{width:d,height:c}=t,{isHideBg:h}=i,g="template-post"===this.context.mode,m=d<=32;r.setAttrs({...t}),n.setAttrs({width:d,height:c,visible:!g,cornerRadius:(0,u.yW)(d)}),h?(o.visible(!1),l.visible(!1)):m?(o.setAttrs({...function(e){let{width:t,height:i}=e;return{x:(t-a.zn)/2,y:(i-a._v)/2,width:a.zn,height:a._v}}(t),visible:!0}),l.visible(!1)):(l.setAttrs({...function(e){let{width:t,height:i}=e;return{x:(t-a.WW)/2,y:(i-a.WW)/2,width:a.WW,height:a.WW}}(t),visible:!0}),o.visible(!1)),g&&o.setAttrs({fill:s.wL.lvvColorBlockStationary,stroke:s.wL.lvvColorWhiteStationary})}active(e,t){let i=this.data.isActive;this.updateData({isActive:e});let r=i!==e;t&&r&&this.render()}clear(){super.clear(),this._clearActiveBorder()}_applyActive(){if(!!this._isMounted){if(!this.data.isActive){this._clearActiveBorder();return}this._renderActiveBorder()}}_clearActiveBorder(){if(!!this._activeBorder)this.context.cache.activeBorder.set(this._activeBorder),this._activeBorder=void 0}_renderActiveBorder(){!this._activeBorder&&(this._activeBorder=this.context.cache.activeBorder.get(()=>new h.L({layer:this._layer,data:this.data,style:this.style,context:this.context})),this._activeBorder.setData(this.data),this._activeBorder.setStyle(this.style)),this._activeBorder.setVisible(this._visible),this._activeBorder.render()}_applyVisible(){var e;null===(e=this._activeBorder)||void 0===e||e.setVisible(this._visible),super._applyVisible()}constructor(e){let{layer:t,id:i,data:r,context:n,style:s}=e;super({layer:t,type:a.KX.Transition,id:i,style:s}),this.data=r,this.context=n,this._container=(0,c.dX)(t,a.PB.TransitionGroup),this._inViewport=!1}}},944356:function(e,t,i){i.d(t,{Z:function(){return u}});var r=i(650248),n=i(563890),a=i(257296),s=i(5240),o=i(153302),l=i(969242),d=i(357940);class u{batchRefreshWave(e){let t=this._pendingRefreshCOs.findIndex(t=>t.id===e.id);-1===t?this._pendingRefreshCOs.push(e):this._pendingRefreshCOs[t]=e,this._runPendingRefreshTasks()}refreshWaveBySegmentCO(e){var t,i;let r=this._sourceCache.get(e.id);if(!r){let i=null!==(t=this._modules.resource.getSourceWaves(e.data.segment))&&void 0!==t?t:[];r=this._saveSourceWave(i,e)}let{segment:n,cropSituation:a}=e.data;if(r&&n&&a){let e=(0,o.X)(n,a),t={...n,duration:null!==(i=null==e?void 0:e.duration)&&void 0!==i?i:n.duration,prolong:e};r.range=(0,s.Yu)(r.waveforms,t)}let l=this._saveRenderCommands(r,e);if(l.length){let{x:t}=this._renderer.camera.getBounds();this._runRenderTask(l,e,t)}}clearAllCOImage(){for(let e of Array.from(this._renderCommandsCache.keys())){let t=(0,n.JP)(this._renderer.children,e);if(t){let e=t.data.thumbnailImage;t.updateData({thumbnailImage:void 0}),(0,d.V$)(e)}}}getNewWavesMap(e){let t=new Map;for(let i of e){let{path:e,id:r,materialDraft:n}=i;if((e||(null==n?void 0:n.draft))&&!this.checkSourceCache(r)){let e=this._modules.resource.getSourceWaves(i);e&&t.set(r,e)}}return t}destroy(){this._renderCommandsCache.clear(),this._sourceCache.clear()}removeCache(e){let t=[];for(let i of(e.forEach(e=>{let{path:i,id:r}=e.data.segment;i&&t.push(r)}),Array.from(this._sourceCache.keys())))!t.includes(i)&&(this._sourceCache.delete(i),this._renderCommandsCache.delete(i))}refreshAllRenderCommand(){for(let[e,t]of(this._renderCommandsCache.clear(),Array.from(this._sourceCache.entries()))){let i=(0,n.JP)(this._renderer.children,e);i&&this._saveRenderCommands(t,i)}}refreshSourceCache(e){let t=[];for(let[i,r]of e){let e=(0,n.JP)(this._renderer.children,i);if(e){let n=this._saveSourceWave(r,e);this._saveRenderCommands(n,e),t.push(i)}}this.reGenerateImages(!1,t)}reGenerateImages(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1?arguments[1]:void 0,i=null!=t?t:Array.from(this._renderCommandsCache.keys()),r=this._renderer.camera.getBounds(),a=[];for(let t of i){let i=this._renderCommandsCache.get(t),s=(0,n.JP)(this._renderer.children,t),o=!1;(e||!(null==s?void 0:s.data.thumbnailImage))&&(o=!0);let l=null==s?void 0:s.getVisible();o&&s&&i&&l&&a.push(this._runRenderTask(i,s,r.x))}return a}checkSourceCache(e){return this._sourceCache.has(e)}_saveRenderCommands(e,t){let{segment:i}=t.data,{width:r,height:n}=t.style,o=(0,s.hk)(this._store),d=(0,l.vY)(this._renderer.camera.zoom,(0,s.kv)(i))||r,u=(0,s.Gv)(e,r,n,a.Ue,o,d);return this._renderCommandsCache.set(i.id,u),u}_saveSourceWave(e,t){let{segment:i}=t.data,r=(0,s.Yu)(e,i),n={waveforms:e,range:r};return this._sourceCache.set(i.id,n),n}_runRenderTask(e,t,i){let r=Math.max(i-t.style.x+this.offsetXBuffer,0),n=this._generateImage(e,t,r);if(!!this._checkNeedUpdateCO(t))this._updateSegmentCOImage(t.data.segment.id,n,-r)}_generateImage(e,t,i){let{width:r,height:n}=this._getImageSize(t);if(0===r||0===e.length)return;let o=i*a.Ue,l=(0,s.hk)(this._store);return(0,s.Kw)(e,r,n,o,l)}_checkNeedUpdateCO(e){return!!e.data||!1}_updateSegmentCOImage(e,t,i){let r=(0,n.JP)(this._renderer.children,e);if(!r)return;let s=r.data.thumbnailImage;r.updateData({thumbnailImage:t,imageOffsetX:i*a.Ue},!0),(0,d.V$)(s)}_getImageSize(e){let t=e.style,i=this._renderer.camera.getBounds(),r=e.getVisible(),{width:n,height:s}=this._getThumbSize(e),o=0;return r&&(o=i.x<=t.x?Math.max(0,Math.min(n,i.width+i.x-t.x)):Math.max(0,Math.min(i.width,n,n+(t.x-i.x)))),{width:o*a.Ue,height:s*a.Ue}}_getThumbSize(e){let{width:t,height:i}=e.style;return{width:t,height:i}}constructor(e,t,i){this._renderer=e,this._modules=t,this._store=i,this.refreshAllThumbWait=300,this.refreshSingleThumbWait=100,this.offsetXBuffer=-1,this._pendingRefreshCOs=[],this._runPendingRefreshTasks=(0,r.Z)(()=>{for(let e of this._pendingRefreshCOs)this.refreshWaveBySegmentCO(e);this._pendingRefreshCOs=[]},this.refreshSingleThumbWait),this.onWavesChange=e=>{let{segmentIds:t}=e,i=new Map;for(let e of t){let t=(0,n.JP)(this._renderer.children,e);if(!(null==t?void 0:t.data))continue;let r=this._modules.resource.getSourceWaves(t.data.segment);if(!!(null==r?void 0:r.length))i.set(e,r),this._sourceCache.delete(e),this._renderCommandsCache.delete(e)}this.refreshSourceCache(i)},this.refreshAudioSegmentWaves=e=>{let t=this._sourceCache.get(e);if(!t)return;let i=(0,n.JP)(this._renderer.children,e);if(!!i)this._saveRenderCommands(t,i),this.reGenerateImages(!0,[e])},this.resetSourceCache=e=>{let t;if(!e){this._sourceCache.clear();return}for(let i of t="string"==typeof e?[e]:e)this._sourceCache.has(i)&&this._sourceCache.delete(i)},this._renderCommandsCache=new Map,this._sourceCache=new Map}}},298648:function(e,t,i){i.d(t,{V:()=>h});var r=i("218571"),n=i("857670"),a=i("690674");class s{getPositionLeft(){if(!this.cursor)return;let e=this.cursor.getBoundingClientRect().left,t=this.cursor.parentElement;if(!t)return;let i=t.getBoundingClientRect().left,r=parseInt(getComputedStyle(this.cursor).left,10);return e+t.scrollLeft-i-r}updateCursorPos(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(this.transitionTime&&!i){var n,a;(null===(n=this.cursorAnimate)||void 0===n?void 0:n.playState)==="paused"&&(null===(a=this.cursorAnimate)||void 0===a||a.play());return}if(!!this.cursor){if(i){this.updatePositionImmediately(e,r);return}this.transitionTime=performance.now(),this.clearAllAnimate(),this.cursorAnimate=this.cursor.animate([{transform:`translateX(${this.lastLeft}px)`},{transform:`translateX(${e}px)`}],{fill:"forwards",iterations:1,easing:"linear",duration:1e3*t}),this.cursorAnimate.onfinish=()=>{this.transitionTime=0,this.lastLeft=e,null==r||r(e)}}}pauseAnimate(){var e;null===(e=this.cursorAnimate)||void 0===e||e.pause()}clearAllAnimate(){var e,t;null===(t=this.cursor)||void 0===t||null===(e=t.getAnimations)||void 0===e||e.call(t).forEach(e=>e.cancel()),this.cursorAnimate=void 0}constructor(e){this.transitionTime=0,this.lastLeft=0,this.updatePositionImmediately=(e,t)=>{var i;this.transitionTime=0,this.lastLeft=e,this.cursorAnimate&&(this.cursorAnimate.oncancel=()=>{null==t||t(e)}),this.cursor.style.transform=`translateX(${e}px)`,this.clearAllAnimate(),!(null===(i=this.cursorAnimate)||void 0===i?void 0:i.oncancel)&&(null==t||t(e))},this.cursor=e}}var o=i("969242");class l{paused(e,t){if(this._isRunning=!1,(!!t||!(this._currentPosition>=this._maxTime))&&!!this._cursorDomRender)this._cursorDomRender.pauseAnimate(),e&&(this._cursorDomRender.updateCursorPos(e,0,!0),this._transitionEndPx=e)}setCursorDom(e){var t;if(null===(t=this._cursorDomRender)||void 0===t||t.clearAllAnimate(),this._cursorDomRender=new s(e),this._currentPosition){let e=this.transToPx(this._currentPosition);this._cursorDomRender.updateCursorPos(e,0,!0)}}updatePlayerStatus(e,t,i){if(this.isPreviewing!==t&&this.resetCssAnimationTime(t),this.isPreviewing=t,e){let e=this._getRealtimeTargetPosition();this._onCursorPauseStatusChange(!1),this._pausedSeekTimer&&window.clearTimeout(this._pausedSeekTimer),this._pausedSeekTimer=0,e!==this._currentPosition&&this.jumpToPos(e),this.play();return}if(this._isRunning=!1,this._zoomChange){this._zoomChange=!1,this._currentPosition!==this._targetPosition&&this.jumpToPos(this._targetPosition),this._onCursorPauseStatusChange(!0);return}if(this.paused(),this.isPreviewing){this._onCursorPauseStatusChange(!0);return}}updateTargetPosition(e){if(!this._cssAnimationTime&&this._cursorDomRender){let t=this.transToPx(e);this._transitionStartPosition=e,this._transitionEndPx=t,this._currentPosition=e,this._cursorDomRender.updateCursorPos(t,0,!0)}this._targetPosition=e,this.jumpToPosIfNeed(e)}resetCssAnimationTime(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){var t;this._cssAnimationTime=0,null===(t=this._cursorDomRender)||void 0===t||t.clearAllAnimate();return}this.zoom<10?this._cssAnimationTime=0:this.zoom<30?this._cssAnimationTime=1:this._cssAnimationTime=2}reRenderAndPauseByZoomChange(e){let t;if(this.zoom=e,!this._cursorDomRender)return;this.resetCssAnimationTime(this.isPreviewing),this._isRunning?(this._zoomChange=!0,this.paused(),t=this._getRealtimeTargetPosition()):t=this._targetPosition;let i=this.transToPx(t);this._currentPosition=t,this._transitionEndPx=i,this._cursorDomRender.updateCursorPos(i,(0,o.vQ)(t),!0)}jumpToPosIfNeed(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&this._pausedSeekTimer&&(this._onCursorPauseStatusChange(!0),window.clearTimeout(this._pausedSeekTimer),this._pausedSeekTimer=0),this._maxTime&&e>this._maxTime)return;let i=this._targetPosition-this._currentPosition;(this._isRunning&&t||!this._isRunning&&!this._pausedSeekTimer&&(i<-16000n||i>16000n))&&this.jumpToPos(e)}updateMaxTime(e){if(this._maxTime!==e){let i=this.transToPx(e);if(this._transitionEndPx>i){var t;null===(t=this._cursorDomRender)||void 0===t||t.updateCursorPos(i,1,!0)}this._maxTime=e}}destroy(){var e;null===(e=this._cursorDomRender)||void 0===e||e.clearAllAnimate()}transToPx(e){return(0,o.vY)(this.zoom,e)}jumpToPos(e){if(!this._cursorDomRender)return;this._targetPosition=e,this._currentPosition=e;let t=this.transToPx(e);this._transitionEndPx=t,this._cursorDomRender.updateCursorPos(t,this._cssAnimationTime,!0,()=>{this._isRunning&&this.play()})}play(){if(!this._cursorDomRender)return;this._transitionStartPosition=this._currentPosition;let{targetPx:e,time:t}=this.getNextPosInfo(this._transitionStartPosition,this._transitionEndPx);if(0!==t)this._isRunning=!0,this._transitionEndPx=e,this._cursorDomRender.updateCursorPos(e,t,!1,this.handleTransitionEnd)}getCurrentPx(){var e;return null===(e=this._cursorDomRender)||void 0===e?void 0:e.getPositionLeft()}constructor(e,t,i,r){this.isPreviewing=!1,this._cssAnimationTime=2,this._currentPosition=0n,this._targetPosition=0n,this._isRunning=!1,this._transitionStartPosition=0n,this._transitionEndPx=0,this._zoomChange=!1,this._maxTime=0n,this._pausedSeekTimer=0,this.getNextPosInfo=(e,t)=>{if(!this._cssAnimationTime)return{targetPx:t,time:0};let i=e+(0,o.Fn)(this._cssAnimationTime),r=this.transToPx(i);if(i<=this._maxTime)return{targetPx:r,time:this._cssAnimationTime};{let e=this.transToPx(this._maxTime);if(t>e)return{targetPx:t,time:0};let i=this._cssAnimationTime*(e-t)/(r-t);return r=e,{targetPx:e,time:i}}},this.handleTransitionEnd=e=>{if(!this._isRunning||!this._cursorDomRender)return;let{targetPx:t,time:i}=this.getNextPosInfo(this._getRealtimeTargetPosition(),e);if(0!==i)this._transitionEndPx=t,this._cursorDomRender.updateCursorPos(t,i,!1,this.handleTransitionEnd)},this._currentPosition=e,this.zoom=t,this._getRealtimeTargetPosition=i,this._onCursorPauseStatusChange=r}}var d=i("260963"),u=i("446352"),c=i("426336");function h(e,t,i,s){let o=(0,r.useRef)(),h=(0,r.useRef)(),g=e=>{let{time:t}=e;t&&o.current&&o.current.updateTargetPosition(t)},{timelineCursorFrozen:m}=e[a.U_];(0,r.useEffect)(()=>{o.current=new l(e[a.U_].progress,e[a.U_].zoomStore.value,()=>t.getCurrentPosition(),t=>{e[a.U_].setDidCursorPause(t)}),h.current&&o.current.setCursorDom(h.current);let r=i.onTimelineUpdateCursorPosition(g);return()=>{var e;null===(e=o.current)||void 0===e||e.destroy(),r.dispose()}},[]),(0,r.useEffect)(()=>{let t=(0,d.U5)(()=>{let{videoPreviewDuration:t,videoPreviewStatus:i}=e[a.VT];return i===u.bC.Playing||i===u.bC.OnDisplay?c.pMA.times(t,1e3,"bigint"):e[a.U_].duration},e=>{var t;null===(t=o.current)||void 0===t||t.updateMaxTime(e)},{fireImmediately:!0});return()=>{t()}},[]);let p=(0,r.useRef)(0n);return(0,r.useEffect)(()=>{let t=(0,d.U5)(()=>({isPlaying:e[a.VT].unionPlaying,progress:e[a.U_].progress}),e=>{let{progress:t,isPlaying:i}=e;if(!i&&!s.cursor.freeze){var r,n;null===(r=o.current)||void 0===r||r.resetCssAnimationTime(!i),null===(n=o.current)||void 0===n||n.updateTargetPosition(t),p.current=t}},{fireImmediately:!0});return()=>{t()}},[s]),(0,r.useEffect)(()=>{if(s.cursor.freeze||m)return;let i=t.onPlayProgressChange((i,r)=>{if(e[a.VT].unionPlaying){if(!o.current)return;let e=(0,n.i1)(i);if(o.current.isPreviewing!==t.isRangePlay&&o.current.resetCssAnimationTime(t.isRangePlay),o.current.isPreviewing=t.isRangePlay,o.current.updateTargetPosition(e),e<p.current||r&&e!==p.current){var s;null===(s=o.current)||void 0===s||s.jumpToPosIfNeed(e,!0)}p.current=e}});return()=>{i.dispose()}},[t,s,m]),(0,r.useEffect)(()=>{let i=(0,d.U5)(()=>({isPlaying:e[a.VT].unionPlaying}),e=>{let{isPlaying:i}=e;if(!s.cursor.freeze){var r;null===(r=o.current)||void 0===r||r.updatePlayerStatus(i,t.isRangePlay,e=>t.seekToTime(e))}},{fireImmediately:!0});return()=>{i()}},[t,s]),(0,r.useEffect)(()=>{let t=(0,d.U5)(()=>e[a.U_].zoomStore.value,e=>{var t;null===(t=o.current)||void 0===t||t.reRenderAndPauseByZoomChange(e)},{fireImmediately:!0});return()=>{t()}},[]),(0,r.useCallback)(e=>{if(e){var t;null===(t=o.current)||void 0===t||t.setCursorDom(e)}h.current=e},[])}},97508:function(e,t,i){i.d(t,{J:function(){return c}});var r=i(772322),n=i(1297),a=i(827322),s=i(218571),o=i(831998),l=i(251976),d=i(202426),u=i(125780);let c=s.memo(e=>{let{renderer:t}=e,i=(0,s.useRef)(null),[c,h]=(0,s.useState)(0),[g]=(0,o.F)();(0,s.useEffect)(()=>{t&&((0,l.Uf)(g),null==t||t.events.view.emit(d.H2.colorLoaded),h(e=>e+1))},[t,g]),(0,n.default)(()=>{if(!i.current||!t)return;let e=new XMLSerializer,r=Array.from(i.current.children),n=Object.keys(u.N);r.length!==n.length&&console.warn("icon doms' length should be equal to icon names' length");for(let t=0;t<n.length;t++){let i=r[t];Array.from(i.querySelectorAll("path")).forEach(e=>e.removeAttribute("fill"));let s=n[t],o=e.serializeToString(i),l=`data:image/svg+xml;base64,${btoa(o)}`,d=new Image;d.src=(0,a.C)(l,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_web_editor",region:"maliva",urlLimit:"10000",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1}),u.J[s]=d}t.setTheme(g)},[c]);let m=l.wL.lvvColorTextContentPrimary;return(0,r.jsx)("div",{style:{display:"none"},ref:i,children:Object.entries(u.N).map(e=>{let[t,i]=e;return(0,r.jsx)(i,{style:{color:m,fill:m}},t)})})})},377125:function(e,t,i){i.d(t,{PO:function(){return O},ZP:function(){return z}});var r=i(772322),n=i(544633),a=i(218571),s=i(670933),o=i(437467),l=i(690674),d=i(461834),u=i(59335),c=i(370924),h=i(379939),g=i(491424),m=i(850649),p=i(502514),f=i(105789),_=i.n(f),v=i(928261),M=i(771255),S=i(709444),y=i(836172),T=i(695324),b=i(309227),I=i(230689),w=i(937802),k=i(21185),A=i(860660),C=i(325805),D=i(607549),x=i(800793),P=i(956626),E=i(108692),N=i(426336),R=i(141913),L=i(626910),j=i(989719);let O="timeline-panel-container",B=(0,R.PS)(()=>Promise.all([i.e("9869"),i.e("9446"),i.e("8368")]).then(i.bind(i,184089))),z=(0,s.f3)("store","modules")((0,s.Pi)(e=>{let{store:t,modules:i,panelHeight:s,replacePanelStyle:f,...z}=e,{timelineStore:U,timelineSelectionStore:V,resourceStore:Z,timelineInteractStore:F}=t,{draftOperation:G,player:W,selection:Y,timelineUI:H,keybinding:Q,coordinate:K,batchReplace:J}=i,{isBatchReplacePanelVisible:X,isTemplate:$,loading:q,isCollapseTimeline:ee,keyframeStore:et,mainEditorWidgetContainerDom:ei}=U,{disableShortCutKey:er}=F,en=Z.batchReplaceStatus!==M.g.IDLE,ea=(0,a.useRef)(null),es=(0,a.useRef)(null),{scrollerRef:eo,isScrolled:el}=(0,d.J)(),ed=(0,w.G)(I.t),eu=(0,w.G)(E.n),ec=V.segmentSelected[0],[eh,eg]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!ec||!(0,v.uG)(ec)){eg(!1);return}let{templateId:e}=ec;e&&eu.draftTemplateManager.getTemplate(e).then(e=>{eg(null==e?void 0:e.mute)})},[ec]),(0,a.useEffect)(()=>(Q.setShortcutKeyBindContainer(ea.current),()=>{Q.setShortcutKeyBindContainer(null)}),[]),(0,g.X)({key:m.Fu.SPLIT,handler:e=>{try{e.preventDefault(),W.pause();let t=G.segment.splitSelectedSegment(H);(0,C.JP)(ed,{action_type:C.Gt.SHORTKEY,function_name:C.BS.CUT,...(0,A.KG)(t)})}catch(e){}},description:[m.Fu.SPLIT],when:e=>!ee&&!er&&!en&&!V.expandedSegmentId&&!X},document.body),(0,g.X)({key:m.Fu.COPY,description:[m.Fu.COPY],handler(){if(et.hasKeyframeSelect){G.keyframe.copyKeyFrame("shortkey");return}try{if(G.segment.copySelectedSegments(),0===Y.segmentIds.length&&0!==Y.transitionIds.length)return;(0,C.JP)(ed,{action_type:C.Gt.SHORTKEY,function_name:C.BS.COPY,...(0,A.KG)(Y.getSelectedSegments())})}catch(e){}},when:e=>!(er||en)&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.CUT,description:[m.Fu.CUT],handler(){try{(0,C.JP)(ed,{action_type:C.Gt.SHORTKEY,function_name:C.BS.COPYCUT,...(0,A.KG)(Y.getSelectedSegments())}),G.segment.cutSelectedSegments()}catch(e){}},when:e=>!($||er||en)&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.DUPLICATE,description:[m.Fu.DUPLICATE],handler(){try{G.segment.duplicateSelectedSegments()}catch(e){}},when:()=>!(er||en)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.FLIP_HORIZONTAL,description:[m.Fu.FLIP_HORIZONTAL],handler(){try{G.segment.flipSegment(t[l.qk].segmentSelected[0].id,!1)}catch(e){}},when:()=>!(er||en)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.FLIP_VERTICAL,description:[m.Fu.FLIP_VERTICAL],handler(){try{G.segment.flipSegment(t[l.qk].segmentSelected[0].id,!0)}catch(e){}},when:()=>!(er||en)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.PASTE,handler(){if(et.keyframeCopyCacheSegment){G.keyframe.pasteKeyframe("shortkey");return}let{currentSeekTime:e}=t[l.U_];G.segment.pasteSegment(e),(0,C.JP)(ed,{action_type:C.Gt.SHORTKEY,function_name:C.BS.PASTE,...(0,A.KG)(Y.getSelectedSegments())})},description:[m.Fu.PASTE],when:e=>!(er||en)&&(0,x.Vw)(e)},document.body),(0,g.X)({key:m.Fu.DETACH_AUDIO,description:[m.Fu.DETACH_AUDIO],handler(){try{let{segmentSelected:e}=t[l.qk],i=(0,D.X)(e),r=(0,D.u)(e,i);W.pause(),G.segment.detachSegmentAudio({segmentId:t[l.qk].segmentSelected[0].id,onError:e=>H.toast.normal(e)}),(0,C.JP)(ed,{action_type:C.Gt.SHORTKEY,function_name:r?C.BS.DIVIDE_AUDIO:C.BS.UNDIVIDE_AUDIO,...(0,A.KG)(Y.getSelectedSegments())})}catch(e){}},when:()=>!(er||en||eh)}),(0,g.X)({key:m.Fu.TIMELINE_ZOOM_IN,description:[m.Fu.TIMELINE_ZOOM_IN],handler(){try{H.zoom.timelineZoomIn("shortkey")}catch(e){}},when:()=>!(ee||en)},document.body),(0,g.X)({key:m.Fu.TIMELINE_ZOOM_OUT,description:[m.Fu.TIMELINE_ZOOM_OUT],handler(){try{H.zoom.timelineZoomOut("shortkey"),(0,C.JP)(ed,{action_type:C.Gt.SHORTKEY,function_name:C.BS.ZOOM})}catch(e){}},when:()=>!(ee||en)},document.body),(0,g.X)({key:m.Fu.ADSORB,description:[m.Fu.ADSORB],handler(){try{(0,S.E)(ed,{option:t[l.U_].switches.adsorb?"off":"on",switch_type:"shortkey"}),t[l.U_].setSwitches({adsorb:!t[l.U_].switches.adsorb})}catch(e){}},when:e=>!(ee||er||en)&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.PREVIEW_LINE,description:[m.Fu.PREVIEW_LINE],handler(){(0,y.e)(ed,{switch_type:"shortkey",option:H.previewLine.switch?"off":"on"}),H.previewLine.toggleSwitch()},when:e=>!(ee||er||en)&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.PREVIOUS,description:[m.Fu.PREVIOUS],handler(e){try{e.preventDefault(),(0,T.b)(ed,{relatedEvent:T.Z.MoveTimeline}),W.seekPrevFrame(),(0,b.o)(ed,{action_type:"shortkey"})}catch(e){}},when:e=>!ee&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.NEXT,description:[m.Fu.NEXT],handler(e){try{e.preventDefault(),(0,T.b)(ed,{relatedEvent:T.Z.MoveTimeline}),W.seekNextFrame(),(0,b.o)(ed,{action_type:"shortkey"})}catch(e){}},when:e=>!ee&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.PREVIOUS_SLOT,description:[m.Fu.PREVIOUS_SLOT],handler(){try{let{mutableVideos:i}=U,{segmentId:r}=V,n=i.findIndex(e=>(null==e?void 0:e.segmentId)===r);if(n>=1){var e,t;let a=i[n-1].segmentId;Y.updateSelectData({segmentIds:[a]}),(0,P.SH)(ed,{action_type:P.kO.SHORTKEY,option_type:P.Ds.SELECT,action_position:P.X3.VIDEO,clip_type:P.U4.TRACK,position_type:U.isBatchReplacePanelVisible?P.o7.BATCH_REPLACE:P.o7.TIMELINE,clip_duration:Math.ceil(N.pMA.div(null!==(t=null===(e=eu.dataSdk.draftView.getSegmentById(null!=r?r:""))||void 0===e?void 0:e.targetTimerange.duration)&&void 0!==t?t:0,1e6))})}}catch(e){}},when:e=>!(ee||er)&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.NEXT_SLOT,description:[m.Fu.NEXT_SLOT],handler(){try{let{mutableVideos:i}=U,{segmentId:r}=V,n=i.findIndex(e=>(null==e?void 0:e.segmentId)===r);if(n>=0&&n<=i.length-2){var e,t;let a=i[n+1].segmentId;Y.updateSelectData({segmentIds:[a]}),(0,P.SH)(ed,{action_type:P.kO.SHORTKEY,option_type:P.Ds.SELECT,action_position:P.X3.VIDEO,clip_type:P.U4.TRACK,position_type:U.isBatchReplacePanelVisible?P.o7.BATCH_REPLACE:P.o7.TIMELINE,clip_duration:Math.ceil(N.pMA.div(null!==(t=null===(e=eu.dataSdk.draftView.getSegmentById(null!=r?r:""))||void 0===e?void 0:e.targetTimerange.duration)&&void 0!==t?t:0,1e6))})}}catch(e){}},when:e=>!(ee||er)&&(0,x.Vw)(e)},null!=ei?ei:void 0),(0,g.X)({key:m.Fu.TOGGLE_TIMELINE,description:[m.Fu.TOGGLE_TIMELINE],handler(e){try{null==e||e.preventDefault();let{isCollapsed:t}=H.panel;H.panel.toggleCollapsed(),(0,C.JP)(ed,{action_type:C.Gt.SHORTKEY,function_name:t?C.BS.SHOW_TIMELINE:C.BS.COLLAPSE_TIMELINE})}catch(e){}},when:e=>!(er||en)&&(0,x.Vw)(e)},document.body),(0,g.X)({key:m.Fu.TOGGLE_BEAT,description:["toggle-beat"],handler(){G.beat.toggleAudioManualBeat(t[l.qk].segmentSelected,t[l.U_].currentSeekTime)},when:e=>!(ee||er||en)&&(0,x.Vw)(e)}),(0,g.X)({key:m.Fu.DELETE,description:["keyframe-delete"],handler(){},when(e){let{keyframeSelectInfo:t}=et;return!t||(e.stopPropagation(),G.keyframe.deleteSelectedKeyFrame("shortkey"),!1)}});let{batchReplacePanelRef:em,timelinePanelRef:ep,updateHeight:ef}=(0,p.h)(i.timelineUI.panel,t),e_=(0,L._u)(j.Z,{direction:"vertical",onScroll:()=>K.registry.tier.refreshBlockPosition()},{coordinate:K,batchReplace:J}),ev=(0,n.default)(e=>{eo&&(eo.current=e),e_(e)});return(0,r.jsxs)("div",{ref:ea,className:_()("timeline-container",o.Z.timelineContainer),id:"timeline-part-view",children:[(0,r.jsx)(R.SV,{fallback:(0,r.jsx)("div",{}),children:(0,r.jsx)(u.Z,{styleConfig:{showTimeline:X,showBoxShadow:X&&el,showBorderBottom:X}})}),(0,r.jsx)(c.Z,{scrollWrapRef:es}),ee&&(0,r.jsx)(k.Z,{hidden:!ee}),(0,r.jsxs)("div",{className:_()(o.Z.timelinePanelContainer,O),ref:ev,children:[($||V.subDraftId)&&(0,r.jsx)(R.SV,{fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(R.Xf,{fallback:(0,r.jsx)("div",{}),children:(0,r.jsx)(B,{elementRef:em,hidden:ee||!X,store:t,modules:i,replacePanelStyle:{failedTextWrapLine:1},onMounted:()=>{X&&ef(!0)}})})}),(0,r.jsx)(R.SV,{fallback:(0,r.jsx)("div",{}),children:(0,r.jsx)(h.Z,{elementRef:ep,scrollWrapRef:es,hidden:ee||X})})]})]})}))},64447:function(e,t,i){i.d(t,{i:function(){return n}});let r={};class n{reset(){clearTimeout(this._uniqueKey?r[this._uniqueKey]:this._timer),this._timer=void 0}run(e,t){this.reset(),this._timer=setTimeout(()=>{this._timer=void 0,e()},null!=t?t:200),this._uniqueKey&&(r[this._uniqueKey]=this._timer)}constructor(e){this._uniqueKey=e}}},183797:function(e,t,i){i.d(t,{Y_:function(){return o},fQ:function(){return l},mk:function(){return d},ug:function(){return s}});var r=i(907031),n=i(426336),a=i(804497);function s(e){let{isTemplate:t,computedTracksUpper:i,computedTracksMain:a,computedTracksUnder:s,isNewEmpty:o,tracksMutable:l}=e;if(t){var d,u,c;return!o||l.length&&(null===(c=l[0])||void 0===c?void 0:null===(u=c[0])||void 0===u?void 0:null===(d=u.segments)||void 0===d?void 0:d.length)?l:[[{id:r.pP,type:n.pNd.TrackTypeNone,segments:[],trackType:n.pNd.TrackTypeNone},0]]}return[...i.map(e=>{let[t,i]=e;return[t,i,"upper"]}),...a.map(e=>{let[t,i]=e;return[t,i,"main"]}),...s.map(e=>{let[t,i]=e;return[t,i,"under"]})]}function o(e,t){var i,r;let{timelineSelectionStore:n,timelineStore:s}=e,{isTemplate:o,tracksMutable:l,isBatchReplacePanelVisible:d}=s,{expandedSegmentId:u,subDraftSegment:c}=n,h=null!=u?u:d?null==c?void 0:c.id:null;if(!o&&!!h){if((null==l?void 0:null===(i=l[0])||void 0===i?void 0:i.length)>0){let e=(0,a.kt)(t,{id:h});if(!e)return;let i=(0,a.JS)(t,{id:e.id}),n=[];for(let a of t){let t=[...a];if(i&&a[0].id===(null===(r=i[0])||void 0===r?void 0:r.id)){let i=l[0][0].segments.map(t=>({...t,start:t.start+e.start}));t[0]={...a[0],type:l[0][0].type,segments:i}}else t[0]={...a[0],segments:[]};n.push(t)}return n}}}function l(e){return e?e.slots.find(e=>"transition"===e.type):null}function d(e){return e.reduce((e,t,i)=>{let r=l(t);return r&&e.push([r,t,i]),e},[])}},200750:function(e,t,i){i.d(t,{H:function(){return s}});var r=i(218571),n=i(907031),a=i(672983);function s(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=(0,r.useCallback)((e,r)=>{e>=0?t.timelineZoomOut(r,e/n.gT,i):t.timelineZoomIn(r,-e/n.gT,i)},[t]);(0,a.f)(e,s,10)}},674103:function(e,t,i){i.d(t,{A:function(){return g}});var r=i(789786);i(784923);var n=i(498417),a=i(780206),s=i(919111),o=i(426336),l=i(948328),d=i(801497),u=i(91474),c=i(126429),h=i(425427);class g{constructor(e,t,i,r,s,l){if(this._dataSdk=e,this._draftPathStore=t,this._replaceSegmentManager=i,this._selection=r,this._draftMaterialsService=s,this._environmentService=l,!(0,h.JY)(this._environmentService))return;this._dataSdk.onChangeDiff(e=>{var t,i,r,s,l;if(e.actionOperateType!==o.aWQ.Undo)return;let u=e.segment;if(!(0,a.b3)(e))return;let c=[],h=null===(t=this._selection.subDraftContext)||void 0===t?void 0:t.subDraftId,g=this._dataSdk.cutSame.getMutableVideos(h);for(let e=0;e<u.length;e++){let{segment:t}=u[e].item,n=u[e].item.id,a=this._draftMaterialsService.getMaterials().userGeneratedMaterials,o=g.find(e=>e.segmentId===n);if(!(null==o?void 0:o.filled)||(null===(i=u[e].item.segment.material)||void 0===i?void 0:i.materialId))continue;let d=null!==(l=this._draftPathStore.getResourceKeyFromDraftPath(null!==(s=null===(r=t.material)||void 0===r?void 0:r.path)&&void 0!==s?s:""))&&void 0!==l?l:"";!a.find(e=>e.key===d)&&c.push(o.id)}c.length&&(n.Z.error(d.oc.t("web_deleted_and_recovered",{},"Video added to the slot has been deleted. Add again.")),this._replaceSegmentManager.resetMutableVideo(c,h,!1))})}}g=(0,r.gn)([(0,r.fM)(4,l.D),(0,r.fM)(5,h.rO),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDataSdk?Object:IDataSdk,void 0===s.H?Object:s.H,void 0===u.m?Object:u.m,void 0===c.Y?Object:c.Y,void 0===l.D?Object:l.D,void 0===h.rO?Object:h.rO])],g)}}]);